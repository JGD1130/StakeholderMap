function J8(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const a in i)if(a!=="default"&&!(a in n)){const c=Object.getOwnPropertyDescriptor(i,a);c&&Object.defineProperty(n,a,c.get?c:{enumerable:!0,get:()=>i[a]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const _ of c.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&i(_)}).observe(document,{childList:!0,subtree:!0});function t(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(a){if(a.ep)return;a.ep=!0;const c=t(a);fetch(a.href,c)}})();var tH=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function M_(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Q8(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function i(){var a=!1;try{a=this instanceof i}catch{}return a?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var a=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:function(){return n[i]}})}),t}var Bb={exports:{}},M0={},zb={exports:{}},Bo={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tS;function eP(){if(tS)return Bo;tS=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),_=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),s=Symbol.for("react.suspense"),T=Symbol.for("react.memo"),L=Symbol.for("react.lazy"),R=Symbol.iterator;function U(Ce){return Ce===null||typeof Ce!="object"?null:(Ce=R&&Ce[R]||Ce["@@iterator"],typeof Ce=="function"?Ce:null)}var M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Q=Object.assign,ae={};function ye(Ce,ge,We){this.props=Ce,this.context=ge,this.refs=ae,this.updater=We||M}ye.prototype.isReactComponent={},ye.prototype.setState=function(Ce,ge){if(typeof Ce!="object"&&typeof Ce!="function"&&Ce!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ce,ge,"setState")},ye.prototype.forceUpdate=function(Ce){this.updater.enqueueForceUpdate(this,Ce,"forceUpdate")};function ie(){}ie.prototype=ye.prototype;function oe(Ce,ge,We){this.props=Ce,this.context=ge,this.refs=ae,this.updater=We||M}var ve=oe.prototype=new ie;ve.constructor=oe,Q(ve,ye.prototype),ve.isPureReactComponent=!0;var de=Array.isArray,Pe=Object.prototype.hasOwnProperty,Be={current:null},_e={key:!0,ref:!0,__self:!0,__source:!0};function G(Ce,ge,We){var Ve,ut={},pt=null,It=null;if(ge!=null)for(Ve in ge.ref!==void 0&&(It=ge.ref),ge.key!==void 0&&(pt=""+ge.key),ge)Pe.call(ge,Ve)&&!_e.hasOwnProperty(Ve)&&(ut[Ve]=ge[Ve]);var Oe=arguments.length-2;if(Oe===1)ut.children=We;else if(1<Oe){for(var Wt=Array(Oe),Zt=0;Zt<Oe;Zt++)Wt[Zt]=arguments[Zt+2];ut.children=Wt}if(Ce&&Ce.defaultProps)for(Ve in Oe=Ce.defaultProps,Oe)ut[Ve]===void 0&&(ut[Ve]=Oe[Ve]);return{$$typeof:n,type:Ce,key:pt,ref:It,props:ut,_owner:Be.current}}function B(Ce,ge){return{$$typeof:n,type:Ce.type,key:ge,ref:Ce.ref,props:Ce.props,_owner:Ce._owner}}function Y(Ce){return typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===n}function $(Ce){var ge={"=":"=0",":":"=2"};return"$"+Ce.replace(/[=:]/g,function(We){return ge[We]})}var J=/\/+/g;function te(Ce,ge){return typeof Ce=="object"&&Ce!==null&&Ce.key!=null?$(""+Ce.key):ge.toString(36)}function Se(Ce,ge,We,Ve,ut){var pt=typeof Ce;(pt==="undefined"||pt==="boolean")&&(Ce=null);var It=!1;if(Ce===null)It=!0;else switch(pt){case"string":case"number":It=!0;break;case"object":switch(Ce.$$typeof){case n:case e:It=!0}}if(It)return It=Ce,ut=ut(It),Ce=Ve===""?"."+te(It,0):Ve,de(ut)?(We="",Ce!=null&&(We=Ce.replace(J,"$&/")+"/"),Se(ut,ge,We,"",function(Zt){return Zt})):ut!=null&&(Y(ut)&&(ut=B(ut,We+(!ut.key||It&&It.key===ut.key?"":(""+ut.key).replace(J,"$&/")+"/")+Ce)),ge.push(ut)),1;if(It=0,Ve=Ve===""?".":Ve+":",de(Ce))for(var Oe=0;Oe<Ce.length;Oe++){pt=Ce[Oe];var Wt=Ve+te(pt,Oe);It+=Se(pt,ge,We,Wt,ut)}else if(Wt=U(Ce),typeof Wt=="function")for(Ce=Wt.call(Ce),Oe=0;!(pt=Ce.next()).done;)pt=pt.value,Wt=Ve+te(pt,Oe++),It+=Se(pt,ge,We,Wt,ut);else if(pt==="object")throw ge=String(Ce),Error("Objects are not valid as a React child (found: "+(ge==="[object Object]"?"object with keys {"+Object.keys(Ce).join(", ")+"}":ge)+"). If you meant to render a collection of children, use an array instead.");return It}function De(Ce,ge,We){if(Ce==null)return Ce;var Ve=[],ut=0;return Se(Ce,Ve,"","",function(pt){return ge.call(We,pt,ut++)}),Ve}function $e(Ce){if(Ce._status===-1){var ge=Ce._result;ge=ge(),ge.then(function(We){(Ce._status===0||Ce._status===-1)&&(Ce._status=1,Ce._result=We)},function(We){(Ce._status===0||Ce._status===-1)&&(Ce._status=2,Ce._result=We)}),Ce._status===-1&&(Ce._status=0,Ce._result=ge)}if(Ce._status===1)return Ce._result.default;throw Ce._result}var Ue={current:null},Le={transition:null},He={ReactCurrentDispatcher:Ue,ReactCurrentBatchConfig:Le,ReactCurrentOwner:Be};function Ke(){throw Error("act(...) is not supported in production builds of React.")}return Bo.Children={map:De,forEach:function(Ce,ge,We){De(Ce,function(){ge.apply(this,arguments)},We)},count:function(Ce){var ge=0;return De(Ce,function(){ge++}),ge},toArray:function(Ce){return De(Ce,function(ge){return ge})||[]},only:function(Ce){if(!Y(Ce))throw Error("React.Children.only expected to receive a single React element child.");return Ce}},Bo.Component=ye,Bo.Fragment=t,Bo.Profiler=a,Bo.PureComponent=oe,Bo.StrictMode=i,Bo.Suspense=s,Bo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=He,Bo.act=Ke,Bo.cloneElement=function(Ce,ge,We){if(Ce==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ce+".");var Ve=Q({},Ce.props),ut=Ce.key,pt=Ce.ref,It=Ce._owner;if(ge!=null){if(ge.ref!==void 0&&(pt=ge.ref,It=Be.current),ge.key!==void 0&&(ut=""+ge.key),Ce.type&&Ce.type.defaultProps)var Oe=Ce.type.defaultProps;for(Wt in ge)Pe.call(ge,Wt)&&!_e.hasOwnProperty(Wt)&&(Ve[Wt]=ge[Wt]===void 0&&Oe!==void 0?Oe[Wt]:ge[Wt])}var Wt=arguments.length-2;if(Wt===1)Ve.children=We;else if(1<Wt){Oe=Array(Wt);for(var Zt=0;Zt<Wt;Zt++)Oe[Zt]=arguments[Zt+2];Ve.children=Oe}return{$$typeof:n,type:Ce.type,key:ut,ref:pt,props:Ve,_owner:It}},Bo.createContext=function(Ce){return Ce={$$typeof:_,_currentValue:Ce,_currentValue2:Ce,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ce.Provider={$$typeof:c,_context:Ce},Ce.Consumer=Ce},Bo.createElement=G,Bo.createFactory=function(Ce){var ge=G.bind(null,Ce);return ge.type=Ce,ge},Bo.createRef=function(){return{current:null}},Bo.forwardRef=function(Ce){return{$$typeof:y,render:Ce}},Bo.isValidElement=Y,Bo.lazy=function(Ce){return{$$typeof:L,_payload:{_status:-1,_result:Ce},_init:$e}},Bo.memo=function(Ce,ge){return{$$typeof:T,type:Ce,compare:ge===void 0?null:ge}},Bo.startTransition=function(Ce){var ge=Le.transition;Le.transition={};try{Ce()}finally{Le.transition=ge}},Bo.unstable_act=Ke,Bo.useCallback=function(Ce,ge){return Ue.current.useCallback(Ce,ge)},Bo.useContext=function(Ce){return Ue.current.useContext(Ce)},Bo.useDebugValue=function(){},Bo.useDeferredValue=function(Ce){return Ue.current.useDeferredValue(Ce)},Bo.useEffect=function(Ce,ge){return Ue.current.useEffect(Ce,ge)},Bo.useId=function(){return Ue.current.useId()},Bo.useImperativeHandle=function(Ce,ge,We){return Ue.current.useImperativeHandle(Ce,ge,We)},Bo.useInsertionEffect=function(Ce,ge){return Ue.current.useInsertionEffect(Ce,ge)},Bo.useLayoutEffect=function(Ce,ge){return Ue.current.useLayoutEffect(Ce,ge)},Bo.useMemo=function(Ce,ge){return Ue.current.useMemo(Ce,ge)},Bo.useReducer=function(Ce,ge,We){return Ue.current.useReducer(Ce,ge,We)},Bo.useRef=function(Ce){return Ue.current.useRef(Ce)},Bo.useState=function(Ce){return Ue.current.useState(Ce)},Bo.useSyncExternalStore=function(Ce,ge,We){return Ue.current.useSyncExternalStore(Ce,ge,We)},Bo.useTransition=function(){return Ue.current.useTransition()},Bo.version="18.3.1",Bo}var nS;function Q5(){return nS||(nS=1,zb.exports=eP()),zb.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rS;function tP(){if(rS)return M0;rS=1;var n=Q5(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function _(y,s,T){var L,R={},U=null,M=null;T!==void 0&&(U=""+T),s.key!==void 0&&(U=""+s.key),s.ref!==void 0&&(M=s.ref);for(L in s)i.call(s,L)&&!c.hasOwnProperty(L)&&(R[L]=s[L]);if(y&&y.defaultProps)for(L in s=y.defaultProps,s)R[L]===void 0&&(R[L]=s[L]);return{$$typeof:e,type:y,key:U,ref:M,props:R,_owner:a.current}}return M0.Fragment=t,M0.jsx=_,M0.jsxs=_,M0}var iS;function nP(){return iS||(iS=1,Bb.exports=tP()),Bb.exports}var se=nP(),tr=Q5();const rP=M_(tr),iP=J8({__proto__:null,default:rP},[tr]);var A1={},jb={exports:{}},sf={},Ub={exports:{}},Vb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sS;function sP(){return sS||(sS=1,(function(n){function e(Le,He){var Ke=Le.length;Le.push(He);e:for(;0<Ke;){var Ce=Ke-1>>>1,ge=Le[Ce];if(0<a(ge,He))Le[Ce]=He,Le[Ke]=ge,Ke=Ce;else break e}}function t(Le){return Le.length===0?null:Le[0]}function i(Le){if(Le.length===0)return null;var He=Le[0],Ke=Le.pop();if(Ke!==He){Le[0]=Ke;e:for(var Ce=0,ge=Le.length,We=ge>>>1;Ce<We;){var Ve=2*(Ce+1)-1,ut=Le[Ve],pt=Ve+1,It=Le[pt];if(0>a(ut,Ke))pt<ge&&0>a(It,ut)?(Le[Ce]=It,Le[pt]=Ke,Ce=pt):(Le[Ce]=ut,Le[Ve]=Ke,Ce=Ve);else if(pt<ge&&0>a(It,Ke))Le[Ce]=It,Le[pt]=Ke,Ce=pt;else break e}}return He}function a(Le,He){var Ke=Le.sortIndex-He.sortIndex;return Ke!==0?Ke:Le.id-He.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;n.unstable_now=function(){return c.now()}}else{var _=Date,y=_.now();n.unstable_now=function(){return _.now()-y}}var s=[],T=[],L=1,R=null,U=3,M=!1,Q=!1,ae=!1,ye=typeof setTimeout=="function"?setTimeout:null,ie=typeof clearTimeout=="function"?clearTimeout:null,oe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ve(Le){for(var He=t(T);He!==null;){if(He.callback===null)i(T);else if(He.startTime<=Le)i(T),He.sortIndex=He.expirationTime,e(s,He);else break;He=t(T)}}function de(Le){if(ae=!1,ve(Le),!Q)if(t(s)!==null)Q=!0,$e(Pe);else{var He=t(T);He!==null&&Ue(de,He.startTime-Le)}}function Pe(Le,He){Q=!1,ae&&(ae=!1,ie(G),G=-1),M=!0;var Ke=U;try{for(ve(He),R=t(s);R!==null&&(!(R.expirationTime>He)||Le&&!$());){var Ce=R.callback;if(typeof Ce=="function"){R.callback=null,U=R.priorityLevel;var ge=Ce(R.expirationTime<=He);He=n.unstable_now(),typeof ge=="function"?R.callback=ge:R===t(s)&&i(s),ve(He)}else i(s);R=t(s)}if(R!==null)var We=!0;else{var Ve=t(T);Ve!==null&&Ue(de,Ve.startTime-He),We=!1}return We}finally{R=null,U=Ke,M=!1}}var Be=!1,_e=null,G=-1,B=5,Y=-1;function $(){return!(n.unstable_now()-Y<B)}function J(){if(_e!==null){var Le=n.unstable_now();Y=Le;var He=!0;try{He=_e(!0,Le)}finally{He?te():(Be=!1,_e=null)}}else Be=!1}var te;if(typeof oe=="function")te=function(){oe(J)};else if(typeof MessageChannel<"u"){var Se=new MessageChannel,De=Se.port2;Se.port1.onmessage=J,te=function(){De.postMessage(null)}}else te=function(){ye(J,0)};function $e(Le){_e=Le,Be||(Be=!0,te())}function Ue(Le,He){G=ye(function(){Le(n.unstable_now())},He)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Le){Le.callback=null},n.unstable_continueExecution=function(){Q||M||(Q=!0,$e(Pe))},n.unstable_forceFrameRate=function(Le){0>Le||125<Le?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<Le?Math.floor(1e3/Le):5},n.unstable_getCurrentPriorityLevel=function(){return U},n.unstable_getFirstCallbackNode=function(){return t(s)},n.unstable_next=function(Le){switch(U){case 1:case 2:case 3:var He=3;break;default:He=U}var Ke=U;U=He;try{return Le()}finally{U=Ke}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Le,He){switch(Le){case 1:case 2:case 3:case 4:case 5:break;default:Le=3}var Ke=U;U=Le;try{return He()}finally{U=Ke}},n.unstable_scheduleCallback=function(Le,He,Ke){var Ce=n.unstable_now();switch(typeof Ke=="object"&&Ke!==null?(Ke=Ke.delay,Ke=typeof Ke=="number"&&0<Ke?Ce+Ke:Ce):Ke=Ce,Le){case 1:var ge=-1;break;case 2:ge=250;break;case 5:ge=1073741823;break;case 4:ge=1e4;break;default:ge=5e3}return ge=Ke+ge,Le={id:L++,callback:He,priorityLevel:Le,startTime:Ke,expirationTime:ge,sortIndex:-1},Ke>Ce?(Le.sortIndex=Ke,e(T,Le),t(s)===null&&Le===t(T)&&(ae?(ie(G),G=-1):ae=!0,Ue(de,Ke-Ce))):(Le.sortIndex=ge,e(s,Le),Q||M||(Q=!0,$e(Pe))),Le},n.unstable_shouldYield=$,n.unstable_wrapCallback=function(Le){var He=U;return function(){var Ke=U;U=He;try{return Le.apply(this,arguments)}finally{U=Ke}}}})(Vb)),Vb}var oS;function oP(){return oS||(oS=1,Ub.exports=sP()),Ub.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aS;function aP(){if(aS)return sf;aS=1;var n=Q5(),e=oP();function t(p){for(var v="https://reactjs.org/docs/error-decoder.html?invariant="+p,C=1;C<arguments.length;C++)v+="&args[]="+encodeURIComponent(arguments[C]);return"Minified React error #"+p+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,a={};function c(p,v){_(p,v),_(p+"Capture",v)}function _(p,v){for(a[p]=v,p=0;p<v.length;p++)i.add(v[p])}var y=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),s=Object.prototype.hasOwnProperty,T=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,L={},R={};function U(p){return s.call(R,p)?!0:s.call(L,p)?!1:T.test(p)?R[p]=!0:(L[p]=!0,!1)}function M(p,v,C,V){if(C!==null&&C.type===0)return!1;switch(typeof v){case"function":case"symbol":return!0;case"boolean":return V?!1:C!==null?!C.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function Q(p,v,C,V){if(v===null||typeof v>"u"||M(p,v,C,V))return!0;if(V)return!1;if(C!==null)switch(C.type){case 3:return!v;case 4:return v===!1;case 5:return isNaN(v);case 6:return isNaN(v)||1>v}return!1}function ae(p,v,C,V,ne,xe,Je){this.acceptsBooleans=v===2||v===3||v===4,this.attributeName=V,this.attributeNamespace=ne,this.mustUseProperty=C,this.propertyName=p,this.type=v,this.sanitizeURL=xe,this.removeEmptyString=Je}var ye={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){ye[p]=new ae(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var v=p[0];ye[v]=new ae(v,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){ye[p]=new ae(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){ye[p]=new ae(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){ye[p]=new ae(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){ye[p]=new ae(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){ye[p]=new ae(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){ye[p]=new ae(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){ye[p]=new ae(p,5,!1,p.toLowerCase(),null,!1,!1)});var ie=/[\-:]([a-z])/g;function oe(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var v=p.replace(ie,oe);ye[v]=new ae(v,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var v=p.replace(ie,oe);ye[v]=new ae(v,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var v=p.replace(ie,oe);ye[v]=new ae(v,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){ye[p]=new ae(p,1,!1,p.toLowerCase(),null,!1,!1)}),ye.xlinkHref=new ae("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){ye[p]=new ae(p,1,!1,p.toLowerCase(),null,!0,!0)});function ve(p,v,C,V){var ne=ye.hasOwnProperty(v)?ye[v]:null;(ne!==null?ne.type!==0:V||!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(Q(v,C,ne,V)&&(C=null),V||ne===null?U(v)&&(C===null?p.removeAttribute(v):p.setAttribute(v,""+C)):ne.mustUseProperty?p[ne.propertyName]=C===null?ne.type===3?!1:"":C:(v=ne.attributeName,V=ne.attributeNamespace,C===null?p.removeAttribute(v):(ne=ne.type,C=ne===3||ne===4&&C===!0?"":""+C,V?p.setAttributeNS(V,v,C):p.setAttribute(v,C))))}var de=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Pe=Symbol.for("react.element"),Be=Symbol.for("react.portal"),_e=Symbol.for("react.fragment"),G=Symbol.for("react.strict_mode"),B=Symbol.for("react.profiler"),Y=Symbol.for("react.provider"),$=Symbol.for("react.context"),J=Symbol.for("react.forward_ref"),te=Symbol.for("react.suspense"),Se=Symbol.for("react.suspense_list"),De=Symbol.for("react.memo"),$e=Symbol.for("react.lazy"),Ue=Symbol.for("react.offscreen"),Le=Symbol.iterator;function He(p){return p===null||typeof p!="object"?null:(p=Le&&p[Le]||p["@@iterator"],typeof p=="function"?p:null)}var Ke=Object.assign,Ce;function ge(p){if(Ce===void 0)try{throw Error()}catch(C){var v=C.stack.trim().match(/\n( *(at )?)/);Ce=v&&v[1]||""}return`
`+Ce+p}var We=!1;function Ve(p,v){if(!p||We)return"";We=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(v)if(v=function(){throw Error()},Object.defineProperty(v.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(v,[])}catch(Nn){var V=Nn}Reflect.construct(p,[],v)}else{try{v.call()}catch(Nn){V=Nn}p.call(v.prototype)}else{try{throw Error()}catch(Nn){V=Nn}p()}}catch(Nn){if(Nn&&V&&typeof Nn.stack=="string"){for(var ne=Nn.stack.split(`
`),xe=V.stack.split(`
`),Je=ne.length-1,Ft=xe.length-1;1<=Je&&0<=Ft&&ne[Je]!==xe[Ft];)Ft--;for(;1<=Je&&0<=Ft;Je--,Ft--)if(ne[Je]!==xe[Ft]){if(Je!==1||Ft!==1)do if(Je--,Ft--,0>Ft||ne[Je]!==xe[Ft]){var Kt=`
`+ne[Je].replace(" at new "," at ");return p.displayName&&Kt.includes("<anonymous>")&&(Kt=Kt.replace("<anonymous>",p.displayName)),Kt}while(1<=Je&&0<=Ft);break}}}finally{We=!1,Error.prepareStackTrace=C}return(p=p?p.displayName||p.name:"")?ge(p):""}function ut(p){switch(p.tag){case 5:return ge(p.type);case 16:return ge("Lazy");case 13:return ge("Suspense");case 19:return ge("SuspenseList");case 0:case 2:case 15:return p=Ve(p.type,!1),p;case 11:return p=Ve(p.type.render,!1),p;case 1:return p=Ve(p.type,!0),p;default:return""}}function pt(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case _e:return"Fragment";case Be:return"Portal";case B:return"Profiler";case G:return"StrictMode";case te:return"Suspense";case Se:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case $:return(p.displayName||"Context")+".Consumer";case Y:return(p._context.displayName||"Context")+".Provider";case J:var v=p.render;return p=p.displayName,p||(p=v.displayName||v.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case De:return v=p.displayName||null,v!==null?v:pt(p.type)||"Memo";case $e:v=p._payload,p=p._init;try{return pt(p(v))}catch{}}return null}function It(p){var v=p.type;switch(p.tag){case 24:return"Cache";case 9:return(v.displayName||"Context")+".Consumer";case 10:return(v._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=v.render,p=p.displayName||p.name||"",v.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return v;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return pt(v);case 8:return v===G?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof v=="function")return v.displayName||v.name||null;if(typeof v=="string")return v}return null}function Oe(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function Wt(p){var v=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(v==="checkbox"||v==="radio")}function Zt(p){var v=Wt(p)?"checked":"value",C=Object.getOwnPropertyDescriptor(p.constructor.prototype,v),V=""+p[v];if(!p.hasOwnProperty(v)&&typeof C<"u"&&typeof C.get=="function"&&typeof C.set=="function"){var ne=C.get,xe=C.set;return Object.defineProperty(p,v,{configurable:!0,get:function(){return ne.call(this)},set:function(Je){V=""+Je,xe.call(this,Je)}}),Object.defineProperty(p,v,{enumerable:C.enumerable}),{getValue:function(){return V},setValue:function(Je){V=""+Je},stopTracking:function(){p._valueTracker=null,delete p[v]}}}}function Xt(p){p._valueTracker||(p._valueTracker=Zt(p))}function Ze(p){if(!p)return!1;var v=p._valueTracker;if(!v)return!0;var C=v.getValue(),V="";return p&&(V=Wt(p)?p.checked?"true":"false":p.value),p=V,p!==C?(v.setValue(p),!0):!1}function zn(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function on(p,v){var C=v.checked;return Ke({},v,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:C??p._wrapperState.initialChecked})}function mt(p,v){var C=v.defaultValue==null?"":v.defaultValue,V=v.checked!=null?v.checked:v.defaultChecked;C=Oe(v.value!=null?v.value:C),p._wrapperState={initialChecked:V,initialValue:C,controlled:v.type==="checkbox"||v.type==="radio"?v.checked!=null:v.value!=null}}function Ir(p,v){v=v.checked,v!=null&&ve(p,"checked",v,!1)}function Fr(p,v){Ir(p,v);var C=Oe(v.value),V=v.type;if(C!=null)V==="number"?(C===0&&p.value===""||p.value!=C)&&(p.value=""+C):p.value!==""+C&&(p.value=""+C);else if(V==="submit"||V==="reset"){p.removeAttribute("value");return}v.hasOwnProperty("value")?$t(p,v.type,C):v.hasOwnProperty("defaultValue")&&$t(p,v.type,Oe(v.defaultValue)),v.checked==null&&v.defaultChecked!=null&&(p.defaultChecked=!!v.defaultChecked)}function qr(p,v,C){if(v.hasOwnProperty("value")||v.hasOwnProperty("defaultValue")){var V=v.type;if(!(V!=="submit"&&V!=="reset"||v.value!==void 0&&v.value!==null))return;v=""+p._wrapperState.initialValue,C||v===p.value||(p.value=v),p.defaultValue=v}C=p.name,C!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,C!==""&&(p.name=C)}function $t(p,v,C){(v!=="number"||zn(p.ownerDocument)!==p)&&(C==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+C&&(p.defaultValue=""+C))}var xr=Array.isArray;function dr(p,v,C,V){if(p=p.options,v){v={};for(var ne=0;ne<C.length;ne++)v["$"+C[ne]]=!0;for(C=0;C<p.length;C++)ne=v.hasOwnProperty("$"+p[C].value),p[C].selected!==ne&&(p[C].selected=ne),ne&&V&&(p[C].defaultSelected=!0)}else{for(C=""+Oe(C),v=null,ne=0;ne<p.length;ne++){if(p[ne].value===C){p[ne].selected=!0,V&&(p[ne].defaultSelected=!0);return}v!==null||p[ne].disabled||(v=p[ne])}v!==null&&(v.selected=!0)}}function ni(p,v){if(v.dangerouslySetInnerHTML!=null)throw Error(t(91));return Ke({},v,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function nn(p,v){var C=v.value;if(C==null){if(C=v.children,v=v.defaultValue,C!=null){if(v!=null)throw Error(t(92));if(xr(C)){if(1<C.length)throw Error(t(93));C=C[0]}v=C}v==null&&(v=""),C=v}p._wrapperState={initialValue:Oe(C)}}function yn(p,v){var C=Oe(v.value),V=Oe(v.defaultValue);C!=null&&(C=""+C,C!==p.value&&(p.value=C),v.defaultValue==null&&p.defaultValue!==C&&(p.defaultValue=C)),V!=null&&(p.defaultValue=""+V)}function sr(p){var v=p.textContent;v===p._wrapperState.initialValue&&v!==""&&v!==null&&(p.value=v)}function Zn(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function $r(p,v){return p==null||p==="http://www.w3.org/1999/xhtml"?Zn(v):p==="http://www.w3.org/2000/svg"&&v==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var qn,jr=(function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(v,C,V,ne){MSApp.execUnsafeLocalFunction(function(){return p(v,C,V,ne)})}:p})(function(p,v){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=v;else{for(qn=qn||document.createElement("div"),qn.innerHTML="<svg>"+v.valueOf().toString()+"</svg>",v=qn.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;v.firstChild;)p.appendChild(v.firstChild)}});function ir(p,v){if(v){var C=p.firstChild;if(C&&C===p.lastChild&&C.nodeType===3){C.nodeValue=v;return}}p.textContent=v}var Xn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Bi=["Webkit","ms","Moz","O"];Object.keys(Xn).forEach(function(p){Bi.forEach(function(v){v=v+p.charAt(0).toUpperCase()+p.substring(1),Xn[v]=Xn[p]})});function bi(p,v,C){return v==null||typeof v=="boolean"||v===""?"":C||typeof v!="number"||v===0||Xn.hasOwnProperty(p)&&Xn[p]?(""+v).trim():v+"px"}function wr(p,v){p=p.style;for(var C in v)if(v.hasOwnProperty(C)){var V=C.indexOf("--")===0,ne=bi(C,v[C],V);C==="float"&&(C="cssFloat"),V?p.setProperty(C,ne):p[C]=ne}}var or=Ke({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ui(p,v){if(v){if(or[p]&&(v.children!=null||v.dangerouslySetInnerHTML!=null))throw Error(t(137,p));if(v.dangerouslySetInnerHTML!=null){if(v.children!=null)throw Error(t(60));if(typeof v.dangerouslySetInnerHTML!="object"||!("__html"in v.dangerouslySetInnerHTML))throw Error(t(61))}if(v.style!=null&&typeof v.style!="object")throw Error(t(62))}}function Kr(p,v){if(p.indexOf("-")===-1)return typeof v.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wi=null;function si(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var vt=null,Ne=null,ze=null;function ft(p){if(p=yl(p)){if(typeof vt!="function")throw Error(t(280));var v=p.stateNode;v&&(v=cf(v),vt(p.stateNode,p.type,v))}}function wt(p){Ne?ze?ze.push(p):ze=[p]:Ne=p}function Ut(){if(Ne){var p=Ne,v=ze;if(ze=Ne=null,ft(p),v)for(p=0;p<v.length;p++)ft(v[p])}}function Gt(p,v){return p(v)}function Tt(){}var Ot=!1;function zt(p,v,C){if(Ot)return p(v,C);Ot=!0;try{return Gt(p,v,C)}finally{Ot=!1,(Ne!==null||ze!==null)&&(Tt(),Ut())}}function Pn(p,v){var C=p.stateNode;if(C===null)return null;var V=cf(C);if(V===null)return null;C=V[v];e:switch(v){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(V=!V.disabled)||(p=p.type,V=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!V;break e;default:p=!1}if(p)return null;if(C&&typeof C!="function")throw Error(t(231,v,typeof C));return C}var Jn=!1;if(y)try{var Fn={};Object.defineProperty(Fn,"passive",{get:function(){Jn=!0}}),window.addEventListener("test",Fn,Fn),window.removeEventListener("test",Fn,Fn)}catch{Jn=!1}function Gr(p,v,C,V,ne,xe,Je,Ft,Kt){var Nn=Array.prototype.slice.call(arguments,3);try{v.apply(C,Nn)}catch(br){this.onError(br)}}var Mr=!1,Zr=null,Br=!1,zi=null,ms={onError:function(p){Mr=!0,Zr=p}};function Os(p,v,C,V,ne,xe,Je,Ft,Kt){Mr=!1,Zr=null,Gr.apply(ms,arguments)}function cs(p,v,C,V,ne,xe,Je,Ft,Kt){if(Os.apply(this,arguments),Mr){if(Mr){var Nn=Zr;Mr=!1,Zr=null}else throw Error(t(198));Br||(Br=!0,zi=Nn)}}function ps(p){var v=p,C=p;if(p.alternate)for(;v.return;)v=v.return;else{p=v;do v=p,(v.flags&4098)!==0&&(C=v.return),p=v.return;while(p)}return v.tag===3?C:null}function vo(p){if(p.tag===13){var v=p.memoizedState;if(v===null&&(p=p.alternate,p!==null&&(v=p.memoizedState)),v!==null)return v.dehydrated}return null}function is(p){if(ps(p)!==p)throw Error(t(188))}function xo(p){var v=p.alternate;if(!v){if(v=ps(p),v===null)throw Error(t(188));return v!==p?null:p}for(var C=p,V=v;;){var ne=C.return;if(ne===null)break;var xe=ne.alternate;if(xe===null){if(V=ne.return,V!==null){C=V;continue}break}if(ne.child===xe.child){for(xe=ne.child;xe;){if(xe===C)return is(ne),p;if(xe===V)return is(ne),v;xe=xe.sibling}throw Error(t(188))}if(C.return!==V.return)C=ne,V=xe;else{for(var Je=!1,Ft=ne.child;Ft;){if(Ft===C){Je=!0,C=ne,V=xe;break}if(Ft===V){Je=!0,V=ne,C=xe;break}Ft=Ft.sibling}if(!Je){for(Ft=xe.child;Ft;){if(Ft===C){Je=!0,C=xe,V=ne;break}if(Ft===V){Je=!0,V=xe,C=ne;break}Ft=Ft.sibling}if(!Je)throw Error(t(189))}}if(C.alternate!==V)throw Error(t(190))}if(C.tag!==3)throw Error(t(188));return C.stateNode.current===C?p:v}function ua(p){return p=xo(p),p!==null?tl(p):null}function tl(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var v=tl(p);if(v!==null)return v;p=p.sibling}return null}var Pa=e.unstable_scheduleCallback,di=e.unstable_cancelCallback,ou=e.unstable_shouldYield,yc=e.unstable_requestPaint,Ss=e.unstable_now,au=e.unstable_getCurrentPriorityLevel,ga=e.unstable_ImmediatePriority,uo=e.unstable_UserBlockingPriority,nl=e.unstable_NormalPriority,Kl=e.unstable_LowPriority,ea=e.unstable_IdlePriority,Wo=null,ta=null;function En(p){if(ta&&typeof ta.onCommitFiberRoot=="function")try{ta.onCommitFiberRoot(Wo,p,void 0,(p.current.flags&128)===128)}catch{}}var co=Math.clz32?Math.clz32:ic,Io=Math.log,Ni=Math.LN2;function ic(p){return p>>>=0,p===0?32:31-(Io(p)/Ni|0)|0}var rl=64,il=4194304;function Ga(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function ho(p,v){var C=p.pendingLanes;if(C===0)return 0;var V=0,ne=p.suspendedLanes,xe=p.pingedLanes,Je=C&268435455;if(Je!==0){var Ft=Je&~ne;Ft!==0?V=Ga(Ft):(xe&=Je,xe!==0&&(V=Ga(xe)))}else Je=C&~ne,Je!==0?V=Ga(Je):xe!==0&&(V=Ga(xe));if(V===0)return 0;if(v!==0&&v!==V&&(v&ne)===0&&(ne=V&-V,xe=v&-v,ne>=xe||ne===16&&(xe&4194240)!==0))return v;if((V&4)!==0&&(V|=C&16),v=p.entangledLanes,v!==0)for(p=p.entanglements,v&=V;0<v;)C=31-co(v),ne=1<<C,V|=p[C],v&=~ne;return V}function lr(p,v){switch(p){case 1:case 2:case 4:return v+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Wr(p,v){for(var C=p.suspendedLanes,V=p.pingedLanes,ne=p.expirationTimes,xe=p.pendingLanes;0<xe;){var Je=31-co(xe),Ft=1<<Je,Kt=ne[Je];Kt===-1?((Ft&C)===0||(Ft&V)!==0)&&(ne[Je]=lr(Ft,v)):Kt<=v&&(p.expiredLanes|=Ft),xe&=~Ft}}function Ur(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function ca(){var p=rl;return rl<<=1,(rl&4194240)===0&&(rl=64),p}function $a(p){for(var v=[],C=0;31>C;C++)v.push(p);return v}function Ri(p,v,C){p.pendingLanes|=v,v!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,v=31-co(v),p[v]=C}function Hi(p,v){var C=p.pendingLanes&~v;p.pendingLanes=v,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=v,p.mutableReadLanes&=v,p.entangledLanes&=v,v=p.entanglements;var V=p.eventTimes;for(p=p.expirationTimes;0<C;){var ne=31-co(C),xe=1<<ne;v[ne]=0,V[ne]=-1,p[ne]=-1,C&=~xe}}function Tl(p,v){var C=p.entangledLanes|=v;for(p=p.entanglements;C;){var V=31-co(C),ne=1<<V;ne&v|p[V]&v&&(p[V]|=v),C&=~ne}}var Wi=0;function ko(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var ss,$u,lu,mu,Us,Ha=!1,sl=[],Vo=null,Ei=null,bo=null,gi=new Map,wo=new Map,Vs=[],Nc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pu(p,v){switch(p){case"focusin":case"focusout":Vo=null;break;case"dragenter":case"dragleave":Ei=null;break;case"mouseover":case"mouseout":bo=null;break;case"pointerover":case"pointerout":gi.delete(v.pointerId);break;case"gotpointercapture":case"lostpointercapture":wo.delete(v.pointerId)}}function Fs(p,v,C,V,ne,xe){return p===null||p.nativeEvent!==xe?(p={blockedOn:v,domEventName:C,eventSystemFlags:V,nativeEvent:xe,targetContainers:[ne]},v!==null&&(v=yl(v),v!==null&&$u(v)),p):(p.eventSystemFlags|=V,v=p.targetContainers,ne!==null&&v.indexOf(ne)===-1&&v.push(ne),p)}function na(p,v,C,V,ne){switch(v){case"focusin":return Vo=Fs(Vo,p,v,C,V,ne),!0;case"dragenter":return Ei=Fs(Ei,p,v,C,V,ne),!0;case"mouseover":return bo=Fs(bo,p,v,C,V,ne),!0;case"pointerover":var xe=ne.pointerId;return gi.set(xe,Fs(gi.get(xe)||null,p,v,C,V,ne)),!0;case"gotpointercapture":return xe=ne.pointerId,wo.set(xe,Fs(wo.get(xe)||null,p,v,C,V,ne)),!0}return!1}function Es(p){var v=Vl(p.target);if(v!==null){var C=ps(v);if(C!==null){if(v=C.tag,v===13){if(v=vo(C),v!==null){p.blockedOn=v,Us(p.priority,function(){lu(C)});return}}else if(v===3&&C.stateNode.current.memoizedState.isDehydrated){p.blockedOn=C.tag===3?C.stateNode.containerInfo:null;return}}}p.blockedOn=null}function xs(p){if(p.blockedOn!==null)return!1;for(var v=p.targetContainers;0<v.length;){var C=Nu(p.domEventName,p.eventSystemFlags,v[0],p.nativeEvent);if(C===null){C=p.nativeEvent;var V=new C.constructor(C.type,C);wi=V,C.target.dispatchEvent(V),wi=null}else return v=yl(C),v!==null&&$u(v),p.blockedOn=C,!1;v.shift()}return!0}function Ts(p,v,C){xs(p)&&C.delete(v)}function Ol(){Ha=!1,Vo!==null&&xs(Vo)&&(Vo=null),Ei!==null&&xs(Ei)&&(Ei=null),bo!==null&&xs(bo)&&(bo=null),gi.forEach(Ts),wo.forEach(Ts)}function ha(p,v){p.blockedOn===v&&(p.blockedOn=null,Ha||(Ha=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Ol)))}function ra(p){function v(ne){return ha(ne,p)}if(0<sl.length){ha(sl[0],p);for(var C=1;C<sl.length;C++){var V=sl[C];V.blockedOn===p&&(V.blockedOn=null)}}for(Vo!==null&&ha(Vo,p),Ei!==null&&ha(Ei,p),bo!==null&&ha(bo,p),gi.forEach(v),wo.forEach(v),C=0;C<Vs.length;C++)V=Vs[C],V.blockedOn===p&&(V.blockedOn=null);for(;0<Vs.length&&(C=Vs[0],C.blockedOn===null);)Es(C),C.blockedOn===null&&Vs.shift()}var os=de.ReactCurrentBatchConfig,gu=!0;function ro(p,v,C,V){var ne=Wi,xe=os.transition;os.transition=null;try{Wi=1,ol(p,v,C,V)}finally{Wi=ne,os.transition=xe}}function ya(p,v,C,V){var ne=Wi,xe=os.transition;os.transition=null;try{Wi=4,ol(p,v,C,V)}finally{Wi=ne,os.transition=xe}}function ol(p,v,C,V){if(gu){var ne=Nu(p,v,C,V);if(ne===null)bc(p,v,V,Al,C),Pu(p,V);else if(na(ne,p,v,C,V))V.stopPropagation();else if(Pu(p,V),v&4&&-1<Nc.indexOf(p)){for(;ne!==null;){var xe=yl(ne);if(xe!==null&&ss(xe),xe=Nu(p,v,C,V),xe===null&&bc(p,v,V,Al,C),xe===ne)break;ne=xe}ne!==null&&V.stopPropagation()}else bc(p,v,V,null,C)}}var Al=null;function Nu(p,v,C,V){if(Al=null,p=si(V),p=Vl(p),p!==null)if(v=ps(p),v===null)p=null;else if(C=v.tag,C===13){if(p=vo(v),p!==null)return p;p=null}else if(C===3){if(v.stateNode.current.memoizedState.isDehydrated)return v.tag===3?v.stateNode.containerInfo:null;p=null}else v!==p&&(p=null);return Al=p,null}function Na(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(au()){case ga:return 1;case uo:return 4;case nl:case Kl:return 16;case ea:return 536870912;default:return 16}default:return 16}}var qo=null,ji=null,qs=null;function Lo(){if(qs)return qs;var p,v=ji,C=v.length,V,ne="value"in qo?qo.value:qo.textContent,xe=ne.length;for(p=0;p<C&&v[p]===ne[p];p++);var Je=C-p;for(V=1;V<=Je&&v[C-V]===ne[xe-V];V++);return qs=ne.slice(p,1<V?1-V:void 0)}function _a(p){var v=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&v===13&&(p=13)):p=v,p===10&&(p=13),32<=p||p===13?p:0}function zo(){return!0}function ml(){return!1}function Po(p){function v(C,V,ne,xe,Je){this._reactName=C,this._targetInst=ne,this.type=V,this.nativeEvent=xe,this.target=Je,this.currentTarget=null;for(var Ft in p)p.hasOwnProperty(Ft)&&(C=p[Ft],this[Ft]=C?C(xe):xe[Ft]);return this.isDefaultPrevented=(xe.defaultPrevented!=null?xe.defaultPrevented:xe.returnValue===!1)?zo:ml,this.isPropagationStopped=ml,this}return Ke(v.prototype,{preventDefault:function(){this.defaultPrevented=!0;var C=this.nativeEvent;C&&(C.preventDefault?C.preventDefault():typeof C.returnValue!="unknown"&&(C.returnValue=!1),this.isDefaultPrevented=zo)},stopPropagation:function(){var C=this.nativeEvent;C&&(C.stopPropagation?C.stopPropagation():typeof C.cancelBubble!="unknown"&&(C.cancelBubble=!0),this.isPropagationStopped=zo)},persist:function(){},isPersistent:zo}),v}var fa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},va=Po(fa),ee=Ke({},fa,{view:0,detail:0}),je=Po(ee),At,kt,sn,fn=Ke({},ee,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gl,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==sn&&(sn&&p.type==="mousemove"?(At=p.screenX-sn.screenX,kt=p.screenY-sn.screenY):kt=At=0,sn=p),At)},movementY:function(p){return"movementY"in p?p.movementY:kt}}),Qn=Po(fn),Xr=Ke({},fn,{dataTransfer:0}),Qr=Po(Xr),oi=Ke({},ee,{relatedTarget:0}),Ui=Po(oi),Ps=Ke({},fa,{animationName:0,elapsedTime:0,pseudoElement:0}),Bs=Po(Ps),fo=Ke({},fa,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Ys=Po(fo),Zs=Ke({},fa,{data:0}),go=Po(Zs),Ns={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},io={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zs={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Fl(p){var v=this.nativeEvent;return v.getModifierState?v.getModifierState(p):(p=zs[p])?!!v[p]:!1}function gl(){return Fl}var O=Ke({},ee,{key:function(p){if(p.key){var v=Ns[p.key]||p.key;if(v!=="Unidentified")return v}return p.type==="keypress"?(p=_a(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?io[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gl,charCode:function(p){return p.type==="keypress"?_a(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?_a(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),me=Po(O),ke=Ke({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nt=Po(ke),hn=Ke({},ee,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gl}),Cn=Po(hn),Sr=Ke({},fa,{propertyName:0,elapsedTime:0,pseudoElement:0}),Rs=Po(Sr),so=Ke({},fn,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),hs=Po(so),es=[9,13,27,32],Js=y&&"CompositionEvent"in window,da=null;y&&"documentMode"in document&&(da=document.documentMode);var oo=y&&"TextEvent"in window&&!da,Vi=y&&(!Js||da&&8<da&&11>=da),Zl=" ",xa=!1;function Rc(p,v){switch(p){case"keyup":return es.indexOf(v.keyCode)!==-1;case"keydown":return v.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ru(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var yu=!1;function Wa(p,v){switch(p){case"compositionend":return Ru(v);case"keypress":return v.which!==32?null:(xa=!0,Zl);case"textInput":return p=v.data,p===Zl&&xa?null:p;default:return null}}function al(p,v){if(yu)return p==="compositionend"||!Js&&Rc(p,v)?(p=Lo(),qs=ji=qo=null,yu=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(v.ctrlKey||v.altKey||v.metaKey)||v.ctrlKey&&v.altKey){if(v.char&&1<v.char.length)return v.char;if(v.which)return String.fromCharCode(v.which)}return null;case"compositionend":return Vi&&v.locale!=="ko"?null:v.data;default:return null}}var Hu={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function yo(p){var v=p&&p.nodeName&&p.nodeName.toLowerCase();return v==="input"?!!Hu[p.type]:v==="textarea"}function ia(p,v,C,V){wt(V),v=pa(v,"onChange"),0<v.length&&(C=new va("onChange","change",null,C,V),p.push({event:C,listeners:v}))}var ll=null,Bl=null;function No(p){Dr(p,0)}function po(p){var v=Xu(p);if(Ze(v))return p}function Ra(p,v){if(p==="change")return v}var sa=!1;if(y){var sc;if(y){var _u="oninput"in document;if(!_u){var zl=document.createElement("div");zl.setAttribute("oninput","return;"),_u=typeof zl.oninput=="function"}sc=_u}else sc=!1;sa=sc&&(!document.documentMode||9<document.documentMode)}function ul(){ll&&(ll.detachEvent("onpropertychange",Jl),Bl=ll=null)}function Jl(p){if(p.propertyName==="value"&&po(Bl)){var v=[];ia(v,Bl,p,si(p)),zt(No,v)}}function jo(p,v,C){p==="focusin"?(ul(),ll=v,Bl=C,ll.attachEvent("onpropertychange",Jl)):p==="focusout"&&ul()}function oa(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return po(Bl)}function E(p,v){if(p==="click")return po(v)}function f(p,v){if(p==="input"||p==="change")return po(v)}function d(p,v){return p===v&&(p!==0||1/p===1/v)||p!==p&&v!==v}var S=typeof Object.is=="function"?Object.is:d;function N(p,v){if(S(p,v))return!0;if(typeof p!="object"||p===null||typeof v!="object"||v===null)return!1;var C=Object.keys(p),V=Object.keys(v);if(C.length!==V.length)return!1;for(V=0;V<C.length;V++){var ne=C[V];if(!s.call(v,ne)||!S(p[ne],v[ne]))return!1}return!0}function X(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function he(p,v){var C=X(p);p=0;for(var V;C;){if(C.nodeType===3){if(V=p+C.textContent.length,p<=v&&V>=v)return{node:C,offset:v-p};p=V}e:{for(;C;){if(C.nextSibling){C=C.nextSibling;break e}C=C.parentNode}C=void 0}C=X(C)}}function Ae(p,v){return p&&v?p===v?!0:p&&p.nodeType===3?!1:v&&v.nodeType===3?Ae(p,v.parentNode):"contains"in p?p.contains(v):p.compareDocumentPosition?!!(p.compareDocumentPosition(v)&16):!1:!1}function Ye(){for(var p=window,v=zn();v instanceof p.HTMLIFrameElement;){try{var C=typeof v.contentWindow.location.href=="string"}catch{C=!1}if(C)p=v.contentWindow;else break;v=zn(p.document)}return v}function bt(p){var v=p&&p.nodeName&&p.nodeName.toLowerCase();return v&&(v==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||v==="textarea"||p.contentEditable==="true")}function an(p){var v=Ye(),C=p.focusedElem,V=p.selectionRange;if(v!==C&&C&&C.ownerDocument&&Ae(C.ownerDocument.documentElement,C)){if(V!==null&&bt(C)){if(v=V.start,p=V.end,p===void 0&&(p=v),"selectionStart"in C)C.selectionStart=v,C.selectionEnd=Math.min(p,C.value.length);else if(p=(v=C.ownerDocument||document)&&v.defaultView||window,p.getSelection){p=p.getSelection();var ne=C.textContent.length,xe=Math.min(V.start,ne);V=V.end===void 0?xe:Math.min(V.end,ne),!p.extend&&xe>V&&(ne=V,V=xe,xe=ne),ne=he(C,xe);var Je=he(C,V);ne&&Je&&(p.rangeCount!==1||p.anchorNode!==ne.node||p.anchorOffset!==ne.offset||p.focusNode!==Je.node||p.focusOffset!==Je.offset)&&(v=v.createRange(),v.setStart(ne.node,ne.offset),p.removeAllRanges(),xe>V?(p.addRange(v),p.extend(Je.node,Je.offset)):(v.setEnd(Je.node,Je.offset),p.addRange(v)))}}for(v=[],p=C;p=p.parentNode;)p.nodeType===1&&v.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof C.focus=="function"&&C.focus(),C=0;C<v.length;C++)p=v[C],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var mn=y&&"documentMode"in document&&11>=document.documentMode,Kn=null,Pr=null,Yr=null,yi=!1;function Ms(p,v,C){var V=C.window===C?C.document:C.nodeType===9?C:C.ownerDocument;yi||Kn==null||Kn!==zn(V)||(V=Kn,"selectionStart"in V&&bt(V)?V={start:V.selectionStart,end:V.selectionEnd}:(V=(V.ownerDocument&&V.ownerDocument.defaultView||window).getSelection(),V={anchorNode:V.anchorNode,anchorOffset:V.anchorOffset,focusNode:V.focusNode,focusOffset:V.focusOffset}),Yr&&N(Yr,V)||(Yr=V,V=pa(Pr,"onSelect"),0<V.length&&(v=new va("onSelect","select",null,v,C),p.push({event:v,listeners:V}),v.target=Kn)))}function Xi(p,v){var C={};return C[p.toLowerCase()]=v.toLowerCase(),C["Webkit"+p]="webkit"+v,C["Moz"+p]="moz"+v,C}var Ds={animationend:Xi("Animation","AnimationEnd"),animationiteration:Xi("Animation","AnimationIteration"),animationstart:Xi("Animation","AnimationStart"),transitionend:Xi("Transition","TransitionEnd")},As={},Xo={};y&&(Xo=document.createElement("div").style,"AnimationEvent"in window||(delete Ds.animationend.animation,delete Ds.animationiteration.animation,delete Ds.animationstart.animation),"TransitionEvent"in window||delete Ds.transitionend.transition);function cl(p){if(As[p])return As[p];if(!Ds[p])return p;var v=Ds[p],C;for(C in v)if(v.hasOwnProperty(C)&&C in Xo)return As[p]=v[C];return p}var Ma=cl("animationend"),Go=cl("animationiteration"),_c=cl("animationstart"),ri=cl("transitionend"),gs=new Map,oc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xa(p,v){gs.set(p,v),c(v,[p])}for(var Ya=0;Ya<oc.length;Ya++){var ba=oc[Ya],jl=ba.toLowerCase(),Wu=ba[0].toUpperCase()+ba.slice(1);Xa(jl,"on"+Wu)}Xa(Ma,"onAnimationEnd"),Xa(Go,"onAnimationIteration"),Xa(_c,"onAnimationStart"),Xa("dblclick","onDoubleClick"),Xa("focusin","onFocus"),Xa("focusout","onBlur"),Xa(ri,"onTransitionEnd"),_("onMouseEnter",["mouseout","mouseover"]),_("onMouseLeave",["mouseout","mouseover"]),_("onPointerEnter",["pointerout","pointerover"]),_("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ka="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),kh=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ka));function ac(p,v,C){var V=p.type||"unknown-event";p.currentTarget=C,cs(V,v,void 0,p),p.currentTarget=null}function Dr(p,v){v=(v&4)!==0;for(var C=0;C<p.length;C++){var V=p[C],ne=V.event;V=V.listeners;e:{var xe=void 0;if(v)for(var Je=V.length-1;0<=Je;Je--){var Ft=V[Je],Kt=Ft.instance,Nn=Ft.currentTarget;if(Ft=Ft.listener,Kt!==xe&&ne.isPropagationStopped())break e;ac(ne,Ft,Nn),xe=Kt}else for(Je=0;Je<V.length;Je++){if(Ft=V[Je],Kt=Ft.instance,Nn=Ft.currentTarget,Ft=Ft.listener,Kt!==xe&&ne.isPropagationStopped())break e;ac(ne,Ft,Nn),xe=Kt}}}if(Br)throw p=zi,Br=!1,zi=null,p}function Is(p,v){var C=v[cu];C===void 0&&(C=v[cu]=new Set);var V=p+"__bubble";C.has(V)||(xc(v,p,2,!1),C.add(V))}function Ql(p,v,C){var V=0;v&&(V|=4),xc(C,p,V,v)}var vc="_reactListening"+Math.random().toString(36).slice(2);function Mu(p){if(!p[vc]){p[vc]=!0,i.forEach(function(C){C!=="selectionchange"&&(kh.has(C)||Ql(C,!1,p),Ql(C,!0,p))});var v=p.nodeType===9?p:p.ownerDocument;v===null||v[vc]||(v[vc]=!0,Ql("selectionchange",!1,v))}}function xc(p,v,C,V){switch(Na(v)){case 1:var ne=ro;break;case 4:ne=ya;break;default:ne=ol}C=ne.bind(null,v,C,p),ne=void 0,!Jn||v!=="touchstart"&&v!=="touchmove"&&v!=="wheel"||(ne=!0),V?ne!==void 0?p.addEventListener(v,C,{capture:!0,passive:ne}):p.addEventListener(v,C,!0):ne!==void 0?p.addEventListener(v,C,{passive:ne}):p.addEventListener(v,C,!1)}function bc(p,v,C,V,ne){var xe=V;if((v&1)===0&&(v&2)===0&&V!==null)e:for(;;){if(V===null)return;var Je=V.tag;if(Je===3||Je===4){var Ft=V.stateNode.containerInfo;if(Ft===ne||Ft.nodeType===8&&Ft.parentNode===ne)break;if(Je===4)for(Je=V.return;Je!==null;){var Kt=Je.tag;if((Kt===3||Kt===4)&&(Kt=Je.stateNode.containerInfo,Kt===ne||Kt.nodeType===8&&Kt.parentNode===ne))return;Je=Je.return}for(;Ft!==null;){if(Je=Vl(Ft),Je===null)return;if(Kt=Je.tag,Kt===5||Kt===6){V=xe=Je;continue e}Ft=Ft.parentNode}}V=V.return}zt(function(){var Nn=xe,br=si(C),Tr=[];e:{var hr=gs.get(p);if(hr!==void 0){var fi=va,Ii=p;switch(p){case"keypress":if(_a(C)===0)break e;case"keydown":case"keyup":fi=me;break;case"focusin":Ii="focus",fi=Ui;break;case"focusout":Ii="blur",fi=Ui;break;case"beforeblur":case"afterblur":fi=Ui;break;case"click":if(C.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":fi=Qn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":fi=Qr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":fi=Cn;break;case Ma:case Go:case _c:fi=Bs;break;case ri:fi=Rs;break;case"scroll":fi=je;break;case"wheel":fi=hs;break;case"copy":case"cut":case"paste":fi=Ys;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":fi=nt}var ki=(v&4)!==0,du=!ki&&p==="scroll",Sn=ki?hr!==null?hr+"Capture":null:hr;ki=[];for(var un=Nn,Ln;un!==null;){Ln=un;var Or=Ln.stateNode;if(Ln.tag===5&&Or!==null&&(Ln=Or,Sn!==null&&(Or=Pn(un,Sn),Or!=null&&ki.push(jn(un,Or,Ln)))),du)break;un=un.return}0<ki.length&&(hr=new fi(hr,Ii,null,C,br),Tr.push({event:hr,listeners:ki}))}}if((v&7)===0){e:{if(hr=p==="mouseover"||p==="pointerover",fi=p==="mouseout"||p==="pointerout",hr&&C!==wi&&(Ii=C.relatedTarget||C.fromElement)&&(Vl(Ii)||Ii[Cs]))break e;if((fi||hr)&&(hr=br.window===br?br:(hr=br.ownerDocument)?hr.defaultView||hr.parentWindow:window,fi?(Ii=C.relatedTarget||C.toElement,fi=Nn,Ii=Ii?Vl(Ii):null,Ii!==null&&(du=ps(Ii),Ii!==du||Ii.tag!==5&&Ii.tag!==6)&&(Ii=null)):(fi=null,Ii=Nn),fi!==Ii)){if(ki=Qn,Or="onMouseLeave",Sn="onMouseEnter",un="mouse",(p==="pointerout"||p==="pointerover")&&(ki=nt,Or="onPointerLeave",Sn="onPointerEnter",un="pointer"),du=fi==null?hr:Xu(fi),Ln=Ii==null?hr:Xu(Ii),hr=new ki(Or,un+"leave",fi,C,br),hr.target=du,hr.relatedTarget=Ln,Or=null,Vl(br)===Nn&&(ki=new ki(Sn,un+"enter",Ii,C,br),ki.target=Ln,ki.relatedTarget=du,Or=ki),du=Or,fi&&Ii)t:{for(ki=fi,Sn=Ii,un=0,Ln=ki;Ln;Ln=Co(Ln))un++;for(Ln=0,Or=Sn;Or;Or=Co(Or))Ln++;for(;0<un-Ln;)ki=Co(ki),un--;for(;0<Ln-un;)Sn=Co(Sn),Ln--;for(;un--;){if(ki===Sn||Sn!==null&&ki===Sn.alternate)break t;ki=Co(ki),Sn=Co(Sn)}ki=null}else ki=null;fi!==null&&uu(Tr,hr,fi,ki,!1),Ii!==null&&du!==null&&uu(Tr,du,Ii,ki,!0)}}e:{if(hr=Nn?Xu(Nn):window,fi=hr.nodeName&&hr.nodeName.toLowerCase(),fi==="select"||fi==="input"&&hr.type==="file")var Li=Ra;else if(yo(hr))if(sa)Li=f;else{Li=oa;var ns=jo}else(fi=hr.nodeName)&&fi.toLowerCase()==="input"&&(hr.type==="checkbox"||hr.type==="radio")&&(Li=E);if(Li&&(Li=Li(p,Nn))){ia(Tr,Li,C,br);break e}ns&&ns(p,hr,Nn),p==="focusout"&&(ns=hr._wrapperState)&&ns.controlled&&hr.type==="number"&&$t(hr,"number",hr.value)}switch(ns=Nn?Xu(Nn):window,p){case"focusin":(yo(ns)||ns.contentEditable==="true")&&(Kn=ns,Pr=Nn,Yr=null);break;case"focusout":Yr=Pr=Kn=null;break;case"mousedown":yi=!0;break;case"contextmenu":case"mouseup":case"dragend":yi=!1,Ms(Tr,C,br);break;case"selectionchange":if(mn)break;case"keydown":case"keyup":Ms(Tr,C,br)}var rs;if(Js)e:{switch(p){case"compositionstart":var Ls="onCompositionStart";break e;case"compositionend":Ls="onCompositionEnd";break e;case"compositionupdate":Ls="onCompositionUpdate";break e}Ls=void 0}else yu?Rc(p,C)&&(Ls="onCompositionEnd"):p==="keydown"&&C.keyCode===229&&(Ls="onCompositionStart");Ls&&(Vi&&C.locale!=="ko"&&(yu||Ls!=="onCompositionStart"?Ls==="onCompositionEnd"&&yu&&(rs=Lo()):(qo=br,ji="value"in qo?qo.value:qo.textContent,yu=!0)),ns=pa(Nn,Ls),0<ns.length&&(Ls=new go(Ls,p,null,C,br),Tr.push({event:Ls,listeners:ns}),rs?Ls.data=rs:(rs=Ru(C),rs!==null&&(Ls.data=rs)))),(rs=oo?Wa(p,C):al(p,C))&&(Nn=pa(Nn,"onBeforeInput"),0<Nn.length&&(br=new go("onBeforeInput","beforeinput",null,C,br),Tr.push({event:br,listeners:Nn}),br.data=rs))}Dr(Tr,v)})}function jn(p,v,C){return{instance:p,listener:v,currentTarget:C}}function pa(p,v){for(var C=v+"Capture",V=[];p!==null;){var ne=p,xe=ne.stateNode;ne.tag===5&&xe!==null&&(ne=xe,xe=Pn(p,C),xe!=null&&V.unshift(jn(p,xe,ne)),xe=Pn(p,v),xe!=null&&V.push(jn(p,xe,ne))),p=p.return}return V}function Co(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function uu(p,v,C,V,ne){for(var xe=v._reactName,Je=[];C!==null&&C!==V;){var Ft=C,Kt=Ft.alternate,Nn=Ft.stateNode;if(Kt!==null&&Kt===V)break;Ft.tag===5&&Nn!==null&&(Ft=Nn,ne?(Kt=Pn(C,xe),Kt!=null&&Je.unshift(jn(C,Kt,Ft))):ne||(Kt=Pn(C,xe),Kt!=null&&Je.push(jn(C,Kt,Ft)))),C=C.return}Je.length!==0&&p.push({event:v,listeners:Je})}var hl=/\r\n?/g,Ji=/\u0000|\uFFFD/g;function Za(p){return(typeof p=="string"?p:""+p).replace(hl,`
`).replace(Ji,"")}function qh(p,v,C){if(v=Za(v),Za(p)!==v&&C)throw Error(t(425))}function Lh(){}var Si=null,Mc=null;function Gh(p,v){return p==="textarea"||p==="noscript"||typeof v.children=="string"||typeof v.children=="number"||typeof v.dangerouslySetInnerHTML=="object"&&v.dangerouslySetInnerHTML!==null&&v.dangerouslySetInnerHTML.__html!=null}var Da=typeof setTimeout=="function"?setTimeout:void 0,Ul=typeof clearTimeout=="function"?clearTimeout:void 0,$h=typeof Promise=="function"?Promise:void 0,lc=typeof queueMicrotask=="function"?queueMicrotask:typeof $h<"u"?function(p){return $h.resolve(null).then(p).catch(Hc)}:Da;function Hc(p){setTimeout(function(){throw p})}function Af(p,v){var C=v,V=0;do{var ne=C.nextSibling;if(p.removeChild(C),ne&&ne.nodeType===8)if(C=ne.data,C==="/$"){if(V===0){p.removeChild(ne),ra(v);return}V--}else C!=="$"&&C!=="$?"&&C!=="$!"||V++;C=ne}while(C);ra(v)}function Il(p){for(;p!=null;p=p.nextSibling){var v=p.nodeType;if(v===1||v===3)break;if(v===8){if(v=p.data,v==="$"||v==="$!"||v==="$?")break;if(v==="/$")return null}}return p}function as(p){p=p.previousSibling;for(var v=0;p;){if(p.nodeType===8){var C=p.data;if(C==="$"||C==="$!"||C==="$?"){if(v===0)return p;v--}else C==="/$"&&v++}p=p.previousSibling}return null}var Ja=Math.random().toString(36).slice(2),Cl="__reactFiber$"+Ja,wc="__reactProps$"+Ja,Cs="__reactContainer$"+Ja,cu="__reactEvents$"+Ja,Hh="__reactListeners$"+Ja,_d="__reactHandles$"+Ja;function Vl(p){var v=p[Cl];if(v)return v;for(var C=p.parentNode;C;){if(v=C[Cs]||C[Cl]){if(C=v.alternate,v.child!==null||C!==null&&C.child!==null)for(p=as(p);p!==null;){if(C=p[Cl])return C;p=as(p)}return v}p=C,C=p.parentNode}return null}function yl(p){return p=p[Cl]||p[Cs],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Xu(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(t(33))}function cf(p){return p[wc]||null}var Ph=[],kl=-1;function Du(p){return{current:p}}function So(p){0>kl||(p.current=Ph[kl],Ph[kl]=null,kl--)}function fs(p,v){kl++,Ph[kl]=p.current,p.current=v}var Ou={},ql=Du(Ou),vu=Du(!1),uh=Ou;function _l(p,v){var C=p.type.contextTypes;if(!C)return Ou;var V=p.stateNode;if(V&&V.__reactInternalMemoizedUnmaskedChildContext===v)return V.__reactInternalMemoizedMaskedChildContext;var ne={},xe;for(xe in C)ne[xe]=v[xe];return V&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=v,p.__reactInternalMemoizedMaskedChildContext=ne),ne}function vl(p){return p=p.childContextTypes,p!=null}function hf(){So(vu),So(ql)}function Fu(p,v,C){if(ql.current!==Ou)throw Error(t(168));fs(ql,v),fs(vu,C)}function xu(p,v,C){var V=p.stateNode;if(v=v.childContextTypes,typeof V.getChildContext!="function")return C;V=V.getChildContext();for(var ne in V)if(!(ne in v))throw Error(t(108,It(p)||"Unknown",ne));return Ke({},C,V)}function hu(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||Ou,uh=ql.current,fs(ql,p),fs(vu,vu.current),!0}function ch(p,v,C){var V=p.stateNode;if(!V)throw Error(t(169));C?(p=xu(p,v,uh),V.__reactInternalMemoizedMergedChildContext=p,So(vu),So(ql),fs(ql,p)):So(vu),fs(vu,C)}var Cr=null,hh=!1,D=!1;function H(p){Cr===null?Cr=[p]:Cr.push(p)}function ue(p){hh=!0,H(p)}function pe(){if(!D&&Cr!==null){D=!0;var p=0,v=Wi;try{var C=Cr;for(Wi=1;p<C.length;p++){var V=C[p];do V=V(!0);while(V!==null)}Cr=null,hh=!1}catch(ne){throw Cr!==null&&(Cr=Cr.slice(p+1)),Pa(ga,pe),ne}finally{Wi=v,D=!1}}return null}var Ge=[],tt=0,it=null,ht=0,dt=[],St=0,Yt=null,pn=1,Et="";function Qt(p,v){Ge[tt++]=ht,Ge[tt++]=it,it=p,ht=v}function gn(p,v,C){dt[St++]=pn,dt[St++]=Et,dt[St++]=Yt,Yt=p;var V=pn;p=Et;var ne=32-co(V)-1;V&=~(1<<ne),C+=1;var xe=32-co(v)+ne;if(30<xe){var Je=ne-ne%5;xe=(V&(1<<Je)-1).toString(32),V>>=Je,ne-=Je,pn=1<<32-co(v)+ne|C<<ne|V,Et=xe+p}else pn=1<<xe|C<<ne|V,Et=p}function Bn(p){p.return!==null&&(Qt(p,1),gn(p,1,0))}function x(p){for(;p===it;)it=Ge[--tt],Ge[tt]=null,ht=Ge[--tt],Ge[tt]=null;for(;p===Yt;)Yt=dt[--St],dt[St]=null,Et=dt[--St],dt[St]=null,pn=dt[--St],dt[St]=null}var l=null,m=null,b=!1,I=null;function P(p,v){var C=cc(5,null,null,0);C.elementType="DELETED",C.stateNode=v,C.return=p,v=p.deletions,v===null?(p.deletions=[C],p.flags|=16):v.push(C)}function j(p,v){switch(p.tag){case 5:var C=p.type;return v=v.nodeType!==1||C.toLowerCase()!==v.nodeName.toLowerCase()?null:v,v!==null?(p.stateNode=v,l=p,m=Il(v.firstChild),!0):!1;case 6:return v=p.pendingProps===""||v.nodeType!==3?null:v,v!==null?(p.stateNode=v,l=p,m=null,!0):!1;case 13:return v=v.nodeType!==8?null:v,v!==null?(C=Yt!==null?{id:pn,overflow:Et}:null,p.memoizedState={dehydrated:v,treeContext:C,retryLane:1073741824},C=cc(18,null,null,0),C.stateNode=v,C.return=p,p.child=C,l=p,m=null,!0):!1;default:return!1}}function W(p){return(p.mode&1)!==0&&(p.flags&128)===0}function Z(p){if(b){var v=m;if(v){var C=v;if(!j(p,v)){if(W(p))throw Error(t(418));v=Il(C.nextSibling);var V=l;v&&j(p,v)?P(V,C):(p.flags=p.flags&-4097|2,b=!1,l=p)}}else{if(W(p))throw Error(t(418));p.flags=p.flags&-4097|2,b=!1,l=p}}}function le(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;l=p}function ce(p){if(p!==l)return!1;if(!b)return le(p),b=!0,!1;var v;if((v=p.tag!==3)&&!(v=p.tag!==5)&&(v=p.type,v=v!=="head"&&v!=="body"&&!Gh(p.type,p.memoizedProps)),v&&(v=m)){if(W(p))throw Ee(),Error(t(418));for(;v;)P(p,v),v=Il(v.nextSibling)}if(le(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(t(317));e:{for(p=p.nextSibling,v=0;p;){if(p.nodeType===8){var C=p.data;if(C==="/$"){if(v===0){m=Il(p.nextSibling);break e}v--}else C!=="$"&&C!=="$!"&&C!=="$?"||v++}p=p.nextSibling}m=null}}else m=l?Il(p.stateNode.nextSibling):null;return!0}function Ee(){for(var p=m;p;)p=Il(p.nextSibling)}function Fe(){m=l=null,b=!1}function qe(p){I===null?I=[p]:I.push(p)}var at=de.ReactCurrentBatchConfig;function et(p,v,C){if(p=C.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(C._owner){if(C=C._owner,C){if(C.tag!==1)throw Error(t(309));var V=C.stateNode}if(!V)throw Error(t(147,p));var ne=V,xe=""+p;return v!==null&&v.ref!==null&&typeof v.ref=="function"&&v.ref._stringRef===xe?v.ref:(v=function(Je){var Ft=ne.refs;Je===null?delete Ft[xe]:Ft[xe]=Je},v._stringRef=xe,v)}if(typeof p!="string")throw Error(t(284));if(!C._owner)throw Error(t(290,p))}return p}function lt(p,v){throw p=Object.prototype.toString.call(v),Error(t(31,p==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":p))}function Ie(p){var v=p._init;return v(p._payload)}function rt(p){function v(Sn,un){if(p){var Ln=Sn.deletions;Ln===null?(Sn.deletions=[un],Sn.flags|=16):Ln.push(un)}}function C(Sn,un){if(!p)return null;for(;un!==null;)v(Sn,un),un=un.sibling;return null}function V(Sn,un){for(Sn=new Map;un!==null;)un.key!==null?Sn.set(un.key,un):Sn.set(un.index,un),un=un.sibling;return Sn}function ne(Sn,un){return Sn=Sd(Sn,un),Sn.index=0,Sn.sibling=null,Sn}function xe(Sn,un,Ln){return Sn.index=Ln,p?(Ln=Sn.alternate,Ln!==null?(Ln=Ln.index,Ln<un?(Sn.flags|=2,un):Ln):(Sn.flags|=2,un)):(Sn.flags|=1048576,un)}function Je(Sn){return p&&Sn.alternate===null&&(Sn.flags|=2),Sn}function Ft(Sn,un,Ln,Or){return un===null||un.tag!==6?(un=h0(Ln,Sn.mode,Or),un.return=Sn,un):(un=ne(un,Ln),un.return=Sn,un)}function Kt(Sn,un,Ln,Or){var Li=Ln.type;return Li===_e?br(Sn,un,Ln.props.children,Or,Ln.key):un!==null&&(un.elementType===Li||typeof Li=="object"&&Li!==null&&Li.$$typeof===$e&&Ie(Li)===un.type)?(Or=ne(un,Ln.props),Or.ref=et(Sn,un,Ln),Or.return=Sn,Or):(Or=Fg(Ln.type,Ln.key,Ln.props,null,Sn.mode,Or),Or.ref=et(Sn,un,Ln),Or.return=Sn,Or)}function Nn(Sn,un,Ln,Or){return un===null||un.tag!==4||un.stateNode.containerInfo!==Ln.containerInfo||un.stateNode.implementation!==Ln.implementation?(un=f0(Ln,Sn.mode,Or),un.return=Sn,un):(un=ne(un,Ln.children||[]),un.return=Sn,un)}function br(Sn,un,Ln,Or,Li){return un===null||un.tag!==7?(un=dp(Ln,Sn.mode,Or,Li),un.return=Sn,un):(un=ne(un,Ln),un.return=Sn,un)}function Tr(Sn,un,Ln){if(typeof un=="string"&&un!==""||typeof un=="number")return un=h0(""+un,Sn.mode,Ln),un.return=Sn,un;if(typeof un=="object"&&un!==null){switch(un.$$typeof){case Pe:return Ln=Fg(un.type,un.key,un.props,null,Sn.mode,Ln),Ln.ref=et(Sn,null,un),Ln.return=Sn,Ln;case Be:return un=f0(un,Sn.mode,Ln),un.return=Sn,un;case $e:var Or=un._init;return Tr(Sn,Or(un._payload),Ln)}if(xr(un)||He(un))return un=dp(un,Sn.mode,Ln,null),un.return=Sn,un;lt(Sn,un)}return null}function hr(Sn,un,Ln,Or){var Li=un!==null?un.key:null;if(typeof Ln=="string"&&Ln!==""||typeof Ln=="number")return Li!==null?null:Ft(Sn,un,""+Ln,Or);if(typeof Ln=="object"&&Ln!==null){switch(Ln.$$typeof){case Pe:return Ln.key===Li?Kt(Sn,un,Ln,Or):null;case Be:return Ln.key===Li?Nn(Sn,un,Ln,Or):null;case $e:return Li=Ln._init,hr(Sn,un,Li(Ln._payload),Or)}if(xr(Ln)||He(Ln))return Li!==null?null:br(Sn,un,Ln,Or,null);lt(Sn,Ln)}return null}function fi(Sn,un,Ln,Or,Li){if(typeof Or=="string"&&Or!==""||typeof Or=="number")return Sn=Sn.get(Ln)||null,Ft(un,Sn,""+Or,Li);if(typeof Or=="object"&&Or!==null){switch(Or.$$typeof){case Pe:return Sn=Sn.get(Or.key===null?Ln:Or.key)||null,Kt(un,Sn,Or,Li);case Be:return Sn=Sn.get(Or.key===null?Ln:Or.key)||null,Nn(un,Sn,Or,Li);case $e:var ns=Or._init;return fi(Sn,un,Ln,ns(Or._payload),Li)}if(xr(Or)||He(Or))return Sn=Sn.get(Ln)||null,br(un,Sn,Or,Li,null);lt(un,Or)}return null}function Ii(Sn,un,Ln,Or){for(var Li=null,ns=null,rs=un,Ls=un=0,hc=null;rs!==null&&Ls<Ln.length;Ls++){rs.index>Ls?(hc=rs,rs=null):hc=rs.sibling;var Oo=hr(Sn,rs,Ln[Ls],Or);if(Oo===null){rs===null&&(rs=hc);break}p&&rs&&Oo.alternate===null&&v(Sn,rs),un=xe(Oo,un,Ls),ns===null?Li=Oo:ns.sibling=Oo,ns=Oo,rs=hc}if(Ls===Ln.length)return C(Sn,rs),b&&Qt(Sn,Ls),Li;if(rs===null){for(;Ls<Ln.length;Ls++)rs=Tr(Sn,Ln[Ls],Or),rs!==null&&(un=xe(rs,un,Ls),ns===null?Li=rs:ns.sibling=rs,ns=rs);return b&&Qt(Sn,Ls),Li}for(rs=V(Sn,rs);Ls<Ln.length;Ls++)hc=fi(rs,Sn,Ls,Ln[Ls],Or),hc!==null&&(p&&hc.alternate!==null&&rs.delete(hc.key===null?Ls:hc.key),un=xe(hc,un,Ls),ns===null?Li=hc:ns.sibling=hc,ns=hc);return p&&rs.forEach(function(tf){return v(Sn,tf)}),b&&Qt(Sn,Ls),Li}function ki(Sn,un,Ln,Or){var Li=He(Ln);if(typeof Li!="function")throw Error(t(150));if(Ln=Li.call(Ln),Ln==null)throw Error(t(151));for(var ns=Li=null,rs=un,Ls=un=0,hc=null,Oo=Ln.next();rs!==null&&!Oo.done;Ls++,Oo=Ln.next()){rs.index>Ls?(hc=rs,rs=null):hc=rs.sibling;var tf=hr(Sn,rs,Oo.value,Or);if(tf===null){rs===null&&(rs=hc);break}p&&rs&&tf.alternate===null&&v(Sn,rs),un=xe(tf,un,Ls),ns===null?Li=tf:ns.sibling=tf,ns=tf,rs=hc}if(Oo.done)return C(Sn,rs),b&&Qt(Sn,Ls),Li;if(rs===null){for(;!Oo.done;Ls++,Oo=Ln.next())Oo=Tr(Sn,Oo.value,Or),Oo!==null&&(un=xe(Oo,un,Ls),ns===null?Li=Oo:ns.sibling=Oo,ns=Oo);return b&&Qt(Sn,Ls),Li}for(rs=V(Sn,rs);!Oo.done;Ls++,Oo=Ln.next())Oo=fi(rs,Sn,Ls,Oo.value,Or),Oo!==null&&(p&&Oo.alternate!==null&&rs.delete(Oo.key===null?Ls:Oo.key),un=xe(Oo,un,Ls),ns===null?Li=Oo:ns.sibling=Oo,ns=Oo);return p&&rs.forEach(function(o1){return v(Sn,o1)}),b&&Qt(Sn,Ls),Li}function du(Sn,un,Ln,Or){if(typeof Ln=="object"&&Ln!==null&&Ln.type===_e&&Ln.key===null&&(Ln=Ln.props.children),typeof Ln=="object"&&Ln!==null){switch(Ln.$$typeof){case Pe:e:{for(var Li=Ln.key,ns=un;ns!==null;){if(ns.key===Li){if(Li=Ln.type,Li===_e){if(ns.tag===7){C(Sn,ns.sibling),un=ne(ns,Ln.props.children),un.return=Sn,Sn=un;break e}}else if(ns.elementType===Li||typeof Li=="object"&&Li!==null&&Li.$$typeof===$e&&Ie(Li)===ns.type){C(Sn,ns.sibling),un=ne(ns,Ln.props),un.ref=et(Sn,ns,Ln),un.return=Sn,Sn=un;break e}C(Sn,ns);break}else v(Sn,ns);ns=ns.sibling}Ln.type===_e?(un=dp(Ln.props.children,Sn.mode,Or,Ln.key),un.return=Sn,Sn=un):(Or=Fg(Ln.type,Ln.key,Ln.props,null,Sn.mode,Or),Or.ref=et(Sn,un,Ln),Or.return=Sn,Sn=Or)}return Je(Sn);case Be:e:{for(ns=Ln.key;un!==null;){if(un.key===ns)if(un.tag===4&&un.stateNode.containerInfo===Ln.containerInfo&&un.stateNode.implementation===Ln.implementation){C(Sn,un.sibling),un=ne(un,Ln.children||[]),un.return=Sn,Sn=un;break e}else{C(Sn,un);break}else v(Sn,un);un=un.sibling}un=f0(Ln,Sn.mode,Or),un.return=Sn,Sn=un}return Je(Sn);case $e:return ns=Ln._init,du(Sn,un,ns(Ln._payload),Or)}if(xr(Ln))return Ii(Sn,un,Ln,Or);if(He(Ln))return ki(Sn,un,Ln,Or);lt(Sn,Ln)}return typeof Ln=="string"&&Ln!==""||typeof Ln=="number"?(Ln=""+Ln,un!==null&&un.tag===6?(C(Sn,un.sibling),un=ne(un,Ln),un.return=Sn,Sn=un):(C(Sn,un),un=h0(Ln,Sn.mode,Or),un.return=Sn,Sn=un),Je(Sn)):C(Sn,un)}return du}var gt=rt(!0),yt=rt(!1),Mt=Du(null),Dt=null,Nt=null,qt=null;function Bt(){qt=Nt=Dt=null}function rn(p){var v=Mt.current;So(Mt),p._currentValue=v}function Rn(p,v,C){for(;p!==null;){var V=p.alternate;if((p.childLanes&v)!==v?(p.childLanes|=v,V!==null&&(V.childLanes|=v)):V!==null&&(V.childLanes&v)!==v&&(V.childLanes|=v),p===C)break;p=p.return}}function Jt(p,v){Dt=p,qt=Nt=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&v)!==0&&(be=!0),p.firstContext=null)}function An(p){var v=p._currentValue;if(qt!==p)if(p={context:p,memoizedValue:v,next:null},Nt===null){if(Dt===null)throw Error(t(308));Nt=p,Dt.dependencies={lanes:0,firstContext:p}}else Nt=Nt.next=p;return v}var cn=null;function Vn(p){cn===null?cn=[p]:cn.push(p)}function tn(p,v,C,V){var ne=v.interleaved;return ne===null?(C.next=C,Vn(v)):(C.next=ne.next,ne.next=C),v.interleaved=C,bn(p,V)}function bn(p,v){p.lanes|=v;var C=p.alternate;for(C!==null&&(C.lanes|=v),C=p,p=p.return;p!==null;)p.childLanes|=v,C=p.alternate,C!==null&&(C.childLanes|=v),C=p,p=p.return;return C.tag===3?C.stateNode:null}var Un=!1;function In(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Wn(p,v){p=p.updateQueue,v.updateQueue===p&&(v.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function Nr(p,v){return{eventTime:p,lane:v,tag:0,payload:null,callback:null,next:null}}function ei(p,v,C){var V=p.updateQueue;if(V===null)return null;if(V=V.shared,(hi&2)!==0){var ne=V.pending;return ne===null?v.next=v:(v.next=ne.next,ne.next=v),V.pending=v,bn(p,C)}return ne=V.interleaved,ne===null?(v.next=v,Vn(V)):(v.next=ne.next,ne.next=v),V.interleaved=v,bn(p,C)}function Er(p,v,C){if(v=v.updateQueue,v!==null&&(v=v.shared,(C&4194240)!==0)){var V=v.lanes;V&=p.pendingLanes,C|=V,v.lanes=C,Tl(p,C)}}function gr(p,v){var C=p.updateQueue,V=p.alternate;if(V!==null&&(V=V.updateQueue,C===V)){var ne=null,xe=null;if(C=C.firstBaseUpdate,C!==null){do{var Je={eventTime:C.eventTime,lane:C.lane,tag:C.tag,payload:C.payload,callback:C.callback,next:null};xe===null?ne=xe=Je:xe=xe.next=Je,C=C.next}while(C!==null);xe===null?ne=xe=v:xe=xe.next=v}else ne=xe=v;C={baseState:V.baseState,firstBaseUpdate:ne,lastBaseUpdate:xe,shared:V.shared,effects:V.effects},p.updateQueue=C;return}p=C.lastBaseUpdate,p===null?C.firstBaseUpdate=v:p.next=v,C.lastBaseUpdate=v}function Ai(p,v,C,V){var ne=p.updateQueue;Un=!1;var xe=ne.firstBaseUpdate,Je=ne.lastBaseUpdate,Ft=ne.shared.pending;if(Ft!==null){ne.shared.pending=null;var Kt=Ft,Nn=Kt.next;Kt.next=null,Je===null?xe=Nn:Je.next=Nn,Je=Kt;var br=p.alternate;br!==null&&(br=br.updateQueue,Ft=br.lastBaseUpdate,Ft!==Je&&(Ft===null?br.firstBaseUpdate=Nn:Ft.next=Nn,br.lastBaseUpdate=Kt))}if(xe!==null){var Tr=ne.baseState;Je=0,br=Nn=Kt=null,Ft=xe;do{var hr=Ft.lane,fi=Ft.eventTime;if((V&hr)===hr){br!==null&&(br=br.next={eventTime:fi,lane:0,tag:Ft.tag,payload:Ft.payload,callback:Ft.callback,next:null});e:{var Ii=p,ki=Ft;switch(hr=v,fi=C,ki.tag){case 1:if(Ii=ki.payload,typeof Ii=="function"){Tr=Ii.call(fi,Tr,hr);break e}Tr=Ii;break e;case 3:Ii.flags=Ii.flags&-65537|128;case 0:if(Ii=ki.payload,hr=typeof Ii=="function"?Ii.call(fi,Tr,hr):Ii,hr==null)break e;Tr=Ke({},Tr,hr);break e;case 2:Un=!0}}Ft.callback!==null&&Ft.lane!==0&&(p.flags|=64,hr=ne.effects,hr===null?ne.effects=[Ft]:hr.push(Ft))}else fi={eventTime:fi,lane:hr,tag:Ft.tag,payload:Ft.payload,callback:Ft.callback,next:null},br===null?(Nn=br=fi,Kt=Tr):br=br.next=fi,Je|=hr;if(Ft=Ft.next,Ft===null){if(Ft=ne.shared.pending,Ft===null)break;hr=Ft,Ft=hr.next,hr.next=null,ne.lastBaseUpdate=hr,ne.shared.pending=null}}while(!0);if(br===null&&(Kt=Tr),ne.baseState=Kt,ne.firstBaseUpdate=Nn,ne.lastBaseUpdate=br,v=ne.shared.interleaved,v!==null){ne=v;do Je|=ne.lane,ne=ne.next;while(ne!==v)}else xe===null&&(ne.shared.lanes=0);Sl|=Je,p.lanes=Je,p.memoizedState=Tr}}function Mi(p,v,C){if(p=v.effects,v.effects=null,p!==null)for(v=0;v<p.length;v++){var V=p[v],ne=V.callback;if(ne!==null){if(V.callback=null,V=C,typeof ne!="function")throw Error(t(191,ne));ne.call(V)}}}var Vr={},Yi=Du(Vr),Ki=Du(Vr),ts=Du(Vr);function Gs(p){if(p===Vr)throw Error(t(174));return p}function wa(p,v){switch(fs(ts,v),fs(Ki,p),fs(Yi,Vr),p=v.nodeType,p){case 9:case 11:v=(v=v.documentElement)?v.namespaceURI:$r(null,"");break;default:p=p===8?v.parentNode:v,v=p.namespaceURI||null,p=p.tagName,v=$r(v,p)}So(Yi),fs(Yi,v)}function $o(){So(Yi),So(Ki),So(ts)}function Bu(p){Gs(ts.current);var v=Gs(Yi.current),C=$r(v,p.type);v!==C&&(fs(Ki,p),fs(Yi,C))}function Yu(p){Ki.current===p&&(So(Yi),So(Ki))}var Zi=Du(0);function ks(p){for(var v=p;v!==null;){if(v.tag===13){var C=v.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||C.data==="$?"||C.data==="$!"))return v}else if(v.tag===19&&v.memoizedProps.revealOrder!==void 0){if((v.flags&128)!==0)return v}else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===p)break;for(;v.sibling===null;){if(v.return===null||v.return===p)return null;v=v.return}v.sibling.return=v.return,v=v.sibling}return null}var $s=[];function Sa(){for(var p=0;p<$s.length;p++)$s[p]._workInProgressVersionPrimary=null;$s.length=0}var Gl=de.ReactCurrentDispatcher,Eo=de.ReactCurrentBatchConfig,Ea=0,Yo=null,Ro=null,aa=null,zu=!1,Ta=!1,Ku=0,If=0;function Oa(){throw Error(t(321))}function Wh(p,v){if(v===null)return!1;for(var C=0;C<v.length&&C<p.length;C++)if(!S(p[C],v[C]))return!1;return!0}function Cf(p,v,C,V,ne,xe){if(Ea=xe,Yo=v,v.memoizedState=null,v.updateQueue=null,v.lanes=0,Gl.current=p===null||p.memoizedState===null?Im:Lg,p=C(V,ne),Ta){xe=0;do{if(Ta=!1,Ku=0,25<=xe)throw Error(t(301));xe+=1,aa=Ro=null,v.updateQueue=null,Gl.current=ph,p=C(V,ne)}while(Ta)}if(Gl.current=Ju,v=Ro!==null&&Ro.next!==null,Ea=0,aa=Ro=Yo=null,zu=!1,v)throw Error(t(300));return p}function Wc(){var p=Ku!==0;return Ku=0,p}function Xc(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return aa===null?Yo.memoizedState=aa=p:aa=aa.next=p,aa}function Zu(){if(Ro===null){var p=Yo.alternate;p=p!==null?p.memoizedState:null}else p=Ro.next;var v=aa===null?Yo.memoizedState:aa.next;if(v!==null)aa=v,Ro=p;else{if(p===null)throw Error(t(310));Ro=p,p={memoizedState:Ro.memoizedState,baseState:Ro.baseState,baseQueue:Ro.baseQueue,queue:Ro.queue,next:null},aa===null?Yo.memoizedState=aa=p:aa=aa.next=p}return aa}function fh(p,v){return typeof v=="function"?v(p):v}function Hf(p){var v=Zu(),C=v.queue;if(C===null)throw Error(t(311));C.lastRenderedReducer=p;var V=Ro,ne=V.baseQueue,xe=C.pending;if(xe!==null){if(ne!==null){var Je=ne.next;ne.next=xe.next,xe.next=Je}V.baseQueue=ne=xe,C.pending=null}if(ne!==null){xe=ne.next,V=V.baseState;var Ft=Je=null,Kt=null,Nn=xe;do{var br=Nn.lane;if((Ea&br)===br)Kt!==null&&(Kt=Kt.next={lane:0,action:Nn.action,hasEagerState:Nn.hasEagerState,eagerState:Nn.eagerState,next:null}),V=Nn.hasEagerState?Nn.eagerState:p(V,Nn.action);else{var Tr={lane:br,action:Nn.action,hasEagerState:Nn.hasEagerState,eagerState:Nn.eagerState,next:null};Kt===null?(Ft=Kt=Tr,Je=V):Kt=Kt.next=Tr,Yo.lanes|=br,Sl|=br}Nn=Nn.next}while(Nn!==null&&Nn!==xe);Kt===null?Je=V:Kt.next=Ft,S(V,v.memoizedState)||(be=!0),v.memoizedState=V,v.baseState=Je,v.baseQueue=Kt,C.lastRenderedState=V}if(p=C.interleaved,p!==null){ne=p;do xe=ne.lane,Yo.lanes|=xe,Sl|=xe,ne=ne.next;while(ne!==p)}else ne===null&&(C.lanes=0);return[v.memoizedState,C.dispatch]}function Yc(p){var v=Zu(),C=v.queue;if(C===null)throw Error(t(311));C.lastRenderedReducer=p;var V=C.dispatch,ne=C.pending,xe=v.memoizedState;if(ne!==null){C.pending=null;var Je=ne=ne.next;do xe=p(xe,Je.action),Je=Je.next;while(Je!==ne);S(xe,v.memoizedState)||(be=!0),v.memoizedState=xe,v.baseQueue===null&&(v.baseState=xe),C.lastRenderedState=xe}return[xe,V]}function kf(){}function Kc(p,v){var C=Yo,V=Zu(),ne=v(),xe=!S(V.memoizedState,ne);if(xe&&(V.memoizedState=ne,be=!0),V=V.queue,Zc(Wf.bind(null,C,V,p),[p]),V.getSnapshot!==v||xe||aa!==null&&aa.memoizedState.tag&1){if(C.flags|=2048,eu(9,dh.bind(null,C,V,ne,v),void 0,null),Pl===null)throw Error(t(349));(Ea&30)!==0||Nh(C,v,ne)}return ne}function Nh(p,v,C){p.flags|=16384,p={getSnapshot:v,value:C},v=Yo.updateQueue,v===null?(v={lastEffect:null,stores:null},Yo.updateQueue=v,v.stores=[p]):(C=v.stores,C===null?v.stores=[p]:C.push(p))}function dh(p,v,C,V){v.value=C,v.getSnapshot=V,Xh(v)&&Yh(p)}function Wf(p,v,C){return C(function(){Xh(v)&&Yh(p)})}function Xh(p){var v=p.getSnapshot;p=p.value;try{var C=v();return!S(p,C)}catch{return!0}}function Yh(p){var v=bn(p,1);v!==null&&gf(v,p,1,-1)}function Xf(p){var v=Xc();return typeof p=="function"&&(p=p()),v.memoizedState=v.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:fh,lastRenderedState:p},v.queue=p,p=p.dispatch=xl.bind(null,Yo,p),[v.memoizedState,p]}function eu(p,v,C,V){return p={tag:p,create:v,destroy:C,deps:V,next:null},v=Yo.updateQueue,v===null?(v={lastEffect:null,stores:null},Yo.updateQueue=v,v.lastEffect=p.next=p):(C=v.lastEffect,C===null?v.lastEffect=p.next=p:(V=C.next,C.next=p,p.next=V,v.lastEffect=p)),p}function Sc(){return Zu().memoizedState}function tu(p,v,C,V){var ne=Xc();Yo.flags|=p,ne.memoizedState=eu(1|v,C,void 0,V===void 0?null:V)}function $l(p,v,C,V){var ne=Zu();V=V===void 0?null:V;var xe=void 0;if(Ro!==null){var Je=Ro.memoizedState;if(xe=Je.destroy,V!==null&&Wh(V,Je.deps)){ne.memoizedState=eu(v,C,xe,V);return}}Yo.flags|=p,ne.memoizedState=eu(1|v,C,xe,V)}function uc(p,v){return tu(8390656,8,p,v)}function Zc(p,v){return $l(2048,8,p,v)}function Rh(p,v){return $l(4,2,p,v)}function Jc(p,v){return $l(4,4,p,v)}function Yf(p,v){if(typeof v=="function")return p=p(),v(p),function(){v(null)};if(v!=null)return p=p(),v.current=p,function(){v.current=null}}function Cg(p,v,C){return C=C!=null?C.concat([p]):null,$l(4,4,Yf.bind(null,v,p),C)}function Sm(){}function Em(p,v){var C=Zu();v=v===void 0?null:v;var V=C.memoizedState;return V!==null&&v!==null&&Wh(v,V[1])?V[0]:(C.memoizedState=[p,v],p)}function Tm(p,v){var C=Zu();v=v===void 0?null:v;var V=C.memoizedState;return V!==null&&v!==null&&Wh(v,V[1])?V[0]:(p=p(),C.memoizedState=[p,v],p)}function Am(p,v,C){return(Ea&21)===0?(p.baseState&&(p.baseState=!1,be=!0),p.memoizedState=C):(S(C,v)||(C=ca(),Yo.lanes|=C,Sl|=C,p.baseState=!0),v)}function Mh(p,v){var C=Wi;Wi=C!==0&&4>C?C:4,p(!0);var V=Eo.transition;Eo.transition={};try{p(!1),v()}finally{Wi=C,Eo.transition=V}}function kg(){return Zu().memoizedState}function np(p,v,C){var V=Mf(p);if(C={lane:V,action:C,hasEagerState:!1,eagerState:null,next:null},pi(p))Kh(v,C);else if(C=tn(p,v,C,V),C!==null){var ne=th();gf(C,p,V,ne),rp(C,v,V)}}function xl(p,v,C){var V=Mf(p),ne={lane:V,action:C,hasEagerState:!1,eagerState:null,next:null};if(pi(p))Kh(v,ne);else{var xe=p.alternate;if(p.lanes===0&&(xe===null||xe.lanes===0)&&(xe=v.lastRenderedReducer,xe!==null))try{var Je=v.lastRenderedState,Ft=xe(Je,C);if(ne.hasEagerState=!0,ne.eagerState=Ft,S(Ft,Je)){var Kt=v.interleaved;Kt===null?(ne.next=ne,Vn(v)):(ne.next=Kt.next,Kt.next=ne),v.interleaved=ne;return}}catch{}finally{}C=tn(p,v,ne,V),C!==null&&(ne=th(),gf(C,p,V,ne),rp(C,v,V))}}function pi(p){var v=p.alternate;return p===Yo||v!==null&&v===Yo}function Kh(p,v){Ta=zu=!0;var C=p.pending;C===null?v.next=v:(v.next=C.next,C.next=v),p.pending=v}function rp(p,v,C){if((C&4194240)!==0){var V=v.lanes;V&=p.pendingLanes,C|=V,v.lanes=C,Tl(p,C)}}var Ju={readContext:An,useCallback:Oa,useContext:Oa,useEffect:Oa,useImperativeHandle:Oa,useInsertionEffect:Oa,useLayoutEffect:Oa,useMemo:Oa,useReducer:Oa,useRef:Oa,useState:Oa,useDebugValue:Oa,useDeferredValue:Oa,useTransition:Oa,useMutableSource:Oa,useSyncExternalStore:Oa,useId:Oa,unstable_isNewReconciler:!1},Im={readContext:An,useCallback:function(p,v){return Xc().memoizedState=[p,v===void 0?null:v],p},useContext:An,useEffect:uc,useImperativeHandle:function(p,v,C){return C=C!=null?C.concat([p]):null,tu(4194308,4,Yf.bind(null,v,p),C)},useLayoutEffect:function(p,v){return tu(4194308,4,p,v)},useInsertionEffect:function(p,v){return tu(4,2,p,v)},useMemo:function(p,v){var C=Xc();return v=v===void 0?null:v,p=p(),C.memoizedState=[p,v],p},useReducer:function(p,v,C){var V=Xc();return v=C!==void 0?C(v):v,V.memoizedState=V.baseState=v,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:v},V.queue=p,p=p.dispatch=np.bind(null,Yo,p),[V.memoizedState,p]},useRef:function(p){var v=Xc();return p={current:p},v.memoizedState=p},useState:Xf,useDebugValue:Sm,useDeferredValue:function(p){return Xc().memoizedState=p},useTransition:function(){var p=Xf(!1),v=p[0];return p=Mh.bind(null,p[1]),Xc().memoizedState=p,[v,p]},useMutableSource:function(){},useSyncExternalStore:function(p,v,C){var V=Yo,ne=Xc();if(b){if(C===void 0)throw Error(t(407));C=C()}else{if(C=v(),Pl===null)throw Error(t(349));(Ea&30)!==0||Nh(V,v,C)}ne.memoizedState=C;var xe={value:C,getSnapshot:v};return ne.queue=xe,uc(Wf.bind(null,V,xe,p),[p]),V.flags|=2048,eu(9,dh.bind(null,V,xe,C,v),void 0,null),C},useId:function(){var p=Xc(),v=Pl.identifierPrefix;if(b){var C=Et,V=pn;C=(V&~(1<<32-co(V)-1)).toString(32)+C,v=":"+v+"R"+C,C=Ku++,0<C&&(v+="H"+C.toString(32)),v+=":"}else C=If++,v=":"+v+"r"+C.toString(32)+":";return p.memoizedState=v},unstable_isNewReconciler:!1},Lg={readContext:An,useCallback:Em,useContext:An,useEffect:Zc,useImperativeHandle:Cg,useInsertionEffect:Rh,useLayoutEffect:Jc,useMemo:Tm,useReducer:Hf,useRef:Sc,useState:function(){return Hf(fh)},useDebugValue:Sm,useDeferredValue:function(p){var v=Zu();return Am(v,Ro.memoizedState,p)},useTransition:function(){var p=Hf(fh)[0],v=Zu().memoizedState;return[p,v]},useMutableSource:kf,useSyncExternalStore:Kc,useId:kg,unstable_isNewReconciler:!1},ph={readContext:An,useCallback:Em,useContext:An,useEffect:Zc,useImperativeHandle:Cg,useInsertionEffect:Rh,useLayoutEffect:Jc,useMemo:Tm,useReducer:Yc,useRef:Sc,useState:function(){return Yc(fh)},useDebugValue:Sm,useDeferredValue:function(p){var v=Zu();return Ro===null?v.memoizedState=p:Am(v,Ro.memoizedState,p)},useTransition:function(){var p=Yc(fh)[0],v=Zu().memoizedState;return[p,v]},useMutableSource:kf,useSyncExternalStore:Kc,useId:kg,unstable_isNewReconciler:!1};function ju(p,v){if(p&&p.defaultProps){v=Ke({},v),p=p.defaultProps;for(var C in p)v[C]===void 0&&(v[C]=p[C]);return v}return v}function Dh(p,v,C,V){v=p.memoizedState,C=C(V,v),C=C==null?v:Ke({},v,C),p.memoizedState=C,p.lanes===0&&(p.updateQueue.baseState=C)}var Ec={isMounted:function(p){return(p=p._reactInternals)?ps(p)===p:!1},enqueueSetState:function(p,v,C){p=p._reactInternals;var V=th(),ne=Mf(p),xe=Nr(V,ne);xe.payload=v,C!=null&&(xe.callback=C),v=ei(p,xe,ne),v!==null&&(gf(v,p,ne,V),Er(v,p,ne))},enqueueReplaceState:function(p,v,C){p=p._reactInternals;var V=th(),ne=Mf(p),xe=Nr(V,ne);xe.tag=1,xe.payload=v,C!=null&&(xe.callback=C),v=ei(p,xe,ne),v!==null&&(gf(v,p,ne,V),Er(v,p,ne))},enqueueForceUpdate:function(p,v){p=p._reactInternals;var C=th(),V=Mf(p),ne=Nr(C,V);ne.tag=2,v!=null&&(ne.callback=v),v=ei(p,ne,V),v!==null&&(gf(v,p,V,C),Er(v,p,V))}};function Tc(p,v,C,V,ne,xe,Je){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(V,xe,Je):v.prototype&&v.prototype.isPureReactComponent?!N(C,V)||!N(ne,xe):!0}function vd(p,v,C){var V=!1,ne=Ou,xe=v.contextType;return typeof xe=="object"&&xe!==null?xe=An(xe):(ne=vl(v)?uh:ql.current,V=v.contextTypes,xe=(V=V!=null)?_l(p,ne):Ou),v=new v(C,xe),p.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=Ec,p.stateNode=v,v._reactInternals=p,V&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=ne,p.__reactInternalMemoizedMaskedChildContext=xe),v}function ip(p,v,C,V){p=v.state,typeof v.componentWillReceiveProps=="function"&&v.componentWillReceiveProps(C,V),typeof v.UNSAFE_componentWillReceiveProps=="function"&&v.UNSAFE_componentWillReceiveProps(C,V),v.state!==p&&Ec.enqueueReplaceState(v,v.state,null)}function Fp(p,v,C,V){var ne=p.stateNode;ne.props=C,ne.state=p.memoizedState,ne.refs={},In(p);var xe=v.contextType;typeof xe=="object"&&xe!==null?ne.context=An(xe):(xe=vl(v)?uh:ql.current,ne.context=_l(p,xe)),ne.state=p.memoizedState,xe=v.getDerivedStateFromProps,typeof xe=="function"&&(Dh(p,v,xe,C),ne.state=p.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof ne.getSnapshotBeforeUpdate=="function"||typeof ne.UNSAFE_componentWillMount!="function"&&typeof ne.componentWillMount!="function"||(v=ne.state,typeof ne.componentWillMount=="function"&&ne.componentWillMount(),typeof ne.UNSAFE_componentWillMount=="function"&&ne.UNSAFE_componentWillMount(),v!==ne.state&&Ec.enqueueReplaceState(ne,ne.state,null),Ai(p,C,ne,V),ne.state=p.memoizedState),typeof ne.componentDidMount=="function"&&(p.flags|=4194308)}function Lf(p,v){try{var C="",V=v;do C+=ut(V),V=V.return;while(V);var ne=C}catch(xe){ne=`
Error generating stack: `+xe.message+`
`+xe.stack}return{value:p,source:v,stack:ne,digest:null}}function Cm(p,v,C){return{value:p,source:null,stack:C??null,digest:v??null}}function sp(p,v){try{console.error(v.value)}catch(C){setTimeout(function(){throw C})}}var Pg=typeof WeakMap=="function"?WeakMap:Map;function Zh(p,v,C){C=Nr(-1,C),C.tag=3,C.payload={element:null};var V=v.value;return C.callback=function(){Lm||(Lm=!0,r0=V),sp(p,v)},C}function Pf(p,v,C){C=Nr(-1,C),C.tag=3;var V=p.type.getDerivedStateFromError;if(typeof V=="function"){var ne=v.value;C.payload=function(){return V(ne)},C.callback=function(){sp(p,v)}}var xe=p.stateNode;return xe!==null&&typeof xe.componentDidCatch=="function"&&(C.callback=function(){sp(p,v),typeof V!="function"&&(Fc===null?Fc=new Set([this]):Fc.add(this));var Je=v.stack;this.componentDidCatch(v.value,{componentStack:Je!==null?Je:""})}),C}function Oh(p,v,C){var V=p.pingCache;if(V===null){V=p.pingCache=new Pg;var ne=new Set;V.set(v,ne)}else ne=V.get(v),ne===void 0&&(ne=new Set,V.set(v,ne));ne.has(C)||(ne.add(C),p=c0.bind(null,p,v,C),v.then(p,p))}function Bp(p){do{var v;if((v=p.tag===13)&&(v=p.memoizedState,v=v!==null?v.dehydrated!==null:!0),v)return p;p=p.return}while(p!==null);return null}function km(p,v,C,V,ne){return(p.mode&1)===0?(p===v?p.flags|=65536:(p.flags|=128,C.flags|=131072,C.flags&=-52805,C.tag===1&&(C.alternate===null?C.tag=17:(v=Nr(-1,1),v.tag=2,ei(C,v,1))),C.lanes|=1),p):(p.flags|=65536,p.lanes=ne,p)}var q=de.ReactCurrentOwner,be=!1;function Me(p,v,C,V){v.child=p===null?yt(v,null,C,V):gt(v,p.child,C,V)}function Qe(p,v,C,V,ne){C=C.render;var xe=v.ref;return Jt(v,ne),V=Cf(p,v,C,V,xe,ne),C=Wc(),p!==null&&!be?(v.updateQueue=p.updateQueue,v.flags&=-2053,p.lanes&=~ne,Qi(p,v,ne)):(b&&C&&Bn(v),v.flags|=1,Me(p,v,V,ne),v.child)}function ct(p,v,C,V,ne){if(p===null){var xe=C.type;return typeof xe=="function"&&!fp(xe)&&xe.defaultProps===void 0&&C.compare===null&&C.defaultProps===void 0?(v.tag=15,v.type=xe,Xe(p,v,xe,V,ne)):(p=Fg(C.type,null,V,v,v.mode,ne),p.ref=v.ref,p.return=v,v.child=p)}if(xe=p.child,(p.lanes&ne)===0){var Je=xe.memoizedProps;if(C=C.compare,C=C!==null?C:N,C(Je,V)&&p.ref===v.ref)return Qi(p,v,ne)}return v.flags|=1,p=Sd(xe,V),p.ref=v.ref,p.return=v,v.child=p}function Xe(p,v,C,V,ne){if(p!==null){var xe=p.memoizedProps;if(N(xe,V)&&p.ref===v.ref)if(be=!1,v.pendingProps=V=xe,(p.lanes&ne)!==0)(p.flags&131072)!==0&&(be=!0);else return v.lanes=p.lanes,Qi(p,v,ne)}return Ht(p,v,C,V,ne)}function ot(p,v,C){var V=v.pendingProps,ne=V.children,xe=p!==null?p.memoizedState:null;if(V.mode==="hidden")if((v.mode&1)===0)v.memoizedState={baseLanes:0,cachePool:null,transitions:null},fs(Hl,Nl),Nl|=C;else{if((C&1073741824)===0)return p=xe!==null?xe.baseLanes|C:C,v.lanes=v.childLanes=1073741824,v.memoizedState={baseLanes:p,cachePool:null,transitions:null},v.updateQueue=null,fs(Hl,Nl),Nl|=p,null;v.memoizedState={baseLanes:0,cachePool:null,transitions:null},V=xe!==null?xe.baseLanes:C,fs(Hl,Nl),Nl|=V}else xe!==null?(V=xe.baseLanes|C,v.memoizedState=null):V=C,fs(Hl,Nl),Nl|=V;return Me(p,v,ne,C),v.child}function Lt(p,v){var C=v.ref;(p===null&&C!==null||p!==null&&p.ref!==C)&&(v.flags|=512,v.flags|=2097152)}function Ht(p,v,C,V,ne){var xe=vl(C)?uh:ql.current;return xe=_l(v,xe),Jt(v,ne),C=Cf(p,v,C,V,xe,ne),V=Wc(),p!==null&&!be?(v.updateQueue=p.updateQueue,v.flags&=-2053,p.lanes&=~ne,Qi(p,v,ne)):(b&&V&&Bn(v),v.flags|=1,Me(p,v,C,ne),v.child)}function Ct(p,v,C,V,ne){if(vl(C)){var xe=!0;hu(v)}else xe=!1;if(Jt(v,ne),v.stateNode===null)ci(p,v),vd(v,C,V),Fp(v,C,V,ne),V=!0;else if(p===null){var Je=v.stateNode,Ft=v.memoizedProps;Je.props=Ft;var Kt=Je.context,Nn=C.contextType;typeof Nn=="object"&&Nn!==null?Nn=An(Nn):(Nn=vl(C)?uh:ql.current,Nn=_l(v,Nn));var br=C.getDerivedStateFromProps,Tr=typeof br=="function"||typeof Je.getSnapshotBeforeUpdate=="function";Tr||typeof Je.UNSAFE_componentWillReceiveProps!="function"&&typeof Je.componentWillReceiveProps!="function"||(Ft!==V||Kt!==Nn)&&ip(v,Je,V,Nn),Un=!1;var hr=v.memoizedState;Je.state=hr,Ai(v,V,Je,ne),Kt=v.memoizedState,Ft!==V||hr!==Kt||vu.current||Un?(typeof br=="function"&&(Dh(v,C,br,V),Kt=v.memoizedState),(Ft=Un||Tc(v,C,Ft,V,hr,Kt,Nn))?(Tr||typeof Je.UNSAFE_componentWillMount!="function"&&typeof Je.componentWillMount!="function"||(typeof Je.componentWillMount=="function"&&Je.componentWillMount(),typeof Je.UNSAFE_componentWillMount=="function"&&Je.UNSAFE_componentWillMount()),typeof Je.componentDidMount=="function"&&(v.flags|=4194308)):(typeof Je.componentDidMount=="function"&&(v.flags|=4194308),v.memoizedProps=V,v.memoizedState=Kt),Je.props=V,Je.state=Kt,Je.context=Nn,V=Ft):(typeof Je.componentDidMount=="function"&&(v.flags|=4194308),V=!1)}else{Je=v.stateNode,Wn(p,v),Ft=v.memoizedProps,Nn=v.type===v.elementType?Ft:ju(v.type,Ft),Je.props=Nn,Tr=v.pendingProps,hr=Je.context,Kt=C.contextType,typeof Kt=="object"&&Kt!==null?Kt=An(Kt):(Kt=vl(C)?uh:ql.current,Kt=_l(v,Kt));var fi=C.getDerivedStateFromProps;(br=typeof fi=="function"||typeof Je.getSnapshotBeforeUpdate=="function")||typeof Je.UNSAFE_componentWillReceiveProps!="function"&&typeof Je.componentWillReceiveProps!="function"||(Ft!==Tr||hr!==Kt)&&ip(v,Je,V,Kt),Un=!1,hr=v.memoizedState,Je.state=hr,Ai(v,V,Je,ne);var Ii=v.memoizedState;Ft!==Tr||hr!==Ii||vu.current||Un?(typeof fi=="function"&&(Dh(v,C,fi,V),Ii=v.memoizedState),(Nn=Un||Tc(v,C,Nn,V,hr,Ii,Kt)||!1)?(br||typeof Je.UNSAFE_componentWillUpdate!="function"&&typeof Je.componentWillUpdate!="function"||(typeof Je.componentWillUpdate=="function"&&Je.componentWillUpdate(V,Ii,Kt),typeof Je.UNSAFE_componentWillUpdate=="function"&&Je.UNSAFE_componentWillUpdate(V,Ii,Kt)),typeof Je.componentDidUpdate=="function"&&(v.flags|=4),typeof Je.getSnapshotBeforeUpdate=="function"&&(v.flags|=1024)):(typeof Je.componentDidUpdate!="function"||Ft===p.memoizedProps&&hr===p.memoizedState||(v.flags|=4),typeof Je.getSnapshotBeforeUpdate!="function"||Ft===p.memoizedProps&&hr===p.memoizedState||(v.flags|=1024),v.memoizedProps=V,v.memoizedState=Ii),Je.props=V,Je.state=Ii,Je.context=Kt,V=Nn):(typeof Je.componentDidUpdate!="function"||Ft===p.memoizedProps&&hr===p.memoizedState||(v.flags|=4),typeof Je.getSnapshotBeforeUpdate!="function"||Ft===p.memoizedProps&&hr===p.memoizedState||(v.flags|=1024),V=!1)}return en(p,v,C,V,xe,ne)}function en(p,v,C,V,ne,xe){Lt(p,v);var Je=(v.flags&128)!==0;if(!V&&!Je)return ne&&ch(v,C,!1),Qi(p,v,xe);V=v.stateNode,q.current=v;var Ft=Je&&typeof C.getDerivedStateFromError!="function"?null:V.render();return v.flags|=1,p!==null&&Je?(v.child=gt(v,p.child,null,xe),v.child=gt(v,null,Ft,xe)):Me(p,v,Ft,xe),v.memoizedState=V.state,ne&&ch(v,C,!0),v.child}function xn(p){var v=p.stateNode;v.pendingContext?Fu(p,v.pendingContext,v.pendingContext!==v.context):v.context&&Fu(p,v.context,!1),wa(p,v.containerInfo)}function Gn(p,v,C,V,ne){return Fe(),qe(ne),v.flags|=256,Me(p,v,C,V),v.child}var dn={dehydrated:null,treeContext:null,retryLane:0};function ln(p){return{baseLanes:p,cachePool:null,transitions:null}}function Tn(p,v,C){var V=v.pendingProps,ne=Zi.current,xe=!1,Je=(v.flags&128)!==0,Ft;if((Ft=Je)||(Ft=p!==null&&p.memoizedState===null?!1:(ne&2)!==0),Ft?(xe=!0,v.flags&=-129):(p===null||p.memoizedState!==null)&&(ne|=1),fs(Zi,ne&1),p===null)return Z(v),p=v.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((v.mode&1)===0?v.lanes=1:p.data==="$!"?v.lanes=8:v.lanes=1073741824,null):(Je=V.children,p=V.fallback,xe?(V=v.mode,xe=v.child,Je={mode:"hidden",children:Je},(V&1)===0&&xe!==null?(xe.childLanes=0,xe.pendingProps=Je):xe=Bg(Je,V,0,null),p=dp(p,V,C,null),xe.return=v,p.return=v,xe.sibling=p,v.child=xe,v.child.memoizedState=ln(C),v.memoizedState=dn,p):kr(v,Je));if(ne=p.memoizedState,ne!==null&&(Ft=ne.dehydrated,Ft!==null))return cr(p,v,Je,V,Ft,ne,C);if(xe){xe=V.fallback,Je=v.mode,ne=p.child,Ft=ne.sibling;var Kt={mode:"hidden",children:V.children};return(Je&1)===0&&v.child!==ne?(V=v.child,V.childLanes=0,V.pendingProps=Kt,v.deletions=null):(V=Sd(ne,Kt),V.subtreeFlags=ne.subtreeFlags&14680064),Ft!==null?xe=Sd(Ft,xe):(xe=dp(xe,Je,C,null),xe.flags|=2),xe.return=v,V.return=v,V.sibling=xe,v.child=V,V=xe,xe=v.child,Je=p.child.memoizedState,Je=Je===null?ln(C):{baseLanes:Je.baseLanes|C,cachePool:null,transitions:Je.transitions},xe.memoizedState=Je,xe.childLanes=p.childLanes&~C,v.memoizedState=dn,V}return xe=p.child,p=xe.sibling,V=Sd(xe,{mode:"visible",children:V.children}),(v.mode&1)===0&&(V.lanes=C),V.return=v,V.sibling=null,p!==null&&(C=v.deletions,C===null?(v.deletions=[p],v.flags|=16):C.push(p)),v.child=V,v.memoizedState=null,V}function kr(p,v){return v=Bg({mode:"visible",children:v},p.mode,0,null),v.return=p,p.child=v}function ti(p,v,C,V){return V!==null&&qe(V),gt(v,p.child,null,C),p=kr(v,v.pendingProps.children),p.flags|=2,v.memoizedState=null,p}function cr(p,v,C,V,ne,xe,Je){if(C)return v.flags&256?(v.flags&=-257,V=Cm(Error(t(422))),ti(p,v,Je,V)):v.memoizedState!==null?(v.child=p.child,v.flags|=128,null):(xe=V.fallback,ne=v.mode,V=Bg({mode:"visible",children:V.children},ne,0,null),xe=dp(xe,ne,Je,null),xe.flags|=2,V.return=v,xe.return=v,V.sibling=xe,v.child=V,(v.mode&1)!==0&&gt(v,p.child,null,Je),v.child.memoizedState=ln(Je),v.memoizedState=dn,xe);if((v.mode&1)===0)return ti(p,v,Je,null);if(ne.data==="$!"){if(V=ne.nextSibling&&ne.nextSibling.dataset,V)var Ft=V.dgst;return V=Ft,xe=Error(t(419)),V=Cm(xe,V,void 0),ti(p,v,Je,V)}if(Ft=(Je&p.childLanes)!==0,be||Ft){if(V=Pl,V!==null){switch(Je&-Je){case 4:ne=2;break;case 16:ne=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:ne=32;break;case 536870912:ne=268435456;break;default:ne=0}ne=(ne&(V.suspendedLanes|Je))!==0?0:ne,ne!==0&&ne!==xe.retryLane&&(xe.retryLane=ne,bn(p,ne),gf(V,p,ne,-1))}return o0(),V=Cm(Error(t(421))),ti(p,v,Je,V)}return ne.data==="$?"?(v.flags|=128,v.child=p.child,v=ib.bind(null,p),ne._reactRetry=v,null):(p=xe.treeContext,m=Il(ne.nextSibling),l=v,b=!0,I=null,p!==null&&(dt[St++]=pn,dt[St++]=Et,dt[St++]=Yt,pn=p.id,Et=p.overflow,Yt=v),v=kr(v,V.children),v.flags|=4096,v)}function Lr(p,v,C){p.lanes|=v;var V=p.alternate;V!==null&&(V.lanes|=v),Rn(p.return,v,C)}function _i(p,v,C,V,ne){var xe=p.memoizedState;xe===null?p.memoizedState={isBackwards:v,rendering:null,renderingStartTime:0,last:V,tail:C,tailMode:ne}:(xe.isBackwards=v,xe.rendering=null,xe.renderingStartTime=0,xe.last=V,xe.tail=C,xe.tailMode=ne)}function xi(p,v,C){var V=v.pendingProps,ne=V.revealOrder,xe=V.tail;if(Me(p,v,V.children,C),V=Zi.current,(V&2)!==0)V=V&1|2,v.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=v.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&Lr(p,C,v);else if(p.tag===19)Lr(p,C,v);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===v)break e;for(;p.sibling===null;){if(p.return===null||p.return===v)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}V&=1}if(fs(Zi,V),(v.mode&1)===0)v.memoizedState=null;else switch(ne){case"forwards":for(C=v.child,ne=null;C!==null;)p=C.alternate,p!==null&&ks(p)===null&&(ne=C),C=C.sibling;C=ne,C===null?(ne=v.child,v.child=null):(ne=C.sibling,C.sibling=null),_i(v,!1,ne,C,xe);break;case"backwards":for(C=null,ne=v.child,v.child=null;ne!==null;){if(p=ne.alternate,p!==null&&ks(p)===null){v.child=ne;break}p=ne.sibling,ne.sibling=C,C=ne,ne=p}_i(v,!0,C,null,xe);break;case"together":_i(v,!1,null,null,void 0);break;default:v.memoizedState=null}return v.child}function ci(p,v){(v.mode&1)===0&&p!==null&&(p.alternate=null,v.alternate=null,v.flags|=2)}function Qi(p,v,C){if(p!==null&&(v.dependencies=p.dependencies),Sl|=v.lanes,(C&v.childLanes)===0)return null;if(p!==null&&v.child!==p.child)throw Error(t(153));if(v.child!==null){for(p=v.child,C=Sd(p,p.pendingProps),v.child=C,C.return=v;p.sibling!==null;)p=p.sibling,C=C.sibling=Sd(p,p.pendingProps),C.return=v;C.sibling=null}return v.child}function Jr(p,v,C){switch(v.tag){case 3:xn(v),Fe();break;case 5:Bu(v);break;case 1:vl(v.type)&&hu(v);break;case 4:wa(v,v.stateNode.containerInfo);break;case 10:var V=v.type._context,ne=v.memoizedProps.value;fs(Mt,V._currentValue),V._currentValue=ne;break;case 13:if(V=v.memoizedState,V!==null)return V.dehydrated!==null?(fs(Zi,Zi.current&1),v.flags|=128,null):(C&v.child.childLanes)!==0?Tn(p,v,C):(fs(Zi,Zi.current&1),p=Qi(p,v,C),p!==null?p.sibling:null);fs(Zi,Zi.current&1);break;case 19:if(V=(C&v.childLanes)!==0,(p.flags&128)!==0){if(V)return xi(p,v,C);v.flags|=128}if(ne=v.memoizedState,ne!==null&&(ne.rendering=null,ne.tail=null,ne.lastEffect=null),fs(Zi,Zi.current),V)break;return null;case 22:case 23:return v.lanes=0,ot(p,v,C)}return Qi(p,v,C)}var ai,ds,li,Hr;ai=function(p,v){for(var C=v.child;C!==null;){if(C.tag===5||C.tag===6)p.appendChild(C.stateNode);else if(C.tag!==4&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===v)break;for(;C.sibling===null;){if(C.return===null||C.return===v)return;C=C.return}C.sibling.return=C.return,C=C.sibling}},ds=function(){},li=function(p,v,C,V){var ne=p.memoizedProps;if(ne!==V){p=v.stateNode,Gs(Yi.current);var xe=null;switch(C){case"input":ne=on(p,ne),V=on(p,V),xe=[];break;case"select":ne=Ke({},ne,{value:void 0}),V=Ke({},V,{value:void 0}),xe=[];break;case"textarea":ne=ni(p,ne),V=ni(p,V),xe=[];break;default:typeof ne.onClick!="function"&&typeof V.onClick=="function"&&(p.onclick=Lh)}ui(C,V);var Je;C=null;for(Nn in ne)if(!V.hasOwnProperty(Nn)&&ne.hasOwnProperty(Nn)&&ne[Nn]!=null)if(Nn==="style"){var Ft=ne[Nn];for(Je in Ft)Ft.hasOwnProperty(Je)&&(C||(C={}),C[Je]="")}else Nn!=="dangerouslySetInnerHTML"&&Nn!=="children"&&Nn!=="suppressContentEditableWarning"&&Nn!=="suppressHydrationWarning"&&Nn!=="autoFocus"&&(a.hasOwnProperty(Nn)?xe||(xe=[]):(xe=xe||[]).push(Nn,null));for(Nn in V){var Kt=V[Nn];if(Ft=ne?.[Nn],V.hasOwnProperty(Nn)&&Kt!==Ft&&(Kt!=null||Ft!=null))if(Nn==="style")if(Ft){for(Je in Ft)!Ft.hasOwnProperty(Je)||Kt&&Kt.hasOwnProperty(Je)||(C||(C={}),C[Je]="");for(Je in Kt)Kt.hasOwnProperty(Je)&&Ft[Je]!==Kt[Je]&&(C||(C={}),C[Je]=Kt[Je])}else C||(xe||(xe=[]),xe.push(Nn,C)),C=Kt;else Nn==="dangerouslySetInnerHTML"?(Kt=Kt?Kt.__html:void 0,Ft=Ft?Ft.__html:void 0,Kt!=null&&Ft!==Kt&&(xe=xe||[]).push(Nn,Kt)):Nn==="children"?typeof Kt!="string"&&typeof Kt!="number"||(xe=xe||[]).push(Nn,""+Kt):Nn!=="suppressContentEditableWarning"&&Nn!=="suppressHydrationWarning"&&(a.hasOwnProperty(Nn)?(Kt!=null&&Nn==="onScroll"&&Is("scroll",p),xe||Ft===Kt||(xe=[])):(xe=xe||[]).push(Nn,Kt))}C&&(xe=xe||[]).push("style",C);var Nn=xe;(v.updateQueue=Nn)&&(v.flags|=4)}},Hr=function(p,v,C,V){C!==V&&(v.flags|=4)};function qi(p,v){if(!b)switch(p.tailMode){case"hidden":v=p.tail;for(var C=null;v!==null;)v.alternate!==null&&(C=v),v=v.sibling;C===null?p.tail=null:C.sibling=null;break;case"collapsed":C=p.tail;for(var V=null;C!==null;)C.alternate!==null&&(V=C),C=C.sibling;V===null?v||p.tail===null?p.tail=null:p.tail.sibling=null:V.sibling=null}}function Yn(p){var v=p.alternate!==null&&p.alternate.child===p.child,C=0,V=0;if(v)for(var ne=p.child;ne!==null;)C|=ne.lanes|ne.childLanes,V|=ne.subtreeFlags&14680064,V|=ne.flags&14680064,ne.return=p,ne=ne.sibling;else for(ne=p.child;ne!==null;)C|=ne.lanes|ne.childLanes,V|=ne.subtreeFlags,V|=ne.flags,ne.return=p,ne=ne.sibling;return p.subtreeFlags|=V,p.childLanes=C,v}function _n(p,v,C){var V=v.pendingProps;switch(x(v),v.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yn(v),null;case 1:return vl(v.type)&&hf(),Yn(v),null;case 3:return V=v.stateNode,$o(),So(vu),So(ql),Sa(),V.pendingContext&&(V.context=V.pendingContext,V.pendingContext=null),(p===null||p.child===null)&&(ce(v)?v.flags|=4:p===null||p.memoizedState.isDehydrated&&(v.flags&256)===0||(v.flags|=1024,I!==null&&(Jf(I),I=null))),ds(p,v),Yn(v),null;case 5:Yu(v);var ne=Gs(ts.current);if(C=v.type,p!==null&&v.stateNode!=null)li(p,v,C,V,ne),p.ref!==v.ref&&(v.flags|=512,v.flags|=2097152);else{if(!V){if(v.stateNode===null)throw Error(t(166));return Yn(v),null}if(p=Gs(Yi.current),ce(v)){V=v.stateNode,C=v.type;var xe=v.memoizedProps;switch(V[Cl]=v,V[wc]=xe,p=(v.mode&1)!==0,C){case"dialog":Is("cancel",V),Is("close",V);break;case"iframe":case"object":case"embed":Is("load",V);break;case"video":case"audio":for(ne=0;ne<Ka.length;ne++)Is(Ka[ne],V);break;case"source":Is("error",V);break;case"img":case"image":case"link":Is("error",V),Is("load",V);break;case"details":Is("toggle",V);break;case"input":mt(V,xe),Is("invalid",V);break;case"select":V._wrapperState={wasMultiple:!!xe.multiple},Is("invalid",V);break;case"textarea":nn(V,xe),Is("invalid",V)}ui(C,xe),ne=null;for(var Je in xe)if(xe.hasOwnProperty(Je)){var Ft=xe[Je];Je==="children"?typeof Ft=="string"?V.textContent!==Ft&&(xe.suppressHydrationWarning!==!0&&qh(V.textContent,Ft,p),ne=["children",Ft]):typeof Ft=="number"&&V.textContent!==""+Ft&&(xe.suppressHydrationWarning!==!0&&qh(V.textContent,Ft,p),ne=["children",""+Ft]):a.hasOwnProperty(Je)&&Ft!=null&&Je==="onScroll"&&Is("scroll",V)}switch(C){case"input":Xt(V),qr(V,xe,!0);break;case"textarea":Xt(V),sr(V);break;case"select":case"option":break;default:typeof xe.onClick=="function"&&(V.onclick=Lh)}V=ne,v.updateQueue=V,V!==null&&(v.flags|=4)}else{Je=ne.nodeType===9?ne:ne.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=Zn(C)),p==="http://www.w3.org/1999/xhtml"?C==="script"?(p=Je.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof V.is=="string"?p=Je.createElement(C,{is:V.is}):(p=Je.createElement(C),C==="select"&&(Je=p,V.multiple?Je.multiple=!0:V.size&&(Je.size=V.size))):p=Je.createElementNS(p,C),p[Cl]=v,p[wc]=V,ai(p,v,!1,!1),v.stateNode=p;e:{switch(Je=Kr(C,V),C){case"dialog":Is("cancel",p),Is("close",p),ne=V;break;case"iframe":case"object":case"embed":Is("load",p),ne=V;break;case"video":case"audio":for(ne=0;ne<Ka.length;ne++)Is(Ka[ne],p);ne=V;break;case"source":Is("error",p),ne=V;break;case"img":case"image":case"link":Is("error",p),Is("load",p),ne=V;break;case"details":Is("toggle",p),ne=V;break;case"input":mt(p,V),ne=on(p,V),Is("invalid",p);break;case"option":ne=V;break;case"select":p._wrapperState={wasMultiple:!!V.multiple},ne=Ke({},V,{value:void 0}),Is("invalid",p);break;case"textarea":nn(p,V),ne=ni(p,V),Is("invalid",p);break;default:ne=V}ui(C,ne),Ft=ne;for(xe in Ft)if(Ft.hasOwnProperty(xe)){var Kt=Ft[xe];xe==="style"?wr(p,Kt):xe==="dangerouslySetInnerHTML"?(Kt=Kt?Kt.__html:void 0,Kt!=null&&jr(p,Kt)):xe==="children"?typeof Kt=="string"?(C!=="textarea"||Kt!=="")&&ir(p,Kt):typeof Kt=="number"&&ir(p,""+Kt):xe!=="suppressContentEditableWarning"&&xe!=="suppressHydrationWarning"&&xe!=="autoFocus"&&(a.hasOwnProperty(xe)?Kt!=null&&xe==="onScroll"&&Is("scroll",p):Kt!=null&&ve(p,xe,Kt,Je))}switch(C){case"input":Xt(p),qr(p,V,!1);break;case"textarea":Xt(p),sr(p);break;case"option":V.value!=null&&p.setAttribute("value",""+Oe(V.value));break;case"select":p.multiple=!!V.multiple,xe=V.value,xe!=null?dr(p,!!V.multiple,xe,!1):V.defaultValue!=null&&dr(p,!!V.multiple,V.defaultValue,!0);break;default:typeof ne.onClick=="function"&&(p.onclick=Lh)}switch(C){case"button":case"input":case"select":case"textarea":V=!!V.autoFocus;break e;case"img":V=!0;break e;default:V=!1}}V&&(v.flags|=4)}v.ref!==null&&(v.flags|=512,v.flags|=2097152)}return Yn(v),null;case 6:if(p&&v.stateNode!=null)Hr(p,v,p.memoizedProps,V);else{if(typeof V!="string"&&v.stateNode===null)throw Error(t(166));if(C=Gs(ts.current),Gs(Yi.current),ce(v)){if(V=v.stateNode,C=v.memoizedProps,V[Cl]=v,(xe=V.nodeValue!==C)&&(p=l,p!==null))switch(p.tag){case 3:qh(V.nodeValue,C,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&qh(V.nodeValue,C,(p.mode&1)!==0)}xe&&(v.flags|=4)}else V=(C.nodeType===9?C:C.ownerDocument).createTextNode(V),V[Cl]=v,v.stateNode=V}return Yn(v),null;case 13:if(So(Zi),V=v.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(b&&m!==null&&(v.mode&1)!==0&&(v.flags&128)===0)Ee(),Fe(),v.flags|=98560,xe=!1;else if(xe=ce(v),V!==null&&V.dehydrated!==null){if(p===null){if(!xe)throw Error(t(318));if(xe=v.memoizedState,xe=xe!==null?xe.dehydrated:null,!xe)throw Error(t(317));xe[Cl]=v}else Fe(),(v.flags&128)===0&&(v.memoizedState=null),v.flags|=4;Yn(v),xe=!1}else I!==null&&(Jf(I),I=null),xe=!0;if(!xe)return v.flags&65536?v:null}return(v.flags&128)!==0?(v.lanes=C,v):(V=V!==null,V!==(p!==null&&p.memoizedState!==null)&&V&&(v.child.flags|=8192,(v.mode&1)!==0&&(p===null||(Zi.current&1)!==0?Ao===0&&(Ao=3):o0())),v.updateQueue!==null&&(v.flags|=4),Yn(v),null);case 4:return $o(),ds(p,v),p===null&&Mu(v.stateNode.containerInfo),Yn(v),null;case 10:return rn(v.type._context),Yn(v),null;case 17:return vl(v.type)&&hf(),Yn(v),null;case 19:if(So(Zi),xe=v.memoizedState,xe===null)return Yn(v),null;if(V=(v.flags&128)!==0,Je=xe.rendering,Je===null)if(V)qi(xe,!1);else{if(Ao!==0||p!==null&&(p.flags&128)!==0)for(p=v.child;p!==null;){if(Je=ks(p),Je!==null){for(v.flags|=128,qi(xe,!1),V=Je.updateQueue,V!==null&&(v.updateQueue=V,v.flags|=4),v.subtreeFlags=0,V=C,C=v.child;C!==null;)xe=C,p=V,xe.flags&=14680066,Je=xe.alternate,Je===null?(xe.childLanes=0,xe.lanes=p,xe.child=null,xe.subtreeFlags=0,xe.memoizedProps=null,xe.memoizedState=null,xe.updateQueue=null,xe.dependencies=null,xe.stateNode=null):(xe.childLanes=Je.childLanes,xe.lanes=Je.lanes,xe.child=Je.child,xe.subtreeFlags=0,xe.deletions=null,xe.memoizedProps=Je.memoizedProps,xe.memoizedState=Je.memoizedState,xe.updateQueue=Je.updateQueue,xe.type=Je.type,p=Je.dependencies,xe.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),C=C.sibling;return fs(Zi,Zi.current&1|2),v.child}p=p.sibling}xe.tail!==null&&Ss()>zp&&(v.flags|=128,V=!0,qi(xe,!1),v.lanes=4194304)}else{if(!V)if(p=ks(Je),p!==null){if(v.flags|=128,V=!0,C=p.updateQueue,C!==null&&(v.updateQueue=C,v.flags|=4),qi(xe,!0),xe.tail===null&&xe.tailMode==="hidden"&&!Je.alternate&&!b)return Yn(v),null}else 2*Ss()-xe.renderingStartTime>zp&&C!==1073741824&&(v.flags|=128,V=!0,qi(xe,!1),v.lanes=4194304);xe.isBackwards?(Je.sibling=v.child,v.child=Je):(C=xe.last,C!==null?C.sibling=Je:v.child=Je,xe.last=Je)}return xe.tail!==null?(v=xe.tail,xe.rendering=v,xe.tail=v.sibling,xe.renderingStartTime=Ss(),v.sibling=null,C=Zi.current,fs(Zi,V?C&1|2:C&1),v):(Yn(v),null);case 22:case 23:return Dg(),V=v.memoizedState!==null,p!==null&&p.memoizedState!==null!==V&&(v.flags|=8192),V&&(v.mode&1)!==0?(Nl&1073741824)!==0&&(Yn(v),v.subtreeFlags&6&&(v.flags|=8192)):Yn(v),null;case 24:return null;case 25:return null}throw Error(t(156,v.tag))}function Dn(p,v){switch(x(v),v.tag){case 1:return vl(v.type)&&hf(),p=v.flags,p&65536?(v.flags=p&-65537|128,v):null;case 3:return $o(),So(vu),So(ql),Sa(),p=v.flags,(p&65536)!==0&&(p&128)===0?(v.flags=p&-65537|128,v):null;case 5:return Yu(v),null;case 13:if(So(Zi),p=v.memoizedState,p!==null&&p.dehydrated!==null){if(v.alternate===null)throw Error(t(340));Fe()}return p=v.flags,p&65536?(v.flags=p&-65537|128,v):null;case 19:return So(Zi),null;case 4:return $o(),null;case 10:return rn(v.type._context),null;case 22:case 23:return Dg(),null;case 24:return null;default:return null}}var ur=!1,yr=!1,vi=typeof WeakSet=="function"?WeakSet:Set,er=null;function Mo(p,v){var C=p.ref;if(C!==null)if(typeof C=="function")try{C(null)}catch(V){fu(p,v,V)}else C.current=null}function ls(p,v,C){try{C()}catch(V){fu(p,v,V)}}var mo=!1;function Qs(p,v){if(Si=gu,p=Ye(),bt(p)){if("selectionStart"in p)var C={start:p.selectionStart,end:p.selectionEnd};else e:{C=(C=p.ownerDocument)&&C.defaultView||window;var V=C.getSelection&&C.getSelection();if(V&&V.rangeCount!==0){C=V.anchorNode;var ne=V.anchorOffset,xe=V.focusNode;V=V.focusOffset;try{C.nodeType,xe.nodeType}catch{C=null;break e}var Je=0,Ft=-1,Kt=-1,Nn=0,br=0,Tr=p,hr=null;t:for(;;){for(var fi;Tr!==C||ne!==0&&Tr.nodeType!==3||(Ft=Je+ne),Tr!==xe||V!==0&&Tr.nodeType!==3||(Kt=Je+V),Tr.nodeType===3&&(Je+=Tr.nodeValue.length),(fi=Tr.firstChild)!==null;)hr=Tr,Tr=fi;for(;;){if(Tr===p)break t;if(hr===C&&++Nn===ne&&(Ft=Je),hr===xe&&++br===V&&(Kt=Je),(fi=Tr.nextSibling)!==null)break;Tr=hr,hr=Tr.parentNode}Tr=fi}C=Ft===-1||Kt===-1?null:{start:Ft,end:Kt}}else C=null}C=C||{start:0,end:0}}else C=null;for(Mc={focusedElem:p,selectionRange:C},gu=!1,er=v;er!==null;)if(v=er,p=v.child,(v.subtreeFlags&1028)!==0&&p!==null)p.return=v,er=p;else for(;er!==null;){v=er;try{var Ii=v.alternate;if((v.flags&1024)!==0)switch(v.tag){case 0:case 11:case 15:break;case 1:if(Ii!==null){var ki=Ii.memoizedProps,du=Ii.memoizedState,Sn=v.stateNode,un=Sn.getSnapshotBeforeUpdate(v.elementType===v.type?ki:ju(v.type,ki),du);Sn.__reactInternalSnapshotBeforeUpdate=un}break;case 3:var Ln=v.stateNode.containerInfo;Ln.nodeType===1?Ln.textContent="":Ln.nodeType===9&&Ln.documentElement&&Ln.removeChild(Ln.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Or){fu(v,v.return,Or)}if(p=v.sibling,p!==null){p.return=v.return,er=p;break}er=v.return}return Ii=mo,mo=!1,Ii}function bl(p,v,C){var V=v.updateQueue;if(V=V!==null?V.lastEffect:null,V!==null){var ne=V=V.next;do{if((ne.tag&p)===p){var xe=ne.destroy;ne.destroy=void 0,xe!==void 0&&ls(v,C,xe)}ne=ne.next}while(ne!==V)}}function Do(p,v){if(v=v.updateQueue,v=v!==null?v.lastEffect:null,v!==null){var C=v=v.next;do{if((C.tag&p)===p){var V=C.create;C.destroy=V()}C=C.next}while(C!==v)}}function wl(p){var v=p.ref;if(v!==null){var C=p.stateNode;switch(p.tag){case 5:p=C;break;default:p=C}typeof v=="function"?v(p):v.current=p}}function To(p){var v=p.alternate;v!==null&&(p.alternate=null,To(v)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(v=p.stateNode,v!==null&&(delete v[Cl],delete v[wc],delete v[cu],delete v[Hh],delete v[_d])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function _r(p){return p.tag===5||p.tag===3||p.tag===4}function Dc(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||_r(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function Qc(p,v,C){var V=p.tag;if(V===5||V===6)p=p.stateNode,v?C.nodeType===8?C.parentNode.insertBefore(p,v):C.insertBefore(p,v):(C.nodeType===8?(v=C.parentNode,v.insertBefore(p,C)):(v=C,v.appendChild(p)),C=C._reactRootContainer,C!=null||v.onclick!==null||(v.onclick=Lh));else if(V!==4&&(p=p.child,p!==null))for(Qc(p,v,C),p=p.sibling;p!==null;)Qc(p,v,C),p=p.sibling}function Jh(p,v,C){var V=p.tag;if(V===5||V===6)p=p.stateNode,v?C.insertBefore(p,v):C.appendChild(p);else if(V!==4&&(p=p.child,p!==null))for(Jh(p,v,C),p=p.sibling;p!==null;)Jh(p,v,C),p=p.sibling}var _o=null,nu=!1;function Ll(p,v,C){for(C=C.child;C!==null;)Qh(p,v,C),C=C.sibling}function Qh(p,v,C){if(ta&&typeof ta.onCommitFiberUnmount=="function")try{ta.onCommitFiberUnmount(Wo,C)}catch{}switch(C.tag){case 5:yr||Mo(C,v);case 6:var V=_o,ne=nu;_o=null,Ll(p,v,C),_o=V,nu=ne,_o!==null&&(nu?(p=_o,C=C.stateNode,p.nodeType===8?p.parentNode.removeChild(C):p.removeChild(C)):_o.removeChild(C.stateNode));break;case 18:_o!==null&&(nu?(p=_o,C=C.stateNode,p.nodeType===8?Af(p.parentNode,C):p.nodeType===1&&Af(p,C),ra(p)):Af(_o,C.stateNode));break;case 4:V=_o,ne=nu,_o=C.stateNode.containerInfo,nu=!0,Ll(p,v,C),_o=V,nu=ne;break;case 0:case 11:case 14:case 15:if(!yr&&(V=C.updateQueue,V!==null&&(V=V.lastEffect,V!==null))){ne=V=V.next;do{var xe=ne,Je=xe.destroy;xe=xe.tag,Je!==void 0&&((xe&2)!==0||(xe&4)!==0)&&ls(C,v,Je),ne=ne.next}while(ne!==V)}Ll(p,v,C);break;case 1:if(!yr&&(Mo(C,v),V=C.stateNode,typeof V.componentWillUnmount=="function"))try{V.props=C.memoizedProps,V.state=C.memoizedState,V.componentWillUnmount()}catch(Ft){fu(C,v,Ft)}Ll(p,v,C);break;case 21:Ll(p,v,C);break;case 22:C.mode&1?(yr=(V=yr)||C.memoizedState!==null,Ll(p,v,C),yr=V):Ll(p,v,C);break;default:Ll(p,v,C)}}function ef(p){var v=p.updateQueue;if(v!==null){p.updateQueue=null;var C=p.stateNode;C===null&&(C=p.stateNode=new vi),v.forEach(function(V){var ne=sb.bind(null,p,V);C.has(V)||(C.add(V),V.then(ne,ne))})}}function Uu(p,v){var C=v.deletions;if(C!==null)for(var V=0;V<C.length;V++){var ne=C[V];try{var xe=p,Je=v,Ft=Je;e:for(;Ft!==null;){switch(Ft.tag){case 5:_o=Ft.stateNode,nu=!1;break e;case 3:_o=Ft.stateNode.containerInfo,nu=!0;break e;case 4:_o=Ft.stateNode.containerInfo,nu=!0;break e}Ft=Ft.return}if(_o===null)throw Error(t(160));Qh(xe,Je,ne),_o=null,nu=!1;var Kt=ne.alternate;Kt!==null&&(Kt.return=null),ne.return=null}catch(Nn){fu(ne,v,Nn)}}if(v.subtreeFlags&12854)for(v=v.child;v!==null;)Kf(v,p),v=v.sibling}function Kf(p,v){var C=p.alternate,V=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Uu(v,p),Oc(p),V&4){try{bl(3,p,p.return),Do(3,p)}catch(ki){fu(p,p.return,ki)}try{bl(5,p,p.return)}catch(ki){fu(p,p.return,ki)}}break;case 1:Uu(v,p),Oc(p),V&512&&C!==null&&Mo(C,C.return);break;case 5:if(Uu(v,p),Oc(p),V&512&&C!==null&&Mo(C,C.return),p.flags&32){var ne=p.stateNode;try{ir(ne,"")}catch(ki){fu(p,p.return,ki)}}if(V&4&&(ne=p.stateNode,ne!=null)){var xe=p.memoizedProps,Je=C!==null?C.memoizedProps:xe,Ft=p.type,Kt=p.updateQueue;if(p.updateQueue=null,Kt!==null)try{Ft==="input"&&xe.type==="radio"&&xe.name!=null&&Ir(ne,xe),Kr(Ft,Je);var Nn=Kr(Ft,xe);for(Je=0;Je<Kt.length;Je+=2){var br=Kt[Je],Tr=Kt[Je+1];br==="style"?wr(ne,Tr):br==="dangerouslySetInnerHTML"?jr(ne,Tr):br==="children"?ir(ne,Tr):ve(ne,br,Tr,Nn)}switch(Ft){case"input":Fr(ne,xe);break;case"textarea":yn(ne,xe);break;case"select":var hr=ne._wrapperState.wasMultiple;ne._wrapperState.wasMultiple=!!xe.multiple;var fi=xe.value;fi!=null?dr(ne,!!xe.multiple,fi,!1):hr!==!!xe.multiple&&(xe.defaultValue!=null?dr(ne,!!xe.multiple,xe.defaultValue,!0):dr(ne,!!xe.multiple,xe.multiple?[]:"",!1))}ne[wc]=xe}catch(ki){fu(p,p.return,ki)}}break;case 6:if(Uu(v,p),Oc(p),V&4){if(p.stateNode===null)throw Error(t(162));ne=p.stateNode,xe=p.memoizedProps;try{ne.nodeValue=xe}catch(ki){fu(p,p.return,ki)}}break;case 3:if(Uu(v,p),Oc(p),V&4&&C!==null&&C.memoizedState.isDehydrated)try{ra(v.containerInfo)}catch(ki){fu(p,p.return,ki)}break;case 4:Uu(v,p),Oc(p);break;case 13:Uu(v,p),Oc(p),ne=p.child,ne.flags&8192&&(xe=ne.memoizedState!==null,ne.stateNode.isHidden=xe,!xe||ne.alternate!==null&&ne.alternate.memoizedState!==null||(ap=Ss())),V&4&&ef(p);break;case 22:if(br=C!==null&&C.memoizedState!==null,p.mode&1?(yr=(Nn=yr)||br,Uu(v,p),yr=Nn):Uu(v,p),Oc(p),V&8192){if(Nn=p.memoizedState!==null,(p.stateNode.isHidden=Nn)&&!br&&(p.mode&1)!==0)for(er=p,br=p.child;br!==null;){for(Tr=er=br;er!==null;){switch(hr=er,fi=hr.child,hr.tag){case 0:case 11:case 14:case 15:bl(4,hr,hr.return);break;case 1:Mo(hr,hr.return);var Ii=hr.stateNode;if(typeof Ii.componentWillUnmount=="function"){V=hr,C=hr.return;try{v=V,Ii.props=v.memoizedProps,Ii.state=v.memoizedState,Ii.componentWillUnmount()}catch(ki){fu(V,C,ki)}}break;case 5:Mo(hr,hr.return);break;case 22:if(hr.memoizedState!==null){fl(Tr);continue}}fi!==null?(fi.return=hr,er=fi):fl(Tr)}br=br.sibling}e:for(br=null,Tr=p;;){if(Tr.tag===5){if(br===null){br=Tr;try{ne=Tr.stateNode,Nn?(xe=ne.style,typeof xe.setProperty=="function"?xe.setProperty("display","none","important"):xe.display="none"):(Ft=Tr.stateNode,Kt=Tr.memoizedProps.style,Je=Kt!=null&&Kt.hasOwnProperty("display")?Kt.display:null,Ft.style.display=bi("display",Je))}catch(ki){fu(p,p.return,ki)}}}else if(Tr.tag===6){if(br===null)try{Tr.stateNode.nodeValue=Nn?"":Tr.memoizedProps}catch(ki){fu(p,p.return,ki)}}else if((Tr.tag!==22&&Tr.tag!==23||Tr.memoizedState===null||Tr===p)&&Tr.child!==null){Tr.child.return=Tr,Tr=Tr.child;continue}if(Tr===p)break e;for(;Tr.sibling===null;){if(Tr.return===null||Tr.return===p)break e;br===Tr&&(br=null),Tr=Tr.return}br===Tr&&(br=null),Tr.sibling.return=Tr.return,Tr=Tr.sibling}}break;case 19:Uu(v,p),Oc(p),V&4&&ef(p);break;case 21:break;default:Uu(v,p),Oc(p)}}function Oc(p){var v=p.flags;if(v&2){try{e:{for(var C=p.return;C!==null;){if(_r(C)){var V=C;break e}C=C.return}throw Error(t(160))}switch(V.tag){case 5:var ne=V.stateNode;V.flags&32&&(ir(ne,""),V.flags&=-33);var xe=Dc(p);Jh(p,xe,ne);break;case 3:case 4:var Je=V.stateNode.containerInfo,Ft=Dc(p);Qc(p,Ft,Je);break;default:throw Error(t(161))}}catch(Kt){fu(p,p.return,Kt)}p.flags&=-3}v&4096&&(p.flags&=-4097)}function eh(p,v,C){er=p,Di(p)}function Di(p,v,C){for(var V=(p.mode&1)!==0;er!==null;){var ne=er,xe=ne.child;if(ne.tag===22&&V){var Je=ne.memoizedState!==null||ur;if(!Je){var Ft=ne.alternate,Kt=Ft!==null&&Ft.memoizedState!==null||yr;Ft=ur;var Nn=yr;if(ur=Je,(yr=Kt)&&!Nn)for(er=ne;er!==null;)Je=er,Kt=Je.child,Je.tag===22&&Je.memoizedState!==null?Fh(ne):Kt!==null?(Kt.return=Je,er=Kt):Fh(ne);for(;xe!==null;)er=xe,Di(xe),xe=xe.sibling;er=ne,ur=Ft,yr=Nn}Ko(p)}else(ne.subtreeFlags&8772)!==0&&xe!==null?(xe.return=ne,er=xe):Ko(p)}}function Ko(p){for(;er!==null;){var v=er;if((v.flags&8772)!==0){var C=v.alternate;try{if((v.flags&8772)!==0)switch(v.tag){case 0:case 11:case 15:yr||Do(5,v);break;case 1:var V=v.stateNode;if(v.flags&4&&!yr)if(C===null)V.componentDidMount();else{var ne=v.elementType===v.type?C.memoizedProps:ju(v.type,C.memoizedProps);V.componentDidUpdate(ne,C.memoizedState,V.__reactInternalSnapshotBeforeUpdate)}var xe=v.updateQueue;xe!==null&&Mi(v,xe,V);break;case 3:var Je=v.updateQueue;if(Je!==null){if(C=null,v.child!==null)switch(v.child.tag){case 5:C=v.child.stateNode;break;case 1:C=v.child.stateNode}Mi(v,Je,C)}break;case 5:var Ft=v.stateNode;if(C===null&&v.flags&4){C=Ft;var Kt=v.memoizedProps;switch(v.type){case"button":case"input":case"select":case"textarea":Kt.autoFocus&&C.focus();break;case"img":Kt.src&&(C.src=Kt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(v.memoizedState===null){var Nn=v.alternate;if(Nn!==null){var br=Nn.memoizedState;if(br!==null){var Tr=br.dehydrated;Tr!==null&&ra(Tr)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}yr||v.flags&512&&wl(v)}catch(hr){fu(v,v.return,hr)}}if(v===p){er=null;break}if(C=v.sibling,C!==null){C.return=v.return,er=C;break}er=v.return}}function fl(p){for(;er!==null;){var v=er;if(v===p){er=null;break}var C=v.sibling;if(C!==null){C.return=v.return,er=C;break}er=v.return}}function Fh(p){for(;er!==null;){var v=er;try{switch(v.tag){case 0:case 11:case 15:var C=v.return;try{Do(4,v)}catch(Kt){fu(v,C,Kt)}break;case 1:var V=v.stateNode;if(typeof V.componentDidMount=="function"){var ne=v.return;try{V.componentDidMount()}catch(Kt){fu(v,ne,Kt)}}var xe=v.return;try{wl(v)}catch(Kt){fu(v,xe,Kt)}break;case 5:var Je=v.return;try{wl(v)}catch(Kt){fu(v,Je,Kt)}}}catch(Kt){fu(v,v.return,Kt)}if(v===p){er=null;break}var Ft=v.sibling;if(Ft!==null){Ft.return=v.return,er=Ft;break}er=v.return}}var bu=Math.ceil,Ac=de.ReactCurrentDispatcher,ff=de.ReactCurrentOwner,Fa=de.ReactCurrentBatchConfig,hi=0,Pl=null,Zo=null,Qa=0,Nl=0,Hl=Du(0),Ao=0,Zf=null,Sl=0,op=0,Nf=0,df=null,Ic=null,ap=0,zp=1/0,pf=null,Lm=!1,r0=null,Fc=null,Rf=!1,mf=null,lp=0,up=0,Ng=null,Rg=-1,Pm=0;function th(){return(hi&6)!==0?Ss():Rg!==-1?Rg:Rg=Ss()}function Mf(p){return(p.mode&1)===0?1:(hi&2)!==0&&Qa!==0?Qa&-Qa:at.transition!==null?(Pm===0&&(Pm=ca()),Pm):(p=Wi,p!==0||(p=window.event,p=p===void 0?16:Na(p.type)),p)}function gf(p,v,C,V){if(50<up)throw up=0,Ng=null,Error(t(185));Ri(p,C,V),((hi&2)===0||p!==Pl)&&(p===Pl&&((hi&2)===0&&(op|=C),Ao===4&&xd(p,Qa)),Bc(p,V),C===1&&hi===0&&(v.mode&1)===0&&(zp=Ss()+500,hh&&pe()))}function Bc(p,v){var C=p.callbackNode;Wr(p,v);var V=ho(p,p===Pl?Qa:0);if(V===0)C!==null&&di(C),p.callbackNode=null,p.callbackPriority=0;else if(v=V&-V,p.callbackPriority!==v){if(C!=null&&di(C),v===1)p.tag===0?ue(cp.bind(null,p)):H(cp.bind(null,p)),lc(function(){(hi&6)===0&&pe()}),C=null;else{switch(ko(V)){case 1:C=ga;break;case 4:C=uo;break;case 16:C=nl;break;case 536870912:C=ea;break;default:C=nl}C=Rm(C,i0.bind(null,p))}p.callbackPriority=v,p.callbackNode=C}}function i0(p,v){if(Rg=-1,Pm=0,(hi&6)!==0)throw Error(t(327));var C=p.callbackNode;if(mh()&&p.callbackNode!==C)return null;var V=ho(p,p===Pl?Qa:0);if(V===0)return null;if((V&30)!==0||(V&p.expiredLanes)!==0||v)v=Nm(p,V);else{v=V;var ne=hi;hi|=2;var xe=s0();(Pl!==p||Qa!==v)&&(pf=null,zp=Ss()+500,hp(p,v));do try{rb();break}catch(Ft){n1(p,Ft)}while(!0);Bt(),Ac.current=xe,hi=ne,Zo!==null?v=0:(Pl=null,Qa=0,v=Ao)}if(v!==0){if(v===2&&(ne=Ur(p),ne!==0&&(V=ne,v=Mg(p,ne))),v===1)throw C=Zf,hp(p,0),xd(p,V),Bc(p,Ss()),C;if(v===6)xd(p,V);else{if(ne=p.current.alternate,(V&30)===0&&!t1(ne)&&(v=Nm(p,V),v===2&&(xe=Ur(p),xe!==0&&(V=xe,v=Mg(p,xe))),v===1))throw C=Zf,hp(p,0),xd(p,V),Bc(p,Ss()),C;switch(p.finishedWork=ne,p.finishedLanes=V,v){case 0:case 1:throw Error(t(345));case 2:wd(p,Ic,pf);break;case 3:if(xd(p,V),(V&130023424)===V&&(v=ap+500-Ss(),10<v)){if(ho(p,0)!==0)break;if(ne=p.suspendedLanes,(ne&V)!==V){th(),p.pingedLanes|=p.suspendedLanes&ne;break}p.timeoutHandle=Da(wd.bind(null,p,Ic,pf),v);break}wd(p,Ic,pf);break;case 4:if(xd(p,V),(V&4194240)===V)break;for(v=p.eventTimes,ne=-1;0<V;){var Je=31-co(V);xe=1<<Je,Je=v[Je],Je>ne&&(ne=Je),V&=~xe}if(V=ne,V=Ss()-V,V=(120>V?120:480>V?480:1080>V?1080:1920>V?1920:3e3>V?3e3:4320>V?4320:1960*bu(V/1960))-V,10<V){p.timeoutHandle=Da(wd.bind(null,p,Ic,pf),V);break}wd(p,Ic,pf);break;case 5:wd(p,Ic,pf);break;default:throw Error(t(329))}}}return Bc(p,Ss()),p.callbackNode===C?i0.bind(null,p):null}function Mg(p,v){var C=df;return p.current.memoizedState.isDehydrated&&(hp(p,v).flags|=256),p=Nm(p,v),p!==2&&(v=Ic,Ic=C,v!==null&&Jf(v)),p}function Jf(p){Ic===null?Ic=p:Ic.push.apply(Ic,p)}function t1(p){for(var v=p;;){if(v.flags&16384){var C=v.updateQueue;if(C!==null&&(C=C.stores,C!==null))for(var V=0;V<C.length;V++){var ne=C[V],xe=ne.getSnapshot;ne=ne.value;try{if(!S(xe(),ne))return!1}catch{return!1}}}if(C=v.child,v.subtreeFlags&16384&&C!==null)C.return=v,v=C;else{if(v===p)break;for(;v.sibling===null;){if(v.return===null||v.return===p)return!0;v=v.return}v.sibling.return=v.return,v=v.sibling}}return!0}function xd(p,v){for(v&=~Nf,v&=~op,p.suspendedLanes|=v,p.pingedLanes&=~v,p=p.expirationTimes;0<v;){var C=31-co(v),V=1<<C;p[C]=-1,v&=~V}}function cp(p){if((hi&6)!==0)throw Error(t(327));mh();var v=ho(p,0);if((v&1)===0)return Bc(p,Ss()),null;var C=Nm(p,v);if(p.tag!==0&&C===2){var V=Ur(p);V!==0&&(v=V,C=Mg(p,V))}if(C===1)throw C=Zf,hp(p,0),xd(p,v),Bc(p,Ss()),C;if(C===6)throw Error(t(345));return p.finishedWork=p.current.alternate,p.finishedLanes=v,wd(p,Ic,pf),Bc(p,Ss()),null}function jp(p,v){var C=hi;hi|=1;try{return p(v)}finally{hi=C,hi===0&&(zp=Ss()+500,hh&&pe())}}function bd(p){mf!==null&&mf.tag===0&&(hi&6)===0&&mh();var v=hi;hi|=1;var C=Fa.transition,V=Wi;try{if(Fa.transition=null,Wi=1,p)return p()}finally{Wi=V,Fa.transition=C,hi=v,(hi&6)===0&&pe()}}function Dg(){Nl=Hl.current,So(Hl)}function hp(p,v){p.finishedWork=null,p.finishedLanes=0;var C=p.timeoutHandle;if(C!==-1&&(p.timeoutHandle=-1,Ul(C)),Zo!==null)for(C=Zo.return;C!==null;){var V=C;switch(x(V),V.tag){case 1:V=V.type.childContextTypes,V!=null&&hf();break;case 3:$o(),So(vu),So(ql),Sa();break;case 5:Yu(V);break;case 4:$o();break;case 13:So(Zi);break;case 19:So(Zi);break;case 10:rn(V.type._context);break;case 22:case 23:Dg()}C=C.return}if(Pl=p,Zo=p=Sd(p.current,null),Qa=Nl=v,Ao=0,Zf=null,Nf=op=Sl=0,Ic=df=null,cn!==null){for(v=0;v<cn.length;v++)if(C=cn[v],V=C.interleaved,V!==null){C.interleaved=null;var ne=V.next,xe=C.pending;if(xe!==null){var Je=xe.next;xe.next=ne,V.next=Je}C.pending=V}cn=null}return p}function n1(p,v){do{var C=Zo;try{if(Bt(),Gl.current=Ju,zu){for(var V=Yo.memoizedState;V!==null;){var ne=V.queue;ne!==null&&(ne.pending=null),V=V.next}zu=!1}if(Ea=0,aa=Ro=Yo=null,Ta=!1,Ku=0,ff.current=null,C===null||C.return===null){Ao=1,Zf=v,Zo=null;break}e:{var xe=p,Je=C.return,Ft=C,Kt=v;if(v=Qa,Ft.flags|=32768,Kt!==null&&typeof Kt=="object"&&typeof Kt.then=="function"){var Nn=Kt,br=Ft,Tr=br.tag;if((br.mode&1)===0&&(Tr===0||Tr===11||Tr===15)){var hr=br.alternate;hr?(br.updateQueue=hr.updateQueue,br.memoizedState=hr.memoizedState,br.lanes=hr.lanes):(br.updateQueue=null,br.memoizedState=null)}var fi=Bp(Je);if(fi!==null){fi.flags&=-257,km(fi,Je,Ft,xe,v),fi.mode&1&&Oh(xe,Nn,v),v=fi,Kt=Nn;var Ii=v.updateQueue;if(Ii===null){var ki=new Set;ki.add(Kt),v.updateQueue=ki}else Ii.add(Kt);break e}else{if((v&1)===0){Oh(xe,Nn,v),o0();break e}Kt=Error(t(426))}}else if(b&&Ft.mode&1){var du=Bp(Je);if(du!==null){(du.flags&65536)===0&&(du.flags|=256),km(du,Je,Ft,xe,v),qe(Lf(Kt,Ft));break e}}xe=Kt=Lf(Kt,Ft),Ao!==4&&(Ao=2),df===null?df=[xe]:df.push(xe),xe=Je;do{switch(xe.tag){case 3:xe.flags|=65536,v&=-v,xe.lanes|=v;var Sn=Zh(xe,Kt,v);gr(xe,Sn);break e;case 1:Ft=Kt;var un=xe.type,Ln=xe.stateNode;if((xe.flags&128)===0&&(typeof un.getDerivedStateFromError=="function"||Ln!==null&&typeof Ln.componentDidCatch=="function"&&(Fc===null||!Fc.has(Ln)))){xe.flags|=65536,v&=-v,xe.lanes|=v;var Or=Pf(xe,Ft,v);gr(xe,Or);break e}}xe=xe.return}while(xe!==null)}l0(C)}catch(Li){v=Li,Zo===C&&C!==null&&(Zo=C=C.return);continue}break}while(!0)}function s0(){var p=Ac.current;return Ac.current=Ju,p===null?Ju:p}function o0(){(Ao===0||Ao===3||Ao===2)&&(Ao=4),Pl===null||(Sl&268435455)===0&&(op&268435455)===0||xd(Pl,Qa)}function Nm(p,v){var C=hi;hi|=2;var V=s0();(Pl!==p||Qa!==v)&&(pf=null,hp(p,v));do try{nb();break}catch(ne){n1(p,ne)}while(!0);if(Bt(),hi=C,Ac.current=V,Zo!==null)throw Error(t(261));return Pl=null,Qa=0,Ao}function nb(){for(;Zo!==null;)a0(Zo)}function rb(){for(;Zo!==null&&!ou();)a0(Zo)}function a0(p){var v=Og(p.alternate,p,Nl);p.memoizedProps=p.pendingProps,v===null?l0(p):Zo=v,ff.current=null}function l0(p){var v=p;do{var C=v.alternate;if(p=v.return,(v.flags&32768)===0){if(C=_n(C,v,Nl),C!==null){Zo=C;return}}else{if(C=Dn(C,v),C!==null){C.flags&=32767,Zo=C;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{Ao=6,Zo=null;return}}if(v=v.sibling,v!==null){Zo=v;return}Zo=v=p}while(v!==null);Ao===0&&(Ao=5)}function wd(p,v,C){var V=Wi,ne=Fa.transition;try{Fa.transition=null,Wi=1,u0(p,v,C,V)}finally{Fa.transition=ne,Wi=V}return null}function u0(p,v,C,V){do mh();while(mf!==null);if((hi&6)!==0)throw Error(t(327));C=p.finishedWork;var ne=p.finishedLanes;if(C===null)return null;if(p.finishedWork=null,p.finishedLanes=0,C===p.current)throw Error(t(177));p.callbackNode=null,p.callbackPriority=0;var xe=C.lanes|C.childLanes;if(Hi(p,xe),p===Pl&&(Zo=Pl=null,Qa=0),(C.subtreeFlags&2064)===0&&(C.flags&2064)===0||Rf||(Rf=!0,Rm(nl,function(){return mh(),null})),xe=(C.flags&15990)!==0,(C.subtreeFlags&15990)!==0||xe){xe=Fa.transition,Fa.transition=null;var Je=Wi;Wi=1;var Ft=hi;hi|=4,ff.current=null,Qs(p,C),Kf(C,p),an(Mc),gu=!!Si,Mc=Si=null,p.current=C,eh(C),yc(),hi=Ft,Wi=Je,Fa.transition=xe}else p.current=C;if(Rf&&(Rf=!1,mf=p,lp=ne),xe=p.pendingLanes,xe===0&&(Fc=null),En(C.stateNode),Bc(p,Ss()),v!==null)for(V=p.onRecoverableError,C=0;C<v.length;C++)ne=v[C],V(ne.value,{componentStack:ne.stack,digest:ne.digest});if(Lm)throw Lm=!1,p=r0,r0=null,p;return(lp&1)!==0&&p.tag!==0&&mh(),xe=p.pendingLanes,(xe&1)!==0?p===Ng?up++:(up=0,Ng=p):up=0,pe(),null}function mh(){if(mf!==null){var p=ko(lp),v=Fa.transition,C=Wi;try{if(Fa.transition=null,Wi=16>p?16:p,mf===null)var V=!1;else{if(p=mf,mf=null,lp=0,(hi&6)!==0)throw Error(t(331));var ne=hi;for(hi|=4,er=p.current;er!==null;){var xe=er,Je=xe.child;if((er.flags&16)!==0){var Ft=xe.deletions;if(Ft!==null){for(var Kt=0;Kt<Ft.length;Kt++){var Nn=Ft[Kt];for(er=Nn;er!==null;){var br=er;switch(br.tag){case 0:case 11:case 15:bl(8,br,xe)}var Tr=br.child;if(Tr!==null)Tr.return=br,er=Tr;else for(;er!==null;){br=er;var hr=br.sibling,fi=br.return;if(To(br),br===Nn){er=null;break}if(hr!==null){hr.return=fi,er=hr;break}er=fi}}}var Ii=xe.alternate;if(Ii!==null){var ki=Ii.child;if(ki!==null){Ii.child=null;do{var du=ki.sibling;ki.sibling=null,ki=du}while(ki!==null)}}er=xe}}if((xe.subtreeFlags&2064)!==0&&Je!==null)Je.return=xe,er=Je;else e:for(;er!==null;){if(xe=er,(xe.flags&2048)!==0)switch(xe.tag){case 0:case 11:case 15:bl(9,xe,xe.return)}var Sn=xe.sibling;if(Sn!==null){Sn.return=xe.return,er=Sn;break e}er=xe.return}}var un=p.current;for(er=un;er!==null;){Je=er;var Ln=Je.child;if((Je.subtreeFlags&2064)!==0&&Ln!==null)Ln.return=Je,er=Ln;else e:for(Je=un;er!==null;){if(Ft=er,(Ft.flags&2048)!==0)try{switch(Ft.tag){case 0:case 11:case 15:Do(9,Ft)}}catch(Li){fu(Ft,Ft.return,Li)}if(Ft===Je){er=null;break e}var Or=Ft.sibling;if(Or!==null){Or.return=Ft.return,er=Or;break e}er=Ft.return}}if(hi=ne,pe(),ta&&typeof ta.onPostCommitFiberRoot=="function")try{ta.onPostCommitFiberRoot(Wo,p)}catch{}V=!0}return V}finally{Wi=C,Fa.transition=v}}return!1}function nh(p,v,C){v=Lf(C,v),v=Zh(p,v,1),p=ei(p,v,1),v=th(),p!==null&&(Ri(p,1,v),Bc(p,v))}function fu(p,v,C){if(p.tag===3)nh(p,p,C);else for(;v!==null;){if(v.tag===3){nh(v,p,C);break}else if(v.tag===1){var V=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof V.componentDidCatch=="function"&&(Fc===null||!Fc.has(V))){p=Lf(C,p),p=Pf(v,p,1),v=ei(v,p,1),p=th(),v!==null&&(Ri(v,1,p),Bc(v,p));break}}v=v.return}}function c0(p,v,C){var V=p.pingCache;V!==null&&V.delete(v),v=th(),p.pingedLanes|=p.suspendedLanes&C,Pl===p&&(Qa&C)===C&&(Ao===4||Ao===3&&(Qa&130023424)===Qa&&500>Ss()-ap?hp(p,0):Nf|=C),Bc(p,v)}function r1(p,v){v===0&&((p.mode&1)===0?v=1:(v=il,il<<=1,(il&130023424)===0&&(il=4194304)));var C=th();p=bn(p,v),p!==null&&(Ri(p,v,C),Bc(p,C))}function ib(p){var v=p.memoizedState,C=0;v!==null&&(C=v.retryLane),r1(p,C)}function sb(p,v){var C=0;switch(p.tag){case 13:var V=p.stateNode,ne=p.memoizedState;ne!==null&&(C=ne.retryLane);break;case 19:V=p.stateNode;break;default:throw Error(t(314))}V!==null&&V.delete(v),r1(p,C)}var Og;Og=function(p,v,C){if(p!==null)if(p.memoizedProps!==v.pendingProps||vu.current)be=!0;else{if((p.lanes&C)===0&&(v.flags&128)===0)return be=!1,Jr(p,v,C);be=(p.flags&131072)!==0}else be=!1,b&&(v.flags&1048576)!==0&&gn(v,ht,v.index);switch(v.lanes=0,v.tag){case 2:var V=v.type;ci(p,v),p=v.pendingProps;var ne=_l(v,ql.current);Jt(v,C),ne=Cf(null,v,V,p,ne,C);var xe=Wc();return v.flags|=1,typeof ne=="object"&&ne!==null&&typeof ne.render=="function"&&ne.$$typeof===void 0?(v.tag=1,v.memoizedState=null,v.updateQueue=null,vl(V)?(xe=!0,hu(v)):xe=!1,v.memoizedState=ne.state!==null&&ne.state!==void 0?ne.state:null,In(v),ne.updater=Ec,v.stateNode=ne,ne._reactInternals=v,Fp(v,V,p,C),v=en(null,v,V,!0,xe,C)):(v.tag=0,b&&xe&&Bn(v),Me(null,v,ne,C),v=v.child),v;case 16:V=v.elementType;e:{switch(ci(p,v),p=v.pendingProps,ne=V._init,V=ne(V._payload),v.type=V,ne=v.tag=ob(V),p=ju(V,p),ne){case 0:v=Ht(null,v,V,p,C);break e;case 1:v=Ct(null,v,V,p,C);break e;case 11:v=Qe(null,v,V,p,C);break e;case 14:v=ct(null,v,V,ju(V.type,p),C);break e}throw Error(t(306,V,""))}return v;case 0:return V=v.type,ne=v.pendingProps,ne=v.elementType===V?ne:ju(V,ne),Ht(p,v,V,ne,C);case 1:return V=v.type,ne=v.pendingProps,ne=v.elementType===V?ne:ju(V,ne),Ct(p,v,V,ne,C);case 3:e:{if(xn(v),p===null)throw Error(t(387));V=v.pendingProps,xe=v.memoizedState,ne=xe.element,Wn(p,v),Ai(v,V,null,C);var Je=v.memoizedState;if(V=Je.element,xe.isDehydrated)if(xe={element:V,isDehydrated:!1,cache:Je.cache,pendingSuspenseBoundaries:Je.pendingSuspenseBoundaries,transitions:Je.transitions},v.updateQueue.baseState=xe,v.memoizedState=xe,v.flags&256){ne=Lf(Error(t(423)),v),v=Gn(p,v,V,C,ne);break e}else if(V!==ne){ne=Lf(Error(t(424)),v),v=Gn(p,v,V,C,ne);break e}else for(m=Il(v.stateNode.containerInfo.firstChild),l=v,b=!0,I=null,C=yt(v,null,V,C),v.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling;else{if(Fe(),V===ne){v=Qi(p,v,C);break e}Me(p,v,V,C)}v=v.child}return v;case 5:return Bu(v),p===null&&Z(v),V=v.type,ne=v.pendingProps,xe=p!==null?p.memoizedProps:null,Je=ne.children,Gh(V,ne)?Je=null:xe!==null&&Gh(V,xe)&&(v.flags|=32),Lt(p,v),Me(p,v,Je,C),v.child;case 6:return p===null&&Z(v),null;case 13:return Tn(p,v,C);case 4:return wa(v,v.stateNode.containerInfo),V=v.pendingProps,p===null?v.child=gt(v,null,V,C):Me(p,v,V,C),v.child;case 11:return V=v.type,ne=v.pendingProps,ne=v.elementType===V?ne:ju(V,ne),Qe(p,v,V,ne,C);case 7:return Me(p,v,v.pendingProps,C),v.child;case 8:return Me(p,v,v.pendingProps.children,C),v.child;case 12:return Me(p,v,v.pendingProps.children,C),v.child;case 10:e:{if(V=v.type._context,ne=v.pendingProps,xe=v.memoizedProps,Je=ne.value,fs(Mt,V._currentValue),V._currentValue=Je,xe!==null)if(S(xe.value,Je)){if(xe.children===ne.children&&!vu.current){v=Qi(p,v,C);break e}}else for(xe=v.child,xe!==null&&(xe.return=v);xe!==null;){var Ft=xe.dependencies;if(Ft!==null){Je=xe.child;for(var Kt=Ft.firstContext;Kt!==null;){if(Kt.context===V){if(xe.tag===1){Kt=Nr(-1,C&-C),Kt.tag=2;var Nn=xe.updateQueue;if(Nn!==null){Nn=Nn.shared;var br=Nn.pending;br===null?Kt.next=Kt:(Kt.next=br.next,br.next=Kt),Nn.pending=Kt}}xe.lanes|=C,Kt=xe.alternate,Kt!==null&&(Kt.lanes|=C),Rn(xe.return,C,v),Ft.lanes|=C;break}Kt=Kt.next}}else if(xe.tag===10)Je=xe.type===v.type?null:xe.child;else if(xe.tag===18){if(Je=xe.return,Je===null)throw Error(t(341));Je.lanes|=C,Ft=Je.alternate,Ft!==null&&(Ft.lanes|=C),Rn(Je,C,v),Je=xe.sibling}else Je=xe.child;if(Je!==null)Je.return=xe;else for(Je=xe;Je!==null;){if(Je===v){Je=null;break}if(xe=Je.sibling,xe!==null){xe.return=Je.return,Je=xe;break}Je=Je.return}xe=Je}Me(p,v,ne.children,C),v=v.child}return v;case 9:return ne=v.type,V=v.pendingProps.children,Jt(v,C),ne=An(ne),V=V(ne),v.flags|=1,Me(p,v,V,C),v.child;case 14:return V=v.type,ne=ju(V,v.pendingProps),ne=ju(V.type,ne),ct(p,v,V,ne,C);case 15:return Xe(p,v,v.type,v.pendingProps,C);case 17:return V=v.type,ne=v.pendingProps,ne=v.elementType===V?ne:ju(V,ne),ci(p,v),v.tag=1,vl(V)?(p=!0,hu(v)):p=!1,Jt(v,C),vd(v,V,ne),Fp(v,V,ne,C),en(null,v,V,!0,p,C);case 19:return xi(p,v,C);case 22:return ot(p,v,C)}throw Error(t(156,v.tag))};function Rm(p,v){return Pa(p,v)}function i1(p,v,C,V){this.tag=p,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=v,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=V,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function cc(p,v,C,V){return new i1(p,v,C,V)}function fp(p){return p=p.prototype,!(!p||!p.isReactComponent)}function ob(p){if(typeof p=="function")return fp(p)?1:0;if(p!=null){if(p=p.$$typeof,p===J)return 11;if(p===De)return 14}return 2}function Sd(p,v){var C=p.alternate;return C===null?(C=cc(p.tag,v,p.key,p.mode),C.elementType=p.elementType,C.type=p.type,C.stateNode=p.stateNode,C.alternate=p,p.alternate=C):(C.pendingProps=v,C.type=p.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=p.flags&14680064,C.childLanes=p.childLanes,C.lanes=p.lanes,C.child=p.child,C.memoizedProps=p.memoizedProps,C.memoizedState=p.memoizedState,C.updateQueue=p.updateQueue,v=p.dependencies,C.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},C.sibling=p.sibling,C.index=p.index,C.ref=p.ref,C}function Fg(p,v,C,V,ne,xe){var Je=2;if(V=p,typeof p=="function")fp(p)&&(Je=1);else if(typeof p=="string")Je=5;else e:switch(p){case _e:return dp(C.children,ne,xe,v);case G:Je=8,ne|=8;break;case B:return p=cc(12,C,v,ne|2),p.elementType=B,p.lanes=xe,p;case te:return p=cc(13,C,v,ne),p.elementType=te,p.lanes=xe,p;case Se:return p=cc(19,C,v,ne),p.elementType=Se,p.lanes=xe,p;case Ue:return Bg(C,ne,xe,v);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case Y:Je=10;break e;case $:Je=9;break e;case J:Je=11;break e;case De:Je=14;break e;case $e:Je=16,V=null;break e}throw Error(t(130,p==null?p:typeof p,""))}return v=cc(Je,C,v,ne),v.elementType=p,v.type=V,v.lanes=xe,v}function dp(p,v,C,V){return p=cc(7,p,V,v),p.lanes=C,p}function Bg(p,v,C,V){return p=cc(22,p,V,v),p.elementType=Ue,p.lanes=C,p.stateNode={isHidden:!1},p}function h0(p,v,C){return p=cc(6,p,null,v),p.lanes=C,p}function f0(p,v,C){return v=cc(4,p.children!==null?p.children:[],p.key,v),v.lanes=C,v.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},v}function d0(p,v,C,V,ne){this.tag=v,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=$a(0),this.expirationTimes=$a(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$a(0),this.identifierPrefix=V,this.onRecoverableError=ne,this.mutableSourceEagerHydrationData=null}function p0(p,v,C,V,ne,xe,Je,Ft,Kt){return p=new d0(p,v,C,Ft,Kt),v===1?(v=1,xe===!0&&(v|=8)):v=0,xe=cc(3,null,null,v),p.current=xe,xe.stateNode=p,xe.memoizedState={element:V,isDehydrated:C,cache:null,transitions:null,pendingSuspenseBoundaries:null},In(xe),p}function Up(p,v,C){var V=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Be,key:V==null?null:""+V,children:p,containerInfo:v,implementation:C}}function s1(p){if(!p)return Ou;p=p._reactInternals;e:{if(ps(p)!==p||p.tag!==1)throw Error(t(170));var v=p;do{switch(v.tag){case 3:v=v.stateNode.context;break e;case 1:if(vl(v.type)){v=v.stateNode.__reactInternalMemoizedMergedChildContext;break e}}v=v.return}while(v!==null);throw Error(t(171))}if(p.tag===1){var C=p.type;if(vl(C))return xu(p,C,v)}return v}function Wl(p,v,C,V,ne,xe,Je,Ft,Kt){return p=p0(C,V,!0,p,ne,xe,Je,Ft,Kt),p.context=s1(null),C=p.current,V=th(),ne=Mf(C),xe=Nr(V,ne),xe.callback=v??null,ei(C,xe,ne),p.current.lanes=ne,Ri(p,ne,V),Bc(p,V),p}function pp(p,v,C,V){var ne=v.current,xe=th(),Je=Mf(ne);return C=s1(C),v.context===null?v.context=C:v.pendingContext=C,v=Nr(xe,Je),v.payload={element:p},V=V===void 0?null:V,V!==null&&(v.callback=V),p=ei(ne,v,Je),p!==null&&(gf(p,ne,Je,xe),Er(p,ne,Je)),Je}function Mm(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function Dm(p,v){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var C=p.retryLane;p.retryLane=C!==0&&C<v?C:v}}function Vp(p,v){Dm(p,v),(p=p.alternate)&&Dm(p,v)}function Om(){return null}var m0=typeof reportError=="function"?reportError:function(p){console.error(p)};function zg(p){this._internalRoot=p}Ed.prototype.render=zg.prototype.render=function(p){var v=this._internalRoot;if(v===null)throw Error(t(409));pp(p,v,null,null)},Ed.prototype.unmount=zg.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var v=p.containerInfo;bd(function(){pp(null,p,null,null)}),v[Cs]=null}};function Ed(p){this._internalRoot=p}Ed.prototype.unstable_scheduleHydration=function(p){if(p){var v=mu();p={blockedOn:null,target:p,priority:v};for(var C=0;C<Vs.length&&v!==0&&v<Vs[C].priority;C++);Vs.splice(C,0,p),C===0&&Es(p)}};function Fm(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function qp(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function jg(){}function ab(p,v,C,V,ne){if(ne){if(typeof V=="function"){var xe=V;V=function(){var Nn=Mm(Je);xe.call(Nn)}}var Je=Wl(v,V,p,0,null,!1,!1,"",jg);return p._reactRootContainer=Je,p[Cs]=Je.current,Mu(p.nodeType===8?p.parentNode:p),bd(),Je}for(;ne=p.lastChild;)p.removeChild(ne);if(typeof V=="function"){var Ft=V;V=function(){var Nn=Mm(Kt);Ft.call(Nn)}}var Kt=p0(p,0,!1,null,null,!1,!1,"",jg);return p._reactRootContainer=Kt,p[Cs]=Kt.current,Mu(p.nodeType===8?p.parentNode:p),bd(function(){pp(v,Kt,C,V)}),Kt}function Bm(p,v,C,V,ne){var xe=C._reactRootContainer;if(xe){var Je=xe;if(typeof ne=="function"){var Ft=ne;ne=function(){var Kt=Mm(Je);Ft.call(Kt)}}pp(v,Je,p,ne)}else Je=ab(C,v,p,ne,V);return Mm(Je)}ss=function(p){switch(p.tag){case 3:var v=p.stateNode;if(v.current.memoizedState.isDehydrated){var C=Ga(v.pendingLanes);C!==0&&(Tl(v,C|1),Bc(v,Ss()),(hi&6)===0&&(zp=Ss()+500,pe()))}break;case 13:bd(function(){var V=bn(p,1);if(V!==null){var ne=th();gf(V,p,1,ne)}}),Vp(p,1)}},$u=function(p){if(p.tag===13){var v=bn(p,134217728);if(v!==null){var C=th();gf(v,p,134217728,C)}Vp(p,134217728)}},lu=function(p){if(p.tag===13){var v=Mf(p),C=bn(p,v);if(C!==null){var V=th();gf(C,p,v,V)}Vp(p,v)}},mu=function(){return Wi},Us=function(p,v){var C=Wi;try{return Wi=p,v()}finally{Wi=C}},vt=function(p,v,C){switch(v){case"input":if(Fr(p,C),v=C.name,C.type==="radio"&&v!=null){for(C=p;C.parentNode;)C=C.parentNode;for(C=C.querySelectorAll("input[name="+JSON.stringify(""+v)+'][type="radio"]'),v=0;v<C.length;v++){var V=C[v];if(V!==p&&V.form===p.form){var ne=cf(V);if(!ne)throw Error(t(90));Ze(V),Fr(V,ne)}}}break;case"textarea":yn(p,C);break;case"select":v=C.value,v!=null&&dr(p,!!C.multiple,v,!1)}},Gt=jp,Tt=bd;var zm={usingClientEntryPoint:!1,Events:[yl,Xu,cf,wt,Ut,jp]},jm={findFiberByHostInstance:Vl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},g0={bundleType:jm.bundleType,version:jm.version,rendererPackageName:jm.rendererPackageName,rendererConfig:jm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:de.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=ua(p),p===null?null:p.stateNode},findFiberByHostInstance:jm.findFiberByHostInstance||Om,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ug=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ug.isDisabled&&Ug.supportsFiber)try{Wo=Ug.inject(g0),ta=Ug}catch{}}return sf.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zm,sf.createPortal=function(p,v){var C=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Fm(v))throw Error(t(200));return Up(p,v,null,C)},sf.createRoot=function(p,v){if(!Fm(p))throw Error(t(299));var C=!1,V="",ne=m0;return v!=null&&(v.unstable_strictMode===!0&&(C=!0),v.identifierPrefix!==void 0&&(V=v.identifierPrefix),v.onRecoverableError!==void 0&&(ne=v.onRecoverableError)),v=p0(p,1,!1,null,null,C,!1,V,ne),p[Cs]=v.current,Mu(p.nodeType===8?p.parentNode:p),new zg(v)},sf.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var v=p._reactInternals;if(v===void 0)throw typeof p.render=="function"?Error(t(188)):(p=Object.keys(p).join(","),Error(t(268,p)));return p=ua(v),p=p===null?null:p.stateNode,p},sf.flushSync=function(p){return bd(p)},sf.hydrate=function(p,v,C){if(!qp(v))throw Error(t(200));return Bm(null,p,v,!0,C)},sf.hydrateRoot=function(p,v,C){if(!Fm(p))throw Error(t(405));var V=C!=null&&C.hydratedSources||null,ne=!1,xe="",Je=m0;if(C!=null&&(C.unstable_strictMode===!0&&(ne=!0),C.identifierPrefix!==void 0&&(xe=C.identifierPrefix),C.onRecoverableError!==void 0&&(Je=C.onRecoverableError)),v=Wl(v,null,p,1,C??null,ne,!1,xe,Je),p[Cs]=v.current,Mu(p),V)for(p=0;p<V.length;p++)C=V[p],ne=C._getVersion,ne=ne(C._source),v.mutableSourceEagerHydrationData==null?v.mutableSourceEagerHydrationData=[C,ne]:v.mutableSourceEagerHydrationData.push(C,ne);return new Ed(v)},sf.render=function(p,v,C){if(!qp(v))throw Error(t(200));return Bm(null,p,v,!1,C)},sf.unmountComponentAtNode=function(p){if(!qp(p))throw Error(t(40));return p._reactRootContainer?(bd(function(){Bm(null,null,p,!1,function(){p._reactRootContainer=null,p[Cs]=null})}),!0):!1},sf.unstable_batchedUpdates=jp,sf.unstable_renderSubtreeIntoContainer=function(p,v,C,V){if(!qp(C))throw Error(t(200));if(p==null||p._reactInternals===void 0)throw Error(t(38));return Bm(p,v,C,!1,V)},sf.version="18.3.1-next-f1338f8080-20240426",sf}var lS;function lP(){if(lS)return jb.exports;lS=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),jb.exports=aP(),jb.exports}var uS;function uP(){if(uS)return A1;uS=1;var n=lP();return A1.createRoot=n.createRoot,A1.hydrateRoot=n.hydrateRoot,A1}var cP=uP();const hP=M_(cP);/**
 * react-router v7.8.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var cS="popstate";function fP(n={}){function e(i,a){let{pathname:c,search:_,hash:y}=i.location;return Kw("",{pathname:c,search:_,hash:y},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function t(i,a){return typeof a=="string"?a:v_(a)}return pP(e,t,null,n)}function ku(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Yd(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function dP(){return Math.random().toString(36).substring(2,10)}function hS(n,e){return{usr:n.state,key:n.key,idx:e}}function Kw(n,e,t=null,i){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?Hy(e):e,state:t,key:e&&e.key||i||dP()}}function v_({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function Hy(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substring(i),n=n.substring(0,i)),n&&(e.pathname=n)}return e}function pP(n,e,t,i={}){let{window:a=document.defaultView,v5Compat:c=!1}=i,_=a.history,y="POP",s=null,T=L();T==null&&(T=0,_.replaceState({..._.state,idx:T},""));function L(){return(_.state||{idx:null}).idx}function R(){y="POP";let ye=L(),ie=ye==null?null:ye-T;T=ye,s&&s({action:y,location:ae.location,delta:ie})}function U(ye,ie){y="PUSH";let oe=Kw(ae.location,ye,ie);T=L()+1;let ve=hS(oe,T),de=ae.createHref(oe);try{_.pushState(ve,"",de)}catch(Pe){if(Pe instanceof DOMException&&Pe.name==="DataCloneError")throw Pe;a.location.assign(de)}c&&s&&s({action:y,location:ae.location,delta:1})}function M(ye,ie){y="REPLACE";let oe=Kw(ae.location,ye,ie);T=L();let ve=hS(oe,T),de=ae.createHref(oe);_.replaceState(ve,"",de),c&&s&&s({action:y,location:ae.location,delta:0})}function Q(ye){return mP(ye)}let ae={get action(){return y},get location(){return n(a,_)},listen(ye){if(s)throw new Error("A history only accepts one active listener");return a.addEventListener(cS,R),s=ye,()=>{a.removeEventListener(cS,R),s=null}},createHref(ye){return e(a,ye)},createURL:Q,encodeLocation(ye){let ie=Q(ye);return{pathname:ie.pathname,search:ie.search,hash:ie.hash}},push:U,replace:M,go(ye){return _.go(ye)}};return ae}function mP(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),ku(t,"No window.location.(origin|href) available to create URL");let i=typeof n=="string"?n:v_(n);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=t+i),new URL(i,t)}function UI(n,e,t="/"){return gP(n,e,t,!1)}function gP(n,e,t,i){let a=typeof e=="string"?Hy(e):e,c=Lp(a.pathname||"/",t);if(c==null)return null;let _=VI(n);yP(_);let y=null;for(let s=0;y==null&&s<_.length;++s){let T=CP(c);y=AP(_[s],T,i)}return y}function VI(n,e=[],t=[],i="",a=!1){let c=(_,y,s=a,T)=>{let L={relativePath:T===void 0?_.path||"":T,caseSensitive:_.caseSensitive===!0,childrenIndex:y,route:_};if(L.relativePath.startsWith("/")){if(!L.relativePath.startsWith(i)&&s)return;ku(L.relativePath.startsWith(i),`Absolute route path "${L.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),L.relativePath=L.relativePath.slice(i.length)}let R=Ap([i,L.relativePath]),U=t.concat(L);_.children&&_.children.length>0&&(ku(_.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${R}".`),VI(_.children,e,U,R,s)),!(_.path==null&&!_.index)&&e.push({path:R,score:EP(R,_.index),routesMeta:U})};return n.forEach((_,y)=>{if(_.path===""||!_.path?.includes("?"))c(_,y);else for(let s of qI(_.path))c(_,y,!0,s)}),e}function qI(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,a=t.endsWith("?"),c=t.replace(/\?$/,"");if(i.length===0)return a?[c,""]:[c];let _=qI(i.join("/")),y=[];return y.push(..._.map(s=>s===""?c:[c,s].join("/"))),a&&y.push(..._),y.map(s=>n.startsWith("/")&&s===""?"/":s)}function yP(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:TP(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var _P=/^:[\w-]+$/,vP=3,xP=2,bP=1,wP=10,SP=-2,fS=n=>n==="*";function EP(n,e){let t=n.split("/"),i=t.length;return t.some(fS)&&(i+=SP),e&&(i+=xP),t.filter(a=>!fS(a)).reduce((a,c)=>a+(_P.test(c)?vP:c===""?bP:wP),i)}function TP(n,e){return n.length===e.length&&n.slice(0,-1).every((i,a)=>i===e[a])?n[n.length-1]-e[e.length-1]:0}function AP(n,e,t=!1){let{routesMeta:i}=n,a={},c="/",_=[];for(let y=0;y<i.length;++y){let s=i[y],T=y===i.length-1,L=c==="/"?e:e.slice(c.length)||"/",R=Ov({path:s.relativePath,caseSensitive:s.caseSensitive,end:T},L),U=s.route;if(!R&&T&&t&&!i[i.length-1].route.index&&(R=Ov({path:s.relativePath,caseSensitive:s.caseSensitive,end:!1},L)),!R)return null;Object.assign(a,R.params),_.push({params:a,pathname:Ap([c,R.pathname]),pathnameBase:NP(Ap([c,R.pathnameBase])),route:U}),R.pathnameBase!=="/"&&(c=Ap([c,R.pathnameBase]))}return _}function Ov(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=IP(n.path,n.caseSensitive,n.end),a=e.match(t);if(!a)return null;let c=a[0],_=c.replace(/(.)\/+$/,"$1"),y=a.slice(1);return{params:i.reduce((T,{paramName:L,isOptional:R},U)=>{if(L==="*"){let Q=y[U]||"";_=c.slice(0,c.length-Q.length).replace(/(.)\/+$/,"$1")}const M=y[U];return R&&!M?T[L]=void 0:T[L]=(M||"").replace(/%2F/g,"/"),T},{}),pathname:c,pathnameBase:_,pattern:n}}function IP(n,e=!1,t=!0){Yd(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let i=[],a="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(_,y,s)=>(i.push({paramName:y,isOptional:s!=null}),s?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(i.push({paramName:"*"}),a+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?a+="\\/*$":n!==""&&n!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),i]}function CP(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Yd(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Lp(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}function kP(n,e="/"){let{pathname:t,search:i="",hash:a=""}=typeof n=="string"?Hy(n):n;return{pathname:t?t.startsWith("/")?t:LP(t,e):e,search:RP(i),hash:MP(a)}}function LP(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(a=>{a===".."?t.length>1&&t.pop():a!=="."&&t.push(a)}),t.length>1?t.join("/"):"/"}function qb(n,e,t,i){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function PP(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function GI(n){let e=PP(n);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function $I(n,e,t,i=!1){let a;typeof n=="string"?a=Hy(n):(a={...n},ku(!a.pathname||!a.pathname.includes("?"),qb("?","pathname","search",a)),ku(!a.pathname||!a.pathname.includes("#"),qb("#","pathname","hash",a)),ku(!a.search||!a.search.includes("#"),qb("#","search","hash",a)));let c=n===""||a.pathname==="",_=c?"/":a.pathname,y;if(_==null)y=t;else{let R=e.length-1;if(!i&&_.startsWith("..")){let U=_.split("/");for(;U[0]==="..";)U.shift(),R-=1;a.pathname=U.join("/")}y=R>=0?e[R]:"/"}let s=kP(a,y),T=_&&_!=="/"&&_.endsWith("/"),L=(c||_===".")&&t.endsWith("/");return!s.pathname.endsWith("/")&&(T||L)&&(s.pathname+="/"),s}var Ap=n=>n.join("/").replace(/\/\/+/g,"/"),NP=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),RP=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,MP=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function DP(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var HI=["POST","PUT","PATCH","DELETE"];new Set(HI);var OP=["GET",...HI];new Set(OP);var Wy=tr.createContext(null);Wy.displayName="DataRouter";var Cx=tr.createContext(null);Cx.displayName="DataRouterState";tr.createContext(!1);var WI=tr.createContext({isTransitioning:!1});WI.displayName="ViewTransition";var FP=tr.createContext(new Map);FP.displayName="Fetchers";var BP=tr.createContext(null);BP.displayName="Await";var Qd=tr.createContext(null);Qd.displayName="Navigation";var D_=tr.createContext(null);D_.displayName="Location";var ep=tr.createContext({outlet:null,matches:[],isDataRoute:!1});ep.displayName="Route";var e3=tr.createContext(null);e3.displayName="RouteError";function zP(n,{relative:e}={}){ku(O_(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=tr.useContext(Qd),{hash:a,pathname:c,search:_}=F_(n,{relative:e}),y=c;return t!=="/"&&(y=c==="/"?t:Ap([t,c])),i.createHref({pathname:y,search:_,hash:a})}function O_(){return tr.useContext(D_)!=null}function bg(){return ku(O_(),"useLocation() may be used only in the context of a <Router> component."),tr.useContext(D_).location}var XI="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function YI(n){tr.useContext(Qd).static||tr.useLayoutEffect(n)}function jP(){let{isDataRoute:n}=tr.useContext(ep);return n?eN():UP()}function UP(){ku(O_(),"useNavigate() may be used only in the context of a <Router> component.");let n=tr.useContext(Wy),{basename:e,navigator:t}=tr.useContext(Qd),{matches:i}=tr.useContext(ep),{pathname:a}=bg(),c=JSON.stringify(GI(i)),_=tr.useRef(!1);return YI(()=>{_.current=!0}),tr.useCallback((s,T={})=>{if(Yd(_.current,XI),!_.current)return;if(typeof s=="number"){t.go(s);return}let L=$I(s,JSON.parse(c),a,T.relative==="path");n==null&&e!=="/"&&(L.pathname=L.pathname==="/"?e:Ap([e,L.pathname])),(T.replace?t.replace:t.push)(L,T.state,T)},[e,t,c,a,n])}tr.createContext(null);function VP(){let{matches:n}=tr.useContext(ep),e=n[n.length-1];return e?e.params:{}}function F_(n,{relative:e}={}){let{matches:t}=tr.useContext(ep),{pathname:i}=bg(),a=JSON.stringify(GI(t));return tr.useMemo(()=>$I(n,JSON.parse(a),i,e==="path"),[n,a,i,e])}function qP(n,e){return KI(n,e)}function KI(n,e,t,i){ku(O_(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a}=tr.useContext(Qd),{matches:c}=tr.useContext(ep),_=c[c.length-1],y=_?_.params:{},s=_?_.pathname:"/",T=_?_.pathnameBase:"/",L=_&&_.route;{let ie=L&&L.path||"";ZI(s,!L||ie.endsWith("*")||ie.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${s}" (under <Route path="${ie}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ie}"> to <Route path="${ie==="/"?"*":`${ie}/*`}">.`)}let R=bg(),U;if(e){let ie=typeof e=="string"?Hy(e):e;ku(T==="/"||ie.pathname?.startsWith(T),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${T}" but pathname "${ie.pathname}" was given in the \`location\` prop.`),U=ie}else U=R;let M=U.pathname||"/",Q=M;if(T!=="/"){let ie=T.replace(/^\//,"").split("/");Q="/"+M.replace(/^\//,"").split("/").slice(ie.length).join("/")}let ae=UI(n,{pathname:Q});Yd(L||ae!=null,`No routes matched location "${U.pathname}${U.search}${U.hash}" `),Yd(ae==null||ae[ae.length-1].route.element!==void 0||ae[ae.length-1].route.Component!==void 0||ae[ae.length-1].route.lazy!==void 0,`Matched leaf route at location "${U.pathname}${U.search}${U.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let ye=XP(ae&&ae.map(ie=>Object.assign({},ie,{params:Object.assign({},y,ie.params),pathname:Ap([T,a.encodeLocation?a.encodeLocation(ie.pathname).pathname:ie.pathname]),pathnameBase:ie.pathnameBase==="/"?T:Ap([T,a.encodeLocation?a.encodeLocation(ie.pathnameBase).pathname:ie.pathnameBase])})),c,t,i);return e&&ye?tr.createElement(D_.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...U},navigationType:"POP"}},ye):ye}function GP(){let n=QP(),e=DP(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:i},c={padding:"2px 4px",backgroundColor:i},_=null;return console.error("Error handled by React Router default ErrorBoundary:",n),_=tr.createElement(tr.Fragment,null,tr.createElement("p",null," Hey developer "),tr.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",tr.createElement("code",{style:c},"ErrorBoundary")," or"," ",tr.createElement("code",{style:c},"errorElement")," prop on your route.")),tr.createElement(tr.Fragment,null,tr.createElement("h2",null,"Unexpected Application Error!"),tr.createElement("h3",{style:{fontStyle:"italic"}},e),t?tr.createElement("pre",{style:a},t):null,_)}var $P=tr.createElement(GP,null),HP=class extends tr.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?tr.createElement(ep.Provider,{value:this.props.routeContext},tr.createElement(e3.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function WP({routeContext:n,match:e,children:t}){let i=tr.useContext(Wy);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),tr.createElement(ep.Provider,{value:n},t)}function XP(n,e=[],t=null,i=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let a=n,c=t?.errors;if(c!=null){let s=a.findIndex(T=>T.route.id&&c?.[T.route.id]!==void 0);ku(s>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),a=a.slice(0,Math.min(a.length,s+1))}let _=!1,y=-1;if(t)for(let s=0;s<a.length;s++){let T=a[s];if((T.route.HydrateFallback||T.route.hydrateFallbackElement)&&(y=s),T.route.id){let{loaderData:L,errors:R}=t,U=T.route.loader&&!L.hasOwnProperty(T.route.id)&&(!R||R[T.route.id]===void 0);if(T.route.lazy||U){_=!0,y>=0?a=a.slice(0,y+1):a=[a[0]];break}}}return a.reduceRight((s,T,L)=>{let R,U=!1,M=null,Q=null;t&&(R=c&&T.route.id?c[T.route.id]:void 0,M=T.route.errorElement||$P,_&&(y<0&&L===0?(ZI("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),U=!0,Q=null):y===L&&(U=!0,Q=T.route.hydrateFallbackElement||null)));let ae=e.concat(a.slice(0,L+1)),ye=()=>{let ie;return R?ie=M:U?ie=Q:T.route.Component?ie=tr.createElement(T.route.Component,null):T.route.element?ie=T.route.element:ie=s,tr.createElement(WP,{match:T,routeContext:{outlet:s,matches:ae,isDataRoute:t!=null},children:ie})};return t&&(T.route.ErrorBoundary||T.route.errorElement||L===0)?tr.createElement(HP,{location:t.location,revalidation:t.revalidation,component:M,error:R,children:ye(),routeContext:{outlet:null,matches:ae,isDataRoute:!0}}):ye()},null)}function t3(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function YP(n){let e=tr.useContext(Wy);return ku(e,t3(n)),e}function KP(n){let e=tr.useContext(Cx);return ku(e,t3(n)),e}function ZP(n){let e=tr.useContext(ep);return ku(e,t3(n)),e}function n3(n){let e=ZP(n),t=e.matches[e.matches.length-1];return ku(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function JP(){return n3("useRouteId")}function QP(){let n=tr.useContext(e3),e=KP("useRouteError"),t=n3("useRouteError");return n!==void 0?n:e.errors?.[t]}function eN(){let{router:n}=YP("useNavigate"),e=n3("useNavigate"),t=tr.useRef(!1);return YI(()=>{t.current=!0}),tr.useCallback(async(a,c={})=>{Yd(t.current,XI),t.current&&(typeof a=="number"?n.navigate(a):await n.navigate(a,{fromRouteId:e,...c}))},[n,e])}var dS={};function ZI(n,e,t){!e&&!dS[n]&&(dS[n]=!0,Yd(!1,t))}tr.memo(tN);function tN({routes:n,future:e,state:t}){return KI(n,void 0,t,e)}function Km(n){ku(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function nN({basename:n="/",children:e=null,location:t,navigationType:i="POP",navigator:a,static:c=!1}){ku(!O_(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let _=n.replace(/^\/*/,"/"),y=tr.useMemo(()=>({basename:_,navigator:a,static:c,future:{}}),[_,a,c]);typeof t=="string"&&(t=Hy(t));let{pathname:s="/",search:T="",hash:L="",state:R=null,key:U="default"}=t,M=tr.useMemo(()=>{let Q=Lp(s,_);return Q==null?null:{location:{pathname:Q,search:T,hash:L,state:R,key:U},navigationType:i}},[_,s,T,L,R,U,i]);return Yd(M!=null,`<Router basename="${_}"> is not able to match the URL "${s}${T}${L}" because it does not start with the basename, so the <Router> won't render anything.`),M==null?null:tr.createElement(Qd.Provider,{value:y},tr.createElement(D_.Provider,{children:e,value:M}))}function rN({children:n,location:e}){return qP(Zw(n),e)}function Zw(n,e=[]){let t=[];return tr.Children.forEach(n,(i,a)=>{if(!tr.isValidElement(i))return;let c=[...e,a];if(i.type===tr.Fragment){t.push.apply(t,Zw(i.props.children,c));return}ku(i.type===Km,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ku(!i.props.index||!i.props.children,"An index route cannot have child routes.");let _={id:i.props.id||c.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(_.children=Zw(i.props.children,c)),t.push(_)}),t}var iv="get",sv="application/x-www-form-urlencoded";function kx(n){return n!=null&&typeof n.tagName=="string"}function iN(n){return kx(n)&&n.tagName.toLowerCase()==="button"}function sN(n){return kx(n)&&n.tagName.toLowerCase()==="form"}function oN(n){return kx(n)&&n.tagName.toLowerCase()==="input"}function aN(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function lN(n,e){return n.button===0&&(!e||e==="_self")&&!aN(n)}var I1=null;function uN(){if(I1===null)try{new FormData(document.createElement("form"),0),I1=!1}catch{I1=!0}return I1}var cN=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Gb(n){return n!=null&&!cN.has(n)?(Yd(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${sv}"`),null):n}function hN(n,e){let t,i,a,c,_;if(sN(n)){let y=n.getAttribute("action");i=y?Lp(y,e):null,t=n.getAttribute("method")||iv,a=Gb(n.getAttribute("enctype"))||sv,c=new FormData(n)}else if(iN(n)||oN(n)&&(n.type==="submit"||n.type==="image")){let y=n.form;if(y==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let s=n.getAttribute("formaction")||y.getAttribute("action");if(i=s?Lp(s,e):null,t=n.getAttribute("formmethod")||y.getAttribute("method")||iv,a=Gb(n.getAttribute("formenctype"))||Gb(y.getAttribute("enctype"))||sv,c=new FormData(y,n),!uN()){let{name:T,type:L,value:R}=n;if(L==="image"){let U=T?`${T}.`:"";c.append(`${U}x`,"0"),c.append(`${U}y`,"0")}else T&&c.append(T,R)}}else{if(kx(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=iv,i=null,a=sv,_=n}return c&&a==="text/plain"&&(_=c,c=void 0),{action:i,method:t.toLowerCase(),encType:a,formData:c,body:_}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function r3(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function fN(n,e,t){let i=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return i.pathname==="/"?i.pathname=`_root.${t}`:e&&Lp(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${t}`,i}async function dN(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function pN(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function mN(n,e,t){let i=await Promise.all(n.map(async a=>{let c=e.routes[a.route.id];if(c){let _=await dN(c,t);return _.links?_.links():[]}return[]}));return vN(i.flat(1).filter(pN).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function pS(n,e,t,i,a,c){let _=(s,T)=>t[T]?s.route.id!==t[T].route.id:!0,y=(s,T)=>t[T].pathname!==s.pathname||t[T].route.path?.endsWith("*")&&t[T].params["*"]!==s.params["*"];return c==="assets"?e.filter((s,T)=>_(s,T)||y(s,T)):c==="data"?e.filter((s,T)=>{let L=i.routes[s.route.id];if(!L||!L.hasLoader)return!1;if(_(s,T)||y(s,T))return!0;if(s.route.shouldRevalidate){let R=s.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:s.params,defaultShouldRevalidate:!0});if(typeof R=="boolean")return R}return!0}):[]}function gN(n,e,{includeHydrateFallback:t}={}){return yN(n.map(i=>{let a=e.routes[i.route.id];if(!a)return[];let c=[a.module];return a.clientActionModule&&(c=c.concat(a.clientActionModule)),a.clientLoaderModule&&(c=c.concat(a.clientLoaderModule)),t&&a.hydrateFallbackModule&&(c=c.concat(a.hydrateFallbackModule)),a.imports&&(c=c.concat(a.imports)),c}).flat(1))}function yN(n){return[...new Set(n)]}function _N(n){let e={},t=Object.keys(n).sort();for(let i of t)e[i]=n[i];return e}function vN(n,e){let t=new Set;return new Set(e),n.reduce((i,a)=>{let c=JSON.stringify(_N(a));return t.has(c)||(t.add(c),i.push({key:c,link:a})),i},[])}function JI(){let n=tr.useContext(Wy);return r3(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function xN(){let n=tr.useContext(Cx);return r3(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var i3=tr.createContext(void 0);i3.displayName="FrameworkContext";function QI(){let n=tr.useContext(i3);return r3(n,"You must render this element inside a <HydratedRouter> element"),n}function bN(n,e){let t=tr.useContext(i3),[i,a]=tr.useState(!1),[c,_]=tr.useState(!1),{onFocus:y,onBlur:s,onMouseEnter:T,onMouseLeave:L,onTouchStart:R}=e,U=tr.useRef(null);tr.useEffect(()=>{if(n==="render"&&_(!0),n==="viewport"){let ae=ie=>{ie.forEach(oe=>{_(oe.isIntersecting)})},ye=new IntersectionObserver(ae,{threshold:.5});return U.current&&ye.observe(U.current),()=>{ye.disconnect()}}},[n]),tr.useEffect(()=>{if(i){let ae=setTimeout(()=>{_(!0)},100);return()=>{clearTimeout(ae)}}},[i]);let M=()=>{a(!0)},Q=()=>{a(!1),_(!1)};return t?n!=="intent"?[c,U,{}]:[c,U,{onFocus:D0(y,M),onBlur:D0(s,Q),onMouseEnter:D0(T,M),onMouseLeave:D0(L,Q),onTouchStart:D0(R,M)}]:[!1,U,{}]}function D0(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function wN({page:n,...e}){let{router:t}=JI(),i=tr.useMemo(()=>UI(t.routes,n,t.basename),[t.routes,n,t.basename]);return i?tr.createElement(EN,{page:n,matches:i,...e}):null}function SN(n){let{manifest:e,routeModules:t}=QI(),[i,a]=tr.useState([]);return tr.useEffect(()=>{let c=!1;return mN(n,e,t).then(_=>{c||a(_)}),()=>{c=!0}},[n,e,t]),i}function EN({page:n,matches:e,...t}){let i=bg(),{manifest:a,routeModules:c}=QI(),{basename:_}=JI(),{loaderData:y,matches:s}=xN(),T=tr.useMemo(()=>pS(n,e,s,a,i,"data"),[n,e,s,a,i]),L=tr.useMemo(()=>pS(n,e,s,a,i,"assets"),[n,e,s,a,i]),R=tr.useMemo(()=>{if(n===i.pathname+i.search+i.hash)return[];let Q=new Set,ae=!1;if(e.forEach(ie=>{let oe=a.routes[ie.route.id];!oe||!oe.hasLoader||(!T.some(ve=>ve.route.id===ie.route.id)&&ie.route.id in y&&c[ie.route.id]?.shouldRevalidate||oe.hasClientLoader?ae=!0:Q.add(ie.route.id))}),Q.size===0)return[];let ye=fN(n,_,"data");return ae&&Q.size>0&&ye.searchParams.set("_routes",e.filter(ie=>Q.has(ie.route.id)).map(ie=>ie.route.id).join(",")),[ye.pathname+ye.search]},[_,y,i,a,T,e,n,c]),U=tr.useMemo(()=>gN(L,a),[L,a]),M=SN(L);return tr.createElement(tr.Fragment,null,R.map(Q=>tr.createElement("link",{key:Q,rel:"prefetch",as:"fetch",href:Q,...t})),U.map(Q=>tr.createElement("link",{key:Q,rel:"modulepreload",href:Q,...t})),M.map(({key:Q,link:ae})=>tr.createElement("link",{key:Q,nonce:t.nonce,...ae})))}function TN(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var eC=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{eC&&(window.__reactRouterVersion="7.8.1")}catch{}function AN({basename:n,children:e,window:t}){let i=tr.useRef();i.current==null&&(i.current=fP({window:t,v5Compat:!0}));let a=i.current,[c,_]=tr.useState({action:a.action,location:a.location}),y=tr.useCallback(s=>{tr.startTransition(()=>_(s))},[_]);return tr.useLayoutEffect(()=>a.listen(y),[a,y]),tr.createElement(nN,{basename:n,children:e,location:c.location,navigationType:c.action,navigator:a})}var tC=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,nC=tr.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:a,reloadDocument:c,replace:_,state:y,target:s,to:T,preventScrollReset:L,viewTransition:R,...U},M){let{basename:Q}=tr.useContext(Qd),ae=typeof T=="string"&&tC.test(T),ye,ie=!1;if(typeof T=="string"&&ae&&(ye=T,eC))try{let B=new URL(window.location.href),Y=T.startsWith("//")?new URL(B.protocol+T):new URL(T),$=Lp(Y.pathname,Q);Y.origin===B.origin&&$!=null?T=$+Y.search+Y.hash:ie=!0}catch{Yd(!1,`<Link to="${T}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let oe=zP(T,{relative:a}),[ve,de,Pe]=bN(i,U),Be=LN(T,{replace:_,state:y,target:s,preventScrollReset:L,relative:a,viewTransition:R});function _e(B){e&&e(B),B.defaultPrevented||Be(B)}let G=tr.createElement("a",{...U,...Pe,href:ye||oe,onClick:ie||c?e:_e,ref:TN(M,de),target:s,"data-discover":!ae&&t==="render"?"true":void 0});return ve&&!ae?tr.createElement(tr.Fragment,null,G,tr.createElement(wN,{page:oe})):G});nC.displayName="Link";var IN=tr.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:a=!1,style:c,to:_,viewTransition:y,children:s,...T},L){let R=F_(_,{relative:T.relative}),U=bg(),M=tr.useContext(Cx),{navigator:Q,basename:ae}=tr.useContext(Qd),ye=M!=null&&DN(R)&&y===!0,ie=Q.encodeLocation?Q.encodeLocation(R).pathname:R.pathname,oe=U.pathname,ve=M&&M.navigation&&M.navigation.location?M.navigation.location.pathname:null;t||(oe=oe.toLowerCase(),ve=ve?ve.toLowerCase():null,ie=ie.toLowerCase()),ve&&ae&&(ve=Lp(ve,ae)||ve);const de=ie!=="/"&&ie.endsWith("/")?ie.length-1:ie.length;let Pe=oe===ie||!a&&oe.startsWith(ie)&&oe.charAt(de)==="/",Be=ve!=null&&(ve===ie||!a&&ve.startsWith(ie)&&ve.charAt(ie.length)==="/"),_e={isActive:Pe,isPending:Be,isTransitioning:ye},G=Pe?e:void 0,B;typeof i=="function"?B=i(_e):B=[i,Pe?"active":null,Be?"pending":null,ye?"transitioning":null].filter(Boolean).join(" ");let Y=typeof c=="function"?c(_e):c;return tr.createElement(nC,{...T,"aria-current":G,className:B,ref:L,style:Y,to:_,viewTransition:y},typeof s=="function"?s(_e):s)});IN.displayName="NavLink";var CN=tr.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:a,state:c,method:_=iv,action:y,onSubmit:s,relative:T,preventScrollReset:L,viewTransition:R,...U},M)=>{let Q=RN(),ae=MN(y,{relative:T}),ye=_.toLowerCase()==="get"?"get":"post",ie=typeof y=="string"&&tC.test(y),oe=ve=>{if(s&&s(ve),ve.defaultPrevented)return;ve.preventDefault();let de=ve.nativeEvent.submitter,Pe=de?.getAttribute("formmethod")||_;Q(de||ve.currentTarget,{fetcherKey:e,method:Pe,navigate:t,replace:a,state:c,relative:T,preventScrollReset:L,viewTransition:R})};return tr.createElement("form",{ref:M,method:ye,action:ae,onSubmit:i?s:oe,...U,"data-discover":!ie&&n==="render"?"true":void 0})});CN.displayName="Form";function kN(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function rC(n){let e=tr.useContext(Wy);return ku(e,kN(n)),e}function LN(n,{target:e,replace:t,state:i,preventScrollReset:a,relative:c,viewTransition:_}={}){let y=jP(),s=bg(),T=F_(n,{relative:c});return tr.useCallback(L=>{if(lN(L,e)){L.preventDefault();let R=t!==void 0?t:v_(s)===v_(T);y(n,{replace:R,state:i,preventScrollReset:a,relative:c,viewTransition:_})}},[s,y,T,t,i,e,n,a,c,_])}var PN=0,NN=()=>`__${String(++PN)}__`;function RN(){let{router:n}=rC("useSubmit"),{basename:e}=tr.useContext(Qd),t=JP();return tr.useCallback(async(i,a={})=>{let{action:c,method:_,encType:y,formData:s,body:T}=hN(i,e);if(a.navigate===!1){let L=a.fetcherKey||NN();await n.fetch(L,t,a.action||c,{preventScrollReset:a.preventScrollReset,formData:s,body:T,formMethod:a.method||_,formEncType:a.encType||y,flushSync:a.flushSync})}else await n.navigate(a.action||c,{preventScrollReset:a.preventScrollReset,formData:s,body:T,formMethod:a.method||_,formEncType:a.encType||y,replace:a.replace,state:a.state,fromRouteId:t,flushSync:a.flushSync,viewTransition:a.viewTransition})},[n,e,t])}function MN(n,{relative:e}={}){let{basename:t}=tr.useContext(Qd),i=tr.useContext(ep);ku(i,"useFormAction must be used inside a RouteContext");let[a]=i.matches.slice(-1),c={...F_(n||".",{relative:e})},_=bg();if(n==null){c.search=_.search;let y=new URLSearchParams(c.search),s=y.getAll("index");if(s.some(L=>L==="")){y.delete("index"),s.filter(R=>R).forEach(R=>y.append("index",R));let L=y.toString();c.search=L?`?${L}`:""}}return(!n||n===".")&&a.route.index&&(c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(c.pathname=c.pathname==="/"?t:Ap([t,c.pathname])),v_(c)}function DN(n,{relative:e}={}){let t=tr.useContext(WI);ku(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=rC("useViewTransitionState"),a=F_(n,{relative:e});if(!t.isTransitioning)return!1;let c=Lp(t.currentLocation.pathname,i)||t.currentLocation.pathname,_=Lp(t.nextLocation.pathname,i)||t.nextLocation.pathname;return Ov(a.pathname,_)!=null||Ov(a.pathname,c)!=null}var ov={exports:{}},ON=ov.exports,mS;function FN(){return mS||(mS=1,(function(n,e){var t={};(function(i,a){n.exports=a()})(ON,(function(){var i,a,c;function _(s,T){if(!i)i=T;else if(!a)a=T;else{var L="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+a+")(sharedChunk); self.onerror = null;",R={};i(R),c=T(R),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(c.workerUrl=window.URL.createObjectURL(new Blob([L],{type:"text/javascript"})))}}_(["exports"],(function(s){var T=typeof self<"u"?self:{},L="2.15.0";let R;const U={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(R==null){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{R=t.API_URL_REGEX!=null?new RegExp(t.API_URL_REGEX):o}catch{R=o}}return R},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!U.API_URL)return null;try{const o=new URL(U.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},M={supported:!1,testSupport:function(o){!ye&&ae&&(ie?oe(o):Q=o)}};let Q,ae,ye=!1,ie=!1;function oe(o){const r=o.createTexture();o.bindTexture(o.TEXTURE_2D,r);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,ae),o.isContextLost())return;M.supported=!0}catch{}o.deleteTexture(r),ye=!0}T.document&&(ae=T.document.createElement("img"),ae.onload=function(){Q&&oe(Q),Q=null,ie=!0},ae.onerror=function(){ye=!0,Q=null},ae.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ve="01";function de(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Pe=Be;function Be(o,r,u,h){this.cx=3*o,this.bx=3*(u-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=r,this.p2x=u,this.p2y=h}Be.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,r){if(r===void 0&&(r=1e-6),o<0)return 0;if(o>1)return 1;for(var u=o,h=0;h<8;h++){var g=this.sampleCurveX(u)-o;if(Math.abs(g)<r)return u;var w=this.sampleCurveDerivativeX(u);if(Math.abs(w)<1e-6)break;u-=g/w}var A=0,k=1;for(u=o,h=0;h<20&&(g=this.sampleCurveX(u),!(Math.abs(g-o)<r));h++)o>g?A=u:k=u,u=.5*(k-A)+A;return u},solve:function(o,r){return this.sampleCurveY(this.solveCurveX(o,r))}};var _e=de(Pe),G=B;function B(o,r){this.x=o,this.y=r}B.prototype={clone:function(){return new B(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,r){return this.clone()._rotateAround(o,r)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var r=o.x-this.x,u=o.y-this.y;return r*r+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,r){return Math.atan2(this.x*r-this.y*o,this.x*o+this.y*r)},_matMult:function(o){var r=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=r,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var r=Math.cos(o),u=Math.sin(o),h=u*this.x+r*this.y;return this.x=r*this.x-u*this.y,this.y=h,this},_rotateAround:function(o,r){var u=Math.cos(o),h=Math.sin(o),g=r.y+h*(this.x-r.x)+u*(this.y-r.y);return this.x=r.x+u*(this.x-r.x)-h*(this.y-r.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},B.convert=function(o){return o instanceof B?o:Array.isArray(o)?new B(o[0],o[1]):o};var Y=de(G);const $=Math.PI/180,J=180/Math.PI;function te(o){return o*$}function Se(o){return o*J}const De=[[0,0],[1,0],[1,1],[0,1]];function $e(o){if(o<=0)return 0;if(o>=1)return 1;const r=o*o,u=r*o;return 4*(o<.5?u:3*(o-r)+u-.75)}function Ue(o,r,u,h){const g=new _e(o,r,u,h);return function(w){return g.solve(w)}}const Le=Ue(.25,.1,.25,1);function He(o,r,u){return Math.min(u,Math.max(r,o))}function Ke(o,r,u){return(u=He((u-o)/(r-o),0,1))*u*(3-2*u)}function Ce(o,r,u){const h=u-r,g=((o-r)%h+h)%h+r;return g===r?u:g}function ge(o,r,u){if(!o.length)return u(null,[]);let h=o.length;const g=new Array(o.length);let w=null;o.forEach(((A,k)=>{r(A,((F,z)=>{F&&(w=F),g[k]=z,--h==0&&u(w,g)}))}))}function We(o){const r=[];for(const u in o)r.push(o[u]);return r}function Ve(o,...r){for(const u of r)for(const h in u)o[h]=u[h];return o}let ut=1;function pt(){return ut++}function It(){return(function o(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)})()}function Oe(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function Wt(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function Zt(o,r){o.forEach((u=>{r[u]&&(r[u]=r[u].bind(r))}))}function Xt(o,r){return o.indexOf(r,o.length-r.length)!==-1}function Ze(o,r,u){const h={};for(const g in o)h[g]=r.call(this,o[g],g,o);return h}function zn(o,r,u){const h={};for(const g in o)r.call(u||this,o[g],g,o)&&(h[g]=o[g]);return h}function on(o){return Array.isArray(o)?o.map(on):typeof o=="object"&&o?Ze(o,on):o}const mt={};function Ir(o){mt[o]||(typeof console<"u"&&console.warn(o),mt[o]=!0)}function Fr(o,r,u){return(u.y-o.y)*(r.x-o.x)>(r.y-o.y)*(u.x-o.x)}function qr(o){let r=0;for(let u,h,g=0,w=o.length,A=w-1;g<w;A=g++)u=o[g],h=o[A],r+=(h.x-u.x)*(u.y+h.y);return r}function $t(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function xr(o){const r={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((u,h,g,w)=>{const A=g||w;return r[h]=!A||A.toLowerCase(),""})),r["max-age"]){const u=parseInt(r["max-age"],10);isNaN(u)?delete r["max-age"]:r["max-age"]=u}return r}let dr=null;function ni(o){if(dr==null){const r=o.navigator?o.navigator.userAgent:null;dr=!!o.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return dr}function nn(o){try{const r=T[o];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}function yn(o,r){return[o[4*r],o[4*r+1],o[4*r+2],o[4*r+3]]}const sr="mapbox-tiles";let Zn=500,$r=50,qn,jr;function ir(){try{return T.caches}catch{}}function Xn(){ir()&&!qn&&(qn=T.caches.open(sr))}function Bi(o){const r=o.indexOf("?");if(r<0)return o;const u=(function(g){const w=g.indexOf("?");return w>0?g.slice(w+1).split("&"):[]})(o),h=u.filter((g=>{const w=g.split("=");return w[0]==="language"||w[0]==="worldview"}));return h.length?`${o.slice(0,r)}?${h.join("&")}`:o.slice(0,r)}let bi=1/0;const wr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(wr);class or extends Error{constructor(r,u,h){u===401&&Gt(h)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=u,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ui=$t()?()=>self.worker&&self.worker.referrer:()=>(T.location.protocol==="blob:"?T.parent:T).location.href,Kr=function(o,r){if(!(/^file:/.test(u=o.url)||/^file:/.test(ui())&&!/^\w+:/.test(u))){if(T.fetch&&T.Request&&T.AbortController&&T.Request.prototype.hasOwnProperty("signal"))return(function(h,g){const w=new T.AbortController,A=new T.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:ui(),referrerPolicy:h.referrerPolicy,signal:w.signal});let k=!1,F=!1;const z=(K=A.url).indexOf("sku=")>0&&Gt(K);var K;h.type==="json"&&A.headers.set("Accept","application/json");const re=(we,Te,Re)=>{if(F)return;if(we&&we.message!=="SecurityError"&&Ir(we.toString()),Te&&Re)return fe(Te);const st=Date.now();T.fetch(A).then((_t=>{if(_t.ok){const Rt=z?_t.clone():null;return fe(_t,Rt,st)}return g(new or(_t.statusText,_t.status,h.url))})).catch((_t=>{_t.name!=="AbortError"&&g(new Error(`${_t.message} ${h.url}`))}))},fe=(we,Te,Re)=>{(h.type==="arrayBuffer"?we.arrayBuffer():h.type==="json"?we.json():we.text()).then((st=>{F||(Te&&Re&&(function(_t,Rt,xt){if(Xn(),!qn)return;const Pt={status:Rt.status,statusText:Rt.statusText,headers:new T.Headers};Rt.headers.forEach(((wn,vn)=>Pt.headers.set(vn,wn)));const Vt=xr(Rt.headers.get("Cache-Control")||"");if(Vt["no-store"])return;Vt["max-age"]&&Pt.headers.set("Expires",new Date(xt+1e3*Vt["max-age"]).toUTCString());const jt=Pt.headers.get("Expires");jt&&(new Date(jt).getTime()-xt<42e4||(function(wn,vn){if(jr===void 0)try{new Response(new ReadableStream),jr=!0}catch{jr=!1}jr?vn(wn.body):wn.blob().then(vn)})(Rt,(wn=>{const vn=new T.Response(wn,Pt);Xn(),qn&&qn.then((On=>On.put(Bi(_t.url),vn))).catch((On=>Ir(On.message)))})))})(A,Te,Re),k=!0,g(null,st,we.headers.get("Cache-Control"),we.headers.get("Expires")))})).catch((st=>{F||g(new Error(st.message))}))};return z?(function(we,Te){if(Xn(),!qn)return Te(null);const Re=Bi(we.url);qn.then((st=>{st.match(Re).then((_t=>{const Rt=(function(xt){if(!xt)return!1;const Pt=new Date(xt.headers.get("Expires")||0),Vt=xr(xt.headers.get("Cache-Control")||"");return Pt>Date.now()&&!Vt["no-cache"]})(_t);st.delete(Re),Rt&&st.put(Re,_t.clone()),Te(null,_t,Rt)})).catch(Te)})).catch(Te)})(A,re):re(null,null),{cancel:()=>{F=!0,k||w.abort()}}})(o,r);if($t()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,r,void 0,!0)}var u;return(function(h,g){const w=new T.XMLHttpRequest;w.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(w.responseType="arraybuffer");for(const A in h.headers)w.setRequestHeader(A,h.headers[A]);return h.type==="json"&&(w.responseType="text",w.setRequestHeader("Accept","application/json")),w.withCredentials=h.credentials==="include",w.onerror=()=>{g(new Error(w.statusText))},w.onload=()=>{if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let A=w.response;if(h.type==="json")try{A=JSON.parse(w.response)}catch(k){return g(k)}g(null,A,w.getResponseHeader("Cache-Control"),w.getResponseHeader("Expires"))}else g(new or(w.statusText,w.status,h.url))},w.send(h.body),{cancel:()=>w.abort()}})(o,r)},wi=function(o,r){return Kr(Ve(o,{type:"arrayBuffer"}),r)};function si(o){const r=T.document.createElement("a");return r.href=o,r.protocol===T.document.location.protocol&&r.host===T.document.location.host}const vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ne,ze;Ne=[],ze=0;const ft=function(o,r){if(M.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),ze>=U.MAX_PARALLEL_IMAGE_REQUESTS){const w={requestParameters:o,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Ne.push(w),w}ze++;let u=!1;const h=()=>{if(!u)for(u=!0,ze--;Ne.length&&ze<U.MAX_PARALLEL_IMAGE_REQUESTS;){const w=Ne.shift(),{requestParameters:A,callback:k,cancelled:F}=w;F||(w.cancel=ft(A,k).cancel)}},g=wi(o,((w,A,k,F)=>{h(),w?r(w):A&&(T.createImageBitmap?(function(z,K){const re=new T.Blob([new Uint8Array(z)],{type:"image/png"});T.createImageBitmap(re).then((fe=>{K(null,fe)})).catch((fe=>{K(new Error(`Could not load image because of ${fe.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(A,((z,K)=>r(z,K,k,F))):(function(z,K){const re=new T.Image,fe=T.URL;re.onload=()=>{K(null,re),fe.revokeObjectURL(re.src),re.onload=null,T.requestAnimationFrame((()=>{re.src=vt}))},re.onerror=()=>K(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const we=new T.Blob([new Uint8Array(z)],{type:"image/png"});re.src=z.byteLength?fe.createObjectURL(we):vt})(A,((z,K)=>r(z,K,k,F))))}));return{cancel:()=>{g.cancel(),h()}}},wt="NO_ACCESS_TOKEN";function Ut(o){return o.indexOf("mapbox:")===0}function Gt(o){return U.API_URL_REGEX.test(o)}function Tt(o){return U.API_CDN_URL_REGEX.test(o)}function Ot(o){return U.API_STYLE_REGEX.test(o)&&!zt(o)}function zt(o){return U.API_SPRITE_REGEX.test(o)}const Pn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Jn(o){const r=o.match(Pn);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Fn(o){const r=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${r}`}const Gr="mapbox.eventData";function Mr(o){if(!o)return null;const r=o.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(decodeURIComponent(T.atob(r[1]).split("").map((u=>"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch{return null}}class Zr{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const u=Mr(U.ACCESS_TOKEN);let h="";return h=u&&u.u?T.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,((g,w)=>String.fromCharCode(+("0x"+w))))):U.ACCESS_TOKEN||"",r?`${Gr}.${r}:${h}`:`${Gr}:${h}`}fetchEventData(){const r=nn("localStorage"),u=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{const g=T.localStorage.getItem(u);g&&(this.eventData=JSON.parse(g));const w=T.localStorage.getItem(h);w&&(this.anonId=w)}catch{Ir("Unable to read from LocalStorage")}}saveEventData(){const r=nn("localStorage"),u=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{T.localStorage.setItem(h,this.anonId),Object.keys(this.eventData).length>=1&&T.localStorage.setItem(u,JSON.stringify(this.eventData))}catch{Ir("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,u,h,g){if(!U.EVENTS_URL)return;const w=Jn(U.EVENTS_URL);w.params.push(`access_token=${g||U.ACCESS_TOKEN||""}`);const A={event:this.type,created:new Date(r).toISOString()},k=u?Ve(A,u):A,F={url:Fn(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([k])};this.pendingRequest=(function(z,K){return Kr(Ve(z,{method:"POST"}),K)})(F,(z=>{this.pendingRequest=null,h(z),this.saveEventData(),this.processRequests(g)}))}queueRequest(r,u){this.queue.push(r),this.processRequests(u)}}const Br=new class extends Zr{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,r){U.EVENTS_URL&&U.ACCESS_TOKEN&&Array.isArray(o)&&o.some((u=>Ut(u)||Gt(u)))&&this.queueRequest(Date.now(),r)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Mr(U.ACCESS_TOKEN),u=r?r.u:U.ACCESS_TOKEN;let h=u!==this.eventData.tokenU;Wt(this.anonId)||(this.anonId=It(),h=!0);const g=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),A=new Date(g),k=(g-this.eventData.lastSuccess)/864e5;h=h||k>=1||k<-1||w.getDate()!==A.getDate()}else h=!0;h?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:L,skuId:ve,"enabled.telemetry":!1,userId:this.anonId},(w=>{w||(this.eventData.lastSuccess=g,this.eventData.tokenU=u)}),o):this.processRequests()}},zi=Br.postTurnstileEvent.bind(Br),ms=new class extends Zr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,r,u,h){this.skuToken=r,this.errorCb=h,U.EVENTS_URL&&(u||U.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},u):this.errorCb(new Error(wt)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:u}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Wt(this.anonId)||(this.anonId=It()),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:L,skuId:ve,skuToken:this.skuToken,userId:this.anonId},(h=>{h?this.errorCb(h):r&&(this.success[r]=!0)}),o))}},Os=ms.postMapLoadEvent.bind(ms),cs=new class extends Zr{constructor(){super("gljs.performance")}postPerformanceEvent(o,r){U.EVENTS_URL&&(o||U.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},o)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:u}=this.queue.shift(),h=(function(g){const w=T.performance.getEntriesByType("resource"),A=T.performance.getEntriesByType("mark"),k=(function(fe){const we={};if(fe){for(const Te in fe)if(Te!=="other")for(const Re of fe[Te]){const st=`${Te}ResolveRangeMin`,_t=`${Te}ResolveRangeMax`,Rt=`${Te}RequestCount`,xt=`${Te}RequestCachedCount`;we[st]=Math.min(we[st]||1/0,Re.startTime),we[_t]=Math.max(we[_t]||-1/0,Re.responseEnd);const Pt=Vt=>{we[Vt]===void 0&&(we[Vt]=0),++we[Vt]};Re.transferSize!==void 0&&Re.transferSize===0&&Pt(xt),Pt(Rt)}}return we})((function(fe,we){const Te={};if(fe)for(const Re of fe){const st=we(Re);Te[st]===void 0&&(Te[st]=[]),Te[st].push(Re)}return Te})(w,Pa)),F=T.devicePixelRatio,z=T.navigator.connection||T.navigator.mozConnection||T.navigator.webkitConnection,K={counters:[],metadata:[],attributes:[]},re=(fe,we,Te)=>{Te!=null&&fe.push({name:we,value:Te.toString()})};for(const fe in k)re(K.counters,fe,k[fe]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(re(K.counters,"interactionRangeMin",g.interactionRange[0]),re(K.counters,"interactionRangeMax",g.interactionRange[1])),A)for(const fe of Object.keys(ua)){const we=ua[fe],Te=A.find((Re=>Re.name===we));Te&&re(K.counters,we,Te.startTime)}return re(K.counters,"visibilityHidden",g.visibilityHidden),re(K.attributes,"style",(function(fe){if(fe)for(const we of fe){const Te=we.name.split("?")[0];if(Ot(Te)){const Re=Te.split("/").slice(-2);if(Re.length===2)return`mapbox://styles/${Re[0]}/${Re[1]}`}}})(w)),re(K.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),re(K.attributes,"fogEnabled",g.fogEnabled?"true":"false"),re(K.attributes,"projection",g.projection),re(K.attributes,"zoom",g.zoom),re(K.metadata,"devicePixelRatio",F),re(K.metadata,"connectionEffectiveType",z?z.effectiveType:void 0),re(K.metadata,"navigatorUserAgent",T.navigator.userAgent),re(K.metadata,"screenWidth",T.screen.width),re(K.metadata,"screenHeight",T.screen.height),re(K.metadata,"windowWidth",T.innerWidth),re(K.metadata,"windowHeight",T.innerHeight),re(K.metadata,"mapWidth",g.width/F),re(K.metadata,"mapHeight",g.height/F),re(K.metadata,"webglRenderer",g.renderer),re(K.metadata,"webglVendor",g.vendor),re(K.metadata,"sdkVersion",L),re(K.metadata,"sdkIdentifier","mapbox-gl-js"),K})(u);for(const g of h.metadata);for(const g of h.counters);for(const g of h.attributes);this.postEvent(r,h,(()=>{}),o)}},ps=cs.postPerformanceEvent.bind(cs),vo=new class extends Zr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,r,u,h){if(!U.API_URL||!U.SESSION_PATH)return;const g=Jn(U.API_URL+U.SESSION_PATH);g.params.push(`sku=${r||""}`),g.params.push(`access_token=${h||U.ACCESS_TOKEN||""}`);const w={url:Fn(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=(function(A,k){return Kr(Ve(A,{method:"GET"}),k)})(w,(A=>{this.pendingRequest=null,u(A),this.saveEventData(),this.processRequests(h)}))}getSessionAPI(o,r,u,h){this.skuToken=r,this.errorCb=h,U.SESSION_PATH&&U.API_URL&&(u||U.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},u):this.errorCb(new Error(wt)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:u}=this.queue.shift();r&&this.success[r]||this.getSession(u,this.skuToken,(h=>{h?this.errorCb(h):r&&(this.success[r]=!0)}),o)}},is=vo.getSessionAPI.bind(vo),xo=new Set,ua={create:"create",load:"load",fullLoad:"fullLoad"},tl={mark(o){T.performance.mark(o)},measure(o,r,u){T.performance.measure(o,r,u)}};function Pa(o){const r=o.name.split("?")[0];return Tt(r)&&r.includes("mapbox-gl.js")?"javascript":Tt(r)&&r.includes("mapbox-gl.css")?"css":(function(u){return U.API_FONTS_REGEX.test(u)})(r)?"fontRange":zt(r)?"sprite":Ot(r)?"style":(function(u){return U.API_TILEJSON_REGEX.test(u)})(r)?"tilejson":"other"}const di=T.performance;function ou(o){const r=o?o.url.toString():void 0;return di.getEntriesByName(r)}let yc,Ss,au,ga;const uo={now:()=>au!==void 0?au:T.performance.now(),setNow(o){au=o},restoreNow(){au=void 0},frame(o){const r=T.requestAnimationFrame(o);return{cancel:()=>T.cancelAnimationFrame(r)}},getImageData(o,r=0){const{width:u,height:h}=o;ga||(ga=T.document.createElement("canvas"));const g=ga.getContext("2d",{willReadFrequently:!0});if(!g)throw new Error("failed to create canvas 2d context");return(u>ga.width||h>ga.height)&&(ga.width=u,ga.height=h),g.clearRect(-r,-r,u+2*r,h+2*r),g.drawImage(o,0,0,u,h),g.getImageData(-r,-r,u+2*r,h+2*r)},resolveURL:o=>(yc||(yc=T.document.createElement("a")),yc.href=o,yc.href),get devicePixelRatio(){return T.devicePixelRatio},get prefersReducedMotion(){return!!T.matchMedia&&(Ss==null&&(Ss=T.matchMedia("(prefers-reduced-motion: reduce)")),Ss.matches)}};function nl(o,r,u){u[o]&&u[o].indexOf(r)!==-1||(u[o]=u[o]||[],u[o].push(r))}function Kl(o,r,u){if(u&&u[o]){const h=u[o].indexOf(r);h!==-1&&u[o].splice(h,1)}}class ea{constructor(r,u={}){Ve(this,u),this.type=r}}class Wo extends ea{constructor(r,u={}){super("error",Ve({error:r},u))}}class ta{on(r,u){return this._listeners=this._listeners||{},nl(r,u,this._listeners),this}off(r,u){return Kl(r,u,this._listeners),Kl(r,u,this._oneTimeListeners),this}once(r,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},nl(r,u,this._oneTimeListeners),this):new Promise((h=>this.once(r,h)))}fire(r,u){typeof r=="string"&&(r=new ea(r,u||{}));const h=r.type;if(this.listens(h)){r.target=this;const g=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const k of g)k.call(this,r);const w=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const k of w)Kl(h,k,this._oneTimeListeners),k.call(this,r);const A=this._eventedParent;A&&(Ve(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),A.fire(r))}else r instanceof Wo&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,u){return this._eventedParent=r,this._eventedParentData=u,this}}var En=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function co(o,...r){for(const u of r)for(const h in u)o[h]=u[h];return o}function Io(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Ni(o){if(Array.isArray(o))return o.map(Ni);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const r={};for(const u in o)r[u]=Ni(o[u]);return r}return Io(o)}class ic extends Error{constructor(r,u){super(u),this.message=u,this.key=r}}var rl=ic;class il{constructor(r,u=[]){this.parent=r,this.bindings={};for(const[h,g]of u)this.bindings[h]=g}concat(r){return new il(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}var Ga=il;const ho={kind:"null"},lr={kind:"number"},Wr={kind:"string"},Ur={kind:"boolean"},ca={kind:"color"},$a={kind:"object"},Ri={kind:"value"},Hi={kind:"collator"},Tl={kind:"formatted"},Wi={kind:"resolvedImage"};function ko(o,r){return{kind:"array",itemType:o,N:r}}function ss(o){if(o.kind==="array"){const r=ss(o.itemType);return typeof o.N=="number"?`array<${r}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${r}>`}return o.kind}const $u=[ho,lr,Wr,Ur,ca,Tl,$a,ko(Ri),Wi];function lu(o,r){if(r.kind==="error")return null;if(o.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!lu(o.itemType,r.itemType))&&(typeof o.N!="number"||o.N===r.N))return null}else{if(o.kind===r.kind)return null;if(o.kind==="value"){for(const u of $u)if(!lu(u,r))return null}}return`Expected ${ss(o)} but found ${ss(r)} instead.`}function mu(o,r){return r.some((u=>u.kind===o.kind))}function Us(o,r){return r.some((u=>u==="null"?o===null:u==="array"?Array.isArray(o):u==="object"?o&&!Array.isArray(o)&&typeof o=="object":u===typeof o))}var Ha,sl={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Vo(o){return(o=Math.round(o))<0?0:o>255?255:o}function Ei(o){return Vo(o[o.length-1]==="%"?parseFloat(o)/100*255:parseInt(o))}function bo(o){return(r=o[o.length-1]==="%"?parseFloat(o)/100:parseFloat(o))<0?0:r>1?1:r;var r}function gi(o,r,u){return u<0?u+=1:u>1&&(u-=1),6*u<1?o+(r-o)*u*6:2*u<1?r:3*u<2?o+(r-o)*(2/3-u)*6:o}try{Ha={}.parseCSSColor=function(o){var r,u=o.replace(/ /g,"").toLowerCase();if(u in sl)return sl[u].slice();if(u[0]==="#")return u.length===4?(r=parseInt(u.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:u.length===7&&(r=parseInt(u.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var h=u.indexOf("("),g=u.indexOf(")");if(h!==-1&&g+1===u.length){var w=u.substr(0,h),A=u.substr(h+1,g-(h+1)).split(","),k=1;switch(w){case"rgba":if(A.length!==4)return null;k=bo(A.pop());case"rgb":return A.length!==3?null:[Ei(A[0]),Ei(A[1]),Ei(A[2]),k];case"hsla":if(A.length!==4)return null;k=bo(A.pop());case"hsl":if(A.length!==3)return null;var F=(parseFloat(A[0])%360+360)%360/360,z=bo(A[1]),K=bo(A[2]),re=K<=.5?K*(z+1):K+z-K*z,fe=2*K-re;return[Vo(255*gi(fe,re,F+1/3)),Vo(255*gi(fe,re,F)),Vo(255*gi(fe,re,F-1/3)),k];default:return null}}return null}}catch{}class wo{constructor(r,u,h,g=1){this.r=r,this.g=u,this.b=h,this.a=g}static parse(r){if(!r)return;if(r instanceof wo)return r;if(typeof r!="string")return;const u=Ha(r);return u?new wo(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3]):void 0}toString(){const[r,u,h,g]=this.toArray();return`rgba(${Math.round(r)},${Math.round(u)},${Math.round(h)},${g})`}toArray(){const{r,g:u,b:h,a:g}=this;return g===0?[0,0,0,0]:[255*r/g,255*u/g,255*h/g,g]}toArray01(){const{r,g:u,b:h,a:g}=this;return g===0?[0,0,0,0]:[r/g,u/g,h/g,g]}toArray01PremultipliedAlpha(){const{r,g:u,b:h,a:g}=this;return[r,u,h,g]}}wo.black=new wo(0,0,0,1),wo.white=new wo(1,1,1,1),wo.transparent=new wo(0,0,0,0),wo.red=new wo(1,0,0,1),wo.blue=new wo(0,0,1,1);var Vs=wo;class Nc{constructor(r,u,h){this.sensitivity=r?u?"variant":"case":u?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,u){return this.collator.compare(r,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Pu{constructor(r,u,h,g,w){this.text=r.normalize?r.normalize():r,this.image=u,this.scale=h,this.fontStack=g,this.textColor=w}}class Fs{constructor(r){this.sections=r}static fromString(r){return new Fs([new Pu(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((r=>r.text.length!==0||r.image&&r.image.name.length!==0))}static factory(r){return r instanceof Fs?r:Fs.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map((r=>r.text)).join("")}serialize(){const r=["format"];for(const u of this.sections){if(u.image){r.push(["image",u.image.name]);continue}r.push(u.text);const h={};u.fontStack&&(h["text-font"]=["literal",u.fontStack.split(",")]),u.scale&&(h["font-scale"]=u.scale),u.textColor&&(h["text-color"]=["rgba"].concat(u.textColor.toArray())),r.push(h)}return r}}class na{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new na({name:r,available:!1}):null}serialize(){return["image",this.name]}}function Es(o,r,u,h){return typeof o=="number"&&o>=0&&o<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof u=="number"&&u>=0&&u<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[o,r,u,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[o,r,u,h]:[o,r,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function xs(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Vs||o instanceof Nc||o instanceof Fs||o instanceof na)return!0;if(Array.isArray(o)){for(const r of o)if(!xs(r))return!1;return!0}if(typeof o=="object"){for(const r in o)if(!xs(o[r]))return!1;return!0}return!1}function Ts(o){if(o===null)return ho;if(typeof o=="string")return Wr;if(typeof o=="boolean")return Ur;if(typeof o=="number")return lr;if(o instanceof Vs)return ca;if(o instanceof Nc)return Hi;if(o instanceof Fs)return Tl;if(o instanceof na)return Wi;if(Array.isArray(o)){const r=o.length;let u;for(const h of o){const g=Ts(h);if(u){if(u===g)continue;u=Ri;break}u=g}return ko(u||Ri,r)}return $a}function Ol(o){const r=typeof o;return o===null?"":r==="string"||r==="number"||r==="boolean"?String(o):o instanceof Vs||o instanceof Fs||o instanceof na?o.toString():JSON.stringify(o)}class ha{constructor(r,u){this.type=r,this.value=u}static parse(r,u){if(r.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!xs(r[1]))return u.error("invalid value");const h=r[1];let g=Ts(h);const w=u.expectedType;return g.kind!=="array"||g.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(g=w),new ha(g,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Vs?["rgba"].concat(this.value.toArray()):this.value instanceof Fs?this.value.serialize():this.value}}var ra=ha,os=class{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}};const gu={string:Wr,number:lr,boolean:Ur,object:$a};class ro{constructor(r,u){this.type=r,this.args=u}static parse(r,u){if(r.length<2)return u.error("Expected at least one argument.");let h,g=1;const w=r[0];if(w==="array"){let k,F;if(r.length>2){const z=r[1];if(typeof z!="string"||!(z in gu)||z==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);k=gu[z],g++}else k=Ri;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return u.error('The length argument to "array" must be a positive integer literal',2);F=r[2],g++}h=ko(k,F)}else h=gu[w];const A=[];for(;g<r.length;g++){const k=u.parse(r[g],g,Ri);if(!k)return null;A.push(k)}return new ro(h,A)}evaluate(r){for(let u=0;u<this.args.length;u++){const h=this.args[u].evaluate(r);if(!lu(this.type,Ts(h)))return h;if(u===this.args.length-1)throw new os(`Expected value to be of type ${ss(this.type)}, but found ${ss(Ts(h))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){const r=this.type,u=[r.kind];if(r.kind==="array"){const h=r.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){u.push(h.kind);const g=r.N;(typeof g=="number"||this.args.length>1)&&u.push(g)}}return u.concat(this.args.map((h=>h.serialize())))}}var ya=ro;class ol{constructor(r){this.type=Tl,this.sections=r}static parse(r,u){if(r.length<2)return u.error("Expected at least one argument.");const h=r[1];if(!Array.isArray(h)&&typeof h=="object")return u.error("First argument must be an image or text section.");const g=[];let w=!1;for(let A=1;A<=r.length-1;++A){const k=r[A];if(w&&typeof k=="object"&&!Array.isArray(k)){w=!1;let F=null;if(k["font-scale"]&&(F=u.parse(k["font-scale"],1,lr),!F))return null;let z=null;if(k["text-font"]&&(z=u.parse(k["text-font"],1,ko(Wr)),!z))return null;let K=null;if(k["text-color"]&&(K=u.parse(k["text-color"],1,ca),!K))return null;const re=g[g.length-1];re.scale=F,re.font=z,re.textColor=K}else{const F=u.parse(r[A],1,Ri);if(!F)return null;const z=F.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,g.push({content:F,scale:null,font:null,textColor:null})}}return new ol(g)}evaluate(r){return new Fs(this.sections.map((u=>{const h=u.content.evaluate(r);return Ts(h)===Wi?new Pu("",h,null,null,null):new Pu(Ol(h),null,u.scale?u.scale.evaluate(r):null,u.font?u.font.evaluate(r).join(","):null,u.textColor?u.textColor.evaluate(r):null)})))}eachChild(r){for(const u of this.sections)r(u.content),u.scale&&r(u.scale),u.font&&r(u.font),u.textColor&&r(u.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const u of this.sections){r.push(u.content.serialize());const h={};u.scale&&(h["font-scale"]=u.scale.serialize()),u.font&&(h["text-font"]=u.font.serialize()),u.textColor&&(h["text-color"]=u.textColor.serialize()),r.push(h)}return r}}class Al{constructor(r){this.type=Wi,this.input=r}static parse(r,u){if(r.length!==2)return u.error("Expected two arguments.");const h=u.parse(r[1],1,Wr);return h?new Al(h):u.error("No image name provided.")}evaluate(r){const u=this.input.evaluate(r),h=na.fromString(u);return h&&r.availableImages&&(h.available=r.availableImages.indexOf(u)>-1),h}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Nu={"to-boolean":Ur,"to-color":ca,"to-number":lr,"to-string":Wr};class Na{constructor(r,u){this.type=r,this.args=u}static parse(r,u){if(r.length<2)return u.error("Expected at least one argument.");const h=r[0];if((h==="to-boolean"||h==="to-string")&&r.length!==2)return u.error("Expected one argument.");const g=Nu[h],w=[];for(let A=1;A<r.length;A++){const k=u.parse(r[A],A,Ri);if(!k)return null;w.push(k)}return new Na(g,w)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let u,h;for(const g of this.args){if(u=g.evaluate(r),h=null,u instanceof Vs)return u;if(typeof u=="string"){const w=r.parseColor(u);if(w)return w}else if(Array.isArray(u)&&(h=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Es(u[0],u[1],u[2],u[3]),!h))return new Vs(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new os(h||`Could not parse color from value '${typeof u=="string"?u:String(JSON.stringify(u))}'`)}if(this.type.kind==="number"){let u=null;for(const h of this.args){if(u=h.evaluate(r),u===null)return 0;const g=Number(u);if(!isNaN(g))return g}throw new os(`Could not convert ${JSON.stringify(u)} to number.`)}return this.type.kind==="formatted"?Fs.fromString(Ol(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?na.fromString(Ol(this.args[0].evaluate(r))):Ol(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new ol([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Al(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild((u=>{r.push(u.serialize())})),r}}var qo=Na;const ji=["Unknown","Point","LineString","Polygon"];var qs=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ji[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*r-o[0])+this.featureDistanceData.bearing[1]*(h*r-o[1])}return 0}parseColor(o){let r=this._parseColorCache[o];return r||(r=this._parseColorCache[o]=Vs.parse(o)),r}};class Lo{constructor(r,u,h,g){this.name=r,this.type=u,this._evaluate=h,this.args=g}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((r=>r.serialize())))}static parse(r,u){const h=r[0],g=Lo.definitions[h];if(!g)return u.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(g)?g[0]:g.type,A=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,k=A.filter((([z])=>!Array.isArray(z)||z.length===r.length-1));let F=null;for(const[z,K]of k){F=new Fl(u.registry,u.path,null,u.scope);const re=[];let fe=!1;for(let we=1;we<r.length;we++){const Te=r[we],Re=Array.isArray(z)?z[we-1]:z.type,st=F.parse(Te,1+re.length,Re);if(!st){fe=!0;break}re.push(st)}if(!fe)if(Array.isArray(z)&&z.length!==re.length)F.error(`Expected ${z.length} arguments, but found ${re.length} instead.`);else{for(let we=0;we<re.length;we++){const Te=Array.isArray(z)?z[we]:z.type,Re=re[we];F.concat(we+1).checkSubtype(Te,Re.type)}if(F.errors.length===0)return new Lo(h,w,K,re)}}if(k.length===1)u.errors.push(...F.errors);else{const z=(k.length?k:A).map((([re])=>{return fe=re,Array.isArray(fe)?`(${fe.map(ss).join(", ")})`:`(${ss(fe.type)}...)`;var fe})).join(" | "),K=[];for(let re=1;re<r.length;re++){const fe=u.parse(r[re],1+K.length);if(!fe)return null;K.push(ss(fe.type))}u.error(`Expected arguments of type ${z}, but found (${K.join(", ")}) instead.`)}return null}static register(r,u){Lo.definitions=u;for(const h in u)r[h]=Lo}}var _a=Lo;class zo{constructor(r,u,h){this.type=Hi,this.locale=h,this.caseSensitive=r,this.diacriticSensitive=u}static parse(r,u){if(r.length!==2)return u.error("Expected one argument.");const h=r[1];if(typeof h!="object"||Array.isArray(h))return u.error("Collator options argument must be an object.");const g=u.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,Ur);if(!g)return null;const w=u.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,Ur);if(!w)return null;let A=null;return h.locale&&(A=u.parse(h.locale,1,Wr),!A)?null:new zo(g,w,A)}evaluate(r){return new Nc(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const ml=8192;function Po(o,r){o[0]=Math.min(o[0],r[0]),o[1]=Math.min(o[1],r[1]),o[2]=Math.max(o[2],r[0]),o[3]=Math.max(o[3],r[1])}function fa(o,r){return!(o[0]<=r[0]||o[2]>=r[2]||o[1]<=r[1]||o[3]>=r[3])}function va(o,r){const u=(180+o[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,g=Math.pow(2,r.z);return[Math.round(u*g*ml),Math.round(h*g*ml)]}function ee(o,r,u){const h=o[0]-r[0],g=o[1]-r[1],w=o[0]-u[0],A=o[1]-u[1];return h*A-w*g==0&&h*w<=0&&g*A<=0}function je(o,r){let u=!1;for(let A=0,k=r.length;A<k;A++){const F=r[A];for(let z=0,K=F.length;z<K-1;z++){if(ee(o,F[z],F[z+1]))return!1;(g=F[z])[1]>(h=o)[1]!=(w=F[z+1])[1]>h[1]&&h[0]<(w[0]-g[0])*(h[1]-g[1])/(w[1]-g[1])+g[0]&&(u=!u)}}var h,g,w;return u}function At(o,r){for(let u=0;u<r.length;u++)if(je(o,r[u]))return!0;return!1}function kt(o,r,u,h){const g=h[0]-u[0],w=h[1]-u[1],A=(o[0]-u[0])*w-g*(o[1]-u[1]),k=(r[0]-u[0])*w-g*(r[1]-u[1]);return A>0&&k<0||A<0&&k>0}function sn(o,r,u){for(const z of u)for(let K=0;K<z.length-1;++K)if((k=[(A=z[K+1])[0]-(w=z[K])[0],A[1]-w[1]])[0]*(F=[(g=r)[0]-(h=o)[0],g[1]-h[1]])[1]-k[1]*F[0]!=0&&kt(h,g,w,A)&&kt(w,A,h,g))return!0;var h,g,w,A,k,F;return!1}function fn(o,r){for(let u=0;u<o.length;++u)if(!je(o[u],r))return!1;for(let u=0;u<o.length-1;++u)if(sn(o[u],o[u+1],r))return!1;return!0}function Qn(o,r){for(let u=0;u<r.length;u++)if(fn(o,r[u]))return!0;return!1}function Xr(o,r,u){const h=[];for(let g=0;g<o.length;g++){const w=[];for(let A=0;A<o[g].length;A++){const k=va(o[g][A],u);Po(r,k),w.push(k)}h.push(w)}return h}function Qr(o,r,u){const h=[];for(let g=0;g<o.length;g++){const w=Xr(o[g],r,u);h.push(w)}return h}function oi(o,r,u,h){if(o[0]<u[0]||o[0]>u[2]){const g=.5*h;let w=o[0]-u[0]>g?-h:u[0]-o[0]>g?h:0;w===0&&(w=o[0]-u[2]>g?-h:u[2]-o[0]>g?h:0),o[0]+=w}Po(r,o)}function Ui(o,r,u,h){const g=Math.pow(2,h.z)*ml,w=[h.x*ml,h.y*ml],A=[];if(!o)return A;for(const k of o)for(const F of k){const z=[F.x+w[0],F.y+w[1]];oi(z,r,u,g),A.push(z)}return A}function Ps(o,r,u,h){const g=Math.pow(2,h.z)*ml,w=[h.x*ml,h.y*ml],A=[];if(!o)return A;for(const F of o){const z=[];for(const K of F){const re=[K.x+w[0],K.y+w[1]];Po(r,re),z.push(re)}A.push(z)}if(r[2]-r[0]<=g/2){(k=r)[0]=k[1]=1/0,k[2]=k[3]=-1/0;for(const F of A)for(const z of F)oi(z,r,u,g)}var k;return A}class Bs{constructor(r,u){this.type=Ur,this.geojson=r,this.geometries=u}static parse(r,u){if(r.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(xs(r[1])){const h=r[1];if(h.type==="FeatureCollection")for(let g=0;g<h.features.length;++g){const w=h.features[g].geometry.type;if(w==="Polygon"||w==="MultiPolygon")return new Bs(h,h.features[g].geometry)}else if(h.type==="Feature"){const g=h.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Bs(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Bs(h,h)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return(function(u,h){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],A=u.canonicalID();if(!A)return!1;if(h.type==="Polygon"){const k=Xr(h.coordinates,w,A),F=Ui(u.geometry(),g,w,A);if(!fa(g,w))return!1;for(const z of F)if(!je(z,k))return!1}if(h.type==="MultiPolygon"){const k=Qr(h.coordinates,w,A),F=Ui(u.geometry(),g,w,A);if(!fa(g,w))return!1;for(const z of F)if(!At(z,k))return!1}return!0})(r,this.geometries);if(r.geometryType()==="LineString")return(function(u,h){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],A=u.canonicalID();if(!A)return!1;if(h.type==="Polygon"){const k=Xr(h.coordinates,w,A),F=Ps(u.geometry(),g,w,A);if(!fa(g,w))return!1;for(const z of F)if(!fn(z,k))return!1}if(h.type==="MultiPolygon"){const k=Qr(h.coordinates,w,A),F=Ps(u.geometry(),g,w,A);if(!fa(g,w))return!1;for(const z of F)if(!Qn(z,k))return!1}return!0})(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var fo=Bs;function Ys(o){if(o instanceof _a&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof fo)return!1;let r=!0;return o.eachChild((u=>{r&&!Ys(u)&&(r=!1)})),r}function Zs(o){if(o instanceof _a&&o.name==="feature-state")return!1;let r=!0;return o.eachChild((u=>{r&&!Zs(u)&&(r=!1)})),r}function go(o,r){if(o instanceof _a&&r.indexOf(o.name)>=0)return!1;let u=!0;return o.eachChild((h=>{u&&!go(h,r)&&(u=!1)})),u}class Ns{constructor(r,u){this.type=u.type,this.name=r,this.boundExpression=u}static parse(r,u){if(r.length!==2||typeof r[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const h=r[1];return u.scope.has(h)?new Ns(h,u.scope.get(h)):u.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var io=Ns;class zs{constructor(r,u=[],h,g=new Ga,w=[]){this.registry=r,this.path=u,this.key=u.map((A=>`[${A}]`)).join(""),this.scope=g,this.errors=w,this.expectedType=h}parse(r,u,h,g,w={}){return u?this.concat(u,h,g)._parse(r,w):this._parse(r,w)}_parse(r,u){function h(g,w,A){return A==="assert"?new ya(w,[g]):A==="coerce"?new qo(w,[g]):g}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=r[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[g];if(w){let A=w.parse(r,this);if(!A)return null;if(this.expectedType){const k=this.expectedType,F=A.type;if(k.kind!=="string"&&k.kind!=="number"&&k.kind!=="boolean"&&k.kind!=="object"&&k.kind!=="array"||F.kind!=="value")if(k.kind!=="color"&&k.kind!=="formatted"&&k.kind!=="resolvedImage"||F.kind!=="value"&&F.kind!=="string"){if(this.checkSubtype(k,F))return null}else A=h(A,k,u.typeAnnotation||"coerce");else A=h(A,k,u.typeAnnotation||"assert")}if(!(A instanceof ra)&&A.type.kind!=="resolvedImage"&&gl(A)){const k=new qs;try{A=new ra(A.type,A.evaluate(k))}catch(F){return this.error(F.message),null}}return A}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,u,h){const g=typeof r=="number"?this.path.concat(r):this.path,w=h?this.scope.concat(h):this.scope;return new zs(this.registry,g,u||null,w,this.errors)}error(r,...u){const h=`${this.key}${u.map((g=>`[${g}]`)).join("")}`;this.errors.push(new rl(h,r))}checkSubtype(r,u){const h=lu(r,u);return h&&this.error(h),h}}var Fl=zs;function gl(o){if(o instanceof io)return gl(o.boundExpression);if(o instanceof _a&&o.name==="error"||o instanceof zo||o instanceof fo)return!1;const r=o instanceof qo||o instanceof ya;let u=!0;return o.eachChild((h=>{u=r?u&&gl(h):u&&h instanceof ra})),!!u&&Ys(o)&&go(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function O(o,r){const u=o.length-1;let h,g,w=0,A=u,k=0;for(;w<=A;)if(k=Math.floor((w+A)/2),h=o[k],g=o[k+1],h<=r){if(k===u||r<g)return k;w=k+1}else{if(!(h>r))throw new os("Input is not a number.");A=k-1}return 0}class me{constructor(r,u,h){this.type=r,this.input=u,this.labels=[],this.outputs=[];for(const[g,w]of h)this.labels.push(g),this.outputs.push(w)}static parse(r,u){if(r.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return u.error("Expected an even number of arguments.");const h=u.parse(r[1],1,lr);if(!h)return null;const g=[];let w=null;u.expectedType&&u.expectedType.kind!=="value"&&(w=u.expectedType);for(let A=1;A<r.length;A+=2){const k=A===1?-1/0:r[A],F=r[A+1],z=A,K=A+1;if(typeof k!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(g.length&&g[g.length-1][0]>=k)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const re=u.parse(F,K,w);if(!re)return null;w=w||re.type,g.push([k,re])}return new me(w,h,g)}evaluate(r){const u=this.labels,h=this.outputs;if(u.length===1)return h[0].evaluate(r);const g=this.input.evaluate(r);if(g<=u[0])return h[0].evaluate(r);const w=u.length;return g>=u[w-1]?h[w-1].evaluate(r):h[O(u,g)].evaluate(r)}eachChild(r){r(this.input);for(const u of this.outputs)r(u)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}serialize(){const r=["step",this.input.serialize()];for(let u=0;u<this.labels.length;u++)u>0&&r.push(this.labels[u]),r.push(this.outputs[u].serialize());return r}}var ke=me;function nt(o,r,u){return o*(1-u)+r*u}var hn=Object.freeze({__proto__:null,array:function(o,r,u){return o.map(((h,g)=>nt(h,r[g],u)))},color:function(o,r,u){return new Vs(nt(o.r,r.r,u),nt(o.g,r.g,u),nt(o.b,r.b,u),nt(o.a,r.a,u))},number:nt});const Cn=.95047,Sr=1.08883,Rs=4/29,so=6/29,hs=3*so*so,es=so*so*so,Js=Math.PI/180,da=180/Math.PI;function oo(o){return o>es?Math.pow(o,1/3):o/hs+Rs}function Vi(o){return o>so?o*o*o:hs*(o-Rs)}function Zl(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function xa(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Rc(o){const r=xa(o.r),u=xa(o.g),h=xa(o.b),g=oo((.4124564*r+.3575761*u+.1804375*h)/Cn),w=oo((.2126729*r+.7151522*u+.072175*h)/1);return{l:116*w-16,a:500*(g-w),b:200*(w-oo((.0193339*r+.119192*u+.9503041*h)/Sr)),alpha:o.a}}function Ru(o){let r=(o.l+16)/116,u=isNaN(o.a)?r:r+o.a/500,h=isNaN(o.b)?r:r-o.b/200;return r=1*Vi(r),u=Cn*Vi(u),h=Sr*Vi(h),new Vs(Zl(3.2404542*u-1.5371385*r-.4985314*h),Zl(-.969266*u+1.8760108*r+.041556*h),Zl(.0556434*u-.2040259*r+1.0572252*h),o.alpha)}function yu(o,r,u){const h=r-o;return o+u*(h>180||h<-180?h-360*Math.round(h/360):h)}const Wa={forward:Rc,reverse:Ru,interpolate:function(o,r,u){return{l:nt(o.l,r.l,u),a:nt(o.a,r.a,u),b:nt(o.b,r.b,u),alpha:nt(o.alpha,r.alpha,u)}}},al={forward:function(o){const{l:r,a:u,b:h}=Rc(o),g=Math.atan2(h,u)*da;return{h:g<0?g+360:g,c:Math.sqrt(u*u+h*h),l:r,alpha:o.a}},reverse:function(o){const r=o.h*Js,u=o.c;return Ru({l:o.l,a:Math.cos(r)*u,b:Math.sin(r)*u,alpha:o.alpha})},interpolate:function(o,r,u){return{h:yu(o.h,r.h,u),c:nt(o.c,r.c,u),l:nt(o.l,r.l,u),alpha:nt(o.alpha,r.alpha,u)}}};var Hu=Object.freeze({__proto__:null,hcl:al,lab:Wa});class yo{constructor(r,u,h,g,w){this.type=r,this.operator=u,this.interpolation=h,this.input=g,this.labels=[],this.outputs=[];for(const[A,k]of w)this.labels.push(A),this.outputs.push(k)}static interpolationFactor(r,u,h,g){let w=0;if(r.name==="exponential")w=ia(u,r.base,h,g);else if(r.name==="linear")w=ia(u,1,h,g);else if(r.name==="cubic-bezier"){const A=r.controlPoints;w=new _e(A[0],A[1],A[2],A[3]).solve(ia(u,1,h,g))}return w}static parse(r,u){let[h,g,w,...A]=r;if(!Array.isArray(g)||g.length===0)return u.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const z=g[1];if(typeof z!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:z}}else{if(g[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const z=g.slice(1);if(z.length!==4||z.some((K=>typeof K!="number"||K<0||K>1)))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:z}}}if(r.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(w=u.parse(w,2,lr),!w)return null;const k=[];let F=null;h==="interpolate-hcl"||h==="interpolate-lab"?F=ca:u.expectedType&&u.expectedType.kind!=="value"&&(F=u.expectedType);for(let z=0;z<A.length;z+=2){const K=A[z],re=A[z+1],fe=z+3,we=z+4;if(typeof K!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',fe);if(k.length&&k[k.length-1][0]>=K)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',fe);const Te=u.parse(re,we,F);if(!Te)return null;F=F||Te.type,k.push([K,Te])}return F.kind==="number"||F.kind==="color"||F.kind==="array"&&F.itemType.kind==="number"&&typeof F.N=="number"?new yo(F,h,g,w,k):u.error(`Type ${ss(F)} is not interpolatable.`)}evaluate(r){const u=this.labels,h=this.outputs;if(u.length===1)return h[0].evaluate(r);const g=this.input.evaluate(r);if(g<=u[0])return h[0].evaluate(r);const w=u.length;if(g>=u[w-1])return h[w-1].evaluate(r);const A=O(u,g),k=yo.interpolationFactor(this.interpolation,g,u[A],u[A+1]),F=h[A].evaluate(r),z=h[A+1].evaluate(r);return this.operator==="interpolate"?hn[this.type.kind.toLowerCase()](F,z,k):this.operator==="interpolate-hcl"?al.reverse(al.interpolate(al.forward(F),al.forward(z),k)):Wa.reverse(Wa.interpolate(Wa.forward(F),Wa.forward(z),k))}eachChild(r){r(this.input);for(const u of this.outputs)r(u)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const u=[this.operator,r,this.input.serialize()];for(let h=0;h<this.labels.length;h++)u.push(this.labels[h],this.outputs[h].serialize());return u}}function ia(o,r,u,h){const g=h-u,w=o-u;return g===0?0:r===1?w/g:(Math.pow(r,w)-1)/(Math.pow(r,g)-1)}var ll=yo;class Bl{constructor(r,u){this.type=r,this.args=u}static parse(r,u){if(r.length<2)return u.error("Expectected at least one argument.");let h=null;const g=u.expectedType;g&&g.kind!=="value"&&(h=g);const w=[];for(const k of r.slice(1)){const F=u.parse(k,1+w.length,h,void 0,{typeAnnotation:"omit"});if(!F)return null;h=h||F.type,w.push(F)}const A=g&&w.some((k=>lu(g,k.type)));return new Bl(A?Ri:h,w)}evaluate(r){let u,h=null,g=0;for(const w of this.args){if(g++,h=w.evaluate(r),h&&h instanceof na&&!h.available&&(u||(u=h),h=null,g===this.args.length))return u;if(h!==null)break}return h}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){const r=["coalesce"];return this.eachChild((u=>{r.push(u.serialize())})),r}}var No=Bl;class po{constructor(r,u){this.type=u.type,this.bindings=[].concat(r),this.result=u}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const u of this.bindings)r(u[1]);r(this.result)}static parse(r,u){if(r.length<4)return u.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const h=[];for(let w=1;w<r.length-1;w+=2){const A=r[w];if(typeof A!="string")return u.error(`Expected string, but found ${typeof A} instead.`,w);if(/[^a-zA-Z0-9_]/.test(A))return u.error("Variable names must contain only alphanumeric characters or '_'.",w);const k=u.parse(r[w+1],w+1);if(!k)return null;h.push([A,k])}const g=u.parse(r[r.length-1],r.length-1,u.expectedType,h);return g?new po(h,g):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[u,h]of this.bindings)r.push(u,h.serialize());return r.push(this.result.serialize()),r}}var Ra=po;class sa{constructor(r,u,h){this.type=r,this.index=u,this.input=h}static parse(r,u){if(r.length!==3)return u.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=u.parse(r[1],1,lr),g=u.parse(r[2],2,ko(u.expectedType||Ri));return h&&g?new sa(g.type.itemType,h,g):null}evaluate(r){const u=this.index.evaluate(r),h=this.input.evaluate(r);if(u<0)throw new os(`Array index out of bounds: ${u} < 0.`);if(u>=h.length)throw new os(`Array index out of bounds: ${u} > ${h.length-1}.`);if(u!==Math.floor(u))throw new os(`Array index must be an integer, but found ${u} instead.`);return h[u]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var sc=sa;class _u{constructor(r,u){this.type=Ur,this.needle=r,this.haystack=u}static parse(r,u){if(r.length!==3)return u.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=u.parse(r[1],1,Ri),g=u.parse(r[2],2,Ri);return h&&g?mu(h.type,[Ur,Wr,lr,ho,Ri])?new _u(h,g):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${ss(h.type)} instead`):null}evaluate(r){const u=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(h==null)return!1;if(!Us(u,["boolean","string","number","null"]))throw new os(`Expected first argument to be of type boolean, string, number or null, but found ${ss(Ts(u))} instead.`);if(!Us(h,["string","array"]))throw new os(`Expected second argument to be of type array or string, but found ${ss(Ts(h))} instead.`);return h.indexOf(u)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var zl=_u;class ul{constructor(r,u,h){this.type=lr,this.needle=r,this.haystack=u,this.fromIndex=h}static parse(r,u){if(r.length<=2||r.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=u.parse(r[1],1,Ri),g=u.parse(r[2],2,Ri);if(!h||!g)return null;if(!mu(h.type,[Ur,Wr,lr,ho,Ri]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${ss(h.type)} instead`);if(r.length===4){const w=u.parse(r[3],3,lr);return w?new ul(h,g,w):null}return new ul(h,g)}evaluate(r){const u=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!Us(u,["boolean","string","number","null"]))throw new os(`Expected first argument to be of type boolean, string, number or null, but found ${ss(Ts(u))} instead.`);if(!Us(h,["string","array"]))throw new os(`Expected second argument to be of type array or string, but found ${ss(Ts(h))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(r);return h.indexOf(u,g)}return h.indexOf(u)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Jl=ul;class jo{constructor(r,u,h,g,w,A){this.inputType=r,this.type=u,this.input=h,this.cases=g,this.outputs=w,this.otherwise=A}static parse(r,u){if(r.length<5)return u.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return u.error("Expected an even number of arguments.");let h,g;u.expectedType&&u.expectedType.kind!=="value"&&(g=u.expectedType);const w={},A=[];for(let z=2;z<r.length-1;z+=2){let K=r[z];const re=r[z+1];Array.isArray(K)||(K=[K]);const fe=u.concat(z);if(K.length===0)return fe.error("Expected at least one branch label.");for(const Te of K){if(typeof Te!="number"&&typeof Te!="string")return fe.error("Branch labels must be numbers or strings.");if(typeof Te=="number"&&Math.abs(Te)>Number.MAX_SAFE_INTEGER)return fe.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Te=="number"&&Math.floor(Te)!==Te)return fe.error("Numeric branch labels must be integer values.");if(h){if(fe.checkSubtype(h,Ts(Te)))return null}else h=Ts(Te);if(w[String(Te)]!==void 0)return fe.error("Branch labels must be unique.");w[String(Te)]=A.length}const we=u.parse(re,z,g);if(!we)return null;g=g||we.type,A.push(we)}const k=u.parse(r[1],1,Ri);if(!k)return null;const F=u.parse(r[r.length-1],r.length-1,g);return F?k.type.kind!=="value"&&u.concat(1).checkSubtype(h,k.type)?null:new jo(h,g,k,w,A,F):null}evaluate(r){const u=this.input.evaluate(r);return(Ts(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],u=Object.keys(this.cases).sort(),h=[],g={};for(const A of u){const k=g[this.cases[A]];k===void 0?(g[this.cases[A]]=h.length,h.push([this.cases[A],[A]])):h[k][1].push(A)}const w=A=>this.inputType.kind==="number"?Number(A):A;for(const[A,k]of h)r.push(k.length===1?w(k[0]):k.map(w)),r.push(this.outputs[A].serialize());return r.push(this.otherwise.serialize()),r}}var oa=jo;class E{constructor(r,u,h){this.type=r,this.branches=u,this.otherwise=h}static parse(r,u){if(r.length<4)return u.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return u.error("Expected an odd number of arguments.");let h;u.expectedType&&u.expectedType.kind!=="value"&&(h=u.expectedType);const g=[];for(let A=1;A<r.length-1;A+=2){const k=u.parse(r[A],A,Ur);if(!k)return null;const F=u.parse(r[A+1],A+1,h);if(!F)return null;g.push([k,F]),h=h||F.type}const w=u.parse(r[r.length-1],r.length-1,h);return w?new E(h,g,w):null}evaluate(r){for(const[u,h]of this.branches)if(u.evaluate(r))return h.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[u,h]of this.branches)r(u),r(h);r(this.otherwise)}outputDefined(){return this.branches.every((([r,u])=>u.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild((u=>{r.push(u.serialize())})),r}}var f=E;class d{constructor(r,u,h,g){this.type=r,this.input=u,this.beginIndex=h,this.endIndex=g}static parse(r,u){if(r.length<=2||r.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=u.parse(r[1],1,Ri),g=u.parse(r[2],2,lr);if(!h||!g)return null;if(!mu(h.type,[ko(Ri),Wr,Ri]))return u.error(`Expected first argument to be of type array or string, but found ${ss(h.type)} instead`);if(r.length===4){const w=u.parse(r[3],3,lr);return w?new d(h.type,h,g,w):null}return new d(h.type,h,g)}evaluate(r){const u=this.input.evaluate(r),h=this.beginIndex.evaluate(r);if(!Us(u,["string","array"]))throw new os(`Expected first argument to be of type array or string, but found ${ss(Ts(u))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(r);return u.slice(h,g)}return u.slice(h)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var S=d;function N(o,r){return o==="=="||o==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function X(o,r,u,h){return h.compare(r,u)===0}function he(o,r,u){const h=o!=="=="&&o!=="!=";return class iC{constructor(w,A,k){this.type=Ur,this.lhs=w,this.rhs=A,this.collator=k,this.hasUntypedArgument=w.type.kind==="value"||A.type.kind==="value"}static parse(w,A){if(w.length!==3&&w.length!==4)return A.error("Expected two or three arguments.");const k=w[0];let F=A.parse(w[1],1,Ri);if(!F)return null;if(!N(k,F.type))return A.concat(1).error(`"${k}" comparisons are not supported for type '${ss(F.type)}'.`);let z=A.parse(w[2],2,Ri);if(!z)return null;if(!N(k,z.type))return A.concat(2).error(`"${k}" comparisons are not supported for type '${ss(z.type)}'.`);if(F.type.kind!==z.type.kind&&F.type.kind!=="value"&&z.type.kind!=="value")return A.error(`Cannot compare types '${ss(F.type)}' and '${ss(z.type)}'.`);h&&(F.type.kind==="value"&&z.type.kind!=="value"?F=new ya(z.type,[F]):F.type.kind!=="value"&&z.type.kind==="value"&&(z=new ya(F.type,[z])));let K=null;if(w.length===4){if(F.type.kind!=="string"&&z.type.kind!=="string"&&F.type.kind!=="value"&&z.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if(K=A.parse(w[3],3,Hi),!K)return null}return new iC(F,z,K)}evaluate(w){const A=this.lhs.evaluate(w),k=this.rhs.evaluate(w);if(h&&this.hasUntypedArgument){const F=Ts(A),z=Ts(k);if(F.kind!==z.kind||F.kind!=="string"&&F.kind!=="number")throw new os(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${F.kind}, ${z.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const F=Ts(A),z=Ts(k);if(F.kind!=="string"||z.kind!=="string")return r(w,A,k)}return this.collator?u(w,A,k,this.collator.evaluate(w)):r(w,A,k)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}serialize(){const w=[o];return this.eachChild((A=>{w.push(A.serialize())})),w}}}const Ae=he("==",(function(o,r,u){return r===u}),X),Ye=he("!=",(function(o,r,u){return r!==u}),(function(o,r,u,h){return!X(0,r,u,h)})),bt=he("<",(function(o,r,u){return r<u}),(function(o,r,u,h){return h.compare(r,u)<0})),an=he(">",(function(o,r,u){return r>u}),(function(o,r,u,h){return h.compare(r,u)>0})),mn=he("<=",(function(o,r,u){return r<=u}),(function(o,r,u,h){return h.compare(r,u)<=0})),Kn=he(">=",(function(o,r,u){return r>=u}),(function(o,r,u,h){return h.compare(r,u)>=0}));class Pr{constructor(r,u,h,g,w,A){this.type=Wr,this.number=r,this.locale=u,this.currency=h,this.unit=g,this.minFractionDigits=w,this.maxFractionDigits=A}static parse(r,u){if(r.length!==3)return u.error("Expected two arguments.");const h=u.parse(r[1],1,lr);if(!h)return null;const g=r[2];if(typeof g!="object"||Array.isArray(g))return u.error("NumberFormat options argument must be an object.");let w=null;if(g.locale&&(w=u.parse(g.locale,1,Wr),!w))return null;let A=null;if(g.currency&&(A=u.parse(g.currency,1,Wr),!A))return null;let k=null;if(g.unit&&(k=u.parse(g.unit,1,Wr),!k))return null;let F=null;if(g["min-fraction-digits"]&&(F=u.parse(g["min-fraction-digits"],1,lr),!F))return null;let z=null;return g["max-fraction-digits"]&&(z=u.parse(g["max-fraction-digits"],1,lr),!z)?null:new Pr(h,w,A,k,F,z)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Yr{constructor(r){this.type=lr,this.input=r}static parse(r,u){if(r.length!==2)return u.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=u.parse(r[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${ss(h.type)} instead.`):new Yr(h):null}evaluate(r){const u=this.input.evaluate(r);if(typeof u=="string"||Array.isArray(u))return u.length;throw new os(`Expected value to be of type string or array, but found ${ss(Ts(u))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild((u=>{r.push(u.serialize())})),r}}const yi={"==":Ae,"!=":Ye,">":an,"<":bt,">=":Kn,"<=":mn,array:ya,at:sc,boolean:ya,case:f,coalesce:No,collator:zo,format:ol,image:Al,in:zl,"index-of":Jl,interpolate:ll,"interpolate-hcl":ll,"interpolate-lab":ll,length:Yr,let:Ra,literal:ra,match:oa,number:ya,"number-format":Pr,object:ya,slice:S,step:ke,string:ya,"to-boolean":qo,"to-color":qo,"to-number":qo,"to-string":qo,var:io,within:fo};function Ms(o,[r,u,h,g]){r=r.evaluate(o),u=u.evaluate(o),h=h.evaluate(o);const w=g?g.evaluate(o):1,A=Es(r,u,h,w);if(A)throw new os(A);return new Vs(r/255*w,u/255*w,h/255*w,w)}function Xi(o,r){return o in r}function Ds(o,r){const u=r[o];return u===void 0?null:u}function As(o){return{type:o}}_a.register(yi,{error:[{kind:"error"},[Wr],(o,[r])=>{throw new os(r.evaluate(o))}],typeof:[Wr,[Ri],(o,[r])=>ss(Ts(r.evaluate(o)))],"to-rgba":[ko(lr,4),[ca],(o,[r])=>r.evaluate(o).toArray()],rgb:[ca,[lr,lr,lr],Ms],rgba:[ca,[lr,lr,lr,lr],Ms],has:{type:Ur,overloads:[[[Wr],(o,[r])=>Xi(r.evaluate(o),o.properties())],[[Wr,$a],(o,[r,u])=>Xi(r.evaluate(o),u.evaluate(o))]]},get:{type:Ri,overloads:[[[Wr],(o,[r])=>Ds(r.evaluate(o),o.properties())],[[Wr,$a],(o,[r,u])=>Ds(r.evaluate(o),u.evaluate(o))]]},"feature-state":[Ri,[Wr],(o,[r])=>Ds(r.evaluate(o),o.featureState||{})],properties:[$a,[],o=>o.properties()],"geometry-type":[Wr,[],o=>o.geometryType()],id:[Ri,[],o=>o.id()],zoom:[lr,[],o=>o.globals.zoom],pitch:[lr,[],o=>o.globals.pitch||0],"distance-from-center":[lr,[],o=>o.distanceFromCenter()],"heatmap-density":[lr,[],o=>o.globals.heatmapDensity||0],"line-progress":[lr,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[lr,[],o=>o.globals.skyRadialProgress||0],accumulated:[Ri,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[lr,As(lr),(o,r)=>{let u=0;for(const h of r)u+=h.evaluate(o);return u}],"*":[lr,As(lr),(o,r)=>{let u=1;for(const h of r)u*=h.evaluate(o);return u}],"-":{type:lr,overloads:[[[lr,lr],(o,[r,u])=>r.evaluate(o)-u.evaluate(o)],[[lr],(o,[r])=>-r.evaluate(o)]]},"/":[lr,[lr,lr],(o,[r,u])=>r.evaluate(o)/u.evaluate(o)],"%":[lr,[lr,lr],(o,[r,u])=>r.evaluate(o)%u.evaluate(o)],ln2:[lr,[],()=>Math.LN2],pi:[lr,[],()=>Math.PI],e:[lr,[],()=>Math.E],"^":[lr,[lr,lr],(o,[r,u])=>Math.pow(r.evaluate(o),u.evaluate(o))],sqrt:[lr,[lr],(o,[r])=>Math.sqrt(r.evaluate(o))],log10:[lr,[lr],(o,[r])=>Math.log(r.evaluate(o))/Math.LN10],ln:[lr,[lr],(o,[r])=>Math.log(r.evaluate(o))],log2:[lr,[lr],(o,[r])=>Math.log(r.evaluate(o))/Math.LN2],sin:[lr,[lr],(o,[r])=>Math.sin(r.evaluate(o))],cos:[lr,[lr],(o,[r])=>Math.cos(r.evaluate(o))],tan:[lr,[lr],(o,[r])=>Math.tan(r.evaluate(o))],asin:[lr,[lr],(o,[r])=>Math.asin(r.evaluate(o))],acos:[lr,[lr],(o,[r])=>Math.acos(r.evaluate(o))],atan:[lr,[lr],(o,[r])=>Math.atan(r.evaluate(o))],min:[lr,As(lr),(o,r)=>Math.min(...r.map((u=>u.evaluate(o))))],max:[lr,As(lr),(o,r)=>Math.max(...r.map((u=>u.evaluate(o))))],abs:[lr,[lr],(o,[r])=>Math.abs(r.evaluate(o))],round:[lr,[lr],(o,[r])=>{const u=r.evaluate(o);return u<0?-Math.round(-u):Math.round(u)}],floor:[lr,[lr],(o,[r])=>Math.floor(r.evaluate(o))],ceil:[lr,[lr],(o,[r])=>Math.ceil(r.evaluate(o))],"filter-==":[Ur,[Wr,Ri],(o,[r,u])=>o.properties()[r.value]===u.value],"filter-id-==":[Ur,[Ri],(o,[r])=>o.id()===r.value],"filter-type-==":[Ur,[Wr],(o,[r])=>o.geometryType()===r.value],"filter-<":[Ur,[Wr,Ri],(o,[r,u])=>{const h=o.properties()[r.value],g=u.value;return typeof h==typeof g&&h<g}],"filter-id-<":[Ur,[Ri],(o,[r])=>{const u=o.id(),h=r.value;return typeof u==typeof h&&u<h}],"filter->":[Ur,[Wr,Ri],(o,[r,u])=>{const h=o.properties()[r.value],g=u.value;return typeof h==typeof g&&h>g}],"filter-id->":[Ur,[Ri],(o,[r])=>{const u=o.id(),h=r.value;return typeof u==typeof h&&u>h}],"filter-<=":[Ur,[Wr,Ri],(o,[r,u])=>{const h=o.properties()[r.value],g=u.value;return typeof h==typeof g&&h<=g}],"filter-id-<=":[Ur,[Ri],(o,[r])=>{const u=o.id(),h=r.value;return typeof u==typeof h&&u<=h}],"filter->=":[Ur,[Wr,Ri],(o,[r,u])=>{const h=o.properties()[r.value],g=u.value;return typeof h==typeof g&&h>=g}],"filter-id->=":[Ur,[Ri],(o,[r])=>{const u=o.id(),h=r.value;return typeof u==typeof h&&u>=h}],"filter-has":[Ur,[Ri],(o,[r])=>r.value in o.properties()],"filter-has-id":[Ur,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Ur,[ko(Wr)],(o,[r])=>r.value.indexOf(o.geometryType())>=0],"filter-id-in":[Ur,[ko(Ri)],(o,[r])=>r.value.indexOf(o.id())>=0],"filter-in-small":[Ur,[Wr,ko(Ri)],(o,[r,u])=>u.value.indexOf(o.properties()[r.value])>=0],"filter-in-large":[Ur,[Wr,ko(Ri)],(o,[r,u])=>(function(h,g,w,A){for(;w<=A;){const k=w+A>>1;if(g[k]===h)return!0;g[k]>h?A=k-1:w=k+1}return!1})(o.properties()[r.value],u.value,0,u.value.length-1)],all:{type:Ur,overloads:[[[Ur,Ur],(o,[r,u])=>r.evaluate(o)&&u.evaluate(o)],[As(Ur),(o,r)=>{for(const u of r)if(!u.evaluate(o))return!1;return!0}]]},any:{type:Ur,overloads:[[[Ur,Ur],(o,[r,u])=>r.evaluate(o)||u.evaluate(o)],[As(Ur),(o,r)=>{for(const u of r)if(u.evaluate(o))return!0;return!1}]]},"!":[Ur,[Ur],(o,[r])=>!r.evaluate(o)],"is-supported-script":[Ur,[Wr],(o,[r])=>{const u=o.globals&&o.globals.isSupportedScript;return!u||u(r.evaluate(o))}],upcase:[Wr,[Wr],(o,[r])=>r.evaluate(o).toUpperCase()],downcase:[Wr,[Wr],(o,[r])=>r.evaluate(o).toLowerCase()],concat:[Wr,As(Ri),(o,r)=>r.map((u=>Ol(u.evaluate(o)))).join("")],"resolved-locale":[Wr,[Hi],(o,[r])=>r.evaluate(o).resolvedLocale()]});var Xo=yi;function cl(o){return{result:"success",value:o}}function Ma(o){return{result:"error",value:o}}function Go(o){return o["property-type"]==="data-driven"}function _c(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function ri(o){return!!o.expression&&o.expression.interpolated}function gs(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function oc(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function Xa(o){return o}function Ya(o,r){const u=r.type==="color",h=o.stops&&typeof o.stops[0][0]=="object",g=h||!(h||o.property!==void 0),w=o.type||(ri(r)?"exponential":"interval");if(u&&((o=co({},o)).stops&&(o.stops=o.stops.map((z=>[z[0],Vs.parse(z[1])]))),o.default=Vs.parse(o.default?o.default:r.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!Hu[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let A,k,F;if(w==="exponential")A=Ka;else if(w==="interval")A=Wu;else if(w==="categorical"){A=jl,k=Object.create(null);for(const z of o.stops)k[z[0]]=z[1];F=typeof o.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);A=kh}if(h){const z={},K=[];for(let we=0;we<o.stops.length;we++){const Te=o.stops[we],Re=Te[0].zoom;z[Re]===void 0&&(z[Re]={zoom:Re,type:o.type,property:o.property,default:o.default,stops:[]},K.push(Re)),z[Re].stops.push([Te[0].value,Te[1]])}const re=[];for(const we of K)re.push([z[we].zoom,Ya(z[we],r)]);const fe={name:"linear"};return{kind:"composite",interpolationType:fe,interpolationFactor:ll.interpolationFactor.bind(void 0,fe),zoomStops:re.map((we=>we[0])),evaluate:({zoom:we},Te)=>Ka({stops:re,base:o.base},r,we).evaluate(we,Te)}}if(g){const z=w==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:ll.interpolationFactor.bind(void 0,z),zoomStops:o.stops.map((K=>K[0])),evaluate:({zoom:K})=>A(o,r,K,k,F)}}return{kind:"source",evaluate(z,K){const re=K&&K.properties?K.properties[o.property]:void 0;return re===void 0?ba(o.default,r.default):A(o,r,re,k,F)}}}function ba(o,r,u){return o!==void 0?o:r!==void 0?r:u!==void 0?u:void 0}function jl(o,r,u,h,g){return ba(typeof u===g?h[u]:void 0,o.default,r.default)}function Wu(o,r,u){if(gs(u)!=="number")return ba(o.default,r.default);const h=o.stops.length;if(h===1||u<=o.stops[0][0])return o.stops[0][1];if(u>=o.stops[h-1][0])return o.stops[h-1][1];const g=O(o.stops.map((w=>w[0])),u);return o.stops[g][1]}function Ka(o,r,u){const h=o.base!==void 0?o.base:1;if(gs(u)!=="number")return ba(o.default,r.default);const g=o.stops.length;if(g===1||u<=o.stops[0][0])return o.stops[0][1];if(u>=o.stops[g-1][0])return o.stops[g-1][1];const w=O(o.stops.map((K=>K[0])),u),A=(function(K,re,fe,we){const Te=we-fe,Re=K-fe;return Te===0?0:re===1?Re/Te:(Math.pow(re,Re)-1)/(Math.pow(re,Te)-1)})(u,h,o.stops[w][0],o.stops[w+1][0]),k=o.stops[w][1],F=o.stops[w+1][1];let z=hn[r.type]||Xa;if(o.colorSpace&&o.colorSpace!=="rgb"){const K=Hu[o.colorSpace];z=(re,fe)=>K.reverse(K.interpolate(K.forward(re),K.forward(fe),A))}return typeof k.evaluate=="function"?{evaluate(...K){const re=k.evaluate.apply(void 0,K),fe=F.evaluate.apply(void 0,K);if(re!==void 0&&fe!==void 0)return z(re,fe,A)}}:z(k,F,A)}function kh(o,r,u){return r.type==="color"?u=Vs.parse(u):r.type==="formatted"?u=Fs.fromString(u.toString()):r.type==="resolvedImage"?u=na.fromString(u.toString()):gs(u)===r.type||r.type==="enum"&&r.values[u]||(u=void 0),ba(u,o.default,r.default)}class ac{constructor(r,u){this.expression=r,this._warningHistory={},this._evaluator=new qs,this._defaultValue=u?(function(h){return h.type==="color"&&(oc(h.default)||Array.isArray(h.default))?new Vs(0,0,0,0):h.type==="color"?Vs.parse(h.default)||null:h.default===void 0?null:h.default})(u):null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(r,u,h,g,w,A,k,F){return this._evaluator.globals=r,this._evaluator.feature=u,this._evaluator.featureState=h,this._evaluator.canonical=g||null,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=A,this._evaluator.featureTileCoord=k||null,this._evaluator.featureDistanceData=F||null,this.expression.evaluate(this._evaluator)}evaluate(r,u,h,g,w,A,k,F){this._evaluator.globals=r,this._evaluator.feature=u||null,this._evaluator.featureState=h||null,this._evaluator.canonical=g||null,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=A||null,this._evaluator.featureTileCoord=k||null,this._evaluator.featureDistanceData=F||null;try{const z=this.expression.evaluate(this._evaluator);if(z==null||typeof z=="number"&&z!=z)return this._defaultValue;if(this._enumValues&&!(z in this._enumValues))throw new os(`Expected value to be one of ${Object.keys(this._enumValues).map((K=>JSON.stringify(K))).join(", ")}, but found ${JSON.stringify(z)} instead.`);return z}catch(z){return this._warningHistory[z.message]||(this._warningHistory[z.message]=!0,typeof console<"u"&&console.warn(z.message)),this._defaultValue}}}function Dr(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Xo}function Is(o,r){const u=new Fl(Xo,[],r?(function(g){const w={color:ca,string:Wr,number:lr,enum:Wr,boolean:Ur,formatted:Tl,resolvedImage:Wi};return g.type==="array"?ko(w[g.value]||Ri,g.length):w[g.type]})(r):void 0),h=u.parse(o,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?cl(new ac(h,r)):Ma(u.errors)}class Ql{constructor(r,u){this.kind=r,this._styleExpression=u,this.isStateDependent=r!=="constant"&&!Zs(u.expression)}evaluateWithoutErrorHandling(r,u,h,g,w,A){return this._styleExpression.evaluateWithoutErrorHandling(r,u,h,g,w,A)}evaluate(r,u,h,g,w,A){return this._styleExpression.evaluate(r,u,h,g,w,A)}}class vc{constructor(r,u,h,g){this.kind=r,this.zoomStops=h,this._styleExpression=u,this.isStateDependent=r!=="camera"&&!Zs(u.expression),this.interpolationType=g}evaluateWithoutErrorHandling(r,u,h,g,w,A){return this._styleExpression.evaluateWithoutErrorHandling(r,u,h,g,w,A)}evaluate(r,u,h,g,w,A){return this._styleExpression.evaluate(r,u,h,g,w,A)}interpolationFactor(r,u,h){return this.interpolationType?ll.interpolationFactor(this.interpolationType,r,u,h):0}}function Mu(o,r){if((o=Is(o,r)).result==="error")return o;const u=o.value.expression,h=Ys(u);if(!h&&!Go(r))return Ma([new rl("","data expressions not supported")]);const g=go(u,["zoom","pitch","distance-from-center"]);if(!g&&!_c(r))return Ma([new rl("","zoom expressions not supported")]);const w=bc(u);return w||g?w instanceof rl?Ma([w]):w instanceof ll&&!ri(r)?Ma([new rl("",'"interpolate" expressions cannot be used with this property')]):cl(w?new vc(h?"camera":"composite",o.value,w.labels,w instanceof ll?w.interpolation:void 0):new Ql(h?"constant":"source",o.value)):Ma([new rl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class xc{constructor(r,u){this._parameters=r,this._specification=u,co(this,Ya(this._parameters,this._specification))}static deserialize(r){return new xc(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function bc(o){let r=null;if(o instanceof Ra)r=bc(o.result);else if(o instanceof No){for(const u of o.args)if(r=bc(u),r)break}else(o instanceof ke||o instanceof ll)&&o.input instanceof _a&&o.input.name==="zoom"&&(r=o);return r instanceof rl||o.eachChild((u=>{const h=bc(u);h instanceof rl?r=h:!r&&h?r=new rl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&h&&r!==h&&(r=new rl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),r}class jn{constructor(r,u,h,g){this.message=(r?`${r}: `:"")+h,g&&(this.identifier=g),u!=null&&u.__line__&&(this.line=u.__line__)}}function pa(o){const r=o.key,u=o.value,h=o.valueSpec||{},g=o.objectElementValidators||{},w=o.style,A=o.styleSpec;let k=[];const F=gs(u);if(F!=="object")return[new jn(r,u,`object expected, ${F} found`)];for(const z in u){const K=z.split(".")[0];let re;g[K]?re=g[K]:h[K]?re=fs:g["*"]?re=g["*"]:h["*"]&&(re=fs),re?k=k.concat(re({key:(r&&`${r}.`)+z,value:u[z],valueSpec:h[K]||h["*"],style:w,styleSpec:A,object:u,objectKey:z},u)):k.push(new jn(r,u[z],`unknown property "${z}"`))}for(const z in h)g[z]||h[z].required&&h[z].default===void 0&&u[z]===void 0&&k.push(new jn(r,u,`missing required property "${z}"`));return k}function Co(o){const r=o.value,u=o.valueSpec,h=o.style,g=o.styleSpec,w=o.key,A=o.arrayElementValidator||fs;if(gs(r)!=="array")return[new jn(w,r,`array expected, ${gs(r)} found`)];if(u.length&&r.length!==u.length)return[new jn(w,r,`array length ${u.length} expected, length ${r.length} found`)];if(u["min-length"]&&r.length<u["min-length"])return[new jn(w,r,`array length at least ${u["min-length"]} expected, length ${r.length} found`)];let k={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};g.$version<7&&(k.function=u.function),gs(u.value)==="object"&&(k=u.value);let F=[];for(let z=0;z<r.length;z++)F=F.concat(A({array:r,arrayIndex:z,value:r[z],valueSpec:k,style:h,styleSpec:g,key:`${w}[${z}]`}));return F}function uu(o){const r=o.key,u=o.value,h=o.valueSpec;let g=gs(u);if(g==="number"&&u!=u&&(g="NaN"),g!=="number")return[new jn(r,u,`number expected, ${g} found`)];if("minimum"in h){let w=h.minimum;if(gs(h.minimum)==="array"&&(w=h.minimum[o.arrayIndex]),u<w)return[new jn(r,u,`${u} is less than the minimum value ${w}`)]}if("maximum"in h){let w=h.maximum;if(gs(h.maximum)==="array"&&(w=h.maximum[o.arrayIndex]),u>w)return[new jn(r,u,`${u} is greater than the maximum value ${w}`)]}return[]}function hl(o){const r=o.valueSpec,u=Io(o.value.type);let h,g,w,A={};const k=u!=="categorical"&&o.value.property===void 0,F=!k,z=gs(o.value.stops)==="array"&&gs(o.value.stops[0])==="array"&&gs(o.value.stops[0][0])==="object",K=pa({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(we){if(u==="identity")return[new jn(we.key,we.value,'identity function may not have a "stops" property')];let Te=[];const Re=we.value;return Te=Te.concat(Co({key:we.key,value:Re,valueSpec:we.valueSpec,style:we.style,styleSpec:we.styleSpec,arrayElementValidator:re})),gs(Re)==="array"&&Re.length===0&&Te.push(new jn(we.key,Re,"array must have at least one stop")),Te},default:function(we){return fs({key:we.key,value:we.value,valueSpec:r,style:we.style,styleSpec:we.styleSpec})}}});return u==="identity"&&k&&K.push(new jn(o.key,o.value,'missing required property "property"')),u==="identity"||o.value.stops||K.push(new jn(o.key,o.value,'missing required property "stops"')),u==="exponential"&&o.valueSpec.expression&&!ri(o.valueSpec)&&K.push(new jn(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(F&&!Go(o.valueSpec)?K.push(new jn(o.key,o.value,"property functions not supported")):k&&!_c(o.valueSpec)&&K.push(new jn(o.key,o.value,"zoom functions not supported"))),u!=="categorical"&&!z||o.value.property!==void 0||K.push(new jn(o.key,o.value,'"property" property is required')),K;function re(we){let Te=[];const Re=we.value,st=we.key;if(gs(Re)!=="array")return[new jn(st,Re,`array expected, ${gs(Re)} found`)];if(Re.length!==2)return[new jn(st,Re,`array length 2 expected, length ${Re.length} found`)];if(z){if(gs(Re[0])!=="object")return[new jn(st,Re,`object expected, ${gs(Re[0])} found`)];if(Re[0].zoom===void 0)return[new jn(st,Re,"object stop key must have zoom")];if(Re[0].value===void 0)return[new jn(st,Re,"object stop key must have value")];const _t=Io(Re[0].zoom);if(typeof _t!="number")return[new jn(st,Re[0].zoom,"stop zoom values must be numbers")];if(w&&w>_t)return[new jn(st,Re[0].zoom,"stop zoom values must appear in ascending order")];_t!==w&&(w=_t,g=void 0,A={}),Te=Te.concat(pa({key:`${st}[0]`,value:Re[0],valueSpec:{zoom:{}},style:we.style,styleSpec:we.styleSpec,objectElementValidators:{zoom:uu,value:fe}}))}else Te=Te.concat(fe({key:`${st}[0]`,value:Re[0],style:we.style,styleSpec:we.styleSpec},Re));return Dr(Ni(Re[1]))?Te.concat([new jn(`${st}[1]`,Re[1],"expressions are not allowed in function stops.")]):Te.concat(fs({key:`${st}[1]`,value:Re[1],valueSpec:r,style:we.style,styleSpec:we.styleSpec}))}function fe(we,Te){const Re=gs(we.value),st=Io(we.value),_t=we.value!==null?we.value:Te;if(h){if(Re!==h)return[new jn(we.key,_t,`${Re} stop domain type must match previous stop domain type ${h}`)]}else h=Re;if(Re!=="number"&&Re!=="string"&&Re!=="boolean"&&typeof st!="number"&&typeof st!="string"&&typeof st!="boolean")return[new jn(we.key,_t,"stop domain value must be a number, string, or boolean")];if(Re!=="number"&&u!=="categorical"){let Rt=`number expected, ${Re} found`;return Go(r)&&u===void 0&&(Rt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new jn(we.key,_t,Rt)]}return u!=="categorical"||Re!=="number"||typeof st=="number"&&isFinite(st)&&Math.floor(st)===st?u!=="categorical"&&Re==="number"&&typeof st=="number"&&typeof g=="number"&&g!==void 0&&st<g?[new jn(we.key,_t,"stop domain values must appear in ascending order")]:(g=st,u==="categorical"&&st in A?[new jn(we.key,_t,"stop domain values must be unique")]:(A[st]=!0,[])):[new jn(we.key,_t,`integer expected, found ${String(st)}`)]}}function Ji(o){const r=(o.expressionContext==="property"?Mu:Is)(Ni(o.value),o.valueSpec);if(r.result==="error")return r.value.map((h=>new jn(`${o.key}${h.key}`,o.value,h.message)));const u=r.value.expression||r.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!u.outputDefined())return[new jn(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Zs(u))return[new jn(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter")return Za(u,o);if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!go(u,["zoom","feature-state"]))return[new jn(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Ys(u))return[new jn(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Za(o,r){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const g of r.valueSpec.expression.parameters)u.delete(g);if(u.size===0)return[];const h=[];return o instanceof _a&&u.has(o.name)?[new jn(r.key,r.value,`["${o.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(o.eachChild((g=>{h.push(...Za(g,r))})),h)}function qh(o){const r=o.key,u=o.value,h=o.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(Io(u))===-1&&g.push(new jn(r,u,`expected one of [${h.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(h.values).indexOf(Io(u))===-1&&g.push(new jn(r,u,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(u)} found`)),g}function Lh(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const r of o.slice(1))if(!Lh(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function Si(o,r="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Lh(o)||(o=Hc(o));const u=o;let h=!0;try{h=(function(z){if(!Da(z))return z;let K=Ni(z);return Gh(K),K=Mc(K),K})(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}const g=En[`filter_${r}`],w=Is(h,g);let A=null;if(w.result==="error")throw new Error(w.value.map((z=>`${z.key}: ${z.message}`)).join(", "));A=(z,K,re)=>w.value.evaluate(z,K,{},re);let k=null,F=null;if(h!==u){const z=Is(u,g);if(z.result==="error")throw new Error(z.value.map((K=>`${K.key}: ${K.message}`)).join(", "));k=(K,re,fe,we,Te)=>z.value.evaluate(K,re,{},fe,void 0,void 0,we,Te),F=!Ys(z.value.expression)}return{filter:A,dynamicFilter:k||void 0,needGeometry:lc(h),needFeature:!!F}}function Mc(o){if(!Array.isArray(o))return o;const r=(function(u){if(Ul.has(u[0])){for(let h=1;h<u.length;h++)if(Da(u[h]))return!0}return u})(o);return r===!0?r:r.map((u=>Mc(u)))}function Gh(o){let r=!1;const u=[];if(o[0]==="case"){for(let h=1;h<o.length-1;h+=2)r=r||Da(o[h]),u.push(o[h+1]);u.push(o[o.length-1])}else if(o[0]==="match"){r=r||Da(o[1]);for(let h=2;h<o.length-1;h+=2)u.push(o[h+1]);u.push(o[o.length-1])}else if(o[0]==="step"){r=r||Da(o[1]);for(let h=1;h<o.length-1;h+=2)u.push(o[h+1])}r&&(o.length=0,o.push("any",...u));for(let h=1;h<o.length;h++)Gh(o[h])}function Da(o){if(!Array.isArray(o))return!1;if((r=o[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let u=1;u<o.length;u++)if(Da(o[u]))return!0;return!1}const Ul=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function $h(o,r){return o<r?-1:o>r?1:0}function lc(o){if(!Array.isArray(o))return!1;if(o[0]==="within")return!0;for(let r=1;r<o.length;r++)if(lc(o[r]))return!0;return!1}function Hc(o){if(!o)return!0;const r=o[0];return o.length<=1?r!=="any":r==="=="?Af(o[1],o[2],"=="):r==="!="?Ja(Af(o[1],o[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Af(o[1],o[2],r):r==="any"?(u=o.slice(1),["any"].concat(u.map(Hc))):r==="all"?["all"].concat(o.slice(1).map(Hc)):r==="none"?["all"].concat(o.slice(1).map(Hc).map(Ja)):r==="in"?Il(o[1],o.slice(2)):r==="!in"?Ja(Il(o[1],o.slice(2))):r==="has"?as(o[1]):r==="!has"?Ja(as(o[1])):r!=="within"||o;var u}function Af(o,r,u){switch(o){case"$type":return[`filter-type-${u}`,r];case"$id":return[`filter-id-${u}`,r];default:return[`filter-${u}`,o,r]}}function Il(o,r){if(r.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some((u=>typeof u!=typeof r[0]))?["filter-in-large",o,["literal",r.sort($h)]]:["filter-in-small",o,["literal",r]]}}function as(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Ja(o){return["!",o]}function Cl(o){return Lh(Ni(o.value))?Ji(co({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):wc(o)}function wc(o){const r=o.value,u=o.key;if(gs(r)!=="array")return[new jn(u,r,`array expected, ${gs(r)} found`)];const h=o.styleSpec;let g,w=[];if(r.length<1)return[new jn(u,r,"filter array must have at least 1 element")];switch(w=w.concat(qh({key:`${u}[0]`,value:r[0],valueSpec:h.filter_operator,style:o.style,styleSpec:o.styleSpec})),Io(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Io(r[1])==="$type"&&w.push(new jn(u,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&w.push(new jn(u,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(g=gs(r[1]),g!=="string"&&w.push(new jn(`${u}[1]`,r[1],`string expected, ${g} found`)));for(let A=2;A<r.length;A++)g=gs(r[A]),Io(r[1])==="$type"?w=w.concat(qh({key:`${u}[${A}]`,value:r[A],valueSpec:h.geometry_type,style:o.style,styleSpec:o.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&w.push(new jn(`${u}[${A}]`,r[A],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let A=1;A<r.length;A++)w=w.concat(wc({key:`${u}[${A}]`,value:r[A],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":g=gs(r[1]),r.length!==2?w.push(new jn(u,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="string"&&w.push(new jn(`${u}[1]`,r[1],`string expected, ${g} found`));break;case"within":g=gs(r[1]),r.length!==2?w.push(new jn(u,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="object"&&w.push(new jn(`${u}[1]`,r[1],`object expected, ${g} found`))}return w}function Cs(o,r){const u=o.key,h=o.style,g=o.styleSpec,w=o.value,A=o.objectKey,k=g[`${r}_${o.layerType}`];if(!k)return[];const F=A.match(/^(.*)-transition$/);if(r==="paint"&&F&&k[F[1]]&&k[F[1]].transition)return fs({key:u,value:w,valueSpec:g.transition,style:h,styleSpec:g});const z=o.valueSpec||k[A];if(!z)return[new jn(u,w,`unknown property "${A}"`)];let K;if(gs(w)==="string"&&Go(z)&&!z.tokens&&(K=/^{([^}]+)}$/.exec(w))){const fe=`\`{ "type": "identity", "property": ${K?JSON.stringify(K[1]):'"_"'} }\``;return[new jn(u,w,`"${A}" does not support interpolation syntax
Use an identity property function instead: ${fe}.`)]}const re=[];return o.layerType==="symbol"&&(A==="text-field"&&h&&!h.glyphs&&re.push(new jn(u,w,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&oc(Ni(w))&&Io(w.type)==="identity"&&re.push(new jn(u,w,'"text-font" does not support identity functions'))),re.concat(fs({key:o.key,value:w,valueSpec:z,style:h,styleSpec:g,expressionContext:"property",propertyType:r,propertyKey:A}))}function cu(o){return Cs(o,"paint")}function Hh(o){return Cs(o,"layout")}function _d(o){let r=[];const u=o.value,h=o.key,g=o.style,w=o.styleSpec;u.type||u.ref||r.push(new jn(h,u,'either "type" or "ref" is required'));let A=Io(u.type);const k=Io(u.ref);if(u.id){const F=Io(u.id);for(let z=0;z<o.arrayIndex;z++){const K=g.layers[z];Io(K.id)===F&&r.push(new jn(h,u.id,`duplicate layer id "${u.id}", previously used at line ${K.id.__line__}`))}}if("ref"in u){let F;["type","source","source-layer","filter","layout"].forEach((z=>{z in u&&r.push(new jn(h,u[z],`"${z}" is prohibited for ref layers`))})),g.layers.forEach((z=>{Io(z.id)===k&&(F=z)})),F?F.ref?r.push(new jn(h,u.ref,"ref cannot reference another ref layer")):A=Io(F.type):typeof k=="string"&&r.push(new jn(h,u.ref,`ref layer "${k}" not found`))}else if(A!=="background"&&A!=="sky")if(u.source){const F=g.sources&&g.sources[u.source],z=F&&Io(F.type);F?z==="vector"&&A==="raster"?r.push(new jn(h,u.source,`layer "${u.id}" requires a raster source`)):z==="raster"&&A!=="raster"?r.push(new jn(h,u.source,`layer "${u.id}" requires a vector source`)):z!=="vector"||u["source-layer"]?z==="raster-dem"&&A!=="hillshade"?r.push(new jn(h,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="line"||!u.paint||!u.paint["line-gradient"]&&!u.paint["line-trim-offset"]||z==="geojson"&&F.lineMetrics||r.push(new jn(h,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new jn(h,u,`layer "${u.id}" must specify a "source-layer"`)):r.push(new jn(h,u.source,`source "${u.source}" not found`))}else r.push(new jn(h,u,'missing required property "source"'));return r=r.concat(pa({key:h,value:u,valueSpec:w.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>fs({key:`${h}.type`,value:u.type,valueSpec:w.layer.type,style:o.style,styleSpec:o.styleSpec,object:u,objectKey:"type"}),filter:F=>Cl(co({layerType:A},F)),layout:F=>pa({layer:u,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":z=>Hh(co({layerType:A},z))}}),paint:F=>pa({layer:u,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":z=>cu(co({layerType:A},z))}})}})),r}function Vl(o){const r=o.value,u=o.key,h=gs(r);return h!=="string"?[new jn(u,r,`string expected, ${h} found`)]:[]}const yl={promoteId:function({key:o,value:r}){if(gs(r)==="string")return Vl({key:o,value:r});{const u=[];for(const h in r)u.push(...Vl({key:`${o}.${h}`,value:r[h]}));return u}}};function Xu(o){const r=o.value,u=o.key,h=o.styleSpec,g=o.style;if(!r.type)return[new jn(u,r,'"type" is required')];const w=Io(r.type);let A;switch(w){case"vector":case"raster":case"raster-dem":return A=pa({key:u,value:r,valueSpec:h[`source_${w.replace("-","_")}`],style:o.style,styleSpec:h,objectElementValidators:yl}),A;case"geojson":if(A=pa({key:u,value:r,valueSpec:h.source_geojson,style:g,styleSpec:h,objectElementValidators:yl}),r.cluster)for(const k in r.clusterProperties){const[F,z]=r.clusterProperties[k],K=typeof F=="string"?[F,["accumulated"],["get",k]]:F;A.push(...Ji({key:`${u}.${k}.map`,value:z,expressionContext:"cluster-map"})),A.push(...Ji({key:`${u}.${k}.reduce`,value:K,expressionContext:"cluster-reduce"}))}return A;case"video":return pa({key:u,value:r,valueSpec:h.source_video,style:g,styleSpec:h});case"image":return pa({key:u,value:r,valueSpec:h.source_image,style:g,styleSpec:h});case"canvas":return[new jn(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qh({key:`${u}.type`,value:r.type,valueSpec:{values:cf(h)}})}}function cf(o){return o.source.reduce(((r,u)=>{const h=o[u];return h.type.type==="enum"&&(r=r.concat(Object.keys(h.type.values))),r}),[])}function Ph(o){const r=o.value,u=o.styleSpec,h=u.light,g=o.style;let w=[];const A=gs(r);if(r===void 0)return w;if(A!=="object")return w=w.concat([new jn("light",r,`object expected, ${A} found`)]),w;for(const k in r){const F=k.match(/^(.*)-transition$/);w=w.concat(F&&h[F[1]]&&h[F[1]].transition?fs({key:k,value:r[k],valueSpec:u.transition,style:g,styleSpec:u}):h[k]?fs({key:k,value:r[k],valueSpec:h[k],style:g,styleSpec:u}):[new jn(k,r[k],`unknown property "${k}"`)])}return w}function kl(o){const r=o.value,u=o.key,h=o.style,g=o.styleSpec,w=g.terrain;let A=[];const k=gs(r);if(r===void 0)return A;if(k!=="object")return A=A.concat([new jn("terrain",r,`object expected, ${k} found`)]),A;for(const F in r){const z=F.match(/^(.*)-transition$/);A=A.concat(z&&w[z[1]]&&w[z[1]].transition?fs({key:F,value:r[F],valueSpec:g.transition,style:h,styleSpec:g}):w[F]?fs({key:F,value:r[F],valueSpec:w[F],style:h,styleSpec:g}):[new jn(F,r[F],`unknown property "${F}"`)])}if(r.source){const F=h.sources&&h.sources[r.source],z=F&&Io(F.type);F?z!=="raster-dem"&&A.push(new jn(u,r.source,`terrain cannot be used with a source of type ${String(z)}, it only be used with a "raster-dem" source type`)):A.push(new jn(u,r.source,`source "${r.source}" not found`))}else A.push(new jn(u,r,'terrain is missing required property "source"'));return A}function Du(o){const r=o.value,u=o.style,h=o.styleSpec,g=h.fog;let w=[];const A=gs(r);if(r===void 0)return w;if(A!=="object")return w=w.concat([new jn("fog",r,`object expected, ${A} found`)]),w;for(const k in r){const F=k.match(/^(.*)-transition$/);w=w.concat(F&&g[F[1]]&&g[F[1]].transition?fs({key:k,value:r[k],valueSpec:h.transition,style:u,styleSpec:h}):g[k]?fs({key:k,value:r[k],valueSpec:g[k],style:u,styleSpec:h}):[new jn(k,r[k],`unknown property "${k}"`)])}return w}const So={"*":()=>[],array:Co,boolean:function(o){const r=o.value,u=o.key,h=gs(r);return h!=="boolean"?[new jn(u,r,`boolean expected, ${h} found`)]:[]},number:uu,color:function(o){const r=o.key,u=o.value,h=gs(u);return h!=="string"?[new jn(r,u,`color expected, ${h} found`)]:Ha(u)===null?[new jn(r,u,`color expected, "${u}" found`)]:[]},enum:qh,filter:Cl,function:hl,layer:_d,object:pa,source:Xu,light:Ph,terrain:kl,fog:Du,string:Vl,formatted:function(o){return Vl(o).length===0?[]:Ji(o)},resolvedImage:function(o){return Vl(o).length===0?[]:Ji(o)},projection:function(o){const r=o.value,u=o.styleSpec,h=u.projection,g=o.style;let w=[];const A=gs(r);if(A==="object")for(const k in r)w=w.concat(fs({key:k,value:r[k],valueSpec:h[k],style:g,styleSpec:u}));else A!=="string"&&(w=w.concat([new jn("projection",r,`object or string expected, ${A} found`)]));return w}};function fs(o){const r=o.value,u=o.valueSpec,h=o.styleSpec;return u.expression&&oc(Io(r))?hl(o):u.expression&&Dr(Ni(r))?Ji(o):u.type&&So[u.type]?So[u.type](o):pa(co({},o,{valueSpec:u.type?h[u.type]:u}))}function Ou(o){const r=o.value,u=o.key,h=Vl(o);return h.length||(r.indexOf("{fontstack}")===-1&&h.push(new jn(u,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&h.push(new jn(u,r,'"glyphs" url must include a "{range}" token'))),h}function ql(o,r=En){return _l(fs({key:"",value:o,valueSpec:r.$root,styleSpec:r,style:o,objectElementValidators:{glyphs:Ou,"*":()=>[]}}))}const vu=o=>_l(cu(o)),uh=o=>_l(Hh(o));function _l(o){return o.slice().sort(((r,u)=>r.line&&u.line?r.line-u.line:0))}function vl(o,r){let u=!1;if(r&&r.length)for(const h of r)o.fire(new Wo(new Error(h.message))),u=!0;return u}var hf=xu,Fu=3;function xu(o,r,u){var h=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var g=new Int32Array(this.arrayBuffer);o=g[0],this.d=(r=g[1])+2*(u=g[2]);for(var w=0;w<this.d*this.d;w++){var A=g[Fu+w],k=g[Fu+w+1];h.push(A===k?null:g.subarray(A,k))}var F=g[Fu+h.length+1];this.keys=g.subarray(g[Fu+h.length],F),this.bboxes=g.subarray(F),this.insert=this._insertReadonly}else{this.d=r+2*u;for(var z=0;z<this.d*this.d;z++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=o,this.padding=u,this.scale=r/o,this.uid=0;var K=u/r*o;this.min=-K,this.max=o+K}xu.prototype.insert=function(o,r,u,h,g){this._forEachCell(r,u,h,g,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(r),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(g)},xu.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},xu.prototype._insertCell=function(o,r,u,h,g,w){this.cells[g].push(w)},xu.prototype.query=function(o,r,u,h,g){var w=this.min,A=this.max;if(o<=w&&r<=w&&A<=u&&A<=h&&!g)return Array.prototype.slice.call(this.keys);var k=[];return this._forEachCell(o,r,u,h,this._queryCell,k,{},g),k},xu.prototype._queryCell=function(o,r,u,h,g,w,A,k){var F=this.cells[g];if(F!==null)for(var z=this.keys,K=this.bboxes,re=0;re<F.length;re++){var fe=F[re];if(A[fe]===void 0){var we=4*fe;(k?k(K[we+0],K[we+1],K[we+2],K[we+3]):o<=K[we+2]&&r<=K[we+3]&&u>=K[we+0]&&h>=K[we+1])?(A[fe]=!0,w.push(z[fe])):A[fe]=!1}}},xu.prototype._forEachCell=function(o,r,u,h,g,w,A,k){for(var F=this._convertToCellCoord(o),z=this._convertToCellCoord(r),K=this._convertToCellCoord(u),re=this._convertToCellCoord(h),fe=F;fe<=K;fe++)for(var we=z;we<=re;we++){var Te=this.d*we+fe;if((!k||k(this._convertFromCellCoord(fe),this._convertFromCellCoord(we),this._convertFromCellCoord(fe+1),this._convertFromCellCoord(we+1)))&&g.call(this,o,r,u,h,Te,w,A,k))return}},xu.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},xu.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},xu.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,r=Fu+this.cells.length+1+1,u=0,h=0;h<this.cells.length;h++)u+=this.cells[h].length;var g=new Int32Array(r+u+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var w=r,A=0;A<o.length;A++){var k=o[A];g[Fu+A]=w,g.set(k,w),w+=k.length}return g[Fu+o.length]=w,g.set(this.keys,w),g[Fu+o.length+1]=w+=this.keys.length,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer};var hu=de(hf);const ch={};function Cr(o,r,u={}){Object.defineProperty(o,"_classRegistryKey",{value:r,writeable:!1}),ch[r]={klass:o,omit:u.omit||[]}}Cr(Object,"Object"),hu.serialize=function(o,r){const u=o.toArrayBuffer();return r&&r.push(u),{buffer:u}},hu.deserialize=function(o){return new hu(o.buffer)},Object.defineProperty(hu,"name",{value:"Grid"}),Cr(hu,"Grid"),Cr(Vs,"Color"),Cr(Error,"Error"),Cr(or,"AJAXError"),Cr(na,"ResolvedImage"),Cr(xc,"StylePropertyFunction"),Cr(ac,"StyleExpression",{omit:["_evaluator"]}),Cr(vc,"ZoomDependentExpression"),Cr(Ql,"ZoomConstantExpression"),Cr(_a,"CompoundExpression",{omit:["_evaluate"]});for(const o in Xo)ch[Xo[o]._classRegistryKey]||Cr(Xo[o],`Expression${o}`);function hh(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function D(o){return T.ImageBitmap&&o instanceof T.ImageBitmap}function H(o,r){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(hh(o)||D(o))return r&&r.push(o),o;if(ArrayBuffer.isView(o)){const u=o;return r&&r.push(u.buffer),u}if(o instanceof T.ImageData)return r&&r.push(o.data.buffer),o;if(Array.isArray(o)){const u=[];for(const h of o)u.push(H(h,r));return u}if(typeof o=="object"){const u=o.constructor,h=u._classRegistryKey;if(!h)throw new Error(`can't serialize object of unregistered class ${h}`);const g=u.serialize?u.serialize(o,r):{};if(!u.serialize){for(const w in o)o.hasOwnProperty(w)&&(ch[h].omit.indexOf(w)>=0||(g[w]=H(o[w],r)));o instanceof Error&&(g.message=o.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(g.$name=h),g}throw new Error("can't serialize object of type "+typeof o)}function ue(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||hh(o)||D(o)||ArrayBuffer.isView(o)||o instanceof T.ImageData)return o;if(Array.isArray(o))return o.map(ue);if(typeof o=="object"){const r=o.$name||"Object",{klass:u}=ch[r];if(!u)throw new Error(`can't deserialize unregistered class ${r}`);if(u.deserialize)return u.deserialize(o);const h=Object.create(u.prototype);for(const g of Object.keys(o))g!=="$name"&&(h[g]=ue(o[g]));return h}throw new Error("can't deserialize object of type "+typeof o)}const pe={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Ge(o){for(const r of o)if(ht(r.charCodeAt(0)))return!0;return!1}function tt(o){for(const r of o)if(!it(r.charCodeAt(0)))return!1;return!0}function it(o){return!(pe.Arabic(o)||pe["Arabic Supplement"](o)||pe["Arabic Extended-A"](o)||pe["Arabic Presentation Forms-A"](o)||pe["Arabic Presentation Forms-B"](o))}function ht(o){return!(o!==746&&o!==747&&(o<4352||!(pe["Bopomofo Extended"](o)||pe.Bopomofo(o)||pe["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||pe["CJK Compatibility Ideographs"](o)||pe["CJK Compatibility"](o)||pe["CJK Radicals Supplement"](o)||pe["CJK Strokes"](o)||!(!pe["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||pe["CJK Unified Ideographs Extension A"](o)||pe["CJK Unified Ideographs"](o)||pe["Enclosed CJK Letters and Months"](o)||pe["Hangul Compatibility Jamo"](o)||pe["Hangul Jamo Extended-A"](o)||pe["Hangul Jamo Extended-B"](o)||pe["Hangul Jamo"](o)||pe["Hangul Syllables"](o)||pe.Hiragana(o)||pe["Ideographic Description Characters"](o)||pe.Kanbun(o)||pe["Kangxi Radicals"](o)||pe["Katakana Phonetic Extensions"](o)||pe.Katakana(o)&&o!==12540||!(!pe["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!pe["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||pe["Unified Canadian Aboriginal Syllabics"](o)||pe["Unified Canadian Aboriginal Syllabics Extended"](o)||pe["Vertical Forms"](o)||pe["Yijing Hexagram Symbols"](o)||pe["Yi Syllables"](o)||pe["Yi Radicals"](o))))}function dt(o){return!(ht(o)||(function(r){return!!(pe["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||pe["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||pe["Letterlike Symbols"](r)||pe["Number Forms"](r)||pe["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||pe["Control Pictures"](r)&&r!==9251||pe["Optical Character Recognition"](r)||pe["Enclosed Alphanumerics"](r)||pe["Geometric Shapes"](r)||pe["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||pe["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||pe["CJK Symbols and Punctuation"](r)||pe.Katakana(r)||pe["Private Use Area"](r)||pe["CJK Compatibility Forms"](r)||pe["Small Form Variants"](r)||pe["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)})(o))}function St(o){return o>=1424&&o<=2303||pe["Arabic Presentation Forms-A"](o)||pe["Arabic Presentation Forms-B"](o)}function Yt(o,r){return!(!r&&St(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||pe.Khmer(o))}function pn(o){for(const r of o)if(St(r.charCodeAt(0)))return!0;return!1}const Et="deferred",Qt="loading",gn="loaded";let Bn=null,x="unavailable",l=null;const m=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(x="error"),Bn&&Bn(o)};function b(){I.fire(new ea("pluginStateChange",{pluginStatus:x,pluginURL:l}))}const I=new ta,P=function(){return x},j=function(){if(x!==Et||!l)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");x=Qt,b(),l&&wi({url:l},(o=>{o?m(o):(x=gn,b())}))},W={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>x===gn||W.applyArabicShaping!=null,isLoading:()=>x===Qt,setState(o){x=o.pluginStatus,l=o.pluginURL},isParsed:()=>W.applyArabicShaping!=null&&W.processBidirectionalText!=null&&W.processStyledBidirectionalText!=null,getPluginURL:()=>l};class Z{constructor(r,u){this.zoom=r,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.transition=u.transition,this.pitch=u.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(r){return(function(u,h){for(const g of u)if(!Yt(g.charCodeAt(0),h))return!1;return!0})(r,W.isLoaded())}}class le{constructor(r,u){this.property=r,this.value=u,this.expression=(function(h,g){if(oc(h))return new xc(h,g);if(Dr(h)){const w=Mu(h,g);if(w.result==="error")throw new Error(w.value.map((A=>`${A.key}: ${A.message}`)).join(", "));return w.value}{let w=h;return typeof h=="string"&&g.type==="color"&&(w=Vs.parse(h)),{kind:"constant",evaluate:()=>w}}})(u===void 0?r.specification.default:u,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,u,h){return this.property.possiblyEvaluate(this,r,u,h)}}class ce{constructor(r){this.property=r,this.value=new le(r,void 0)}transitioned(r,u){return new Fe(this.property,this.value,u,Ve({},r.transition,this.transition),r.now)}untransitioned(){return new Fe(this.property,this.value,null,{},0)}}class Ee{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return on(this._values[r].value.value)}setValue(r,u){this._values.hasOwnProperty(r)||(this._values[r]=new ce(this._values[r].property)),this._values[r].value=new le(this._values[r].property,u===null?void 0:on(u))}getTransition(r){return on(this._values[r].transition)}setTransition(r,u){this._values.hasOwnProperty(r)||(this._values[r]=new ce(this._values[r].property)),this._values[r].transition=on(u)||void 0}serialize(){const r={};for(const u of Object.keys(this._values)){const h=this.getValue(u);h!==void 0&&(r[u]=h);const g=this.getTransition(u);g!==void 0&&(r[`${u}-transition`]=g)}return r}transitioned(r,u){const h=new qe(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].transitioned(r,u._values[g]);return h}untransitioned(){const r=new qe(this._properties);for(const u of Object.keys(this._values))r._values[u]=this._values[u].untransitioned();return r}}class Fe{constructor(r,u,h,g,w){const A=g.delay||0,k=g.duration||0;w=w||0,this.property=r,this.value=u,this.begin=w+A,this.end=this.begin+k,r.specification.transition&&(g.delay||g.duration)&&(this.prior=h)}possiblyEvaluate(r,u,h){const g=r.now||0,w=this.value.possiblyEvaluate(r,u,h),A=this.prior;if(A){if(g>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(g<this.begin)return A.possiblyEvaluate(r,u,h);{const k=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(A.possiblyEvaluate(r,u,h),w,$e(k))}}return w}}class qe{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,u,h){const g=new lt(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(r,u,h);return g}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class at{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return on(this._values[r].value)}setValue(r,u){this._values[r]=new le(this._values[r].property,u===null?void 0:on(u))}serialize(){const r={};for(const u of Object.keys(this._values)){const h=this.getValue(u);h!==void 0&&(r[u]=h)}return r}possiblyEvaluate(r,u,h){const g=new lt(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(r,u,h);return g}}class et{constructor(r,u,h){this.property=r,this.value=u,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,u,h,g){return this.property.evaluate(this.value,this.parameters,r,u,h,g)}}class lt{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Ie{constructor(r){this.specification=r}possiblyEvaluate(r,u){return r.expression.evaluate(u)}interpolate(r,u,h){const g=hn[this.specification.type];return g?g(r,u,h):r}}class rt{constructor(r,u){this.specification=r,this.overrides=u}possiblyEvaluate(r,u,h,g){return new et(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(u,null,{},h,g)}:r.expression,u)}interpolate(r,u,h){if(r.value.kind!=="constant"||u.value.kind!=="constant")return r;if(r.value.value===void 0||u.value.value===void 0)return new et(this,{kind:"constant",value:void 0},r.parameters);const g=hn[this.specification.type];return g?new et(this,{kind:"constant",value:g(r.value.value,u.value.value,h)},r.parameters):r}evaluate(r,u,h,g,w,A){return r.kind==="constant"?r.value:r.evaluate(u,h,g,w,A)}}class gt{constructor(r){this.specification=r}possiblyEvaluate(r,u,h,g){return!!r.expression.evaluate(u,null,{},h,g)}interpolate(){return!1}}class yt{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const u=new Z(0,{});for(const h in r){const g=r[h];g.specification.overridable&&this.overridableProperties.push(h);const w=this.defaultPropertyValues[h]=new le(g,void 0),A=this.defaultTransitionablePropertyValues[h]=new ce(g);this.defaultTransitioningPropertyValues[h]=A.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=w.possiblyEvaluate(u)}}}function Mt(o,r){return 256*(o=He(Math.floor(o),0,255))+He(Math.floor(r),0,255)}Cr(rt,"DataDrivenProperty"),Cr(Ie,"DataConstantProperty"),Cr(gt,"ColorRampProperty");const Dt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Nt{constructor(r,u){this._structArray=r,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class qt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,u){return r._trim(),u&&(r.isTransferred=!0,u.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const u=Object.create(this.prototype);return u.arrayBuffer=r.arrayBuffer,u.length=r.length,u.capacity=r.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Bt(o,r=1){let u=0,h=0;return{members:o.map((g=>{const w=Dt[g.type].BYTES_PER_ELEMENT,A=u=rn(u,Math.max(r,w)),k=g.components||1;return h=Math.max(h,w),u+=w*k,{name:g.name,type:g.type,components:k,offset:A}})),size:rn(u,Math.max(h,r)),alignment:r}}function rn(o,r){return Math.ceil(o/r)*r}class Rn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,u)}emplace(r,u,h){const g=2*r;return this.int16[g+0]=u,this.int16[g+1]=h,r}}Rn.prototype.bytesPerElement=4,Cr(Rn,"StructArrayLayout2i4");class Jt extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,h)}emplace(r,u,h,g){const w=3*r;return this.int16[w+0]=u,this.int16[w+1]=h,this.int16[w+2]=g,r}}Jt.prototype.bytesPerElement=6,Cr(Jt,"StructArrayLayout3i6");class An extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,r,u,h,g)}emplace(r,u,h,g,w){const A=4*r;return this.int16[A+0]=u,this.int16[A+1]=h,this.int16[A+2]=g,this.int16[A+3]=w,r}}An.prototype.bytesPerElement=8,Cr(An,"StructArrayLayout4i8");class cn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,h,g,w,A,k){const F=this.length;return this.resize(F+1),this.emplace(F,r,u,h,g,w,A,k)}emplace(r,u,h,g,w,A,k,F){const z=6*r,K=12*r,re=3*r;return this.int16[z+0]=u,this.int16[z+1]=h,this.uint8[K+4]=g,this.uint8[K+5]=w,this.uint8[K+6]=A,this.uint8[K+7]=k,this.float32[re+2]=F,r}}cn.prototype.bytesPerElement=12,Cr(cn,"StructArrayLayout2i4ub1f12");class Vn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,r,u,h,g)}emplace(r,u,h,g,w){const A=4*r;return this.float32[A+0]=u,this.float32[A+1]=h,this.float32[A+2]=g,this.float32[A+3]=w,r}}Vn.prototype.bytesPerElement=16,Cr(Vn,"StructArrayLayout4f16");class tn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,h,g,w){const A=this.length;return this.resize(A+1),this.emplace(A,r,u,h,g,w)}emplace(r,u,h,g,w,A){const k=6*r,F=3*r;return this.uint16[k+0]=u,this.uint16[k+1]=h,this.uint16[k+2]=g,this.uint16[k+3]=w,this.float32[F+2]=A,r}}tn.prototype.bytesPerElement=12,Cr(tn,"StructArrayLayout4ui1f12");class bn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,r,u,h,g)}emplace(r,u,h,g,w){const A=4*r;return this.uint16[A+0]=u,this.uint16[A+1]=h,this.uint16[A+2]=g,this.uint16[A+3]=w,r}}bn.prototype.bytesPerElement=8,Cr(bn,"StructArrayLayout4ui8");class Un extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,h,g,w,A){const k=this.length;return this.resize(k+1),this.emplace(k,r,u,h,g,w,A)}emplace(r,u,h,g,w,A,k){const F=6*r;return this.int16[F+0]=u,this.int16[F+1]=h,this.int16[F+2]=g,this.int16[F+3]=w,this.int16[F+4]=A,this.int16[F+5]=k,r}}Un.prototype.bytesPerElement=12,Cr(Un,"StructArrayLayout6i12");class In extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,h,g,w,A,k,F,z,K,re,fe){const we=this.length;return this.resize(we+1),this.emplace(we,r,u,h,g,w,A,k,F,z,K,re,fe)}emplace(r,u,h,g,w,A,k,F,z,K,re,fe,we){const Te=12*r;return this.int16[Te+0]=u,this.int16[Te+1]=h,this.int16[Te+2]=g,this.int16[Te+3]=w,this.uint16[Te+4]=A,this.uint16[Te+5]=k,this.uint16[Te+6]=F,this.uint16[Te+7]=z,this.int16[Te+8]=K,this.int16[Te+9]=re,this.int16[Te+10]=fe,this.int16[Te+11]=we,r}}In.prototype.bytesPerElement=24,Cr(In,"StructArrayLayout4i4ui4i24");class Wn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,h,g,w,A){const k=this.length;return this.resize(k+1),this.emplace(k,r,u,h,g,w,A)}emplace(r,u,h,g,w,A,k){const F=10*r,z=5*r;return this.int16[F+0]=u,this.int16[F+1]=h,this.int16[F+2]=g,this.float32[z+2]=w,this.float32[z+3]=A,this.float32[z+4]=k,r}}Wn.prototype.bytesPerElement=20,Cr(Wn,"StructArrayLayout3i3f20");class Nr extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const u=this.length;return this.resize(u+1),this.emplace(u,r)}emplace(r,u){return this.uint32[1*r+0]=u,r}}Nr.prototype.bytesPerElement=4,Cr(Nr,"StructArrayLayout1ul4");class ei extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,h,g,w,A,k,F,z,K,re,fe,we){const Te=this.length;return this.resize(Te+1),this.emplace(Te,r,u,h,g,w,A,k,F,z,K,re,fe,we)}emplace(r,u,h,g,w,A,k,F,z,K,re,fe,we,Te){const Re=20*r,st=10*r;return this.int16[Re+0]=u,this.int16[Re+1]=h,this.int16[Re+2]=g,this.int16[Re+3]=w,this.int16[Re+4]=A,this.float32[st+3]=k,this.float32[st+4]=F,this.float32[st+5]=z,this.float32[st+6]=K,this.int16[Re+14]=re,this.uint32[st+8]=fe,this.uint16[Re+18]=we,this.uint16[Re+19]=Te,r}}ei.prototype.bytesPerElement=40,Cr(ei,"StructArrayLayout5i4f1i1ul2ui40");class Er extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,h,g,w,A,k){const F=this.length;return this.resize(F+1),this.emplace(F,r,u,h,g,w,A,k)}emplace(r,u,h,g,w,A,k,F){const z=8*r;return this.int16[z+0]=u,this.int16[z+1]=h,this.int16[z+2]=g,this.int16[z+4]=w,this.int16[z+5]=A,this.int16[z+6]=k,this.int16[z+7]=F,r}}Er.prototype.bytesPerElement=16,Cr(Er,"StructArrayLayout3i2i2i16");class gr extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,h,g,w){const A=this.length;return this.resize(A+1),this.emplace(A,r,u,h,g,w)}emplace(r,u,h,g,w,A){const k=4*r,F=8*r;return this.float32[k+0]=u,this.float32[k+1]=h,this.float32[k+2]=g,this.int16[F+6]=w,this.int16[F+7]=A,r}}gr.prototype.bytesPerElement=16,Cr(gr,"StructArrayLayout2f1f2i16");class Ai extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,r,u,h,g)}emplace(r,u,h,g,w){const A=12*r,k=3*r;return this.uint8[A+0]=u,this.uint8[A+1]=h,this.float32[k+1]=g,this.float32[k+2]=w,r}}Ai.prototype.bytesPerElement=12,Cr(Ai,"StructArrayLayout2ub2f12");class Mi extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,h)}emplace(r,u,h,g){const w=3*r;return this.float32[w+0]=u,this.float32[w+1]=h,this.float32[w+2]=g,r}}Mi.prototype.bytesPerElement=12,Cr(Mi,"StructArrayLayout3f12");class Vr extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,h)}emplace(r,u,h,g){const w=3*r;return this.uint16[w+0]=u,this.uint16[w+1]=h,this.uint16[w+2]=g,r}}Vr.prototype.bytesPerElement=6,Cr(Vr,"StructArrayLayout3ui6");class Yi extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,u,h,g,w,A,k,F,z,K,re,fe,we,Te,Re,st,_t,Rt,xt,Pt,Vt){const jt=this.length;return this.resize(jt+1),this.emplace(jt,r,u,h,g,w,A,k,F,z,K,re,fe,we,Te,Re,st,_t,Rt,xt,Pt,Vt)}emplace(r,u,h,g,w,A,k,F,z,K,re,fe,we,Te,Re,st,_t,Rt,xt,Pt,Vt,jt){const wn=30*r,vn=15*r,On=60*r;return this.int16[wn+0]=u,this.int16[wn+1]=h,this.int16[wn+2]=g,this.float32[vn+2]=w,this.float32[vn+3]=A,this.uint16[wn+8]=k,this.uint16[wn+9]=F,this.uint32[vn+5]=z,this.uint32[vn+6]=K,this.uint32[vn+7]=re,this.uint16[wn+16]=fe,this.uint16[wn+17]=we,this.uint16[wn+18]=Te,this.float32[vn+10]=Re,this.float32[vn+11]=st,this.uint8[On+48]=_t,this.uint8[On+49]=Rt,this.uint8[On+50]=xt,this.uint32[vn+13]=Pt,this.int16[wn+28]=Vt,this.uint8[On+58]=jt,r}}Yi.prototype.bytesPerElement=60,Cr(Yi,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ki extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,u,h,g,w,A,k,F,z,K,re,fe,we,Te,Re,st,_t,Rt,xt,Pt,Vt,jt,wn,vn,On,ar,kn,$n,Hn,nr){const fr=this.length;return this.resize(fr+1),this.emplace(fr,r,u,h,g,w,A,k,F,z,K,re,fe,we,Te,Re,st,_t,Rt,xt,Pt,Vt,jt,wn,vn,On,ar,kn,$n,Hn,nr)}emplace(r,u,h,g,w,A,k,F,z,K,re,fe,we,Te,Re,st,_t,Rt,xt,Pt,Vt,jt,wn,vn,On,ar,kn,$n,Hn,nr,fr){const Mn=38*r,Rr=19*r;return this.int16[Mn+0]=u,this.int16[Mn+1]=h,this.int16[Mn+2]=g,this.float32[Rr+2]=w,this.float32[Rr+3]=A,this.int16[Mn+8]=k,this.int16[Mn+9]=F,this.int16[Mn+10]=z,this.int16[Mn+11]=K,this.int16[Mn+12]=re,this.int16[Mn+13]=fe,this.uint16[Mn+14]=we,this.uint16[Mn+15]=Te,this.uint16[Mn+16]=Re,this.uint16[Mn+17]=st,this.uint16[Mn+18]=_t,this.uint16[Mn+19]=Rt,this.uint16[Mn+20]=xt,this.uint16[Mn+21]=Pt,this.uint16[Mn+22]=Vt,this.uint16[Mn+23]=jt,this.uint16[Mn+24]=wn,this.uint16[Mn+25]=vn,this.uint16[Mn+26]=On,this.uint16[Mn+27]=ar,this.uint16[Mn+28]=kn,this.uint32[Rr+15]=$n,this.float32[Rr+16]=Hn,this.float32[Rr+17]=nr,this.float32[Rr+18]=fr,r}}Ki.prototype.bytesPerElement=76,Cr(Ki,"StructArrayLayout3i2f6i15ui1ul3f76");class ts extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const u=this.length;return this.resize(u+1),this.emplace(u,r)}emplace(r,u){return this.float32[1*r+0]=u,r}}ts.prototype.bytesPerElement=4,Cr(ts,"StructArrayLayout1f4");class Gs extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,h,g,w){const A=this.length;return this.resize(A+1),this.emplace(A,r,u,h,g,w)}emplace(r,u,h,g,w,A){const k=5*r;return this.float32[k+0]=u,this.float32[k+1]=h,this.float32[k+2]=g,this.float32[k+3]=w,this.float32[k+4]=A,r}}Gs.prototype.bytesPerElement=20,Cr(Gs,"StructArrayLayout5f20");class wa extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,r,u,h,g)}emplace(r,u,h,g,w){const A=6*r;return this.uint32[3*r+0]=u,this.uint16[A+2]=h,this.uint16[A+3]=g,this.uint16[A+4]=w,r}}wa.prototype.bytesPerElement=12,Cr(wa,"StructArrayLayout1ul3ui12");class $o extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,u)}emplace(r,u,h){const g=2*r;return this.uint16[g+0]=u,this.uint16[g+1]=h,r}}$o.prototype.bytesPerElement=4,Cr($o,"StructArrayLayout2ui4");class Bu extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const u=this.length;return this.resize(u+1),this.emplace(u,r)}emplace(r,u){return this.uint16[1*r+0]=u,r}}Bu.prototype.bytesPerElement=2,Cr(Bu,"StructArrayLayout1ui2");class Yu extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,u)}emplace(r,u,h){const g=2*r;return this.float32[g+0]=u,this.float32[g+1]=h,r}}Yu.prototype.bytesPerElement=8,Cr(Yu,"StructArrayLayout2f8");class Zi extends Nt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Zi.prototype.size=40;class ks extends ei{get(r){return new Zi(this,r)}}Cr(ks,"CollisionBoxArray");class $s extends Nt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}$s.prototype.size=60;class Sa extends Yi{get(r){return new $s(this,r)}}Cr(Sa,"PlacedSymbolArray");class Gl extends Nt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Gl.prototype.size=76;class Eo extends Ki{get(r){return new Gl(this,r)}}Cr(Eo,"SymbolInstanceArray");class Ea extends ts{getoffsetX(r){return this.float32[1*r+0]}}Cr(Ea,"GlyphOffsetArray");class Yo extends Rn{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}Cr(Yo,"SymbolLineVertexArray");class Ro extends Nt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ro.prototype.size=12;class aa extends wa{get(r){return new Ro(this,r)}}Cr(aa,"FeatureIndexArray");class zu extends $o{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}Cr(zu,"FillExtrusionCentroidArray");const Ta=Bt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ku=Bt([{name:"a_dash",components:4,type:"Uint16"}]);var If={exports:{}},Oa={exports:{}};Oa.exports=function(o,r){var u,h,g,w,A,k,F,z;for(h=o.length-(u=3&o.length),g=r,A=3432918353,k=461845907,z=0;z<h;)F=255&o.charCodeAt(z)|(255&o.charCodeAt(++z))<<8|(255&o.charCodeAt(++z))<<16|(255&o.charCodeAt(++z))<<24,++z,g=27492+(65535&(w=5*(65535&(g=(g^=F=(65535&(F=(F=(65535&F)*A+(((F>>>16)*A&65535)<<16)&4294967295)<<15|F>>>17))*k+(((F>>>16)*k&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(F=0,u){case 3:F^=(255&o.charCodeAt(z+2))<<16;case 2:F^=(255&o.charCodeAt(z+1))<<8;case 1:g^=F=(65535&(F=(F=(65535&(F^=255&o.charCodeAt(z)))*A+(((F>>>16)*A&65535)<<16)&4294967295)<<15|F>>>17))*k+(((F>>>16)*k&65535)<<16)&4294967295}return g^=o.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Wh=Oa.exports,Cf={exports:{}};Cf.exports=function(o,r){for(var u,h=o.length,g=r^h,w=0;h>=4;)u=1540483477*(65535&(u=255&o.charCodeAt(w)|(255&o.charCodeAt(++w))<<8|(255&o.charCodeAt(++w))<<16|(255&o.charCodeAt(++w))<<24))+((1540483477*(u>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),h-=4,++w;switch(h){case 3:g^=(255&o.charCodeAt(w+2))<<16;case 2:g^=(255&o.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&o.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var Wc=Wh,Xc=Cf.exports;If.exports=Wc,If.exports.murmur3=Wc,If.exports.murmur2=Xc;var Zu=de(If.exports);class fh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,u,h,g){this.ids.push(Hf(r)),this.positions.push(u,h,g)}getPositions(r){const u=Hf(r);let h=0,g=this.ids.length-1;for(;h<g;){const A=h+g>>1;this.ids[A]>=u?g=A:h=A+1}const w=[];for(;this.ids[h]===u;)w.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return w}static serialize(r,u){const h=new Float64Array(r.ids),g=new Uint32Array(r.positions);return Yc(h,g,0,h.length-1),u&&u.push(h.buffer,g.buffer),{ids:h,positions:g}}static deserialize(r){const u=new fh;return u.ids=r.ids,u.positions=r.positions,u.indexed=!0,u}}function Hf(o){const r=+o;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:Zu(String(o))}function Yc(o,r,u,h){for(;u<h;){const g=o[u+h>>1];let w=u-1,A=h+1;for(;;){do w++;while(o[w]<g);do A--;while(o[A]>g);if(w>=A)break;kf(o,w,A),kf(r,3*w,3*A),kf(r,3*w+1,3*A+1),kf(r,3*w+2,3*A+2)}A-u<h-A?(Yc(o,r,u,A),u=A+1):(Yc(o,r,A+1,h),h=A)}}function kf(o,r,u){const h=o[r];o[r]=o[u],o[u]=h}Cr(fh,"FeaturePositionMap");class Kc{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,u){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,u),this.initialized=!0),!!this.location}}class Nh extends Kc{constructor(r){super(r),this.current=0}set(r,u,h){this.fetchUniformLocation(r,u)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class dh extends Kc{constructor(r){super(r),this.current=[0,0,0,0]}set(r,u,h){this.fetchUniformLocation(r,u)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class Wf extends Kc{constructor(r){super(r),this.current=Vs.transparent}set(r,u,h){this.fetchUniformLocation(r,u)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const Xh=new Float32Array(16),Yh=new Float32Array(9),Xf=new Float32Array(4);function eu(o){return[Mt(255*o.r,255*o.g),Mt(255*o.b,255*o.a)]}class Sc{constructor(r,u,h){this.value=r,this.uniformNames=u.map((g=>`u_${g}`)),this.type=h}setUniform(r,u,h,g,w){u.set(r,w,g.constantOr(this.value))}getBinding(r,u){return this.type==="color"?new Wf(r):new Nh(r)}}class tu{constructor(r,u){this.uniformNames=u.map((h=>`u_${h}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,u,h,g,w){const A=w==="u_pattern"||w==="u_dash"?this.pattern:w==="u_pixel_ratio"?this.pixelRatio:null;A&&u.set(r,w,A)}getBinding(r,u){return u==="u_pattern"||u==="u_dash"?new dh(r):new Nh(r)}}class $l{constructor(r,u,h,g){this.expression=r,this.type=h,this.maxValue=0,this.paintVertexAttributes=u.map((w=>({name:`a_${w}`,type:"Float32",components:h==="color"?2:1,offset:0}))),this.paintVertexArray=new g}populatePaintArray(r,u,h,g,w,A){const k=this.paintVertexArray.length,F=this.expression.evaluate(new Z(0),u,{},w,g,A);this.paintVertexArray.resize(r),this._setPaintValue(k,r,F)}updatePaintArray(r,u,h,g,w){const A=this.expression.evaluate({zoom:0},h,g,void 0,w);this._setPaintValue(r,u,A)}_setPaintValue(r,u,h){if(this.type==="color"){const g=eu(h);for(let w=r;w<u;w++)this.paintVertexArray.emplace(w,g[0],g[1])}else{for(let g=r;g<u;g++)this.paintVertexArray.emplace(g,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class uc{constructor(r,u,h,g,w,A){this.expression=r,this.uniformNames=u.map((k=>`u_${k}_t`)),this.type=h,this.useIntegerZoom=g,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=u.map((k=>({name:`a_${k}`,type:"Float32",components:h==="color"?4:2,offset:0}))),this.paintVertexArray=new A}populatePaintArray(r,u,h,g,w,A){const k=this.expression.evaluate(new Z(this.zoom),u,{},w,g,A),F=this.expression.evaluate(new Z(this.zoom+1),u,{},w,g,A),z=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(z,r,k,F)}updatePaintArray(r,u,h,g,w){const A=this.expression.evaluate({zoom:this.zoom},h,g,void 0,w),k=this.expression.evaluate({zoom:this.zoom+1},h,g,void 0,w);this._setPaintValue(r,u,A,k)}_setPaintValue(r,u,h,g){if(this.type==="color"){const w=eu(h),A=eu(g);for(let k=r;k<u;k++)this.paintVertexArray.emplace(k,w[0],w[1],A[0],A[1])}else{for(let w=r;w<u;w++)this.paintVertexArray.emplace(w,h,g);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(g))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,u,h,g,w){const A=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,k=He(this.expression.interpolationFactor(A,this.zoom,this.zoom+1),0,1);u.set(r,w,k)}getBinding(r,u){return new Nh(r)}}class Zc{constructor(r,u,h,g,w){this.expression=r,this.layerId=w,this.paintVertexAttributes=(h==="array"?Ku:Ta).members;for(let A=0;A<u.length;++A);this.paintVertexArray=new g}populatePaintArray(r,u,h){const g=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(g,r,u.patterns&&u.patterns[this.layerId],h)}updatePaintArray(r,u,h,g,w,A){this._setPaintValues(r,u,h.patterns&&h.patterns[this.layerId],A)}_setPaintValues(r,u,h,g){if(!g||!h)return;const w=g[h];if(!w)return;const{tl:A,br:k,pixelRatio:F}=w;for(let z=r;z<u;z++)this.paintVertexArray.emplace(z,A[0],A[1],k[0],k[1],F)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Rh{constructor(r,u,h=(()=>!0)){this.binders={},this._buffers=[];const g=[];for(const w in r.paint._values){if(!h(w))continue;const A=r.paint.get(w);if(!(A instanceof et&&Go(A.property.specification)))continue;const k=Cg(w,r.type),F=A.value,z=A.property.specification.type,K=!!A.property.useIntegerZoom,re=w==="line-dasharray"||w.endsWith("pattern"),fe=w==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant";if(F.kind!=="constant"||fe)if(F.kind==="source"||fe||re){const we=Tm(w,z,"source");this.binders[w]=re?new Zc(F,k,z,we,r.id):new $l(F,k,z,we),g.push(`/a_${w}`)}else{const we=Tm(w,z,"composite");this.binders[w]=new uc(F,k,z,K,u,we),g.push(`/z_${w}`)}else this.binders[w]=re?new tu(F.value,k):new Sc(F.value,k,z),g.push(`/u_${w}`)}this.cacheKey=g.sort().join("")}getMaxValue(r){const u=this.binders[r];return u instanceof $l||u instanceof uc?u.maxValue:0}populatePaintArrays(r,u,h,g,w,A){for(const k in this.binders){const F=this.binders[k];(F instanceof $l||F instanceof uc||F instanceof Zc)&&F.populatePaintArray(r,u,h,g,w,A)}}setConstantPatternPositions(r){for(const u in this.binders){const h=this.binders[u];h instanceof tu&&h.setConstantPatternPositions(r)}}updatePaintArrays(r,u,h,g,w,A){let k=!1;for(const F in r){const z=u.getPositions(F);for(const K of z){const re=h.feature(K.index);for(const fe in this.binders){const we=this.binders[fe];if((we instanceof $l||we instanceof uc||we instanceof Zc)&&we.expression.isStateDependent===!0){const Te=g.paint.get(fe);we.expression=Te.value,we.updatePaintArray(K.start,K.end,re,r[F],w,A),k=!0}}}}return k}defines(){const r=[];for(const u in this.binders){const h=this.binders[u];(h instanceof Sc||h instanceof tu)&&r.push(...h.uniformNames.map((g=>`#define HAS_UNIFORM_${g}`)))}return r}getBinderAttributes(){const r=[];for(const u in this.binders){const h=this.binders[u];if(h instanceof $l||h instanceof uc||h instanceof Zc)for(let g=0;g<h.paintVertexAttributes.length;g++)r.push(h.paintVertexAttributes[g].name)}return r}getBinderUniforms(){const r=[];for(const u in this.binders){const h=this.binders[u];if(h instanceof Sc||h instanceof tu||h instanceof uc)for(const g of h.uniformNames)r.push(g)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const u=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof Sc||g instanceof tu||g instanceof uc)for(const w of g.uniformNames)u.push({name:w,property:h,binding:g.getBinding(r,w)})}return u}setUniforms(r,u,h,g,w){for(const{name:A,property:k,binding:F}of h)this.binders[k].setUniform(r,F,w,g.get(k),A)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const u=this.binders[r];(u instanceof $l||u instanceof uc||u instanceof Zc)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(r){for(const u in this.binders){const h=this.binders[u];(h instanceof $l||h instanceof uc||h instanceof Zc)&&h.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const u=this.binders[r];(u instanceof $l||u instanceof uc||u instanceof Zc)&&u.destroy()}}}class Jc{constructor(r,u,h=(()=>!0)){this.programConfigurations={};for(const g of r)this.programConfigurations[g.id]=new Rh(g,u,h);this.needsUpload=!1,this._featureMap=new fh,this._bufferOffset=0}populatePaintArrays(r,u,h,g,w,A,k){for(const F in this.programConfigurations)this.programConfigurations[F].populatePaintArrays(r,u,g,w,A,k);u.id!==void 0&&this._featureMap.add(u.id,h,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,u,h,g,w){for(const A of h)this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(r,this._featureMap,u,A,g,w)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const Yf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Cg(o,r){return Yf[o]||[o.replace(`${r}-`,"").replace(/-/g,"_")]}const Sm={"line-pattern":{source:tn,composite:tn},"fill-pattern":{source:tn,composite:tn},"fill-extrusion-pattern":{source:tn,composite:tn},"line-dasharray":{source:bn,composite:bn}},Em={color:{source:Yu,composite:Vn},number:{source:ts,composite:Yu}};function Tm(o,r,u){const h=Sm[o];return h&&h[u]||Em[r][u]}Cr(Sc,"ConstantBinder"),Cr(tu,"PatternConstantBinder"),Cr($l,"SourceExpressionBinder"),Cr(Zc,"PatternCompositeBinder"),Cr(uc,"CompositeExpressionBinder"),Cr(Rh,"ProgramConfiguration",{omit:["_buffers"]}),Cr(Jc,"ProgramConfigurationSet");const Am="-transition";class Mh extends ta{constructor(r,u){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&r.type!=="sky"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),u.layout&&(this._unevaluatedLayout=new at(u.layout)),u.paint)){this._transitionablePaint=new Ee(u.paint);for(const h in r.paint)this.setPaintProperty(h,r.paint[h],{validate:!1});for(const h in r.layout)this.setLayoutProperty(h,r.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new lt(u.paint)}}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,u,h={}){u!=null&&this._validate(uh,`layers.${this.id}.layout.${r}`,r,u,h)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,u):this.visibility=u)}getPaintProperty(r){return Xt(r,Am)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,u,h={}){if(u!=null&&this._validate(vu,`layers.${this.id}.paint.${r}`,r,u,h))return!1;if(Xt(r,Am))return this._transitionablePaint.setTransition(r.slice(0,-11),u||void 0),!1;{const g=this._transitionablePaint._values[r],w=g.value.isDataDriven(),A=g.value;this._transitionablePaint.setValue(r,u),this._handleSpecialPaintPropertyUpdate(r);const k=this._transitionablePaint._values[r].value,F=k.isDataDriven(),z=Xt(r,"pattern")||r==="line-dasharray";return F||w||z||this._handleOverridablePaintPropertyUpdate(r,A,k)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,u,h){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,u){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,u)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),zn(r,((u,h)=>!(u===void 0||h==="layout"&&!Object.keys(u).length||h==="paint"&&!Object.keys(u).length)))}_validate(r,u,h,g,w={}){return(!w||w.validate!==!1)&&vl(this,r.call(ql,{key:u,layerType:this.type,objectKey:h,value:g,styleSpec:En,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const u=this.paint.get(r);if(u instanceof et&&Go(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Si(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const kg=Bt([{name:"a_pos",components:2,type:"Int16"}],4),np=Bt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class xl{constructor(r=[]){this.segments=r}prepareSegment(r,u,h,g){let w=this.segments[this.segments.length-1];return r>xl.MAX_VERTEX_ARRAY_LENGTH&&Ir(`Max vertices per segment is ${xl.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!w||w.vertexLength+r>xl.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==g)&&(w={vertexOffset:u.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},g!==void 0&&(w.sortKey=g),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const r of this.segments)for(const u in r.vaos)r.vaos[u].destroy()}static simpleSegment(r,u,h,g){return new xl([{vertexOffset:r,primitiveOffset:u,vertexLength:h,primitiveLength:g,vaos:{},sortKey:0}])}}xl.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Cr(xl,"SegmentVector");var pi=8192;class Kh{constructor(r,u){r&&(u?this.setSouthWest(r).setNorthEast(u):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof hi?new hi(r.lng,r.lat):hi.convert(r),this}setSouthWest(r){return this._sw=r instanceof hi?new hi(r.lng,r.lat):hi.convert(r),this}extend(r){const u=this._sw,h=this._ne;let g,w;if(r instanceof hi)g=r,w=r;else{if(!(r instanceof Kh))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(Kh.convert(r)):this.extend(hi.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(hi.convert(r)):this;if(g=r._sw,w=r._ne,!g||!w)return this}return u||h?(u.lng=Math.min(g.lng,u.lng),u.lat=Math.min(g.lat,u.lat),h.lng=Math.max(w.lng,h.lng),h.lat=Math.max(w.lat,h.lat)):(this._sw=new hi(g.lng,g.lat),this._ne=new hi(w.lng,w.lat)),this}getCenter(){return new hi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new hi(this.getWest(),this.getNorth())}getSouthEast(){return new hi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:u,lat:h}=hi.convert(r);let g=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&g}static convert(r){return!r||r instanceof Kh?r:new Kh(r)}}var rp=1e-6,Ju=typeof Float32Array<"u"?Float32Array:Array;function Im(){var o=new Ju(9);return Ju!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function Lg(o,r,u){var h=r[0],g=r[1],w=r[2],A=r[3],k=r[4],F=r[5],z=r[6],K=r[7],re=r[8],fe=u[0],we=u[1],Te=u[2],Re=u[3],st=u[4],_t=u[5],Rt=u[6],xt=u[7],Pt=u[8];return o[0]=fe*h+we*A+Te*z,o[1]=fe*g+we*k+Te*K,o[2]=fe*w+we*F+Te*re,o[3]=Re*h+st*A+_t*z,o[4]=Re*g+st*k+_t*K,o[5]=Re*w+st*F+_t*re,o[6]=Rt*h+xt*A+Pt*z,o[7]=Rt*g+xt*k+Pt*K,o[8]=Rt*w+xt*F+Pt*re,o}function ph(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function ju(o,r){var u=r[0],h=r[1],g=r[2],w=r[3],A=r[4],k=r[5],F=r[6],z=r[7],K=r[8],re=r[9],fe=r[10],we=r[11],Te=r[12],Re=r[13],st=r[14],_t=r[15],Rt=u*k-h*A,xt=u*F-g*A,Pt=u*z-w*A,Vt=h*F-g*k,jt=h*z-w*k,wn=g*z-w*F,vn=K*Re-re*Te,On=K*st-fe*Te,ar=K*_t-we*Te,kn=re*st-fe*Re,$n=re*_t-we*Re,Hn=fe*_t-we*st,nr=Rt*Hn-xt*$n+Pt*kn+Vt*ar-jt*On+wn*vn;return nr?(o[0]=(k*Hn-F*$n+z*kn)*(nr=1/nr),o[1]=(g*$n-h*Hn-w*kn)*nr,o[2]=(Re*wn-st*jt+_t*Vt)*nr,o[3]=(fe*jt-re*wn-we*Vt)*nr,o[4]=(F*ar-A*Hn-z*On)*nr,o[5]=(u*Hn-g*ar+w*On)*nr,o[6]=(st*Pt-Te*wn-_t*xt)*nr,o[7]=(K*wn-fe*Pt+we*xt)*nr,o[8]=(A*$n-k*ar+z*vn)*nr,o[9]=(h*ar-u*$n-w*vn)*nr,o[10]=(Te*jt-Re*Pt+_t*Rt)*nr,o[11]=(re*Pt-K*jt-we*Rt)*nr,o[12]=(k*On-A*kn-F*vn)*nr,o[13]=(u*kn-h*On+g*vn)*nr,o[14]=(Re*xt-Te*Vt-st*Rt)*nr,o[15]=(K*Vt-re*xt+fe*Rt)*nr,o):null}function Dh(o,r,u){var h=r[0],g=r[1],w=r[2],A=r[3],k=r[4],F=r[5],z=r[6],K=r[7],re=r[8],fe=r[9],we=r[10],Te=r[11],Re=r[12],st=r[13],_t=r[14],Rt=r[15],xt=u[0],Pt=u[1],Vt=u[2],jt=u[3];return o[0]=xt*h+Pt*k+Vt*re+jt*Re,o[1]=xt*g+Pt*F+Vt*fe+jt*st,o[2]=xt*w+Pt*z+Vt*we+jt*_t,o[3]=xt*A+Pt*K+Vt*Te+jt*Rt,o[4]=(xt=u[4])*h+(Pt=u[5])*k+(Vt=u[6])*re+(jt=u[7])*Re,o[5]=xt*g+Pt*F+Vt*fe+jt*st,o[6]=xt*w+Pt*z+Vt*we+jt*_t,o[7]=xt*A+Pt*K+Vt*Te+jt*Rt,o[8]=(xt=u[8])*h+(Pt=u[9])*k+(Vt=u[10])*re+(jt=u[11])*Re,o[9]=xt*g+Pt*F+Vt*fe+jt*st,o[10]=xt*w+Pt*z+Vt*we+jt*_t,o[11]=xt*A+Pt*K+Vt*Te+jt*Rt,o[12]=(xt=u[12])*h+(Pt=u[13])*k+(Vt=u[14])*re+(jt=u[15])*Re,o[13]=xt*g+Pt*F+Vt*fe+jt*st,o[14]=xt*w+Pt*z+Vt*we+jt*_t,o[15]=xt*A+Pt*K+Vt*Te+jt*Rt,o}function Ec(o,r,u){var h,g,w,A,k,F,z,K,re,fe,we,Te,Re=u[0],st=u[1],_t=u[2];return r===o?(o[12]=r[0]*Re+r[4]*st+r[8]*_t+r[12],o[13]=r[1]*Re+r[5]*st+r[9]*_t+r[13],o[14]=r[2]*Re+r[6]*st+r[10]*_t+r[14],o[15]=r[3]*Re+r[7]*st+r[11]*_t+r[15]):(g=r[1],w=r[2],A=r[3],k=r[4],F=r[5],z=r[6],K=r[7],re=r[8],fe=r[9],we=r[10],Te=r[11],o[0]=h=r[0],o[1]=g,o[2]=w,o[3]=A,o[4]=k,o[5]=F,o[6]=z,o[7]=K,o[8]=re,o[9]=fe,o[10]=we,o[11]=Te,o[12]=h*Re+k*st+re*_t+r[12],o[13]=g*Re+F*st+fe*_t+r[13],o[14]=w*Re+z*st+we*_t+r[14],o[15]=A*Re+K*st+Te*_t+r[15]),o}function Tc(o,r,u){var h=u[0],g=u[1],w=u[2];return o[0]=r[0]*h,o[1]=r[1]*h,o[2]=r[2]*h,o[3]=r[3]*h,o[4]=r[4]*g,o[5]=r[5]*g,o[6]=r[6]*g,o[7]=r[7]*g,o[8]=r[8]*w,o[9]=r[9]*w,o[10]=r[10]*w,o[11]=r[11]*w,o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15],o}function vd(o,r,u){var h=Math.sin(u),g=Math.cos(u),w=r[4],A=r[5],k=r[6],F=r[7],z=r[8],K=r[9],re=r[10],fe=r[11];return r!==o&&(o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[4]=w*g+z*h,o[5]=A*g+K*h,o[6]=k*g+re*h,o[7]=F*g+fe*h,o[8]=z*g-w*h,o[9]=K*g-A*h,o[10]=re*g-k*h,o[11]=fe*g-F*h,o}function ip(o,r,u){var h=Math.sin(u),g=Math.cos(u),w=r[0],A=r[1],k=r[2],F=r[3],z=r[8],K=r[9],re=r[10],fe=r[11];return r!==o&&(o[4]=r[4],o[5]=r[5],o[6]=r[6],o[7]=r[7],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=w*g-z*h,o[1]=A*g-K*h,o[2]=k*g-re*h,o[3]=F*g-fe*h,o[8]=w*h+z*g,o[9]=A*h+K*g,o[10]=k*h+re*g,o[11]=F*h+fe*g,o}function Fp(o,r){return o[0]=r[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=r[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=r[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Lf(o,r,u){var h,g,w,A=u[0],k=u[1],F=u[2],z=Math.hypot(A,k,F);return z<rp?null:(A*=z=1/z,k*=z,F*=z,h=Math.sin(r),g=Math.cos(r),o[0]=A*A*(w=1-g)+g,o[1]=k*A*w+F*h,o[2]=F*A*w-k*h,o[3]=0,o[4]=A*k*w-F*h,o[5]=k*k*w+g,o[6]=F*k*w+A*h,o[7]=0,o[8]=A*F*w+k*h,o[9]=k*F*w-A*h,o[10]=F*F*w+g,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}Math.hypot||(Math.hypot=function(){for(var o=0,r=arguments.length;r--;)o+=arguments[r]*arguments[r];return Math.sqrt(o)});var Cm=Dh;function sp(){var o=new Ju(3);return Ju!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Pg(o){var r=new Ju(3);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r}function Zh(o){return Math.hypot(o[0],o[1],o[2])}function Pf(o,r,u){var h=new Ju(3);return h[0]=o,h[1]=r,h[2]=u,h}function Oh(o,r,u){return o[0]=r[0]+u[0],o[1]=r[1]+u[1],o[2]=r[2]+u[2],o}function Bp(o,r,u){return o[0]=r[0]-u[0],o[1]=r[1]-u[1],o[2]=r[2]-u[2],o}function km(o,r,u){return o[0]=r[0]*u[0],o[1]=r[1]*u[1],o[2]=r[2]*u[2],o}function q(o,r,u){return o[0]=Math.min(r[0],u[0]),o[1]=Math.min(r[1],u[1]),o[2]=Math.min(r[2],u[2]),o}function be(o,r,u){return o[0]=Math.max(r[0],u[0]),o[1]=Math.max(r[1],u[1]),o[2]=Math.max(r[2],u[2]),o}function Me(o,r,u){return o[0]=r[0]*u,o[1]=r[1]*u,o[2]=r[2]*u,o}function Qe(o,r,u,h){return o[0]=r[0]+u[0]*h,o[1]=r[1]+u[1]*h,o[2]=r[2]+u[2]*h,o}function ct(o,r){var u=r[0],h=r[1],g=r[2],w=u*u+h*h+g*g;return w>0&&(w=1/Math.sqrt(w)),o[0]=r[0]*w,o[1]=r[1]*w,o[2]=r[2]*w,o}function Xe(o,r){return o[0]*r[0]+o[1]*r[1]+o[2]*r[2]}function ot(o,r,u){var h=r[0],g=r[1],w=r[2],A=u[0],k=u[1],F=u[2];return o[0]=g*F-w*k,o[1]=w*A-h*F,o[2]=h*k-g*A,o}function Lt(o,r,u){var h=r[0],g=r[1],w=r[2],A=u[3]*h+u[7]*g+u[11]*w+u[15];return o[0]=(u[0]*h+u[4]*g+u[8]*w+u[12])/(A=A||1),o[1]=(u[1]*h+u[5]*g+u[9]*w+u[13])/A,o[2]=(u[2]*h+u[6]*g+u[10]*w+u[14])/A,o}function Ht(o,r,u){var h=u[0],g=u[1],w=u[2],A=r[0],k=r[1],F=r[2],z=g*F-w*k,K=w*A-h*F,re=h*k-g*A,fe=g*re-w*K,we=w*z-h*re,Te=h*K-g*z,Re=2*u[3];return K*=Re,re*=Re,we*=2,Te*=2,o[0]=A+(z*=Re)+(fe*=2),o[1]=k+K+we,o[2]=F+re+Te,o}var Ct,en=Bp,xn=km,Gn=Zh;function dn(o,r,u){return o[0]=r[0]*u,o[1]=r[1]*u,o[2]=r[2]*u,o[3]=r[3]*u,o}function ln(o,r){var u=r[0],h=r[1],g=r[2],w=r[3],A=u*u+h*h+g*g+w*w;return A>0&&(A=1/Math.sqrt(A)),o[0]=u*A,o[1]=h*A,o[2]=g*A,o[3]=w*A,o}function Tn(o,r,u){var h=r[0],g=r[1],w=r[2],A=r[3];return o[0]=u[0]*h+u[4]*g+u[8]*w+u[12]*A,o[1]=u[1]*h+u[5]*g+u[9]*w+u[13]*A,o[2]=u[2]*h+u[6]*g+u[10]*w+u[14]*A,o[3]=u[3]*h+u[7]*g+u[11]*w+u[15]*A,o}function kr(){var o=new Ju(4);return Ju!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function ti(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function cr(o,r,u){u*=.5;var h=r[0],g=r[1],w=r[2],A=r[3],k=Math.sin(u),F=Math.cos(u);return o[0]=h*F+A*k,o[1]=g*F+w*k,o[2]=w*F-g*k,o[3]=A*F-h*k,o}function Lr(o,r,u){u*=.5;var h=r[0],g=r[1],w=r[2],A=r[3],k=Math.sin(u),F=Math.cos(u);return o[0]=h*F-w*k,o[1]=g*F+A*k,o[2]=w*F+h*k,o[3]=A*F-g*k,o}sp(),Ct=new Ju(4),Ju!=Float32Array&&(Ct[0]=0,Ct[1]=0,Ct[2]=0,Ct[3]=0);var _i=ln;sp(),Pf(1,0,0),Pf(0,1,0),kr(),kr(),Im();const xi=Bt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ci}=xi,Qi=Bt([{name:"a_pos_3",components:3,type:"Int16"}]);var Jr=Bt([{name:"a_pos",type:"Int16",components:2}]);class ai{constructor(r,u){this.pos=r,this.dir=u}intersectsPlane(r,u,h){const g=Xe(u,this.dir);if(Math.abs(g)<1e-6)return!1;const w=((r[0]-this.pos[0])*u[0]+(r[1]-this.pos[1])*u[1]+(r[2]-this.pos[2])*u[2])/g;return h[0]=this.pos[0]+this.dir[0]*w,h[1]=this.pos[1]+this.dir[1]*w,h[2]=this.pos[2]+this.dir[2]*w,!0}closestPointOnSphere(r,u,h){if((function(we,Te){var Re=we[0],st=we[1],_t=we[2],Rt=Te[0],xt=Te[1],Pt=Te[2];return Math.abs(Re-Rt)<=rp*Math.max(1,Math.abs(Re),Math.abs(Rt))&&Math.abs(st-xt)<=rp*Math.max(1,Math.abs(st),Math.abs(xt))&&Math.abs(_t-Pt)<=rp*Math.max(1,Math.abs(_t),Math.abs(Pt))})(this.pos,r)||u===0)return h[0]=h[1]=h[2]=0,!1;const[g,w,A]=this.dir,k=this.pos[0]-r[0],F=this.pos[1]-r[1],z=this.pos[2]-r[2],K=g*g+w*w+A*A,re=2*(k*g+F*w+z*A),fe=re*re-4*K*(k*k+F*F+z*z-u*u);if(fe<0){const we=Math.max(-re/2,0),Te=k+g*we,Re=F+w*we,st=z+A*we,_t=Math.hypot(Te,Re,st);return h[0]=Te*u/_t,h[1]=Re*u/_t,h[2]=st*u/_t,!1}{const we=(-re-Math.sqrt(fe))/(2*K);if(we<0){const Te=Math.hypot(k,F,z);return h[0]=k*u/Te,h[1]=F*u/Te,h[2]=z*u/Te,!1}return h[0]=k+g*we,h[1]=F+w*we,h[2]=z+A*we,!0}}}class ds{constructor(r,u,h,g,w){this.TL=r,this.TR=u,this.BR=h,this.BL=g,this.horizon=w}static fromInvProjectionMatrix(r,u,h){const g=[-1,1,1],w=[1,1,1],A=[1,-1,1],k=[-1,-1,1],F=Lt(g,g,r),z=Lt(w,w,r),K=Lt(A,A,r),re=Lt(k,k,r);return new ds(F,z,K,re,u/h)}}class li{constructor(r,u){this.points=r,this.planes=u}static fromInvProjectionMatrix(r,u,h,g){const w=Math.pow(2,h),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((F=>{const z=Tn([],F,r),K=1/z[3]/u*w;return(function(re,fe,we){return re[0]=fe[0]*we[0],re[1]=fe[1]*we[1],re[2]=fe[2]*we[2],re[3]=fe[3]*we[3],re})(z,z,[K,K,g?1/z[3]:K,K])})),k=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((F=>{const z=ct([],ot([],en([],A[F[0]],A[F[1]]),en([],A[F[2]],A[F[1]]))),K=-Xe(z,A[F[1]]);return z.concat(K)}));return new li(A,k)}}class Hr{static fromPoints(r){const u=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const g of r)q(u,u,g),be(h,h,g);return new Hr(u,h)}static applyTransform(r,u){const h=r.getCorners();for(let g=0;g<h.length;++g)Lt(h[g],h[g],u);return Hr.fromPoints(h)}constructor(r,u){this.min=r,this.max=u,this.center=Me([],Oh([],this.min,this.max),.5)}quadrant(r){const u=[r%2==0,r<2],h=Pg(this.min),g=Pg(this.max);for(let w=0;w<u.length;w++)h[w]=u[w]?this.min[w]:this.center[w],g[w]=u[w]?this.center[w]:this.max[w];return g[2]=this.max[2],new Hr(h,g)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,u=this.max;return[[r[0],r[1],r[2]],[u[0],r[1],r[2]],[u[0],u[1],r[2]],[r[0],u[1],r[2]],[r[0],r[1],u[2]],[u[0],r[1],u[2]],[u[0],u[1],u[2]],[r[0],u[1],u[2]]]}intersects(r){const u=this.getCorners();let h=!0;for(let g=0;g<r.planes.length;g++){const w=r.planes[g];let A=0;for(let k=0;k<u.length;k++)A+=Xe(w,u[k])+w[3]>=0;if(A===0)return 0;A!==u.length&&(h=!1)}if(h)return 2;for(let g=0;g<3;g++){let w=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let k=0;k<r.points.length;k++){const F=r.points[k][g]-this.min[g];w=Math.min(w,F),A=Math.max(A,F)}if(A<0||w>this.max[g]-this.min[g])return 0}return 1}}const qi=5,Yn=6,_n=pi/Math.PI/2,Dn=16383,ur=64,yr=[ur,32,16],vi=-_n,er=_n,Mo=[new Hr([vi,vi,vi],[er,er,er]),new Hr([vi,vi,vi],[0,0,er]),new Hr([0,vi,vi],[er,0,er]),new Hr([vi,0,vi],[0,er,er]),new Hr([0,0,vi],[er,er,er])];function ls(o){return o*_n/Ac}function mo(o,r,u,h=!0){const g=Me([],o._camera.position,o.worldSize),w=[r,u,1,1];Tn(w,w,o.pixelMatrixInverse),dn(w,w,1/w[3]);const A=ct([],en([],w,g)),k=o.globeMatrix,F=[k[12],k[13],k[14]],z=en([],F,g),K=Zh(z),re=ct([],z),fe=o.worldSize/(2*Math.PI),we=Xe(re,A),Te=Math.asin(fe/K);if(Te<Math.acos(we)){if(!h)return null;const ar=[],kn=[];Me(ar,A,K/we),ct(kn,en(kn,ar,z)),ct(A,Oh(A,z,Me(A,kn,Math.tan(Te)*K)))}const Re=[];new ai(g,A).closestPointOnSphere(F,fe,Re);const st=ct([],yn(k,0)),_t=ct([],yn(k,1)),Rt=ct([],yn(k,2)),xt=Xe(st,Re),Pt=Xe(_t,Re),Vt=Xe(Rt,Re),jt=Se(Math.asin(-Pt/fe));let wn=Se(Math.atan2(xt,Vt));wn=o.center.lng+(function(ar,kn){const $n=(kn-ar+180)%360-180;return $n<-180?$n+360:$n})(o.center.lng,wn);const vn=Zo(wn),On=He(Qa(jt),0,1);return new Nf(vn,On)}class Qs{constructor(r,u,h){this.a=en([],r,h),this.b=en([],u,h),this.center=h;const g=ct([],this.a),w=ct([],this.b);this.angle=Math.acos(Xe(g,w))}}function bl(o,r){if(o.angle===0)return null;let u;return u=o.a[r]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[r]/o.a[r]/Math.sin(o.angle)-1/Math.tan(o.angle)),u<0||u>1?null:(function(h,g,w,A){const k=Math.sin(w);return h*(Math.sin((1-A)*w)/k)+g*(Math.sin(A*w)/k)})(o.a[r],o.b[r],o.angle,He(u,0,1))+o.center[r]}function Do(o){if(o.z<=1)return Mo[o.z+2*o.y+o.x];const r=Jh(Qc(o));return Hr.fromPoints(r)}function wl(o,r,u){return Me(o,o,1-u),Qe(o,o,r,u)}function To(o,r){const u=eh(r.zoom);if(u===0)return Do(o);const h=Qc(o),g=Jh(h),w=Zo(h.getWest())*r.worldSize,A=Zo(h.getEast())*r.worldSize,k=Qa(h.getNorth())*r.worldSize,F=Qa(h.getSouth())*r.worldSize,z=[w,k,0],K=[A,k,0],re=[w,F,0],fe=[A,F,0],we=ju([],r.globeMatrix);return Lt(z,z,we),Lt(K,K,we),Lt(re,re,we),Lt(fe,fe,we),g[0]=wl(g[0],re,u),g[1]=wl(g[1],fe,u),g[2]=wl(g[2],K,u),g[3]=wl(g[3],z,u),Hr.fromPoints(g)}function _r(o,r,u){for(const h of o)Lt(h,h,r),Me(h,h,u)}function Dc(o,r,u){const h=r/o.worldSize,g=o.globeMatrix;if(u.z<=1){const vn=Do(u).getCorners();return _r(vn,g,h),Hr.fromPoints(vn)}const w=Qc(u),A=Jh(w);_r(A,g,h);const k=Number.MAX_VALUE,F=[-k,-k,-k],z=[k,k,k];if(w.contains(o.center)){for(const ar of A)q(z,z,ar),be(F,F,ar);F[2]=0;const vn=o.point,On=[vn.x*h,vn.y*h,0];return q(z,z,On),be(F,F,On),new Hr(z,F)}const K=[g[12]*h,g[13]*h,g[14]*h],re=w.getCenter(),fe=He(o.center.lat,-Sl,Sl),we=He(re.lat,-Sl,Sl),Te=Zo(o.center.lng),Re=Qa(fe);let st=Te-Zo(re.lng);const _t=Re-Qa(we);st>.5?st-=1:st<-.5&&(st+=1);let Rt=0;Math.abs(st)>Math.abs(_t)?Rt=st>=0?1:3:(Rt=_t>=0?0:2,Qe(K,K,[g[4]*h,g[5]*h,g[6]*h],-Math.sin(te(_t>=0?w.getSouth():w.getNorth()))*_n));const xt=A[Rt],Pt=A[(Rt+1)%4],Vt=new Qs(xt,Pt,K),jt=[bl(Vt,0)||xt[0],bl(Vt,1)||xt[1],bl(Vt,2)||xt[2]],wn=eh(o.zoom);if(wn>0){const vn=(function({x:ar,y:kn,z:$n},Hn,nr,fr,Mn){const Rr=1/(1<<$n);let ii=ar*Rr,zr=ii+Rr,ys=kn*Rr,pr=ys+Rr,Ti=0;const _s=(ii+zr)/2-fr;return _s>.5?Ti=-1:_s<-.5&&(Ti=1),ii=((ii+Ti)*Hn-(fr*=Hn))*nr+fr,zr=((zr+Ti)*Hn-fr)*nr+fr,ys=(ys*Hn-(Mn*=Hn))*nr+Mn,pr=(pr*Hn-Mn)*nr+Mn,[[ii,pr,0],[zr,pr,0],[zr,ys,0],[ii,ys,0]]})(u,r,o._pixelsPerMercatorPixel,Te,Re);for(let ar=0;ar<A.length;ar++)wl(A[ar],vn[ar],wn);const On=Oh([],vn[Rt],vn[(Rt+1)%4]);Me(On,On,.5),wl(jt,On,wn)}for(const vn of A)q(z,z,vn),be(F,F,vn);return z[2]=Math.min(xt[2],Pt[2]),q(z,z,jt),be(F,F,jt),new Hr(z,F)}function Qc({x:o,y:r,z:u}){const h=1/(1<<u),g=new hi(Hl(o*h),Ao((r+1)*h)),w=new hi(Hl((o+1)*h),Ao(r*h));return new Kh(g,w)}function Jh(o){const r=te(o.getNorth()),u=te(o.getSouth()),h=Math.cos(r),g=Math.cos(u),w=Math.sin(r),A=Math.sin(u),k=o.getWest(),F=o.getEast();return[_o(g,A,k),_o(g,A,F),_o(h,w,F),_o(h,w,k)]}function _o(o,r,u,h=_n){return u=te(u),[o*Math.sin(u)*h,-r*h,o*Math.cos(u)*h]}function nu(o,r,u){return _o(Math.cos(te(o)),Math.sin(te(o)),r,u)}function Ll(o,r,u,h){const g=1<<u.z,w=(o/pi+u.x)/g;return nu(Ao((r/pi+u.y)/g),Hl(w),h)}function Qh({min:o,max:r}){return Dn/Math.max(r[0]-o[0],r[1]-o[1],r[2]-o[2])}const ef=new Float64Array(16);function Uu(o){const r=Qh(o),u=Fp(ef,[r,r,r]);return Ec(u,u,((h=[])[0]=-(g=o.min)[0],h[1]=-g[1],h[2]=-g[2],h));var h,g}function Kf(o){const r=(h=o.min,(u=ef)[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=h[0],u[13]=h[1],u[14]=h[2],u[15]=1,u);var u,h;const g=1/Qh(o);return Tc(r,r,[g,g,g])}function Oc(o,r,u,h,g){const w=(function(F){const z=pi/(2*Math.PI);return F/(2*Math.PI)/z})(u),A=[o,r,-u/(2*Math.PI)],k=ph(new Float64Array(16));return Ec(k,k,A),Tc(k,k,[w,w,w]),vd(k,k,te(-g)),ip(k,k,te(-h)),k}function eh(o){return Ke(qi,Yn,o)}function Di(o,r){const u=nu(r.lat,r.lng),h=(function(Te){const Re=nu(Te._center.lat,Te._center.lng);let st=ot([],Pf(0,1,0),Re);const _t=Lf([],-Te.angle,Re);st=Lt(st,st,_t),Lf(_t,-Te._pitch,st);const Rt=ct([],Re);return Me(Rt,Rt,ls(Te.cameraToCenterDistance/Te.pixelsPerMeter)),Lt(Rt,Rt,_t),Oh([],Re,Rt)})(o);return A=(g=Bp([],h,u))[0],k=g[1],F=g[2],z=(w=u)[0],K=w[1],re=w[2],we=(fe=Math.sqrt(A*A+k*k+F*F)*Math.sqrt(z*z+K*K+re*re))&&Xe(g,w)/fe,Math.acos(Math.min(Math.max(we,-1),1));var g,w,A,k,F,z,K,re,fe,we}function Ko(o,r){return Di(o,r)>Math.PI/2*1.01}const fl=te(85),Fh=Math.cos(fl),bu=Math.sin(fl),Ac=63710088e-1,ff=2*Math.PI*Ac;class Fa{constructor(r,u){if(isNaN(r)||isNaN(u))throw new Error(`Invalid LngLat object: (${r}, ${u})`);if(this.lng=+r,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Fa(Ce(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const u=Math.PI/180,h=this.lat*u,g=r.lat*u,w=Math.sin(h)*Math.sin(g)+Math.cos(h)*Math.cos(g)*Math.cos((r.lng-this.lng)*u);return Ac*Math.acos(Math.min(w,1))}toBounds(r=0){const u=360*r/40075017,h=u/Math.cos(Math.PI/180*this.lat);return new Kh(new Fa(this.lng-h,this.lat-u),new Fa(this.lng+h,this.lat+u))}toEcef(r){const u=ls(r);return nu(this.lat,this.lng,_n+u)}static convert(r){if(r instanceof Fa)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Fa(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Fa(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var hi=Fa;function Pl(o){return ff*Math.cos(o*Math.PI/180)}function Zo(o){return(180+o)/360}function Qa(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Nl(o,r){return o/Pl(r)}function Hl(o){return 360*o-180}function Ao(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Zf(o,r){return o*Pl(Ao(r))}const Sl=85.051129;function op(o){return 1/Math.cos(o*Math.PI/180)}class Nf{constructor(r,u,h=0){this.x=+r,this.y=+u,this.z=+h}static fromLngLat(r,u=0){const h=hi.convert(r);return new Nf(Zo(h.lng),Qa(h.lat),Nl(u,h.lat))}toLngLat(){return new hi(Hl(this.x),Ao(this.y))}toAltitude(){return Zf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ff*op(Ao(this.y))}}function df(o,r,u,h,g,w,A,k,F){const z=(r+h)/2,K=(u+g)/2,re=new Y(z,K);k(re),(function(fe,we,Te,Re,st,_t){const Rt=Te-st,xt=Re-_t;return Math.abs((Re-we)*Rt-(Te-fe)*xt)/Math.hypot(Rt,xt)})(re.x,re.y,w.x,w.y,A.x,A.y)>=F?(df(o,r,u,z,K,w,re,k,F),df(o,z,K,h,g,re,A,k,F)):o.push(A)}function Ic(o,r,u){let h=o[0],g=h.x,w=h.y;r(h);const A=[h];for(let k=1;k<o.length;k++){const F=o[k],{x:z,y:K}=F;r(F),df(A,g,w,z,K,h,F,r,u),g=z,w=K,h=F}return A}function ap(o,r,u,h){if(h(r,u)){const g=r.add(u)._mult(.5);ap(o,r,g,h),ap(o,g,u,h)}else o.push(u)}function zp(o,r){let u=o[0];const h=[u];for(let g=1;g<o.length;g++){const w=o[g];ap(h,u,w,r),u=w}return h}const pf=Math.pow(2,14)-1,Lm=-pf-1;function r0(o,r){const u=Math.round(o.x*r),h=Math.round(o.y*r);return o.x=He(u,Lm,pf),o.y=He(h,Lm,pf),(u<o.x||u>o.x+1||h<o.y||h>o.y+1)&&Ir("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function Fc(o,r,u){const h=o.loadGeometry(),g=o.extent,w=pi/g;if(r&&u&&u.projection.isReprojectedInTileSpace){const A=1<<r.z,{scale:k,x:F,y:z,projection:K}=u,re=fe=>{const we=Hl((r.x+fe.x/g)/A),Te=Ao((r.y+fe.y/g)/A),Re=K.project(we,Te);fe.x=(Re.x*k-F)*g,fe.y=(Re.y*k-z)*g};for(let fe=0;fe<h.length;fe++)if(o.type!==1)h[fe]=Ic(h[fe],re,1);else{const we=[];for(const Te of h[fe])Te.x<0||Te.x>=g||Te.y<0||Te.y>=g||(re(Te),we.push(Te));h[fe]=we}}for(const A of h)for(const k of A)r0(k,w);return h}function Rf(o,r){return{type:o.type,id:o.id,properties:o.properties,geometry:r?Fc(o):[]}}function mf(o,r,u,h,g){o.emplaceBack(2*r+(h+1)/2,2*u+(g+1)/2)}function lp(o,r,u){o.emplaceBack(r.x,r.y,r.z,u[0]*16384,u[1]*16384,u[2]*16384)}class up{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new Rn,this.indexArray=new Vr,this.segments=new xl,this.programConfigurations=new Jc(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(r,u,h,g){const w=this.layers[0],A=[];let k=null;w.type==="circle"&&(k=w.layout.get("circle-sort-key"));for(const{feature:z,id:K,index:re,sourceLayerIndex:fe}of r){const we=this.layers[0]._featureFilter.needGeometry,Te=Rf(z,we);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),Te,h))continue;const Re=k?k.evaluate(Te,{},h):void 0,st={id:K,properties:z.properties,type:z.type,sourceLayerIndex:fe,index:re,geometry:we?Te.geometry:Fc(z,h,g),patterns:{},sortKey:Re};A.push(st)}k&&A.sort(((z,K)=>z.sortKey-K.sortKey));let F=null;g.projection.name==="globe"&&(this.globeExtVertexArray=new Un,F=g.projection);for(const z of A){const{geometry:K,index:re,sourceLayerIndex:fe}=z,we=r[re].feature;this.addFeature(z,K,re,u.availableImages,h,F),u.featureIndex.insert(we,K,re,fe,this.index)}}update(r,u,h,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,kg.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,np.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,u,h,g,w,A){for(const k of u)for(const F of k){const z=F.x,K=F.y;if(z<0||z>=pi||K<0||K>=pi)continue;if(A){const we=A.projectTilePoint(z,K,w),Te=A.upVector(w,z,K),Re=this.globeExtVertexArray;lp(Re,we,Te),lp(Re,we,Te),lp(Re,we,Te),lp(Re,we,Te)}const re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),fe=re.vertexLength;mf(this.layoutVertexArray,z,K,-1,-1),mf(this.layoutVertexArray,z,K,1,-1),mf(this.layoutVertexArray,z,K,1,1),mf(this.layoutVertexArray,z,K,-1,1),this.indexArray.emplaceBack(fe,fe+1,fe+2),this.indexArray.emplaceBack(fe,fe+2,fe+3),re.vertexLength+=4,re.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{},g,w)}}function Ng(o,r){for(let u=0;u<o.length;u++)if(Jf(r,o[u]))return!0;for(let u=0;u<r.length;u++)if(Jf(o,r[u]))return!0;return!!Mf(o,r)}function Rg(o,r,u){return!!Jf(o,r)||!!Bc(r,o,u)}function Pm(o,r){if(o.length===1)return Mg(r,o[0]);for(let u=0;u<r.length;u++){const h=r[u];for(let g=0;g<h.length;g++)if(Jf(o,h[g]))return!0}for(let u=0;u<o.length;u++)if(Mg(r,o[u]))return!0;for(let u=0;u<r.length;u++)if(Mf(o,r[u]))return!0;return!1}function th(o,r,u){if(o.length>1){if(Mf(o,r))return!0;for(let h=0;h<r.length;h++)if(Bc(r[h],o,u))return!0}for(let h=0;h<o.length;h++)if(Bc(o[h],r,u))return!0;return!1}function Mf(o,r){if(o.length===0||r.length===0)return!1;for(let u=0;u<o.length-1;u++){const h=o[u],g=o[u+1];for(let w=0;w<r.length-1;w++)if(gf(h,g,r[w],r[w+1]))return!0}return!1}function gf(o,r,u,h){return Fr(o,u,h)!==Fr(r,u,h)&&Fr(o,r,u)!==Fr(o,r,h)}function Bc(o,r,u){const h=u*u;if(r.length===1)return o.distSqr(r[0])<h;for(let g=1;g<r.length;g++)if(i0(o,r[g-1],r[g])<h)return!0;return!1}function i0(o,r,u){const h=r.distSqr(u);if(h===0)return o.distSqr(r);const g=((o.x-r.x)*(u.x-r.x)+(o.y-r.y)*(u.y-r.y))/h;return o.distSqr(g<0?r:g>1?u:u.sub(r)._mult(g)._add(r))}function Mg(o,r){let u,h,g,w=!1;for(let A=0;A<o.length;A++){u=o[A];for(let k=0,F=u.length-1;k<u.length;F=k++)h=u[k],g=u[F],h.y>r.y!=g.y>r.y&&r.x<(g.x-h.x)*(r.y-h.y)/(g.y-h.y)+h.x&&(w=!w)}return w}function Jf(o,r){let u=!1;for(let h=0,g=o.length-1;h<o.length;g=h++){const w=o[h],A=o[g];w.y>r.y!=A.y>r.y&&r.x<(A.x-w.x)*(r.y-w.y)/(A.y-w.y)+w.x&&(u=!u)}return u}function t1(o,r,u,h,g){for(const A of o)if(r<=A.x&&u<=A.y&&h>=A.x&&g>=A.y)return!0;const w=[new Y(r,u),new Y(r,g),new Y(h,g),new Y(h,u)];if(o.length>2){for(const A of w)if(Jf(o,A))return!0}for(let A=0;A<o.length-1;A++)if(xd(o[A],o[A+1],w))return!0;return!1}function xd(o,r,u){const h=u[0],g=u[2];if(o.x<h.x&&r.x<h.x||o.x>g.x&&r.x>g.x||o.y<h.y&&r.y<h.y||o.y>g.y&&r.y>g.y)return!1;const w=Fr(o,r,u[0]);return w!==Fr(o,r,u[1])||w!==Fr(o,r,u[2])||w!==Fr(o,r,u[3])}function cp(o,r,u){const h=r.paint.get(o).value;return h.kind==="constant"?h.value:u.programConfigurations.get(r.id).getMaxValue(o)}function jp(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function bd(o,r,u,h,g){if(!r[0]&&!r[1])return o;const w=Y.convert(r)._mult(g);u==="viewport"&&w._rotate(-h);const A=[];for(let k=0;k<o.length;k++)A.push(o[k].sub(w));return A}function Dg(o,r,u,h){const g=Y.convert(o)._mult(h);return r==="viewport"&&g._rotate(-u),g}Cr(up,"CircleBucket",{omit:["layers"]});const hp=new yt({"circle-sort-key":new rt(En.layout_circle["circle-sort-key"])});var n1={paint:new yt({"circle-radius":new rt(En.paint_circle["circle-radius"]),"circle-color":new rt(En.paint_circle["circle-color"]),"circle-blur":new rt(En.paint_circle["circle-blur"]),"circle-opacity":new rt(En.paint_circle["circle-opacity"]),"circle-translate":new Ie(En.paint_circle["circle-translate"]),"circle-translate-anchor":new Ie(En.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ie(En.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ie(En.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new rt(En.paint_circle["circle-stroke-width"]),"circle-stroke-color":new rt(En.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new rt(En.paint_circle["circle-stroke-opacity"])}),layout:hp};function s0(o,r,u,h,g,w,A,k,F){if(w&&o.queryGeometry.isAboveHorizon)return!1;w&&(F*=o.pixelToTileUnitsFactor);const z=o.tileID.canonical,K=u.projection.upVectorScale(z,u.center.lat,u.worldSize).metersToTile;for(const re of r)for(const fe of re){const we=fe.add(k),Te=g&&u.elevation?u.elevation.exaggeration()*g.getElevationAt(we.x,we.y,!0):0,Re=u.projection.projectTilePoint(we.x,we.y,z);if(Te>0){const xt=u.projection.upVector(z,we.x,we.y);Re.x+=xt[0]*K*Te,Re.y+=xt[1]*K*Te,Re.z+=xt[2]*K*Te}const st=w?we:o0(Re.x,Re.y,Re.z,h),_t=w?o.tilespaceRays.map((xt=>rb(xt,Te))):o.queryGeometry.screenGeometry,Rt=Tn([],[Re.x,Re.y,Re.z,1],h);if(!A&&w?F*=Rt[3]/u.cameraToCenterDistance:A&&!w&&(F*=u.cameraToCenterDistance/Rt[3]),w){const xt=Ao((fe.y/pi+z.y)/(1<<z.z));F/=u.projection.pixelsPerMeter(xt,1)/Nl(1,xt)}if(Rg(_t,st,F))return!0}return!1}function o0(o,r,u,h){const g=Tn([],[o,r,u,1],h);return new Y(g[0]/g[3],g[1]/g[3])}const Nm=Pf(0,0,0),nb=Pf(0,0,1);function rb(o,r){const u=sp();return Nm[2]=r,o.intersectsPlane(Nm,nb,u),new Y(u[0],u[1])}class a0 extends up{}function l0(o,{width:r,height:u},h,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==r*u*h)throw new RangeError("mismatched image size")}else g=new Uint8Array(r*u*h);return o.width=r,o.height=u,o.data=g,o}function wd(o,r,u){const{width:h,height:g}=r;h===o.width&&g===o.height||(u0(o,r,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,h),height:Math.min(o.height,g)},u),o.width=h,o.height=g,o.data=r.data)}function u0(o,r,u,h,g,w){if(g.width===0||g.height===0)return r;if(g.width>o.width||g.height>o.height||u.x>o.width-g.width||u.y>o.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>r.width||g.height>r.height||h.x>r.width-g.width||h.y>r.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const A=o.data,k=r.data;for(let F=0;F<g.height;F++){const z=((u.y+F)*o.width+u.x)*w,K=((h.y+F)*r.width+h.x)*w;for(let re=0;re<g.width*w;re++)k[K+re]=A[z+re]}return r}Cr(a0,"HeatmapBucket",{omit:["layers"]});class mh{constructor(r,u){l0(this,r,1,u)}resize(r){wd(this,new mh(r),1)}clone(){return new mh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,u,h,g,w){u0(r,u,h,g,w,1)}}class nh{constructor(r,u){l0(this,r,4,u)}resize(r){wd(this,new nh(r),4)}replace(r,u){u?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new nh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,u,h,g,w){u0(r,u,h,g,w,4)}}Cr(mh,"AlphaImage"),Cr(nh,"RGBAImage");var fu={paint:new yt({"heatmap-radius":new rt(En.paint_heatmap["heatmap-radius"]),"heatmap-weight":new rt(En.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ie(En.paint_heatmap["heatmap-intensity"]),"heatmap-color":new gt(En.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ie(En.paint_heatmap["heatmap-opacity"])})};function c0(o){const r={},u=o.resolution||256,h=o.clips?o.clips.length:1,g=o.image||new nh({width:u,height:h}),w=(A,k,F)=>{r[o.evaluationKey]=F;const z=o.expression.evaluate(r);g.data[A+k+0]=Math.floor(255*z.r/z.a),g.data[A+k+1]=Math.floor(255*z.g/z.a),g.data[A+k+2]=Math.floor(255*z.b/z.a),g.data[A+k+3]=Math.floor(255*z.a)};if(o.clips)for(let A=0,k=0;A<h;++A,k+=4*u)for(let F=0,z=0;F<u;F++,z+=4){const K=F/(u-1),{start:re,end:fe}=o.clips[A];w(k,z,re*(1-K)+fe*K)}else for(let A=0,k=0;A<u;A++,k+=4)w(0,k,A/(u-1));return g}var r1={paint:new yt({"hillshade-illumination-direction":new Ie(En.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ie(En.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ie(En.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ie(En.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ie(En.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ie(En.paint_hillshade["hillshade-accent-color"])})};const ib=Bt([{name:"a_pos",components:2,type:"Int16"}],4),{members:sb}=ib;var Og={exports:{}};function Rm(o,r,u){u=u||2;var h,g,w,A,k,F,z,K=r&&r.length,re=K?r[0]*u:o.length,fe=i1(o,0,re,u,!0),we=[];if(!fe||fe.next===fe.prev)return we;if(K&&(fe=(function(Re,st,_t,Rt){var xt,Pt,Vt,jt=[];for(xt=0,Pt=st.length;xt<Pt;xt++)(Vt=i1(Re,st[xt]*Rt,xt<Pt-1?st[xt+1]*Rt:Re.length,Rt,!1))===Vt.next&&(Vt.steiner=!0),jt.push(p0(Vt));for(jt.sort(Bg),xt=0;xt<jt.length;xt++)_t=h0(jt[xt],_t);return _t})(o,r,fe,u)),o.length>80*u){h=w=o[0],g=A=o[1];for(var Te=u;Te<re;Te+=u)(k=o[Te])<h&&(h=k),(F=o[Te+1])<g&&(g=F),k>w&&(w=k),F>A&&(A=F);z=(z=Math.max(w-h,A-g))!==0?32767/z:0}return fp(fe,we,u,h,g,z,0),we}function i1(o,r,u,h,g){var w,A;if(g===qp(o,r,u,h)>0)for(w=r;w<u;w+=h)A=zg(w,o[w],o[w+1],A);else for(w=u-h;w>=r;w-=h)A=zg(w,o[w],o[w+1],A);return A&&pp(A,A.next)&&(Ed(A),A=A.next),A}function cc(o,r){if(!o)return o;r||(r=o);var u,h=o;do if(u=!1,h.steiner||!pp(h,h.next)&&Wl(h.prev,h,h.next)!==0)h=h.next;else{if(Ed(h),(h=r=h.prev)===h.next)break;u=!0}while(u||h!==r);return r}function fp(o,r,u,h,g,w,A){if(o){!A&&w&&(function(K,re,fe,we){var Te=K;do Te.z===0&&(Te.z=d0(Te.x,Te.y,re,fe,we)),Te.prevZ=Te.prev,Te.nextZ=Te.next,Te=Te.next;while(Te!==K);Te.prevZ.nextZ=null,Te.prevZ=null,(function(Re){var st,_t,Rt,xt,Pt,Vt,jt,wn,vn=1;do{for(_t=Re,Re=null,Pt=null,Vt=0;_t;){for(Vt++,Rt=_t,jt=0,st=0;st<vn&&(jt++,Rt=Rt.nextZ);st++);for(wn=vn;jt>0||wn>0&&Rt;)jt!==0&&(wn===0||!Rt||_t.z<=Rt.z)?(xt=_t,_t=_t.nextZ,jt--):(xt=Rt,Rt=Rt.nextZ,wn--),Pt?Pt.nextZ=xt:Re=xt,xt.prevZ=Pt,Pt=xt;_t=Rt}Pt.nextZ=null,vn*=2}while(Vt>1)})(Te)})(o,h,g,w);for(var k,F,z=o;o.prev!==o.next;)if(k=o.prev,F=o.next,w?Sd(o,h,g,w):ob(o))r.push(k.i/u|0),r.push(o.i/u|0),r.push(F.i/u|0),Ed(o),o=F.next,z=F.next;else if((o=F)===z){A?A===1?fp(o=Fg(cc(o),r,u),r,u,h,g,w,2):A===2&&dp(o,r,u,h,g,w):fp(cc(o),r,u,h,g,w,1);break}}}function ob(o){var r=o.prev,u=o,h=o.next;if(Wl(r,u,h)>=0)return!1;for(var g=r.x,w=u.x,A=h.x,k=r.y,F=u.y,z=h.y,K=g<w?g<A?g:A:w<A?w:A,re=k<F?k<z?k:z:F<z?F:z,fe=g>w?g>A?g:A:w>A?w:A,we=k>F?k>z?k:z:F>z?F:z,Te=h.next;Te!==r;){if(Te.x>=K&&Te.x<=fe&&Te.y>=re&&Te.y<=we&&Up(g,k,w,F,A,z,Te.x,Te.y)&&Wl(Te.prev,Te,Te.next)>=0)return!1;Te=Te.next}return!0}function Sd(o,r,u,h){var g=o.prev,w=o,A=o.next;if(Wl(g,w,A)>=0)return!1;for(var k=g.x,F=w.x,z=A.x,K=g.y,re=w.y,fe=A.y,we=k<F?k<z?k:z:F<z?F:z,Te=K<re?K<fe?K:fe:re<fe?re:fe,Re=k>F?k>z?k:z:F>z?F:z,st=K>re?K>fe?K:fe:re>fe?re:fe,_t=d0(we,Te,r,u,h),Rt=d0(Re,st,r,u,h),xt=o.prevZ,Pt=o.nextZ;xt&&xt.z>=_t&&Pt&&Pt.z<=Rt;){if(xt.x>=we&&xt.x<=Re&&xt.y>=Te&&xt.y<=st&&xt!==g&&xt!==A&&Up(k,K,F,re,z,fe,xt.x,xt.y)&&Wl(xt.prev,xt,xt.next)>=0||(xt=xt.prevZ,Pt.x>=we&&Pt.x<=Re&&Pt.y>=Te&&Pt.y<=st&&Pt!==g&&Pt!==A&&Up(k,K,F,re,z,fe,Pt.x,Pt.y)&&Wl(Pt.prev,Pt,Pt.next)>=0))return!1;Pt=Pt.nextZ}for(;xt&&xt.z>=_t;){if(xt.x>=we&&xt.x<=Re&&xt.y>=Te&&xt.y<=st&&xt!==g&&xt!==A&&Up(k,K,F,re,z,fe,xt.x,xt.y)&&Wl(xt.prev,xt,xt.next)>=0)return!1;xt=xt.prevZ}for(;Pt&&Pt.z<=Rt;){if(Pt.x>=we&&Pt.x<=Re&&Pt.y>=Te&&Pt.y<=st&&Pt!==g&&Pt!==A&&Up(k,K,F,re,z,fe,Pt.x,Pt.y)&&Wl(Pt.prev,Pt,Pt.next)>=0)return!1;Pt=Pt.nextZ}return!0}function Fg(o,r,u){var h=o;do{var g=h.prev,w=h.next.next;!pp(g,w)&&Mm(g,h,h.next,w)&&Om(g,w)&&Om(w,g)&&(r.push(g.i/u|0),r.push(h.i/u|0),r.push(w.i/u|0),Ed(h),Ed(h.next),h=o=w),h=h.next}while(h!==o);return cc(h)}function dp(o,r,u,h,g,w){var A=o;do{for(var k=A.next.next;k!==A.prev;){if(A.i!==k.i&&s1(A,k)){var F=m0(A,k);return A=cc(A,A.next),F=cc(F,F.next),fp(A,r,u,h,g,w,0),void fp(F,r,u,h,g,w,0)}k=k.next}A=A.next}while(A!==o)}function Bg(o,r){return o.x-r.x}function h0(o,r){var u=(function(g,w){var A,k=w,F=g.x,z=g.y,K=-1/0;do{if(z<=k.y&&z>=k.next.y&&k.next.y!==k.y){var re=k.x+(z-k.y)*(k.next.x-k.x)/(k.next.y-k.y);if(re<=F&&re>K&&(K=re,A=k.x<k.next.x?k:k.next,re===F))return A}k=k.next}while(k!==w);if(!A)return null;var fe,we=A,Te=A.x,Re=A.y,st=1/0;k=A;do F>=k.x&&k.x>=Te&&F!==k.x&&Up(z<Re?F:K,z,Te,Re,z<Re?K:F,z,k.x,k.y)&&(fe=Math.abs(z-k.y)/(F-k.x),Om(k,g)&&(fe<st||fe===st&&(k.x>A.x||k.x===A.x&&f0(A,k)))&&(A=k,st=fe)),k=k.next;while(k!==we);return A})(o,r);if(!u)return r;var h=m0(u,o);return cc(h,h.next),cc(u,u.next)}function f0(o,r){return Wl(o.prev,o,r.prev)<0&&Wl(r.next,o,o.next)<0}function d0(o,r,u,h,g){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-u)*g|0)|o<<8))|o<<4))|o<<2))|o<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-h)*g|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function p0(o){var r=o,u=o;do(r.x<u.x||r.x===u.x&&r.y<u.y)&&(u=r),r=r.next;while(r!==o);return u}function Up(o,r,u,h,g,w,A,k){return(g-A)*(r-k)>=(o-A)*(w-k)&&(o-A)*(h-k)>=(u-A)*(r-k)&&(u-A)*(w-k)>=(g-A)*(h-k)}function s1(o,r){return o.next.i!==r.i&&o.prev.i!==r.i&&!(function(u,h){var g=u;do{if(g.i!==u.i&&g.next.i!==u.i&&g.i!==h.i&&g.next.i!==h.i&&Mm(g,g.next,u,h))return!0;g=g.next}while(g!==u);return!1})(o,r)&&(Om(o,r)&&Om(r,o)&&(function(u,h){var g=u,w=!1,A=(u.x+h.x)/2,k=(u.y+h.y)/2;do g.y>k!=g.next.y>k&&g.next.y!==g.y&&A<(g.next.x-g.x)*(k-g.y)/(g.next.y-g.y)+g.x&&(w=!w),g=g.next;while(g!==u);return w})(o,r)&&(Wl(o.prev,o,r.prev)||Wl(o,r.prev,r))||pp(o,r)&&Wl(o.prev,o,o.next)>0&&Wl(r.prev,r,r.next)>0)}function Wl(o,r,u){return(r.y-o.y)*(u.x-r.x)-(r.x-o.x)*(u.y-r.y)}function pp(o,r){return o.x===r.x&&o.y===r.y}function Mm(o,r,u,h){var g=Vp(Wl(o,r,u)),w=Vp(Wl(o,r,h)),A=Vp(Wl(u,h,o)),k=Vp(Wl(u,h,r));return g!==w&&A!==k||!(g!==0||!Dm(o,u,r))||!(w!==0||!Dm(o,h,r))||!(A!==0||!Dm(u,o,h))||!(k!==0||!Dm(u,r,h))}function Dm(o,r,u){return r.x<=Math.max(o.x,u.x)&&r.x>=Math.min(o.x,u.x)&&r.y<=Math.max(o.y,u.y)&&r.y>=Math.min(o.y,u.y)}function Vp(o){return o>0?1:o<0?-1:0}function Om(o,r){return Wl(o.prev,o,o.next)<0?Wl(o,r,o.next)>=0&&Wl(o,o.prev,r)>=0:Wl(o,r,o.prev)<0||Wl(o,o.next,r)<0}function m0(o,r){var u=new Fm(o.i,o.x,o.y),h=new Fm(r.i,r.x,r.y),g=o.next,w=r.prev;return o.next=r,r.prev=o,u.next=g,g.prev=u,h.next=u,u.prev=h,w.next=h,h.prev=w,h}function zg(o,r,u,h){var g=new Fm(o,r,u);return h?(g.next=h.next,g.prev=h,h.next.prev=g,h.next=g):(g.prev=g,g.next=g),g}function Ed(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Fm(o,r,u){this.i=o,this.x=r,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qp(o,r,u,h){for(var g=0,w=r,A=u-h;w<u;w+=h)g+=(o[A]-o[w])*(o[w+1]+o[A+1]),A=w;return g}Og.exports=Rm,Og.exports.default=Rm,Rm.deviation=function(o,r,u,h){var g=r&&r.length,w=Math.abs(qp(o,0,g?r[0]*u:o.length,u));if(g)for(var A=0,k=r.length;A<k;A++)w-=Math.abs(qp(o,r[A]*u,A<k-1?r[A+1]*u:o.length,u));var F=0;for(A=0;A<h.length;A+=3){var z=h[A]*u,K=h[A+1]*u,re=h[A+2]*u;F+=Math.abs((o[z]-o[re])*(o[K+1]-o[z+1])-(o[z]-o[K])*(o[re+1]-o[z+1]))}return w===0&&F===0?0:Math.abs((F-w)/w)},Rm.flatten=function(o){for(var r=o[0][0].length,u={vertices:[],holes:[],dimensions:r},h=0,g=0;g<o.length;g++){for(var w=0;w<o[g].length;w++)for(var A=0;A<r;A++)u.vertices.push(o[g][w][A]);g>0&&u.holes.push(h+=o[g-1].length)}return u};var jg=de(Og.exports);function ab(o,r,u,h,g){Bm(o,r,u,h||o.length-1,g||jm)}function Bm(o,r,u,h,g){for(;h>u;){if(h-u>600){var w=h-u+1,A=r-u+1,k=Math.log(w),F=.5*Math.exp(2*k/3),z=.5*Math.sqrt(k*F*(w-F)/w)*(A-w/2<0?-1:1);Bm(o,r,Math.max(u,Math.floor(r-A*F/w+z)),Math.min(h,Math.floor(r+(w-A)*F/w+z)),g)}var K=o[r],re=u,fe=h;for(zm(o,u,r),g(o[h],K)>0&&zm(o,u,h);re<fe;){for(zm(o,re,fe),re++,fe--;g(o[re],K)<0;)re++;for(;g(o[fe],K)>0;)fe--}g(o[u],K)===0?zm(o,u,fe):zm(o,++fe,h),fe<=r&&(u=fe+1),r<=fe&&(h=fe-1)}}function zm(o,r,u){var h=o[r];o[r]=o[u],o[u]=h}function jm(o,r){return o<r?-1:o>r?1:0}function g0(o,r){const u=o.length;if(u<=1)return[o];const h=[];let g,w;for(let A=0;A<u;A++){const k=qr(o[A]);k!==0&&(o[A].area=Math.abs(k),w===void 0&&(w=k<0),w===k<0?(g&&h.push(g),g=[o[A]]):g.push(o[A]))}if(g&&h.push(g),r>1)for(let A=0;A<h.length;A++)h[A].length<=r||(ab(h[A],r,1,h[A].length-1,Ug),h[A]=h[A].slice(0,r));return h}function Ug(o,r){return r.area-o.area}function p(o,r,u){const h=u.patternDependencies;let g=!1;for(const w of r){const A=w.paint.get(`${o}-pattern`);A.isConstant()||(g=!0);const k=A.constantOr(null);k&&(g=!0,h[k]=!0)}return g}function v(o,r,u,h,g){const w=g.patternDependencies;for(const A of r){const k=A.paint.get(`${o}-pattern`).value;if(k.kind!=="constant"){let F=k.evaluate({zoom:h},u,{},g.availableImages);F=F&&F.name?F.name:F,w[F]=!0,u.patterns[A.id]=F}}return u}class C{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Rn,this.indexArray=new Vr,this.indexArray2=new $o,this.programConfigurations=new Jc(r.layers,r.zoom),this.segments=new xl,this.segments2=new xl,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id)),this.projection=r.projection}populate(r,u,h,g){this.hasPattern=p("fill",this.layers,u);const w=this.layers[0].layout.get("fill-sort-key"),A=[];for(const{feature:k,id:F,index:z,sourceLayerIndex:K}of r){const re=this.layers[0]._featureFilter.needGeometry,fe=Rf(k,re);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),fe,h))continue;const we=w?w.evaluate(fe,{},h,u.availableImages):void 0,Te={id:F,properties:k.properties,type:k.type,sourceLayerIndex:K,index:z,geometry:re?fe.geometry:Fc(k,h,g),patterns:{},sortKey:we};A.push(Te)}w&&A.sort(((k,F)=>k.sortKey-F.sortKey));for(const k of A){const{geometry:F,index:z,sourceLayerIndex:K}=k;if(this.hasPattern){const re=v("fill",this.layers,k,this.zoom,u);this.patternFeatures.push(re)}else this.addFeature(k,F,z,h,{},u.availableImages);u.featureIndex.insert(r[z].feature,F,z,K,this.index)}}update(r,u,h,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,h,g)}addFeatures(r,u,h,g,w){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,u,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,sb),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,u,h,g,w,A=[]){for(const k of g0(u,500)){let F=0;for(const Te of k)F+=Te.length;const z=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray),K=z.vertexLength,re=[],fe=[];for(const Te of k){if(Te.length===0)continue;Te!==k[0]&&fe.push(re.length/2);const Re=this.segments2.prepareSegment(Te.length,this.layoutVertexArray,this.indexArray2),st=Re.vertexLength;this.layoutVertexArray.emplaceBack(Te[0].x,Te[0].y),this.indexArray2.emplaceBack(st+Te.length-1,st),re.push(Te[0].x),re.push(Te[0].y);for(let _t=1;_t<Te.length;_t++)this.layoutVertexArray.emplaceBack(Te[_t].x,Te[_t].y),this.indexArray2.emplaceBack(st+_t-1,st+_t),re.push(Te[_t].x),re.push(Te[_t].y);Re.vertexLength+=Te.length,Re.primitiveLength+=Te.length}const we=jg(re,fe);for(let Te=0;Te<we.length;Te+=3)this.indexArray.emplaceBack(K+we[Te],K+we[Te+1],K+we[Te+2]);z.vertexLength+=F,z.primitiveLength+=we.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,w,A,g)}}Cr(C,"FillBucket",{omit:["layers","patternFeatures"]});const V=new yt({"fill-sort-key":new rt(En.layout_fill["fill-sort-key"])});var ne={paint:new yt({"fill-antialias":new Ie(En.paint_fill["fill-antialias"]),"fill-opacity":new rt(En.paint_fill["fill-opacity"]),"fill-color":new rt(En.paint_fill["fill-color"]),"fill-outline-color":new rt(En.paint_fill["fill-outline-color"]),"fill-translate":new Ie(En.paint_fill["fill-translate"]),"fill-translate-anchor":new Ie(En.paint_fill["fill-translate-anchor"]),"fill-pattern":new rt(En.paint_fill["fill-pattern"])}),layout:V};const xe=Bt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Je=Bt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Ft=Bt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Kt}=xe;var Nn={},br=G,Tr=hr;function hr(o,r,u,h,g){this.properties={},this.extent=u,this.type=0,this._pbf=o,this._geometry=-1,this._keys=h,this._values=g,o.readFields(fi,this,r)}function fi(o,r,u){o==1?r.id=u.readVarint():o==2?(function(h,g){for(var w=h.readVarint()+h.pos;h.pos<w;){var A=g._keys[h.readVarint()],k=g._values[h.readVarint()];g.properties[A]=k}})(u,r):o==3?r.type=u.readVarint():o==4&&(r._geometry=u.pos)}function Ii(o){for(var r,u,h=0,g=0,w=o.length,A=w-1;g<w;A=g++)h+=((u=o[A]).x-(r=o[g]).x)*(r.y+u.y);return h}hr.types=["Unknown","Point","LineString","Polygon"],hr.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var r,u=o.readVarint()+o.pos,h=1,g=0,w=0,A=0,k=[];o.pos<u;){if(g<=0){var F=o.readVarint();h=7&F,g=F>>3}if(g--,h===1||h===2)w+=o.readSVarint(),A+=o.readSVarint(),h===1&&(r&&k.push(r),r=[]),r.push(new br(w,A));else{if(h!==7)throw new Error("unknown command "+h);r&&r.push(r[0].clone())}}return r&&k.push(r),k},hr.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var r=o.readVarint()+o.pos,u=1,h=0,g=0,w=0,A=1/0,k=-1/0,F=1/0,z=-1/0;o.pos<r;){if(h<=0){var K=o.readVarint();u=7&K,h=K>>3}if(h--,u===1||u===2)(g+=o.readSVarint())<A&&(A=g),g>k&&(k=g),(w+=o.readSVarint())<F&&(F=w),w>z&&(z=w);else if(u!==7)throw new Error("unknown command "+u)}return[A,F,k,z]},hr.prototype.toGeoJSON=function(o,r,u){var h,g,w=this.extent*Math.pow(2,u),A=this.extent*o,k=this.extent*r,F=this.loadGeometry(),z=hr.types[this.type];function K(we){for(var Te=0;Te<we.length;Te++){var Re=we[Te];we[Te]=[360*(Re.x+A)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(Re.y+k)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var re=[];for(h=0;h<F.length;h++)re[h]=F[h][0];K(F=re);break;case 2:for(h=0;h<F.length;h++)K(F[h]);break;case 3:for(F=(function(we){var Te=we.length;if(Te<=1)return[we];for(var Re,st,_t=[],Rt=0;Rt<Te;Rt++){var xt=Ii(we[Rt]);xt!==0&&(st===void 0&&(st=xt<0),st===xt<0?(Re&&_t.push(Re),Re=[we[Rt]]):Re.push(we[Rt]))}return Re&&_t.push(Re),_t})(F),h=0;h<F.length;h++)for(g=0;g<F[h].length;g++)K(F[h][g])}F.length===1?F=F[0]:z="Multi"+z;var fe={type:"Feature",geometry:{type:z,coordinates:F},properties:this.properties};return"id"in this&&(fe.id=this.id),fe};var ki=Tr,du=Sn;function Sn(o,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(un,this,r),this.length=this._features.length}function un(o,r,u){o===15?r.version=u.readVarint():o===1?r.name=u.readString():o===5?r.extent=u.readVarint():o===2?r._features.push(u.pos):o===3?r._keys.push(u.readString()):o===4&&r._values.push((function(h){for(var g=null,w=h.readVarint()+h.pos;h.pos<w;){var A=h.readVarint()>>3;g=A===1?h.readString():A===2?h.readFloat():A===3?h.readDouble():A===4?h.readVarint64():A===5?h.readVarint():A===6?h.readSVarint():A===7?h.readBoolean():null}return g})(u))}Sn.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var r=this._pbf.readVarint()+this._pbf.pos;return new ki(this._pbf,r,this.extent,this._keys,this._values)};var Ln=du;function Or(o,r,u){if(o===3){var h=new Ln(u,u.readVarint()+u.pos);h.length&&(r[h.name]=h)}}var Li=Nn.VectorTile=function(o,r){this.layers=o.readFields(Or,{},r)},ns=Nn.VectorTileFeature=Tr;function rs(o,r,u,h){const g=[],w=h===0?(A,k,F,z,K,re)=>{A.push(new Y(re,F+(re-k)/(z-k)*(K-F)))}:(A,k,F,z,K,re)=>{A.push(new Y(k+(re-F)/(K-F)*(z-k),re))};for(const A of o){const k=[];for(const F of A){if(F.length<=2)continue;const z=[];for(let fe=0;fe<F.length-1;fe++){const we=F[fe].x,Te=F[fe].y,Re=F[fe+1].x,st=F[fe+1].y,_t=h===0?we:Te,Rt=h===0?Re:st;_t<r?Rt>r&&w(z,we,Te,Re,st,r):_t>u?Rt<u&&w(z,we,Te,Re,st,u):z.push(F[fe]),Rt<r&&_t>=r&&w(z,we,Te,Re,st,r),Rt>u&&_t<=u&&w(z,we,Te,Re,st,u)}let K=F[F.length-1];const re=h===0?K.x:K.y;re>=r&&re<=u&&z.push(K),z.length&&(K=z[z.length-1],z[0].x===K.x&&z[0].y===K.y||z.push(z[0]),k.push(z))}k.length&&g.push(k)}return g}Nn.VectorTileLayer=du;const Ls=ns.types,hc=Math.pow(2,13);function Oo(o,r,u,h,g,w,A,k){o.emplaceBack((r<<1)+A,(u<<1)+w,(Math.floor(h*hc)<<1)+g,Math.round(k))}function tf(o,r,u){o.emplaceBack(r.x,r.y,r.z,u[0]*16384,u[1]*16384,u[2]*16384)}class o1{constructor(){this.acc=new Y(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Y(r.x,r.y),this.max=new Y(r.x,r.y))}append(r,u){this.currentPolyCount.edges++,this.acc._add(r);const h=this.min,g=this.max;r.x<h.x?h.x=r.x:r.x>g.x&&(g.x=r.x),r.y<h.y?h.y=r.y:r.y>g.y&&(g.y=r.y),((r.x===0||r.x===pi)&&r.x===u.x)!=((r.y===0||r.y===pi)&&r.y===u.y)&&this.processBorderOverlap(r,u),u.x<0!=r.x<0&&this.addBorderIntersection(0,nt(u.y,r.y,(0-u.x)/(r.x-u.x))),u.x>pi!=r.x>pi&&this.addBorderIntersection(1,nt(u.y,r.y,(pi-u.x)/(r.x-u.x))),u.y<0!=r.y<0&&this.addBorderIntersection(2,nt(u.x,r.x,(0-u.y)/(r.y-u.y))),u.y>pi!=r.y>pi&&this.addBorderIntersection(3,nt(u.x,r.x,(pi-u.y)/(r.y-u.y)))}addBorderIntersection(r,u){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[r];u<h[0]&&(h[0]=u),u>h[1]&&(h[1]=u)}processBorderOverlap(r,u){if(r.x===u.x){if(r.y===u.y)return;const h=r.x===0?0:1;this.addBorderIntersection(h,u.y),this.addBorderIntersection(h,r.y)}else{const h=r.y===0?2:3;this.addBorderIntersection(h,u.x),this.addBorderIntersection(h,r.x)}}centroid(){const r=this.polyCount.reduce(((u,h)=>u+h.edges),0);return r!==0?this.acc.div(r)._round():new Y(0,0)}span(){return new Y(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((r,u)=>r+ +(u[0]!==Number.MAX_VALUE)),0)}}class y0{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.layoutVertexArray=new An,this.centroidVertexArray=new zu,this.indexArray=new Vr,this.programConfigurations=new Jc(r.layers,r.zoom),this.segments=new xl,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id)),this.enableTerrain=r.enableTerrain}populate(r,u,h,g){this.features=[],this.hasPattern=p("fill-extrusion",this.layers,u),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=(function(w){const A=Math.exp(Math.PI*(1-w.y/(1<<w.z)*2));return 80150034*A/(A*A+1)/pi/(1<<w.z)})(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:w,id:A,index:k,sourceLayerIndex:F}of r){const z=this.layers[0]._featureFilter.needGeometry,K=Rf(w,z);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),K,h))continue;const re={id:A,sourceLayerIndex:F,index:k,geometry:z?K.geometry:Fc(w,h,g),properties:w.properties,type:w.type,patterns:{}},fe=this.layoutVertexArray.length;this.hasPattern?this.features.push(v("fill-extrusion",this.layers,re,this.zoom,u)):this.addFeature(re,re.geometry,k,h,{},u.availableImages,g),u.featureIndex.insert(w,re.geometry,k,F,this.index,fe)}this.sortBorders()}addFeatures(r,u,h,g,w){for(const A of this.features){const{geometry:k}=A;this.addFeature(A,k,A.index,u,h,g,w)}this.sortBorders()}update(r,u,h,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Kt),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,Ft.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Je.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,u,h,g,w,A,k){const F=[new Y(0,0),new Y(pi,pi)],z=k.projection,K=z.name==="globe",re=this.enableTerrain&&!K?new o1:null,fe=Ls[r.type]==="Polygon";K&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Un);const we=g0(u,500);for(let _t=we.length-1;_t>=0;_t--){const Rt=we[_t];(Rt.length===0||(Te=Rt[0]).every((xt=>xt.x<=0))||Te.every((xt=>xt.x>=pi))||Te.every((xt=>xt.y<=0))||Te.every((xt=>xt.y>=pi)))&&we.splice(_t,1)}var Te;let Re;if(K)Re=R2(we,F,g);else{Re=[];for(const _t of we)Re.push({polygon:_t,bounds:F})}const st=fe?this.edgeRadius:0;for(const{polygon:_t,bounds:Rt}of Re){let xt=0,Pt=0;for(const jt of _t)fe&&!jt[0].equals(jt[jt.length-1])&&jt.push(jt[0]),Pt+=fe?jt.length-1:jt.length;const Vt=this.segments.prepareSegment((fe?5:4)*Pt,this.layoutVertexArray,this.indexArray);if(fe){const jt=[],wn=[];xt=Vt.vertexLength;for(const On of _t){let ar,kn;On.length&&On!==_t[0]&&wn.push(jt.length/2),ar=On[1].sub(On[0])._perp()._unit();for(let $n=1;$n<On.length;$n++){const Hn=On[$n],nr=On[$n===On.length-1?1:$n+1];let{x:fr,y:Mn}=Hn;if(st){kn=nr.sub(Hn)._perp()._unit();const Rr=ar.add(kn)._unit(),ii=st*Math.min(4,1/(ar.x*Rr.x+ar.y*Rr.y));fr+=ii*Rr.x,Mn+=ii*Rr.y,ar=kn}Oo(this.layoutVertexArray,fr,Mn,0,0,1,1,0),Vt.vertexLength++,jt.push(Hn.x,Hn.y),K&&tf(this.layoutVertexExtArray,z.projectTilePoint(fr,Mn,g),z.upVector(g,fr,Mn))}}const vn=jg(jt,wn);for(let On=0;On<vn.length;On+=3)this.indexArray.emplaceBack(xt+vn[On],xt+vn[On+2],xt+vn[On+1]),Vt.primitiveLength++}for(const jt of _t){re&&jt.length&&re.startRing(jt[0]);let wn,vn,On,ar=jt.length>4&&L2(jt[jt.length-2],jt[0],jt[1]),kn=st?RL(jt[jt.length-2],jt[0],jt[1],st):0;vn=jt[1].sub(jt[0])._perp()._unit();let $n=!0;for(let Hn=1,nr=0;Hn<jt.length;Hn++){let fr=jt[Hn-1],Mn=jt[Hn];const Rr=jt[Hn===jt.length-1?1:Hn+1];if(re&&fe&&re.currentPolyCount.top++,k2(Mn,fr,Rt)){st&&(vn=Rr.sub(Mn)._perp()._unit(),$n=!$n);continue}re&&re.append(Mn,fr);const ii=Mn.sub(fr)._perp(),zr=ii.x/(Math.abs(ii.x)+Math.abs(ii.y)),ys=ii.y>0?1:0,pr=fr.dist(Mn);if(nr+pr>32768&&(nr=0),st){On=Rr.sub(Mn)._perp()._unit();let vs=C2(fr,Mn,Rr,I2(vn,On),st);isNaN(vs)&&(vs=0);const Gi=Mn.sub(fr)._unit();fr=fr.add(Gi.mult(kn))._round(),Mn=Mn.add(Gi.mult(-vs))._round(),kn=vs,vn=On}const Ti=Vt.vertexLength,_s=jt.length>4&&L2(fr,Mn,Rr);let Fo=P2(nr,ar,$n);if(Oo(this.layoutVertexArray,fr.x,fr.y,zr,ys,0,0,Fo),Oo(this.layoutVertexArray,fr.x,fr.y,zr,ys,0,1,Fo),nr+=pr,Fo=P2(nr,_s,!$n),ar=_s,Oo(this.layoutVertexArray,Mn.x,Mn.y,zr,ys,0,0,Fo),Oo(this.layoutVertexArray,Mn.x,Mn.y,zr,ys,0,1,Fo),Vt.vertexLength+=4,this.indexArray.emplaceBack(Ti+0,Ti+1,Ti+2),this.indexArray.emplaceBack(Ti+1,Ti+3,Ti+2),Vt.primitiveLength+=2,st){const vs=xt+(Hn===1?jt.length-2:Hn-2),Gi=Hn===1?xt:vs+1;if(this.indexArray.emplaceBack(Ti+1,vs,Ti+3),this.indexArray.emplaceBack(vs,Gi,Ti+3),Vt.primitiveLength+=2,wn===void 0&&(wn=Ti),!k2(Rr,jt[Hn],Rt)){const el=Hn===jt.length-1?wn:Vt.vertexLength;this.indexArray.emplaceBack(Ti+2,Ti+3,el),this.indexArray.emplaceBack(Ti+3,el+1,el),this.indexArray.emplaceBack(Ti+3,Gi,el+1),Vt.primitiveLength+=3}$n=!$n}if(K){const vs=this.layoutVertexExtArray,Gi=z.projectTilePoint(fr.x,fr.y,g),el=z.projectTilePoint(Mn.x,Mn.y,g),bs=z.upVector(g,fr.x,fr.y),ws=z.upVector(g,Mn.x,Mn.y);tf(vs,Gi,bs),tf(vs,Gi,bs),tf(vs,el,ws),tf(vs,el,ws)}}fe&&(xt+=jt.length-1)}}if(re&&re.polyCount.length>0){if(re.borders){re.vertexArrayOffset=this.centroidVertexArray.length;const _t=re.borders,Rt=this.featuresOnBorder.push(re)-1;for(let xt=0;xt<4;xt++)_t[xt][0]!==Number.MAX_VALUE&&this.borders[xt].push(Rt)}this.encodeCentroid(re.borders?void 0:re.centroid(),re)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,w,A,g)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort(((u,h)=>this.featuresOnBorder[u].borders[r][0]-this.featuresOnBorder[h].borders[r][0]))}encodeCentroid(r,u,h=!0){let g,w;if(r)if(r.y!==0){const k=u.span()._mult(this.tileToMeter);g=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(k.x/10)),w=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(k.y/10))}else g=Math.ceil(7*(r.x+450)),w=0;else g=0,w=+h;let A=h?this.centroidVertexArray.length:u.vertexArrayOffset;for(const k of u.polyCount){h&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*k.edges+k.top);for(let F=0;F<k.top;F++)this.centroidVertexArray.emplace(A++,g,w);for(let F=0;F<2*k.edges;F++)this.centroidVertexArray.emplace(A++,0,w),this.centroidVertexArray.emplace(A++,g,w)}}}function I2(o,r){const u=o.add(r)._unit();return o.x*u.x+o.y*u.y}function RL(o,r,u,h){const g=r.sub(o)._perp()._unit(),w=u.sub(r)._perp()._unit();return C2(o,r,u,I2(g,w),h)}function C2(o,r,u,h,g){const w=Math.sqrt(1-h*h);return Math.min(o.dist(r)/3,r.dist(u)/3,g*w/h)}function k2(o,r,u){return o.x<u[0].x&&r.x<u[0].x||o.x>u[1].x&&r.x>u[1].x||o.y<u[0].y&&r.y<u[0].y||o.y>u[1].y&&r.y>u[1].y}function L2(o,r,u){if(o.x<0||o.x>=pi||r.x<0||r.x>=pi||u.x<0||u.x>=pi)return!1;const h=u.sub(r),g=h.perp(),w=o.sub(r);return(h.x*w.x+h.y*w.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(w.x*w.x+w.y*w.y))>-.866&&g.x*w.x+g.y*w.y<0}function P2(o,r,u){const h=r?2|o:-3&o;return u?1|h:-2&h}function N2(){const o=Math.PI/32,r=Math.tan(o),u=Ac;return u*Math.sqrt(1+2*r*r)-u}function R2(o,r,u){const h=1<<u.z,g=Hl(u.x/h),w=Hl((u.x+1)/h),A=Ao(u.y/h),k=Ao((u.y+1)/h);return(function(F,z,K,re,fe=0,we){const Te=[];if(!F.length||!K||!re)return Te;const Re=(jt,wn)=>{for(const vn of jt)Te.push({polygon:vn,bounds:wn})},st=Math.ceil(Math.log2(K)),_t=Math.ceil(Math.log2(re)),Rt=st-_t,xt=[];for(let jt=0;jt<Math.abs(Rt);jt++)xt.push(Rt>0?0:1);for(let jt=0;jt<Math.min(st,_t);jt++)xt.push(0),xt.push(1);let Pt=F;if(Pt=rs(Pt,z[0].y-fe,z[1].y+fe,1),Pt=rs(Pt,z[0].x-fe,z[1].x+fe,0),!Pt.length)return Te;const Vt=[];for(xt.length?Vt.push({polygons:Pt,bounds:z,depth:0}):Re(Pt,z);Vt.length;){const jt=Vt.pop(),wn=jt.depth,vn=xt[wn],On=jt.bounds[0],ar=jt.bounds[1],kn=vn===0?On.x:On.y,$n=vn===0?ar.x:ar.y,Hn=we?we(vn,kn,$n):.5*(kn+$n),nr=rs(jt.polygons,kn-fe,Hn+fe,vn),fr=rs(jt.polygons,Hn-fe,$n+fe,vn);if(nr.length){const Mn=[On,new Y(vn===0?Hn:ar.x,vn===1?Hn:ar.y)];xt.length>wn+1?Vt.push({polygons:nr,bounds:Mn,depth:wn+1}):Re(nr,Mn)}if(fr.length){const Mn=[new Y(vn===0?Hn:On.x,vn===1?Hn:On.y),ar];xt.length>wn+1?Vt.push({polygons:fr,bounds:Mn,depth:wn+1}):Re(fr,Mn)}}return Te})(o,r,Math.ceil((w-g)/11.25),Math.ceil((A-k)/11.25),1,((F,z,K)=>{if(F===0)return .5*(z+K);{const re=Ao((u.y+z/pi)/h);return(Qa(.5*(Ao((u.y+K/pi)/h)+re))*h-u.y)*pi}}))}Cr(y0,"FillExtrusionBucket",{omit:["layers","features"]}),Cr(o1,"PartMetadata");const ML=new yt({"fill-extrusion-edge-radius":new Ie(En["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var DL={paint:new yt({"fill-extrusion-opacity":new Ie(En["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new rt(En["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ie(En["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ie(En["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new rt(En["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new rt(En["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new rt(En["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ie(En["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ie(En["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ie(En["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new Ie(En["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:ML};function M2(o,r,u){var h=2*Math.PI*6378137/256/Math.pow(2,u);return[o*h-2*Math.PI*6378137/2,r*h-2*Math.PI*6378137/2]}class a1{constructor(r,u,h){this.z=r,this.x=u,this.y=h,this.key=_0(0,r,r,u,h)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,u){const h=(function(w,A,k){var F=M2(256*w,256*(A=Math.pow(2,k)-A-1),k),z=M2(256*(w+1),256*(A+1),k);return F[0]+","+F[1]+","+z[0]+","+z[1]})(this.x,this.y,this.z),g=(function(w,A,k){let F,z="";for(let K=w;K>0;K--)F=1<<K-1,z+=(A&F?1:0)+(k&F?2:0);return z})(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class D2{constructor(r,u){this.wrap=r,this.canonical=u,this.key=_0(r,u.z,u.z,u.x,u.y)}}class gh{constructor(r,u,h,g,w){this.overscaledZ=r,this.wrap=u,this.canonical=new a1(h,+g,+w),this.key=u===0&&r===h?this.canonical.key:_0(u,r,h,g,w)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const u=this.canonical.z-r;return r>this.canonical.z?new gh(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new gh(r,this.wrap,r,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(r,u=!0){if(this.overscaledZ===r&&u)return this.key;if(r>this.canonical.z)return _0(this.wrap*+u,r,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-r;return _0(this.wrap*+u,r,r,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const u=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>u&&r.canonical.y===this.canonical.y>>u}children(r){if(this.overscaledZ>=r)return[new gh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,h=2*this.canonical.x,g=2*this.canonical.y;return[new gh(u,this.wrap,u,h,g),new gh(u,this.wrap,u,h+1,g),new gh(u,this.wrap,u,h,g+1),new gh(u,this.wrap,u,h+1,g+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new gh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new gh(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new D2(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function _0(o,r,u,h,g){const w=1<<Math.min(u,22);let A=w*(g%w)+h%w;return o&&u<22&&(A+=w*w*((o<0?-2*o-1:2*o)%(1<<2*(22-u)))),16*(32*A+u)+(r-u)}Cr(a1,"CanonicalTileID"),Cr(gh,"OverscaledTileID",{omit:["projMatrix"]});class Vg extends Y{constructor(r,u,h){super(r,u),this.z=h}}function v0(o,r){return o.x*r.x+o.y*r.y}function O2(o,r){if(o.length===1){let u=0;const h=r[u++];let g;for(;!g||h.equals(g);)if(g=r[u++],!g)return 1/0;for(;u<r.length;u++){const w=r[u],A=o[0],k=g.sub(h),F=w.sub(h),z=A.sub(h),K=v0(k,k),re=v0(k,F),fe=v0(F,F),we=v0(z,k),Te=v0(z,F),Re=K*fe-re*re,st=(fe*we-re*Te)/Re,_t=(K*Te-re*we)/Re,Rt=h.z*(1-st-_t)+g.z*st+w.z*_t;if(isFinite(Rt))return Rt}return 1/0}{let u=1/0;for(const h of r)u=Math.min(u,h.z);return u}}function F2(o,r,u,h,g,w,A,k){const F=A*g.getElevationAt(o,r,!0,!0),z=w[0]!==0,K=z?w[1]===0?A*(w[0]/7-450):A*(function(re,fe,we){const Te=Math.floor(fe[0]/8),Re=Math.floor(fe[1]/8),st=10*(fe[0]-8*Te),_t=10*(fe[1]-8*Re),Rt=re.getElevationAt(Te,Re,!0,!0),xt=re.getMeterToDEM(we),Pt=Math.floor(.5*(st*xt-1)),Vt=Math.floor(.5*(_t*xt-1)),jt=re.tileCoordToPixel(Te,Re),wn=2*Pt+1,vn=2*Vt+1,On=(function(fr,Mn,Rr,ii,zr){return[fr.getElevationAtPixel(Mn,Rr,!0),fr.getElevationAtPixel(Mn+zr,Rr,!0),fr.getElevationAtPixel(Mn,Rr+zr,!0),fr.getElevationAtPixel(Mn+ii,Rr+zr,!0)]})(re,jt.x-Pt,jt.y-Vt,wn,vn),ar=Math.abs(On[0]-On[1]),kn=Math.abs(On[2]-On[3]),$n=Math.abs(On[0]-On[2])+Math.abs(On[1]-On[3]),Hn=Math.min(.25,.5*xt*(ar+kn)/wn),nr=Math.min(.25,.5*xt*$n/vn);return Rt+Math.max(Hn*st,nr*_t)})(g,w,k):F;return{base:F+(u===0)?-1:u,top:z?Math.max(K+h,F+u+2):F+h}}const OL=Bt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:FL}=OL,BL=Bt([{name:"a_packed",components:4,type:"Float32"}]),{members:zL}=BL,jL=ns.types,UL=Math.cos(Math.PI/180*37.5);class l1{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((u=>{this.gradients[u.id]={}})),this.layoutVertexArray=new cn,this.layoutVertexArray2=new Vn,this.indexArray=new Vr,this.programConfigurations=new Jc(r.layers,r.zoom),this.segments=new xl,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(r,u,h,g){this.hasPattern=p("line",this.layers,u);const w=this.layers[0].layout.get("line-sort-key"),A=[];for(const{feature:K,id:re,index:fe,sourceLayerIndex:we}of r){const Te=this.layers[0]._featureFilter.needGeometry,Re=Rf(K,Te);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),Re,h))continue;const st=w?w.evaluate(Re,{},h):void 0,_t={id:re,properties:K.properties,type:K.type,sourceLayerIndex:we,index:fe,geometry:Te?Re.geometry:Fc(K,h,g),patterns:{},sortKey:st};A.push(_t)}w&&A.sort(((K,re)=>K.sortKey-re.sortKey));const{lineAtlas:k,featureIndex:F}=u,z=this.addConstantDashes(k);for(const K of A){const{geometry:re,index:fe,sourceLayerIndex:we}=K;if(z&&this.addFeatureDashes(K,k),this.hasPattern){const Te=v("line",this.layers,K,this.zoom,u);this.patternFeatures.push(Te)}else this.addFeature(K,re,fe,h,k.positions,u.availableImages);F.insert(r[fe].feature,re,fe,we,this.index)}}addConstantDashes(r){let u=!1;for(const h of this.layers){const g=h.paint.get("line-dasharray").value,w=h.layout.get("line-cap").value;if(g.kind!=="constant"||w.kind!=="constant")u=!0;else{const A=w.value,k=g.value;if(!k)continue;r.addDash(k,A)}}return u}addFeatureDashes(r,u){const h=this.zoom;for(const g of this.layers){const w=g.paint.get("line-dasharray").value,A=g.layout.get("line-cap").value;if(w.kind==="constant"&&A.kind==="constant")continue;let k,F;if(w.kind==="constant"){if(k=w.value,!k)continue}else k=w.evaluate({zoom:h},r);F=A.kind==="constant"?A.value:A.evaluate({zoom:h},r),u.addDash(k,F),r.patterns[g.id]=u.getKey(k,F)}}update(r,u,h,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,h,g)}addFeatures(r,u,h,g,w){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,u,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,zL)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,FL),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,u,h,g,w,A){const k=this.layers[0].layout,F=k.get("line-join").evaluate(r,{}),z=k.get("line-cap").evaluate(r,{}),K=k.get("line-miter-limit"),re=k.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const fe of u)this.addLine(fe,r,F,z,K,re);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,w,A,g)}addLine(r,u,h,g,w,A){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let _t=0;_t<r.length-1;_t++)this.totalDistance+=r[_t].dist(r[_t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const k=jL[u.type]==="Polygon";let F=r.length;for(;F>=2&&r[F-1].equals(r[F-2]);)F--;let z=0;for(;z<F-1&&r[z].equals(r[z+1]);)z++;if(F<(k?3:2))return;h==="bevel"&&(w=1.05);const K=this.overscaling<=16?15*pi/(512*this.overscaling):0,re=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray);let fe,we,Te,Re,st;this.e1=this.e2=-1,k&&(fe=r[F-2],st=r[z].sub(fe)._unit()._perp());for(let _t=z;_t<F;_t++){if(Te=_t===F-1?k?r[z+1]:void 0:r[_t+1],Te&&r[_t].equals(Te))continue;st&&(Re=st),fe&&(we=fe),fe=r[_t],st=Te?Te.sub(fe)._unit()._perp():Re,Re=Re||st;let Rt=Re.add(st);Rt.x===0&&Rt.y===0||Rt._unit();const xt=Re.x*st.x+Re.y*st.y,Pt=Rt.x*st.x+Rt.y*st.y,Vt=Pt!==0?1/Pt:1/0,jt=2*Math.sqrt(2-2*Pt),wn=Pt<UL&&we&&Te,vn=Re.x*st.y-Re.y*st.x>0;if(wn&&_t>z){const kn=fe.dist(we);if(kn>2*K){const $n=fe.sub(fe.sub(we)._mult(K/kn)._round());this.updateDistance(we,$n),this.addCurrentVertex($n,Re,0,0,re),we=$n}}const On=we&&Te;let ar=On?h:k?"butt":g;if(On&&ar==="round"&&(Vt<A?ar="miter":Vt<=2&&(ar="fakeround")),ar==="miter"&&Vt>w&&(ar="bevel"),ar==="bevel"&&(Vt>2&&(ar="flipbevel"),Vt<w&&(ar="miter")),we&&this.updateDistance(we,fe),ar==="miter")Rt._mult(Vt),this.addCurrentVertex(fe,Rt,0,0,re);else if(ar==="flipbevel"){if(Vt>100)Rt=st.mult(-1);else{const kn=Vt*Re.add(st).mag()/Re.sub(st).mag();Rt._perp()._mult(kn*(vn?-1:1))}this.addCurrentVertex(fe,Rt,0,0,re),this.addCurrentVertex(fe,Rt.mult(-1),0,0,re)}else if(ar==="bevel"||ar==="fakeround"){const kn=-Math.sqrt(Vt*Vt-1),$n=vn?kn:0,Hn=vn?0:kn;if(we&&this.addCurrentVertex(fe,Re,$n,Hn,re),ar==="fakeround"){const nr=Math.round(180*jt/Math.PI/20);for(let fr=1;fr<nr;fr++){let Mn=fr/nr;if(Mn!==.5){const ii=Mn-.5;Mn+=Mn*ii*(Mn-1)*((1.0904+xt*(xt*(3.55645-1.43519*xt)-3.2452))*ii*ii+(.848013+xt*(.215638*xt-1.06021)))}const Rr=st.sub(Re)._mult(Mn)._add(Re)._unit()._mult(vn?-1:1);this.addHalfVertex(fe,Rr.x,Rr.y,!1,vn,0,re)}}Te&&this.addCurrentVertex(fe,st,-$n,-Hn,re)}else if(ar==="butt")this.addCurrentVertex(fe,Rt,0,0,re);else if(ar==="square"){const kn=we?1:-1;we||this.addCurrentVertex(fe,Rt,kn,kn,re),this.addCurrentVertex(fe,Rt,0,0,re),we&&this.addCurrentVertex(fe,Rt,kn,kn,re)}else ar==="round"&&(we&&(this.addCurrentVertex(fe,Re,0,0,re),this.addCurrentVertex(fe,Re,1,1,re,!0)),Te&&(this.addCurrentVertex(fe,st,-1,-1,re,!0),this.addCurrentVertex(fe,st,0,0,re)));if(wn&&_t<F-1){const kn=fe.dist(Te);if(kn>2*K){const $n=fe.add(Te.sub(fe)._mult(K/kn)._round());this.updateDistance(fe,$n),this.addCurrentVertex($n,st,0,0,re),fe=$n}}}}addCurrentVertex(r,u,h,g,w,A=!1){const k=u.y*g-u.x,F=-u.y-u.x*g;this.addHalfVertex(r,u.x+u.y*h,u.y-u.x*h,A,!1,h,w),this.addHalfVertex(r,k,F,A,!0,-g,w)}addHalfVertex({x:r,y:u},h,g,w,A,k,F){this.layoutVertexArray.emplaceBack((r<<1)+(w?1:0),(u<<1)+(A?1:0),Math.round(63*h)+128,Math.round(63*g)+128,1+(k===0?0:k<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const z=F.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),F.primitiveLength++),A?this.e2=z:this.e1=z}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,u){this.distance+=r.dist(u),this.updateScaledDistance()}}Cr(l1,"LineBucket",{omit:["layers","patternFeatures"]});const VL=new yt({"line-cap":new rt(En.layout_line["line-cap"]),"line-join":new rt(En.layout_line["line-join"]),"line-miter-limit":new Ie(En.layout_line["line-miter-limit"]),"line-round-limit":new Ie(En.layout_line["line-round-limit"]),"line-sort-key":new rt(En.layout_line["line-sort-key"])});var B2={paint:new yt({"line-opacity":new rt(En.paint_line["line-opacity"]),"line-color":new rt(En.paint_line["line-color"]),"line-translate":new Ie(En.paint_line["line-translate"]),"line-translate-anchor":new Ie(En.paint_line["line-translate-anchor"]),"line-width":new rt(En.paint_line["line-width"]),"line-gap-width":new rt(En.paint_line["line-gap-width"]),"line-offset":new rt(En.paint_line["line-offset"]),"line-blur":new rt(En.paint_line["line-blur"]),"line-dasharray":new rt(En.paint_line["line-dasharray"]),"line-pattern":new rt(En.paint_line["line-pattern"]),"line-gradient":new gt(En.paint_line["line-gradient"]),"line-trim-offset":new Ie(En.paint_line["line-trim-offset"])}),layout:VL};const z2=new class extends rt{possiblyEvaluate(o,r){return r=new Z(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(o,r)}evaluate(o,r,u,h){return r=Ve({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(o,r,u,h)}}(B2.paint.properties["line-width"].specification);function j2(o,r){return r>0?r+2*o:o}z2.useIntegerZoom=!0;const qL=Bt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),GL=Bt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),$L=Bt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Bt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const HL=Bt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),WL=Bt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Bt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const U2=Bt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),XL=Bt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Bt([{name:"triangle",components:3,type:"Uint16"}]),Bt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Bt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Bt([{type:"Float32",name:"offsetX"}]),Bt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Cc=24;const Qf=128;function lb(o,r){const{expression:u}=r;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Z(o+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:g}=u;let w=0;for(;w<h.length&&h[w]<=o;)w++;w=Math.max(0,w-1);let A=w;for(;A<h.length&&h[A]<o+1;)A++;A=Math.min(h.length-1,A);const k=h[w],F=h[A];return u.kind==="composite"?{kind:"composite",minZoom:k,maxZoom:F,interpolationType:g}:{kind:"camera",minZoom:k,maxZoom:F,minSize:u.evaluate(new Z(k)),maxSize:u.evaluate(new Z(F)),interpolationType:g}}}function u1(o,{uSize:r,uSizeT:u},{lowerSize:h,upperSize:g}){return o.kind==="source"?h/Qf:o.kind==="composite"?nt(h/Qf,g/Qf,u):r}function qg(o,r){let u=0,h=0;if(o.kind==="constant")h=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:g,minZoom:w,maxZoom:A}=o,k=g?He(ll.interpolationFactor(g,r,w,A),0,1):0;o.kind==="camera"?h=nt(o.minSize,o.maxSize,k):u=k}return{uSizeT:u,uSize:h}}var YL=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Qf,evaluateSizeForFeature:u1,evaluateSizeForZoom:qg,getSizeData:lb});function KL(o,r,u){return o.sections.forEach((h=>{h.text=(function(g,w,A){const k=w.layout.get("text-transform").evaluate(A,{});return k==="uppercase"?g=g.toLocaleUpperCase():k==="lowercase"&&(g=g.toLocaleLowerCase()),W.applyArabicShaping&&(g=W.applyArabicShaping(g)),g})(h.text,r,u)})),o}const x0={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function ZL(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}function JL(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}var V2=Ba,q2=function(o,r,u,h,g){var w,A,k=8*g-h-1,F=(1<<k)-1,z=F>>1,K=-7,re=g-1,fe=-1,we=o[r+re];for(re+=fe,w=we&(1<<-K)-1,we>>=-K,K+=k;K>0;w=256*w+o[r+re],re+=fe,K-=8);for(A=w&(1<<-K)-1,w>>=-K,K+=h;K>0;A=256*A+o[r+re],re+=fe,K-=8);if(w===0)w=1-z;else{if(w===F)return A?NaN:1/0*(we?-1:1);A+=Math.pow(2,h),w-=z}return(we?-1:1)*A*Math.pow(2,w-h)},G2=function(o,r,u,h,g,w){var A,k,F,z=8*w-g-1,K=(1<<z)-1,re=K>>1,fe=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,we=0,Te=1,Re=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(k=isNaN(r)?1:0,A=K):(A=Math.floor(Math.log(r)/Math.LN2),r*(F=Math.pow(2,-A))<1&&(A--,F*=2),(r+=A+re>=1?fe/F:fe*Math.pow(2,1-re))*F>=2&&(A++,F/=2),A+re>=K?(k=0,A=K):A+re>=1?(k=(r*F-1)*Math.pow(2,g),A+=re):(k=r*Math.pow(2,re-1)*Math.pow(2,g),A=0));g>=8;o[u+we]=255&k,we+=Te,k/=256,g-=8);for(A=A<<g|k,z+=g;z>0;o[u+we]=255&A,we+=Te,A/=256,z-=8);o[u+we-Te]|=128*Re};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Ba(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Ba.Varint=0,Ba.Fixed64=1,Ba.Bytes=2,Ba.Fixed32=5;var ub=4294967296,$2=1/ub,H2=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function mp(o){return o.type===Ba.Bytes?o.readVarint()+o.pos:o.pos+1}function Gg(o,r,u){return u?4294967296*r+(o>>>0):4294967296*(r>>>0)+(o>>>0)}function W2(o,r,u){var h=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));u.realloc(h);for(var g=u.pos-1;g>=o;g--)u.buf[g+h]=u.buf[g]}function QL(o,r){for(var u=0;u<o.length;u++)r.writeVarint(o[u])}function e8(o,r){for(var u=0;u<o.length;u++)r.writeSVarint(o[u])}function t8(o,r){for(var u=0;u<o.length;u++)r.writeFloat(o[u])}function n8(o,r){for(var u=0;u<o.length;u++)r.writeDouble(o[u])}function r8(o,r){for(var u=0;u<o.length;u++)r.writeBoolean(o[u])}function i8(o,r){for(var u=0;u<o.length;u++)r.writeFixed32(o[u])}function s8(o,r){for(var u=0;u<o.length;u++)r.writeSFixed32(o[u])}function o8(o,r){for(var u=0;u<o.length;u++)r.writeFixed64(o[u])}function a8(o,r){for(var u=0;u<o.length;u++)r.writeSFixed64(o[u])}function c1(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+16777216*o[r+3]}function $g(o,r,u){o[u]=r,o[u+1]=r>>>8,o[u+2]=r>>>16,o[u+3]=r>>>24}function X2(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+(o[r+3]<<24)}Ba.prototype={destroy:function(){this.buf=null},readFields:function(o,r,u){for(u=u||this.length;this.pos<u;){var h=this.readVarint(),g=h>>3,w=this.pos;this.type=7&h,o(g,r,this),this.pos===w&&this.skip(h)}return r},readMessage:function(o,r){return this.readFields(o,r,this.readVarint()+this.pos)},readFixed32:function(){var o=c1(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=X2(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=c1(this.buf,this.pos)+c1(this.buf,this.pos+4)*ub;return this.pos+=8,o},readSFixed64:function(){var o=c1(this.buf,this.pos)+X2(this.buf,this.pos+4)*ub;return this.pos+=8,o},readFloat:function(){var o=q2(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=q2(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var r,u,h=this.buf;return r=127&(u=h[this.pos++]),u<128?r:(r|=(127&(u=h[this.pos++]))<<7,u<128?r:(r|=(127&(u=h[this.pos++]))<<14,u<128?r:(r|=(127&(u=h[this.pos++]))<<21,u<128?r:(function(g,w,A){var k,F,z=A.buf;if(k=(112&(F=z[A.pos++]))>>4,F<128||(k|=(127&(F=z[A.pos++]))<<3,F<128)||(k|=(127&(F=z[A.pos++]))<<10,F<128)||(k|=(127&(F=z[A.pos++]))<<17,F<128)||(k|=(127&(F=z[A.pos++]))<<24,F<128)||(k|=(1&(F=z[A.pos++]))<<31,F<128))return Gg(g,k,w);throw new Error("Expected varint not more than 10 bytes")})(r|=(15&(u=h[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,r=this.pos;return this.pos=o,o-r>=12&&H2?(function(u,h,g){return H2.decode(u.subarray(h,g))})(this.buf,r,o):(function(u,h,g){for(var w="",A=h;A<g;){var k,F,z,K=u[A],re=null,fe=K>239?4:K>223?3:K>191?2:1;if(A+fe>g)break;fe===1?K<128&&(re=K):fe===2?(192&(k=u[A+1]))==128&&(re=(31&K)<<6|63&k)<=127&&(re=null):fe===3?(F=u[A+2],(192&(k=u[A+1]))==128&&(192&F)==128&&((re=(15&K)<<12|(63&k)<<6|63&F)<=2047||re>=55296&&re<=57343)&&(re=null)):fe===4&&(F=u[A+2],z=u[A+3],(192&(k=u[A+1]))==128&&(192&F)==128&&(192&z)==128&&((re=(15&K)<<18|(63&k)<<12|(63&F)<<6|63&z)<=65535||re>=1114112)&&(re=null)),re===null?(re=65533,fe=1):re>65535&&(re-=65536,w+=String.fromCharCode(re>>>10&1023|55296),re=56320|1023&re),w+=String.fromCharCode(re),A+=fe}return w})(this.buf,r,o)},readBytes:function(){var o=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,o);return this.pos=o,r},readPackedVarint:function(o,r){if(this.type!==Ba.Bytes)return o.push(this.readVarint(r));var u=mp(this);for(o=o||[];this.pos<u;)o.push(this.readVarint(r));return o},readPackedSVarint:function(o){if(this.type!==Ba.Bytes)return o.push(this.readSVarint());var r=mp(this);for(o=o||[];this.pos<r;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Ba.Bytes)return o.push(this.readBoolean());var r=mp(this);for(o=o||[];this.pos<r;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Ba.Bytes)return o.push(this.readFloat());var r=mp(this);for(o=o||[];this.pos<r;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Ba.Bytes)return o.push(this.readDouble());var r=mp(this);for(o=o||[];this.pos<r;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Ba.Bytes)return o.push(this.readFixed32());var r=mp(this);for(o=o||[];this.pos<r;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Ba.Bytes)return o.push(this.readSFixed32());var r=mp(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Ba.Bytes)return o.push(this.readFixed64());var r=mp(this);for(o=o||[];this.pos<r;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Ba.Bytes)return o.push(this.readSFixed64());var r=mp(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed64());return o},skip:function(o){var r=7&o;if(r===Ba.Varint)for(;this.buf[this.pos++]>127;);else if(r===Ba.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Ba.Fixed32)this.pos+=4;else{if(r!==Ba.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(o,r){this.writeVarint(o<<3|r)},realloc:function(o){for(var r=this.length||16;r<this.pos+o;)r*=2;if(r!==this.length){var u=new Uint8Array(r);u.set(this.buf),this.buf=u,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),$g(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),$g(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),$g(this.buf,-1&o,this.pos),$g(this.buf,Math.floor(o*$2),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),$g(this.buf,-1&o,this.pos),$g(this.buf,Math.floor(o*$2),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?(function(r,u){var h,g;if(r>=0?(h=r%4294967296|0,g=r/4294967296|0):(g=~(-r/4294967296),4294967295^(h=~(-r%4294967296))?h=h+1|0:(h=0,g=g+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),(function(w,A,k){k.buf[k.pos++]=127&w|128,w>>>=7,k.buf[k.pos++]=127&w|128,w>>>=7,k.buf[k.pos++]=127&w|128,w>>>=7,k.buf[k.pos++]=127&w|128,k.buf[k.pos]=127&(w>>>=7)})(h,0,u),(function(w,A){var k=(7&w)<<4;A.buf[A.pos++]|=k|((w>>>=3)?128:0),w&&(A.buf[A.pos++]=127&w|((w>>>=7)?128:0),w&&(A.buf[A.pos++]=127&w|((w>>>=7)?128:0),w&&(A.buf[A.pos++]=127&w|((w>>>=7)?128:0),w&&(A.buf[A.pos++]=127&w|((w>>>=7)?128:0),w&&(A.buf[A.pos++]=127&w)))))})(g,u)})(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var r=this.pos;this.pos=(function(h,g,w){for(var A,k,F=0;F<g.length;F++){if((A=g.charCodeAt(F))>55295&&A<57344){if(!k){A>56319||F+1===g.length?(h[w++]=239,h[w++]=191,h[w++]=189):k=A;continue}if(A<56320){h[w++]=239,h[w++]=191,h[w++]=189,k=A;continue}A=k-55296<<10|A-56320|65536,k=null}else k&&(h[w++]=239,h[w++]=191,h[w++]=189,k=null);A<128?h[w++]=A:(A<2048?h[w++]=A>>6|192:(A<65536?h[w++]=A>>12|224:(h[w++]=A>>18|240,h[w++]=A>>12&63|128),h[w++]=A>>6&63|128),h[w++]=63&A|128)}return w})(this.buf,o,this.pos);var u=this.pos-r;u>=128&&W2(r,u,this),this.pos=r-1,this.writeVarint(u),this.pos+=u},writeFloat:function(o){this.realloc(4),G2(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),G2(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var r=o.length;this.writeVarint(r),this.realloc(r);for(var u=0;u<r;u++)this.buf[this.pos++]=o[u]},writeRawMessage:function(o,r){this.pos++;var u=this.pos;o(r,this);var h=this.pos-u;h>=128&&W2(u,h,this),this.pos=u-1,this.writeVarint(h),this.pos+=h},writeMessage:function(o,r,u){this.writeTag(o,Ba.Bytes),this.writeRawMessage(r,u)},writePackedVarint:function(o,r){r.length&&this.writeMessage(o,QL,r)},writePackedSVarint:function(o,r){r.length&&this.writeMessage(o,e8,r)},writePackedBoolean:function(o,r){r.length&&this.writeMessage(o,r8,r)},writePackedFloat:function(o,r){r.length&&this.writeMessage(o,t8,r)},writePackedDouble:function(o,r){r.length&&this.writeMessage(o,n8,r)},writePackedFixed32:function(o,r){r.length&&this.writeMessage(o,i8,r)},writePackedSFixed32:function(o,r){r.length&&this.writeMessage(o,s8,r)},writePackedFixed64:function(o,r){r.length&&this.writeMessage(o,o8,r)},writePackedSFixed64:function(o,r){r.length&&this.writeMessage(o,a8,r)},writeBytesField:function(o,r){this.writeTag(o,Ba.Bytes),this.writeBytes(r)},writeFixed32Field:function(o,r){this.writeTag(o,Ba.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(o,r){this.writeTag(o,Ba.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(o,r){this.writeTag(o,Ba.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(o,r){this.writeTag(o,Ba.Fixed64),this.writeSFixed64(r)},writeVarintField:function(o,r){this.writeTag(o,Ba.Varint),this.writeVarint(r)},writeSVarintField:function(o,r){this.writeTag(o,Ba.Varint),this.writeSVarint(r)},writeStringField:function(o,r){this.writeTag(o,Ba.Bytes),this.writeString(r)},writeFloatField:function(o,r){this.writeTag(o,Ba.Fixed32),this.writeFloat(r)},writeDoubleField:function(o,r){this.writeTag(o,Ba.Fixed64),this.writeDouble(r)},writeBooleanField:function(o,r){this.writeVarintField(o,!!r)}};var h1=de(V2);const cb=3;function l8(o,r,u){r.glyphs=[],o===1&&u.readMessage(u8,r)}function u8(o,r,u){if(o===3){const{id:h,bitmap:g,width:w,height:A,left:k,top:F,advance:z}=u.readMessage(c8,{});r.glyphs.push({id:h,bitmap:new mh({width:w+2*cb,height:A+2*cb},g),metrics:{width:w,height:A,left:k,top:F,advance:z}})}else o===4?r.ascender=u.readSVarint():o===5&&(r.descender=u.readSVarint())}function c8(o,r,u){o===1?r.id=u.readVarint():o===2?r.bitmap=u.readBytes():o===3?r.width=u.readVarint():o===4?r.height=u.readVarint():o===5?r.left=u.readSVarint():o===6?r.top=u.readSVarint():o===7&&(r.advance=u.readVarint())}const Y2=cb;function hb(o){let r=0,u=0;for(const A of o)r+=A.w*A.h,u=Math.max(u,A.w);o.sort(((A,k)=>k.h-A.h));const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),u),h:1/0}];let g=0,w=0;for(const A of o)for(let k=h.length-1;k>=0;k--){const F=h[k];if(!(A.w>F.w||A.h>F.h)){if(A.x=F.x,A.y=F.y,w=Math.max(w,A.y+A.h),g=Math.max(g,A.x+A.w),A.w===F.w&&A.h===F.h){const z=h.pop();k<h.length&&(h[k]=z)}else A.h===F.h?(F.x+=A.w,F.w-=A.w):A.w===F.w?(F.y+=A.h,F.h-=A.h):(h.push({x:F.x+A.w,y:F.y,w:F.w-A.w,h:A.h}),F.y+=A.h,F.h-=A.h);break}}return{w:g,h:w,fill:r/(g*w)||0}}const Bh=1;class fb{constructor(r,{pixelRatio:u,version:h,stretchX:g,stretchY:w,content:A}){this.paddedRect=r,this.pixelRatio=u,this.stretchX=g,this.stretchY=w,this.content=A,this.version=h}get tl(){return[this.paddedRect.x+Bh,this.paddedRect.y+Bh]}get br(){return[this.paddedRect.x+this.paddedRect.w-Bh,this.paddedRect.y+this.paddedRect.h-Bh]}get displaySize(){return[(this.paddedRect.w-2*Bh)/this.pixelRatio,(this.paddedRect.h-2*Bh)/this.pixelRatio]}}class K2{constructor(r,u){const h={},g={};this.haveRenderCallbacks=[];const w=[];this.addImages(r,h,w),this.addImages(u,g,w);const{w:A,h:k}=hb(w),F=new nh({width:A||1,height:k||1});for(const z in r){const K=r[z],re=h[z].paddedRect;nh.copy(K.data,F,{x:0,y:0},{x:re.x+Bh,y:re.y+Bh},K.data)}for(const z in u){const K=u[z],re=g[z].paddedRect,fe=re.x+Bh,we=re.y+Bh,Te=K.data.width,Re=K.data.height;nh.copy(K.data,F,{x:0,y:0},{x:fe,y:we},K.data),nh.copy(K.data,F,{x:0,y:Re-1},{x:fe,y:we-1},{width:Te,height:1}),nh.copy(K.data,F,{x:0,y:0},{x:fe,y:we+Re},{width:Te,height:1}),nh.copy(K.data,F,{x:Te-1,y:0},{x:fe-1,y:we},{width:1,height:Re}),nh.copy(K.data,F,{x:0,y:0},{x:fe+Te,y:we},{width:1,height:Re})}this.image=F,this.iconPositions=h,this.patternPositions=g}addImages(r,u,h){for(const g in r){const w=r[g],A={x:0,y:0,w:w.data.width+2*Bh,h:w.data.height+2*Bh};h.push(A),u[g]=new fb(A,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(r,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((h=>r.hasImage(h))),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in r.updatedImages)this.patchUpdatedImage(this.iconPositions[h],r.getImage(h),u),this.patchUpdatedImage(this.patternPositions[h],r.getImage(h),u)}patchUpdatedImage(r,u,h){if(!r||!u||r.version===u.version)return;r.version=u.version;const[g,w]=r.tl;h.update(u.data,void 0,{x:g,y:w})}}Cr(fb,"ImagePosition"),Cr(K2,"ImageAtlas");const yf={horizontal:1,vertical:2,horizontalOnly:3},Z2=-17;class b0{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,u){const h=new b0;return h.scale=r||1,h.fontStack=u,h}static forImage(r){const u=new b0;return u.imageName=r,u}}class Hg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,u){const h=new Hg;for(let g=0;g<r.sections.length;g++){const w=r.sections[g];w.image?h.addImageSection(w):h.addTextSection(w,u)}return h}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=(function(u,h){let g="";for(let w=0;w<u.length;w++){const A=u.charCodeAt(w+1)||null,k=u.charCodeAt(w-1)||null;g+=!h&&(A&&dt(A)&&!x0[u[w+1]]||k&&dt(k)&&!x0[u[w-1]])||!x0[u[w]]?u[w]:x0[u[w]]}return g})(this.text,r)}trim(){let r=0;for(let h=0;h<this.text.length&&f1[this.text.charCodeAt(h)];h++)r++;let u=this.text.length;for(let h=this.text.length-1;h>=0&&h>=r&&f1[this.text.charCodeAt(h)];h--)u--;this.text=this.text.substring(r,u),this.sectionIndex=this.sectionIndex.slice(r,u)}substring(r,u){const h=new Hg;return h.text=this.text.substring(r,u),h.sectionIndex=this.sectionIndex.slice(r,u),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((r,u)=>Math.max(r,this.sections[u].scale)),0)}addTextSection(r,u){this.text+=r.text,this.sections.push(b0.forText(r.scale,r.fontStack||u));const h=this.sections.length-1;for(let g=0;g<r.text.length;++g)this.sectionIndex.push(h)}addImageSection(r){const u=r.image?r.image.name:"";if(u.length===0)return void Ir("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(b0.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Ir("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function db(o,r,u,h,g,w,A,k,F,z,K,re,fe,we,Te){const Re=Hg.fromFeature(o,g);re===yf.vertical&&Re.verticalizePunctuation(fe);let st=[];const _t=(function(jt,wn,vn,On,ar,kn){if(!jt)return[];const $n=[],Hn=(function(Rr,ii,zr,ys,pr,Ti){let _s=0;for(let Fo=0;Fo<Rr.length();Fo++){const vs=Rr.getSection(Fo);_s+=J2(Rr.getCharCode(Fo),vs,ys,pr,ii,Ti)}return _s/Math.max(1,Math.ceil(_s/zr))})(jt,wn,vn,On,ar,kn),nr=jt.text.indexOf("")>=0;let fr=0;for(let Rr=0;Rr<jt.length();Rr++){const ii=jt.getSection(Rr),zr=jt.getCharCode(Rr);if(f1[zr]||(fr+=J2(zr,ii,On,ar,wn,kn)),Rr<jt.length()-1){const ys=!((Mn=zr)<11904||!(pe["Bopomofo Extended"](Mn)||pe.Bopomofo(Mn)||pe["CJK Compatibility Forms"](Mn)||pe["CJK Compatibility Ideographs"](Mn)||pe["CJK Compatibility"](Mn)||pe["CJK Radicals Supplement"](Mn)||pe["CJK Strokes"](Mn)||pe["CJK Symbols and Punctuation"](Mn)||pe["CJK Unified Ideographs Extension A"](Mn)||pe["CJK Unified Ideographs"](Mn)||pe["Enclosed CJK Letters and Months"](Mn)||pe["Halfwidth and Fullwidth Forms"](Mn)||pe.Hiragana(Mn)||pe["Ideographic Description Characters"](Mn)||pe["Kangxi Radicals"](Mn)||pe["Katakana Phonetic Extensions"](Mn)||pe.Katakana(Mn)||pe["Vertical Forms"](Mn)||pe["Yi Radicals"](Mn)||pe["Yi Syllables"](Mn)));(h8[zr]||ys||ii.imageName)&&$n.push(e4(Rr+1,fr,Hn,$n,f8(zr,jt.getCharCode(Rr+1),ys&&nr),!1))}}var Mn;return t4(e4(jt.length(),fr,Hn,$n,0,!0))})(Re,z,w,r,h,we),{processBidirectionalText:Rt,processStyledBidirectionalText:xt}=W;if(Rt&&Re.sections.length===1){const jt=Rt(Re.toString(),_t);for(const wn of jt){const vn=new Hg;vn.text=wn,vn.sections=Re.sections;for(let On=0;On<wn.length;On++)vn.sectionIndex.push(0);st.push(vn)}}else if(xt){const jt=xt(Re.text,Re.sectionIndex,_t);for(const wn of jt){const vn=new Hg;vn.text=wn[0],vn.sectionIndex=wn[1],vn.sections=Re.sections,st.push(vn)}}else st=(function(jt,wn){const vn=[],On=jt.text;let ar=0;for(const kn of wn)vn.push(jt.substring(ar,kn)),ar=kn;return ar<On.length&&vn.push(jt.substring(ar,On.length)),vn})(Re,_t);const Pt=[],Vt={positionedLines:Pt,text:Re.toString(),top:K[1],bottom:K[1],left:K[0],right:K[0],writingMode:re,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return(function(jt,wn,vn,On,ar,kn,$n,Hn,nr,fr,Mn,Rr){let ii=0,zr=0,ys=0;const pr=Hn==="right"?1:Hn==="left"?0:.5;let Ti=!1;for(const bs of ar){const ws=bs.getSections();for(const Aa of ws){if(Aa.imageName)continue;const za=wn[Aa.fontStack];if(za&&(Ti=za.ascender!==void 0&&za.descender!==void 0,!Ti))break}if(!Ti)break}let _s=0;for(const bs of ar){bs.trim();const ws=bs.getMaxScale(),Aa=(ws-1)*Cc,za={positionedGlyphs:[],lineOffset:0};jt.positionedLines[_s]=za;const ja=za.positionedGlyphs;let Ia=0;if(!bs.length()){zr+=kn,++_s;continue}let Rl=0,ru=0;for(let Ca=0;Ca<bs.length();Ca++){const Vu=bs.getSection(Ca),Su=bs.getSectionIndex(Ca),Xl=bs.getCharCode(Ca);let Uo=Vu.scale,Eu=null,Ua=null,yh=null,Tu=Cc,kc=0;const fc=!(nr===yf.horizontal||!Mn&&!ht(Xl)||Mn&&(f1[Xl]||(Fo=Xl,pe.Arabic(Fo)||pe["Arabic Supplement"](Fo)||pe["Arabic Extended-A"](Fo)||pe["Arabic Presentation Forms-A"](Fo)||pe["Arabic Presentation Forms-B"](Fo))));if(Vu.imageName){const _h=On[Vu.imageName];if(!_h)continue;yh=Vu.imageName,jt.iconsInText=jt.iconsInText||!0,Ua=_h.paddedRect;const dc=_h.displaySize;Uo=Uo*Cc/Rr,Eu={width:dc[0],height:dc[1],left:Bh,top:-Y2,advance:fc?dc[1]:dc[0],localGlyph:!1},kc=Ti?-Eu.height*Uo:Z2+ws*Cc-dc[1]*Uo,Tu=Eu.advance;const nd=(fc?dc[0]:dc[1])*Uo-Cc*ws;nd>0&&nd>Ia&&(Ia=nd)}else{const _h=vn[Vu.fontStack];if(!_h)continue;_h[Xl]&&(Ua=_h[Xl]);const dc=wn[Vu.fontStack];if(!dc)continue;const nd=dc.glyphs[Xl];if(!nd)continue;if(Eu=nd.metrics,Tu=Xl!==8203?Cc:0,Ti){const Qg=dc.ascender!==void 0?Math.abs(dc.ascender):0,P0=dc.descender!==void 0?Math.abs(dc.descender):0,N0=(Qg+P0)*Uo;Rl<N0&&(Rl=N0,ru=(Qg-P0)/2*Uo),kc=-Qg*Uo}else kc=Z2+(ws-Uo)*Cc}fc?(jt.verticalizable=!0,ja.push({glyph:Xl,imageName:yh,x:ii,y:zr+kc,vertical:fc,scale:Uo,localGlyph:Eu.localGlyph,fontStack:Vu.fontStack,sectionIndex:Su,metrics:Eu,rect:Ua}),ii+=Tu*Uo+fr):(ja.push({glyph:Xl,imageName:yh,x:ii,y:zr+kc,vertical:fc,scale:Uo,localGlyph:Eu.localGlyph,fontStack:Vu.fontStack,sectionIndex:Su,metrics:Eu,rect:Ua}),ii+=Eu.advance*Uo+fr)}ja.length!==0&&(ys=Math.max(ii-fr,ys),Ti?n4(ja,pr,Ia,ru,kn*ws/2):n4(ja,pr,Ia,0,kn/2)),ii=0;const wu=kn*ws+Ia;za.lineOffset=Math.max(Ia,Aa),zr+=wu,++_s}var Fo;const vs=zr,{horizontalAlign:Gi,verticalAlign:el}=pb($n);(function(bs,ws,Aa,za,ja,Ia){const Rl=(ws-Aa)*ja,ru=-Ia*za;for(const wu of bs)for(const Ca of wu.positionedGlyphs)Ca.x+=Rl,Ca.y+=ru})(jt.positionedLines,pr,Gi,el,ys,vs),jt.top+=-el*vs,jt.bottom=jt.top+vs,jt.left+=-Gi*ys,jt.right=jt.left+ys,jt.hasBaseline=Ti})(Vt,r,u,h,st,A,k,F,re,z,fe,Te),!(function(jt){for(const wn of jt)if(wn.positionedGlyphs.length!==0)return!1;return!0})(Pt)&&Vt}const f1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},h8={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function J2(o,r,u,h,g,w){if(r.imageName){const A=h[r.imageName];return A?A.displaySize[0]*r.scale*Cc/w+g:0}{const A=u[r.fontStack],k=A&&A.glyphs[o];return k?k.metrics.advance*r.scale+g:0}}function Q2(o,r,u,h){const g=Math.pow(o-r,2);return h?o<r?g/2:2*g:g+Math.abs(u)*u}function f8(o,r,u){let h=0;return o===10&&(h-=1e4),u&&(h+=150),o!==40&&o!==65288||(h+=50),r!==41&&r!==65289||(h+=50),h}function e4(o,r,u,h,g,w){let A=null,k=Q2(r,u,g,w);for(const F of h){const z=Q2(r-F.x,u,g,w)+F.badness;z<=k&&(A=F,k=z)}return{index:o,x:r,priorBreak:A,badness:k}}function t4(o){return o?t4(o.priorBreak).concat(o.index):[]}function pb(o){let r=.5,u=.5;switch(o){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:r,verticalAlign:u}}function n4(o,r,u,h,g){if(!(r||u||h||g))return;const w=o.length-1,A=o[w],k=(A.x+A.metrics.advance*A.scale)*r;for(let F=0;F<=w;F++)o[F].x-=k,o[F].y+=u+h+g}function d8(o,r,u){const{horizontalAlign:h,verticalAlign:g}=pb(u),w=r[0]-o.displaySize[0]*h,A=r[1]-o.displaySize[1]*g;return{image:o,top:A,bottom:A+o.displaySize[1],left:w,right:w+o.displaySize[0]}}function r4(o,r,u,h,g,w){const A=o.image;let k;if(A.content){const st=A.content,_t=A.pixelRatio||1;k=[st[0]/_t,st[1]/_t,A.displaySize[0]-st[2]/_t,A.displaySize[1]-st[3]/_t]}const F=r.left*w,z=r.right*w;let K,re,fe,we;u==="width"||u==="both"?(we=g[0]+F-h[3],re=g[0]+z+h[1]):(we=g[0]+(F+z-A.displaySize[0])/2,re=we+A.displaySize[0]);const Te=r.top*w,Re=r.bottom*w;return u==="height"||u==="both"?(K=g[1]+Te-h[0],fe=g[1]+Re+h[2]):(K=g[1]+(Te+Re-A.displaySize[1])/2,fe=K+A.displaySize[1]),{image:A,top:K,right:re,bottom:fe,left:we,collisionPadding:k}}class gp extends Y{constructor(r,u,h,g,w){super(r,u),this.angle=g,this.z=h,w!==void 0&&(this.segment=w)}clone(){return new gp(this.x,this.y,this.z,this.angle,this.segment)}}function i4(o,r,u,h,g){if(r.segment===void 0)return!0;let w=r,A=r.segment+1,k=0;for(;k>-u/2;){if(A--,A<0)return!1;k-=o[A].dist(w),w=o[A]}k+=o[A].dist(o[A+1]),A++;const F=[];let z=0;for(;k<u/2;){const K=o[A],re=o[A+1];if(!re)return!1;let fe=o[A-1].angleTo(K)-K.angleTo(re);for(fe=Math.abs((fe+3*Math.PI)%(2*Math.PI)-Math.PI),F.push({distance:k,angleDelta:fe}),z+=fe;k-F[0].distance>h;)z-=F.shift().angleDelta;if(z>g)return!1;A++,k+=K.dist(re)}return!0}function s4(o){let r=0;for(let u=0;u<o.length-1;u++)r+=o[u].dist(o[u+1]);return r}function o4(o,r,u){return o?.6*r*u:0}function a4(o,r){return Math.max(o?o.right-o.left:0,r?r.right-r.left:0)}function p8(o,r,u,h,g,w){const A=o4(u,g,w),k=a4(u,h)*w;let F=0;const z=s4(o)/2;for(let K=0;K<o.length-1;K++){const re=o[K],fe=o[K+1],we=re.dist(fe);if(F+we>z){const Te=(z-F)/we,Re=nt(re.x,fe.x,Te),st=nt(re.y,fe.y,Te),_t=new gp(Re,st,0,fe.angleTo(re),K);return!A||i4(o,_t,k,A,r)?_t:void 0}F+=we}}function m8(o,r,u,h,g,w,A,k,F){const z=o4(h,w,A),K=a4(h,g),re=K*A,fe=o[0].x===0||o[0].x===F||o[0].y===0||o[0].y===F;return r-re<r/4&&(r=re+r/4),l4(o,fe?r/2*k%r:(K/2+2*w)*A*k%r,r,z,u,re,fe,!1,F)}function l4(o,r,u,h,g,w,A,k,F){const z=w/2,K=s4(o);let re=0,fe=r-u,we=[];for(let Te=0;Te<o.length-1;Te++){const Re=o[Te],st=o[Te+1],_t=Re.dist(st),Rt=st.angleTo(Re);for(;fe+u<re+_t;){fe+=u;const xt=(fe-re)/_t,Pt=nt(Re.x,st.x,xt),Vt=nt(Re.y,st.y,xt);if(Pt>=0&&Pt<F&&Vt>=0&&Vt<F&&fe-z>=0&&fe+z<=K){const jt=new gp(Pt,Vt,0,Rt,Te);jt._round(),h&&!i4(o,jt,w,h,g)||we.push(jt)}}re+=_t}return k||we.length||A||(we=l4(o,re/2,u,h,g,w,A,!0,F)),we}function u4(o,r,u,h,g){const w=[];for(let A=0;A<o.length;A++){const k=o[A];let F;for(let z=0;z<k.length-1;z++){let K=k[z],re=k[z+1];K.x<r&&re.x<r||(K.x<r?K=new Y(r,K.y+(r-K.x)/(re.x-K.x)*(re.y-K.y))._round():re.x<r&&(re=new Y(r,K.y+(r-K.x)/(re.x-K.x)*(re.y-K.y))._round()),K.y<u&&re.y<u||(K.y<u?K=new Y(K.x+(u-K.y)/(re.y-K.y)*(re.x-K.x),u)._round():re.y<u&&(re=new Y(K.x+(u-K.y)/(re.y-K.y)*(re.x-K.x),u)._round()),K.x>=h&&re.x>=h||(K.x>=h?K=new Y(h,K.y+(h-K.x)/(re.x-K.x)*(re.y-K.y))._round():re.x>=h&&(re=new Y(h,K.y+(h-K.x)/(re.x-K.x)*(re.y-K.y))._round()),K.y>=g&&re.y>=g||(K.y>=g?K=new Y(K.x+(g-K.y)/(re.y-K.y)*(re.x-K.x),g)._round():re.y>=g&&(re=new Y(K.x+(g-K.y)/(re.y-K.y)*(re.x-K.x),g)._round()),F&&K.equals(F[F.length-1])||(F=[K],w.push(F)),F.push(re)))))}}return w}Cr(gp,"Anchor");const w0=1e20;function c4(o,r,u,h,g,w,A,k,F){for(let z=r;z<r+h;z++)h4(o,u*w+z,w,g,A,k,F);for(let z=u;z<u+g;z++)h4(o,z*w+r,1,h,A,k,F)}function h4(o,r,u,h,g,w,A){w[0]=0,A[0]=-w0,A[1]=w0,g[0]=o[r];for(let k=1,F=0,z=0;k<h;k++){g[k]=o[r+k*u];const K=k*k;do{const re=w[F];z=(g[k]-g[re]+K-re*re)/(k-re)/2}while(z<=A[F]&&--F>-1);F++,w[F]=k,A[F]=z,A[F+1]=w0}for(let k=0,F=0;k<h;k++){for(;A[F+1]<k;)F++;const z=w[F],K=k-z;o[r+k*u]=g[z]+K*K}}const ed=2,mb={none:0,ideographs:1,all:2};class Wg{constructor(r,u,h){this.requestManager=r,this.localGlyphMode=u,this.localFontFamily=h,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,u){const h=[];for(const g in r)for(const w of r[g])h.push({stack:g,id:w});ge(h,(({stack:g,id:w},A)=>{let k=this.entries[g];k||(k=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let F=k.glyphs[w];if(F!==void 0)return void A(null,{stack:g,id:w,glyph:F});if(F=this._tinySDF(k,g,w),F)return k.glyphs[w]=F,void A(null,{stack:g,id:w,glyph:F});const z=Math.floor(w/256);if(256*z>65535)return void A(new Error("glyphs > 65535 not supported"));if(k.ranges[z])return void A(null,{stack:g,id:w,glyph:F});let K=k.requests[z];K||(K=k.requests[z]=[],Wg.loadGlyphRange(g,z,this.url,this.requestManager,((re,fe)=>{if(fe){k.ascender=fe.ascender,k.descender=fe.descender;for(const we in fe.glyphs)this._doesCharSupportLocalGlyph(+we)||(k.glyphs[+we]=fe.glyphs[+we]);k.ranges[z]=!0}for(const we of K)we(re,fe);delete k.requests[z]}))),K.push(((re,fe)=>{re?A(re):fe&&A(null,{stack:g,id:w,glyph:fe.glyphs[w]||null})}))}),((g,w)=>{if(g)u(g);else if(w){const A={};for(const{stack:k,id:F,glyph:z}of w)A[k]===void 0&&(A[k]={}),A[k].glyphs===void 0&&(A[k].glyphs={}),A[k].glyphs[F]=z&&{id:z.id,bitmap:z.bitmap.clone(),metrics:z.metrics},A[k].ascender=this.entries[k].ascender,A[k].descender=this.entries[k].descender;u(null,A)}}))}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==mb.none&&(this.localGlyphMode===mb.all?!!this.localFontFamily:!!this.localFontFamily&&(pe["CJK Unified Ideographs"](r)||pe["Hangul Syllables"](r)||pe.Hiragana(r)||pe.Katakana(r)||pe["CJK Symbols and Punctuation"](r)))}_tinySDF(r,u,h){const g=this.localFontFamily;if(!g||!this._doesCharSupportLocalGlyph(h))return;let w=r.tinySDF;if(!w){let Re="400";/bold/i.test(u)?Re="900":/medium/i.test(u)?Re="500":/light/i.test(u)&&(Re="200"),w=r.tinySDF=new Wg.TinySDF({fontFamily:g,fontWeight:Re,fontSize:24*ed,buffer:3*ed,radius:8*ed}),w.fontWeight=Re}if(this.localGlyphs[w.fontWeight][h])return this.localGlyphs[w.fontWeight][h];const A=String.fromCharCode(h),{data:k,width:F,height:z,glyphWidth:K,glyphHeight:re,glyphLeft:fe,glyphTop:we,glyphAdvance:Te}=w.draw(A);return this.localGlyphs[w.fontWeight][h]={id:h,bitmap:new mh({width:F,height:z},k),metrics:{width:K/ed,height:re/ed,left:fe/ed,top:we/ed-27,advance:Te/ed,localGlyph:!0}}}}Wg.loadGlyphRange=function(o,r,u,h,g){const w=256*r,A=w+255,k=h.transformRequest(h.normalizeGlyphsURL(u).replace("{fontstack}",o).replace("{range}",`${w}-${A}`),wr.Glyphs);wi(k,((F,z)=>{if(F)g(F);else if(z){const K={},re=(function(fe){return new h1(fe).readFields(l8,{})})(z);for(const fe of re.glyphs)K[fe.id]=fe;g(null,{glyphs:K,ascender:re.ascender,descender:re.descender})}}))},Wg.TinySDF=class{constructor({fontSize:o=24,buffer:r=3,radius:u=8,cutoff:h=.25,fontFamily:g="sans-serif",fontWeight:w="normal",fontStyle:A="normal"}={}){this.buffer=r,this.cutoff=h,this.radius=u;const k=this.size=o+4*r,F=this._createCanvas(k),z=this.ctx=F.getContext("2d",{willReadFrequently:!0});z.font=`${A} ${w} ${o}px ${g}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Uint16Array(k)}_createCanvas(o){const r=document.createElement("canvas");return r.width=r.height=o,r}draw(o){const{width:r,actualBoundingBoxAscent:u,actualBoundingBoxDescent:h,actualBoundingBoxLeft:g,actualBoundingBoxRight:w}=this.ctx.measureText(o),A=Math.ceil(u),k=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-g))),F=Math.min(this.size-this.buffer,A+Math.ceil(h)),z=k+2*this.buffer,K=F+2*this.buffer,re=Math.max(z*K,0),fe=new Uint8ClampedArray(re),we={data:fe,width:z,height:K,glyphWidth:k,glyphHeight:F,glyphTop:A,glyphLeft:0,glyphAdvance:r};if(k===0||F===0)return we;const{ctx:Te,buffer:Re,gridInner:st,gridOuter:_t}=this;Te.clearRect(Re,Re,k,F),Te.fillText(o,Re,Re+A);const Rt=Te.getImageData(Re,Re,k,F);_t.fill(w0,0,re),st.fill(0,0,re);for(let xt=0;xt<F;xt++)for(let Pt=0;Pt<k;Pt++){const Vt=Rt.data[4*(xt*k+Pt)+3]/255;if(Vt===0)continue;const jt=(xt+Re)*z+Pt+Re;if(Vt===1)_t[jt]=0,st[jt]=w0;else{const wn=.5-Vt;_t[jt]=wn>0?wn*wn:0,st[jt]=wn<0?wn*wn:0}}c4(_t,0,0,z,K,z,this.f,this.v,this.z),c4(st,Re,Re,k,F,z,this.f,this.v,this.z);for(let xt=0;xt<re;xt++){const Pt=Math.sqrt(_t[xt])-Math.sqrt(st[xt]);fe[xt]=Math.round(255-255*(Pt/this.radius+this.cutoff))}return we}};const Xg=Bh;function f4(o,r,u,h){const g=[],w=o.image,A=w.pixelRatio,k=w.paddedRect.w-2*Xg,F=w.paddedRect.h-2*Xg,z=o.right-o.left,K=o.bottom-o.top,re=w.stretchX||[[0,k]],fe=w.stretchY||[[0,F]],we=(kn,$n)=>kn+$n[1]-$n[0],Te=re.reduce(we,0),Re=fe.reduce(we,0),st=k-Te,_t=F-Re;let Rt=0,xt=Te,Pt=0,Vt=Re,jt=0,wn=st,vn=0,On=_t;if(w.content&&h){const kn=w.content;Rt=d1(re,0,kn[0]),Pt=d1(fe,0,kn[1]),xt=d1(re,kn[0],kn[2]),Vt=d1(fe,kn[1],kn[3]),jt=kn[0]-Rt,vn=kn[1]-Pt,wn=kn[2]-kn[0]-xt,On=kn[3]-kn[1]-Vt}const ar=(kn,$n,Hn,nr)=>{const fr=p1(kn.stretch-Rt,xt,z,o.left),Mn=m1(kn.fixed-jt,wn,kn.stretch,Te),Rr=p1($n.stretch-Pt,Vt,K,o.top),ii=m1($n.fixed-vn,On,$n.stretch,Re),zr=p1(Hn.stretch-Rt,xt,z,o.left),ys=m1(Hn.fixed-jt,wn,Hn.stretch,Te),pr=p1(nr.stretch-Pt,Vt,K,o.top),Ti=m1(nr.fixed-vn,On,nr.stretch,Re),_s=new Y(fr,Rr),Fo=new Y(zr,Rr),vs=new Y(zr,pr),Gi=new Y(fr,pr),el=new Y(Mn/A,ii/A),bs=new Y(ys/A,Ti/A),ws=r*Math.PI/180;if(ws){const ja=Math.sin(ws),Ia=Math.cos(ws),Rl=[Ia,-ja,ja,Ia];_s._matMult(Rl),Fo._matMult(Rl),Gi._matMult(Rl),vs._matMult(Rl)}const Aa=kn.stretch+kn.fixed,za=$n.stretch+$n.fixed;return{tl:_s,tr:Fo,bl:Gi,br:vs,tex:{x:w.paddedRect.x+Xg+Aa,y:w.paddedRect.y+Xg+za,w:Hn.stretch+Hn.fixed-Aa,h:nr.stretch+nr.fixed-za},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:el,pixelOffsetBR:bs,minFontScaleX:wn/A/z,minFontScaleY:On/A/K,isSDF:u}};if(h&&(w.stretchX||w.stretchY)){const kn=d4(re,st,Te),$n=d4(fe,_t,Re);for(let Hn=0;Hn<kn.length-1;Hn++){const nr=kn[Hn],fr=kn[Hn+1];for(let Mn=0;Mn<$n.length-1;Mn++)g.push(ar(nr,$n[Mn],fr,$n[Mn+1]))}}else g.push(ar({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:k+1},{fixed:0,stretch:F+1}));return g}function d1(o,r,u){let h=0;for(const g of o)h+=Math.max(r,Math.min(u,g[1]))-Math.max(r,Math.min(u,g[0]));return h}function d4(o,r,u){const h=[{fixed:-Xg,stretch:0}];for(const[g,w]of o){const A=h[h.length-1];h.push({fixed:g-A.stretch,stretch:A.stretch}),h.push({fixed:g-A.stretch,stretch:A.stretch+(w-g)})}return h.push({fixed:r+Xg,stretch:u}),h}function p1(o,r,u,h){return o/r*u+h}function m1(o,r,u,h){return o-r*u/h}function g8(o,r,u,h){const g=r+o.positionedLines[h].lineOffset;return h===0?u+g/2:u+(g+(r+o.positionedLines[h-1].lineOffset))/2}class y8{constructor(r=[],u=_8){if(this.data=r,this.length=this.data.length,this.compare=u,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:u,compare:h}=this,g=u[r];for(;r>0;){const w=r-1>>1,A=u[w];if(h(g,A)>=0)break;u[r]=A,r=w}u[r]=g}_down(r){const{data:u,compare:h}=this,g=this.length>>1,w=u[r];for(;r<g;){let A=1+(r<<1),k=u[A];const F=A+1;if(F<this.length&&h(u[F],k)<0&&(A=F,k=u[F]),h(k,w)>=0)break;u[r]=k,r=A}u[r]=w}}function _8(o,r){return o<r?-1:o>r?1:0}function v8(o,r=1,u=!1){let h=1/0,g=1/0,w=-1/0,A=-1/0;const k=o[0];for(let we=0;we<k.length;we++){const Te=k[we];(!we||Te.x<h)&&(h=Te.x),(!we||Te.y<g)&&(g=Te.y),(!we||Te.x>w)&&(w=Te.x),(!we||Te.y>A)&&(A=Te.y)}const F=Math.min(w-h,A-g);let z=F/2;const K=new y8([],x8);if(F===0)return new Y(h,g);for(let we=h;we<w;we+=F)for(let Te=g;Te<A;Te+=F)K.push(new Yg(we+z,Te+z,z,o));let re=(function(we){let Te=0,Re=0,st=0;const _t=we[0];for(let Rt=0,xt=_t.length,Pt=xt-1;Rt<xt;Pt=Rt++){const Vt=_t[Rt],jt=_t[Pt],wn=Vt.x*jt.y-jt.x*Vt.y;Re+=(Vt.x+jt.x)*wn,st+=(Vt.y+jt.y)*wn,Te+=3*wn}return new Yg(Re/Te,st/Te,0,we)})(o),fe=K.length;for(;K.length;){const we=K.pop();(we.d>re.d||!re.d)&&(re=we,u&&console.log("found best %d after %d probes",Math.round(1e4*we.d)/1e4,fe)),we.max-re.d<=r||(z=we.h/2,K.push(new Yg(we.p.x-z,we.p.y-z,z,o)),K.push(new Yg(we.p.x+z,we.p.y-z,z,o)),K.push(new Yg(we.p.x-z,we.p.y+z,z,o)),K.push(new Yg(we.p.x+z,we.p.y+z,z,o)),fe+=4)}return u&&(console.log(`num probes: ${fe}`),console.log(`best distance: ${re.d}`)),re.p}function x8(o,r){return r.max-o.max}class Yg{constructor(r,u,h,g){this.p=new Y(r,u),this.h=h,this.d=(function(w,A){let k=!1,F=1/0;for(let z=0;z<A.length;z++){const K=A[z];for(let re=0,fe=K.length,we=fe-1;re<fe;we=re++){const Te=K[re],Re=K[we];Te.y>w.y!=Re.y>w.y&&w.x<(Re.x-Te.x)*(w.y-Te.y)/(Re.y-Te.y)+Te.x&&(k=!k),F=Math.min(F,i0(w,Te,Re))}}return(k?1:-1)*Math.sqrt(F)})(this.p,g),this.max=this.d+this.h*Math.SQRT2}}const Kg=7,gb=Number.POSITIVE_INFINITY,b8=Math.sqrt(2);function p4(o,[r,u]){let h=0,g=0;if(u===gb){r<0&&(r=0);const w=r/b8;switch(o){case"top-right":case"top-left":g=w-Kg;break;case"bottom-right":case"bottom-left":g=-w+Kg;break;case"bottom":g=-r+Kg;break;case"top":g=r-Kg}switch(o){case"top-right":case"bottom-right":h=-w;break;case"top-left":case"bottom-left":h=w;break;case"left":h=r;break;case"right":h=-r}}else{switch(r=Math.abs(r),u=Math.abs(u),o){case"top-right":case"top-left":case"top":g=u-Kg;break;case"bottom-right":case"bottom-left":case"bottom":g=-u+Kg}switch(o){case"top-right":case"bottom-right":case"right":h=-r;break;case"top-left":case"bottom-left":case"left":h=r}}return[h,g]}function w8(o,r,u,h,g,w,A,k,F,z){o.createArrays(),o.tilePixelRatio=pi/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const K=o.layers[0].layout,re=o.layers[0]._unevaluatedLayout._values,fe={};if(o.textSizeData.kind==="composite"){const{minZoom:Re,maxZoom:st}=o.textSizeData;fe.compositeTextSizes=[re["text-size"].possiblyEvaluate(new Z(Re),k),re["text-size"].possiblyEvaluate(new Z(st),k)]}if(o.iconSizeData.kind==="composite"){const{minZoom:Re,maxZoom:st}=o.iconSizeData;fe.compositeIconSizes=[re["icon-size"].possiblyEvaluate(new Z(Re),k),re["icon-size"].possiblyEvaluate(new Z(st),k)]}fe.layoutTextSize=re["text-size"].possiblyEvaluate(new Z(F+1),k),fe.layoutIconSize=re["icon-size"].possiblyEvaluate(new Z(F+1),k),fe.textMaxSize=re["text-size"].possiblyEvaluate(new Z(18),k);const we=K.get("text-rotation-alignment")==="map"&&K.get("symbol-placement")!=="point",Te=K.get("text-size");for(const Re of o.features){const st=K.get("text-font").evaluate(Re,{},k).join(","),_t=Te.evaluate(Re,{},k),Rt=fe.layoutTextSize.evaluate(Re,{},k),xt=(fe.layoutIconSize.evaluate(Re,{},k),{horizontal:{},vertical:void 0}),Pt=Re.text;let Vt,jt=[0,0];if(Pt){const On=Pt.toString(),ar=K.get("text-letter-spacing").evaluate(Re,{},k)*Cc,kn=K.get("text-line-height").evaluate(Re,{},k)*Cc,$n=tt(On)?ar:0,Hn=K.get("text-anchor").evaluate(Re,{},k),nr=K.get("text-variable-anchor");if(!nr){const zr=K.get("text-radial-offset").evaluate(Re,{},k);jt=zr?p4(Hn,[zr*Cc,gb]):K.get("text-offset").evaluate(Re,{},k).map((ys=>ys*Cc))}let fr=we?"center":K.get("text-justify").evaluate(Re,{},k);const Mn=K.get("symbol-placement")==="point",Rr=Mn?K.get("text-max-width").evaluate(Re,{},k)*Cc:1/0,ii=zr=>{o.allowVerticalPlacement&&Ge(On)&&(xt.vertical=db(Pt,r,u,g,st,Rr,kn,Hn,zr,$n,jt,yf.vertical,!0,Rt,_t))};if(!we&&nr){const zr=fr==="auto"?nr.map((pr=>yb(pr))):[fr];let ys=!1;for(let pr=0;pr<zr.length;pr++){const Ti=zr[pr];if(!xt.horizontal[Ti])if(ys)xt.horizontal[Ti]=xt.horizontal[0];else{const _s=db(Pt,r,u,g,st,Rr,kn,"center",Ti,$n,jt,yf.horizontal,!1,Rt,_t);_s&&(xt.horizontal[Ti]=_s,ys=_s.positionedLines.length===1)}}ii("left")}else{if(fr==="auto"&&(fr=yb(Hn)),Mn||K.get("text-writing-mode").indexOf("horizontal")>=0||!Ge(On)){const zr=db(Pt,r,u,g,st,Rr,kn,Hn,fr,$n,jt,yf.horizontal,!1,Rt,_t);zr&&(xt.horizontal[fr]=zr)}ii(Mn?"left":fr)}}let wn=!1;if(Re.icon&&Re.icon.name){const On=h[Re.icon.name];On&&(Vt=d8(g[Re.icon.name],K.get("icon-offset").evaluate(Re,{},k),K.get("icon-anchor").evaluate(Re,{},k)),wn=On.sdf,o.sdfIcons===void 0?o.sdfIcons=On.sdf:o.sdfIcons!==On.sdf&&Ir("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(On.pixelRatio!==o.pixelRatio||K.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}const vn=g4(xt.horizontal)||xt.vertical;o.iconsInText||(o.iconsInText=!!vn&&vn.iconsInText),(vn||Vt)&&S8(o,Re,xt,Vt,h,fe,Rt,0,jt,wn,A,k,z)}w&&o.generateCollisionDebugBuffers(F,o.collisionBoxArray)}function yb(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function S8(o,r,u,h,g,w,A,k,F,z,K,re,fe){let we=w.textMaxSize.evaluate(r,{},re);we===void 0&&(we=A);const Te=o.layers[0].layout,Re=Te.get("icon-offset").evaluate(r,{},re),st=g4(u.horizontal)||u.vertical,_t=fe.name==="globe",Rt=Cc,xt=A/Rt,Pt=o.tilePixelRatio*we/Rt,Vt=(Hn=o.overscaling,o.zoom>18&&Hn>2&&(Hn>>=1),Math.max(pi/(512*Hn),1)*Te.get("symbol-spacing")),jt=Te.get("text-padding")*o.tilePixelRatio,wn=Te.get("icon-padding")*o.tilePixelRatio,vn=te(Te.get("text-max-angle")),On=Te.get("text-rotation-alignment")==="map"&&Te.get("symbol-placement")!=="point",ar=Te.get("icon-rotation-alignment")==="map"&&Te.get("symbol-placement")!=="point",kn=Te.get("symbol-placement"),$n=Vt/2;var Hn;const nr=Te.get("icon-text-fit");let fr;h&&nr!=="none"&&(o.allowVerticalPlacement&&u.vertical&&(fr=r4(h,u.vertical,nr,Te.get("icon-text-fit-padding"),Re,xt)),st&&(h=r4(h,st,nr,Te.get("icon-text-fit-padding"),Re,xt)));const Mn=(Rr,ii,zr)=>{if(ii.x<0||ii.x>=pi||ii.y<0||ii.y>=pi)return;let ys=null;if(_t){const{x:pr,y:Ti,z:_s}=fe.projectTilePoint(ii.x,ii.y,zr);ys={anchor:new gp(pr,Ti,_s,0,void 0),up:fe.upVector(zr,ii.x,ii.y)}}(function(pr,Ti,_s,Fo,vs,Gi,el,bs,ws,Aa,za,ja,Ia,Rl,ru,wu,Ca,Vu,Su,Xl,Uo,Eu,Ua,yh,Tu){const kc=pr.addToLineVertexArray(Ti,Fo);let fc,_h,dc,nd,Qg,P0,N0,Y4=0,K4=0,Z4=0,J4=0,Nb=-1,Rb=-1;const Cd={};let Q4=Zu("");const qm=_s?_s.anchor:Ti;let Mb=0,Db=0;if(ws._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Mb,Db]=ws.layout.get("text-offset").evaluate(Uo,{},Tu).map((nf=>nf*Cc)):(Mb=ws.layout.get("text-radial-offset").evaluate(Uo,{},Tu)*Cc,Db=gb),pr.allowVerticalPlacement&&vs.vertical){const nf=vs.vertical;if(ru)P0=_b(nf),bs&&(N0=_b(bs));else{const rf=ws.layout.get("text-rotate").evaluate(Uo,{},Tu)+90;dc=g1(Aa,qm,Ti,za,ja,Ia,nf,Rl,rf,wu),bs&&(nd=g1(Aa,qm,Ti,za,ja,Ia,bs,Vu,rf))}}if(Gi){const nf=ws.layout.get("icon-rotate").evaluate(Uo,{},Tu),rf=ws.layout.get("icon-text-fit")!=="none",R0=f4(Gi,nf,Ua,rf),Fb=bs?f4(bs,nf,Ua,rf):void 0;_h=g1(Aa,qm,Ti,za,ja,Ia,Gi,Vu,nf),Y4=4*R0.length;const eS=pr.iconSizeData;let Gm=null;eS.kind==="source"?(Gm=[Qf*ws.layout.get("icon-size").evaluate(Uo,{},Tu)],Gm[0]>Gp&&Ir(`${pr.layerIds[0]}: Value for "icon-size" is >= ${S0}. Reduce your "icon-size".`)):eS.kind==="composite"&&(Gm=[Qf*Eu.compositeIconSizes[0].evaluate(Uo,{},Tu),Qf*Eu.compositeIconSizes[1].evaluate(Uo,{},Tu)],(Gm[0]>Gp||Gm[1]>Gp)&&Ir(`${pr.layerIds[0]}: Value for "icon-size" is >= ${S0}. Reduce your "icon-size".`)),pr.addSymbols(pr.icon,R0,Gm,Xl,Su,Uo,!1,_s,Ti,kc.lineStartIndex,kc.lineLength,-1,yh,Tu),Nb=pr.icon.placedSymbolArray.length-1,Fb&&(K4=4*Fb.length,pr.addSymbols(pr.icon,Fb,Gm,Xl,Su,Uo,yf.vertical,_s,Ti,kc.lineStartIndex,kc.lineLength,-1,yh,Tu),Rb=pr.icon.placedSymbolArray.length-1)}for(const nf in vs.horizontal){const rf=vs.horizontal[nf];fc||(Q4=Zu(rf.text),ru?Qg=_b(rf):fc=g1(Aa,qm,Ti,za,ja,Ia,rf,Rl,ws.layout.get("text-rotate").evaluate(Uo,{},Tu),wu));const R0=rf.positionedLines.length===1;if(Z4+=m4(pr,_s,Ti,rf,el,ws,ru,Uo,wu,kc,vs.vertical?yf.horizontal:yf.horizontalOnly,R0?Object.keys(vs.horizontal):[nf],Cd,Nb,Eu,yh,Tu),R0)break}vs.vertical&&(J4+=m4(pr,_s,Ti,vs.vertical,el,ws,ru,Uo,wu,kc,yf.vertical,["vertical"],Cd,Rb,Eu,yh,Tu));let Kp=-1;const Ob=(nf,rf)=>nf?Math.max(nf,rf):rf;Kp=Ob(Qg,Kp),Kp=Ob(P0,Kp),Kp=Ob(N0,Kp);const Z8=Kp>-1?1:0;pr.glyphOffsetArray.length>=Hp.MAX_GLYPHS&&Ir("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Uo.sortKey!==void 0&&pr.addToSortKeyRanges(pr.symbolInstances.length,Uo.sortKey),pr.symbolInstances.emplaceBack(qm.x,qm.y,qm.z,Ti.x,Ti.y,Cd.right>=0?Cd.right:-1,Cd.center>=0?Cd.center:-1,Cd.left>=0?Cd.left:-1,Cd.vertical>=0?Cd.vertical:-1,Nb,Rb,Q4,fc!==void 0?fc:pr.collisionBoxArray.length,fc!==void 0?fc+1:pr.collisionBoxArray.length,dc!==void 0?dc:pr.collisionBoxArray.length,dc!==void 0?dc+1:pr.collisionBoxArray.length,_h!==void 0?_h:pr.collisionBoxArray.length,_h!==void 0?_h+1:pr.collisionBoxArray.length,nd||pr.collisionBoxArray.length,nd?nd+1:pr.collisionBoxArray.length,za,Z4,J4,Y4,K4,Z8,0,Mb,Db,Kp)})(o,ii,ys,Rr,u,h,g,fr,o.layers[0],o.collisionBoxArray,r.index,r.sourceLayerIndex,o.index,jt,On,F,0,wn,ar,Re,r,w,z,K,re)};if(kn==="line")for(const Rr of u4(r.geometry,0,0,pi,pi)){const ii=m8(Rr,Vt,vn,u.vertical||st,h,Rt,Pt,o.overscaling,pi);for(const zr of ii)st&&E8(o,st.text,$n,zr)||Mn(Rr,zr,re)}else if(kn==="line-center"){for(const Rr of r.geometry)if(Rr.length>1){const ii=p8(Rr,vn,u.vertical||st,h,Rt,Pt);ii&&Mn(Rr,ii,re)}}else if(r.type==="Polygon")for(const Rr of g0(r.geometry,0)){const ii=v8(Rr,16);Mn(Rr[0],new gp(ii.x,ii.y,0,0,void 0),re)}else if(r.type==="LineString")for(const Rr of r.geometry)Mn(Rr,new gp(Rr[0].x,Rr[0].y,0,0,void 0),re);else if(r.type==="Point")for(const Rr of r.geometry)for(const ii of Rr)Mn([ii],new gp(ii.x,ii.y,0,0,void 0),re)}const S0=255,Gp=S0*Qf;function m4(o,r,u,h,g,w,A,k,F,z,K,re,fe,we,Te,Re,st){const _t=(function(Pt,Vt,jt,wn,vn,On,ar,kn){const $n=[];if(Vt.positionedLines.length===0)return $n;const Hn=wn.layout.get("text-rotate").evaluate(On,{})*Math.PI/180,nr=(function(zr){const ys=zr[0],pr=zr[1],Ti=ys*pr;return Ti>0?[ys,-pr]:Ti<0?[-ys,pr]:ys===0?[pr,ys]:[pr,-ys]})(jt);let fr=Math.abs(Vt.top-Vt.bottom);for(const zr of Vt.positionedLines)fr-=zr.lineOffset;const Mn=Vt.positionedLines.length,Rr=fr/Mn;let ii=Vt.top-jt[1];for(let zr=0;zr<Mn;++zr){const ys=Vt.positionedLines[zr];ii=g8(Vt,Rr,ii,zr);for(const pr of ys.positionedGlyphs){if(!pr.rect)continue;const Ti=pr.rect||{};let _s=Y2+1,Fo=!0,vs=1,Gi=0;if(pr.imageName){const Ua=ar[pr.imageName];if(!Ua)continue;if(Ua.sdf){Ir("SDF images are not supported in formatted text and will be ignored.");continue}Fo=!1,vs=Ua.pixelRatio,_s=Bh/vs}const el=(vn||kn)&&pr.vertical,bs=pr.metrics.advance*pr.scale/2,ws=pr.metrics,Aa=pr.rect;if(Aa===null)continue;kn&&Vt.verticalizable&&(Gi=pr.imageName?bs-pr.metrics.width*pr.scale/2:0);const za=vn?[pr.x+bs,pr.y]:[0,0];let ja=[0,0],Ia=[0,0],Rl=!1;vn||(el?(Ia=[pr.x+bs+nr[0],pr.y+nr[1]-Gi],Rl=!0):ja=[pr.x+bs+jt[0],pr.y+jt[1]-Gi]);const ru=Aa.w*pr.scale/(vs*(pr.localGlyph?ed:1)),wu=Aa.h*pr.scale/(vs*(pr.localGlyph?ed:1));let Ca,Vu,Su,Xl;if(el){const Ua=pr.y-ii,yh=new Y(-bs,bs-Ua),Tu=-Math.PI/2,kc=new Y(...Ia);Ca=new Y(-bs+ja[0],ja[1]),Ca._rotateAround(Tu,yh)._add(kc),Ca.x+=-Ua+bs,Ca.y-=(ws.left-_s)*pr.scale;const fc=pr.imageName?ws.advance*pr.scale:Cc*pr.scale,_h=String.fromCharCode(pr.glyph);ZL(_h)?Ca.x+=(1-_s)*pr.scale:JL(_h)?Ca.x+=fc-ws.height*pr.scale+(-_s-1)*pr.scale:Ca.x+=pr.imageName||ws.width+2*_s===Aa.w&&ws.height+2*_s===Aa.h?(fc-wu)/2:(fc-(ws.height+2*_s)*pr.scale)/2,Vu=new Y(Ca.x,Ca.y-ru),Su=new Y(Ca.x+wu,Ca.y),Xl=new Y(Ca.x+wu,Ca.y-ru)}else{const Ua=(ws.left-_s)*pr.scale-bs+ja[0],yh=(-ws.top-_s)*pr.scale+ja[1],Tu=Ua+ru,kc=yh+wu;Ca=new Y(Ua,yh),Vu=new Y(Tu,yh),Su=new Y(Ua,kc),Xl=new Y(Tu,kc)}if(Hn){let Ua;Ua=vn?new Y(0,0):Rl?new Y(nr[0],nr[1]):new Y(jt[0],jt[1]),Ca._rotateAround(Hn,Ua),Vu._rotateAround(Hn,Ua),Su._rotateAround(Hn,Ua),Xl._rotateAround(Hn,Ua)}const Uo=new Y(0,0),Eu=new Y(0,0);$n.push({tl:Ca,tr:Vu,bl:Su,br:Xl,tex:Ti,writingMode:Vt.writingMode,glyphOffset:za,sectionIndex:pr.sectionIndex,isSDF:Fo,pixelOffsetTL:Uo,pixelOffsetBR:Eu,minFontScaleX:0,minFontScaleY:0})}}return $n})(0,h,F,w,A,k,g,o.allowVerticalPlacement),Rt=o.textSizeData;let xt=null;Rt.kind==="source"?(xt=[Qf*w.layout.get("text-size").evaluate(k,{},st)],xt[0]>Gp&&Ir(`${o.layerIds[0]}: Value for "text-size" is >= ${S0}. Reduce your "text-size".`)):Rt.kind==="composite"&&(xt=[Qf*Te.compositeTextSizes[0].evaluate(k,{},st),Qf*Te.compositeTextSizes[1].evaluate(k,{},st)],(xt[0]>Gp||xt[1]>Gp)&&Ir(`${o.layerIds[0]}: Value for "text-size" is >= ${S0}. Reduce your "text-size".`)),o.addSymbols(o.text,_t,xt,F,A,k,K,r,u,z.lineStartIndex,z.lineLength,we,Re,st);for(const Pt of re)fe[Pt]=o.text.placedSymbolArray.length-1;return 4*_t.length}function g4(o){for(const r in o)return o[r];return null}function g1(o,r,u,h,g,w,A,k,F,z){let K=A.top,re=A.bottom,fe=A.left,we=A.right;const Te=A.collisionPadding;if(Te&&(fe-=Te[0],K-=Te[1],we+=Te[2],re+=Te[3]),F){const Re=new Y(fe,K),st=new Y(we,K),_t=new Y(fe,re),Rt=new Y(we,re),xt=te(F);let Pt=new Y(0,0);z&&(Pt=new Y(z[0],z[1])),Re._rotateAround(xt,Pt),st._rotateAround(xt,Pt),_t._rotateAround(xt,Pt),Rt._rotateAround(xt,Pt),fe=Math.min(Re.x,st.x,_t.x,Rt.x),we=Math.max(Re.x,st.x,_t.x,Rt.x),K=Math.min(Re.y,st.y,_t.y,Rt.y),re=Math.max(Re.y,st.y,_t.y,Rt.y)}return o.emplaceBack(r.x,r.y,r.z,u.x,u.y,fe,K,we,re,k,h,g,w),o.length-1}function _b(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const r=o.bottom-o.top;return r>0?Math.max(10,r):null}function E8(o,r,u,h){const g=o.compareText;if(r in g){const w=g[r];for(let A=w.length-1;A>=0;A--)if(h.dist(w[A])<u)return!0}else g[r]=[];return g[r].push(h),!1}function y4(o,r){const u=o.fovAboveCenter,h=o.elevation?o.elevation.getMinElevationBelowMSL()*r:0,g=(o._camera.position[2]*o.worldSize-h)/Math.cos(o._pitch),w=Math.sin(u)*g/Math.sin(Math.max(Math.PI/2-o._pitch-u,.01)),A=Math.sin(o._pitch)*w+g;return Math.min(1.01*A,g*(1/o._horizonShift))}function Um(o,r){if(!r.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:r};const u=Math.pow(2,-o.z),h=o.x*u,g=(o.x+1)*u,w=o.y*u,A=(o.y+1)*u,k=Hl(h),F=Hl(g),z=Ao(w),K=Ao(A),re=r.project(k,z),fe=r.project(F,z),we=r.project(F,K),Te=r.project(k,K);let Re=Math.min(re.x,fe.x,we.x,Te.x),st=Math.min(re.y,fe.y,we.y,Te.y),_t=Math.max(re.x,fe.x,we.x,Te.x),Rt=Math.max(re.y,fe.y,we.y,Te.y);const xt=u/16;function Pt(jt,wn,vn,On,ar,kn){const $n=(vn+ar)/2,Hn=(On+kn)/2,nr=r.project(Hl($n),Ao(Hn)),fr=Math.max(0,Re-nr.x,st-nr.y,nr.x-_t,nr.y-Rt);Re=Math.min(Re,nr.x),_t=Math.max(_t,nr.x),st=Math.min(st,nr.y),Rt=Math.max(Rt,nr.y),fr>xt&&(Pt(jt,nr,vn,On,$n,Hn),Pt(nr,wn,$n,Hn,ar,kn))}Pt(re,fe,h,w,g,w),Pt(fe,we,g,w,g,A),Pt(we,Te,g,A,h,A),Pt(Te,re,h,A,h,w),Re-=xt,st-=xt,_t+=xt,Rt+=xt;const Vt=1/Math.max(_t-Re,Rt-st);return{scale:Vt,x:Re*Vt,y:st*Vt,x2:_t*Vt,y2:Rt*Vt,projection:r}}const T8=ph(new Float32Array(16));class $p{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,u){return{x:0,y:0,z:0}}unproject(r,u){return new hi(0,0)}projectTilePoint(r,u,h){return{x:r,y:u,z:0}}locationPoint(r,u,h=!0){return r._coordinatePoint(r.locationCoordinate(u),h)}pixelsPerMeter(r,u){return Nl(1,r)*u}pixelSpaceConversion(r,u,h){return 1}farthestPixelDistance(r){return y4(r,r.pixelsPerMeter)}pointCoordinate(r,u,h,g){const w=r.horizonLineFromTop(!1),A=new Y(u,Math.max(w,h));return r.rayIntersectionCoordinate(r.pointRayIntersection(A,g))}pointCoordinate3D(r,u,h){const g=new Y(u,h);if(r.elevation)return r.elevation.pointCoordinate(g);{const w=this.pointCoordinate(r,g.x,g.y,0);return[w.x,w.y,w.z]}}isPointAboveHorizon(r,u){if(r.elevation)return!this.pointCoordinate3D(r,u.x,u.y);const h=r.horizonLineFromTop();return u.y<h}createInversionMatrix(r,u){return T8}createTileMatrix(r,u,h){let g,w,A;const k=h.canonical,F=ph(new Float64Array(16));if(this.isReprojectedInTileSpace){const z=Um(k,this);g=1,w=z.x+h.wrap*z.scale,A=z.y,Tc(F,F,[g/z.scale,g/z.scale,r.pixelsPerMeter/u])}else g=u/r.zoomScale(k.z),w=(k.x+Math.pow(2,k.z)*h.wrap)*g,A=k.y*g;return Ec(F,F,[w,A,0]),Tc(F,F,[g/pi,g/pi,1]),F}upVector(r,u,h){return[0,0,1]}upVectorScale(r,u,h){return{metersToTile:1}}}class A8 extends $p{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[u,h]=this.parallels=r.parallels||[29.5,45.5],g=Math.sin(te(u));this.n=(g+Math.sin(te(h)))/2,this.c=1+g*(2*this.n-g),this.r0=Math.sqrt(this.c)/this.n}project(r,u){const{n:h,c:g,r0:w}=this,A=te(r-this.center[0]),k=te(u),F=Math.sqrt(g-2*h*Math.sin(k))/h;return{x:F*Math.sin(A*h),y:F*Math.cos(A*h)-w,z:0}}unproject(r,u){const{n:h,c:g,r0:w}=this,A=w+u;let k=Math.atan2(r,Math.abs(A))*Math.sign(A);A*h<0&&(k-=Math.PI*Math.sign(r)*Math.sign(A));const F=te(this.center[0])*h;k=Ce(k,-Math.PI-F,Math.PI-F);const z=He(Se(k/h)+this.center[0],-180,180),K=Math.asin(He((g-(r*r+A*A)*h*h)/(2*h),-1,1)),re=He(Se(K),-Sl,Sl);return new hi(z,re)}}const E0=1.340264,T0=-.081106,A0=893e-6,I0=.003796,y1=Math.sqrt(3)/2;class I8 extends $p{project(r,u){u=u/180*Math.PI,r=r/180*Math.PI;const h=Math.asin(y1*Math.sin(u)),g=h*h,w=g*g*g;return{x:.5*(r*Math.cos(h)/(y1*(E0+3*T0*g+w*(7*A0+9*I0*g)))/Math.PI+.5),y:1-.5*(h*(E0+T0*g+w*(A0+I0*g))/Math.PI+1),z:0}}unproject(r,u){r=(2*r-.5)*Math.PI;let h=u=(2*(1-u)-1)*Math.PI,g=h*h,w=g*g*g;for(let K,re,fe,we=0;we<12&&(re=h*(E0+T0*g+w*(A0+I0*g))-u,fe=E0+3*T0*g+w*(7*A0+9*I0*g),K=re/fe,h=He(h-K,-Math.PI/3,Math.PI/3),g=h*h,w=g*g*g,!(Math.abs(K)<1e-12));++we);const A=y1*r*(E0+3*T0*g+w*(7*A0+9*I0*g))/Math.cos(h),k=Math.asin(Math.sin(h)/y1),F=He(180*A/Math.PI,-180,180),z=He(180*k/Math.PI,-Sl,Sl);return new hi(F,z)}}class C8 extends $p{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,u){return{x:.5+r/360,y:.5-u/360,z:0}}unproject(r,u){const h=360*(r-.5),g=He(360*(.5-u),-Sl,Sl);return new hi(h,g)}}const Zg=Math.PI/2;function _1(o){return Math.tan((Zg+o)/2)}class k8 extends $p{constructor(r){super(r),this.center=r.center||[0,30];const[u,h]=this.parallels=r.parallels||[30,30];let g=te(u),w=te(h);this.southernCenter=g+w<0,this.southernCenter&&(g=-g,w=-w);const A=Math.cos(g),k=_1(g);this.n=g===w?Math.sin(g):Math.log(A/Math.cos(w))/Math.log(_1(w)/k),this.f=A*Math.pow(_1(g),this.n)/this.n}project(r,u){u=te(u),this.southernCenter&&(u=-u),r=te(r-this.center[0]);const h=1e-6,{n:g,f:w}=this;w>0?u<-Zg+h&&(u=-Zg+h):u>Zg-h&&(u=Zg-h);const A=w/Math.pow(_1(u),g);let k=A*Math.sin(g*r),F=w-A*Math.cos(g*r);return k=.5*(k/Math.PI+.5),F=.5*(F/Math.PI+.5),{x:k,y:this.southernCenter?F:1-F,z:0}}unproject(r,u){r=(2*r-.5)*Math.PI,this.southernCenter&&(u=1-u),u=(2*(1-u)-.5)*Math.PI;const{n:h,f:g}=this,w=g-u,A=Math.sign(w),k=Math.sign(h)*Math.sqrt(r*r+w*w);let F=Math.atan2(r,Math.abs(w))*A;w*h<0&&(F-=Math.PI*Math.sign(r)*A);const z=He(Se(F/h)+this.center[0],-180,180),K=He(Se(2*Math.atan(Math.pow(g/k,1/h))-Zg),-Sl,Sl);return new hi(z,this.southernCenter?-K:K)}}class _4 extends $p{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,u){return{x:Zo(r),y:Qa(u),z:0}}unproject(r,u){const h=Hl(r),g=Ao(u);return new hi(h,g)}}const v4=te(Sl);class L8 extends $p{project(r,u){const h=(u=te(u))*u,g=h*h;return{x:.5*((r=te(r))*(.8707-.131979*h+g*(g*(.003971*h-.001529*g)-.013791))/Math.PI+.5),y:1-.5*(u*(1.007226+h*(.015085+g*(.028874*h-.044475-.005916*g)))/Math.PI+1),z:0}}unproject(r,u){r=(2*r-.5)*Math.PI;let h=u=(2*(1-u)-1)*Math.PI,g=25,w=0,A=h*h;do{A=h*h;const z=A*A;w=(h*(1.007226+A*(.015085+z*(.028874*A-.044475-.005916*z)))-u)/(1.007226+A*(.045255+z*(.259866*A-.311325-.005916*11*z))),h=He(h-w,-v4,v4)}while(Math.abs(w)>1e-6&&--g>0);A=h*h;const k=He(Se(r/(.8707+A*(A*(A*A*A*(.003971-.001529*A)-.013791)-.131979))),-180,180),F=Se(h);return new hi(k,F)}}const x4=te(Sl);class P8 extends $p{project(r,u){u=te(u),r=te(r);const h=Math.cos(u),g=2/Math.PI,w=Math.acos(h*Math.cos(r/2)),A=Math.sin(w)/w,k=.5*(r*g+2*h*Math.sin(r/2)/A)||0,F=.5*(u+Math.sin(u)/A)||0;return{x:.5*(k/Math.PI+.5),y:1-.5*(F/Math.PI+1),z:0}}unproject(r,u){let h=r=(2*r-.5)*Math.PI,g=u=(2*(1-u)-1)*Math.PI,w=25;const A=1e-6;let k=0,F=0;do{const z=Math.cos(g),K=Math.sin(g),re=2*K*z,fe=K*K,we=z*z,Te=Math.cos(h/2),Re=Math.sin(h/2),st=2*Te*Re,_t=Re*Re,Rt=1-we*Te*Te,xt=Rt?1/Rt:0,Pt=Rt?Math.acos(z*Te)*Math.sqrt(1/Rt):0,Vt=.5*(2*Pt*z*Re+2*h/Math.PI)-r,jt=.5*(Pt*K+g)-u,wn=.5*xt*(we*_t+Pt*z*Te*fe)+1/Math.PI,vn=xt*(st*re/4-Pt*K*Re),On=.125*xt*(re*Re-Pt*K*we*st),ar=.5*xt*(fe*Te+Pt*_t*z)+.5,kn=vn*On-ar*wn;k=(jt*vn-Vt*ar)/kn,F=(Vt*On-jt*wn)/kn,h=He(h-k,-Math.PI,Math.PI),g=He(g-F,-x4,x4)}while((Math.abs(k)>A||Math.abs(F)>A)&&--w>0);return new hi(Se(h),Se(g))}}class b4 extends $p{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(te(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,u){const{scale:h,cosPhi:g}=this;return{x:te(r)*g*h+.5,y:-Math.sin(te(u))/g*h+.5,z:0}}unproject(r,u){const{scale:h,cosPhi:g}=this,w=-(u-.5)/h,A=He(Se((r-.5)/h)/g,-180,180),k=Math.asin(He(w*g,-1,1)),F=He(Se(k),-Sl,Sl);return new hi(A,F)}}class N8 extends _4{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,u,h){const g=Ll(r,u,h);return Lt(g,g,Uu(Do(h))),{x:g[0],y:g[1],z:g[2]}}locationPoint(r,u){const h=nu(u.lat,u.lng),g=ct([],h),w=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(u),r._centerAltitude):r._centerAltitude;Qe(h,h,g,Nl(1,0)*pi*w);const A=ph(new Float64Array(16));return Dh(A,r.pixelMatrix,r.globeMatrix),Lt(h,h,A),new Y(h[0],h[1])}pixelsPerMeter(r,u){return Nl(1,0)*u}pixelSpaceConversion(r,u,h){const g=Nl(1,r)*u,w=nt(Nl(1,45)*u,g,h);return this.pixelsPerMeter(r,u)/w}createTileMatrix(r,u,h){const g=Kf(Do(h.canonical));return Dh(new Float64Array(16),r.globeMatrix,g)}createInversionMatrix(r,u){const{center:h}=r,g=Uu(Do(u));return ip(g,g,te(h.lng)),vd(g,g,te(h.lat)),Tc(g,g,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(g)}pointCoordinate(r,u,h,g){return mo(r,u,h,!0)||new Nf(0,0)}pointCoordinate3D(r,u,h){const g=this.pointCoordinate(r,u,h,0);return[g.x,g.y,g.z]}isPointAboveHorizon(r,u){return!mo(r,u.x,u.y,!1)}farthestPixelDistance(r){const u=(function(g,w){const A=g.cameraToCenterDistance,k=g._centerAltitude*w,F=g._camera,z=g._camera.forward(),K=Oh([],Me([],z,-A),[0,0,k]),re=g.worldSize/(2*Math.PI),fe=[0,0,-re],we=g.width/g.height,Te=Math.tan(g.fovAboveCenter),Re=Me([],F.up(),Te),st=Me([],F.right(),Te*we),_t=ct([],Oh([],Oh([],z,Re),st)),Rt=[];let xt;if(new ai(K,_t).closestPointOnSphere(fe,re,Rt)){const Pt=Oh([],Rt,fe),Vt=en([],Pt,K);xt=Math.cos(g.fovAboveCenter)*Zh(Vt)}else{const Pt=en([],K,fe),Vt=en([],fe,K);ct(Vt,Vt);const jt=Zh(Pt)-re;xt=Math.sqrt(jt*(jt+2*re));const wn=Math.acos(xt/(re+jt))-Math.acos(Xe(z,Vt));xt*=Math.cos(wn)}return 1.01*xt})(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),h=eh(r.zoom);if(h>0){const g=y4(r,Nl(1,r.center.lat)*r.worldSize),w=r.worldSize/(2*Math.PI),A=Math.max(r.width,r.height)/r.worldSize*Math.PI;return nt(u,g+w*(1-Math.cos(A)),Math.pow(h,10))}return u}upVector(r,u,h){return Ll(u,h,r,1)}upVectorScale(r){return{metersToTile:ls(Qh(Do(r)))}}}function w4(o){const r=o.parallels,u=!!r&&Math.abs(r[0]+r[1])<.01;switch(o.name){case"mercator":return new _4(o);case"equirectangular":return new C8(o);case"naturalEarth":return new L8(o);case"equalEarth":return new I8(o);case"winkelTripel":return new P8(o);case"albers":return u?new b4(o):new A8(o);case"lambertConformalConic":return u?new b4(o):new k8(o);case"globe":return new N8(o)}throw new Error(`Invalid projection name: ${o.name}`)}const R8=ns.types,M8=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function v1(o,r,u,h,g,w,A,k,F,z,K,re,fe){const we=k?Math.min(Gp,Math.round(k[0])):0,Te=k?Math.min(Gp,Math.round(k[1])):0;o.emplaceBack(r,u,Math.round(32*h),Math.round(32*g),w,A,(we<<1)+(F?1:0),Te,16*z,16*K,256*re,256*fe)}function x1(o,r,u,h,g,w,A){o.emplaceBack(r,u,h,g,w,A)}function b1(o,r,u,h,g){o.emplaceBack(r,u,h,g),o.emplaceBack(r,u,h,g),o.emplaceBack(r,u,h,g),o.emplaceBack(r,u,h,g)}function D8(o){for(const r of o.sections)if(pn(r.text))return!0;return!1}class vb{constructor(r){this.layoutVertexArray=new In,this.indexArray=new Vr,this.programConfigurations=r,this.segments=new xl,this.dynamicLayoutVertexArray=new Vn,this.opacityVertexArray=new Nr,this.placedSymbolArray=new Sa,this.globeExtVertexArray=new Wn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,u,h,g){this.isEmpty()||(h&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,qL.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,$L.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,M8,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,GL.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||g)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Cr(vb,"SymbolBuffers");class xb{constructor(r,u,h){this.layoutVertexArray=new r,this.layoutAttributes=u,this.indexArray=new h,this.segments=new xl,this.collisionVertexArray=new Ai,this.collisionVertexArrayExt=new Mi}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,HL.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,WL.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Cr(xb,"CollisionBuffers");class Hp{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((A=>A.id)),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ph([]),this.placementViewportMatrix=ph([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=lb(this.zoom,u["text-size"]),this.iconSizeData=lb(this.zoom,u["icon-size"]);const h=this.layers[0].layout,g=h.get("symbol-sort-key"),w=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&g.constantOr(1)!==void 0,this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map((A=>yf[A])),this.stateDependentLayerIds=this.layers.filter((A=>A.isStateDependent())).map((A=>A.id)),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new vb(new Jc(this.layers,this.zoom,(r=>/^text/.test(r)))),this.icon=new vb(new Jc(this.layers,this.zoom,(r=>/^icon/.test(r)))),this.glyphOffsetArray=new Ea,this.lineVertexArray=new Yo,this.symbolInstances=new Eo}calculateGlyphDependencies(r,u,h,g,w){for(let A=0;A<r.length;A++)if(u[r.charCodeAt(A)]=!0,g&&w){const k=x0[r.charAt(A)];k&&(u[k.charCodeAt(0)]=!0)}}populate(r,u,h,g){const w=this.layers[0],A=w.layout,k=this.projection.name==="globe",F=A.get("text-font"),z=A.get("text-field"),K=A.get("icon-image"),re=(z.value.kind!=="constant"||z.value.value instanceof Fs&&!z.value.value.isEmpty()||z.value.value.toString().length>0)&&(F.value.kind!=="constant"||F.value.value.length>0),fe=K.value.kind!=="constant"||!!K.value.value||Object.keys(K.parameters).length>0,we=A.get("symbol-sort-key");if(this.features=[],!re&&!fe)return;const Te=u.iconDependencies,Re=u.glyphDependencies,st=u.availableImages,_t=new Z(this.zoom);for(const{feature:Rt,id:xt,index:Pt,sourceLayerIndex:Vt}of r){const jt=w._featureFilter.needGeometry,wn=Rf(Rt,jt);if(!w._featureFilter.filter(_t,wn,h))continue;if(jt||(wn.geometry=Fc(Rt,h,g)),k&&Rt.type!==1&&h.z<=5){const kn=wn.geometry,$n=.98078528056,Hn=(nr,fr)=>Xe(Ll(nr.x,nr.y,h,1),Ll(fr.x,fr.y,h,1))<$n;for(let nr=0;nr<kn.length;nr++)kn[nr]=zp(kn[nr],Hn)}let vn,On;if(re){const kn=w.getValueAndResolveTokens("text-field",wn,h,st),$n=Fs.factory(kn);D8($n)&&(this.hasRTLText=!0),(!this.hasRTLText||P()==="unavailable"||this.hasRTLText&&W.isParsed())&&(vn=KL($n,w,wn))}if(fe){const kn=w.getValueAndResolveTokens("icon-image",wn,h,st);On=kn instanceof na?kn:na.fromString(kn)}if(!vn&&!On)continue;const ar=this.sortFeaturesByKey?we.evaluate(wn,{},h):void 0;if(this.features.push({id:xt,text:vn,icon:On,index:Pt,sourceLayerIndex:Vt,geometry:wn.geometry,properties:Rt.properties,type:R8[Rt.type],sortKey:ar}),On&&(Te[On.name]=!0),vn){const kn=F.evaluate(wn,{},h).join(","),$n=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(yf.vertical)>=0;for(const Hn of vn.sections)if(Hn.image)Te[Hn.image.name]=!0;else{const nr=Ge(vn.toString()),fr=Hn.fontStack||kn,Mn=Re[fr]=Re[fr]||{};this.calculateGlyphDependencies(Hn.text,Mn,$n,this.allowVerticalPlacement,nr)}}}A.get("symbol-placement")==="line"&&(this.features=(function(Rt){const xt={},Pt={},Vt=[];let jt=0;function wn(kn){Vt.push(Rt[kn]),jt++}function vn(kn,$n,Hn){const nr=Pt[kn];return delete Pt[kn],Pt[$n]=nr,Vt[nr].geometry[0].pop(),Vt[nr].geometry[0]=Vt[nr].geometry[0].concat(Hn[0]),nr}function On(kn,$n,Hn){const nr=xt[$n];return delete xt[$n],xt[kn]=nr,Vt[nr].geometry[0].shift(),Vt[nr].geometry[0]=Hn[0].concat(Vt[nr].geometry[0]),nr}function ar(kn,$n,Hn){const nr=Hn?$n[0][$n[0].length-1]:$n[0][0];return`${kn}:${nr.x}:${nr.y}`}for(let kn=0;kn<Rt.length;kn++){const $n=Rt[kn],Hn=$n.geometry,nr=$n.text?$n.text.toString():null;if(!nr){wn(kn);continue}const fr=ar(nr,Hn),Mn=ar(nr,Hn,!0);if(fr in Pt&&Mn in xt&&Pt[fr]!==xt[Mn]){const Rr=On(fr,Mn,Hn),ii=vn(fr,Mn,Vt[Rr].geometry);delete xt[fr],delete Pt[Mn],Pt[ar(nr,Vt[ii].geometry,!0)]=ii,Vt[Rr].geometry=null}else fr in Pt?vn(fr,Mn,Hn):Mn in xt?On(fr,Mn,Hn):(wn(kn),xt[fr]=jt-1,Pt[Mn]=jt-1)}return Vt.filter((kn=>kn.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((Rt,xt)=>Rt.sortKey-xt.sortKey))}update(r,u,h,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,u,this.layers,h,g),this.icon.programConfigurations.updatePaintArrays(r,u,this.layers,h,g))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=w4(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,u){const h=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:g,y:w}of u)this.lineVertexArray.emplaceBack(g,w);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(r,u,h,g,w,A,k,F,z,K,re,fe,we,Te){const Re=r.indexArray,st=r.layoutVertexArray,_t=r.globeExtVertexArray,Rt=r.segments.prepareSegment(4*u.length,st,Re,this.canOverlap?A.sortKey:void 0),xt=this.glyphOffsetArray.length,Pt=Rt.vertexLength,Vt=this.allowVerticalPlacement&&k===yf.vertical?Math.PI/2:0,jt=A.text&&A.text.sections;for(let vn=0;vn<u.length;vn++){const{tl:On,tr:ar,bl:kn,br:$n,tex:Hn,pixelOffsetTL:nr,pixelOffsetBR:fr,minFontScaleX:Mn,minFontScaleY:Rr,glyphOffset:ii,isSDF:zr,sectionIndex:ys}=u[vn],pr=Rt.vertexLength,Ti=ii[1];if(v1(st,z.x,z.y,On.x,Ti+On.y,Hn.x,Hn.y,h,zr,nr.x,nr.y,Mn,Rr),v1(st,z.x,z.y,ar.x,Ti+ar.y,Hn.x+Hn.w,Hn.y,h,zr,fr.x,nr.y,Mn,Rr),v1(st,z.x,z.y,kn.x,Ti+kn.y,Hn.x,Hn.y+Hn.h,h,zr,nr.x,fr.y,Mn,Rr),v1(st,z.x,z.y,$n.x,Ti+$n.y,Hn.x+Hn.w,Hn.y+Hn.h,h,zr,fr.x,fr.y,Mn,Rr),F){const{x:_s,y:Fo,z:vs}=F.anchor,[Gi,el,bs]=F.up;x1(_t,_s,Fo,vs,Gi,el,bs),x1(_t,_s,Fo,vs,Gi,el,bs),x1(_t,_s,Fo,vs,Gi,el,bs),x1(_t,_s,Fo,vs,Gi,el,bs),b1(r.dynamicLayoutVertexArray,_s,Fo,vs,Vt)}else b1(r.dynamicLayoutVertexArray,z.x,z.y,z.z,Vt);Re.emplaceBack(pr,pr+1,pr+2),Re.emplaceBack(pr+1,pr+2,pr+3),Rt.vertexLength+=4,Rt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ii[0]),vn!==u.length-1&&ys===u[vn+1].sectionIndex||r.programConfigurations.populatePaintArrays(st.length,A,A.index,{},we,Te,jt&&jt[ys])}const wn=F?F.anchor:z;r.placedSymbolArray.emplaceBack(wn.x,wn.y,wn.z,z.x,z.y,xt,this.glyphOffsetArray.length-xt,Pt,K,re,z.segment,h?h[0]:0,h?h[1]:0,g[0],g[1],k,0,!1,0,fe,0)}_commitLayoutVertex(r,u,h,g,w,A,k){r.emplaceBack(u,h,g,w,A,Math.round(k.x),Math.round(k.y))}_addCollisionDebugVertices(r,u,h,g,w,A,k){const F=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),z=F.vertexLength,K=k.tileAnchorX,re=k.tileAnchorY;for(let we=0;we<4;we++)h.collisionVertexArray.emplaceBack(0,0,0,0);h.collisionVertexArrayExt.emplaceBack(u,-r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(u,r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(u,r.padding,r.padding),h.collisionVertexArrayExt.emplaceBack(u,-r.padding,r.padding),this._commitLayoutVertex(h.layoutVertexArray,g,w,A,K,re,new Y(r.x1,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,g,w,A,K,re,new Y(r.x2,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,g,w,A,K,re,new Y(r.x2,r.y2)),this._commitLayoutVertex(h.layoutVertexArray,g,w,A,K,re,new Y(r.x1,r.y2)),F.vertexLength+=4;const fe=h.indexArray;fe.emplaceBack(z,z+1),fe.emplaceBack(z+1,z+2),fe.emplaceBack(z+2,z+3),fe.emplaceBack(z+3,z),F.primitiveLength+=4}_addTextDebugCollisionBoxes(r,u,h,g,w,A){for(let k=g;k<w;k++){const F=h.get(k),z=this.getSymbolInstanceTextSize(r,A,u,k);this._addCollisionDebugVertices(F,z,this.textCollisionBox,F.projectedAnchorX,F.projectedAnchorY,F.projectedAnchorZ,A)}}_addIconDebugCollisionBoxes(r,u,h,g,w,A){for(let k=g;k<w;k++){const F=h.get(k),z=this.getSymbolInstanceIconSize(r,u,A.placedIconSymbolIndex);this._addCollisionDebugVertices(F,z,this.iconCollisionBox,F.projectedAnchorX,F.projectedAnchorY,F.projectedAnchorZ,A)}}generateCollisionDebugBuffers(r,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new xb(Er,U2.members,$o),this.iconCollisionBox=new xb(Er,U2.members,$o);const h=qg(this.iconSizeData,r),g=qg(this.textSizeData,r);for(let w=0;w<this.symbolInstances.length;w++){const A=this.symbolInstances.get(w);this._addTextDebugCollisionBoxes(g,r,u,A.textBoxStartIndex,A.textBoxEndIndex,A),this._addTextDebugCollisionBoxes(g,r,u,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A),this._addIconDebugCollisionBoxes(h,r,u,A.iconBoxStartIndex,A.iconBoxEndIndex,A),this._addIconDebugCollisionBoxes(h,r,u,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A)}}getSymbolInstanceTextSize(r,u,h,g){const w=this.text.placedSymbolArray.get(u.rightJustifiedTextSymbolIndex>=0?u.rightJustifiedTextSymbolIndex:u.centerJustifiedTextSymbolIndex>=0?u.centerJustifiedTextSymbolIndex:u.leftJustifiedTextSymbolIndex>=0?u.leftJustifiedTextSymbolIndex:u.verticalPlacedTextSymbolIndex>=0?u.verticalPlacedTextSymbolIndex:g),A=u1(this.textSizeData,r,w)/Cc;return this.tilePixelRatio*A}getSymbolInstanceIconSize(r,u,h){const g=this.icon.placedSymbolArray.get(h),w=u1(this.iconSizeData,r,g);return this.tilePixelRatio*w}_commitDebugCollisionVertexUpdate(r,u,h){r.emplaceBack(u,-h,-h),r.emplaceBack(u,h,-h),r.emplaceBack(u,h,h),r.emplaceBack(u,-h,h)}_updateTextDebugCollisionBoxes(r,u,h,g,w,A){for(let k=g;k<w;k++){const F=h.get(k),z=this.getSymbolInstanceTextSize(r,A,u,k);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,z,F.padding)}}_updateIconDebugCollisionBoxes(r,u,h,g,w,A){for(let k=g;k<w;k++){const F=h.get(k),z=this.getSymbolInstanceIconSize(r,u,A);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,z,F.padding)}}updateCollisionDebugBuffers(r,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=qg(this.iconSizeData,r),g=qg(this.textSizeData,r);for(let w=0;w<this.symbolInstances.length;w++){const A=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(g,r,u,A.textBoxStartIndex,A.textBoxEndIndex,A),this._updateTextDebugCollisionBoxes(g,r,u,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A),this._updateIconDebugCollisionBoxes(h,r,u,A.iconBoxStartIndex,A.iconBoxEndIndex,A.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(h,r,u,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,u,h,g,w,A,k,F,z){const K={};if(u<h){const{x1:re,y1:fe,x2:we,y2:Te,padding:Re,projectedAnchorX:st,projectedAnchorY:_t,projectedAnchorZ:Rt,tileAnchorX:xt,tileAnchorY:Pt,featureIndex:Vt}=r.get(u);K.textBox={x1:re,y1:fe,x2:we,y2:Te,padding:Re,projectedAnchorX:st,projectedAnchorY:_t,projectedAnchorZ:Rt,tileAnchorX:xt,tileAnchorY:Pt},K.textFeatureIndex=Vt}if(g<w){const{x1:re,y1:fe,x2:we,y2:Te,padding:Re,projectedAnchorX:st,projectedAnchorY:_t,projectedAnchorZ:Rt,tileAnchorX:xt,tileAnchorY:Pt,featureIndex:Vt}=r.get(g);K.verticalTextBox={x1:re,y1:fe,x2:we,y2:Te,padding:Re,projectedAnchorX:st,projectedAnchorY:_t,projectedAnchorZ:Rt,tileAnchorX:xt,tileAnchorY:Pt},K.verticalTextFeatureIndex=Vt}if(A<k){const{x1:re,y1:fe,x2:we,y2:Te,padding:Re,projectedAnchorX:st,projectedAnchorY:_t,projectedAnchorZ:Rt,tileAnchorX:xt,tileAnchorY:Pt,featureIndex:Vt}=r.get(A);K.iconBox={x1:re,y1:fe,x2:we,y2:Te,padding:Re,projectedAnchorX:st,projectedAnchorY:_t,projectedAnchorZ:Rt,tileAnchorX:xt,tileAnchorY:Pt},K.iconFeatureIndex=Vt}if(F<z){const{x1:re,y1:fe,x2:we,y2:Te,padding:Re,projectedAnchorX:st,projectedAnchorY:_t,projectedAnchorZ:Rt,tileAnchorX:xt,tileAnchorY:Pt,featureIndex:Vt}=r.get(F);K.verticalIconBox={x1:re,y1:fe,x2:we,y2:Te,padding:Re,projectedAnchorX:st,projectedAnchorY:_t,projectedAnchorZ:Rt,tileAnchorX:xt,tileAnchorY:Pt},K.verticalIconFeatureIndex=Vt}return K}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const h=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,u){const h=r.placedSymbolArray.get(u),g=h.vertexStartIndex+4*h.numGlyphs;for(let w=h.vertexStartIndex;w<g;w+=4)r.indexArray.emplaceBack(w,w+1,w+2),r.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(r),h=Math.cos(r),g=[],w=[],A=[];for(let k=0;k<this.symbolInstances.length;++k){A.push(k);const F=this.symbolInstances.get(k);g.push(0|Math.round(u*F.tileAnchorX+h*F.tileAnchorY)),w.push(F.featureIndex)}return A.sort(((k,F)=>g[k]-g[F]||w[F]-w[k])),A}addToSortKeyRanges(r,u){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===u?h.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const h=this.symbolInstances.get(u);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:w,leftJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:k,placedIconSymbolIndex:F,verticalPlacedIconSymbolIndex:z}=h;g>=0&&this.addIndicesForPlacedSymbol(this.text,g),w>=0&&w!==g&&this.addIndicesForPlacedSymbol(this.text,w),A>=0&&A!==w&&A!==g&&this.addIndicesForPlacedSymbol(this.text,A),k>=0&&this.addIndicesForPlacedSymbol(this.text,k),F>=0&&this.addIndicesForPlacedSymbol(this.icon,F),z>=0&&this.addIndicesForPlacedSymbol(this.icon,z)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Cr(Hp,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Hp.MAX_GLYPHS=65535,Hp.addDynamicAttributes=b1;const O8=new yt({"symbol-placement":new Ie(En.layout_symbol["symbol-placement"]),"symbol-spacing":new Ie(En.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ie(En.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new rt(En.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ie(En.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ie(En.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ie(En.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ie(En.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ie(En.layout_symbol["icon-rotation-alignment"]),"icon-size":new rt(En.layout_symbol["icon-size"]),"icon-text-fit":new Ie(En.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ie(En.layout_symbol["icon-text-fit-padding"]),"icon-image":new rt(En.layout_symbol["icon-image"]),"icon-rotate":new rt(En.layout_symbol["icon-rotate"]),"icon-padding":new Ie(En.layout_symbol["icon-padding"]),"icon-keep-upright":new Ie(En.layout_symbol["icon-keep-upright"]),"icon-offset":new rt(En.layout_symbol["icon-offset"]),"icon-anchor":new rt(En.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ie(En.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ie(En.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ie(En.layout_symbol["text-rotation-alignment"]),"text-field":new rt(En.layout_symbol["text-field"]),"text-font":new rt(En.layout_symbol["text-font"]),"text-size":new rt(En.layout_symbol["text-size"]),"text-max-width":new rt(En.layout_symbol["text-max-width"]),"text-line-height":new rt(En.layout_symbol["text-line-height"]),"text-letter-spacing":new rt(En.layout_symbol["text-letter-spacing"]),"text-justify":new rt(En.layout_symbol["text-justify"]),"text-radial-offset":new rt(En.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ie(En.layout_symbol["text-variable-anchor"]),"text-anchor":new rt(En.layout_symbol["text-anchor"]),"text-max-angle":new Ie(En.layout_symbol["text-max-angle"]),"text-writing-mode":new Ie(En.layout_symbol["text-writing-mode"]),"text-rotate":new rt(En.layout_symbol["text-rotate"]),"text-padding":new Ie(En.layout_symbol["text-padding"]),"text-keep-upright":new Ie(En.layout_symbol["text-keep-upright"]),"text-transform":new rt(En.layout_symbol["text-transform"]),"text-offset":new rt(En.layout_symbol["text-offset"]),"text-allow-overlap":new Ie(En.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ie(En.layout_symbol["text-ignore-placement"]),"text-optional":new Ie(En.layout_symbol["text-optional"])});var bb={paint:new yt({"icon-opacity":new rt(En.paint_symbol["icon-opacity"]),"icon-color":new rt(En.paint_symbol["icon-color"]),"icon-halo-color":new rt(En.paint_symbol["icon-halo-color"]),"icon-halo-width":new rt(En.paint_symbol["icon-halo-width"]),"icon-halo-blur":new rt(En.paint_symbol["icon-halo-blur"]),"icon-translate":new Ie(En.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ie(En.paint_symbol["icon-translate-anchor"]),"text-opacity":new rt(En.paint_symbol["text-opacity"]),"text-color":new rt(En.paint_symbol["text-color"],{runtimeType:ca,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new rt(En.paint_symbol["text-halo-color"]),"text-halo-width":new rt(En.paint_symbol["text-halo-width"]),"text-halo-blur":new rt(En.paint_symbol["text-halo-blur"]),"text-translate":new Ie(En.paint_symbol["text-translate"]),"text-translate-anchor":new Ie(En.paint_symbol["text-translate-anchor"])}),layout:O8};class S4{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:ho,this.defaultValue=r}evaluate(r){if(r.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(r.formattedSection))return u.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Cr(S4,"FormatSectionOverride",{omit:["defaultValue"]});class w1 extends Mh{constructor(r){super(r,bb)}recalculate(r,u){super.recalculate(r,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const g=[];for(const w of h)g.indexOf(w)<0&&g.push(w);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,u,h,g){const w=this.layout.get(r).evaluate(u,{},h,g),A=this._unevaluatedLayout._values[r];return A.isDataDriven()||Dr(A.value)||!w?w:(function(k,F){return F.replace(/{([^{}]+)}/g,((z,K)=>K in k?String(k[K]):""))})(u.properties,w)}createBucket(r){return new Hp(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of bb.paint.overridableProperties){if(!w1.hasPaintOverride(this.layout,r))continue;const u=this.paint.get(r),h=new S4(u),g=new ac(h,u.property.specification);let w=null;w=u.value.kind==="constant"||u.value.kind==="source"?new Ql("source",g):new vc("composite",g,u.value.zoomStops,u.value._interpolationType),this.paint._values[r]=new et(u.property,w,u.parameters)}}_handleOverridablePaintPropertyUpdate(r,u,h){return!(!this.layout||u.isDataDriven()||h.isDataDriven())&&w1.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,u){const h=r.get("text-field"),g=bb.paint.properties[u];let w=!1;const A=k=>{for(const F of k)if(g.overrides&&g.overrides.hasOverride(F))return void(w=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Fs)A(h.value.value.sections);else if(h.value.kind==="source"){const k=z=>{w||(z instanceof ra&&Ts(z.value)===Tl?A(z.value.sections):z instanceof ol?A(z.sections):z.eachChild(k))},F=h.value;F._styleExpression&&k(F._styleExpression.expression)}return w}getProgramConfiguration(r){return new Rh(this,r)}}var F8={paint:new yt({"background-color":new Ie(En.paint_background["background-color"]),"background-pattern":new Ie(En.paint_background["background-pattern"]),"background-opacity":new Ie(En.paint_background["background-opacity"])})},B8={paint:new yt({"raster-opacity":new Ie(En.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ie(En.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ie(En.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ie(En.paint_raster["raster-brightness-max"]),"raster-saturation":new Ie(En.paint_raster["raster-saturation"]),"raster-contrast":new Ie(En.paint_raster["raster-contrast"]),"raster-resampling":new Ie(En.paint_raster["raster-resampling"]),"raster-fade-duration":new Ie(En.paint_raster["raster-fade-duration"])})};class z8 extends Mh{constructor(r){super(r,{}),this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var j8={paint:new yt({"sky-type":new Ie(En.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ie(En.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ie(En.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ie(En.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ie(En.paint_sky["sky-gradient-radius"]),"sky-gradient":new gt(En.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ie(En.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ie(En.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ie(En.paint_sky["sky-opacity"])})};function wb(o,r,u){const h=[0,0,1],g=ti([]);return Lr(g,g,u?-te(o)+Math.PI:te(o)),cr(g,g,-te(r)),Ht(h,h,g),ct(h,h)}const U8={circle:class extends Mh{constructor(o){super(o,n1)}createBucket(o){return new up(o)}queryRadius(o){const r=o;return cp("circle-radius",this,r)+cp("circle-stroke-width",this,r)+jp(this.paint.get("circle-translate"))}queryIntersectsFeature(o,r,u,h,g,w,A,k){const F=Dg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,o.pixelToTileUnitsFactor),z=this.paint.get("circle-radius").evaluate(r,u)+this.paint.get("circle-stroke-width").evaluate(r,u);return s0(o,h,w,A,k,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",F,z)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new Rh(this,o)}},heatmap:class extends Mh{createBucket(o){return new a0(o)}constructor(o){super(o,fu),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=c0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return cp("heatmap-radius",this,o)}queryIntersectsFeature(o,r,u,h,g,w,A,k){const F=this.paint.get("heatmap-radius").evaluate(r,u);return s0(o,h,w,A,k,!0,!0,new Y(0,0),F)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new Rh(this,o)}},hillshade:class extends Mh{constructor(o){super(o,r1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Mh{constructor(o){super(o,ne)}getProgramIds(){const o=this.paint.get("fill-pattern"),r=o&&o.constantOr(1),u=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&u.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),u}getProgramConfiguration(o){return new Rh(this,o)}recalculate(o,r){super.recalculate(o,r);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new C(o)}queryRadius(){return jp(this.paint.get("fill-translate"))}queryIntersectsFeature(o,r,u,h,g,w){return!o.queryGeometry.isAboveHorizon&&Pm(bd(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,o.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}},"fill-extrusion":class extends Mh{constructor(o){super(o,DL)}createBucket(o){return new y0(o)}queryRadius(){return jp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new Rh(this,o)}queryIntersectsFeature(o,r,u,h,g,w,A,k,F){const z=Dg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,o.pixelToTileUnitsFactor),K=this.paint.get("fill-extrusion-height").evaluate(r,u),re=this.paint.get("fill-extrusion-base").evaluate(r,u),fe=[0,0],we=k&&w.elevation,Te=w.elevation?w.elevation.exaggeration():1,Re=o.tile.getBucket(this);if(we&&Re instanceof y0){const Pt=Re.centroidVertexArray,Vt=F+1;Vt<Pt.length&&(fe[0]=Pt.geta_centroid_pos0(Vt),fe[1]=Pt.geta_centroid_pos1(Vt))}if(fe[0]===0&&fe[1]===1)return!1;w.projection.name==="globe"&&(h=R2([h],[new Y(0,0),new Y(pi,pi)],o.tileID.canonical).map((Pt=>Pt.polygon)).flat());const st=we?k:null,[_t,Rt]=(function(Pt,Vt,jt,wn,vn,On,ar,kn,$n,Hn,nr){return Pt.projection.name==="globe"?(function(fr,Mn,Rr,ii,zr,ys,pr,Ti,_s,Fo,vs){const Gi=[],el=[],bs=fr.projection.upVectorScale(vs,fr.center.lat,fr.worldSize).metersToTile,ws=[0,0,0,1],Aa=[0,0,0,1],za=(Ia,Rl,ru,wu)=>{Ia[0]=Rl,Ia[1]=ru,Ia[2]=wu,Ia[3]=1},ja=N2();Rr>0&&(Rr+=ja),ii+=ja;for(const Ia of Mn){const Rl=[],ru=[];for(const wu of Ia){const Ca=wu.x+zr.x,Vu=wu.y+zr.y,Su=fr.projection.projectTilePoint(Ca,Vu,vs),Xl=fr.projection.upVector(vs,wu.x,wu.y);let Uo=Rr,Eu=ii;if(pr){const Ua=F2(Ca,Vu,Rr,ii,pr,Ti,_s,Fo);Uo+=Ua.base,Eu+=Ua.top}Rr!==0?za(ws,Su.x+Xl[0]*bs*Uo,Su.y+Xl[1]*bs*Uo,Su.z+Xl[2]*bs*Uo):za(ws,Su.x,Su.y,Su.z),za(Aa,Su.x+Xl[0]*bs*Eu,Su.y+Xl[1]*bs*Eu,Su.z+Xl[2]*bs*Eu),Lt(ws,ws,ys),Lt(Aa,Aa,ys),Rl.push(new Vg(ws[0],ws[1],ws[2])),ru.push(new Vg(Aa[0],Aa[1],Aa[2]))}Gi.push(Rl),el.push(ru)}return[Gi,el]})(Pt,Vt,jt,wn,vn,On,ar,kn,$n,Hn,nr):ar?(function(fr,Mn,Rr,ii,zr,ys,pr,Ti,_s){const Fo=[],vs=[],Gi=[0,0,0,1];for(const el of fr){const bs=[],ws=[];for(const Aa of el){const za=Aa.x+ii.x,ja=Aa.y+ii.y,Ia=F2(za,ja,Mn,Rr,ys,pr,Ti,_s);Gi[0]=za,Gi[1]=ja,Gi[2]=Ia.base,Gi[3]=1,Tn(Gi,Gi,zr),Gi[3]=Math.max(Gi[3],1e-5);const Rl=new Vg(Gi[0]/Gi[3],Gi[1]/Gi[3],Gi[2]/Gi[3]);Gi[0]=za,Gi[1]=ja,Gi[2]=Ia.top,Gi[3]=1,Tn(Gi,Gi,zr),Gi[3]=Math.max(Gi[3],1e-5);const ru=new Vg(Gi[0]/Gi[3],Gi[1]/Gi[3],Gi[2]/Gi[3]);bs.push(Rl),ws.push(ru)}Fo.push(bs),vs.push(ws)}return[Fo,vs]})(Vt,jt,wn,vn,On,ar,kn,$n,Hn):(function(fr,Mn,Rr,ii,zr){const ys=[],pr=[],Ti=zr[8]*Mn,_s=zr[9]*Mn,Fo=zr[10]*Mn,vs=zr[11]*Mn,Gi=zr[8]*Rr,el=zr[9]*Rr,bs=zr[10]*Rr,ws=zr[11]*Rr;for(const Aa of fr){const za=[],ja=[];for(const Ia of Aa){const Rl=Ia.x+ii.x,ru=Ia.y+ii.y,wu=zr[0]*Rl+zr[4]*ru+zr[12],Ca=zr[1]*Rl+zr[5]*ru+zr[13],Vu=zr[2]*Rl+zr[6]*ru+zr[14],Su=zr[3]*Rl+zr[7]*ru+zr[15],Xl=wu+Ti,Uo=Ca+_s,Eu=Vu+Fo,Ua=Math.max(Su+vs,1e-5),yh=wu+Gi,Tu=Ca+el,kc=Vu+bs,fc=Math.max(Su+ws,1e-5);za.push(new Vg(Xl/Ua,Uo/Ua,Eu/Ua)),ja.push(new Vg(yh/fc,Tu/fc,kc/fc))}ys.push(za),pr.push(ja)}return[ys,pr]})(Vt,jt,wn,vn,On)})(w,h,re,K,z,A,st,fe,Te,w.center.lat,o.tileID.canonical),xt=o.queryGeometry;return(function(Pt,Vt,jt){let wn=1/0;Pm(jt,Vt)&&(wn=O2(jt,Vt[0]));for(let vn=0;vn<Vt.length;vn++){const On=Vt[vn],ar=Pt[vn];for(let kn=0;kn<On.length-1;kn++){const $n=On[kn],Hn=[$n,On[kn+1],ar[kn+1],ar[kn],$n];Ng(jt,Hn)&&(wn=Math.min(wn,O2(jt,Hn)))}}return wn!==1/0&&wn})(_t,Rt,xt.isPointQuery()?xt.screenBounds:xt.screenGeometry)}},line:class extends Mh{constructor(o){super(o,B2),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof ke,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,r){super.recalculate(o,r),this.paint._values["line-floorwidth"]=z2.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new l1(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new Rh(this,o)}queryRadius(o){const r=o,u=j2(cp("line-width",this,r),cp("line-gap-width",this,r)),h=cp("line-offset",this,r);return u/2+Math.abs(h)+jp(this.paint.get("line-translate"))}queryIntersectsFeature(o,r,u,h,g,w){if(o.queryGeometry.isAboveHorizon)return!1;const A=bd(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,o.pixelToTileUnitsFactor),k=o.pixelToTileUnitsFactor/2*j2(this.paint.get("line-width").evaluate(r,u),this.paint.get("line-gap-width").evaluate(r,u)),F=this.paint.get("line-offset").evaluate(r,u);return F&&(h=(function(z,K){const re=[],fe=new Y(0,0);for(let we=0;we<z.length;we++){const Te=z[we],Re=[];for(let st=0;st<Te.length;st++){const _t=Te[st],Rt=Te[st+1],xt=st===0?fe:_t.sub(Te[st-1])._unit()._perp(),Pt=st===Te.length-1?fe:Rt.sub(_t)._unit()._perp(),Vt=xt._add(Pt)._unit();Vt._mult(1/(Vt.x*Pt.x+Vt.y*Pt.y)),Re.push(Vt._mult(K)._add(_t))}re.push(Re)}return re})(h,F*o.pixelToTileUnitsFactor)),(function(z,K,re){for(let fe=0;fe<K.length;fe++){const we=K[fe];if(z.length>=3){for(let Te=0;Te<we.length;Te++)if(Jf(z,we[Te]))return!0}if(th(z,we,re))return!0}return!1})(A,h,k)}isTileClipped(){return!0}},symbol:w1,background:class extends Mh{constructor(o){super(o,F8)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Mh{constructor(o){super(o,B8)}getProgramIds(){return["raster"]}},sky:class extends Mh{constructor(o){super(o,j8),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=c0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(o,r){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),g=!h,w=o.style.light,A=w.properties.get("position");return g&&w.properties.get("anchor")==="viewport"&&Ir("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),g?wb(A.azimuthal,90-A.polar,r):wb(h[0],90-h[1],r)}const u=this.paint.get("sky-gradient-center");return wb(u[0],90-u[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}}};class C0{constructor(r,u,h,g){this.context=r,this.format=h,this.texture=r.gl.createTexture(),this.update(u,g)}update(r,u,h){const{width:g,height:w}=r,{context:A}=this,{gl:k}=A,{HTMLImageElement:F,HTMLCanvasElement:z,HTMLVideoElement:K,ImageData:re,ImageBitmap:fe}=T;if(k.bindTexture(k.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!u||u.premultiply!==!1)),h||this.size&&this.size[0]===g&&this.size[1]===w){const{x:we,y:Te}=h||{x:0,y:0};r instanceof F||r instanceof z||r instanceof K||r instanceof re||fe&&r instanceof fe?k.texSubImage2D(k.TEXTURE_2D,0,we,Te,k.RGBA,k.UNSIGNED_BYTE,r):k.texSubImage2D(k.TEXTURE_2D,0,we,Te,g,w,k.RGBA,k.UNSIGNED_BYTE,r.data)}else this.size=[g,w],r instanceof F||r instanceof z||r instanceof K||r instanceof re||fe&&r instanceof fe?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,r):k.texImage2D(k.TEXTURE_2D,0,this.format,g,w,0,this.format,k.UNSIGNED_BYTE,r.data);this.useMipmap=!!(u&&u.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&k.generateMipmap(k.TEXTURE_2D)}bind(r,u){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),r!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,r),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?r===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_NEAREST:r),this.filter=r),u!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,u),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class V8{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class q8{constructor(){this.tasks={},this.taskQueue=[],Zt(["process"],this),this.invoker=new V8(this.process),this.nextId=0}add(r,u){const h=this.nextId++,g=(function({type:w,isSymbolTile:A,zoom:k}){return k=k||0,w==="message"?0:w!=="maybePrepare"||A?w!=="parseTile"||A?w==="parseTile"&&A?300-k:w==="maybePrepare"&&A?400-k:500:200-k:100-k})(u);if(g===0){$t();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[h]={fn:r,metadata:u,priority:g,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){$t();try{if(this.taskQueue=this.taskQueue.filter((h=>!!this.tasks[h])),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const u=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!u)return;u.fn()}finally{}}pick(){let r=null,u=1/0;for(let g=0;g<this.taskQueue.length;g++){const w=this.tasks[this.taskQueue[g]];w.priority<u&&(u=w.priority,r=g)}if(r===null)return null;const h=this.taskQueue[r];return this.taskQueue.splice(r,1),h}remove(){this.invoker.remove()}}class E4{constructor(r){this._stringToNumber={},this._numberToString=[];for(let u=0;u<r.length;u++){const h=r[u];this._stringToNumber[h]=u,this._numberToString[u]=h}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const G8=["tile","layer","source","sourceLayer","state"];class T4{constructor(r,u,h,g,w){this.type="Feature",this._vectorTileFeature=r,this._z=u,this._x=h,this._y=g,this.properties=r.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(r.id=this.id);for(const u of G8)this[u]!==void 0&&(r[u]=this[u]);return r}}const Df=32,Td=33,Wp=new Uint16Array(8184);for(let o=0;o<2046;o++){let r=o+2,u=0,h=0,g=0,w=0,A=0,k=0;for(1&r?g=w=A=Df:u=h=k=Df;(r>>=1)>1;){const z=u+g>>1,K=h+w>>1;1&r?(g=u,w=h,u=A,h=k):(u=g,h=w,g=A,w=k),A=z,k=K}const F=4*o;Wp[F+0]=u,Wp[F+1]=h,Wp[F+2]=g,Wp[F+3]=w}const Ad=new Uint16Array(2178),Xp=new Uint8Array(1089),S1=new Uint16Array(1089);function A4(o){return o===0?-.03125:o===32?.03125:0}var I4=Bt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const C4={type:2,extent:pi,loadGeometry:()=>[[new Y(0,0),new Y(pi+1,0),new Y(pi+1,pi+1),new Y(0,pi+1),new Y(0,0)]]};class Sb{constructor(r,u,h,g,w){this.tileID=r,this.uid=pt(),this.uses=0,this.tileSize=u,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection)}registerFadeDuration(r){const u=r+this.timeAdded;u<uo.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Um(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,u,h){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=(function(g,w){const A={};if(!w)return A;for(const k of g){const F=k.layerIds.map((z=>w.getLayer(z))).filter(Boolean);if(F.length!==0){k.layers=F,k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map((z=>F.filter((K=>K.id===z))[0])));for(const z of F)A[z.id]=k}}return A})(r.buckets,u.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const w=this.buckets[g];if(w instanceof Hp){if(this.hasSymbolBuckets=!0,!h)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const w=this.buckets[g];if(w instanceof Hp&&w.hasRTLText){this.hasRTLText=!0,W.isLoading()||W.isLoaded()||P()!=="deferred"||j();break}}this.queryPadding=0;for(const g in this.buckets){const w=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(g).queryRadius(w))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new ks}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const h in this.buckets){const g=this.buckets[h];g.uploadPending()&&g.upload(r)}const u=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new C0(r,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new C0(r,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new C0(r,this.lineAtlas.image,u.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,u,h,g,w,A,k,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:g,pixelPosMatrix:k,transform:A,params:w,tileTransform:this.tileTransform},r,u,h):{}}querySourceFeatures(r,u){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const g=h.loadVTLayers(),w=u?u.sourceLayer:"",A=g._geojsonTileLayer||g[w];if(!A)return;const k=Si(u&&u.filter),{z:F,x:z,y:K}=this.tileID.canonical,re={z:F,x:z,y:K};for(let fe=0;fe<A.length;fe++){const we=A.feature(fe);if(k.needGeometry){const st=Rf(we,!0);if(!k.filter(new Z(this.tileID.overscaledZ),st,this.tileID.canonical))continue}else if(!k.filter(new Z(this.tileID.overscaledZ),we))continue;const Te=h.getId(we,w),Re=new T4(we,F,z,K,Te);Re.tile=re,r.push(Re)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const u=this.expirationTime;if(r.cacheControl){const h=xr(r.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const h=Date.now();let g=!1;if(this.expirationTime>h)g=!1;else if(u)if(this.expirationTime<u)g=!0;else{const w=this.expirationTime-u;w?this.expirationTime=h+Math.max(w,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0||!u)return;const h=this.latestFeatureIndex.loadVTLayers(),g=u.style.listImages();for(const w in this.buckets){if(!u.style.hasLayer(w))continue;const A=this.buckets[w],k=A.layers[0].sourceLayer||"_geojsonTileLayer",F=h[k],z=r[k];if(!F||!z||Object.keys(z).length===0)continue;if(A.update(z,F,g,this.imageAtlas&&this.imageAtlas.patternPositions||{}),A instanceof l1||A instanceof C){const re=u.style._getSourceCache(A.layers[0].source);u._terrain&&u._terrain.enabled&&re&&A.programConfigurations.needsUpload&&u._terrain._clearRenderCacheForTile(re.id,this.tileID)}const K=u&&u.style&&u.style.getLayer(w);K&&(this.queryPadding=Math.max(this.queryPadding,K.queryRadius(A)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<uo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=uo.now()+r}setTexture(r,u){const h=u.context,g=h.gl;this.texture=this.texture||u.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new C0(h,r,g.RGBA,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(r,u){const h={};for(const g of u)h[g]=!0;this.dependencies[r]=h}hasDependency(r,u){for(const h of r){const g=this.dependencies[h];if(g){for(const w of u)if(g[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,u){if(!u||u.name==="mercator"||this._tileDebugBuffer)return;const h=Fc(C4,this.tileID.canonical,this.tileTransform)[0],g=new Rn,w=new Bu;for(let A=0;A<h.length;A++){const{x:k,y:F}=h[A];g.emplaceBack(k,F),w.emplaceBack(A)}w.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(w),this._tileDebugBuffer=r.createVertexBuffer(g,Jr.members),this._tileDebugSegments=xl.simpleSegment(0,0,g.length,w.length)}_makeTileBoundsBuffers(r,u){if(this._tileBoundsBuffer||!u||u.name==="mercator")return;const h=Fc(C4,this.tileID.canonical,this.tileTransform)[0];let g,w;if(this.isRaster){const A=(function(k,F){const z=Um(k,F),K=Math.pow(2,k.z);for(let st=0;st<Td;st++)for(let _t=0;_t<Td;_t++){const Rt=Hl((k.x+(_t+A4(_t))/Df)/K),xt=Ao((k.y+(st+A4(st))/Df)/K),Pt=F.project(Rt,xt),Vt=st*Td+_t;Ad[2*Vt+0]=Math.round((Pt.x*z.scale-z.x)*pi),Ad[2*Vt+1]=Math.round((Pt.y*z.scale-z.y)*pi)}Xp.fill(0),S1.fill(0);for(let st=2045;st>=0;st--){const _t=4*st,Rt=Wp[_t+0],xt=Wp[_t+1],Pt=Wp[_t+2],Vt=Wp[_t+3],jt=Rt+Pt>>1,wn=xt+Vt>>1,vn=jt+wn-xt,On=wn+Rt-jt,ar=xt*Td+Rt,kn=Vt*Td+Pt,$n=wn*Td+jt,Hn=Math.hypot((Ad[2*ar+0]+Ad[2*kn+0])/2-Ad[2*$n+0],(Ad[2*ar+1]+Ad[2*kn+1])/2-Ad[2*$n+1])>=16;Xp[$n]=Xp[$n]||(Hn?1:0),st<1022&&(Xp[$n]=Xp[$n]||Xp[(xt+On>>1)*Td+(Rt+vn>>1)]||Xp[(Vt+On>>1)*Td+(Pt+vn>>1)])}const re=new An,fe=new Vr;let we=0;function Te(st,_t){const Rt=_t*Td+st;return S1[Rt]===0&&(re.emplaceBack(Ad[2*Rt+0],Ad[2*Rt+1],st*pi/Df,_t*pi/Df),S1[Rt]=++we),S1[Rt]-1}function Re(st,_t,Rt,xt,Pt,Vt){const jt=st+Rt>>1,wn=_t+xt>>1;if(Math.abs(st-Pt)+Math.abs(_t-Vt)>1&&Xp[wn*Td+jt])Re(Pt,Vt,st,_t,jt,wn),Re(Rt,xt,Pt,Vt,jt,wn);else{const vn=Te(st,_t),On=Te(Rt,xt),ar=Te(Pt,Vt);fe.emplaceBack(vn,On,ar)}}return Re(0,0,Df,Df,Df,0),Re(Df,Df,0,0,0,Df),{vertices:re,indices:fe}})(this.tileID.canonical,u);g=A.vertices,w=A.indices}else{g=new An,w=new Vr;for(const{x:k,y:F}of h)g.emplaceBack(k,F,0,0);const A=jg(g.int16,void 0,4);for(let k=0;k<A.length;k+=3)w.emplaceBack(A[k],A[k+1],A[k+2])}this._tileBoundsBuffer=r.createVertexBuffer(g,I4.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(w),this._tileBoundsSegments=xl.simpleSegment(0,0,g.length,w.length)}_makeGlobeTileDebugBuffers(r,u){const h=u.projection;if(!h||h.name!=="globe"||u.freezeTileCoverage)return;const g=this.tileID.canonical,w=Uu(To(g,u)),A=eh(u.zoom);let k;A>0&&(k=ju(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,g,u,w,k,A),this._makeGlobeTileDebugTextBuffer(r,g,u,w,k,A)}_globePoint(r,u,h,g,w,A,k){let F=Ll(r,u,h);if(A){const z=1<<h.z,K=Zo(g.center.lng),re=Qa(g.center.lat),fe=(h.x+.5)/z-K;let we=0;fe>.5?we=-1:fe<-.5&&(we=1);let Te=(r/pi+h.x)/z+we,Re=(u/pi+h.y)/z;Te=(Te-K)*g._pixelsPerMercatorPixel+K,Re=(Re-re)*g._pixelsPerMercatorPixel+re;const st=[Te*g.worldSize,Re*g.worldSize,0];Lt(st,st,A),F=wl(F,st,k)}return Lt(F,F,w)}_makeGlobeTileDebugBorderBuffer(r,u,h,g,w,A){const k=new Rn,F=new Bu,z=new Jt,K=(fe,we,Te,Re,st)=>{const _t=(Te-fe)/(st-1),Rt=(Re-we)/(st-1),xt=k.length;for(let Pt=0;Pt<st;Pt++){const Vt=fe+Pt*_t,jt=we+Pt*Rt;k.emplaceBack(Vt,jt);const wn=this._globePoint(Vt,jt,u,h,g,w,A);z.emplaceBack(wn[0],wn[1],wn[2]),F.emplaceBack(xt+Pt)}},re=pi;K(0,0,re,0,16),K(re,0,re,re,16),K(re,re,0,re,16),K(0,re,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(F),this._tileDebugBuffer=r.createVertexBuffer(k,Jr.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(z,Qi.members),this._tileDebugSegments=xl.simpleSegment(0,0,k.length,F.length)}_makeGlobeTileDebugTextBuffer(r,u,h,g,w,A){const k=pi/4,F=new Rn,z=new Vr,K=new Jt,re=25;z.reserve(32),F.reserve(re),K.reserve(re);const fe=(we,Te)=>re*we+Te;for(let we=0;we<re;we++){const Te=we*k;for(let Re=0;Re<re;Re++){const st=Re*k;F.emplaceBack(st,Te);const _t=this._globePoint(st,Te,u,h,g,w,A);K.emplaceBack(_t[0],_t[1],_t[2])}}for(let we=0;we<4;we++)for(let Te=0;Te<4;Te++){const Re=fe(we,Te),st=fe(we,Te+1),_t=fe(we+1,Te),Rt=fe(we+1,Te+1);z.emplaceBack(Re,st,_t),z.emplaceBack(_t,st,Rt)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(z),this._tileDebugTextBuffer=r.createVertexBuffer(F,Jr.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(K,Qi.members),this._tileDebugTextSegments=xl.simpleSegment(0,0,re,32)}}class $8{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,u,h){const g=String(u);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][g]=this.stateChanges[r][g]||{},Ve(this.stateChanges[r][g],h),this.deletedStates[r]===null){this.deletedStates[r]={};for(const w in this.state[r])w!==g&&(this.deletedStates[r][w]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][g]===null){this.deletedStates[r][g]={};for(const w in this.state[r][g])h[w]||(this.deletedStates[r][g][w]=null)}else for(const w in h)this.deletedStates[r]&&this.deletedStates[r][g]&&this.deletedStates[r][g][w]===null&&delete this.deletedStates[r][g][w]}removeFeatureState(r,u,h){if(this.deletedStates[r]===null)return;const g=String(u);if(this.deletedStates[r]=this.deletedStates[r]||{},h&&u!==void 0)this.deletedStates[r][g]!==null&&(this.deletedStates[r][g]=this.deletedStates[r][g]||{},this.deletedStates[r][g][h]=null);else if(u!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][g])for(h in this.deletedStates[r][g]={},this.stateChanges[r][g])this.deletedStates[r][g][h]=null;else this.deletedStates[r][g]=null;else this.deletedStates[r]=null}getState(r,u){const h=String(u),g=Ve({},(this.state[r]||{})[h],(this.stateChanges[r]||{})[h]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const w=this.deletedStates[r][u];if(w===null)return{};for(const A in w)delete g[A]}return g}initializeTileState(r,u){r.setFeatureState(this.state,u)}coalesceChanges(r,u){const h={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const w={};for(const A in this.stateChanges[g])this.state[g][A]||(this.state[g][A]={}),Ve(this.state[g][A],this.stateChanges[g][A]),w[A]=this.state[g][A];h[g]=w}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const w={};if(this.deletedStates[g]===null)for(const A in this.state[g])w[A]={},this.state[g][A]={};else for(const A in this.deletedStates[g]){if(this.deletedStates[g][A]===null)this.state[g][A]={};else if(this.state[g][A])for(const k of Object.keys(this.deletedStates[g][A]))delete this.state[g][A][k];w[A]=this.state[g][A]}h[g]=h[g]||{},Ve(h[g],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const g in r)r[g].setFeatureState(h,u)}}class k4{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,u){const h=this.toIdx(r,u);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(r,u){return this.leaves[this.toIdx(r,u)]}toIdx(r,u){return u*this.size+r}}function L4(o,r,u,h){let g=0,w=Number.MAX_VALUE;for(let A=0;A<3;A++)if(Math.abs(h[A])<1e-15){if(u[A]<o[A]||u[A]>r[A])return null}else{const k=1/h[A];let F=(o[A]-u[A])*k,z=(r[A]-u[A])*k;if(F>z){const K=F;F=z,z=K}if(F>g&&(g=F),z<w&&(w=z),g>w)return null}return g}function P4(o,r,u,h,g,w,A,k,F,z,K){const re=h-o,fe=g-r,we=w-u,Te=A-o,Re=k-r,st=F-u,_t=K[1]*st-K[2]*Re,Rt=K[2]*Te-K[0]*st,xt=K[0]*Re-K[1]*Te,Pt=re*_t+fe*Rt+we*xt;if(Math.abs(Pt)<1e-15)return null;const Vt=1/Pt,jt=z[0]-o,wn=z[1]-r,vn=z[2]-u,On=(jt*_t+wn*Rt+vn*xt)*Vt;if(On<0||On>1)return null;const ar=wn*we-vn*fe,kn=vn*re-jt*we,$n=jt*fe-wn*re,Hn=(K[0]*ar+K[1]*kn+K[2]*$n)*Vt;return Hn<0||On+Hn>1?null:(Te*ar+Re*kn+st*$n)*Vt}function N4(o,r,u){return(o-r)/(u-r)}function R4(o,r,u,h,g,w,A,k,F){const z=1<<u,K=w-h,re=A-g,fe=(o+1)/z*K+h,we=(r+0)/z*re+g,Te=(r+1)/z*re+g;k[0]=(o+0)/z*K+h,k[1]=we,F[0]=fe,F[1]=Te}class M4{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const u=(function(w){const A=Math.ceil(Math.log2(w.dim/8)),k=[];let F=Math.ceil(Math.pow(2,A));const z=1/F,K=(we,Te,Re,st,_t)=>{const Rt=st?1:0,xt=(we+1)*Re-Rt,Pt=Te*Re,Vt=(Te+1)*Re-Rt;_t[0]=we*Re,_t[1]=Pt,_t[2]=xt,_t[3]=Vt};let re=new k4(F);const fe=[];for(let we=0;we<F*F;we++){K(we%F,Math.floor(we/F),z,!1,fe);const Te=Yp(fe[0],fe[1],w),Re=Yp(fe[2],fe[1],w),st=Yp(fe[2],fe[3],w),_t=Yp(fe[0],fe[3],w);re.minimums.push(Math.min(Te,Re,st,_t)),re.maximums.push(Math.max(Te,Re,st,_t)),re.leaves.push(1)}for(k.push(re),F/=2;F>=1;F/=2){const we=k[k.length-1];re=new k4(F);for(let Te=0;Te<F*F;Te++){K(Te%F,Math.floor(Te/F),2,!0,fe);const Re=we.getElevation(fe[0],fe[1]),st=we.getElevation(fe[2],fe[1]),_t=we.getElevation(fe[2],fe[3]),Rt=we.getElevation(fe[0],fe[3]),xt=we.isLeaf(fe[0],fe[1]),Pt=we.isLeaf(fe[2],fe[1]),Vt=we.isLeaf(fe[2],fe[3]),jt=we.isLeaf(fe[0],fe[3]),wn=Math.min(Re.min,st.min,_t.min,Rt.min),vn=Math.max(Re.max,st.max,_t.max,Rt.max),On=xt&&Pt&&Vt&&jt;re.maximums.push(vn),re.minimums.push(wn),re.leaves.push(vn-wn<=5&&On?1:0)}k.push(re)}return k})(this.dem),h=u.length-1,g=u[h];this._addNode(g.minimums[0],g.maximums[0],g.leaves[0]),this._construct(u,0,0,h,0)}raycastRoot(r,u,h,g,w,A,k=1){return L4([r,u,-100],[h,g,this.maximums[0]*k],w,A)}raycast(r,u,h,g,w,A,k=1){if(!this.nodeCount)return null;const F=this.raycastRoot(r,u,h,g,w,A,k);if(F==null)return null;const z=[],K=[],re=[],fe=[],we=[{idx:0,t:F,nodex:0,nodey:0,depth:0}];for(;we.length>0;){const{idx:Te,t:Re,nodex:st,nodey:_t,depth:Rt}=we.pop();if(this.leaves[Te]){R4(st,_t,Rt,r,u,h,g,re,fe);const Pt=1<<Rt,Vt=(st+0)/Pt,jt=(st+1)/Pt,wn=(_t+0)/Pt,vn=(_t+1)/Pt,On=Yp(Vt,wn,this.dem)*k,ar=Yp(jt,wn,this.dem)*k,kn=Yp(jt,vn,this.dem)*k,$n=Yp(Vt,vn,this.dem)*k,Hn=P4(re[0],re[1],On,fe[0],re[1],ar,fe[0],fe[1],kn,w,A),nr=P4(fe[0],fe[1],kn,re[0],fe[1],$n,re[0],re[1],On,w,A),fr=Math.min(Hn!==null?Hn:Number.MAX_VALUE,nr!==null?nr:Number.MAX_VALUE);if(fr!==Number.MAX_VALUE)return fr;{const Mn=Qe([],w,A,Re);if(D4(On,ar,$n,kn,N4(Mn[0],re[0],fe[0]),N4(Mn[1],re[1],fe[1]))>=Mn[2])return Re}continue}let xt=0;for(let Pt=0;Pt<this._siblingOffset.length;Pt++){R4((st<<1)+this._siblingOffset[Pt][0],(_t<<1)+this._siblingOffset[Pt][1],Rt+1,r,u,h,g,re,fe),re[2]=-100,fe[2]=this.maximums[this.childOffsets[Te]+Pt]*k;const Vt=L4(re,fe,w,A);if(Vt!=null){const jt=Vt;z[Pt]=jt;let wn=!1;for(let vn=0;vn<xt&&!wn;vn++)jt>=z[K[vn]]&&(K.splice(vn,0,Pt),wn=!0);wn||(K[xt]=Pt),xt++}}for(let Pt=0;Pt<xt;Pt++){const Vt=K[Pt];we.push({idx:this.childOffsets[Te]+Vt,t:z[Vt],nodex:(st<<1)+this._siblingOffset[Vt][0],nodey:(_t<<1)+this._siblingOffset[Vt][1],depth:Rt+1})}}return null}_addNode(r,u,h){return this.minimums.push(r),this.maximums.push(u),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(r,u,h,g,w){if(r[g].isLeaf(u,h)===1)return;this.childOffsets[w]||(this.childOffsets[w]=this.nodeCount);const A=g-1,k=r[A];let F=0,z=0;for(let K=0;K<this._siblingOffset.length;K++){const re=2*u+this._siblingOffset[K][0],fe=2*h+this._siblingOffset[K][1],we=k.getElevation(re,fe),Te=k.isLeaf(re,fe),Re=this._addNode(we.min,we.max,Te);Te&&(F|=1<<K),z||(z=Re)}for(let K=0;K<this._siblingOffset.length;K++)F&1<<K||this._construct(r,2*u+this._siblingOffset[K][0],2*h+this._siblingOffset[K][1],A,z+K)}}function D4(o,r,u,h,g,w){return nt(nt(o,u,w),nt(r,h,w),g)}function Yp(o,r,u){const h=u.dim,g=He(o*h-.5,0,h-1),w=He(r*h-.5,0,h-1),A=Math.floor(g),k=Math.floor(w),F=Math.min(A+1,h-1),z=Math.min(k+1,h-1);return D4(u.get(A,k),u.get(F,k),u.get(A,z),u.get(F,z),g-A,w-k)}const O4={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function H8(o,r,u){return(256*o*256+256*r+u)/10-1e4}function W8(o,r,u){return 256*o+r+u/256-32768}class E1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,u,h,g=!1,w=!1){if(this.uid=r,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return Ir(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const A=this.dim=u.height-2,k=new Uint32Array(u.data.buffer);if(this.pixels=new Uint8Array(u.data.buffer),this.encoding=h||"mapbox",this.borderReady=g,!g){for(let F=0;F<A;F++)k[this._idx(-1,F)]=k[this._idx(0,F)],k[this._idx(A,F)]=k[this._idx(A-1,F)],k[this._idx(F,-1)]=k[this._idx(F,0)],k[this._idx(F,A)]=k[this._idx(F,A-1)];k[this._idx(-1,-1)]=k[this._idx(0,0)],k[this._idx(A,-1)]=k[this._idx(A-1,0)],k[this._idx(-1,A)]=k[this._idx(0,A-1)],k[this._idx(A,A)]=k[this._idx(A-1,A-1)],w&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new M4(this)}get(r,u,h=!1){h&&(r=He(r,-1,this.dim),u=He(u,-1,this.dim));const g=4*this._idx(r,u);return(this.encoding==="terrarium"?W8:H8)(this.pixels[g],this.pixels[g+1],this.pixels[g+2])}static getUnpackVector(r){return O4[r]}get unpackVector(){return O4[this.encoding]}_idx(r,u){if(r<-1||r>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(r+1)}static pack(r,u){const h=[0,0,0,0],g=E1.getUnpackVector(u);let w=Math.floor((r+g[3])/g[2]);return h[2]=w%256,w=Math.floor(w/256),h[1]=w%256,w=Math.floor(w/256),h[0]=w,h}getPixels(){return new nh({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,u,h){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let g=u*this.dim,w=u*this.dim+this.dim,A=h*this.dim,k=h*this.dim+this.dim;switch(u){case-1:g=w-1;break;case 1:w=g+1}switch(h){case-1:A=k-1;break;case 1:k=A+1}const F=-u*this.dim,z=-h*this.dim;for(let K=A;K<k;K++)for(let re=g;re<w;re++){const fe=4*this._idx(re,K),we=4*this._idx(re+F,K+z);this.pixels[fe+0]=r.pixels[we+0],this.pixels[fe+1]=r.pixels[we+1],this.pixels[fe+2]=r.pixels[we+2],this.pixels[fe+3]=r.pixels[we+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Cr(E1,"DEMData"),Cr(M4,"DemMinMaxQuadTree",{omit:["dem"]});class X8{constructor(r,u){this.max=r,this.onRemove=u,this.reset()}reset(){for(const r in this.data)for(const u of this.data[r])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(r,u,h){const g=r.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const w={value:u,timeout:void 0};if(h!==void 0&&(w.timeout=setTimeout((()=>{this.remove(r,w)}),h)),this.data[g].push(w),this.order.push(g),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const u=this.data[r].shift();return u.timeout&&clearTimeout(u.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),u.value}getByKey(r){const u=this.data[r];return u?u[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,u){if(!this.has(r))return this;const h=r.wrapped().key,g=u===void 0?0:this.data[h].indexOf(u),w=this.data[h][g];return this.data[h].splice(g,1),w.timeout&&clearTimeout(w.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(w.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(r){const u=[];for(const h in this.data)for(const g of this.data[h])r(g.value)||u.push(g);for(const h of u)this.remove(h.value.tileID,h)}}class Jg{constructor(r,u,h){this.func=r,this.mask=u,this.range=h}}Jg.ReadOnly=!1,Jg.ReadWrite=!0,Jg.disabled=new Jg(519,Jg.ReadOnly,[0,1]);const Eb=7680;class Tb{constructor(r,u,h,g,w,A){this.test=r,this.ref=u,this.mask=h,this.fail=g,this.depthFail=w,this.pass=A}}Tb.disabled=new Tb({func:519,mask:0},0,0,Eb,Eb,Eb);class Id{constructor(r,u,h){this.blendFunction=r,this.blendColor=u,this.mask=h}}Id.Replace=[1,0],Id.disabled=new Id(Id.Replace,Vs.transparent,[!1,!1,!1,!1]),Id.unblended=new Id(Id.Replace,Vs.transparent,[!0,!0,!0,!0]),Id.alphaBlended=new Id([1,771],Vs.transparent,[!0,!0,!0,!0]);const Ab=1029,Ib=2305;class td{constructor(r,u,h){this.enable=r,this.mode=u,this.frontFace=h}}td.disabled=new td(!1,Ab,Ib),td.backCCW=new td(!0,Ab,Ib),td.backCW=new td(!0,Ab,2304),td.frontCW=new td(!0,1028,2304),td.frontCCW=new td(!0,1028,Ib);class Vm extends ta{constructor(r,u,h){super(),this.id=r,this._onlySymbols=h,u.on("data",(g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),u.on("error",(()=>{this._sourceErrored=!0})),this._source=u,this._tiles={},this._cache=new X8(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new $8,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const u=this._tiles[r];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,u){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,u)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,(()=>{}))}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,(()=>{}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const h=this._tiles[u];h.upload(r),h.prepare(this.map.style.imageManager)}}getIds(){return We(this._tiles).map((r=>r.tileID)).sort(F4).map((r=>r.key))}getRenderableIds(r){const u=[];for(const h in this._tiles)this._isIdRenderable(+h,r)&&u.push(this._tiles[h]);return r?u.sort(((h,g)=>{const w=h.tileID,A=g.tileID,k=new Y(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),F=new Y(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-A.overscaledZ||F.y-k.y||F.x-k.x})).map((h=>h.tileID.key)):u.map((h=>h.tileID)).sort(F4).map((h=>h.key))}hasRenderableParent(r){const u=this.findLoadedParent(r,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(r,u){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(u||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,u){const h=this._tiles[r];h&&(h.state!=="loading"&&(h.state=u),this._loadTile(h,this._tileLoaded.bind(this,h,r,u)))}_tileLoaded(r,u,h,g){if(g)if(r.state="errored",g.status!==404)this._source.fire(new Wo(g,{tile:r}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=uo.now(),h==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(u,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new ea("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const u=this.getRenderableIds();for(let g=0;g<u.length;g++){const w=u[g];if(r.neighboringTiles&&r.neighboringTiles[w]){const A=this.getTileByID(w);h(r,A),h(A,r)}}function h(g,w){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let A=w.tileID.canonical.x-g.tileID.canonical.x;const k=w.tileID.canonical.y-g.tileID.canonical.y,F=Math.pow(2,g.tileID.canonical.z),z=w.tileID.key;A===0&&k===0||Math.abs(k)>1||(Math.abs(A)>1&&(Math.abs(A+F)===1?A+=F:Math.abs(A-F)===1&&(A-=F)),w.dem&&g.dem&&(g.dem.backfillBorder(w.dem,A,k),g.neighboringTiles&&g.neighboringTiles[z]&&(g.neighboringTiles[z].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,u,h,g){for(const w in this._tiles){let A=this._tiles[w];if(g[w]||!A.hasData()||A.tileID.overscaledZ<=u||A.tileID.overscaledZ>h)continue;let k=A.tileID;for(;A&&A.tileID.overscaledZ>u+1;){const z=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[z.key],A&&A.hasData()&&(k=z)}let F=k;for(;F.overscaledZ>u;)if(F=F.scaledTo(F.overscaledZ-1),r[F.key]){g[k.key]=k;break}}}findLoadedParent(r,u){if(r.key in this._loadedParentTiles){const h=this._loadedParentTiles[r.key];return h&&h.tileID.overscaledZ>=u?h:null}for(let h=r.overscaledZ-1;h>=u;h--){const g=r.scaledTo(h),w=this._getLoadedTile(g);if(w)return w}}_getLoadedTile(r){const u=this._tiles[r.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,u){u=u||this._source.tileSize;const h=Math.ceil(r.width/u)+1,g=Math.ceil(r.height/u)+1,w=Math.floor(h*g*5),A=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(k)}handleWrapJump(r){const u=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,u){const h={};for(const g in this._tiles){const w=this._tiles[g];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+u),h[w.tileID.key]=w}this._tiles=h;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(r,u,h){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let g;this.updateCacheSize(r,u),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?g=r.getVisibleUnwrappedCoordinates(this._source.tileID).map((k=>new gh(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y))):(g=r.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(g=g.filter((k=>this._source.hasTile(k))))):g=[];const w=this._updateRetainedTiles(g);if(B4(this._source.type)&&g.length!==0){const k={},F={},z=Object.keys(w);for(const re of z){const fe=w[re],we=this._tiles[re];if(!we||we.fadeEndTime&&we.fadeEndTime<=uo.now())continue;const Te=this.findLoadedParent(fe,Math.max(fe.overscaledZ-Vm.maxOverzooming,this._source.minzoom));Te&&(this._addTile(Te.tileID),k[Te.tileID.key]=Te.tileID),F[re]=fe}const K=g[g.length-1].overscaledZ;for(const re in this._tiles){const fe=this._tiles[re];if(w[re]||!fe.hasData())continue;let we=fe.tileID;for(;we.overscaledZ>K;){we=we.scaledTo(we.overscaledZ-1);const Te=this._tiles[we.key];if(Te&&Te.hasData()&&F[we.key]){w[re]=fe.tileID;break}}}for(const re in k)w[re]||(this._coveredTiles[re]=!0,w[re]=k[re])}for(const k in w)this._tiles[k].clearFadeHold();const A=(function(k,F){const z=[];for(const K in k)K in F||z.push(K);return z})(this._tiles,w);for(const k of A){const F=this._tiles[k];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(+k)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const u={};if(r.length===0)return u;const h={},g=r.reduce(((z,K)=>Math.min(z,K.overscaledZ)),1/0),w=r[0].overscaledZ,A=Math.max(w-Vm.maxOverzooming,this._source.minzoom),k=Math.max(w+Vm.maxUnderzooming,this._source.minzoom),F={};for(const z of r){const K=this._addTile(z);u[z.key]=z,K.hasData()||g<this._source.maxzoom&&(F[z.key]=z)}this._retainLoadedChildren(F,g,k,u);for(const z of r){let K=this._tiles[z.key];if(K.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const fe=z.children(this._source.maxzoom)[0],we=this.getTile(fe);if(we&&we.hasData()){u[fe.key]=fe;continue}}else{const fe=z.children(this._source.maxzoom);if(u[fe[0].key]&&u[fe[1].key]&&u[fe[2].key]&&u[fe[3].key])continue}let re=K.wasRequested();for(let fe=z.overscaledZ-1;fe>=A;--fe){const we=z.scaledTo(fe);if(h[we.key]||(h[we.key]=!0,K=this.getTile(we),!K&&re&&(K=this._addTile(we)),K&&(u[we.key]=we,re=K.wasRequested(),K.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const u=[];let h,g=this._tiles[r].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){h=this._loadedParentTiles[g.key];break}u.push(g.key);const w=g.scaledTo(g.overscaledZ-1);if(h=this._getLoadedTile(w),h)break;g=w}for(const w of u)this._loadedParentTiles[w]=h}}_addTile(r){let u=this._tiles[r.key];if(u)return u;u=this._cache.getAndRemove(r),u&&(this._setTileReloadTimer(r.key,u),u.tileID=r,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,u)));const h=!!u;if(!h){const g=this.map?this.map.painter:null;u=new Sb(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,g,this._isRaster),this._loadTile(u,this._tileLoaded.bind(this,u,r.key,u.state))}return u?(u.uses++,this._tiles[r.key]=u,h||this._source.fire(new ea("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u):null}_setTileReloadTimer(r,u){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const h=u.getExpiryTimeout();h&&(this._timers[r]=setTimeout((()=>{this._reloadTile(r,"expired"),delete this._timers[r]}),h))}_removeTile(r){const u=this._tiles[r];u&&(u.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,u,h){const g=[],w=this.transform;if(!w)return g;const A=w.projection.name==="globe",k=Zo(w.center.lng);for(const F in this._tiles){const z=this._tiles[F];if(h&&z.clearQueryDebugViz(),z.holdingForFade())continue;let K;if(A){const re=z.tileID.canonical;if(re.z===0){const fe=[Math.abs(He(k,...k0(re,-1))-k),Math.abs(He(k,...k0(re,1))-k)];K=[0,2*fe.indexOf(Math.min(...fe))-1]}else{const fe=[Math.abs(He(k,...k0(re,-1))-k),Math.abs(He(k,...k0(re,0))-k),Math.abs(He(k,...k0(re,1))-k)];K=[fe.indexOf(Math.min(...fe))-1]}}else K=[0];for(const re of K){const fe=r.containsTile(z,w,u,re);fe&&g.push(fe)}}return g}getVisibleCoordinates(r){const u=this.getRenderableIds(r).map((h=>this._tiles[h].tileID));for(const h of u)h.projMatrix=this.transform.calculateProjMatrix(h.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(B4(this._source.type))for(const r in this._tiles){const u=this._tiles[r];if(u.fadeEndTime!==void 0&&u.fadeEndTime>=uo.now())return!0}return!1}setFeatureState(r,u,h){this._state.updateState(r=r||"_geojsonTileLayer",u,h)}removeFeatureState(r,u,h){this._state.removeFeatureState(r=r||"_geojsonTileLayer",u,h)}getFeatureState(r,u){return this._state.getState(r=r||"_geojsonTileLayer",u)}setDependencies(r,u,h){const g=this._tiles[r];g&&g.setDependencies(u,h)}reloadTilesForDependencies(r,u){for(const h in this._tiles)this._tiles[h].hasDependency(r,u)&&this._reloadTile(+h,"reloading");this._cache.filter((h=>!h.hasDependency(r,u)))}_preloadTiles(r,u){if(!this._sourceLoaded){const k=()=>{this._sourceLoaded&&(this._source.off("data",k),this._preloadTiles(r,u))};return void this._source.on("data",k)}const h=new Map,g=Array.isArray(r)?r:[r],w=this.map.painter.terrain,A=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const k of g){const F=k.coveringTiles({tileSize:A,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const z of F)h.set(z.key,z);this.usedForTerrain&&k.updateElevation(!1)}ge(Array.from(h.values()),((k,F)=>{const z=new Sb(k,this._source.tileSize*k.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(z,(K=>{this._source.type==="raster-dem"&&z.dem&&this._backfillDEM(z),F(K,z)}))}),u)}}function F4(o,r){const u=Math.abs(2*o.wrap)-+(o.wrap<0),h=Math.abs(2*r.wrap)-+(r.wrap<0);return o.overscaledZ-r.overscaledZ||h-u||r.canonical.y-o.canonical.y||r.canonical.x-o.canonical.x}function B4(o){return o==="raster"||o==="image"||o==="video"||o==="custom"}function k0(o,r){const u=1<<o.z;return[o.x/u+r,(o.x+1)/u+r]}Vm.maxOverzooming=10,Vm.maxUnderzooming=3;class T1{constructor(r,u,h){this._demTile=r,this._dem=this._demTile.dem,this._scale=u,this._offset=h}static create(r,u,h){const g=h||r.findDEMTileFor(u);if(!g||!g.dem)return;const w=g.dem,A=g.tileID,k=1<<u.canonical.z-A.canonical.z;return new T1(g,g.tileSize/pi/k,[(u.canonical.x/k-A.canonical.x)*w.dim,(u.canonical.y/k-A.canonical.y)*w.dim])}tileCoordToPixel(r,u){const h=u*this._scale+this._offset[1],g=Math.floor(r*this._scale+this._offset[0]),w=Math.floor(h);return new Y(g,w)}getElevationAt(r,u,h,g){const w=r*this._scale+this._offset[0],A=u*this._scale+this._offset[1],k=Math.floor(w),F=Math.floor(A),z=this._dem;return g=!!g,h?nt(nt(z.get(k,F,g),z.get(k,F+1,g),A-F),nt(z.get(k+1,F,g),z.get(k+1,F+1,g),A-F),w-k):z.get(k,F,g)}getElevationAtPixel(r,u,h){return this._dem.get(r,u,!!h)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Nl(1,r)*this._dem.stride}}class z4{constructor(r,u){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new hu(pi,16,0),this.featureIndexArray=new aa,this.promoteId=u}insert(r,u,h,g,w,A=0){const k=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,g,w,A);const F=this.grid;for(let z=0;z<u.length;z++){const K=u[z],re=[1/0,1/0,-1/0,-1/0];for(let fe=0;fe<K.length;fe++){const we=K[fe];re[0]=Math.min(re[0],we.x),re[1]=Math.min(re[1],we.y),re[2]=Math.max(re[2],we.x),re[3]=Math.max(re[3],we.y)}re[0]<pi&&re[1]<pi&&re[2]>=0&&re[3]>=0&&F.insert(k,re[0],re[1],re[2],re[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Li(new h1(this.rawTileData)).layers,this.sourceLayerCoder=new E4(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,u,h,g){this.loadVTLayers();const w=r.params||{},A=Si(w.filter),k=r.tileResult,F=r.transform,z=k.bufferedTilespaceBounds,K=this.grid.query(z.min.x,z.min.y,z.max.x,z.max.y,((Te,Re,st,_t)=>t1(k.bufferedTilespaceGeometry,Te,Re,st,_t)));K.sort(Y8);let re=null;F.elevation&&K.length>0&&(re=T1.create(F.elevation,this.tileID));const fe={};let we;for(let Te=0;Te<K.length;Te++){const Re=K[Te];if(Re===we)continue;we=Re;const st=this.featureIndexArray.get(Re);let _t=null;this.loadMatchingFeature(fe,st,A,w.layers,w.availableImages,u,h,g,((Rt,xt,Pt,Vt=0)=>(_t||(_t=Fc(Rt,this.tileID.canonical,r.tileTransform)),xt.queryIntersectsFeature(k,Rt,Pt,_t,this.z,r.transform,r.pixelPosMatrix,re,Vt))))}return fe}loadMatchingFeature(r,u,h,g,w,A,k,F,z){const{featureIndex:K,bucketIndex:re,sourceLayerIndex:fe,layoutVertexArrayOffset:we}=u,Te=this.bucketLayerIDs[re];if(g&&!(function(Rt,xt){for(let Pt=0;Pt<Rt.length;Pt++)if(xt.indexOf(Rt[Pt])>=0)return!0;return!1})(g,Te))return;const Re=this.sourceLayerCoder.decode(fe),st=this.vtLayers[Re].feature(K);if(h.needGeometry){const Rt=Rf(st,!0);if(!h.filter(new Z(this.tileID.overscaledZ),Rt,this.tileID.canonical))return}else if(!h.filter(new Z(this.tileID.overscaledZ),st))return;const _t=this.getId(st,Re);for(let Rt=0;Rt<Te.length;Rt++){const xt=Te[Rt];if(g&&g.indexOf(xt)<0)continue;const Pt=A[xt];if(!Pt)continue;let Vt={};_t!==void 0&&F&&(Vt=F.getState(Pt.sourceLayer||"_geojsonTileLayer",_t));const jt=Ve({},k[xt]);jt.paint=j4(jt.paint,Pt.paint,st,Vt,w),jt.layout=j4(jt.layout,Pt.layout,st,Vt,w);const wn=!z||z(st,Pt,Vt,we);if(!wn)continue;const vn=new T4(st,this.z,this.x,this.y,_t);vn.layer=jt;let On=r[xt];On===void 0&&(On=r[xt]=[]),On.push({featureIndex:K,feature:vn,intersectionZ:wn})}}lookupSymbolFeatures(r,u,h,g,w,A,k,F){const z={};this.loadVTLayers();const K=Si(w);for(const re of r)this.loadMatchingFeature(z,{bucketIndex:h,sourceLayerIndex:g,featureIndex:re,layoutVertexArrayOffset:0},K,A,k,F,u);return z}loadFeature(r){const{featureIndex:u,sourceLayerIndex:h}=r;this.loadVTLayers();const g=this.sourceLayerCoder.decode(h),w=this.vtFeatures[g];if(w[u])return w[u];const A=this.vtLayers[g].feature(u);return w[u]=A,A}hasLayer(r){for(const u of this.bucketLayerIDs)for(const h of u)if(r===h)return!0;return!1}getId(r,u){let h=r.id;if(this.promoteId){const g=typeof this.promoteId=="string"?this.promoteId:this.promoteId[u];g!=null&&(h=r.properties[g]),typeof h=="boolean"&&(h=Number(h))}return h}}function j4(o,r,u,h,g){return Ze(o,((w,A)=>{const k=r instanceof lt?r.get(A):null;return k&&k.evaluate?k.evaluate(u,h,g):k}))}function Y8(o,r){return r-o}Cr(z4,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class U4{constructor(r,u){this.width=r,this.height=u,this.nextRow=0,this.image=new mh({width:r,height:u}),this.positions={},this.uploaded=!1}getDash(r,u){const h=this.getKey(r,u);return this.positions[h]}trim(){const r=this.width,u=this.height=Oe(this.nextRow);this.image.resize({width:r,height:u})}getKey(r,u){return r.join(",")+u}getDashRanges(r,u,h){const g=[];let w=r.length%2==1?-r[r.length-1]*h:0,A=r[0]*h,k=!0;g.push({left:w,right:A,isDash:k,zeroLength:r[0]===0});let F=r[0];for(let z=1;z<r.length;z++){k=!k;const K=r[z];w=F*h,F+=K,A=F*h,g.push({left:w,right:A,isDash:k,zeroLength:K===0})}return g}addRoundDash(r,u,h){const g=u/2;for(let w=-h;w<=h;w++){const A=this.width*(this.nextRow+h+w);let k=0,F=r[k];for(let z=0;z<this.width;z++){z/F.right>1&&(F=r[++k]);const K=Math.abs(z-F.left),re=Math.abs(z-F.right),fe=Math.min(K,re);let we;const Te=w/h*(g+1);if(F.isDash){const Re=g-Math.abs(Te);we=Math.sqrt(fe*fe+Re*Re)}else we=g-Math.sqrt(fe*fe+Te*Te);this.image.data[A+z]=Math.max(0,Math.min(255,we+128))}}}addRegularDash(r,u){for(let F=r.length-1;F>=0;--F){const z=r[F],K=r[F+1];z.zeroLength?r.splice(F,1):K&&K.isDash===z.isDash&&(K.left=z.left,r.splice(F,1))}const h=r[0],g=r[r.length-1];h.isDash===g.isDash&&(h.left=g.left-this.width,g.right=h.right+this.width);const w=this.width*this.nextRow;let A=0,k=r[A];for(let F=0;F<this.width;F++){F/k.right>1&&(k=r[++A]);const z=Math.abs(F-k.left),K=Math.abs(F-k.right),re=Math.min(z,K);this.image.data[w+F]=Math.max(0,Math.min(255,(k.isDash?re:-re)+u+128))}}addDash(r,u){const h=this.getKey(r,u);if(this.positions[h])return this.positions[h];const g=u==="round",w=g?7:0,A=2*w+1;if(this.nextRow+A>this.height)return Ir("LineAtlas out of space"),null;r.length===0&&r.push(1);let k=0;for(let K=0;K<r.length;K++)r[K]<0&&(Ir("Negative value is found in line dasharray, replacing values with 0"),r[K]=0),k+=r[K];if(k!==0){const K=this.width/k,re=this.getDashRanges(r,this.width,K);g?this.addRoundDash(re,K,w):this.addRegularDash(re,u==="square"?.5*K:0)}const F=this.nextRow+w;this.nextRow+=A;const z={tl:[F,w],br:[k,0]};return this.positions[h]=z,z}}Cr(U4,"LineAtlas");const V4=1*ed;class q4{constructor(r){const u={},h=[];for(const k in r){const F=r[k],z=u[k]={};for(const K in F.glyphs){const re=F.glyphs[+K];if(!re||re.bitmap.width===0||re.bitmap.height===0)continue;const fe=re.metrics.localGlyph?V4:1,we={x:0,y:0,w:re.bitmap.width+2*fe,h:re.bitmap.height+2*fe};h.push(we),z[K]=we}}const{w:g,h:w}=hb(h),A=new mh({width:g||1,height:w||1});for(const k in r){const F=r[k];for(const z in F.glyphs){const K=F.glyphs[+z];if(!K||K.bitmap.width===0||K.bitmap.height===0)continue;const re=u[k][z],fe=K.metrics.localGlyph?V4:1;mh.copy(K.bitmap,A,{x:0,y:0},{x:re.x+fe,y:re.y+fe},K.bitmap)}}this.image=A,this.positions=u}}Cr(q4,"GlyphAtlas");class K8{constructor(r){this.tileID=new gh(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=Um(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,u,h,g,w){this.status="parsing",this.data=r,this.collisionBoxArray=new ks;const A=new E4(Object.keys(r.layers).sort()),k=new z4(this.tileID,this.promoteId);k.bucketLayerIDs=[];const F={},z=new U4(256,256),K={featureIndex:k,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:z,availableImages:h},re=u.familiesBySource[this.source];for(const Vt in re){const jt=r.layers[Vt];if(!jt)continue;let wn=!1,vn=!1;for(const kn of re[Vt])kn[0].type==="symbol"?wn=!0:vn=!0;if(this.isSymbolTile===!0&&!wn||this.isSymbolTile===!1&&!vn)continue;jt.version===1&&Ir(`Vector tile source "${this.source}" layer "${Vt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const On=A.encode(Vt),ar=[];for(let kn=0;kn<jt.length;kn++){const $n=jt.feature(kn),Hn=k.getId($n,Vt);ar.push({feature:$n,id:Hn,index:kn,sourceLayerIndex:On})}for(const kn of re[Vt]){const $n=kn[0];this.isSymbolTile!==void 0&&$n.type==="symbol"!==this.isSymbolTile||$n.minzoom&&this.zoom<Math.floor($n.minzoom)||$n.maxzoom&&this.zoom>=$n.maxzoom||$n.visibility!=="none"&&(Cb(kn,this.zoom,h),(F[$n.id]=$n.createBucket({index:k.bucketLayerIDs.length,layers:kn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:On,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:h})).populate(ar,K,this.tileID.canonical,this.tileTransform),k.bucketLayerIDs.push(kn.map((Hn=>Hn.id))))}}let fe,we,Te,Re;z.trim();const st={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},_t=()=>{if(fe)return w(fe);if(we&&Te&&Re){const Vt=new q4(we),jt=new K2(Te,Re);for(const wn in F){const vn=F[wn];vn instanceof Hp?(Cb(vn.layers,this.zoom,h),w8(vn,we,Vt.positions,Te,jt.iconPositions,this.showCollisionBoxes,h,this.tileID.canonical,this.tileZoom,this.projection)):vn.hasPattern&&(vn instanceof l1||vn instanceof C||vn instanceof y0)&&(Cb(vn.layers,this.zoom,h),vn.addFeatures(K,this.tileID.canonical,jt.patternPositions,h,this.tileTransform))}this.status="done",w(null,{buckets:We(F).filter((wn=>!wn.isEmpty())),featureIndex:k,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Vt.image,lineAtlas:z,imageAtlas:jt,glyphMap:this.returnDependencies?we:null,iconMap:this.returnDependencies?Te:null,glyphPositions:this.returnDependencies?Vt.positions:null})}},Rt=Ze(K.glyphDependencies,(Vt=>Object.keys(Vt).map(Number)));Object.keys(Rt).length?g.send("getGlyphs",{uid:this.uid,stacks:Rt},((Vt,jt)=>{fe||(fe=Vt,we=jt,_t())}),void 0,!1,st):we={};const xt=Object.keys(K.iconDependencies);xt.length?g.send("getImages",{icons:xt,source:this.source,tileID:this.tileID,type:"icons"},((Vt,jt)=>{fe||(fe=Vt,Te=jt,_t())}),void 0,!1,st):Te={};const Pt=Object.keys(K.patternDependencies);Pt.length?g.send("getImages",{icons:Pt,source:this.source,tileID:this.tileID,type:"patterns"},((Vt,jt)=>{fe||(fe=Vt,Re=jt,_t())}),void 0,!1,st):Re={},_t()}}function Cb(o,r,u){const h=new Z(r);for(const g of o)g.recalculate(h,u)}class G4{constructor(r){this.entries={},this.scheduler=r}request(r,u,h,g){const w=this.entries[r]=this.entries[r]||{callbacks:[]};if(w.result){const[A,k]=w.result;return this.scheduler?this.scheduler.add((()=>{g(A,k)}),u):g(A,k),()=>{}}return w.callbacks.push(g),w.cancel||(w.cancel=h(((A,k)=>{w.result=[A,k];for(const F of w.callbacks)this.scheduler?this.scheduler.add((()=>{F(A,k)}),u):F(A,k);setTimeout((()=>delete this.entries[r]),3e3)}))),()=>{w.result||(w.callbacks=w.callbacks.filter((A=>A!==g)),w.callbacks.length||(w.cancel(),delete this.entries[r]))}}}function $4(o,r,u){const h=JSON.stringify(o.request);return o.data&&(this.deduped.entries[h]={result:[null,o.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},(g=>{const w=wi(o.request,((A,k,F,z)=>{A?g(A):k&&g(null,{vectorTile:u?void 0:new Li(new h1(k)),rawData:k,cacheControl:F,expires:z})}));return()=>{w.cancel(),g()}}),r)}const H4=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class kb{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,h]=new Uint8Array(r,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=h>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const w=H4[15&h];if(!w)throw new Error("Unrecognized array type.");const[A]=new Uint16Array(r,2,1),[k]=new Uint32Array(r,4,1);return new kb(k,A,w,r)}constructor(r,u=64,h=Float64Array,g){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=h,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const w=H4.indexOf(this.ArrayType),A=2*r*this.ArrayType.BYTES_PER_ELEMENT,k=r*this.IndexArrayType.BYTES_PER_ELEMENT,F=(8-k%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${h}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+k+F,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+A+k+F),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+k+F,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=r)}add(r,u){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=r,this.coords[this._pos++]=u,h}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return Lb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,u,h,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:A,nodeSize:k}=this,F=[0,w.length-1,0],z=[];for(;F.length;){const K=F.pop()||0,re=F.pop()||0,fe=F.pop()||0;if(re-fe<=k){for(let st=fe;st<=re;st++){const _t=A[2*st],Rt=A[2*st+1];_t>=r&&_t<=h&&Rt>=u&&Rt<=g&&z.push(w[st])}continue}const we=fe+re>>1,Te=A[2*we],Re=A[2*we+1];Te>=r&&Te<=h&&Re>=u&&Re<=g&&z.push(w[we]),(K===0?r<=Te:u<=Re)&&(F.push(fe),F.push(we-1),F.push(1-K)),(K===0?h>=Te:g>=Re)&&(F.push(we+1),F.push(re),F.push(1-K))}return z}within(r,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:w,nodeSize:A}=this,k=[0,g.length-1,0],F=[],z=h*h;for(;k.length;){const K=k.pop()||0,re=k.pop()||0,fe=k.pop()||0;if(re-fe<=A){for(let st=fe;st<=re;st++)X4(w[2*st],w[2*st+1],r,u)<=z&&F.push(g[st]);continue}const we=fe+re>>1,Te=w[2*we],Re=w[2*we+1];X4(Te,Re,r,u)<=z&&F.push(g[we]),(K===0?r-h<=Te:u-h<=Re)&&(k.push(fe),k.push(we-1),k.push(1-K)),(K===0?r+h>=Te:u+h>=Re)&&(k.push(we+1),k.push(re),k.push(1-K))}return F}}function Lb(o,r,u,h,g,w){if(g-h<=u)return;const A=h+g>>1;W4(o,r,A,h,g,w),Lb(o,r,u,h,A-1,1-w),Lb(o,r,u,A+1,g,1-w)}function W4(o,r,u,h,g,w){for(;g>h;){if(g-h>600){const z=g-h+1,K=u-h+1,re=Math.log(z),fe=.5*Math.exp(2*re/3),we=.5*Math.sqrt(re*fe*(z-fe)/z)*(K-z/2<0?-1:1);W4(o,r,u,Math.max(h,Math.floor(u-K*fe/z+we)),Math.min(g,Math.floor(u+(z-K)*fe/z+we)),w)}const A=r[2*u+w];let k=h,F=g;for(L0(o,r,h,u),r[2*g+w]>A&&L0(o,r,h,g);k<F;){for(L0(o,r,k,F),k++,F--;r[2*k+w]<A;)k++;for(;r[2*F+w]>A;)F--}r[2*h+w]===A?L0(o,r,h,F):(F++,L0(o,r,F,g)),F<=u&&(h=F+1),u<=F&&(g=F-1)}}function L0(o,r,u,h){Pb(o,u,h),Pb(r,2*u,2*h),Pb(r,2*u+1,2*h+1)}function Pb(o,r,u){const h=o[r];o[r]=o[u],o[u]=h}function X4(o,r,u,h){const g=o-u,w=r-h;return g*g+w*w}s.ARRAY_TYPE=Ju,s.AUTH_ERR_MSG=wt,s.Aabb=Hr,s.Actor=class{constructor(o,r,u){this.target=o,this.parent=r,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Zt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=$t()?o:T,this.scheduler=new q8}send(o,r,u,h,g=!1,w){const A=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=w,this.callbacks[A]=u);const k=ni(this.globalScope)?void 0:[];return this.target.postMessage({id:A,type:o,hasCallback:!!u,targetMapId:h,mustQueue:g,sourceMapId:this.mapId,data:H(r,k)},k),{cancel:()=>{u&&delete this.callbacks[A],this.target.postMessage({id:A,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(o){const r=o.data,u=r.id;if(u&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h.cancel()}else if(r.mustQueue||$t()){const h=this.callbacks[u];this.cancelCallbacks[u]=this.scheduler.add((()=>this.processTask(u,r)),h&&h.metadata||{type:"message"})}else this.processTask(u,r)}processTask(o,r){if(r.type==="<response>"){const u=this.callbacks[o];delete this.callbacks[o],u&&(r.error?u(ue(r.error)):u(null,ue(r.data)))}else{const u=ni(this.globalScope)?void 0:[],h=r.hasCallback?(w,A)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:w?H(w):null,data:H(A,u)},u)}:w=>{},g=ue(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,g,h);else if(this.parent.getWorkerSource){const w=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,w[0],g.source)[w[1]](g,h)}else h(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=a1,s.Color=Vs,s.ColorMode=Id,s.CullFaceMode=td,s.DEMData=E1,s.DataConstantProperty=Ie,s.DedupedRequest=G4,s.DepthMode=Jg,s.EXTENT=pi,s.Elevation=class{isDataAvailableAtPoint(o){const r=this._source();if(this.isUsingMockSource()||!r||o.y<0||o.y>1)return!1;const u=r.getSource().maxzoom,h=1<<u,g=Math.floor(o.x),w=Math.floor((o.x-g)*h),A=Math.floor(o.y*h),k=this.findDEMTileFor(new gh(u,g,u,w,A));return!(!k||!k.dem)}getAtPointOrZero(o,r=0){return this.getAtPoint(o,r)||0}getAtPoint(o,r,u=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const h=this._source();if(!h||o.y<0||o.y>1)return r;const g=h.getSource().maxzoom,w=1<<g,A=Math.floor(o.x),k=o.x-A,F=new gh(g,A,g,Math.floor(k*w),Math.floor(o.y*w)),z=this.findDEMTileFor(F);if(!z||!z.dem)return r;const K=z.dem,re=1<<z.tileID.canonical.z,fe=(k*re-z.tileID.canonical.x)*K.dim,we=(o.y*re-z.tileID.canonical.y)*K.dim,Te=Math.floor(fe),Re=Math.floor(we);return(u?this.exaggeration():1)*nt(nt(K.get(Te,Re),K.get(Te,Re+1),we-Re),nt(K.get(Te+1,Re),K.get(Te+1,Re+1),we-Re),fe-Te)}getAtTileOffset(o,r,u){const h=1<<o.canonical.z;return this.getAtPointOrZero(new Nf(o.wrap+(o.canonical.x+r/pi)/h,(o.canonical.y+u/pi)/h))}getAtTileOffsetFunc(o,r,u,h){return g=>{const w=this.getAtTileOffset(o,g.x,g.y),A=h.upVector(o.canonical,g.x,g.y);return Me(A,A,w*h.upVectorScale(o.canonical,r,u).metersToTile),A}}getForTilePoints(o,r,u,h){if(this.isUsingMockSource())return!1;const g=T1.create(this,o,h);return!!g&&(r.forEach((w=>{w[2]=this.exaggeration()*g.getElevationAt(w[0],w[1],u)})),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(o);if(!r||!r.dem)return null;const u=r.dem.tree,h=r.tileID,g=1<<o.canonical.z-h.canonical.z;let w=o.canonical.x/g-h.canonical.x,A=o.canonical.y/g-h.canonical.y,k=0;for(let F=0;F<o.canonical.z-h.canonical.z&&!u.leaves[k];F++){w*=2,A*=2;const z=2*Math.floor(A)+Math.floor(w);k=u.childOffsets[k]+z,w%=1,A%=1}return{min:this.exaggeration()*u.minimums[k],max:this.exaggeration()*u.maximums[k]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,r,u){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=Wo,s.EvaluationParameters=Z,s.Event=ea,s.Evented=ta,s.FillExtrusionBucket=y0,s.Frustum=li,s.FrustumCorners=ds,s.GLOBE_RADIUS=_n,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=Yn,s.GLOBE_ZOOM_THRESHOLD_MIN=qi,s.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const o of this._wireframeSegments)o.destroy()}}_fillGridMeshWithLods(o,r){const u=new Rn,h=new Vr,g=[],w=o+1+2,A=r[0]+1,k=r[0]+1+(1+r.length),F=(z,K,re)=>{let fe=z===w-1?z-2:z===0?z:z-1;return fe+=re?24575:0,[fe,K]};for(let z=0;z<w;++z)u.emplaceBack(...F(z,0,!0));for(let z=0;z<A;++z)for(let K=0;K<w;++K)u.emplaceBack(...F(K,z,(K===0||K===w-1)&&!0));for(let z=0;z<r.length;++z){const K=r[z];for(let re=0;re<w;++re)u.emplaceBack(...F(re,K,!0))}for(let z=0;z<r.length;++z){const K=h.length,re=r[z]+1+2,fe=new Vr;for(let Re=0;Re<re-1;Re++){const st=Re===re-2,_t=st?w*(k-r.length+z-Re):w;for(let Rt=0;Rt<w-1;Rt++){const xt=Re*w+Rt;Re===0||st||Rt===0||Rt===w-2?(fe.emplaceBack(xt+1,xt,xt+_t),fe.emplaceBack(xt+_t,xt+_t+1,xt+1)):(h.emplaceBack(xt+1,xt,xt+_t),h.emplaceBack(xt+_t,xt+_t+1,xt+1))}}const we=xl.simpleSegment(0,K,u.length,h.length-K);for(let Re=0;Re<fe.uint16.length;Re+=3)h.emplaceBack(fe.uint16[Re],fe.uint16[Re+1],fe.uint16[Re+2]);const Te=xl.simpleSegment(0,K,u.length,h.length-K);g.push({withoutSkirts:we,withSkirts:Te})}return{vertices:u,indices:h,segments:g}}_createGrid(o){const r=this._fillGridMeshWithLods(ur,yr);this._gridSegments=r.segments,this._gridBuffer=o.createVertexBuffer(r.vertices,Jr.members),this._gridIndexBuffer=o.createIndexBuffer(r.indices,!0)}_createPoles(o){const r=new Vr;for(let g=0;g<=ur;g++)r.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=o.createIndexBuffer(r,!0);const u=new Gs,h=new Gs;this._poleSegments=[];for(let g=0,w=0;g<qi;g++){const A=360/(1<<g);u.emplaceBack(0,-_n,0,.5,0),h.emplaceBack(0,-_n,0,.5,1);for(let k=0;k<=ur;k++){const F=k/ur,z=nt(0,A,F),[K,re,fe]=_o(Fh,bu,z,_n);u.emplaceBack(K,re,fe,F,0),h.emplaceBack(K,re,fe,F,1)}this._poleSegments.push(xl.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(u,ci,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(h,ci,!1)}getGridBuffers(o,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o,r){if(!this._wireframeSegments){const u=new $o,h=ur,g=h+1+2,w=1;this._wireframeSegments=[];for(let A=0,k=0;A<yr.length;A++){const F=yr[A];for(let K=w;K<F+w;K++)for(let re=w;re<h+w;re++){const fe=K*g+re;u.emplaceBack(fe,fe+1),u.emplaceBack(fe,fe+g),u.emplaceBack(fe,fe+g+1)}const z=F*h*3;this._wireframeSegments.push(xl.simpleSegment(0,k,(F+1)*g,z)),k+=z}this._wireframeIndexBuffer=o.createIndexBuffer(u)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},s.GlyphManager=Wg,s.ImagePosition=fb,s.KDBush=kb,s.LivePerformanceUtils=tl,s.LngLat=hi,s.LngLatBounds=Kh,s.LocalGlyphMode=mb,s.MAX_MERCATOR_LATITUDE=Sl,s.MercatorCoordinate=Nf,s.ONE_EM=Cc,s.OverscaledTileID=gh,s.PerformanceMarkers=ua,s.Point=Y,s.Properties=yt,s.RGBAImage=nh,s.Ray=ai,s.RequestManager=class{constructor(o,r,u){this._transformRequestFn=o,this._customAccessToken=r,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const o=(function(){let r="";for(let u=0;u<10;u++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ve,r].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,r){return this._transformRequestFn&&this._transformRequestFn(o,r)||{url:o}}normalizeStyleURL(o,r){if(!Ut(o))return o;const u=Jn(o);return u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeGlyphsURL(o,r){if(!Ut(o))return o;const u=Jn(o);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeSourceURL(o,r,u,h){if(!Ut(o))return o;const g=Jn(o);return g.path=`/v4/${g.authority}.json`,g.params.push("secure"),u&&g.params.push(`language=${u}`),h&&g.params.push(`worldview=${h}`),this._makeAPIURL(g,this._customAccessToken||r)}normalizeSpriteURL(o,r,u,h){const g=Jn(o);return Ut(o)?(g.path=`/styles/v1${g.path}/sprite${r}${u}`,this._makeAPIURL(g,this._customAccessToken||h)):(g.path+=`${r}${u}`,Fn(g))}normalizeTileURL(o,r,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Ut(o))return o;const h=Jn(o);h.path=h.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||u&&h.authority!=="raster"&&u===512?"@2x":""}${M.supported?".webp":"$1"}`),h.authority==="raster"?h.path=`/${U.RASTER_URL_PREFIX}${h.path}`:(h.path=h.path.replace(/^.+\/v4\//,"/"),h.path=`/${U.TILE_URL_VERSION}${h.path}`);const g=this._customAccessToken||(function(w){for(const A of w){const k=A.match(/^access_token=(.*)$/);if(k)return k[1]}return null})(h.params)||U.ACCESS_TOKEN;return U.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&h.params.push(`sku=${this._skuToken}`),this._makeAPIURL(h,g)}canonicalizeTileURL(o,r){const u=Jn(o);if(!u.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!u.path.match(/\.[\w]+$/))return o;let h="mapbox://";u.path.match(/^\/raster\/v1\//)?h+=`raster/${u.path.replace(`/${U.RASTER_URL_PREFIX}/`,"")}`:h+=`tiles/${u.path.replace(`/${U.TILE_URL_VERSION}/`,"")}`;let g=u.params;return r&&(g=g.filter((w=>!w.match(/^access_token=/)))),g.length&&(h+=`?${g.join("&")}`),h}canonicalizeTileset(o,r){const u=!!r&&Ut(r),h=[];for(const g of o.tiles||[])Gt(g)?h.push(this.canonicalizeTileURL(g,u)):h.push(g);return h}_makeAPIURL(o,r){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",h=Jn(U.API_URL);if(o.protocol=h.protocol,o.authority=h.authority,o.protocol==="http"){const g=o.params.indexOf("secure");g>=0&&o.params.splice(g,1)}if(h.path!=="/"&&(o.path=`${h.path}${o.path}`),!U.REQUIRE_ACCESS_TOKEN)return Fn(o);if(r=r||U.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return o.params=o.params.filter((g=>g.indexOf("access_token")===-1)),o.params.push(`access_token=${r||""}`),Fn(o)}},s.ResourceType=wr,s.SegmentVector=xl,s.SourceCache=Vm,s.StencilMode=Tb,s.StructArrayLayout1ui2=Bu,s.StructArrayLayout2f1f2i16=gr,s.StructArrayLayout2i4=Rn,s.StructArrayLayout2ui4=$o,s.StructArrayLayout3f12=Mi,s.StructArrayLayout3ui6=Vr,s.StructArrayLayout4i8=An,s.StructArrayLayout5f20=Gs,s.Texture=C0,s.Tile=Sb,s.Transitionable=Ee,s.Uniform1f=Nh,s.Uniform1i=class extends Kc{constructor(o){super(o),this.current=0}set(o,r,u){this.fetchUniformLocation(o,r)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},s.Uniform2f=class extends Kc{constructor(o){super(o),this.current=[0,0]}set(o,r,u){this.fetchUniformLocation(o,r)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}},s.Uniform3f=class extends Kc{constructor(o){super(o),this.current=[0,0,0]}set(o,r,u){this.fetchUniformLocation(o,r)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}},s.Uniform4f=dh,s.UniformColor=Wf,s.UniformMatrix2f=class extends Kc{constructor(o){super(o),this.current=Xf}set(o,r,u){if(this.fetchUniformLocation(o,r)){for(let h=0;h<4;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}},s.UniformMatrix3f=class extends Kc{constructor(o){super(o),this.current=Yh}set(o,r,u){if(this.fetchUniformLocation(o,r)){for(let h=0;h<9;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix3fv(this.location,!1,u);break}}}},s.UniformMatrix4f=class extends Kc{constructor(o){super(o),this.current=Xh}set(o,r,u){if(this.fetchUniformLocation(o,r)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}},s.UnwrappedTileID=D2,s.ValidationError=jn,s.VectorTileFeature=ns,s.VectorTileWorkerSource=class extends ta{constructor(o,r,u,h,g){super(),this.actor=o,this.layerIndex=r,this.availableImages=u,this.loadVectorData=g||$4,this.loading={},this.loaded={},this.deduped=new G4(o.scheduler),this.isSpriteLoaded=h,this.scheduler=o.scheduler}loadTile(o,r){const u=o.uid,h=o&&o.request,g=h&&h.collectResourceTiming,w=this.loading[u]=new K8(o);w.abort=this.loadVectorData(o,((A,k)=>{const F=!this.loading[u];if(delete this.loading[u],F||A||!k)return w.status="done",F||(this.loaded[u]=w),r(A);const z=k.rawData,K={};k.expires&&(K.expires=k.expires),k.cacheControl&&(K.cacheControl=k.cacheControl),w.vectorTile=k.vectorTile||new Li(new h1(z));const re=()=>{w.parse(w.vectorTile,this.layerIndex,this.availableImages,this.actor,((fe,we)=>{if(fe||!we)return r(fe);const Te={};if(g){const Re=ou(h);Re.length>0&&(Te.resourceTiming=JSON.parse(JSON.stringify(Re)))}r(null,Ve({rawTileData:z.slice(0)},we,K,Te))}))};this.isSpriteLoaded?re():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(re,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):re()})),this.loaded=this.loaded||{},this.loaded[u]=w}))}reloadTile(o,r){const u=this.loaded,h=o.uid,g=this;if(u&&u[h]){const w=u[h];w.showCollisionBoxes=o.showCollisionBoxes,w.enableTerrain=!!o.enableTerrain,w.projection=o.projection,w.tileTransform=Um(o.tileID.canonical,o.projection);const A=(k,F)=>{const z=w.reloadCallback;z&&(delete w.reloadCallback,w.parse(w.vectorTile,g.layerIndex,this.availableImages,g.actor,z)),r(k,F)};w.status==="parsing"?w.reloadCallback=A:w.status==="done"&&(w.vectorTile?w.parse(w.vectorTile,this.layerIndex,this.availableImages,this.actor,A):A())}}abortTile(o,r){const u=o.uid,h=this.loading[u];h&&(h.abort&&h.abort(),delete this.loading[u]),r()}removeTile(o,r){const u=this.loaded,h=o.uid;u&&u[h]&&delete u[h],r()}},s.WritingMode=yf,s.ZoomDependentExpression=vc,s.add=Oh,s.addDynamicAttributes=b1,s.adjoint=function(o,r){var u=r[0],h=r[1],g=r[2],w=r[3],A=r[4],k=r[5],F=r[6],z=r[7],K=r[8];return o[0]=A*K-k*z,o[1]=g*z-h*K,o[2]=h*k-g*A,o[3]=k*F-w*K,o[4]=u*K-g*F,o[5]=g*w-u*k,o[6]=w*z-A*F,o[7]=h*F-u*z,o[8]=u*A-h*w,o},s.asyncAll=ge,s.bezier=Ue,s.bindAll=Zt,s.boundsAttributes=I4,s.bufferConvexPolygon=function(o,r){const u=[];for(let h=0;h<o.length;h++){const g=Ce(h-1,-1,o.length-1),w=Ce(h+1,-1,o.length-1),A=o[h],k=o[w],F=o[g].sub(A).unit(),z=k.sub(A).unit(),K=z.angleWithSep(F.x,F.y),re=F.add(z).unit().mult(-1*r/Math.sin(K/2));u.push(A.add(re))}return u},s.cacheEntryPossiblyAdded=function(o){bi++,bi>$r&&(o.getActor().send("enforceCacheSizeLimit",Zn),bi=0)},s.calculateGlobeLabelMatrix=function(o,r){const{x:u,y:h}=o.point,g=Oc(u,h,o.worldSize/o._pixelsPerMercatorPixel,0,0);return Dh(g,g,Kf(Do(r)))},s.calculateGlobeMatrix=function(o){const{x:r,y:u}=o.point,{lng:h,lat:g}=o._center;return Oc(r,u,o.worldSize,h,g)},s.calculateGlobeMercatorMatrix=function(o){const r=o.pixelsPerMeter,u=r/Nl(1,o.center.lat),h=ph(new Float64Array(16));return Ec(h,h,[o.point.x,o.point.y,0]),Tc(h,h,[u,u,r]),Float32Array.from(h)},s.circumferenceAtLatitude=Pl,s.clamp=He,s.clearTileCache=function(o){if(!ir())return;const r=T.caches.delete(sr);o&&r.catch(o).then((()=>o()))},s.clipLine=u4,s.clone=function(o){var r=new Ju(16);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=o[3],r[4]=o[4],r[5]=o[5],r[6]=o[6],r[7]=o[7],r[8]=o[8],r[9]=o[9],r[10]=o[10],r[11]=o[11],r[12]=o[12],r[13]=o[13],r[14]=o[14],r[15]=o[15],r},s.clone$1=on,s.collisionCircleLayout=XL,s.config=U,s.conjugate=function(o,r){return o[0]=-r[0],o[1]=-r[1],o[2]=-r[2],o[3]=r[3],o},s.create=function(){var o=new Ju(16);return Ju!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},s.create$1=Im,s.createExpression=Is,s.createLayout=Bt,s.createStyleLayer=function(o){return o.type==="custom"?new z8(o):new U8[o.type](o)},s.cross=ot,s.degToRad=te,s.distance=function(o,r){return Math.hypot(r[0]-o[0],r[1]-o[1],r[2]-o[2])},s.div=function(o,r,u){return o[0]=r[0]/u[0],o[1]=r[1]/u[1],o[2]=r[2]/u[2],o},s.dot=Xe,s.earthRadius=Ac,s.ease=Le,s.easeCubicInOut=$e,s.ecefToLatLng=function([o,r,u]){const h=Math.hypot(o,r,u),g=Math.atan2(o,u),w=.5*Math.PI-Math.acos(-r/h);return new hi(Se(g),Se(w))},s.emitValidationErrors=vl,s.endsWith=Xt,s.enforceCacheSizeLimit=function(o){Xn(),qn&&qn.then((r=>{r.keys().then((u=>{for(let h=0;h<u.length-o;h++)r.delete(u[h])}))}))},s.evaluateSizeForFeature=u1,s.evaluateSizeForZoom=qg,s.evaluateVariableOffset=p4,s.evented=I,s.exactEquals=function(o,r){return o[0]===r[0]&&o[1]===r[1]&&o[2]===r[2]&&o[3]===r[3]},s.exactEquals$1=function(o,r){return o[0]===r[0]&&o[1]===r[1]&&o[2]===r[2]},s.exported=uo,s.exported$1=M,s.extend=Ve,s.extend$1=co,s.fillExtrusionHeightLift=N2,s.filterObject=zn,s.fromMat4=function(o,r){return o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[4],o[4]=r[5],o[5]=r[6],o[6]=r[8],o[7]=r[9],o[8]=r[10],o},s.fromQuat=function(o,r){var u=r[0],h=r[1],g=r[2],w=r[3],A=u+u,k=h+h,F=g+g,z=u*A,K=h*A,re=h*k,fe=g*A,we=g*k,Te=g*F,Re=w*A,st=w*k,_t=w*F;return o[0]=1-re-Te,o[1]=K+_t,o[2]=fe-st,o[3]=0,o[4]=K-_t,o[5]=1-z-Te,o[6]=we+Re,o[7]=0,o[8]=fe+st,o[9]=we-Re,o[10]=1-z-re,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},s.fromRotation=function(o,r){var u=Math.sin(r),h=Math.cos(r);return o[0]=h,o[1]=u,o[2]=0,o[3]=-u,o[4]=h,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},s.fromScaling=Fp,s.furthestTileCorner=function(o){const r=Math.round((o+45+360)%360/90)%4;return De[r]},s.getAABBPointSquareDist=function(o,r,u){let h=0;for(let g=0;g<2;++g){const w=u?u[g]:0;o[g]>w&&(h+=(o[g]-w)*(o[g]-w)),r[g]<w&&(h+=(w-r[g])*(w-r[g]))}return h},s.getAnchorAlignment=pb,s.getAnchorJustification=yb,s.getBounds=function(o){let r=1/0,u=1/0,h=-1/0,g=-1/0;for(const w of o)r=Math.min(r,w.x),u=Math.min(u,w.y),h=Math.max(h,w.x),g=Math.max(g,w.y);return{min:new Y(r,u),max:new Y(h,g)}},s.getColumn=yn,s.getDefaultExportFromCjs=de,s.getGridMatrix=function(o,r,u,h){const g=r.getNorth(),w=r.getSouth(),A=r.getWest(),k=r.getEast(),F=1<<o.z,z=k-A,K=g-w,re=z/ur,fe=-K/yr[u],we=[0,re,0,fe,0,0,g,A,0];if(o.z>0){const Te=180/h;Lg(we,we,[Te/z+1,0,0,0,Te/K+1,0,-.5*Te/re,.5*Te/fe,1])}return we[2]=F,we[5]=o.x,we[8]=o.y,we},s.getImage=ft,s.getJSON=function(o,r){return Kr(Ve(o,{type:"json"}),r)},s.getLatitudinalLod=function(o){const r=Sl-5;o=He(o,-r,r)/r*90;const u=Math.pow(Math.abs(Math.sin(te(o))),3);return Math.round(u*(yr.length-1))},s.getMapSessionAPI=is,s.getPerformanceMeasurement=ou,s.getProjection=w4,s.getRTLTextPluginStatus=P,s.getReferrer=ui,s.getTilePoint=function(o,{x:r,y:u},h=0){return new Y(((r-h)*o.scale-o.x)*pi,(u*o.scale-o.y)*pi)},s.getTileVec3=function(o,r,u=0){return Pf(((r.x-u)*o.scale-o.x)*pi,(r.y*o.scale-o.y)*pi,Zf(r.z,r.y))},s.getVideo=function(o,r){const u=T.document.createElement("video");u.muted=!0,u.onloadstart=function(){r(null,u)};for(let h=0;h<o.length;h++){const g=T.document.createElement("source");si(o[h])||(u.crossOrigin="Anonymous"),g.src=o[h],u.appendChild(g)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(o){const r=[0,0,0],u=ph(new Float64Array(16));return Dh(u,o.pixelMatrix,o.globeMatrix),Lt(r,r,u),new Y(r[0],r[1])},s.globeDenormalizeECEF=Kf,s.globeECEFOrigin=function(o,r){const u=[0,0,0];return Lt(u,u,Uu(Do(r.canonical))),Lt(u,u,o),u},s.globeMetersToEcef=ls,s.globeNormalizeECEF=Uu,s.globePixelsToTileUnits=function(o,r){return pi/(512*Math.pow(2,o))*Qh(Do(r))},s.globePoleMatrixForTile=function(o,r,u){const h=ph(new Float64Array(16)),g=(r/(1<<o)-.5)*Math.PI*2;return ip(h,u.globeMatrix,g),Float32Array.from(h)},s.globeTileBounds=Do,s.globeTiltAtLngLat=Di,s.globeToMercatorTransition=eh,s.globeUseCustomAntiAliasing=function(o,r,u){const h=eh(u.zoom),g=o.style.map._antialias,w=!!r.extStandardDerivatives,A=r.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return h===0&&!g&&!A&&w},s.identity=ph,s.identity$1=ti,s.invert=ju,s.isFullscreen=function(){return!!T.document.fullscreenElement||!!T.document.webkitFullscreenElement},s.isLngLatBehindGlobe=Ko,s.isMapAuthenticated=function(o){return xo.has(o)},s.isMapboxURL=Ut,s.isSafariWithAntialiasingBug=function(o){const r=o.navigator?o.navigator.userAgent:null;return!!ni(o)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=Ao,s.latLngToECEF=nu,s.len=Gn,s.length=Zh,s.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},s.lngFromMercatorX=Hl,s.loadVectorTile=$4,s.makeRequest=Kr,s.mapValue=function(o,r,u,h,g){return He((o-r)/(u-r)*(g-h)+h,h,g)},s.mercatorScale=op,s.mercatorXfromLng=Zo,s.mercatorYfromLat=Qa,s.mercatorZfromAltitude=Nl,s.mul=Cm,s.mul$1=xn,s.multiply=Dh,s.multiply$1=Lg,s.multiply$2=km,s.nextPowerOfTwo=Oe,s.normalize=ct,s.normalize$1=_i,s.normalize$2=ln,s.number=nt,s.ortho=function(o,r,u,h,g,w,A){var k=1/(r-u),F=1/(h-g),z=1/(w-A);return o[0]=-2*k,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*F,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*z,o[11]=0,o[12]=(r+u)*k,o[13]=(g+h)*F,o[14]=(A+w)*z,o[15]=1,o},s.pbf=V2,s.perspective=function(o,r,u,h,g){var w,A=1/Math.tan(r/2);return o[0]=A/u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=A,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,g!=null&&g!==1/0?(o[10]=(g+h)*(w=1/(h-g)),o[14]=2*g*h*w):(o[10]=-1,o[14]=-2*h),o},s.pick=function(o,r){const u={};for(let h=0;h<r.length;h++){const g=r[h];g in o&&(u[g]=o[g])}return u},s.plugin=W,s.pointGeometry=G,s.polesInViewport=function(o){const r=ph(new Float64Array(16));Dh(r,o.pixelMatrix,o.globeMatrix);const u=[0,vi,0],h=[0,er,0];return Lt(u,u,r),Lt(h,h,r),[u[0]>0&&u[0]<=o.width&&u[1]>0&&u[1]<=o.height&&!Ko(o,new hi(o.center.lat,90)),h[0]>0&&h[0]<=o.width&&h[1]>0&&h[1]<=o.height&&!Ko(o,new hi(o.center.lat,-90))]},s.polygonContainsPoint=Jf,s.polygonIntersectsBox=t1,s.polygonIntersectsPolygon=Ng,s.polygonizeBounds=function(o,r,u=0,h=!0){const g=new Y(u,u),w=o.sub(g),A=r.add(g),k=[w,new Y(A.x,w.y),A,new Y(w.x,A.y)];return h&&k.push(w.clone()),k},s.posAttributes=Jr,s.postMapLoadEvent=Os,s.postPerformanceEvent=ps,s.postTurnstileEvent=zi,s.potpack=hb,s.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},s.radToDeg=Se,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(o){return o({pluginStatus:x,pluginURL:l}),I.on("pluginStateChange",o),o},s.removeAuthState=function(o){xo.delete(o)},s.renderColorRamp=c0,s.resample=Ic,s.rotateX=vd,s.rotateX$1=cr,s.rotateY=ip,s.rotateY$1=Lr,s.rotateZ=function(o,r,u){var h=Math.sin(u),g=Math.cos(u),w=r[0],A=r[1],k=r[2],F=r[3],z=r[4],K=r[5],re=r[6],fe=r[7];return r!==o&&(o[8]=r[8],o[9]=r[9],o[10]=r[10],o[11]=r[11],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=w*g+z*h,o[1]=A*g+K*h,o[2]=k*g+re*h,o[3]=F*g+fe*h,o[4]=z*g-w*h,o[5]=K*g-A*h,o[6]=re*g-k*h,o[7]=fe*g-F*h,o},s.rotateZ$1=function(o,r,u){u*=.5;var h=r[0],g=r[1],w=r[2],A=r[3],k=Math.sin(u),F=Math.cos(u);return o[0]=h*F+g*k,o[1]=g*F-h*k,o[2]=w*F+A*k,o[3]=A*F-w*k,o},s.scale=Tc,s.scale$1=dn,s.scale$2=Me,s.scaleAndAdd=Qe,s.set=function(o,r,u,h){return o[0]=r,o[1]=u,o[2]=h,o},s.setCacheLimits=function(o,r){Zn=o,$r=r},s.setColumn=function(o,r,u){o[4*r+0]=u[0],o[4*r+1]=u[1],o[4*r+2]=u[2],o[4*r+3]=u[3]},s.setRTLTextPlugin=function(o,r,u=!1){if(x===Et||x===Qt||x===gn)throw new Error("setRTLTextPlugin cannot be called multiple times.");l=uo.resolveURL(o),x=Et,Bn=r,b(),u||j()},s.smoothstep=Ke,s.spec=En,s.squaredLength=function(o){var r=o[0],u=o[1],h=o[2];return r*r+u*u+h*h},s.storeAuthState=function(o,r){r?xo.add(o):xo.delete(o)},s.sub=en,s.subtract=Bp,s.symbolSize=YL,s.tileAABB=function(o,r,u,h,g,w,A,k,F){if(F.name==="globe")return Dc(o,r,new a1(u,h,g));const z=Um({z:u,x:h,y:g},F);return new Hr([(w+z.x/z.scale)*r,r*(z.y/z.scale),A],[(w+z.x2/z.scale)*r,r*(z.y2/z.scale),k])},s.tileCornersToBounds=Qc,s.tileTransform=Um,s.transformMat3=function(o,r,u){var h=r[0],g=r[1],w=r[2];return o[0]=h*u[0]+g*u[3]+w*u[6],o[1]=h*u[1]+g*u[4]+w*u[7],o[2]=h*u[2]+g*u[5]+w*u[8],o},s.transformMat4=Lt,s.transformMat4$1=Tn,s.transformQuat=Ht,s.transitionTileAABBinECEF=To,s.translate=Ec,s.transpose=function(o,r){if(o===r){var u=r[1],h=r[2],g=r[5];o[1]=r[3],o[2]=r[6],o[3]=u,o[5]=r[7],o[6]=h,o[7]=g}else o[0]=r[0],o[1]=r[3],o[2]=r[6],o[3]=r[1],o[4]=r[4],o[5]=r[7],o[6]=r[2],o[7]=r[5],o[8]=r[8];return o},s.triggerPluginCompletionEvent=m,s.uniqueId=pt,s.updateGlobeVertexNormal=function(o,r,u,h,g){const w=5*r+2;o.float32[w+0]=u,o.float32[w+1]=h,o.float32[w+2]=g},s.validateCustomStyleLayer=function(o){const r=[],u=o.id;return u===void 0&&r.push({message:`layers.${u}: missing required property "id"`}),o.render===void 0&&r.push({message:`layers.${u}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&r.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),r},s.validateFilter=o=>_l(Cl(o)),s.validateFog=o=>_l(Du(o)),s.validateLayer=o=>_l(_d(o)),s.validateLight=o=>_l(Ph(o)),s.validateSource=o=>_l(Xu(o)),s.validateStyle=ql,s.validateTerrain=o=>_l(kl(o)),s.values=We,s.vectorTile=Nn,s.version=L,s.warnOnce=Ir,s.window=T,s.wrap=Ce})),_(["./shared"],(function(s){function T(vt){if(typeof vt=="number"||typeof vt=="boolean"||typeof vt=="string"||vt==null)return JSON.stringify(vt);if(Array.isArray(vt)){let ze="[";for(const ft of vt)ze+=`${T(ft)},`;return`${ze}]`}let Ne="{";for(const ze of Object.keys(vt).sort())Ne+=`${ze}:${T(vt[ze])},`;return`${Ne}}`}function L(vt){let Ne="";for(const ze of s.refProperties)Ne+=`/${T(vt[ze])}`;return Ne}class R{constructor(Ne){this.keyCache={},Ne&&this.replace(Ne)}replace(Ne){this._layerConfigs={},this._layers={},this.update(Ne,[])}update(Ne,ze){for(const wt of Ne)this._layerConfigs[wt.id]=wt,(this._layers[wt.id]=s.createStyleLayer(wt)).compileFilter(),this.keyCache[wt.id]&&delete this.keyCache[wt.id];for(const wt of ze)delete this.keyCache[wt],delete this._layerConfigs[wt],delete this._layers[wt];this.familiesBySource={};const ft=(function(wt,Ut){const Gt={};for(let Ot=0;Ot<wt.length;Ot++){const zt=Ut&&Ut[wt[Ot].id]||L(wt[Ot]);Ut&&(Ut[wt[Ot].id]=zt);let Pn=Gt[zt];Pn||(Pn=Gt[zt]=[]),Pn.push(wt[Ot])}const Tt=[];for(const Ot in Gt)Tt.push(Gt[Ot]);return Tt})(s.values(this._layerConfigs),this.keyCache);for(const wt of ft){const Ut=wt.map((Jn=>this._layers[Jn.id])),Gt=Ut[0];if(Gt.visibility==="none")continue;const Tt=Gt.source||"";let Ot=this.familiesBySource[Tt];Ot||(Ot=this.familiesBySource[Tt]={});const zt=Gt.sourceLayer||"_geojsonTileLayer";let Pn=Ot[zt];Pn||(Pn=Ot[zt]=[]),Pn.push(Ut)}}}class U{loadTile(Ne,ze){const{uid:ft,encoding:wt,rawImageData:Ut,padding:Gt,buildQuadTree:Tt}=Ne,Ot=s.window.ImageBitmap&&Ut instanceof s.window.ImageBitmap?this.getImageData(Ut,Gt):Ut;ze(null,new s.DEMData(ft,Ot,wt,Gt<1,Tt))}getImageData(Ne,ze){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Ne.width,Ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Ne.width,this.offscreenCanvas.height=Ne.height,this.offscreenCanvasContext.drawImage(Ne,0,0,Ne.width,Ne.height);const ft=this.offscreenCanvasContext.getImageData(-ze,-ze,Ne.width+2*ze,Ne.height+2*ze);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ft}}function M(vt,Ne){if(vt.length!==0){Q(vt[0],Ne);for(var ze=1;ze<vt.length;ze++)Q(vt[ze],!Ne)}}function Q(vt,Ne){for(var ze=0,ft=0,wt=0,Ut=vt.length,Gt=Ut-1;wt<Ut;Gt=wt++){var Tt=(vt[wt][0]-vt[Gt][0])*(vt[Gt][1]+vt[wt][1]),Ot=ze+Tt;ft+=Math.abs(ze)>=Math.abs(Tt)?ze-Ot+Tt:Tt-Ot+ze,ze=Ot}ze+ft>=0!=!!Ne&&vt.reverse()}var ae=s.getDefaultExportFromCjs((function vt(Ne,ze){var ft,wt=Ne&&Ne.type;if(wt==="FeatureCollection")for(ft=0;ft<Ne.features.length;ft++)vt(Ne.features[ft],ze);else if(wt==="GeometryCollection")for(ft=0;ft<Ne.geometries.length;ft++)vt(Ne.geometries[ft],ze);else if(wt==="Feature")vt(Ne.geometry,ze);else if(wt==="Polygon")M(Ne.coordinates,ze);else if(wt==="MultiPolygon")for(ft=0;ft<Ne.coordinates.length;ft++)M(Ne.coordinates[ft],ze);return Ne}));const ye=s.VectorTileFeature.prototype.toGeoJSON;var ie={exports:{}},oe=s.pointGeometry,ve=s.vectorTile.VectorTileFeature,de=Pe;function Pe(vt,Ne){this.options=Ne||{},this.features=vt,this.length=vt.length}function Be(vt,Ne){this.id=typeof vt.id=="number"?vt.id:void 0,this.type=vt.type,this.rawGeometry=vt.type===1?[vt.geometry]:vt.geometry,this.properties=vt.tags,this.extent=Ne||4096}Pe.prototype.feature=function(vt){return new Be(this.features[vt],this.options.extent)},Be.prototype.loadGeometry=function(){var vt=this.rawGeometry;this.geometry=[];for(var Ne=0;Ne<vt.length;Ne++){for(var ze=vt[Ne],ft=[],wt=0;wt<ze.length;wt++)ft.push(new oe(ze[wt][0],ze[wt][1]));this.geometry.push(ft)}return this.geometry},Be.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var vt=this.geometry,Ne=1/0,ze=-1/0,ft=1/0,wt=-1/0,Ut=0;Ut<vt.length;Ut++)for(var Gt=vt[Ut],Tt=0;Tt<Gt.length;Tt++){var Ot=Gt[Tt];Ne=Math.min(Ne,Ot.x),ze=Math.max(ze,Ot.x),ft=Math.min(ft,Ot.y),wt=Math.max(wt,Ot.y)}return[Ne,ft,ze,wt]},Be.prototype.toGeoJSON=ve.prototype.toGeoJSON;var _e=s.pbf,G=de;function B(vt){var Ne=new _e;return(function(ze,ft){for(var wt in ze.layers)ft.writeMessage(3,Y,ze.layers[wt])})(vt,Ne),Ne.finish()}function Y(vt,Ne){var ze;Ne.writeVarintField(15,vt.version||1),Ne.writeStringField(1,vt.name||""),Ne.writeVarintField(5,vt.extent||4096);var ft={keys:[],values:[],keycache:{},valuecache:{}};for(ze=0;ze<vt.length;ze++)ft.feature=vt.feature(ze),Ne.writeMessage(2,$,ft);var wt=ft.keys;for(ze=0;ze<wt.length;ze++)Ne.writeStringField(3,wt[ze]);var Ut=ft.values;for(ze=0;ze<Ut.length;ze++)Ne.writeMessage(4,$e,Ut[ze])}function $(vt,Ne){var ze=vt.feature;ze.id!==void 0&&Ne.writeVarintField(1,ze.id),Ne.writeMessage(2,J,vt),Ne.writeVarintField(3,ze.type),Ne.writeMessage(4,De,ze)}function J(vt,Ne){var ze=vt.feature,ft=vt.keys,wt=vt.values,Ut=vt.keycache,Gt=vt.valuecache;for(var Tt in ze.properties){var Ot=ze.properties[Tt],zt=Ut[Tt];if(Ot!==null){zt===void 0&&(ft.push(Tt),Ut[Tt]=zt=ft.length-1),Ne.writeVarint(zt);var Pn=typeof Ot;Pn!=="string"&&Pn!=="boolean"&&Pn!=="number"&&(Ot=JSON.stringify(Ot));var Jn=Pn+":"+Ot,Fn=Gt[Jn];Fn===void 0&&(wt.push(Ot),Gt[Jn]=Fn=wt.length-1),Ne.writeVarint(Fn)}}}function te(vt,Ne){return(Ne<<3)+(7&vt)}function Se(vt){return vt<<1^vt>>31}function De(vt,Ne){for(var ze=vt.loadGeometry(),ft=vt.type,wt=0,Ut=0,Gt=ze.length,Tt=0;Tt<Gt;Tt++){var Ot=ze[Tt],zt=1;ft===1&&(zt=Ot.length),Ne.writeVarint(te(1,zt));for(var Pn=ft===3?Ot.length-1:Ot.length,Jn=0;Jn<Pn;Jn++){Jn===1&&ft!==1&&Ne.writeVarint(te(2,Pn-1));var Fn=Ot[Jn].x-wt,Gr=Ot[Jn].y-Ut;Ne.writeVarint(Se(Fn)),Ne.writeVarint(Se(Gr)),wt+=Fn,Ut+=Gr}ft===3&&Ne.writeVarint(te(7,1))}}function $e(vt,Ne){var ze=typeof vt;ze==="string"?Ne.writeStringField(1,vt):ze==="boolean"?Ne.writeBooleanField(7,vt):ze==="number"&&(vt%1!=0?Ne.writeDoubleField(3,vt):vt<0?Ne.writeSVarintField(6,vt):Ne.writeVarintField(5,vt))}ie.exports=B,ie.exports.fromVectorTileJs=B,ie.exports.fromGeojsonVt=function(vt,Ne){Ne=Ne||{};var ze={};for(var ft in vt)ze[ft]=new G(vt[ft].features,Ne),ze[ft].name=ft,ze[ft].version=Ne.version,ze[ft].extent=Ne.extent;return B({layers:ze})},ie.exports.GeoJSONWrapper=G;var Ue=s.getDefaultExportFromCjs(ie.exports);const Le={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:vt=>vt},He=Math.fround||(Ke=new Float32Array(1),vt=>(Ke[0]=+vt,Ke[0]));var Ke;const Ce=3,ge=5,We=6;class Ve{constructor(Ne){this.options=Object.assign(Object.create(Le),Ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Ne){const{log:ze,minZoom:ft,maxZoom:wt}=this.options;ze&&console.time("total time");const Ut=`prepare ${Ne.length} points`;ze&&console.time(Ut),this.points=Ne;const Gt=[];for(let Ot=0;Ot<Ne.length;Ot++){const zt=Ne[Ot];if(!zt.geometry)continue;const[Pn,Jn]=zt.geometry.coordinates,Fn=He(It(Pn)),Gr=He(Oe(Jn));Gt.push(Fn,Gr,1/0,Ot,-1,1),this.options.reduce&&Gt.push(0)}let Tt=this.trees[wt+1]=this._createTree(Gt);ze&&console.timeEnd(Ut);for(let Ot=wt;Ot>=ft;Ot--){const zt=+Date.now();Tt=this.trees[Ot]=this._createTree(this._cluster(Tt,Ot)),ze&&console.log("z%d: %d clusters in %dms",Ot,Tt.numItems,+Date.now()-zt)}return ze&&console.timeEnd("total time"),this}getClusters(Ne,ze){let ft=((Ne[0]+180)%360+360)%360-180;const wt=Math.max(-90,Math.min(90,Ne[1]));let Ut=Ne[2]===180?180:((Ne[2]+180)%360+360)%360-180;const Gt=Math.max(-90,Math.min(90,Ne[3]));if(Ne[2]-Ne[0]>=360)ft=-180,Ut=180;else if(ft>Ut){const Jn=this.getClusters([ft,wt,180,Gt],ze),Fn=this.getClusters([-180,wt,Ut,Gt],ze);return Jn.concat(Fn)}const Tt=this.trees[this._limitZoom(ze)],Ot=Tt.range(It(ft),Oe(Gt),It(Ut),Oe(wt)),zt=Tt.data,Pn=[];for(const Jn of Ot){const Fn=this.stride*Jn;Pn.push(zt[Fn+ge]>1?ut(zt,Fn,this.clusterProps):this.points[zt[Fn+Ce]])}return Pn}getChildren(Ne){const ze=this._getOriginId(Ne),ft=this._getOriginZoom(Ne),wt="No cluster with the specified id.",Ut=this.trees[ft];if(!Ut)throw new Error(wt);const Gt=Ut.data;if(ze*this.stride>=Gt.length)throw new Error(wt);const Tt=this.options.radius/(this.options.extent*Math.pow(2,ft-1)),Ot=Ut.within(Gt[ze*this.stride],Gt[ze*this.stride+1],Tt),zt=[];for(const Pn of Ot){const Jn=Pn*this.stride;Gt[Jn+4]===Ne&&zt.push(Gt[Jn+ge]>1?ut(Gt,Jn,this.clusterProps):this.points[Gt[Jn+Ce]])}if(zt.length===0)throw new Error(wt);return zt}getLeaves(Ne,ze,ft){const wt=[];return this._appendLeaves(wt,Ne,ze=ze||10,ft=ft||0,0),wt}getTile(Ne,ze,ft){const wt=this.trees[this._limitZoom(Ne)],Ut=Math.pow(2,Ne),{extent:Gt,radius:Tt}=this.options,Ot=Tt/Gt,zt=(ft-Ot)/Ut,Pn=(ft+1+Ot)/Ut,Jn={features:[]};return this._addTileFeatures(wt.range((ze-Ot)/Ut,zt,(ze+1+Ot)/Ut,Pn),wt.data,ze,ft,Ut,Jn),ze===0&&this._addTileFeatures(wt.range(1-Ot/Ut,zt,1,Pn),wt.data,Ut,ft,Ut,Jn),ze===Ut-1&&this._addTileFeatures(wt.range(0,zt,Ot/Ut,Pn),wt.data,-1,ft,Ut,Jn),Jn.features.length?Jn:null}getClusterExpansionZoom(Ne){let ze=this._getOriginZoom(Ne)-1;for(;ze<=this.options.maxZoom;){const ft=this.getChildren(Ne);if(ze++,ft.length!==1)break;Ne=ft[0].properties.cluster_id}return ze}_appendLeaves(Ne,ze,ft,wt,Ut){const Gt=this.getChildren(ze);for(const Tt of Gt){const Ot=Tt.properties;if(Ot&&Ot.cluster?Ut+Ot.point_count<=wt?Ut+=Ot.point_count:Ut=this._appendLeaves(Ne,Ot.cluster_id,ft,wt,Ut):Ut<wt?Ut++:Ne.push(Tt),Ne.length===ft)break}return Ut}_createTree(Ne){const ze=new s.KDBush(Ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ft=0;ft<Ne.length;ft+=this.stride)ze.add(Ne[ft],Ne[ft+1]);return ze.finish(),ze.data=Ne,ze}_addTileFeatures(Ne,ze,ft,wt,Ut,Gt){for(const Tt of Ne){const Ot=Tt*this.stride,zt=ze[Ot+ge]>1;let Pn,Jn,Fn;if(zt)Pn=pt(ze,Ot,this.clusterProps),Jn=ze[Ot],Fn=ze[Ot+1];else{const Zr=this.points[ze[Ot+Ce]];Pn=Zr.properties;const[Br,zi]=Zr.geometry.coordinates;Jn=It(Br),Fn=Oe(zi)}const Gr={type:1,geometry:[[Math.round(this.options.extent*(Jn*Ut-ft)),Math.round(this.options.extent*(Fn*Ut-wt))]],tags:Pn};let Mr;Mr=zt||this.options.generateId?ze[Ot+Ce]:this.points[ze[Ot+Ce]].id,Mr!==void 0&&(Gr.id=Mr),Gt.features.push(Gr)}}_limitZoom(Ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ne),this.options.maxZoom+1))}_cluster(Ne,ze){const{radius:ft,extent:wt,reduce:Ut,minPoints:Gt}=this.options,Tt=ft/(wt*Math.pow(2,ze)),Ot=Ne.data,zt=[],Pn=this.stride;for(let Jn=0;Jn<Ot.length;Jn+=Pn){if(Ot[Jn+2]<=ze)continue;Ot[Jn+2]=ze;const Fn=Ot[Jn],Gr=Ot[Jn+1],Mr=Ne.within(Ot[Jn],Ot[Jn+1],Tt),Zr=Ot[Jn+ge];let Br=Zr;for(const zi of Mr){const ms=zi*Pn;Ot[ms+2]>ze&&(Br+=Ot[ms+ge])}if(Br>Zr&&Br>=Gt){let zi,ms=Fn*Zr,Os=Gr*Zr,cs=-1;const ps=((Jn/Pn|0)<<5)+(ze+1)+this.points.length;for(const vo of Mr){const is=vo*Pn;if(Ot[is+2]<=ze)continue;Ot[is+2]=ze;const xo=Ot[is+ge];ms+=Ot[is]*xo,Os+=Ot[is+1]*xo,Ot[is+4]=ps,Ut&&(zi||(zi=this._map(Ot,Jn,!0),cs=this.clusterProps.length,this.clusterProps.push(zi)),Ut(zi,this._map(Ot,is)))}Ot[Jn+4]=ps,zt.push(ms/Br,Os/Br,1/0,ps,-1,Br),Ut&&zt.push(cs)}else{for(let zi=0;zi<Pn;zi++)zt.push(Ot[Jn+zi]);if(Br>1)for(const zi of Mr){const ms=zi*Pn;if(!(Ot[ms+2]<=ze)){Ot[ms+2]=ze;for(let Os=0;Os<Pn;Os++)zt.push(Ot[ms+Os])}}}}return zt}_getOriginId(Ne){return Ne-this.points.length>>5}_getOriginZoom(Ne){return(Ne-this.points.length)%32}_map(Ne,ze,ft){if(Ne[ze+ge]>1){const Gt=this.clusterProps[Ne[ze+We]];return ft?Object.assign({},Gt):Gt}const wt=this.points[Ne[ze+Ce]].properties,Ut=this.options.map(wt);return ft&&Ut===wt?Object.assign({},Ut):Ut}}function ut(vt,Ne,ze){return{type:"Feature",id:vt[Ne+Ce],properties:pt(vt,Ne,ze),geometry:{type:"Point",coordinates:[(ft=vt[Ne],360*(ft-.5)),Wt(vt[Ne+1])]}};var ft}function pt(vt,Ne,ze){const ft=vt[Ne+ge],wt=ft>=1e4?`${Math.round(ft/1e3)}k`:ft>=1e3?Math.round(ft/100)/10+"k":ft,Ut=vt[Ne+We],Gt=Ut===-1?{}:Object.assign({},ze[Ut]);return Object.assign(Gt,{cluster:!0,cluster_id:vt[Ne+Ce],point_count:ft,point_count_abbreviated:wt})}function It(vt){return vt/360+.5}function Oe(vt){const Ne=Math.sin(vt*Math.PI/180),ze=.5-.25*Math.log((1+Ne)/(1-Ne))/Math.PI;return ze<0?0:ze>1?1:ze}function Wt(vt){const Ne=(180-360*vt)*Math.PI/180;return 360*Math.atan(Math.exp(Ne))/Math.PI-90}function Zt(vt,Ne,ze,ft){for(var wt,Ut=ft,Gt=ze-Ne>>1,Tt=ze-Ne,Ot=vt[Ne],zt=vt[Ne+1],Pn=vt[ze],Jn=vt[ze+1],Fn=Ne+3;Fn<ze;Fn+=3){var Gr=Xt(vt[Fn],vt[Fn+1],Ot,zt,Pn,Jn);if(Gr>Ut)wt=Fn,Ut=Gr;else if(Gr===Ut){var Mr=Math.abs(Fn-Gt);Mr<Tt&&(wt=Fn,Tt=Mr)}}Ut>ft&&(wt-Ne>3&&Zt(vt,Ne,wt,ft),vt[wt+2]=Ut,ze-wt>3&&Zt(vt,wt,ze,ft))}function Xt(vt,Ne,ze,ft,wt,Ut){var Gt=wt-ze,Tt=Ut-ft;if(Gt!==0||Tt!==0){var Ot=((vt-ze)*Gt+(Ne-ft)*Tt)/(Gt*Gt+Tt*Tt);Ot>1?(ze=wt,ft=Ut):Ot>0&&(ze+=Gt*Ot,ft+=Tt*Ot)}return(Gt=vt-ze)*Gt+(Tt=Ne-ft)*Tt}function Ze(vt,Ne,ze,ft){var wt={id:vt===void 0?null:vt,type:Ne,geometry:ze,tags:ft,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return(function(Ut){var Gt=Ut.geometry,Tt=Ut.type;if(Tt==="Point"||Tt==="MultiPoint"||Tt==="LineString")zn(Ut,Gt);else if(Tt==="Polygon"||Tt==="MultiLineString")for(var Ot=0;Ot<Gt.length;Ot++)zn(Ut,Gt[Ot]);else if(Tt==="MultiPolygon")for(Ot=0;Ot<Gt.length;Ot++)for(var zt=0;zt<Gt[Ot].length;zt++)zn(Ut,Gt[Ot][zt])})(wt),wt}function zn(vt,Ne){for(var ze=0;ze<Ne.length;ze+=3)vt.minX=Math.min(vt.minX,Ne[ze]),vt.minY=Math.min(vt.minY,Ne[ze+1]),vt.maxX=Math.max(vt.maxX,Ne[ze]),vt.maxY=Math.max(vt.maxY,Ne[ze+1])}function on(vt,Ne,ze,ft){if(Ne.geometry){var wt=Ne.geometry.coordinates,Ut=Ne.geometry.type,Gt=Math.pow(ze.tolerance/((1<<ze.maxZoom)*ze.extent),2),Tt=[],Ot=Ne.id;if(ze.promoteId?Ot=Ne.properties[ze.promoteId]:ze.generateId&&(Ot=ft||0),Ut==="Point")mt(wt,Tt);else if(Ut==="MultiPoint")for(var zt=0;zt<wt.length;zt++)mt(wt[zt],Tt);else if(Ut==="LineString")Ir(wt,Tt,Gt,!1);else if(Ut==="MultiLineString"){if(ze.lineMetrics){for(zt=0;zt<wt.length;zt++)Ir(wt[zt],Tt=[],Gt,!1),vt.push(Ze(Ot,"LineString",Tt,Ne.properties));return}Fr(wt,Tt,Gt,!1)}else if(Ut==="Polygon")Fr(wt,Tt,Gt,!0);else{if(Ut!=="MultiPolygon"){if(Ut==="GeometryCollection"){for(zt=0;zt<Ne.geometry.geometries.length;zt++)on(vt,{id:Ot,geometry:Ne.geometry.geometries[zt],properties:Ne.properties},ze,ft);return}throw new Error("Input data is not a valid GeoJSON object.")}for(zt=0;zt<wt.length;zt++){var Pn=[];Fr(wt[zt],Pn,Gt,!0),Tt.push(Pn)}}vt.push(Ze(Ot,Ut,Tt,Ne.properties))}}function mt(vt,Ne){Ne.push(qr(vt[0])),Ne.push($t(vt[1])),Ne.push(0)}function Ir(vt,Ne,ze,ft){for(var wt,Ut,Gt=0,Tt=0;Tt<vt.length;Tt++){var Ot=qr(vt[Tt][0]),zt=$t(vt[Tt][1]);Ne.push(Ot),Ne.push(zt),Ne.push(0),Tt>0&&(Gt+=ft?(wt*zt-Ot*Ut)/2:Math.sqrt(Math.pow(Ot-wt,2)+Math.pow(zt-Ut,2))),wt=Ot,Ut=zt}var Pn=Ne.length-3;Ne[2]=1,Zt(Ne,0,Pn,ze),Ne[Pn+2]=1,Ne.size=Math.abs(Gt),Ne.start=0,Ne.end=Ne.size}function Fr(vt,Ne,ze,ft){for(var wt=0;wt<vt.length;wt++){var Ut=[];Ir(vt[wt],Ut,ze,ft),Ne.push(Ut)}}function qr(vt){return vt/360+.5}function $t(vt){var Ne=Math.sin(vt*Math.PI/180),ze=.5-.25*Math.log((1+Ne)/(1-Ne))/Math.PI;return ze<0?0:ze>1?1:ze}function xr(vt,Ne,ze,ft,wt,Ut,Gt,Tt){if(ft/=Ne,Ut>=(ze/=Ne)&&Gt<ft)return vt;if(Gt<ze||Ut>=ft)return null;for(var Ot=[],zt=0;zt<vt.length;zt++){var Pn=vt[zt],Jn=Pn.geometry,Fn=Pn.type,Gr=wt===0?Pn.minX:Pn.minY,Mr=wt===0?Pn.maxX:Pn.maxY;if(Gr>=ze&&Mr<ft)Ot.push(Pn);else if(!(Mr<ze||Gr>=ft)){var Zr=[];if(Fn==="Point"||Fn==="MultiPoint")dr(Jn,Zr,ze,ft,wt);else if(Fn==="LineString")ni(Jn,Zr,ze,ft,wt,!1,Tt.lineMetrics);else if(Fn==="MultiLineString")yn(Jn,Zr,ze,ft,wt,!1);else if(Fn==="Polygon")yn(Jn,Zr,ze,ft,wt,!0);else if(Fn==="MultiPolygon")for(var Br=0;Br<Jn.length;Br++){var zi=[];yn(Jn[Br],zi,ze,ft,wt,!0),zi.length&&Zr.push(zi)}if(Zr.length){if(Tt.lineMetrics&&Fn==="LineString"){for(Br=0;Br<Zr.length;Br++)Ot.push(Ze(Pn.id,Fn,Zr[Br],Pn.tags));continue}Fn!=="LineString"&&Fn!=="MultiLineString"||(Zr.length===1?(Fn="LineString",Zr=Zr[0]):Fn="MultiLineString"),Fn!=="Point"&&Fn!=="MultiPoint"||(Fn=Zr.length===3?"Point":"MultiPoint"),Ot.push(Ze(Pn.id,Fn,Zr,Pn.tags))}}}return Ot.length?Ot:null}function dr(vt,Ne,ze,ft,wt){for(var Ut=0;Ut<vt.length;Ut+=3){var Gt=vt[Ut+wt];Gt>=ze&&Gt<=ft&&(Ne.push(vt[Ut]),Ne.push(vt[Ut+1]),Ne.push(vt[Ut+2]))}}function ni(vt,Ne,ze,ft,wt,Ut,Gt){for(var Tt,Ot,zt=nn(vt),Pn=wt===0?Zn:$r,Jn=vt.start,Fn=0;Fn<vt.length-3;Fn+=3){var Gr=vt[Fn],Mr=vt[Fn+1],Zr=vt[Fn+2],Br=vt[Fn+3],zi=vt[Fn+4],ms=wt===0?Gr:Mr,Os=wt===0?Br:zi,cs=!1;Gt&&(Tt=Math.sqrt(Math.pow(Gr-Br,2)+Math.pow(Mr-zi,2))),ms<ze?Os>ze&&(Ot=Pn(zt,Gr,Mr,Br,zi,ze),Gt&&(zt.start=Jn+Tt*Ot)):ms>ft?Os<ft&&(Ot=Pn(zt,Gr,Mr,Br,zi,ft),Gt&&(zt.start=Jn+Tt*Ot)):sr(zt,Gr,Mr,Zr),Os<ze&&ms>=ze&&(Ot=Pn(zt,Gr,Mr,Br,zi,ze),cs=!0),Os>ft&&ms<=ft&&(Ot=Pn(zt,Gr,Mr,Br,zi,ft),cs=!0),!Ut&&cs&&(Gt&&(zt.end=Jn+Tt*Ot),Ne.push(zt),zt=nn(vt)),Gt&&(Jn+=Tt)}var ps=vt.length-3;Gr=vt[ps],Mr=vt[ps+1],Zr=vt[ps+2],(ms=wt===0?Gr:Mr)>=ze&&ms<=ft&&sr(zt,Gr,Mr,Zr),ps=zt.length-3,Ut&&ps>=3&&(zt[ps]!==zt[0]||zt[ps+1]!==zt[1])&&sr(zt,zt[0],zt[1],zt[2]),zt.length&&Ne.push(zt)}function nn(vt){var Ne=[];return Ne.size=vt.size,Ne.start=vt.start,Ne.end=vt.end,Ne}function yn(vt,Ne,ze,ft,wt,Ut){for(var Gt=0;Gt<vt.length;Gt++)ni(vt[Gt],Ne,ze,ft,wt,Ut,!1)}function sr(vt,Ne,ze,ft){vt.push(Ne),vt.push(ze),vt.push(ft)}function Zn(vt,Ne,ze,ft,wt,Ut){var Gt=(Ut-Ne)/(ft-Ne);return vt.push(Ut),vt.push(ze+(wt-ze)*Gt),vt.push(1),Gt}function $r(vt,Ne,ze,ft,wt,Ut){var Gt=(Ut-ze)/(wt-ze);return vt.push(Ne+(ft-Ne)*Gt),vt.push(Ut),vt.push(1),Gt}function qn(vt,Ne){for(var ze=[],ft=0;ft<vt.length;ft++){var wt,Ut=vt[ft],Gt=Ut.type;if(Gt==="Point"||Gt==="MultiPoint"||Gt==="LineString")wt=jr(Ut.geometry,Ne);else if(Gt==="MultiLineString"||Gt==="Polygon"){wt=[];for(var Tt=0;Tt<Ut.geometry.length;Tt++)wt.push(jr(Ut.geometry[Tt],Ne))}else if(Gt==="MultiPolygon")for(wt=[],Tt=0;Tt<Ut.geometry.length;Tt++){for(var Ot=[],zt=0;zt<Ut.geometry[Tt].length;zt++)Ot.push(jr(Ut.geometry[Tt][zt],Ne));wt.push(Ot)}ze.push(Ze(Ut.id,Gt,wt,Ut.tags))}return ze}function jr(vt,Ne){var ze=[];ze.size=vt.size,vt.start!==void 0&&(ze.start=vt.start,ze.end=vt.end);for(var ft=0;ft<vt.length;ft+=3)ze.push(vt[ft]+Ne,vt[ft+1],vt[ft+2]);return ze}function ir(vt,Ne){if(vt.transformed)return vt;var ze,ft,wt,Ut=1<<vt.z,Gt=vt.x,Tt=vt.y;for(ze=0;ze<vt.features.length;ze++){var Ot=vt.features[ze],zt=Ot.geometry,Pn=Ot.type;if(Ot.geometry=[],Pn===1)for(ft=0;ft<zt.length;ft+=2)Ot.geometry.push(Xn(zt[ft],zt[ft+1],Ne,Ut,Gt,Tt));else for(ft=0;ft<zt.length;ft++){var Jn=[];for(wt=0;wt<zt[ft].length;wt+=2)Jn.push(Xn(zt[ft][wt],zt[ft][wt+1],Ne,Ut,Gt,Tt));Ot.geometry.push(Jn)}}return vt.transformed=!0,vt}function Xn(vt,Ne,ze,ft,wt,Ut){return[Math.round(ze*(vt*ft-wt)),Math.round(ze*(Ne*ft-Ut))]}function Bi(vt,Ne,ze,ft,wt){for(var Ut=Ne===wt.maxZoom?0:wt.tolerance/((1<<Ne)*wt.extent),Gt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ze,y:ft,z:Ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Tt=0;Tt<vt.length;Tt++){Gt.numFeatures++,bi(Gt,vt[Tt],Ut,wt);var Ot=vt[Tt].minX,zt=vt[Tt].minY,Pn=vt[Tt].maxX,Jn=vt[Tt].maxY;Ot<Gt.minX&&(Gt.minX=Ot),zt<Gt.minY&&(Gt.minY=zt),Pn>Gt.maxX&&(Gt.maxX=Pn),Jn>Gt.maxY&&(Gt.maxY=Jn)}return Gt}function bi(vt,Ne,ze,ft){var wt=Ne.geometry,Ut=Ne.type,Gt=[];if(Ut==="Point"||Ut==="MultiPoint")for(var Tt=0;Tt<wt.length;Tt+=3)Gt.push(wt[Tt]),Gt.push(wt[Tt+1]),vt.numPoints++,vt.numSimplified++;else if(Ut==="LineString")wr(Gt,wt,vt,ze,!1,!1);else if(Ut==="MultiLineString"||Ut==="Polygon")for(Tt=0;Tt<wt.length;Tt++)wr(Gt,wt[Tt],vt,ze,Ut==="Polygon",Tt===0);else if(Ut==="MultiPolygon")for(var Ot=0;Ot<wt.length;Ot++){var zt=wt[Ot];for(Tt=0;Tt<zt.length;Tt++)wr(Gt,zt[Tt],vt,ze,!0,Tt===0)}if(Gt.length){var Pn=Ne.tags||null;if(Ut==="LineString"&&ft.lineMetrics){for(var Jn in Pn={},Ne.tags)Pn[Jn]=Ne.tags[Jn];Pn.mapbox_clip_start=wt.start/wt.size,Pn.mapbox_clip_end=wt.end/wt.size}var Fn={geometry:Gt,type:Ut==="Polygon"||Ut==="MultiPolygon"?3:Ut==="LineString"||Ut==="MultiLineString"?2:1,tags:Pn};Ne.id!==null&&(Fn.id=Ne.id),vt.features.push(Fn)}}function wr(vt,Ne,ze,ft,wt,Ut){var Gt=ft*ft;if(ft>0&&Ne.size<(wt?Gt:ft))ze.numPoints+=Ne.length/3;else{for(var Tt=[],Ot=0;Ot<Ne.length;Ot+=3)(ft===0||Ne[Ot+2]>Gt)&&(ze.numSimplified++,Tt.push(Ne[Ot]),Tt.push(Ne[Ot+1])),ze.numPoints++;wt&&(function(zt,Pn){for(var Jn=0,Fn=0,Gr=zt.length,Mr=Gr-2;Fn<Gr;Mr=Fn,Fn+=2)Jn+=(zt[Fn]-zt[Mr])*(zt[Fn+1]+zt[Mr+1]);if(Jn>0===Pn)for(Fn=0,Gr=zt.length;Fn<Gr/2;Fn+=2){var Zr=zt[Fn],Br=zt[Fn+1];zt[Fn]=zt[Gr-2-Fn],zt[Fn+1]=zt[Gr-1-Fn],zt[Gr-2-Fn]=Zr,zt[Gr-1-Fn]=Br}})(Tt,Ut),vt.push(Tt)}}function or(vt,Ne){var ze=(Ne=this.options=(function(wt,Ut){for(var Gt in Ut)wt[Gt]=Ut[Gt];return wt})(Object.create(this.options),Ne)).debug;if(ze&&console.time("preprocess data"),Ne.maxZoom<0||Ne.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ne.promoteId&&Ne.generateId)throw new Error("promoteId and generateId cannot be used together.");var ft=(function(wt,Ut){var Gt=[];if(wt.type==="FeatureCollection")for(var Tt=0;Tt<wt.features.length;Tt++)on(Gt,wt.features[Tt],Ut,Tt);else on(Gt,wt.type==="Feature"?wt:{geometry:wt},Ut);return Gt})(vt,Ne);this.tiles={},this.tileCoords=[],ze&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ne.indexMaxZoom,Ne.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ft=(function(wt,Ut){var Gt=Ut.buffer/Ut.extent,Tt=wt,Ot=xr(wt,1,-1-Gt,Gt,0,-1,2,Ut),zt=xr(wt,1,1-Gt,2+Gt,0,-1,2,Ut);return(Ot||zt)&&(Tt=xr(wt,1,-Gt,1+Gt,0,-1,2,Ut)||[],Ot&&(Tt=qn(Ot,1).concat(Tt)),zt&&(Tt=Tt.concat(qn(zt,-1)))),Tt})(ft,Ne),ft.length&&this.splitTile(ft,0,0,0),ze&&(ft.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ui(vt,Ne,ze){return 32*((1<<vt)*ze+Ne)+vt}function Kr(vt,Ne){const ze=vt.tileID.canonical;if(!this._geoJSONIndex)return Ne(null,null);const ft=this._geoJSONIndex.getTile(ze.z,ze.x,ze.y);if(!ft)return Ne(null,null);const wt=new class{constructor(Gt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=Gt.length,this._features=Gt}feature(Gt){return new class{constructor(Tt){this._feature=Tt,this.extent=s.EXTENT,this.type=Tt.type,this.properties=Tt.tags,"id"in Tt&&!isNaN(Tt.id)&&(this.id=parseInt(Tt.id,10))}loadGeometry(){if(this._feature.type===1){const Tt=[];for(const Ot of this._feature.geometry)Tt.push([new s.Point(Ot[0],Ot[1])]);return Tt}{const Tt=[];for(const Ot of this._feature.geometry){const zt=[];for(const Pn of Ot)zt.push(new s.Point(Pn[0],Pn[1]));Tt.push(zt)}return Tt}}toGeoJSON(Tt,Ot,zt){return ye.call(this,Tt,Ot,zt)}}(this._features[Gt])}}(ft.features);let Ut=Ue(wt);Ut.byteOffset===0&&Ut.byteLength===Ut.buffer.byteLength||(Ut=new Uint8Array(Ut)),Ne(null,{vectorTile:wt,rawData:Ut.buffer})}or.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},or.prototype.splitTile=function(vt,Ne,ze,ft,wt,Ut,Gt){for(var Tt=[vt,Ne,ze,ft],Ot=this.options,zt=Ot.debug;Tt.length;){ft=Tt.pop(),ze=Tt.pop(),Ne=Tt.pop(),vt=Tt.pop();var Pn=1<<Ne,Jn=ui(Ne,ze,ft),Fn=this.tiles[Jn];if(!Fn&&(zt>1&&console.time("creation"),Fn=this.tiles[Jn]=Bi(vt,Ne,ze,ft,Ot),this.tileCoords.push({z:Ne,x:ze,y:ft}),zt)){zt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ne,ze,ft,Fn.numFeatures,Fn.numPoints,Fn.numSimplified),console.timeEnd("creation"));var Gr="z"+Ne;this.stats[Gr]=(this.stats[Gr]||0)+1,this.total++}if(Fn.source=vt,wt){if(Ne===Ot.maxZoom||Ne===wt)continue;var Mr=1<<wt-Ne;if(ze!==Math.floor(Ut/Mr)||ft!==Math.floor(Gt/Mr))continue}else if(Ne===Ot.indexMaxZoom||Fn.numPoints<=Ot.indexMaxPoints)continue;if(Fn.source=null,vt.length!==0){zt>1&&console.time("clipping");var Zr,Br,zi,ms,Os,cs,ps=.5*Ot.buffer/Ot.extent,vo=.5-ps,is=.5+ps,xo=1+ps;Zr=Br=zi=ms=null,Os=xr(vt,Pn,ze-ps,ze+is,0,Fn.minX,Fn.maxX,Ot),cs=xr(vt,Pn,ze+vo,ze+xo,0,Fn.minX,Fn.maxX,Ot),vt=null,Os&&(Zr=xr(Os,Pn,ft-ps,ft+is,1,Fn.minY,Fn.maxY,Ot),Br=xr(Os,Pn,ft+vo,ft+xo,1,Fn.minY,Fn.maxY,Ot),Os=null),cs&&(zi=xr(cs,Pn,ft-ps,ft+is,1,Fn.minY,Fn.maxY,Ot),ms=xr(cs,Pn,ft+vo,ft+xo,1,Fn.minY,Fn.maxY,Ot),cs=null),zt>1&&console.timeEnd("clipping"),Tt.push(Zr||[],Ne+1,2*ze,2*ft),Tt.push(Br||[],Ne+1,2*ze,2*ft+1),Tt.push(zi||[],Ne+1,2*ze+1,2*ft),Tt.push(ms||[],Ne+1,2*ze+1,2*ft+1)}}},or.prototype.getTile=function(vt,Ne,ze){var ft=this.options,wt=ft.extent,Ut=ft.debug;if(vt<0||vt>24)return null;var Gt=1<<vt,Tt=ui(vt,Ne=(Ne%Gt+Gt)%Gt,ze);if(this.tiles[Tt])return ir(this.tiles[Tt],wt);Ut>1&&console.log("drilling down to z%d-%d-%d",vt,Ne,ze);for(var Ot,zt=vt,Pn=Ne,Jn=ze;!Ot&&zt>0;)zt--,Pn=Math.floor(Pn/2),Jn=Math.floor(Jn/2),Ot=this.tiles[ui(zt,Pn,Jn)];return Ot&&Ot.source?(Ut>1&&console.log("found parent tile z%d-%d-%d",zt,Pn,Jn),Ut>1&&console.time("drilling down"),this.splitTile(Ot.source,zt,Pn,Jn,vt,Ne,ze),Ut>1&&console.timeEnd("drilling down"),this.tiles[Tt]?ir(this.tiles[Tt],wt):null):null};class wi extends s.VectorTileWorkerSource{constructor(Ne,ze,ft,wt,Ut){super(Ne,ze,ft,wt,Kr),Ut&&(this.loadGeoJSON=Ut)}loadData(Ne,ze){const ft=Ne&&Ne.request,wt=ft&&ft.collectResourceTiming;this.loadGeoJSON(Ne,((Ut,Gt)=>{if(Ut||!Gt)return ze(Ut);if(typeof Gt!="object")return ze(new Error(`Input data given to '${Ne.source}' is not a valid GeoJSON object.`));{ae(Gt,!0);try{if(Ne.filter){const Ot=s.createExpression(Ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ot.result==="error")throw new Error(Ot.value.map((Pn=>`${Pn.key}: ${Pn.message}`)).join(", "));Gt={type:"FeatureCollection",features:Gt.features.filter((Pn=>Ot.value.evaluate({zoom:0},Pn)))}}this._geoJSONIndex=Ne.cluster?new Ve((function({superclusterOptions:Ot,clusterProperties:zt}){if(!zt||!Ot)return Ot;const Pn={},Jn={},Fn={accumulated:null,zoom:0},Gr={properties:null},Mr=Object.keys(zt);for(const Zr of Mr){const[Br,zi]=zt[Zr],ms=s.createExpression(zi),Os=s.createExpression(typeof Br=="string"?[Br,["accumulated"],["get",Zr]]:Br);Pn[Zr]=ms.value,Jn[Zr]=Os.value}return Ot.map=Zr=>{Gr.properties=Zr;const Br={};for(const zi of Mr)Br[zi]=Pn[zi].evaluate(Fn,Gr);return Br},Ot.reduce=(Zr,Br)=>{Gr.properties=Br;for(const zi of Mr)Fn.accumulated=Zr[zi],Zr[zi]=Jn[zi].evaluate(Fn,Gr)},Ot})(Ne)).load(Gt.features):(function(Ot,zt){return new or(Ot,zt)})(Gt,Ne.geojsonVtOptions)}catch(Ot){return ze(Ot)}this.loaded={};const Tt={};if(wt){const Ot=s.getPerformanceMeasurement(ft);Ot&&(Tt.resourceTiming={},Tt.resourceTiming[Ne.source]=JSON.parse(JSON.stringify(Ot)))}ze(null,Tt)}}))}reloadTile(Ne,ze){const ft=this.loaded;return ft&&ft[Ne.uid]?super.reloadTile(Ne,ze):this.loadTile(Ne,ze)}loadGeoJSON(Ne,ze){if(Ne.request)s.getJSON(Ne.request,ze);else{if(typeof Ne.data!="string")return ze(new Error(`Input data given to '${Ne.source}' is not a valid GeoJSON object.`));try{return ze(null,JSON.parse(Ne.data))}catch{return ze(new Error(`Input data given to '${Ne.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Ne,ze){try{ze(null,this._geoJSONIndex.getClusterExpansionZoom(Ne.clusterId))}catch(ft){ze(ft)}}getClusterChildren(Ne,ze){try{ze(null,this._geoJSONIndex.getChildren(Ne.clusterId))}catch(ft){ze(ft)}}getClusterLeaves(Ne,ze){try{ze(null,this._geoJSONIndex.getLeaves(Ne.clusterId,Ne.limit,Ne.offset))}catch(ft){ze(ft)}}}class si{constructor(Ne){this.self=Ne,this.actor=new s.Actor(Ne,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:wi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ze,ft)=>{if(this.workerSourceTypes[ze])throw new Error(`Worker source with name "${ze}" already registered.`);this.workerSourceTypes[ze]=ft},this.self.registerRTLTextPlugin=ze=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=ze.applyArabicShaping,s.plugin.processBidirectionalText=ze.processBidirectionalText,s.plugin.processStyledBidirectionalText=ze.processStyledBidirectionalText}}clearCaches(Ne,ze,ft){delete this.layerIndexes[Ne],delete this.availableImages[Ne],delete this.workerSources[Ne],delete this.demWorkerSources[Ne],ft()}checkIfReady(Ne,ze,ft){ft()}setReferrer(Ne,ze){this.referrer=ze}spriteLoaded(Ne,ze){this.isSpriteLoaded[Ne]=ze;for(const ft in this.workerSources[Ne]){const wt=this.workerSources[Ne][ft];for(const Ut in wt)wt[Ut]instanceof s.VectorTileWorkerSource&&(wt[Ut].isSpriteLoaded=ze,wt[Ut].fire(new s.Event("isSpriteLoaded")))}}setImages(Ne,ze,ft){this.availableImages[Ne]=ze;for(const wt in this.workerSources[Ne]){const Ut=this.workerSources[Ne][wt];for(const Gt in Ut)Ut[Gt].availableImages=ze}ft()}enableTerrain(Ne,ze,ft){this.terrain=ze,ft()}setProjection(Ne,ze){this.projections[Ne]=s.getProjection(ze)}setLayers(Ne,ze,ft){this.getLayerIndex(Ne).replace(ze),ft()}updateLayers(Ne,ze,ft){this.getLayerIndex(Ne).update(ze.layers,ze.removedIds),ft()}loadTile(Ne,ze,ft){const wt=this.enableTerrain?s.extend({enableTerrain:this.terrain},ze):ze;wt.projection=this.projections[Ne]||this.defaultProjection,this.getWorkerSource(Ne,ze.type,ze.source).loadTile(wt,ft)}loadDEMTile(Ne,ze,ft){const wt=this.enableTerrain?s.extend({buildQuadTree:this.terrain},ze):ze;this.getDEMWorkerSource(Ne,ze.source).loadTile(wt,ft)}reloadTile(Ne,ze,ft){const wt=this.enableTerrain?s.extend({enableTerrain:this.terrain},ze):ze;wt.projection=this.projections[Ne]||this.defaultProjection,this.getWorkerSource(Ne,ze.type,ze.source).reloadTile(wt,ft)}abortTile(Ne,ze,ft){this.getWorkerSource(Ne,ze.type,ze.source).abortTile(ze,ft)}removeTile(Ne,ze,ft){this.getWorkerSource(Ne,ze.type,ze.source).removeTile(ze,ft)}removeSource(Ne,ze,ft){if(!this.workerSources[Ne]||!this.workerSources[Ne][ze.type]||!this.workerSources[Ne][ze.type][ze.source])return;const wt=this.workerSources[Ne][ze.type][ze.source];delete this.workerSources[Ne][ze.type][ze.source],wt.removeSource!==void 0?wt.removeSource(ze,ft):ft()}loadWorkerSource(Ne,ze,ft){try{this.self.importScripts(ze.url),ft()}catch(wt){ft(wt.toString())}}syncRTLPluginState(Ne,ze,ft){try{s.plugin.setState(ze);const wt=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&wt!=null){this.self.importScripts(wt);const Ut=s.plugin.isParsed();ft(Ut?void 0:new Error(`RTL Text Plugin failed to import scripts from ${wt}`),Ut)}}catch(wt){ft(wt.toString())}}getAvailableImages(Ne){let ze=this.availableImages[Ne];return ze||(ze=[]),ze}getLayerIndex(Ne){let ze=this.layerIndexes[Ne];return ze||(ze=this.layerIndexes[Ne]=new R),ze}getWorkerSource(Ne,ze,ft){if(this.workerSources[Ne]||(this.workerSources[Ne]={}),this.workerSources[Ne][ze]||(this.workerSources[Ne][ze]={}),!this.workerSources[Ne][ze][ft]){const wt={send:(Ut,Gt,Tt,Ot,zt,Pn)=>{this.actor.send(Ut,Gt,Tt,Ne,zt,Pn)},scheduler:this.actor.scheduler};this.workerSources[Ne][ze][ft]=new this.workerSourceTypes[ze](wt,this.getLayerIndex(Ne),this.getAvailableImages(Ne),this.isSpriteLoaded[Ne])}return this.workerSources[Ne][ze][ft]}getDEMWorkerSource(Ne,ze){return this.demWorkerSources[Ne]||(this.demWorkerSources[Ne]={}),this.demWorkerSources[Ne][ze]||(this.demWorkerSources[Ne][ze]=new U),this.demWorkerSources[Ne][ze]}enforceCacheSizeLimit(Ne,ze){s.enforceCacheSizeLimit(ze)}getWorkerPerformanceMetrics(Ne,ze,ft){ft(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new si(self)),si})),_(["./shared"],(function(s){function T(x,l){if(Array.isArray(x)){if(!Array.isArray(l)||x.length!==l.length)return!1;for(let m=0;m<x.length;m++)if(!T(x[m],l[m]))return!1;return!0}if(typeof x=="object"&&x!==null&&l!==null){if(typeof l!="object"||Object.keys(x).length!==Object.keys(l).length)return!1;for(const m in x)if(!T(x[m],l[m]))return!1;return!0}return x===l}var L=R;function R(x){return!(function(l){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,I,P=new Blob([""],{type:"text/javascript"}),j=URL.createObjectURL(P);try{I=new Worker(j),b=!0}catch{b=!1}return I&&I.terminate(),URL.revokeObjectURL(j),b})()?"Uint8ClampedArray"in window?ArrayBuffer.isView?(function(){var b=document.createElement("canvas");b.width=b.height=1;var I=b.getContext("2d");if(!I)return!1;var P=I.getImageData(0,0,1,1);return P&&P.width===b.width})()?(U[m=l&&l.failIfMajorPerformanceCaveat]===void 0&&(U[m]=(function(b){var I,P=(function(j){var W=document.createElement("canvas"),Z=Object.create(R.webGLContextAttributes);return Z.failIfMajorPerformanceCaveat=j,W.getContext("webgl",Z)||W.getContext("experimental-webgl",Z)})(b);if(!P)return!1;try{I=P.createShader(P.VERTEX_SHADER)}catch{return!1}return!(!I||P.isContextLost())&&(P.shaderSource(I,"void main() {}"),P.compileShader(I),P.getShaderParameter(I,P.COMPILE_STATUS)===!0)})(m)),U[m]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var m})(x)}var U={};function M(x,l,m){const b=s.window.document.createElement(x);return l!==void 0&&(b.className=l),m&&m.appendChild(b),b}function Q(x,l,m){const b=s.window.document.createElementNS("http://www.w3.org/2000/svg",x);for(const I of Object.keys(l))b.setAttributeNS(null,I,l[I]);return m&&m.appendChild(b),b}R.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ae=s.window.document&&s.window.document.documentElement.style,ye=ae&&ae.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ie;function oe(){ae&&ye&&(ie=ae[ye],ae[ye]="none")}function ve(){ae&&ye&&(ae[ye]=ie)}function de(x){x.preventDefault(),x.stopPropagation(),s.window.removeEventListener("click",de,!0)}function Pe(){s.window.addEventListener("click",de,!0),s.window.setTimeout((()=>{s.window.removeEventListener("click",de,!0)}),0)}function Be(x,l){const m=x.getBoundingClientRect();return B(x,m,l)}function _e(x,l){const m=x.getBoundingClientRect(),b=[];for(let I=0;I<l.length;I++)b.push(B(x,m,l[I]));return b}function G(x){return s.window.InstallTrigger!==void 0&&x.button===2&&x.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:x.button}function B(x,l,m){const b=x.offsetWidth===l.width?1:x.offsetWidth/l.width;return new s.Point((m.clientX-l.left)*b,(m.clientY-l.top)*b)}function Y(x,l){var m=l[0],b=l[1],I=l[2],P=l[3],j=m*P-I*b;return j?(x[0]=P*(j=1/j),x[1]=-b*j,x[2]=-I*j,x[3]=m*j,x):null}function $(x){const{userImage:l}=x;return!!(l&&l.render&&l.render())&&(x.data.replace(new Uint8Array(l.data.buffer)),!0)}class J extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:m,callback:b}of this.requestors)this._notify(m,b);this.requestors=[]}}hasImage(l){return!!this.getImage(l)}getImage(l){return this.images[l]}addImage(l,m){this._validate(l,m)&&(this.images[l]=m)}_validate(l,m){let b=!0;return this._validateStretch(m.stretchX,m.data&&m.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${l}" has invalid "stretchX" value`))),b=!1),this._validateStretch(m.stretchY,m.data&&m.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${l}" has invalid "stretchY" value`))),b=!1),this._validateContent(m.content,m)||(this.fire(new s.ErrorEvent(new Error(`Image "${l}" has invalid "content" value`))),b=!1),b}_validateStretch(l,m){if(!l)return!0;let b=0;for(const I of l){if(I[0]<b||I[1]<I[0]||m<I[1])return!1;b=I[1]}return!0}_validateContent(l,m){return!(l&&(l.length!==4||l[0]<0||m.data.width<l[0]||l[1]<0||m.data.height<l[1]||l[2]<0||m.data.width<l[2]||l[3]<0||m.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,m){m.version=this.images[l].version+1,this.images[l]=m,this.updatedImages[l]=!0}removeImage(l){const m=this.images[l];delete this.images[l],delete this.patterns[l],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,m){let b=!0;if(!this.isLoaded())for(const I of l)this.images[I]||(b=!1);this.isLoaded()||b?this._notify(l,m):this.requestors.push({ids:l,callback:m})}_notify(l,m){const b={};for(const I of l){this.images[I]||this.fire(new s.Event("styleimagemissing",{id:I}));const P=this.images[I];P?b[I]={data:P.data.clone(),pixelRatio:P.pixelRatio,sdf:P.sdf,version:P.version,stretchX:P.stretchX,stretchY:P.stretchY,content:P.content,hasRenderCallback:!!(P.userImage&&P.userImage.render)}:s.warnOnce(`Image "${I}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}m(null,b)}getPixelSize(){const{width:l,height:m}=this.atlasImage;return{width:l,height:m}}getPattern(l){const m=this.patterns[l],b=this.getImage(l);if(!b)return null;if(m&&m.position.version===b.version)return m.position;if(m)m.position.version=b.version;else{const I={w:b.data.width+2,h:b.data.height+2,x:0,y:0},P=new s.ImagePosition(I,b);this.patterns[l]={bin:I,position:P}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const m=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(l,this.atlasImage,m.RGBA),this.atlasTexture&&this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const P in this.patterns)l.push(this.patterns[P].bin);const{w:m,h:b}=s.potpack(l),I=this.atlasImage;I.resize({width:m||1,height:b||1});for(const P in this.patterns){const{bin:j}=this.patterns[P],W=j.x+1,Z=j.y+1,le=this.images[P].data,ce=le.width,Ee=le.height;s.RGBAImage.copy(le,I,{x:0,y:0},{x:W,y:Z},{width:ce,height:Ee}),s.RGBAImage.copy(le,I,{x:0,y:Ee-1},{x:W,y:Z-1},{width:ce,height:1}),s.RGBAImage.copy(le,I,{x:0,y:0},{x:W,y:Z+Ee},{width:ce,height:1}),s.RGBAImage.copy(le,I,{x:ce-1,y:0},{x:W-1,y:Z},{width:1,height:Ee}),s.RGBAImage.copy(le,I,{x:0,y:0},{x:W+ce,y:Z},{width:1,height:Ee})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const m of l){if(this.callbackDispatchedThisFrame[m])continue;this.callbackDispatchedThisFrame[m]=!0;const b=this.images[m];$(b)&&this.updateImage(m,b)}}}const te=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(x,l){return(function([m,b,I]){const P=s.degToRad(b+90),j=s.degToRad(I);return{x:m*Math.cos(P)*Math.sin(j),y:m*Math.sin(P)*Math.sin(j),z:m*Math.cos(j),azimuthal:b,polar:I}})(x.expression.evaluate(l))}interpolate(x,l,m){return{x:s.number(x.x,l.x,m),y:s.number(x.y,l.y,m),z:s.number(x.z,l.z,m),azimuthal:s.number(x.azimuthal,l.azimuthal,m),polar:s.number(x.polar,l.polar,m)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)});class Se extends s.Evented{constructor(l){super(),this._transitionable=new s.Transitionable(te),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,m={}){if(!this._validate(s.validateLight,l,m))for(const b in l){const I=l[b];s.endsWith(b,"-transition")?this._transitionable.setTransition(b.slice(0,-11),I):this._transitionable.setValue(b,I)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,m,b){return(!b||b.validate!==!1)&&s.emitValidationErrors(this,l.call(s.validateStyle,s.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const De=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)});let $e=class extends s.Evented{constructor(x,l){super(),this._transitionable=new s.Transitionable(De),this.set(x),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(x){for(const l in x){const m=x[l];s.endsWith(l,"-transition")?this._transitionable.setTransition(l.slice(0,-11),m):this._transitionable.setValue(l,m)}}updateTransitions(x){this._transitioning=this._transitionable.transitioned(x,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(x){this.properties=this._transitioning.possiblyEvaluate(x)}};function Ue(x,l,m,b){const I=s.smoothstep(45,65,m),[P,j]=Le(x,b),W=s.length(l);let Z=1-Math.min(1,Math.exp((W-P)/(j-P)*-6));return Z*=Z*Z,Z=Math.min(1,1.00747*Z),Z*I*x.alpha}function Le(x,l){const m=.5/Math.tan(.5*l);return[x.range[0]+m,x.range[1]+m]}const He=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])});class Ke extends s.Evented{constructor(l,m){super(),this._transitionable=new s.Transitionable(He),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=m}get state(){const l=this._transform,m=l.projection.name==="globe",b=s.globeToMercatorTransition(l.zoom),I=this.properties.get("range"),P=[.5,3];return{range:m?[s.number(P[0],I[0],b),s.number(P[1],I[1],b)]:I,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,m={}){if(!this._validate(s.validateFog,l,m)){for(const b of Object.keys(s.spec.fog))l&&l[b]===void 0&&(l[b]=s.spec.fog[b].default);for(const b in l){const I=l[b];s.endsWith(b,"-transition")?this._transitionable.setTransition(b.slice(0,-11),I):this._transitionable.setValue(b,I)}}}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const m=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,l))*m.a}getOpacityAtLatLng(l,m){return this._transform.projection.supportsFog?(function(b,I,P){const j=s.MercatorCoordinate.fromLngLat(I),W=P.elevation?P.elevation.getAtPointOrZero(j):0,Z=[j.x,j.y,W];return s.transformMat4(Z,Z,P.mercatorFogMatrix),Ue(b,Z,P.pitch,P._fov)})(this.state,l,m):0}getFovAdjustedRange(l){return this._transform.projection.supportsFog?Le(this.state,l):[0,1]}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,m,b){return(!b||b.validate!==!1)&&s.emitValidationErrors(this,l.call(s.validateStyle,s.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class Ce{constructor(l,m){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const b=this.workerPool.acquire(this.id);for(let I=0;I<b.length;I++){const P=new Ce.Actor(b[I],m,this.id);P.name=`Worker ${I}`,this.actors.push(P)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(l,m,b){s.asyncAll(this.actors,((I,P)=>{I.send(l,m,P)}),b=b||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((l=>{l.remove()})),this.actors=[],this.workerPool.release(this.id)}}function ge(x,l,m){return l*(s.EXTENT/(x.tileSize*Math.pow(2,m-x.tileID.overscaledZ)))}Ce.Actor=s.Actor;class We{constructor(l,m,b,I){this.screenBounds=l,this.cameraPoint=m,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=b,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,I)}static createFromScreenPoints(l,m){let b,I;if(l instanceof s.Point||typeof l[0]=="number"){const P=s.Point.convert(l);b=[P],I=m.isPointAboveHorizon(P)}else{const P=s.Point.convert(l[0]),j=s.Point.convert(l[1]);b=[P,j],I=s.polygonizeBounds(P,j).every((W=>m.isPointAboveHorizon(W)))}return new We(b,m.getCameraPoint(),I,m)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const m=this.screenBounds[0],b=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],I=s.polygonizeBounds(m,b,0,!1);return this.cameraPoint.y>b.y&&(this.cameraPoint.x>m.x&&this.cameraPoint.x<b.x?I.splice(3,0,this.cameraPoint):this.cameraPoint.x>=b.x?I[2]=this.cameraPoint:this.cameraPoint.x<=m.x&&(I[3]=this.cameraPoint)),s.bufferConvexPolygon(I,l)}bufferedCameraGeometryGlobe(l){const m=this.screenBounds[0],b=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],I=s.polygonizeBounds(m,b,l),P=this.cameraPoint.clone();switch(3*((P.y>m.y)+(P.y>b.y))+((P.x>m.x)+(P.x>b.x))){case 0:I[0]=P,I[4]=P.clone();break;case 1:I.splice(1,0,P);break;case 2:I[1]=P;break;case 3:I.splice(4,0,P);break;case 5:I.splice(2,0,P);break;case 6:I[3]=P;break;case 7:I.splice(3,0,P);break;case 8:I[2]=P}return I}containsTile(l,m,b,I=0){const P=l.queryPadding/m._pixelsPerMercatorPixel+1,j=b?this._bufferedCameraMercator(P,m):this._bufferedScreenMercator(P,m);let W=l.tileID.wrap+(j.unwrapped?I:0);const Z=j.polygon.map((lt=>s.getTilePoint(l.tileTransform,lt,W)));if(!s.polygonIntersectsBox(Z,0,0,s.EXTENT,s.EXTENT))return;W=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?I:0);const le=this.screenGeometryMercator.polygon.map((lt=>s.getTileVec3(l.tileTransform,lt,W))),ce=le.map((lt=>new s.Point(lt[0],lt[1]))),Ee=m.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),Fe=s.getTileVec3(l.tileTransform,Ee,W),qe=le.map((lt=>{const Ie=s.sub(lt,lt,Fe);return s.normalize(Ie,Ie),new s.Ray(Fe,Ie)})),at=ge(l,1,m.zoom)*m._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:ce,tilespaceRays:qe,bufferedTilespaceGeometry:Z,bufferedTilespaceBounds:(et=s.getBounds(Z),et.min.x=s.clamp(et.min.x,0,s.EXTENT),et.min.y=s.clamp(et.min.y,0,s.EXTENT),et.max.x=s.clamp(et.max.x,0,s.EXTENT),et.max.y=s.clamp(et.max.y,0,s.EXTENT),et),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:at};var et}_bufferedScreenMercator(l,m){const b=pt(l);if(this._screenRaycastCache[b])return this._screenRaycastCache[b];{let I;return I=m.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),m):{polygon:this.bufferedScreenGeometry(l).map((P=>m.pointCoordinate3D(P))),unwrapped:!0},this._screenRaycastCache[b]=I,I}}_bufferedCameraMercator(l,m){const b=pt(l);if(this._cameraRaycastCache[b])return this._cameraRaycastCache[b];{let I;return I=m.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),m):{polygon:this.bufferedCameraGeometry(l).map((P=>m.pointCoordinate3D(P))),unwrapped:!0},this._cameraRaycastCache[b]=I,I}}_projectAndResample(l,m){const b=(function(P,j){const W=s.multiply([],j.pixelMatrix,j.globeMatrix),Z=[0,-s.GLOBE_RADIUS,0,1],le=[0,s.GLOBE_RADIUS,0,1],ce=[0,0,0,1];s.transformMat4$1(Z,Z,W),s.transformMat4$1(le,le,W),s.transformMat4$1(ce,ce,W);const Ee=new s.Point(Z[0]/Z[3],Z[1]/Z[3]),Fe=new s.Point(le[0]/le[3],le[1]/le[3]),qe=s.polygonContainsPoint(P,Ee)&&Z[3]<ce[3],at=s.polygonContainsPoint(P,Fe)&&le[3]<ce[3];if(!qe&&!at)return null;const et=(function(Nt,qt,Bt){for(let rn=1;rn<Nt.length;rn++){const Rn=ut(qt.pointCoordinate3D(Nt[rn-1]).x),Jt=ut(qt.pointCoordinate3D(Nt[rn]).x);if(Bt<0){if(Rn<Jt)return{idx:rn,t:-Rn/(Jt-1-Rn)}}else if(Jt<Rn)return{idx:rn,t:(1-Rn)/(Jt+1-Rn)}}return null})(P,j,qe?-1:1);if(!et)return null;const{idx:lt,t:Ie}=et;let rt=lt>1?Ve(P.slice(0,lt),j):[],gt=lt<P.length?Ve(P.slice(lt),j):[];rt=rt.map((Nt=>new s.Point(ut(Nt.x),Nt.y))),gt=gt.map((Nt=>new s.Point(ut(Nt.x),Nt.y)));const yt=[...rt];yt.length===0&&yt.push(gt[gt.length-1]);const Mt=s.number(yt[yt.length-1].y,(gt.length===0?rt[0]:gt[0]).y,Ie);let Dt;return Dt=qe?[new s.Point(0,Mt),new s.Point(0,0),new s.Point(1,0),new s.Point(1,Mt)]:[new s.Point(1,Mt),new s.Point(1,1),new s.Point(0,1),new s.Point(0,Mt)],yt.push(...Dt),gt.length===0?yt.push(rt[0]):yt.push(...gt),{polygon:yt.map((Nt=>new s.MercatorCoordinate(Nt.x,Nt.y))),unwrapped:!1}})(l,m);if(b)return b;const I=(function(P,j){let W=!1,Z=-1/0,le=0;for(let Ee=0;Ee<P.length-1;Ee++)P[Ee].x>Z&&(Z=P[Ee].x,le=Ee);for(let Ee=0;Ee<P.length-1;Ee++){const Fe=(le+Ee)%(P.length-1),qe=P[Fe],at=P[Fe+1];Math.abs(qe.x-at.x)>.5&&(qe.x<at.x?(qe.x+=1,Fe===0&&(P[P.length-1].x+=1)):(at.x+=1,Fe+1===P.length-1&&(P[0].x+=1)),W=!0)}const ce=s.mercatorXfromLng(j.center.lng);return W&&ce<Math.abs(ce-1)&&P.forEach((Ee=>{Ee.x-=1})),{polygon:P,unwrapped:W}})(Ve(l,m).map((P=>new s.Point(ut(P.x),P.y))),m);return{polygon:I.polygon.map((P=>new s.MercatorCoordinate(P.x,P.y))),unwrapped:I.unwrapped}}}function Ve(x,l){return s.resample(x,(m=>{const b=l.pointCoordinate3D(m);m.x=b.x,m.y=b.y}),1/256)}function ut(x){return x<0?1+x%1:x%1}function pt(x){return 100*x|0}function It(x,l,m,b,I){const P=function(j,W){if(j)return I(j);if(W){x.url&&W.tiles&&x.tiles&&delete x.tiles;const Z=s.pick(s.extend(W,x),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);W.vector_layers&&(Z.vectorLayers=W.vector_layers,Z.vectorLayerIds=Z.vectorLayers.map((le=>le.id))),Z.tiles=l.canonicalizeTileset(Z,x.url),I(null,Z)}};return x.url?s.getJSON(l.transformRequest(l.normalizeSourceURL(x.url,null,m,b),s.ResourceType.Source),P):s.exported.frame((()=>P(null,x)))}class Oe{constructor(l,m,b){this.bounds=s.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=m||0,this.maxzoom=b||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const m=Math.pow(2,l.z),b=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*m),I=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*m),P=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*m),j=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*m);return l.x>=b&&l.x<P&&l.y>=I&&l.y<j}}class Wt{constructor(l,m,b){this.context=l;const I=l.gl;this.buffer=I.createBuffer(),this.dynamicDraw=!!b,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),I.bufferData(I.ELEMENT_ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||m.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const m=this.context.gl;this.context.unbindVAO(),this.bind(),m.bufferSubData(m.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Zt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xt{constructor(l,m,b,I){this.length=m.length,this.attributes=b,this.itemSize=m.bytesPerElement,this.dynamicDraw=I,this.context=l;const P=l.gl;this.buffer=P.createBuffer(),l.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||m.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const m=this.context.gl;this.bind(),m.bufferSubData(m.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,m){for(let b=0;b<this.attributes.length;b++){const I=m.attributes[this.attributes[b].name];I!==void 0&&l.enableVertexAttribArray(I)}}setVertexAttribPointers(l,m,b){for(let I=0;I<this.attributes.length;I++){const P=this.attributes[I],j=m.attributes[P.name];j!==void 0&&l.vertexAttribPointer(j,P.components,l[Zt[P.type]],!1,this.itemSize,P.offset+this.itemSize*(b||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ze{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class zn extends Ze{getDefault(){return s.Color.transparent}set(l){const m=this.current;(l.r!==m.r||l.g!==m.g||l.b!==m.b||l.a!==m.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class on extends Ze{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class mt extends Ze{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Ir extends Ze{getDefault(){return[!0,!0,!0,!0]}set(l){const m=this.current;(l[0]!==m[0]||l[1]!==m[1]||l[2]!==m[2]||l[3]!==m[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Fr extends Ze{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class qr extends Ze{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class $t extends Ze{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const m=this.current;(l.func!==m.func||l.ref!==m.ref||l.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class xr extends Ze{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const m=this.current;(l[0]!==m[0]||l[1]!==m[1]||l[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class dr extends Ze{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;l?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=l,this.dirty=!1}}class ni extends Ze{getDefault(){return[0,1]}set(l){const m=this.current;(l[0]!==m[0]||l[1]!==m[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class nn extends Ze{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;l?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=l,this.dirty=!1}}class yn extends Ze{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class sr extends Ze{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;l?m.enable(m.BLEND):m.disable(m.BLEND),this.current=l,this.dirty=!1}}class Zn extends Ze{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const m=this.current;(l[0]!==m[0]||l[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class $r extends Ze{getDefault(){return s.Color.transparent}set(l){const m=this.current;(l.r!==m.r||l.g!==m.g||l.b!==m.b||l.a!==m.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class qn extends Ze{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class jr extends Ze{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;l?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=l,this.dirty=!1}}class ir extends Ze{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Xn extends Ze{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let Bi,bi=class extends Ze{getDefault(){return null}set(x){(x!==this.current||this.dirty)&&(this.gl.useProgram(x),this.current=x,this.dirty=!1)}};class wr extends Ze{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class or extends Ze{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const m=this.current;(l[0]!==m[0]||l[1]!==m[1]||l[2]!==m[2]||l[3]!==m[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class ui extends Ze{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Kr extends Ze{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class wi extends Ze{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;m.bindTexture(m.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class si extends Ze{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class vt extends Ze{getDefault(){return null}set(l){const m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ne extends Ze{constructor(l){super(l),this.vao=l.extVertexArrayObject}getDefault(){return null}set(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)}}class ze extends Ze{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class ft extends Ze{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class wt extends Ze{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Ut extends Ze{constructor(l,m){super(l),this.context=l,this.parent=m}getDefault(){return null}}class Gt extends Ut{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Tt extends Ut{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,this.attachment(),m.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Ot extends Tt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class zt{constructor(l,m,b,I){this.context=l,this.width=m,this.height=b;const P=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new Gt(l,P),I&&(this.depthAttachment=new Tt(l,P))}destroy(){const l=this.context.gl,m=this.colorAttachment.get();if(m&&l.deleteTexture(m),this.depthAttachment){const b=this.depthAttachment.get();b&&l.deleteRenderbuffer(b)}l.deleteFramebuffer(this.framebuffer)}}class Pn{constructor(l,m=!1){if(this.gl=l,this.isWebGL2=m,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),m){const b=l;this.extVertexArrayObject={createVertexArrayOES:b.createVertexArray.bind(l),deleteVertexArrayOES:b.deleteVertexArray.bind(l),bindVertexArrayOES:b.bindVertexArray.bind(l)}}this.clearColor=new zn(this),this.clearDepth=new on(this),this.clearStencil=new mt(this),this.colorMask=new Ir(this),this.depthMask=new Fr(this),this.stencilMask=new qr(this),this.stencilFunc=new $t(this),this.stencilOp=new xr(this),this.stencilTest=new dr(this),this.depthRange=new ni(this),this.depthTest=new nn(this),this.depthFunc=new yn(this),this.blend=new sr(this),this.blendFunc=new Zn(this),this.blendColor=new $r(this),this.blendEquation=new qn(this),this.cullFace=new jr(this),this.cullFaceSide=new ir(this),this.frontFace=new Xn(this),this.program=new bi(this),this.activeTexture=new wr(this),this.viewport=new or(this),this.bindFramebuffer=new ui(this),this.bindRenderbuffer=new Kr(this),this.bindTexture=new wi(this),this.bindVertexBuffer=new si(this),this.bindElementBuffer=new vt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ne(this),this.pixelStoreUnpack=new ze(this),this.pixelStoreUnpackPremultiplyAlpha=new ft(this),this.pixelStoreUnpackFlipY=new wt(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),m||(this.extTextureHalfFloat=l.getExtension("OES_texture_half_float")),(m||this.extTextureHalfFloat&&l.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=m||l.getExtension("OES_standard_derivatives"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,m){return new Wt(this,l,m)}createVertexBuffer(l,m,b){return new Xt(this,l,m,b)}createRenderbuffer(l,m,b){const I=this.gl,P=I.createRenderbuffer();return this.bindRenderbuffer.set(P),I.renderbufferStorage(I.RENDERBUFFER,l,m,b),this.bindRenderbuffer.set(null),P}createFramebuffer(l,m,b){return new zt(this,l,m,b)}clear({color:l,depth:m,stencil:b}){const I=this.gl;let P=0;l&&(P|=I.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),m!==void 0&&(P|=I.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(m),this.depthMask.set(!0)),b!==void 0&&(P|=I.STENCIL_BUFFER_BIT,this.clearStencil.set(b),this.stencilMask.set(255)),I.clear(P)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){T(l.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Jn extends s.Evented{constructor(l,m,b,I){if(super(),this.id=l,this.dispatcher=b,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(m,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(I),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(l){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const m=Array.isArray(this.map._language)?this.map._language.join():this.map._language,b=this.map._worldview;this._tileJSONRequest=It(this._options,this.map._requestManager,m,b,((I,P)=>{this._tileJSONRequest=null,this._loaded=!0,I?(m&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${m}`),b&&b.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${b}`),this.fire(new s.ErrorEvent(I))):P&&(s.extend(this,P),P.bounds&&(this.tileBounds=new Oe(P.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(P.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(I)}))}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}loadTile(l,m){const b=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),I={request:this.map._requestManager.transformRequest(b,s.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(I.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=m:l.request=l.actor.send("reloadTile",I,P.bind(this));else if(l.actor=this._tileWorkers[b]=this._tileWorkers[b]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",I,P.bind(this),void 0,!0);else{const j=s.loadVectorTile.call({deduped:this._deduped},I,((W,Z)=>{W||!Z?P.call(this,W):(I.data={cacheControl:Z.cacheControl,expires:Z.expires,rawData:Z.rawData.slice(0)},l.actor&&l.actor.send("loadTile",I,P.bind(this),void 0,!0))}),!0);l.request={cancel:j}}function P(j,W){return delete l.request,l.aborted?m(null):j&&j.status!==404?m(j):(W&&W.resourceTiming&&(l.resourceTiming=W.resourceTiming),this.map._refreshExpiredTiles&&W&&l.setExpiryData(W),l.loadVectorData(W,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),m(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Fn extends s.Evented{constructor(l,m,b,I){super(),this.id=l,this.dispatcher=b,this.setEventedParent(I),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},m),s.extend(this,s.pick(m,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=It(this._options,this.map._requestManager,null,null,((m,b)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new s.ErrorEvent(m)):b&&(s.extend(this,b),b.bounds&&(this.tileBounds=new Oe(b.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(b.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(m)}))}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,m){const b=s.exported.devicePixelRatio>=2,I=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),b,this.tileSize);l.request=s.getImage(this.map._requestManager.transformRequest(I,s.ResourceType.Tile),((P,j,W,Z)=>(delete l.request,l.aborted?(l.state="unloaded",m(null)):P?(l.state="errored",m(P)):j?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:W,expires:Z}),l.setTexture(j,this.map.painter),l.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void m(null)):m(null))))}static loadTileData(l,m,b){l.setTexture(m,b)}static unloadTileData(l,m){l.texture&&m.saveTileTexture(l.texture)}abortTile(l,m){l.request&&(l.request.cancel(),delete l.request),m()}unloadTile(l,m){l.texture&&this.map.painter.saveTileTexture(l.texture),m()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Gr(x,l,m,b,I,P,j,W){const Z=[x,m,I,l,b,P,1,1,1],le=[j,W,1],ce=s.adjoint([],Z),[Ee,Fe,qe]=s.transformMat3(le,le,s.transpose(ce,ce));return s.multiply$1(Z,[Ee,0,0,0,Fe,0,0,0,qe],Z)}class Mr extends s.Evented{constructor(l,m,b,I){super(),this.id=l,this.dispatcher=b,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(I),this.options=m,this._dirty=!1}load(l,m){this._loaded=m||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),((b,I)=>{if(this._imageRequest=null,this._loaded=!0,b)this.fire(new s.ErrorEvent(b));else if(I){const{HTMLImageElement:P}=s.window;this.image=I instanceof P?s.exported.getImageData(I):I,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,l&&(this.coordinates=l),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(l){return this.image&&l.url?(this._imageRequest&&l.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=l.url,this.load(l.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(l){this.coordinates=l,this._boundsArray=void 0;const m=l.map(s.MercatorCoordinate.fromLngLat);return this.tileID=(function(b){let I=1/0,P=1/0,j=-1/0,W=-1/0;for(const Ee of b)I=Math.min(I,Ee.x),P=Math.min(P,Ee.y),j=Math.max(j,Ee.x),W=Math.max(W,Ee.y);const Z=Math.max(j-I,W-P),le=Math.max(0,Math.floor(-Math.log(Z)/Math.LN2)),ce=Math.pow(2,le);return new s.CanonicalTileID(le,Math.floor((I+j)/2*ce),Math.floor((P+W)/2*ce))})(m),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(l){for(const Z in this.tiles){const le=this.tiles[Z];le.state!=="loaded"&&(le.state="loaded",le.texture=this.texture)}if(this._boundsArray)return;const m=s.tileTransform(this.tileID,this.map.transform.projection),[b,I,P,j]=this.coordinates.map((Z=>{const le=m.projection.project(Z[0],Z[1]);return s.getTilePoint(m,le)._round()}));this.perspectiveTransform=(function(Z,le,ce,Ee,Fe,qe,at,et,lt,Ie){const rt=Gr(0,0,Z,0,0,le,Z,le),gt=Gr(ce,Ee,Fe,qe,at,et,lt,Ie);return s.multiply$1(gt,s.adjoint(rt,rt),gt),[gt[6]/gt[8]*Z/s.EXTENT,gt[7]/gt[8]*le/s.EXTENT]})(this.width,this.height,b.x,b.y,I.x,I.y,j.x,j.y,P.x,P.y);const W=this._boundsArray=new s.StructArrayLayout4i8;W.emplaceBack(b.x,b.y,0,0),W.emplaceBack(I.x,I.y,s.EXTENT,0),W.emplaceBack(j.x,j.y,0,s.EXTENT),W.emplaceBack(P.x,P.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=l.createVertexBuffer(W,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,m=l.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new s.Texture(l,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(l)}loadTile(l,m){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},m(null)):(l.state="errored",m(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Zr={vector:Jn,raster:Fn,"raster-dem":class extends Fn{constructor(x,l,m,b){super(x,l,m,b),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(x,l){const m=this.map._requestManager.normalizeTileURL(x.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function b(I,P){I&&(x.state="errored",l(I)),P&&(x.dem=P,x.dem.onDeserialize(),x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0,x.state="loaded",l(null))}x.request=s.getImage(this.map._requestManager.transformRequest(m,s.ResourceType.Tile),(function(I,P,j,W){if(delete x.request,x.aborted)x.state="unloaded",l(null);else if(I)x.state="errored",l(I);else if(P){this.map._refreshExpiredTiles&&x.setExpiryData({cacheControl:j,expires:W});const Z=s.window.ImageBitmap&&P instanceof s.window.ImageBitmap&&(Bi==null&&(Bi=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),Bi),le=1-(P.width-s.prevPowerOfTwo(P.width))/2;le<1||x.neighboringTiles||(x.neighboringTiles=this._getNeighboringTiles(x.tileID));const ce=Z?P:s.exported.getImageData(P,le),Ee={uid:x.uid,coord:x.tileID,source:this.id,rawImageData:ce,encoding:this.encoding,padding:le};x.actor&&x.state!=="expired"||(x.actor=this.dispatcher.getActor(),x.actor.send("loadDEMTile",Ee,b.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(x){const l=x.canonical,m=Math.pow(2,l.z),b=(l.x-1+m)%m,I=l.x===0?x.wrap-1:x.wrap,P=(l.x+1+m)%m,j=l.x+1===m?x.wrap+1:x.wrap,W={};return W[new s.OverscaledTileID(x.overscaledZ,I,l.z,b,l.y).key]={backfilled:!1},W[new s.OverscaledTileID(x.overscaledZ,j,l.z,P,l.y).key]={backfilled:!1},l.y>0&&(W[new s.OverscaledTileID(x.overscaledZ,I,l.z,b,l.y-1).key]={backfilled:!1},W[new s.OverscaledTileID(x.overscaledZ,x.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},W[new s.OverscaledTileID(x.overscaledZ,j,l.z,P,l.y-1).key]={backfilled:!1}),l.y+1<m&&(W[new s.OverscaledTileID(x.overscaledZ,I,l.z,b,l.y+1).key]={backfilled:!1},W[new s.OverscaledTileID(x.overscaledZ,x.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},W[new s.OverscaledTileID(x.overscaledZ,j,l.z,P,l.y+1).key]={backfilled:!1}),W}unloadTile(x){x.demTexture&&this.map.painter.saveTileTexture(x.demTexture),x.fbo&&(x.fbo.destroy(),delete x.fbo),x.dem&&delete x.dem,delete x.neighboringTiles,x.state="unloaded"}},geojson:class extends s.Evented{constructor(x,l,m,b){super(),this.id=x,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=m.getActor(),this.setEventedParent(b),this._data=l.data,this._options=s.extend({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const I=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*I,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*I,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:s.EXTENT,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*I,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(x){this.map=x,this.setData(this._data)}setData(x){return this._data=x,this._updateWorkerData(),this}getClusterExpansionZoom(x,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:x,source:this.id},l),this}getClusterChildren(x,l){return this.actor.send("geojson.getClusterChildren",{clusterId:x,source:this.id},l),this}getClusterLeaves(x,l,m,b){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:x,limit:l,offset:m},b),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const x=s.extend({},this.workerOptions),l=this._data;typeof l=="string"?(x.request=this.map._requestManager.transformRequest(s.exported.resolveURL(l),s.ResourceType.Source),x.request.collectResourceTiming=this._collectResourceTiming):x.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,x,((m,b)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new s.ErrorEvent(m));else{const I={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(I.resourceTiming=b.resourceTiming[this.id]),this.fire(new s.Event("data",I)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(x,l){const m=x.actor?"reloadTile":"loadTile";x.actor=this.actor,x.request=this.actor.send(m,{type:this.type,uid:x.uid,tileID:x.tileID,tileZoom:x.tileZoom,zoom:x.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((b,I)=>(delete x.request,x.unloadVectorData(),x.aborted?l(null):b?l(b):(x.loadVectorData(I,this.map.painter,m==="reloadTile"),l(null)))),void 0,m==="loadTile")}abortTile(x){x.request&&(x.request.cancel(),delete x.request),x.aborted=!0}unloadTile(x){x.unloadVectorData(),this.actor.send("removeTile",{uid:x.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Mr{constructor(x,l,m,b){super(x,l,m,b),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const x=this.options;this.urls=[];for(const l of x.urls)this.urls.push(this.map._requestManager.transformRequest(l,s.ResourceType.Source).url);s.getVideo(this.urls,((l,m)=>{this._loaded=!0,l?this.fire(new s.ErrorEvent(l)):m&&(this.video=m,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(x){if(this.video){const l=this.video.seekable;x<l.start(0)||x>l.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=x}}getVideo(){return this.video}onAdd(x){this.map||(this.map=x,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const x=this.map.painter.context,l=x.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(x,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(x)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Mr,canvas:class extends Mr{constructor(x,l,m,b){super(x,l,m,b),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some((I=>!Array.isArray(I)||I.length!==2||I.some((P=>typeof P!="number"))))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${x}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${x}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${x}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${x}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${x}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(x){this.map=x,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let x=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,x=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,x=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context;this.texture?(x||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const x of[this.canvas.width,this.canvas.height])if(isNaN(x)||x<=0)return!0;return!1}},custom:class extends s.Evented{constructor(x,l,m,b){super(),this.id=x,this.type="custom",this._dataType="raster",this._dispatcher=m,this._implementation=l,this.setEventedParent(b),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Oe(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(x){this._map=x,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(x),this.load()}onRemove(x){this._implementation.onRemove&&this._implementation.onRemove(x)}hasTile(x){if(this._implementation.hasTile){const{x:l,y:m,z:b}=x.canonical;return this._implementation.hasTile({x:l,y:m,z:b})}return!this.tileBounds||this.tileBounds.contains(x.canonical)}loadTile(x,l){const{x:m,y:b,z:I}=x.tileID.canonical,P=new s.window.AbortController;x.request=Promise.resolve(this._implementation.loadTile({x:m,y:b,z:I},{signal:P.signal})).then((function(j){return delete x.request,x.aborted?(x.state="unloaded",l(null)):j===void 0?(x.state="errored",l(null)):j===null?(this.loadTileData(x,{width:this.tileSize,height:this.tileSize,data:null}),x.state="loaded",l(null)):(function(W){return W instanceof s.window.ImageData||W instanceof s.window.HTMLCanvasElement||W instanceof s.window.ImageBitmap||W instanceof s.window.HTMLImageElement})(j)?(this.loadTileData(x,j),x.state="loaded",void l(null)):(x.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((j=>{j.code!==20&&(x.state="errored",l(j))})),x.request.cancel=()=>P.abort()}loadTileData(x,l){Fn.loadTileData(x,l,this._map.painter)}unloadTileData(x){Fn.unloadTileData(x,this._map.painter)}unloadTile(x,l){if(this.unloadTileData(x),this._implementation.unloadTile){const{x:m,y:b,z:I}=x.tileID.canonical;this._implementation.unloadTile({x:m,y:b,z:I})}l()}abortTile(x,l){x.request&&x.request.cancel&&(x.request.cancel(),delete x.request),l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((x=>({x:x.canonical.x,y:x.canonical.y,z:x.canonical.z})))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Br=function(x,l,m,b){const I=new Zr[l.type](x,l,m,b);if(I.id!==x)throw new Error(`Expected Source id to be ${x} instead of ${I.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],I),I};function zi(x,l){const m=s.identity([]);return s.scale(m,m,[.5*x.width,.5*-x.height,1]),s.translate(m,m,[1,-1,0]),s.multiply(m,m,x.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(m)}function ms(x,l,m,b,I,P,j,W=!1){const Z=x.tilesIn(b,j,W);Z.sort(cs);const le=[];for(const Ee of Z)le.push({wrappedTileID:Ee.tile.tileID.wrapped().key,queryResults:Ee.tile.queryRenderedFeatures(l,m,x._state,Ee,I,P,zi(x.transform,Ee.tile.tileID),W)});const ce=(function(Ee){const Fe={},qe={};for(const at of Ee){const et=at.queryResults,lt=at.wrappedTileID,Ie=qe[lt]=qe[lt]||{};for(const rt in et){const gt=et[rt],yt=Ie[rt]=Ie[rt]||{},Mt=Fe[rt]=Fe[rt]||[];for(const Dt of gt)yt[Dt.featureIndex]||(yt[Dt.featureIndex]=!0,Mt.push(Dt))}}return Fe})(le);for(const Ee in ce)ce[Ee].forEach((Fe=>{const qe=Fe.feature,at=qe.layer;at&&at.type!=="background"&&at.type!=="sky"&&(qe.source=at.source,at["source-layer"]&&(qe.sourceLayer=at["source-layer"]),qe.state=qe.id!==void 0?x.getFeatureState(at["source-layer"],qe.id):{})}));return ce}function Os(x,l){const m=x.getRenderableIds().map((P=>x.getTileByID(P))),b=[],I={};for(let P=0;P<m.length;P++){const j=m[P],W=j.tileID.canonical.key;I[W]||(I[W]=!0,j.querySourceFeatures(b,l))}return b}function cs(x,l){const m=x.tileID,b=l.tileID;return m.overscaledZ-b.overscaledZ||m.canonical.y-b.canonical.y||m.wrap-b.wrap||m.canonical.x-b.canonical.x}function ps(){return Bn.workerClass!=null?new Bn.workerClass:new s.window.Worker(Bn.workerUrl)}const vo="mapboxgl_preloaded_worker_pool";class is{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<is.workerCount;)this.workers.push(new ps);return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach((m=>{m.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[vo]}numActive(){return Object.keys(this.active).length}}let xo;function ua(){return xo||(xo=new is),xo}function tl(x,l){const m={};for(const b in x)b!=="ref"&&(m[b]=x[b]);return s.refProperties.forEach((b=>{b in l&&(m[b]=l[b])})),m}function Pa(x){x=x.slice();const l=Object.create(null);for(let m=0;m<x.length;m++)l[x[m].id]=x[m];for(let m=0;m<x.length;m++)"ref"in x[m]&&(x[m]=tl(x[m],l[x[m].ref]));return x}is.workerCount=2;const di={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function ou(x,l,m){m.push({command:di.addSource,args:[x,l[x]]})}function yc(x,l,m){l.push({command:di.removeSource,args:[x]}),m[x]=!0}function Ss(x,l,m,b){yc(x,m,b),ou(x,l,m)}function au(x,l,m){let b;for(b in x[m])if(x[m].hasOwnProperty(b)&&b!=="data"&&!T(x[m][b],l[m][b]))return!1;for(b in l[m])if(l[m].hasOwnProperty(b)&&b!=="data"&&!T(x[m][b],l[m][b]))return!1;return!0}function ga(x,l,m,b,I,P){let j;for(j in l=l||{},x=x||{})x.hasOwnProperty(j)&&(T(x[j],l[j])||m.push({command:P,args:[b,j,l[j],I]}));for(j in l)l.hasOwnProperty(j)&&!x.hasOwnProperty(j)&&(T(x[j],l[j])||m.push({command:P,args:[b,j,l[j],I]}))}function uo(x){return x.id}function nl(x,l){return x[l.id]=l,x}class Kl{constructor(l,m){this.reset(l,m)}reset(l,m){this.points=l||[],this._distances=[0];for(let b=1;b<this.points.length;b++)this._distances[b]=this._distances[b-1]+this.points[b].dist(this.points[b-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(m||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=s.clamp(l,0,1);let m=1,b=this._distances[m];const I=l*this.paddedLength+this.padding;for(;b<I&&m<this._distances.length;)b=this._distances[++m];const P=m-1,j=this._distances[P],W=b-j,Z=W>0?(I-j)/W:0;return this.points[P].mult(1-Z).add(this.points[m].mult(Z))}}class ea{constructor(l,m,b){const I=this.boxCells=[],P=this.circleCells=[];this.xCellCount=Math.ceil(l/b),this.yCellCount=Math.ceil(m/b);for(let j=0;j<this.xCellCount*this.yCellCount;j++)I.push([]),P.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=m,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/m,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,m,b,I,P){this._forEachCell(m,b,I,P,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(I),this.bboxes.push(P)}insertCircle(l,m,b,I){this._forEachCell(m-I,b-I,m+I,b+I,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(m),this.circles.push(b),this.circles.push(I)}_insertBoxCell(l,m,b,I,P,j){this.boxCells[P].push(j)}_insertCircleCell(l,m,b,I,P,j){this.circleCells[P].push(j)}_query(l,m,b,I,P,j){if(b<0||l>this.width||I<0||m>this.height)return!P&&[];const W=[];if(l<=0&&m<=0&&this.width<=b&&this.height<=I){if(P)return!0;for(let Z=0;Z<this.boxKeys.length;Z++)W.push({key:this.boxKeys[Z],x1:this.bboxes[4*Z],y1:this.bboxes[4*Z+1],x2:this.bboxes[4*Z+2],y2:this.bboxes[4*Z+3]});for(let Z=0;Z<this.circleKeys.length;Z++){const le=this.circles[3*Z],ce=this.circles[3*Z+1],Ee=this.circles[3*Z+2];W.push({key:this.circleKeys[Z],x1:le-Ee,y1:ce-Ee,x2:le+Ee,y2:ce+Ee})}return j?W.filter(j):W}return this._forEachCell(l,m,b,I,this._queryCell,W,{hitTest:P,seenUids:{box:{},circle:{}}},j),P?W.length>0:W}_queryCircle(l,m,b,I,P){const j=l-b,W=l+b,Z=m-b,le=m+b;if(W<0||j>this.width||le<0||Z>this.height)return!I&&[];const ce=[];return this._forEachCell(j,Z,W,le,this._queryCellCircle,ce,{hitTest:I,circle:{x:l,y:m,radius:b},seenUids:{box:{},circle:{}}},P),I?ce.length>0:ce}query(l,m,b,I,P){return this._query(l,m,b,I,!1,P)}hitTest(l,m,b,I,P){return this._query(l,m,b,I,!0,P)}hitTestCircle(l,m,b,I){return this._queryCircle(l,m,b,!0,I)}_queryCell(l,m,b,I,P,j,W,Z){const le=W.seenUids,ce=this.boxCells[P];if(ce!==null){const Fe=this.bboxes;for(const qe of ce)if(!le.box[qe]){le.box[qe]=!0;const at=4*qe;if(l<=Fe[at+2]&&m<=Fe[at+3]&&b>=Fe[at+0]&&I>=Fe[at+1]&&(!Z||Z(this.boxKeys[qe]))){if(W.hitTest)return j.push(!0),!0;j.push({key:this.boxKeys[qe],x1:Fe[at],y1:Fe[at+1],x2:Fe[at+2],y2:Fe[at+3]})}}}const Ee=this.circleCells[P];if(Ee!==null){const Fe=this.circles;for(const qe of Ee)if(!le.circle[qe]){le.circle[qe]=!0;const at=3*qe;if(this._circleAndRectCollide(Fe[at],Fe[at+1],Fe[at+2],l,m,b,I)&&(!Z||Z(this.circleKeys[qe]))){if(W.hitTest)return j.push(!0),!0;{const et=Fe[at],lt=Fe[at+1],Ie=Fe[at+2];j.push({key:this.circleKeys[qe],x1:et-Ie,y1:lt-Ie,x2:et+Ie,y2:lt+Ie})}}}}}_queryCellCircle(l,m,b,I,P,j,W,Z){const le=W.circle,ce=W.seenUids,Ee=this.boxCells[P];if(Ee!==null){const qe=this.bboxes;for(const at of Ee)if(!ce.box[at]){ce.box[at]=!0;const et=4*at;if(this._circleAndRectCollide(le.x,le.y,le.radius,qe[et+0],qe[et+1],qe[et+2],qe[et+3])&&(!Z||Z(this.boxKeys[at])))return j.push(!0),!0}}const Fe=this.circleCells[P];if(Fe!==null){const qe=this.circles;for(const at of Fe)if(!ce.circle[at]){ce.circle[at]=!0;const et=3*at;if(this._circlesCollide(qe[et],qe[et+1],qe[et+2],le.x,le.y,le.radius)&&(!Z||Z(this.circleKeys[at])))return j.push(!0),!0}}}_forEachCell(l,m,b,I,P,j,W,Z){const le=this._convertToXCellCoord(l),ce=this._convertToYCellCoord(m),Ee=this._convertToXCellCoord(b),Fe=this._convertToYCellCoord(I);for(let qe=le;qe<=Ee;qe++)for(let at=ce;at<=Fe;at++)if(P.call(this,l,m,b,I,this.xCellCount*at+qe,j,W,Z))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,m,b,I,P,j){const W=I-l,Z=P-m,le=b+j;return le*le>W*W+Z*Z}_circleAndRectCollide(l,m,b,I,P,j,W){const Z=(j-I)/2,le=Math.abs(l-(I+Z));if(le>Z+b)return!1;const ce=(W-P)/2,Ee=Math.abs(m-(P+ce));if(Ee>ce+b)return!1;if(le<=Z||Ee<=ce)return!0;const Fe=le-Z,qe=Ee-ce;return Fe*Fe+qe*qe<=b*b}}const Wo={unknown:0,flipRequired:1,flipNotRequired:2},ta=Math.tan(85*Math.PI/180);function En(x,l,m,b,I,P,j){const W=s.create();if(m)if(P.name==="globe"){const Z=s.calculateGlobeLabelMatrix(I,l);s.multiply(W,W,Z)}else{const Z=Y([],j);W[0]=Z[0],W[1]=Z[1],W[4]=Z[2],W[5]=Z[3],b||s.rotateZ(W,W,I.angle)}else s.multiply(W,I.labelPlaneMatrix,x);return W}function co(x,l,m,b,I,P,j){const W=En(x,l,m,b,I,P,j);return P.name==="globe"&&m||(W[2]=W[6]=W[10]=W[14]=0),W}function Io(x,l,m,b,I,P,j){if(m){if(P.name==="globe"){const W=En(x,l,m,b,I,P,j);return s.invert(W,W),s.multiply(W,x,W),W}{const W=s.clone(x),Z=s.identity([]);return Z[0]=j[0],Z[1]=j[1],Z[4]=j[2],Z[5]=j[3],s.multiply(W,W,Z),b||s.rotateZ(W,W,-I.angle),W}}return I.glCoordMatrix}function Ni(x,l,m,b){const I=[x,l,m,1];m?s.transformMat4$1(I,I,b):Ri(I,I,b);const P=I[3];return I[0]/=P,I[1]/=P,I[2]/=P,I}function ic(x,l){return Math.min(.5+x/l*.5,1.5)}function rl(x,l){const m=x[0]/x[3],b=x[1]/x[3];return m>=-l[0]&&m<=l[0]&&b>=-l[1]&&b<=l[1]}function il(x,l,m,b,I,P,j,W,Z,le){const ce=m.transform,Ee=b?x.textSizeData:x.iconSizeData,Fe=s.evaluateSizeForZoom(Ee,m.transform.zoom),qe=ce.projection.name==="globe",at=[256/m.width*2+1,256/m.height*2+1],et=b?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;et.clear();let lt=null;qe&&(lt=b?x.text.globeExtVertexArray:x.icon.globeExtVertexArray);const Ie=x.lineVertexArray,rt=b?x.text.placedSymbolArray:x.icon.placedSymbolArray,gt=m.transform.width/m.transform.height;let yt,Mt=!1;for(let Dt=0;Dt<rt.length;Dt++){const Nt=rt.get(Dt),{numGlyphs:qt,writingMode:Bt}=Nt;if(Bt!==s.WritingMode.vertical||Mt||yt===s.WritingMode.horizontal||(Mt=!0),yt=Bt,(Nt.hidden||Bt===s.WritingMode.vertical)&&!Mt){$a(qt,et);continue}Mt=!1;const rn=new s.Point(Nt.tileAnchorX,Nt.tileAnchorY);let{x:Rn,y:Jt,z:An}=ce.projection.projectTilePoint(rn.x,rn.y,le.canonical);if(Z){const[ei,Er,gr]=Z(rn);Rn+=ei,Jt+=Er,An+=gr}const cn=[Rn,Jt,An,1];if(s.transformMat4$1(cn,cn,l),!rl(cn,at)){$a(qt,et);continue}const Vn=ic(m.transform.cameraToCenterDistance,cn[3]),tn=s.evaluateSizeForFeature(Ee,Fe,Nt),bn=j?tn/Vn:tn*Vn,Un=Ni(Rn,Jt,An,I);if(Un[3]<=0){$a(qt,et);continue}let In={};const Wn=j?null:Z,Nr=lr(Nt,bn,!1,W,l,I,P,x.glyphOffsetArray,Ie,et,lt,Un,rn,In,gt,Wn,ce.projection,le,j);Mt=Nr.useVertical,Wn&&Nr.needsFlipping&&(In={}),(Nr.notEnoughRoom||Mt||Nr.needsFlipping&&lr(Nt,bn,!0,W,l,I,P,x.glyphOffsetArray,Ie,et,lt,Un,rn,In,gt,Wn,ce.projection,le,j).notEnoughRoom)&&$a(qt,et)}b?(x.text.dynamicLayoutVertexBuffer.updateData(et),lt&&x.text.globeExtVertexBuffer.updateData(lt)):(x.icon.dynamicLayoutVertexBuffer.updateData(et),lt&&x.icon.globeExtVertexBuffer.updateData(lt))}function Ga(x,l,m,b,I,P,j,W,Z,le,ce,Ee,Fe,qe,at,et){const{lineStartIndex:lt,glyphStartIndex:Ie,segment:rt}=W,gt=Ie+W.numGlyphs,yt=lt+W.lineLength,Mt=l.getoffsetX(Ie),Dt=l.getoffsetX(gt-1),Nt=ca(x*Mt,m,b,I,P,j,rt,lt,yt,Z,le,ce,Ee,Fe,!0,qe,at,et);if(!Nt)return null;const qt=ca(x*Dt,m,b,I,P,j,rt,lt,yt,Z,le,ce,Ee,Fe,!0,qe,at,et);return qt?{first:Nt,last:qt}:null}function ho(x,l,m,b){return x===s.WritingMode.horizontal&&Math.abs(b)>Math.abs(m)?{useVertical:!0}:x===s.WritingMode.vertical?b>0?{needsFlipping:!0}:null:l!==Wo.unknown&&(function(I,P){return I===0||Math.abs(P/I)>ta})(m,b)?l===Wo.flipRequired?{needsFlipping:!0}:null:m<0?{needsFlipping:!0}:null}function lr(x,l,m,b,I,P,j,W,Z,le,ce,Ee,Fe,qe,at,et,lt,Ie,rt){const gt=l/24,yt=x.lineOffsetX*gt,Mt=x.lineOffsetY*gt,{lineStartIndex:Dt,glyphStartIndex:Nt,numGlyphs:qt,segment:Bt,writingMode:rn,flipState:Rn}=x,Jt=Dt+x.lineLength,An=cn=>{if(ce){const[Un,In,Wn]=cn.up,Nr=le.length;s.updateGlobeVertexNormal(ce,Nr+0,Un,In,Wn),s.updateGlobeVertexNormal(ce,Nr+1,Un,In,Wn),s.updateGlobeVertexNormal(ce,Nr+2,Un,In,Wn),s.updateGlobeVertexNormal(ce,Nr+3,Un,In,Wn)}const[Vn,tn,bn]=cn.point;s.addDynamicAttributes(le,Vn,tn,bn,cn.angle)};if(qt>1){const cn=Ga(gt,W,yt,Mt,m,Ee,Fe,x,Z,P,qe,et,!1,lt,Ie,rt);if(!cn)return{notEnoughRoom:!0};if(b&&!m){let[Vn,tn,bn]=cn.first.point,[Un,In,Wn]=cn.last.point;[Vn,tn]=Ni(Vn,tn,bn,j),[Un,In]=Ni(Un,In,Wn,j);const Nr=ho(rn,Rn,(Un-Vn)*at,In-tn);if(x.flipState=Nr&&Nr.needsFlipping?Wo.flipRequired:Wo.flipNotRequired,Nr)return Nr}An(cn.first);for(let Vn=Nt+1;Vn<Nt+qt-1;Vn++){const tn=ca(gt*W.getoffsetX(Vn),yt,Mt,m,Ee,Fe,Bt,Dt,Jt,Z,P,qe,et,!1,!1,lt,Ie,rt);if(!tn)return le.length-=4*(Vn-Nt),{notEnoughRoom:!0};An(tn)}An(cn.last)}else{if(b&&!m){const Vn=Ni(Fe.x,Fe.y,0,I),tn=Dt+Bt+1,bn=new s.Point(Z.getx(tn),Z.gety(tn)),Un=Ni(bn.x,bn.y,0,I),In=Un[3]>0?Un:Ur(Fe,bn,Vn,1,I,void 0,lt,Ie.canonical),Wn=ho(rn,Rn,(In[0]-Vn[0])*at,In[1]-Vn[1]);if(x.flipState=Wn&&Wn.needsFlipping?Wo.flipRequired:Wo.flipNotRequired,Wn)return Wn}const cn=ca(gt*W.getoffsetX(Nt),yt,Mt,m,Ee,Fe,Bt,Dt,Jt,Z,P,qe,et,!1,!1,lt,Ie,rt);if(!cn)return{notEnoughRoom:!0};An(cn)}return{}}function Wr(x,l,m,b,I){const{x:P,y:j,z:W}=b.projectTilePoint(x.x,x.y,l);if(!I)return Ni(P,j,W,m);const[Z,le,ce]=I(x);return Ni(P+Z,j+le,W+ce,m)}function Ur(x,l,m,b,I,P,j,W){const Z=Wr(x.sub(l)._unit()._add(x),W,I,j,P);return s.sub(Z,m,Z),s.normalize(Z,Z),s.scaleAndAdd(Z,m,Z,b)}function ca(x,l,m,b,I,P,j,W,Z,le,ce,Ee,Fe,qe,at,et,lt,Ie){const rt=b?x-l:x+l;let gt=rt>0?1:-1,yt=0;b&&(gt*=-1,yt=Math.PI),gt<0&&(yt+=Math.PI);let Mt=W+j+(gt>0?0:1)|0,Dt=I,Nt=I,qt=0,Bt=0;const rn=Math.abs(rt),Rn=[],Jt=[];let An=P,cn=An;const Vn=()=>Ur(cn,An,Nt,rn-qt+1,ce,Fe,et,lt.canonical);for(;qt+Bt<=rn;){if(Mt+=gt,Mt<W||Mt>=Z)return null;if(Nt=Dt,cn=An,Rn.push(Nt),qe&&Jt.push(cn),An=new s.Point(le.getx(Mt),le.gety(Mt)),Dt=Ee[Mt],!Dt){const gr=Wr(An,lt.canonical,ce,et,Fe);Dt=gr[3]>0?Ee[Mt]=gr:Vn()}qt+=Bt,Bt=s.distance(Nt,Dt)}at&&Fe&&(Ee[Mt]&&(Dt=Vn(),Bt=s.distance(Nt,Dt)),Ee[Mt]=Dt);const tn=(rn-qt)/Bt,bn=An.sub(cn)._mult(tn)._add(cn),Un=s.sub([],Dt,Nt),In=s.scaleAndAdd([],Nt,Un,tn);let Wn=[0,0,1],Nr=Un[0],ei=Un[1];if(Ie&&(Wn=et.upVector(lt.canonical,bn.x,bn.y),Wn[0]!==0||Wn[1]!==0||Wn[2]!==1)){const gr=[Wn[2],0,-Wn[0]],Ai=s.cross([],Wn,gr);s.normalize(gr,gr),s.normalize(Ai,Ai),Nr=s.dot(Un,gr),ei=s.dot(Un,Ai)}if(m){const gr=s.cross([],Wn,Un);s.normalize(gr,gr),s.scaleAndAdd(In,In,gr,m*gt)}const Er=yt+Math.atan2(ei,Nr);return Rn.push(In),qe&&Jt.push(bn),{point:In,angle:Er,path:Rn,tilePath:Jt,up:Wn}}function $a(x,l){const m=l.length,b=m+4*x;l.resize(b),l.float32.fill(-1/0,4*m,4*b)}function Ri(x,l,m){const b=l[0],I=l[1];return x[0]=m[0]*b+m[4]*I+m[12],x[1]=m[1]*b+m[5]*I+m[13],x[3]=m[3]*b+m[7]*I+m[15],x}const Hi=100;class Tl{constructor(l,m,b=new ea(l.width+200,l.height+200,25),I=new ea(l.width+200,l.height+200,25)){this.transform=l,this.grid=b,this.ignoredGrid=I,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Hi,this.screenBottomBoundary=l.height+Hi,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=m}placeCollisionBox(l,m,b,I,P,j,W,Z){let le=b.projectedAnchorX,ce=b.projectedAnchorY,Ee=b.projectedAnchorZ;const Fe=b.elevation,qe=b.tileID,at=l.getProjection();if(Fe&&qe){const[Dt,Nt,qt]=at.upVector(qe.canonical,b.tileAnchorX,b.tileAnchorY),Bt=at.upVectorScale(qe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;le+=Dt*Fe*Bt,ce+=Nt*Fe*Bt,Ee+=qt*Fe*Bt}const et=this.projectAndGetPerspectiveRatio(W,le,ce,Ee,b.tileID,at.name==="globe"||!!Fe||this.transform.pitch>0,at),lt=j*et.perspectiveRatio,Ie=(b.x1*m+I.x-b.padding)*lt+et.point.x,rt=(b.y1*m+I.y-b.padding)*lt+et.point.y,gt=(b.x2*m+I.x+b.padding)*lt+et.point.x,yt=(b.y2*m+I.y+b.padding)*lt+et.point.y,Mt=et.perspectiveRatio<=.55||et.occluded;return!this.isInsideGrid(Ie,rt,gt,yt)||!P&&this.grid.hitTest(Ie,rt,gt,yt,Z)||Mt?{box:[],offscreen:!1,occluded:et.occluded}:{box:[Ie,rt,gt,yt],offscreen:this.isOffscreen(Ie,rt,gt,yt),occluded:!1}}placeCollisionCircles(l,m,b,I,P,j,W,Z,le,ce,Ee,Fe,qe,at,et){const lt=[],Ie=this.transform.elevation,rt=l.getProjection(),gt=Ie?Ie.getAtTileOffsetFunc(et,this.transform.center.lat,this.transform.worldSize,rt):null,yt=new s.Point(b.tileAnchorX,b.tileAnchorY);let{x:Mt,y:Dt,z:Nt}=rt.projectTilePoint(yt.x,yt.y,et.canonical);if(gt){const[bn,Un,In]=gt(yt);Mt+=bn,Dt+=Un,Nt+=In}const qt=rt.name==="globe",Bt=this.projectAndGetPerspectiveRatio(W,Mt,Dt,Nt,et,qt||!!Ie||this.transform.pitch>0,rt),{perspectiveRatio:rn}=Bt,Rn=(Ee?j/rn:j*rn)/s.ONE_EM,Jt=Ni(Mt,Dt,Nt,Z),An=Bt.signedDistanceFromCamera>0?Ga(Rn,P,b.lineOffsetX*Rn,b.lineOffsetY*Rn,!1,Jt,yt,b,I,Z,{},Ie&&!Ee?gt:null,Ee&&!!Ie,rt,et,Ee):null;let cn=!1,Vn=!1,tn=!0;if(An&&!Bt.occluded){const bn=.5*qe*rn+at,Un=new s.Point(-100,-100),In=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),Wn=new Kl,{first:Nr,last:ei}=An,Er=Nr.path.length;let gr=[];for(let Vr=Er-1;Vr>=1;Vr--)gr.push(Nr.path[Vr]);for(let Vr=1;Vr<ei.path.length;Vr++)gr.push(ei.path[Vr]);const Ai=2.5*bn;le&&(gr=gr.map((([Vr,Yi,Ki],ts)=>(gt&&!qt&&(Ki=gt(ts<Er-1?Nr.tilePath[Er-1-ts]:ei.tilePath[ts-Er+2])[2]),Ni(Vr,Yi,Ki,le)))),gr.some((Vr=>Vr[3]<=0))&&(gr=[]));let Mi=[];if(gr.length>0){let Vr=1/0,Yi=-1/0,Ki=1/0,ts=-1/0;for(const Gs of gr)Vr=Math.min(Vr,Gs[0]),Ki=Math.min(Ki,Gs[1]),Yi=Math.max(Yi,Gs[0]),ts=Math.max(ts,Gs[1]);Yi>=Un.x&&Vr<=In.x&&ts>=Un.y&&Ki<=In.y&&(Mi=[gr.map((Gs=>new s.Point(Gs[0],Gs[1])))],(Vr<Un.x||Yi>In.x||Ki<Un.y||ts>In.y)&&(Mi=s.clipLine(Mi,Un.x,Un.y,In.x,In.y)))}for(const Vr of Mi){Wn.reset(Vr,.25*bn);let Yi=0;Yi=Wn.length<=.5*bn?1:Math.ceil(Wn.paddedLength/Ai)+1;for(let Ki=0;Ki<Yi;Ki++){const ts=Ki/Math.max(Yi-1,1),Gs=Wn.lerp(ts),wa=Gs.x+Hi,$o=Gs.y+Hi;lt.push(wa,$o,bn,0);const Bu=wa-bn,Yu=$o-bn,Zi=wa+bn,ks=$o+bn;if(tn=tn&&this.isOffscreen(Bu,Yu,Zi,ks),Vn=Vn||this.isInsideGrid(Bu,Yu,Zi,ks),!m&&this.grid.hitTestCircle(wa,$o,bn,Fe)&&(cn=!0,!ce))return{circles:[],offscreen:!1,collisionDetected:cn,occluded:!1}}}}return{circles:!ce&&cn||!Vn?[]:lt,offscreen:tn,collisionDetected:cn,occluded:Bt.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const m=[];let b=1/0,I=1/0,P=-1/0,j=-1/0;for(const ce of l){const Ee=new s.Point(ce.x+Hi,ce.y+Hi);b=Math.min(b,Ee.x),I=Math.min(I,Ee.y),P=Math.max(P,Ee.x),j=Math.max(j,Ee.y),m.push(Ee)}const W=this.grid.query(b,I,P,j).concat(this.ignoredGrid.query(b,I,P,j)),Z={},le={};for(const ce of W){const Ee=ce.key;if(Z[Ee.bucketInstanceId]===void 0&&(Z[Ee.bucketInstanceId]={}),Z[Ee.bucketInstanceId][Ee.featureIndex])continue;const Fe=[new s.Point(ce.x1,ce.y1),new s.Point(ce.x2,ce.y1),new s.Point(ce.x2,ce.y2),new s.Point(ce.x1,ce.y2)];s.polygonIntersectsPolygon(m,Fe)&&(Z[Ee.bucketInstanceId][Ee.featureIndex]=!0,le[Ee.bucketInstanceId]===void 0&&(le[Ee.bucketInstanceId]=[]),le[Ee.bucketInstanceId].push(Ee.featureIndex))}return le}insertCollisionBox(l,m,b,I,P){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:I,collisionGroupID:P},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,m,b,I,P){const j=m?this.ignoredGrid:this.grid,W={bucketInstanceId:b,featureIndex:I,collisionGroupID:P};for(let Z=0;Z<l.length;Z+=4)j.insertCircle(W,l[Z],l[Z+1],l[Z+2])}projectAndGetPerspectiveRatio(l,m,b,I,P,j,W){const Z=[m,b,I,1];let le=!1;I||this.transform.pitch>0?(s.transformMat4$1(Z,Z,l),this.fogState&&P&&W.name!=="globe"&&(le=(function(Fe,qe,at,et,lt,Ie){const rt=Ie.calculateFogTileMatrix(lt),gt=[qe,at,et];return s.transformMat4(gt,gt,rt),Ue(Fe,gt,Ie.pitch,Ie._fov)})(this.fogState,m,b,I,P.toUnwrapped(),this.transform)>.9)):Ri(Z,Z,l);const ce=Z[3];return{point:new s.Point((Z[0]/ce+1)/2*this.transform.width+Hi,(-Z[1]/ce+1)/2*this.transform.height+Hi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(W)/ce*.5,1.5),signedDistanceFromCamera:ce,occluded:j&&Z[2]>ce||le}}isOffscreen(l,m,b,I){return b<Hi||l>=this.screenRightBoundary||I<Hi||m>this.screenBottomBoundary}isInsideGrid(l,m,b,I){return b>=0&&l<this.gridRightBoundary&&I>=0&&m<this.gridBottomBoundary}getViewportMatrix(){const l=s.identity([]);return s.translate(l,l,[-100,-100,0]),l}}function Wi(x,l,m){const b=l.createTileMatrix(x,x.worldSize,m.toUnwrapped());return s.multiply(new Float32Array(16),x.projMatrix,b)}function ko(x,l,m){if(l.projection.name===m.projection.name)return x.projMatrix;const b=m.clone();return b.setProjection(l.projection),Wi(b,l.getProjection(),x)}function ss(x,l,m){return l.name===m.projection.name?x.projMatrix:Wi(m,l,x)}class $u{constructor(l,m,b,I){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?m:-m))):I&&b?1:0,this.placed=b}isHidden(){return this.opacity===0&&!this.placed}}class lu{constructor(l,m,b,I,P,j=!1){this.text=new $u(l?l.text:null,m,b,P),this.icon=new $u(l?l.icon:null,m,I,P),this.clipped=j}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class mu{constructor(l,m,b,I=!1){this.text=l,this.icon=m,this.skipFade=b,this.clipped=I}}class Us{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Ha{constructor(l,m,b,I,P){this.bucketInstanceId=l,this.featureIndex=m,this.sourceLayerIndex=b,this.bucketIndex=I,this.tileID=P}}class sl{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const m=++this.maxGroupID;this.collisionGroups[l]={ID:m,predicate:b=>b.collisionGroupID===m}}return this.collisionGroups[l]}}function Vo(x,l,m,b,I){const{horizontalAlign:P,verticalAlign:j}=s.getAnchorAlignment(x),W=-(P-.5)*l,Z=-(j-.5)*m,le=s.evaluateVariableOffset(x,b);return new s.Point(W+le[0]*I,Z+le[1]*I)}function Ei(x,l,m,b,I){const P=new s.Point(x,l);return m&&P._rotate(b?I:-I),P}class bo{constructor(l,m,b,I,P){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new Tl(this.transform,P),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new sl(b),this.collisionCircleArrays={},this.prevPlacement=I,I&&(I.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,m,b,I){const P=b.getBucket(m),j=b.latestFeatureIndex;if(!P||!j||m.id!==P.layerIds[0])return;const W=P.layers[0].layout,Z=b.collisionBoxArray,le=Math.pow(2,this.transform.zoom-b.tileID.overscaledZ),ce=b.tileSize/s.EXTENT,Ee=b.tileID.toUnwrapped();this.transform.setProjection(P.projection);const Fe=(qe=b.tileID,at=P.getProjection(),et=this.transform,at.name===this.projection?et.calculateProjMatrix(qe.toUnwrapped()):Wi(et,at,qe));var qe,at,et;const lt=W.get("text-pitch-alignment")==="map",Ie=W.get("text-rotation-alignment")==="map";m.compileFilter();const rt=m.dynamicFilter(),gt=m.dynamicFilterNeedsFeature(),yt=this.transform.calculatePixelsToTileUnitsMatrix(b),Mt=co(Fe,b.tileID.canonical,lt,Ie,this.transform,P.getProjection(),yt);let Dt=null;if(lt){const Bt=Io(Fe,b.tileID.canonical,lt,Ie,this.transform,P.getProjection(),yt);Dt=s.multiply([],this.transform.labelPlaneMatrix,Bt)}let Nt=null;rt&&b.latestFeatureIndex&&(Nt={unwrappedTileID:Ee,dynamicFilter:rt,dynamicFilterNeedsFeature:gt,featureIndex:b.latestFeatureIndex}),this.retainedQueryData[P.bucketInstanceId]=new Ha(P.bucketInstanceId,j,P.sourceLayerIndex,P.index,b.tileID);const qt={bucket:P,layout:W,posMatrix:Fe,textLabelPlaneMatrix:Mt,labelToScreenMatrix:Dt,clippingData:Nt,scale:le,textPixelRatio:ce,holdingForFade:b.holdingForFade(),collisionBoxArray:Z,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(P.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(P.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(P.sourceID)};if(I)for(const Bt of P.sortKeyRanges){const{sortKey:rn,symbolInstanceStart:Rn,symbolInstanceEnd:Jt}=Bt;l.push({sortKey:rn,symbolInstanceStart:Rn,symbolInstanceEnd:Jt,parameters:qt})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:P.symbolInstances.length,parameters:qt})}attemptAnchorPlacement(l,m,b,I,P,j,W,Z,le,ce,Ee,Fe,qe,at,et,lt,Ie,rt){const{textOffset0:gt,textOffset1:yt,crossTileID:Mt}=Fe,Dt=[gt,yt],Nt=Vo(l,b,I,Dt,P),qt=this.collisionIndex.placeCollisionBox(at,P,m,Ei(Nt.x,Nt.y,j,W,this.transform.angle),Ee,Z,le,ce.predicate);if(lt){const Bt=at.getSymbolInstanceIconSize(rt,this.transform.zoom,Fe.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(at,Bt,lt,Ei(Nt.x,Nt.y,j,W,this.transform.angle),Ee,Z,le,ce.predicate).box.length===0)return}if(qt.box.length>0){let Bt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Mt]&&this.prevPlacement.placements[Mt]&&this.prevPlacement.placements[Mt].text&&(Bt=this.prevPlacement.variableOffsets[Mt].anchor),this.variableOffsets[Mt]={textOffset:Dt,width:b,height:I,anchor:l,textScale:P,prevAnchor:Bt},this.markUsedJustification(at,l,Fe,et),at.allowVerticalPlacement&&(this.markUsedOrientation(at,et,Fe),this.placedOrientations[Mt]=et),{shift:Nt,placedGlyphBoxes:qt}}}placeLayerBucketPart(l,m,b,I){const{bucket:P,layout:j,posMatrix:W,textLabelPlaneMatrix:Z,labelToScreenMatrix:le,clippingData:ce,textPixelRatio:Ee,holdingForFade:Fe,collisionBoxArray:qe,partiallyEvaluatedTextSize:at,partiallyEvaluatedIconSize:et,collisionGroup:lt}=l.parameters,Ie=j.get("text-optional"),rt=j.get("icon-optional"),gt=j.get("text-allow-overlap"),yt=j.get("icon-allow-overlap"),Mt=j.get("text-rotation-alignment")==="map",Dt=j.get("text-pitch-alignment")==="map",Nt=j.get("icon-text-fit")!=="none",qt=j.get("symbol-z-order")==="viewport-y";this.transform.setProjection(P.projection);let Bt=gt&&(yt||!P.hasIconData()||rt),rn=yt&&(gt||!P.hasTextData()||Ie);!P.collisionArrays&&qe&&P.deserializeCollisionBoxes(qe),b&&I&&P.updateCollisionDebugBuffers(this.transform.zoom,qe);const Rn=(Jt,An,cn)=>{const{crossTileID:Vn,numVerticalGlyphVertices:tn}=Jt;if(ce){const Zi={zoom:this.transform.zoom,pitch:this.transform.pitch};let ks=null;if(ce.dynamicFilterNeedsFeature){const $s=this.retainedQueryData[P.bucketInstanceId];ks=ce.featureIndex.loadFeature({featureIndex:Jt.featureIndex,bucketIndex:$s.bucketIndex,sourceLayerIndex:$s.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,ce.dynamicFilter)(Zi,ks,this.retainedQueryData[P.bucketInstanceId].tileID.canonical,new s.Point(Jt.tileAnchorX,Jt.tileAnchorY),this.transform.calculateDistanceTileData(ce.unwrappedTileID)))return this.placements[Vn]=new mu(!1,!1,!1,!0),void m.add(Vn)}if(m.has(Vn))return;if(Fe)return void(this.placements[Vn]=new mu(!1,!1,!1));let bn=!1,Un=!1,In=!0,Wn=!1,Nr=!1,ei=null,Er={box:null,offscreen:null,occluded:null},gr={box:null},Ai=null,Mi=null,Vr=null,Yi=0,Ki=0,ts=0;cn.textFeatureIndex?Yi=cn.textFeatureIndex:Jt.useRuntimeCollisionCircles&&(Yi=Jt.featureIndex),cn.verticalTextFeatureIndex&&(Ki=cn.verticalTextFeatureIndex);const Gs=Zi=>{Zi.tileID=this.retainedQueryData[P.bucketInstanceId].tileID;const ks=this.transform.elevation;(ks||Zi.elevation)&&(Zi.elevation=ks?ks.getAtTileOffset(Zi.tileID,Zi.tileAnchorX,Zi.tileAnchorY):0)},wa=cn.textBox;if(wa){Gs(wa);const Zi=$s=>{let Sa=s.WritingMode.horizontal;if(P.allowVerticalPlacement&&!$s&&this.prevPlacement){const Gl=this.prevPlacement.placedOrientations[Vn];Gl&&(this.placedOrientations[Vn]=Gl,Sa=Gl,this.markUsedOrientation(P,Sa,Jt))}return Sa},ks=($s,Sa)=>{if(P.allowVerticalPlacement&&tn>0&&cn.verticalTextBox){for(const Gl of P.writingModes)if(Gl===s.WritingMode.vertical?(Er=Sa(),gr=Er):Er=$s(),Er&&Er.box&&Er.box.length)break}else Er=$s()};if(j.get("text-variable-anchor")){let $s=j.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Vn]){const Eo=this.prevPlacement.variableOffsets[Vn];$s.indexOf(Eo.anchor)>0&&($s=$s.filter((Ea=>Ea!==Eo.anchor)),$s.unshift(Eo.anchor))}const Sa=(Eo,Ea,Yo)=>{const Ro=P.getSymbolInstanceTextSize(at,Jt,this.transform.zoom,An),aa=(Eo.x2-Eo.x1)*Ro+2*Eo.padding,zu=(Eo.y2-Eo.y1)*Ro+2*Eo.padding,Ta=Nt&&!yt?Ea:null;Ta&&Gs(Ta);let Ku={box:[],offscreen:!1,occluded:!1};const If=gt?2*$s.length:$s.length;for(let Oa=0;Oa<If;++Oa){const Wh=this.attemptAnchorPlacement($s[Oa%$s.length],Eo,aa,zu,Ro,Mt,Dt,Ee,W,lt,Oa>=$s.length,Jt,An,P,Yo,Ta,at,et);if(Wh&&(Ku=Wh.placedGlyphBoxes,Ku&&Ku.box&&Ku.box.length)){bn=!0,ei=Wh.shift;break}}return Ku};ks((()=>Sa(wa,cn.iconBox,s.WritingMode.horizontal)),(()=>{const Eo=cn.verticalTextBox;return Eo&&Gs(Eo),P.allowVerticalPlacement&&!(Er&&Er.box&&Er.box.length)&&tn>0&&Eo?Sa(Eo,cn.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),Er&&(bn=Er.box,In=Er.offscreen,Wn=Er.occluded);const Gl=Zi(!(!Er||!Er.box));if(!bn&&this.prevPlacement){const Eo=this.prevPlacement.variableOffsets[Vn];Eo&&(this.variableOffsets[Vn]=Eo,this.markUsedJustification(P,Eo.anchor,Jt,Gl))}}else{const $s=(Sa,Gl)=>{const Eo=P.getSymbolInstanceTextSize(at,Jt,this.transform.zoom,An),Ea=this.collisionIndex.placeCollisionBox(P,Eo,Sa,new s.Point(0,0),gt,Ee,W,lt.predicate);return Ea&&Ea.box&&Ea.box.length&&(this.markUsedOrientation(P,Gl,Jt),this.placedOrientations[Vn]=Gl),Ea};ks((()=>$s(wa,s.WritingMode.horizontal)),(()=>{const Sa=cn.verticalTextBox;return P.allowVerticalPlacement&&tn>0&&Sa?(Gs(Sa),$s(Sa,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),Zi(!!(Er&&Er.box&&Er.box.length))}}if(Ai=Er,bn=Ai&&Ai.box&&Ai.box.length>0,In=Ai&&Ai.offscreen,Wn=Ai&&Ai.occluded,Jt.useRuntimeCollisionCircles){const Zi=P.text.placedSymbolArray.get(Jt.centerJustifiedTextSymbolIndex>=0?Jt.centerJustifiedTextSymbolIndex:Jt.verticalPlacedTextSymbolIndex),ks=s.evaluateSizeForFeature(P.textSizeData,at,Zi),$s=j.get("text-padding");Mi=this.collisionIndex.placeCollisionCircles(P,gt,Zi,P.lineVertexArray,P.glyphOffsetArray,ks,W,Z,le,b,Dt,lt.predicate,Jt.collisionCircleDiameter*ks/s.ONE_EM,$s,this.retainedQueryData[P.bucketInstanceId].tileID),bn=gt||Mi.circles.length>0&&!Mi.collisionDetected,In=In&&Mi.offscreen,Wn=Mi.occluded}if(cn.iconFeatureIndex&&(ts=cn.iconFeatureIndex),cn.iconBox){const Zi=ks=>{Gs(ks);const $s=Nt&&ei?Ei(ei.x,ei.y,Mt,Dt,this.transform.angle):new s.Point(0,0),Sa=P.getSymbolInstanceIconSize(et,this.transform.zoom,Jt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(P,Sa,ks,$s,yt,Ee,W,lt.predicate)};gr&&gr.box&&gr.box.length&&cn.verticalIconBox?(Vr=Zi(cn.verticalIconBox),Un=Vr.box.length>0):(Vr=Zi(cn.iconBox),Un=Vr.box.length>0),In=In&&Vr.offscreen,Nr=Vr.occluded}const $o=Ie||Jt.numHorizontalGlyphVertices===0&&tn===0,Bu=rt||Jt.numIconVertices===0;if($o||Bu?Bu?$o||(Un=Un&&bn):bn=Un&&bn:Un=bn=Un&&bn,bn&&Ai&&Ai.box&&this.collisionIndex.insertCollisionBox(Ai.box,j.get("text-ignore-placement"),P.bucketInstanceId,gr&&gr.box&&Ki?Ki:Yi,lt.ID),Un&&Vr&&this.collisionIndex.insertCollisionBox(Vr.box,j.get("icon-ignore-placement"),P.bucketInstanceId,ts,lt.ID),Mi&&(bn&&this.collisionIndex.insertCollisionCircles(Mi.circles,j.get("text-ignore-placement"),P.bucketInstanceId,Yi,lt.ID),b)){const Zi=P.bucketInstanceId;let ks=this.collisionCircleArrays[Zi];ks===void 0&&(ks=this.collisionCircleArrays[Zi]=new Us);for(let $s=0;$s<Mi.circles.length;$s+=4)ks.circles.push(Mi.circles[$s+0]),ks.circles.push(Mi.circles[$s+1]),ks.circles.push(Mi.circles[$s+2]),ks.circles.push(Mi.collisionDetected?1:0)}const Yu=P.projection.name!=="globe";Bt=Bt&&(Yu||!Wn),rn=rn&&(Yu||!Nr),this.placements[Vn]=new mu(bn||Bt,Un||rn,In||P.justReloaded),m.add(Vn)};if(qt){const Jt=P.getSortedSymbolIndexes(this.transform.angle);for(let An=Jt.length-1;An>=0;--An){const cn=Jt[An];Rn(P.symbolInstances.get(cn),cn,P.collisionArrays[cn])}}else for(let Jt=l.symbolInstanceStart;Jt<l.symbolInstanceEnd;Jt++)Rn(P.symbolInstances.get(Jt),Jt,P.collisionArrays[Jt]);if(b&&P.bucketInstanceId in this.collisionCircleArrays){const Jt=this.collisionCircleArrays[P.bucketInstanceId];s.invert(Jt.invProjMatrix,W),Jt.viewportMatrix=this.collisionIndex.getViewportMatrix()}P.justReloaded=!1}markUsedJustification(l,m,b,I){const{leftJustifiedTextSymbolIndex:P,centerJustifiedTextSymbolIndex:j,rightJustifiedTextSymbolIndex:W,verticalPlacedTextSymbolIndex:Z,crossTileID:le}=b,ce=s.getAnchorJustification(m),Ee=I===s.WritingMode.vertical?Z:ce==="left"?P:ce==="center"?j:ce==="right"?W:-1;P>=0&&(l.text.placedSymbolArray.get(P).crossTileID=Ee>=0&&P!==Ee?0:le),j>=0&&(l.text.placedSymbolArray.get(j).crossTileID=Ee>=0&&j!==Ee?0:le),W>=0&&(l.text.placedSymbolArray.get(W).crossTileID=Ee>=0&&W!==Ee?0:le),Z>=0&&(l.text.placedSymbolArray.get(Z).crossTileID=Ee>=0&&Z!==Ee?0:le)}markUsedOrientation(l,m,b){const I=m===s.WritingMode.horizontal||m===s.WritingMode.horizontalOnly?m:0,P=m===s.WritingMode.vertical?m:0,{leftJustifiedTextSymbolIndex:j,centerJustifiedTextSymbolIndex:W,rightJustifiedTextSymbolIndex:Z,verticalPlacedTextSymbolIndex:le}=b,ce=l.text.placedSymbolArray;j>=0&&(ce.get(j).placedOrientation=I),W>=0&&(ce.get(W).placedOrientation=I),Z>=0&&(ce.get(Z).placedOrientation=I),le>=0&&(ce.get(le).placedOrientation=P)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const m=this.prevPlacement;let b=!1;this.prevZoomAdjustment=m?m.zoomAdjustment(this.transform.zoom):0;const I=m?m.symbolFadeChange(l):1,P=m?m.opacities:{},j=m?m.variableOffsets:{},W=m?m.placedOrientations:{};for(const Z in this.placements){const le=this.placements[Z],ce=P[Z];ce?(this.opacities[Z]=new lu(ce,I,le.text,le.icon,null,le.clipped),b=b||le.text!==ce.text.placed||le.icon!==ce.icon.placed):(this.opacities[Z]=new lu(null,I,le.text,le.icon,le.skipFade,le.clipped),b=b||le.text||le.icon)}for(const Z in P){const le=P[Z];if(!this.opacities[Z]){const ce=new lu(le,I,!1,!1);ce.isHidden()||(this.opacities[Z]=ce,b=b||le.text.placed||le.icon.placed)}}for(const Z in j)this.variableOffsets[Z]||!this.opacities[Z]||this.opacities[Z].isHidden()||(this.variableOffsets[Z]=j[Z]);for(const Z in W)this.placedOrientations[Z]||!this.opacities[Z]||this.opacities[Z].isHidden()||(this.placedOrientations[Z]=W[Z]);b?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=m?m.lastPlacementChangeTime:l)}updateLayerOpacities(l,m){const b=new Set;for(const I of m){const P=I.getBucket(l);P&&I.latestFeatureIndex&&l.id===P.layerIds[0]&&this.updateBucketOpacities(P,b,I.collisionBoxArray)}}updateBucketOpacities(l,m,b){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const I=l.layers[0].layout,P=!!l.layers[0].dynamicFilter(),j=new lu(null,0,!1,!1,!0),W=I.get("text-allow-overlap"),Z=I.get("icon-allow-overlap"),le=I.get("text-variable-anchor"),ce=I.get("text-rotation-alignment")==="map",Ee=I.get("text-pitch-alignment")==="map",Fe=I.get("icon-text-fit")!=="none",qe=new lu(null,0,W&&(Z||!l.hasIconData()||I.get("icon-optional")),Z&&(W||!l.hasTextData()||I.get("text-optional")),!0);!l.collisionArrays&&b&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(b);const at=(lt,Ie,rt)=>{for(let gt=0;gt<Ie/4;gt++)lt.opacityVertexArray.emplaceBack(rt)};let et=0;for(let lt=0;lt<l.symbolInstances.length;lt++){const Ie=l.symbolInstances.get(lt),{numHorizontalGlyphVertices:rt,numVerticalGlyphVertices:gt,crossTileID:yt,numIconVertices:Mt}=Ie,Dt=m.has(yt);let Nt=this.opacities[yt];Dt?Nt=j:Nt||(Nt=qe,this.opacities[yt]=Nt),m.add(yt);const qt=rt>0||gt>0,Bt=Mt>0,rn=this.placedOrientations[yt],Rn=rn===s.WritingMode.vertical,Jt=rn===s.WritingMode.horizontal||rn===s.WritingMode.horizontalOnly;if(!qt&&!Bt||Nt.isHidden()||et++,qt){const An=xs(Nt.text);at(l.text,rt,Rn?Ts:An),at(l.text,gt,Jt?Ts:An);const cn=Nt.text.isHidden(),{leftJustifiedTextSymbolIndex:Vn,centerJustifiedTextSymbolIndex:tn,rightJustifiedTextSymbolIndex:bn,verticalPlacedTextSymbolIndex:Un}=Ie,In=l.text.placedSymbolArray,Wn=cn||Rn?1:0;Vn>=0&&(In.get(Vn).hidden=Wn),tn>=0&&(In.get(tn).hidden=Wn),bn>=0&&(In.get(bn).hidden=Wn),Un>=0&&(In.get(Un).hidden=cn||Jt?1:0);const Nr=this.variableOffsets[yt];Nr&&this.markUsedJustification(l,Nr.anchor,Ie,rn);const ei=this.placedOrientations[yt];ei&&(this.markUsedJustification(l,"left",Ie,ei),this.markUsedOrientation(l,ei,Ie))}if(Bt){const An=xs(Nt.icon),{placedIconSymbolIndex:cn,verticalPlacedIconSymbolIndex:Vn}=Ie,tn=l.icon.placedSymbolArray,bn=Nt.icon.isHidden()?1:0;cn>=0&&(at(l.icon,Mt,Rn?Ts:An),tn.get(cn).hidden=bn),Vn>=0&&(at(l.icon,Ie.numVerticalIconVertices,Jt?Ts:An),tn.get(Vn).hidden=bn)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const An=l.collisionArrays[lt];if(An){let cn=new s.Point(0,0),Vn=!0;if(An.textBox||An.verticalTextBox){if(le){const bn=this.variableOffsets[yt];bn?(cn=Vo(bn.anchor,bn.width,bn.height,bn.textOffset,bn.textScale),ce&&cn._rotate(Ee?this.transform.angle:-this.transform.angle)):Vn=!1}P&&(Vn=!Nt.clipped),An.textBox&&gi(l.textCollisionBox.collisionVertexArray,Nt.text.placed,!Vn||Rn,cn.x,cn.y),An.verticalTextBox&&gi(l.textCollisionBox.collisionVertexArray,Nt.text.placed,!Vn||Jt,cn.x,cn.y)}const tn=Vn&&!!(!Jt&&An.verticalIconBox);An.iconBox&&gi(l.iconCollisionBox.collisionVertexArray,Nt.icon.placed,tn,Fe?cn.x:0,Fe?cn.y:0),An.verticalIconBox&&gi(l.iconCollisionBox.collisionVertexArray,Nt.icon.placed,!tn,Fe?cn.x:0,Fe?cn.y:0)}}}if(l.fullyClipped=et===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const lt=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=lt.invProjMatrix,l.placementViewportMatrix=lt.viewportMatrix,l.collisionCircleArray=lt.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,m){const b=this.zoomAtLastRecencyCheck===m?1-this.zoomAdjustment(m):1;return this.zoomAtLastRecencyCheck=m,this.commitTime+this.fadeDuration*b>l}setStale(){this.stale=!0}}function gi(x,l,m,b,I){x.emplaceBack(l?1:0,m?1:0,b||0,I||0),x.emplaceBack(l?1:0,m?1:0,b||0,I||0),x.emplaceBack(l?1:0,m?1:0,b||0,I||0),x.emplaceBack(l?1:0,m?1:0,b||0,I||0)}const wo=Math.pow(2,25),Vs=Math.pow(2,24),Nc=Math.pow(2,17),Pu=Math.pow(2,16),Fs=Math.pow(2,9),na=Math.pow(2,8),Es=Math.pow(2,1);function xs(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;const l=x.placed?1:0,m=Math.floor(127*x.opacity);return m*wo+l*Vs+m*Nc+l*Pu+m*Fs+l*na+m*Es+l}const Ts=0;class Ol{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,m,b,I,P){const j=this._bucketParts;for(;this._currentTileIndex<l.length;)if(m.getBucketParts(j,I,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,P())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,j.sort(((W,Z)=>W.sortKey-Z.sortKey)));this._currentPartIndex<j.length;){const W=j[this._currentPartIndex];if(m.placeLayerBucketPart(W,this._seenCrossTileIDs,b,W.symbolInstanceStart===0),this._currentPartIndex++,P())return!0}return!1}}class ha{constructor(l,m,b,I,P,j,W,Z){this.placement=new bo(l,P,j,W,Z),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=I,this._done=!1}isDone(){return this._done}continuePlacement(l,m,b){const I=s.exported.now(),P=()=>{const j=s.exported.now()-I;return!this._forceFullPlacement&&j>2};for(;this._currentPlacementIndex>=0;){const j=m[l[this._currentPlacementIndex]],W=this.placement.collisionIndex.transform.zoom;if(j.type==="symbol"&&(!j.minzoom||j.minzoom<=W)&&(!j.maxzoom||j.maxzoom>W)){if(this._inProgressLayer||(this._inProgressLayer=new Ol(j)),this._inProgressLayer.continuePlacement(b[j.source],this.placement,this._showCollisionBoxes,j,P))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const ra=512/s.EXTENT/2;class os{constructor(l,m,b){this.tileID=l,this.bucketInstanceId=b,this.index=new s.KDBush(m.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const I=l.canonical.x*s.EXTENT,P=l.canonical.y*s.EXTENT;for(let j=0;j<m.length;j++){const{key:W,crossTileID:Z,tileAnchorX:le,tileAnchorY:ce}=m.get(j),Ee=Math.floor((I+le)*ra),Fe=Math.floor((P+ce)*ra);this.index.add(Ee,Fe),this.keys.push(W),this.crossTileIDs.push(Z)}this.index.finish()}findMatches(l,m,b){const I=this.tileID.canonical.z<m.canonical.z?1:Math.pow(2,this.tileID.canonical.z-m.canonical.z),P=ra/Math.pow(2,m.canonical.z-this.tileID.canonical.z),j=m.canonical.x*s.EXTENT,W=m.canonical.y*s.EXTENT;for(let Z=0;Z<l.length;Z++){const le=l.get(Z);if(le.crossTileID)continue;const{key:ce,tileAnchorX:Ee,tileAnchorY:Fe}=le,qe=Math.floor((j+Ee)*P),at=Math.floor((W+Fe)*P),et=this.index.range(qe-I,at-I,qe+I,at+I);for(const lt of et){const Ie=this.crossTileIDs[lt];if(this.keys[lt]===ce&&!b.has(Ie)){b.add(Ie),le.crossTileID=Ie;break}}}}}class gu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ro{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const m=Math.round((l-this.lng)/360);if(m!==0)for(const b in this.indexes){const I=this.indexes[b],P={};for(const j in I){const W=I[j];W.tileID=W.tileID.unwrapTo(W.tileID.wrap+m),P[W.tileID.key]=W}this.indexes[b]=P}this.lng=l}addBucket(l,m,b){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===m.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let P=0;P<m.symbolInstances.length;P++)m.symbolInstances.get(P).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const I=this.usedCrossTileIDs[l.overscaledZ];for(const P in this.indexes){const j=this.indexes[P];if(Number(P)>l.overscaledZ)for(const W in j){const Z=j[W];Z.tileID.isChildOf(l)&&Z.findMatches(m.symbolInstances,l,I)}else{const W=j[l.scaledTo(Number(P)).key];W&&W.findMatches(m.symbolInstances,l,I)}}for(let P=0;P<m.symbolInstances.length;P++){const j=m.symbolInstances.get(P);j.crossTileID||(j.crossTileID=b.generate(),I.add(j.crossTileID))}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new os(l,m.symbolInstances,m.bucketInstanceId),!0}removeBucketCrossTileIDs(l,m){for(const b of m.crossTileIDs)this.usedCrossTileIDs[l].delete(b)}removeStaleBuckets(l){let m=!1;for(const b in this.indexes){const I=this.indexes[b];for(const P in I)l[I[P].bucketInstanceId]||(this.removeBucketCrossTileIDs(b,I[P]),delete I[P],m=!0)}return m}}class ya{constructor(){this.layerIndexes={},this.crossTileIDs=new gu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,m,b,I){let P=this.layerIndexes[l.id];P===void 0&&(P=this.layerIndexes[l.id]=new ro);let j=!1;const W={};I.name!=="globe"&&P.handleWrapJump(b);for(const Z of m){const le=Z.getBucket(l);le&&l.id===le.layerIds[0]&&(le.bucketInstanceId||(le.bucketInstanceId=++this.maxBucketInstanceId),P.addBucket(Z.tileID,le,this.crossTileIDs)&&(j=!0),W[le.bucketInstanceId]=!0)}return P.removeStaleBuckets(W)&&(j=!0),j}pruneUnusedLayers(l){const m={};l.forEach((b=>{m[b]=!0}));for(const b in this.layerIndexes)m[b]||delete this.layerIndexes[b]}}const ol=(x,l)=>s.emitValidationErrors(x,l&&l.filter((m=>m.identifier!=="source.canvas"))),Al=s.pick(di,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Nu=s.pick(di,["setCenter","setZoom","setBearing","setPitch"]),Na={version:8,layers:[],sources:{}},qo={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ji extends s.Evented{constructor(l,m={}){super(),this.map=l,this.dispatcher=new Ce(ua(),this),this.imageManager=new J,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(l._requestManager,m.localFontFamily?s.LocalGlyphMode.all:m.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,m.localFontFamily||m.localIdeographFontFamily),this.crossTileSymbolIndex=new ya,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const b=this;this._rtlTextPluginCallback=ji.registerForPluginStateChange((I=>{b.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:I.pluginStatus,pluginURL:I.pluginURL},((P,j)=>{if(s.triggerPluginCompletionEvent(P),j&&j.every((W=>W)))for(const W in b._sourceCaches){const Z=b._sourceCaches[W],le=Z.getSource().type;le!=="vector"&&le!=="geojson"||Z.reload()}}))})),this.on("data",(I=>{if(I.dataType!=="source"||I.sourceDataType!=="metadata")return;const P=this.getSource(I.sourceId);if(P&&P.vectorLayerIds)for(const j in this._layers){const W=this._layers[j];W.source===P.id&&this._validateLayer(W)}}))}loadURL(l,m={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const b=typeof m.validate=="boolean"?m.validate:!s.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,m.accessToken);const I=this.map._requestManager.transformRequest(l,s.ResourceType.Style);this._request=s.getJSON(I,((P,j)=>{this._request=null,P?this.fire(new s.ErrorEvent(P)):j&&this._load(j,b)}))}loadJSON(l,m={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame((()=>{this._request=null,this._load(l,m.validate!==!1)}))}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(Na,!1)}_updateLayerCount(l,m){const b=m?1:-1;l.is3D()&&(this._num3DLayers+=b),l.type==="circle"&&(this._numCircleLayers+=b),l.type==="symbol"&&(this._numSymbolLayers+=b)}_load(l,m){if(m&&ol(this,s.validateStyle(l)))return;this._loaded=!0,this.stylesheet=s.clone$1(l),this._updateMapProjection();for(const I in l.sources)this.addSource(I,l.sources[I],{validate:!1});this._changed=!1,l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(l.glyphs);const b=Pa(this.stylesheet.layers);this._order=b.map((I=>I.id)),this._layers={},this._serializedLayers={};for(const I of b){const P=s.createStyleLayer(I);P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P,this._serializedLayers[P.id]=P.serialize(),this._updateLayerCount(P,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Se(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(l){this._spriteRequest=(function(m,b,I){let P,j,W;const Z=s.exported.devicePixelRatio>1?"@2x":"";let le=s.getJSON(b.transformRequest(b.normalizeSpriteURL(m,Z,".json"),s.ResourceType.SpriteJSON),((Fe,qe)=>{le=null,W||(W=Fe,P=qe,Ee())})),ce=s.getImage(b.transformRequest(b.normalizeSpriteURL(m,Z,".png"),s.ResourceType.SpriteImage),((Fe,qe)=>{ce=null,W||(W=Fe,j=qe,Ee())}));function Ee(){if(W)I(W);else if(P&&j){const Fe=s.exported.getImageData(j),qe={};for(const at in P){const{width:et,height:lt,x:Ie,y:rt,sdf:gt,pixelRatio:yt,stretchX:Mt,stretchY:Dt,content:Nt}=P[at],qt=new s.RGBAImage({width:et,height:lt});s.RGBAImage.copy(Fe,qt,{x:Ie,y:rt},{x:0,y:0},{width:et,height:lt}),qe[at]={data:qt,pixelRatio:yt,sdf:gt,stretchX:Mt,stretchY:Dt,content:Nt}}I(null,qe)}}return{cancel(){le&&(le.cancel(),le=null),ce&&(ce.cancel(),ce=null)}}})(l,this.map._requestManager,((m,b)=>{if(this._spriteRequest=null,m)this.fire(new s.ErrorEvent(m));else if(b)for(const I in b)this.imageManager.addImage(I,b[I]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))}))}_validateLayer(l){const m=this.getSource(l.source);if(!m)return;const b=l.sourceLayer;b&&(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(b)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${b}" does not exist on source "${m.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(l){const m=[];for(const b of l){const I=this._layers[b];I.type!=="custom"&&m.push(I.serialize())}return m}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(l){return!!this.terrain&&(typeof l.isLayerDraped=="function"?l.isLayerDraped():qo[l.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(l){if(!this._loaded)return;const m=this._changed;if(this._changed){const I=Object.keys(this._updatedLayers),P=Object.keys(this._removedLayers);(I.length||P.length)&&this._updateWorkerLayers(I,P);for(const j in this._updatedSources){const W=this._updatedSources[j];W==="reload"?this._reloadSource(j):W==="clear"&&this._clearSource(j)}this._updateTilesForChangedImages();for(const j in this._updatedPaintProps)this._layers[j].updateTransitions(l);this.light.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._resetUpdates()}const b={};for(const I in this._sourceCaches){const P=this._sourceCaches[I];b[I]=P.used,P.used=!1}for(const I of this._order){const P=this._layers[I];if(P.recalculate(l,this._availableImages),!P.isHidden(l.zoom)){const W=this._getLayerSourceCache(P);W&&(W.used=!0)}const j=this.map.painter;if(j){const W=P.getProgramIds();if(!W)continue;const Z=P.getProgramConfiguration(l.zoom);for(const le of W)j.useProgram(le,Z)}}for(const I in b){const P=this._sourceCaches[I];b[I]!==P.used&&P.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:P.getSource().id}))}this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),m&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const m in this._sourceCaches)this._sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateWorkerLayers(l,m){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:m})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(l){if(this._checkLoaded(),ol(this,s.validateStyle(l)))return!1;(l=s.clone$1(l)).layers=Pa(l.layers);const m=(function(I,P){if(!I)return[{command:di.setStyle,args:[P]}];let j=[];try{if(!T(I.version,P.version))return[{command:di.setStyle,args:[P]}];T(I.center,P.center)||j.push({command:di.setCenter,args:[P.center]}),T(I.zoom,P.zoom)||j.push({command:di.setZoom,args:[P.zoom]}),T(I.bearing,P.bearing)||j.push({command:di.setBearing,args:[P.bearing]}),T(I.pitch,P.pitch)||j.push({command:di.setPitch,args:[P.pitch]}),T(I.sprite,P.sprite)||j.push({command:di.setSprite,args:[P.sprite]}),T(I.glyphs,P.glyphs)||j.push({command:di.setGlyphs,args:[P.glyphs]}),T(I.transition,P.transition)||j.push({command:di.setTransition,args:[P.transition]}),T(I.light,P.light)||j.push({command:di.setLight,args:[P.light]}),T(I.fog,P.fog)||j.push({command:di.setFog,args:[P.fog]}),T(I.projection,P.projection)||j.push({command:di.setProjection,args:[P.projection]});const W={},Z=[];(function(Ee,Fe,qe,at){let et;for(et in Fe=Fe||{},Ee=Ee||{})Ee.hasOwnProperty(et)&&(Fe.hasOwnProperty(et)||yc(et,qe,at));for(et in Fe){if(!Fe.hasOwnProperty(et))continue;const lt=Fe[et];Ee.hasOwnProperty(et)?T(Ee[et],lt)||(Ee[et].type==="geojson"&&lt.type==="geojson"&&au(Ee,Fe,et)?qe.push({command:di.setGeoJSONSourceData,args:[et,lt.data]}):Ss(et,Fe,qe,at)):ou(et,Fe,qe)}})(I.sources,P.sources,Z,W);const le=[];I.layers&&I.layers.forEach((Ee=>{Ee.source&&W[Ee.source]?j.push({command:di.removeLayer,args:[Ee.id]}):le.push(Ee)}));let ce=I.terrain;ce&&W[ce.source]&&(j.push({command:di.setTerrain,args:[void 0]}),ce=void 0),j=j.concat(Z),T(ce,P.terrain)||j.push({command:di.setTerrain,args:[P.terrain]}),(function(Ee,Fe,qe){Fe=Fe||[];const at=(Ee=Ee||[]).map(uo),et=Fe.map(uo),lt=Ee.reduce(nl,{}),Ie=Fe.reduce(nl,{}),rt=at.slice(),gt=Object.create(null);let yt,Mt,Dt,Nt,qt,Bt,rn;for(yt=0,Mt=0;yt<at.length;yt++)Dt=at[yt],Ie.hasOwnProperty(Dt)?Mt++:(qe.push({command:di.removeLayer,args:[Dt]}),rt.splice(rt.indexOf(Dt,Mt),1));for(yt=0,Mt=0;yt<et.length;yt++)Dt=et[et.length-1-yt],rt[rt.length-1-yt]!==Dt&&(lt.hasOwnProperty(Dt)?(qe.push({command:di.removeLayer,args:[Dt]}),rt.splice(rt.lastIndexOf(Dt,rt.length-Mt),1)):Mt++,Bt=rt[rt.length-yt],qe.push({command:di.addLayer,args:[Ie[Dt],Bt]}),rt.splice(rt.length-yt,0,Dt),gt[Dt]=!0);for(yt=0;yt<et.length;yt++)if(Dt=et[yt],Nt=lt[Dt],qt=Ie[Dt],!gt[Dt]&&!T(Nt,qt))if(T(Nt.source,qt.source)&&T(Nt["source-layer"],qt["source-layer"])&&T(Nt.type,qt.type)){for(rn in ga(Nt.layout,qt.layout,qe,Dt,null,di.setLayoutProperty),ga(Nt.paint,qt.paint,qe,Dt,null,di.setPaintProperty),T(Nt.filter,qt.filter)||qe.push({command:di.setFilter,args:[Dt,qt.filter]}),T(Nt.minzoom,qt.minzoom)&&T(Nt.maxzoom,qt.maxzoom)||qe.push({command:di.setLayerZoomRange,args:[Dt,qt.minzoom,qt.maxzoom]}),Nt)Nt.hasOwnProperty(rn)&&rn!=="layout"&&rn!=="paint"&&rn!=="filter"&&rn!=="metadata"&&rn!=="minzoom"&&rn!=="maxzoom"&&(rn.indexOf("paint.")===0?ga(Nt[rn],qt[rn],qe,Dt,rn.slice(6),di.setPaintProperty):T(Nt[rn],qt[rn])||qe.push({command:di.setLayerProperty,args:[Dt,rn,qt[rn]]}));for(rn in qt)qt.hasOwnProperty(rn)&&!Nt.hasOwnProperty(rn)&&rn!=="layout"&&rn!=="paint"&&rn!=="filter"&&rn!=="metadata"&&rn!=="minzoom"&&rn!=="maxzoom"&&(rn.indexOf("paint.")===0?ga(Nt[rn],qt[rn],qe,Dt,rn.slice(6),di.setPaintProperty):T(Nt[rn],qt[rn])||qe.push({command:di.setLayerProperty,args:[Dt,rn,qt[rn]]}))}else qe.push({command:di.removeLayer,args:[Dt]}),Bt=rt[rt.lastIndexOf(Dt)+1],qe.push({command:di.addLayer,args:[qt,Bt]})})(le,P.layers,j)}catch(W){console.warn("Unable to compute style diff:",W),j=[{command:di.setStyle,args:[P]}]}return j})(this.serialize(),l).filter((I=>!(I.command in Nu)));if(m.length===0)return!1;const b=m.filter((I=>!(I.command in Al)));if(b.length>0)throw new Error(`Unimplemented: ${b.map((I=>I.command)).join(", ")}.`);return m.forEach((I=>{I.command!=="setTransition"&&I.command!=="setProjection"&&this[I.command].apply(this,I.args)})),this.stylesheet=l,this._updateMapProjection(),!0}addImage(l,m){return this.getImage(l)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,m),this._afterImageUpdated(l),this)}updateImage(l,m){this.imageManager.updateImage(l,m)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l),this._afterImageUpdated(l),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(l,m,b={}){if(this._checkLoaded(),this.getSource(l)!==void 0)throw new Error("There is already a source with this ID");if(!m.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(m).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(s.validateSource,`sources.${l}`,m,null,b))return;this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);const I=Br(l,m,this.dispatcher,this);I.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(l),source:I.serialize(),sourceId:l})));const P=j=>{const W=(j?"symbol:":"other:")+l,Z=this._sourceCaches[W]=new s.SourceCache(W,I,j);(j?this._symbolSourceCaches:this._otherSourceCaches)[l]=Z,Z.style=this,Z.onAdd(this.map)};P(!1),m.type!=="vector"&&m.type!=="geojson"||P(!0),I.onAdd&&I.onAdd(this.map),this._changed=!0}removeSource(l){this._checkLoaded();const m=this.getSource(l);if(!m)throw new Error("There is no source with this ID");for(const I in this._layers)if(this._layers[I].source===l)return this.fire(new s.ErrorEvent(new Error(`Source "${l}" cannot be removed while layer "${I}" is using it.`)));if(this.terrain&&this.terrain.get().source===l)return this.fire(new s.ErrorEvent(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const b=this._getSourceCaches(l);for(const I of b)delete this._sourceCaches[I.id],delete this._updatedSources[I.id],I.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:I.getSource().id})),I.setEventedParent(null),I.clearTiles();return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],m.setEventedParent(null),m.onRemove&&m.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(l,m){this._checkLoaded(),this.getSource(l).setData(m),this._changed=!0}getSource(l){const m=this._getSourceCache(l);return m&&m.getSource()}_getSources(){const l=[];for(const m in this._otherSourceCaches){const b=this._getSourceCache(m);b&&l.push(b.getSource())}return l}addLayer(l,m,b={}){this._checkLoaded();const I=l.id;if(this.getLayer(I))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${I}" already exists on this map`)));let P;if(l.type==="custom"){if(ol(this,s.validateCustomStyleLayer(l)))return;P=s.createStyleLayer(l)}else{if(typeof l.source=="object"&&(this.addSource(I,l.source),l=s.clone$1(l),l=s.extend(l,{source:I})),this._validate(s.validateLayer,`layers.${I}`,l,{arrayIndex:-1},b))return;P=s.createStyleLayer(l),this._validateLayer(P),P.setEventedParent(this,{layer:{id:I}}),this._serializedLayers[P.id]=P.serialize(),this._updateLayerCount(P,!0)}const j=m?this._order.indexOf(m):this._order.length;if(m&&j===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${m}" does not exist on this map.`)));this._order.splice(j,0,I),this._layerOrderChanged=!0,this._layers[I]=P;const W=this._getLayerSourceCache(P);if(this._removedLayers[I]&&P.source&&W&&P.type!=="custom"){const Z=this._removedLayers[I];delete this._removedLayers[I],Z.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",W.pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(l,m){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===m)return;const b=this._order.indexOf(l);this._order.splice(b,1);const I=m?this._order.indexOf(m):this._order.length;m&&I===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${m}" does not exist on this map.`))):(this._order.splice(I,0,l),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(l){this._checkLoaded();const m=this._layers[l];if(!m)return void this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be removed.`)));m.setEventedParent(null),this._updateLayerCount(m,!1);const b=this._order.indexOf(l);this._order.splice(b,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=m,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],m.onRemove&&m.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(l){return this._layers[l]}hasLayer(l){return l in this._layers}hasLayerType(l){for(const m in this._layers)if(this._layers[m].type===l)return!0;return!1}setLayerZoomRange(l,m,b){this._checkLoaded();const I=this.getLayer(l);I?I.minzoom===m&&I.maxzoom===b||(m!=null&&(I.minzoom=m),b!=null&&(I.maxzoom=b),this._updateLayer(I)):this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(l,m,b={}){this._checkLoaded();const I=this.getLayer(l);if(I){if(!T(I.filter,m))return m==null?(I.filter=void 0,void this._updateLayer(I)):void(this._validate(s.validateFilter,`layers.${I.id}.filter`,m,{layerType:I.type},b)||(I.filter=s.clone$1(m),this._updateLayer(I)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be filtered.`)))}getFilter(l){const m=this.getLayer(l);return m&&s.clone$1(m.filter)}setLayoutProperty(l,m,b,I={}){this._checkLoaded();const P=this.getLayer(l);P?T(P.getLayoutProperty(m),b)||(P.setLayoutProperty(m,b,I),this._updateLayer(P)):this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(l,m){const b=this.getLayer(l);if(b)return b.getLayoutProperty(m);this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style.`)))}setPaintProperty(l,m,b,I={}){this._checkLoaded();const P=this.getLayer(l);P?T(P.getPaintProperty(m),b)||(P.setPaintProperty(m,b,I)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(l,m){const b=this.getLayer(l);return b&&b.getPaintProperty(m)}setFeatureState(l,m){this._checkLoaded();const b=l.source,I=l.sourceLayer,P=this.getSource(b);if(!P)return void this.fire(new s.ErrorEvent(new Error(`The source '${b}' does not exist in the map's style.`)));const j=P.type;if(j==="geojson"&&I)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(j==="vector"&&!I)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const W=this._getSourceCaches(b);for(const Z of W)Z.setFeatureState(I,l.id,m)}removeFeatureState(l,m){this._checkLoaded();const b=l.source,I=this.getSource(b);if(!I)return void this.fire(new s.ErrorEvent(new Error(`The source '${b}' does not exist in the map's style.`)));const P=I.type,j=P==="vector"?l.sourceLayer:void 0;if(P==="vector"&&!j)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(m&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const W=this._getSourceCaches(b);for(const Z of W)Z.removeFeatureState(j,l.id,m)}getFeatureState(l){this._checkLoaded();const m=l.source,b=l.sourceLayer,I=this.getSource(m);if(I){if(I.type!=="vector"||b)return l.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(m)[0].getFeatureState(b,l.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const l={};for(const m in this._sourceCaches){const b=this._sourceCaches[m].getSource();l[b.id]||(l[b.id]=b.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:l,layers:this._serializeLayers(this._order)},(m=>m!==void 0))}_updateLayer(l){this._updatedLayers[l.id]=!0;const m=this._getLayerSourceCache(l);l.source&&!this._updatedSources[l.source]&&m&&m.getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",m.pause()),this._changed=!0,l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const m=j=>this._layers[j].type==="fill-extrusion",b={},I=[];for(let j=this._order.length-1;j>=0;j--){const W=this._order[j];if(m(W)){b[W]=j;for(const Z of l){const le=Z[W];if(le)for(const ce of le)I.push(ce)}}}I.sort(((j,W)=>W.intersectionZ-j.intersectionZ));const P=[];for(let j=this._order.length-1;j>=0;j--){const W=this._order[j];if(m(W))for(let Z=I.length-1;Z>=0;Z--){const le=I[Z].feature;if(b[le.layer.id]<j)break;P.push(le),I.pop()}else for(const Z of l){const le=Z[W];if(le)for(const ce of le)P.push(ce.feature)}}return P}queryRenderedFeatures(l,m,b){m&&m.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",m.filter,null,m);const I={};if(m&&m.layers){if(!Array.isArray(m.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const Z of m.layers){const le=this._layers[Z];if(!le)return this.fire(new s.ErrorEvent(new Error(`The layer '${Z}' does not exist in the map's style and cannot be queried for features.`))),[];I[le.source]=!0}}const P=[];m.availableImages=this._availableImages;const j=m&&m.layers?m.layers.some((Z=>{const le=this.getLayer(Z);return le&&le.is3D()})):this.has3DLayers(),W=We.createFromScreenPoints(l,b);for(const Z in this._sourceCaches){const le=this._sourceCaches[Z].getSource().id;m.layers&&!I[le]||P.push(ms(this._sourceCaches[Z],this._layers,this._serializedLayers,W,m,b,j,!!this.map._showQueryGeometry))}return this.placement&&P.push((function(Z,le,ce,Ee,Fe,qe,at){const et={},lt=qe.queryRenderedSymbols(Ee),Ie=[];for(const rt of Object.keys(lt).map(Number))Ie.push(at[rt]);Ie.sort(cs);for(const rt of Ie){const gt=rt.featureIndex.lookupSymbolFeatures(lt[rt.bucketInstanceId],le,rt.bucketIndex,rt.sourceLayerIndex,Fe.filter,Fe.layers,Fe.availableImages,Z);for(const yt in gt){const Mt=et[yt]=et[yt]||[],Dt=gt[yt];Dt.sort(((Nt,qt)=>{const Bt=rt.featureSortOrder;if(Bt){const rn=Bt.indexOf(Nt.featureIndex);return Bt.indexOf(qt.featureIndex)-rn}return qt.featureIndex-Nt.featureIndex}));for(const Nt of Dt)Mt.push(Nt)}}for(const rt in et)et[rt].forEach((gt=>{const yt=gt.feature,Mt=ce(Z[rt]);if(!Mt)return;const Dt=Mt.getFeatureState(yt.layer["source-layer"],yt.id);yt.source=yt.layer.source,yt.layer["source-layer"]&&(yt.sourceLayer=yt.layer["source-layer"]),yt.state=Dt}));return et})(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),W.screenGeometry,m,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(P)}querySourceFeatures(l,m){m&&m.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",m.filter,null,m);const b=this._getSourceCaches(l);let I=[];for(const P of b)I=I.concat(Os(P,m));return I}addSourceType(l,m,b){return ji.getSourceType(l)?b(new Error(`A source type called "${l}" already exists.`)):(ji.setSourceType(l,m),m.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:m.workerSourceURL},b):b(null,null))}getLight(){return this.light.getLight()}setLight(l,m={}){this._checkLoaded();const b=this.light.getLight();let I=!1;for(const j in l)if(!T(l[j],b[j])){I=!0;break}if(!I)return;const P=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(l,m),this.light.updateTransitions(P)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,m=1){if(this._checkLoaded(),!l)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let b=l;if(m===1){if(typeof b.source=="object"){const I="terrain-dem-src";this.addSource(I,b.source),b=s.clone$1(b),b=s.extend(b,{source:I})}if(this._validate(s.validateTerrain,"terrain",b))return}if(!this.terrain||this.terrain&&m!==this.terrain.drapeRenderMode){if(!b)return;this._createTerrain(b,m)}else{const I=this.terrain,P=I.get();for(const j of Object.keys(s.spec.terrain))!b.hasOwnProperty(j)&&s.spec.terrain[j].default&&(b[j]=s.spec.terrain[j].default);for(const j in b)if(!T(b[j],P[j])){I.set(b),this.stylesheet.terrain=b;const W=this._setTransitionParameters({duration:0});I.updateTransitions(W);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const m=this.fog=new Ke(l,this.map.transform);this.stylesheet.fog=l;const b=this._setTransitionParameters({duration:0});m.updateTransitions(b)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const l of this.map._markers)l._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const m=this.fog,b=m.get();Object.keys(l).length===0&&m.set(l);for(const I in l)if(!T(l[I],b[I])){m.set(l),this.stylesheet.fog=l;const P=this._setTransitionParameters({duration:0});m.updateTransitions(P);break}}else this._createFog(l);this._markersNeedUpdate=!0}_setTransitionParameters(l){return{now:s.exported.now(),transition:s.extend(l,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const l=this._order.filter((b=>this.isLayerDraped(this._layers[b]))),m=this._order.filter((b=>!this.isLayerDraped(this._layers[b])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...m)}_createTerrain(l,m){const b=this.terrain=new $e(l,m);this.stylesheet.terrain=l,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const I=this._setTransitionParameters({duration:0});b.updateTransitions(I)}_force3DLayerUpdate(){for(const l in this._layers){const m=this._layers[l];m.type==="fill-extrusion"&&this._updateLayer(m)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const m=this._layers[l];m.type==="symbol"&&this._updateLayer(m)}}_validate(l,m,b,I,P={}){return(!P||P.validate!==!1)&&ol(this,l.call(s.validateStyle,s.extend({key:m,style:this.serialize(),value:b,styleSpec:s.spec},I)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this._sourceCaches)this._sourceCaches[l].clearTiles(),this._sourceCaches[l].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(l){const m=this._getSourceCaches(l);for(const b of m)b.clearTiles()}_reloadSource(l){const m=this._getSourceCaches(l);for(const b of m)b.resume(),b.reload()}_reloadSources(){for(const l of this._getSources())l.reload&&l.reload()}_updateSources(l){for(const m in this._sourceCaches)this._sourceCaches[m].update(l)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const m=this._sourceCaches[l];m.resume(),m.reload()}}_updatePlacement(l,m,b,I,P=!1){let j=!1,W=!1;const Z={};for(const le of this._order){const ce=this._layers[le];if(ce.type!=="symbol")continue;if(!Z[ce.source]){const Fe=this._getLayerSourceCache(ce);if(!Fe)continue;Z[ce.source]=Fe.getRenderableIds(!0).map((qe=>Fe.getTileByID(qe))).sort(((qe,at)=>at.tileID.overscaledZ-qe.tileID.overscaledZ||(qe.tileID.isLessThan(at.tileID)?-1:1)))}const Ee=this.crossTileSymbolIndex.addLayer(ce,Z[ce.source],l.center.lng,l.projection);j=j||Ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),P=P||this._layerOrderChanged||b===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(P||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),l.zoom))&&(this.pauseablePlacement=new ha(l,this._order,P,m,b,I,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),W=!0),j&&this.pauseablePlacement.placement.setStale()),W||j)for(const le of this._order){const ce=this._layers[le];ce.type==="symbol"&&this.placement.updateLayerOpacities(ce,Z[ce.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,m,b){this.imageManager.getImages(m.icons,b),this._updateTilesForChangedImages();const I=P=>{P&&P.setDependencies(m.tileID.key,m.type,m.icons)};I(this._otherSourceCaches[m.source]),I(this._symbolSourceCaches[m.source])}getGlyphs(l,m,b){this.glyphManager.getGlyphs(m.stacks,b)}getResource(l,m,b){return s.makeRequest(m,b)}_getSourceCache(l){return this._otherSourceCaches[l]}_getLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}_getSourceCaches(l){const m=[];return this._otherSourceCaches[l]&&m.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&m.push(this._symbolSourceCaches[l]),m}_isSourceCacheLoaded(l){const m=this._getSourceCaches(l);return m.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${l}'`))),!1):m.every((b=>b.loaded()))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ji.getSourceType=function(x){return Zr[x]},ji.setSourceType=function(x,l){Zr[x]=l},ji.registerForPluginStateChange=s.registerForPluginStateChange;var qs=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Lo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",_a=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,zo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ml=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Po={},fa={};const va=[];sn(qs,va),sn(_a,va),sn(zo,va),sn(ml,va),Po=fn("",_a),fa=fn(ml,zo);const ee=fn(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),je=qs,At=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var kt={background:fn(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:fn(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:fn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:fn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:fn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:fn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:fn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:fn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:fn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:fn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:fn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:fn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:fn(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:fn(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:fn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:fn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:fn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:fn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:fn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:fn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:fn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:fn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:fn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:fn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Lo),skyboxGradient:fn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Lo),skyboxCapture:fn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:fn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:fn(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function sn(x,l){const m=x.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let b of m)if(b=b.trim(),b[0]==="#"&&b.includes("if")&&!b.includes("endif")){b=b.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const I=b.split(" ");for(const P of I)l.includes(P)||l.push(P)}}function fn(x,l){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,b=l.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),I={},P=[...va];return sn(x,P),sn(l,P),{fragmentSource:x=x.replace(m,((j,W,Z,le,ce)=>(I[ce]=!0,W==="define"?`
#ifndef HAS_UNIFORM_u_${ce}
varying ${Z} ${le} ${ce};
#else
uniform ${Z} ${le} u_${ce};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ce}
    ${Z} ${le} ${ce} = u_${ce};
#endif
`))),vertexSource:l=l.replace(m,((j,W,Z,le,ce)=>{const Ee=le==="float"?"vec2":"vec4",Fe=ce.match(/color/)?"color":Ee;return I[ce]?W==="define"?`
#ifndef HAS_UNIFORM_u_${ce}
uniform lowp float u_${ce}_t;
attribute ${Z} ${Ee} a_${ce};
varying ${Z} ${le} ${ce};
#else
uniform ${Z} ${le} u_${ce};
#endif
`:Fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ce}
    ${ce} = a_${ce};
#else
    ${Z} ${le} ${ce} = u_${ce};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ce}
    ${ce} = unpack_mix_${Fe}(a_${ce}, u_${ce}_t);
#else
    ${Z} ${le} ${ce} = u_${ce};
#endif
`:W==="define"?`
#ifndef HAS_UNIFORM_u_${ce}
uniform lowp float u_${ce}_t;
attribute ${Z} ${Ee} a_${ce};
#else
uniform ${Z} ${le} u_${ce};
#endif
`:Fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ce}
    ${Z} ${le} ${ce} = a_${ce};
#else
    ${Z} ${le} ${ce} = u_${ce};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ce}
    ${Z} ${le} ${ce} = unpack_mix_${Fe}(a_${ce}, u_${ce}_t);
#else
    ${Z} ${le} ${ce} = u_${ce};
#endif
`})),staticAttributes:b,usedDefines:P}}class Qn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,m,b,I,P,j,W){this.context=l;let Z=this.boundPaintVertexBuffers.length!==I.length;for(let ce=0;!Z&&ce<I.length;ce++)this.boundPaintVertexBuffers[ce]!==I[ce]&&(Z=!0);let le=this.boundDynamicVertexBuffers.length!==W.length;for(let ce=0;!le&&ce<W.length;ce++)this.boundDynamicVertexBuffers[ce]!==W[ce]&&(le=!0);if(!l.extVertexArrayObject||!this.vao||this.boundProgram!==m||this.boundLayoutVertexBuffer!==b||Z||le||this.boundIndexBuffer!==P||this.boundVertexOffset!==j)this.freshBind(m,b,I,P,j,W);else{l.bindVertexArrayOES.set(this.vao);for(const ce of W)ce&&ce.bind();P&&P.dynamicDraw&&P.bind()}}freshBind(l,m,b,I,P,j){let W;const Z=l.numAttributes,le=this.context,ce=le.gl;if(le.extVertexArrayObject)this.vao&&this.destroy(),this.vao=le.extVertexArrayObject.createVertexArrayOES(),le.bindVertexArrayOES.set(this.vao),W=0,this.boundProgram=l,this.boundLayoutVertexBuffer=m,this.boundPaintVertexBuffers=b,this.boundIndexBuffer=I,this.boundVertexOffset=P,this.boundDynamicVertexBuffers=j;else{W=le.currentNumAttributes||0;for(let Ee=Z;Ee<W;Ee++)ce.disableVertexAttribArray(Ee)}m.enableAttributes(ce,l),m.bind(),m.setVertexAttribPointers(ce,l,P);for(const Ee of b)Ee.enableAttributes(ce,l),Ee.bind(),Ee.setVertexAttribPointers(ce,l,P);for(const Ee of j)Ee&&(Ee.enableAttributes(ce,l),Ee.bind(),Ee.setVertexAttribPointers(ce,l,P));I&&I.bind(),le.currentNumAttributes=Z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Xr(x,l){const m=Math.pow(2,l.canonical.z),b=l.canonical.y;return[new s.MercatorCoordinate(0,b/m).toLngLat().lat,new s.MercatorCoordinate(0,(b+1)/m).toLngLat().lat]}function Qr(x,l,m,b,I,P,j){const W=x.context,Z=W.gl,le=m.fbo;if(!le)return;x.prepareDrawTile();const ce=x.useProgram("hillshade");W.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,le.colorAttachment.get());const Ee=((et,lt,Ie,rt)=>{const gt=Ie.paint.get("hillshade-shadow-color"),yt=Ie.paint.get("hillshade-highlight-color"),Mt=Ie.paint.get("hillshade-accent-color");let Dt=Ie.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ie.paint.get("hillshade-illumination-anchor")==="viewport"&&(Dt-=et.transform.angle);const Nt=!et.options.moving;return{u_matrix:rt||et.transform.calculateProjMatrix(lt.tileID.toUnwrapped(),Nt),u_image:0,u_latrange:Xr(0,lt.tileID),u_light:[Ie.paint.get("hillshade-exaggeration"),Dt],u_shadow:gt,u_highlight:yt,u_accent:Mt}})(x,m,b,x.terrain?l.projMatrix:null);x.prepareDrawProgram(W,ce,l.toUnwrapped());const{tileBoundsBuffer:Fe,tileBoundsIndexBuffer:qe,tileBoundsSegments:at}=x.getTileBoundsBuffers(m);ce.draw(W,Z.TRIANGLES,I,P,j,s.CullFaceMode.disabled,Ee,b.id,Fe,qe,at)}function oi(x,l,m){if(!l.needsDEMTextureUpload)return;const b=x.context,I=b.gl;b.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||x.getTileTexture(m.stride);const P=m.getPixels();l.demTexture?l.demTexture.update(P,{premultiply:!1}):l.demTexture=new s.Texture(b,P,I.RGBA,{premultiply:!1}),l.needsDEMTextureUpload=!1}function Ui(x,l,m,b,I,P){const j=x.context,W=j.gl;if(!l.dem)return;const Z=l.dem;if(j.activeTexture.set(W.TEXTURE1),oi(x,l,Z),!l.demTexture)return;l.demTexture.bind(W.NEAREST,W.CLAMP_TO_EDGE);const le=Z.dim;j.activeTexture.set(W.TEXTURE0);let ce=l.fbo;if(!ce){const at=new s.Texture(j,{width:le,height:le,data:null},W.RGBA);at.bind(W.LINEAR,W.CLAMP_TO_EDGE),ce=l.fbo=j.createFramebuffer(le,le,!0),ce.colorAttachment.set(at.texture)}j.bindFramebuffer.set(ce.framebuffer),j.viewport.set([0,0,le,le]);const{tileBoundsBuffer:Ee,tileBoundsIndexBuffer:Fe,tileBoundsSegments:qe}=x.getMercatorTileBoundsBuffers();x.useProgram("hillshadePrepare").draw(j,W.TRIANGLES,b,I,P,s.CullFaceMode.disabled,((at,et)=>{const lt=et.stride,Ie=s.create();return s.ortho(Ie,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(Ie,Ie,[0,-s.EXTENT,0]),{u_matrix:Ie,u_image:1,u_dimension:[lt,lt],u_zoom:at.overscaledZ,u_unpack:et.unpackVector}})(l.tileID,Z),m.id,Ee,Fe,qe),l.needsHillshadePrepare=!1}const Ps=x=>({u_matrix:new s.UniformMatrix4f(x),u_image0:new s.Uniform1i(x),u_skirt_height:new s.Uniform1f(x)}),Bs=(x,l)=>({u_matrix:x,u_image0:0,u_skirt_height:l}),fo=(x,l,m,b,I,P,j,W,Z,le,ce,Ee,Fe,qe,at)=>({u_proj_matrix:Float32Array.from(x),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(b),u_merc_matrix:m,u_zoom_transition:I,u_merc_center:P,u_image0:0,u_frustum_tl:j,u_frustum_tr:W,u_frustum_br:Z,u_frustum_bl:le,u_globe_pos:ce,u_globe_radius:Ee,u_viewport:Fe,u_grid_matrix:at?Float32Array.from(at):new Float32Array(9),u_skirt_height:qe});function Ys(x,l){return x!=null&&l!=null&&!(!x.hasData()||!l.hasData())&&x.demTexture!=null&&l.demTexture!=null&&x.tileID.key!==l.tileID.key}const Zs=new class{constructor(){this.operations={}}newMorphing(x,l,m,b,I){if(x in this.operations){const P=this.operations[x];P.to.tileID.key!==m.tileID.key&&(P.queued=m)}else this.operations[x]={startTime:b,phase:0,duration:I,from:l,to:m,queued:null}}getMorphValuesForProxy(x){if(!(x in this.operations))return null;const l=this.operations[x];return{from:l.from,to:l.to,phase:l.phase}}update(x){for(const l in this.operations){const m=this.operations[l];for(m.phase=(x-m.startTime)/m.duration;m.phase>=1||!this._validOp(m);)if(!this._nextOp(m,x)){delete this.operations[l];break}}}_nextOp(x,l){return!!x.queued&&(x.from=x.to,x.to=x.queued,x.queued=null,x.phase=0,x.startTime=l,!0)}_validOp(x){return x.from.hasData()&&x.to.hasData()}},go={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ns(x){return 6*Math.pow(1.5,22-x)}function io(x,l){const m=1<<x.z;return!l&&(x.x===0||x.x===m-1)||x.y===0||x.y===m-1}const zs=x=>({u_matrix:x});function Fl(x,l,m,b,I){if(I>0){const P=s.exported.now(),j=(P-x.timeAdded)/I,W=l?(P-l.timeAdded)/I:-1,Z=m.getSource(),le=b.coveringZoomLevel({tileSize:Z.tileSize,roundZoom:Z.roundZoom}),ce=!l||Math.abs(l.tileID.overscaledZ-le)>Math.abs(x.tileID.overscaledZ-le),Ee=ce&&x.refreshedUponExpiration?1:s.clamp(ce?j:1-W,0,1);return x.refreshedUponExpiration&&j>=1&&(x.refreshedUponExpiration=!1),l?{opacity:1,mix:1-Ee}:{opacity:Ee,mix:0}}return{opacity:1,mix:0}}class gl extends s.SourceCache{constructor(l){const m={type:"raster-dem",maxzoom:l.transform.maxZoom},b=new Ce(ua(),null),I=Br("mock-dem",m,b,l.style);super("mock-dem",I,!1),I.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,m){l.state="loaded",m(null)}}class O extends s.SourceCache{constructor(l){const m=Br("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new Ce(ua(),null),l.style);super("proxy",m,!1),m.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,m,b){if(l.freezeTileCoverage)return;this.transform=l;const I=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((P,j)=>{if(P[j.key]="",!this._tiles[j.key]){const W=new s.Tile(j,this._source.tileSize*j.overscaleFactor(),l.tileZoom);W.state="loaded",this._tiles[j.key]=W}return P}),{});for(const P in this._tiles)P in I||(this.freeFBO(P),this._tiles[P].unloadVectorData(),delete this._tiles[P])}freeFBO(l){const m=this.proxyCachedFBO[l];if(m!==void 0){const b=Object.values(m);this.renderCachePool.push(...b),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach((l=>l.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class me extends s.OverscaledTileID{constructor(l,m,b){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=m,this.projMatrix=b}}class ke extends s.Elevation{constructor(l,m){super(),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[b,I,P]=(function(Z){const le=new s.StructArrayLayout2i4,ce=new s.StructArrayLayout3ui6,Ee=131;le.reserve(17161),ce.reserve(33800);const Fe=s.EXTENT/128,qe=s.EXTENT+Fe/2,at=qe+Fe;for(let lt=-Fe;lt<at;lt+=Fe)for(let Ie=-Fe;Ie<at;Ie+=Fe){const rt=Ie<0||Ie>qe||lt<0||lt>qe?24575:0,gt=s.clamp(Math.round(Ie),0,s.EXTENT),yt=s.clamp(Math.round(lt),0,s.EXTENT);le.emplaceBack(gt+rt,yt)}const et=(lt,Ie)=>{const rt=Ie*Ee+lt;ce.emplaceBack(rt+1,rt,rt+Ee),ce.emplaceBack(rt+Ee,rt+Ee+1,rt+1)};for(let lt=1;lt<129;lt++)for(let Ie=1;Ie<129;Ie++)et(Ie,lt);return[0,129].forEach((lt=>{for(let Ie=0;Ie<130;Ie++)et(Ie,lt),et(lt,Ie)})),[le,ce,32768]})(),j=l.context;this.gridBuffer=j.createVertexBuffer(b,s.posAttributes.members),this.gridIndexBuffer=j.createIndexBuffer(I),this.gridSegments=s.SegmentVector.simpleSegment(0,0,b.length,I.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,b.length,P),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new O(m.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.EXTENT,0,s.EXTENT,0,1);const W=j.gl;this._overlapStencilMode=new s.StencilMode({func:W.GEQUAL,mask:255},0,255,W.KEEP,W.KEEP,W.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=m,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new gl(m.map)}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),l.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=l,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(l,m,b){if(l&&l.terrain){this._style!==l&&(this.style=l),this.enabled=!0;const I=l.terrain.properties;this.sourceCache=l.terrain.drapeRenderMode===0?this._mockSourceCache:l._getSourceCache(I.get("source")),this._exaggeration=I.get("exaggeration");const P=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const j=this.getScaledDemTileSize();this.sourceCache.update(m,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,P(),this._initializing=!0),P(),m.updateElevation(!0,b),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(m),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const l=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||l.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${l.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${l.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._sourceCaches)this._style._sourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((l=>l.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const m=this.proxySourceCache,b=this.painter.transform;this._initializing&&(this._initializing=b._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(b.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const I=this.proxyCoords=m.getIds().map((Z=>{const le=m.getTileByID(Z).tileID;return le.projMatrix=b.calculateProjMatrix(le.toUnwrapped()),le}));(function(Z,le){const ce=le.transform.pointCoordinate(le.transform.getCameraPoint()),Ee=new s.Point(ce.x,ce.y);Z.sort(((Fe,qe)=>{if(qe.overscaledZ-Fe.overscaledZ)return qe.overscaledZ-Fe.overscaledZ;const at=new s.Point(Fe.canonical.x+(1<<Fe.canonical.z)*Fe.wrap,Fe.canonical.y),et=new s.Point(qe.canonical.x+(1<<qe.canonical.z)*qe.wrap,qe.canonical.y),lt=Ee.mult(1<<Fe.canonical.z);return lt.x-=.5,lt.y-=.5,lt.distSqr(at)-lt.distSqr(et)}))})(I,this.painter),this._previousZoom=b.zoom;const P=this.proxyToSource||{};this.proxyToSource={},I.forEach((Z=>{this.proxyToSource[Z.key]={}})),this.terrainTileForTile={};const j=this._style._sourceCaches;for(const Z in j){const le=j[Z];if(!le.used||(le!==this.sourceCache&&this.resetTileLookupCache(le.id),this._setupProxiedCoordsForOrtho(le,l[Z],P),le.usedForTerrain))continue;const ce=l[Z];le.getSource().reparseOverscaled&&this._assignTerrainTiles(ce)}this.proxiedCoords[m.id]=I.map((Z=>new me(Z,Z.key,this.orthoMatrix))),this._assignTerrainTiles(I),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(P),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const W={};this._visibleDemTiles=[];for(const Z of this.proxyCoords){const le=this.terrainTileForTile[Z.key];if(!le)continue;const ce=le.tileID.key;ce in W||(this._visibleDemTiles.push(le),W[ce]=ce)}}_assignTerrainTiles(l){this._initializing||l.forEach((m=>{if(this.terrainTileForTile[m.key])return;const b=this._findTileCoveringTileID(m,this.sourceCache);b&&(this.terrainTileForTile[m.key]=b)}))}_prepareDEMTextures(){const l=this.painter.context,m=l.gl;for(const b in this.terrainTileForTile){const I=this.terrainTileForTile[b],P=I.dem;!P||I.demTexture&&!I.needsDEMTextureUpload||(l.activeTexture.set(m.TEXTURE1),oi(this.painter,I,P))}}_prepareDemTileUniforms(l,m,b,I){if(!m||m.demTexture==null)return!1;const P=l.tileID.canonical,j=Math.pow(2,m.tileID.canonical.z-P.z),W=I||"";return b[`u_dem_tl${W}`]=[P.x*j%1,P.y*j%1],b[`u_dem_scale${W}`]=j,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const l=this.painter.context,m=l.gl;if(!this._emptyDepthBufferTexture){const b=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(l,b,m.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0;const m=this._visibleDemTiles.reduce(((b,I)=>{if(!I.dem)return b;const P=I.dem.tree.minimums[0];return P>0&&l++,b+P}),0);return l?m/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,m=l.gl;l.activeTexture.set(m.TEXTURE2);const b=this._getLoadedAreaMinimum(),I=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(b,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let P=this._emptyDEMTexture;return P?P.update(I,{premultiply:!1}):P=this._emptyDEMTexture=new s.Texture(l,I,m.RGBA,{premultiply:!1}),P}setupElevationDraw(l,m,b){const I=this.painter.context,P=I.gl,j=(W=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(W),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var W;j.u_dem_size=this.sourceCache.getSource().tileSize,j.u_exaggeration=this.exaggeration();let Z=null,le=null,ce=1;if(b&&b.morphing&&this._useVertexMorphing){const Ee=b.morphing.srcDemTile,Fe=b.morphing.dstDemTile;ce=b.morphing.phase,Ee&&Fe&&(this._prepareDemTileUniforms(l,Ee,j,"_prev")&&(le=Ee),this._prepareDemTileUniforms(l,Fe,j)&&(Z=Fe))}if(le&&Z?(I.activeTexture.set(P.TEXTURE2),Z.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE,P.NEAREST),I.activeTexture.set(P.TEXTURE4),le.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE,P.NEAREST),j.u_dem_lerp=ce):(Z=this.terrainTileForTile[l.tileID.key],I.activeTexture.set(P.TEXTURE2),(this._prepareDemTileUniforms(l,Z,j)?Z.demTexture:this.emptyDEMTexture).bind(P.NEAREST,P.CLAMP_TO_EDGE)),I.activeTexture.set(P.TEXTURE3),b&&b.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE),this._depthFBO&&(j.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE),j.u_depth_size_inv=[1,1]),b&&b.useMeterToDem&&Z){const Ee=(1<<Z.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;j.u_meter_to_dem=Ee}if(b&&b.labelPlaneMatrixInv&&(j.u_label_plane_matrix_inv=b.labelPlaneMatrixInv),m.setTerrainUniformValues(I,j),this.painter.transform.projection.name==="globe"){const Ee=this.globeUniformValues(this.painter.transform,l.tileID.canonical,b&&b.useDenormalizedUpVectorScale);m.setGlobeUniformValues(I,Ee)}}globeUniformValues(l,m,b){const I=l.projection;return{u_tile_tl_up:I.upVector(m,0,0),u_tile_tr_up:I.upVector(m,s.EXTENT,0),u_tile_br_up:I.upVector(m,s.EXTENT,s.EXTENT),u_tile_bl_up:I.upVector(m,0,s.EXTENT),u_tile_up_scale:b?s.globeMetersToEcef(1):I.upVectorScale(m,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const m=this.painter,b=this.painter.context;l.length!==0&&(b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height]),m.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(I,P,j,W,Z){if(I.transform.projection.name==="globe")(function(le,ce,Ee,Fe,qe){const at=le.context,et=at.gl;let lt,Ie;const rt=le.options.showTerrainWireframe?2:0,gt=le.transform,yt=s.globeUseCustomAntiAliasing(le,at,gt),Mt=(Vn,tn)=>{if(Ie===Vn)return;const bn=[go[Vn],"PROJECTION_GLOBE_VIEW"];yt&&bn.push("CUSTOM_ANTIALIASING"),tn&&bn.push(go[rt]),lt=le.useProgram("globeRaster",null,bn),Ie=Vn},Dt=le.colorModeForRenderPass(),Nt=new s.DepthMode(et.LEQUAL,s.DepthMode.ReadWrite,le.depthRangeFor3D);Zs.update(qe);const qt=s.calculateGlobeMercatorMatrix(gt),Bt=[s.mercatorXfromLng(gt.center.lng),s.mercatorYfromLat(gt.center.lat)],rn=rt?[!1,!0]:[!1],Rn=le.globeSharedBuffers,Jt=[gt.width*s.exported.devicePixelRatio,gt.height*s.exported.devicePixelRatio],An=Float32Array.from(gt.globeMatrix),cn={useDenormalizedUpVectorScale:!0};if(rn.forEach((Vn=>{const tn=le.transform,bn=Ns(tn.zoom)*ce.exaggeration();Ie=-1;const Un=Vn?et.LINES:et.TRIANGLES;for(const In of Fe){const Wn=Ee.getTile(In),Nr=s.StencilMode.disabled,ei=ce.prevTerrainTileForTile[In.key],Er=ce.terrainTileForTile[In.key];Ys(ei,Er)&&Zs.newMorphing(In.key,ei,Er,qe,250),at.activeTexture.set(et.TEXTURE0),Wn.texture.bind(et.LINEAR,et.CLAMP_TO_EDGE);const gr=Zs.getMorphValuesForProxy(In.key),Ai=gr?1:0;gr&&s.extend$1(cn,{morphing:{srcDemTile:gr.from,dstDemTile:gr.to,phase:s.easeCubicInOut(gr.phase)}});const Mi=s.tileCornersToBounds(In.canonical),Vr=s.getLatitudinalLod(Mi.getCenter().lat),Yi=s.getGridMatrix(In.canonical,Mi,Vr,tn.worldSize/tn._pixelsPerMercatorPixel),Ki=s.globeNormalizeECEF(s.globeTileBounds(In.canonical)),ts=fo(tn.projMatrix,An,qt,Ki,s.globeToMercatorTransition(tn.zoom),Bt,tn.frustumCorners.TL,tn.frustumCorners.TR,tn.frustumCorners.BR,tn.frustumCorners.BL,tn.globeCenterInViewSpace,tn.globeRadius,Jt,bn,Yi);if(Mt(Ai,Vn),ce.setupElevationDraw(Wn,lt,cn),le.prepareDrawProgram(at,lt,In.toUnwrapped()),Rn){const[Gs,wa,$o]=Vn?Rn.getWirefameBuffers(le.context,Vr):Rn.getGridBuffers(Vr,bn!==0);lt.draw(at,Un,Nt,Nr,Dt,s.CullFaceMode.backCCW,ts,"globe_raster",Gs,wa,$o)}}})),Rn){const Vn=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];yt&&Vn.push("CUSTOM_ANTIALIASING"),lt=le.useProgram("globeRaster",null,Vn);for(const tn of Fe){const{x:bn,y:Un,z:In}=tn.canonical,Wn=Un===0,Nr=Un===(1<<In)-1,[ei,Er,gr,Ai]=Rn.getPoleBuffers(In);if(Ai&&(Wn||Nr)){const Mi=Ee.getTile(tn);at.activeTexture.set(et.TEXTURE0),Mi.texture.bind(et.LINEAR,et.CLAMP_TO_EDGE);let Vr=s.globePoleMatrixForTile(In,bn,gt);const Yi=s.globeNormalizeECEF(s.globeTileBounds(tn.canonical)),Ki=(ts,Gs)=>ts.draw(at,et.TRIANGLES,Nt,s.StencilMode.disabled,Dt,s.CullFaceMode.disabled,fo(gt.projMatrix,Vr,Vr,Yi,0,Bt,gt.frustumCorners.TL,gt.frustumCorners.TR,gt.frustumCorners.BR,gt.frustumCorners.BL,gt.globeCenterInViewSpace,gt.globeRadius,Jt,0),"globe_pole_raster",Gs,gr,Ai);ce.setupElevationDraw(Mi,lt,cn),le.prepareDrawProgram(at,lt,tn.toUnwrapped()),Wn&&Ki(lt,ei),Nr&&(Vr=s.scale(s.create(),Vr,[1,-1,1]),Ki(lt,Er))}}}})(I,P,j,W,Z);else{const le=I.context,ce=le.gl;let Ee,Fe;const qe=I.options.showTerrainWireframe?2:0,at=(gt,yt)=>{if(Fe===gt)return;const Mt=[go[gt]];yt&&Mt.push(go[qe]),Ee=I.useProgram("terrainRaster",null,Mt),Fe=gt},et=I.colorModeForRenderPass(),lt=new s.DepthMode(ce.LEQUAL,s.DepthMode.ReadWrite,I.depthRangeFor3D);Zs.update(Z);const Ie=I.transform,rt=Ns(Ie.zoom)*P.exaggeration();(qe?[!1,!0]:[!1]).forEach((gt=>{Fe=-1;const yt=gt?ce.LINES:ce.TRIANGLES,[Mt,Dt]=gt?P.getWirefameBuffer():[P.gridIndexBuffer,P.gridSegments];for(const Nt of W){const qt=j.getTile(Nt),Bt=s.StencilMode.disabled,rn=P.prevTerrainTileForTile[Nt.key],Rn=P.terrainTileForTile[Nt.key];Ys(rn,Rn)&&Zs.newMorphing(Nt.key,rn,Rn,Z,250),le.activeTexture.set(ce.TEXTURE0),qt.texture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE,ce.LINEAR_MIPMAP_NEAREST);const Jt=Zs.getMorphValuesForProxy(Nt.key),An=Jt?1:0;let cn;Jt&&(cn={morphing:{srcDemTile:Jt.from,dstDemTile:Jt.to,phase:s.easeCubicInOut(Jt.phase)}});const Vn=Bs(Nt.projMatrix,io(Nt.canonical,Ie.renderWorldCopies)?rt/10:rt);at(An,gt),P.setupElevationDraw(qt,Ee,cn),I.prepareDrawProgram(le,Ee,Nt.toUnwrapped()),Ee.draw(le,yt,lt,Bt,et,s.CullFaceMode.backCCW,Vn,"terrain_raster",P.gridBuffer,Mt,Dt)}}))}})(m,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,m.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;const m=this.painter,b=this.painter.context,I=this.proxySourceCache,P=this.proxiedCoords[I.id],j=this._drapedRenderBatches.shift(),W=[],Z=m.style.order;let le=0;for(const ce of P){const Ee=I.getTileByID(ce.proxyTileKey),Fe=I.proxyCachedFBO[ce.key]?I.proxyCachedFBO[ce.key][l]:void 0,qe=Fe!==void 0?I.renderCache[Fe]:this.pool[le++],at=Fe!==void 0;if(Ee.texture=qe.tex,at&&!qe.dirty){W.push(Ee.tileID);continue}let et;b.bindFramebuffer.set(qe.fb.framebuffer),this.renderedToTile=!1,qe.dirty&&(b.clear({color:s.Color.transparent,stencil:0}),qe.dirty=!1);for(let lt=j.start;lt<=j.end;++lt){const Ie=m.style._layers[Z[lt]];if(Ie.isHidden(m.transform.zoom))continue;const rt=m.style._getLayerSourceCache(Ie),gt=rt?this.proxyToSource[ce.key][rt.id]:[ce];if(!gt)continue;const yt=gt;b.viewport.set([0,0,qe.fb.width,qe.fb.height]),et!==(rt?rt.id:null)&&(this._setupStencil(qe,gt,Ie,rt),et=rt?rt.id:null),m.renderLayer(m,rt,Ie,yt)}this.renderedToTile?(qe.dirty=!0,W.push(Ee.tileID)):at||--le,le===5&&(le=0,this.renderToBackBuffer(W))}return this.renderToBackBuffer(W),this.renderingToTexture=!1,b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height]),j.end+1}postRender(){}renderCacheEfficiency(l){const m=l.order.length;if(m===0)return{efficiency:100};let b,I=0,P=0,j=!1;for(let W=0;W<m;++W){const Z=l._layers[l.order[W]];this._style.isLayerDraped(Z)?(j&&++I,++P):j||(j=!0,b=Z.id)}return P===0?{efficiency:100}:{efficiency:100*(1-I/P),firstUndrapedLayer:b}}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter((m=>m.dem)).forEach((m=>{l=Math.min(l,m.dem.tree.minimums[0])})),l===0?l:(l-30)*this._exaggeration}raycast(l,m,b){if(!this._visibleDemTiles)return null;const I=this._visibleDemTiles.filter((P=>P.dem)).map((P=>{const j=P.tileID,W=1<<j.overscaledZ,{x:Z,y:le}=j.canonical,ce=Z/W,Ee=(Z+1)/W,Fe=le/W,qe=(le+1)/W;return{minx:ce,miny:Fe,maxx:Ee,maxy:qe,t:P.dem.tree.raycastRoot(ce,Fe,Ee,qe,l,m,b),tile:P}}));I.sort(((P,j)=>(P.t!==null?P.t:Number.MAX_VALUE)-(j.t!==null?j.t:Number.MAX_VALUE)));for(const P of I){if(P.t==null)return null;const j=P.tile.dem.tree.raycast(P.minx,P.miny,P.maxx,P.maxy,l,m,b);if(j!=null)return j}return null}_createFBO(){const l=this.painter.context,m=l.gl,b=this.drapeBufferSize;l.activeTexture.set(m.TEXTURE0);const I=new s.Texture(l,{width:b[0],height:b[1],data:null},m.RGBA);I.bind(m.LINEAR,m.CLAMP_TO_EDGE);const P=l.createFramebuffer(b[0],b[1],!1);return P.colorAttachment.set(I.texture),P.depthAttachment=new Ot(l,P.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,b[0],b[1]),this._stencilRef=0,P.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):P.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&!l.extTextureFilterAnisotropicForceOff&&m.texParameterf(m.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:P,tex:I,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l].hasTransition())return!0;return this._style.order.some((l=>{const m=this._style._layers[l],b=m.isHidden(this.painter.transform.zoom);return m.type==="custom"?!b&&m.shouldRedrape():!b&&m.hasTransition()}))}_clearLineLayersFromRenderCache(){let l=!1;for(const b of this._style._getSources())if(b instanceof Jn){l=!0;break}if(!l)return;const m={};for(let b=0;b<this._style.order.length;++b){const I=this._style._layers[this._style.order[b]],P=this._style._getLayerSourceCache(I);if(P&&!m[P.id]&&!I.isHidden(this.painter.transform.zoom)&&I.type==="line"&&I.widthExpression()instanceof s.ZoomDependentExpression){m[P.id]=!0;for(const j of this.proxyCoords){const W=this.proxyToSource[j.key][P.id];if(W)for(const Z of W)this._clearRenderCacheForTile(P.id,Z)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const b in this._style._sourceCaches)if(this._style._sourceCaches[b]._source instanceof Fn){l=!0;break}if(!l)return;const m={};for(let b=0;b<this._style.order.length;++b){const I=this._style._layers[this._style.order[b]],P=this._style._getLayerSourceCache(I);if(!P||m[P.id]||I.isHidden(this.painter.transform.zoom)||I.type!=="raster")continue;const j=I.paint.get("raster-fade-duration");for(const W of this.proxyCoords){const Z=this.proxyToSource[W.key][P.id];if(Z)for(const le of Z){const ce=Fl(P.getTile(le),P.findLoadedParent(le,0),P,this.painter.transform,j);(ce.opacity!==1||ce.mix!==0)&&this._clearRenderCacheForTile(P.id,le)}}}}_setupDrapedRenderBatches(){const l=this._style.order,m=l.length;if(m===0)return;const b=[];let I,P=0,j=this._style._layers[l[P]];for(;!this._style.isLayerDraped(j)&&j.isHidden(this.painter.transform.zoom)&&++P<m;)j=this._style._layers[l[P]];for(;P<m;++P){const W=this._style._layers[l[P]];W.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(W)?I===void 0&&(I=P):I!==void 0&&(b.push({start:I,end:P-1}),I=void 0))}I!==void 0&&b.push({start:I,end:P-1}),this._drapedRenderBatches=b}_setupRenderCache(l){const m=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,m.renderCache.length>m.renderCachePool.length){const j=Object.values(m.proxyCachedFBO);m.proxyCachedFBO={};for(let W=0;W<j.length;++W){const Z=Object.values(j[W]);m.renderCachePool.push(...Z)}}return}this._clearRasterLayersFromRenderCache();const b=this.proxyCoords,I=this._tilesDirty;for(let j=b.length-1;j>=0;j--){const W=b[j];if(m.getTileByID(W.key),m.proxyCachedFBO[W.key]!==void 0){const Z=l[W.key],le=this.proxyToSource[W.key];let ce=0;for(const Ee in le){const Fe=le[Ee],qe=Z[Ee];if(!qe||qe.length!==Fe.length||Fe.some(((at,et)=>at!==qe[et]||I[Ee]&&I[Ee].hasOwnProperty(at.key)))){ce=-1;break}++ce}for(const Ee in m.proxyCachedFBO[W.key])m.renderCache[m.proxyCachedFBO[W.key][Ee]].dirty=ce<0||ce!==Object.values(Z).length}}const P=[...this._drapedRenderBatches];P.sort(((j,W)=>W.end-W.start-(j.end-j.start)));for(const j of P)for(const W of b){if(m.proxyCachedFBO[W.key])continue;let Z=m.renderCachePool.pop();Z===void 0&&m.renderCache.length<50&&(Z=m.renderCache.length,m.renderCache.push(this._createFBO())),Z!==void 0&&(m.proxyCachedFBO[W.key]={},m.proxyCachedFBO[W.key][j.start]=Z,m.renderCache[Z].dirty=!0)}this._tilesDirty={}}_setupStencil(l,m,b,I){if(!I||!this._sourceTilesOverlap[I.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const P=this.painter.context,j=P.gl;if(m.length<=1)return void(this._overlapStencilType=!1);let W;if(b.isTileClipped())W=m.length,this._overlapStencilMode.test={func:j.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(m[0].overscaledZ>m[m.length-1].overscaledZ))return void(this._overlapStencilType=!1);W=1,this._overlapStencilMode.test={func:j.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+W>255&&(P.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=W,this._overlapStencilMode.ref=this._stencilRef,b.isTileClipped()&&this._renderTileClippingMasks(m,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(l,m){const b=this.painter,I=this.painter.context,P=I.gl;b._tileClippingMaskIDs={},I.setColorMode(s.ColorMode.disabled),I.setDepthMode(s.DepthMode.disabled);const j=b.useProgram("clippingMask");for(const W of l){const Z=b._tileClippingMaskIDs[W.key]=--m;j.draw(I,P.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:P.ALWAYS,mask:0},Z,255,P.KEEP,P.KEEP,P.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,zs(W.projMatrix),"$clipping",b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}}pointCoordinate(l){const m=this.painter.transform;if(l.x<0||l.x>m.width||l.y<0||l.y>m.height)return null;const b=[l.x,l.y,1,1];s.transformMat4$1(b,b,m.pixelMatrixInverse),s.scale$1(b,b,1/b[3]),b[0]/=m.worldSize,b[1]/=m.worldSize;const I=m._camera.position,P=s.mercatorZfromAltitude(1,m.center.lat),j=[I[0],I[1],I[2]/P,0],W=s.subtract([],b.slice(0,3),j);s.normalize(W,W);const Z=this.raycast(j,W,this._exaggeration);return Z!==null&&Z?(s.scaleAndAdd(j,j,W,Z),j[3]=j[2],j[2]*=P,j):null}drawDepth(){const l=this.painter,m=l.context,b=this.proxySourceCache,I=Math.ceil(l.width),P=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===I&&this._depthFBO.height===P||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const j=m.gl,W=m.createFramebuffer(I,P,!0);m.activeTexture.set(j.TEXTURE0);const Z=new s.Texture(m,{width:I,height:P,data:null},j.RGBA);Z.bind(j.NEAREST,j.CLAMP_TO_EDGE),W.colorAttachment.set(Z.texture);const le=m.createRenderbuffer(m.gl.DEPTH_COMPONENT16,I,P);W.depthAttachment.set(le),this._depthFBO=W,this._depthTexture=Z}m.bindFramebuffer.set(this._depthFBO.framebuffer),m.viewport.set([0,0,I,P]),(function(j,W,Z,le){if(j.transform.projection.name==="globe")return;const ce=j.context,Ee=ce.gl;ce.clear({depth:1});const Fe=j.useProgram("terrainDepth"),qe=new s.DepthMode(Ee.LESS,s.DepthMode.ReadWrite,j.depthRangeFor3D);for(const at of le){const et=Z.getTile(at),lt=Bs(at.projMatrix,0);W.setupElevationDraw(et,Fe),Fe.draw(ce,Ee.TRIANGLES,qe,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,lt,"terrain_depth",W.gridBuffer,W.gridIndexBuffer,W.gridNoSkirtSegments)}})(l,this,b,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,m,b){if(l.getSource()instanceof Mr)return this._setupProxiedCoordsForImageSource(l,m,b);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const I=this.proxiedCoords[l.id]=[],P=this.proxyCoords;for(let W=0;W<P.length;W++){const Z=P[W],le=this._findTileCoveringTileID(Z,l);if(le){const ce=this._createProxiedId(Z,le,b[Z.key]&&b[Z.key][l.id]);I.push(ce),this.proxyToSource[Z.key][l.id]=[ce]}}let j=!1;for(let W=0;W<m.length;W++){const Z=l.getTile(m[W]);if(!Z||!Z.hasData())continue;const le=this._findTileCoveringTileID(Z.tileID,this.proxySourceCache);if(le&&le.tileID.canonical.z!==Z.tileID.canonical.z){const ce=this.proxyToSource[le.tileID.key][l.id],Ee=this._createProxiedId(le.tileID,Z,b[le.tileID.key]&&b[le.tileID.key][l.id]);ce?ce.splice(ce.length-1,0,Ee):this.proxyToSource[le.tileID.key][l.id]=[Ee],I.push(Ee),j=!0}}this._sourceTilesOverlap[l.id]=j}_setupProxiedCoordsForImageSource(l,m,b){if(!l.getSource().loaded())return;const I=this.proxiedCoords[l.id]=[],P=this.proxyCoords,j=l.getSource(),W=new s.Point(j.tileID.x,j.tileID.y)._div(1<<j.tileID.z),Z=j.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce(((ce,Ee)=>(ce.min.x=Math.min(ce.min.x,Ee.x-W.x),ce.min.y=Math.min(ce.min.y,Ee.y-W.y),ce.max.x=Math.max(ce.max.x,Ee.x-W.x),ce.max.y=Math.max(ce.max.y,Ee.y-W.y),ce)),{min:new s.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),le=(ce,Ee)=>{const Fe=ce.wrap+ce.canonical.x/(1<<ce.canonical.z),qe=ce.canonical.y/(1<<ce.canonical.z),at=s.EXTENT/(1<<ce.canonical.z),et=Ee.wrap+Ee.canonical.x/(1<<Ee.canonical.z),lt=Ee.canonical.y/(1<<Ee.canonical.z);return Fe+at<et+Z.min.x||Fe>et+Z.max.x||qe+at<lt+Z.min.y||qe>lt+Z.max.y};for(let ce=0;ce<P.length;ce++){const Ee=P[ce];for(let Fe=0;Fe<m.length;Fe++){const qe=l.getTile(m[Fe]);if(!qe||!qe.hasData()||le(Ee,qe.tileID))continue;const at=this._createProxiedId(Ee,qe,b[Ee.key]&&b[Ee.key][l.id]),et=this.proxyToSource[Ee.key][l.id];et?et.push(at):this.proxyToSource[Ee.key][l.id]=[at],I.push(at)}}}_createProxiedId(l,m,b){let I=this.orthoMatrix;if(b){const P=b.find((j=>j.key===m.tileID.key));if(P)return P}if(m.tileID.key!==l.key){const P=l.canonical.z-m.tileID.canonical.z;let j,W,Z;I=s.create();const le=m.tileID.wrap-l.wrap<<l.overscaledZ;P>0?(j=s.EXTENT>>P,W=j*((m.tileID.canonical.x<<P)-l.canonical.x+le),Z=j*((m.tileID.canonical.y<<P)-l.canonical.y)):(j=s.EXTENT<<-P,W=s.EXTENT*(m.tileID.canonical.x-(l.canonical.x+le<<-P)),Z=s.EXTENT*(m.tileID.canonical.y-(l.canonical.y<<-P))),s.ortho(I,0,j,0,j,0,1),s.translate(I,I,[W,Z,0])}return new me(m.tileID,l.key,I)}_findTileCoveringTileID(l,m){let b=m.getTile(l);if(b&&b.hasData())return b;const I=this._findCoveringTileCache[m.id],P=I[l.key];if(b=P?m.getTileByID(P):null,b&&b.hasData()||P===null)return b;let j=b?b.tileID:l,W=j.overscaledZ;const Z=m.getSource().minzoom,le=[];if(!P){const Ee=m.getSource().maxzoom;if(l.canonical.z>=Ee){const Fe=l.canonical.z-Ee;m.getSource().reparseOverscaled?(W=Math.max(l.canonical.z+2,m.transform.tileZoom),j=new s.OverscaledTileID(W,l.wrap,Ee,l.canonical.x>>Fe,l.canonical.y>>Fe)):Fe!==0&&(W=Ee,j=new s.OverscaledTileID(W,l.wrap,Ee,l.canonical.x>>Fe,l.canonical.y>>Fe))}j.key!==l.key&&(le.push(j.key),b=m.getTile(j))}const ce=Ee=>{le.forEach((Fe=>{I[Fe]=Ee})),le.length=0};for(W-=1;W>=Z&&(!b||!b.hasData());W--){b&&ce(b.tileID.key);const Ee=j.calculateScaledKey(W);if(b=m.getTileByID(Ee),b&&b.hasData())break;const Fe=I[Ee];if(Fe===null)break;Fe===void 0?le.push(Ee):b=m.getTileByID(Fe)}return ce(b?b.tileID.key:null),b&&b.hasData()?b:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,m){let b=this._tilesDirty[l];b||(b=this._tilesDirty[l]={}),b[m.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const l=(function(m){let b=0;const I=new s.StructArrayLayout2ui4,P=131;for(let j=1;j<129;j++){for(let W=1;W<129;W++)b=j*P+W,I.emplaceBack(b,b+1),I.emplaceBack(b,b+P),I.emplaceBack(b+1,b+P),j===128&&I.emplaceBack(b+P,b+P+1);I.emplaceBack(b+1,b+1+P)}return I})();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(l),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,l.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class nt{static cacheKey(l,m,b,I){let P=`${m}${I?I.cacheKey:""}`;for(const j of b)l.usedDefines.includes(j)&&(P+=`/${j}`);return P}constructor(l,m,b,I,P,j){const W=l.gl;this.program=W.createProgram();const Z=(function(Ie){const rt=[];for(let gt=0;gt<Ie.length;gt++){if(Ie[gt]===null)continue;const yt=Ie[gt].split(" ");rt.push(yt.pop())}return rt})(b.staticAttributes),le=I?I.getBinderAttributes():[],ce=Z.concat(le);let Ee=I?I.defines():[];Ee=Ee.concat(j.map((Ie=>`#define ${Ie}`)));const Fe=l.isWebGL2?`#version 300 es
`:"",qe=Fe+Ee.concat(l.extStandardDerivatives&&Fe.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(At):At,At,je,ee.fragmentSource,fa.fragmentSource,b.fragmentSource).join(`
`),at=Fe+Ee.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,je,ee.vertexSource,fa.vertexSource,Po.vertexSource,b.vertexSource).join(`
`),et=W.createShader(W.FRAGMENT_SHADER);if(W.isContextLost())return void(this.failedToCreate=!0);W.shaderSource(et,qe),W.compileShader(et),W.attachShader(this.program,et);const lt=W.createShader(W.VERTEX_SHADER);if(W.isContextLost())this.failedToCreate=!0;else{W.shaderSource(lt,at),W.compileShader(lt),W.attachShader(this.program,lt),this.attributes={},this.numAttributes=ce.length;for(let Ie=0;Ie<this.numAttributes;Ie++)ce[Ie]&&(W.bindAttribLocation(this.program,Ie,ce[Ie]),this.attributes[ce[Ie]]=Ie);W.linkProgram(this.program),W.deleteShader(lt),W.deleteShader(et),this.fixedUniforms=P(l),this.binderUniforms=I?I.getUniforms(l):[],j.includes("TERRAIN")&&(this.terrainUniforms=(Ie=>({u_dem:new s.Uniform1i(Ie),u_dem_prev:new s.Uniform1i(Ie),u_dem_unpack:new s.Uniform4f(Ie),u_dem_tl:new s.Uniform2f(Ie),u_dem_scale:new s.Uniform1f(Ie),u_dem_tl_prev:new s.Uniform2f(Ie),u_dem_scale_prev:new s.Uniform1f(Ie),u_dem_size:new s.Uniform1f(Ie),u_dem_lerp:new s.Uniform1f(Ie),u_exaggeration:new s.Uniform1f(Ie),u_depth:new s.Uniform1i(Ie),u_depth_size_inv:new s.Uniform2f(Ie),u_meter_to_dem:new s.Uniform1f(Ie),u_label_plane_matrix_inv:new s.UniformMatrix4f(Ie)}))(l)),j.includes("GLOBE")&&(this.globeUniforms=(Ie=>({u_tile_tl_up:new s.Uniform3f(Ie),u_tile_tr_up:new s.Uniform3f(Ie),u_tile_br_up:new s.Uniform3f(Ie),u_tile_bl_up:new s.Uniform3f(Ie),u_tile_up_scale:new s.Uniform1f(Ie)}))(l)),j.includes("FOG")&&(this.fogUniforms=(Ie=>({u_fog_matrix:new s.UniformMatrix4f(Ie),u_fog_range:new s.Uniform2f(Ie),u_fog_color:new s.Uniform4f(Ie),u_fog_horizon_blend:new s.Uniform1f(Ie),u_fog_temporal_offset:new s.Uniform1f(Ie),u_frustum_tl:new s.Uniform3f(Ie),u_frustum_tr:new s.Uniform3f(Ie),u_frustum_br:new s.Uniform3f(Ie),u_frustum_bl:new s.Uniform3f(Ie),u_globe_pos:new s.Uniform3f(Ie),u_globe_radius:new s.Uniform1f(Ie),u_globe_transition:new s.Uniform1f(Ie),u_is_globe:new s.Uniform1i(Ie),u_viewport:new s.Uniform2f(Ie)}))(l))}}setTerrainUniformValues(l,m){if(!this.terrainUniforms)return;const b=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const I in m)b[I]&&b[I].set(this.program,I,m[I])}}setGlobeUniformValues(l,m){if(!this.globeUniforms)return;const b=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const I in m)b[I]&&b[I].set(this.program,I,m[I])}}setFogUniformValues(l,m){if(!this.fogUniforms)return;const b=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const I in m)b[I].set(this.program,I,m[I])}}draw(l,m,b,I,P,j,W,Z,le,ce,Ee,Fe,qe,at,et){const lt=l.gl;if(this.failedToCreate)return;l.program.set(this.program),l.setDepthMode(b),l.setStencilMode(I),l.setColorMode(P),l.setCullFace(j);for(const rt of Object.keys(this.fixedUniforms))this.fixedUniforms[rt].set(this.program,rt,W[rt]);at&&at.setUniforms(this.program,l,this.binderUniforms,Fe,{zoom:qe});const Ie={[lt.LINES]:2,[lt.TRIANGLES]:3,[lt.LINE_STRIP]:1}[m];for(const rt of Ee.get()){const gt=rt.vaos||(rt.vaos={});(gt[Z]||(gt[Z]=new Qn)).bind(l,this,le,at?at.getPaintVertexBuffers():[],ce,rt.vertexOffset,et||[]),lt.drawElements(m,rt.primitiveLength*Ie,lt.UNSIGNED_SHORT,rt.primitiveOffset*Ie*2)}}}function hn(x,l){const m=Math.pow(2,l.tileID.overscaledZ),b=l.tileSize*Math.pow(2,x.transform.tileZoom)/m,I=b*(l.tileID.canonical.x+l.tileID.wrap*m),P=b*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_tile_units_to_pixels:1/ge(l,1,x.transform.tileZoom),u_pixel_coord_upper:[I>>16,P>>16],u_pixel_coord_lower:[65535&I,65535&P]}}const Cn=s.create(),Sr=(x,l,m,b,I,P,j,W,Z,le,ce)=>{const Ee=l.style.light,Fe=Ee.properties.get("position"),qe=[Fe.x,Fe.y,Fe.z],at=s.create$1();Ee.properties.get("anchor")==="viewport"&&(s.fromRotation(at,-l.transform.angle),s.transformMat3(qe,qe,at));const et=Ee.properties.get("color"),lt=l.transform,Ie={u_matrix:x,u_lightpos:qe,u_lightintensity:Ee.properties.get("intensity"),u_lightcolor:[et.r,et.g,et.b],u_vertical_gradient:+m,u_opacity:b,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Cn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:I,u_edge_radius:P};return lt.projection.name==="globe"&&(Ie.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],Ie.u_zoom_transition=Z,Ie.u_inv_rot_matrix=ce,Ie.u_merc_center=le,Ie.u_up_dir=lt.projection.upVector(new s.CanonicalTileID(0,0,0),le[0]*s.EXTENT,le[1]*s.EXTENT),Ie.u_height_lift=W),Ie},Rs=(x,l,m,b,I,P,j,W,Z,le,ce,Ee)=>{const Fe=Sr(x,l,m,b,I,P,j,Z,le,ce,Ee),qe={u_height_factor:-Math.pow(2,j.overscaledZ)/W.tileSize/8};return s.extend(Fe,hn(l,W),qe)},so=x=>({u_matrix:x}),hs=(x,l,m)=>s.extend(so(x),hn(l,m)),es=(x,l)=>({u_matrix:x,u_world:l}),Js=(x,l,m,b)=>s.extend(hs(x,l,m),{u_world:b}),da=s.create(),oo=(x,l,m,b,I,P)=>{const j=x.transform,W=j.projection.name==="globe";let Z;if(P.paint.get("circle-pitch-alignment")==="map")if(W){const ce=s.globePixelsToTileUnits(j.zoom,l.canonical)*j._pixelsPerMercatorPixel;Z=Float32Array.from([ce,0,0,ce])}else Z=j.calculatePixelsToTileUnitsMatrix(m);else Z=new Float32Array([j.pixelsToGLUnits[0],0,0,j.pixelsToGLUnits[1]]);const le={u_camera_to_center_distance:j.cameraToCenterDistance,u_matrix:x.translatePosMatrix(l.projMatrix,m,P.paint.get("circle-translate"),P.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:Z,u_inv_rot_matrix:da,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(W){le.u_inv_rot_matrix=b,le.u_merc_center=I,le.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],le.u_zoom_transition=s.globeToMercatorTransition(j.zoom);const ce=I[0]*s.EXTENT,Ee=I[1]*s.EXTENT;le.u_up_dir=j.projection.upVector(new s.CanonicalTileID(0,0,0),ce,Ee)}return le},Vi=x=>{const l=[];return x.paint.get("circle-pitch-alignment")==="map"&&l.push("PITCH_WITH_MAP"),x.paint.get("circle-pitch-scale")==="map"&&l.push("SCALE_WITH_MAP"),l},Zl=(x,l,m,b)=>{const I=s.EXTENT/m.tileSize;return{u_matrix:x,u_camera_to_center_distance:l.getCameraToCenterDistance(b),u_extrude_scale:[l.pixelsToGLUnits[0]/I,l.pixelsToGLUnits[1]/I]}},xa=(x,l,m=1)=>({u_matrix:x,u_color:l,u_overlay:0,u_overlay_scale:m}),Rc=s.create(),Ru=(x,l,m,b,I,P,j)=>{const W=x.transform,Z=W.projection.name==="globe",le=Z?s.globePixelsToTileUnits(W.zoom,l.canonical)*W._pixelsPerMercatorPixel:ge(m,1,P),ce={u_matrix:l.projMatrix,u_extrude_scale:le,u_intensity:j,u_inv_rot_matrix:Rc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(Z){ce.u_inv_rot_matrix=b,ce.u_merc_center=I,ce.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],ce.u_zoom_transition=s.globeToMercatorTransition(W.zoom);const Ee=I[0]*s.EXTENT,Fe=I[1]*s.EXTENT;ce.u_up_dir=W.projection.upVector(new s.CanonicalTileID(0,0,0),Ee,Fe)}return ce},yu=(x,l,m,b,I,P,j)=>{const W=x.transform,Z=W.calculatePixelsToTileUnitsMatrix(l);return{u_matrix:Hu(x,l,m,b),u_pixels_to_tile_units:Z,u_device_pixel_ratio:P,u_units_to_pixels:[1/W.pixelsToGLUnits[0],1/W.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:I,u_texsize:yo(m)?l.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:al(l,x.transform),u_alpha_discard_threshold:0,u_trim_offset:j}},Wa=(x,l,m,b,I)=>{const P=x.transform;return{u_matrix:Hu(x,l,m,b),u_texsize:l.imageAtlasTexture.size,u_pixels_to_tile_units:P.calculatePixelsToTileUnitsMatrix(l),u_device_pixel_ratio:I,u_image:0,u_tile_units_to_pixels:al(l,P),u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function al(x,l){return 1/ge(x,1,l.tileZoom)}function Hu(x,l,m,b){return x.translatePosMatrix(b||l.tileID.projMatrix,l,m.paint.get("line-translate"),m.paint.get("line-translate-anchor"))}function yo(x){const l=x.paint.get("line-dasharray").value;return l.value||l.kind!=="constant"}const ia=(x,l,m,b,I,P)=>{return{u_matrix:x,u_tl_parent:l,u_scale_parent:m,u_fade_t:b.mix,u_opacity:b.opacity*I.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:I.paint.get("raster-brightness-min"),u_brightness_high:I.paint.get("raster-brightness-max"),u_saturation_factor:(W=I.paint.get("raster-saturation"),W>0?1-1/(1.001-W):-W),u_contrast_factor:(j=I.paint.get("raster-contrast"),j>0?1/(1-j):1+j),u_spin_weights:ll(I.paint.get("raster-hue-rotate")),u_perspective_transform:P};var j,W};function ll(x){x*=Math.PI/180;const l=Math.sin(x),m=Math.cos(x);return[(2*m+1)/3,(-Math.sqrt(3)*l-m+1)/3,(Math.sqrt(3)*l-m+1)/3]}const Bl=s.create(),No=(x,l,m,b,I,P,j,W,Z,le,ce,Ee,Fe,qe,at,et)=>{const lt=I.transform,Ie={u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:lt.cameraToCenterDistance,u_rotate_symbol:+m,u_aspect_ratio:lt.width/lt.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:j,u_coord_matrix:W,u_is_text:+Z,u_pitch_with_map:+b,u_texsize:le,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Bl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Bl,u_up_vector:[0,-1,0]};return et.name==="globe"&&(Ie.u_tile_id=[ce.canonical.x,ce.canonical.y,1<<ce.canonical.z],Ie.u_zoom_transition=Ee,Ie.u_inv_rot_matrix=qe,Ie.u_merc_center=Fe,Ie.u_camera_forward=lt._camera.forward(),Ie.u_ecef_origin=s.globeECEFOrigin(lt.globeMatrix,ce.toUnwrapped()),Ie.u_tile_matrix=Float32Array.from(lt.globeMatrix),Ie.u_up_vector=at),Ie},po=(x,l,m,b,I,P,j,W,Z,le,ce,Ee,Fe,qe,at,et,lt)=>s.extend(No(x,l,m,b,I,P,j,W,Z,le,Ee,Fe,qe,at,et,lt),{u_gamma_scale:b?I.transform.cameraToCenterDistance*Math.cos(I.terrain?0:I.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:1}),Ra=(x,l,m,b,I,P,j,W,Z,le,ce,Ee,Fe,qe,at,et)=>s.extend(po(x,l,m,b,I,P,j,W,!0,Z,!0,ce,Ee,Fe,qe,at,et),{u_texsize_icon:le,u_texture_icon:1}),sa=(x,l,m)=>({u_matrix:x,u_opacity:l,u_color:m}),sc=(x,l,m,b,I)=>s.extend((function(P,j,W){const Z=j.imageManager.getPattern(P.toString()),{width:le,height:ce}=j.imageManager.getPixelSize(),Ee=Math.pow(2,W.tileID.overscaledZ),Fe=W.tileSize*Math.pow(2,j.transform.tileZoom)/Ee,qe=Fe*(W.tileID.canonical.x+W.tileID.wrap*Ee),at=Fe*W.tileID.canonical.y;return{u_image:0,u_pattern_tl:Z.tl,u_pattern_br:Z.br,u_texsize:[le,ce],u_pattern_size:Z.displaySize,u_tile_units_to_pixels:1/ge(W,1,j.transform.tileZoom),u_pixel_coord_upper:[qe>>16,at>>16],u_pixel_coord_lower:[65535&qe,65535&at]}})(b,m,I),{u_matrix:x,u_opacity:l}),_u={fillExtrusion:x=>({u_matrix:new s.UniformMatrix4f(x),u_lightpos:new s.Uniform3f(x),u_lightintensity:new s.Uniform1f(x),u_lightcolor:new s.Uniform3f(x),u_vertical_gradient:new s.Uniform1f(x),u_opacity:new s.Uniform1f(x),u_edge_radius:new s.Uniform1f(x),u_ao:new s.Uniform2f(x),u_tile_id:new s.Uniform3f(x),u_zoom_transition:new s.Uniform1f(x),u_inv_rot_matrix:new s.UniformMatrix4f(x),u_merc_center:new s.Uniform2f(x),u_up_dir:new s.Uniform3f(x),u_height_lift:new s.Uniform1f(x)}),fillExtrusionPattern:x=>({u_matrix:new s.UniformMatrix4f(x),u_lightpos:new s.Uniform3f(x),u_lightintensity:new s.Uniform1f(x),u_lightcolor:new s.Uniform3f(x),u_vertical_gradient:new s.Uniform1f(x),u_height_factor:new s.Uniform1f(x),u_edge_radius:new s.Uniform1f(x),u_ao:new s.Uniform2f(x),u_tile_id:new s.Uniform3f(x),u_zoom_transition:new s.Uniform1f(x),u_inv_rot_matrix:new s.UniformMatrix4f(x),u_merc_center:new s.Uniform2f(x),u_up_dir:new s.Uniform3f(x),u_height_lift:new s.Uniform1f(x),u_image:new s.Uniform1i(x),u_texsize:new s.Uniform2f(x),u_pixel_coord_upper:new s.Uniform2f(x),u_pixel_coord_lower:new s.Uniform2f(x),u_tile_units_to_pixels:new s.Uniform1f(x),u_opacity:new s.Uniform1f(x)}),fill:x=>({u_matrix:new s.UniformMatrix4f(x)}),fillPattern:x=>({u_matrix:new s.UniformMatrix4f(x),u_image:new s.Uniform1i(x),u_texsize:new s.Uniform2f(x),u_pixel_coord_upper:new s.Uniform2f(x),u_pixel_coord_lower:new s.Uniform2f(x),u_tile_units_to_pixels:new s.Uniform1f(x)}),fillOutline:x=>({u_matrix:new s.UniformMatrix4f(x),u_world:new s.Uniform2f(x)}),fillOutlinePattern:x=>({u_matrix:new s.UniformMatrix4f(x),u_world:new s.Uniform2f(x),u_image:new s.Uniform1i(x),u_texsize:new s.Uniform2f(x),u_pixel_coord_upper:new s.Uniform2f(x),u_pixel_coord_lower:new s.Uniform2f(x),u_tile_units_to_pixels:new s.Uniform1f(x)}),circle:x=>({u_camera_to_center_distance:new s.Uniform1f(x),u_extrude_scale:new s.UniformMatrix2f(x),u_device_pixel_ratio:new s.Uniform1f(x),u_matrix:new s.UniformMatrix4f(x),u_inv_rot_matrix:new s.UniformMatrix4f(x),u_merc_center:new s.Uniform2f(x),u_tile_id:new s.Uniform3f(x),u_zoom_transition:new s.Uniform1f(x),u_up_dir:new s.Uniform3f(x)}),collisionBox:x=>({u_matrix:new s.UniformMatrix4f(x),u_camera_to_center_distance:new s.Uniform1f(x),u_extrude_scale:new s.Uniform2f(x)}),collisionCircle:x=>({u_matrix:new s.UniformMatrix4f(x),u_inv_matrix:new s.UniformMatrix4f(x),u_camera_to_center_distance:new s.Uniform1f(x),u_viewport_size:new s.Uniform2f(x)}),debug:x=>({u_color:new s.UniformColor(x),u_matrix:new s.UniformMatrix4f(x),u_overlay:new s.Uniform1i(x),u_overlay_scale:new s.Uniform1f(x)}),clippingMask:x=>({u_matrix:new s.UniformMatrix4f(x)}),heatmap:x=>({u_extrude_scale:new s.Uniform1f(x),u_intensity:new s.Uniform1f(x),u_matrix:new s.UniformMatrix4f(x),u_inv_rot_matrix:new s.UniformMatrix4f(x),u_merc_center:new s.Uniform2f(x),u_tile_id:new s.Uniform3f(x),u_zoom_transition:new s.Uniform1f(x),u_up_dir:new s.Uniform3f(x)}),heatmapTexture:x=>({u_image:new s.Uniform1i(x),u_color_ramp:new s.Uniform1i(x),u_opacity:new s.Uniform1f(x)}),hillshade:x=>({u_matrix:new s.UniformMatrix4f(x),u_image:new s.Uniform1i(x),u_latrange:new s.Uniform2f(x),u_light:new s.Uniform2f(x),u_shadow:new s.UniformColor(x),u_highlight:new s.UniformColor(x),u_accent:new s.UniformColor(x)}),hillshadePrepare:x=>({u_matrix:new s.UniformMatrix4f(x),u_image:new s.Uniform1i(x),u_dimension:new s.Uniform2f(x),u_zoom:new s.Uniform1f(x),u_unpack:new s.Uniform4f(x)}),line:x=>({u_matrix:new s.UniformMatrix4f(x),u_pixels_to_tile_units:new s.UniformMatrix2f(x),u_device_pixel_ratio:new s.Uniform1f(x),u_units_to_pixels:new s.Uniform2f(x),u_dash_image:new s.Uniform1i(x),u_gradient_image:new s.Uniform1i(x),u_image_height:new s.Uniform1f(x),u_texsize:new s.Uniform2f(x),u_tile_units_to_pixels:new s.Uniform1f(x),u_alpha_discard_threshold:new s.Uniform1f(x),u_trim_offset:new s.Uniform2f(x)}),linePattern:x=>({u_matrix:new s.UniformMatrix4f(x),u_texsize:new s.Uniform2f(x),u_pixels_to_tile_units:new s.UniformMatrix2f(x),u_device_pixel_ratio:new s.Uniform1f(x),u_image:new s.Uniform1i(x),u_units_to_pixels:new s.Uniform2f(x),u_tile_units_to_pixels:new s.Uniform1f(x),u_alpha_discard_threshold:new s.Uniform1f(x)}),raster:x=>({u_matrix:new s.UniformMatrix4f(x),u_tl_parent:new s.Uniform2f(x),u_scale_parent:new s.Uniform1f(x),u_fade_t:new s.Uniform1f(x),u_opacity:new s.Uniform1f(x),u_image0:new s.Uniform1i(x),u_image1:new s.Uniform1i(x),u_brightness_low:new s.Uniform1f(x),u_brightness_high:new s.Uniform1f(x),u_saturation_factor:new s.Uniform1f(x),u_contrast_factor:new s.Uniform1f(x),u_spin_weights:new s.Uniform3f(x),u_perspective_transform:new s.Uniform2f(x)}),symbolIcon:x=>({u_is_size_zoom_constant:new s.Uniform1i(x),u_is_size_feature_constant:new s.Uniform1i(x),u_size_t:new s.Uniform1f(x),u_size:new s.Uniform1f(x),u_camera_to_center_distance:new s.Uniform1f(x),u_rotate_symbol:new s.Uniform1i(x),u_aspect_ratio:new s.Uniform1f(x),u_fade_change:new s.Uniform1f(x),u_matrix:new s.UniformMatrix4f(x),u_label_plane_matrix:new s.UniformMatrix4f(x),u_coord_matrix:new s.UniformMatrix4f(x),u_is_text:new s.Uniform1i(x),u_pitch_with_map:new s.Uniform1i(x),u_texsize:new s.Uniform2f(x),u_tile_id:new s.Uniform3f(x),u_zoom_transition:new s.Uniform1f(x),u_inv_rot_matrix:new s.UniformMatrix4f(x),u_merc_center:new s.Uniform2f(x),u_camera_forward:new s.Uniform3f(x),u_tile_matrix:new s.UniformMatrix4f(x),u_up_vector:new s.Uniform3f(x),u_ecef_origin:new s.Uniform3f(x),u_texture:new s.Uniform1i(x)}),symbolSDF:x=>({u_is_size_zoom_constant:new s.Uniform1i(x),u_is_size_feature_constant:new s.Uniform1i(x),u_size_t:new s.Uniform1f(x),u_size:new s.Uniform1f(x),u_camera_to_center_distance:new s.Uniform1f(x),u_rotate_symbol:new s.Uniform1i(x),u_aspect_ratio:new s.Uniform1f(x),u_fade_change:new s.Uniform1f(x),u_matrix:new s.UniformMatrix4f(x),u_label_plane_matrix:new s.UniformMatrix4f(x),u_coord_matrix:new s.UniformMatrix4f(x),u_is_text:new s.Uniform1i(x),u_pitch_with_map:new s.Uniform1i(x),u_texsize:new s.Uniform2f(x),u_texture:new s.Uniform1i(x),u_gamma_scale:new s.Uniform1f(x),u_device_pixel_ratio:new s.Uniform1f(x),u_tile_id:new s.Uniform3f(x),u_zoom_transition:new s.Uniform1f(x),u_inv_rot_matrix:new s.UniformMatrix4f(x),u_merc_center:new s.Uniform2f(x),u_camera_forward:new s.Uniform3f(x),u_tile_matrix:new s.UniformMatrix4f(x),u_up_vector:new s.Uniform3f(x),u_ecef_origin:new s.Uniform3f(x),u_is_halo:new s.Uniform1i(x)}),symbolTextAndIcon:x=>({u_is_size_zoom_constant:new s.Uniform1i(x),u_is_size_feature_constant:new s.Uniform1i(x),u_size_t:new s.Uniform1f(x),u_size:new s.Uniform1f(x),u_camera_to_center_distance:new s.Uniform1f(x),u_rotate_symbol:new s.Uniform1i(x),u_aspect_ratio:new s.Uniform1f(x),u_fade_change:new s.Uniform1f(x),u_matrix:new s.UniformMatrix4f(x),u_label_plane_matrix:new s.UniformMatrix4f(x),u_coord_matrix:new s.UniformMatrix4f(x),u_is_text:new s.Uniform1i(x),u_pitch_with_map:new s.Uniform1i(x),u_texsize:new s.Uniform2f(x),u_texsize_icon:new s.Uniform2f(x),u_texture:new s.Uniform1i(x),u_texture_icon:new s.Uniform1i(x),u_gamma_scale:new s.Uniform1f(x),u_device_pixel_ratio:new s.Uniform1f(x),u_is_halo:new s.Uniform1i(x)}),background:x=>({u_matrix:new s.UniformMatrix4f(x),u_opacity:new s.Uniform1f(x),u_color:new s.UniformColor(x)}),backgroundPattern:x=>({u_matrix:new s.UniformMatrix4f(x),u_opacity:new s.Uniform1f(x),u_image:new s.Uniform1i(x),u_pattern_tl:new s.Uniform2f(x),u_pattern_br:new s.Uniform2f(x),u_texsize:new s.Uniform2f(x),u_pattern_size:new s.Uniform2f(x),u_pixel_coord_upper:new s.Uniform2f(x),u_pixel_coord_lower:new s.Uniform2f(x),u_tile_units_to_pixels:new s.Uniform1f(x)}),terrainRaster:Ps,terrainDepth:Ps,skybox:x=>({u_matrix:new s.UniformMatrix4f(x),u_sun_direction:new s.Uniform3f(x),u_cubemap:new s.Uniform1i(x),u_opacity:new s.Uniform1f(x),u_temporal_offset:new s.Uniform1f(x)}),skyboxGradient:x=>({u_matrix:new s.UniformMatrix4f(x),u_color_ramp:new s.Uniform1i(x),u_center_direction:new s.Uniform3f(x),u_radius:new s.Uniform1f(x),u_opacity:new s.Uniform1f(x),u_temporal_offset:new s.Uniform1f(x)}),skyboxCapture:x=>({u_matrix_3f:new s.UniformMatrix3f(x),u_sun_direction:new s.Uniform3f(x),u_sun_intensity:new s.Uniform1f(x),u_color_tint_r:new s.Uniform4f(x),u_color_tint_m:new s.Uniform4f(x),u_luminance:new s.Uniform1f(x)}),globeRaster:x=>({u_proj_matrix:new s.UniformMatrix4f(x),u_globe_matrix:new s.UniformMatrix4f(x),u_normalize_matrix:new s.UniformMatrix4f(x),u_merc_matrix:new s.UniformMatrix4f(x),u_zoom_transition:new s.Uniform1f(x),u_merc_center:new s.Uniform2f(x),u_image0:new s.Uniform1i(x),u_grid_matrix:new s.UniformMatrix3f(x),u_skirt_height:new s.Uniform1f(x),u_frustum_tl:new s.Uniform3f(x),u_frustum_tr:new s.Uniform3f(x),u_frustum_br:new s.Uniform3f(x),u_frustum_bl:new s.Uniform3f(x),u_globe_pos:new s.Uniform3f(x),u_globe_radius:new s.Uniform1f(x),u_viewport:new s.Uniform2f(x)}),globeAtmosphere:x=>({u_frustum_tl:new s.Uniform3f(x),u_frustum_tr:new s.Uniform3f(x),u_frustum_br:new s.Uniform3f(x),u_frustum_bl:new s.Uniform3f(x),u_horizon:new s.Uniform1f(x),u_transition:new s.Uniform1f(x),u_fadeout_range:new s.Uniform1f(x),u_color:new s.Uniform4f(x),u_high_color:new s.Uniform4f(x),u_space_color:new s.Uniform4f(x),u_star_intensity:new s.Uniform1f(x),u_star_density:new s.Uniform1f(x),u_star_size:new s.Uniform1f(x),u_temporal_offset:new s.Uniform1f(x),u_horizon_angle:new s.Uniform1f(x),u_rotation_matrix:new s.UniformMatrix4f(x)})};let zl;function ul(x,l,m,b,I,P,j){const W=x.context,Z=W.gl,le=x.transform,ce=x.useProgram("collisionBox"),Ee=[];let Fe=0,qe=0;for(let yt=0;yt<b.length;yt++){const Mt=b[yt],Dt=l.getTile(Mt),Nt=Dt.getBucket(m);if(!Nt)continue;const qt=ko(Mt,Nt,le);let Bt=qt;I[0]===0&&I[1]===0||(Bt=x.translatePosMatrix(qt,Dt,I,P));const rn=j?Nt.textCollisionBox:Nt.iconCollisionBox,Rn=Nt.collisionCircleArray;if(Rn.length>0){const Jt=s.create(),An=Bt;s.mul(Jt,Nt.placementInvProjMatrix,le.glCoordMatrix),s.mul(Jt,Jt,Nt.placementViewportMatrix),Ee.push({circleArray:Rn,circleOffset:qe,transform:An,invTransform:Jt,projection:Nt.getProjection()}),Fe+=Rn.length/4,qe=Fe}rn&&(x.terrain&&x.terrain.setupElevationDraw(Dt,ce),ce.draw(W,Z.LINES,s.DepthMode.disabled,s.StencilMode.disabled,x.colorModeForRenderPass(),s.CullFaceMode.disabled,Zl(Bt,le,Dt,Nt.getProjection()),m.id,rn.layoutVertexBuffer,rn.indexBuffer,rn.segments,null,le.zoom,null,[rn.collisionVertexBuffer,rn.collisionVertexBufferExt]))}if(!j||!Ee.length)return;const at=x.useProgram("collisionCircle"),et=new s.StructArrayLayout2f1f2i16;et.resize(4*Fe),et._trim();let lt=0;for(const yt of Ee)for(let Mt=0;Mt<yt.circleArray.length/4;Mt++){const Dt=4*Mt,Nt=yt.circleArray[Dt+0],qt=yt.circleArray[Dt+1],Bt=yt.circleArray[Dt+2],rn=yt.circleArray[Dt+3];et.emplace(lt++,Nt,qt,Bt,rn,0),et.emplace(lt++,Nt,qt,Bt,rn,1),et.emplace(lt++,Nt,qt,Bt,rn,2),et.emplace(lt++,Nt,qt,Bt,rn,3)}(!zl||zl.length<2*Fe)&&(zl=(function(yt){const Mt=2*yt,Dt=new s.StructArrayLayout3ui6;Dt.resize(Mt),Dt._trim();for(let Nt=0;Nt<Mt;Nt++){const qt=6*Nt;Dt.uint16[qt+0]=4*Nt+0,Dt.uint16[qt+1]=4*Nt+1,Dt.uint16[qt+2]=4*Nt+2,Dt.uint16[qt+3]=4*Nt+2,Dt.uint16[qt+4]=4*Nt+3,Dt.uint16[qt+5]=4*Nt+0}return Dt})(Fe));const Ie=W.createIndexBuffer(zl,!0),rt=W.createVertexBuffer(et,s.collisionCircleLayout.members,!0);for(const yt of Ee){const Mt={u_matrix:yt.transform,u_inv_matrix:yt.invTransform,u_camera_to_center_distance:(gt=le).getCameraToCenterDistance(yt.projection),u_viewport_size:[gt.width,gt.height]};at.draw(W,Z.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,x.colorModeForRenderPass(),s.CullFaceMode.disabled,Mt,m.id,rt,Ie,s.SegmentVector.simpleSegment(0,2*yt.circleOffset,yt.circleArray.length,yt.circleArray.length/2),null,le.zoom)}var gt;rt.destroy(),Ie.destroy()}const Jl=s.create();function jo({width:x,height:l,anchor:m,textOffset:b,textScale:I},P){const{horizontalAlign:j,verticalAlign:W}=s.getAnchorAlignment(m),Z=-(j-.5)*x,le=-(W-.5)*l,ce=s.evaluateVariableOffset(m,b);return new s.Point((Z/I+ce[0])*P,(le/I+ce[1])*P)}function oa(x,l,m,b,I,P,j,W,Z,le,ce){const Ee=x.text.placedSymbolArray,Fe=x.text.dynamicLayoutVertexArray,qe=x.icon.dynamicLayoutVertexArray,at={},et=x.getProjection(),lt=ss(W,et,P),Ie=P.elevation,rt=et.upVectorScale(W.canonical,P.center.lat,P.worldSize).metersToTile;Fe.clear();for(let gt=0;gt<Ee.length;gt++){const yt=Ee.get(gt),{tileAnchorX:Mt,tileAnchorY:Dt,numGlyphs:Nt}=yt,qt=yt.hidden||!yt.crossTileID||x.allowVerticalPlacement&&!yt.placedOrientation?null:b[yt.crossTileID];if(qt){let Bt=0,rn=0,Rn=0;if(Ie){const Wn=Ie?Ie.getAtTileOffset(W,Mt,Dt):0,[Nr,ei,Er]=et.upVector(W.canonical,Mt,Dt);Bt=Wn*Nr*rt,rn=Wn*ei*rt,Rn=Wn*Er*rt}let[Jt,An,cn,Vn]=Ni(yt.projectedAnchorX+Bt,yt.projectedAnchorY+rn,yt.projectedAnchorZ+Rn,m?lt:j);const tn=ic(P.getCameraToCenterDistance(et),Vn);let bn=I.evaluateSizeForFeature(x.textSizeData,le,yt)*tn/s.ONE_EM;m&&(bn*=x.tilePixelRatio/Z);const Un=jo(qt,bn);m?({x:Jt,y:An,z:cn}=et.projectTilePoint(Mt+Un.x,Dt+Un.y,W.canonical),[Jt,An,cn]=Ni(Jt+Bt,An+rn,cn+Rn,j)):(l&&Un._rotate(-P.angle),Jt+=Un.x,An+=Un.y,cn=0);const In=x.allowVerticalPlacement&&yt.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let Wn=0;Wn<Nt;Wn++)s.addDynamicAttributes(Fe,Jt,An,cn,In);ce&&yt.associatedIconIndex>=0&&(at[yt.associatedIconIndex]={x:Jt,y:An,z:cn,angle:In})}else $a(Nt,Fe)}if(ce){qe.clear();const gt=x.icon.placedSymbolArray;for(let yt=0;yt<gt.length;yt++){const Mt=gt.get(yt),{numGlyphs:Dt}=Mt,Nt=at[yt];if(Mt.hidden||!Nt)$a(Dt,qe);else{const{x:qt,y:Bt,z:rn,angle:Rn}=Nt;for(let Jt=0;Jt<Dt;Jt++)s.addDynamicAttributes(qe,qt,Bt,rn,Rn)}}x.icon.dynamicLayoutVertexBuffer.updateData(qe)}x.text.dynamicLayoutVertexBuffer.updateData(Fe)}function E(x,l,m){return m.iconsInText&&l?"symbolTextAndIcon":x?"symbolSDF":"symbolIcon"}function f(x,l,m,b,I,P,j,W,Z,le,ce,Ee){const Fe=x.context,qe=Fe.gl,at=x.transform,et=W==="map",lt=Z==="map",Ie=et&&m.layout.get("symbol-placement")!=="point",rt=et&&!lt&&!Ie,gt=m.layout.get("symbol-sort-key").constantOr(1)!==void 0;let yt=!1;const Mt=x.depthModeForSublayer(0,s.DepthMode.ReadOnly),Dt=[s.mercatorXfromLng(at.center.lng),s.mercatorYfromLat(at.center.lat)],Nt=m.layout.get("text-variable-anchor"),qt=at.projection.name==="globe",Bt=[],rn=[0,-1,0];let Rn=rn;!qt&&!at.mercatorFromTransition||et||(Rn=(function(Jt){const An=Jt._camera.getWorldToCamera(Jt.worldSize,1),cn=s.multiply([],An,Jt.globeMatrix);s.invert(cn,cn);const Vn=[0,0,0],tn=[0,1,0,0];return s.transformMat4$1(tn,tn,cn),Vn[0]=tn[0],Vn[1]=tn[1],Vn[2]=tn[2],s.normalize(Vn,Vn),Vn})(at));for(const Jt of b){const An=l.getTile(Jt),cn=An.getBucket(m);if(!cn||cn.projection.name==="mercator"&&qt)continue;const Vn=I?cn.text:cn.icon;if(!Vn||cn.fullyClipped||!Vn.segments.get().length)continue;const tn=Vn.programConfigurations.get(m.id),bn=I||cn.sdfIcons,Un=I?cn.textSizeData:cn.iconSizeData,In=lt||at.pitch!==0,Wn=s.evaluateSizeForZoom(Un,at.zoom);let Nr,ei,Er,gr,Ai=[0,0],Mi=null;if(I)ei=An.glyphAtlasTexture,Er=qe.LINEAR,Nr=An.glyphAtlasTexture.size,cn.iconsInText&&(Ai=An.imageAtlasTexture.size,Mi=An.imageAtlasTexture,gr=In||x.options.rotating||x.options.zooming||Un.kind==="composite"||Un.kind==="camera"?qe.LINEAR:qe.NEAREST);else{const zu=m.layout.get("icon-size").constantOr(0)!==1||cn.iconsNeedLinear;ei=An.imageAtlasTexture,Er=bn||x.options.rotating||x.options.zooming||zu||In?qe.LINEAR:qe.NEAREST,Nr=An.imageAtlasTexture.size}const Vr=cn.projection.name==="globe",Yi=Vr?Rn:rn,Ki=Vr?s.globeToMercatorTransition(at.zoom):0,ts=ss(Jt,cn.getProjection(),at),Gs=at.calculatePixelsToTileUnitsMatrix(An),wa=En(ts,An.tileID.canonical,lt,et,at,cn.getProjection(),Gs),$o=x.terrain&&lt&&Ie?s.invert(s.create(),wa):Jl,Bu=Io(ts,An.tileID.canonical,lt,et,at,cn.getProjection(),Gs),Yu=Nt&&cn.hasTextData(),Zi=m.layout.get("icon-text-fit")!=="none"&&Yu&&cn.hasIconData();if(Ie){const zu=at.elevation,Ta=zu?zu.getAtTileOffsetFunc(Jt,at.center.lat,at.worldSize,cn.getProjection()):null,Ku=co(ts,An.tileID.canonical,lt,et,at,cn.getProjection(),Gs);il(cn,ts,x,I,Ku,Bu,lt,le,Ta,Jt)}const ks=Ie||I&&Nt||Zi,$s=x.translatePosMatrix(ts,An,P,j),Sa=ks?Jl:wa,Gl=x.translatePosMatrix(Bu,An,P,j,!0),Eo=cn.getProjection().createInversionMatrix(at,Jt.canonical),Ea=[];x.terrainRenderModeElevated()&&lt&&Ea.push("PITCH_WITH_MAP_TERRAIN"),Vr&&Ea.push("PROJECTION_GLOBE_VIEW"),ks&&Ea.push("PROJECTED_POS_ON_VIEWPORT");const Yo=bn&&m.paint.get(I?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ro;Ro=bn?cn.iconsInText?Ra(Un.kind,Wn,rt,lt,x,$s,Sa,Gl,Nr,Ai,Jt,Ki,Dt,Eo,Yi,cn.getProjection()):po(Un.kind,Wn,rt,lt,x,$s,Sa,Gl,I,Nr,!0,Jt,Ki,Dt,Eo,Yi,cn.getProjection()):No(Un.kind,Wn,rt,lt,x,$s,Sa,Gl,I,Nr,Jt,Ki,Dt,Eo,Yi,cn.getProjection());const aa={program:x.useProgram(E(bn,I,cn),tn,Ea),buffers:Vn,uniformValues:Ro,atlasTexture:ei,atlasTextureIcon:Mi,atlasInterpolation:Er,atlasInterpolationIcon:gr,isSDF:bn,hasHalo:Yo,tile:An,labelPlaneMatrixInv:$o};if(gt&&cn.canOverlap){yt=!0;const zu=Vn.segments.get();for(const Ta of zu)Bt.push({segments:new s.SegmentVector([Ta]),sortKey:Ta.sortKey,state:aa})}else Bt.push({segments:Vn.segments,sortKey:0,state:aa})}yt&&Bt.sort(((Jt,An)=>Jt.sortKey-An.sortKey));for(const Jt of Bt){const An=Jt.state;if(x.terrain&&x.terrain.setupElevationDraw(An.tile,An.program,{useDepthForOcclusion:!qt,labelPlaneMatrixInv:An.labelPlaneMatrixInv}),Fe.activeTexture.set(qe.TEXTURE0),An.atlasTexture.bind(An.atlasInterpolation,qe.CLAMP_TO_EDGE),An.atlasTextureIcon&&(Fe.activeTexture.set(qe.TEXTURE1),An.atlasTextureIcon&&An.atlasTextureIcon.bind(An.atlasInterpolationIcon,qe.CLAMP_TO_EDGE)),An.isSDF){const cn=An.uniformValues;An.hasHalo&&(cn.u_is_halo=1,d(An.buffers,Jt.segments,m,x,An.program,Mt,ce,Ee,cn)),cn.u_is_halo=0}d(An.buffers,Jt.segments,m,x,An.program,Mt,ce,Ee,An.uniformValues)}}function d(x,l,m,b,I,P,j,W,Z){const le=b.context,ce=[x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer,x.globeExtVertexBuffer];I.draw(le,le.gl.TRIANGLES,P,j,W,s.CullFaceMode.disabled,Z,m.id,x.layoutVertexBuffer,x.indexBuffer,l,m.paint,b.transform.zoom,x.programConfigurations.get(m.id),ce)}function S(x,l,m,b,I,P,j){const W=x.context.gl,Z=m.paint.get("fill-pattern"),le=Z&&Z.constantOr(1);let ce,Ee,Fe,qe,at;j?(Ee=le&&!m.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ce=W.LINES):(Ee=le?"fillPattern":"fill",ce=W.TRIANGLES);for(const et of b){const lt=l.getTile(et);if(le&&!lt.patternsLoaded())continue;const Ie=lt.getBucket(m);if(!Ie)continue;x.prepareDrawTile();const rt=Ie.programConfigurations.get(m.id),gt=x.useProgram(Ee,rt);le&&(x.context.activeTexture.set(W.TEXTURE0),lt.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),rt.updatePaintBuffers());const yt=Z.constantOr(null);if(yt&&lt.imageAtlas){const Dt=lt.imageAtlas.patternPositions[yt.toString()];Dt&&rt.setConstantPatternPositions(Dt)}const Mt=x.translatePosMatrix(et.projMatrix,lt,m.paint.get("fill-translate"),m.paint.get("fill-translate-anchor"));if(j){qe=Ie.indexBuffer2,at=Ie.segments2;const Dt=x.terrain&&x.terrain.renderingToTexture?x.terrain.drapeBufferSize:[W.drawingBufferWidth,W.drawingBufferHeight];Fe=Ee==="fillOutlinePattern"&&le?Js(Mt,x,lt,Dt):es(Mt,Dt)}else qe=Ie.indexBuffer,at=Ie.segments,Fe=le?hs(Mt,x,lt):so(Mt);x.prepareDrawProgram(x.context,gt,et.toUnwrapped()),gt.draw(x.context,ce,I,x.stencilModeForClipping(et),P,s.CullFaceMode.disabled,Fe,m.id,Ie.layoutVertexBuffer,qe,at,m.paint,x.transform.zoom,rt)}}function N(x,l,m,b,I,P,j){const W=x.context,Z=W.gl,le=x.transform,ce=m.paint.get("fill-extrusion-pattern"),Ee=ce.constantOr(1),Fe=m.paint.get("fill-extrusion-opacity"),qe=[m.paint.get("fill-extrusion-ambient-occlusion-intensity"),m.paint.get("fill-extrusion-ambient-occlusion-radius")],at=m.layout.get("fill-extrusion-edge-radius"),et=at>0&&!m.paint.get("fill-extrusion-rounded-roof"),lt=et?0:at,Ie=le.projection.name==="globe"?s.fillExtrusionHeightLift():0,rt=le.projection.name==="globe",gt=rt?s.globeToMercatorTransition(le.zoom):0,yt=[s.mercatorXfromLng(le.center.lng),s.mercatorYfromLat(le.center.lat)],Mt=[];rt&&Mt.push("PROJECTION_GLOBE_VIEW"),qe[0]>0&&Mt.push("FAUX_AO"),et&&Mt.push("ZERO_ROOF_RADIUS");for(const Dt of b){const Nt=l.getTile(Dt),qt=Nt.getBucket(m);if(!qt||qt.projection.name!==le.projection.name)continue;const Bt=qt.programConfigurations.get(m.id),rn=x.useProgram(Ee?"fillExtrusionPattern":"fillExtrusion",Bt,Mt);if(x.terrain){const bn=x.terrain;if(x.style.terrainSetForDrapingOnly())bn.setupElevationDraw(Nt,rn,{useMeterToDem:!0});else{if(!qt.enableTerrain)continue;if(bn.setupElevationDraw(Nt,rn,{useMeterToDem:!0}),X(W,l,Dt,qt,m,bn),!qt.centroidVertexBuffer){const Un=rn.attributes.a_centroid_pos;Un!==void 0&&Z.vertexAttrib2f(Un,0,0)}}}Ee&&(x.context.activeTexture.set(Z.TEXTURE0),Nt.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),Bt.updatePaintBuffers());const Rn=ce.constantOr(null);if(Rn&&Nt.imageAtlas){const bn=Nt.imageAtlas.patternPositions[Rn.toString()];bn&&Bt.setConstantPatternPositions(bn)}const Jt=x.translatePosMatrix(Dt.projMatrix,Nt,m.paint.get("fill-extrusion-translate"),m.paint.get("fill-extrusion-translate-anchor")),An=le.projection.createInversionMatrix(le,Dt.canonical),cn=m.paint.get("fill-extrusion-vertical-gradient"),Vn=Ee?Rs(Jt,x,cn,Fe,qe,lt,Dt,Nt,Ie,gt,yt,An):Sr(Jt,x,cn,Fe,qe,lt,Dt,Ie,gt,yt,An);x.prepareDrawProgram(W,rn,Dt.toUnwrapped());const tn=[];x.terrain&&tn.push(qt.centroidVertexBuffer),rt&&tn.push(qt.layoutVertexExtBuffer),rn.draw(W,W.gl.TRIANGLES,I,P,j,s.CullFaceMode.backCCW,Vn,m.id,qt.layoutVertexBuffer,qt.indexBuffer,qt.segments,m.paint,x.transform.zoom,Bt,tn)}}function X(x,l,m,b,I,P){const j=[Ie=>{let rt=Ie.canonical.x-1,gt=Ie.wrap;return rt<0&&(rt=(1<<Ie.canonical.z)-1,gt--),new s.OverscaledTileID(Ie.overscaledZ,gt,Ie.canonical.z,rt,Ie.canonical.y)},Ie=>{let rt=Ie.canonical.x+1,gt=Ie.wrap;return rt===1<<Ie.canonical.z&&(rt=0,gt++),new s.OverscaledTileID(Ie.overscaledZ,gt,Ie.canonical.z,rt,Ie.canonical.y)},Ie=>new s.OverscaledTileID(Ie.overscaledZ,Ie.wrap,Ie.canonical.z,Ie.canonical.x,(Ie.canonical.y===0?1<<Ie.canonical.z:Ie.canonical.y)-1),Ie=>new s.OverscaledTileID(Ie.overscaledZ,Ie.wrap,Ie.canonical.z,Ie.canonical.x,Ie.canonical.y===(1<<Ie.canonical.z)-1?0:Ie.canonical.y+1)],W=Ie=>{const rt=l.getSource().minzoom,gt=Mt=>{const Dt=l.getTileByID(Mt);if(Dt&&Dt.hasData())return Dt.getBucket(I)},yt=[0,-1,1];for(const Mt of yt){if(Ie.overscaledZ+Mt<rt)continue;const Dt=gt(Ie.calculateScaledKey(Ie.overscaledZ+Mt));if(Dt)return Dt}},Z=[0,0,0],le=(Ie,rt)=>(Z[0]=Math.min(Ie.min.y,rt.min.y),Z[1]=Math.max(Ie.max.y,rt.max.y),Z[2]=s.EXTENT-rt.min.x>Ie.max.x?rt.min.x-s.EXTENT:Ie.max.x,Z),ce=(Ie,rt)=>(Z[0]=Math.min(Ie.min.x,rt.min.x),Z[1]=Math.max(Ie.max.x,rt.max.x),Z[2]=s.EXTENT-rt.min.y>Ie.max.y?rt.min.y-s.EXTENT:Ie.max.y,Z),Ee=[(Ie,rt)=>le(Ie,rt),(Ie,rt)=>le(rt,Ie),(Ie,rt)=>ce(Ie,rt),(Ie,rt)=>ce(rt,Ie)],Fe=new s.Point(0,0);let qe,at,et;const lt=(Ie,rt,gt,yt,Mt)=>{const Dt=[[yt?gt:Ie,yt?Ie:gt,0],[yt?gt:rt,yt?rt:gt,0]],Nt=Mt<0?s.EXTENT+Mt:Mt,qt=[yt?Nt:(Ie+rt)/2,yt?(Ie+rt)/2:Nt,0];return gt===0&&Mt<0||gt!==0&&Mt>0?P.getForTilePoints(et,[qt],!0,at):Dt.push(qt),P.getForTilePoints(m,Dt,!0,qe),Math.max(Dt[0][2],Dt[1][2],qt[2])/P.exaggeration()};for(let Ie=0;Ie<4;Ie++){const rt=(Ie<2?1:5)-Ie,gt=b.borders[Ie];if(gt.length===0)continue;const yt=et=j[Ie](m),Mt=W(yt);if(!(Mt&&Mt instanceof s.FillExtrusionBucket&&Mt.enableTerrain)||b.borderDoneWithNeighborZ[Ie]===Mt.canonical.z&&Mt.borderDoneWithNeighborZ[rt]===b.canonical.z||(at=P.findDEMTileFor(yt),!at||!at.dem))continue;if(!qe){const Bt=P.findDEMTileFor(m);if(!Bt||!Bt.dem)return;qe=Bt}const Dt=Mt.borders[rt];let Nt=0;const qt=Mt.borderDoneWithNeighborZ[rt]!==b.canonical.z;if(b.canonical.z===Mt.canonical.z){for(let Bt=0;Bt<gt.length;Bt++){const rn=b.featuresOnBorder[gt[Bt]],Rn=rn.borders[Ie];let Jt;for(;Nt<Dt.length&&(Jt=Mt.featuresOnBorder[Dt[Nt]],!(Jt.borders[rt][1]>Rn[0]+3));)qt&&Mt.encodeCentroid(void 0,Jt,!1),Nt++;if(Jt&&Nt<Dt.length){const An=Nt;let cn=0;for(;!(Jt.borders[rt][0]>Rn[1]-3)&&(cn++,++Nt!==Dt.length);)Jt=Mt.featuresOnBorder[Dt[Nt]];if(Jt=Mt.featuresOnBorder[Dt[An]],rn.intersectsCount()>1||Jt.intersectsCount()>1||cn!==1){cn!==1&&(Nt=An),b.encodeCentroid(void 0,rn,!1),qt&&Mt.encodeCentroid(void 0,Jt,!1);continue}const Vn=Ee[Ie](rn,Jt),tn=Ie%2?s.EXTENT-1:0;Fe.x=lt(Vn[0],Math.min(s.EXTENT-1,Vn[1]),tn,Ie<2,Vn[2]),Fe.y=0,b.encodeCentroid(Fe,rn,!1),qt&&Mt.encodeCentroid(Fe,Jt,!1)}else b.encodeCentroid(void 0,rn,!1)}b.borderDoneWithNeighborZ[Ie]=Mt.canonical.z,b.needsCentroidUpdate=!0,qt&&(Mt.borderDoneWithNeighborZ[rt]=b.canonical.z,Mt.needsCentroidUpdate=!0)}else{for(const Bt of gt)b.encodeCentroid(void 0,b.featuresOnBorder[Bt],!1);if(qt){for(const Bt of Dt)Mt.encodeCentroid(void 0,Mt.featuresOnBorder[Bt],!1);Mt.borderDoneWithNeighborZ[rt]=b.canonical.z,Mt.needsCentroidUpdate=!0}b.borderDoneWithNeighborZ[Ie]=Mt.canonical.z,b.needsCentroidUpdate=!0}}(b.needsCentroidUpdate||!b.centroidVertexBuffer&&b.centroidVertexArray.length!==0)&&b.uploadCentroid(x)}const he=new s.Color(1,0,0,1),Ae=new s.Color(0,1,0,1),Ye=new s.Color(0,0,1,1),bt=new s.Color(1,0,1,1),an=new s.Color(0,1,1,1);function mn(x,l,m){const b=x.context,I=x.transform,P=b.gl,j=I.projection.name==="globe",W=j?["PROJECTION_GLOBE_VIEW"]:null;let Z=m.projMatrix;if(j&&s.globeToMercatorTransition(I.zoom)>0){const rn=s.transitionTileAABBinECEF(m.canonical,I),Rn=s.globeDenormalizeECEF(rn);Z=s.multiply(new Float32Array(16),I.globeMatrix,Rn),s.multiply(Z,I.projMatrix,Z)}const le=x.useProgram("debug",null,W),ce=l.getTileByID(m.key);x.terrain&&x.terrain.setupElevationDraw(ce,le);const Ee=s.DepthMode.disabled,Fe=s.StencilMode.disabled,qe=x.colorModeForRenderPass(),at="$debug";b.activeTexture.set(P.TEXTURE0),x.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),j?ce._makeGlobeTileDebugBuffers(x.context,I):ce._makeDebugTileBoundsBuffers(x.context,I.projection);const et=ce._tileDebugBuffer||x.debugBuffer,lt=ce._tileDebugIndexBuffer||x.debugIndexBuffer,Ie=ce._tileDebugSegments||x.debugSegments;le.draw(b,P.LINE_STRIP,Ee,Fe,qe,s.CullFaceMode.disabled,xa(Z,s.Color.red),at,et,lt,Ie,null,null,null,[ce._globeTileDebugBorderBuffer]);const rt=ce.latestRawTileData,gt=Math.floor((rt&&rt.byteLength||0)/1024),yt=l.getTile(m).tileSize,Mt=512/Math.min(yt,512)*(m.overscaledZ/I.zoom)*.5;let Dt=m.canonical.toString();m.overscaledZ!==m.canonical.z&&(Dt+=` => ${m.overscaledZ}`),Dt+=` ${gt}kb`,(function(rn,Rn){rn.initDebugOverlayCanvas();const Jt=rn.debugOverlayCanvas,An=rn.context.gl,cn=rn.debugOverlayCanvas.getContext("2d");cn.clearRect(0,0,Jt.width,Jt.height),cn.shadowColor="white",cn.shadowBlur=2,cn.lineWidth=1.5,cn.strokeStyle="white",cn.textBaseline="top",cn.font="bold 36px Open Sans, sans-serif",cn.fillText(Rn,5,5),cn.strokeText(Rn,5,5),rn.debugOverlayTexture.update(Jt),rn.debugOverlayTexture.bind(An.LINEAR,An.CLAMP_TO_EDGE)})(x,Dt);const Nt=ce._tileDebugTextBuffer||x.debugBuffer,qt=ce._tileDebugTextIndexBuffer||x.quadTriangleIndexBuffer,Bt=ce._tileDebugTextSegments||x.debugSegments;le.draw(b,P.TRIANGLES,Ee,Fe,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,xa(Z,s.Color.transparent,Mt),at,Nt,qt,Bt,null,null,null,[ce._globeTileDebugTextBuffer])}function Kn(x,l,m,b){Yr(x,0,l+m/2,x.transform.width,m,b)}function Pr(x,l,m,b){Yr(x,l-m/2,0,m,x.transform.height,b)}function Yr(x,l,m,b,I,P){const j=x.context,W=j.gl;W.enable(W.SCISSOR_TEST),W.scissor(l*s.exported.devicePixelRatio,m*s.exported.devicePixelRatio,b*s.exported.devicePixelRatio,I*s.exported.devicePixelRatio),j.clear({color:P}),W.disable(W.SCISSOR_TEST)}const yi=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ms}=yi;function Xi(x,l,m,b){x.emplaceBack(l,m,b)}class Ds{constructor(l){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,Xi(this.vertexArray,-1,-1,1),Xi(this.vertexArray,1,-1,1),Xi(this.vertexArray,-1,1,1),Xi(this.vertexArray,1,1,1),Xi(this.vertexArray,-1,-1,-1),Xi(this.vertexArray,1,-1,-1),Xi(this.vertexArray,-1,1,-1),Xi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,Ms),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function As(x,l,m,b,I,P){const j=x.gl,W=l.paint.get("sky-atmosphere-color"),Z=l.paint.get("sky-atmosphere-halo-color"),le=l.paint.get("sky-atmosphere-sun-intensity"),ce=((Ee,Fe,qe,at,et)=>({u_matrix_3f:Ee,u_sun_direction:Fe,u_sun_intensity:qe,u_color_tint_r:[at.r,at.g,at.b,at.a],u_color_tint_m:[et.r,et.g,et.b,et.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),b),I,le,W,Z);j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_CUBE_MAP_POSITIVE_X+P,l.skyboxTexture,0),m.draw(x,j.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,ce,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const Xo=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class cl{constructor(l){const m=new s.StructArrayLayout5f20;m.emplaceBack(-1,1,1,0,0),m.emplaceBack(1,1,1,1,0),m.emplaceBack(1,-1,1,1,1),m.emplaceBack(-1,-1,1,0,1);const b=new s.StructArrayLayout3ui6;b.emplaceBack(0,1,2),b.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(m,Xo.members),this.indexBuffer=l.createIndexBuffer(b),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ma={symbol:function(x,l,m,b,I){if(x.renderPass!=="translucent")return;const P=s.StencilMode.disabled,j=x.colorModeForRenderPass();m.layout.get("text-variable-anchor")&&(function(W,Z,le,ce,Ee,Fe,qe){const at=Z.transform,et=Ee==="map",lt=Fe==="map";for(const Ie of W){const rt=ce.getTile(Ie),gt=rt.getBucket(le);if(!gt||!gt.text||!gt.text.segments.get().length)continue;const yt=s.evaluateSizeForZoom(gt.textSizeData,at.zoom),Mt=ss(Ie,gt.getProjection(),at),Dt=at.calculatePixelsToTileUnitsMatrix(rt),Nt=En(Mt,rt.tileID.canonical,lt,et,at,gt.getProjection(),Dt),qt=le.layout.get("icon-text-fit")!=="none"&&gt.hasIconData();if(yt){const Bt=Math.pow(2,at.zoom-rt.tileID.overscaledZ);oa(gt,et,lt,qe,s.symbolSize,at,Nt,Ie,Bt,yt,qt)}}})(b,x,m,l,m.layout.get("text-rotation-alignment"),m.layout.get("text-pitch-alignment"),I),m.paint.get("icon-opacity").constantOr(1)!==0&&f(x,l,m,b,!1,m.paint.get("icon-translate"),m.paint.get("icon-translate-anchor"),m.layout.get("icon-rotation-alignment"),m.layout.get("icon-pitch-alignment"),m.layout.get("icon-keep-upright"),P,j),m.paint.get("text-opacity").constantOr(1)!==0&&f(x,l,m,b,!0,m.paint.get("text-translate"),m.paint.get("text-translate-anchor"),m.layout.get("text-rotation-alignment"),m.layout.get("text-pitch-alignment"),m.layout.get("text-keep-upright"),P,j),l.map.showCollisionBoxes&&(ul(x,l,m,b,m.paint.get("text-translate"),m.paint.get("text-translate-anchor"),!0),ul(x,l,m,b,m.paint.get("icon-translate"),m.paint.get("icon-translate-anchor"),!1))},circle:function(x,l,m,b){if(x.renderPass!=="translucent")return;const I=m.paint.get("circle-opacity"),P=m.paint.get("circle-stroke-width"),j=m.paint.get("circle-stroke-opacity"),W=m.layout.get("circle-sort-key").constantOr(1)!==void 0;if(I.constantOr(1)===0&&(P.constantOr(1)===0||j.constantOr(1)===0))return;const Z=x.context,le=Z.gl,ce=x.transform,Ee=x.depthModeForSublayer(0,s.DepthMode.ReadOnly),Fe=s.StencilMode.disabled,qe=x.colorModeForRenderPass(),at=ce.projection.name==="globe",et=[s.mercatorXfromLng(ce.center.lng),s.mercatorYfromLat(ce.center.lat)],lt=[];for(let rt=0;rt<b.length;rt++){const gt=b[rt],yt=l.getTile(gt),Mt=yt.getBucket(m);if(!Mt||Mt.projection.name!==ce.projection.name)continue;const Dt=Mt.programConfigurations.get(m.id),Nt=Vi(m);at&&Nt.push("PROJECTION_GLOBE_VIEW");const qt=x.useProgram("circle",Dt,Nt),Bt=Mt.layoutVertexBuffer,rn=Mt.globeExtVertexBuffer,Rn=Mt.indexBuffer,Jt=ce.projection.createInversionMatrix(ce,gt.canonical),An={programConfiguration:Dt,program:qt,layoutVertexBuffer:Bt,globeExtVertexBuffer:rn,indexBuffer:Rn,uniformValues:oo(x,gt,yt,Jt,et,m),tile:yt};if(W){const cn=Mt.segments.get();for(const Vn of cn)lt.push({segments:new s.SegmentVector([Vn]),sortKey:Vn.sortKey,state:An})}else lt.push({segments:Mt.segments,sortKey:0,state:An})}W&&lt.sort(((rt,gt)=>rt.sortKey-gt.sortKey));const Ie={useDepthForOcclusion:!at};for(const rt of lt){const{programConfiguration:gt,program:yt,layoutVertexBuffer:Mt,globeExtVertexBuffer:Dt,indexBuffer:Nt,uniformValues:qt,tile:Bt}=rt.state,rn=rt.segments;x.terrain&&x.terrain.setupElevationDraw(Bt,yt,Ie),x.prepareDrawProgram(Z,yt,Bt.tileID.toUnwrapped()),yt.draw(Z,le.TRIANGLES,Ee,Fe,qe,s.CullFaceMode.disabled,qt,m.id,Mt,Nt,rn,m.paint,ce.zoom,gt,[Dt])}},heatmap:function(x,l,m,b){if(m.paint.get("heatmap-opacity")!==0)if(x.renderPass==="offscreen"){const I=x.context,P=I.gl,j=s.StencilMode.disabled,W=new s.ColorMode([P.ONE,P.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(qe,at,et,lt){const Ie=qe.gl,rt=at.width*lt,gt=at.height*lt;qe.activeTexture.set(Ie.TEXTURE1),qe.viewport.set([0,0,rt,gt]);let yt=et.heatmapFbo;if(!yt||yt&&(yt.width!==rt||yt.height!==gt)){yt&&yt.destroy();const Mt=Ie.createTexture();Ie.bindTexture(Ie.TEXTURE_2D,Mt),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_WRAP_S,Ie.CLAMP_TO_EDGE),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_WRAP_T,Ie.CLAMP_TO_EDGE),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_MIN_FILTER,Ie.LINEAR),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_MAG_FILTER,Ie.LINEAR),yt=et.heatmapFbo=qe.createFramebuffer(rt,gt,!1),(function(Dt,Nt,qt,Bt,rn,Rn){const Jt=Dt.gl;Jt.texImage2D(Jt.TEXTURE_2D,0,Dt.isWebGL2&&Dt.extRenderToTextureHalfFloat?Jt.RGBA16F:Jt.RGBA,rn,Rn,0,Jt.RGBA,Dt.extRenderToTextureHalfFloat?Dt.isWebGL2?Jt.HALF_FLOAT:Dt.extTextureHalfFloat.HALF_FLOAT_OES:Jt.UNSIGNED_BYTE,null),Bt.colorAttachment.set(qt)})(qe,0,Mt,yt,rt,gt)}else Ie.bindTexture(Ie.TEXTURE_2D,yt.colorAttachment.get()),qe.bindFramebuffer.set(yt.framebuffer)})(I,x,m,x.transform.projection.name==="globe"?.5:.25),I.clear({color:s.Color.transparent});const Z=x.transform,le=Z.projection.name==="globe",ce=le?["PROJECTION_GLOBE_VIEW"]:null,Ee=le?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,Fe=[s.mercatorXfromLng(Z.center.lng),s.mercatorYfromLat(Z.center.lat)];for(let qe=0;qe<b.length;qe++){const at=b[qe];if(l.hasRenderableParent(at))continue;const et=l.getTile(at),lt=et.getBucket(m);if(!lt||lt.projection.name!==Z.projection.name)continue;const Ie=lt.programConfigurations.get(m.id),rt=x.useProgram("heatmap",Ie,ce),{zoom:gt}=x.transform;x.terrain&&x.terrain.setupElevationDraw(et,rt),x.prepareDrawProgram(I,rt,at.toUnwrapped());const yt=Z.projection.createInversionMatrix(Z,at.canonical);rt.draw(I,P.TRIANGLES,s.DepthMode.disabled,j,W,Ee,Ru(x,at,et,yt,Fe,gt,m.paint.get("heatmap-intensity")),m.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,m.paint,x.transform.zoom,Ie,le?[lt.globeExtVertexBuffer]:null)}I.viewport.set([0,0,x.width,x.height])}else x.renderPass==="translucent"&&(x.context.setColorMode(x.colorModeForRenderPass()),(function(I,P){const j=I.context,W=j.gl,Z=P.heatmapFbo;if(!Z)return;j.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,Z.colorAttachment.get()),j.activeTexture.set(W.TEXTURE1);let le=P.colorRampTexture;le||(le=P.colorRampTexture=new s.Texture(j,P.colorRamp,W.RGBA)),le.bind(W.LINEAR,W.CLAMP_TO_EDGE),I.useProgram("heatmapTexture").draw(j,W.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,I.colorModeForRenderPass(),s.CullFaceMode.disabled,((ce,Ee,Fe,qe)=>({u_image:0,u_color_ramp:1,u_opacity:Ee.paint.get("heatmap-opacity")}))(0,P),P.id,I.viewportBuffer,I.quadTriangleIndexBuffer,I.viewportSegments,P.paint,I.transform.zoom)})(x,m))},line:function(x,l,m,b){if(x.renderPass!=="translucent")return;const I=m.paint.get("line-opacity"),P=m.paint.get("line-width");if(I.constantOr(1)===0||P.constantOr(1)===0)return;const j=x.depthModeForSublayer(0,s.DepthMode.ReadOnly),W=x.colorModeForRenderPass(),Z=x.terrain&&x.terrain.renderingToTexture?1:s.exported.devicePixelRatio,le=m.paint.get("line-dasharray"),ce=le.constantOr(1),Ee=m.layout.get("line-cap"),Fe=m.paint.get("line-pattern"),qe=Fe.constantOr(1),at=m.paint.get("line-gradient"),et=qe?"linePattern":"line",lt=x.context,Ie=lt.gl,rt=(yt=>{const Mt=[];yo(yt)&&Mt.push("RENDER_LINE_DASH"),yt.paint.get("line-gradient")&&Mt.push("RENDER_LINE_GRADIENT");const Dt=yt.paint.get("line-trim-offset");Dt[0]===0&&Dt[1]===0||Mt.push("RENDER_LINE_TRIM_OFFSET");const Nt=yt.paint.get("line-pattern").constantOr(1),qt=yt.paint.get("line-opacity").constantOr(1)!==1;return!Nt&&qt&&Mt.push("RENDER_LINE_ALPHA_DISCARD"),Mt})(m);let gt=rt.includes("RENDER_LINE_ALPHA_DISCARD");x.terrain&&x.terrain.clipOrMaskOverlapStencilType()&&(gt=!1);for(const yt of b){const Mt=l.getTile(yt);if(qe&&!Mt.patternsLoaded())continue;const Dt=Mt.getBucket(m);if(!Dt)continue;x.prepareDrawTile();const Nt=Dt.programConfigurations.get(m.id),qt=x.useProgram(et,Nt,rt),Bt=Fe.constantOr(null);if(Bt&&Mt.imageAtlas){const bn=Mt.imageAtlas.patternPositions[Bt.toString()];bn&&Nt.setConstantPatternPositions(bn)}const rn=le.constantOr(null),Rn=Ee.constantOr(null);if(!qe&&rn&&Rn&&Mt.lineAtlas){const bn=Mt.lineAtlas.getDash(rn,Rn);bn&&Nt.setConstantPatternPositions(bn)}let[Jt,An]=m.paint.get("line-trim-offset");(Rn==="round"||Rn==="square")&&Jt!==An&&(Jt===0&&(Jt-=1),An===1&&(An+=1));const cn=x.terrain?yt.projMatrix:null,Vn=qe?Wa(x,Mt,m,cn,Z):yu(x,Mt,m,cn,Dt.lineClipsArray.length,Z,[Jt,An]);if(at){const bn=Dt.gradients[m.id];let Un=bn.texture;if(m.gradientVersion!==bn.version){let In=256;if(m.stepInterpolant){const Wn=l.getSource().maxzoom,Nr=yt.canonical.z===Wn?Math.ceil(1<<x.transform.maxZoom-yt.canonical.z):1;In=s.clamp(s.nextPowerOfTwo(Dt.maxLineLength/s.EXTENT*1024*Nr),256,lt.maxTextureSize)}bn.gradient=s.renderColorRamp({expression:m.gradientExpression(),evaluationKey:"lineProgress",resolution:In,image:bn.gradient||void 0,clips:Dt.lineClipsArray}),bn.texture?bn.texture.update(bn.gradient):bn.texture=new s.Texture(lt,bn.gradient,Ie.RGBA),bn.version=m.gradientVersion,Un=bn.texture}lt.activeTexture.set(Ie.TEXTURE1),Un.bind(m.stepInterpolant?Ie.NEAREST:Ie.LINEAR,Ie.CLAMP_TO_EDGE)}ce&&(lt.activeTexture.set(Ie.TEXTURE0),Mt.lineAtlasTexture.bind(Ie.LINEAR,Ie.REPEAT),Nt.updatePaintBuffers()),qe&&(lt.activeTexture.set(Ie.TEXTURE0),Mt.imageAtlasTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),Nt.updatePaintBuffers()),x.prepareDrawProgram(lt,qt,yt.toUnwrapped());const tn=bn=>{qt.draw(lt,Ie.TRIANGLES,j,bn,W,s.CullFaceMode.disabled,Vn,m.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Dt.segments,m.paint,x.transform.zoom,Nt,[Dt.layoutVertexBuffer2])};if(gt){const bn=x.stencilModeForClipping(yt).ref;bn===0&&x.terrain&&lt.clear({stencil:0});const Un={func:Ie.EQUAL,mask:255};Vn.u_alpha_discard_threshold=.8,tn(new s.StencilMode(Un,bn,255,Ie.KEEP,Ie.KEEP,Ie.INVERT)),Vn.u_alpha_discard_threshold=0,tn(new s.StencilMode(Un,bn,255,Ie.KEEP,Ie.KEEP,Ie.KEEP))}else tn(x.stencilModeForClipping(yt))}gt&&(x.resetStencilClippingMasks(),x.terrain&&lt.clear({stencil:0}))},fill:function(x,l,m,b){const I=m.paint.get("fill-color"),P=m.paint.get("fill-opacity");if(P.constantOr(1)===0)return;const j=x.colorModeForRenderPass(),W=m.paint.get("fill-pattern"),Z=x.opaquePassEnabledForLayer()&&!W.constantOr(1)&&I.constantOr(s.Color.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===Z){const le=x.depthModeForSublayer(1,x.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);S(x,l,m,b,le,j,!1)}if(x.renderPass==="translucent"&&m.paint.get("fill-antialias")){const le=x.depthModeForSublayer(m.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);S(x,l,m,b,le,j,!0)}},"fill-extrusion":function(x,l,m,b){const I=m.paint.get("fill-extrusion-opacity");if(I!==0&&x.renderPass==="translucent"){const P=new s.DepthMode(x.context.gl.LEQUAL,s.DepthMode.ReadWrite,x.depthRangeFor3D);if(I!==1||m.paint.get("fill-extrusion-pattern").constantOr(1))N(x,l,m,b,P,s.StencilMode.disabled,s.ColorMode.disabled),N(x,l,m,b,P,x.stencilModeFor3D(),x.colorModeForRenderPass()),x.resetStencilClippingMasks();else{const j=x.colorModeForRenderPass();N(x,l,m,b,P,s.StencilMode.disabled,j)}}},hillshade:function(x,l,m,b){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;const I=x.context,P=x.depthModeForSublayer(0,s.DepthMode.ReadOnly),j=x.colorModeForRenderPass(),W=x.terrain&&x.terrain.renderingToTexture,[Z,le]=x.renderPass!=="translucent"||W?[{},b]:x.stencilConfigForOverlap(b);for(const ce of le){const Ee=l.getTile(ce);if(Ee.needsHillshadePrepare&&x.renderPass==="offscreen")Ui(x,Ee,m,P,s.StencilMode.disabled,j);else if(x.renderPass==="translucent"){const Fe=W&&x.terrain?x.terrain.stencilModeForRTTOverlap(ce):Z[ce.overscaledZ];Qr(x,ce,Ee,m,P,Fe,j)}}I.viewport.set([0,0,x.width,x.height]),x.resetStencilClippingMasks()},raster:function(x,l,m,b,I,P){if(x.renderPass!=="translucent"||m.paint.get("raster-opacity")===0||!b.length)return;const j=x.context,W=j.gl,Z=l.getSource(),le=x.useProgram("raster"),ce=x.colorModeForRenderPass(),Ee=x.terrain&&x.terrain.renderingToTexture,[Fe,qe]=Z instanceof Mr||Ee?[{},b]:x.stencilConfigForOverlap(b),at=qe[qe.length-1].overscaledZ,et=!x.options.moving;for(const lt of qe){const Ie=Ee?s.DepthMode.disabled:x.depthModeForSublayer(lt.overscaledZ-at,m.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,W.LESS),rt=lt.toUnwrapped(),gt=l.getTile(lt);if(Ee&&(!gt||!gt.hasData()))continue;const yt=Ee?lt.projMatrix:x.transform.calculateProjMatrix(rt,et),Mt=x.terrain&&Ee?x.terrain.stencilModeForRTTOverlap(lt):Fe[lt.overscaledZ],Dt=P?0:m.paint.get("raster-fade-duration");gt.registerFadeDuration(Dt);const Nt=l.findLoadedParent(lt,0),qt=Fl(gt,Nt,l,x.transform,Dt);let Bt,rn;x.terrain&&x.terrain.prepareDrawTile();const Rn=m.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR;j.activeTexture.set(W.TEXTURE0),gt.texture.bind(Rn,W.CLAMP_TO_EDGE),j.activeTexture.set(W.TEXTURE1),Nt?(Nt.texture.bind(Rn,W.CLAMP_TO_EDGE),Bt=Math.pow(2,Nt.tileID.overscaledZ-gt.tileID.overscaledZ),rn=[gt.tileID.canonical.x*Bt%1,gt.tileID.canonical.y*Bt%1]):gt.texture.bind(Rn,W.CLAMP_TO_EDGE),gt.texture.useMipmap&&j.extTextureFilterAnisotropic&&x.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const Jt=ia(yt,rn||[0,0],Bt||1,qt,m,Z instanceof Mr?Z.perspectiveTransform:[0,0]);if(x.prepareDrawProgram(j,le,rt),Z instanceof Mr)Z.boundsBuffer&&Z.boundsSegments&&le.draw(j,W.TRIANGLES,Ie,s.StencilMode.disabled,ce,s.CullFaceMode.disabled,Jt,m.id,Z.boundsBuffer,x.quadTriangleIndexBuffer,Z.boundsSegments);else{const{tileBoundsBuffer:An,tileBoundsIndexBuffer:cn,tileBoundsSegments:Vn}=x.getTileBoundsBuffers(gt);le.draw(j,W.TRIANGLES,Ie,Mt,ce,s.CullFaceMode.disabled,Jt,m.id,An,cn,Vn)}}x.resetStencilClippingMasks()},background:function(x,l,m,b){const I=m.paint.get("background-color"),P=m.paint.get("background-opacity");if(P===0)return;const j=x.context,W=j.gl,Z=x.transform,le=Z.tileSize,ce=m.paint.get("background-pattern");if(x.isPatternMissing(ce))return;const Ee=!ce&&I.a===1&&P===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==Ee)return;const Fe=s.StencilMode.disabled,qe=x.depthModeForSublayer(0,Ee==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),at=x.colorModeForRenderPass(),et=x.useProgram(ce?"backgroundPattern":"background");let lt,Ie=b;Ie||(lt=x.getBackgroundTiles(),Ie=Object.values(lt).map((rt=>rt.tileID))),ce&&(j.activeTexture.set(W.TEXTURE0),x.imageManager.bind(x.context));for(const rt of Ie){const gt=rt.toUnwrapped(),yt=b?rt.projMatrix:x.transform.calculateProjMatrix(gt);x.prepareDrawTile();const Mt=l?l.getTile(rt):lt?lt[rt.key]:new s.Tile(rt,le,Z.zoom,x),Dt=ce?sc(yt,P,x,ce,{tileID:rt,tileSize:le}):sa(yt,P,I);x.prepareDrawProgram(j,et,gt);const{tileBoundsBuffer:Nt,tileBoundsIndexBuffer:qt,tileBoundsSegments:Bt}=x.getTileBoundsBuffers(Mt);et.draw(j,W.TRIANGLES,qe,Fe,at,s.CullFaceMode.disabled,Dt,m.id,Nt,qt,Bt)}},sky:function(x,l,m){const b=x.transform,I=b.projection.name==="mercator"||b.projection.name==="globe"?1:s.smoothstep(7,8,b.zoom),P=m.paint.get("sky-opacity")*I;if(P===0)return;const j=x.context,W=m.paint.get("sky-type"),Z=new s.DepthMode(j.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),le=x.frameCounter/1e3%1;W==="atmosphere"?x.renderPass==="offscreen"?m.needsSkyboxCapture(x)&&((function(ce,Ee,Fe,qe){const at=ce.context,et=at.gl;let lt=Ee.skyboxFbo;if(!lt){lt=Ee.skyboxFbo=at.createFramebuffer(32,32,!1),Ee.skyboxGeometry=new Ds(at),Ee.skyboxTexture=at.gl.createTexture(),et.bindTexture(et.TEXTURE_CUBE_MAP,Ee.skyboxTexture),et.texParameteri(et.TEXTURE_CUBE_MAP,et.TEXTURE_WRAP_S,et.CLAMP_TO_EDGE),et.texParameteri(et.TEXTURE_CUBE_MAP,et.TEXTURE_WRAP_T,et.CLAMP_TO_EDGE),et.texParameteri(et.TEXTURE_CUBE_MAP,et.TEXTURE_MIN_FILTER,et.LINEAR),et.texParameteri(et.TEXTURE_CUBE_MAP,et.TEXTURE_MAG_FILTER,et.LINEAR);for(let yt=0;yt<6;++yt)et.texImage2D(et.TEXTURE_CUBE_MAP_POSITIVE_X+yt,0,et.RGBA,32,32,0,et.RGBA,et.UNSIGNED_BYTE,null)}at.bindFramebuffer.set(lt.framebuffer),at.viewport.set([0,0,32,32]);const Ie=Ee.getCenter(ce,!0),rt=ce.useProgram("skyboxCapture"),gt=new Float64Array(16);s.identity(gt),s.rotateY(gt,gt,.5*-Math.PI),As(at,Ee,rt,gt,Ie,0),s.identity(gt),s.rotateY(gt,gt,.5*Math.PI),As(at,Ee,rt,gt,Ie,1),s.identity(gt),s.rotateX(gt,gt,.5*-Math.PI),As(at,Ee,rt,gt,Ie,2),s.identity(gt),s.rotateX(gt,gt,.5*Math.PI),As(at,Ee,rt,gt,Ie,3),s.identity(gt),As(at,Ee,rt,gt,Ie,4),s.identity(gt),s.rotateY(gt,gt,Math.PI),As(at,Ee,rt,gt,Ie,5),at.viewport.set([0,0,ce.width,ce.height])})(x,m),m.markSkyboxValid(x)):x.renderPass==="sky"&&(function(ce,Ee,Fe,qe,at){const et=ce.context,lt=et.gl,Ie=ce.transform,rt=ce.useProgram("skybox");et.activeTexture.set(lt.TEXTURE0),lt.bindTexture(lt.TEXTURE_CUBE_MAP,Ee.skyboxTexture);const gt=((yt,Mt,Dt,Nt,qt)=>({u_matrix:yt,u_sun_direction:Mt,u_cubemap:0,u_opacity:Nt,u_temporal_offset:qt}))(Ie.skyboxMatrix,Ee.getCenter(ce,!1),0,qe,at);ce.prepareDrawProgram(et,rt),rt.draw(et,lt.TRIANGLES,Fe,s.StencilMode.disabled,ce.colorModeForRenderPass(),s.CullFaceMode.backCW,gt,"skybox",Ee.skyboxGeometry.vertexBuffer,Ee.skyboxGeometry.indexBuffer,Ee.skyboxGeometry.segment)})(x,m,Z,P,le):W==="gradient"&&x.renderPass==="sky"&&(function(ce,Ee,Fe,qe,at){const et=ce.context,lt=et.gl,Ie=ce.transform,rt=ce.useProgram("skyboxGradient");Ee.skyboxGeometry||(Ee.skyboxGeometry=new Ds(et)),et.activeTexture.set(lt.TEXTURE0);let gt=Ee.colorRampTexture;gt||(gt=Ee.colorRampTexture=new s.Texture(et,Ee.colorRamp,lt.RGBA)),gt.bind(lt.LINEAR,lt.CLAMP_TO_EDGE);const yt=((Mt,Dt,Nt,qt,Bt)=>({u_matrix:Mt,u_color_ramp:0,u_center_direction:Dt,u_radius:s.degToRad(Nt),u_opacity:qt,u_temporal_offset:Bt}))(Ie.skyboxMatrix,Ee.getCenter(ce,!1),Ee.paint.get("sky-gradient-radius"),qe,at);ce.prepareDrawProgram(et,rt),rt.draw(et,lt.TRIANGLES,Fe,s.StencilMode.disabled,ce.colorModeForRenderPass(),s.CullFaceMode.backCW,yt,"skyboxGradient",Ee.skyboxGeometry.vertexBuffer,Ee.skyboxGeometry.indexBuffer,Ee.skyboxGeometry.segment)})(x,m,Z,P,le)},debug:function(x,l,m){for(let b=0;b<m.length;b++)mn(x,l,m[b])},custom:function(x,l,m,b){const I=x.context,P=m.implementation;if(!x.transform.projection.unsupportedLayers||!x.transform.projection.unsupportedLayers.includes("custom")||x.terrain&&(x.terrain.renderingToTexture||x.renderPass==="offscreen")&&m.isLayerDraped()){if(x.renderPass==="offscreen"){const j=P.prerender;if(j){if(x.setCustomLayerDefaults(),I.setColorMode(x.colorModeForRenderPass()),x.transform.projection.name==="globe"){const W=x.transform.pointMerc;j.call(P,I.gl,x.transform.customLayerMatrix(),x.transform.getProjection(),x.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(x.transform.zoom),[W.x,W.y],x.transform.pixelsPerMeterRatio)}else j.call(P,I.gl,x.transform.customLayerMatrix());I.setDirty(),x.setBaseState()}}else if(x.renderPass==="translucent"){if(x.terrain&&x.terrain.renderingToTexture){const W=P.renderToTile;if(W){const Z=b[0].canonical,le=new s.MercatorCoordinate(Z.x+b[0].wrap*(1<<Z.z),Z.y,Z.z);I.setDepthMode(s.DepthMode.disabled),I.setStencilMode(s.StencilMode.disabled),I.setColorMode(x.colorModeForRenderPass()),x.setCustomLayerDefaults(),W.call(P,I.gl,le),I.setDirty(),x.setBaseState()}return}x.setCustomLayerDefaults(),I.setColorMode(x.colorModeForRenderPass()),I.setStencilMode(s.StencilMode.disabled);const j=P.renderingMode==="3d"?new s.DepthMode(x.context.gl.LEQUAL,s.DepthMode.ReadWrite,x.depthRangeFor3D):x.depthModeForSublayer(0,s.DepthMode.ReadOnly);if(I.setDepthMode(j),x.transform.projection.name==="globe"){const W=x.transform.pointMerc;P.render(I.gl,x.transform.customLayerMatrix(),x.transform.getProjection(),x.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(x.transform.zoom),[W.x,W.y],x.transform.pixelsPerMeterRatio)}else P.render(I.gl,x.transform.customLayerMatrix());I.setDirty(),x.setBaseState(),I.bindFramebuffer.set(null)}}else s.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Go{constructor(l,m,b=!1){this.context=new Pn(l,b),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(l,m){const b=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(b||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ke(this,l));const I=this._terrain;this.transform.elevation=b?I:null,I.update(l,this.transform,m)}_updateFog(l){const m=l.fog;if(!m||this.transform.projection.name==="globe"||m.getOpacity(this.transform.pitch)<1||m.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[b,I]=m.getFovAdjustedRange(this.transform._fov);if(b>I)return void(this.transform.fogCullDistSq=null);const P=b+.78*(I-b);this.transform.fogCullDistSq=P*P}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(l,m){if(this.width=l*s.exported.devicePixelRatio,this.height=m*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const b of this.style.order)this.style._layers[b].resize()}setup(){const l=this.context,m=new s.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(s.EXTENT,0),m.emplaceBack(0,s.EXTENT),m.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(m,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const b=new s.StructArrayLayout2i4;b.emplaceBack(0,0),b.emplaceBack(s.EXTENT,0),b.emplaceBack(0,s.EXTENT),b.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=l.createVertexBuffer(b,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const I=new s.StructArrayLayout2i4;I.emplaceBack(-1,-1),I.emplaceBack(1,-1),I.emplaceBack(-1,1),I.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(I,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const P=new s.StructArrayLayout4i8;P.emplaceBack(0,0,0,0),P.emplaceBack(s.EXTENT,0,s.EXTENT,0),P.emplaceBack(0,s.EXTENT,0,s.EXTENT),P.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=l.createVertexBuffer(P,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const j=new s.StructArrayLayout3ui6;j.emplaceBack(0,1,2),j.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(j);const W=new s.StructArrayLayout1ui2;for(const le of[0,1,3,2,0])W.emplaceBack(le);this.debugIndexBuffer=l.createIndexBuffer(W),this.emptyTexture=new s.Texture(l,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=s.create();const Z=this.context.gl;this.stencilClearMode=new s.StencilMode({func:Z.ALWAYS,mask:0},0,255,Z.ZERO,Z.ZERO,Z.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new cl(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context,m=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(l,m.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,zs(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,m,b){if(!m||this.currentStencilSource===m.id||!l.isTileClipped()||!b||b.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let W=!1;for(const Z of b)if(this._tileClippingMaskIDs[Z.key]===void 0){W=!0;break}if(!W)return}this.currentStencilSource=m.id;const I=this.context,P=I.gl;this.nextStencilID+b.length>256&&this.clearStencil(),I.setColorMode(s.ColorMode.disabled),I.setDepthMode(s.DepthMode.disabled);const j=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const W of b){const Z=m.getTile(W),le=this._tileClippingMaskIDs[W.key]=this.nextStencilID++,{tileBoundsBuffer:ce,tileBoundsIndexBuffer:Ee,tileBoundsSegments:Fe}=this.getTileBoundsBuffers(Z);j.draw(I,P.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:P.ALWAYS,mask:0},le,255,P.KEEP,P.KEEP,P.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,zs(W.projMatrix),"$clipping",ce,Ee,Fe)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,m=this.context.gl;return new s.StencilMode({func:m.NOTEQUAL,mask:255},l,255,m.KEEP,m.KEEP,m.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const m=this.context.gl;return new s.StencilMode({func:m.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,m.KEEP,m.KEEP,m.REPLACE)}stencilConfigForOverlap(l){const m=this.context.gl,b=l.sort(((j,W)=>W.overscaledZ-j.overscaledZ)),I=b[b.length-1].overscaledZ,P=b[0].overscaledZ-I+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();const j={};for(let W=0;W<P;W++)j[W+I]=new s.StencilMode({func:m.GEQUAL,mask:255},W+this.nextStencilID,255,m.KEEP,m.KEEP,m.REPLACE);return this.nextStencilID+=P,[j,b]}return[{[I]:s.StencilMode.disabled},b]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([l.CONSTANT_COLOR,l.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(l,m,b){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const I=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new s.DepthMode(b||this.context.gl.LEQUAL,m,[I,I])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,m){this.style=l,this.options=m,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const b=this.style.order,I=this.style._sourceCaches;for(const le in I){const ce=I[le];ce.used&&ce.prepare(this.context)}const P={},j={},W={};for(const le in I){const ce=I[le];P[le]=ce.getVisibleCoordinates(),j[le]=P[le].slice().reverse(),W[le]=ce.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let le=0;le<b.length;le++)if(this.style._layers[b[le]].is3D()){this.opaquePassCutoff=le;break}if(this.terrain&&(this.terrain.updateTileBinding(W),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),!s.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const le of b){const ce=this.style._layers[le],Ee=l._getLayerSourceCache(ce);if(!ce.hasOffscreenPass()||ce.isHidden(this.transform.zoom))continue;const Fe=Ee?j[Ee.id]:void 0;(ce.type==="custom"||ce.isSky()||Fe&&Fe.length)&&this.renderLayer(this,Ee,ce,Fe)}this.depthRangeFor3D=[0,1-(l.order.length+2)*this.numSublayers*this.depthEpsilon];const Z=this.terrain;if(Z&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&Z.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:m.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=m.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const le=this.style._layers[b[this.currentLayer]],ce=l._getLayerSourceCache(le);if(le.isSky())continue;const Ee=ce?j[ce.id]:void 0;this._renderTileClippingMasks(le,ce,Ee),this.renderLayer(this,ce,le,Ee)}if(this.style.fog&&this.transform.projection.supportsFog&&(function(le,ce){const Ee=le.context,Fe=Ee.gl,qe=le.transform,at=new s.DepthMode(Fe.LEQUAL,s.DepthMode.ReadOnly,[0,1]),et=le.useProgram("globeAtmosphere",null,qe.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),lt=s.globeToMercatorTransition(qe.zoom),Ie=ce.properties.get("color").toArray01(),rt=ce.properties.get("high-color").toArray01(),gt=ce.properties.get("space-color").toArray01PremultipliedAlpha(),yt=s.identity$1([]);s.rotateY$1(yt,yt,-s.degToRad(qe._center.lng)),s.rotateX$1(yt,yt,s.degToRad(qe._center.lat)),s.rotateZ$1(yt,yt,qe.angle),s.rotateX$1(yt,yt,-qe._pitch);const Mt=s.fromQuat(new Float32Array(16),yt),Dt=s.mapValue(ce.properties.get("star-intensity"),0,1,0,.25),Nt=5e-4,qt=s.mapValue(ce.properties.get("horizon-blend"),0,1,Nt,.25),Bt=s.globeUseCustomAntiAliasing(le,Ee,qe)&&qt===Nt?qe.worldSize/(2*Math.PI*1.025)-1:qe.globeRadius,rn=le.frameCounter/1e3%1,Rn=s.length(qe.globeCenterInViewSpace),Jt=Math.sqrt(Math.pow(Rn,2)-Math.pow(Bt,2)),An=Math.acos(Jt/Rn),cn=((tn,bn,Un,In,Wn,Nr,ei,Er,gr,Ai,Mi,Vr,Yi,Ki)=>({u_frustum_tl:tn,u_frustum_tr:bn,u_frustum_br:Un,u_frustum_bl:In,u_horizon:Wn,u_transition:Nr,u_fadeout_range:ei,u_color:Er,u_high_color:gr,u_space_color:Ai,u_star_intensity:Mi,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Vr,u_horizon_angle:Yi,u_rotation_matrix:Ki}))(qe.frustumCorners.TL,qe.frustumCorners.TR,qe.frustumCorners.BR,qe.frustumCorners.BL,qe.frustumCorners.horizon,lt,qt,Ie,rt,gt,Dt,rn,An,Mt);le.prepareDrawProgram(Ee,et);const Vn=le.atmosphereBuffer;Vn&&et.draw(Ee,Fe.TRIANGLES,at,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,cn,"skybox",Vn.vertexBuffer,Vn.indexBuffer,Vn.segments)})(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const le=this.style._layers[b[this.currentLayer]],ce=l._getLayerSourceCache(le);le.isSky()&&this.renderLayer(this,ce,le,ce?j[ce.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<b.length;){const le=this.style._layers[b[this.currentLayer]],ce=l._getLayerSourceCache(le);if(le.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(le)){if(le.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const Ee=ce?(le.type==="symbol"?W:j)[ce.id]:void 0;this._renderTileClippingMasks(le,ce,ce?P[ce.id]:void 0),this.renderLayer(this,ce,le,Ee),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let le=null;s.values(this.style._layers).forEach((ce=>{const Ee=l._getLayerSourceCache(ce);Ee&&!ce.isHidden(this.transform.zoom)&&(!le||le.getSource().maxzoom<Ee.getSource().maxzoom)&&(le=Ee)})),le&&this.options.showTileBoundaries&&Ma.debug(this,le,le.getVisibleCoordinates())}this.options.showPadding&&(function(le){const ce=le.transform.padding;Kn(le,le.transform.height-(ce.top||0),3,he),Kn(le,ce.bottom||0,3,Ae),Pr(le,ce.left||0,3,Ye),Pr(le,le.transform.width-(ce.right||0),3,bt);const Ee=le.transform.centerPoint;(function(Fe,qe,at,et){Yr(Fe,qe-1,at-10,2,20,et),Yr(Fe,qe-10,at-1,20,2,et)})(le,Ee.x,le.transform.height-Ee.y,an)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}renderLayer(l,m,b,I){b.isHidden(this.transform.zoom)||(b.type==="background"||b.type==="sky"||b.type==="custom"||I&&I.length)&&(this.id=b.id,this.gpuTimingStart(b),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(b.type)||l.terrain&&b.type==="custom")&&Ma[b.type](l,m,b,I,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const m=this.context.extTimerQuery;let b=this.gpuTimers[l.id];b||(b=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:m.createQueryEXT()}),b.calls++,m.beginQueryEXT(m.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,m=l.createQueryEXT();this.deferredRenderGpuTimeQueries.push(m),l.beginQueryEXT(l.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const m={};for(const b in l){const I=l[b],P=this.context.extTimerQuery,j=P.getQueryObjectEXT(I.query,P.QUERY_RESULT_EXT)/1e6;P.deleteQueryEXT(I.query),m[b]=j}return m}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const m=this.context.extTimerQuery;let b=0;for(const I of l)b+=m.getQueryObjectEXT(I,m.QUERY_RESULT_EXT)/1e6,m.deleteQueryEXT(I);return b}translatePosMatrix(l,m,b,I,P){if(!b[0]&&!b[1])return l;const j=P?I==="map"?this.transform.angle:0:I==="viewport"?-this.transform.angle:0;if(j){const le=Math.sin(j),ce=Math.cos(j);b=[b[0]*ce-b[1]*le,b[0]*le+b[1]*ce]}const W=[P?b[0]:ge(m,b[0],this.transform.zoom),P?b[1]:ge(m,b[1],this.transform.zoom),0],Z=new Float32Array(16);return s.translate(Z,l,W),Z}saveTileTexture(l){const m=this._tileTextures[l.size[0]];m?m.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const m=this._tileTextures[l];return m&&m.length>0?m.pop():null}isPatternMissing(l){return l===null||l!==void 0&&!this.imageManager.getPattern(l.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const l=this.terrain&&this.terrain.renderingToTexture,m=this.terrain&&this.terrain.exaggeration()===0,b=this.style&&this.style.fog,I=[];return this.terrainRenderModeElevated()&&I.push("TERRAIN"),this.transform.projection.name==="globe"&&I.push("GLOBE"),m&&I.push("ZERO_EXAGGERATION"),b&&!l&&b.getOpacity(this.transform.pitch)!==0&&I.push("FOG"),l&&I.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&I.push("OVERDRAW_INSPECTOR"),I}useProgram(l,m,b){this.cache=this.cache||{};const I=b||[],P=this.currentGlobalDefines().concat(I),j=nt.cacheKey(kt[l],l,P,m);return this.cache[j]||(this.cache[j]=new nt(this.context,l,kt[l],m,_u[l],P)),this.cache[j]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(l,m,b){if(this.terrain&&this.terrain.renderingToTexture)return;const I=this.style.fog;if(I){const P=I.getOpacity(this.transform.pitch),j=((W,Z,le,ce,Ee,Fe,qe,at,et,lt,Ie)=>{const rt=W.transform,gt=Z.properties.get("color").toArray01();gt[3]=ce;const yt=W.frameCounter/1e3%1;return{u_fog_matrix:le?rt.calculateFogTileMatrix(le):W.identityMat,u_fog_range:Z.getFovAdjustedRange(rt._fov),u_fog_color:gt,u_fog_horizon_blend:Z.properties.get("horizon-blend"),u_fog_temporal_offset:yt,u_frustum_tl:Ee,u_frustum_tr:Fe,u_frustum_br:qe,u_frustum_bl:at,u_globe_pos:et,u_globe_radius:lt,u_viewport:Ie,u_globe_transition:s.globeToMercatorTransition(rt.zoom),u_is_globe:+(rt.projection.name==="globe")}})(this,I,b,P,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);m.setFogUniformValues(l,j)}}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,m=l.createTexture();return l.bindTexture(l.TEXTURE_2D,m),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),m}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const l=this._backgroundTiles,m=this._backgroundTiles={},b=this.transform.coveringTiles({tileSize:512});for(const I of b)m[I.key]=l[I.key]||new s.Tile(I,512,this.transform.tileZoom,this);return m}clearBackgroundTiles(){this._backgroundTiles={}}}class _c{constructor(l=0,m=0,b=0,I=0){if(isNaN(l)||l<0||isNaN(m)||m<0||isNaN(b)||b<0||isNaN(I)||I<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=m,this.left=b,this.right=I}interpolate(l,m,b){return m.top!=null&&l.top!=null&&(this.top=s.number(l.top,m.top,b)),m.bottom!=null&&l.bottom!=null&&(this.bottom=s.number(l.bottom,m.bottom,b)),m.left!=null&&l.left!=null&&(this.left=s.number(l.left,m.left,b)),m.right!=null&&l.right!=null&&(this.right=s.number(l.right,m.right,b)),this}getCenter(l,m){const b=s.clamp((this.left+l-this.right)/2,0,l),I=s.clamp((this.top+m-this.bottom)/2,0,m);return new s.Point(b,I)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new _c(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ri(x,l){const m=s.getColumn(x,3);s.fromQuat(x,l),s.setColumn(x,3,m)}function gs(x,l){const m=s.identity$1([]);return s.rotateZ$1(m,m,-l),s.rotateX$1(m,m,-x),m}function oc(x,l){const m=[x[0],x[1],0],b=[l[0],l[1],0];if(s.length(m)>=1e-15){const j=s.normalize([],m);s.scale$2(b,j,s.dot(b,j)),l[0]=b[0],l[1]=b[1]}const I=s.cross([],l,x);if(s.len(I)<1e-15)return null;const P=Math.atan2(-I[1],I[0]);return gs(Math.atan2(Math.sqrt(x[0]*x[0]+x[1]*x[1]),-x[2]),P)}class Xa{constructor(l,m){this.position=l,this.orientation=m}get position(){return this._position}set position(l){if(l){const m=l instanceof s.MercatorCoordinate?l:new s.MercatorCoordinate(l[0],l[1],l[2]);this._renderWorldCopies&&(m.x=s.wrap(m.x,0,1)),this._position=m}else this._position=null}lookAtPoint(l,m){if(this.orientation=null,!this.position)return;const b=this.position,I=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(l)):0,P=s.MercatorCoordinate.fromLngLat(l,I),j=[P.x-b.x,P.y-b.y,P.z-b.z];m||(m=[0,0,1]),m[2]=Math.abs(m[2]),this.orientation=oc(j,m)}setPitchBearing(l,m){this.orientation=gs(s.degToRad(l),s.degToRad(-m))}}class Ya{constructor(l,m){this._transform=s.identity([]),this.orientation=m,this.position=l}get mercatorPosition(){const l=this.position;return new s.MercatorCoordinate(l[0],l[1],l[2])}get position(){const l=s.getColumn(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var m;l&&s.setColumn(this._transform,3,[(m=l)[0],m[1],m[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||s.identity$1([]),l&&ri(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),m=this.right();return{bearing:Math.atan2(-m[1],m[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,m){this._orientation=gs(l,m),ri(this._transform,this._orientation)}forward(){const l=s.getColumn(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=s.getColumn(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=s.getColumn(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,m){const b=new Float64Array(16);return s.invert(b,this.getWorldToCamera(l,m)),b}getWorldToCameraPosition(l,m,b){const I=this.position;s.scale$2(I,I,-l);const P=new Float64Array(16);return s.fromScaling(P,[b,b,b]),s.translate(P,P,I),P[10]*=m,P}getWorldToCamera(l,m){const b=new Float64Array(16),I=new Float64Array(4),P=this.position;return s.conjugate(I,this._orientation),s.scale$2(P,P,-l),s.fromQuat(b,I),s.translate(b,b,P),b[1]*=-1,b[5]*=-1,b[9]*=-1,b[13]*=-1,b[8]*=m,b[9]*=m,b[10]*=m,b[11]*=m,b}getCameraToClipPerspective(l,m,b,I){const P=new Float64Array(16);return s.perspective(P,l,m,b,I),P}getDistanceToElevation(l,m=!1){const b=l===0?0:s.mercatorZfromAltitude(l,m?s.latFromMercatorY(this.position[1]):this.position[1]),I=this.forward();return(b-this.position[2])/I[2]}clone(){return new Ya([...this.position],[...this.orientation])}}function ba(x,l){const m=Wu(x.projection,x.zoom,x.width,x.height),b=(function(P,j,W,Z,le){const ce=new s.LngLat(W.lng-180*Ka,W.lat),Ee=new s.LngLat(W.lng+180*Ka,W.lat),Fe=P.project(ce.lng,ce.lat),qe=P.project(Ee.lng,Ee.lat),at=-Math.atan2(qe.y-Fe.y,qe.x-Fe.x),et=s.MercatorCoordinate.fromLngLat(W);et.y=s.clamp(et.y,-1+Ka,1-Ka);const lt=et.toLngLat(),Ie=P.project(lt.lng,lt.lat),rt=s.MercatorCoordinate.fromLngLat(lt);rt.x+=Ka;const gt=rt.toLngLat(),yt=P.project(gt.lng,gt.lat),Mt=ac(yt.x-Ie.x,yt.y-Ie.y,at),Dt=s.MercatorCoordinate.fromLngLat(lt);Dt.y+=Ka;const Nt=Dt.toLngLat(),qt=P.project(Nt.lng,Nt.lat),Bt=ac(qt.x-Ie.x,qt.y-Ie.y,at),rn=Math.abs(Mt.x)/Math.abs(Bt.y),Rn=s.identity([]);s.rotateZ(Rn,Rn,-at*(1-(le?0:Z)));const Jt=s.identity([]);return s.scale(Jt,Jt,[1,1-(1-rn)*Z,1]),Jt[4]=-Bt.x/Bt.y*Z,s.rotateZ(Jt,Jt,at),s.multiply(Jt,Rn,Jt),Jt})(x.projection,0,x.center,m,l),I=jl(x);return s.scale(b,b,[I,I,1]),b}function jl(x){const l=x.projection,m=Wu(x.projection,x.zoom,x.width,x.height),b=kh(l,x.center),I=kh(l,s.LngLat.convert(l.center));return Math.pow(2,b*m+(1-m)*I)}function Wu(x,l,m,b,I=1/0){const P=x.range;if(!P)return 0;const j=Math.min(I,Math.max(m,b)),W=Math.log(j/1024)/Math.LN2;return s.smoothstep(P[0]+W,P[1]+W,l)}const Ka=1/4e4;function kh(x,l){const m=s.clamp(l.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),b=new s.LngLat(l.lng-180*Ka,m),I=new s.LngLat(l.lng+180*Ka,m),P=x.project(b.lng,m),j=x.project(I.lng,m),W=s.MercatorCoordinate.fromLngLat(b),Z=s.MercatorCoordinate.fromLngLat(I),le=j.x-P.x,ce=j.y-P.y,Ee=Z.x-W.x,Fe=Z.y-W.y,qe=Math.sqrt((Ee*Ee+Fe*Fe)/(le*le+ce*ce));return Math.log(qe)/Math.LN2}function ac(x,l,m){const b=Math.cos(m),I=Math.sin(m);return{x:x*b-l*I,y:x*I+l*b}}class Dr{constructor(l,m,b,I,P,j,W){this.tileSize=512,this._renderWorldCopies=P===void 0||P,this._minZoom=l||0,this._maxZoom=m||22,this._minPitch=b??0,this._maxPitch=I??60,this.setProjection(j),this.setMaxBounds(W),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new _c,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Ya,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const l=new Dr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(l,m=!1){const b=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||b)&&this._updateCameraOnTerrain(),(l||b)&&this._constrainCamera(m),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const m=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const b=!T(m,this.getProjection());return b&&this._calcMatrices(),this.mercatorFromTransition=!1,b}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const m=l!==this.projection.name;return m&&this._calcMatrices(),m}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.Point(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const m=-l*Math.PI/180;var b;this.angle!==m&&(this._unmodified=!1,this.angle=m,this._calcMatrices(),this.rotationMatrix=(b=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(b[1]=0,b[2]=0),b[0]=1,b[3]=1,b),(function(I,P,j){var W=P[0],Z=P[1],le=P[2],ce=P[3],Ee=Math.sin(j),Fe=Math.cos(j);I[0]=W*Fe+le*Ee,I[1]=Z*Fe+ce*Ee,I[2]=W*-Ee+le*Fe,I[3]=Z*-Ee+ce*Fe})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const m=s.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==m&&(this._unmodified=!1,this._pitch=m,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=s.degToRad(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const m=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==m&&(this._unmodified=!1,this._setZoom(m),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const l=this._elevation;this._centerAltitude=l.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=l.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,m=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],b=this.horizonLineFromTop();let I=0,P=0;for(let j=0;j<m.length;j++){const W=new s.Point(m[j][0]*this.width,b+m[j][1]*(this.height-b)),Z=l.pointCoordinate(W);if(!Z)continue;const le=1/Math.hypot(Z[0]-this._camera.position[0],Z[1]-this._camera.position[1]);I+=Z[3]*le,P+=le}return P===0?NaN:I/P}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const l=this._seaLevelZoom,m=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),b=this.pixelsPerMeter/this.worldSize*m,I=this._mercatorZfromZoom(l),P=this._mercatorZfromZoom(this._maxZoom),j=Math.max(I-b,P);this._setZoom(this._zoomFromMercatorZ(j))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const m=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let b;b=l.z<this._camera.position[2]?[m.x,m.y,m.z]:[l.x,l.y,l.z];const I=s.length(s.sub([],this._camera.position,b));return s.clamp(this._zoomFromMercatorZ(I),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let m=!1;if(l.orientation&&!s.exactEquals(l.orientation,this._camera.orientation)&&(m=this._setCameraOrientation(l.orientation)),l.position){const b=[l.position.x,l.position.y,l.position.z];s.exactEquals$1(b,this._camera.position)||(this._setCameraPosition(b),m=!0)}m&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,m=new Xa;return m.position=new s.MercatorCoordinate(l[0],l[1],l[2]),m.orientation=this._camera.orientation,m._elevation=this.elevation,m._renderWorldCopies=this.renderWorldCopies,m}_setCameraOrientation(l){if(!s.length$1(l))return!1;s.normalize$1(l,l);const m=s.transformQuat([],[0,0,-1],l),b=s.transformQuat([],[0,-1,0],l);if(b[2]<0)return!1;const I=oc(m,b);return!!I&&(this._camera.orientation=I,!0)}_setCameraPosition(l){const m=this.zoomScale(this.minZoom)*this.tileSize,b=this.zoomScale(this.maxZoom)*this.tileSize,I=this.cameraToCenterDistance;l[2]=s.clamp(l[2],I/b,I/m),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,m,b){this._unmodified=!1,this._edgeInsets.interpolate(l,m,b),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const m=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,m)}getVisibleUnwrappedCoordinates(l){const m=[new s.UnwrappedTileID(0,l)];if(this.renderWorldCopies){const b=this.pointCoordinate(new s.Point(0,0)),I=this.pointCoordinate(new s.Point(this.width,0)),P=this.pointCoordinate(new s.Point(this.width,this.height)),j=this.pointCoordinate(new s.Point(0,this.height)),W=Math.floor(Math.min(b.x,I.x,P.x,j.x)),Z=Math.floor(Math.max(b.x,I.x,P.x,j.x)),le=1;for(let ce=W-le;ce<=Z+le;ce++)ce!==0&&m.push(new s.UnwrappedTileID(ce,l))}return m}coveringTiles(l){let m=this.coveringZoomLevel(l);const b=m,I=this.elevation&&!l.isTerrainDEM,P=this.projection.name==="mercator";if(l.minzoom!==void 0&&m<l.minzoom)return[];l.maxzoom!==void 0&&m>l.maxzoom&&(m=l.maxzoom);const j=this.locationCoordinate(this.center),W=this.center.lat,Z=1<<m,le=[Z*j.x,Z*j.y,0],ce=this.projection.name==="globe",Ee=!ce,Fe=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m,Ee),qe=ce?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),at=Z*s.mercatorZfromAltitude(1,this.center.lat),et=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),lt=[Z*qe.x,Z*qe.y,et*(Ee?1:at)],Ie=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),rt=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?m:0,gt=l.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,yt=l.isTerrainDEM?-gt:this._elevation?this._elevation.getMinElevationBelowMSL():0,Mt=this.projection.isReprojectedInTileSpace?jl(this):1,Dt=tn=>{const Un=new s.MercatorCoordinate(tn.x+25e-6,tn.y,tn.z),In=new s.MercatorCoordinate(tn.x,tn.y+25e-6,tn.z),Wn=tn.toLngLat(),Nr=Un.toLngLat(),ei=In.toLngLat(),Er=this.locationCoordinate(Wn),gr=this.locationCoordinate(Nr),Ai=this.locationCoordinate(ei),Mi=Math.hypot(gr.x-Er.x,gr.y-Er.y),Vr=Math.hypot(Ai.x-Er.x,Ai.y-Er.y);return Math.sqrt(Mi*Vr)*Mt/25e-6},Nt=tn=>{const bn=gt,Un=yt;return{aabb:s.tileAABB(this,Z,0,0,0,tn,Un,bn,this.projection),zoom:0,x:0,y:0,minZ:Un,maxZ:bn,wrap:tn,fullyVisible:!1}},qt=[];let Bt=[];const rn=m,Rn=l.reparseOverscaled?b:m,Jt=tn=>tn*tn,An=Jt((et-this._centerAltitude)*at),cn=tn=>{if(!this._elevation||!tn.tileID||!P)return;const bn=this._elevation.getMinMaxForTile(tn.tileID),Un=tn.aabb;bn?(Un.min[2]=bn.min,Un.max[2]=bn.max,Un.center[2]=(Un.min[2]+Un.max[2])/2):(tn.shouldSplit=Vn(tn),tn.shouldSplit||(Un.min[2]=Un.max[2]=Un.center[2]=this._centerAltitude))},Vn=tn=>{if(tn.zoom<rt)return!0;if(tn.zoom===rn)return!1;if(tn.shouldSplit!=null)return tn.shouldSplit;const bn=tn.aabb.distanceX(lt),Un=tn.aabb.distanceY(lt);let In=An,Wn=1;if(ce){In=Jt(tn.aabb.distanceZ(lt));const Er=Math.pow(2,tn.zoom),gr=s.latFromMercatorY((tn.y+1)/Er),Ai=s.latFromMercatorY(tn.y/Er),Mi=Math.min(Math.max(W,gr),Ai),Vr=s.circumferenceAtLatitude(Mi)/s.circumferenceAtLatitude(W);if(Wn=Mi===W?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Vr/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&tn.zoom===rn-1&&Vr>=.9)return!0}else if(I&&(In=Jt(tn.aabb.distanceZ(lt)*at)),this.projection.isReprojectedInTileSpace&&b<=5){const Er=Math.pow(2,tn.zoom),gr=Dt(new s.MercatorCoordinate((tn.x+.5)/Er,(tn.y+.5)/Er));Wn=gr>.85?1:gr}const Nr=bn*bn+Un*Un+In,ei=Jt((1<<rn-tn.zoom)*Ie*Wn*((Er,gr)=>{if(gr*Jt(.707)<Er)return 1;const Ai=Math.sqrt(gr/Er);return Ai/(1.4144271570014144+(Math.pow(1.1,Ai-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(In,An),Nr));return Nr<ei};if(this.renderWorldCopies)for(let tn=1;tn<=3;tn++)qt.push(Nt(-tn)),qt.push(Nt(tn));for(qt.push(Nt(0));qt.length>0;){const tn=qt.pop(),bn=tn.x,Un=tn.y;let In=tn.fullyVisible;if(!In){const Wn=tn.aabb.intersects(Fe);if(Wn===0)continue;In=Wn===2}if(tn.zoom!==rn&&Vn(tn))for(let Wn=0;Wn<4;Wn++){const Nr=(bn<<1)+Wn%2,ei=(Un<<1)+(Wn>>1),Er={aabb:P?tn.aabb.quadrant(Wn):s.tileAABB(this,Z,tn.zoom+1,Nr,ei,tn.wrap,tn.minZ,tn.maxZ,this.projection),zoom:tn.zoom+1,x:Nr,y:ei,wrap:tn.wrap,fullyVisible:In,tileID:void 0,shouldSplit:void 0,minZ:tn.minZ,maxZ:tn.maxZ};I&&!ce&&(Er.tileID=new s.OverscaledTileID(tn.zoom+1===rn?Rn:tn.zoom+1,tn.wrap,tn.zoom+1,Nr,ei),cn(Er)),qt.push(Er)}else{const Wn=tn.zoom===rn?Rn:tn.zoom;if(l.minzoom&&l.minzoom>Wn)continue;const Nr=le[0]-(.5+bn+(tn.wrap<<tn.zoom))*(1<<m-tn.zoom),ei=le[1]-.5-Un,Er=tn.tileID?tn.tileID:new s.OverscaledTileID(Wn,tn.wrap,tn.zoom,bn,Un);Bt.push({tileID:Er,distanceSq:Nr*Nr+ei*ei})}}if(this.fogCullDistSq){const tn=this.fogCullDistSq,bn=this.horizonLineFromTop();Bt=Bt.filter((Un=>{const In=[0,0,0,1],Wn=[s.EXTENT,s.EXTENT,0,1],Nr=this.calculateFogTileMatrix(Un.tileID.toUnwrapped());s.transformMat4$1(In,In,Nr),s.transformMat4$1(Wn,Wn,Nr);const ei=s.getAABBPointSquareDist(In,Wn);if(ei===0)return!0;let Er=!1;const gr=this._elevation;if(gr&&ei>tn&&bn!==0){const Ai=this.calculateProjMatrix(Un.tileID.toUnwrapped());let Mi;l.isTerrainDEM||(Mi=gr.getMinMaxForTile(Un.tileID)),Mi||(Mi={min:yt,max:gt});const Vr=s.furthestTileCorner(this.rotation),Yi=[Vr[0]*s.EXTENT,Vr[1]*s.EXTENT,Mi.max];s.transformMat4(Yi,Yi,Ai),Er=(1-Yi[1])*this.height*.5<bn}return ei<tn||Er}))}return Bt.sort(((tn,bn)=>tn.distanceSq-bn.distanceSq)).map((tn=>tn.tileID))}resize(l,m){this.width=l,this.height=m,this.pixelsToGLUnits=[2/l,-2/m],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const m=s.clamp(l.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),b=this.projection.project(l.lng,m);return new s.Point(b.x*this.worldSize,b.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,m){let b,I;const P=this.centerPoint;if(this.projection.name==="globe"){const W=this.worldSize;b=(m.x-P.x)/W,I=(m.y-P.y)/W}else{const W=this.pointCoordinate(m),Z=this.pointCoordinate(P);b=W.x-Z.x,I=W.y-Z.y}const j=this.locationCoordinate(l);this.setLocation(new s.MercatorCoordinate(j.x-b,j.y-I))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,m){const b=m?s.mercatorZfromAltitude(m,l.lat):void 0,I=this.projection.project(l.lng,l.lat);return new s.MercatorCoordinate(I.x,I.y,b)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,m){const b=m??this._centerAltitude,I=[l.x,l.y,0,1],P=[l.x,l.y,1,1];s.transformMat4$1(I,I,this.pixelMatrixInverse),s.transformMat4$1(P,P,this.pixelMatrixInverse);const j=P[3];s.scale$1(I,I,1/I[3]),s.scale$1(P,P,1/j);const W=I[2],Z=P[2];return{p0:I,p1:P,t:W===Z?0:(b-W)/(Z-W)}}screenPointToMercatorRay(l){const m=[l.x,l.y,0,1],b=[l.x,l.y,1,1];return s.transformMat4$1(m,m,this.pixelMatrixInverse),s.transformMat4$1(b,b,this.pixelMatrixInverse),s.scale$1(m,m,1/m[3]),s.scale$1(b,b,1/b[3]),m[2]=s.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,b[2]=s.mercatorZfromAltitude(b[2],this._center.lat)*this.worldSize,s.scale$1(m,m,1/this.worldSize),s.scale$1(b,b,1/this.worldSize),new s.Ray([m[0],m[1],m[2]],s.normalize([],s.sub([],b,m)))}rayIntersectionCoordinate(l){const{p0:m,p1:b,t:I}=l,P=s.mercatorZfromAltitude(m[2],this._center.lat),j=s.mercatorZfromAltitude(b[2],this._center.lat);return new s.MercatorCoordinate(s.number(m[0],b[0],I)/this.worldSize,s.number(m[1],b[1],I)/this.worldSize,s.number(P,j,I))}pointCoordinate(l,m=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,m)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let m=this.projection.pointCoordinate3D(this,l.x,l.y);if(m)return new s.MercatorCoordinate(m[0],m[1],m[2]);let b=0,I=this.horizonLineFromTop();if(l.y>I)return this.pointCoordinate(l);const P=.02*I,j=l.clone();for(let W=0;W<10&&I-b>P;W++){j.y=s.number(b,I,.66);const Z=this.projection.pointCoordinate3D(this,j.x,j.y);Z?(I=j.y,m=Z):b=j.y}return m?new s.MercatorCoordinate(m[0],m[1],m[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(l);const m=this.pointCoordinate(l);return m.y>=0&&m.y<=1}_coordinatePoint(l,m){const b=m&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,I=[l.x*this.worldSize,l.y*this.worldSize,b+l.toAltitude(),1];return s.transformMat4$1(I,I,this.pixelMatrix),I[3]>0?new s.Point(I[0]/I[3],I[1]/I[3]):new s.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:m}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,P=this.pointLocation3D(new s.Point(m,l)),j=this.pointLocation3D(new s.Point(I,l)),W=this.pointLocation3D(new s.Point(I,b)),Z=this.pointLocation3D(new s.Point(m,b));let le=Math.min(P.lng,j.lng,W.lng,Z.lng),ce=Math.max(P.lng,j.lng,W.lng,Z.lng),Ee=Math.min(P.lat,j.lat,W.lat,Z.lat),Fe=Math.max(P.lat,j.lat,W.lat,Z.lat);const qe=Math.pow(2,-this.zoom)/16*270,at=this.projection.name==="globe"?1:4,et=(lt,Ie,rt,gt,yt)=>{const Mt=(lt+rt)/2,Dt=(Ie+gt)/2,Nt=new s.Point(Mt,Dt),{lng:qt,lat:Bt}=this.pointLocation3D(Nt),rn=Math.max(0,le-qt,Ee-Bt,qt-ce,Bt-Fe);le=Math.min(le,qt),ce=Math.max(ce,qt),Ee=Math.min(Ee,Bt),Fe=Math.max(Fe,Bt),(yt<at||rn>qe)&&(et(lt,Ie,Mt,Dt,yt+1),et(Mt,Dt,rt,gt,yt+1))};if(et(m,l,I,l,1),et(I,l,I,b,1),et(I,b,m,b,1),et(m,b,m,l,1),this.projection.name==="globe"){const[lt,Ie]=s.polesInViewport(this);lt?(Fe=90,ce=180,le=-180):Ie&&(Ee=-90,ce=180,le=-180)}return new s.LngLatBounds(new s.LngLat(le,Ee),new s.LngLat(ce,Fe))}_getBoundsRectangular(l,m){const{top:b,left:I}=this._edgeInsets,P=this.height-this._edgeInsets.bottom,j=this.width-this._edgeInsets.right,W=new s.Point(I,b),Z=new s.Point(j,b),le=new s.Point(j,P),ce=new s.Point(I,P);let Ee=this.pointCoordinate(W,l),Fe=this.pointCoordinate(Z,l);const qe=this.pointCoordinate(le,m),at=this.pointCoordinate(ce,m),et=(lt,Ie)=>(Ie.y-lt.y)/(Ie.x-lt.x);return Ee.y>1&&Fe.y>=0?Ee=new s.MercatorCoordinate((1-at.y)/et(at,Ee)+at.x,1):Ee.y<0&&Fe.y<=1&&(Ee=new s.MercatorCoordinate(-at.y/et(at,Ee)+at.x,0)),Fe.y>1&&Ee.y>=0?Fe=new s.MercatorCoordinate((1-qe.y)/et(qe,Fe)+qe.x,1):Fe.y<0&&Ee.y<=1&&(Fe=new s.MercatorCoordinate(-qe.y/et(qe,Fe)+qe.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(Ee)).extend(this.coordinateLocation(Fe)).extend(this.coordinateLocation(at)).extend(this.coordinateLocation(qe))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const m=l.visibleDemTiles.reduce(((b,I)=>{if(I.dem){const P=I.dem.tree;b.min=Math.min(b.min,P.minimums[0]),b.max=Math.max(b.max,P.maximums[0])}return b}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(m.min*l.exaggeration(),m.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const m=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,b=this.height/2-m*(1-this._horizonShift);return l?Math.max(0,b):b}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,m){return this.projection.createTileMatrix(this,m,l)}calculateDistanceTileData(l){const m=l.key,b=this._distanceTileDataCache;if(b[m])return b[m];const I=l.canonical,P=1/this.height,j=this.cameraWorldSize,W=j/this.zoomScale(I.z),Z=(I.x+Math.pow(2,I.z)*l.wrap)*W,le=I.y*W,ce=this.point;ce.x*=j/this.worldSize,ce.y*=j/this.worldSize;const Ee=this.angle,Fe=Math.sin(-Ee),qe=-Math.cos(-Ee);return b[m]={bearing:[Fe,qe],center:[(ce.x-Z)*P,(ce.y-le)*P],scale:W/s.EXTENT*P},b[m]}calculateFogTileMatrix(l){const m=l.key,b=this._fogTileMatrixCache;if(b[m])return b[m];const I=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return s.multiply(I,this.worldToFogMatrix,I),b[m]=new Float32Array(I),b[m]}calculateProjMatrix(l,m=!1){const b=l.key,I=m?this._alignedProjMatrixCache:this._projMatrixCache;if(I[b])return I[b];const P=this.calculatePosMatrix(l,this.worldSize);return s.multiply(P,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.alignedProjMatrix:this.projMatrix,P),I[b]=new Float32Array(P),I[b]}calculatePixelsToTileUnitsMatrix(l){const m=l.tileID.key,b=this._pixelsToTileUnitsCache;if(b[m])return b[m];const I=(function(P,j){const{scale:W}=P.tileTransform,Z=W*s.EXTENT/(P.tileSize*Math.pow(2,j.zoom-P.tileID.overscaledZ+P.tileID.canonical.z));return le=new Float32Array(4),Fe=(ce=j.inverseAdjustmentMatrix)[1],qe=ce[2],at=ce[3],lt=(Ee=[Z,Z])[1],le[0]=ce[0]*(et=Ee[0]),le[1]=Fe*et,le[2]=qe*lt,le[3]=at*lt,le;var le,ce,Ee,Fe,qe,at,et,lt})(l,this);return b[m]=I,b[m]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const l=1/this.worldSize,m=s.fromScaling([],[l,l,l]);return s.multiply(m,m,this.globeMatrix),m}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const l=this._elevation;this._updateCameraState();const m=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(m),I=this._camera.forward(),P=s.mercatorZfromAltitude(1,this._center.lat);b[2]/=P,I[2]/=P,s.normalize(I,I);const j=l.raycast(b,I,l.exaggeration());if(j){const W=s.scaleAndAdd([],b,I,j),Z=new s.MercatorCoordinate(W[0],W[1],s.mercatorZfromAltitude(W[2],s.latFromMercatorY(W[1]))),le=(Z.z+s.length([Z.x-b[0],Z.y-b[1],Z.z-b[2]*P]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(le),this._centerAltitude=Z.toAltitude(),this._center=this.coordinateLocation(Z),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const m=this._elevation,b=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,I=this._computeCameraPosition(b),P=m.getAtPointOrZero(new s.MercatorCoordinate(...I)),j=this.pixelsPerMeter/this.worldSize*P,W=this._minimumHeightOverTerrain(),Z=I[2]-j;if(Z<=W)if(Z<0||l){const le=this.locationCoordinate(this._center,this._centerAltitude),ce=[I[0],I[1],le.z-I[2]],Ee=s.length(ce);ce[2]-=(W-Z)/this._pixelsPerMercatorPixel;const Fe=s.length(ce);if(Fe===0)return;s.scale$2(ce,ce,Ee/Fe*this._pixelsPerMercatorPixel),this._camera.position=[I[0],I[1],le.z*this._pixelsPerMercatorPixel-ce[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const Fe=this.center;return Fe.lat=s.clamp(Fe.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(Fe.lng=s.clamp(Fe.lng,this.minLng,this.maxLng)),this.center=Fe,void(this._constraining=!1)}const m=this._unmodified,{x:b,y:I}=this.point;let P=0,j=b,W=I;const Z=this.width/2,le=this.height/2,ce=this.worldMinY*this.scale,Ee=this.worldMaxY*this.scale;if(I-le<ce&&(W=ce+le),I+le>Ee&&(W=Ee-le),Ee-ce<this.height&&(P=Math.max(P,this.height/(Ee-ce)),W=(Ee+ce)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Fe=this.worldMinX*this.scale,qe=this.worldMaxX*this.scale,at=this.worldSize/2-(Fe+qe)/2;j=(b+at+this.worldSize)%this.worldSize-at,j-Z<Fe&&(j=Fe+Z),j+Z>qe&&(j=qe-Z),qe-Fe<this.width&&(P=Math.max(P,this.width/(qe-Fe)),j=(qe+Fe)/2)}j===b&&W===I||(this.center=this.unproject(new s.Point(j,W))),P&&(this.zoom+=this.scaleZoom(P)),this._constrainCamera(),this._unmodified=m,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,m=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const b=Wu(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const I=this.projection.zAxisUnit==="meters"?m:1,P=this._camera.getWorldToCamera(this.worldSize,I),j=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);j[8]=2*-l.x/this.width,j[9]=2*l.y/this.height;let W=s.mul([],j,P);if(this.projection.isReprojectedInTileSpace){const Dt=this.locationCoordinate(this.center),Nt=s.identity([]);s.translate(Nt,Nt,[Dt.x*this.worldSize,Dt.y*this.worldSize,0]),s.multiply(Nt,Nt,ba(this)),s.translate(Nt,Nt,[-Dt.x*this.worldSize,-Dt.y*this.worldSize,0]),s.multiply(W,W,Nt),this.inverseAdjustmentMatrix=(function(qt){const Bt=ba(qt,!0);return Y([],[Bt[0],Bt[1],Bt[4],Bt[5]])})(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],W,[this.worldSize,this.worldSize,this.worldSize/I,1]),this.projMatrix=W,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const Z=s.invert([],j);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(Z,this.horizonLineFromTop(),this.height);const le=new Float32Array(16);s.identity(le),s.scale(le,le,[1,-1,1]),s.rotateX(le,le,this._pitch),s.rotateZ(le,le,this.angle);const ce=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),Ee=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ce[8]=2*-l.x/this.width,ce[9]=2*(l.y+Ee)/this.height,this.skyboxMatrix=s.multiply(le,ce,le);const Fe=this.point,qe=Fe.x,at=Fe.y,et=this.width%2/2,lt=this.height%2/2,Ie=Math.cos(this.angle),rt=Math.sin(this.angle),gt=qe-Math.round(qe)+Ie*et+rt*lt,yt=at-Math.round(at)+Ie*lt+rt*et,Mt=new Float64Array(W);if(s.translate(Mt,Mt,[gt>.5?gt-1:gt,yt>.5?yt-1:yt,0]),this.alignedProjMatrix=Mt,W=s.create(),s.scale(W,W,[this.width/2,-this.height/2,1]),s.translate(W,W,[1,-1,0]),this.labelPlaneMatrix=W,W=s.create(),s.scale(W,W,[1,-1,1]),s.translate(W,W,[-1,-1,0]),s.scale(W,W,[2/this.width,2/this.height,1]),this.glCoordMatrix=W,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},W=s.invert(new Float64Array(16),this.pixelMatrix),!W)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=W,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const Dt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(Dt,Dt,P),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=W;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,m=this.cameraPixelsPerMeter,b=this._camera.position,I=1/this.height/this._pixelsPerMercatorPixel,P=[l,l,m];s.scale$2(P,P,I),s.scale$2(b,b,-1),s.multiply$2(b,b,P);const j=s.create();s.translate(j,j,b),s.scale(j,j,P),this.mercatorFogMatrix=j,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,m,I)}_computeCameraPosition(l){const m=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,b=this._camera.forward(),I=this.point,P=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*m-l/this.worldSize*this._centerAltitude;return[I.x/this.worldSize-b[0]*P,I.y/this.worldSize-b[1]*P,l/this.worldSize*this._centerAltitude-b[2]*P]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const m=this._maxCameraBoundsDistance()*Math.cos(this._pitch),b=this._camera.position[2],I=l[2];let P=1;this.projection.wrap&&(this.center=this.center.wrap()),I>0&&(P=Math.min((m-b)/I,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,l,P),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,m=this._camera.forward(),{pitch:b,bearing:I}=this._camera.getPitchBearing(),P=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,j=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),W=Math.max((l[2]-P)/Math.cos(b),j),Z=this._zoomFromMercatorZ(W);s.scaleAndAdd(l,l,m,W),this._pitch=s.clamp(b,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(I,-Math.PI,Math.PI),this._setZoom(s.clamp(Z,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let m=0,b=s.GLOBE_ZOOM_THRESHOLD_MAX,I=0,P=1/0;for(;b-m>1e-6&&b>m;){const j=m+.5*(b-m),W=this.tileSize*Math.pow(2,j),Z=this.getCameraToCenterDistance(this.projection,j,W),le=this.scaleZoom(Z/(l*this.tileSize)),ce=Math.abs(j-le);ce<P&&(P=ce,I=j),j<le?m=j:b=j}return I}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,m){const b=Math.min(l.x,m.x),I=Math.max(l.x,m.x),P=Math.min(l.y,m.y),j=Math.max(l.y,m.y);if(P<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const W=[new s.Point(b,P),new s.Point(I,j),new s.Point(b,j),new s.Point(I,P)],Z=this.renderWorldCopies?-3:0,le=this.renderWorldCopies?4:1;for(const ce of W){const Ee=this.pointRayIntersection(ce);if(Ee.t<0)return!0;const Fe=this.rayIntersectionCoordinate(Ee);if(Fe.x<Z||Fe.y<0||Fe.x>le||Fe.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.Point(0,0),new s.Point(this.width,this.height))}zoomDeltaToMovement(l,m){const b=s.length(s.sub([],this._camera.position,l)),I=this._zoomFromMercatorZ(b)+m;return b-this._mercatorZfromZoom(I)}getCameraPoint(){if(this.projection.name==="globe"){const l=(function([m,b,I],P){const j=[m,b,I,1];s.transformMat4$1(j,j,P);const W=j[3]=Math.max(j[3],1e-6);return j[0]/=W,j[1]/=W,j[2]/=W,j})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.Point(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,l))}}getCameraToCenterDistance(l,m=this.zoom,b=this.worldSize){const I=Wu(l,m,this.width,this.height,1024),P=l.pixelSpaceConversion(this.center.lat,b,I);return .5/Math.tan(.5*this._fov)*this.height*P}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.multiply(l,l,this.globeMatrix),l}}function Is(x,l){let m=!1,b=null;const I=()=>{b=null,m&&(x(),b=setTimeout(I,l),m=!1)};return()=>(m=!0,b||I(),b)}class Ql{constructor(l){this._hashName=l&&encodeURIComponent(l),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Is(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,s.window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const m=vc(l);if(this._hashName){const b=this._hashName;let I=!1;const P=s.window.location.hash.slice(1).split("&").map((j=>{const W=j.split("=")[0];return W===b?(I=!0,`${W}=${m}`):j})).filter((j=>j));return I||P.push(`${b}=${m}`),`#${P.join("&")}`}return`#${m}`}_getCurrentHash(){const l=s.window.location.hash.replace("#","");if(this._hashName){let m;return l.split("&").map((b=>b.split("="))).forEach((b=>{b[0]===this._hashName&&(m=b)})),(m&&m[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const m=this._getCurrentHash();if(m.length>=3&&!m.some((b=>isNaN(b)))){const b=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(m[3]||0):l.getBearing();return l.jumpTo({center:[+m[2],+m[1]],zoom:+m[0],bearing:b,pitch:+(m[4]||0)}),!0}return!1}_updateHashUnthrottled(){const l=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,l)}}function vc(x,l){const m=x.getCenter(),b=Math.round(100*x.getZoom())/100,I=Math.ceil((b*Math.LN2+Math.log(512/360/.5))/Math.LN10),P=Math.pow(10,I),j=Math.round(m.lng*P)/P,W=Math.round(m.lat*P)/P,Z=x.getBearing(),le=x.getPitch();let ce=l?`/${j}/${W}/${b}`:`${b}/${W}/${j}`;return(Z||le)&&(ce+="/"+Math.round(10*Z)/10),le&&(ce+=`/${Math.round(le)}`),ce}const Mu={linearity:.3,easing:s.bezier(0,0,.3,1)},xc=s.extend({deceleration:2500,maxSpeed:1400},Mu),bc=s.extend({deceleration:20,maxSpeed:1400},Mu),jn=s.extend({deceleration:1e3,maxSpeed:360},Mu),pa=s.extend({deceleration:1e3,maxSpeed:90},Mu);class Co{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,m=s.exported.now();for(;l.length>0&&m-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const m={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:P}of this._inertiaBuffer)m.zoom+=P.zoomDelta||0,m.bearing+=P.bearingDelta||0,m.pitch+=P.pitchDelta||0,P.panDelta&&m.pan._add(P.panDelta),P.around&&(m.around=P.around),P.pinchAround&&(m.pinchAround=P.pinchAround);const b=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,I={};if(m.pan.mag()){const P=hl(m.pan.mag(),b,s.extend({},xc,l||{}));I.offset=m.pan.mult(P.amount/m.pan.mag()),I.center=this._map.transform.center,uu(I,P)}if(m.zoom){const P=hl(m.zoom,b,bc);I.zoom=this._map.transform.zoom+P.amount,uu(I,P)}if(m.bearing){const P=hl(m.bearing,b,jn);I.bearing=this._map.transform.bearing+s.clamp(P.amount,-179,179),uu(I,P)}if(m.pitch){const P=hl(m.pitch,b,pa);I.pitch=this._map.transform.pitch+P.amount,uu(I,P)}if(I.zoom||I.bearing){const P=m.pinchAround===void 0?m.around:m.pinchAround;I.around=P?this._map.unproject(P):this._map.getCenter()}return this.clear(),I.noMoveStart=!0,I}}function uu(x,l){(!x.duration||x.duration<l.duration)&&(x.duration=l.duration,x.easing=l.easing)}function hl(x,l,m){const{maxSpeed:b,linearity:I,deceleration:P}=m,j=s.clamp(x*I/(l/1e3),-b,b),W=Math.abs(j)/(P*I);return{easing:m.easing,duration:1e3*W,amount:j*(W/2)}}class Ji extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,m,b,I={}){const P=Be(m.getCanvasContainer(),b),j=m.unproject(P);super(l,s.extend({point:P,lngLat:j,originalEvent:b},I)),this._defaultPrevented=!1,this.target=m}}class Za extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,m,b){const I=l==="touchend"?b.changedTouches:b.touches,P=_e(m.getCanvasContainer(),I),j=P.map((Z=>m.unproject(Z))),W=P.reduce(((Z,le,ce,Ee)=>Z.add(le.div(Ee.length))),new s.Point(0,0));super(l,{points:P,point:W,lngLats:j,lngLat:m.unproject(W),originalEvent:b}),this._defaultPrevented=!1}}class qh extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,m,b){super(l,{originalEvent:b}),this._defaultPrevented=!1}}class Lh{constructor(l,m){this._map=l,this._clickTolerance=m.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new qh(l.type,this._map,l))}mousedown(l,m){return this._mousedownPos=m,this._firePreventable(new Ji(l.type,this._map,l))}mouseup(l){this._map.fire(new Ji(l.type,this._map,l))}preclick(l){const m=s.extend({},l);m.type="preclick",this._map.fire(new Ji(m.type,this._map,m))}click(l,m){this._mousedownPos&&this._mousedownPos.dist(m)>=this._clickTolerance||(this.preclick(l),this._map.fire(new Ji(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new Ji(l.type,this._map,l))}mouseover(l){this._map.fire(new Ji(l.type,this._map,l))}mouseout(l){this._map.fire(new Ji(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Za(l.type,this._map,l))}touchmove(l){this._map.fire(new Za(l.type,this._map,l))}touchend(l){this._map.fire(new Za(l.type,this._map,l))}touchcancel(l){this._map.fire(new Za(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Si{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new Ji(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ji("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Ji(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Mc{constructor(l,m){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=m.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,m){this.isEnabled()&&l.shiftKey&&l.button===0&&(oe(),this._startPos=this._lastPos=m,this._active=!0)}mousemoveWindow(l,m){if(!this._active)return;const b=m,I=this._startPos,P=this._lastPos;if(!I||!P||P.equals(b)||!this._box&&b.dist(I)<this._clickTolerance)return;this._lastPos=b,this._box||(this._box=M("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const j=Math.min(I.x,b.x),W=Math.max(I.x,b.x),Z=Math.min(I.y,b.y),le=Math.max(I.y,b.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${j}px,${Z}px)`,this._box.style.width=W-j+"px",this._box.style.height=le-Z+"px")}))}mouseupWindow(l,m){if(!this._active)return;const b=this._startPos,I=m;if(b&&l.button===0){if(this.reset(),Pe(),b.x!==I.x||b.y!==I.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:P=>P.fitScreenCoordinates(b,I,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ve(),delete this._startPos,delete this._lastPos}_fireEvent(l,m){return this._map.fire(new s.Event(l,{originalEvent:m}))}}function Gh(x,l){const m={};for(let b=0;b<x.length;b++)m[x[b].identifier]=l[b];return m}class Da{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,m,b){(this.centroid||b.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),b.length===this.numTouches&&(this.centroid=(function(I){const P=new s.Point(0,0);for(const j of I)P._add(j);return P.div(I.length)})(m),this.touches=Gh(b,m)))}touchmove(l,m,b){if(this.aborted||!this.centroid)return;const I=Gh(b,m);for(const P in this.touches){const j=I[P];(!j||j.dist(this.touches[P])>30)&&(this.aborted=!0)}}touchend(l,m,b){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),b.length===0){const I=!this.aborted&&this.centroid;if(this.reset(),I)return I}}}class Ul{constructor(l){this.singleTap=new Da(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,m,b){this.singleTap.touchstart(l,m,b)}touchmove(l,m,b){this.singleTap.touchmove(l,m,b)}touchend(l,m,b){const I=this.singleTap.touchend(l,m,b);if(I){const P=l.timeStamp-this.lastTime<500,j=!this.lastTap||this.lastTap.dist(I)<30;if(P&&j||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=I,this.count===this.numTaps)return this.reset(),I}}}class $h{constructor(){this._zoomIn=new Ul({numTouches:1,numTaps:2}),this._zoomOut=new Ul({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,m,b){this._zoomIn.touchstart(l,m,b),this._zoomOut.touchstart(l,m,b)}touchmove(l,m,b){this._zoomIn.touchmove(l,m,b),this._zoomOut.touchmove(l,m,b)}touchend(l,m,b){const I=this._zoomIn.touchend(l,m,b),P=this._zoomOut.touchend(l,m,b);return I?(this._active=!0,l.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:j.getZoom()+1,around:j.unproject(I)},{originalEvent:l})}):P?(this._active=!0,l.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:j.getZoom()-1,around:j.unproject(P)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const lc={0:1,2:2};class Hc{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,m){return!1}_move(l,m){return{}}mousedown(l,m){if(this._lastPoint)return;const b=G(l);this._correctButton(l,b)&&(this._lastPoint=m,this._eventButton=b)}mousemoveWindow(l,m){const b=this._lastPoint;if(b){if(l.preventDefault(),this._eventButton!=null&&(function(I,P){const j=lc[P];return I.buttons===void 0||(I.buttons&j)!==j})(l,this._eventButton))this.reset();else if(this._moved||!(m.dist(b)<this._clickTolerance))return this._moved=!0,this._lastPoint=m,this._move(b,m)}}mouseupWindow(l){this._lastPoint&&G(l)===this._eventButton&&(this._moved&&Pe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Af extends Hc{mousedown(l,m){super.mousedown(l,m),this._lastPoint&&(this._active=!0)}_correctButton(l,m){return m===0&&!l.ctrlKey}_move(l,m){return{around:m,panDelta:m.sub(l)}}}class Il extends Hc{_correctButton(l,m){return m===0&&l.ctrlKey||m===2}_move(l,m){const b=.8*(m.x-l.x);if(b)return this._active=!0,{bearingDelta:b}}contextmenu(l){l.preventDefault()}}class as extends Hc{_correctButton(l,m){return m===0&&l.ctrlKey||m===2}_move(l,m){const b=-.5*(m.y-l.y);if(b)return this._active=!0,{pitchDelta:b}}contextmenu(l){l.preventDefault()}}class Ja{constructor(l,m){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=m.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)}touchstart(l,m,b){return this._calculateTransform(l,m,b)}touchmove(l,m,b){if(this._active&&!(b.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(b.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,m,b)}}touchend(l,m,b){this._calculateTransform(l,m,b),this._active&&b.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,m,b){b.length>0&&(this._active=!0);const I=Gh(b,m),P=new s.Point(0,0),j=new s.Point(0,0);let W=0;for(const le in I){const ce=I[le],Ee=this._touches[le];Ee&&(P._add(ce),j._add(ce.sub(Ee)),W++,I[le]=ce)}if(this._touches=I,W<this._minTouches||!j.mag())return;const Z=j.div(W);return this._sum._add(Z),this._sum.mag()<this._clickTolerance?void 0:{around:P.div(W),panDelta:Z}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=M("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")}),500)}}class Cl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,m,b){return{}}touchstart(l,m,b){this._firstTwoTouches||b.length<2||(this._firstTwoTouches=[b[0].identifier,b[1].identifier],this._start([m[0],m[1]]))}touchmove(l,m,b){const I=this._firstTwoTouches;if(!I)return;l.preventDefault();const[P,j]=I,W=wc(b,m,P),Z=wc(b,m,j);if(!W||!Z)return;const le=this._aroundCenter?null:W.add(Z).div(2);return this._move([W,Z],le,l)}touchend(l,m,b){if(!this._firstTwoTouches)return;const[I,P]=this._firstTwoTouches,j=wc(b,m,I),W=wc(b,m,P);j&&W||(this._active&&Pe(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function wc(x,l,m){for(let b=0;b<x.length;b++)if(x[b].identifier===m)return l[b]}function Cs(x,l){return Math.log(x/l)/Math.LN2}class cu extends Cl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,m){const b=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Cs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Cs(this._distance,b),pinchAround:m}}}function Hh(x,l){return 180*x.angleWith(l)/Math.PI}class _d extends Cl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,m){const b=this._vector;if(this._vector=l[0].sub(l[1]),b&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Hh(this._vector,b),pinchAround:m}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const m=25/(Math.PI*this._minDiameter)*360,b=this._startVector;if(!b)return!1;const I=Hh(l,b);return Math.abs(I)<m}}function Vl(x){return Math.abs(x.y)>Math.abs(x.x)}class yl extends Cl{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,Vl(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,m,b){const I=this._lastPoints;if(!I)return;const P=l[0].sub(I[0]),j=l[1].sub(I[1]);return this._map._cooperativeGestures&&!s.isFullscreen()&&b.touches.length<3||(this._valid=this.gestureBeginsVertically(P,j,b.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(P.y+j.y)/2*-.5})}gestureBeginsVertically(l,m,b){if(this._valid!==void 0)return this._valid;const I=l.mag()>=2,P=m.mag()>=2;if(!I&&!P)return;if(!I||!P)return this._firstMove==null&&(this._firstMove=b),b-this._firstMove<100&&void 0;const j=l.y>0==m.y>0;return Vl(l)&&Vl(m)&&j}}const Xu={panStep:100,bearingStep:15,pitchStep:10};class cf{constructor(){const l=Xu;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let m=0,b=0,I=0,P=0,j=0;switch(l.keyCode){case 61:case 107:case 171:case 187:m=1;break;case 189:case 109:case 173:m=-1;break;case 37:l.shiftKey?b=-1:(l.preventDefault(),P=-1);break;case 39:l.shiftKey?b=1:(l.preventDefault(),P=1);break;case 38:l.shiftKey?I=1:(l.preventDefault(),j=-1);break;case 40:l.shiftKey?I=-1:(l.preventDefault(),j=1);break;default:return}return this._rotationDisabled&&(b=0,I=0),{cameraAnimation:W=>{const Z=W.getZoom();W.easeTo({duration:300,easeId:"keyboardHandler",easing:Ph,zoom:m?Math.round(Z)+m*(l.shiftKey?2:1):Z,bearing:W.getBearing()+b*this._bearingStep,pitch:W.getPitch()+I*this._pitchStep,offset:[-P*this._panStep,-j*this._panStep],center:W.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ph(x){return x*(2-x)}const kl=4.000244140625;class Du{constructor(l,m){this._map=l,this._el=l.getCanvasContainer(),this._handler=m,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let m=l.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const b=s.exported.now(),I=b-(this._lastWheelEventTime||0);this._lastWheelEventTime=b,m!==0&&m%kl==0?this._type="wheel":m!==0&&Math.abs(m)<4?this._type="trackpad":I>400?(this._type=null,this._lastValue=m,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(I*m)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,m+=this._lastValue)),l.shiftKey&&m&&(m/=4),this._type&&(this._lastWheelEvent=l,this._delta-=m,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const m=Be(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:m,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const m=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){const Z=this._type==="wheel"&&Math.abs(this._delta)>kl?this._wheelZoomRate:this._defaultZoomRate;let le=2/(1+Math.exp(-Math.abs(this._delta*Z)));this._delta<0&&le!==0&&(le=1/le);const ce=m(),Ee=Math.pow(2,ce),Fe=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):Ee;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(Fe*le))),this._type==="wheel"&&(this._startZoom=ce,this._easing=this._smoothOutEasing(200)),this._delta=0}const b=typeof this._targetZoom=="number"?this._targetZoom:m(),I=this._startZoom,P=this._easing;let j,W=!1;if(this._type==="wheel"&&I&&P){const Z=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),le=P(Z);j=s.number(I,b,le),Z<1?this._frameId||(this._frameId=!0):W=!0}else j=b,W=!0;return this._active=!0,W&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!W,zoomDelta:j-m(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let m=s.ease;if(this._prevEase){const b=this._prevEase,I=(s.exported.now()-b.start)/b.duration,P=b.easing(I+.01)-b.easing(I),j=.27/Math.sqrt(P*P+1e-4)*.01,W=Math.sqrt(.0729-j*j);m=s.bezier(j,W,.25,1)}return this._prevEase={start:s.exported.now(),duration:l,easing:m},m}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=M("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")}),200)}}class So{constructor(l,m){this._clickZoom=l,this._tapZoom=m}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fs{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,m){return l.preventDefault(),{cameraAnimation:b=>{b.easeTo({duration:300,zoom:b.getZoom()+(l.shiftKey?-1:1),around:b.unproject(m)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ou{constructor(){this._tap=new Ul({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,m,b){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?b.length>0&&(this._swipePoint=m[0],this._swipeTouch=b[0].identifier):this._tap.touchstart(l,m,b))}touchmove(l,m,b){if(this._tapTime){if(this._swipePoint){if(b[0].identifier!==this._swipeTouch)return;const I=m[0],P=I.y-this._swipePoint.y;return this._swipePoint=I,l.preventDefault(),this._active=!0,{zoomDelta:P/128}}}else this._tap.touchmove(l,m,b)}touchend(l,m,b){this._tapTime?this._swipePoint&&b.length===0&&this.reset():this._tap.touchend(l,m,b)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ql{constructor(l,m,b){this._el=l,this._mousePan=m,this._touchPan=b}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vu{constructor(l,m,b){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=m,this._mousePitch=b}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class uh{constructor(l,m,b,I){this._el=l,this._touchZoom=m,this._touchRotate=b,this._tapDragZoom=I,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const _l=x=>x.zoom||x.drag||x.pitch||x.rotate;class vl extends s.Event{}class hf{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,m){const b=s.sub([],m,l);this.radius=s.length(b[2]<0?s.div([],b,this.constants):[b[0],b[1],0])}projectRay(l){s.div(l,l,this.constants),s.normalize(l,l),s.mul$1(l,l,this.constants);const m=s.scale$2([],l,this.radius);if(m[2]>0){const b=s.scale$2([],[0,0,1],s.dot(m,[0,0,1])),I=s.scale$2([],s.normalize([],[m[0],m[1],0]),this.radius),P=s.add([],m,s.scale$2([],s.sub([],s.add([],I,b),m),2));m[0]=P[0],m[1]=P[1]}return m}}function Fu(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta}class xu{constructor(l,m){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Co(l),this._bearingSnap=m.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new hf,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(m),s.bindAll(["handleEvent","handleWindowEvent"],this);const b=this._el;this._listeners=[[b,"touchstart",{passive:!0}],[b,"touchmove",{passive:!1}],[b,"touchend",void 0],[b,"touchcancel",void 0],[b,"mousedown",void 0],[b,"mousemove",void 0],[b,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[b,"mouseover",void 0],[b,"mouseout",void 0],[b,"dblclick",void 0],[b,"click",void 0],[b,"keydown",{capture:!1}],[b,"keyup",void 0],[b,"wheel",{passive:!1}],[b,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[I,P,j]of this._listeners)I.addEventListener(P,I===s.window.document?this.handleWindowEvent:this.handleEvent,j)}destroy(){for(const[l,m,b]of this._listeners)l.removeEventListener(m,l===s.window.document?this.handleWindowEvent:this.handleEvent,b)}_addDefaultHandlers(l){const m=this._map,b=m.getCanvasContainer();this._add("mapEvent",new Lh(m,l));const I=m.boxZoom=new Mc(m,l);this._add("boxZoom",I);const P=new $h,j=new fs;m.doubleClickZoom=new So(j,P),this._add("tapZoom",P),this._add("clickZoom",j);const W=new Ou;this._add("tapDragZoom",W);const Z=m.touchPitch=new yl(m);this._add("touchPitch",Z);const le=new Il(l),ce=new as(l);m.dragRotate=new vu(l,le,ce),this._add("mouseRotate",le,["mousePitch"]),this._add("mousePitch",ce,["mouseRotate"]);const Ee=new Af(l),Fe=new Ja(m,l);m.dragPan=new ql(b,Ee,Fe),this._add("mousePan",Ee),this._add("touchPan",Fe,["touchZoom","touchRotate"]);const qe=new _d,at=new cu;m.touchZoomRotate=new uh(b,at,qe,W),this._add("touchRotate",qe,["touchPan","touchZoom"]),this._add("touchZoom",at,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Si(m));const et=m.scrollZoom=new Du(m,this);this._add("scrollZoom",et,["mousePan"]);const lt=m.keyboard=new cf;this._add("keyboard",lt);for(const Ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[Ie]&&m[Ie].enable(l[Ie])}_add(l,m,b){this._handlers.push({handlerName:l,handler:m,allowed:b}),this._handlersById[l]=m}stop(l){if(!this._updatingCamera){for(const{handler:m}of this._handlers)m.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_l(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,m,b){for(const I in l)if(I!==b&&(!m||m.indexOf(I)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const m=[];for(const b of l)this._el.contains(b.target)&&m.push(b);return m}handleEvent(l,m){this._updatingCamera=!0;const b=l.type==="renderFrame",I=b?void 0:l,P={needsRenderFrame:!1},j={},W={},Z=l.touches?this._getMapTouches(l.touches):void 0,le=Z?_e(this._el,Z):b?void 0:Be(this._el,l);for(const{handlerName:Fe,handler:qe,allowed:at}of this._handlers){if(!qe.isEnabled())continue;let et;this._blockedByActive(W,at,Fe)?qe.reset():qe[m||l.type]&&(et=qe[m||l.type](l,le,Z),this.mergeHandlerResult(P,j,et,Fe,I),et&&et.needsRenderFrame&&this._triggerRenderFrame()),(et||qe.isActive())&&(W[Fe]=qe)}const ce={};for(const Fe in this._previousActiveHandlers)W[Fe]||(ce[Fe]=I);this._previousActiveHandlers=W,(Object.keys(ce).length||Fu(P))&&(this._changes.push([P,j,ce]),this._triggerRenderFrame()),(Object.keys(W).length||Fu(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Ee}=P;Ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ee(this._map))}mergeHandlerResult(l,m,b,I,P){if(!b)return;s.extend(l,b);const j={handlerName:I,originalEvent:b.originalEvent||P};b.zoomDelta!==void 0&&(m.zoom=j),b.panDelta!==void 0&&(m.drag=j),b.pitchDelta!==void 0&&(m.pitch=j),b.bearingDelta!==void 0&&(m.rotate=j)}_applyChanges(){const l={},m={},b={};for(const[I,P,j]of this._changes)I.panDelta&&(l.panDelta=(l.panDelta||new s.Point(0,0))._add(I.panDelta)),I.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+I.zoomDelta),I.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+I.bearingDelta),I.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+I.pitchDelta),I.around!==void 0&&(l.around=I.around),I.aroundCoord!==void 0&&(l.aroundCoord=I.aroundCoord),I.pinchAround!==void 0&&(l.pinchAround=I.pinchAround),I.noInertia&&(l.noInertia=I.noInertia),s.extend(m,P),s.extend(b,j);this._updateMapTransform(l,m,b),this._changes=[]}_updateMapTransform(l,m,b){const I=this._map,P=I.transform,j=rt=>[rt.x,rt.y,rt.z];if((rt=>{const gt=this._eventsInProgress.drag;return gt&&!this._handlersById[gt.handlerName].isActive()})()&&!Fu(l)){const rt=P.zoom;P.cameraElevationReference="sea",P.recenterOnTerrain(),P.cameraElevationReference="ground",rt!==P.zoom&&this._map._update(!0)}if(P._isCameraConstrained&&I._stop(!0),!Fu(l))return void this._fireEvents(m,b,!0);let{panDelta:W,zoomDelta:Z,bearingDelta:le,pitchDelta:ce,around:Ee,aroundCoord:Fe,pinchAround:qe}=l;P._isCameraConstrained&&(Z>0&&(Z=0),P._isCameraConstrained=!1),qe!==void 0&&(Ee=qe),(Z||(rt=>m[rt]&&!this._eventsInProgress[rt])("drag"))&&Ee&&(this._dragOrigin=j(P.pointCoordinate3D(Ee)),this._trackingEllipsoid.setup(P._camera.position,this._dragOrigin)),P.cameraElevationReference="sea",I._stop(!0),Ee=Ee||I.transform.centerPoint,le&&(P.bearing+=le),ce&&(P.pitch+=ce),P._updateCameraState();const at=[0,0,0];if(W)if(P.projection.name==="mercator"){const rt=this._trackingEllipsoid.projectRay(P.screenPointToMercatorRay(Ee).dir),gt=this._trackingEllipsoid.projectRay(P.screenPointToMercatorRay(Ee.sub(W)).dir);at[0]=gt[0]-rt[0],at[1]=gt[1]-rt[1]}else{const rt=P.pointCoordinate(Ee);if(P.projection.name==="globe"){W=W.rotate(-P.angle);const gt=P._pixelsPerMercatorPixel/P.worldSize;at[0]=-W.x*s.mercatorScale(s.latFromMercatorY(rt.y))*gt,at[1]=-W.y*s.mercatorScale(P.center.lat)*gt}else{const gt=P.pointCoordinate(Ee.sub(W));rt&&gt&&(at[0]=gt.x-rt.x,at[1]=gt.y-rt.y)}}const et=P.zoom,lt=[0,0,0];if(Z){const rt=j(Fe||P.pointCoordinate3D(Ee)),gt={dir:s.normalize([],s.sub([],rt,P._camera.position))};if(gt.dir[2]<0){const yt=P.zoomDeltaToMovement(rt,Z);s.scale$2(lt,gt.dir,yt)}}const Ie=s.add(at,at,lt);P._translateCameraConstrained(Ie),Z&&Math.abs(P.zoom-et)>1e-4&&P.recenterOnTerrain(),P.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(m,b,!0)}_fireEvents(l,m,b){const I=_l(this._eventsInProgress),P=_l(l),j={};for(const ce in l){const{originalEvent:Ee}=l[ce];this._eventsInProgress[ce]||(j[`${ce}start`]=Ee),this._eventsInProgress[ce]=l[ce]}!I&&P&&this._fireEvent("movestart",P.originalEvent);for(const ce in j)this._fireEvent(ce,j[ce]);P&&this._fireEvent("move",P.originalEvent);for(const ce in l){const{originalEvent:Ee}=l[ce];this._fireEvent(ce,Ee)}const W={};let Z;for(const ce in this._eventsInProgress){const{handlerName:Ee,originalEvent:Fe}=this._eventsInProgress[ce];this._handlersById[Ee].isActive()||(delete this._eventsInProgress[ce],Z=m[Ee]||Fe,W[`${ce}end`]=Z)}for(const ce in W)this._fireEvent(ce,W[ce]);const le=_l(this._eventsInProgress);if(b&&(I||P)&&!le){this._updatingCamera=!0;const ce=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ee=Fe=>Fe!==0&&-this._bearingSnap<Fe&&Fe<this._bearingSnap;ce?(Ee(ce.bearing||this._map.getBearing())&&(ce.bearing=0),this._map.easeTo(ce,{originalEvent:Z})):(this._map.fire(new s.Event("moveend",{originalEvent:Z})),Ee(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,m){this._map.fire(new s.Event(l,m?{originalEvent:m}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((l=>{this._frameId=void 0,this.handleEvent(new vl("renderFrame",{timeStamp:l})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const hu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ch extends s.Evented{constructor(l,m){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=m.bearingSnap,this._respectPrefersReducedMotion=m.respectPrefersReducedMotion!==!1,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(l,m){return this.jumpTo({center:l},m)}panBy(l,m,b){return l=s.Point.convert(l).mult(-1),this.panTo(this.transform.center,s.extend({offset:l},m),b)}panTo(l,m,b){return this.easeTo(s.extend({center:l},m),b)}getZoom(){return this.transform.zoom}setZoom(l,m){return this.jumpTo({zoom:l},m),this}zoomTo(l,m,b){return this.easeTo(s.extend({zoom:l},m),b)}zoomIn(l,m){return this.zoomTo(this.getZoom()+1,l,m),this}zoomOut(l,m){return this.zoomTo(this.getZoom()-1,l,m),this}getBearing(){return this.transform.bearing}setBearing(l,m){return this.jumpTo({bearing:l},m),this}getPadding(){return this.transform.padding}setPadding(l,m){return this.jumpTo({padding:l},m),this}rotateTo(l,m,b){return this.easeTo(s.extend({bearing:l},m),b)}resetNorth(l,m){return this.rotateTo(0,s.extend({duration:1e3},l),m),this}resetNorthPitch(l,m){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},l),m),this}snapToNorth(l,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,m):this}getPitch(){return this.transform.pitch}setPitch(l,m){return this.jumpTo({pitch:l},m),this}cameraForBounds(l,m){l=s.LngLatBounds.convert(l);const b=m&&m.bearing||0,I=m&&m.pitch||0,P=l.getNorthWest(),j=l.getSouthEast();return this._cameraForBounds(this.transform,P,j,b,I,m)}_extendCameraOptions(l){const m={top:0,bottom:0,right:0,left:0};if(typeof(l=s.extend({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const b=l.padding;l.padding={top:b,bottom:b,right:b,left:b}}return l.padding=s.extend(m,l.padding),l}_minimumAABBFrustumDistance(l,m){const b=m.max[0]-m.min[0],I=m.max[1]-m.min[1];return b/I>l.aspect?b/(2*Math.tan(.5*l.fovX)*l.aspect):I/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,m,b,I,P,j){const W=l.clone(),Z=this._extendCameraOptions(j);W.bearing=I,W.pitch=P;const le=s.LngLat.convert(m),ce=s.LngLat.convert(b),Ee=.5*(le.lat+ce.lat),Fe=.5*(le.lng+ce.lng),qe=s.latLngToECEF(Ee,Fe),at=s.normalize([],qe),et=s.normalize([],s.cross([],at,[0,1,0])),lt=s.cross([],et,at),Ie=[et[0],et[1],et[2],0,lt[0],lt[1],lt[2],0,at[0],at[1],at[2],0,0,0,0,1],rt=[qe,s.latLngToECEF(le.lat,le.lng),s.latLngToECEF(ce.lat,le.lng),s.latLngToECEF(ce.lat,ce.lng),s.latLngToECEF(le.lat,ce.lng),s.latLngToECEF(Ee,le.lng),s.latLngToECEF(Ee,ce.lng),s.latLngToECEF(le.lat,Fe),s.latLngToECEF(ce.lat,Fe)];let gt=s.Aabb.fromPoints(rt.map((In=>[s.dot(et,In),s.dot(lt,In),s.dot(at,In)])));const yt=s.transformMat4([],gt.center,Ie);s.squaredLength(yt)===0&&s.set(yt,0,0,1),s.normalize(yt,yt),s.scale$2(yt,yt,s.GLOBE_RADIUS),W.center=s.ecefToLatLng(yt);const Mt=W.getWorldToCameraMatrix(),Dt=s.invert(new Float64Array(16),Mt);gt=s.Aabb.applyTransform(gt,s.multiply([],Mt,Ie)),s.transformMat4(yt,yt,Mt);const Nt=.5*(gt.max[2]-gt.min[2]),qt=this._minimumAABBFrustumDistance(W,gt),Bt=s.scale$2([],[0,0,1],Nt),rn=s.add(Bt,yt,Bt),Rn=qt+(W.pitch===0?0:s.distance(yt,rn)),Jt=W.globeCenterInViewSpace,An=s.sub([],yt,[Jt[0],Jt[1],Jt[2]]);s.normalize(An,An),s.scale$2(An,An,Rn);const cn=s.add([],yt,An);s.transformMat4(cn,cn,Dt);const Vn=s.earthRadius/s.GLOBE_RADIUS,tn=s.length(cn),bn=s.mercatorZfromAltitude(Math.max(tn*Vn-s.earthRadius,Number.EPSILON),0),Un=Math.min(W.zoomFromMercatorZAdjusted(bn),Z.maxZoom);return Un>.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(W.setProjection({name:"mercator"}),W.zoom=Un,this._cameraForBounds(W,m,b,I,P,j)):{center:W.center,zoom:Un,bearing:I,pitch:P}}queryTerrainElevation(l,m){const b=this.transform.elevation;return b?(m=s.extend({},{exaggerated:!0},m),b.getAtPoint(s.MercatorCoordinate.fromLngLat(l),null,m.exaggerated)):null}_cameraForBounds(l,m,b,I,P,j){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,m,b,I,P,j);const W=l.clone(),Z=this._extendCameraOptions(j),le=W.padding;W.bearing=I,W.pitch=P;const ce=s.LngLat.convert(m),Ee=s.LngLat.convert(b),Fe=new s.LngLat(ce.lng,Ee.lat),qe=new s.LngLat(Ee.lng,ce.lat),at=W.project(ce),et=W.project(Ee),lt=this.queryTerrainElevation(ce),Ie=this.queryTerrainElevation(Ee),rt=this.queryTerrainElevation(Fe),gt=this.queryTerrainElevation(qe),yt=[[at.x,at.y,Math.min(lt||0,Ie||0,rt||0,gt||0)],[et.x,et.y,Math.max(lt||0,Ie||0,rt||0,gt||0)]];let Mt=s.Aabb.fromPoints(yt);const Dt=W.getWorldToCameraMatrix(),Nt=s.invert(new Float64Array(16),Dt);Mt=s.Aabb.applyTransform(Mt,Dt);const qt=s.sub([],Mt.max,Mt.min),Bt=le.left||0,rn=le.right||0,Rn=le.bottom||0,Jt=le.top||0,{left:An,right:cn,top:Vn,bottom:tn}=Z.padding,bn=.5*(Bt+rn),Un=.5*(Jt+Rn),In=Math.min(W.scaleZoom(W.scale*Math.min((W.width-(Bt+rn+An+cn))/qt[0],(W.height-(Rn+Jt+tn+Vn))/qt[1])),Z.maxZoom),Wn=W.scale/W.zoomScale(In);Mt=new s.Aabb([Mt.min[0]-(An+bn)*Wn,Mt.min[1]-(tn+Un)*Wn,Mt.min[2]],[Mt.max[0]+(cn+bn)*Wn,Mt.max[1]+(Vn+Un)*Wn,Mt.max[2]]);const Nr=.5*qt[2],ei=this._minimumAABBFrustumDistance(W,Mt),Er=[0,0,1,0];s.transformMat4$1(Er,Er,Dt),s.normalize$2(Er,Er);const gr=s.scale$2([],Er,ei+Nr),Ai=s.add([],Mt.center,gr),Mi=(typeof Z.offset.x=="number"&&typeof Z.offset.y=="number"?new s.Point(Z.offset.x,Z.offset.y):s.Point.convert(Z.offset)).rotate(-s.degToRad(I));Mt.center[0]-=Mi.x*Wn,Mt.center[1]+=Mi.y*Wn,s.transformMat4(Mt.center,Mt.center,Nt),s.transformMat4(Ai,Ai,Nt);const Vr=[Mt.center[0],Mt.center[1],Ai[2]*W.pixelsPerMeter];s.scale$2(Vr,Vr,1/W.worldSize);const Yi=s.lngFromMercatorX(Vr[0]),Ki=s.latFromMercatorY(Vr[1]),ts=Math.min(W._zoomFromMercatorZ(Vr[2]),Z.maxZoom),Gs=new s.LngLat(Yi,Ki);return W.mercatorFromTransition&&ts<.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(W.setProjection({name:"globe"}),W.zoom=ts,this._cameraForBounds(W,m,b,I,P,j)):{center:Gs,zoom:ts,bearing:I,pitch:P}}fitBounds(l,m,b){const I=this.cameraForBounds(l,m);return this._fitInternal(I,m,b)}fitScreenCoordinates(l,m,b,I,P){const j=s.Point.convert(l),W=s.Point.convert(m),Z=new s.Point(Math.min(j.x,W.x),Math.min(j.y,W.y)),le=new s.Point(Math.max(j.x,W.x),Math.max(j.y,W.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(j,W))return this;const ce=this.transform.pointLocation3D(Z),Ee=this.transform.pointLocation3D(le),Fe=this.transform.pointLocation3D(new s.Point(Z.x,le.y)),qe=this.transform.pointLocation3D(new s.Point(le.x,Z.y)),at=[Math.min(ce.lng,Ee.lng,Fe.lng,qe.lng),Math.min(ce.lat,Ee.lat,Fe.lat,qe.lat)],et=[Math.max(ce.lng,Ee.lng,Fe.lng,qe.lng),Math.max(ce.lat,Ee.lat,Fe.lat,qe.lat)],lt=I&&I.pitch?I.pitch:this.getPitch(),Ie=this._cameraForBounds(this.transform,at,et,b,lt,I);return this._fitInternal(Ie,I,P)}_fitInternal(l,m,b){return l?(delete(m=s.extend(l,m)).padding,m.linear?this.easeTo(m,b):this.flyTo(m,b)):this}jumpTo(l,m){this.stop();const b=l.preloadOnly?this.transform.clone():this.transform;let I=!1,P=!1,j=!1;return"zoom"in l&&b.zoom!==+l.zoom&&(I=!0,b.zoom=+l.zoom),l.center!==void 0&&(b.center=s.LngLat.convert(l.center)),"bearing"in l&&b.bearing!==+l.bearing&&(P=!0,b.bearing=+l.bearing),"pitch"in l&&b.pitch!==+l.pitch&&(j=!0,b.pitch=+l.pitch),l.padding==null||b.isPaddingEqual(l.padding)||(b.padding=l.padding),l.preloadOnly?(this._preloadTiles(b),this):(this.fire(new s.Event("movestart",m)).fire(new s.Event("move",m)),I&&this.fire(new s.Event("zoomstart",m)).fire(new s.Event("zoom",m)).fire(new s.Event("zoomend",m)),P&&this.fire(new s.Event("rotatestart",m)).fire(new s.Event("rotate",m)).fire(new s.Event("rotateend",m)),j&&this.fire(new s.Event("pitchstart",m)).fire(new s.Event("pitch",m)).fire(new s.Event("pitchend",m)),this.fire(new s.Event("moveend",m)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(hu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,m){const b=this.transform;if(!b.projection.supportsFreeCamera)return s.warnOnce(hu),this;this.stop();const I=b.zoom,P=b.pitch,j=b.bearing;b.setFreeCameraOptions(l);const W=I!==b.zoom,Z=P!==b.pitch,le=j!==b.bearing;return this.fire(new s.Event("movestart",m)).fire(new s.Event("move",m)),W&&this.fire(new s.Event("zoomstart",m)).fire(new s.Event("zoom",m)).fire(new s.Event("zoomend",m)),le&&this.fire(new s.Event("rotatestart",m)).fire(new s.Event("rotate",m)).fire(new s.Event("rotateend",m)),Z&&this.fire(new s.Event("pitchstart",m)).fire(new s.Event("pitch",m)).fire(new s.Event("pitchend",m)),this.fire(new s.Event("moveend",m)),this}easeTo(l,m){this._stop(!1,l.easeId),((l=s.extend({offset:[0,0],duration:500,easing:s.ease},l)).animate===!1||this._prefersReducedMotion(l))&&(l.duration=0);const b=this.transform,I=this.getZoom(),P=this.getBearing(),j=this.getPitch(),W=this.getPadding(),Z="zoom"in l?+l.zoom:I,le="bearing"in l?this._normalizeBearing(l.bearing,P):P,ce="pitch"in l?+l.pitch:j,Ee="padding"in l?l.padding:b.padding,Fe=s.Point.convert(l.offset);let qe,at,et;if(b.projection.name==="globe"){const Bt=s.MercatorCoordinate.fromLngLat(b.center),rn=Fe.rotate(-b.angle);Bt.x+=rn.x/b.worldSize,Bt.y+=rn.y/b.worldSize;const Rn=Bt.toLngLat(),Jt=s.LngLat.convert(l.center||Rn);this._normalizeCenter(Jt),qe=b.centerPoint.add(rn),at=new s.Point(Bt.x,Bt.y).mult(b.worldSize),et=new s.Point(s.mercatorXfromLng(Jt.lng),s.mercatorYfromLat(Jt.lat)).mult(b.worldSize).sub(at)}else{qe=b.centerPoint.add(Fe);const Bt=b.pointLocation(qe),rn=s.LngLat.convert(l.center||Bt);this._normalizeCenter(rn),at=b.project(Bt),et=b.project(rn).sub(at)}const lt=b.zoomScale(Z-I);let Ie,rt;l.around&&(Ie=s.LngLat.convert(l.around),rt=b.locationPoint(Ie));const gt=this._zooming||Z!==I,yt=this._rotating||P!==le,Mt=this._pitching||ce!==j,Dt=!b.isPaddingEqual(Ee),Nt=Bt=>rn=>{if(gt&&(Bt.zoom=s.number(I,Z,rn)),yt&&(Bt.bearing=s.number(P,le,rn)),Mt&&(Bt.pitch=s.number(j,ce,rn)),Dt&&(Bt.interpolatePadding(W,Ee,rn),qe=Bt.centerPoint.add(Fe)),Ie)Bt.setLocationAtPoint(Ie,rt);else{const Rn=Bt.zoomScale(Bt.zoom-I),Jt=Z>I?Math.min(2,lt):Math.max(.5,lt),An=Math.pow(Jt,1-rn),cn=Bt.unproject(at.add(et.mult(rn*An)).mult(Rn));Bt.setLocationAtPoint(Bt.renderWorldCopies?cn.wrap():cn,qe)}return l.preloadOnly||this._fireMoveEvents(m),Bt};if(l.preloadOnly){const Bt=this._emulate(Nt,l.duration,b);return this._preloadTiles(Bt),this}const qt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=gt,this._rotating=yt,this._pitching=Mt,this._padding=Dt,this._easeId=l.easeId,this._prepareEase(m,l.noMoveStart,qt),this._ease(Nt(b),(Bt=>{b.recenterOnTerrain(),this._afterEase(m,Bt)}),l),this}_prepareEase(l,m,b={}){this._moving=!0,this.transform.cameraElevationReference="sea",m||b.moving||this.fire(new s.Event("movestart",l)),this._zooming&&!b.zooming&&this.fire(new s.Event("zoomstart",l)),this._rotating&&!b.rotating&&this.fire(new s.Event("rotatestart",l)),this._pitching&&!b.pitching&&this.fire(new s.Event("pitchstart",l))}_fireMoveEvents(l){this.fire(new s.Event("move",l)),this._zooming&&this.fire(new s.Event("zoom",l)),this._rotating&&this.fire(new s.Event("rotate",l)),this._pitching&&this.fire(new s.Event("pitch",l))}_afterEase(l,m){if(this._easeId&&m&&this._easeId===m)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const b=this._zooming,I=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,b&&this.fire(new s.Event("zoomend",l)),I&&this.fire(new s.Event("rotateend",l)),P&&this.fire(new s.Event("pitchend",l)),this.fire(new s.Event("moveend",l))}flyTo(l,m){if(this._prefersReducedMotion(l)){const In=s.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(In,m)}this.stop(),l=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},l);const b=this.transform,I=this.getZoom(),P=this.getBearing(),j=this.getPitch(),W=this.getPadding(),Z="zoom"in l?s.clamp(+l.zoom,b.minZoom,b.maxZoom):I,le="bearing"in l?this._normalizeBearing(l.bearing,P):P,ce="pitch"in l?+l.pitch:j,Ee="padding"in l?l.padding:b.padding,Fe=b.zoomScale(Z-I),qe=s.Point.convert(l.offset);let at=b.centerPoint.add(qe);const et=b.pointLocation(at),lt=s.LngLat.convert(l.center||et);this._normalizeCenter(lt);const Ie=b.project(et),rt=b.project(lt).sub(Ie);let gt=l.curve;const yt=Math.max(b.width,b.height),Mt=yt/Fe,Dt=rt.mag();if("minZoom"in l){const In=s.clamp(Math.min(l.minZoom,I,Z),b.minZoom,b.maxZoom),Wn=yt/b.zoomScale(In-I);gt=Math.sqrt(Wn/Dt*2)}const Nt=gt*gt;function qt(In){const Wn=(Mt*Mt-yt*yt+(In?-1:1)*Nt*Nt*Dt*Dt)/(2*(In?Mt:yt)*Nt*Dt);return Math.log(Math.sqrt(Wn*Wn+1)-Wn)}function Bt(In){return(Math.exp(In)-Math.exp(-In))/2}function rn(In){return(Math.exp(In)+Math.exp(-In))/2}const Rn=qt(0);let Jt=function(In){return rn(Rn)/rn(Rn+gt*In)},An=function(In){return yt*((rn(Rn)*(Bt(Wn=Rn+gt*In)/rn(Wn))-Bt(Rn))/Nt)/Dt;var Wn},cn=(qt(1)-Rn)/gt;if(Math.abs(Dt)<1e-6||!isFinite(cn)){if(Math.abs(yt-Mt)<1e-6)return this.easeTo(l,m);const In=Mt<yt?-1:1;cn=Math.abs(Math.log(Mt/yt))/gt,An=function(){return 0},Jt=function(Wn){return Math.exp(In*gt*Wn)}}l.duration="duration"in l?+l.duration:1e3*cn/("screenSpeed"in l?+l.screenSpeed/gt:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const Vn=P!==le,tn=ce!==j,bn=!b.isPaddingEqual(Ee),Un=In=>Wn=>{const Nr=Wn*cn,ei=1/Jt(Nr);In.zoom=Wn===1?Z:I+In.scaleZoom(ei),Vn&&(In.bearing=s.number(P,le,Wn)),tn&&(In.pitch=s.number(j,ce,Wn)),bn&&(In.interpolatePadding(W,Ee,Wn),at=In.centerPoint.add(qe));const Er=Wn===1?lt:In.unproject(Ie.add(rt.mult(An(Nr))).mult(ei));return In.setLocationAtPoint(In.renderWorldCopies?Er.wrap():Er,at),In._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(m),In};if(l.preloadOnly){const In=this._emulate(Un,l.duration,b);return this._preloadTiles(In),this}return this._zooming=!0,this._rotating=Vn,this._pitching=tn,this._padding=bn,this._prepareEase(m,!1),this._ease(Un(b),(()=>this._afterEase(m)),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,m){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const b=this._onEaseEnd;this._onEaseEnd=void 0,b.call(this,m)}if(!l){const b=this.handlers;b&&b.stop(!1)}return this}_ease(l,m,b){b.animate===!1||b.duration===0?(l(1),m()):(this._easeStart=s.exported.now(),this._easeOptions=b,this._onEaseFrame=l,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),m=this._onEaseFrame;m&&m(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,m){l=s.wrap(l,-180,180);const b=Math.abs(l-m);return Math.abs(l-360-m)<b&&(l-=360),Math.abs(l+360-m)<b&&(l+=360),l}_normalizeCenter(l){const m=this.transform;if(!m.renderWorldCopies||m.maxBounds)return;const b=l.lng-m.center.lng;l.lng+=b>180?-360:b<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&s.exported.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,m,b){const I=Math.ceil(15*m/1e3),P=[],j=l(b.clone());for(let W=0;W<=I;W++){const Z=j(W/I);P.push(Z.clone())}return P}}class Cr{constructor(l={}){this.options=l,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const m=this.options&&this.options.compact;return this._map=l,this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=M("button","mapboxgl-ctrl-attrib-button",this._container),M("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=M("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),m&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),m===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,m){const b=this._map._getUIString(`AttributionControl.${m}`);l.setAttribute("aria-label",b),l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",b)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const m=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(l){const b=m.reduce(((I,P,j)=>(P.value&&(I+=`${P.key}=${P.value}${j<m.length-1?"&":""}`),I)),"?");l.href=`${s.config.FEEDBACK_URL}/${b}#${vc(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const I=this._map.style.stylesheet;this.styleOwner=I.owner,this.styleId=I.id}const m=this._map.style._sourceCaches;for(const I in m){const P=m[I];if(P.used){const j=P.getSource();j.attribution&&l.indexOf(j.attribution)<0&&l.push(j.attribution)}}l.sort(((I,P)=>I.length-P.length)),l=l.filter(((I,P)=>{for(let j=P+1;j<l.length;j++)if(l[j].indexOf(I)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const b=l.join(" | ");b!==this._attribHTML&&(this._attribHTML=b,l.length?(this._innerContainer.innerHTML=b,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class hh{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=M("div","mapboxgl-ctrl");const m=M("a","mapboxgl-ctrl-logo");return m.target="_blank",m.rel="noopener nofollow",m.href="https://www.mapbox.com/",m.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),m.setAttribute("rel","noopener nofollow"),this._container.appendChild(m),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(const m in l){const b=l[m].getSource();if(b.hasOwnProperty("mapbox_logo")&&!b.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const m=l[0];this._map.getCanvasContainer().offsetWidth<250?m.classList.add("mapboxgl-compact"):m.classList.remove("mapboxgl-compact")}}}class D{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const m=++this._id;return this._queue.push({callback:l,id:m,cancelled:!1}),m}remove(l){const m=this._currentlyRunning,b=m?this._queue.concat(m):this._queue;for(const I of b)if(I.id===l)return void(I.cancelled=!0)}run(l=0){const m=this._currentlyRunning=this._queue;this._queue=[];for(const b of m)if(!b.cancelled&&(b.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function H(x,l,m){if(x=new s.LngLat(x.lng,x.lat),l){const b=new s.LngLat(x.lng-360,x.lat),I=new s.LngLat(x.lng+360,x.lat),P=360*Math.ceil(Math.abs(x.lng-m.center.lng)/360),j=m.locationPoint(x).distSqr(l),W=l.x<0||l.y<0||l.x>m.width||l.y>m.height;m.locationPoint(b).distSqr(l)<j&&(W||Math.abs(b.lng-m.center.lng)<P)?x=b:m.locationPoint(I).distSqr(l)<j&&(W||Math.abs(I.lng-m.center.lng)<P)&&(x=I)}for(;Math.abs(x.lng-m.center.lng)>180;){const b=m.locationPoint(x);if(b.x>=0&&b.y>=0&&b.x<=m.width&&b.y<=m.height)break;x.lng>m.center.lng?x.lng-=360:x.lng+=360}return x}const ue={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class pe extends s.Evented{constructor(l,m){if(super(),(l instanceof s.window.HTMLElement||m)&&(l=s.extend({element:l},m)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=s.Point.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=M("div");const I=41,P=27,j=Q("svg",{display:"block",height:I*this._scale+"px",width:P*this._scale+"px",viewBox:`0 0 ${P} ${I}`},this._element),W=Q("radialGradient",{id:"shadowGradient"},Q("defs",{},j));Q("stop",{offset:"10%","stop-opacity":.4},W),Q("stop",{offset:"100%","stop-opacity":.05},W),Q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},j),Q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},j),Q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},j),Q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},j),this._offset=s.Point.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(I=>{I.preventDefault()})),this._element.addEventListener("mousedown",(I=>{I.preventDefault()}));const b=this._element.classList;for(const I in ue)b.remove(`mapboxgl-marker-anchor-${I}`);b.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const I=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[I,-1*(38.1-13.5+I)],"bottom-right":[-I,-1*(38.1-13.5+I)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const m=l.code,b=l.charCode||l.keyCode;m!=="Space"&&m!=="Enter"&&b!==32&&b!==13||this.togglePopup()}_onMapClick(l){const m=l.originalEvent.target,b=this._element;this._popup&&(m===b||b.contains(m))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,m=this._pos;if(!l||!m)return!1;const b=l.unproject(m),I=l.getFreeCameraOptions();if(!I.position)return!1;const P=I.position.toLngLat();return P.distanceTo(b)<.9*P.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const m=this._pos;if(!m||m.x<0||m.x>l.transform.width||m.y<0||m.y>l.transform.height)return void this._clearFadeTimer();const b=l.unproject(m);let I;l._showingGlobe()&&s.isLngLatBehindGlobe(l.transform,this._lngLat)?I=0:(I=1-l._queryFogOpacity(b),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(I*=this._occludedOpacity)),this._element.style.opacity=`${I}`,this._element.style.pointerEvents=I>0?"auto":"none",this._popup&&this._popup._setOpacity(I),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const m=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${ue[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${m.x}px,${m.y}px)
        `}_calculateXYTransform(){const l=this._pos,m=this._map,b=this.getPitchAlignment();if(!m||!l||b!=="map")return"";if(!m._showingGlobe()){const Z=m.getPitch();return Z?`rotateX(${Z}deg)`:""}const I=s.radToDeg(s.globeTiltAtLngLat(m.transform,this._lngLat)),P=l.sub(s.globeCenterToScreenPoint(m.transform)),j=Math.abs(P.x)+Math.abs(P.y);if(j===0)return"";const W=I/j;return`rotateX(${-P.y*W}deg) rotateY(${P.x*W}deg)`}_calculateZTransform(){const l=this._pos,m=this._map;if(!m||!l)return"";let b=0;const I=this.getRotationAlignment();if(I==="map")if(m._showingGlobe()){const P=m.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),j=m.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(P);b=s.radToDeg(Math.atan2(j.y,j.x))-90}else b=-m.getBearing();else if(I==="horizon"){const P=s.smoothstep(4,6,m.getZoom()),j=s.globeCenterToScreenPoint(m.transform);j.y+=P*m.transform.height;const W=l.sub(j),Z=s.radToDeg(Math.atan2(W.y,W.x));b=(Z>90?Z-270:Z+90)*(1-P)}return b+=this._rotation,b?`rotateZ(${b}deg)`:""}_update(l){s.window.cancelAnimationFrame(this._updateFrameId);const m=this._map;m&&(m.transform.renderWorldCopies&&(this._lngLat=H(this._lngLat,this._pos,m.transform)),this._pos=m.project(this._lngLat),l===!0?this._updateFrameId=s.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),m._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(m._showingGlobe()||m.getTerrain()||m.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(l){return this._offset=s.Point.convert(l),this._update(),this}_onMove(l){const m=this._map;if(!m)return;const b=this._pointerdownPos,I=this._positionDelta;if(b&&I){if(!this._isDragging){const P=this._clickTolerance||m._clickTolerance;if(l.point.dist(b)<P)return;this._isDragging=!0}this._pos=l.point.sub(I),this._lngLat=m.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(l){const m=this._map,b=this._pos;m&&b&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(b),this._pointerdownPos=l.point,this._state="pending",m.on("mousemove",this._onMove),m.on("touchmove",this._onMove),m.once("mouseup",this._onUp),m.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const m=this._map;return m&&(l?(m.on("mousedown",this._addDragHandler),m.on("touchstart",this._addDragHandler)):(m.off("mousedown",this._addDragHandler),m.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ge={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},tt=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function it(x=new s.Point(0,0),l="bottom"){if(typeof x=="number"){const m=Math.round(Math.sqrt(.5*Math.pow(x,2)));switch(l){case"top":return new s.Point(0,x);case"top-left":return new s.Point(m,m);case"top-right":return new s.Point(-m,m);case"bottom":return new s.Point(0,-x);case"bottom-left":return new s.Point(m,-m);case"bottom-right":return new s.Point(-m,-m);case"left":return new s.Point(x,0);case"right":return new s.Point(-x,0)}return new s.Point(0,0)}return x instanceof s.Point||Array.isArray(x)?s.Point.convert(x):s.Point.convert(x[l]||[0,0])}class ht{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const m=s.easeCubicInOut((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-m)+this._end*m}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,m,b){this._start=this.getValue(m),this._end=l,this._startTime=m,this._endTime=m+b}}const dt={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},St={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Yt={showCompass:!0,showZoom:!0,visualizePitch:!1};class pn{constructor(l,m,b=!1){this._clickTolerance=10,this.element=m,this.mouseRotate=new Il({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,b&&(this.mousePitch=new as({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),m.addEventListener("mousedown",this.mousedown),m.addEventListener("touchstart",this.touchstart,{passive:!1}),m.addEventListener("touchmove",this.touchmove),m.addEventListener("touchend",this.touchend),m.addEventListener("touchcancel",this.reset)}down(l,m){this.mouseRotate.mousedown(l,m),this.mousePitch&&this.mousePitch.mousedown(l,m),oe()}move(l,m){const b=this.map,I=this.mouseRotate.mousemoveWindow(l,m),P=I&&I.bearingDelta;if(P&&b.setBearing(b.getBearing()+P),this.mousePitch){const j=this.mousePitch.mousemoveWindow(l,m),W=j&&j.pitchDelta;W&&b.setPitch(b.getPitch()+W)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ve(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(s.extend({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),Be(this.element,l)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,Be(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=_e(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=_e(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Et={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Qt={maxWidth:100,unit:"metric"},gn={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Bn={version:s.version,supported:L,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends ch{constructor(x){if(s.LivePerformanceUtils.mark(s.PerformanceMarkers.create),(x=s.extend({},St,x)).minZoom!=null&&x.maxZoom!=null&&x.minZoom>x.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(x.minPitch!=null&&x.maxPitch!=null&&x.minPitch>x.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(x.minPitch!=null&&x.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(x.maxPitch!=null&&x.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(x.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(x.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Dr(x.minZoom,x.maxZoom,x.minPitch,x.maxPitch,x.renderWorldCopies),x),this._interactive=x.interactive,this._minTileCacheSize=x.minTileCacheSize,this._maxTileCacheSize=x.maxTileCacheSize,this._failIfMajorPerformanceCaveat=x.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=x.preserveDrawingBuffer,this._antialias=x.antialias,this._useWebGL2=x.useWebGL2,this._trackResize=x.trackResize,this._bearingSnap=x.bearingSnap,this._refreshExpiredTiles=x.refreshExpiredTiles,this._fadeDuration=x.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=x.crossSourceCollisions,this._collectResourceTiming=x.collectResourceTiming,this._optimizeForTerrain=x.optimizeForTerrain,this._language=this._parseLanguage(x.language),this._worldview=x.worldview,this._renderTaskQueue=new D,this._domRenderTaskQueue=new D,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.uniqueId(),this._locale=s.extend({},dt,x.locale),this._clickTolerance=x.clickTolerance,this._cooperativeGestures=x.cooperativeGestures,this._performanceMetricsCollection=x.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ht(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(x.transformRequest,x.accessToken,x.testMode),this._silenceAuthErrors=!!x.testMode,typeof x.container=="string"){if(this._container=s.window.document.getElementById(x.container),!this._container)throw new Error(`Container '${x.container}' not found.`)}else{if(!(x.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=x.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),x.maxBounds&&this.setMaxBounds(x.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new xu(this,x),this._localFontFamily=x.localFontFamily,this._localIdeographFontFamily=x.localIdeographFontFamily,x.style&&this.setStyle(x.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),x.projection&&this.setProjection(x.projection),this._hash=x.hash&&new Ql(typeof x.hash=="string"&&x.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch}),x.bounds&&(this.resize(),this.fitBounds(x.bounds,s.extend({},x.fitBoundsOptions,{duration:0})))),this.resize(),x.attributionControl&&this.addControl(new Cr({customAttribution:x.customAttribution})),this._logoControl=new hh,this.addControl(this._logoControl,x.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(l=>{this._update(l.dataType==="style"),this.fire(new s.Event(`${l.dataType}data`,l))})),this.on("dataloading",(l=>{this.fire(new s.Event(`${l.dataType}dataloading`,l))}))}_getMapId(){return this._mapId}addControl(x,l){if(l===void 0&&(l=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const m=x.onAdd(this);this._controls.push(x);const b=this._controlPositions[l];return l.indexOf("bottom")!==-1?b.insertBefore(m,b.firstChild):b.appendChild(m),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(x);return l>-1&&this._controls.splice(l,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(x){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new s.Event("movestart",x)).fire(new s.Event("move",x)),this.fire(new s.Event("resize",x)),l&&this.fire(new s.Event("moveend",x)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(x){return this.transform.setMaxBounds(s.LngLatBounds.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom)return this.transform.minZoom=x,this._update(),this.getZoom()<x?this.setZoom(x):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom)return this.transform.maxZoom=x,this._update(),this.getZoom()>x?this.setZoom(x):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.minPitch=x,this._update(),this.getPitch()<x?this.setPitch(x):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(x>=this.transform.minPitch)return this.transform.maxPitch=x,this._update(),this.getPitch()>x?this.setPitch(x):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.renderWorldCopies=x,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(x){return x==="auto"?s.window.navigator.language:Array.isArray(x)?x.length===0?void 0:x.map((l=>l==="auto"?s.window.navigator.language:l)):x}setLanguage(x){const l=this._parseLanguage(x);if(!this.style||l===this._language)return this;this._language=l,this.style._reloadSources();for(const m of this._controls)m._setLanguage&&m._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(x){return this.style&&x!==this._worldview?(this._worldview=x,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(x){return this._lazyInitEmptyStyle(),x?typeof x=="string"&&(x={name:x}):x=null,this._useExplicitProjection=!!x,this._prioritizeAndUpdateProjection(x,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const x=this.transform,l=x.projection.name;let m;l==="globe"&&x.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(x.setMercatorFromTransition(),m=!0):l==="mercator"&&x.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(x.setProjection({name:"globe"}),m=!0),m&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(x,l){return this._updateProjection(x||l||{name:"mercator"})}_updateProjection(x){let l;if(l=x.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(x),this.style.applyProjectionUpdate(),l){this.painter.clearBackgroundTiles();for(const m in this.style._sourceCaches)this.style._sourceCaches[m].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(x){return this.transform.locationPoint3D(s.LngLat.convert(x))}unproject(x){return this.transform.pointLocation3D(s.Point.convert(x))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(x,l,m){if(x==="mouseenter"||x==="mouseover"){let b=!1;const I=j=>{const W=l.filter((le=>this.getLayer(le))),Z=W.length?this.queryRenderedFeatures(j.point,{layers:W}):[];Z.length?b||(b=!0,m.call(this,new Ji(x,this,j.originalEvent,{features:Z}))):b=!1},P=()=>{b=!1};return{layers:new Set(l),listener:m,delegates:{mousemove:I,mouseout:P}}}if(x==="mouseleave"||x==="mouseout"){let b=!1;const I=j=>{const W=l.filter((Z=>this.getLayer(Z)));(W.length?this.queryRenderedFeatures(j.point,{layers:W}):[]).length?b=!0:b&&(b=!1,m.call(this,new Ji(x,this,j.originalEvent)))},P=j=>{b&&(b=!1,m.call(this,new Ji(x,this,j.originalEvent)))};return{layers:new Set(l),listener:m,delegates:{mousemove:I,mouseout:P}}}{const b=I=>{const P=l.filter((W=>this.getLayer(W))),j=P.length?this.queryRenderedFeatures(I.point,{layers:P}):[];j.length&&(I.features=j,m.call(this,I),delete I.features)};return{layers:new Set(l),listener:m,delegates:{[x]:b}}}}on(x,l,m){if(m===void 0)return super.on(x,l);Array.isArray(l)||(l=[l]);const b=this._createDelegatedListener(x,l,m);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(b);for(const I in b.delegates)this.on(I,b.delegates[I]);return this}once(x,l,m){if(m===void 0)return super.once(x,l);Array.isArray(l)||(l=[l]);const b=this._createDelegatedListener(x,l,m);for(const I in b.delegates)this.once(I,b.delegates[I]);return this}off(x,l,m){if(m===void 0)return super.off(x,l);l=new Set(Array.isArray(l)?l:[l]);const b=(P,j)=>{if(P.size!==j.size)return!1;for(const W of P)if(!j.has(W))return!1;return!0},I=this._delegatedListeners?this._delegatedListeners[x]:void 0;return I&&(P=>{for(let j=0;j<P.length;j++){const W=P[j];if(W.listener===m&&b(W.layers,l)){for(const Z in W.delegates)this.off(Z,W.delegates[Z]);return P.splice(j,1),this}}})(I),this}queryRenderedFeatures(x,l){return this.style?(l!==void 0||x===void 0||x instanceof s.Point||Array.isArray(x)||(l=x,x=void 0),this.style.queryRenderedFeatures(x=x||[[0,0],[this.transform.width,this.transform.height]],l=l||{},this.transform)):[]}querySourceFeatures(x,l){return this.style.querySourceFeatures(x,l)}isPointOnSurface(x){const{name:l}=this.transform.projection;return l!=="globe"&&l!=="mercator"&&s.warnOnce(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.Point.convert(x))}setStyle(x,l){return(l=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&x?(this._diffStyle(x,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(x,l))}_getUIString(x){const l=this._locale[x];if(l==null)throw new Error(`Missing UI string '${x}'`);return l}_updateStyle(x,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),x&&(this.style=new ji(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof x=="string"?this.style.loadURL(x):this.style.loadJSON(x)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ji(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(x,l){if(typeof x=="string"){const m=this._requestManager.normalizeStyleURL(x),b=this._requestManager.transformRequest(m,s.ResourceType.Style);s.getJSON(b,((I,P)=>{I?this.fire(new s.ErrorEvent(I)):P&&this._updateDiff(P,l)}))}else typeof x=="object"&&this._updateDiff(x,l)}_updateDiff(x,l){try{this.style.setState(x)&&this._update(!0)}catch(m){s.warnOnce(`Unable to perform style diff: ${m.message||m.error||m}.  Rebuilding the style from scratch.`),this._updateStyle(x,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(x,l){return this._lazyInitEmptyStyle(),this.style.addSource(x,l),this._update(!0)}isSourceLoaded(x){return!!this.style&&this.style._isSourceCacheLoaded(x)}areTilesLoaded(){const x=this.style&&this.style._sourceCaches;for(const l in x){const m=x[l]._tiles;for(const b in m){const I=m[b];if(I.state!=="loaded"&&I.state!=="errored")return!1}}return!0}addSourceType(x,l,m){this._lazyInitEmptyStyle(),this.style.addSourceType(x,l,m)}removeSource(x){return this.style.removeSource(x),this._updateTerrain(),this._update(!0)}getSource(x){return this.style.getSource(x)}addImage(x,l,{pixelRatio:m=1,sdf:b=!1,stretchX:I,stretchY:P,content:j}={}){if(this._lazyInitEmptyStyle(),l instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&l instanceof s.window.ImageBitmap){const{width:W,height:Z,data:le}=s.exported.getImageData(l);this.style.addImage(x,{data:new s.RGBAImage({width:W,height:Z},le),pixelRatio:m,stretchX:I,stretchY:P,content:j,sdf:b,version:0})}else if(l.width===void 0||l.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:W,height:Z}=l,le=l;this.style.addImage(x,{data:new s.RGBAImage({width:W,height:Z},new Uint8Array(le.data)),pixelRatio:m,stretchX:I,stretchY:P,content:j,sdf:b,version:0,userImage:le}),le.onAdd&&le.onAdd(this,x)}}updateImage(x,l){const m=this.style.getImage(x);if(!m)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const b=l instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&l instanceof s.window.ImageBitmap?s.exported.getImageData(l):l,{width:I,height:P}=b;I!==void 0&&P!==void 0?I===m.data.width&&P===m.data.height?(m.data.replace(b.data,!(l instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&l instanceof s.window.ImageBitmap)),this.style.updateImage(x,m)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${I}, ${P})
                must be that same as the previous version of the image
                (${m.data.width}, ${m.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(x){return x?!!this.style.getImage(x):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(x)}loadImage(x,l){s.getImage(this._requestManager.transformRequest(x,s.ResourceType.Image),((m,b)=>{l(m,b instanceof s.window.HTMLImageElement?s.exported.getImageData(b):b)}))}listImages(){return this.style.listImages()}addLayer(x,l){return this._lazyInitEmptyStyle(),this.style.addLayer(x,l),this._update(!0)}moveLayer(x,l){return this.style.moveLayer(x,l),this._update(!0)}removeLayer(x){return this.style.removeLayer(x),this._update(!0)}getLayer(x){return this.style.getLayer(x)}setLayerZoomRange(x,l,m){return this.style.setLayerZoomRange(x,l,m),this._update(!0)}setFilter(x,l,m={}){return this.style.setFilter(x,l,m),this._update(!0)}getFilter(x){return this.style.getFilter(x)}setPaintProperty(x,l,m,b={}){return this.style.setPaintProperty(x,l,m,b),this._update(!0)}getPaintProperty(x,l){return this.style.getPaintProperty(x,l)}setLayoutProperty(x,l,m,b={}){return this.style.setLayoutProperty(x,l,m,b),this._update(!0)}getLayoutProperty(x,l){return this.style.getLayoutProperty(x,l)}setLight(x,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(x,l),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(x){return this._lazyInitEmptyStyle(),!x&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(x),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(x){return this._lazyInitEmptyStyle(),this.style.setFog(x),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(x){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(x),this.transform):0}setFeatureState(x,l){return this.style.setFeatureState(x,l),this._update()}removeFeatureState(x,l){return this.style.removeFeatureState(x,l),this._update()}getFeatureState(x){return this.style.getFeatureState(x)}_updateContainerDimensions(){if(!this._container)return;const x=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let m,b,I,P=this._container;for(;P&&(!b||!I);){const j=s.window.getComputedStyle(P).transform;j&&j!=="none"&&(m=j.match(/matrix.*\((.+)\)/)[1].split(", "),m[0]&&m[0]!=="0"&&m[0]!=="1"&&(b=m[0]),m[3]&&m[3]!=="0"&&m[3]!=="1"&&(I=m[3])),P=P.parentElement}this._containerWidth=b?Math.abs(x/b):x,this._containerHeight=I?Math.abs(l/I):l}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const x=this._container;x.classList.add("mapboxgl-map"),(this._missingCSSCanary=M("div","mapboxgl-canary",x)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=M("div","mapboxgl-canvas-container",x);this._interactive&&l.classList.add("mapboxgl-interactive"),this._canvas=M("canvas","mapboxgl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const m=this._controlContainer=M("div","mapboxgl-control-container",x),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((I=>{b[I]=M("div",`mapboxgl-ctrl-${I}`,m)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,l){const m=s.exported.devicePixelRatio||1;this._canvas.width=m*Math.ceil(x),this._canvas.height=m*Math.ceil(l),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${l}px`}_addMarker(x){this._markers.push(x)}_removeMarker(x){const l=this._markers.indexOf(x);l!==-1&&this._markers.splice(l,1)}_addPopup(x){this._popups.push(x)}_removePopup(x){const l=this._popups.indexOf(x);l!==-1&&this._popups.splice(l,1)}_setupPainter(){const x=s.extend({},L.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._useWebGL2&&this._canvas.getContext("webgl2",x),m=l||this._canvas.getContext("webgl",x)||this._canvas.getContext("experimental-webgl",x);m?(this._useWebGL2&&!l&&s.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),s.storeAuthState(m,!0),this.painter=new Go(m,this.transform,!!l),this.on("data",(b=>{b.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),s.exported$1.testSupport(m)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(x){x.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:x}))}_contextRestored(x){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:x}))}_onMapScroll(x){if(x.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(x){return this.style?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_requestDomTask(x){!this.loaded()||this.loaded()&&!this.isMoving()?x():this._domRenderTaskQueue.add(x)}_render(x){let l;const m=this.painter.context.extTimerQuery,b=s.exported.now();if(this.listens("gpu-timing-frame")&&(l=m.createQueryEXT(),m.beginQueryEXT(m.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],s.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],s.window.performance.now())),this._renderTaskQueue.run(x),this._domRenderTaskQueue.run(x),this._removed)return;this._updateProjectionTransition();const I=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const W=this.transform.zoom,Z=this.transform.pitch,le=s.exported.now(),ce=new s.EvaluationParameters(W,{now:le,fadeDuration:I,pitch:Z,transition:this.style.getTransition()});this.style.update(ce)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let P=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),P=this._updateAverageElevation(b),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):P=this._updateAverageElevation(b),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,I,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:I,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const W=s.exported.now()-b;m.endQueryEXT(m.TIME_ELAPSED_EXT,l),setTimeout((()=>{const Z=m.getQueryObjectEXT(l,m.QUERY_RESULT_EXT)/1e6;m.deleteQueryEXT(l),this.fire(new s.Event("gpu-timing-frame",{cpuTime:W,gpuTime:Z})),s.window.performance.mark("frame-gpu",{startTime:b,detail:{gpuTime:Z}})}),50)}if(this.listens("gpu-timing-layer")){const W=this.painter.collectGpuTimers();setTimeout((()=>{const Z=this.painter.queryGpuTimers(W);this.fire(new s.Event("gpu-timing-layer",{layerTimes:Z}))}),50)}if(this.listens("gpu-timing-deferred-render")){const W=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const Z=this.painter.queryGpuTimeDeferredRender(W);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:Z}))}),50)}const j=this._sourcesDirty||this._styleDirty||this._placementDirty||P;if(j||this._repaint)this.triggerRepaint();else{const W=!this.isMoving()&&this.loaded();if(W&&(P=this._updateAverageElevation(b,!0)),P)this.triggerRepaint();else if(this._triggerFrame(!1),W&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Z=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:Z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||j||(this._fullyLoaded=!0,s.LivePerformanceUtils.mark(s.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&s.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(x){for(const l of this._markers)x&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!x||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(x,l=!1){const m=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&m(0);if((l||x-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(x)){const b=this.transform.averageElevation;let I=this.transform.sampleAverageElevation(),P=!1;this.transform.elevation&&(P=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(I)?I=0:this._averageElevationLastSampledAt=x;const j=Math.abs(b-I);if(j>1){if(this._isInitialLoad||P)return this._averageElevation.jumpTo(I),m(I);this._averageElevation.easeTo(I,x,300)}else if(j>1e-4)return this._averageElevation.jumpTo(I),m(I)}return!!this._averageElevation.isEasing(x)&&m(this._averageElevation.getValue(x))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(x=>{if(x&&(x.message===s.AUTH_ERR_MSG||x.status===401)){const l=this.painter.context.gl;s.storeAuthState(l,!1),this._logoControl instanceof hh&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const x=this._isDragging();this.painter.updateTerrain(this.style,x)}_calculateSpeedIndex(){const x=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const m=this.painter.context.gl,b=m.createFramebuffer();function I(P){m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,P,0);const j=new Uint8Array(m.drawingBufferWidth*m.drawingBufferHeight*4);return m.readPixels(0,0,m.drawingBufferWidth,m.drawingBufferHeight,m.RGBA,m.UNSIGNED_BYTE,j),j}return m.bindFramebuffer(m.FRAMEBUFFER,b),this._canvasPixelComparison(I(x),l.canvasCopies.map(I),l.timeStamps)}_canvasPixelComparison(x,l,m){let b=m[1]-m[0];const I=x.length/4;for(let P=0;P<l.length;P++){const j=l[P];let W=0;for(let Z=0;Z<j.length;Z+=4)j[Z]===x[Z]&&j[Z+1]===x[Z+1]&&j[Z+2]===x[Z+2]&&j[Z+3]===x[Z+3]&&(W+=1);b+=(m[P+2]-m[P+1])*(1-W/I)}return b}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1),s.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const x=this.painter.context.gl.getExtension("WEBGL_lose_context");x&&x.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(x){this._renderNextFrame=this._renderNextFrame||x,this.style&&!this._frame&&(this._frame=s.exported.frame((l=>{const m=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,m&&this._render(l)})))}_preloadTiles(x){const l=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(l,((m,b)=>m._preloadTiles(x,b)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(x){this._trackResize&&this.resize({originalEvent:x})._update()}_onVisibilityChange(){s.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(x){this._showTerrainWireframe!==x&&(this._showTerrainWireframe=x,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(x){this._speedIndexTiming!==x&&(this._speedIndexTiming=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(x){this._showTileAABBs!==x&&(this._showTileAABBs=x,x&&this._update())}_setCacheLimits(x,l){s.setCacheLimits(x,l)}get version(){return s.version}},NavigationControl:class{constructor(x){this.options=s.extend({},Yt,x),this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(l=>l.preventDefault())),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(l=>{this._map&&this._map.zoomIn({},{originalEvent:l})})),M("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(l=>{this._map&&this._map.zoomOut({},{originalEvent:l})})),M("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(l=>{const m=this._map;m&&(this.options.visualizePitch?m.resetNorthPitch({},{originalEvent:l}):m.resetNorth({},{originalEvent:l}))})),this._compassIcon=M("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const x=this._map;if(!x)return;const l=x.getZoom(),m=l===x.getMaxZoom(),b=l===x.getMinZoom();this._zoomInButton.disabled=m,this._zoomOutButton.disabled=b,this._zoomInButton.setAttribute("aria-disabled",m.toString()),this._zoomOutButton.setAttribute("aria-disabled",b.toString())}_rotateCompassArrow(){const x=this._map;if(!x)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(x.transform.pitch*(Math.PI/180)),.5)}) rotateX(${x.transform.pitch}deg) rotateZ(${x.transform.angle*(180/Math.PI)}deg)`:`rotate(${x.transform.angle*(180/Math.PI)}deg)`;x._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=l)}))}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),x.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&x.on("pitch",this._rotateCompassArrow),x.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new pn(x,this._compass,this.options.visualizePitch)),this._container}onRemove(){const x=this._map;x&&(this._container.remove(),this.options.showZoom&&x.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&x.off("pitch",this._rotateCompassArrow),x.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(x,l){const m=M("button",x,this._container);return m.type="button",m.addEventListener("click",l),m}_setButtonTitle(x,l){if(!this._map)return;const m=this._map._getUIString(`NavigationControl.${l}`);x.setAttribute("aria-label",m),x.firstElementChild&&x.firstElementChild.setAttribute("title",m)}},GeolocateControl:class extends s.Evented{constructor(x){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},Et,x),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Is(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(x){return this._map=x,this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(x){const l=(m=!!this.options.geolocation)=>{this._supportsGeolocation=m,x(m)};this._supportsGeolocation!==void 0?x(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then((m=>l(m.state!=="denied"))).catch((()=>l())):l()}_isOutOfMapMaxBounds(x){const l=this._map.getMaxBounds(),m=x.coords;return!!l&&(m.longitude<l.getWest()||m.longitude>l.getEast()||m.latitude<l.getSouth()||m.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(x){if(this._map){if(this._isOutOfMapMaxBounds(x))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",x)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=x,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(x),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(x),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",x)),this._finish()}}_updateCamera(x){const l=new s.LngLat(x.coords.longitude,x.coords.latitude),m=x.coords.accuracy,b=this._map.getBearing(),I=s.extend({bearing:b},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(m),I,{geolocateSource:!0})}_updateMarker(x){if(x){const l=new s.LngLat(x.coords.longitude,x.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=x.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const x=this._map.transform,l=s.mercatorZfromAltitude(1,x._center.lat)*x.worldSize,m=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(x){if(this._map){if(this.options.trackUserLocation)if(x.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(x.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",x)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(x){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(l=>l.preventDefault())),this._geolocateButton=M("button","mapboxgl-ctrl-geolocate",this._container),M("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",x===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=M("div","mapboxgl-user-location"),this._dotElement.appendChild(M("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(M("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new pe({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=M("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new pe({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))}))}}_onDeviceOrientation(x){this._userLocationDotMarker&&(x.webkitCompassHeading?this._heading=x.webkitCompassHeading:x.absolute===!0&&(this._heading=-1*x.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(x={maximumAge:6e5,timeout:0},this._noTimeout=!0):(x=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,x),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const x=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((l=>{l==="granted"&&x()})).catch(console.error):x()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Cr,ScaleControl:class{constructor(x){this.options=s.extend({},Qt,x),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const x=this.options.maxWidth||100,l=this._map,m=l._containerHeight/2,b=l._containerWidth/2-x/2,I=l.unproject([b,m]),P=l.unproject([b+x,m]),j=I.distanceTo(P);if(this.options.unit==="imperial"){const W=3.2808*j;W>5280?this._setScale(x,W/5280,"mile"):this._setScale(x,W,"foot")}else this.options.unit==="nautical"?this._setScale(x,j/1852,"nautical-mile"):j>=1e3?this._setScale(x,j/1e3,"kilometer"):this._setScale(x,j,"meter")}_setScale(x,l,m){this._map._requestDomTask((()=>{const b=(function(P){const j=Math.pow(10,`${Math.floor(P)}`.length-1);let W=P/j;return W=W>=10?10:W>=5?5:W>=3?3:W>=2?2:W>=1?1:(function(Z){const le=Math.pow(10,Math.ceil(-Math.log(Z)/Math.LN10));return Math.round(Z*le)/le})(W),j*W})(l),I=b/l;this._container.innerHTML=this._isNumberFormatSupported&&m!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:m}).format(b):`${b}&nbsp;${gn[m]}`,this._container.style.width=x*I+"px"}))}onAdd(x){return this._map=x,this._language=x.getLanguage(),this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-scale",x.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(x){this._language=x,this._update()}setUnit(x){this.options.unit=x,this._update()}},FullscreenControl:class{constructor(x){this._fullscreen=!1,x&&x.container&&(x.container instanceof s.window.HTMLElement?this._container=x.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=M("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const x=this._fullscreenButton=M("button","mapboxgl-ctrl-fullscreen",this._controlContainer);M("span","mapboxgl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",x)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(x){super(),this.options=s.extend(Object.create(Ge),x),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(x&&x.className?x.className.trim().split(/\s+/):[])}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&x.on("preclick",this._onClose),this.options.closeOnMove&&x.on("move",this._onClose),x.on("remove",this.remove),this._update(),x._addPopup(this),this._focusFirstElement(),this._trackPointer?(x.on("mousemove",this._onMouseEvent),x.on("mouseup",this._onMouseEvent),x._canvasContainer.classList.add("mapboxgl-track-pointer")):x.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const x=this._map;return x&&(x.off("move",this._update),x.off("move",this._onClose),x.off("preclick",this._onClose),x.off("click",this._onClose),x.off("remove",this.remove),x.off("mousemove",this._onMouseEvent),x.off("mouseup",this._onMouseEvent),x.off("drag",this._onMouseEvent),x._canvasContainer&&x._canvasContainer.classList.remove("mapboxgl-track-pointer"),x._removePopup(this),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(x){this._lngLat=s.LngLat.convert(x),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const x=this._map;return x&&(x.off("move",this._update),x.on("mousemove",this._onMouseEvent),x.on("drag",this._onMouseEvent),x._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(s.window.document.createTextNode(x))}setHTML(x){const l=s.window.document.createDocumentFragment(),m=s.window.document.createElement("body");let b;for(m.innerHTML=x;b=m.firstChild,b;)l.appendChild(b);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=M("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(x),this.options.closeButton){const m=this._closeButton=M("button","mapboxgl-popup-close-button",l);m.type="button",m.setAttribute("aria-label","Close popup"),m.setAttribute("aria-hidden","true"),m.innerHTML="&#215;",m.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(x){return this._classList.add(x),this._updateClassList(),this}removeClassName(x){return this._classList.delete(x),this._updateClassList(),this}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){let l;return this._classList.delete(x)?l=!1:(this._classList.add(x),l=!0),this._updateClassList(),l}_onMouseEvent(x){this._update(x.point)}_getAnchor(x){if(this.options.anchor)return this.options.anchor;const l=this._map,m=this._container,b=this._pos;if(!l||!m||!b)return"bottom";const I=m.offsetWidth,P=m.offsetHeight,j=b.x<I/2,W=b.x>l.transform.width-I/2;if(b.y+x<P)return j?"top-left":W?"top-right":"top";if(b.y>l.transform.height-P){if(j)return"bottom-left";if(W)return"bottom-right"}return j?"left":W?"right":"bottom"}_updateClassList(){const x=this._container;if(!x)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),x.className=l.join(" ")}_update(x){const l=this._map,m=this._content;if(!l||!this._lngLat&&!this._trackPointer||!m)return;let b=this._container;if(b||(b=this._container=M("div","mapboxgl-popup",l.getContainer()),this._tip=M("div","mapboxgl-popup-tip",b),b.appendChild(m)),this.options.maxWidth&&b.style.maxWidth!==this.options.maxWidth&&(b.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=H(this._lngLat,this._pos,l.transform)),!this._trackPointer||x){const I=this._pos=this._trackPointer&&x?x:l.project(this._lngLat),P=it(this.options.offset),j=this._anchor=this._getAnchor(P.y),W=it(this.options.offset,j),Z=I.add(W).round();l._requestDomTask((()=>{this._container&&j&&(this._container.style.transform=`${ue[j]} translate(${Z.x}px,${Z.y}px)`)}))}if(!this._marker&&l._showingGlobe()){const I=s.isLngLatBehindGlobe(l.transform,this._lngLat)?0:1;this._setOpacity(I)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(tt);x&&x.focus()}_onClose(){this.remove()}_setOpacity(x){this._container&&(this._container.style.opacity=`${x}`),this._content&&(this._content.style.pointerEvents=x?"auto":"none")}},Marker:pe,Style:ji,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:Xa,Evented:s.Evented,config:s.config,prewarm:function(){ua().acquire(vo)},clearPrewarmedResources:function(){const x=xo;x&&(x.isPreloaded()&&x.numActive()===1?(x.release(vo),xo=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(x){s.config.ACCESS_TOKEN=x},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(x){s.config.API_URL=x},get workerCount(){return is.workerCount},set workerCount(x){is.workerCount=x},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(x){s.config.MAX_PARALLEL_IMAGE_REQUESTS=x},clearStorage(x){s.clearTileCache(x)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return Bn}));var y=c;return y}))})(ov)),ov.exports}var BN=FN();const zf=M_(BN),zN="modulepreload",jN=function(n){return"/StakeholderMap/"+n},gS={},$b=function(e,t,i){let a=Promise.resolve();if(t&&t.length>0){let s=function(T){return Promise.all(T.map(L=>Promise.resolve(L).then(R=>({status:"fulfilled",value:R}),R=>({status:"rejected",reason:R}))))};document.getElementsByTagName("link");const _=document.querySelector("meta[property=csp-nonce]"),y=_?.nonce||_?.getAttribute("nonce");a=s(t.map(T=>{if(T=jN(T),T in gS)return;gS[T]=!0;const L=T.endsWith(".css"),R=L?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${T}"]${R}`))return;const U=document.createElement("link");if(U.rel=L?"stylesheet":zN,L||(U.as="script"),U.crossOrigin="",U.href=T,y&&U.setAttribute("nonce",y),document.head.appendChild(U),L)return new Promise((M,Q)=>{U.addEventListener("load",M),U.addEventListener("error",()=>Q(new Error(`Unable to preload CSS for ${T}`)))})}))}function c(_){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=_,window.dispatchEvent(y),!y.defaultPrevented)throw _}return a.then(_=>{for(const y of _||[])y.status==="rejected"&&c(y.reason);return e().catch(c)})};function dl(n){"@babel/helpers - typeof";return dl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dl(n)}var pd=Uint8Array,Sf=Uint16Array,s3=Int32Array,o3=new pd([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a3=new pd([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),yS=new pd([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sC=function(n,e){for(var t=new Sf(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var a=new s3(t[30]),i=1;i<30;++i)for(var c=t[i];c<t[i+1];++c)a[c]=c-t[i]<<5|i;return{b:t,r:a}},oC=sC(o3,2),UN=oC.b,Jw=oC.r;UN[28]=258,Jw[258]=28;var VN=sC(a3,0),_S=VN.r,Qw=new Sf(32768);for(var su=0;su<32768;++su){var Zp=(su&43690)>>1|(su&21845)<<1;Zp=(Zp&52428)>>2|(Zp&13107)<<2,Zp=(Zp&61680)>>4|(Zp&3855)<<4,Qw[su]=((Zp&65280)>>8|(Zp&255)<<8)>>1}var i_=(function(n,e,t){for(var i=n.length,a=0,c=new Sf(e);a<i;++a)n[a]&&++c[n[a]-1];var _=new Sf(e);for(a=1;a<e;++a)_[a]=_[a-1]+c[a-1]<<1;var y;if(t){y=new Sf(1<<e);var s=15-e;for(a=0;a<i;++a)if(n[a])for(var T=a<<4|n[a],L=e-n[a],R=_[n[a]-1]++<<L,U=R|(1<<L)-1;R<=U;++R)y[Qw[R]>>s]=T}else for(y=new Sf(i),a=0;a<i;++a)n[a]&&(y[a]=Qw[_[n[a]-1]++]>>15-n[a]);return y}),cg=new pd(288);for(var su=0;su<144;++su)cg[su]=8;for(var su=144;su<256;++su)cg[su]=9;for(var su=256;su<280;++su)cg[su]=7;for(var su=280;su<288;++su)cg[su]=8;var Fv=new pd(32);for(var su=0;su<32;++su)Fv[su]=5;var qN=i_(cg,9,0),GN=i_(Fv,5,0),aC=function(n){return(n+7)/8|0},$N=function(n,e,t){return(t==null||t>n.length)&&(t=n.length),new pd(n.subarray(e,t))},yp=function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>8},O0=function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>8,n[i+2]|=t>>16},Hb=function(n,e){for(var t=[],i=0;i<n.length;++i)n[i]&&t.push({s:i,f:n[i]});var a=t.length,c=t.slice();if(!a)return{t:uC,l:0};if(a==1){var _=new pd(t[0].s+1);return _[t[0].s]=1,{t:_,l:1}}t.sort(function(Pe,Be){return Pe.f-Be.f}),t.push({s:-1,f:25001});var y=t[0],s=t[1],T=0,L=1,R=2;for(t[0]={s:-1,f:y.f+s.f,l:y,r:s};L!=a-1;)y=t[t[T].f<t[R].f?T++:R++],s=t[T!=L&&t[T].f<t[R].f?T++:R++],t[L++]={s:-1,f:y.f+s.f,l:y,r:s};for(var U=c[0].s,i=1;i<a;++i)c[i].s>U&&(U=c[i].s);var M=new Sf(U+1),Q=e5(t[L-1],M,0);if(Q>e){var i=0,ae=0,ye=Q-e,ie=1<<ye;for(c.sort(function(Be,_e){return M[_e.s]-M[Be.s]||Be.f-_e.f});i<a;++i){var oe=c[i].s;if(M[oe]>e)ae+=ie-(1<<Q-M[oe]),M[oe]=e;else break}for(ae>>=ye;ae>0;){var ve=c[i].s;M[ve]<e?ae-=1<<e-M[ve]++-1:++i}for(;i>=0&&ae;--i){var de=c[i].s;M[de]==e&&(--M[de],++ae)}Q=e}return{t:new pd(M),l:Q}},e5=function(n,e,t){return n.s==-1?Math.max(e5(n.l,e,t+1),e5(n.r,e,t+1)):e[n.s]=t},vS=function(n){for(var e=n.length;e&&!n[--e];);for(var t=new Sf(++e),i=0,a=n[0],c=1,_=function(s){t[i++]=s},y=1;y<=e;++y)if(n[y]==a&&y!=e)++c;else{if(!a&&c>2){for(;c>138;c-=138)_(32754);c>2&&(_(c>10?c-11<<5|28690:c-3<<5|12305),c=0)}else if(c>3){for(_(a),--c;c>6;c-=6)_(8304);c>2&&(_(c-3<<5|8208),c=0)}for(;c--;)_(a);c=1,a=n[y]}return{c:t.subarray(0,i),n:e}},F0=function(n,e){for(var t=0,i=0;i<e.length;++i)t+=n[i]*e[i];return t},lC=function(n,e,t){var i=t.length,a=aC(e+2);n[a]=i&255,n[a+1]=i>>8,n[a+2]=n[a]^255,n[a+3]=n[a+1]^255;for(var c=0;c<i;++c)n[a+c+4]=t[c];return(a+4+i)*8},xS=function(n,e,t,i,a,c,_,y,s,T,L){yp(e,L++,t),++a[256];for(var R=Hb(a,15),U=R.t,M=R.l,Q=Hb(c,15),ae=Q.t,ye=Q.l,ie=vS(U),oe=ie.c,ve=ie.n,de=vS(ae),Pe=de.c,Be=de.n,_e=new Sf(19),G=0;G<oe.length;++G)++_e[oe[G]&31];for(var G=0;G<Pe.length;++G)++_e[Pe[G]&31];for(var B=Hb(_e,7),Y=B.t,$=B.l,J=19;J>4&&!Y[yS[J-1]];--J);var te=T+5<<3,Se=F0(a,cg)+F0(c,Fv)+_,De=F0(a,U)+F0(c,ae)+_+14+3*J+F0(_e,Y)+2*_e[16]+3*_e[17]+7*_e[18];if(s>=0&&te<=Se&&te<=De)return lC(e,L,n.subarray(s,s+T));var $e,Ue,Le,He;if(yp(e,L,1+(De<Se)),L+=2,De<Se){$e=i_(U,M,0),Ue=U,Le=i_(ae,ye,0),He=ae;var Ke=i_(Y,$,0);yp(e,L,ve-257),yp(e,L+5,Be-1),yp(e,L+10,J-4),L+=14;for(var G=0;G<J;++G)yp(e,L+3*G,Y[yS[G]]);L+=3*J;for(var Ce=[oe,Pe],ge=0;ge<2;++ge)for(var We=Ce[ge],G=0;G<We.length;++G){var Ve=We[G]&31;yp(e,L,Ke[Ve]),L+=Y[Ve],Ve>15&&(yp(e,L,We[G]>>5&127),L+=We[G]>>12)}}else $e=qN,Ue=cg,Le=GN,He=Fv;for(var G=0;G<y;++G){var ut=i[G];if(ut>255){var Ve=ut>>18&31;O0(e,L,$e[Ve+257]),L+=Ue[Ve+257],Ve>7&&(yp(e,L,ut>>23&31),L+=o3[Ve]);var pt=ut&31;O0(e,L,Le[pt]),L+=He[pt],pt>3&&(O0(e,L,ut>>5&8191),L+=a3[pt])}else O0(e,L,$e[ut]),L+=Ue[ut]}return O0(e,L,$e[256]),L+Ue[256]},HN=new s3([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),uC=new pd(0),WN=function(n,e,t,i,a,c){var _=c.z||n.length,y=new pd(i+_+5*(1+Math.ceil(_/7e3))+a),s=y.subarray(i,y.length-a),T=c.l,L=(c.r||0)&7;if(e){L&&(s[0]=c.r>>3);for(var R=HN[e-1],U=R>>13,M=R&8191,Q=(1<<t)-1,ae=c.p||new Sf(32768),ye=c.h||new Sf(Q+1),ie=Math.ceil(t/3),oe=2*ie,ve=function(on){return(n[on]^n[on+1]<<ie^n[on+2]<<oe)&Q},de=new s3(25e3),Pe=new Sf(288),Be=new Sf(32),_e=0,G=0,B=c.i||0,Y=0,$=c.w||0,J=0;B+2<_;++B){var te=ve(B),Se=B&32767,De=ye[te];if(ae[Se]=De,ye[te]=Se,$<=B){var $e=_-B;if((_e>7e3||Y>24576)&&($e>423||!T)){L=xS(n,s,0,de,Pe,Be,G,Y,J,B-J,L),Y=_e=G=0,J=B;for(var Ue=0;Ue<286;++Ue)Pe[Ue]=0;for(var Ue=0;Ue<30;++Ue)Be[Ue]=0}var Le=2,He=0,Ke=M,Ce=Se-De&32767;if($e>2&&te==ve(B-Ce))for(var ge=Math.min(U,$e)-1,We=Math.min(32767,B),Ve=Math.min(258,$e);Ce<=We&&--Ke&&Se!=De;){if(n[B+Le]==n[B+Le-Ce]){for(var ut=0;ut<Ve&&n[B+ut]==n[B+ut-Ce];++ut);if(ut>Le){if(Le=ut,He=Ce,ut>ge)break;for(var pt=Math.min(Ce,ut-2),It=0,Ue=0;Ue<pt;++Ue){var Oe=B-Ce+Ue&32767,Wt=ae[Oe],Zt=Oe-Wt&32767;Zt>It&&(It=Zt,De=Oe)}}}Se=De,De=ae[Se],Ce+=Se-De&32767}if(He){de[Y++]=268435456|Jw[Le]<<18|_S[He];var Xt=Jw[Le]&31,Ze=_S[He]&31;G+=o3[Xt]+a3[Ze],++Pe[257+Xt],++Be[Ze],$=B+Le,++_e}else de[Y++]=n[B],++Pe[n[B]]}}for(B=Math.max(B,$);B<_;++B)de[Y++]=n[B],++Pe[n[B]];L=xS(n,s,T,de,Pe,Be,G,Y,J,B-J,L),T||(c.r=L&7|s[L/8|0]<<3,L-=7,c.h=ye,c.p=ae,c.i=B,c.w=$)}else{for(var B=c.w||0;B<_+T;B+=65535){var zn=B+65535;zn>=_&&(s[L/8|0]=T,zn=_),L=lC(s,L+1,n.subarray(B,zn))}c.i=_}return $N(y,0,i+aC(L)+a)},cC=function(){var n=1,e=0;return{p:function(t){for(var i=n,a=e,c=t.length|0,_=0;_!=c;){for(var y=Math.min(_+2655,c);_<y;++_)a+=i+=t[_];i=(i&65535)+15*(i>>16),a=(a&65535)+15*(a>>16)}n=i,e=a},d:function(){return n%=65521,e%=65521,(n&255)<<24|(n&65280)<<8|(e&255)<<8|e>>8}}},XN=function(n,e,t,i,a){if(!a&&(a={l:1},e.dictionary)){var c=e.dictionary.subarray(-32768),_=new pd(c.length+n.length);_.set(c),_.set(n,c.length),n=_,a.w=c.length}return WN(n,e.level==null?6:e.level,e.mem==null?a.l?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):20:12+e.mem,t,i,a)},hC=function(n,e,t){for(;t;++e)n[e]=t,t>>>=8},YN=function(n,e){var t=e.level,i=t==0?0:t<6?1:t==9?3:2;if(n[0]=120,n[1]=i<<6|(e.dictionary&&32),n[1]|=31-(n[0]<<8|n[1])%31,e.dictionary){var a=cC();a.p(e.dictionary),hC(n,2,a.d())}};function t5(n,e){e||(e={});var t=cC();t.p(n);var i=XN(n,e,e.dictionary?6:2,4);return YN(i,e),hC(i,i.length-4,t.d()),i}var KN=typeof TextDecoder<"u"&&new TextDecoder,ZN=0;try{KN.decode(uC,{stream:!0}),ZN=1}catch{}function JN(n){if(Array.isArray(n))return n}function QN(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,a,c,_,y=[],s=!0,T=!1;try{if(c=(t=t.call(n)).next,e!==0)for(;!(s=(i=c.call(t)).done)&&(y.push(i.value),y.length!==e);s=!0);}catch(L){T=!0,a=L}finally{try{if(!s&&t.return!=null&&(_=t.return(),Object(_)!==_))return}finally{if(T)throw a}}return y}}function bS(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function eR(n,e){if(n){if(typeof n=="string")return bS(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?bS(n,e):void 0}}function tR(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wS(n,e){return JN(n)||QN(n,e)||eR(n,e)||tR()}function SS(n,e="utf8"){return new TextDecoder(e).decode(n)}const nR=new TextEncoder;function rR(n){return nR.encode(n)}const iR=1024*8,sR=(()=>{const n=new Uint8Array(4),e=new Uint32Array(n.buffer);return!((e[0]=1)&n[0])})(),Wb={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class l3{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(e=iR,t={}){let i=!1;typeof e=="number"?e=new ArrayBuffer(e):(i=!0,this.lastWrittenByte=e.byteLength);const a=t.offset?t.offset>>>0:0,c=e.byteLength-a;let _=a;(ArrayBuffer.isView(e)||e instanceof l3)&&(e.byteLength!==e.buffer.byteLength&&(_=e.byteOffset+a),e=e.buffer),i?this.lastWrittenByte=c:this.lastWrittenByte=0,this.buffer=e,this.length=c,this.byteLength=c,this.byteOffset=_,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,_,c),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const i=(this.offset+e)*2,a=new Uint8Array(i);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=i,this.byteLength=i,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const i=Wb[t].BYTES_PER_ELEMENT*e,a=this.byteOffset+this.offset,c=this.buffer.slice(a,a+i);if(this.littleEndian===sR&&t!=="uint8"&&t!=="int8"){const y=new Uint8Array(this.buffer.slice(a,a+i));y.reverse();const s=new Wb[t](y.buffer);return this.offset+=i,s.reverse(),s}const _=new Wb[t](c);return this.offset+=i,_}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let i=0;i<e;i++)t+=this.readChar();return t}readUtf8(e=1){return SS(this.readBytes(e))}decodeText(e=1,t="utf8"){return SS(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(rR(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function Xy(n){let e=n.length;for(;--e>=0;)n[e]=0}const oR=3,aR=258,fC=29,lR=256,uR=lR+1+fC,dC=30,cR=512,hR=new Array((uR+2)*2);Xy(hR);const fR=new Array(dC*2);Xy(fR);const dR=new Array(cR);Xy(dR);const pR=new Array(aR-oR+1);Xy(pR);const mR=new Array(fC);Xy(mR);const gR=new Array(dC);Xy(gR);const yR=(n,e,t,i)=>{let a=n&65535|0,c=n>>>16&65535|0,_=0;for(;t!==0;){_=t>2e3?2e3:t,t-=_;do a=a+e[i++]|0,c=c+a|0;while(--_);a%=65521,c%=65521}return a|c<<16|0};var n5=yR;const _R=()=>{let n,e=[];for(var t=0;t<256;t++){n=t;for(var i=0;i<8;i++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e},vR=new Uint32Array(_R()),xR=(n,e,t,i)=>{const a=vR,c=i+t;n^=-1;for(let _=i;_<c;_++)n=n>>>8^a[(n^e[_])&255];return n^-1};var kd=xR,r5={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},pC={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const bR=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var wR=function(n){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const i in t)bR(t,i)&&(n[i]=t[i])}}return n},SR=n=>{let e=0;for(let i=0,a=n.length;i<a;i++)e+=n[i].length;const t=new Uint8Array(e);for(let i=0,a=0,c=n.length;i<c;i++){let _=n[i];t.set(_,a),a+=_.length}return t},mC={assign:wR,flattenChunks:SR};let gC=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{gC=!1}const x_=new Uint8Array(256);for(let n=0;n<256;n++)x_[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;x_[254]=x_[254]=1;var ER=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let e,t,i,a,c,_=n.length,y=0;for(a=0;a<_;a++)t=n.charCodeAt(a),(t&64512)===55296&&a+1<_&&(i=n.charCodeAt(a+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),a++)),y+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(y),c=0,a=0;c<y;a++)t=n.charCodeAt(a),(t&64512)===55296&&a+1<_&&(i=n.charCodeAt(a+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),a++)),t<128?e[c++]=t:t<2048?(e[c++]=192|t>>>6,e[c++]=128|t&63):t<65536?(e[c++]=224|t>>>12,e[c++]=128|t>>>6&63,e[c++]=128|t&63):(e[c++]=240|t>>>18,e[c++]=128|t>>>12&63,e[c++]=128|t>>>6&63,e[c++]=128|t&63);return e};const TR=(n,e)=>{if(e<65534&&n.subarray&&gC)return String.fromCharCode.apply(null,n.length===e?n:n.subarray(0,e));let t="";for(let i=0;i<e;i++)t+=String.fromCharCode(n[i]);return t};var AR=(n,e)=>{const t=e||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,e));let i,a;const c=new Array(t*2);for(a=0,i=0;i<t;){let _=n[i++];if(_<128){c[a++]=_;continue}let y=x_[_];if(y>4){c[a++]=65533,i+=y-1;continue}for(_&=y===2?31:y===3?15:7;y>1&&i<t;)_=_<<6|n[i++]&63,y--;if(y>1){c[a++]=65533;continue}_<65536?c[a++]=_:(_-=65536,c[a++]=55296|_>>10&1023,c[a++]=56320|_&1023)}return TR(c,a)},IR=(n,e)=>{e=e||n.length,e>n.length&&(e=n.length);let t=e-1;for(;t>=0&&(n[t]&192)===128;)t--;return t<0||t===0?e:t+x_[n[t]]>e?t:e},i5={string2buf:ER,buf2string:AR,utf8border:IR};function CR(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var kR=CR;const C1=16209,LR=16191;var PR=function(e,t){let i,a,c,_,y,s,T,L,R,U,M,Q,ae,ye,ie,oe,ve,de,Pe,Be,_e,G,B,Y;const $=e.state;i=e.next_in,B=e.input,a=i+(e.avail_in-5),c=e.next_out,Y=e.output,_=c-(t-e.avail_out),y=c+(e.avail_out-257),s=$.dmax,T=$.wsize,L=$.whave,R=$.wnext,U=$.window,M=$.hold,Q=$.bits,ae=$.lencode,ye=$.distcode,ie=(1<<$.lenbits)-1,oe=(1<<$.distbits)-1;e:do{Q<15&&(M+=B[i++]<<Q,Q+=8,M+=B[i++]<<Q,Q+=8),ve=ae[M&ie];t:for(;;){if(de=ve>>>24,M>>>=de,Q-=de,de=ve>>>16&255,de===0)Y[c++]=ve&65535;else if(de&16){Pe=ve&65535,de&=15,de&&(Q<de&&(M+=B[i++]<<Q,Q+=8),Pe+=M&(1<<de)-1,M>>>=de,Q-=de),Q<15&&(M+=B[i++]<<Q,Q+=8,M+=B[i++]<<Q,Q+=8),ve=ye[M&oe];n:for(;;){if(de=ve>>>24,M>>>=de,Q-=de,de=ve>>>16&255,de&16){if(Be=ve&65535,de&=15,Q<de&&(M+=B[i++]<<Q,Q+=8,Q<de&&(M+=B[i++]<<Q,Q+=8)),Be+=M&(1<<de)-1,Be>s){e.msg="invalid distance too far back",$.mode=C1;break e}if(M>>>=de,Q-=de,de=c-_,Be>de){if(de=Be-de,de>L&&$.sane){e.msg="invalid distance too far back",$.mode=C1;break e}if(_e=0,G=U,R===0){if(_e+=T-de,de<Pe){Pe-=de;do Y[c++]=U[_e++];while(--de);_e=c-Be,G=Y}}else if(R<de){if(_e+=T+R-de,de-=R,de<Pe){Pe-=de;do Y[c++]=U[_e++];while(--de);if(_e=0,R<Pe){de=R,Pe-=de;do Y[c++]=U[_e++];while(--de);_e=c-Be,G=Y}}}else if(_e+=R-de,de<Pe){Pe-=de;do Y[c++]=U[_e++];while(--de);_e=c-Be,G=Y}for(;Pe>2;)Y[c++]=G[_e++],Y[c++]=G[_e++],Y[c++]=G[_e++],Pe-=3;Pe&&(Y[c++]=G[_e++],Pe>1&&(Y[c++]=G[_e++]))}else{_e=c-Be;do Y[c++]=Y[_e++],Y[c++]=Y[_e++],Y[c++]=Y[_e++],Pe-=3;while(Pe>2);Pe&&(Y[c++]=Y[_e++],Pe>1&&(Y[c++]=Y[_e++]))}}else if((de&64)===0){ve=ye[(ve&65535)+(M&(1<<de)-1)];continue n}else{e.msg="invalid distance code",$.mode=C1;break e}break}}else if((de&64)===0){ve=ae[(ve&65535)+(M&(1<<de)-1)];continue t}else if(de&32){$.mode=LR;break e}else{e.msg="invalid literal/length code",$.mode=C1;break e}break}}while(i<a&&c<y);Pe=Q>>3,i-=Pe,Q-=Pe<<3,M&=(1<<Q)-1,e.next_in=i,e.next_out=c,e.avail_in=i<a?5+(a-i):5-(i-a),e.avail_out=c<y?257+(y-c):257-(c-y),$.hold=M,$.bits=Q};const ey=15,ES=852,TS=592,AS=0,Xb=1,IS=2,NR=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),RR=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),MR=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),DR=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),OR=(n,e,t,i,a,c,_,y)=>{const s=y.bits;let T=0,L=0,R=0,U=0,M=0,Q=0,ae=0,ye=0,ie=0,oe=0,ve,de,Pe,Be,_e,G=null,B;const Y=new Uint16Array(ey+1),$=new Uint16Array(ey+1);let J=null,te,Se,De;for(T=0;T<=ey;T++)Y[T]=0;for(L=0;L<i;L++)Y[e[t+L]]++;for(M=s,U=ey;U>=1&&Y[U]===0;U--);if(M>U&&(M=U),U===0)return a[c++]=1<<24|64<<16|0,a[c++]=1<<24|64<<16|0,y.bits=1,0;for(R=1;R<U&&Y[R]===0;R++);for(M<R&&(M=R),ye=1,T=1;T<=ey;T++)if(ye<<=1,ye-=Y[T],ye<0)return-1;if(ye>0&&(n===AS||U!==1))return-1;for($[1]=0,T=1;T<ey;T++)$[T+1]=$[T]+Y[T];for(L=0;L<i;L++)e[t+L]!==0&&(_[$[e[t+L]]++]=L);if(n===AS?(G=J=_,B=20):n===Xb?(G=NR,J=RR,B=257):(G=MR,J=DR,B=0),oe=0,L=0,T=R,_e=c,Q=M,ae=0,Pe=-1,ie=1<<M,Be=ie-1,n===Xb&&ie>ES||n===IS&&ie>TS)return 1;for(;;){te=T-ae,_[L]+1<B?(Se=0,De=_[L]):_[L]>=B?(Se=J[_[L]-B],De=G[_[L]-B]):(Se=96,De=0),ve=1<<T-ae,de=1<<Q,R=de;do de-=ve,a[_e+(oe>>ae)+de]=te<<24|Se<<16|De|0;while(de!==0);for(ve=1<<T-1;oe&ve;)ve>>=1;if(ve!==0?(oe&=ve-1,oe+=ve):oe=0,L++,--Y[T]===0){if(T===U)break;T=e[t+_[L]]}if(T>M&&(oe&Be)!==Pe){for(ae===0&&(ae=M),_e+=R,Q=T-ae,ye=1<<Q;Q+ae<U&&(ye-=Y[Q+ae],!(ye<=0));)Q++,ye<<=1;if(ie+=1<<Q,n===Xb&&ie>ES||n===IS&&ie>TS)return 1;Pe=oe&Be,a[Pe]=M<<24|Q<<16|_e-c|0}}return oe!==0&&(a[_e+oe]=T-ae<<24|64<<16|0),y.bits=M,0};var s_=OR;const FR=0,yC=1,_C=2,{Z_FINISH:CS,Z_BLOCK:BR,Z_TREES:k1,Z_OK:hg,Z_STREAM_END:zR,Z_NEED_DICT:jR,Z_STREAM_ERROR:$f,Z_DATA_ERROR:vC,Z_MEM_ERROR:xC,Z_BUF_ERROR:UR,Z_DEFLATED:kS}=pC,Lx=16180,LS=16181,PS=16182,NS=16183,RS=16184,MS=16185,DS=16186,OS=16187,FS=16188,BS=16189,Bv=16190,_p=16191,Yb=16192,zS=16193,Kb=16194,jS=16195,US=16196,VS=16197,qS=16198,L1=16199,P1=16200,GS=16201,$S=16202,HS=16203,WS=16204,XS=16205,Zb=16206,YS=16207,KS=16208,pu=16209,bC=16210,wC=16211,VR=852,qR=592,GR=15,$R=GR,ZS=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function HR(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const wg=n=>{if(!n)return 1;const e=n.state;return!e||e.strm!==n||e.mode<Lx||e.mode>wC?1:0},SC=n=>{if(wg(n))return $f;const e=n.state;return n.total_in=n.total_out=e.total=0,n.msg="",e.wrap&&(n.adler=e.wrap&1),e.mode=Lx,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(VR),e.distcode=e.distdyn=new Int32Array(qR),e.sane=1,e.back=-1,hg},EC=n=>{if(wg(n))return $f;const e=n.state;return e.wsize=0,e.whave=0,e.wnext=0,SC(n)},TC=(n,e)=>{let t;if(wg(n))return $f;const i=n.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?$f:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,EC(n))},AC=(n,e)=>{if(!n)return $f;const t=new HR;n.state=t,t.strm=n,t.window=null,t.mode=Lx;const i=TC(n,e);return i!==hg&&(n.state=null),i},WR=n=>AC(n,$R);let JS=!0,Jb,Qb;const XR=n=>{if(JS){Jb=new Int32Array(512),Qb=new Int32Array(32);let e=0;for(;e<144;)n.lens[e++]=8;for(;e<256;)n.lens[e++]=9;for(;e<280;)n.lens[e++]=7;for(;e<288;)n.lens[e++]=8;for(s_(yC,n.lens,0,288,Jb,0,n.work,{bits:9}),e=0;e<32;)n.lens[e++]=5;s_(_C,n.lens,0,32,Qb,0,n.work,{bits:5}),JS=!1}n.lencode=Jb,n.lenbits=9,n.distcode=Qb,n.distbits=5},IC=(n,e,t,i)=>{let a;const c=n.state;return c.window===null&&(c.wsize=1<<c.wbits,c.wnext=0,c.whave=0,c.window=new Uint8Array(c.wsize)),i>=c.wsize?(c.window.set(e.subarray(t-c.wsize,t),0),c.wnext=0,c.whave=c.wsize):(a=c.wsize-c.wnext,a>i&&(a=i),c.window.set(e.subarray(t-i,t-i+a),c.wnext),i-=a,i?(c.window.set(e.subarray(t-i,t),0),c.wnext=i,c.whave=c.wsize):(c.wnext+=a,c.wnext===c.wsize&&(c.wnext=0),c.whave<c.wsize&&(c.whave+=a))),0},YR=(n,e)=>{let t,i,a,c,_,y,s,T,L,R,U,M,Q,ae,ye=0,ie,oe,ve,de,Pe,Be,_e,G;const B=new Uint8Array(4);let Y,$;const J=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(wg(n)||!n.output||!n.input&&n.avail_in!==0)return $f;t=n.state,t.mode===_p&&(t.mode=Yb),_=n.next_out,a=n.output,s=n.avail_out,c=n.next_in,i=n.input,y=n.avail_in,T=t.hold,L=t.bits,R=y,U=s,G=hg;e:for(;;)switch(t.mode){case Lx:if(t.wrap===0){t.mode=Yb;break}for(;L<16;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}if(t.wrap&2&&T===35615){t.wbits===0&&(t.wbits=15),t.check=0,B[0]=T&255,B[1]=T>>>8&255,t.check=kd(t.check,B,2,0),T=0,L=0,t.mode=LS;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((T&255)<<8)+(T>>8))%31){n.msg="incorrect header check",t.mode=pu;break}if((T&15)!==kS){n.msg="unknown compression method",t.mode=pu;break}if(T>>>=4,L-=4,_e=(T&15)+8,t.wbits===0&&(t.wbits=_e),_e>15||_e>t.wbits){n.msg="invalid window size",t.mode=pu;break}t.dmax=1<<t.wbits,t.flags=0,n.adler=t.check=1,t.mode=T&512?BS:_p,T=0,L=0;break;case LS:for(;L<16;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}if(t.flags=T,(t.flags&255)!==kS){n.msg="unknown compression method",t.mode=pu;break}if(t.flags&57344){n.msg="unknown header flags set",t.mode=pu;break}t.head&&(t.head.text=T>>8&1),t.flags&512&&t.wrap&4&&(B[0]=T&255,B[1]=T>>>8&255,t.check=kd(t.check,B,2,0)),T=0,L=0,t.mode=PS;case PS:for(;L<32;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}t.head&&(t.head.time=T),t.flags&512&&t.wrap&4&&(B[0]=T&255,B[1]=T>>>8&255,B[2]=T>>>16&255,B[3]=T>>>24&255,t.check=kd(t.check,B,4,0)),T=0,L=0,t.mode=NS;case NS:for(;L<16;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}t.head&&(t.head.xflags=T&255,t.head.os=T>>8),t.flags&512&&t.wrap&4&&(B[0]=T&255,B[1]=T>>>8&255,t.check=kd(t.check,B,2,0)),T=0,L=0,t.mode=RS;case RS:if(t.flags&1024){for(;L<16;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}t.length=T,t.head&&(t.head.extra_len=T),t.flags&512&&t.wrap&4&&(B[0]=T&255,B[1]=T>>>8&255,t.check=kd(t.check,B,2,0)),T=0,L=0}else t.head&&(t.head.extra=null);t.mode=MS;case MS:if(t.flags&1024&&(M=t.length,M>y&&(M=y),M&&(t.head&&(_e=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(c,c+M),_e)),t.flags&512&&t.wrap&4&&(t.check=kd(t.check,i,M,c)),y-=M,c+=M,t.length-=M),t.length))break e;t.length=0,t.mode=DS;case DS:if(t.flags&2048){if(y===0)break e;M=0;do _e=i[c+M++],t.head&&_e&&t.length<65536&&(t.head.name+=String.fromCharCode(_e));while(_e&&M<y);if(t.flags&512&&t.wrap&4&&(t.check=kd(t.check,i,M,c)),y-=M,c+=M,_e)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=OS;case OS:if(t.flags&4096){if(y===0)break e;M=0;do _e=i[c+M++],t.head&&_e&&t.length<65536&&(t.head.comment+=String.fromCharCode(_e));while(_e&&M<y);if(t.flags&512&&t.wrap&4&&(t.check=kd(t.check,i,M,c)),y-=M,c+=M,_e)break e}else t.head&&(t.head.comment=null);t.mode=FS;case FS:if(t.flags&512){for(;L<16;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}if(t.wrap&4&&T!==(t.check&65535)){n.msg="header crc mismatch",t.mode=pu;break}T=0,L=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),n.adler=t.check=0,t.mode=_p;break;case BS:for(;L<32;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}n.adler=t.check=ZS(T),T=0,L=0,t.mode=Bv;case Bv:if(t.havedict===0)return n.next_out=_,n.avail_out=s,n.next_in=c,n.avail_in=y,t.hold=T,t.bits=L,jR;n.adler=t.check=1,t.mode=_p;case _p:if(e===BR||e===k1)break e;case Yb:if(t.last){T>>>=L&7,L-=L&7,t.mode=Zb;break}for(;L<3;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}switch(t.last=T&1,T>>>=1,L-=1,T&3){case 0:t.mode=zS;break;case 1:if(XR(t),t.mode=L1,e===k1){T>>>=2,L-=2;break e}break;case 2:t.mode=US;break;case 3:n.msg="invalid block type",t.mode=pu}T>>>=2,L-=2;break;case zS:for(T>>>=L&7,L-=L&7;L<32;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}if((T&65535)!==(T>>>16^65535)){n.msg="invalid stored block lengths",t.mode=pu;break}if(t.length=T&65535,T=0,L=0,t.mode=Kb,e===k1)break e;case Kb:t.mode=jS;case jS:if(M=t.length,M){if(M>y&&(M=y),M>s&&(M=s),M===0)break e;a.set(i.subarray(c,c+M),_),y-=M,c+=M,s-=M,_+=M,t.length-=M;break}t.mode=_p;break;case US:for(;L<14;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}if(t.nlen=(T&31)+257,T>>>=5,L-=5,t.ndist=(T&31)+1,T>>>=5,L-=5,t.ncode=(T&15)+4,T>>>=4,L-=4,t.nlen>286||t.ndist>30){n.msg="too many length or distance symbols",t.mode=pu;break}t.have=0,t.mode=VS;case VS:for(;t.have<t.ncode;){for(;L<3;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}t.lens[J[t.have++]]=T&7,T>>>=3,L-=3}for(;t.have<19;)t.lens[J[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,Y={bits:t.lenbits},G=s_(FR,t.lens,0,19,t.lencode,0,t.work,Y),t.lenbits=Y.bits,G){n.msg="invalid code lengths set",t.mode=pu;break}t.have=0,t.mode=qS;case qS:for(;t.have<t.nlen+t.ndist;){for(;ye=t.lencode[T&(1<<t.lenbits)-1],ie=ye>>>24,oe=ye>>>16&255,ve=ye&65535,!(ie<=L);){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}if(ve<16)T>>>=ie,L-=ie,t.lens[t.have++]=ve;else{if(ve===16){for($=ie+2;L<$;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}if(T>>>=ie,L-=ie,t.have===0){n.msg="invalid bit length repeat",t.mode=pu;break}_e=t.lens[t.have-1],M=3+(T&3),T>>>=2,L-=2}else if(ve===17){for($=ie+3;L<$;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}T>>>=ie,L-=ie,_e=0,M=3+(T&7),T>>>=3,L-=3}else{for($=ie+7;L<$;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}T>>>=ie,L-=ie,_e=0,M=11+(T&127),T>>>=7,L-=7}if(t.have+M>t.nlen+t.ndist){n.msg="invalid bit length repeat",t.mode=pu;break}for(;M--;)t.lens[t.have++]=_e}}if(t.mode===pu)break;if(t.lens[256]===0){n.msg="invalid code -- missing end-of-block",t.mode=pu;break}if(t.lenbits=9,Y={bits:t.lenbits},G=s_(yC,t.lens,0,t.nlen,t.lencode,0,t.work,Y),t.lenbits=Y.bits,G){n.msg="invalid literal/lengths set",t.mode=pu;break}if(t.distbits=6,t.distcode=t.distdyn,Y={bits:t.distbits},G=s_(_C,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,Y),t.distbits=Y.bits,G){n.msg="invalid distances set",t.mode=pu;break}if(t.mode=L1,e===k1)break e;case L1:t.mode=P1;case P1:if(y>=6&&s>=258){n.next_out=_,n.avail_out=s,n.next_in=c,n.avail_in=y,t.hold=T,t.bits=L,PR(n,U),_=n.next_out,a=n.output,s=n.avail_out,c=n.next_in,i=n.input,y=n.avail_in,T=t.hold,L=t.bits,t.mode===_p&&(t.back=-1);break}for(t.back=0;ye=t.lencode[T&(1<<t.lenbits)-1],ie=ye>>>24,oe=ye>>>16&255,ve=ye&65535,!(ie<=L);){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}if(oe&&(oe&240)===0){for(de=ie,Pe=oe,Be=ve;ye=t.lencode[Be+((T&(1<<de+Pe)-1)>>de)],ie=ye>>>24,oe=ye>>>16&255,ve=ye&65535,!(de+ie<=L);){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}T>>>=de,L-=de,t.back+=de}if(T>>>=ie,L-=ie,t.back+=ie,t.length=ve,oe===0){t.mode=XS;break}if(oe&32){t.back=-1,t.mode=_p;break}if(oe&64){n.msg="invalid literal/length code",t.mode=pu;break}t.extra=oe&15,t.mode=GS;case GS:if(t.extra){for($=t.extra;L<$;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}t.length+=T&(1<<t.extra)-1,T>>>=t.extra,L-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=$S;case $S:for(;ye=t.distcode[T&(1<<t.distbits)-1],ie=ye>>>24,oe=ye>>>16&255,ve=ye&65535,!(ie<=L);){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}if((oe&240)===0){for(de=ie,Pe=oe,Be=ve;ye=t.distcode[Be+((T&(1<<de+Pe)-1)>>de)],ie=ye>>>24,oe=ye>>>16&255,ve=ye&65535,!(de+ie<=L);){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}T>>>=de,L-=de,t.back+=de}if(T>>>=ie,L-=ie,t.back+=ie,oe&64){n.msg="invalid distance code",t.mode=pu;break}t.offset=ve,t.extra=oe&15,t.mode=HS;case HS:if(t.extra){for($=t.extra;L<$;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}t.offset+=T&(1<<t.extra)-1,T>>>=t.extra,L-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){n.msg="invalid distance too far back",t.mode=pu;break}t.mode=WS;case WS:if(s===0)break e;if(M=U-s,t.offset>M){if(M=t.offset-M,M>t.whave&&t.sane){n.msg="invalid distance too far back",t.mode=pu;break}M>t.wnext?(M-=t.wnext,Q=t.wsize-M):Q=t.wnext-M,M>t.length&&(M=t.length),ae=t.window}else ae=a,Q=_-t.offset,M=t.length;M>s&&(M=s),s-=M,t.length-=M;do a[_++]=ae[Q++];while(--M);t.length===0&&(t.mode=P1);break;case XS:if(s===0)break e;a[_++]=t.length,s--,t.mode=P1;break;case Zb:if(t.wrap){for(;L<32;){if(y===0)break e;y--,T|=i[c++]<<L,L+=8}if(U-=s,n.total_out+=U,t.total+=U,t.wrap&4&&U&&(n.adler=t.check=t.flags?kd(t.check,a,U,_-U):n5(t.check,a,U,_-U)),U=s,t.wrap&4&&(t.flags?T:ZS(T))!==t.check){n.msg="incorrect data check",t.mode=pu;break}T=0,L=0}t.mode=YS;case YS:if(t.wrap&&t.flags){for(;L<32;){if(y===0)break e;y--,T+=i[c++]<<L,L+=8}if(t.wrap&4&&T!==(t.total&4294967295)){n.msg="incorrect length check",t.mode=pu;break}T=0,L=0}t.mode=KS;case KS:G=zR;break e;case pu:G=vC;break e;case bC:return xC;case wC:default:return $f}return n.next_out=_,n.avail_out=s,n.next_in=c,n.avail_in=y,t.hold=T,t.bits=L,(t.wsize||U!==n.avail_out&&t.mode<pu&&(t.mode<Zb||e!==CS))&&IC(n,n.output,n.next_out,U-n.avail_out),R-=n.avail_in,U-=n.avail_out,n.total_in+=R,n.total_out+=U,t.total+=U,t.wrap&4&&U&&(n.adler=t.check=t.flags?kd(t.check,a,U,n.next_out-U):n5(t.check,a,U,n.next_out-U)),n.data_type=t.bits+(t.last?64:0)+(t.mode===_p?128:0)+(t.mode===L1||t.mode===Kb?256:0),(R===0&&U===0||e===CS)&&G===hg&&(G=UR),G},KR=n=>{if(wg(n))return $f;let e=n.state;return e.window&&(e.window=null),n.state=null,hg},ZR=(n,e)=>{if(wg(n))return $f;const t=n.state;return(t.wrap&2)===0?$f:(t.head=e,e.done=!1,hg)},JR=(n,e)=>{const t=e.length;let i,a,c;return wg(n)||(i=n.state,i.wrap!==0&&i.mode!==Bv)?$f:i.mode===Bv&&(a=1,a=n5(a,e,t,0),a!==i.check)?vC:(c=IC(n,e,t,t),c?(i.mode=bC,xC):(i.havedict=1,hg))};var QR=EC,eM=TC,tM=SC,nM=WR,rM=AC,iM=YR,sM=KR,oM=ZR,aM=JR,lM="pako inflate (from Nodeca project)",wp={inflateReset:QR,inflateReset2:eM,inflateResetKeep:tM,inflateInit:nM,inflateInit2:rM,inflate:iM,inflateEnd:sM,inflateGetHeader:oM,inflateSetDictionary:aM,inflateInfo:lM};function uM(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var cM=uM;const CC=Object.prototype.toString,{Z_NO_FLUSH:hM,Z_FINISH:fM,Z_OK:b_,Z_STREAM_END:ew,Z_NEED_DICT:tw,Z_STREAM_ERROR:dM,Z_DATA_ERROR:QS,Z_MEM_ERROR:pM}=pC;function B_(n){this.options=mC.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(n&&n.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kR,this.strm.avail_out=0;let t=wp.inflateInit2(this.strm,e.windowBits);if(t!==b_)throw new Error(r5[t]);if(this.header=new cM,wp.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=i5.string2buf(e.dictionary):CC.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=wp.inflateSetDictionary(this.strm,e.dictionary),t!==b_)))throw new Error(r5[t])}B_.prototype.push=function(n,e){const t=this.strm,i=this.options.chunkSize,a=this.options.dictionary;let c,_,y;if(this.ended)return!1;for(e===~~e?_=e:_=e===!0?fM:hM,CC.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),c=wp.inflate(t,_),c===tw&&a&&(c=wp.inflateSetDictionary(t,a),c===b_?c=wp.inflate(t,_):c===QS&&(c=tw));t.avail_in>0&&c===ew&&t.state.wrap>0&&n[t.next_in]!==0;)wp.inflateReset(t),c=wp.inflate(t,_);switch(c){case dM:case QS:case tw:case pM:return this.onEnd(c),this.ended=!0,!1}if(y=t.avail_out,t.next_out&&(t.avail_out===0||c===ew))if(this.options.to==="string"){let s=i5.utf8border(t.output,t.next_out),T=t.next_out-s,L=i5.buf2string(t.output,s);t.next_out=T,t.avail_out=i-T,T&&t.output.set(t.output.subarray(s,s+T),0),this.onData(L)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(c===b_&&y===0)){if(c===ew)return c=wp.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};B_.prototype.onData=function(n){this.chunks.push(n)};B_.prototype.onEnd=function(n){n===b_&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=mC.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function mM(n,e){const t=new B_(e);if(t.push(n),t.err)throw t.msg||r5[t.err];return t.result}var gM=B_,yM=mM,_M={Inflate:gM,inflate:yM};const{Inflate:vM,inflate:xM}=_M;var eE=vM,bM=xM;const kC=[];for(let n=0;n<256;n++){let e=n;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e=e>>>1;kC[n]=e}const tE=4294967295;function wM(n,e,t){let i=n;for(let a=0;a<t;a++)i=kC[(i^e[a])&255]^i>>>8;return i}function SM(n,e){return(wM(tE,n,e)^tE)>>>0}function nE(n,e,t){const i=n.readUint32(),a=SM(new Uint8Array(n.buffer,n.byteOffset+n.offset-e-4,e),e);if(a!==i)throw new Error(`CRC mismatch for chunk ${t}. Expected ${i}, found ${a}`)}function LC(n,e,t){for(let i=0;i<t;i++)e[i]=n[i]}function PC(n,e,t,i){let a=0;for(;a<i;a++)e[a]=n[a];for(;a<t;a++)e[a]=n[a]+e[a-i]&255}function NC(n,e,t,i){let a=0;if(t.length===0)for(;a<i;a++)e[a]=n[a];else for(;a<i;a++)e[a]=n[a]+t[a]&255}function RC(n,e,t,i,a){let c=0;if(t.length===0){for(;c<a;c++)e[c]=n[c];for(;c<i;c++)e[c]=n[c]+(e[c-a]>>1)&255}else{for(;c<a;c++)e[c]=n[c]+(t[c]>>1)&255;for(;c<i;c++)e[c]=n[c]+(e[c-a]+t[c]>>1)&255}}function MC(n,e,t,i,a){let c=0;if(t.length===0){for(;c<a;c++)e[c]=n[c];for(;c<i;c++)e[c]=n[c]+e[c-a]&255}else{for(;c<a;c++)e[c]=n[c]+t[c]&255;for(;c<i;c++)e[c]=n[c]+EM(e[c-a],t[c],t[c-a])&255}}function EM(n,e,t){const i=n+e-t,a=Math.abs(i-n),c=Math.abs(i-e),_=Math.abs(i-t);return a<=c&&a<=_?n:c<=_?e:t}function TM(n,e,t,i,a,c){switch(n){case 0:LC(e,t,a);break;case 1:PC(e,t,a,c);break;case 2:NC(e,t,i,a);break;case 3:RC(e,t,i,a,c);break;case 4:MC(e,t,i,a,c);break;default:throw new Error(`Unsupported filter: ${n}`)}}const AM=new Uint16Array([255]),IM=new Uint8Array(AM.buffer),CM=IM[0]===255;function kM(n){const{data:e,width:t,height:i,channels:a,depth:c}=n,_=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],y=Math.ceil(c/8)*a,s=new Uint8Array(i*t*y);let T=0;for(let L=0;L<7;L++){const R=_[L],U=Math.ceil((t-R.x)/R.xStep),M=Math.ceil((i-R.y)/R.yStep);if(U<=0||M<=0)continue;const Q=U*y,ae=new Uint8Array(Q);for(let ye=0;ye<M;ye++){const ie=e[T++],oe=e.subarray(T,T+Q);T+=Q;const ve=new Uint8Array(Q);TM(ie,oe,ve,ae,Q,y),ae.set(ve);for(let de=0;de<U;de++){const Pe=R.x+de*R.xStep,Be=R.y+ye*R.yStep;if(!(Pe>=t||Be>=i))for(let _e=0;_e<y;_e++)s[(Be*t+Pe)*y+_e]=ve[de*y+_e]}}}if(c===16){const L=new Uint16Array(s.buffer);if(CM)for(let R=0;R<L.length;R++)L[R]=LM(L[R]);return L}else return s}function LM(n){return(n&255)<<8|n>>8&255}const PM=new Uint16Array([255]),NM=new Uint8Array(PM.buffer),RM=NM[0]===255,MM=new Uint8Array(0);function rE(n){const{data:e,width:t,height:i,channels:a,depth:c}=n,_=Math.ceil(c/8)*a,y=Math.ceil(c/8*a*t),s=new Uint8Array(i*y);let T=MM,L=0,R,U;for(let M=0;M<i;M++){switch(R=e.subarray(L+1,L+1+y),U=s.subarray(M*y,(M+1)*y),e[L]){case 0:LC(R,U,y);break;case 1:PC(R,U,y,_);break;case 2:NC(R,U,T,y);break;case 3:RC(R,U,T,y,_);break;case 4:MC(R,U,T,y,_);break;default:throw new Error(`Unsupported filter: ${e[L]}`)}T=U,L+=y+1}if(c===16){const M=new Uint16Array(s.buffer);if(RM)for(let Q=0;Q<M.length;Q++)M[Q]=DM(M[Q]);return M}else return s}function DM(n){return(n&255)<<8|n>>8&255}const av=Uint8Array.of(137,80,78,71,13,10,26,10);function iE(n){if(!OM(n.readBytes(av.length)))throw new Error("wrong PNG signature")}function OM(n){if(n.length<av.length)return!1;for(let e=0;e<av.length;e++)if(n[e]!==av[e])return!1;return!0}const FM="tEXt",BM=0,DC=new TextDecoder("latin1");function zM(n){if(UM(n),n.length===0||n.length>79)throw new Error("keyword length must be between 1 and 79")}const jM=/^[\u0000-\u00FF]*$/;function UM(n){if(!jM.test(n))throw new Error("invalid latin1 text")}function VM(n,e,t){const i=OC(e);n[i]=qM(e,t-i.length-1)}function OC(n){for(n.mark();n.readByte()!==BM;);const e=n.offset;n.reset();const t=DC.decode(n.readBytes(e-n.offset-1));return n.skip(1),zM(t),t}function qM(n,e){return DC.decode(n.readBytes(e))}const _f={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},nw={UNKNOWN:-1,DEFLATE:0},sE={UNKNOWN:-1,ADAPTIVE:0},rw={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},N1={NONE:0,BACKGROUND:1,PREVIOUS:2},iw={SOURCE:0,OVER:1};class GM extends l3{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(e,t={}){super(e);const{checkCrc:i=!1}=t;this._checkCrc=i,this._inflator=new eE,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=nw.UNKNOWN,this._filterMethod=sE.UNKNOWN,this._interlaceMethod=rw.UNKNOWN,this._colorType=_f.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(iE(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(iE(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){const i=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case FM:VM(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?nE(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){const i=this.offset;switch(t!=="fdAT"&&t!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=i+e;break}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?nE(this,e+4,t):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=$M(this.readUint8());const t=this.readUint8();this._colorType=t;let i;switch(t){case _f.GREYSCALE:i=1;break;case _f.TRUECOLOUR:i=3;break;case _f.INDEXED_COLOUR:i=1;break;case _f.GREYSCALE_ALPHA:i=2;break;case _f.TRUECOLOUR_ALPHA:i=4;break;case _f.UNKNOWN:default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=i,this._compressionMethod=this.readUint8(),this._compressionMethod!==nw.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const i=[];this._palette=i;for(let a=0;a<t;a++)i.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const t=e,i=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,i,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,i=this.offset+this.byteOffset;if(i+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,i,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodetRNS(e){switch(this._colorType){case _f.GREYSCALE:case _f.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break}case _f.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const i=this.readByte();this._palette[t].push(i)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}case _f.UNKNOWN:case _f.GREYSCALE_ALPHA:case _f.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){const t=OC(this),i=this.readUint8();if(i!==nw.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${i}`);const a=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:bM(a)}}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),i=this.readByte();this._png.resolution={x:e,y:t,unit:i}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},i=this._frames.at(e);if(i){if(i.data=rE({data:i.data,width:i.width,height:i.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),e===0||i.xOffset===0&&i.yOffset===0&&i.width===this._png.width&&i.height===this._png.height)t.data=i.data;else{const a=this._apng.frames.at(e-1);this.disposeFrame(i,a,t),this.addFrameDataToCanvas(t,i)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,i){switch(e.disposeOp){case N1.NONE:break;case N1.BACKGROUND:for(let a=0;a<this._png.height;a++)for(let c=0;c<this._png.width;c++){const _=(a*e.width+c)*this._png.channels;for(let y=0;y<this._png.channels;y++)i.data[_+y]=0}break;case N1.PREVIOUS:i.data.set(t.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){const i=1<<this._png.depth,a=(c,_)=>{const y=((c+t.yOffset)*this._png.width+t.xOffset+_)*this._png.channels,s=(c*t.width+_)*this._png.channels;return{index:y,frameIndex:s}};switch(t.blendOp){case iw.SOURCE:for(let c=0;c<t.height;c++)for(let _=0;_<t.width;_++){const{index:y,frameIndex:s}=a(c,_);for(let T=0;T<this._png.channels;T++)e.data[y+T]=t.data[s+T]}break;case iw.OVER:for(let c=0;c<t.height;c++)for(let _=0;_<t.width;_++){const{index:y,frameIndex:s}=a(c,_);for(let T=0;T<this._png.channels;T++){const L=t.data[s+this._png.channels-1]/i,R=T%(this._png.channels-1)===0?1:t.data[s+T],U=Math.floor(L*R+(1-L)*e.data[y+T]);e.data[y+T]+=U}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==sE.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===rw.NO_INTERLACE)this._png.data=rE({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===rw.ADAM7)this._png.data=kM({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:N1.NONE,blendOp:iw.SOURCE,data:e}),this._inflator=new eE,this._writingDataChunks=!1}}function $M(n){if(n!==1&&n!==2&&n!==4&&n!==8&&n!==16)throw new Error(`invalid bit depth: ${n}`);return n}var oE;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.METRE=1]="METRE"})(oE||(oE={}));function HM(n,e){return new GM(n,e).decode()}var js=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function sw(){js.console&&typeof js.console.log=="function"&&js.console.log.apply(js.console,arguments)}var Dl={log:sw,warn:function(n){js.console&&(typeof js.console.warn=="function"?js.console.warn.apply(js.console,arguments):sw.call(null,arguments))},error:function(n){js.console&&(typeof js.console.error=="function"?js.console.error.apply(js.console,arguments):sw(n))}};function ow(n,e,t){var i=new XMLHttpRequest;i.open("GET",n),i.responseType="blob",i.onload=function(){Zm(i.response,e,t)},i.onerror=function(){Dl.error("could not download file")},i.send()}function aE(n){var e=new XMLHttpRequest;e.open("HEAD",n,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function R1(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(e)}}var Zm=js.saveAs||((typeof window>"u"?"undefined":dl(window))!=="object"||window!==js?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(n,e,t){var i=js.URL||js.webkitURL,a=document.createElement("a");e=e||n.name||"download",a.download=e,a.rel="noopener",typeof n=="string"?(a.href=n,a.origin!==location.origin?aE(a.href)?ow(n,e,t):R1(a,a.target="_blank"):R1(a)):(a.href=i.createObjectURL(n),setTimeout(function(){i.revokeObjectURL(a.href)},4e4),setTimeout(function(){R1(a)},0))}:"msSaveOrOpenBlob"in navigator?function(n,e,t){if(e=e||n.name||"download",typeof n=="string")if(aE(n))ow(n,e,t);else{var i=document.createElement("a");i.href=n,i.target="_blank",setTimeout(function(){R1(i)})}else navigator.msSaveOrOpenBlob((function(a,c){return c===void 0?c={autoBom:!1}:dl(c)!=="object"&&(Dl.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a})(n,t),e)}:function(n,e,t,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),typeof n=="string")return ow(n,e,t);var a=n.type==="application/octet-stream",c=/constructor/i.test(js.HTMLElement)||js.safari,_=/CriOS\/[\d]+/.test(navigator.userAgent);if((_||a&&c)&&(typeof FileReader>"u"?"undefined":dl(FileReader))==="object"){var y=new FileReader;y.onloadend=function(){var L=y.result;L=_?L:L.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=L:location=L,i=null},y.readAsDataURL(n)}else{var s=js.URL||js.webkitURL,T=s.createObjectURL(n);i?i.location=T:location.href=T,i=null,setTimeout(function(){s.revokeObjectURL(T)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function FC(n){var e;n=n||"",this.ok=!1,n.charAt(0)=="#"&&(n=n.substr(1,6)),n={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[n=(n=n.replace(/ /g,"")).toLowerCase()]||n;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(y){return[parseInt(y[1]),parseInt(y[2]),parseInt(y[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(y){return[parseInt(y[1],16),parseInt(y[2],16),parseInt(y[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(y){return[parseInt(y[1]+y[1],16),parseInt(y[2]+y[2],16),parseInt(y[3]+y[3],16)]}}],i=0;i<t.length;i++){var a=t[i].re,c=t[i].process,_=a.exec(n);_&&(e=c(_),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var y=this.r.toString(16),s=this.g.toString(16),T=this.b.toString(16);return y.length==1&&(y="0"+y),s.length==1&&(s="0"+s),T.length==1&&(T="0"+T),"#"+y+s+T}}var lv=js.atob.bind(js),lE=js.btoa.bind(js);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function aw(n,e){var t=n[0],i=n[1],a=n[2],c=n[3];t=vh(t,i,a,c,e[0],7,-680876936),c=vh(c,t,i,a,e[1],12,-389564586),a=vh(a,c,t,i,e[2],17,606105819),i=vh(i,a,c,t,e[3],22,-1044525330),t=vh(t,i,a,c,e[4],7,-176418897),c=vh(c,t,i,a,e[5],12,1200080426),a=vh(a,c,t,i,e[6],17,-1473231341),i=vh(i,a,c,t,e[7],22,-45705983),t=vh(t,i,a,c,e[8],7,1770035416),c=vh(c,t,i,a,e[9],12,-1958414417),a=vh(a,c,t,i,e[10],17,-42063),i=vh(i,a,c,t,e[11],22,-1990404162),t=vh(t,i,a,c,e[12],7,1804603682),c=vh(c,t,i,a,e[13],12,-40341101),a=vh(a,c,t,i,e[14],17,-1502002290),t=xh(t,i=vh(i,a,c,t,e[15],22,1236535329),a,c,e[1],5,-165796510),c=xh(c,t,i,a,e[6],9,-1069501632),a=xh(a,c,t,i,e[11],14,643717713),i=xh(i,a,c,t,e[0],20,-373897302),t=xh(t,i,a,c,e[5],5,-701558691),c=xh(c,t,i,a,e[10],9,38016083),a=xh(a,c,t,i,e[15],14,-660478335),i=xh(i,a,c,t,e[4],20,-405537848),t=xh(t,i,a,c,e[9],5,568446438),c=xh(c,t,i,a,e[14],9,-1019803690),a=xh(a,c,t,i,e[3],14,-187363961),i=xh(i,a,c,t,e[8],20,1163531501),t=xh(t,i,a,c,e[13],5,-1444681467),c=xh(c,t,i,a,e[2],9,-51403784),a=xh(a,c,t,i,e[7],14,1735328473),t=bh(t,i=xh(i,a,c,t,e[12],20,-1926607734),a,c,e[5],4,-378558),c=bh(c,t,i,a,e[8],11,-2022574463),a=bh(a,c,t,i,e[11],16,1839030562),i=bh(i,a,c,t,e[14],23,-35309556),t=bh(t,i,a,c,e[1],4,-1530992060),c=bh(c,t,i,a,e[4],11,1272893353),a=bh(a,c,t,i,e[7],16,-155497632),i=bh(i,a,c,t,e[10],23,-1094730640),t=bh(t,i,a,c,e[13],4,681279174),c=bh(c,t,i,a,e[0],11,-358537222),a=bh(a,c,t,i,e[3],16,-722521979),i=bh(i,a,c,t,e[6],23,76029189),t=bh(t,i,a,c,e[9],4,-640364487),c=bh(c,t,i,a,e[12],11,-421815835),a=bh(a,c,t,i,e[15],16,530742520),t=wh(t,i=bh(i,a,c,t,e[2],23,-995338651),a,c,e[0],6,-198630844),c=wh(c,t,i,a,e[7],10,1126891415),a=wh(a,c,t,i,e[14],15,-1416354905),i=wh(i,a,c,t,e[5],21,-57434055),t=wh(t,i,a,c,e[12],6,1700485571),c=wh(c,t,i,a,e[3],10,-1894986606),a=wh(a,c,t,i,e[10],15,-1051523),i=wh(i,a,c,t,e[1],21,-2054922799),t=wh(t,i,a,c,e[8],6,1873313359),c=wh(c,t,i,a,e[15],10,-30611744),a=wh(a,c,t,i,e[6],15,-1560198380),i=wh(i,a,c,t,e[13],21,1309151649),t=wh(t,i,a,c,e[4],6,-145523070),c=wh(c,t,i,a,e[11],10,-1120210379),a=wh(a,c,t,i,e[2],15,718787259),i=wh(i,a,c,t,e[9],21,-343485551),n[0]=am(t,n[0]),n[1]=am(i,n[1]),n[2]=am(a,n[2]),n[3]=am(c,n[3])}function Px(n,e,t,i,a,c){return e=am(am(e,n),am(i,c)),am(e<<a|e>>>32-a,t)}function vh(n,e,t,i,a,c,_){return Px(e&t|~e&i,n,e,a,c,_)}function xh(n,e,t,i,a,c,_){return Px(e&i|t&~i,n,e,a,c,_)}function bh(n,e,t,i,a,c,_){return Px(e^t^i,n,e,a,c,_)}function wh(n,e,t,i,a,c,_){return Px(t^(e|~i),n,e,a,c,_)}function BC(n){var e,t=n.length,i=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=n.length;e+=64)aw(i,WM(n.substring(e-64,e)));n=n.substring(e-64);var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<n.length;e++)a[e>>2]|=n.charCodeAt(e)<<(e%4<<3);if(a[e>>2]|=128<<(e%4<<3),e>55)for(aw(i,a),e=0;e<16;e++)a[e]=0;return a[14]=8*t,aw(i,a),i}function WM(n){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=n.charCodeAt(e)+(n.charCodeAt(e+1)<<8)+(n.charCodeAt(e+2)<<16)+(n.charCodeAt(e+3)<<24);return t}var uE="0123456789abcdef".split("");function XM(n){for(var e="",t=0;t<4;t++)e+=uE[n>>8*t+4&15]+uE[n>>8*t&15];return e}function YM(n){return String.fromCharCode(255&n,(65280&n)>>8,(16711680&n)>>16,(4278190080&n)>>24)}function s5(n){return BC(n).map(YM).join("")}var KM=(function(n){for(var e=0;e<n.length;e++)n[e]=XM(n[e]);return n.join("")})(BC("hello"))!="5d41402abc4b2a76b9719d911017c592";function am(n,e){if(KM){var t=(65535&n)+(65535&e);return(n>>16)+(e>>16)+(t>>16)<<16|65535&t}return n+e&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function o5(n,e){var t,i,a,c;if(n!==t){for(var _=(a=n,c=1+(256/n.length|0),new Array(c+1).join(a)),y=[],s=0;s<256;s++)y[s]=s;var T=0;for(s=0;s<256;s++){var L=y[s];T=(T+L+_.charCodeAt(s))%256,y[s]=y[T],y[T]=L}t=n,i=y}else y=i;var R=e.length,U=0,M=0,Q="";for(s=0;s<R;s++)M=(M+(L=y[U=(U+1)%256]))%256,y[U]=y[M],y[M]=L,_=y[(y[U]+y[M])%256],Q+=String.fromCharCode(e.charCodeAt(s)^_);return Q}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var cE={print:4,modify:8,copy:16,"annot-forms":32};function uy(n,e,t,i){this.v=1,this.r=2;var a=192;n.forEach(function(y){if(cE.perm!==void 0)throw new Error("Invalid permission: "+y);a+=cE[y]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var c=(e+this.padding).substr(0,32),_=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(c,_),this.P=-(1+(255^a)),this.encryptionKey=s5(c+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(i)).substr(0,5),this.U=o5(this.encryptionKey,this.padding)}function cy(n){if(/[^\u0000-\u00ff]/.test(n))throw new Error("Invalid PDF Name Object: "+n+", Only accept ASCII characters.");for(var e="",t=n.length,i=0;i<t;i++){var a=n.charCodeAt(i);e+=a<33||a===35||a===37||a===40||a===41||a===47||a===60||a===62||a===91||a===93||a===123||a===125||a>126?"#"+("0"+a.toString(16)).slice(-2):n[i]}return e}function hE(n){if(dl(n)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,i,a){if(a=a||!1,typeof t!="string"||typeof i!="function"||typeof a!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var c=Math.random().toString(35);return e[t][c]=[i,!!a],c},this.unsubscribe=function(t){for(var i in e)if(e[i][t])return delete e[i][t],Object.keys(e[i]).length===0&&delete e[i],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var i=Array.prototype.slice.call(arguments,1),a=[];for(var c in e[t]){var _=e[t][c];try{_[0].apply(n,i)}catch(y){js.console&&Dl.error("jsPDF PubSub Error",y.message,y)}_[1]&&a.push(c)}a.length&&a.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function zv(n){if(!(this instanceof zv))return new zv(n);var e="opacity,stroke-opacity".split(",");for(var t in n)n.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=n[t]);this.id="",this.objectNumber=-1}function zC(n,e){this.gState=n,this.matrix=e,this.id="",this.objectNumber=-1}function tg(n,e,t,i,a){if(!(this instanceof tg))return new tg(n,e,t,i,a);this.type=n==="axial"?2:3,this.coords=e,this.colors=t,zC.call(this,i,a)}function gy(n,e,t,i,a){if(!(this instanceof gy))return new gy(n,e,t,i,a);this.boundingBox=n,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,zC.call(this,i,a)}function $i(n){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",i=arguments[1],a=arguments[2],c=arguments[3],_=[],y=1,s=16,T="S",L=null;dl(n=n||{})==="object"&&(t=n.orientation,i=n.unit||i,a=n.format||a,c=n.compress||n.compressPdf||c,(L=n.encryption||null)!==null&&(L.userPassword=L.userPassword||"",L.ownerPassword=L.ownerPassword||"",L.userPermissions=L.userPermissions||[]),y=typeof n.userUnit=="number"?Math.abs(n.userUnit):1,n.precision!==void 0&&(e=n.precision),n.floatPrecision!==void 0&&(s=n.floatPrecision),T=n.defaultPathOperation||"S"),_=n.filters||(c===!0?["FlateEncode"]:_),i=i||"mm",t=(""+(t||"P")).toLowerCase();var R=n.putOnlyUsedFonts||!1,U={},M={internal:{},__private__:{}};M.__private__.PubSub=hE;var Q="1.3",ae=M.__private__.getPdfVersion=function(){return Q};M.__private__.setPdfVersion=function(ee){Q=ee};var ye={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};M.__private__.getPageFormats=function(){return ye};var ie=M.__private__.getPageFormat=function(ee){return ye[ee]};a=a||"a4";var oe="compat",ve="advanced",de=oe;function Pe(){this.saveGraphicsState(),mt(new zt(ir,0,0,-ir,0,fa()*ir).toString()+" cm"),this.setFontSize(this.getFontSize()/ir),T="n",de=ve}function Be(){this.restoreGraphicsState(),T="S",de=oe}var _e=M.__private__.combineFontStyleAndFontWeight=function(ee,je){if(ee=="bold"&&je=="normal"||ee=="bold"&&je==400||ee=="normal"&&je=="italic"||ee=="bold"&&je=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return je&&(ee=je==400||je==="normal"?ee==="italic"?"italic":"normal":je!=700&&je!=="bold"||ee!=="normal"?(je==700?"bold":je)+""+ee:"bold"),ee};M.advancedAPI=function(ee){var je=de===oe;return je&&Pe.call(this),typeof ee!="function"||(ee(this),je&&Be.call(this)),this},M.compatAPI=function(ee){var je=de===ve;return je&&Be.call(this),typeof ee!="function"||(ee(this),je&&Pe.call(this)),this},M.isAdvancedAPI=function(){return de===ve};var G,B=function(ee){if(de!==ve)throw new Error(ee+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},Y=M.roundToPrecision=M.__private__.roundToPrecision=function(ee,je){var At=e||je;if(isNaN(ee)||isNaN(At))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return ee.toFixed(At).replace(/0+$/,"")};G=M.hpf=M.__private__.hpf=typeof s=="number"?function(ee){if(isNaN(ee))throw new Error("Invalid argument passed to jsPDF.hpf");return Y(ee,s)}:s==="smart"?function(ee){if(isNaN(ee))throw new Error("Invalid argument passed to jsPDF.hpf");return Y(ee,ee>-1&&ee<1?16:5)}:function(ee){if(isNaN(ee))throw new Error("Invalid argument passed to jsPDF.hpf");return Y(ee,16)};var $=M.f2=M.__private__.f2=function(ee){if(isNaN(ee))throw new Error("Invalid argument passed to jsPDF.f2");return Y(ee,2)},J=M.__private__.f3=function(ee){if(isNaN(ee))throw new Error("Invalid argument passed to jsPDF.f3");return Y(ee,3)},te=M.scale=M.__private__.scale=function(ee){if(isNaN(ee))throw new Error("Invalid argument passed to jsPDF.scale");return de===oe?ee*ir:de===ve?ee:void 0},Se=function(ee){return te((function(je){return de===oe?fa()-je:de===ve?je:void 0})(ee))};M.__private__.setPrecision=M.setPrecision=function(ee){typeof parseInt(ee,10)=="number"&&(e=parseInt(ee,10))};var De,$e="00000000000000000000000000000000",Ue=M.__private__.getFileId=function(){return $e},Le=M.__private__.setFileId=function(ee){return $e=ee!==void 0&&/^[a-fA-F0-9]{32}$/.test(ee)?ee.toUpperCase():$e.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),L!==null&&(Wr=new uy(L.userPermissions,L.userPassword,L.ownerPassword,$e)),$e};M.setFileId=function(ee){return Le(ee),this},M.getFileId=function(){return Ue()};var He=M.__private__.convertDateToPDFDate=function(ee){var je=ee.getTimezoneOffset(),At=je<0?"+":"-",kt=Math.floor(Math.abs(je/60)),sn=Math.abs(je%60),fn=[At,Ve(kt),"'",Ve(sn),"'"].join("");return["D:",ee.getFullYear(),Ve(ee.getMonth()+1),Ve(ee.getDate()),Ve(ee.getHours()),Ve(ee.getMinutes()),Ve(ee.getSeconds()),fn].join("")},Ke=M.__private__.convertPDFDateToDate=function(ee){var je=parseInt(ee.substr(2,4),10),At=parseInt(ee.substr(6,2),10)-1,kt=parseInt(ee.substr(8,2),10),sn=parseInt(ee.substr(10,2),10),fn=parseInt(ee.substr(12,2),10),Qn=parseInt(ee.substr(14,2),10);return new Date(je,At,kt,sn,fn,Qn,0)},Ce=M.__private__.setCreationDate=function(ee){var je;if(ee===void 0&&(ee=new Date),ee instanceof Date)je=He(ee);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(ee))throw new Error("Invalid argument passed to jsPDF.setCreationDate");je=ee}return De=je},ge=M.__private__.getCreationDate=function(ee){var je=De;return ee==="jsDate"&&(je=Ke(De)),je};M.setCreationDate=function(ee){return Ce(ee),this},M.getCreationDate=function(ee){return ge(ee)};var We,Ve=M.__private__.padd2=function(ee){return("0"+parseInt(ee)).slice(-2)},ut=M.__private__.padd2Hex=function(ee){return("00"+(ee=ee.toString())).substr(ee.length)},pt=0,It=[],Oe=[],Wt=0,Zt=[],Xt=[],Ze=!1,zn=Oe;M.__private__.setCustomOutputDestination=function(ee){Ze=!0,zn=ee};var on=function(ee){Ze||(zn=ee)};M.__private__.resetCustomOutputDestination=function(){Ze=!1,zn=Oe};var mt=M.__private__.out=function(ee){return ee=ee.toString(),Wt+=ee.length+1,zn.push(ee),zn},Ir=M.__private__.write=function(ee){return mt(arguments.length===1?ee.toString():Array.prototype.join.call(arguments," "))},Fr=M.__private__.getArrayBuffer=function(ee){for(var je=ee.length,At=new ArrayBuffer(je),kt=new Uint8Array(At);je--;)kt[je]=ee.charCodeAt(je);return At},qr=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];M.__private__.getStandardFonts=function(){return qr};var $t=n.fontSize||16;M.__private__.setFontSize=M.setFontSize=function(ee){return $t=de===ve?ee/ir:ee,this};var xr,dr=M.__private__.getFontSize=M.getFontSize=function(){return de===oe?$t:$t*ir},ni=n.R2L||!1;M.__private__.setR2L=M.setR2L=function(ee){return ni=ee,this},M.__private__.getR2L=M.getR2L=function(){return ni};var nn,yn=M.__private__.setZoomMode=function(ee){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(ee))xr=ee;else if(isNaN(ee)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(ee)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+ee+'" is not recognized.');xr=ee}else xr=parseInt(ee,10)};M.__private__.getZoomMode=function(){return xr};var sr,Zn=M.__private__.setPageMode=function(ee){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(ee)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+ee+'" is not recognized.');nn=ee};M.__private__.getPageMode=function(){return nn};var $r=M.__private__.setLayoutMode=function(ee){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(ee)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+ee+'" is not recognized.');sr=ee};M.__private__.getLayoutMode=function(){return sr},M.__private__.setDisplayMode=M.setDisplayMode=function(ee,je,At){return yn(ee),$r(je),Zn(At),this};var qn={title:"",subject:"",author:"",keywords:"",creator:""};M.__private__.getDocumentProperty=function(ee){if(Object.keys(qn).indexOf(ee)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return qn[ee]},M.__private__.getDocumentProperties=function(){return qn},M.__private__.setDocumentProperties=M.setProperties=M.setDocumentProperties=function(ee){for(var je in qn)qn.hasOwnProperty(je)&&ee[je]&&(qn[je]=ee[je]);return this},M.__private__.setDocumentProperty=function(ee,je){if(Object.keys(qn).indexOf(ee)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return qn[ee]=je};var jr,ir,Xn,Bi,bi,wr={},or={},ui=[],Kr={},wi={},si={},vt={},Ne=null,ze=0,ft=[],wt=new hE(M),Ut=n.hotfixes||[],Gt={},Tt={},Ot=[],zt=function ee(je,At,kt,sn,fn,Qn){if(!(this instanceof ee))return new ee(je,At,kt,sn,fn,Qn);isNaN(je)&&(je=1),isNaN(At)&&(At=0),isNaN(kt)&&(kt=0),isNaN(sn)&&(sn=1),isNaN(fn)&&(fn=0),isNaN(Qn)&&(Qn=0),this._matrix=[je,At,kt,sn,fn,Qn]};Object.defineProperty(zt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(ee){this._matrix[0]=ee}}),Object.defineProperty(zt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(ee){this._matrix[1]=ee}}),Object.defineProperty(zt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(ee){this._matrix[2]=ee}}),Object.defineProperty(zt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(ee){this._matrix[3]=ee}}),Object.defineProperty(zt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(ee){this._matrix[4]=ee}}),Object.defineProperty(zt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(ee){this._matrix[5]=ee}}),Object.defineProperty(zt.prototype,"a",{get:function(){return this._matrix[0]},set:function(ee){this._matrix[0]=ee}}),Object.defineProperty(zt.prototype,"b",{get:function(){return this._matrix[1]},set:function(ee){this._matrix[1]=ee}}),Object.defineProperty(zt.prototype,"c",{get:function(){return this._matrix[2]},set:function(ee){this._matrix[2]=ee}}),Object.defineProperty(zt.prototype,"d",{get:function(){return this._matrix[3]},set:function(ee){this._matrix[3]=ee}}),Object.defineProperty(zt.prototype,"e",{get:function(){return this._matrix[4]},set:function(ee){this._matrix[4]=ee}}),Object.defineProperty(zt.prototype,"f",{get:function(){return this._matrix[5]},set:function(ee){this._matrix[5]=ee}}),Object.defineProperty(zt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(zt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(zt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(zt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),zt.prototype.join=function(ee){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(G).join(ee)},zt.prototype.multiply=function(ee){var je=ee.sx*this.sx+ee.shy*this.shx,At=ee.sx*this.shy+ee.shy*this.sy,kt=ee.shx*this.sx+ee.sy*this.shx,sn=ee.shx*this.shy+ee.sy*this.sy,fn=ee.tx*this.sx+ee.ty*this.shx+this.tx,Qn=ee.tx*this.shy+ee.ty*this.sy+this.ty;return new zt(je,At,kt,sn,fn,Qn)},zt.prototype.decompose=function(){var ee=this.sx,je=this.shy,At=this.shx,kt=this.sy,sn=this.tx,fn=this.ty,Qn=Math.sqrt(ee*ee+je*je),Xr=(ee/=Qn)*At+(je/=Qn)*kt;At-=ee*Xr,kt-=je*Xr;var Qr=Math.sqrt(At*At+kt*kt);return Xr/=Qr,ee*(kt/=Qr)<je*(At/=Qr)&&(ee=-ee,je=-je,Xr=-Xr,Qn=-Qn),{scale:new zt(Qn,0,0,Qr,0,0),translate:new zt(1,0,0,1,sn,fn),rotate:new zt(ee,je,-je,ee,0,0),skew:new zt(1,0,Xr,1,0,0)}},zt.prototype.toString=function(ee){return this.join(" ")},zt.prototype.inversed=function(){var ee=this.sx,je=this.shy,At=this.shx,kt=this.sy,sn=this.tx,fn=this.ty,Qn=1/(ee*kt-je*At),Xr=kt*Qn,Qr=-je*Qn,oi=-At*Qn,Ui=ee*Qn;return new zt(Xr,Qr,oi,Ui,-Xr*sn-oi*fn,-Qr*sn-Ui*fn)},zt.prototype.applyToPoint=function(ee){var je=ee.x*this.sx+ee.y*this.shx+this.tx,At=ee.x*this.shy+ee.y*this.sy+this.ty;return new Al(je,At)},zt.prototype.applyToRectangle=function(ee){var je=this.applyToPoint(ee),At=this.applyToPoint(new Al(ee.x+ee.w,ee.y+ee.h));return new Nu(je.x,je.y,At.x-je.x,At.y-je.y)},zt.prototype.clone=function(){var ee=this.sx,je=this.shy,At=this.shx,kt=this.sy,sn=this.tx,fn=this.ty;return new zt(ee,je,At,kt,sn,fn)},M.Matrix=zt;var Pn=M.matrixMult=function(ee,je){return je.multiply(ee)},Jn=new zt(1,0,0,1,0,0);M.unitMatrix=M.identityMatrix=Jn;var Fn=function(ee,je){if(!wi[ee]){var At=(je instanceof tg?"Sh":"P")+(Object.keys(Kr).length+1).toString(10);je.id=At,wi[ee]=At,Kr[At]=je,wt.publish("addPattern",je)}};M.ShadingPattern=tg,M.TilingPattern=gy,M.addShadingPattern=function(ee,je){return B("addShadingPattern()"),Fn(ee,je),this},M.beginTilingPattern=function(ee){B("beginTilingPattern()"),qo(ee.boundingBox[0],ee.boundingBox[1],ee.boundingBox[2]-ee.boundingBox[0],ee.boundingBox[3]-ee.boundingBox[1],ee.matrix)},M.endTilingPattern=function(ee,je){B("endTilingPattern()"),je.stream=Xt[We].join(`
`),Fn(ee,je),wt.publish("endTilingPattern",je),Ot.pop().restore()};var Gr,Mr=M.__private__.newObject=function(){var ee=Zr();return Br(ee,!0),ee},Zr=M.__private__.newObjectDeferred=function(){return pt++,It[pt]=function(){return Wt},pt},Br=function(ee,je){return je=typeof je=="boolean"&&je,It[ee]=Wt,je&&mt(ee+" 0 obj"),ee},zi=M.__private__.newAdditionalObject=function(){var ee={objId:Zr(),content:""};return Zt.push(ee),ee},ms=Zr(),Os=Zr(),cs=M.__private__.decodeColorString=function(ee){var je=ee.split(" ");if(je.length!==2||je[1]!=="g"&&je[1]!=="G")je.length!==5||je[4]!=="k"&&je[4]!=="K"||(je=[(1-je[0])*(1-je[3]),(1-je[1])*(1-je[3]),(1-je[2])*(1-je[3]),"r"]);else{var At=parseFloat(je[0]);je=[At,At,At,"r"]}for(var kt="#",sn=0;sn<3;sn++)kt+=("0"+Math.floor(255*parseFloat(je[sn])).toString(16)).slice(-2);return kt},ps=M.__private__.encodeColorString=function(ee){var je;typeof ee=="string"&&(ee={ch1:ee});var At=ee.ch1,kt=ee.ch2,sn=ee.ch3,fn=ee.ch4,Qn=ee.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof At=="string"&&At.charAt(0)!=="#"){var Xr=new FC(At);if(Xr.ok)At=Xr.toHex();else if(!/^\d*\.?\d*$/.test(At))throw new Error('Invalid color "'+At+'" passed to jsPDF.encodeColorString.')}if(typeof At=="string"&&/^#[0-9A-Fa-f]{3}$/.test(At)&&(At="#"+At[1]+At[1]+At[2]+At[2]+At[3]+At[3]),typeof At=="string"&&/^#[0-9A-Fa-f]{6}$/.test(At)){var Qr=parseInt(At.substr(1),16);At=Qr>>16&255,kt=Qr>>8&255,sn=255&Qr}if(kt===void 0||fn===void 0&&At===kt&&kt===sn)je=typeof At=="string"?At+" "+Qn[0]:ee.precision===2?$(At/255)+" "+Qn[0]:J(At/255)+" "+Qn[0];else if(fn===void 0||dl(fn)==="object"){if(fn&&!isNaN(fn.a)&&fn.a===0)return["1.","1.","1.",Qn[1]].join(" ");je=typeof At=="string"?[At,kt,sn,Qn[1]].join(" "):ee.precision===2?[$(At/255),$(kt/255),$(sn/255),Qn[1]].join(" "):[J(At/255),J(kt/255),J(sn/255),Qn[1]].join(" ")}else je=typeof At=="string"?[At,kt,sn,fn,Qn[2]].join(" "):ee.precision===2?[$(At),$(kt),$(sn),$(fn),Qn[2]].join(" "):[J(At),J(kt),J(sn),J(fn),Qn[2]].join(" ");return je},vo=M.__private__.getFilters=function(){return _},is=M.__private__.putStream=function(ee){var je=(ee=ee||{}).data||"",At=ee.filters||vo(),kt=ee.alreadyAppliedFilters||[],sn=ee.addLength1||!1,fn=je.length,Qn=ee.objectId,Xr=function(Zs){return Zs};if(L!==null&&Qn===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");L!==null&&(Xr=Wr.encryptor(Qn,0));var Qr={};At===!0&&(At=["FlateEncode"]);var oi=ee.additionalKeyValues||[],Ui=(Qr=$i.API.processDataByFilters!==void 0?$i.API.processDataByFilters(je,At):{data:je,reverseChain:[]}).reverseChain+(Array.isArray(kt)?kt.join(" "):kt.toString());if(Qr.data.length!==0&&(oi.push({key:"Length",value:Qr.data.length}),sn===!0&&oi.push({key:"Length1",value:fn})),Ui.length!=0)if(Ui.split("/").length-1==1)oi.push({key:"Filter",value:Ui});else{oi.push({key:"Filter",value:"["+Ui+"]"});for(var Ps=0;Ps<oi.length;Ps+=1)if(oi[Ps].key==="DecodeParms"){for(var Bs=[],fo=0;fo<Qr.reverseChain.split("/").length-1;fo+=1)Bs.push("null");Bs.push(oi[Ps].value),oi[Ps].value="["+Bs.join(" ")+"]"}}mt("<<");for(var Ys=0;Ys<oi.length;Ys++)mt("/"+oi[Ys].key+" "+oi[Ys].value);mt(">>"),Qr.data.length!==0&&(mt("stream"),mt(Xr(Qr.data)),mt("endstream"))},xo=M.__private__.putPage=function(ee){var je=ee.number,At=ee.data,kt=ee.objId,sn=ee.contentsObjId;Br(kt,!0),mt("<</Type /Page"),mt("/Parent "+ee.rootDictionaryObjId+" 0 R"),mt("/Resources "+ee.resourceDictionaryObjId+" 0 R"),mt("/MediaBox ["+parseFloat(G(ee.mediaBox.bottomLeftX))+" "+parseFloat(G(ee.mediaBox.bottomLeftY))+" "+G(ee.mediaBox.topRightX)+" "+G(ee.mediaBox.topRightY)+"]"),ee.cropBox!==null&&mt("/CropBox ["+G(ee.cropBox.bottomLeftX)+" "+G(ee.cropBox.bottomLeftY)+" "+G(ee.cropBox.topRightX)+" "+G(ee.cropBox.topRightY)+"]"),ee.bleedBox!==null&&mt("/BleedBox ["+G(ee.bleedBox.bottomLeftX)+" "+G(ee.bleedBox.bottomLeftY)+" "+G(ee.bleedBox.topRightX)+" "+G(ee.bleedBox.topRightY)+"]"),ee.trimBox!==null&&mt("/TrimBox ["+G(ee.trimBox.bottomLeftX)+" "+G(ee.trimBox.bottomLeftY)+" "+G(ee.trimBox.topRightX)+" "+G(ee.trimBox.topRightY)+"]"),ee.artBox!==null&&mt("/ArtBox ["+G(ee.artBox.bottomLeftX)+" "+G(ee.artBox.bottomLeftY)+" "+G(ee.artBox.topRightX)+" "+G(ee.artBox.topRightY)+"]"),typeof ee.userUnit=="number"&&ee.userUnit!==1&&mt("/UserUnit "+ee.userUnit),wt.publish("putPage",{objId:kt,pageContext:ft[je],pageNumber:je,page:At}),mt("/Contents "+sn+" 0 R"),mt(">>"),mt("endobj");var fn=At.join(`
`);return de===ve&&(fn+=`
Q`),Br(sn,!0),is({data:fn,filters:vo(),objectId:sn}),mt("endobj"),kt},ua=M.__private__.putPages=function(){var ee,je,At=[];for(ee=1;ee<=ze;ee++)ft[ee].objId=Zr(),ft[ee].contentsObjId=Zr();for(ee=1;ee<=ze;ee++)At.push(xo({number:ee,data:Xt[ee],objId:ft[ee].objId,contentsObjId:ft[ee].contentsObjId,mediaBox:ft[ee].mediaBox,cropBox:ft[ee].cropBox,bleedBox:ft[ee].bleedBox,trimBox:ft[ee].trimBox,artBox:ft[ee].artBox,userUnit:ft[ee].userUnit,rootDictionaryObjId:ms,resourceDictionaryObjId:Os}));Br(ms,!0),mt("<</Type /Pages");var kt="/Kids [";for(je=0;je<ze;je++)kt+=At[je]+" 0 R ";mt(kt+"]"),mt("/Count "+ze),mt(">>"),mt("endobj"),wt.publish("postPutPages")},tl=function(ee){wt.publish("putFont",{font:ee,out:mt,newObject:Mr,putStream:is}),ee.isAlreadyPutted!==!0&&(ee.objectNumber=Mr(),mt("<<"),mt("/Type /Font"),mt("/BaseFont /"+cy(ee.postScriptName)),mt("/Subtype /Type1"),typeof ee.encoding=="string"&&mt("/Encoding /"+ee.encoding),mt("/FirstChar 32"),mt("/LastChar 255"),mt(">>"),mt("endobj"))},Pa=function(ee){ee.objectNumber=Mr();var je=[];je.push({key:"Type",value:"/XObject"}),je.push({key:"Subtype",value:"/Form"}),je.push({key:"BBox",value:"["+[G(ee.x),G(ee.y),G(ee.x+ee.width),G(ee.y+ee.height)].join(" ")+"]"}),je.push({key:"Matrix",value:"["+ee.matrix.toString()+"]"});var At=ee.pages[1].join(`
`);is({data:At,additionalKeyValues:je,objectId:ee.objectNumber}),mt("endobj")},di=function(ee,je){je||(je=21);var At=Mr(),kt=(function(Qn,Xr){var Qr,oi=[],Ui=1/(Xr-1);for(Qr=0;Qr<1;Qr+=Ui)oi.push(Qr);if(oi.push(1),Qn[0].offset!=0){var Ps={offset:0,color:Qn[0].color};Qn.unshift(Ps)}if(Qn[Qn.length-1].offset!=1){var Bs={offset:1,color:Qn[Qn.length-1].color};Qn.push(Bs)}for(var fo="",Ys=0,Zs=0;Zs<oi.length;Zs++){for(Qr=oi[Zs];Qr>Qn[Ys+1].offset;)Ys++;var go=Qn[Ys].offset,Ns=(Qr-go)/(Qn[Ys+1].offset-go),io=Qn[Ys].color,zs=Qn[Ys+1].color;fo+=ut(Math.round((1-Ns)*io[0]+Ns*zs[0]).toString(16))+ut(Math.round((1-Ns)*io[1]+Ns*zs[1]).toString(16))+ut(Math.round((1-Ns)*io[2]+Ns*zs[2]).toString(16))}return fo.trim()})(ee.colors,je),sn=[];sn.push({key:"FunctionType",value:"0"}),sn.push({key:"Domain",value:"[0.0 1.0]"}),sn.push({key:"Size",value:"["+je+"]"}),sn.push({key:"BitsPerSample",value:"8"}),sn.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),sn.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),is({data:kt,additionalKeyValues:sn,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:At}),mt("endobj"),ee.objectNumber=Mr(),mt("<< /ShadingType "+ee.type),mt("/ColorSpace /DeviceRGB");var fn="/Coords ["+G(parseFloat(ee.coords[0]))+" "+G(parseFloat(ee.coords[1]))+" ";ee.type===2?fn+=G(parseFloat(ee.coords[2]))+" "+G(parseFloat(ee.coords[3])):fn+=G(parseFloat(ee.coords[2]))+" "+G(parseFloat(ee.coords[3]))+" "+G(parseFloat(ee.coords[4]))+" "+G(parseFloat(ee.coords[5])),mt(fn+="]"),ee.matrix&&mt("/Matrix ["+ee.matrix.toString()+"]"),mt("/Function "+At+" 0 R"),mt("/Extend [true true]"),mt(">>"),mt("endobj")},ou=function(ee,je){var At=Zr(),kt=Mr();je.push({resourcesOid:At,objectOid:kt}),ee.objectNumber=kt;var sn=[];sn.push({key:"Type",value:"/Pattern"}),sn.push({key:"PatternType",value:"1"}),sn.push({key:"PaintType",value:"1"}),sn.push({key:"TilingType",value:"1"}),sn.push({key:"BBox",value:"["+ee.boundingBox.map(G).join(" ")+"]"}),sn.push({key:"XStep",value:G(ee.xStep)}),sn.push({key:"YStep",value:G(ee.yStep)}),sn.push({key:"Resources",value:At+" 0 R"}),ee.matrix&&sn.push({key:"Matrix",value:"["+ee.matrix.toString()+"]"}),is({data:ee.stream,additionalKeyValues:sn,objectId:ee.objectNumber}),mt("endobj")},yc=function(ee){for(var je in ee.objectNumber=Mr(),mt("<<"),ee)switch(je){case"opacity":mt("/ca "+$(ee[je]));break;case"stroke-opacity":mt("/CA "+$(ee[je]))}mt(">>"),mt("endobj")},Ss=function(ee){Br(ee.resourcesOid,!0),mt("<<"),mt("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var je in mt("/Font <<"),wr)wr.hasOwnProperty(je)&&(R===!1||R===!0&&U.hasOwnProperty(je))&&mt("/"+je+" "+wr[je].objectNumber+" 0 R");mt(">>")})(),(function(){if(Object.keys(Kr).length>0){for(var je in mt("/Shading <<"),Kr)Kr.hasOwnProperty(je)&&Kr[je]instanceof tg&&Kr[je].objectNumber>=0&&mt("/"+je+" "+Kr[je].objectNumber+" 0 R");wt.publish("putShadingPatternDict"),mt(">>")}})(),(function(je){if(Object.keys(Kr).length>0){for(var At in mt("/Pattern <<"),Kr)Kr.hasOwnProperty(At)&&Kr[At]instanceof M.TilingPattern&&Kr[At].objectNumber>=0&&Kr[At].objectNumber<je&&mt("/"+At+" "+Kr[At].objectNumber+" 0 R");wt.publish("putTilingPatternDict"),mt(">>")}})(ee.objectOid),(function(){if(Object.keys(si).length>0){var je;for(je in mt("/ExtGState <<"),si)si.hasOwnProperty(je)&&si[je].objectNumber>=0&&mt("/"+je+" "+si[je].objectNumber+" 0 R");wt.publish("putGStateDict"),mt(">>")}})(),(function(){for(var je in mt("/XObject <<"),Gt)Gt.hasOwnProperty(je)&&Gt[je].objectNumber>=0&&mt("/"+je+" "+Gt[je].objectNumber+" 0 R");wt.publish("putXobjectDict"),mt(">>")})(),mt(">>"),mt("endobj")},au=function(ee){or[ee.fontName]=or[ee.fontName]||{},or[ee.fontName][ee.fontStyle]=ee.id},ga=function(ee,je,At,kt,sn){var fn={id:"F"+(Object.keys(wr).length+1).toString(10),postScriptName:ee,fontName:je,fontStyle:At,encoding:kt,isStandardFont:sn||!1,metadata:{}};return wt.publish("addFont",{font:fn,instance:this}),wr[fn.id]=fn,au(fn),fn.id},uo=M.__private__.pdfEscape=M.pdfEscape=function(ee,je){return(function(At,kt){var sn,fn,Qn,Xr,Qr,oi,Ui,Ps,Bs;if(Qn=(kt=kt||{}).sourceEncoding||"Unicode",Qr=kt.outputEncoding,(kt.autoencode||Qr)&&wr[jr].metadata&&wr[jr].metadata[Qn]&&wr[jr].metadata[Qn].encoding&&(Xr=wr[jr].metadata[Qn].encoding,!Qr&&wr[jr].encoding&&(Qr=wr[jr].encoding),!Qr&&Xr.codePages&&(Qr=Xr.codePages[0]),typeof Qr=="string"&&(Qr=Xr[Qr]),Qr)){for(Ui=!1,oi=[],sn=0,fn=At.length;sn<fn;sn++)(Ps=Qr[At.charCodeAt(sn)])?oi.push(String.fromCharCode(Ps)):oi.push(At[sn]),oi[sn].charCodeAt(0)>>8&&(Ui=!0);At=oi.join("")}for(sn=At.length;Ui===void 0&&sn!==0;)At.charCodeAt(sn-1)>>8&&(Ui=!0),sn--;if(!Ui)return At;for(oi=kt.noBOM?[]:[254,255],sn=0,fn=At.length;sn<fn;sn++){if((Bs=(Ps=At.charCodeAt(sn))>>8)>>8)throw new Error("Character at position "+sn+" of string '"+At+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");oi.push(Bs),oi.push(Ps-(Bs<<8))}return String.fromCharCode.apply(void 0,oi)})(ee,je).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},nl=M.__private__.beginPage=function(ee){Xt[++ze]=[],ft[ze]={objId:0,contentsObjId:0,userUnit:Number(y),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(ee[0]),topRightY:Number(ee[1])}},Wo(ze),on(Xt[We])},Kl=function(ee,je){var At,kt,sn;switch(t=je||t,typeof ee=="string"&&(At=ie(ee.toLowerCase()),Array.isArray(At)&&(kt=At[0],sn=At[1])),Array.isArray(ee)&&(kt=ee[0]*ir,sn=ee[1]*ir),isNaN(kt)&&(kt=a[0],sn=a[1]),(kt>14400||sn>14400)&&(Dl.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),kt=Math.min(14400,kt),sn=Math.min(14400,sn)),a=[kt,sn],t.substr(0,1)){case"l":sn>kt&&(a=[sn,kt]);break;case"p":kt>sn&&(a=[sn,kt])}nl(a),wo(bo),mt(Ts),ro!==0&&mt(ro+" J"),ya!==0&&mt(ya+" j"),wt.publish("addPage",{pageNumber:ze})},ea=function(ee){ee>0&&ee<=ze&&(Xt.splice(ee,1),ft.splice(ee,1),ze--,We>ze&&(We=ze),this.setPage(We))},Wo=function(ee){ee>0&&ee<=ze&&(We=ee)},ta=M.__private__.getNumberOfPages=M.getNumberOfPages=function(){return Xt.length-1},En=function(ee,je,At){var kt,sn=void 0;return At=At||{},ee=ee!==void 0?ee:wr[jr].fontName,je=je!==void 0?je:wr[jr].fontStyle,kt=ee.toLowerCase(),or[kt]!==void 0&&or[kt][je]!==void 0?sn=or[kt][je]:or[ee]!==void 0&&or[ee][je]!==void 0?sn=or[ee][je]:At.disableWarning===!1&&Dl.warn("Unable to look up font label for font '"+ee+"', '"+je+"'. Refer to getFontList() for available fonts."),sn||At.noFallback||(sn=or.times[je])==null&&(sn=or.times.normal),sn},co=M.__private__.putInfo=function(){var ee=Mr(),je=function(kt){return kt};for(var At in L!==null&&(je=Wr.encryptor(ee,0)),mt("<<"),mt("/Producer ("+uo(je("jsPDF "+$i.version))+")"),qn)qn.hasOwnProperty(At)&&qn[At]&&mt("/"+At.substr(0,1).toUpperCase()+At.substr(1)+" ("+uo(je(qn[At]))+")");mt("/CreationDate ("+uo(je(De))+")"),mt(">>"),mt("endobj")},Io=M.__private__.putCatalog=function(ee){var je=(ee=ee||{}).rootDictionaryObjId||ms;switch(Mr(),mt("<<"),mt("/Type /Catalog"),mt("/Pages "+je+" 0 R"),xr||(xr="fullwidth"),xr){case"fullwidth":mt("/OpenAction [3 0 R /FitH null]");break;case"fullheight":mt("/OpenAction [3 0 R /FitV null]");break;case"fullpage":mt("/OpenAction [3 0 R /Fit]");break;case"original":mt("/OpenAction [3 0 R /XYZ null null 1]");break;default:var At=""+xr;At.substr(At.length-1)==="%"&&(xr=parseInt(xr)/100),typeof xr=="number"&&mt("/OpenAction [3 0 R /XYZ null null "+$(xr)+"]")}switch(sr||(sr="continuous"),sr){case"continuous":mt("/PageLayout /OneColumn");break;case"single":mt("/PageLayout /SinglePage");break;case"two":case"twoleft":mt("/PageLayout /TwoColumnLeft");break;case"tworight":mt("/PageLayout /TwoColumnRight")}nn&&mt("/PageMode /"+nn),wt.publish("putCatalog"),mt(">>"),mt("endobj")},Ni=M.__private__.putTrailer=function(){mt("trailer"),mt("<<"),mt("/Size "+(pt+1)),mt("/Root "+pt+" 0 R"),mt("/Info "+(pt-1)+" 0 R"),L!==null&&mt("/Encrypt "+Wr.oid+" 0 R"),mt("/ID [ <"+$e+"> <"+$e+"> ]"),mt(">>")},ic=M.__private__.putHeader=function(){mt("%PDF-"+Q),mt("%")},rl=M.__private__.putXRef=function(){var ee="0000000000";mt("xref"),mt("0 "+(pt+1)),mt("0000000000 65535 f ");for(var je=1;je<=pt;je++)typeof It[je]=="function"?mt((ee+It[je]()).slice(-10)+" 00000 n "):It[je]!==void 0?mt((ee+It[je]).slice(-10)+" 00000 n "):mt("0000000000 00000 n ")},il=M.__private__.buildDocument=function(){var ee;pt=0,Wt=0,Oe=[],It=[],Zt=[],ms=Zr(),Os=Zr(),on(Oe),wt.publish("buildDocument"),ic(),ua(),(function(){wt.publish("putAdditionalObjects");for(var At=0;At<Zt.length;At++){var kt=Zt[At];Br(kt.objId,!0),mt(kt.content),mt("endobj")}wt.publish("postPutAdditionalObjects")})(),ee=[],(function(){for(var At in wr)wr.hasOwnProperty(At)&&(R===!1||R===!0&&U.hasOwnProperty(At))&&tl(wr[At])})(),(function(){var At;for(At in si)si.hasOwnProperty(At)&&yc(si[At])})(),(function(){for(var At in Gt)Gt.hasOwnProperty(At)&&Pa(Gt[At])})(),(function(At){var kt;for(kt in Kr)Kr.hasOwnProperty(kt)&&(Kr[kt]instanceof tg?di(Kr[kt]):Kr[kt]instanceof gy&&ou(Kr[kt],At))})(ee),wt.publish("putResources"),ee.forEach(Ss),Ss({resourcesOid:Os,objectOid:Number.MAX_SAFE_INTEGER}),wt.publish("postPutResources"),L!==null&&(Wr.oid=Mr(),mt("<<"),mt("/Filter /Standard"),mt("/V "+Wr.v),mt("/R "+Wr.r),mt("/U <"+Wr.toHexString(Wr.U)+">"),mt("/O <"+Wr.toHexString(Wr.O)+">"),mt("/P "+Wr.P),mt(">>"),mt("endobj")),co(),Io();var je=Wt;return rl(),Ni(),mt("startxref"),mt(""+je),mt("%%EOF"),on(Xt[We]),Oe.join(`
`)},Ga=M.__private__.getBlob=function(ee){return new Blob([Fr(ee)],{type:"application/pdf"})},ho=M.output=M.__private__.output=(Gr=function(ee,je){switch(typeof(je=je||{})=="string"?je={filename:je}:je.filename=je.filename||"generated.pdf",ee){case void 0:return il();case"save":M.save(je.filename);break;case"arraybuffer":return Fr(il());case"blob":return Ga(il());case"bloburi":case"bloburl":if(js.URL!==void 0&&typeof js.URL.createObjectURL=="function")return js.URL&&js.URL.createObjectURL(Ga(il()))||void 0;Dl.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var At="",kt=il();try{At=lE(kt)}catch{At=lE(unescape(encodeURIComponent(kt)))}return"data:application/pdf;filename="+je.filename+";base64,"+At;case"pdfobjectnewwindow":if(Object.prototype.toString.call(js)==="[object Window]"){var sn="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",fn=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';je.pdfObjectUrl&&(sn=je.pdfObjectUrl,fn="");var Qn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+sn+'"'+fn+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(je)+");<\/script></body></html>",Xr=js.open();return Xr!==null&&Xr.document.write(Qn),Xr}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(js)==="[object Window]"){var Qr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(je.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+je.filename+'" width="500px" height="400px" /></body></html>',oi=js.open();if(oi!==null){oi.document.write(Qr);var Ui=this;oi.document.documentElement.querySelector("#pdfViewer").onload=function(){oi.document.title=je.filename,oi.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Ui.output("bloburl"))}}return oi}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(js)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Ps='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",je)+'"></iframe></body></html>',Bs=js.open();if(Bs!==null&&(Bs.document.write(Ps),Bs.document.title=je.filename),Bs||typeof safari>"u")return Bs;break;case"datauri":case"dataurl":return js.document.location.href=this.output("datauristring",je);default:return null}},Gr.foo=function(){try{return Gr.apply(this,arguments)}catch(At){var ee=At.stack||"";~ee.indexOf(" at ")&&(ee=ee.split(" at ")[1]);var je="Error in function "+ee.split(`
`)[0].split("<")[0]+": "+At.message;if(!js.console)throw new Error(je);js.console.error(je,At),js.alert&&alert(je)}},Gr.foo.bar=Gr,Gr.foo),lr=function(ee){return Array.isArray(Ut)===!0&&Ut.indexOf(ee)>-1};switch(i){case"pt":ir=1;break;case"mm":ir=72/25.4;break;case"cm":ir=72/2.54;break;case"in":ir=72;break;case"px":ir=lr("px_scaling")==1?.75:96/72;break;case"pc":case"em":ir=12;break;case"ex":ir=6;break;default:if(typeof i!="number")throw new Error("Invalid unit: "+i);ir=i}var Wr=null;Ce(),Le();var Ur=M.__private__.getPageInfo=M.getPageInfo=function(ee){if(isNaN(ee)||ee%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:ft[ee].objId,pageNumber:ee,pageContext:ft[ee]}},ca=M.__private__.getPageInfoByObjId=function(ee){if(isNaN(ee)||ee%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var je in ft)if(ft[je].objId===ee)break;return Ur(je)},$a=M.__private__.getCurrentPageInfo=M.getCurrentPageInfo=function(){return{objId:ft[We].objId,pageNumber:We,pageContext:ft[We]}};M.addPage=function(){return Kl.apply(this,arguments),this},M.setPage=function(){return Wo.apply(this,arguments),on.call(this,Xt[We]),this},M.insertPage=function(ee){return this.addPage(),this.movePage(We,ee),this},M.movePage=function(ee,je){var At,kt;if(ee>je){At=Xt[ee],kt=ft[ee];for(var sn=ee;sn>je;sn--)Xt[sn]=Xt[sn-1],ft[sn]=ft[sn-1];Xt[je]=At,ft[je]=kt,this.setPage(je)}else if(ee<je){At=Xt[ee],kt=ft[ee];for(var fn=ee;fn<je;fn++)Xt[fn]=Xt[fn+1],ft[fn]=ft[fn+1];Xt[je]=At,ft[je]=kt,this.setPage(je)}return this},M.deletePage=function(){return ea.apply(this,arguments),this},M.__private__.text=M.text=function(ee,je,At,kt,sn){var fn,Qn,Xr,Qr,oi,Ui,Ps,Bs,fo,Ys=(kt=kt||{}).scope||this;if(typeof ee=="number"&&typeof je=="number"&&(typeof At=="string"||Array.isArray(At))){var Zs=At;At=je,je=ee,ee=Zs}if(arguments[3]instanceof zt==0?(Xr=arguments[4],Qr=arguments[5],dl(Ps=arguments[3])==="object"&&Ps!==null||(typeof Xr=="string"&&(Qr=Xr,Xr=null),typeof Ps=="string"&&(Qr=Ps,Ps=null),typeof Ps=="number"&&(Xr=Ps,Ps=null),kt={flags:Ps,angle:Xr,align:Qr})):(B("The transform parameter of text() with a Matrix value"),fo=sn),isNaN(je)||isNaN(At)||ee==null)throw new Error("Invalid arguments passed to jsPDF.text");if(ee.length===0)return Ys;var go,Ns="",io=typeof kt.lineHeightFactor=="number"?kt.lineHeightFactor:Ei,zs=Ys.internal.scaleFactor;function Fl(X){return X=X.split("	").join(Array(kt.TabLen||9).join(" ")),uo(X,Ps)}function gl(X){for(var he,Ae=X.concat(),Ye=[],bt=Ae.length;bt--;)typeof(he=Ae.shift())=="string"?Ye.push(he):Array.isArray(X)&&(he.length===1||he[1]===void 0&&he[2]===void 0)?Ye.push(he[0]):Ye.push([he[0],he[1],he[2]]);return Ye}function O(X,he){var Ae;if(typeof X=="string")Ae=he(X)[0];else if(Array.isArray(X)){for(var Ye,bt,an=X.concat(),mn=[],Kn=an.length;Kn--;)typeof(Ye=an.shift())=="string"?mn.push(he(Ye)[0]):Array.isArray(Ye)&&typeof Ye[0]=="string"&&(bt=he(Ye[0],Ye[1],Ye[2]),mn.push([bt[0],bt[1],bt[2]]));Ae=mn}return Ae}var me=!1,ke=!0;if(typeof ee=="string")me=!0;else if(Array.isArray(ee)){var nt=ee.concat();Qn=[];for(var hn,Cn=nt.length;Cn--;)(typeof(hn=nt.shift())!="string"||Array.isArray(hn)&&typeof hn[0]!="string")&&(ke=!1);me=ke}if(me===!1)throw new Error('Type of text must be string or Array. "'+ee+'" is not recognized.');typeof ee=="string"&&(ee=ee.match(/[\r?\n]/)?ee.split(/\r\n|\r|\n/g):[ee]);var Sr=$t/Ys.internal.scaleFactor,Rs=Sr*(io-1);switch(kt.baseline){case"bottom":At-=Rs;break;case"top":At+=Sr-Rs;break;case"hanging":At+=Sr-2*Rs;break;case"middle":At+=Sr/2-Rs}if((Ui=kt.maxWidth||0)>0&&(typeof ee=="string"?ee=Ys.splitTextToSize(ee,Ui):Object.prototype.toString.call(ee)==="[object Array]"&&(ee=ee.reduce(function(X,he){return X.concat(Ys.splitTextToSize(he,Ui))},[]))),fn={text:ee,x:je,y:At,options:kt,mutex:{pdfEscape:uo,activeFontKey:jr,fonts:wr,activeFontSize:$t}},wt.publish("preProcessText",fn),ee=fn.text,Xr=(kt=fn.options).angle,fo instanceof zt==0&&Xr&&typeof Xr=="number"){Xr*=Math.PI/180,kt.rotationDirection===0&&(Xr=-Xr),de===ve&&(Xr=-Xr);var so=Math.cos(Xr),hs=Math.sin(Xr);fo=new zt(so,hs,-hs,so,0,0)}else Xr&&Xr instanceof zt&&(fo=Xr);de!==ve||fo||(fo=Jn),(oi=kt.charSpace||os)!==void 0&&(Ns+=G(te(oi))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Bs=kt.horizontalScale)!==void 0&&(Ns+=G(100*Bs)+` Tz
`),kt.lang;var es=-1,Js=kt.renderingMode!==void 0?kt.renderingMode:kt.stroke,da=Ys.internal.getCurrentPageInfo().pageContext;switch(Js){case 0:case!1:case"fill":es=0;break;case 1:case!0:case"stroke":es=1;break;case 2:case"fillThenStroke":es=2;break;case 3:case"invisible":es=3;break;case 4:case"fillAndAddForClipping":es=4;break;case 5:case"strokeAndAddPathForClipping":es=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":es=6;break;case 7:case"addToPathForClipping":es=7}var oo=da.usedRenderingMode!==void 0?da.usedRenderingMode:-1;es!==-1?Ns+=es+` Tr
`:oo!==-1&&(Ns+=`0 Tr
`),es!==-1&&(da.usedRenderingMode=es),Qr=kt.align||"left";var Vi,Zl=$t*io,xa=Ys.internal.pageSize.getWidth(),Rc=wr[jr];oi=kt.charSpace||os,Ui=kt.maxWidth||0,Ps=Object.assign({autoencode:!0,noBOM:!0},kt.flags);var Ru=[],yu=function(X){return Ys.getStringUnitWidth(X,{font:Rc,charSpace:oi,fontSize:$t,doKerning:!1})*$t/zs};if(Object.prototype.toString.call(ee)==="[object Array]"){var Wa;Qn=gl(ee),Qr!=="left"&&(Vi=Qn.map(yu));var al,Hu=0;if(Qr==="right"){je-=Vi[0],ee=[],Cn=Qn.length;for(var yo=0;yo<Cn;yo++)yo===0?(al=Fs(je),Wa=na(At)):(al=te(Hu-Vi[yo]),Wa=-Zl),ee.push([Qn[yo],al,Wa]),Hu=Vi[yo]}else if(Qr==="center"){je-=Vi[0]/2,ee=[],Cn=Qn.length;for(var ia=0;ia<Cn;ia++)ia===0?(al=Fs(je),Wa=na(At)):(al=te((Hu-Vi[ia])/2),Wa=-Zl),ee.push([Qn[ia],al,Wa]),Hu=Vi[ia]}else if(Qr==="left"){ee=[],Cn=Qn.length;for(var ll=0;ll<Cn;ll++)ee.push(Qn[ll])}else if(Qr==="justify"&&Rc.encoding==="Identity-H"){ee=[],Cn=Qn.length,Ui=Ui!==0?Ui:xa;for(var Bl=0,No=0;No<Cn;No++)if(Wa=No===0?na(At):-Zl,al=No===0?Fs(je):Bl,No<Cn-1){var po=te((Ui-Vi[No])/(Qn[No].split(" ").length-1)),Ra=Qn[No].split(" ");ee.push([Ra[0]+" ",al,Wa]),Bl=0;for(var sa=1;sa<Ra.length;sa++){var sc=(yu(Ra[sa-1]+" "+Ra[sa])-yu(Ra[sa]))*zs+po;sa==Ra.length-1?ee.push([Ra[sa],sc,0]):ee.push([Ra[sa]+" ",sc,0]),Bl-=sc}}else ee.push([Qn[No],al,Wa]);ee.push(["",Bl,0])}else{if(Qr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(ee=[],Cn=Qn.length,Ui=Ui!==0?Ui:xa,No=0;No<Cn;No++){Wa=No===0?na(At):-Zl,al=No===0?Fs(je):0;var _u=Qn[No].split(" ").length-1,zl=_u>0?(Ui-Vi[No])/_u:0;No<Cn-1?Ru.push(G(te(zl))):Ru.push(0),ee.push([Qn[No],al,Wa])}}}(typeof kt.R2L=="boolean"?kt.R2L:ni)===!0&&(ee=O(ee,function(X,he,Ae){return[X.split("").reverse().join(""),he,Ae]})),fn={text:ee,x:je,y:At,options:kt,mutex:{pdfEscape:uo,activeFontKey:jr,fonts:wr,activeFontSize:$t}},wt.publish("postProcessText",fn),ee=fn.text,go=fn.mutex.isHex||!1;var ul=wr[jr].encoding;ul!=="WinAnsiEncoding"&&ul!=="StandardEncoding"||(ee=O(ee,function(X,he,Ae){return[Fl(X),he,Ae]})),Qn=gl(ee),ee=[];for(var Jl,jo,oa,E=Array.isArray(Qn[0])?1:0,f="",d=function(X,he,Ae){var Ye="";return Ae instanceof zt?(Ae=typeof kt.angle=="number"?Pn(Ae,new zt(1,0,0,1,X,he)):Pn(new zt(1,0,0,1,X,he),Ae),de===ve&&(Ae=Pn(new zt(1,0,0,-1,0,0),Ae)),Ye=Ae.join(" ")+` Tm
`):Ye=G(X)+" "+G(he)+` Td
`,Ye},S=0;S<Qn.length;S++){switch(f="",E){case 1:oa=(go?"<":"(")+Qn[S][0]+(go?">":")"),Jl=parseFloat(Qn[S][1]),jo=parseFloat(Qn[S][2]);break;case 0:oa=(go?"<":"(")+Qn[S]+(go?">":")"),Jl=Fs(je),jo=na(At)}Ru!==void 0&&Ru[S]!==void 0&&(f=Ru[S]+` Tw
`),S===0?ee.push(f+d(Jl,jo,fo)+oa):E===0?ee.push(f+oa):E===1&&ee.push(f+d(Jl,jo,fo)+oa)}ee=E===0?ee.join(` Tj
T* `):ee.join(` Tj
`),ee+=` Tj
`;var N=`BT
/`;return N+=jr+" "+$t+` Tf
`,N+=G($t*io)+` TL
`,N+=ha+`
`,N+=Ns,N+=ee,mt(N+="ET"),U[jr]=!0,Ys};var Ri=M.__private__.clip=M.clip=function(ee){return mt(ee==="evenodd"?"W*":"W"),this};M.clipEvenOdd=function(){return Ri("evenodd")},M.__private__.discardPath=M.discardPath=function(){return mt("n"),this};var Hi=M.__private__.isValidStyle=function(ee){var je=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(ee)!==-1&&(je=!0),je};M.__private__.setDefaultPathOperation=M.setDefaultPathOperation=function(ee){return Hi(ee)&&(T=ee),this};var Tl=M.__private__.getStyle=M.getStyle=function(ee){var je=T;switch(ee){case"D":case"S":je="S";break;case"F":je="f";break;case"FD":case"DF":je="B";break;case"f":case"f*":case"B":case"B*":je=ee}return je},Wi=M.close=function(){return mt("h"),this};M.stroke=function(){return mt("S"),this},M.fill=function(ee){return ko("f",ee),this},M.fillEvenOdd=function(ee){return ko("f*",ee),this},M.fillStroke=function(ee){return ko("B",ee),this},M.fillStrokeEvenOdd=function(ee){return ko("B*",ee),this};var ko=function(ee,je){dl(je)==="object"?lu(je,ee):mt(ee)},ss=function(ee){ee===null||de===ve&&ee===void 0||(ee=Tl(ee),mt(ee))};function $u(ee,je,At,kt,sn){var fn=new gy(je||this.boundingBox,At||this.xStep,kt||this.yStep,this.gState,sn||this.matrix);fn.stream=this.stream;var Qn=ee+"$$"+this.cloneIndex+++"$$";return Fn(Qn,fn),fn}var lu=function(ee,je){var At=wi[ee.key],kt=Kr[At];if(kt instanceof tg)mt("q"),mt(mu(je)),kt.gState&&M.setGState(kt.gState),mt(ee.matrix.toString()+" cm"),mt("/"+At+" sh"),mt("Q");else if(kt instanceof gy){var sn=new zt(1,0,0,-1,0,fa());ee.matrix&&(sn=sn.multiply(ee.matrix||Jn),At=$u.call(kt,ee.key,ee.boundingBox,ee.xStep,ee.yStep,sn).id),mt("q"),mt("/Pattern cs"),mt("/"+At+" scn"),kt.gState&&M.setGState(kt.gState),mt(je),mt("Q")}},mu=function(ee){switch(ee){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Us=M.moveTo=function(ee,je){return mt(G(te(ee))+" "+G(Se(je))+" m"),this},Ha=M.lineTo=function(ee,je){return mt(G(te(ee))+" "+G(Se(je))+" l"),this},sl=M.curveTo=function(ee,je,At,kt,sn,fn){return mt([G(te(ee)),G(Se(je)),G(te(At)),G(Se(kt)),G(te(sn)),G(Se(fn)),"c"].join(" ")),this};M.__private__.line=M.line=function(ee,je,At,kt,sn){if(isNaN(ee)||isNaN(je)||isNaN(At)||isNaN(kt)||!Hi(sn))throw new Error("Invalid arguments passed to jsPDF.line");return de===oe?this.lines([[At-ee,kt-je]],ee,je,[1,1],sn||"S"):this.lines([[At-ee,kt-je]],ee,je,[1,1]).stroke()},M.__private__.lines=M.lines=function(ee,je,At,kt,sn,fn){var Qn,Xr,Qr,oi,Ui,Ps,Bs,fo,Ys,Zs,go,Ns;if(typeof ee=="number"&&(Ns=At,At=je,je=ee,ee=Ns),kt=kt||[1,1],fn=fn||!1,isNaN(je)||isNaN(At)||!Array.isArray(ee)||!Array.isArray(kt)||!Hi(sn)||typeof fn!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Us(je,At),Qn=kt[0],Xr=kt[1],oi=ee.length,Zs=je,go=At,Qr=0;Qr<oi;Qr++)(Ui=ee[Qr]).length===2?(Zs=Ui[0]*Qn+Zs,go=Ui[1]*Xr+go,Ha(Zs,go)):(Ps=Ui[0]*Qn+Zs,Bs=Ui[1]*Xr+go,fo=Ui[2]*Qn+Zs,Ys=Ui[3]*Xr+go,Zs=Ui[4]*Qn+Zs,go=Ui[5]*Xr+go,sl(Ps,Bs,fo,Ys,Zs,go));return fn&&Wi(),ss(sn),this},M.path=function(ee){for(var je=0;je<ee.length;je++){var At=ee[je],kt=At.c;switch(At.op){case"m":Us(kt[0],kt[1]);break;case"l":Ha(kt[0],kt[1]);break;case"c":sl.apply(this,kt);break;case"h":Wi()}}return this},M.__private__.rect=M.rect=function(ee,je,At,kt,sn){if(isNaN(ee)||isNaN(je)||isNaN(At)||isNaN(kt)||!Hi(sn))throw new Error("Invalid arguments passed to jsPDF.rect");return de===oe&&(kt=-kt),mt([G(te(ee)),G(Se(je)),G(te(At)),G(te(kt)),"re"].join(" ")),ss(sn),this},M.__private__.triangle=M.triangle=function(ee,je,At,kt,sn,fn,Qn){if(isNaN(ee)||isNaN(je)||isNaN(At)||isNaN(kt)||isNaN(sn)||isNaN(fn)||!Hi(Qn))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[At-ee,kt-je],[sn-At,fn-kt],[ee-sn,je-fn]],ee,je,[1,1],Qn,!0),this},M.__private__.roundedRect=M.roundedRect=function(ee,je,At,kt,sn,fn,Qn){if(isNaN(ee)||isNaN(je)||isNaN(At)||isNaN(kt)||isNaN(sn)||isNaN(fn)||!Hi(Qn))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Xr=4/3*(Math.SQRT2-1);return sn=Math.min(sn,.5*At),fn=Math.min(fn,.5*kt),this.lines([[At-2*sn,0],[sn*Xr,0,sn,fn-fn*Xr,sn,fn],[0,kt-2*fn],[0,fn*Xr,-sn*Xr,fn,-sn,fn],[2*sn-At,0],[-sn*Xr,0,-sn,-fn*Xr,-sn,-fn],[0,2*fn-kt],[0,-fn*Xr,sn*Xr,-fn,sn,-fn]],ee+sn,je,[1,1],Qn,!0),this},M.__private__.ellipse=M.ellipse=function(ee,je,At,kt,sn){if(isNaN(ee)||isNaN(je)||isNaN(At)||isNaN(kt)||!Hi(sn))throw new Error("Invalid arguments passed to jsPDF.ellipse");var fn=4/3*(Math.SQRT2-1)*At,Qn=4/3*(Math.SQRT2-1)*kt;return Us(ee+At,je),sl(ee+At,je-Qn,ee+fn,je-kt,ee,je-kt),sl(ee-fn,je-kt,ee-At,je-Qn,ee-At,je),sl(ee-At,je+Qn,ee-fn,je+kt,ee,je+kt),sl(ee+fn,je+kt,ee+At,je+Qn,ee+At,je),ss(sn),this},M.__private__.circle=M.circle=function(ee,je,At,kt){if(isNaN(ee)||isNaN(je)||isNaN(At)||!Hi(kt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(ee,je,At,At,kt)},M.setFont=function(ee,je,At){return At&&(je=_e(je,At)),jr=En(ee,je,{disableWarning:!1}),this};var Vo=M.__private__.getFont=M.getFont=function(){return wr[En.apply(M,arguments)]};M.__private__.getFontList=M.getFontList=function(){var ee,je,At={};for(ee in or)if(or.hasOwnProperty(ee))for(je in At[ee]=[],or[ee])or[ee].hasOwnProperty(je)&&At[ee].push(je);return At},M.addFont=function(ee,je,At,kt,sn){var fn=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&fn.indexOf(arguments[3])!==-1?sn=arguments[3]:arguments[3]&&fn.indexOf(arguments[3])==-1&&(At=_e(At,kt)),ga.call(this,ee,je,At,sn=sn||"Identity-H")};var Ei,bo=n.lineWidth||.200025,gi=M.__private__.getLineWidth=M.getLineWidth=function(){return bo},wo=M.__private__.setLineWidth=M.setLineWidth=function(ee){return bo=ee,mt(G(te(ee))+" w"),this};M.__private__.setLineDash=$i.API.setLineDash=$i.API.setLineDashPattern=function(ee,je){if(ee=ee||[],je=je||0,isNaN(je)||!Array.isArray(ee))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return ee=ee.map(function(At){return G(te(At))}).join(" "),je=G(te(je)),mt("["+ee+"] "+je+" d"),this};var Vs=M.__private__.getLineHeight=M.getLineHeight=function(){return $t*Ei};M.__private__.getLineHeight=M.getLineHeight=function(){return $t*Ei};var Nc=M.__private__.setLineHeightFactor=M.setLineHeightFactor=function(ee){return typeof(ee=ee||1.15)=="number"&&(Ei=ee),this},Pu=M.__private__.getLineHeightFactor=M.getLineHeightFactor=function(){return Ei};Nc(n.lineHeight);var Fs=M.__private__.getHorizontalCoordinate=function(ee){return te(ee)},na=M.__private__.getVerticalCoordinate=function(ee){return de===ve?ee:ft[We].mediaBox.topRightY-ft[We].mediaBox.bottomLeftY-te(ee)},Es=M.__private__.getHorizontalCoordinateString=M.getHorizontalCoordinateString=function(ee){return G(Fs(ee))},xs=M.__private__.getVerticalCoordinateString=M.getVerticalCoordinateString=function(ee){return G(na(ee))},Ts=n.strokeColor||"0 G";M.__private__.getStrokeColor=M.getDrawColor=function(){return cs(Ts)},M.__private__.setStrokeColor=M.setDrawColor=function(ee,je,At,kt){return Ts=ps({ch1:ee,ch2:je,ch3:At,ch4:kt,pdfColorType:"draw",precision:2}),mt(Ts),this};var Ol=n.fillColor||"0 g";M.__private__.getFillColor=M.getFillColor=function(){return cs(Ol)},M.__private__.setFillColor=M.setFillColor=function(ee,je,At,kt){return Ol=ps({ch1:ee,ch2:je,ch3:At,ch4:kt,pdfColorType:"fill",precision:2}),mt(Ol),this};var ha=n.textColor||"0 g",ra=M.__private__.getTextColor=M.getTextColor=function(){return cs(ha)};M.__private__.setTextColor=M.setTextColor=function(ee,je,At,kt){return ha=ps({ch1:ee,ch2:je,ch3:At,ch4:kt,pdfColorType:"text",precision:3}),this};var os=n.charSpace,gu=M.__private__.getCharSpace=M.getCharSpace=function(){return parseFloat(os||0)};M.__private__.setCharSpace=M.setCharSpace=function(ee){if(isNaN(ee))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return os=ee,this};var ro=0;M.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},M.__private__.setLineCap=M.setLineCap=function(ee){var je=M.CapJoinStyles[ee];if(je===void 0)throw new Error("Line cap style of '"+ee+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return ro=je,mt(je+" J"),this};var ya=0;M.__private__.setLineJoin=M.setLineJoin=function(ee){var je=M.CapJoinStyles[ee];if(je===void 0)throw new Error("Line join style of '"+ee+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return ya=je,mt(je+" j"),this},M.__private__.setLineMiterLimit=M.__private__.setMiterLimit=M.setLineMiterLimit=M.setMiterLimit=function(ee){if(ee=ee||0,isNaN(ee))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return mt(G(te(ee))+" M"),this},M.GState=zv,M.setGState=function(ee){(ee=typeof ee=="string"?si[vt[ee]]:ol(null,ee)).equals(Ne)||(mt("/"+ee.id+" gs"),Ne=ee)};var ol=function(ee,je){if(!ee||!vt[ee]){var At=!1;for(var kt in si)if(si.hasOwnProperty(kt)&&si[kt].equals(je)){At=!0;break}if(At)je=si[kt];else{var sn="GS"+(Object.keys(si).length+1).toString(10);si[sn]=je,je.id=sn}return ee&&(vt[ee]=je.id),wt.publish("addGState",je),je}};M.addGState=function(ee,je){return ol(ee,je),this},M.saveGraphicsState=function(){return mt("q"),ui.push({key:jr,size:$t,color:ha}),this},M.restoreGraphicsState=function(){mt("Q");var ee=ui.pop();return jr=ee.key,$t=ee.size,ha=ee.color,Ne=null,this},M.setCurrentTransformationMatrix=function(ee){return mt(ee.toString()+" cm"),this},M.comment=function(ee){return mt("#"+ee),this};var Al=function(ee,je){var At=ee||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return At},set:function(fn){isNaN(fn)||(At=parseFloat(fn))}});var kt=je||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return kt},set:function(fn){isNaN(fn)||(kt=parseFloat(fn))}});var sn="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return sn},set:function(fn){sn=fn.toString()}}),this},Nu=function(ee,je,At,kt){Al.call(this,ee,je),this.type="rect";var sn=At||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return sn},set:function(Qn){isNaN(Qn)||(sn=parseFloat(Qn))}});var fn=kt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return fn},set:function(Qn){isNaN(Qn)||(fn=parseFloat(Qn))}}),this},Na=function(){this.page=ze,this.currentPage=We,this.pages=Xt.slice(0),this.pagesContext=ft.slice(0),this.x=Xn,this.y=Bi,this.matrix=bi,this.width=qs(We),this.height=_a(We),this.outputDestination=zn,this.id="",this.objectNumber=-1};Na.prototype.restore=function(){ze=this.page,We=this.currentPage,ft=this.pagesContext,Xt=this.pages,Xn=this.x,Bi=this.y,bi=this.matrix,Lo(We,this.width),zo(We,this.height),zn=this.outputDestination};var qo=function(ee,je,At,kt,sn){Ot.push(new Na),ze=We=0,Xt=[],Xn=ee,Bi=je,bi=sn,nl([At,kt])};for(var ji in M.beginFormObject=function(ee,je,At,kt,sn){return qo(ee,je,At,kt,sn),this},M.endFormObject=function(ee){return(function(je){if(Tt[je])Ot.pop().restore();else{var At=new Na,kt="Xo"+(Object.keys(Gt).length+1).toString(10);At.id=kt,Tt[je]=kt,Gt[kt]=At,wt.publish("addFormObject",At),Ot.pop().restore()}})(ee),this},M.doFormObject=function(ee,je){var At=Gt[Tt[ee]];return mt("q"),mt(je.toString()+" cm"),mt("/"+At.id+" Do"),mt("Q"),this},M.getFormObject=function(ee){var je=Gt[Tt[ee]];return{x:je.x,y:je.y,width:je.width,height:je.height,matrix:je.matrix}},M.save=function(ee,je){return ee=ee||"generated.pdf",(je=je||{}).returnPromise=je.returnPromise||!1,je.returnPromise===!1?(Zm(Ga(il()),ee),typeof Zm.unload=="function"&&js.setTimeout&&setTimeout(Zm.unload,911),this):new Promise(function(At,kt){try{var sn=Zm(Ga(il()),ee);typeof Zm.unload=="function"&&js.setTimeout&&setTimeout(Zm.unload,911),At(sn)}catch(fn){kt(fn.message)}})},$i.API)$i.API.hasOwnProperty(ji)&&(ji==="events"&&$i.API.events.length?(function(ee,je){var At,kt,sn;for(sn=je.length-1;sn!==-1;sn--)At=je[sn][0],kt=je[sn][1],ee.subscribe.apply(ee,[At].concat(typeof kt=="function"?[kt]:kt))})(wt,$i.API.events):M[ji]=$i.API[ji]);function qs(ee){return ft[ee].mediaBox.topRightX-ft[ee].mediaBox.bottomLeftX}function Lo(ee,je){ft[ee].mediaBox.topRightX=je+ft[ee].mediaBox.bottomLeftX}function _a(ee){return ft[ee].mediaBox.topRightY-ft[ee].mediaBox.bottomLeftY}function zo(ee,je){ft[ee].mediaBox.topRightY=je+ft[ee].mediaBox.bottomLeftY}var ml=M.getPageWidth=function(ee){return qs(ee=ee||We)/ir},Po=M.setPageWidth=function(ee,je){Lo(ee,je*ir)},fa=M.getPageHeight=function(ee){return _a(ee=ee||We)/ir},va=M.setPageHeight=function(ee,je){zo(ee,je*ir)};return M.internal={pdfEscape:uo,getStyle:Tl,getFont:Vo,getFontSize:dr,getCharSpace:gu,getTextColor:ra,getLineHeight:Vs,getLineHeightFactor:Pu,getLineWidth:gi,write:Ir,getHorizontalCoordinate:Fs,getVerticalCoordinate:na,getCoordinateString:Es,getVerticalCoordinateString:xs,collections:{},newObject:Mr,newAdditionalObject:zi,newObjectDeferred:Zr,newObjectDeferredBegin:Br,getFilters:vo,putStream:is,events:wt,scaleFactor:ir,pageSize:{getWidth:function(){return ml(We)},setWidth:function(ee){Po(We,ee)},getHeight:function(){return fa(We)},setHeight:function(ee){va(We,ee)}},encryptionOptions:L,encryption:Wr,getEncryptor:function(ee){return L!==null?Wr.encryptor(ee,0):function(je){return je}},output:ho,getNumberOfPages:ta,pages:Xt,out:mt,f2:$,f3:J,getPageInfo:Ur,getPageInfoByObjId:ca,getCurrentPageInfo:$a,getPDFVersion:ae,Point:Al,Rectangle:Nu,Matrix:zt,hasHotfix:lr},Object.defineProperty(M.internal.pageSize,"width",{get:function(){return ml(We)},set:function(ee){Po(We,ee)},enumerable:!0,configurable:!0}),Object.defineProperty(M.internal.pageSize,"height",{get:function(){return fa(We)},set:function(ee){va(We,ee)},enumerable:!0,configurable:!0}),(function(ee){for(var je=0,At=qr.length;je<At;je++){var kt=ga.call(this,ee[je][0],ee[je][1],ee[je][2],qr[je][3],!0);R===!1&&(U[kt]=!0);var sn=ee[je][0].split("-");au({id:kt,fontName:sn[0],fontStyle:sn[1]||""})}wt.publish("addFonts",{fonts:wr,dictionary:or})}).call(M,qr),jr="F1",Kl(a,t),wt.publish("initialized"),M}uy.prototype.lsbFirstWord=function(n){return String.fromCharCode(255&n,n>>8&255,n>>16&255,n>>24&255)},uy.prototype.toHexString=function(n){return n.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},uy.prototype.hexToBytes=function(n){for(var e=[],t=0;t<n.length;t+=2)e.push(String.fromCharCode(parseInt(n.substr(t,2),16)));return e.join("")},uy.prototype.processOwnerPassword=function(n,e){return o5(s5(e).substr(0,5),n)},uy.prototype.encryptor=function(n,e){var t=s5(this.encryptionKey+String.fromCharCode(255&n,n>>8&255,n>>16&255,255&e,e>>8&255)).substr(0,10);return function(i){return o5(t,i)}},zv.prototype.equals=function(n){var e,t="id,objectNumber,equals";if(!n||dl(n)!==dl(this))return!1;var i=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!n.hasOwnProperty(e)||this[e]!==n[e])return!1;i++}for(e in n)n.hasOwnProperty(e)&&t.indexOf(e)<0&&i--;return i===0},$i.API={events:[]},$i.version="3.0.3";var qu=$i.API,u3=1,Sg=function(n){return n.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},ty=function(n){return n.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},eo=function(n){return n.toFixed(2)},Jp=function(n){return n.toFixed(5)};qu.__acroform__={};var uf=function(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n},fE=function(n){return n*u3},Ld=function(n){var e=new UC,t=Pi.internal.getHeight(n)||0,i=Pi.internal.getWidth(n)||0;return e.BBox=[0,0,Number(eo(i)),Number(eo(t))],e},ZM=qu.__acroform__.setBit=function(n,e){if(n=n||0,e=e||0,isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return n|1<<e},JM=qu.__acroform__.clearBit=function(n,e){if(n=n||0,e=e||0,isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return n&~(1<<e)},QM=qu.__acroform__.getBit=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return n&1<<e?1:0},tc=qu.__acroform__.getBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return QM(n,e-1)},nc=qu.__acroform__.setBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return ZM(n,e-1)},rc=qu.__acroform__.clearBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return JM(n,e-1)},e7=qu.__acroform__.calculateCoordinates=function(n,e){var t=e.internal.getHorizontalCoordinate,i=e.internal.getVerticalCoordinate,a=n[0],c=n[1],_=n[2],y=n[3],s={};return s.lowerLeft_X=t(a)||0,s.lowerLeft_Y=i(c+y)||0,s.upperRight_X=t(a+_)||0,s.upperRight_Y=i(c)||0,[Number(eo(s.lowerLeft_X)),Number(eo(s.lowerLeft_Y)),Number(eo(s.upperRight_X)),Number(eo(s.upperRight_Y))]},t7=function(n){if(n.appearanceStreamContent)return n.appearanceStreamContent;if(n.V||n.DV){var e=[],t=n._V||n.DV,i=a5(n,t),a=n.scope.internal.getFont(n.fontName,n.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(n.scope.__private__.encodeColorString(n.color)),e.push("/"+a+" "+eo(i.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(i.text),e.push("ET"),e.push("Q"),e.push("EMC");var c=Ld(n);return c.scope=n.scope,c.stream=e.join(`
`),c}},a5=function(n,e){var t=n.fontSize===0?n.maxFontSize:n.fontSize,i={text:"",fontSize:""},a=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");a=n.multiline?a.map(function($){return $.split(`
`)}):a.map(function($){return[$]});var c=t,_=Pi.internal.getHeight(n)||0;_=_<0?-_:_;var y=Pi.internal.getWidth(n)||0;y=y<0?-y:y;var s=function($,J,te){if($+1<a.length){var Se=J+" "+a[$+1][0];return M1(Se,n,te).width<=y-4}return!1};c++;e:for(;c>0;){e="",c--;var T,L,R=M1("3",n,c).height,U=n.multiline?_-c:(_-R)/2,M=U+=2,Q=0,ae=0,ye=0;if(c<=0){e=`(...) Tj
`,e+="% Width of Text: "+M1(e,n,c=12).width+", FieldWidth:"+y+`
`;break}for(var ie="",oe=0,ve=0;ve<a.length;ve++)if(a.hasOwnProperty(ve)){var de=!1;if(a[ve].length!==1&&ye!==a[ve].length-1){if((R+2)*(oe+2)+2>_)continue e;ie+=a[ve][ye],de=!0,ae=ve,ve--}else{ie=(ie+=a[ve][ye]+" ").substr(ie.length-1)==" "?ie.substr(0,ie.length-1):ie;var Pe=parseInt(ve),Be=s(Pe,ie,c),_e=ve>=a.length-1;if(Be&&!_e){ie+=" ",ye=0;continue}if(Be||_e){if(_e)ae=Pe;else if(n.multiline&&(R+2)*(oe+2)+2>_)continue e}else{if(!n.multiline||(R+2)*(oe+2)+2>_)continue e;ae=Pe}}for(var G="",B=Q;B<=ae;B++){var Y=a[B];if(n.multiline){if(B===ae){G+=Y[ye]+" ",ye=(ye+1)%Y.length;continue}if(B===Q){G+=Y[Y.length-1]+" ";continue}}G+=Y[0]+" "}switch(G=G.substr(G.length-1)==" "?G.substr(0,G.length-1):G,L=M1(G,n,c).width,n.textAlign){case"right":T=y-L-2;break;case"center":T=(y-L)/2;break;default:T=2}e+=eo(T)+" "+eo(M)+` Td
`,e+="("+Sg(G)+`) Tj
`,e+=-eo(T)+` 0 Td
`,M=-(c+2),L=0,Q=de?ae:ae+1,oe++,ie=""}break}return i.text=e,i.fontSize=c,i},M1=function(n,e,t){var i=e.scope.internal.getFont(e.fontName,e.fontStyle),a=e.scope.getStringUnitWidth(n,{font:i,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:i,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:a}},n7={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},r7=function(n,e){var t={type:"reference",object:n};e.internal.getPageInfo(n.page).pageContext.annotations.find(function(i){return i.type===t.type&&i.object===t.object})===void 0&&e.internal.getPageInfo(n.page).pageContext.annotations.push(t)},i7=function(n,e){if(e.scope=n,n.internal!==void 0&&(n.internal.acroformPlugin===void 0||n.internal.acroformPlugin.isInitialized===!1)){if(gd.FieldNum=0,n.internal.acroformPlugin=JSON.parse(JSON.stringify(n7)),n.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");u3=n.internal.scaleFactor,n.internal.acroformPlugin.acroFormDictionaryRoot=new VC,n.internal.acroformPlugin.acroFormDictionaryRoot.scope=n,n.internal.acroformPlugin.acroFormDictionaryRoot._eventID=n.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(n)}),n.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var i=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var a in i)if(i.hasOwnProperty(a)){var c=i[a];c.objId=void 0,c.hasAnnotation&&r7(c,t)}})(n)}),n.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(n)}),n.internal.events.subscribe("postPutPages",function(t){(function(i,a){var c=!i;for(var _ in i||(a.internal.newObjectDeferredBegin(a.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),a.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),i=i||a.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(i.hasOwnProperty(_)){var y=i[_],s=[],T=y.Rect;if(y.Rect&&(y.Rect=e7(y.Rect,a)),a.internal.newObjectDeferredBegin(y.objId,!0),y.DA=Pi.createDefaultAppearanceStream(y),dl(y)==="object"&&typeof y.getKeyValueListForStream=="function"&&(s=y.getKeyValueListForStream()),y.Rect=T,y.hasAppearanceStream&&!y.appearanceStreamContent){var L=t7(y);s.push({key:"AP",value:"<</N "+L+">>"}),a.internal.acroformPlugin.xForms.push(L)}if(y.appearanceStreamContent){var R="";for(var U in y.appearanceStreamContent)if(y.appearanceStreamContent.hasOwnProperty(U)){var M=y.appearanceStreamContent[U];if(R+="/"+U+" ",R+="<<",Object.keys(M).length>=1||Array.isArray(M)){for(var _ in M)if(M.hasOwnProperty(_)){var Q=M[_];typeof Q=="function"&&(Q=Q.call(a,y)),R+="/"+_+" "+Q+" ",a.internal.acroformPlugin.xForms.indexOf(Q)>=0||a.internal.acroformPlugin.xForms.push(Q)}}else typeof(Q=M)=="function"&&(Q=Q.call(a,y)),R+="/"+_+" "+Q,a.internal.acroformPlugin.xForms.indexOf(Q)>=0||a.internal.acroformPlugin.xForms.push(Q);R+=">>"}s.push({key:"AP",value:`<<
`+R+">>"})}a.internal.putStream({additionalKeyValues:s,objectId:y.objId}),a.internal.out("endobj")}c&&(function(ae,ye){for(var ie in ae)if(ae.hasOwnProperty(ie)){var oe=ie,ve=ae[ie];ye.internal.newObjectDeferredBegin(ve.objId,!0),dl(ve)==="object"&&typeof ve.putStream=="function"&&ve.putStream(),delete ae[oe]}})(a.internal.acroformPlugin.xForms,a)})(t,n)}),n.internal.acroformPlugin.isInitialized=!0}},jC=qu.__acroform__.arrayToPdfArray=function(n,e,t){var i=function(_){return _};if(Array.isArray(n)){for(var a="[",c=0;c<n.length;c++)switch(c!==0&&(a+=" "),dl(n[c])){case"boolean":case"number":case"object":a+=n[c].toString();break;case"string":n[c].substr(0,1)!=="/"?(e!==void 0&&t&&(i=t.internal.getEncryptor(e)),a+="("+Sg(i(n[c].toString()))+")"):a+=n[c].toString()}return a+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},lw=function(n,e,t){var i=function(a){return a};return e!==void 0&&t&&(i=t.internal.getEncryptor(e)),(n=n||"").toString(),"("+Sg(i(n))+")"},Bd=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(n){this._objId=n}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Bd.prototype.toString=function(){return this.objId+" 0 R"},Bd.prototype.putStream=function(){var n=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:n,objectId:this.objId}),this.scope.internal.out("endobj")},Bd.prototype.getKeyValueListForStream=function(){var n=[],e=Object.getOwnPropertyNames(this).filter(function(c){return c!="content"&&c!="appearanceStreamContent"&&c!="scope"&&c!="objId"&&c.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var i=e[t],a=this[i];a&&(Array.isArray(a)?n.push({key:i,value:jC(a,this.objId,this.scope)}):a instanceof Bd?(a.scope=this.scope,n.push({key:i,value:a.objId+" 0 R"})):typeof a!="function"&&n.push({key:i,value:a}))}return n};var UC=function(){Bd.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var n,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){n=t.trim()},get:function(){return n||null}})};uf(UC,Bd);var VC=function(){Bd.call(this);var n,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(n){var t=function(i){return i};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+Sg(t(n))+")"}},set:function(t){n=t}})};uf(VC,Bd);var gd=function n(){Bd.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(ie){if(isNaN(ie))throw new Error('Invalid value "'+ie+'" for attribute F supplied.');e=ie}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!tc(e,3)},set:function(ie){ie?this.F=nc(e,3):this.F=rc(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(ie){if(isNaN(ie))throw new Error('Invalid value "'+ie+'" for attribute Ff supplied.');t=ie}});var i=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(i.length!==0)return i},set:function(ie){i=ie!==void 0?ie:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[0])?0:i[0]},set:function(ie){i[0]=ie}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[1])?0:i[1]},set:function(ie){i[1]=ie}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[2])?0:i[2]},set:function(ie){i[2]=ie}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[3])?0:i[3]},set:function(ie){i[3]=ie}});var a="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return a},set:function(ie){switch(ie){case"/Btn":case"/Tx":case"/Ch":case"/Sig":a=ie;break;default:throw new Error('Invalid value "'+ie+'" for attribute FT supplied.')}}});var c=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!c||c.length<1){if(this instanceof jv)return;c="FieldObject"+n.FieldNum++}var ie=function(oe){return oe};return this.scope&&(ie=this.scope.internal.getEncryptor(this.objId)),"("+Sg(ie(c))+")"},set:function(ie){c=ie.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return c},set:function(ie){c=ie}});var _="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return _},set:function(ie){_=ie}});var y="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return y},set:function(ie){y=ie}});var s=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return s},set:function(ie){s=ie}});var T=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return T===void 0?50/u3:T},set:function(ie){T=ie}});var L="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return L},set:function(ie){L=ie}});var R="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!R||this instanceof jv||this instanceof og))return lw(R,this.objId,this.scope)},set:function(ie){ie=ie.toString(),R=ie}});var U=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(U)return this instanceof Gc==0?lw(U,this.objId,this.scope):U},set:function(ie){ie=ie.toString(),U=this instanceof Gc==0?ie.substr(0,1)==="("?ty(ie.substr(1,ie.length-2)):ty(ie):ie}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Gc==1?ty(U.substr(1,U.length-1)):U},set:function(ie){ie=ie.toString(),U=this instanceof Gc==1?"/"+ie:ie}});var M=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(M)return M},set:function(ie){this.V=ie}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(M)return this instanceof Gc==0?lw(M,this.objId,this.scope):M},set:function(ie){ie=ie.toString(),M=this instanceof Gc==0?ie.substr(0,1)==="("?ty(ie.substr(1,ie.length-2)):ty(ie):ie}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Gc==1?ty(M.substr(1,M.length-1)):M},set:function(ie){ie=ie.toString(),M=this instanceof Gc==1?"/"+ie:ie}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var Q,ae=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return ae},set:function(ie){ie=!!ie,ae=ie}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(Q)return Q},set:function(ie){Q=ie}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,1)},set:function(ie){ie?this.Ff=nc(this.Ff,1):this.Ff=rc(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,2)},set:function(ie){ie?this.Ff=nc(this.Ff,2):this.Ff=rc(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,3)},set:function(ie){ie?this.Ff=nc(this.Ff,3):this.Ff=rc(this.Ff,3)}});var ye=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(ye!==null)return ye},set:function(ie){if([0,1,2].indexOf(ie)===-1)throw new Error('Invalid value "'+ie+'" for attribute Q supplied.');ye=ie}}),Object.defineProperty(this,"textAlign",{get:function(){var ie;switch(ye){case 0:default:ie="left";break;case 1:ie="center";break;case 2:ie="right"}return ie},configurable:!0,enumerable:!0,set:function(ie){switch(ie){case"right":case 2:ye=2;break;case"center":case 1:ye=1;break;default:ye=0}}})};uf(gd,Bd);var wy=function(){gd.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var n=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return n},set:function(t){n=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return jC(e,this.objId,this.scope)},set:function(t){var i,a;a=[],typeof(i=t)=="string"&&(a=(function(c,_,y){y||(y=1);for(var s,T=[];s=_.exec(c);)T.push(s[y]);return T})(i,/\((.*?)\)/g)),e=a}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,i){for(i=i||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),i!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,18)},set:function(t){t?this.Ff=nc(this.Ff,18):this.Ff=rc(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=nc(this.Ff,19):this.Ff=rc(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,20)},set:function(t){t?(this.Ff=nc(this.Ff,20),e.sort()):this.Ff=rc(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,22)},set:function(t){t?this.Ff=nc(this.Ff,22):this.Ff=rc(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,23)},set:function(t){t?this.Ff=nc(this.Ff,23):this.Ff=rc(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,27)},set:function(t){t?this.Ff=nc(this.Ff,27):this.Ff=rc(this.Ff,27)}}),this.hasAppearanceStream=!1};uf(wy,gd);var Sy=function(){wy.call(this),this.fontName="helvetica",this.combo=!1};uf(Sy,wy);var Ey=function(){Sy.call(this),this.combo=!0};uf(Ey,Sy);var uv=function(){Ey.call(this),this.edit=!0};uf(uv,Ey);var Gc=function(){gd.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,15)},set:function(t){t?this.Ff=nc(this.Ff,15):this.Ff=rc(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,16)},set:function(t){t?this.Ff=nc(this.Ff,16):this.Ff=rc(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,17)},set:function(t){t?this.Ff=nc(this.Ff,17):this.Ff=rc(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,26)},set:function(t){t?this.Ff=nc(this.Ff,26):this.Ff=rc(this.Ff,26)}});var n,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(c){return c};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var i,a=[];for(i in a.push("<<"),e)a.push("/"+i+" ("+Sg(t(e[i]))+")");return a.push(">>"),a.join(`
`)}},set:function(t){dl(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(t){n="/"+t}})};uf(Gc,gd);var cv=function(){Gc.call(this),this.pushButton=!0};uf(cv,Gc);var Ty=function(){Gc.call(this),this.radio=!0,this.pushButton=!1;var n=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e!==void 0?e:[]}})};uf(Ty,Gc);var jv=function(){var n,e;gd.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return n},set:function(a){n=a}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(a){e=a}});var t,i={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var a=function(y){return y};this.scope&&(a=this.scope.internal.getEncryptor(this.objId));var c,_=[];for(c in _.push("<<"),i)_.push("/"+c+" ("+Sg(a(i[c]))+")");return _.push(">>"),_.join(`
`)},set:function(a){dl(a)==="object"&&(i=a)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return i.CA||""},set:function(a){typeof a=="string"&&(i.CA=a)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(a){t=a}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(a){t="/"+a}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Pi.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};uf(jv,gd),Ty.prototype.setAppearance=function(n){if(!("createAppearanceStream"in n)||!("getCA"in n))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=n.createAppearanceStream(t.optionName),t.caption=n.getCA()}},Ty.prototype.createOption=function(n){var e=new jv;return e.Parent=this,e.optionName=n,this.Kids.push(e),s7.call(this.scope,e),e};var hv=function(){Gc.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Pi.CheckBox.createAppearanceStream()};uf(hv,Gc);var og=function(){gd.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,13)},set:function(e){e?this.Ff=nc(this.Ff,13):this.Ff=rc(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,21)},set:function(e){e?this.Ff=nc(this.Ff,21):this.Ff=rc(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,23)},set:function(e){e?this.Ff=nc(this.Ff,23):this.Ff=rc(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,24)},set:function(e){e?this.Ff=nc(this.Ff,24):this.Ff=rc(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,25)},set:function(e){e?this.Ff=nc(this.Ff,25):this.Ff=rc(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,26)},set:function(e){e?this.Ff=nc(this.Ff,26):this.Ff=rc(this.Ff,26)}});var n=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return n},set:function(e){Number.isInteger(e)&&(n=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};uf(og,gd);var fv=function(){og.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!tc(this.Ff,14)},set:function(n){n?this.Ff=nc(this.Ff,14):this.Ff=rc(this.Ff,14)}}),this.password=!0};uf(fv,og);var Pi={CheckBox:{createAppearanceStream:function(){return{N:{On:Pi.CheckBox.YesNormal},D:{On:Pi.CheckBox.YesPushDown,Off:Pi.CheckBox.OffPushDown}}},YesPushDown:function(n){var e=Ld(n);e.scope=n.scope;var t=[],i=n.scope.internal.getFont(n.fontName,n.fontStyle).id,a=n.scope.__private__.encodeColorString(n.color),c=a5(n,n.caption);return t.push("0.749023 g"),t.push("0 0 "+eo(Pi.internal.getWidth(n))+" "+eo(Pi.internal.getHeight(n))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+i+" "+eo(c.fontSize)+" Tf "+a),t.push("BT"),t.push(c.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(n){var e=Ld(n);e.scope=n.scope;var t=n.scope.internal.getFont(n.fontName,n.fontStyle).id,i=n.scope.__private__.encodeColorString(n.color),a=[],c=Pi.internal.getHeight(n),_=Pi.internal.getWidth(n),y=a5(n,n.caption);return a.push("1 g"),a.push("0 0 "+eo(_)+" "+eo(c)+" re"),a.push("f"),a.push("q"),a.push("0 0 1 rg"),a.push("0 0 "+eo(_-1)+" "+eo(c-1)+" re"),a.push("W"),a.push("n"),a.push("0 g"),a.push("BT"),a.push("/"+t+" "+eo(y.fontSize)+" Tf "+i),a.push(y.text),a.push("ET"),a.push("Q"),e.stream=a.join(`
`),e},OffPushDown:function(n){var e=Ld(n);e.scope=n.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+eo(Pi.internal.getWidth(n))+" "+eo(Pi.internal.getHeight(n))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(n){var e={D:{Off:Pi.RadioButton.Circle.OffPushDown},N:{}};return e.N[n]=Pi.RadioButton.Circle.YesNormal,e.D[n]=Pi.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(n){var e=Ld(n);e.scope=n.scope;var t=[],i=Pi.internal.getWidth(n)<=Pi.internal.getHeight(n)?Pi.internal.getWidth(n)/4:Pi.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var a=Pi.internal.Bezier_C,c=Number((i*a).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+Jp(Pi.internal.getWidth(n)/2)+" "+Jp(Pi.internal.getHeight(n)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+c+" "+c+" "+i+" 0 "+i+" c"),t.push("-"+c+" "+i+" -"+i+" "+c+" -"+i+" 0 c"),t.push("-"+i+" -"+c+" -"+c+" -"+i+" 0 -"+i+" c"),t.push(c+" -"+i+" "+i+" -"+c+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(n){var e=Ld(n);e.scope=n.scope;var t=[],i=Pi.internal.getWidth(n)<=Pi.internal.getHeight(n)?Pi.internal.getWidth(n)/4:Pi.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var a=Number((2*i).toFixed(5)),c=Number((a*Pi.internal.Bezier_C).toFixed(5)),_=Number((i*Pi.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Jp(Pi.internal.getWidth(n)/2)+" "+Jp(Pi.internal.getHeight(n)/2)+" cm"),t.push(a+" 0 m"),t.push(a+" "+c+" "+c+" "+a+" 0 "+a+" c"),t.push("-"+c+" "+a+" -"+a+" "+c+" -"+a+" 0 c"),t.push("-"+a+" -"+c+" -"+c+" -"+a+" 0 -"+a+" c"),t.push(c+" -"+a+" "+a+" -"+c+" "+a+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+Jp(Pi.internal.getWidth(n)/2)+" "+Jp(Pi.internal.getHeight(n)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+_+" "+_+" "+i+" 0 "+i+" c"),t.push("-"+_+" "+i+" -"+i+" "+_+" -"+i+" 0 c"),t.push("-"+i+" -"+_+" -"+_+" -"+i+" 0 -"+i+" c"),t.push(_+" -"+i+" "+i+" -"+_+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(n){var e=Ld(n);e.scope=n.scope;var t=[],i=Pi.internal.getWidth(n)<=Pi.internal.getHeight(n)?Pi.internal.getWidth(n)/4:Pi.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var a=Number((2*i).toFixed(5)),c=Number((a*Pi.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Jp(Pi.internal.getWidth(n)/2)+" "+Jp(Pi.internal.getHeight(n)/2)+" cm"),t.push(a+" 0 m"),t.push(a+" "+c+" "+c+" "+a+" 0 "+a+" c"),t.push("-"+c+" "+a+" -"+a+" "+c+" -"+a+" 0 c"),t.push("-"+a+" -"+c+" -"+c+" -"+a+" 0 -"+a+" c"),t.push(c+" -"+a+" "+a+" -"+c+" "+a+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(n){var e={D:{Off:Pi.RadioButton.Cross.OffPushDown},N:{}};return e.N[n]=Pi.RadioButton.Cross.YesNormal,e.D[n]=Pi.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(n){var e=Ld(n);e.scope=n.scope;var t=[],i=Pi.internal.calculateCross(n);return t.push("q"),t.push("1 1 "+eo(Pi.internal.getWidth(n)-2)+" "+eo(Pi.internal.getHeight(n)-2)+" re"),t.push("W"),t.push("n"),t.push(eo(i.x1.x)+" "+eo(i.x1.y)+" m"),t.push(eo(i.x2.x)+" "+eo(i.x2.y)+" l"),t.push(eo(i.x4.x)+" "+eo(i.x4.y)+" m"),t.push(eo(i.x3.x)+" "+eo(i.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(n){var e=Ld(n);e.scope=n.scope;var t=Pi.internal.calculateCross(n),i=[];return i.push("0.749023 g"),i.push("0 0 "+eo(Pi.internal.getWidth(n))+" "+eo(Pi.internal.getHeight(n))+" re"),i.push("f"),i.push("q"),i.push("1 1 "+eo(Pi.internal.getWidth(n)-2)+" "+eo(Pi.internal.getHeight(n)-2)+" re"),i.push("W"),i.push("n"),i.push(eo(t.x1.x)+" "+eo(t.x1.y)+" m"),i.push(eo(t.x2.x)+" "+eo(t.x2.y)+" l"),i.push(eo(t.x4.x)+" "+eo(t.x4.y)+" m"),i.push(eo(t.x3.x)+" "+eo(t.x3.y)+" l"),i.push("s"),i.push("Q"),e.stream=i.join(`
`),e},OffPushDown:function(n){var e=Ld(n);e.scope=n.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+eo(Pi.internal.getWidth(n))+" "+eo(Pi.internal.getHeight(n))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(n){var e=n.scope.internal.getFont(n.fontName,n.fontStyle).id,t=n.scope.__private__.encodeColorString(n.color);return"/"+e+" "+n.fontSize+" Tf "+t}};Pi.internal={Bezier_C:.551915024494,calculateCross:function(n){var e=Pi.internal.getWidth(n),t=Pi.internal.getHeight(n),i=Math.min(e,t);return{x1:{x:(e-i)/2,y:(t-i)/2+i},x2:{x:(e-i)/2+i,y:(t-i)/2},x3:{x:(e-i)/2,y:(t-i)/2},x4:{x:(e-i)/2+i,y:(t-i)/2+i}}}},Pi.internal.getWidth=function(n){var e=0;return dl(n)==="object"&&(e=fE(n.Rect[2])),e},Pi.internal.getHeight=function(n){var e=0;return dl(n)==="object"&&(e=fE(n.Rect[3])),e};var s7=qu.addField=function(n){if(i7(this,n),!(n instanceof gd))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=n).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),n.page=n.scope.internal.getCurrentPageInfo().pageNumber,this};qu.AcroFormChoiceField=wy,qu.AcroFormListBox=Sy,qu.AcroFormComboBox=Ey,qu.AcroFormEditBox=uv,qu.AcroFormButton=Gc,qu.AcroFormPushButton=cv,qu.AcroFormRadioButton=Ty,qu.AcroFormCheckBox=hv,qu.AcroFormTextField=og,qu.AcroFormPasswordField=fv,qu.AcroFormAppearance=Pi,qu.AcroForm={ChoiceField:wy,ListBox:Sy,ComboBox:Ey,EditBox:uv,Button:Gc,PushButton:cv,RadioButton:Ty,CheckBox:hv,TextField:og,PasswordField:fv,Appearance:Pi},$i.AcroForm={ChoiceField:wy,ListBox:Sy,ComboBox:Ey,EditBox:uv,Button:Gc,PushButton:cv,RadioButton:Ty,CheckBox:hv,TextField:og,PasswordField:fv,Appearance:Pi};$i.AcroForm;function qC(n){return n.reduce(function(e,t,i){return e[t]=i,e},{})}(function(n){var e="addImage_";n.__addimage__={};var t="UNKNOWN",i={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},a=n.__addimage__.getImageFileTypeByImageData=function($,J){var te,Se,De,$e,Ue,Le=t;if((J=J||t)==="RGBA"||$.data!==void 0&&$.data instanceof Uint8ClampedArray&&"height"in $&&"width"in $)return"RGBA";if(Be($))for(Ue in i)for(De=i[Ue],te=0;te<De.length;te+=1){for($e=!0,Se=0;Se<De[te].length;Se+=1)if(De[te][Se]!==void 0&&De[te][Se]!==$[Se]){$e=!1;break}if($e===!0){Le=Ue;break}}else for(Ue in i)for(De=i[Ue],te=0;te<De.length;te+=1){for($e=!0,Se=0;Se<De[te].length;Se+=1)if(De[te][Se]!==void 0&&De[te][Se]!==$.charCodeAt(Se)){$e=!1;break}if($e===!0){Le=Ue;break}}return Le===t&&J!==t&&(Le=J),Le},c=function $(J){for(var te=this.internal.write,Se=this.internal.putStream,De=(0,this.internal.getFilters)();De.indexOf("FlateEncode")!==-1;)De.splice(De.indexOf("FlateEncode"),1);J.objectId=this.internal.newObject();var $e=[];if($e.push({key:"Type",value:"/XObject"}),$e.push({key:"Subtype",value:"/Image"}),$e.push({key:"Width",value:J.width}),$e.push({key:"Height",value:J.height}),J.colorSpace===ie.INDEXED?$e.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(J.palette.length/3-1)+" "+("sMask"in J&&J.sMask!==void 0?J.objectId+2:J.objectId+1)+" 0 R]"}):($e.push({key:"ColorSpace",value:"/"+J.colorSpace}),J.colorSpace===ie.DEVICE_CMYK&&$e.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),$e.push({key:"BitsPerComponent",value:J.bitsPerComponent}),"decodeParameters"in J&&J.decodeParameters!==void 0&&$e.push({key:"DecodeParms",value:"<<"+J.decodeParameters+">>"}),"transparency"in J&&Array.isArray(J.transparency)&&J.transparency.length>0){for(var Ue="",Le=0,He=J.transparency.length;Le<He;Le++)Ue+=J.transparency[Le]+" "+J.transparency[Le]+" ";$e.push({key:"Mask",value:"["+Ue+"]"})}J.sMask!==void 0&&$e.push({key:"SMask",value:J.objectId+1+" 0 R"});var Ke=J.filter!==void 0?["/"+J.filter]:void 0;if(Se({data:J.data,additionalKeyValues:$e,alreadyAppliedFilters:Ke,objectId:J.objectId}),te("endobj"),"sMask"in J&&J.sMask!==void 0){var Ce,ge=(Ce=J.sMaskBitsPerComponent)!==null&&Ce!==void 0?Ce:J.bitsPerComponent,We={width:J.width,height:J.height,colorSpace:"DeviceGray",bitsPerComponent:ge,data:J.sMask};"filter"in J&&(We.decodeParameters="/Predictor ".concat(J.predictor," /Colors 1 /BitsPerComponent ").concat(ge," /Columns ").concat(J.width),We.filter=J.filter),$.call(this,We)}if(J.colorSpace===ie.INDEXED){var Ve=this.internal.newObject();Se({data:G(new Uint8Array(J.palette)),objectId:Ve}),te("endobj")}},_=function(){var $=this.internal.collections[e+"images"];for(var J in $)c.call(this,$[J])},y=function(){var $,J=this.internal.collections[e+"images"],te=this.internal.write;for(var Se in J)te("/I"+($=J[Se]).index,$.objectId,"0","R")},s=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",_),this.internal.events.subscribe("putXobjectDict",y))},T=function(){var $=this.internal.collections[e+"images"];return s.call(this),$},L=function(){return Object.keys(this.internal.collections[e+"images"]).length},R=function($){return typeof n["process"+$.toUpperCase()]=="function"},U=function($){return dl($)==="object"&&$.nodeType===1},M=function($,J){if($.nodeName==="IMG"&&$.hasAttribute("src")){var te=""+$.getAttribute("src");if(te.indexOf("data:image/")===0)return lv(unescape(te).split("base64,").pop());var Se=n.loadFile(te,!0);if(Se!==void 0)return Se}if($.nodeName==="CANVAS"){if($.width===0||$.height===0)throw new Error("Given canvas must have data. Canvas width: "+$.width+", height: "+$.height);var De;switch(J){case"PNG":De="image/png";break;case"WEBP":De="image/webp";break;default:De="image/jpeg"}return lv($.toDataURL(De,1).split("base64,").pop())}},Q=function($){var J=this.internal.collections[e+"images"];if(J){for(var te in J)if($===J[te].alias)return J[te]}},ae=function($,J,te){return $||J||($=-96,J=-96),$<0&&($=-1*te.width*72/$/this.internal.scaleFactor),J<0&&(J=-1*te.height*72/J/this.internal.scaleFactor),$===0&&($=J*te.width/te.height),J===0&&(J=$*te.height/te.width),[$,J]},ye=function($,J,te,Se,De,$e){var Ue=ae.call(this,te,Se,De),Le=this.internal.getCoordinateString,He=this.internal.getVerticalCoordinateString,Ke=T.call(this);if(te=Ue[0],Se=Ue[1],Ke[De.index]=De,$e){$e*=Math.PI/180;var Ce=Math.cos($e),ge=Math.sin($e),We=function(ut){return ut.toFixed(4)},Ve=[We(Ce),We(ge),We(-1*ge),We(Ce),0,0,"cm"]}this.internal.write("q"),$e?(this.internal.write([1,"0","0",1,Le($),He(J+Se),"cm"].join(" ")),this.internal.write(Ve.join(" ")),this.internal.write([Le(te),"0","0",Le(Se),"0","0","cm"].join(" "))):this.internal.write([Le(te),"0","0",Le(Se),Le($),He(J+Se),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+De.index+" Do"),this.internal.write("Q")},ie=n.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};n.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var oe=n.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},ve=n.__addimage__.sHashCode=function($){var J,te,Se=0;if(typeof $=="string")for(te=$.length,J=0;J<te;J++)Se=(Se<<5)-Se+$.charCodeAt(J),Se|=0;else if(Be($))for(te=$.byteLength/2,J=0;J<te;J++)Se=(Se<<5)-Se+$[J],Se|=0;return Se},de=n.__addimage__.validateStringAsBase64=function($){($=$||"").toString().trim();var J=!0;return $.length===0&&(J=!1),$.length%4!=0&&(J=!1),/^[A-Za-z0-9+/]+$/.test($.substr(0,$.length-2))===!1&&(J=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test($.substr(-2))===!1&&(J=!1),J},Pe=n.__addimage__.extractImageFromDataUrl=function($){if($==null||!($=$.trim()).startsWith("data:"))return null;var J=$.indexOf(",");return J<0?null:$.substring(0,J).trim().endsWith("base64")?$.substring(J+1):null};n.__addimage__.isArrayBuffer=function($){return $ instanceof ArrayBuffer};var Be=n.__addimage__.isArrayBufferView=function($){return $ instanceof Int8Array||$ instanceof Uint8Array||$ instanceof Uint8ClampedArray||$ instanceof Int16Array||$ instanceof Uint16Array||$ instanceof Int32Array||$ instanceof Uint32Array||$ instanceof Float32Array||$ instanceof Float64Array},_e=n.__addimage__.binaryStringToUint8Array=function($){for(var J=$.length,te=new Uint8Array(J),Se=0;Se<J;Se++)te[Se]=$.charCodeAt(Se);return te},G=n.__addimage__.arrayBufferToBinaryString=function($){for(var J="",te=Be($)?$:new Uint8Array($),Se=0;Se<te.length;Se+=8192)J+=String.fromCharCode.apply(null,te.subarray(Se,Se+8192));return J};n.addImage=function(){var $,J,te,Se,De,$e,Ue,Le,He;if(typeof arguments[1]=="number"?(J=t,te=arguments[1],Se=arguments[2],De=arguments[3],$e=arguments[4],Ue=arguments[5],Le=arguments[6],He=arguments[7]):(J=arguments[1],te=arguments[2],Se=arguments[3],De=arguments[4],$e=arguments[5],Ue=arguments[6],Le=arguments[7],He=arguments[8]),dl($=arguments[0])==="object"&&!U($)&&"imageData"in $){var Ke=$;$=Ke.imageData,J=Ke.format||J||t,te=Ke.x||te||0,Se=Ke.y||Se||0,De=Ke.w||Ke.width||De,$e=Ke.h||Ke.height||$e,Ue=Ke.alias||Ue,Le=Ke.compression||Le,He=Ke.rotation||Ke.angle||He}var Ce=this.internal.getFilters();if(Le===void 0&&Ce.indexOf("FlateEncode")!==-1&&(Le="SLOW"),isNaN(te)||isNaN(Se))throw new Error("Invalid coordinates passed to jsPDF.addImage");s.call(this);var ge=B.call(this,$,J,Ue,Le);return ye.call(this,te,Se,De,$e,ge,He),this};var B=function($,J,te,Se){var De,$e,Ue;if(typeof $=="string"&&a($)===t){$=unescape($);var Le=Y($,!1);(Le!==""||(Le=n.loadFile($,!0))!==void 0)&&($=Le)}if(U($)&&($=M($,J)),J=a($,J),!R(J))throw new Error("addImage does not support files of type '"+J+"', please ensure that a plugin for '"+J+"' support is added.");if(((Ue=te)==null||Ue.length===0)&&(te=(function(He){return typeof He=="string"||Be(He)?ve(He):Be(He.data)?ve(He.data):null})($)),(De=Q.call(this,te))||($ instanceof Uint8Array||J==="RGBA"||($e=$,$=_e($)),De=this["process"+J.toUpperCase()]($,L.call(this),te,(function(He){return He&&typeof He=="string"&&(He=He.toUpperCase()),He in n.image_compression?He:oe.NONE})(Se),$e)),!De)throw new Error("An unknown error occurred whilst processing the image.");return De},Y=n.__addimage__.convertBase64ToBinaryString=function($,J){J=typeof J!="boolean"||J;var te,Se="";if(typeof $=="string"){var De;te=(De=Pe($))!==null&&De!==void 0?De:$;try{Se=lv(te)}catch($e){if(J)throw de(te)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+$e.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Se};n.getImageProperties=function($){var J,te,Se="";if(U($)&&($=M($)),typeof $=="string"&&a($)===t&&((Se=Y($,!1))===""&&(Se=n.loadFile($)||""),$=Se),te=a($),!R(te))throw new Error("addImage does not support files of type '"+te+"', please ensure that a plugin for '"+te+"' support is added.");if($ instanceof Uint8Array||($=_e($)),!(J=this["process"+te.toUpperCase()]($)))throw new Error("An unknown error occurred whilst processing the image");return J.fileType=te,J}})($i.API),(function(n){var e=function(t){if(t!==void 0&&t!="")return!0};$i.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),n.events.push(["putPage",function(t){for(var i,a,c,_=this.internal.getCoordinateString,y=this.internal.getVerticalCoordinateString,s=this.internal.getPageInfoByObjId(t.objId),T=t.pageContext.annotations,L=!1,R=0;R<T.length&&!L;R++)switch((i=T[R]).type){case"link":(e(i.options.url)||e(i.options.pageNumber))&&(L=!0);break;case"reference":case"text":case"freetext":L=!0}if(L!=0){this.internal.write("/Annots [");for(var U=0;U<T.length;U++){i=T[U];var M=this.internal.pdfEscape,Q=this.internal.getEncryptor(t.objId);switch(i.type){case"reference":this.internal.write(" "+i.object.objId+" 0 R ");break;case"text":var ae=this.internal.newAdditionalObject(),ye=this.internal.newAdditionalObject(),ie=this.internal.getEncryptor(ae.objId),oe=i.title||"Note";c="<</Type /Annot /Subtype /Text "+(a="/Rect ["+_(i.bounds.x)+" "+y(i.bounds.y+i.bounds.h)+" "+_(i.bounds.x+i.bounds.w)+" "+y(i.bounds.y)+"] ")+"/Contents ("+M(ie(i.contents))+")",c+=" /Popup "+ye.objId+" 0 R",c+=" /P "+s.objId+" 0 R",c+=" /T ("+M(ie(oe))+") >>",ae.content=c;var ve=ae.objId+" 0 R";c="<</Type /Annot /Subtype /Popup "+(a="/Rect ["+_(i.bounds.x+30)+" "+y(i.bounds.y+i.bounds.h)+" "+_(i.bounds.x+i.bounds.w+30)+" "+y(i.bounds.y)+"] ")+" /Parent "+ve,i.open&&(c+=" /Open true"),c+=" >>",ye.content=c,this.internal.write(ae.objId,"0 R",ye.objId,"0 R");break;case"freetext":a="/Rect ["+_(i.bounds.x)+" "+y(i.bounds.y)+" "+_(i.bounds.x+i.bounds.w)+" "+y(i.bounds.y+i.bounds.h)+"] ";var de=i.color||"#000000";c="<</Type /Annot /Subtype /FreeText "+a+"/Contents ("+M(Q(i.contents))+")",c+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+de+")",c+=" /Border [0 0 0]",c+=" >>",this.internal.write(c);break;case"link":if(i.options.name){var Pe=this.annotations._nameMap[i.options.name];i.options.pageNumber=Pe.page,i.options.top=Pe.y}else i.options.top||(i.options.top=0);if(a="/Rect ["+i.finalBounds.x+" "+i.finalBounds.y+" "+i.finalBounds.w+" "+i.finalBounds.h+"] ",c="",i.options.url)c="<</Type /Annot /Subtype /Link "+a+"/Border [0 0 0] /A <</S /URI /URI ("+M(Q(i.options.url))+") >>";else if(i.options.pageNumber)switch(c="<</Type /Annot /Subtype /Link "+a+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(i.options.pageNumber).objId+" 0 R",i.options.magFactor=i.options.magFactor||"XYZ",i.options.magFactor){case"Fit":c+=" /Fit]";break;case"FitH":c+=" /FitH "+i.options.top+"]";break;case"FitV":i.options.left=i.options.left||0,c+=" /FitV "+i.options.left+"]";break;default:var Be=y(i.options.top);i.options.left=i.options.left||0,i.options.zoom===void 0&&(i.options.zoom=0),c+=" /XYZ "+i.options.left+" "+Be+" "+i.options.zoom+"]"}c!=""&&(c+=" >>",this.internal.write(c))}}this.internal.write("]")}}]),n.createAnnotation=function(t){var i=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":i.pageContext.annotations.push(t)}},n.link=function(t,i,a,c,_){var y=this.internal.getCurrentPageInfo(),s=this.internal.getCoordinateString,T=this.internal.getVerticalCoordinateString;y.pageContext.annotations.push({finalBounds:{x:s(t),y:T(i),w:s(t+a),h:T(i+c)},options:_,type:"link"})},n.textWithLink=function(t,i,a,c){var _,y,s=this.getTextWidth(t),T=this.internal.getLineHeight()/this.internal.scaleFactor;if(c.maxWidth!==void 0){y=c.maxWidth;var L=this.splitTextToSize(t,y).length;_=Math.ceil(T*L)}else y=s,_=T;return this.text(t,i,a,c),a+=.2*T,c.align==="center"&&(i-=s/2),c.align==="right"&&(i-=s),this.link(i,a-T,y,_,c),s},n.getTextWidth=function(t){var i=this.internal.getFontSize();return this.getStringUnitWidth(t)*i/this.internal.scaleFactor}})($i.API),(function(n){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},i={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},a=[1570,1571,1573,1575];n.__arabicParser__={};var c=n.__arabicParser__.isInArabicSubstitutionA=function(ae){return e[ae.charCodeAt(0)]!==void 0},_=n.__arabicParser__.isArabicLetter=function(ae){return typeof ae=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(ae)},y=n.__arabicParser__.isArabicEndLetter=function(ae){return _(ae)&&c(ae)&&e[ae.charCodeAt(0)].length<=2},s=n.__arabicParser__.isArabicAlfLetter=function(ae){return _(ae)&&a.indexOf(ae.charCodeAt(0))>=0};n.__arabicParser__.arabicLetterHasIsolatedForm=function(ae){return _(ae)&&c(ae)&&e[ae.charCodeAt(0)].length>=1};var T=n.__arabicParser__.arabicLetterHasFinalForm=function(ae){return _(ae)&&c(ae)&&e[ae.charCodeAt(0)].length>=2};n.__arabicParser__.arabicLetterHasInitialForm=function(ae){return _(ae)&&c(ae)&&e[ae.charCodeAt(0)].length>=3};var L=n.__arabicParser__.arabicLetterHasMedialForm=function(ae){return _(ae)&&c(ae)&&e[ae.charCodeAt(0)].length==4},R=n.__arabicParser__.resolveLigatures=function(ae){var ye=0,ie=t,oe="",ve=0;for(ye=0;ye<ae.length;ye+=1)ie[ae.charCodeAt(ye)]!==void 0?(ve++,typeof(ie=ie[ae.charCodeAt(ye)])=="number"&&(oe+=String.fromCharCode(ie),ie=t,ve=0),ye===ae.length-1&&(ie=t,oe+=ae.charAt(ye-(ve-1)),ye-=ve-1,ve=0)):(ie=t,oe+=ae.charAt(ye-ve),ye-=ve,ve=0);return oe};n.__arabicParser__.isArabicDiacritic=function(ae){return ae!==void 0&&i[ae.charCodeAt(0)]!==void 0};var U=n.__arabicParser__.getCorrectForm=function(ae,ye,ie){return _(ae)?c(ae)===!1?-1:!T(ae)||!_(ye)&&!_(ie)||!_(ie)&&y(ye)||y(ae)&&!_(ye)||y(ae)&&s(ye)||y(ae)&&y(ye)?0:L(ae)&&_(ye)&&!y(ye)&&_(ie)&&T(ie)?3:y(ae)||!_(ie)?1:2:-1},M=function(ae){var ye=0,ie=0,oe=0,ve="",de="",Pe="",Be=(ae=ae||"").split("\\s+"),_e=[];for(ye=0;ye<Be.length;ye+=1){for(_e.push(""),ie=0;ie<Be[ye].length;ie+=1)ve=Be[ye][ie],de=Be[ye][ie-1],Pe=Be[ye][ie+1],_(ve)?(oe=U(ve,de,Pe),_e[ye]+=oe!==-1?String.fromCharCode(e[ve.charCodeAt(0)][oe]):ve):_e[ye]+=ve;_e[ye]=R(_e[ye])}return _e.join(" ")},Q=n.__arabicParser__.processArabic=n.processArabic=function(){var ae,ye=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,ie=[];if(Array.isArray(ye)){var oe=0;for(ie=[],oe=0;oe<ye.length;oe+=1)Array.isArray(ye[oe])?ie.push([M(ye[oe][0]),ye[oe][1],ye[oe][2]]):ie.push([M(ye[oe])]);ae=ie}else ae=M(ye);return typeof arguments[0]=="string"?ae:(arguments[0].text=ae,arguments[0])};n.events.push(["preProcessText",Q])})($i.API),$i.API.autoPrint=function(n){var e;return(n=n||{}).variant=n.variant||"non-conform",n.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this},(function(n){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(y){t=y}});var i=150;Object.defineProperty(this,"width",{get:function(){return i},set:function(y){i=isNaN(y)||Number.isInteger(y)===!1||y<0?150:y,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=i+1)}});var a=300;Object.defineProperty(this,"height",{get:function(){return a},set:function(y){a=isNaN(y)||Number.isInteger(y)===!1||y<0?300:y,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=a+1)}});var c=[];Object.defineProperty(this,"childNodes",{get:function(){return c},set:function(y){c=y}});var _={};Object.defineProperty(this,"style",{get:function(){return _},set:function(y){_=y}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,i){var a;if((t=t||"2d")!=="2d")return null;for(a in i)this.pdf.context2d.hasOwnProperty(a)&&(this.pdf.context2d[a]=i[a]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},n.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])})($i.API),(function(n){var e={left:0,top:0,bottom:0,right:0},t=!1,i=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),a.call(this))},a=function(){this.internal.__cell__.lastCell=new c,this.internal.__cell__.pages=1},c=function(){var s=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return s},set:function(ae){s=ae}});var T=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return T},set:function(ae){T=ae}});var L=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return L},set:function(ae){L=ae}});var R=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return R},set:function(ae){R=ae}});var U=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return U},set:function(ae){U=ae}});var M=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return M},set:function(ae){M=ae}});var Q=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return Q},set:function(ae){Q=ae}}),this};c.prototype.clone=function(){return new c(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},c.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},n.setHeaderFunction=function(s){return i.call(this),this.internal.__cell__.headerFunction=typeof s=="function"?s:void 0,this},n.getTextDimensions=function(s,T){i.call(this);var L=(T=T||{}).fontSize||this.getFontSize(),R=T.font||this.getFont(),U=T.scaleFactor||this.internal.scaleFactor,M=0,Q=0,ae=0,ye=this;if(!Array.isArray(s)&&typeof s!="string"){if(typeof s!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");s=String(s)}var ie=T.maxWidth;ie>0?typeof s=="string"?s=this.splitTextToSize(s,ie):Object.prototype.toString.call(s)==="[object Array]"&&(s=s.reduce(function(ve,de){return ve.concat(ye.splitTextToSize(de,ie))},[])):s=Array.isArray(s)?s:[s];for(var oe=0;oe<s.length;oe++)M<(ae=this.getStringUnitWidth(s[oe],{font:R})*L)&&(M=ae);return M!==0&&(Q=s.length),{w:M/=U,h:Math.max((Q*L*this.getLineHeightFactor()-L*(this.getLineHeightFactor()-1))/U,0)}},n.cellAddPage=function(){i.call(this),this.addPage();var s=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new c(s.left,s.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var _=n.cell=function(){var s;s=arguments[0]instanceof c?arguments[0]:new c(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),i.call(this);var T=this.internal.__cell__.lastCell,L=this.internal.__cell__.padding,R=this.internal.__cell__.margins||e,U=this.internal.__cell__.tableHeaderRow,M=this.internal.__cell__.printHeaders;return T.lineNumber!==void 0&&(T.lineNumber===s.lineNumber?(s.x=(T.x||0)+(T.width||0),s.y=T.y||0):T.y+T.height+s.height+R.bottom>this.getPageHeight()?(this.cellAddPage(),s.y=R.top,M&&U&&(this.printHeaderRow(s.lineNumber,!0),s.y+=U[0].height)):s.y=T.y+T.height||s.y),s.text[0]!==void 0&&(this.rect(s.x,s.y,s.width,s.height,t===!0?"FD":void 0),s.align==="right"?this.text(s.text,s.x+s.width-L,s.y+L,{align:"right",baseline:"top"}):s.align==="center"?this.text(s.text,s.x+s.width/2,s.y+L,{align:"center",baseline:"top",maxWidth:s.width-L-L}):this.text(s.text,s.x+L,s.y+L,{align:"left",baseline:"top",maxWidth:s.width-L-L})),this.internal.__cell__.lastCell=s,this};n.table=function(s,T,L,R,U){if(i.call(this),!L)throw new Error("No data for PDF table.");var M,Q,ae,ye,ie=[],oe=[],ve=[],de={},Pe={},Be=[],_e=[],G=(U=U||{}).autoSize||!1,B=U.printHeaders!==!1,Y=U.css&&U.css["font-size"]!==void 0?16*U.css["font-size"]:U.fontSize||12,$=U.margins||Object.assign({width:this.getPageWidth()},e),J=typeof U.padding=="number"?U.padding:3,te=U.headerBackgroundColor||"#c8c8c8",Se=U.headerTextColor||"#000";if(a.call(this),this.internal.__cell__.printHeaders=B,this.internal.__cell__.margins=$,this.internal.__cell__.table_font_size=Y,this.internal.__cell__.padding=J,this.internal.__cell__.headerBackgroundColor=te,this.internal.__cell__.headerTextColor=Se,this.setFontSize(Y),R==null)oe=ie=Object.keys(L[0]),ve=ie.map(function(){return"left"});else if(Array.isArray(R)&&dl(R[0])==="object")for(ie=R.map(function(Ke){return Ke.name}),oe=R.map(function(Ke){return Ke.prompt||Ke.name||""}),ve=R.map(function(Ke){return Ke.align||"left"}),M=0;M<R.length;M+=1)Pe[R[M].name]=.7499990551181103*R[M].width;else Array.isArray(R)&&typeof R[0]=="string"&&(oe=ie=R,ve=ie.map(function(){return"left"}));if(G||Array.isArray(R)&&typeof R[0]=="string")for(M=0;M<ie.length;M+=1){for(de[ye=ie[M]]=L.map(function(Ke){return Ke[ye]}),this.setFont(void 0,"bold"),Be.push(this.getTextDimensions(oe[M],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),Q=de[ye],this.setFont(void 0,"normal"),ae=0;ae<Q.length;ae+=1)Be.push(this.getTextDimensions(Q[ae],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);Pe[ye]=Math.max.apply(null,Be)+J+J,Be=[]}if(B){var De={};for(M=0;M<ie.length;M+=1)De[ie[M]]={},De[ie[M]].text=oe[M],De[ie[M]].align=ve[M];var $e=y.call(this,De,Pe);_e=ie.map(function(Ke){return new c(s,T,Pe[Ke],$e,De[Ke].text,void 0,De[Ke].align)}),this.setTableHeaderRow(_e),this.printHeaderRow(1,!1)}var Ue=R.reduce(function(Ke,Ce){return Ke[Ce.name]=Ce.align,Ke},{});for(M=0;M<L.length;M+=1){"rowStart"in U&&U.rowStart instanceof Function&&U.rowStart({row:M,data:L[M]},this);var Le=y.call(this,L[M],Pe);for(ae=0;ae<ie.length;ae+=1){var He=L[M][ie[ae]];"cellStart"in U&&U.cellStart instanceof Function&&U.cellStart({row:M,col:ae,data:He},this),_.call(this,new c(s,T,Pe[ie[ae]],Le,He,M+2,Ue[ie[ae]]))}}return this.internal.__cell__.table_x=s,this.internal.__cell__.table_y=T,this};var y=function(s,T){var L=this.internal.__cell__.padding,R=this.internal.__cell__.table_font_size,U=this.internal.scaleFactor;return Object.keys(s).map(function(M){var Q=s[M];return this.splitTextToSize(Q.hasOwnProperty("text")?Q.text:Q,T[M]-L-L)},this).map(function(M){return this.getLineHeightFactor()*M.length*R/U+L+L},this).reduce(function(M,Q){return Math.max(M,Q)},0)};n.setTableHeaderRow=function(s){i.call(this),this.internal.__cell__.tableHeaderRow=s},n.printHeaderRow=function(s,T){if(i.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var L;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var R=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new c(R[0],R[1],R[2],R[3],void 0,-1)}this.setFont(void 0,"bold");for(var U=[],M=0;M<this.internal.__cell__.tableHeaderRow.length;M+=1){L=this.internal.__cell__.tableHeaderRow[M].clone(),T&&(L.y=this.internal.__cell__.margins.top||0,U.push(L)),L.lineNumber=s;var Q=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),_.call(this,L),this.setTextColor(Q)}U.length>0&&this.setTableHeaderRow(U),this.setFont(void 0,"normal"),t=!1}})($i.API);var GC={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},$C=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],l5=qC($C),HC=[100,200,300,400,500,600,700,800,900],o7=qC(HC);function uw(n){var e=n.family.replace(/"|'/g,"").toLowerCase(),t=(function(c){return GC[c=c||"normal"]?c:"normal"})(n.style),i=(function(c){return c?typeof c=="number"?c>=100&&c<=900&&c%100==0?c:400:/^\d00$/.test(c)?parseInt(c):c==="bold"?700:400:400})(n.weight),a=(function(c){return typeof l5[c=c||"normal"]=="number"?c:"normal"})(n.stretch);return{family:e,style:t,weight:i,stretch:a,src:n.src||[],ref:n.ref||{name:e,style:[a,t,i].join(" ")}}}function dE(n,e,t,i){var a;for(a=t;a>=0&&a<e.length;a+=i)if(n[e[a]])return n[e[a]];for(a=t;a>=0&&a<e.length;a-=i)if(n[e[a]])return n[e[a]]}var a7={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},pE={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function mE(n){return[n.stretch,n.style,n.weight,n.family].join(" ")}function gE(n){return n.trimLeft()}function l7(n,e){for(var t=0;t<n.length;){if(n.charAt(t)===e)return[n.substring(0,t),n.substring(t+1)];t+=1}return null}function u7(n){var e=n.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],n.substring(e[0].length)]}var D1,yE,_E,ny,O1,vE,xE,bE,cw=["times"];function wE(n,e,t,i,a){var c=4,_=EE;switch(a){case $i.API.image_compression.FAST:c=1,_=SE;break;case $i.API.image_compression.MEDIUM:c=6,_=TE;break;case $i.API.image_compression.SLOW:c=9,_=AE}n=(function(s,T,L,R){for(var U,M=s.length/T,Q=new Uint8Array(s.length+M),ae=[c7,SE,EE,TE,AE],ye=0;ye<M;ye+=1){var ie=ye*T,oe=s.subarray(ie,ie+T);if(R)Q.set(R(oe,L,U),ie+ye);else{for(var ve=ae.length,de=[],Pe=0;Pe<ve;Pe+=1)de[Pe]=ae[Pe](oe,L,U);var Be=f7(de.concat());Q.set(de[Be],ie+ye)}U=oe}return Q})(n,e,Math.ceil(t*i/8),_);var y=t5(n,{level:c});return $i.API.__addimage__.arrayBufferToBinaryString(y)}function c7(n){var e=Array.apply([],n);return e.unshift(0),e}function SE(n,e){var t=n.length,i=[];i[0]=1;for(var a=0;a<t;a+=1){var c=n[a-e]||0;i[a+1]=n[a]-c+256&255}return i}function EE(n,e,t){var i=n.length,a=[];a[0]=2;for(var c=0;c<i;c+=1){var _=t&&t[c]||0;a[c+1]=n[c]-_+256&255}return a}function TE(n,e,t){var i=n.length,a=[];a[0]=3;for(var c=0;c<i;c+=1){var _=n[c-e]||0,y=t&&t[c]||0;a[c+1]=n[c]+256-(_+y>>>1)&255}return a}function AE(n,e,t){var i=n.length,a=[];a[0]=4;for(var c=0;c<i;c+=1){var _=h7(n[c-e]||0,t&&t[c]||0,t&&t[c-e]||0);a[c+1]=n[c]-_+256&255}return a}function h7(n,e,t){if(n===e&&e===t)return n;var i=Math.abs(e-t),a=Math.abs(n-t),c=Math.abs(n+e-t-t);return i<=a&&i<=c?n:a<=c?e:t}function f7(n){var e=n.map(function(t){return t.reduce(function(i,a){return i+Math.abs(a)},0)});return e.indexOf(Math.min.apply(null,e))}function hw(n,e,t){var i=e*t,a=Math.floor(i/8),c=16-(i-8*a+t),_=(1<<t)-1;return WC(n,a)>>c&_}function IE(n,e,t,i){var a=t*i,c=Math.floor(a/8),_=16-(a-8*c+i),y=(1<<i)-1,s=(e&y)<<_;(function(T,L,R){if(L+1<T.byteLength)T.setUint16(L,R,!1);else{var U=R>>8&255;T.setUint8(L,U)}})(n,c,WC(n,c)&~(y<<_)&65535|s)}function WC(n,e){return e+1<n.byteLength?n.getUint16(e,!1):n.getUint8(e)<<8}function d7(n){var e=0;if(n[e++]!==71||n[e++]!==73||n[e++]!==70||n[e++]!==56||(n[e++]+1&253)!=56||n[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=n[e++]|n[e++]<<8,i=n[e++]|n[e++]<<8,a=n[e++],c=a>>7,_=1<<1+(7&a);n[e++],n[e++];var y=null,s=null;c&&(y=e,s=_,e+=3*_);var T=!0,L=[],R=0,U=null,M=0,Q=null;for(this.width=t,this.height=i;T&&e<n.length;)switch(n[e++]){case 33:switch(n[e++]){case 255:if(n[e]!==11||n[e+1]==78&&n[e+2]==69&&n[e+3]==84&&n[e+4]==83&&n[e+5]==67&&n[e+6]==65&&n[e+7]==80&&n[e+8]==69&&n[e+9]==50&&n[e+10]==46&&n[e+11]==48&&n[e+12]==3&&n[e+13]==1&&n[e+16]==0)e+=14,Q=n[e++]|n[e++]<<8,e++;else for(e+=12;;){if(!(($=n[e++])>=0))throw Error("Invalid block size");if($===0)break;e+=$}break;case 249:if(n[e++]!==4||n[e+4]!==0)throw new Error("Invalid graphics extension block.");var ae=n[e++];R=n[e++]|n[e++]<<8,U=n[e++],1&ae||(U=null),M=ae>>2&7,e++;break;case 254:for(;;){if(!(($=n[e++])>=0))throw Error("Invalid block size");if($===0)break;e+=$}break;default:throw new Error("Unknown graphic control label: 0x"+n[e-1].toString(16))}break;case 44:var ye=n[e++]|n[e++]<<8,ie=n[e++]|n[e++]<<8,oe=n[e++]|n[e++]<<8,ve=n[e++]|n[e++]<<8,de=n[e++],Pe=de>>6&1,Be=1<<1+(7&de),_e=y,G=s,B=!1;de>>7&&(B=!0,_e=e,G=Be,e+=3*Be);var Y=e;for(e++;;){var $;if(!(($=n[e++])>=0))throw Error("Invalid block size");if($===0)break;e+=$}L.push({x:ye,y:ie,width:oe,height:ve,has_local_palette:B,palette_offset:_e,palette_size:G,data_offset:Y,data_length:e-Y,transparent_index:U,interlaced:!!Pe,delay:R,disposal:M});break;case 59:T=!1;break;default:throw new Error("Unknown gif block: 0x"+n[e-1].toString(16))}this.numFrames=function(){return L.length},this.loopCount=function(){return Q},this.frameInfo=function(J){if(J<0||J>=L.length)throw new Error("Frame index out of range.");return L[J]},this.decodeAndBlitFrameBGRA=function(J,te){var Se=this.frameInfo(J),De=Se.width*Se.height,$e=new Uint8Array(De);CE(n,Se.data_offset,$e,De);var Ue=Se.palette_offset,Le=Se.transparent_index;Le===null&&(Le=256);var He=Se.width,Ke=t-He,Ce=He,ge=4*(Se.y*t+Se.x),We=4*((Se.y+Se.height)*t+Se.x),Ve=ge,ut=4*Ke;Se.interlaced===!0&&(ut+=4*t*7);for(var pt=8,It=0,Oe=$e.length;It<Oe;++It){var Wt=$e[It];if(Ce===0&&(Ce=He,(Ve+=ut)>=We&&(ut=4*Ke+4*t*(pt-1),Ve=ge+(He+Ke)*(pt<<1),pt>>=1)),Wt===Le)Ve+=4;else{var Zt=n[Ue+3*Wt],Xt=n[Ue+3*Wt+1],Ze=n[Ue+3*Wt+2];te[Ve++]=Ze,te[Ve++]=Xt,te[Ve++]=Zt,te[Ve++]=255}--Ce}},this.decodeAndBlitFrameRGBA=function(J,te){var Se=this.frameInfo(J),De=Se.width*Se.height,$e=new Uint8Array(De);CE(n,Se.data_offset,$e,De);var Ue=Se.palette_offset,Le=Se.transparent_index;Le===null&&(Le=256);var He=Se.width,Ke=t-He,Ce=He,ge=4*(Se.y*t+Se.x),We=4*((Se.y+Se.height)*t+Se.x),Ve=ge,ut=4*Ke;Se.interlaced===!0&&(ut+=4*t*7);for(var pt=8,It=0,Oe=$e.length;It<Oe;++It){var Wt=$e[It];if(Ce===0&&(Ce=He,(Ve+=ut)>=We&&(ut=4*Ke+4*t*(pt-1),Ve=ge+(He+Ke)*(pt<<1),pt>>=1)),Wt===Le)Ve+=4;else{var Zt=n[Ue+3*Wt],Xt=n[Ue+3*Wt+1],Ze=n[Ue+3*Wt+2];te[Ve++]=Zt,te[Ve++]=Xt,te[Ve++]=Ze,te[Ve++]=255}--Ce}}}function CE(n,e,t,i){for(var a=n[e++],c=1<<a,_=c+1,y=_+1,s=a+1,T=(1<<s)-1,L=0,R=0,U=0,M=n[e++],Q=new Int32Array(4096),ae=null;;){for(;L<16&&M!==0;)R|=n[e++]<<L,L+=8,M===1?M=n[e++]:--M;if(L<s)break;var ye=R&T;if(R>>=s,L-=s,ye!==c){if(ye===_)break;for(var ie=ye<y?ye:ae,oe=0,ve=ie;ve>c;)ve=Q[ve]>>8,++oe;var de=ve;if(U+oe+(ie!==ye?1:0)>i)return void Dl.log("Warning, gif stream longer than expected.");t[U++]=de;var Pe=U+=oe;for(ie!==ye&&(t[U++]=de),ve=ie;oe--;)ve=Q[ve],t[--Pe]=255&ve,ve>>=8;ae!==null&&y<4096&&(Q[y++]=ae<<8|de,y>=T+1&&s<12&&(++s,T=T<<1|1)),ae=ye}else y=_+1,T=(1<<(s=a+1))-1,ae=null}return U!==i&&Dl.log("Warning, gif stream shorter than expected."),t}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function fw(n){var e,t,i,a,c,_=Math.floor,y=new Array(64),s=new Array(64),T=new Array(64),L=new Array(64),R=new Array(65535),U=new Array(65535),M=new Array(64),Q=new Array(64),ae=[],ye=0,ie=7,oe=new Array(64),ve=new Array(64),de=new Array(64),Pe=new Array(256),Be=new Array(2048),_e=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],G=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],B=[0,1,2,3,4,5,6,7,8,9,10,11],Y=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],$=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],J=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],te=[0,1,2,3,4,5,6,7,8,9,10,11],Se=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],De=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function $e(ge,We){for(var Ve=0,ut=0,pt=new Array,It=1;It<=16;It++){for(var Oe=1;Oe<=ge[It];Oe++)pt[We[ut]]=[],pt[We[ut]][0]=Ve,pt[We[ut]][1]=It,ut++,Ve++;Ve*=2}return pt}function Ue(ge){for(var We=ge[0],Ve=ge[1]-1;Ve>=0;)We&1<<Ve&&(ye|=1<<ie),Ve--,--ie<0&&(ye==255?(Le(255),Le(0)):Le(ye),ie=7,ye=0)}function Le(ge){ae.push(ge)}function He(ge){Le(ge>>8&255),Le(255&ge)}function Ke(ge,We,Ve,ut,pt){for(var It,Oe=pt[0],Wt=pt[240],Zt=(function($t,xr){var dr,ni,nn,yn,sr,Zn,$r,qn,jr,ir,Xn=0;for(jr=0;jr<8;++jr){dr=$t[Xn],ni=$t[Xn+1],nn=$t[Xn+2],yn=$t[Xn+3],sr=$t[Xn+4],Zn=$t[Xn+5],$r=$t[Xn+6];var Bi=dr+(qn=$t[Xn+7]),bi=dr-qn,wr=ni+$r,or=ni-$r,ui=nn+Zn,Kr=nn-Zn,wi=yn+sr,si=yn-sr,vt=Bi+wi,Ne=Bi-wi,ze=wr+ui,ft=wr-ui;$t[Xn]=vt+ze,$t[Xn+4]=vt-ze;var wt=.707106781*(ft+Ne);$t[Xn+2]=Ne+wt,$t[Xn+6]=Ne-wt;var Ut=.382683433*((vt=si+Kr)-(ft=or+bi)),Gt=.5411961*vt+Ut,Tt=1.306562965*ft+Ut,Ot=.707106781*(ze=Kr+or),zt=bi+Ot,Pn=bi-Ot;$t[Xn+5]=Pn+Gt,$t[Xn+3]=Pn-Gt,$t[Xn+1]=zt+Tt,$t[Xn+7]=zt-Tt,Xn+=8}for(Xn=0,jr=0;jr<8;++jr){dr=$t[Xn],ni=$t[Xn+8],nn=$t[Xn+16],yn=$t[Xn+24],sr=$t[Xn+32],Zn=$t[Xn+40],$r=$t[Xn+48];var Jn=dr+(qn=$t[Xn+56]),Fn=dr-qn,Gr=ni+$r,Mr=ni-$r,Zr=nn+Zn,Br=nn-Zn,zi=yn+sr,ms=yn-sr,Os=Jn+zi,cs=Jn-zi,ps=Gr+Zr,vo=Gr-Zr;$t[Xn]=Os+ps,$t[Xn+32]=Os-ps;var is=.707106781*(vo+cs);$t[Xn+16]=cs+is,$t[Xn+48]=cs-is;var xo=.382683433*((Os=ms+Br)-(vo=Mr+Fn)),ua=.5411961*Os+xo,tl=1.306562965*vo+xo,Pa=.707106781*(ps=Br+Mr),di=Fn+Pa,ou=Fn-Pa;$t[Xn+40]=ou+ua,$t[Xn+24]=ou-ua,$t[Xn+8]=di+tl,$t[Xn+56]=di-tl,Xn++}for(jr=0;jr<64;++jr)ir=$t[jr]*xr[jr],M[jr]=ir>0?ir+.5|0:ir-.5|0;return M})(ge,We),Xt=0;Xt<64;++Xt)Q[_e[Xt]]=Zt[Xt];var Ze=Q[0]-Ve;Ve=Q[0],Ze==0?Ue(ut[0]):(Ue(ut[U[It=32767+Ze]]),Ue(R[It]));for(var zn=63;zn>0&&Q[zn]==0;)zn--;if(zn==0)return Ue(Oe),Ve;for(var on,mt=1;mt<=zn;){for(var Ir=mt;Q[mt]==0&&mt<=zn;)++mt;var Fr=mt-Ir;if(Fr>=16){on=Fr>>4;for(var qr=1;qr<=on;++qr)Ue(Wt);Fr&=15}It=32767+Q[mt],Ue(pt[(Fr<<4)+U[It]]),Ue(R[It]),mt++}return zn!=63&&Ue(Oe),Ve}function Ce(ge){ge=Math.min(Math.max(ge,1),100),c!=ge&&((function(We){for(var Ve=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],ut=0;ut<64;ut++){var pt=_((Ve[ut]*We+50)/100);pt=Math.min(Math.max(pt,1),255),y[_e[ut]]=pt}for(var It=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Oe=0;Oe<64;Oe++){var Wt=_((It[Oe]*We+50)/100);Wt=Math.min(Math.max(Wt,1),255),s[_e[Oe]]=Wt}for(var Zt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Xt=0,Ze=0;Ze<8;Ze++)for(var zn=0;zn<8;zn++)T[Xt]=1/(y[_e[Xt]]*Zt[Ze]*Zt[zn]*8),L[Xt]=1/(s[_e[Xt]]*Zt[Ze]*Zt[zn]*8),Xt++})(ge<50?Math.floor(5e3/ge):Math.floor(200-2*ge)),c=ge)}this.encode=function(ge,We){We&&Ce(We),ae=new Array,ye=0,ie=7,He(65496),He(65504),He(16),Le(74),Le(70),Le(73),Le(70),Le(0),Le(1),Le(1),Le(0),He(1),He(1),Le(0),Le(0),(function(){He(65499),He(132),Le(0);for(var ni=0;ni<64;ni++)Le(y[ni]);Le(1);for(var nn=0;nn<64;nn++)Le(s[nn])})(),(function(ni,nn){He(65472),He(17),Le(8),He(nn),He(ni),Le(3),Le(1),Le(17),Le(0),Le(2),Le(17),Le(1),Le(3),Le(17),Le(1)})(ge.width,ge.height),(function(){He(65476),He(418),Le(0);for(var ni=0;ni<16;ni++)Le(G[ni+1]);for(var nn=0;nn<=11;nn++)Le(B[nn]);Le(16);for(var yn=0;yn<16;yn++)Le(Y[yn+1]);for(var sr=0;sr<=161;sr++)Le($[sr]);Le(1);for(var Zn=0;Zn<16;Zn++)Le(J[Zn+1]);for(var $r=0;$r<=11;$r++)Le(te[$r]);Le(17);for(var qn=0;qn<16;qn++)Le(Se[qn+1]);for(var jr=0;jr<=161;jr++)Le(De[jr])})(),He(65498),He(12),Le(3),Le(1),Le(0),Le(2),Le(17),Le(3),Le(17),Le(0),Le(63),Le(0);var Ve=0,ut=0,pt=0;ye=0,ie=7,this.encode.displayName="_encode_";for(var It,Oe,Wt,Zt,Xt,Ze,zn,on,mt,Ir=ge.data,Fr=ge.width,qr=ge.height,$t=4*Fr,xr=0;xr<qr;){for(It=0;It<$t;){for(Xt=$t*xr+It,zn=-1,on=0,mt=0;mt<64;mt++)Ze=Xt+(on=mt>>3)*$t+(zn=4*(7&mt)),xr+on>=qr&&(Ze-=$t*(xr+1+on-qr)),It+zn>=$t&&(Ze-=It+zn-$t+4),Oe=Ir[Ze++],Wt=Ir[Ze++],Zt=Ir[Ze++],oe[mt]=(Be[Oe]+Be[Wt+256|0]+Be[Zt+512|0]>>16)-128,ve[mt]=(Be[Oe+768|0]+Be[Wt+1024|0]+Be[Zt+1280|0]>>16)-128,de[mt]=(Be[Oe+1280|0]+Be[Wt+1536|0]+Be[Zt+1792|0]>>16)-128;Ve=Ke(oe,T,Ve,e,i),ut=Ke(ve,L,ut,t,a),pt=Ke(de,L,pt,t,a),It+=32}xr+=8}if(ie>=0){var dr=[];dr[1]=ie+1,dr[0]=(1<<ie+1)-1,Ue(dr)}return He(65497),new Uint8Array(ae)},n=n||50,(function(){for(var ge=String.fromCharCode,We=0;We<256;We++)Pe[We]=ge(We)})(),e=$e(G,B),t=$e(J,te),i=$e(Y,$),a=$e(Se,De),(function(){for(var ge=1,We=2,Ve=1;Ve<=15;Ve++){for(var ut=ge;ut<We;ut++)U[32767+ut]=Ve,R[32767+ut]=[],R[32767+ut][1]=Ve,R[32767+ut][0]=ut;for(var pt=-(We-1);pt<=-ge;pt++)U[32767+pt]=Ve,R[32767+pt]=[],R[32767+pt][1]=Ve,R[32767+pt][0]=We-1+pt;ge<<=1,We<<=1}})(),(function(){for(var ge=0;ge<256;ge++)Be[ge]=19595*ge,Be[ge+256|0]=38470*ge,Be[ge+512|0]=7471*ge+32768,Be[ge+768|0]=-11059*ge,Be[ge+1024|0]=-21709*ge,Be[ge+1280|0]=32768*ge+8421375,Be[ge+1536|0]=-27439*ge,Be[ge+1792|0]=-5329*ge})(),Ce(n)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function rd(n,e){if(this.pos=0,this.buffer=n,this.datav=new DataView(n.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function kE(n){function e(B){if(!B)throw Error("assert :P")}function t(B,Y,$){for(var J=0;4>J;J++)if(B[Y+J]!=$.charCodeAt(J))return!0;return!1}function i(B,Y,$,J,te){for(var Se=0;Se<te;Se++)B[Y+Se]=$[J+Se]}function a(B,Y,$,J){for(var te=0;te<J;te++)B[Y+te]=$}function c(B){return new Int32Array(B)}function _(B,Y){for(var $=[],J=0;J<B;J++)$.push(new Y);return $}function y(B,Y){var $=[];return(function J(te,Se,De){for(var $e=De[Se],Ue=0;Ue<$e&&(te.push(De.length>Se+1?[]:new Y),!(De.length<Se+1));Ue++)J(te[Ue],Se+1,De)})($,0,B),$}var s=function(){var B=this;function Y(D,H){for(var ue=1<<H-1>>>0;D&ue;)ue>>>=1;return ue?(D&ue-1)+ue:D}function $(D,H,ue,pe,Ge){e(!(pe%ue));do D[H+(pe-=ue)]=Ge;while(0<pe)}function J(D,H,ue,pe,Ge){if(e(2328>=Ge),512>=Ge)var tt=c(512);else if((tt=c(Ge))==null)return 0;return(function(it,ht,dt,St,Yt,pn){var Et,Qt,gn=ht,Bn=1<<dt,x=c(16),l=c(16);for(e(Yt!=0),e(St!=null),e(it!=null),e(0<dt),Qt=0;Qt<Yt;++Qt){if(15<St[Qt])return 0;++x[St[Qt]]}if(x[0]==Yt)return 0;for(l[1]=0,Et=1;15>Et;++Et){if(x[Et]>1<<Et)return 0;l[Et+1]=l[Et]+x[Et]}for(Qt=0;Qt<Yt;++Qt)Et=St[Qt],0<St[Qt]&&(pn[l[Et]++]=Qt);if(l[15]==1)return(St=new te).g=0,St.value=pn[0],$(it,gn,1,Bn,St),Bn;var m,b=-1,I=Bn-1,P=0,j=1,W=1,Z=1<<dt;for(Qt=0,Et=1,Yt=2;Et<=dt;++Et,Yt<<=1){if(j+=W<<=1,0>(W-=x[Et]))return 0;for(;0<x[Et];--x[Et])(St=new te).g=Et,St.value=pn[Qt++],$(it,gn+P,Yt,Z,St),P=Y(P,Et)}for(Et=dt+1,Yt=2;15>=Et;++Et,Yt<<=1){if(j+=W<<=1,0>(W-=x[Et]))return 0;for(;0<x[Et];--x[Et]){if(St=new te,(P&I)!=b){for(gn+=Z,m=1<<(b=Et)-dt;15>b&&!(0>=(m-=x[b]));)++b,m<<=1;Bn+=Z=1<<(m=b-dt),it[ht+(b=P&I)].g=m+dt,it[ht+b].value=gn-ht-b}St.g=Et-dt,St.value=pn[Qt++],$(it,gn+(P>>dt),Yt,Z,St),P=Y(P,Et)}}return j!=2*l[15]-1?0:Bn})(D,H,ue,pe,Ge,tt)}function te(){this.value=this.g=0}function Se(){this.value=this.g=0}function De(){this.G=_(5,te),this.H=c(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=_(yu,Se)}function $e(D,H,ue,pe){e(D!=null),e(H!=null),e(2147483648>pe),D.Ca=254,D.I=0,D.b=-8,D.Ka=0,D.oa=H,D.pa=ue,D.Jd=H,D.Yc=ue+pe,D.Zc=4<=pe?ue+pe-4+1:ue,Oe(D)}function Ue(D,H){for(var ue=0;0<H--;)ue|=Zt(D,128)<<H;return ue}function Le(D,H){var ue=Ue(D,H);return Wt(D)?-ue:ue}function He(D,H,ue,pe){var Ge,tt=0;for(e(D!=null),e(H!=null),e(4294967288>pe),D.Sb=pe,D.Ra=0,D.u=0,D.h=0,4<pe&&(pe=4),Ge=0;Ge<pe;++Ge)tt+=H[ue+Ge]<<8*Ge;D.Ra=tt,D.bb=pe,D.oa=H,D.pa=ue}function Ke(D){for(;8<=D.u&&D.bb<D.Sb;)D.Ra>>>=8,D.Ra+=D.oa[D.pa+D.bb]<<Hu-8>>>0,++D.bb,D.u-=8;ut(D)&&(D.h=1,D.u=0)}function Ce(D,H){if(e(0<=H),!D.h&&H<=al){var ue=Ve(D)&Wa[H];return D.u+=H,Ke(D),ue}return D.h=1,D.u=0}function ge(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function We(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Ve(D){return D.Ra>>>(D.u&Hu-1)>>>0}function ut(D){return e(D.bb<=D.Sb),D.h||D.bb==D.Sb&&D.u>Hu}function pt(D,H){D.u=H,D.h=ut(D)}function It(D){D.u>=yo&&(e(D.u>=yo),Ke(D))}function Oe(D){e(D!=null&&D.oa!=null),D.pa<D.Zc?(D.I=(D.oa[D.pa++]|D.I<<8)>>>0,D.b+=8):(e(D!=null&&D.oa!=null),D.pa<D.Yc?(D.b+=8,D.I=D.oa[D.pa++]|D.I<<8):D.Ka?D.b=0:(D.I<<=8,D.b+=8,D.Ka=1))}function Wt(D){return Ue(D,1)}function Zt(D,H){var ue=D.Ca;0>D.b&&Oe(D);var pe=D.b,Ge=ue*H>>>8,tt=(D.I>>>pe>Ge)+0;for(tt?(ue-=Ge,D.I-=Ge+1<<pe>>>0):ue=Ge+1,pe=ue,Ge=0;256<=pe;)Ge+=8,pe>>=8;return pe=7^Ge+ia[pe],D.b-=pe,D.Ca=(ue<<pe)-1,tt}function Xt(D,H,ue){D[H+0]=ue>>24&255,D[H+1]=ue>>16&255,D[H+2]=ue>>8&255,D[H+3]=255&ue}function Ze(D,H){return D[H+0]|D[H+1]<<8}function zn(D,H){return Ze(D,H)|D[H+2]<<16}function on(D,H){return Ze(D,H)|Ze(D,H+2)<<16}function mt(D,H){var ue=1<<H;return e(D!=null),e(0<H),D.X=c(ue),D.X==null?0:(D.Mb=32-H,D.Xa=H,1)}function Ir(D,H){e(D!=null),e(H!=null),e(D.Xa==H.Xa),i(H.X,0,D.X,0,1<<H.Xa)}function Fr(){this.X=[],this.Xa=this.Mb=0}function qr(D,H,ue,pe){e(ue!=null),e(pe!=null);var Ge=ue[0],tt=pe[0];return Ge==0&&(Ge=(D*tt+H/2)/H),tt==0&&(tt=(H*Ge+D/2)/D),0>=Ge||0>=tt?0:(ue[0]=Ge,pe[0]=tt,1)}function $t(D,H){return D+(1<<H)-1>>>H}function xr(D,H){return((4278255360&D)+(4278255360&H)>>>0&4278255360)+((16711935&D)+(16711935&H)>>>0&16711935)>>>0}function dr(D,H){B[H]=function(ue,pe,Ge,tt,it,ht,dt){var St;for(St=0;St<it;++St){var Yt=B[D](ht[dt+St-1],Ge,tt+St);ht[dt+St]=xr(ue[pe+St],Yt)}}}function ni(){this.ud=this.hd=this.jd=0}function nn(D,H){return((4278124286&(D^H))>>>1)+(D&H)>>>0}function yn(D){return 0<=D&&256>D?D:0>D?0:255<D?255:void 0}function sr(D,H){return yn(D+(D-H+.5>>1))}function Zn(D,H,ue){return Math.abs(H-ue)-Math.abs(D-ue)}function $r(D,H,ue,pe,Ge,tt,it){for(pe=tt[it-1],ue=0;ue<Ge;++ue)tt[it+ue]=pe=xr(D[H+ue],pe)}function qn(D,H,ue,pe,Ge){var tt;for(tt=0;tt<ue;++tt){var it=D[H+tt],ht=it>>8&255,dt=16711935&(dt=(dt=16711935&it)+((ht<<16)+ht));pe[Ge+tt]=(4278255360&it)+dt>>>0}}function jr(D,H){H.jd=255&D,H.hd=D>>8&255,H.ud=D>>16&255}function ir(D,H,ue,pe,Ge,tt){var it;for(it=0;it<pe;++it){var ht=H[ue+it],dt=ht>>>8,St=ht,Yt=255&(Yt=(Yt=ht>>>16)+((D.jd<<24>>24)*(dt<<24>>24)>>>5));St=255&(St=(St+=(D.hd<<24>>24)*(dt<<24>>24)>>>5)+((D.ud<<24>>24)*(Yt<<24>>24)>>>5)),Ge[tt+it]=(4278255360&ht)+(Yt<<16)+St}}function Xn(D,H,ue,pe,Ge){B[H]=function(tt,it,ht,dt,St,Yt,pn,Et,Qt){for(dt=pn;dt<Et;++dt)for(pn=0;pn<Qt;++pn)St[Yt++]=Ge(ht[pe(tt[it++])])},B[D]=function(tt,it,ht,dt,St,Yt,pn){var Et=8>>tt.b,Qt=tt.Ea,gn=tt.K[0],Bn=tt.w;if(8>Et)for(tt=(1<<tt.b)-1,Bn=(1<<Et)-1;it<ht;++it){var x,l=0;for(x=0;x<Qt;++x)x&tt||(l=pe(dt[St++])),Yt[pn++]=Ge(gn[l&Bn]),l>>=Et}else B["VP8LMapColor"+ue](dt,St,gn,Bn,Yt,pn,it,ht,Qt)}}function Bi(D,H,ue,pe,Ge){for(ue=H+ue;H<ue;){var tt=D[H++];pe[Ge++]=tt>>16&255,pe[Ge++]=tt>>8&255,pe[Ge++]=255&tt}}function bi(D,H,ue,pe,Ge){for(ue=H+ue;H<ue;){var tt=D[H++];pe[Ge++]=tt>>16&255,pe[Ge++]=tt>>8&255,pe[Ge++]=255&tt,pe[Ge++]=tt>>24&255}}function wr(D,H,ue,pe,Ge){for(ue=H+ue;H<ue;){var tt=(it=D[H++])>>16&240|it>>12&15,it=240&it|it>>28&15;pe[Ge++]=tt,pe[Ge++]=it}}function or(D,H,ue,pe,Ge){for(ue=H+ue;H<ue;){var tt=(it=D[H++])>>16&248|it>>13&7,it=it>>5&224|it>>3&31;pe[Ge++]=tt,pe[Ge++]=it}}function ui(D,H,ue,pe,Ge){for(ue=H+ue;H<ue;){var tt=D[H++];pe[Ge++]=255&tt,pe[Ge++]=tt>>8&255,pe[Ge++]=tt>>16&255}}function Kr(D,H,ue,pe,Ge,tt){if(tt==0)for(ue=H+ue;H<ue;)Xt(pe,((tt=D[H++])[0]>>24|tt[1]>>8&65280|tt[2]<<8&16711680|tt[3]<<24)>>>0),Ge+=32;else i(pe,Ge,D,H,ue)}function wi(D,H){B[H][0]=B[D+"0"],B[H][1]=B[D+"1"],B[H][2]=B[D+"2"],B[H][3]=B[D+"3"],B[H][4]=B[D+"4"],B[H][5]=B[D+"5"],B[H][6]=B[D+"6"],B[H][7]=B[D+"7"],B[H][8]=B[D+"8"],B[H][9]=B[D+"9"],B[H][10]=B[D+"10"],B[H][11]=B[D+"11"],B[H][12]=B[D+"12"],B[H][13]=B[D+"13"],B[H][14]=B[D+"0"],B[H][15]=B[D+"0"]}function si(D){return D==vc||D==Mu||D==xc||D==bc}function vt(){this.eb=[],this.size=this.A=this.fb=0}function Ne(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function ze(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new vt,this.f.kb=new Ne,this.sd=null}function ft(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function wt(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Ut(D){return alert("todo:WebPSamplerProcessPlane"),D.T}function Gt(D,H){var ue=D.T,pe=H.ba.f.RGBA,Ge=pe.eb,tt=pe.fb+D.ka*pe.A,it=cu[H.ba.S],ht=D.y,dt=D.O,St=D.f,Yt=D.N,pn=D.ea,Et=D.W,Qt=H.cc,gn=H.dc,Bn=H.Mc,x=H.Nc,l=D.ka,m=D.ka+D.T,b=D.U,I=b+1>>1;for(l==0?it(ht,dt,null,null,St,Yt,pn,Et,St,Yt,pn,Et,Ge,tt,null,null,b):(it(H.ec,H.fc,ht,dt,Qt,gn,Bn,x,St,Yt,pn,Et,Ge,tt-pe.A,Ge,tt,b),++ue);l+2<m;l+=2)Qt=St,gn=Yt,Bn=pn,x=Et,Yt+=D.Rc,Et+=D.Rc,tt+=2*pe.A,it(ht,(dt+=2*D.fa)-D.fa,ht,dt,Qt,gn,Bn,x,St,Yt,pn,Et,Ge,tt-pe.A,Ge,tt,b);return dt+=D.fa,D.j+m<D.o?(i(H.ec,H.fc,ht,dt,b),i(H.cc,H.dc,St,Yt,I),i(H.Mc,H.Nc,pn,Et,I),ue--):1&m||it(ht,dt,null,null,St,Yt,pn,Et,St,Yt,pn,Et,Ge,tt+pe.A,null,null,b),ue}function Tt(D,H,ue){var pe=D.F,Ge=[D.J];if(pe!=null){var tt=D.U,it=H.ba.S,ht=it==Dr||it==xc;H=H.ba.f.RGBA;var dt=[0],St=D.ka;dt[0]=D.T,D.Kb&&(St==0?--dt[0]:(--St,Ge[0]-=D.width),D.j+D.ka+D.T==D.o&&(dt[0]=D.o-D.j-St));var Yt=H.eb;St=H.fb+St*H.A,D=cl(pe,Ge[0],D.width,tt,dt,Yt,St+(ht?0:3),H.A),e(ue==dt),D&&si(it)&&As(Yt,St,ht,tt,dt,H.A)}return 0}function Ot(D){var H=D.ma,ue=H.ba.S,pe=11>ue,Ge=ue==Ka||ue==ac||ue==Dr||ue==Is||ue==12||si(ue);if(H.memory=null,H.Ib=null,H.Jb=null,H.Nd=null,!xa(H.Oa,D,Ge?11:12))return 0;if(Ge&&si(ue)&&Fl(),D.da)alert("todo:use_scaling");else{if(pe){if(H.Ib=Ut,D.Kb){if(ue=D.U+1>>1,H.memory=c(D.U+2*ue),H.memory==null)return 0;H.ec=H.memory,H.fc=0,H.cc=H.ec,H.dc=H.fc+D.U,H.Mc=H.cc,H.Nc=H.dc+ue,H.Ib=Gt,Fl()}}else alert("todo:EmitYUV");Ge&&(H.Jb=Tt,pe&&io())}if(pe&&!ql){for(D=0;256>D;++D)vu[D]=89858*(D-128)+Du>>kl,vl[D]=-22014*(D-128)+Du,_l[D]=-45773*(D-128),uh[D]=113618*(D-128)+Du>>kl;for(D=So;D<fs;++D)H=76283*(D-16)+Du>>kl,hf[D-So]=es(H,255),Fu[D-So]=es(H+8>>4,15);ql=1}return 1}function zt(D){var H=D.ma,ue=D.U,pe=D.T;return e(!(1&D.ka)),0>=ue||0>=pe?0:(ue=H.Ib(D,H),H.Jb!=null&&H.Jb(D,H,ue),H.Dc+=ue,1)}function Pn(D){D.ma.memory=null}function Jn(D,H,ue,pe){return Ce(D,8)!=47?0:(H[0]=Ce(D,14)+1,ue[0]=Ce(D,14)+1,pe[0]=Ce(D,1),Ce(D,3)!=0?0:!D.h)}function Fn(D,H){if(4>D)return D+1;var ue=D-2>>1;return(2+(1&D)<<ue)+Ce(H,ue)+1}function Gr(D,H){return 120<H?H-120:1<=(ue=((ue=Ji[H-1])>>4)*D+(8-(15&ue)))?ue:1;var ue}function Mr(D,H,ue){var pe=Ve(ue),Ge=D[H+=255&pe].g-8;return 0<Ge&&(pt(ue,ue.u+8),pe=Ve(ue),H+=D[H].value,H+=pe&(1<<Ge)-1),pt(ue,ue.u+D[H].g),D[H].value}function Zr(D,H,ue){return ue.g+=D.g,ue.value+=D.value<<H>>>0,e(8>=ue.g),D.g}function Br(D,H,ue){var pe=D.xc;return e((H=pe==0?0:D.vc[D.md*(ue>>pe)+(H>>pe)])<D.Wb),D.Ya[H]}function zi(D,H,ue,pe){var Ge=D.ab,tt=D.c*H,it=D.C;H=it+H;var ht=ue,dt=pe;for(pe=D.Ta,ue=D.Ua;0<Ge--;){var St=D.gc[Ge],Yt=it,pn=H,Et=ht,Qt=dt,gn=(dt=pe,ht=ue,St.Ea);switch(e(Yt<pn),e(pn<=St.nc),St.hc){case 2:No(Et,Qt,(pn-Yt)*gn,dt,ht);break;case 0:var Bn=Yt,x=pn,l=dt,m=ht,b=(Z=St).Ea;Bn==0&&(ll(Et,Qt,null,null,1,l,m),$r(Et,Qt+1,0,0,b-1,l,m+1),Qt+=b,m+=b,++Bn);for(var I=1<<Z.b,P=I-1,j=$t(b,Z.b),W=Z.K,Z=Z.w+(Bn>>Z.b)*j;Bn<x;){var le=W,ce=Z,Ee=1;for(Bl(Et,Qt,l,m-b,1,l,m);Ee<b;){var Fe=(Ee&~P)+I;Fe>b&&(Fe=b),(0,_u[le[ce++]>>8&15])(Et,Qt+ +Ee,l,m+Ee-b,Fe-Ee,l,m+Ee),Ee=Fe}Qt+=b,m+=b,++Bn&P||(Z+=j)}pn!=St.nc&&i(dt,ht-gn,dt,ht+(pn-Yt-1)*gn,gn);break;case 1:for(gn=Et,x=Qt,b=(Et=St.Ea)-(m=Et&~(l=(Qt=1<<St.b)-1)),Bn=$t(Et,St.b),I=St.K,St=St.w+(Yt>>St.b)*Bn;Yt<pn;){for(P=I,j=St,W=new ni,Z=x+m,le=x+Et;x<Z;)jr(P[j++],W),zl(W,gn,x,Qt,dt,ht),x+=Qt,ht+=Qt;x<le&&(jr(P[j++],W),zl(W,gn,x,b,dt,ht),x+=b,ht+=b),++Yt&l||(St+=Bn)}break;case 3:if(Et==dt&&Qt==ht&&0<St.b){for(x=dt,Et=gn=ht+(pn-Yt)*gn-(m=(pn-Yt)*$t(St.Ea,St.b)),Qt=dt,l=ht,Bn=[],m=(b=m)-1;0<=m;--m)Bn[m]=Qt[l+m];for(m=b-1;0<=m;--m)x[Et+m]=Bn[m];po(St,Yt,pn,dt,gn,dt,ht)}else po(St,Yt,pn,Et,Qt,dt,ht)}ht=pe,dt=ue}dt!=ue&&i(pe,ue,ht,dt,tt)}function ms(D,H){var ue=D.V,pe=D.Ba+D.c*D.C,Ge=H-D.C;if(e(H<=D.l.o),e(16>=Ge),0<Ge){var tt=D.l,it=D.Ta,ht=D.Ua,dt=tt.width;if(zi(D,Ge,ue,pe),Ge=ht=[ht],e((ue=D.C)<(pe=H)),e(tt.v<tt.va),pe>tt.o&&(pe=tt.o),ue<tt.j){var St=tt.j-ue;ue=tt.j,Ge[0]+=St*dt}if(ue>=pe?ue=0:(Ge[0]+=4*tt.v,tt.ka=ue-tt.j,tt.U=tt.va-tt.v,tt.T=pe-ue,ue=1),ue){if(ht=ht[0],11>(ue=D.ca).S){var Yt=ue.f.RGBA,pn=(pe=ue.S,Ge=tt.U,tt=tt.T,St=Yt.eb,Yt.A),Et=tt;for(Yt=Yt.fb+D.Ma*Yt.A;0<Et--;){var Qt=it,gn=ht,Bn=Ge,x=St,l=Yt;switch(pe){case Wu:ul(Qt,gn,Bn,x,l);break;case Ka:Jl(Qt,gn,Bn,x,l);break;case vc:Jl(Qt,gn,Bn,x,l),As(x,l,0,Bn,1,0);break;case kh:E(Qt,gn,Bn,x,l);break;case ac:Kr(Qt,gn,Bn,x,l,1);break;case Mu:Kr(Qt,gn,Bn,x,l,1),As(x,l,0,Bn,1,0);break;case Dr:Kr(Qt,gn,Bn,x,l,0);break;case xc:Kr(Qt,gn,Bn,x,l,0),As(x,l,1,Bn,1,0);break;case Is:jo(Qt,gn,Bn,x,l);break;case bc:jo(Qt,gn,Bn,x,l),Xo(x,l,Bn,1,0);break;case Ql:oa(Qt,gn,Bn,x,l);break;default:e(0)}ht+=dt,Yt+=pn}D.Ma+=tt}else alert("todo:EmitRescaledRowsYUVA");e(D.Ma<=ue.height)}}D.C=H,e(D.C<=D.i)}function Os(D){var H;if(0<D.ua)return 0;for(H=0;H<D.Wb;++H){var ue=D.Ya[H].G,pe=D.Ya[H].H;if(0<ue[1][pe[1]+0].g||0<ue[2][pe[2]+0].g||0<ue[3][pe[3]+0].g)return 0}return 1}function cs(D,H,ue,pe,Ge,tt){if(D.Z!=0){var it=D.qd,ht=D.rd;for(e(Cs[D.Z]!=null);H<ue;++H)Cs[D.Z](it,ht,pe,Ge,pe,Ge,tt),it=pe,ht=Ge,Ge+=tt;D.qd=it,D.rd=ht}}function ps(D,H){var ue=D.l.ma,pe=ue.Z==0||ue.Z==1?D.l.j:D.C;if(pe=D.C<pe?pe:D.C,e(H<=D.l.o),H>pe){var Ge=D.l.width,tt=ue.ca,it=ue.tb+Ge*pe,ht=D.V,dt=D.Ba+D.c*pe,St=D.gc;e(D.ab==1),e(St[0].hc==3),sa(St[0],pe,H,ht,dt,tt,it),cs(ue,pe,H,tt,it,Ge)}D.C=D.Ma=H}function vo(D,H,ue,pe,Ge,tt,it){var ht=D.$/pe,dt=D.$%pe,St=D.m,Yt=D.s,pn=ue+D.$,Et=pn;Ge=ue+pe*Ge;var Qt=ue+pe*tt,gn=280+Yt.ua,Bn=D.Pb?ht:16777216,x=0<Yt.ua?Yt.Wa:null,l=Yt.wc,m=pn<Qt?Br(Yt,dt,ht):null;e(D.C<tt),e(Qt<=Ge);var b=!1;e:for(;;){for(;b||pn<Qt;){var I=0;if(ht>=Bn){var P=pn-ue;e((Bn=D).Pb),Bn.wd=Bn.m,Bn.xd=P,0<Bn.s.ua&&Ir(Bn.s.Wa,Bn.s.vb),Bn=ht+qh}if(dt&l||(m=Br(Yt,dt,ht)),e(m!=null),m.Qb&&(H[pn]=m.qb,b=!0),!b)if(It(St),m.jc){I=St,P=H;var j=pn,W=m.pd[Ve(I)&yu-1];e(m.jc),256>W.g?(pt(I,I.u+W.g),P[j]=W.value,I=0):(pt(I,I.u+W.g-256),e(256<=W.value),I=W.value),I==0&&(b=!0)}else I=Mr(m.G[0],m.H[0],St);if(St.h)break;if(b||256>I){if(!b)if(m.nd)H[pn]=(m.qb|I<<8)>>>0;else{if(It(St),b=Mr(m.G[1],m.H[1],St),It(St),P=Mr(m.G[2],m.H[2],St),j=Mr(m.G[3],m.H[3],St),St.h)break;H[pn]=(j<<24|b<<16|I<<8|P)>>>0}if(b=!1,++pn,++dt>=pe&&(dt=0,++ht,it!=null&&ht<=tt&&!(ht%16)&&it(D,ht),x!=null))for(;Et<pn;)I=H[Et++],x.X[(506832829*I&4294967295)>>>x.Mb]=I}else if(280>I){if(I=Fn(I-256,St),P=Mr(m.G[4],m.H[4],St),It(St),P=Gr(pe,P=Fn(P,St)),St.h)break;if(pn-ue<P||Ge-pn<I)break e;for(j=0;j<I;++j)H[pn+j]=H[pn+j-P];for(pn+=I,dt+=I;dt>=pe;)dt-=pe,++ht,it!=null&&ht<=tt&&!(ht%16)&&it(D,ht);if(e(pn<=Ge),dt&l&&(m=Br(Yt,dt,ht)),x!=null)for(;Et<pn;)I=H[Et++],x.X[(506832829*I&4294967295)>>>x.Mb]=I}else{if(!(I<gn))break e;for(b=I-280,e(x!=null);Et<pn;)I=H[Et++],x.X[(506832829*I&4294967295)>>>x.Mb]=I;I=pn,e(!(b>>>(P=x).Xa)),H[I]=P.X[b],b=!0}b||e(St.h==ut(St))}if(D.Pb&&St.h&&pn<Ge)e(D.m.h),D.a=5,D.m=D.wd,D.$=D.xd,0<D.s.ua&&Ir(D.s.vb,D.s.Wa);else{if(St.h)break e;it?.(D,ht>tt?tt:ht),D.a=0,D.$=pn-ue}return 1}return D.a=3,0}function is(D){e(D!=null),D.vc=null,D.yc=null,D.Ya=null;var H=D.Wa;H!=null&&(H.X=null),D.vb=null,e(D!=null)}function xo(){var D=new Qr;return D==null?null:(D.a=0,D.xb=wc,wi("Predictor","VP8LPredictors"),wi("Predictor","VP8LPredictors_C"),wi("PredictorAdd","VP8LPredictorsAdd"),wi("PredictorAdd","VP8LPredictorsAdd_C"),No=qn,zl=ir,ul=Bi,Jl=bi,jo=wr,oa=or,E=ui,B.VP8LMapColor32b=Ra,B.VP8LMapColor8b=sc,D)}function ua(D,H,ue,pe,Ge){var tt=1,it=[D],ht=[H],dt=pe.m,St=pe.s,Yt=null,pn=0;e:for(;;){if(ue)for(;tt&&Ce(dt,1);){var Et=it,Qt=ht,gn=pe,Bn=1,x=gn.m,l=gn.gc[gn.ab],m=Ce(x,2);if(gn.Oc&1<<m)tt=0;else{switch(gn.Oc|=1<<m,l.hc=m,l.Ea=Et[0],l.nc=Qt[0],l.K=[null],++gn.ab,e(4>=gn.ab),m){case 0:case 1:l.b=Ce(x,3)+2,Bn=ua($t(l.Ea,l.b),$t(l.nc,l.b),0,gn,l.K),l.K=l.K[0];break;case 3:var b,I=Ce(x,8)+1,P=16<I?0:4<I?1:2<I?2:3;if(Et[0]=$t(l.Ea,P),l.b=P,b=Bn=ua(I,1,0,gn,l.K)){var j,W=I,Z=l,le=1<<(8>>Z.b),ce=c(le);if(ce==null)b=0;else{var Ee=Z.K[0],Fe=Z.w;for(ce[0]=Z.K[0][0],j=1;j<1*W;++j)ce[j]=xr(Ee[Fe+j],ce[j-1]);for(;j<4*le;++j)ce[j]=0;Z.K[0]=null,Z.K[0]=ce,b=1}}Bn=b;break;case 2:break;default:e(0)}tt=Bn}}if(it=it[0],ht=ht[0],tt&&Ce(dt,1)&&!(tt=1<=(pn=Ce(dt,4))&&11>=pn)){pe.a=3;break e}var qe;if(qe=tt)t:{var at,et,lt,Ie=pe,rt=it,gt=ht,yt=pn,Mt=ue,Dt=Ie.m,Nt=Ie.s,qt=[null],Bt=1,rn=0,Rn=Za[yt];n:for(;;){if(Mt&&Ce(Dt,1)){var Jt=Ce(Dt,3)+2,An=$t(rt,Jt),cn=$t(gt,Jt),Vn=An*cn;if(!ua(An,cn,0,Ie,qt))break n;for(qt=qt[0],Nt.xc=Jt,at=0;at<Vn;++at){var tn=qt[at]>>8&65535;qt[at]=tn,tn>=Bt&&(Bt=tn+1)}}if(Dt.h)break n;for(et=0;5>et;++et){var bn=Co[et];!et&&0<yt&&(bn+=1<<yt),rn<bn&&(rn=bn)}var Un=_(Bt*Rn,te),In=Bt,Wn=_(In,De);if(Wn==null)var Nr=null;else e(65536>=In),Nr=Wn;var ei=c(rn);if(Nr==null||ei==null||Un==null){Ie.a=1;break n}var Er=Un;for(at=lt=0;at<Bt;++at){var gr=Nr[at],Ai=gr.G,Mi=gr.H,Vr=0,Yi=1,Ki=0;for(et=0;5>et;++et){bn=Co[et],Ai[et]=Er,Mi[et]=lt,!et&&0<yt&&(bn+=1<<yt);i:{var ts,Gs=bn,wa=Ie,$o=ei,Bu=Er,Yu=lt,Zi=0,ks=wa.m,$s=Ce(ks,1);if(a($o,0,0,Gs),$s){var Sa=Ce(ks,1)+1,Gl=Ce(ks,1),Eo=Ce(ks,Gl==0?1:8);$o[Eo]=1,Sa==2&&($o[Eo=Ce(ks,8)]=1);var Ea=1}else{var Yo=c(19),Ro=Ce(ks,4)+4;if(19<Ro){wa.a=3;var aa=0;break i}for(ts=0;ts<Ro;++ts)Yo[hl[ts]]=Ce(ks,3);var zu=void 0,Ta=void 0,Ku=wa,If=Yo,Oa=Gs,Wh=$o,Cf=0,Wc=Ku.m,Xc=8,Zu=_(128,te);r:for(;J(Zu,0,7,If,19);){if(Ce(Wc,1)){var fh=2+2*Ce(Wc,3);if((zu=2+Ce(Wc,fh))>Oa)break r}else zu=Oa;for(Ta=0;Ta<Oa&&zu--;){It(Wc);var Hf=Zu[0+(127&Ve(Wc))];pt(Wc,Wc.u+Hf.g);var Yc=Hf.value;if(16>Yc)Wh[Ta++]=Yc,Yc!=0&&(Xc=Yc);else{var kf=Yc==16,Kc=Yc-16,Nh=pa[Kc],dh=Ce(Wc,jn[Kc])+Nh;if(Ta+dh>Oa)break r;for(var Wf=kf?Xc:0;0<dh--;)Wh[Ta++]=Wf}}Cf=1;break r}Cf||(Ku.a=3),Ea=Cf}(Ea=Ea&&!ks.h)&&(Zi=J(Bu,Yu,8,$o,Gs)),Ea&&Zi!=0?aa=Zi:(wa.a=3,aa=0)}if(aa==0)break n;if(Yi&&uu[et]==1&&(Yi=Er[lt].g==0),Vr+=Er[lt].g,lt+=aa,3>=et){var Xh,Yh=ei[0];for(Xh=1;Xh<bn;++Xh)ei[Xh]>Yh&&(Yh=ei[Xh]);Ki+=Yh}}if(gr.nd=Yi,gr.Qb=0,Yi&&(gr.qb=(Ai[3][Mi[3]+0].value<<24|Ai[1][Mi[1]+0].value<<16|Ai[2][Mi[2]+0].value)>>>0,Vr==0&&256>Ai[0][Mi[0]+0].value&&(gr.Qb=1,gr.qb+=Ai[0][Mi[0]+0].value<<8)),gr.jc=!gr.Qb&&6>Ki,gr.jc){var Xf,eu=gr;for(Xf=0;Xf<yu;++Xf){var Sc=Xf,tu=eu.pd[Sc],$l=eu.G[0][eu.H[0]+Sc];256<=$l.value?(tu.g=$l.g+256,tu.value=$l.value):(tu.g=0,tu.value=0,Sc>>=Zr($l,8,tu),Sc>>=Zr(eu.G[1][eu.H[1]+Sc],16,tu),Sc>>=Zr(eu.G[2][eu.H[2]+Sc],0,tu),Zr(eu.G[3][eu.H[3]+Sc],24,tu))}}}Nt.vc=qt,Nt.Wb=Bt,Nt.Ya=Nr,Nt.yc=Un,qe=1;break t}qe=0}if(!(tt=qe)){pe.a=3;break e}if(0<pn){if(St.ua=1<<pn,!mt(St.Wa,pn)){pe.a=1,tt=0;break e}}else St.ua=0;var uc=pe,Zc=it,Rh=ht,Jc=uc.s,Yf=Jc.xc;if(uc.c=Zc,uc.i=Rh,Jc.md=$t(Zc,Yf),Jc.wc=Yf==0?-1:(1<<Yf)-1,ue){pe.xb=Cl;break e}if((Yt=c(it*ht))==null){pe.a=1,tt=0;break e}tt=(tt=vo(pe,Yt,0,it,ht,ht,null))&&!dt.h;break e}return tt?(Ge!=null?Ge[0]=Yt:(e(Yt==null),e(ue)),pe.$=0,ue||is(St)):is(St),tt}function tl(D,H){var ue=D.c*D.i,pe=ue+H+16*H;return e(D.c<=H),D.V=c(pe),D.V==null?(D.Ta=null,D.Ua=0,D.a=1,0):(D.Ta=D.V,D.Ua=D.Ba+ue+H,1)}function Pa(D,H){var ue=D.C,pe=H-ue,Ge=D.V,tt=D.Ba+D.c*ue;for(e(H<=D.l.o);0<pe;){var it=16<pe?16:pe,ht=D.l.ma,dt=D.l.width,St=dt*it,Yt=ht.ca,pn=ht.tb+dt*ue,Et=D.Ta,Qt=D.Ua;zi(D,it,Ge,tt),Ma(Et,Qt,Yt,pn,St),cs(ht,ue,ue+it,Yt,pn,dt),pe-=it,Ge+=it*D.c,ue+=it}e(ue==H),D.C=D.Ma=H}function di(){this.ub=this.yd=this.td=this.Rb=0}function ou(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function yc(){this.Fb=this.Bb=this.Cb=0,this.Zb=c(4),this.Lb=c(4)}function Ss(){this.Yb=(function(){var D=[];return(function H(ue,pe,Ge){for(var tt=Ge[pe],it=0;it<tt&&(ue.push(Ge.length>pe+1?[]:0),!(Ge.length<pe+1));it++)H(ue[it],pe+1,Ge)})(D,0,[3,11]),D})()}function au(){this.jb=c(3),this.Wc=y([4,8],Ss),this.Xc=y([4,17],Ss)}function ga(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new c(4),this.od=new c(4)}function uo(){this.ld=this.La=this.dd=this.tc=0}function nl(){this.Na=this.la=0}function Kl(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function ea(){this.ad=c(384),this.Za=0,this.Ob=c(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Wo(){this.uc=this.M=this.Nb=0,this.wa=Array(new uo),this.Y=0,this.ya=Array(new ea),this.aa=0,this.l=new co}function ta(){this.y=c(16),this.f=c(8),this.ea=c(8)}function En(){this.cb=this.a=0,this.sc="",this.m=new ge,this.Od=new di,this.Kc=new ou,this.ed=new ga,this.Qa=new yc,this.Ic=this.$c=this.Aa=0,this.D=new Wo,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=_(8,ge),this.ia=0,this.pb=_(4,Kl),this.Pa=new au,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new ta),this.Hd=0,this.rb=Array(new nl),this.sb=0,this.wa=Array(new uo),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new ea),this.L=this.aa=0,this.gd=y([4,2],uo),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function co(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Io(){var D=new En;return D!=null&&(D.a=0,D.sc="OK",D.cb=0,D.Xb=0,Mc||(Mc=il)),D}function Ni(D,H,ue){return D.a==0&&(D.a=H,D.sc=ue,D.cb=0),0}function ic(D,H,ue){return 3<=ue&&D[H+0]==157&&D[H+1]==1&&D[H+2]==42}function rl(D,H){if(D==null)return 0;if(D.a=0,D.sc="OK",H==null)return Ni(D,2,"null VP8Io passed to VP8GetHeaders()");var ue=H.data,pe=H.w,Ge=H.ha;if(4>Ge)return Ni(D,7,"Truncated header.");var tt=ue[pe+0]|ue[pe+1]<<8|ue[pe+2]<<16,it=D.Od;if(it.Rb=!(1&tt),it.td=tt>>1&7,it.yd=tt>>4&1,it.ub=tt>>5,3<it.td)return Ni(D,3,"Incorrect keyframe parameters.");if(!it.yd)return Ni(D,4,"Frame not displayable.");pe+=3,Ge-=3;var ht=D.Kc;if(it.Rb){if(7>Ge)return Ni(D,7,"cannot parse picture header");if(!ic(ue,pe,Ge))return Ni(D,3,"Bad code word");ht.c=16383&(ue[pe+4]<<8|ue[pe+3]),ht.Td=ue[pe+4]>>6,ht.i=16383&(ue[pe+6]<<8|ue[pe+5]),ht.Ud=ue[pe+6]>>6,pe+=7,Ge-=7,D.za=ht.c+15>>4,D.Ub=ht.i+15>>4,H.width=ht.c,H.height=ht.i,H.Da=0,H.j=0,H.v=0,H.va=H.width,H.o=H.height,H.da=0,H.ib=H.width,H.hb=H.height,H.U=H.width,H.T=H.height,a((tt=D.Pa).jb,0,255,tt.jb.length),e((tt=D.Qa)!=null),tt.Cb=0,tt.Bb=0,tt.Fb=1,a(tt.Zb,0,0,tt.Zb.length),a(tt.Lb,0,0,tt.Lb)}if(it.ub>Ge)return Ni(D,7,"bad partition length");$e(tt=D.m,ue,pe,it.ub),pe+=it.ub,Ge-=it.ub,it.Rb&&(ht.Ld=Wt(tt),ht.Kd=Wt(tt)),ht=D.Qa;var dt,St=D.Pa;if(e(tt!=null),e(ht!=null),ht.Cb=Wt(tt),ht.Cb){if(ht.Bb=Wt(tt),Wt(tt)){for(ht.Fb=Wt(tt),dt=0;4>dt;++dt)ht.Zb[dt]=Wt(tt)?Le(tt,7):0;for(dt=0;4>dt;++dt)ht.Lb[dt]=Wt(tt)?Le(tt,6):0}if(ht.Bb)for(dt=0;3>dt;++dt)St.jb[dt]=Wt(tt)?Ue(tt,8):255}else ht.Bb=0;if(tt.Ka)return Ni(D,3,"cannot parse segment header");if((ht=D.ed).zd=Wt(tt),ht.Tb=Ue(tt,6),ht.wb=Ue(tt,3),ht.Pc=Wt(tt),ht.Pc&&Wt(tt)){for(St=0;4>St;++St)Wt(tt)&&(ht.vd[St]=Le(tt,6));for(St=0;4>St;++St)Wt(tt)&&(ht.od[St]=Le(tt,6))}if(D.L=ht.Tb==0?0:ht.zd?1:2,tt.Ka)return Ni(D,3,"cannot parse filter header");var Yt=Ge;if(Ge=dt=pe,pe=dt+Yt,ht=Yt,D.Xb=(1<<Ue(D.m,2))-1,Yt<3*(St=D.Xb))ue=7;else{for(dt+=3*St,ht-=3*St,Yt=0;Yt<St;++Yt){var pn=ue[Ge+0]|ue[Ge+1]<<8|ue[Ge+2]<<16;pn>ht&&(pn=ht),$e(D.Jc[+Yt],ue,dt,pn),dt+=pn,ht-=pn,Ge+=3}$e(D.Jc[+St],ue,dt,ht),ue=dt<pe?0:5}if(ue!=0)return Ni(D,ue,"cannot parse partitions");for(ue=Ue(dt=D.m,7),Ge=Wt(dt)?Le(dt,4):0,pe=Wt(dt)?Le(dt,4):0,ht=Wt(dt)?Le(dt,4):0,St=Wt(dt)?Le(dt,4):0,dt=Wt(dt)?Le(dt,4):0,Yt=D.Qa,pn=0;4>pn;++pn){if(Yt.Cb){var Et=Yt.Zb[pn];Yt.Fb||(Et+=ue)}else{if(0<pn){D.pb[pn]=D.pb[0];continue}Et=ue}var Qt=D.pb[pn];Qt.Sc[0]=Lh[es(Et+Ge,127)],Qt.Sc[1]=Si[es(Et+0,127)],Qt.Eb[0]=2*Lh[es(Et+pe,127)],Qt.Eb[1]=101581*Si[es(Et+ht,127)]>>16,8>Qt.Eb[1]&&(Qt.Eb[1]=8),Qt.Qc[0]=Lh[es(Et+St,117)],Qt.Qc[1]=Si[es(Et+dt,127)],Qt.lc=Et+dt}if(!it.Rb)return Ni(D,4,"Not a key frame.");for(Wt(tt),it=D.Pa,ue=0;4>ue;++ue){for(Ge=0;8>Ge;++Ge)for(pe=0;3>pe;++pe)for(ht=0;11>ht;++ht)St=Zt(tt,Hc[ue][Ge][pe][ht])?Ue(tt,8):$h[ue][Ge][pe][ht],it.Wc[ue][Ge].Yb[pe][ht]=St;for(Ge=0;17>Ge;++Ge)it.Xc[ue][Ge]=it.Wc[ue][Af[Ge]]}return D.kc=Wt(tt),D.kc&&(D.Bd=Ue(tt,8)),D.cb=1}function il(D,H,ue,pe,Ge,tt,it){var ht=H[Ge].Yb[ue];for(ue=0;16>Ge;++Ge){if(!Zt(D,ht[ue+0]))return Ge;for(;!Zt(D,ht[ue+1]);)if(ht=H[++Ge].Yb[0],ue=0,Ge==16)return 16;var dt=H[Ge+1].Yb;if(Zt(D,ht[ue+2])){var St=D,Yt=0;if(Zt(St,(Et=ht)[(pn=ue)+3]))if(Zt(St,Et[pn+6])){for(ht=0,pn=2*(Yt=Zt(St,Et[pn+8]))+(Et=Zt(St,Et[pn+9+Yt])),Yt=0,Et=Gh[pn];Et[ht];++ht)Yt+=Yt+Zt(St,Et[ht]);Yt+=3+(8<<pn)}else Zt(St,Et[pn+7])?(Yt=7+2*Zt(St,165),Yt+=Zt(St,145)):Yt=5+Zt(St,159);else Yt=Zt(St,Et[pn+4])?3+Zt(St,Et[pn+5]):2;ht=dt[2]}else Yt=1,ht=dt[1];dt=it+Da[Ge],0>(St=D).b&&Oe(St);var pn,Et=St.b,Qt=(pn=St.Ca>>1)-(St.I>>Et)>>31;--St.b,St.Ca+=Qt,St.Ca|=1,St.I-=(pn+1&Qt)<<Et,tt[dt]=((Yt^Qt)-Qt)*pe[(0<Ge)+0]}return 16}function Ga(D){var H=D.rb[D.sb-1];H.la=0,H.Na=0,a(D.zc,0,0,D.zc.length),D.ja=0}function ho(D,H,ue,pe,Ge){Ge=D[H+ue+32*pe]+(Ge>>3),D[H+ue+32*pe]=-256&Ge?0>Ge?0:255:Ge}function lr(D,H,ue,pe,Ge,tt){ho(D,H,0,ue,pe+Ge),ho(D,H,1,ue,pe+tt),ho(D,H,2,ue,pe-tt),ho(D,H,3,ue,pe-Ge)}function Wr(D){return(20091*D>>16)+D}function Ur(D,H,ue,pe){var Ge,tt=0,it=c(16);for(Ge=0;4>Ge;++Ge){var ht=D[H+0]+D[H+8],dt=D[H+0]-D[H+8],St=(35468*D[H+4]>>16)-Wr(D[H+12]),Yt=Wr(D[H+4])+(35468*D[H+12]>>16);it[tt+0]=ht+Yt,it[tt+1]=dt+St,it[tt+2]=dt-St,it[tt+3]=ht-Yt,tt+=4,H++}for(Ge=tt=0;4>Ge;++Ge)ht=(D=it[tt+0]+4)+it[tt+8],dt=D-it[tt+8],St=(35468*it[tt+4]>>16)-Wr(it[tt+12]),ho(ue,pe,0,0,ht+(Yt=Wr(it[tt+4])+(35468*it[tt+12]>>16))),ho(ue,pe,1,0,dt+St),ho(ue,pe,2,0,dt-St),ho(ue,pe,3,0,ht-Yt),tt++,pe+=32}function ca(D,H,ue,pe){var Ge=D[H+0]+4,tt=35468*D[H+4]>>16,it=Wr(D[H+4]),ht=35468*D[H+1]>>16;lr(ue,pe,0,Ge+it,D=Wr(D[H+1]),ht),lr(ue,pe,1,Ge+tt,D,ht),lr(ue,pe,2,Ge-tt,D,ht),lr(ue,pe,3,Ge-it,D,ht)}function $a(D,H,ue,pe,Ge){Ur(D,H,ue,pe),Ge&&Ur(D,H+16,ue,pe+4)}function Ri(D,H,ue,pe){d(D,H+0,ue,pe,1),d(D,H+32,ue,pe+128,1)}function Hi(D,H,ue,pe){var Ge;for(D=D[H+0]+4,Ge=0;4>Ge;++Ge)for(H=0;4>H;++H)ho(ue,pe,H,Ge,D)}function Tl(D,H,ue,pe){D[H+0]&&X(D,H+0,ue,pe),D[H+16]&&X(D,H+16,ue,pe+4),D[H+32]&&X(D,H+32,ue,pe+128),D[H+48]&&X(D,H+48,ue,pe+128+4)}function Wi(D,H,ue,pe){var Ge,tt=c(16);for(Ge=0;4>Ge;++Ge){var it=D[H+0+Ge]+D[H+12+Ge],ht=D[H+4+Ge]+D[H+8+Ge],dt=D[H+4+Ge]-D[H+8+Ge],St=D[H+0+Ge]-D[H+12+Ge];tt[0+Ge]=it+ht,tt[8+Ge]=it-ht,tt[4+Ge]=St+dt,tt[12+Ge]=St-dt}for(Ge=0;4>Ge;++Ge)it=(D=tt[0+4*Ge]+3)+tt[3+4*Ge],ht=tt[1+4*Ge]+tt[2+4*Ge],dt=tt[1+4*Ge]-tt[2+4*Ge],St=D-tt[3+4*Ge],ue[pe+0]=it+ht>>3,ue[pe+16]=St+dt>>3,ue[pe+32]=it-ht>>3,ue[pe+48]=St-dt>>3,pe+=64}function ko(D,H,ue){var pe,Ge=H-32,tt=ba,it=255-D[Ge-1];for(pe=0;pe<ue;++pe){var ht,dt=tt,St=it+D[H-1];for(ht=0;ht<ue;++ht)D[H+ht]=dt[St+D[Ge+ht]];H+=32}}function ss(D,H){ko(D,H,4)}function $u(D,H){ko(D,H,8)}function lu(D,H){ko(D,H,16)}function mu(D,H){var ue;for(ue=0;16>ue;++ue)i(D,H+32*ue,D,H-32,16)}function Us(D,H){var ue;for(ue=16;0<ue;--ue)a(D,H,D[H-1],16),H+=32}function Ha(D,H,ue){var pe;for(pe=0;16>pe;++pe)a(H,ue+32*pe,D,16)}function sl(D,H){var ue,pe=16;for(ue=0;16>ue;++ue)pe+=D[H-1+32*ue]+D[H+ue-32];Ha(pe>>5,D,H)}function Vo(D,H){var ue,pe=8;for(ue=0;16>ue;++ue)pe+=D[H-1+32*ue];Ha(pe>>4,D,H)}function Ei(D,H){var ue,pe=8;for(ue=0;16>ue;++ue)pe+=D[H+ue-32];Ha(pe>>4,D,H)}function bo(D,H){Ha(128,D,H)}function gi(D,H,ue){return D+2*H+ue+2>>2}function wo(D,H){var ue,pe=H-32;for(pe=new Uint8Array([gi(D[pe-1],D[pe+0],D[pe+1]),gi(D[pe+0],D[pe+1],D[pe+2]),gi(D[pe+1],D[pe+2],D[pe+3]),gi(D[pe+2],D[pe+3],D[pe+4])]),ue=0;4>ue;++ue)i(D,H+32*ue,pe,0,pe.length)}function Vs(D,H){var ue=D[H-1],pe=D[H-1+32],Ge=D[H-1+64],tt=D[H-1+96];Xt(D,H+0,16843009*gi(D[H-1-32],ue,pe)),Xt(D,H+32,16843009*gi(ue,pe,Ge)),Xt(D,H+64,16843009*gi(pe,Ge,tt)),Xt(D,H+96,16843009*gi(Ge,tt,tt))}function Nc(D,H){var ue,pe=4;for(ue=0;4>ue;++ue)pe+=D[H+ue-32]+D[H-1+32*ue];for(pe>>=3,ue=0;4>ue;++ue)a(D,H+32*ue,pe,4)}function Pu(D,H){var ue=D[H-1+0],pe=D[H-1+32],Ge=D[H-1+64],tt=D[H-1-32],it=D[H+0-32],ht=D[H+1-32],dt=D[H+2-32],St=D[H+3-32];D[H+0+96]=gi(pe,Ge,D[H-1+96]),D[H+1+96]=D[H+0+64]=gi(ue,pe,Ge),D[H+2+96]=D[H+1+64]=D[H+0+32]=gi(tt,ue,pe),D[H+3+96]=D[H+2+64]=D[H+1+32]=D[H+0+0]=gi(it,tt,ue),D[H+3+64]=D[H+2+32]=D[H+1+0]=gi(ht,it,tt),D[H+3+32]=D[H+2+0]=gi(dt,ht,it),D[H+3+0]=gi(St,dt,ht)}function Fs(D,H){var ue=D[H+1-32],pe=D[H+2-32],Ge=D[H+3-32],tt=D[H+4-32],it=D[H+5-32],ht=D[H+6-32],dt=D[H+7-32];D[H+0+0]=gi(D[H+0-32],ue,pe),D[H+1+0]=D[H+0+32]=gi(ue,pe,Ge),D[H+2+0]=D[H+1+32]=D[H+0+64]=gi(pe,Ge,tt),D[H+3+0]=D[H+2+32]=D[H+1+64]=D[H+0+96]=gi(Ge,tt,it),D[H+3+32]=D[H+2+64]=D[H+1+96]=gi(tt,it,ht),D[H+3+64]=D[H+2+96]=gi(it,ht,dt),D[H+3+96]=gi(ht,dt,dt)}function na(D,H){var ue=D[H-1+0],pe=D[H-1+32],Ge=D[H-1+64],tt=D[H-1-32],it=D[H+0-32],ht=D[H+1-32],dt=D[H+2-32],St=D[H+3-32];D[H+0+0]=D[H+1+64]=tt+it+1>>1,D[H+1+0]=D[H+2+64]=it+ht+1>>1,D[H+2+0]=D[H+3+64]=ht+dt+1>>1,D[H+3+0]=dt+St+1>>1,D[H+0+96]=gi(Ge,pe,ue),D[H+0+64]=gi(pe,ue,tt),D[H+0+32]=D[H+1+96]=gi(ue,tt,it),D[H+1+32]=D[H+2+96]=gi(tt,it,ht),D[H+2+32]=D[H+3+96]=gi(it,ht,dt),D[H+3+32]=gi(ht,dt,St)}function Es(D,H){var ue=D[H+0-32],pe=D[H+1-32],Ge=D[H+2-32],tt=D[H+3-32],it=D[H+4-32],ht=D[H+5-32],dt=D[H+6-32],St=D[H+7-32];D[H+0+0]=ue+pe+1>>1,D[H+1+0]=D[H+0+64]=pe+Ge+1>>1,D[H+2+0]=D[H+1+64]=Ge+tt+1>>1,D[H+3+0]=D[H+2+64]=tt+it+1>>1,D[H+0+32]=gi(ue,pe,Ge),D[H+1+32]=D[H+0+96]=gi(pe,Ge,tt),D[H+2+32]=D[H+1+96]=gi(Ge,tt,it),D[H+3+32]=D[H+2+96]=gi(tt,it,ht),D[H+3+64]=gi(it,ht,dt),D[H+3+96]=gi(ht,dt,St)}function xs(D,H){var ue=D[H-1+0],pe=D[H-1+32],Ge=D[H-1+64],tt=D[H-1+96];D[H+0+0]=ue+pe+1>>1,D[H+2+0]=D[H+0+32]=pe+Ge+1>>1,D[H+2+32]=D[H+0+64]=Ge+tt+1>>1,D[H+1+0]=gi(ue,pe,Ge),D[H+3+0]=D[H+1+32]=gi(pe,Ge,tt),D[H+3+32]=D[H+1+64]=gi(Ge,tt,tt),D[H+3+64]=D[H+2+64]=D[H+0+96]=D[H+1+96]=D[H+2+96]=D[H+3+96]=tt}function Ts(D,H){var ue=D[H-1+0],pe=D[H-1+32],Ge=D[H-1+64],tt=D[H-1+96],it=D[H-1-32],ht=D[H+0-32],dt=D[H+1-32],St=D[H+2-32];D[H+0+0]=D[H+2+32]=ue+it+1>>1,D[H+0+32]=D[H+2+64]=pe+ue+1>>1,D[H+0+64]=D[H+2+96]=Ge+pe+1>>1,D[H+0+96]=tt+Ge+1>>1,D[H+3+0]=gi(ht,dt,St),D[H+2+0]=gi(it,ht,dt),D[H+1+0]=D[H+3+32]=gi(ue,it,ht),D[H+1+32]=D[H+3+64]=gi(pe,ue,it),D[H+1+64]=D[H+3+96]=gi(Ge,pe,ue),D[H+1+96]=gi(tt,Ge,pe)}function Ol(D,H){var ue;for(ue=0;8>ue;++ue)i(D,H+32*ue,D,H-32,8)}function ha(D,H){var ue;for(ue=0;8>ue;++ue)a(D,H,D[H-1],8),H+=32}function ra(D,H,ue){var pe;for(pe=0;8>pe;++pe)a(H,ue+32*pe,D,8)}function os(D,H){var ue,pe=8;for(ue=0;8>ue;++ue)pe+=D[H+ue-32]+D[H-1+32*ue];ra(pe>>4,D,H)}function gu(D,H){var ue,pe=4;for(ue=0;8>ue;++ue)pe+=D[H+ue-32];ra(pe>>3,D,H)}function ro(D,H){var ue,pe=4;for(ue=0;8>ue;++ue)pe+=D[H-1+32*ue];ra(pe>>3,D,H)}function ya(D,H){ra(128,D,H)}function ol(D,H,ue){var pe=D[H-ue],Ge=D[H+0],tt=3*(Ge-pe)+Xa[1020+D[H-2*ue]-D[H+ue]],it=Ya[112+(tt+4>>3)];D[H-ue]=ba[255+pe+Ya[112+(tt+3>>3)]],D[H+0]=ba[255+Ge-it]}function Al(D,H,ue,pe){var Ge=D[H+0],tt=D[H+ue];return jl[255+D[H-2*ue]-D[H-ue]]>pe||jl[255+tt-Ge]>pe}function Nu(D,H,ue,pe){return 4*jl[255+D[H-ue]-D[H+0]]+jl[255+D[H-2*ue]-D[H+ue]]<=pe}function Na(D,H,ue,pe,Ge){var tt=D[H-3*ue],it=D[H-2*ue],ht=D[H-ue],dt=D[H+0],St=D[H+ue],Yt=D[H+2*ue],pn=D[H+3*ue];return 4*jl[255+ht-dt]+jl[255+it-St]>pe?0:jl[255+D[H-4*ue]-tt]<=Ge&&jl[255+tt-it]<=Ge&&jl[255+it-ht]<=Ge&&jl[255+pn-Yt]<=Ge&&jl[255+Yt-St]<=Ge&&jl[255+St-dt]<=Ge}function qo(D,H,ue,pe){var Ge=2*pe+1;for(pe=0;16>pe;++pe)Nu(D,H+pe,ue,Ge)&&ol(D,H+pe,ue)}function ji(D,H,ue,pe){var Ge=2*pe+1;for(pe=0;16>pe;++pe)Nu(D,H+pe*ue,1,Ge)&&ol(D,H+pe*ue,1)}function qs(D,H,ue,pe){var Ge;for(Ge=3;0<Ge;--Ge)qo(D,H+=4*ue,ue,pe)}function Lo(D,H,ue,pe){var Ge;for(Ge=3;0<Ge;--Ge)ji(D,H+=4,ue,pe)}function _a(D,H,ue,pe,Ge,tt,it,ht){for(tt=2*tt+1;0<Ge--;){if(Na(D,H,ue,tt,it))if(Al(D,H,ue,ht))ol(D,H,ue);else{var dt=D,St=H,Yt=ue,pn=dt[St-2*Yt],Et=dt[St-Yt],Qt=dt[St+0],gn=dt[St+Yt],Bn=dt[St+2*Yt],x=27*(m=Xa[1020+3*(Qt-Et)+Xa[1020+pn-gn]])+63>>7,l=18*m+63>>7,m=9*m+63>>7;dt[St-3*Yt]=ba[255+dt[St-3*Yt]+m],dt[St-2*Yt]=ba[255+pn+l],dt[St-Yt]=ba[255+Et+x],dt[St+0]=ba[255+Qt-x],dt[St+Yt]=ba[255+gn-l],dt[St+2*Yt]=ba[255+Bn-m]}H+=pe}}function zo(D,H,ue,pe,Ge,tt,it,ht){for(tt=2*tt+1;0<Ge--;){if(Na(D,H,ue,tt,it))if(Al(D,H,ue,ht))ol(D,H,ue);else{var dt=D,St=H,Yt=ue,pn=dt[St-Yt],Et=dt[St+0],Qt=dt[St+Yt],gn=Ya[112+(4+(Bn=3*(Et-pn))>>3)],Bn=Ya[112+(Bn+3>>3)],x=gn+1>>1;dt[St-2*Yt]=ba[255+dt[St-2*Yt]+x],dt[St-Yt]=ba[255+pn+Bn],dt[St+0]=ba[255+Et-gn],dt[St+Yt]=ba[255+Qt-x]}H+=pe}}function ml(D,H,ue,pe,Ge,tt){_a(D,H,ue,1,16,pe,Ge,tt)}function Po(D,H,ue,pe,Ge,tt){_a(D,H,1,ue,16,pe,Ge,tt)}function fa(D,H,ue,pe,Ge,tt){var it;for(it=3;0<it;--it)zo(D,H+=4*ue,ue,1,16,pe,Ge,tt)}function va(D,H,ue,pe,Ge,tt){var it;for(it=3;0<it;--it)zo(D,H+=4,1,ue,16,pe,Ge,tt)}function ee(D,H,ue,pe,Ge,tt,it,ht){_a(D,H,Ge,1,8,tt,it,ht),_a(ue,pe,Ge,1,8,tt,it,ht)}function je(D,H,ue,pe,Ge,tt,it,ht){_a(D,H,1,Ge,8,tt,it,ht),_a(ue,pe,1,Ge,8,tt,it,ht)}function At(D,H,ue,pe,Ge,tt,it,ht){zo(D,H+4*Ge,Ge,1,8,tt,it,ht),zo(ue,pe+4*Ge,Ge,1,8,tt,it,ht)}function kt(D,H,ue,pe,Ge,tt,it,ht){zo(D,H+4,1,Ge,8,tt,it,ht),zo(ue,pe+4,1,Ge,8,tt,it,ht)}function sn(){this.ba=new ze,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new wt,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function fn(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Qn(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Xr(){this.ua=0,this.Wa=new Fr,this.vb=new Fr,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new De,this.yc=new te}function Qr(){this.xb=this.a=0,this.l=new co,this.ca=new ze,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new We,this.Pb=0,this.wd=new We,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Xr,this.ab=0,this.gc=_(4,Qn),this.Oc=0}function oi(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new co,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Ui(D,H,ue,pe,Ge,tt,it){for(D=D==null?0:D[H+0],H=0;H<it;++H)Ge[tt+H]=D+ue[pe+H]&255,D=Ge[tt+H]}function Ps(D,H,ue,pe,Ge,tt,it){var ht;if(D==null)Ui(null,null,ue,pe,Ge,tt,it);else for(ht=0;ht<it;++ht)Ge[tt+ht]=D[H+ht]+ue[pe+ht]&255}function Bs(D,H,ue,pe,Ge,tt,it){if(D==null)Ui(null,null,ue,pe,Ge,tt,it);else{var ht,dt=D[H+0],St=dt,Yt=dt;for(ht=0;ht<it;++ht)St=Yt+(dt=D[H+ht])-St,Yt=ue[pe+ht]+(-256&St?0>St?0:255:St)&255,St=dt,Ge[tt+ht]=Yt}}function fo(D,H,ue,pe){var Ge=H.width,tt=H.o;if(e(D!=null&&H!=null),0>ue||0>=pe||ue+pe>tt)return null;if(!D.Cc){if(D.ga==null){var it;if(D.ga=new oi,(it=D.ga==null)||(it=H.width*H.o,e(D.Gb.length==0),D.Gb=c(it),D.Uc=0,D.Gb==null?it=0:(D.mb=D.Gb,D.nb=D.Uc,D.rc=null,it=1),it=!it),!it){it=D.ga;var ht=D.Fa,dt=D.P,St=D.qc,Yt=D.mb,pn=D.nb,Et=dt+1,Qt=St-1,gn=it.l;if(e(ht!=null&&Yt!=null&&H!=null),Cs[0]=null,Cs[1]=Ui,Cs[2]=Ps,Cs[3]=Bs,it.ca=Yt,it.tb=pn,it.c=H.width,it.i=H.height,e(0<it.c&&0<it.i),1>=St)H=0;else if(it.$a=3&ht[dt+0],it.Z=ht[dt+0]>>2&3,it.Lc=ht[dt+0]>>4&3,dt=ht[dt+0]>>6&3,0>it.$a||1<it.$a||4<=it.Z||1<it.Lc||dt)H=0;else if(gn.put=zt,gn.ac=Ot,gn.bc=Pn,gn.ma=it,gn.width=H.width,gn.height=H.height,gn.Da=H.Da,gn.v=H.v,gn.va=H.va,gn.j=H.j,gn.o=H.o,it.$a)e:{e(it.$a==1),H=xo();t:for(;;){if(H==null){H=0;break e}if(e(it!=null),it.mc=H,H.c=it.c,H.i=it.i,H.l=it.l,H.l.ma=it,H.l.width=it.c,H.l.height=it.i,H.a=0,He(H.m,ht,Et,Qt),!ua(it.c,it.i,1,H,null)||(H.ab==1&&H.gc[0].hc==3&&Os(H.s)?(it.ic=1,ht=H.c*H.i,H.Ta=null,H.Ua=0,H.V=c(ht),H.Ba=0,H.V==null?(H.a=1,H=0):H=1):(it.ic=0,H=tl(H,it.c)),!H))break t;H=1;break e}it.mc=null,H=0}else H=Qt>=it.c*it.i;it=!H}if(it)return null;D.ga.Lc!=1?D.Ga=0:pe=tt-ue}e(D.ga!=null),e(ue+pe<=tt);e:{if(H=(ht=D.ga).c,tt=ht.l.o,ht.$a==0){if(Et=D.rc,Qt=D.Vc,gn=D.Fa,dt=D.P+1+ue*H,St=D.mb,Yt=D.nb+ue*H,e(dt<=D.P+D.qc),ht.Z!=0)for(e(Cs[ht.Z]!=null),it=0;it<pe;++it)Cs[ht.Z](Et,Qt,gn,dt,St,Yt,H),Et=St,Qt=Yt,Yt+=H,dt+=H;else for(it=0;it<pe;++it)i(St,Yt,gn,dt,H),Et=St,Qt=Yt,Yt+=H,dt+=H;D.rc=Et,D.Vc=Qt}else{if(e(ht.mc!=null),H=ue+pe,e((it=ht.mc)!=null),e(H<=it.i),it.C>=H)H=1;else if(ht.ic||io(),ht.ic){ht=it.V,Et=it.Ba,Qt=it.c;var Bn=it.i,x=(gn=1,dt=it.$/Qt,St=it.$%Qt,Yt=it.m,pn=it.s,it.$),l=Qt*Bn,m=Qt*H,b=pn.wc,I=x<m?Br(pn,St,dt):null;e(x<=l),e(H<=Bn),e(Os(pn));t:for(;;){for(;!Yt.h&&x<m;){if(St&b||(I=Br(pn,St,dt)),e(I!=null),It(Yt),256>(Bn=Mr(I.G[0],I.H[0],Yt)))ht[Et+x]=Bn,++x,++St>=Qt&&(St=0,++dt<=H&&!(dt%16)&&ps(it,dt));else{if(!(280>Bn)){gn=0;break t}Bn=Fn(Bn-256,Yt);var P,j=Mr(I.G[4],I.H[4],Yt);if(It(Yt),!(x>=(j=Gr(Qt,j=Fn(j,Yt)))&&l-x>=Bn)){gn=0;break t}for(P=0;P<Bn;++P)ht[Et+x+P]=ht[Et+x+P-j];for(x+=Bn,St+=Bn;St>=Qt;)St-=Qt,++dt<=H&&!(dt%16)&&ps(it,dt);x<m&&St&b&&(I=Br(pn,St,dt))}e(Yt.h==ut(Yt))}ps(it,dt>H?H:dt);break t}!gn||Yt.h&&x<l?(gn=0,it.a=Yt.h?5:3):it.$=x,H=gn}else H=vo(it,it.V,it.Ba,it.c,it.i,H,Pa);if(!H){pe=0;break e}}ue+pe>=tt&&(D.Cc=1),pe=1}if(!pe)return null;if(D.Cc&&((pe=D.ga)!=null&&(pe.mc=null),D.ga=null,0<D.Ga))return alert("todo:WebPDequantizeLevels"),null}return D.nb+ue*Ge}function Ys(D,H,ue,pe,Ge,tt){for(;0<Ge--;){var it,ht=D,dt=H+(ue?1:0),St=D,Yt=H+(ue?0:3);for(it=0;it<pe;++it){var pn=St[Yt+4*it];pn!=255&&(pn*=32897,ht[dt+4*it+0]=ht[dt+4*it+0]*pn>>23,ht[dt+4*it+1]=ht[dt+4*it+1]*pn>>23,ht[dt+4*it+2]=ht[dt+4*it+2]*pn>>23)}H+=tt}}function Zs(D,H,ue,pe,Ge){for(;0<pe--;){var tt;for(tt=0;tt<ue;++tt){var it=D[H+2*tt+0],ht=15&(St=D[H+2*tt+1]),dt=4369*ht,St=(240&St|St>>4)*dt>>16;D[H+2*tt+0]=(240&it|it>>4)*dt>>16&240|(15&it|it<<4)*dt>>16>>4&15,D[H+2*tt+1]=240&St|ht}H+=Ge}}function go(D,H,ue,pe,Ge,tt,it,ht){var dt,St,Yt=255;for(St=0;St<Ge;++St){for(dt=0;dt<pe;++dt){var pn=D[H+dt];tt[it+4*dt]=pn,Yt&=pn}H+=ue,it+=ht}return Yt!=255}function Ns(D,H,ue,pe,Ge){var tt;for(tt=0;tt<Ge;++tt)ue[pe+tt]=D[H+tt]>>8}function io(){As=Ys,Xo=Zs,cl=go,Ma=Ns}function zs(D,H,ue){B[D]=function(pe,Ge,tt,it,ht,dt,St,Yt,pn,Et,Qt,gn,Bn,x,l,m,b){var I,P=b-1>>1,j=ht[dt+0]|St[Yt+0]<<16,W=pn[Et+0]|Qt[gn+0]<<16;e(pe!=null);var Z=3*j+W+131074>>2;for(H(pe[Ge+0],255&Z,Z>>16,Bn,x),tt!=null&&(Z=3*W+j+131074>>2,H(tt[it+0],255&Z,Z>>16,l,m)),I=1;I<=P;++I){var le=ht[dt+I]|St[Yt+I]<<16,ce=pn[Et+I]|Qt[gn+I]<<16,Ee=j+le+W+ce+524296,Fe=Ee+2*(le+W)>>3;Z=Fe+j>>1,j=(Ee=Ee+2*(j+ce)>>3)+le>>1,H(pe[Ge+2*I-1],255&Z,Z>>16,Bn,x+(2*I-1)*ue),H(pe[Ge+2*I-0],255&j,j>>16,Bn,x+(2*I-0)*ue),tt!=null&&(Z=Ee+W>>1,j=Fe+ce>>1,H(tt[it+2*I-1],255&Z,Z>>16,l,m+(2*I-1)*ue),H(tt[it+2*I+0],255&j,j>>16,l,m+(2*I+0)*ue)),j=le,W=ce}1&b||(Z=3*j+W+131074>>2,H(pe[Ge+b-1],255&Z,Z>>16,Bn,x+(b-1)*ue),tt!=null&&(Z=3*W+j+131074>>2,H(tt[it+b-1],255&Z,Z>>16,l,m+(b-1)*ue)))}}function Fl(){cu[Wu]=Hh,cu[Ka]=Vl,cu[kh]=_d,cu[ac]=yl,cu[Dr]=Xu,cu[Is]=cf,cu[Ql]=Ph,cu[vc]=Vl,cu[Mu]=yl,cu[xc]=Xu,cu[bc]=cf}function gl(D){return D&-16384?0>D?0:255:D>>Ou}function O(D,H){return gl((19077*D>>8)+(26149*H>>8)-14234)}function me(D,H,ue){return gl((19077*D>>8)-(6419*H>>8)-(13320*ue>>8)+8708)}function ke(D,H){return gl((19077*D>>8)+(33050*H>>8)-17685)}function nt(D,H,ue,pe,Ge){pe[Ge+0]=O(D,ue),pe[Ge+1]=me(D,H,ue),pe[Ge+2]=ke(D,H)}function hn(D,H,ue,pe,Ge){pe[Ge+0]=ke(D,H),pe[Ge+1]=me(D,H,ue),pe[Ge+2]=O(D,ue)}function Cn(D,H,ue,pe,Ge){var tt=me(D,H,ue);H=tt<<3&224|ke(D,H)>>3,pe[Ge+0]=248&O(D,ue)|tt>>5,pe[Ge+1]=H}function Sr(D,H,ue,pe,Ge){var tt=240&ke(D,H)|15;pe[Ge+0]=240&O(D,ue)|me(D,H,ue)>>4,pe[Ge+1]=tt}function Rs(D,H,ue,pe,Ge){pe[Ge+0]=255,nt(D,H,ue,pe,Ge+1)}function so(D,H,ue,pe,Ge){hn(D,H,ue,pe,Ge),pe[Ge+3]=255}function hs(D,H,ue,pe,Ge){nt(D,H,ue,pe,Ge),pe[Ge+3]=255}function es(D,H){return 0>D?0:D>H?H:D}function Js(D,H,ue){B[D]=function(pe,Ge,tt,it,ht,dt,St,Yt,pn){for(var Et=Yt+(-2&pn)*ue;Yt!=Et;)H(pe[Ge+0],tt[it+0],ht[dt+0],St,Yt),H(pe[Ge+1],tt[it+0],ht[dt+0],St,Yt+ue),Ge+=2,++it,++dt,Yt+=2*ue;1&pn&&H(pe[Ge+0],tt[it+0],ht[dt+0],St,Yt)}}function da(D,H,ue){return ue==0?D==0?H==0?6:5:H==0?4:0:ue}function oo(D,H,ue,pe,Ge){switch(D>>>30){case 3:d(H,ue,pe,Ge,0);break;case 2:S(H,ue,pe,Ge);break;case 1:X(H,ue,pe,Ge)}}function Vi(D,H){var ue,pe,Ge=H.M,tt=H.Nb,it=D.oc,ht=D.pc+40,dt=D.oc,St=D.pc+584,Yt=D.oc,pn=D.pc+600;for(ue=0;16>ue;++ue)it[ht+32*ue-1]=129;for(ue=0;8>ue;++ue)dt[St+32*ue-1]=129,Yt[pn+32*ue-1]=129;for(0<Ge?it[ht-1-32]=dt[St-1-32]=Yt[pn-1-32]=129:(a(it,ht-32-1,127,21),a(dt,St-32-1,127,9),a(Yt,pn-32-1,127,9)),pe=0;pe<D.za;++pe){var Et=H.ya[H.aa+pe];if(0<pe){for(ue=-1;16>ue;++ue)i(it,ht+32*ue-4,it,ht+32*ue+12,4);for(ue=-1;8>ue;++ue)i(dt,St+32*ue-4,dt,St+32*ue+4,4),i(Yt,pn+32*ue-4,Yt,pn+32*ue+4,4)}var Qt=D.Gd,gn=D.Hd+pe,Bn=Et.ad,x=Et.Hc;if(0<Ge&&(i(it,ht-32,Qt[gn].y,0,16),i(dt,St-32,Qt[gn].f,0,8),i(Yt,pn-32,Qt[gn].ea,0,8)),Et.Za){var l=it,m=ht-32+16;for(0<Ge&&(pe>=D.za-1?a(l,m,Qt[gn].y[15],4):i(l,m,Qt[gn+1].y,0,4)),ue=0;4>ue;ue++)l[m+128+ue]=l[m+256+ue]=l[m+384+ue]=l[m+0+ue];for(ue=0;16>ue;++ue,x<<=2)l=it,m=ht+xu[ue],as[Et.Ob[ue]](l,m),oo(x,Bn,16*+ue,l,m)}else if(l=da(pe,Ge,Et.Ob[0]),Il[l](it,ht),x!=0)for(ue=0;16>ue;++ue,x<<=2)oo(x,Bn,16*+ue,it,ht+xu[ue]);for(ue=Et.Gc,l=da(pe,Ge,Et.Dd),Ja[l](dt,St),Ja[l](Yt,pn),x=Bn,l=dt,m=St,255&(Et=0|ue)&&(170&Et?N(x,256,l,m):he(x,256,l,m)),Et=Yt,x=pn,255&(ue>>=8)&&(170&ue?N(Bn,320,Et,x):he(Bn,320,Et,x)),Ge<D.Ub-1&&(i(Qt[gn].y,0,it,ht+480,16),i(Qt[gn].f,0,dt,St+224,8),i(Qt[gn].ea,0,Yt,pn+224,8)),ue=8*tt*D.B,Qt=D.sa,gn=D.ta+16*pe+16*tt*D.R,Bn=D.qa,Et=D.ra+8*pe+ue,x=D.Ha,l=D.Ia+8*pe+ue,ue=0;16>ue;++ue)i(Qt,gn+ue*D.R,it,ht+32*ue,16);for(ue=0;8>ue;++ue)i(Bn,Et+ue*D.B,dt,St+32*ue,8),i(x,l+ue*D.B,Yt,pn+32*ue,8)}}function Zl(D,H,ue,pe,Ge,tt,it,ht,dt){var St=[0],Yt=[0],pn=0,Et=dt!=null?dt.kd:0,Qt=dt??new fn;if(D==null||12>ue)return 7;Qt.data=D,Qt.w=H,Qt.ha=ue,H=[H],ue=[ue],Qt.gb=[Qt.gb];e:{var gn=H,Bn=ue,x=Qt.gb;if(e(D!=null),e(Bn!=null),e(x!=null),x[0]=0,12<=Bn[0]&&!t(D,gn[0],"RIFF")){if(t(D,gn[0]+8,"WEBP")){x=3;break e}var l=on(D,gn[0]+4);if(12>l||4294967286<l){x=3;break e}if(Et&&l>Bn[0]-8){x=7;break e}x[0]=l,gn[0]+=12,Bn[0]-=12}x=0}if(x!=0)return x;for(l=0<Qt.gb[0],ue=ue[0];;){e:{var m=D;Bn=H,x=ue;var b=St,I=Yt,P=gn=[0];if((Z=pn=[pn])[0]=0,8>x[0])x=7;else{if(!t(m,Bn[0],"VP8X")){if(on(m,Bn[0]+4)!=10){x=3;break e}if(18>x[0]){x=7;break e}var j=on(m,Bn[0]+8),W=1+zn(m,Bn[0]+12);if(2147483648<=W*(m=1+zn(m,Bn[0]+15))){x=3;break e}P!=null&&(P[0]=j),b!=null&&(b[0]=W),I!=null&&(I[0]=m),Bn[0]+=18,x[0]-=18,Z[0]=1}x=0}}if(pn=pn[0],gn=gn[0],x!=0)return x;if(Bn=!!(2&gn),!l&&pn)return 3;if(tt!=null&&(tt[0]=!!(16&gn)),it!=null&&(it[0]=Bn),ht!=null&&(ht[0]=0),it=St[0],gn=Yt[0],pn&&Bn&&dt==null){x=0;break}if(4>ue){x=7;break}if(l&&pn||!l&&!pn&&!t(D,H[0],"ALPH")){ue=[ue],Qt.na=[Qt.na],Qt.P=[Qt.P],Qt.Sa=[Qt.Sa];e:{j=D,x=H,l=ue;var Z=Qt.gb;b=Qt.na,I=Qt.P,P=Qt.Sa,W=22,e(j!=null),e(l!=null),m=x[0];var le=l[0];for(e(b!=null),e(P!=null),b[0]=null,I[0]=null,P[0]=0;;){if(x[0]=m,l[0]=le,8>le){x=7;break e}var ce=on(j,m+4);if(4294967286<ce){x=3;break e}var Ee=8+ce+1&-2;if(W+=Ee,0<Z&&W>Z){x=3;break e}if(!t(j,m,"VP8 ")||!t(j,m,"VP8L")){x=0;break e}if(le[0]<Ee){x=7;break e}t(j,m,"ALPH")||(b[0]=j,I[0]=m+8,P[0]=ce),m+=Ee,le-=Ee}}if(ue=ue[0],Qt.na=Qt.na[0],Qt.P=Qt.P[0],Qt.Sa=Qt.Sa[0],x!=0)break}ue=[ue],Qt.Ja=[Qt.Ja],Qt.xa=[Qt.xa];e:if(Z=D,x=H,l=ue,b=Qt.gb[0],I=Qt.Ja,P=Qt.xa,j=x[0],m=!t(Z,j,"VP8 "),W=!t(Z,j,"VP8L"),e(Z!=null),e(l!=null),e(I!=null),e(P!=null),8>l[0])x=7;else{if(m||W){if(Z=on(Z,j+4),12<=b&&Z>b-12){x=3;break e}if(Et&&Z>l[0]-8){x=7;break e}I[0]=Z,x[0]+=8,l[0]-=8,P[0]=W}else P[0]=5<=l[0]&&Z[j+0]==47&&!(Z[j+4]>>5),I[0]=l[0];x=0}if(ue=ue[0],Qt.Ja=Qt.Ja[0],Qt.xa=Qt.xa[0],H=H[0],x!=0)break;if(4294967286<Qt.Ja)return 3;if(ht==null||Bn||(ht[0]=Qt.xa?2:1),it=[it],gn=[gn],Qt.xa){if(5>ue){x=7;break}ht=it,Et=gn,Bn=tt,D==null||5>ue?D=0:5<=ue&&D[H+0]==47&&!(D[H+4]>>5)?(l=[0],Z=[0],b=[0],He(I=new We,D,H,ue),Jn(I,l,Z,b)?(ht!=null&&(ht[0]=l[0]),Et!=null&&(Et[0]=Z[0]),Bn!=null&&(Bn[0]=b[0]),D=1):D=0):D=0}else{if(10>ue){x=7;break}ht=gn,D==null||10>ue||!ic(D,H+3,ue-3)?D=0:(Et=D[H+0]|D[H+1]<<8|D[H+2]<<16,Bn=16383&(D[H+7]<<8|D[H+6]),D=16383&(D[H+9]<<8|D[H+8]),1&Et||3<(Et>>1&7)||!(Et>>4&1)||Et>>5>=Qt.Ja||!Bn||!D?D=0:(it&&(it[0]=Bn),ht&&(ht[0]=D),D=1))}if(!D||(it=it[0],gn=gn[0],pn&&(St[0]!=it||Yt[0]!=gn)))return 3;dt!=null&&(dt[0]=Qt,dt.offset=H-dt.w,e(4294967286>H-dt.w),e(dt.offset==dt.ha-ue));break}return x==0||x==7&&pn&&dt==null?(tt!=null&&(tt[0]|=Qt.na!=null&&0<Qt.na.length),pe!=null&&(pe[0]=it),Ge!=null&&(Ge[0]=gn),0):x}function xa(D,H,ue){var pe=H.width,Ge=H.height,tt=0,it=0,ht=pe,dt=Ge;if(H.Da=D!=null&&0<D.Da,H.Da&&(ht=D.cd,dt=D.bd,tt=D.v,it=D.j,11>ue||(tt&=-2,it&=-2),0>tt||0>it||0>=ht||0>=dt||tt+ht>pe||it+dt>Ge))return 0;if(H.v=tt,H.j=it,H.va=tt+ht,H.o=it+dt,H.U=ht,H.T=dt,H.da=D!=null&&0<D.da,H.da){if(!qr(ht,dt,ue=[D.ib],tt=[D.hb]))return 0;H.ib=ue[0],H.hb=tt[0]}return H.ob=D!=null&&D.ob,H.Kb=D==null||!D.Sd,H.da&&(H.ob=H.ib<3*pe/4&&H.hb<3*Ge/4,H.Kb=0),1}function Rc(D){if(D==null)return 2;if(11>D.S){var H=D.f.RGBA;H.fb+=(D.height-1)*H.A,H.A=-H.A}else H=D.f.kb,D=D.height,H.O+=(D-1)*H.fa,H.fa=-H.fa,H.N+=(D-1>>1)*H.Ab,H.Ab=-H.Ab,H.W+=(D-1>>1)*H.Db,H.Db=-H.Db,H.F!=null&&(H.J+=(D-1)*H.lb,H.lb=-H.lb);return 0}function Ru(D,H,ue,pe){if(pe==null||0>=D||0>=H)return 2;if(ue!=null){if(ue.Da){var Ge=ue.cd,tt=ue.bd,it=-2&ue.v,ht=-2&ue.j;if(0>it||0>ht||0>=Ge||0>=tt||it+Ge>D||ht+tt>H)return 2;D=Ge,H=tt}if(ue.da){if(!qr(D,H,Ge=[ue.ib],tt=[ue.hb]))return 2;D=Ge[0],H=tt[0]}}pe.width=D,pe.height=H;e:{var dt=pe.width,St=pe.height;if(D=pe.S,0>=dt||0>=St||!(D>=Wu&&13>D))D=2;else{if(0>=pe.Rd&&pe.sd==null){it=tt=Ge=H=0;var Yt=(ht=dt*hh[D])*St;if(11>D||(tt=(St+1)/2*(H=(dt+1)/2),D==12&&(it=(Ge=dt)*St)),(St=c(Yt+2*tt+it))==null){D=1;break e}pe.sd=St,11>D?((dt=pe.f.RGBA).eb=St,dt.fb=0,dt.A=ht,dt.size=Yt):((dt=pe.f.kb).y=St,dt.O=0,dt.fa=ht,dt.Fd=Yt,dt.f=St,dt.N=0+Yt,dt.Ab=H,dt.Cd=tt,dt.ea=St,dt.W=0+Yt+tt,dt.Db=H,dt.Ed=tt,D==12&&(dt.F=St,dt.J=0+Yt+2*tt),dt.Tc=it,dt.lb=Ge)}if(H=1,Ge=pe.S,tt=pe.width,it=pe.height,Ge>=Wu&&13>Ge)if(11>Ge)D=pe.f.RGBA,H&=(ht=Math.abs(D.A))*(it-1)+tt<=D.size,H&=ht>=tt*hh[Ge],H&=D.eb!=null;else{D=pe.f.kb,ht=(tt+1)/2,Yt=(it+1)/2,dt=Math.abs(D.fa),St=Math.abs(D.Ab);var pn=Math.abs(D.Db),Et=Math.abs(D.lb),Qt=Et*(it-1)+tt;H&=dt*(it-1)+tt<=D.Fd,H&=St*(Yt-1)+ht<=D.Cd,H=(H&=pn*(Yt-1)+ht<=D.Ed)&dt>=tt&St>=ht&pn>=ht,H&=D.y!=null,H&=D.f!=null,H&=D.ea!=null,Ge==12&&(H&=Et>=tt,H&=Qt<=D.Tc,H&=D.F!=null)}else H=0;D=H?0:2}}return D!=0||ue!=null&&ue.fd&&(D=Rc(pe)),D}var yu=64,Wa=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],al=24,Hu=32,yo=8,ia=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];dr("Predictor0","PredictorAdd0"),B.Predictor0=function(){return 4278190080},B.Predictor1=function(D){return D},B.Predictor2=function(D,H,ue){return H[ue+0]},B.Predictor3=function(D,H,ue){return H[ue+1]},B.Predictor4=function(D,H,ue){return H[ue-1]},B.Predictor5=function(D,H,ue){return nn(nn(D,H[ue+1]),H[ue+0])},B.Predictor6=function(D,H,ue){return nn(D,H[ue-1])},B.Predictor7=function(D,H,ue){return nn(D,H[ue+0])},B.Predictor8=function(D,H,ue){return nn(H[ue-1],H[ue+0])},B.Predictor9=function(D,H,ue){return nn(H[ue+0],H[ue+1])},B.Predictor10=function(D,H,ue){return nn(nn(D,H[ue-1]),nn(H[ue+0],H[ue+1]))},B.Predictor11=function(D,H,ue){var pe=H[ue+0];return 0>=Zn(pe>>24&255,D>>24&255,(H=H[ue-1])>>24&255)+Zn(pe>>16&255,D>>16&255,H>>16&255)+Zn(pe>>8&255,D>>8&255,H>>8&255)+Zn(255&pe,255&D,255&H)?pe:D},B.Predictor12=function(D,H,ue){var pe=H[ue+0];return(yn((D>>24&255)+(pe>>24&255)-((H=H[ue-1])>>24&255))<<24|yn((D>>16&255)+(pe>>16&255)-(H>>16&255))<<16|yn((D>>8&255)+(pe>>8&255)-(H>>8&255))<<8|yn((255&D)+(255&pe)-(255&H)))>>>0},B.Predictor13=function(D,H,ue){var pe=H[ue-1];return(sr((D=nn(D,H[ue+0]))>>24&255,pe>>24&255)<<24|sr(D>>16&255,pe>>16&255)<<16|sr(D>>8&255,pe>>8&255)<<8|sr(255&D,255&pe))>>>0};var ll=B.PredictorAdd0;B.PredictorAdd1=$r,dr("Predictor2","PredictorAdd2"),dr("Predictor3","PredictorAdd3"),dr("Predictor4","PredictorAdd4"),dr("Predictor5","PredictorAdd5"),dr("Predictor6","PredictorAdd6"),dr("Predictor7","PredictorAdd7"),dr("Predictor8","PredictorAdd8"),dr("Predictor9","PredictorAdd9"),dr("Predictor10","PredictorAdd10"),dr("Predictor11","PredictorAdd11"),dr("Predictor12","PredictorAdd12"),dr("Predictor13","PredictorAdd13");var Bl=B.PredictorAdd2;Xn("ColorIndexInverseTransform","MapARGB","32b",function(D){return D>>8&255},function(D){return D}),Xn("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(D){return D},function(D){return D>>8&255});var No,po=B.ColorIndexInverseTransform,Ra=B.MapARGB,sa=B.VP8LColorIndexInverseTransformAlpha,sc=B.MapAlpha,_u=B.VP8LPredictorsAdd=[];_u.length=16,(B.VP8LPredictors=[]).length=16,(B.VP8LPredictorsAdd_C=[]).length=16,(B.VP8LPredictors_C=[]).length=16;var zl,ul,Jl,jo,oa,E,f,d,S,N,X,he,Ae,Ye,bt,an,mn,Kn,Pr,Yr,yi,Ms,Xi,Ds,As,Xo,cl,Ma,Go=c(511),_c=c(2041),ri=c(225),gs=c(767),oc=0,Xa=_c,Ya=ri,ba=gs,jl=Go,Wu=0,Ka=1,kh=2,ac=3,Dr=4,Is=5,Ql=6,vc=7,Mu=8,xc=9,bc=10,jn=[2,3,7],pa=[3,3,11],Co=[280,256,256,256,40],uu=[0,1,1,1,0],hl=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Ji=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Za=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],qh=8,Lh=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Si=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Mc=null,Gh=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Da=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Ul=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],$h=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],lc=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Hc=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Af=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Il=[],as=[],Ja=[],Cl=1,wc=2,Cs=[],cu=[];zs("UpsampleRgbLinePair",nt,3),zs("UpsampleBgrLinePair",hn,3),zs("UpsampleRgbaLinePair",hs,4),zs("UpsampleBgraLinePair",so,4),zs("UpsampleArgbLinePair",Rs,4),zs("UpsampleRgba4444LinePair",Sr,2),zs("UpsampleRgb565LinePair",Cn,2);var Hh=B.UpsampleRgbLinePair,_d=B.UpsampleBgrLinePair,Vl=B.UpsampleRgbaLinePair,yl=B.UpsampleBgraLinePair,Xu=B.UpsampleArgbLinePair,cf=B.UpsampleRgba4444LinePair,Ph=B.UpsampleRgb565LinePair,kl=16,Du=1<<kl-1,So=-227,fs=482,Ou=6,ql=0,vu=c(256),uh=c(256),_l=c(256),vl=c(256),hf=c(fs-So),Fu=c(fs-So);Js("YuvToRgbRow",nt,3),Js("YuvToBgrRow",hn,3),Js("YuvToRgbaRow",hs,4),Js("YuvToBgraRow",so,4),Js("YuvToArgbRow",Rs,4),Js("YuvToRgba4444Row",Sr,2),Js("YuvToRgb565Row",Cn,2);var xu=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],hu=[0,2,8],ch=[8,7,6,4,4,2,2,2,1,1,1,1],Cr=1;this.WebPDecodeRGBA=function(D,H,ue,pe,Ge){var tt=Ka,it=new sn,ht=new ze;it.ba=ht,ht.S=tt,ht.width=[ht.width],ht.height=[ht.height];var dt=ht.width,St=ht.height,Yt=new ft;if(Yt==null||D==null)var pn=2;else e(Yt!=null),pn=Zl(D,H,ue,Yt.width,Yt.height,Yt.Pd,Yt.Qd,Yt.format,null);if(pn!=0?dt=0:(dt!=null&&(dt[0]=Yt.width[0]),St!=null&&(St[0]=Yt.height[0]),dt=1),dt){ht.width=ht.width[0],ht.height=ht.height[0],pe!=null&&(pe[0]=ht.width),Ge!=null&&(Ge[0]=ht.height);e:{if(pe=new co,(Ge=new fn).data=D,Ge.w=H,Ge.ha=ue,Ge.kd=1,H=[0],e(Ge!=null),((D=Zl(Ge.data,Ge.w,Ge.ha,null,null,null,H,null,Ge))==0||D==7)&&H[0]&&(D=4),(H=D)==0){if(e(it!=null),pe.data=Ge.data,pe.w=Ge.w+Ge.offset,pe.ha=Ge.ha-Ge.offset,pe.put=zt,pe.ac=Ot,pe.bc=Pn,pe.ma=it,Ge.xa){if((D=xo())==null){it=1;break e}if((function(Et,Qt){var gn=[0],Bn=[0],x=[0];t:for(;;){if(Et==null)return 0;if(Qt==null)return Et.a=2,0;if(Et.l=Qt,Et.a=0,He(Et.m,Qt.data,Qt.w,Qt.ha),!Jn(Et.m,gn,Bn,x)){Et.a=3;break t}if(Et.xb=wc,Qt.width=gn[0],Qt.height=Bn[0],!ua(gn[0],Bn[0],1,Et,null))break t;return 1}return e(Et.a!=0),0})(D,pe)){if(pe=(H=Ru(pe.width,pe.height,it.Oa,it.ba))==0){t:{pe=D;n:for(;;){if(pe==null){pe=0;break t}if(e(pe.s.yc!=null),e(pe.s.Ya!=null),e(0<pe.s.Wb),e((ue=pe.l)!=null),e((Ge=ue.ma)!=null),pe.xb!=0){if(pe.ca=Ge.ba,pe.tb=Ge.tb,e(pe.ca!=null),!xa(Ge.Oa,ue,ac)){pe.a=2;break n}if(!tl(pe,ue.width)||ue.da)break n;if((ue.da||si(pe.ca.S))&&io(),11>pe.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),pe.ca.f.kb.F!=null&&io()),pe.Pb&&0<pe.s.ua&&pe.s.vb.X==null&&!mt(pe.s.vb,pe.s.Wa.Xa)){pe.a=1;break n}pe.xb=0}if(!vo(pe,pe.V,pe.Ba,pe.c,pe.i,ue.o,ms))break n;Ge.Dc=pe.Ma,pe=1;break t}e(pe.a!=0),pe=0}pe=!pe}pe&&(H=D.a)}else H=D.a}else{if((D=new Io)==null){it=1;break e}if(D.Fa=Ge.na,D.P=Ge.P,D.qc=Ge.Sa,rl(D,pe)){if((H=Ru(pe.width,pe.height,it.Oa,it.ba))==0){if(D.Aa=0,ue=it.Oa,e((Ge=D)!=null),ue!=null){if(0<(dt=0>(dt=ue.Md)?0:100<dt?255:255*dt/100)){for(St=Yt=0;4>St;++St)12>(pn=Ge.pb[St]).lc&&(pn.ia=dt*ch[0>pn.lc?0:pn.lc]>>3),Yt|=pn.ia;Yt&&(alert("todo:VP8InitRandom"),Ge.ia=1)}Ge.Ga=ue.Id,100<Ge.Ga?Ge.Ga=100:0>Ge.Ga&&(Ge.Ga=0)}(function(Et,Qt){if(Et==null)return 0;if(Qt==null)return Ni(Et,2,"NULL VP8Io parameter in VP8Decode().");if(!Et.cb&&!rl(Et,Qt))return 0;if(e(Et.cb),Qt.ac==null||Qt.ac(Qt)){Qt.ob&&(Et.L=0);var gn=hu[Et.L];if(Et.L==2?(Et.yb=0,Et.zb=0):(Et.yb=Qt.v-gn>>4,Et.zb=Qt.j-gn>>4,0>Et.yb&&(Et.yb=0),0>Et.zb&&(Et.zb=0)),Et.Va=Qt.o+15+gn>>4,Et.Hb=Qt.va+15+gn>>4,Et.Hb>Et.za&&(Et.Hb=Et.za),Et.Va>Et.Ub&&(Et.Va=Et.Ub),0<Et.L){var Bn=Et.ed;for(gn=0;4>gn;++gn){var x;if(Et.Qa.Cb){var l=Et.Qa.Lb[gn];Et.Qa.Fb||(l+=Bn.Tb)}else l=Bn.Tb;for(x=0;1>=x;++x){var m=Et.gd[gn][x],b=l;if(Bn.Pc&&(b+=Bn.vd[0],x&&(b+=Bn.od[0])),0<(b=0>b?0:63<b?63:b)){var I=b;0<Bn.wb&&(I=4<Bn.wb?I>>2:I>>1)>9-Bn.wb&&(I=9-Bn.wb),1>I&&(I=1),m.dd=I,m.tc=2*b+I,m.ld=40<=b?2:15<=b?1:0}else m.tc=0;m.La=x}}}gn=0}else Ni(Et,6,"Frame setup failed"),gn=Et.a;if(gn=gn==0){if(gn){Et.$c=0,0<Et.Aa||(Et.Ic=Cr);t:{gn=Et.Ic,Bn=4*(I=Et.za);var P=32*I,j=I+1,W=0<Et.L?I*(0<Et.Aa?2:1):0,Z=(Et.Aa==2?2:1)*I;if((m=Bn+832+(x=3*(16*gn+hu[Et.L])/2*P)+(l=Et.Fa!=null&&0<Et.Fa.length?Et.Kc.c*Et.Kc.i:0))!=m)gn=0;else{if(m>Et.Vb){if(Et.Vb=0,Et.Ec=c(m),Et.Fc=0,Et.Ec==null){gn=Ni(Et,1,"no memory during frame initialization.");break t}Et.Vb=m}m=Et.Ec,b=Et.Fc,Et.Ac=m,Et.Bc=b,b+=Bn,Et.Gd=_(P,ta),Et.Hd=0,Et.rb=_(j+1,nl),Et.sb=1,Et.wa=W?_(W,uo):null,Et.Y=0,Et.D.Nb=0,Et.D.wa=Et.wa,Et.D.Y=Et.Y,0<Et.Aa&&(Et.D.Y+=I),e(!0),Et.oc=m,Et.pc=b,b+=832,Et.ya=_(Z,ea),Et.aa=0,Et.D.ya=Et.ya,Et.D.aa=Et.aa,Et.Aa==2&&(Et.D.aa+=I),Et.R=16*I,Et.B=8*I,I=(P=hu[Et.L])*Et.R,P=P/2*Et.B,Et.sa=m,Et.ta=b+I,Et.qa=Et.sa,Et.ra=Et.ta+16*gn*Et.R+P,Et.Ha=Et.qa,Et.Ia=Et.ra+8*gn*Et.B+P,Et.$c=0,b+=x,Et.mb=l?m:null,Et.nb=l?b:null,e(b+l<=Et.Fc+Et.Vb),Ga(Et),a(Et.Ac,Et.Bc,0,Bn),gn=1}}if(gn){if(Qt.ka=0,Qt.y=Et.sa,Qt.O=Et.ta,Qt.f=Et.qa,Qt.N=Et.ra,Qt.ea=Et.Ha,Qt.Vd=Et.Ia,Qt.fa=Et.R,Qt.Rc=Et.B,Qt.F=null,Qt.J=0,!oc){for(gn=-255;255>=gn;++gn)Go[255+gn]=0>gn?-gn:gn;for(gn=-1020;1020>=gn;++gn)_c[1020+gn]=-128>gn?-128:127<gn?127:gn;for(gn=-112;112>=gn;++gn)ri[112+gn]=-16>gn?-16:15<gn?15:gn;for(gn=-255;510>=gn;++gn)gs[255+gn]=0>gn?0:255<gn?255:gn;oc=1}f=Wi,d=$a,N=Ri,X=Hi,he=Tl,S=ca,Ae=ml,Ye=Po,bt=ee,an=je,mn=fa,Kn=va,Pr=At,Yr=kt,yi=qo,Ms=ji,Xi=qs,Ds=Lo,as[0]=Nc,as[1]=ss,as[2]=wo,as[3]=Vs,as[4]=Pu,as[5]=na,as[6]=Fs,as[7]=Es,as[8]=Ts,as[9]=xs,Il[0]=sl,Il[1]=lu,Il[2]=mu,Il[3]=Us,Il[4]=Vo,Il[5]=Ei,Il[6]=bo,Ja[0]=os,Ja[1]=$u,Ja[2]=Ol,Ja[3]=ha,Ja[4]=ro,Ja[5]=gu,Ja[6]=ya,gn=1}else gn=0}gn&&(gn=(function(le,ce){for(le.M=0;le.M<le.Va;++le.M){var Ee,Fe=le.Jc[le.M&le.Xb],qe=le.m,at=le;for(Ee=0;Ee<at.za;++Ee){var et=qe,lt=at,Ie=lt.Ac,rt=lt.Bc+4*Ee,gt=lt.zc,yt=lt.ya[lt.aa+Ee];if(lt.Qa.Bb?yt.$b=Zt(et,lt.Pa.jb[0])?2+Zt(et,lt.Pa.jb[2]):Zt(et,lt.Pa.jb[1]):yt.$b=0,lt.kc&&(yt.Ad=Zt(et,lt.Bd)),yt.Za=!Zt(et,145)+0,yt.Za){var Mt=yt.Ob,Dt=0;for(lt=0;4>lt;++lt){var Nt,qt=gt[0+lt];for(Nt=0;4>Nt;++Nt){qt=lc[Ie[rt+Nt]][qt];for(var Bt=Ul[Zt(et,qt[0])];0<Bt;)Bt=Ul[2*Bt+Zt(et,qt[Bt])];qt=-Bt,Ie[rt+Nt]=qt}i(Mt,Dt,Ie,rt,4),Dt+=4,gt[0+lt]=qt}}else qt=Zt(et,156)?Zt(et,128)?1:3:Zt(et,163)?2:0,yt.Ob[0]=qt,a(Ie,rt,qt,4),a(gt,0,qt,4);yt.Dd=Zt(et,142)?Zt(et,114)?Zt(et,183)?1:3:2:0}if(at.m.Ka)return Ni(le,7,"Premature end-of-partition0 encountered.");for(;le.ja<le.za;++le.ja){if(at=Fe,et=(qe=le).rb[qe.sb-1],Ie=qe.rb[qe.sb+qe.ja],Ee=qe.ya[qe.aa+qe.ja],rt=qe.kc?Ee.Ad:0)et.la=Ie.la=0,Ee.Za||(et.Na=Ie.Na=0),Ee.Hc=0,Ee.Gc=0,Ee.ia=0;else{var rn,Rn;if(et=Ie,Ie=at,rt=qe.Pa.Xc,gt=qe.ya[qe.aa+qe.ja],yt=qe.pb[gt.$b],lt=gt.ad,Mt=0,Dt=qe.rb[qe.sb-1],qt=Nt=0,a(lt,Mt,0,384),gt.Za)var Jt=0,An=rt[3];else{Bt=c(16);var cn=et.Na+Dt.Na;if(cn=Mc(Ie,rt[1],cn,yt.Eb,0,Bt,0),et.Na=Dt.Na=(0<cn)+0,1<cn)f(Bt,0,lt,Mt);else{var Vn=Bt[0]+3>>3;for(Bt=0;256>Bt;Bt+=16)lt[Mt+Bt]=Vn}Jt=1,An=rt[0]}var tn=15&et.la,bn=15&Dt.la;for(Bt=0;4>Bt;++Bt){var Un=1&bn;for(Vn=Rn=0;4>Vn;++Vn)tn=tn>>1|(Un=(cn=Mc(Ie,An,cn=Un+(1&tn),yt.Sc,Jt,lt,Mt))>Jt)<<7,Rn=Rn<<2|(3<cn?3:1<cn?2:lt[Mt+0]!=0),Mt+=16;tn>>=4,bn=bn>>1|Un<<7,Nt=(Nt<<8|Rn)>>>0}for(An=tn,Jt=bn>>4,rn=0;4>rn;rn+=2){for(Rn=0,tn=et.la>>4+rn,bn=Dt.la>>4+rn,Bt=0;2>Bt;++Bt){for(Un=1&bn,Vn=0;2>Vn;++Vn)cn=Un+(1&tn),tn=tn>>1|(Un=0<(cn=Mc(Ie,rt[2],cn,yt.Qc,0,lt,Mt)))<<3,Rn=Rn<<2|(3<cn?3:1<cn?2:lt[Mt+0]!=0),Mt+=16;tn>>=2,bn=bn>>1|Un<<5}qt|=Rn<<4*rn,An|=tn<<4<<rn,Jt|=(240&bn)<<rn}et.la=An,Dt.la=Jt,gt.Hc=Nt,gt.Gc=qt,gt.ia=43690&qt?0:yt.ia,rt=!(Nt|qt)}if(0<qe.L&&(qe.wa[qe.Y+qe.ja]=qe.gd[Ee.$b][Ee.Za],qe.wa[qe.Y+qe.ja].La|=!rt),at.Ka)return Ni(le,7,"Premature end-of-file encountered.")}if(Ga(le),qe=ce,at=1,Ee=(Fe=le).D,et=0<Fe.L&&Fe.M>=Fe.zb&&Fe.M<=Fe.Va,Fe.Aa==0)t:{if(Ee.M=Fe.M,Ee.uc=et,Vi(Fe,Ee),at=1,Ee=(Rn=Fe.D).Nb,et=(qt=hu[Fe.L])*Fe.R,Ie=qt/2*Fe.B,Bt=16*Ee*Fe.R,Vn=8*Ee*Fe.B,rt=Fe.sa,gt=Fe.ta-et+Bt,yt=Fe.qa,lt=Fe.ra-Ie+Vn,Mt=Fe.Ha,Dt=Fe.Ia-Ie+Vn,bn=(tn=Rn.M)==0,Nt=tn>=Fe.Va-1,Fe.Aa==2&&Vi(Fe,Rn),Rn.uc)for(Un=(cn=Fe).D.M,e(cn.D.uc),Rn=cn.yb;Rn<cn.Hb;++Rn){Jt=Rn,An=Un;var In=(Wn=(Ki=cn).D).Nb;rn=Ki.R;var Wn=Wn.wa[Wn.Y+Jt],Nr=Ki.sa,ei=Ki.ta+16*In*rn+16*Jt,Er=Wn.dd,gr=Wn.tc;if(gr!=0)if(e(3<=gr),Ki.L==1)0<Jt&&Ms(Nr,ei,rn,gr+4),Wn.La&&Ds(Nr,ei,rn,gr),0<An&&yi(Nr,ei,rn,gr+4),Wn.La&&Xi(Nr,ei,rn,gr);else{var Ai=Ki.B,Mi=Ki.qa,Vr=Ki.ra+8*In*Ai+8*Jt,Yi=Ki.Ha,Ki=Ki.Ia+8*In*Ai+8*Jt;In=Wn.ld,0<Jt&&(Ye(Nr,ei,rn,gr+4,Er,In),an(Mi,Vr,Yi,Ki,Ai,gr+4,Er,In)),Wn.La&&(Kn(Nr,ei,rn,gr,Er,In),Yr(Mi,Vr,Yi,Ki,Ai,gr,Er,In)),0<An&&(Ae(Nr,ei,rn,gr+4,Er,In),bt(Mi,Vr,Yi,Ki,Ai,gr+4,Er,In)),Wn.La&&(mn(Nr,ei,rn,gr,Er,In),Pr(Mi,Vr,Yi,Ki,Ai,gr,Er,In))}}if(Fe.ia&&alert("todo:DitherRow"),qe.put!=null){if(Rn=16*tn,tn=16*(tn+1),bn?(qe.y=Fe.sa,qe.O=Fe.ta+Bt,qe.f=Fe.qa,qe.N=Fe.ra+Vn,qe.ea=Fe.Ha,qe.W=Fe.Ia+Vn):(Rn-=qt,qe.y=rt,qe.O=gt,qe.f=yt,qe.N=lt,qe.ea=Mt,qe.W=Dt),Nt||(tn-=qt),tn>qe.o&&(tn=qe.o),qe.F=null,qe.J=null,Fe.Fa!=null&&0<Fe.Fa.length&&Rn<tn&&(qe.J=fo(Fe,qe,Rn,tn-Rn),qe.F=Fe.mb,qe.F==null&&qe.F.length==0)){at=Ni(Fe,3,"Could not decode alpha data.");break t}Rn<qe.j&&(qt=qe.j-Rn,Rn=qe.j,e(!(1&qt)),qe.O+=Fe.R*qt,qe.N+=Fe.B*(qt>>1),qe.W+=Fe.B*(qt>>1),qe.F!=null&&(qe.J+=qe.width*qt)),Rn<tn&&(qe.O+=qe.v,qe.N+=qe.v>>1,qe.W+=qe.v>>1,qe.F!=null&&(qe.J+=qe.v),qe.ka=Rn-qe.j,qe.U=qe.va-qe.v,qe.T=tn-Rn,at=qe.put(qe))}Ee+1!=Fe.Ic||Nt||(i(Fe.sa,Fe.ta-et,rt,gt+16*Fe.R,et),i(Fe.qa,Fe.ra-Ie,yt,lt+8*Fe.B,Ie),i(Fe.Ha,Fe.Ia-Ie,Mt,Dt+8*Fe.B,Ie))}if(!at)return Ni(le,6,"Output aborted.")}return 1})(Et,Qt)),Qt.bc!=null&&Qt.bc(Qt),gn&=1}return gn?(Et.cb=0,gn):0})(D,pe)||(H=D.a)}}else H=D.a}H==0&&it.Oa!=null&&it.Oa.fd&&(H=Rc(it.ba))}it=H}tt=it!=0?null:11>tt?ht.f.RGBA.eb:ht.f.kb.y}else tt=null;return tt};var hh=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function T(B,Y){for(var $="",J=0;J<4;J++)$+=String.fromCharCode(B[Y++]);return $}function L(B,Y){return B[Y+0]|B[Y+1]<<8}function R(B,Y){return(B[Y+0]|B[Y+1]<<8|B[Y+2]<<16)>>>0}function U(B,Y){return(B[Y+0]|B[Y+1]<<8|B[Y+2]<<16|B[Y+3]<<24)>>>0}new s;var M=[0],Q=[0],ae=[],ye=new s,ie=n,oe=(function(B,Y){var $={},J=0,te=!1,Se=0,De=0;if($.frames=[],!(function(ge,We){for(var Ve=0;Ve<4;Ve++)if(ge[We+Ve]!="RIFF".charCodeAt(Ve))return!0;return!1})(B,Y)){for(U(B,Y+=4),Y+=8;Y<B.length;){var $e=T(B,Y),Ue=U(B,Y+=4);Y+=4;var Le=Ue+(1&Ue);switch($e){case"VP8 ":case"VP8L":$.frames[J]===void 0&&($.frames[J]={}),(Ce=$.frames[J]).src_off=te?De:Y-8,Ce.src_size=Se+Ue+8,J++,te&&(te=!1,Se=0,De=0);break;case"VP8X":(Ce=$.header={}).feature_flags=B[Y];var He=Y+4;Ce.canvas_width=1+R(B,He),He+=3,Ce.canvas_height=1+R(B,He),He+=3;break;case"ALPH":te=!0,Se=Le+8,De=Y-8;break;case"ANIM":(Ce=$.header).bgcolor=U(B,Y),He=Y+4,Ce.loop_count=L(B,He),He+=2;break;case"ANMF":var Ke,Ce;(Ce=$.frames[J]={}).offset_x=2*R(B,Y),Y+=3,Ce.offset_y=2*R(B,Y),Y+=3,Ce.width=1+R(B,Y),Y+=3,Ce.height=1+R(B,Y),Y+=3,Ce.duration=R(B,Y),Y+=3,Ke=B[Y++],Ce.dispose=1&Ke,Ce.blend=Ke>>1&1}$e!="ANMF"&&(Y+=Le)}return $}})(ie,0);oe.response=ie,oe.rgbaoutput=!0,oe.dataurl=!1;var ve=oe.header?oe.header:null,de=oe.frames?oe.frames:null;if(ve){ve.loop_counter=ve.loop_count,M=[ve.canvas_height],Q=[ve.canvas_width];for(var Pe=0;Pe<de.length&&de[Pe].blend!=0;Pe++);}var Be=de[0],_e=ye.WebPDecodeRGBA(ie,Be.src_off,Be.src_size,Q,M);Be.rgba=_e,Be.imgwidth=Q[0],Be.imgheight=M[0];for(var G=0;G<Q[0]*M[0]*4;G++)ae[G]=_e[G];return this.width=Q,this.height=M,this.data=ae,this}(function(n){var e,t,i,a,c,_,y,s,T,L=function(ge){return ge=ge||{},this.isStrokeTransparent=ge.isStrokeTransparent||!1,this.strokeOpacity=ge.strokeOpacity||1,this.strokeStyle=ge.strokeStyle||"#000000",this.fillStyle=ge.fillStyle||"#000000",this.isFillTransparent=ge.isFillTransparent||!1,this.fillOpacity=ge.fillOpacity||1,this.font=ge.font||"10px sans-serif",this.textBaseline=ge.textBaseline||"alphabetic",this.textAlign=ge.textAlign||"left",this.lineWidth=ge.lineWidth||1,this.lineJoin=ge.lineJoin||"miter",this.lineCap=ge.lineCap||"butt",this.path=ge.path||[],this.transform=ge.transform!==void 0?ge.transform.clone():new s,this.globalCompositeOperation=ge.globalCompositeOperation||"normal",this.globalAlpha=ge.globalAlpha||1,this.clip_path=ge.clip_path||[],this.currentPoint=ge.currentPoint||new _,this.miterLimit=ge.miterLimit||10,this.lastPoint=ge.lastPoint||new _,this.lineDashOffset=ge.lineDashOffset||0,this.lineDash=ge.lineDash||[],this.margin=ge.margin||[0,0,0,0],this.prevPageLastElemOffset=ge.prevPageLastElemOffset||0,this.ignoreClearRect=typeof ge.ignoreClearRect!="boolean"||ge.ignoreClearRect,this};n.events.push(["initialized",function(){this.context2d=new R(this),e=this.internal.f2,t=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,a=this.internal.getHorizontalCoordinate,c=this.internal.getVerticalCoordinate,_=this.internal.Point,y=this.internal.Rectangle,s=this.internal.Matrix,T=new L}]);var R=function(ge){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var We=ge;Object.defineProperty(this,"pdf",{get:function(){return We}});var Ve=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Ve},set:function(on){Ve=!!on}});var ut=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return ut},set:function(on){ut=!!on}});var pt=0;Object.defineProperty(this,"posX",{get:function(){return pt},set:function(on){isNaN(on)||(pt=on)}});var It=0;Object.defineProperty(this,"posY",{get:function(){return It},set:function(on){isNaN(on)||(It=on)}}),Object.defineProperty(this,"margin",{get:function(){return T.margin},set:function(on){var mt;typeof on=="number"?mt=[on,on,on,on]:((mt=new Array(4))[0]=on[0],mt[1]=on.length>=2?on[1]:mt[0],mt[2]=on.length>=3?on[2]:mt[0],mt[3]=on.length>=4?on[3]:mt[1]),T.margin=mt}});var Oe=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Oe},set:function(on){Oe=on}});var Wt=0;Object.defineProperty(this,"lastBreak",{get:function(){return Wt},set:function(on){Wt=on}});var Zt=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Zt},set:function(on){Zt=on}}),Object.defineProperty(this,"ctx",{get:function(){return T},set:function(on){on instanceof L&&(T=on)}}),Object.defineProperty(this,"path",{get:function(){return T.path},set:function(on){T.path=on}});var Xt=[];Object.defineProperty(this,"ctxStack",{get:function(){return Xt},set:function(on){Xt=on}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(on){var mt;mt=U(on),this.ctx.fillStyle=mt.style,this.ctx.isFillTransparent=mt.a===0,this.ctx.fillOpacity=mt.a,this.pdf.setFillColor(mt.r,mt.g,mt.b,{a:mt.a}),this.pdf.setTextColor(mt.r,mt.g,mt.b,{a:mt.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(on){var mt=U(on);this.ctx.strokeStyle=mt.style,this.ctx.isStrokeTransparent=mt.a===0,this.ctx.strokeOpacity=mt.a,mt.a===0?this.pdf.setDrawColor(255,255,255):(mt.a,this.pdf.setDrawColor(mt.r,mt.g,mt.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(on){["butt","round","square"].indexOf(on)!==-1&&(this.ctx.lineCap=on,this.pdf.setLineCap(on))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(on){isNaN(on)||(this.ctx.lineWidth=on,this.pdf.setLineWidth(on))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(on){["bevel","round","miter"].indexOf(on)!==-1&&(this.ctx.lineJoin=on,this.pdf.setLineJoin(on))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(on){isNaN(on)||(this.ctx.miterLimit=on,this.pdf.setMiterLimit(on))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(on){this.ctx.textBaseline=on}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(on){["right","end","center","left","start"].indexOf(on)!==-1&&(this.ctx.textAlign=on)}});var Ze=null,zn=null;Object.defineProperty(this,"fontFaces",{get:function(){return zn},set:function(on){Ze=null,zn=on}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(on){var mt;if(this.ctx.font=on,(mt=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(on))!==null){var Ir=mt[1];mt[2];var Fr=mt[3],qr=mt[4];mt[5];var $t=mt[6],xr=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(qr)[2];qr=Math.floor(xr==="px"?parseFloat(qr)*this.pdf.internal.scaleFactor:xr==="em"?parseFloat(qr)*this.pdf.getFontSize():parseFloat(qr)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(qr);var dr=(function(ir){var Xn,Bi,bi=[],wr=ir.trim();if(wr==="")return cw;if(wr in pE)return[pE[wr]];for(;wr!=="";){switch(Bi=null,Xn=(wr=gE(wr)).charAt(0)){case'"':case"'":Bi=l7(wr.substring(1),Xn);break;default:Bi=u7(wr)}if(Bi===null||(bi.push(Bi[0]),(wr=gE(Bi[1]))!==""&&wr.charAt(0)!==","))return cw;wr=wr.replace(/^,/,"")}return bi})($t);if(this.fontFaces){var ni=(function(ir,Xn){if(Ze===null){var Bi=(function(bi){var wr=[];return Object.keys(bi).forEach(function(or){bi[or].forEach(function(ui){var Kr=null;switch(ui){case"bold":Kr={family:or,weight:"bold"};break;case"italic":Kr={family:or,style:"italic"};break;case"bolditalic":Kr={family:or,weight:"bold",style:"italic"};break;case"":case"normal":Kr={family:or}}Kr!==null&&(Kr.ref={name:or,style:ui},wr.push(Kr))})}),wr})(ir.getFontList());Ze=(function(bi){for(var wr={},or=0;or<bi.length;++or){var ui=uw(bi[or]),Kr=ui.family,wi=ui.stretch,si=ui.style,vt=ui.weight;wr[Kr]=wr[Kr]||{},wr[Kr][wi]=wr[Kr][wi]||{},wr[Kr][wi][si]=wr[Kr][wi][si]||{},wr[Kr][wi][si][vt]=ui}return wr})(Bi.concat(Xn))}return Ze})(this.pdf,this.fontFaces),nn=dr.map(function(ir){return{family:ir,stretch:"normal",weight:Fr,style:Ir}}),yn=(function(ir,Xn,Bi){for(var bi=(Bi=Bi||{}).defaultFontFamily||"times",wr=Object.assign({},a7,Bi.genericFontFamilies||{}),or=null,ui=null,Kr=0;Kr<Xn.length;++Kr)if(wr[(or=uw(Xn[Kr])).family]&&(or.family=wr[or.family]),ir.hasOwnProperty(or.family)){ui=ir[or.family];break}if(!(ui=ui||ir[bi]))throw new Error("Could not find a font-family for the rule '"+mE(or)+"' and default family '"+bi+"'.");if(ui=(function(wi,si){if(si[wi])return si[wi];var vt=l5[wi],Ne=vt<=l5.normal?-1:1,ze=dE(si,$C,vt,Ne);if(!ze)throw new Error("Could not find a matching font-stretch value for "+wi);return ze})(or.stretch,ui),ui=(function(wi,si){if(si[wi])return si[wi];for(var vt=GC[wi],Ne=0;Ne<vt.length;++Ne)if(si[vt[Ne]])return si[vt[Ne]];throw new Error("Could not find a matching font-style for "+wi)})(or.style,ui),!(ui=(function(wi,si){if(si[wi])return si[wi];if(wi===400&&si[500])return si[500];if(wi===500&&si[400])return si[400];var vt=o7[wi],Ne=dE(si,HC,vt,wi<400?-1:1);if(!Ne)throw new Error("Could not find a matching font-weight for value "+wi);return Ne})(or.weight,ui)))throw new Error("Failed to resolve a font for the rule '"+mE(or)+"'.");return ui})(ni,nn);this.pdf.setFont(yn.ref.name,yn.ref.style)}else{var sr="";(Fr==="bold"||parseInt(Fr,10)>=700||Ir==="bold")&&(sr="bold"),Ir==="italic"&&(sr+="italic"),sr.length===0&&(sr="normal");for(var Zn="",$r={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},qn=0;qn<dr.length;qn++){if(this.pdf.internal.getFont(dr[qn],sr,{noFallback:!0,disableWarning:!0})!==void 0){Zn=dr[qn];break}if(sr==="bolditalic"&&this.pdf.internal.getFont(dr[qn],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Zn=dr[qn],sr="bold";else if(this.pdf.internal.getFont(dr[qn],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Zn=dr[qn],sr="normal";break}}if(Zn===""){for(var jr=0;jr<dr.length;jr++)if($r[dr[jr]]){Zn=$r[dr[jr]];break}}Zn=Zn===""?"Times":Zn,this.pdf.setFont(Zn,sr)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(on){this.ctx.globalCompositeOperation=on}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(on){this.ctx.globalAlpha=on}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(on){this.ctx.lineDashOffset=on,Ce.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(on){this.ctx.lineDash=on,Ce.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(on){this.ctx.ignoreClearRect=!!on}})};R.prototype.setLineDash=function(ge){this.lineDash=ge},R.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},R.prototype.fill=function(){de.call(this,"fill",!1)},R.prototype.stroke=function(){de.call(this,"stroke",!1)},R.prototype.beginPath=function(){this.path=[{type:"begin"}]},R.prototype.moveTo=function(ge,We){if(isNaN(ge)||isNaN(We))throw Dl.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Ve=this.ctx.transform.applyToPoint(new _(ge,We));this.path.push({type:"mt",x:Ve.x,y:Ve.y}),this.ctx.lastPoint=new _(ge,We)},R.prototype.closePath=function(){var ge=new _(0,0),We=0;for(We=this.path.length-1;We!==-1;We--)if(this.path[We].type==="begin"&&dl(this.path[We+1])==="object"&&typeof this.path[We+1].x=="number"){ge=new _(this.path[We+1].x,this.path[We+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new _(ge.x,ge.y)},R.prototype.lineTo=function(ge,We){if(isNaN(ge)||isNaN(We))throw Dl.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Ve=this.ctx.transform.applyToPoint(new _(ge,We));this.path.push({type:"lt",x:Ve.x,y:Ve.y}),this.ctx.lastPoint=new _(Ve.x,Ve.y)},R.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),de.call(this,null,!0)},R.prototype.quadraticCurveTo=function(ge,We,Ve,ut){if(isNaN(Ve)||isNaN(ut)||isNaN(ge)||isNaN(We))throw Dl.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var pt=this.ctx.transform.applyToPoint(new _(Ve,ut)),It=this.ctx.transform.applyToPoint(new _(ge,We));this.path.push({type:"qct",x1:It.x,y1:It.y,x:pt.x,y:pt.y}),this.ctx.lastPoint=new _(pt.x,pt.y)},R.prototype.bezierCurveTo=function(ge,We,Ve,ut,pt,It){if(isNaN(pt)||isNaN(It)||isNaN(ge)||isNaN(We)||isNaN(Ve)||isNaN(ut))throw Dl.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Oe=this.ctx.transform.applyToPoint(new _(pt,It)),Wt=this.ctx.transform.applyToPoint(new _(ge,We)),Zt=this.ctx.transform.applyToPoint(new _(Ve,ut));this.path.push({type:"bct",x1:Wt.x,y1:Wt.y,x2:Zt.x,y2:Zt.y,x:Oe.x,y:Oe.y}),this.ctx.lastPoint=new _(Oe.x,Oe.y)},R.prototype.arc=function(ge,We,Ve,ut,pt,It){if(isNaN(ge)||isNaN(We)||isNaN(Ve)||isNaN(ut)||isNaN(pt))throw Dl.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(It=!!It,!this.ctx.transform.isIdentity){var Oe=this.ctx.transform.applyToPoint(new _(ge,We));ge=Oe.x,We=Oe.y;var Wt=this.ctx.transform.applyToPoint(new _(0,Ve)),Zt=this.ctx.transform.applyToPoint(new _(0,0));Ve=Math.sqrt(Math.pow(Wt.x-Zt.x,2)+Math.pow(Wt.y-Zt.y,2))}Math.abs(pt-ut)>=2*Math.PI&&(ut=0,pt=2*Math.PI),this.path.push({type:"arc",x:ge,y:We,radius:Ve,startAngle:ut,endAngle:pt,counterclockwise:It})},R.prototype.arcTo=function(ge,We,Ve,ut,pt){throw new Error("arcTo not implemented.")},R.prototype.rect=function(ge,We,Ve,ut){if(isNaN(ge)||isNaN(We)||isNaN(Ve)||isNaN(ut))throw Dl.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(ge,We),this.lineTo(ge+Ve,We),this.lineTo(ge+Ve,We+ut),this.lineTo(ge,We+ut),this.lineTo(ge,We),this.lineTo(ge+Ve,We),this.lineTo(ge,We)},R.prototype.fillRect=function(ge,We,Ve,ut){if(isNaN(ge)||isNaN(We)||isNaN(Ve)||isNaN(ut))throw Dl.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!M.call(this)){var pt={};this.lineCap!=="butt"&&(pt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(pt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(ge,We,Ve,ut),this.fill(),pt.hasOwnProperty("lineCap")&&(this.lineCap=pt.lineCap),pt.hasOwnProperty("lineJoin")&&(this.lineJoin=pt.lineJoin)}},R.prototype.strokeRect=function(ge,We,Ve,ut){if(isNaN(ge)||isNaN(We)||isNaN(Ve)||isNaN(ut))throw Dl.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");Q.call(this)||(this.beginPath(),this.rect(ge,We,Ve,ut),this.stroke())},R.prototype.clearRect=function(ge,We,Ve,ut){if(isNaN(ge)||isNaN(We)||isNaN(Ve)||isNaN(ut))throw Dl.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(ge,We,Ve,ut))},R.prototype.save=function(ge){ge=typeof ge!="boolean"||ge;for(var We=this.pdf.internal.getCurrentPageInfo().pageNumber,Ve=0;Ve<this.pdf.internal.getNumberOfPages();Ve++)this.pdf.setPage(Ve+1),this.pdf.internal.out("q");if(this.pdf.setPage(We),ge){this.ctx.fontSize=this.pdf.internal.getFontSize();var ut=new L(this.ctx);this.ctxStack.push(this.ctx),this.ctx=ut}},R.prototype.restore=function(ge){ge=typeof ge!="boolean"||ge;for(var We=this.pdf.internal.getCurrentPageInfo().pageNumber,Ve=0;Ve<this.pdf.internal.getNumberOfPages();Ve++)this.pdf.setPage(Ve+1),this.pdf.internal.out("Q");this.pdf.setPage(We),ge&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},R.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var U=function(ge){var We,Ve,ut,pt;if(ge.isCanvasGradient===!0&&(ge=ge.getColor()),!ge)return{r:0,g:0,b:0,a:0,style:ge};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(ge))We=0,Ve=0,ut=0,pt=0;else{var It=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(ge);if(It!==null)We=parseInt(It[1]),Ve=parseInt(It[2]),ut=parseInt(It[3]),pt=1;else if((It=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(ge))!==null)We=parseInt(It[1]),Ve=parseInt(It[2]),ut=parseInt(It[3]),pt=parseFloat(It[4]);else{if(pt=1,typeof ge=="string"&&ge.charAt(0)!=="#"){var Oe=new FC(ge);ge=Oe.ok?Oe.toHex():"#000000"}ge.length===4?(We=ge.substring(1,2),We+=We,Ve=ge.substring(2,3),Ve+=Ve,ut=ge.substring(3,4),ut+=ut):(We=ge.substring(1,3),Ve=ge.substring(3,5),ut=ge.substring(5,7)),We=parseInt(We,16),Ve=parseInt(Ve,16),ut=parseInt(ut,16)}}return{r:We,g:Ve,b:ut,a:pt,style:ge}},M=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},Q=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};R.prototype.fillText=function(ge,We,Ve,ut){if(isNaN(We)||isNaN(Ve)||typeof ge!="string")throw Dl.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(ut=isNaN(ut)?void 0:ut,!M.call(this)){var pt=Le(this.ctx.transform.rotation),It=this.ctx.transform.scaleX;J.call(this,{text:ge,x:We,y:Ve,scale:It,angle:pt,align:this.textAlign,maxWidth:ut})}},R.prototype.strokeText=function(ge,We,Ve,ut){if(isNaN(We)||isNaN(Ve)||typeof ge!="string")throw Dl.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!Q.call(this)){ut=isNaN(ut)?void 0:ut;var pt=Le(this.ctx.transform.rotation),It=this.ctx.transform.scaleX;J.call(this,{text:ge,x:We,y:Ve,scale:It,renderingMode:"stroke",angle:pt,align:this.textAlign,maxWidth:ut})}},R.prototype.measureText=function(ge){if(typeof ge!="string")throw Dl.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var We=this.pdf,Ve=this.pdf.internal.scaleFactor,ut=We.internal.getFontSize(),pt=We.getStringUnitWidth(ge)*ut/We.internal.scaleFactor;return new function(It){var Oe=(It=It||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return Oe}}),this}({width:pt*=Math.round(96*Ve/72*1e4)/1e4})},R.prototype.scale=function(ge,We){if(isNaN(ge)||isNaN(We))throw Dl.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Ve=new s(ge,0,0,We,0,0);this.ctx.transform=this.ctx.transform.multiply(Ve)},R.prototype.rotate=function(ge){if(isNaN(ge))throw Dl.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var We=new s(Math.cos(ge),Math.sin(ge),-Math.sin(ge),Math.cos(ge),0,0);this.ctx.transform=this.ctx.transform.multiply(We)},R.prototype.translate=function(ge,We){if(isNaN(ge)||isNaN(We))throw Dl.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Ve=new s(1,0,0,1,ge,We);this.ctx.transform=this.ctx.transform.multiply(Ve)},R.prototype.transform=function(ge,We,Ve,ut,pt,It){if(isNaN(ge)||isNaN(We)||isNaN(Ve)||isNaN(ut)||isNaN(pt)||isNaN(It))throw Dl.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Oe=new s(ge,We,Ve,ut,pt,It);this.ctx.transform=this.ctx.transform.multiply(Oe)},R.prototype.setTransform=function(ge,We,Ve,ut,pt,It){ge=isNaN(ge)?1:ge,We=isNaN(We)?0:We,Ve=isNaN(Ve)?0:Ve,ut=isNaN(ut)?1:ut,pt=isNaN(pt)?0:pt,It=isNaN(It)?0:It,this.ctx.transform=new s(ge,We,Ve,ut,pt,It)};var ae=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};R.prototype.drawImage=function(ge,We,Ve,ut,pt,It,Oe,Wt,Zt){var Xt=this.pdf.getImageProperties(ge),Ze=1,zn=1,on=1,mt=1;ut!==void 0&&Wt!==void 0&&(on=Wt/ut,mt=Zt/pt,Ze=Xt.width/ut*Wt/ut,zn=Xt.height/pt*Zt/pt),It===void 0&&(It=We,Oe=Ve,We=0,Ve=0),ut!==void 0&&Wt===void 0&&(Wt=ut,Zt=pt),ut===void 0&&Wt===void 0&&(Wt=Xt.width,Zt=Xt.height);for(var Ir,Fr=this.ctx.transform.decompose(),qr=Le(Fr.rotate.shx),$t=new s,xr=($t=($t=($t=$t.multiply(Fr.translate)).multiply(Fr.skew)).multiply(Fr.scale)).applyToRectangle(new y(It-We*on,Oe-Ve*mt,ut*Ze,pt*zn)),dr=ye.call(this,xr),ni=[],nn=0;nn<dr.length;nn+=1)ni.indexOf(dr[nn])===-1&&ni.push(dr[nn]);if(ve(ni),this.autoPaging)for(var yn=ni[0],sr=ni[ni.length-1],Zn=yn;Zn<sr+1;Zn++){this.pdf.setPage(Zn);var $r=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],qn=Zn===1?this.posY+this.margin[0]:this.margin[0],jr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],ir=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Xn=Zn===1?0:jr+(Zn-2)*ir;if(this.ctx.clip_path.length!==0){var Bi=this.path;Ir=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=oe(Ir,this.posX+this.margin[3],-Xn+qn+this.ctx.prevPageLastElemOffset),Pe.call(this,"fill",!0),this.path=Bi}var bi=JSON.parse(JSON.stringify(xr));bi=oe([bi],this.posX+this.margin[3],-Xn+qn+this.ctx.prevPageLastElemOffset)[0];var wr=(Zn>yn||Zn<sr)&&ae.call(this);wr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],$r,ir,null).clip().discardPath()),this.pdf.addImage(ge,"JPEG",bi.x,bi.y,bi.w,bi.h,null,null,qr),wr&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(ge,"JPEG",xr.x,xr.y,xr.w,xr.h,null,null,qr)};var ye=function(ge,We,Ve){var ut=[];We=We||this.pdf.internal.pageSize.width,Ve=Ve||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var pt=this.posY+this.ctx.prevPageLastElemOffset;switch(ge.type){default:case"mt":case"lt":ut.push(Math.floor((ge.y+pt)/Ve)+1);break;case"arc":ut.push(Math.floor((ge.y+pt-ge.radius)/Ve)+1),ut.push(Math.floor((ge.y+pt+ge.radius)/Ve)+1);break;case"qct":var It=He(this.ctx.lastPoint.x,this.ctx.lastPoint.y,ge.x1,ge.y1,ge.x,ge.y);ut.push(Math.floor((It.y+pt)/Ve)+1),ut.push(Math.floor((It.y+It.h+pt)/Ve)+1);break;case"bct":var Oe=Ke(this.ctx.lastPoint.x,this.ctx.lastPoint.y,ge.x1,ge.y1,ge.x2,ge.y2,ge.x,ge.y);ut.push(Math.floor((Oe.y+pt)/Ve)+1),ut.push(Math.floor((Oe.y+Oe.h+pt)/Ve)+1);break;case"rect":ut.push(Math.floor((ge.y+pt)/Ve)+1),ut.push(Math.floor((ge.y+ge.h+pt)/Ve)+1)}for(var Wt=0;Wt<ut.length;Wt+=1)for(;this.pdf.internal.getNumberOfPages()<ut[Wt];)ie.call(this);return ut},ie=function(){var ge=this.fillStyle,We=this.strokeStyle,Ve=this.font,ut=this.lineCap,pt=this.lineWidth,It=this.lineJoin;this.pdf.addPage(),this.fillStyle=ge,this.strokeStyle=We,this.font=Ve,this.lineCap=ut,this.lineWidth=pt,this.lineJoin=It},oe=function(ge,We,Ve){for(var ut=0;ut<ge.length;ut++)switch(ge[ut].type){case"bct":ge[ut].x2+=We,ge[ut].y2+=Ve;case"qct":ge[ut].x1+=We,ge[ut].y1+=Ve;default:ge[ut].x+=We,ge[ut].y+=Ve}return ge},ve=function(ge){return ge.sort(function(We,Ve){return We-Ve})},de=function(ge,We){for(var Ve,ut,pt=this.fillStyle,It=this.strokeStyle,Oe=this.lineCap,Wt=this.lineWidth,Zt=Math.abs(Wt*this.ctx.transform.scaleX),Xt=this.lineJoin,Ze=JSON.parse(JSON.stringify(this.path)),zn=JSON.parse(JSON.stringify(this.path)),on=[],mt=0;mt<zn.length;mt++)if(zn[mt].x!==void 0)for(var Ir=ye.call(this,zn[mt]),Fr=0;Fr<Ir.length;Fr+=1)on.indexOf(Ir[Fr])===-1&&on.push(Ir[Fr]);for(var qr=0;qr<on.length;qr++)for(;this.pdf.internal.getNumberOfPages()<on[qr];)ie.call(this);if(ve(on),this.autoPaging)for(var $t=on[0],xr=on[on.length-1],dr=$t;dr<xr+1;dr++){this.pdf.setPage(dr),this.fillStyle=pt,this.strokeStyle=It,this.lineCap=Oe,this.lineWidth=Zt,this.lineJoin=Xt;var ni=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],nn=dr===1?this.posY+this.margin[0]:this.margin[0],yn=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],sr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Zn=dr===1?0:yn+(dr-2)*sr;if(this.ctx.clip_path.length!==0){var $r=this.path;Ve=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=oe(Ve,this.posX+this.margin[3],-Zn+nn+this.ctx.prevPageLastElemOffset),Pe.call(this,ge,!0),this.path=$r}if(ut=JSON.parse(JSON.stringify(Ze)),this.path=oe(ut,this.posX+this.margin[3],-Zn+nn+this.ctx.prevPageLastElemOffset),We===!1||dr===0){var qn=(dr>$t||dr<xr)&&ae.call(this);qn&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ni,sr,null).clip().discardPath()),Pe.call(this,ge,We),qn&&this.pdf.restoreGraphicsState()}this.lineWidth=Wt}else this.lineWidth=Zt,Pe.call(this,ge,We),this.lineWidth=Wt;this.path=Ze},Pe=function(ge,We){if((ge!=="stroke"||We||!Q.call(this))&&(ge==="stroke"||We||!M.call(this))){for(var Ve,ut,pt=[],It=this.path,Oe=0;Oe<It.length;Oe++){var Wt=It[Oe];switch(Wt.type){case"begin":pt.push({begin:!0});break;case"close":pt.push({close:!0});break;case"mt":pt.push({start:Wt,deltas:[],abs:[]});break;case"lt":var Zt=pt.length;if(It[Oe-1]&&!isNaN(It[Oe-1].x)&&(Ve=[Wt.x-It[Oe-1].x,Wt.y-It[Oe-1].y],Zt>0)){for(;Zt>=0;Zt--)if(pt[Zt-1].close!==!0&&pt[Zt-1].begin!==!0){pt[Zt-1].deltas.push(Ve),pt[Zt-1].abs.push(Wt);break}}break;case"bct":Ve=[Wt.x1-It[Oe-1].x,Wt.y1-It[Oe-1].y,Wt.x2-It[Oe-1].x,Wt.y2-It[Oe-1].y,Wt.x-It[Oe-1].x,Wt.y-It[Oe-1].y],pt[pt.length-1].deltas.push(Ve);break;case"qct":var Xt=It[Oe-1].x+2/3*(Wt.x1-It[Oe-1].x),Ze=It[Oe-1].y+2/3*(Wt.y1-It[Oe-1].y),zn=Wt.x+2/3*(Wt.x1-Wt.x),on=Wt.y+2/3*(Wt.y1-Wt.y),mt=Wt.x,Ir=Wt.y;Ve=[Xt-It[Oe-1].x,Ze-It[Oe-1].y,zn-It[Oe-1].x,on-It[Oe-1].y,mt-It[Oe-1].x,Ir-It[Oe-1].y],pt[pt.length-1].deltas.push(Ve);break;case"arc":pt.push({deltas:[],abs:[],arc:!0}),Array.isArray(pt[pt.length-1].abs)&&pt[pt.length-1].abs.push(Wt)}}ut=We?null:ge==="stroke"?"stroke":"fill";for(var Fr=!1,qr=0;qr<pt.length;qr++)if(pt[qr].arc)for(var $t=pt[qr].abs,xr=0;xr<$t.length;xr++){var dr=$t[xr];dr.type==="arc"?G.call(this,dr.x,dr.y,dr.radius,dr.startAngle,dr.endAngle,dr.counterclockwise,void 0,We,!Fr):te.call(this,dr.x,dr.y),Fr=!0}else if(pt[qr].close===!0)this.pdf.internal.out("h"),Fr=!1;else if(pt[qr].begin!==!0){var ni=pt[qr].start.x,nn=pt[qr].start.y;Se.call(this,pt[qr].deltas,ni,nn),Fr=!0}ut&&B.call(this,ut),We&&Y.call(this)}},Be=function(ge){var We=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Ve=We*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return ge-Ve;case"top":return ge+We-Ve;case"hanging":return ge+We-2*Ve;case"middle":return ge+We/2-Ve;default:return ge}},_e=function(ge){return ge+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};R.prototype.createLinearGradient=function(){var ge=function(){};return ge.colorStops=[],ge.addColorStop=function(We,Ve){this.colorStops.push([We,Ve])},ge.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},ge.isCanvasGradient=!0,ge},R.prototype.createPattern=function(){return this.createLinearGradient()},R.prototype.createRadialGradient=function(){return this.createLinearGradient()};var G=function(ge,We,Ve,ut,pt,It,Oe,Wt,Zt){for(var Xt=$e.call(this,Ve,ut,pt,It),Ze=0;Ze<Xt.length;Ze++){var zn=Xt[Ze];Ze===0&&(Zt?$.call(this,zn.x1+ge,zn.y1+We):te.call(this,zn.x1+ge,zn.y1+We)),De.call(this,ge,We,zn.x2,zn.y2,zn.x3,zn.y3,zn.x4,zn.y4)}Wt?Y.call(this):B.call(this,Oe)},B=function(ge){switch(ge){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},Y=function(){this.pdf.clip(),this.pdf.discardPath()},$=function(ge,We){this.pdf.internal.out(t(ge)+" "+i(We)+" m")},J=function(ge){var We;switch(ge.align){case"right":case"end":We="right";break;case"center":We="center";break;default:We="left"}var Ve=this.pdf.getTextDimensions(ge.text),ut=Be.call(this,ge.y),pt=_e.call(this,ut)-Ve.h,It=this.ctx.transform.applyToPoint(new _(ge.x,ut)),Oe=this.ctx.transform.decompose(),Wt=new s;Wt=(Wt=(Wt=Wt.multiply(Oe.translate)).multiply(Oe.skew)).multiply(Oe.scale);for(var Zt,Xt,Ze,zn=this.ctx.transform.applyToRectangle(new y(ge.x,ut,Ve.w,Ve.h)),on=Wt.applyToRectangle(new y(ge.x,pt,Ve.w,Ve.h)),mt=ye.call(this,on),Ir=[],Fr=0;Fr<mt.length;Fr+=1)Ir.indexOf(mt[Fr])===-1&&Ir.push(mt[Fr]);if(ve(Ir),this.autoPaging)for(var qr=Ir[0],$t=Ir[Ir.length-1],xr=qr;xr<$t+1;xr++){this.pdf.setPage(xr);var dr=xr===1?this.posY+this.margin[0]:this.margin[0],ni=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],nn=this.pdf.internal.pageSize.height-this.margin[2],yn=nn-this.margin[0],sr=this.pdf.internal.pageSize.width-this.margin[1],Zn=sr-this.margin[3],$r=xr===1?0:ni+(xr-2)*yn;if(this.ctx.clip_path.length!==0){var qn=this.path;Zt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=oe(Zt,this.posX+this.margin[3],-1*$r+dr),Pe.call(this,"fill",!0),this.path=qn}var jr=oe([JSON.parse(JSON.stringify(on))],this.posX+this.margin[3],-$r+dr+this.ctx.prevPageLastElemOffset)[0];ge.scale>=.01&&(Xt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Xt*ge.scale),Ze=this.lineWidth,this.lineWidth=Ze*ge.scale);var ir=this.autoPaging!=="text";if(ir||jr.y+jr.h<=nn){if(ir||jr.y>=dr&&jr.x<=sr){var Xn=ir?ge.text:this.pdf.splitTextToSize(ge.text,ge.maxWidth||sr-jr.x)[0],Bi=oe([JSON.parse(JSON.stringify(zn))],this.posX+this.margin[3],-$r+dr+this.ctx.prevPageLastElemOffset)[0],bi=ir&&(xr>qr||xr<$t)&&ae.call(this);bi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Zn,yn,null).clip().discardPath()),this.pdf.text(Xn,Bi.x,Bi.y,{angle:ge.angle,align:We,renderingMode:ge.renderingMode}),bi&&this.pdf.restoreGraphicsState()}}else jr.y<nn&&(this.ctx.prevPageLastElemOffset+=nn-jr.y);ge.scale>=.01&&(this.pdf.setFontSize(Xt),this.lineWidth=Ze)}else ge.scale>=.01&&(Xt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Xt*ge.scale),Ze=this.lineWidth,this.lineWidth=Ze*ge.scale),this.pdf.text(ge.text,It.x+this.posX,It.y+this.posY,{angle:ge.angle,align:We,renderingMode:ge.renderingMode,maxWidth:ge.maxWidth}),ge.scale>=.01&&(this.pdf.setFontSize(Xt),this.lineWidth=Ze)},te=function(ge,We,Ve,ut){Ve=Ve||0,ut=ut||0,this.pdf.internal.out(t(ge+Ve)+" "+i(We+ut)+" l")},Se=function(ge,We,Ve){return this.pdf.lines(ge,We,Ve,null,null)},De=function(ge,We,Ve,ut,pt,It,Oe,Wt){this.pdf.internal.out([e(a(Ve+ge)),e(c(ut+We)),e(a(pt+ge)),e(c(It+We)),e(a(Oe+ge)),e(c(Wt+We)),"c"].join(" "))},$e=function(ge,We,Ve,ut){for(var pt=2*Math.PI,It=Math.PI/2;We>Ve;)We-=pt;var Oe=Math.abs(Ve-We);Oe<pt&&ut&&(Oe=pt-Oe);for(var Wt=[],Zt=ut?-1:1,Xt=We;Oe>1e-5;){var Ze=Xt+Zt*Math.min(Oe,It);Wt.push(Ue.call(this,ge,Xt,Ze)),Oe-=Math.abs(Ze-Xt),Xt=Ze}return Wt},Ue=function(ge,We,Ve){var ut=(Ve-We)/2,pt=ge*Math.cos(ut),It=ge*Math.sin(ut),Oe=pt,Wt=-It,Zt=Oe*Oe+Wt*Wt,Xt=Zt+Oe*pt+Wt*It,Ze=4/3*(Math.sqrt(2*Zt*Xt)-Xt)/(Oe*It-Wt*pt),zn=Oe-Ze*Wt,on=Wt+Ze*Oe,mt=zn,Ir=-on,Fr=ut+We,qr=Math.cos(Fr),$t=Math.sin(Fr);return{x1:ge*Math.cos(We),y1:ge*Math.sin(We),x2:zn*qr-on*$t,y2:zn*$t+on*qr,x3:mt*qr-Ir*$t,y3:mt*$t+Ir*qr,x4:ge*Math.cos(Ve),y4:ge*Math.sin(Ve)}},Le=function(ge){return 180*ge/Math.PI},He=function(ge,We,Ve,ut,pt,It){var Oe=ge+.5*(Ve-ge),Wt=We+.5*(ut-We),Zt=pt+.5*(Ve-pt),Xt=It+.5*(ut-It),Ze=Math.min(ge,pt,Oe,Zt),zn=Math.max(ge,pt,Oe,Zt),on=Math.min(We,It,Wt,Xt),mt=Math.max(We,It,Wt,Xt);return new y(Ze,on,zn-Ze,mt-on)},Ke=function(ge,We,Ve,ut,pt,It,Oe,Wt){var Zt,Xt,Ze,zn,on,mt,Ir,Fr,qr,$t,xr,dr,ni,nn,yn=Ve-ge,sr=ut-We,Zn=pt-Ve,$r=It-ut,qn=Oe-pt,jr=Wt-It;for(Xt=0;Xt<41;Xt++)qr=(Ir=(Ze=ge+(Zt=Xt/40)*yn)+Zt*((on=Ve+Zt*Zn)-Ze))+Zt*(on+Zt*(pt+Zt*qn-on)-Ir),$t=(Fr=(zn=We+Zt*sr)+Zt*((mt=ut+Zt*$r)-zn))+Zt*(mt+Zt*(It+Zt*jr-mt)-Fr),Xt==0?(xr=qr,dr=$t,ni=qr,nn=$t):(xr=Math.min(xr,qr),dr=Math.min(dr,$t),ni=Math.max(ni,qr),nn=Math.max(nn,$t));return new y(Math.round(xr),Math.round(dr),Math.round(ni-xr),Math.round(nn-dr))},Ce=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var ge,We,Ve=(ge=this.ctx.lineDash,We=this.ctx.lineDashOffset,JSON.stringify({lineDash:ge,lineDashOffset:We}));this.prevLineDash!==Ve&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Ve)}}})($i.API),(function(n){var e=function(_){var y,s,T,L,R,U,M,Q,ae,ye;for(s=[],T=0,L=(_+=y="\0\0\0\0".slice(_.length%4||4)).length;L>T;T+=4)(R=(_.charCodeAt(T)<<24)+(_.charCodeAt(T+1)<<16)+(_.charCodeAt(T+2)<<8)+_.charCodeAt(T+3))!==0?(U=(R=((R=((R=((R=(R-(ye=R%85))/85)-(ae=R%85))/85)-(Q=R%85))/85)-(M=R%85))/85)%85,s.push(U+33,M+33,Q+33,ae+33,ye+33)):s.push(122);return(function(ie,oe){for(var ve=oe;ve>0;ve--)ie.pop()})(s,y.length),String.fromCharCode.apply(String,s)+"~>"},t=function(_){var y,s,T,L,R,U=String,M="length",Q=255,ae="charCodeAt",ye="slice",ie="replace";for(_[ye](-2),_=_[ye](0,-2)[ie](/\s/g,"")[ie]("z","!!!!!"),T=[],L=0,R=(_+=y="uuuuu"[ye](_[M]%5||5))[M];R>L;L+=5)s=52200625*(_[ae](L)-33)+614125*(_[ae](L+1)-33)+7225*(_[ae](L+2)-33)+85*(_[ae](L+3)-33)+(_[ae](L+4)-33),T.push(Q&s>>24,Q&s>>16,Q&s>>8,Q&s);return(function(oe,ve){for(var de=ve;de>0;de--)oe.pop()})(T,y[M]),U.fromCharCode.apply(U,T)},i=function(_){return _.split("").map(function(y){return("0"+y.charCodeAt().toString(16)).slice(-2)}).join("")+">"},a=function(_){var y=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((_=_.replace(/\s/g,"")).indexOf(">")!==-1&&(_=_.substr(0,_.indexOf(">"))),_.length%2&&(_+="0"),y.test(_)===!1)return"";for(var s="",T=0;T<_.length;T+=2)s+=String.fromCharCode("0x"+(_[T]+_[T+1]));return s},c=function(_){for(var y=new Uint8Array(_.length),s=_.length;s--;)y[s]=_.charCodeAt(s);return(y=t5(y)).reduce(function(T,L){return T+String.fromCharCode(L)},"")};n.processDataByFilters=function(_,y){var s=0,T=_||"",L=[];for(typeof(y=y||[])=="string"&&(y=[y]),s=0;s<y.length;s+=1)switch(y[s]){case"ASCII85Decode":case"/ASCII85Decode":T=t(T),L.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":T=e(T),L.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":T=a(T),L.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":T=i(T),L.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":T=c(T),L.push("/FlateDecode");break;default:throw new Error('The filter: "'+y[s]+'" is not implemented')}return{data:T,reverseChain:L.reverse().join(" ")}}})($i.API),(function(n){n.loadFile=function(e,t,i){return(function(a,c,_){c=c!==!1,_=typeof _=="function"?_:function(){};var y=void 0;try{y=(function(s,T,L){var R=new XMLHttpRequest,U=0,M=function(Q){var ae=Q.length,ye=[],ie=String.fromCharCode;for(U=0;U<ae;U+=1)ye.push(ie(255&Q.charCodeAt(U)));return ye.join("")};if(R.open("GET",s,!T),R.overrideMimeType("text/plain; charset=x-user-defined"),T===!1&&(R.onload=function(){R.status===200?L(M(this.responseText)):L(void 0)}),R.send(null),T&&R.status===200)return M(R.responseText)})(a,c,_)}catch{}return y})(e,t,i)},n.loadImageFile=n.loadFile})($i.API),(function(n){function e(){return(js.html2canvas?Promise.resolve(js.html2canvas):$b(()=>import("./html2canvas.esm-B0tyYwQk.js"),[])).catch(function(y){return Promise.reject(new Error("Could not load html2canvas: "+y))}).then(function(y){return y.default?y.default:y})}function t(){return(js.DOMPurify?Promise.resolve(js.DOMPurify):$b(()=>import("./purify.es-B6FQ9oRL.js"),[])).catch(function(y){return Promise.reject(new Error("Could not load dompurify: "+y))}).then(function(y){return y.default?y.default:y})}var i=function(y){var s=dl(y);return s==="undefined"?"undefined":s==="string"||y instanceof String?"string":s==="number"||y instanceof Number?"number":s==="function"||y instanceof Function?"function":y&&y.constructor===Array?"array":y&&y.nodeType===1?"element":s==="object"?"object":"unknown"},a=function(y,s){var T=document.createElement(y);for(var L in s.className&&(T.className=s.className),s.innerHTML&&s.dompurify&&(T.innerHTML=s.dompurify.sanitize(s.innerHTML)),s.style)T.style[L]=s.style[L];return T},c=function y(s,T){for(var L=s.nodeType===3?document.createTextNode(s.nodeValue):s.cloneNode(!1),R=s.firstChild;R;R=R.nextSibling)T!==!0&&R.nodeType===1&&R.nodeName==="SCRIPT"||L.appendChild(y(R,T));return s.nodeType===1&&(s.nodeName==="CANVAS"?(L.width=s.width,L.height=s.height,L.getContext("2d").drawImage(s,0,0)):s.nodeName!=="TEXTAREA"&&s.nodeName!=="SELECT"||(L.value=s.value),L.addEventListener("load",function(){L.scrollTop=s.scrollTop,L.scrollLeft=s.scrollLeft},!0)),L},_=function y(s){var T=Object.assign(y.convert(Promise.resolve()),JSON.parse(JSON.stringify(y.template))),L=y.convert(Promise.resolve(),T);return(L=L.setProgress(1,y,1,[y])).set(s)};(_.prototype=Object.create(Promise.prototype)).constructor=_,_.convert=function(y,s){return y.__proto__=s||_.prototype,y},_.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},_.prototype.from=function(y,s){return this.then(function(){switch(s=s||(function(T){switch(i(T)){case"string":return"string";case"element":return T.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(y),s){case"string":return this.then(t).then(function(T){return this.set({src:a("div",{innerHTML:y,dompurify:T})})});case"element":return this.set({src:y});case"canvas":return this.set({canvas:y});case"img":return this.set({img:y});default:return this.error("Unknown source type.")}})},_.prototype.to=function(y){switch(y){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},_.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var y={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},s=c(this.prop.src,this.opt.html2canvas.javascriptEnabled);s.tagName==="BODY"&&(y.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=a("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=a("div",{className:"html2pdf__container",style:y}),this.prop.container.appendChild(s),this.prop.container.firstChild.appendChild(a("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},_.prototype.toCanvas=function(){var y=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(y).then(e).then(function(s){var T=Object.assign({},this.opt.html2canvas);return delete T.onrendered,s(this.prop.container,T)}).then(function(s){(this.opt.html2canvas.onrendered||function(){})(s),this.prop.canvas=s,document.body.removeChild(this.prop.overlay)})},_.prototype.toContext2d=function(){var y=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(y).then(e).then(function(s){var T=this.opt.jsPDF,L=this.opt.fontFaces,R=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,U=Object.assign({async:!0,allowTaint:!0,scale:R,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete U.onrendered,T.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,T.context2d.posX=this.opt.x,T.context2d.posY=this.opt.y,T.context2d.margin=this.opt.margin,T.context2d.fontFaces=L,L)for(var M=0;M<L.length;++M){var Q=L[M],ae=Q.src.find(function(ye){return ye.format==="truetype"});ae&&T.addFont(ae.url,Q.ref.name,Q.ref.style)}return U.windowHeight=U.windowHeight||0,U.windowHeight=U.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):U.windowHeight,T.context2d.save(!0),s(this.prop.container,U)}).then(function(s){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(s),this.prop.canvas=s,document.body.removeChild(this.prop.overlay)})},_.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var y=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=y})},_.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},_.prototype.output=function(y,s,T){return(T=T||"pdf").toLowerCase()==="img"||T.toLowerCase()==="image"?this.outputImg(y,s):this.outputPdf(y,s)},_.prototype.outputPdf=function(y,s){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(y,s)})},_.prototype.outputImg=function(y){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(y){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+y+'" is not supported.'}})},_.prototype.save=function(y){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(y?{filename:y}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},_.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},_.prototype.set=function(y){if(i(y)!=="object")return this;var s=Object.keys(y||{}).map(function(T){if(T in _.template.prop)return function(){this.prop[T]=y[T]};switch(T){case"margin":return this.setMargin.bind(this,y.margin);case"jsPDF":return function(){return this.opt.jsPDF=y.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,y.pageSize);default:return function(){this.opt[T]=y[T]}}},this);return this.then(function(){return this.thenList(s)})},_.prototype.get=function(y,s){return this.then(function(){var T=y in _.template.prop?this.prop[y]:this.opt[y];return s?s(T):T})},_.prototype.setMargin=function(y){return this.then(function(){switch(i(y)){case"number":y=[y,y,y,y];case"array":if(y.length===2&&(y=[y[0],y[1],y[0],y[1]]),y.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=y}).then(this.setPageSize)},_.prototype.setPageSize=function(y){function s(T,L){return Math.floor(T*L/72*96)}return this.then(function(){(y=y||$i.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(y.inner={width:y.width-this.opt.margin[1]-this.opt.margin[3],height:y.height-this.opt.margin[0]-this.opt.margin[2]},y.inner.px={width:s(y.inner.width,y.k),height:s(y.inner.height,y.k)},y.inner.ratio=y.inner.height/y.inner.width),this.prop.pageSize=y})},_.prototype.setProgress=function(y,s,T,L){return y!=null&&(this.progress.val=y),s!=null&&(this.progress.state=s),T!=null&&(this.progress.n=T),L!=null&&(this.progress.stack=L),this.progress.ratio=this.progress.val/this.progress.state,this},_.prototype.updateProgress=function(y,s,T,L){return this.setProgress(y?this.progress.val+y:null,s||null,T?this.progress.n+T:null,L?this.progress.stack.concat(L):null)},_.prototype.then=function(y,s){var T=this;return this.thenCore(y,s,function(L,R){return T.updateProgress(null,null,1,[L]),Promise.prototype.then.call(this,function(U){return T.updateProgress(null,L),U}).then(L,R).then(function(U){return T.updateProgress(1),U})})},_.prototype.thenCore=function(y,s,T){T=T||Promise.prototype.then;var L=this;y&&(y=y.bind(L)),s&&(s=s.bind(L));var R=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?L:_.convert(Object.assign({},L),Promise.prototype),U=T.call(R,y,s);return _.convert(U,L.__proto__)},_.prototype.thenExternal=function(y,s){return Promise.prototype.then.call(this,y,s)},_.prototype.thenList=function(y){var s=this;return y.forEach(function(T){s=s.thenCore(T)}),s},_.prototype.catch=function(y){y&&(y=y.bind(this));var s=Promise.prototype.catch.call(this,y);return _.convert(s,this)},_.prototype.catchExternal=function(y){return Promise.prototype.catch.call(this,y)},_.prototype.error=function(y){return this.then(function(){throw new Error(y)})},_.prototype.using=_.prototype.set,_.prototype.saveAs=_.prototype.save,_.prototype.export=_.prototype.output,_.prototype.run=_.prototype.then,$i.getPageSize=function(y,s,T){if(dl(y)==="object"){var L=y;y=L.orientation,s=L.unit||s,T=L.format||T}s=s||"mm",T=T||"a4",y=(""+(y||"P")).toLowerCase();var R,U=(""+T).toLowerCase(),M={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(s){case"pt":R=1;break;case"mm":R=72/25.4;break;case"cm":R=72/2.54;break;case"in":R=72;break;case"px":R=.75;break;case"pc":case"em":R=12;break;case"ex":R=6;break;default:throw"Invalid unit: "+s}var Q,ae=0,ye=0;if(M.hasOwnProperty(U))ae=M[U][1]/R,ye=M[U][0]/R;else try{ae=T[1],ye=T[0]}catch{throw new Error("Invalid format: "+T)}if(y==="p"||y==="portrait")y="p",ye>ae&&(Q=ye,ye=ae,ae=Q);else{if(y!=="l"&&y!=="landscape")throw"Invalid orientation: "+y;y="l",ae>ye&&(Q=ye,ye=ae,ae=Q)}return{width:ye,height:ae,unit:s,k:R,orientation:y}},n.html=function(y,s){(s=s||{}).callback=s.callback||function(){},s.html2canvas=s.html2canvas||{},s.html2canvas.canvas=s.html2canvas.canvas||this.canvas,s.jsPDF=s.jsPDF||this,s.fontFaces=s.fontFaces?s.fontFaces.map(uw):null;var T=new _(s);return s.worker?T:T.from(y).doCallback()}})($i.API),$i.API.addJS=function(n){return _E=n,this.internal.events.subscribe("postPutResources",function(){D1=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(D1+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),yE=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+_E+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){D1!==void 0&&yE!==void 0&&this.internal.out("/Names <</JavaScript "+D1+" 0 R>>")}),this},(function(n){var e;n.events.push(["postPutResources",function(){var t=this,i=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var a=t.outline.render().split(/\r\n/),c=0;c<a.length;c++){var _=a[c],y=i.exec(_);if(y!=null){var s=y[1];t.internal.newObjectDeferredBegin(s,!1)}t.internal.write(_)}if(this.outline.createNamedDestinations){var T=this.internal.pages.length,L=[];for(c=0;c<T;c++){var R=t.internal.newObject();L.push(R);var U=t.internal.getPageInfo(c+1);t.internal.write("<< /D["+U.objId+" 0 R /XYZ null null null]>> endobj")}var M=t.internal.newObject();for(t.internal.write("<< /Names [ "),c=0;c<L.length;c++)t.internal.write("(page_"+(c+1)+")"+L[c]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+M+" 0 R"),t.internal.write(">>","endobj")}}]),n.events.push(["putCatalog",function(){var t=this;t.outline.root.children.length>0&&(t.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&t.internal.write("/Names "+e+" 0 R"))}]),n.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(i,a,c){var _={title:a,options:c,children:[]};return i==null&&(i=this.root),i.children.push(_),_},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(i){i.id=t.internal.newObjectDeferred();for(var a=0;a<i.children.length;a++)this.genIds_r(i.children[a])},t.outline.renderRoot=function(i){this.objStart(i),this.line("/Type /Outlines"),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1]))),this.line("/Count "+this.count_r({count:0},i)),this.objEnd()},t.outline.renderItems=function(i){for(var a=this.ctx.pdf.internal.getVerticalCoordinateString,c=0;c<i.children.length;c++){var _=i.children[c];this.objStart(_),this.line("/Title "+this.makeString(_.title)),this.line("/Parent "+this.makeRef(i)),c>0&&this.line("/Prev "+this.makeRef(i.children[c-1])),c<i.children.length-1&&this.line("/Next "+this.makeRef(i.children[c+1])),_.children.length>0&&(this.line("/First "+this.makeRef(_.children[0])),this.line("/Last "+this.makeRef(_.children[_.children.length-1])));var y=this.count=this.count_r({count:0},_);if(y>0&&this.line("/Count "+y),_.options&&_.options.pageNumber){var s=t.internal.getPageInfo(_.options.pageNumber);this.line("/Dest ["+s.objId+" 0 R /XYZ 0 "+a(0)+" 0]")}this.objEnd()}for(var T=0;T<i.children.length;T++)this.renderItems(i.children[T])},t.outline.line=function(i){this.ctx.val+=i+`\r
`},t.outline.makeRef=function(i){return i.id+" 0 R"},t.outline.makeString=function(i){return"("+t.internal.pdfEscape(i)+")"},t.outline.objStart=function(i){this.ctx.val+=`\r
`+i.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(i,a){for(var c=0;c<a.children.length;c++)i.count++,this.count_r(i,a.children[c]);return i.count}}])})($i.API),(function(n){var e=[192,193,194,195,196,197,198,199];n.processJPEG=function(t,i,a,c,_,y){var s,T=this.decode.DCT_DECODE,L=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=_||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,s=(function(R){for(var U,M=256*R.charCodeAt(4)+R.charCodeAt(5),Q=R.length,ae={width:0,height:0,numcomponents:1},ye=4;ye<Q;ye+=2){if(ye+=M,e.indexOf(R.charCodeAt(ye+1))!==-1){U=256*R.charCodeAt(ye+5)+R.charCodeAt(ye+6),ae={width:256*R.charCodeAt(ye+7)+R.charCodeAt(ye+8),height:U,numcomponents:R.charCodeAt(ye+9)};break}M=256*R.charCodeAt(ye+2)+R.charCodeAt(ye+3)}return ae})(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t),s.numcomponents){case 1:y=this.color_spaces.DEVICE_GRAY;break;case 4:y=this.color_spaces.DEVICE_CMYK;break;case 3:y=this.color_spaces.DEVICE_RGB}L={data:t,width:s.width,height:s.height,colorSpace:y,bitsPerComponent:8,filter:T,index:i,alias:a}}return L}})($i.API),$i.API.processPNG=function(n,e,t,i){if(this.__addimage__.isArrayBuffer(n)&&(n=new Uint8Array(n)),this.__addimage__.isArrayBufferView(n)){var a,c=HM(n,{checkCrc:!0}),_=c.width,y=c.height,s=c.channels,T=c.palette,L=c.depth;a=T&&s===1?(function(G){for(var B=G.width,Y=G.height,$=G.data,J=G.palette,te=G.depth,Se=!1,De=[],$e=[],Ue=void 0,Le=!1,He=0,Ke=0;Ke<J.length;Ke++){var Ce=wS(J[Ke],4),ge=Ce[0],We=Ce[1],Ve=Ce[2],ut=Ce[3];De.push(ge,We,Ve),ut!=null&&(ut===0?(He++,$e.length<1&&$e.push(Ke)):ut<255&&(Le=!0))}if(Le||He>1){Se=!0,$e=void 0;var pt=B*Y;Ue=new Uint8Array(pt);for(var It=new DataView($.buffer),Oe=0;Oe<pt;Oe++){var Wt=hw(It,Oe,te),Zt=wS(J[Wt],4)[3];Ue[Oe]=Zt}}else He===0&&($e=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:Se?8:void 0,colorBytes:$,alphaBytes:Ue,needSMask:Se,palette:De,mask:$e}})(c):s===2||s===4?(function(G){for(var B=G.data,Y=G.width,$=G.height,J=G.channels,te=G.depth,Se=J===2?"DeviceGray":"DeviceRGB",De=J-1,$e=Y*$,Ue=De,Le=$e*Ue,He=1*$e,Ke=Math.ceil(Le*te/8),Ce=Math.ceil(He*te/8),ge=new Uint8Array(Ke),We=new Uint8Array(Ce),Ve=new DataView(B.buffer),ut=new DataView(ge.buffer),pt=new DataView(We.buffer),It=!1,Oe=0;Oe<$e;Oe++){for(var Wt=Oe*J,Zt=0;Zt<Ue;Zt++)IE(ut,hw(Ve,Wt+Zt,te),Oe*Ue+Zt,te);var Xt=hw(Ve,Wt+Ue,te);Xt<(1<<te)-1&&(It=!0),IE(pt,Xt,1*Oe,te)}return{colorSpace:Se,colorsPerPixel:De,sMaskBitsPerComponent:It?te:void 0,colorBytes:ge,alphaBytes:We,needSMask:It}})(c):(function(G){var B=G.data,Y=G.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:Y,colorsPerPixel:Y==="DeviceGray"?1:3,colorBytes:B instanceof Uint16Array?(function($){for(var J=$.length,te=new Uint8Array(2*J),Se=new DataView(te.buffer,te.byteOffset,te.byteLength),De=0;De<J;De++)Se.setUint16(2*De,$[De],!1);return te})(B):B,needSMask:!1}})(c);var R,U,M,Q=a,ae=Q.colorSpace,ye=Q.colorsPerPixel,ie=Q.sMaskBitsPerComponent,oe=Q.colorBytes,ve=Q.alphaBytes,de=Q.needSMask,Pe=Q.palette,Be=Q.mask,_e=null;return i!==$i.API.image_compression.NONE&&typeof t5=="function"?(_e=(function(G){var B;switch(G){case $i.API.image_compression.FAST:B=11;break;case $i.API.image_compression.MEDIUM:B=13;break;case $i.API.image_compression.SLOW:B=14;break;default:B=12}return B})(i),R=this.decode.FLATE_DECODE,U="/Predictor ".concat(_e," /Colors ").concat(ye," /BitsPerComponent ").concat(L," /Columns ").concat(_),n=wE(oe,Math.ceil(_*ye*L/8),ye,L,i),de&&(M=wE(ve,Math.ceil(_*ie/8),1,ie,i))):(R=void 0,U=void 0,n=oe,de&&(M=ve)),(this.__addimage__.isArrayBuffer(n)||this.__addimage__.isArrayBufferView(n))&&(n=this.__addimage__.arrayBufferToBinaryString(n)),(M&&this.__addimage__.isArrayBuffer(M)||this.__addimage__.isArrayBufferView(M))&&(M=this.__addimage__.arrayBufferToBinaryString(M)),{alias:t,data:n,index:e,filter:R,decodeParameters:U,transparency:Be,palette:Pe,sMask:M,predictor:_e,width:_,height:y,bitsPerComponent:L,sMaskBitsPerComponent:ie,colorSpace:ae}}},(function(n){n.processGIF89A=function(e,t,i,a){var c=new d7(e),_=c.width,y=c.height,s=[];c.decodeAndBlitFrameRGBA(0,s);var T={data:s,width:_,height:y},L=new fw(100).encode(T,100);return n.processJPEG.call(this,L,t,i,a)},n.processGIF87A=n.processGIF89A})($i.API),rd.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var n=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(n);for(var e=0;e<n;e++){var t=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:a,green:i,blue:t,quad:c}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},rd.prototype.parseBGR=function(){this.pos=this.offset;try{var n="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[n]()}catch(t){Dl.log("bit decode error:"+t)}},rd.prototype.bit1=function(){var n,e=Math.ceil(this.width/8),t=e%4;for(n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,a=0;a<e;a++)for(var c=this.datav.getUint8(this.pos++,!0),_=i*this.width*4+8*a*4,y=0;y<8&&8*a+y<this.width;y++){var s=this.palette[c>>7-y&1];this.data[_+4*y]=s.blue,this.data[_+4*y+1]=s.green,this.data[_+4*y+2]=s.red,this.data[_+4*y+3]=255}t!==0&&(this.pos+=4-t)}},rd.prototype.bit4=function(){for(var n=Math.ceil(this.width/2),e=n%4,t=this.height-1;t>=0;t--){for(var i=this.bottom_up?t:this.height-1-t,a=0;a<n;a++){var c=this.datav.getUint8(this.pos++,!0),_=i*this.width*4+2*a*4,y=c>>4,s=15&c,T=this.palette[y];if(this.data[_]=T.blue,this.data[_+1]=T.green,this.data[_+2]=T.red,this.data[_+3]=255,2*a+1>=this.width)break;T=this.palette[s],this.data[_+4]=T.blue,this.data[_+4+1]=T.green,this.data[_+4+2]=T.red,this.data[_+4+3]=255}e!==0&&(this.pos+=4-e)}},rd.prototype.bit8=function(){for(var n=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,i=0;i<this.width;i++){var a=this.datav.getUint8(this.pos++,!0),c=t*this.width*4+4*i;if(a<this.palette.length){var _=this.palette[a];this.data[c]=_.red,this.data[c+1]=_.green,this.data[c+2]=_.blue,this.data[c+3]=255}else this.data[c]=255,this.data[c+1]=255,this.data[c+2]=255,this.data[c+3]=255}n!==0&&(this.pos+=4-n)}},rd.prototype.bit15=function(){for(var n=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var i=this.bottom_up?t:this.height-1-t,a=0;a<this.width;a++){var c=this.datav.getUint16(this.pos,!0);this.pos+=2;var _=(c&e)/e*255|0,y=(c>>5&e)/e*255|0,s=(c>>10&e)/e*255|0,T=c>>15?255:0,L=i*this.width*4+4*a;this.data[L]=s,this.data[L+1]=y,this.data[L+2]=_,this.data[L+3]=T}this.pos+=n}},rd.prototype.bit16=function(){for(var n=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),i=this.height-1;i>=0;i--){for(var a=this.bottom_up?i:this.height-1-i,c=0;c<this.width;c++){var _=this.datav.getUint16(this.pos,!0);this.pos+=2;var y=(_&e)/e*255|0,s=(_>>5&t)/t*255|0,T=(_>>11)/e*255|0,L=a*this.width*4+4*c;this.data[L]=T,this.data[L+1]=s,this.data[L+2]=y,this.data[L+3]=255}this.pos+=n}},rd.prototype.bit24=function(){for(var n=this.height-1;n>=0;n--){for(var e=this.bottom_up?n:this.height-1-n,t=0;t<this.width;t++){var i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),_=e*this.width*4+4*t;this.data[_]=c,this.data[_+1]=a,this.data[_+2]=i,this.data[_+3]=255}this.pos+=this.width%4}},rd.prototype.bit32=function(){for(var n=this.height-1;n>=0;n--)for(var e=this.bottom_up?n:this.height-1-n,t=0;t<this.width;t++){var i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),_=this.datav.getUint8(this.pos++,!0),y=e*this.width*4+4*t;this.data[y]=c,this.data[y+1]=a,this.data[y+2]=i,this.data[y+3]=_}},rd.prototype.getData=function(){return this.data},(function(n){n.processBMP=function(e,t,i,a){var c=new rd(e,!1),_=c.width,y=c.height,s={data:c.getData(),width:_,height:y},T=new fw(100).encode(s,100);return n.processJPEG.call(this,T,t,i,a)}})($i.API),kE.prototype.getData=function(){return this.data},(function(n){n.processWEBP=function(e,t,i,a){var c=new kE(e),_=c.width,y=c.height,s={data:c.getData(),width:_,height:y},T=new fw(100).encode(s,100);return n.processJPEG.call(this,T,t,i,a)}})($i.API),$i.API.processRGBA=function(n,e,t){for(var i=n.data,a=i.length,c=new Uint8Array(a/4*3),_=new Uint8Array(a/4),y=0,s=0,T=0;T<a;T+=4){var L=i[T],R=i[T+1],U=i[T+2],M=i[T+3];c[y++]=L,c[y++]=R,c[y++]=U,_[s++]=M}var Q=this.__addimage__.arrayBufferToBinaryString(c);return{alpha:this.__addimage__.arrayBufferToBinaryString(_),data:Q,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:n.width,height:n.height}},$i.API.setLanguage=function(n){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[n]!==void 0&&(this.internal.languageSettings.languageCode=n,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},ny=$i.API,O1=ny.getCharWidthsArray=function(n,e){var t,i,a=(e=e||{}).font||this.internal.getFont(),c=e.fontSize||this.internal.getFontSize(),_=e.charSpace||this.internal.getCharSpace(),y=e.widths?e.widths:a.metadata.Unicode.widths,s=y.fof?y.fof:1,T=e.kerning?e.kerning:a.metadata.Unicode.kerning,L=T.fof?T.fof:1,R=e.doKerning!==!1,U=0,M=n.length,Q=0,ae=y[0]||s,ye=[];for(t=0;t<M;t++)i=n.charCodeAt(t),typeof a.metadata.widthOfString=="function"?ye.push((a.metadata.widthOfGlyph(a.metadata.characterToGlyph(i))+_*(1e3/c)||0)/1e3):(U=R&&dl(T[i])==="object"&&!isNaN(parseInt(T[i][Q],10))?T[i][Q]/L:0,ye.push((y[i]||ae)/s+U)),Q=i;return ye},vE=ny.getStringUnitWidth=function(n,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),i=e.font||this.internal.getFont(),a=e.charSpace||this.internal.getCharSpace();return ny.processArabic&&(n=ny.processArabic(n)),typeof i.metadata.widthOfString=="function"?i.metadata.widthOfString(n,t,a)/t:O1.apply(this,arguments).reduce(function(c,_){return c+_},0)},xE=function(n,e,t,i){for(var a=[],c=0,_=n.length,y=0;c!==_&&y+e[c]<t;)y+=e[c],c++;a.push(n.slice(0,c));var s=c;for(y=0;c!==_;)y+e[c]>i&&(a.push(n.slice(s,c)),y=0,s=c),y+=e[c],c++;return s!==c&&a.push(n.slice(s,c)),a},bE=function(n,e,t){t||(t={});var i,a,c,_,y,s,T,L=[],R=[L],U=t.textIndent||0,M=0,Q=0,ae=n.split(" "),ye=O1.apply(this,[" ",t])[0];if(s=t.lineIndent===-1?ae[0].length+2:t.lineIndent||0){var ie=Array(s).join(" "),oe=[];ae.map(function(de){(de=de.split(/\s*\n/)).length>1?oe=oe.concat(de.map(function(Pe,Be){return(Be&&Pe.length?`
`:"")+Pe})):oe.push(de[0])}),ae=oe,s=vE.apply(this,[ie,t])}for(c=0,_=ae.length;c<_;c++){var ve=0;if(i=ae[c],s&&i[0]==`
`&&(i=i.substr(1),ve=1),U+M+(Q=(a=O1.apply(this,[i,t])).reduce(function(de,Pe){return de+Pe},0))>e||ve){if(Q>e){for(y=xE.apply(this,[i,a,e-(U+M),e]),L.push(y.shift()),L=[y.pop()];y.length;)R.push([y.shift()]);Q=a.slice(i.length-(L[0]?L[0].length:0)).reduce(function(de,Pe){return de+Pe},0)}else L=[i];R.push(L),U=Q+s,M=ye}else L.push(i),U+=M+Q,M=ye}return T=s?function(de,Pe){return(Pe?ie:"")+de.join(" ")}:function(de){return de.join(" ")},R.map(T)},ny.splitTextToSize=function(n,e,t){var i,a=(t=t||{}).fontSize||this.internal.getFontSize(),c=(function(L){if(L.widths&&L.kerning)return{widths:L.widths,kerning:L.kerning};var R=this.internal.getFont(L.fontName,L.fontStyle),U="Unicode";return R.metadata[U]?{widths:R.metadata[U].widths||{0:1},kerning:R.metadata[U].kerning||{}}:{font:R.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);i=Array.isArray(n)?n:String(n).split(/\r?\n/);var _=1*this.internal.scaleFactor*e/a;c.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/a:0,c.lineIndent=t.lineIndent;var y,s,T=[];for(y=0,s=i.length;y<s;y++)T=T.concat(bE.apply(this,[i[y],_,c]));return T},(function(n){n.__fontmetrics__=n.__fontmetrics__||{};for(var e="0123456789abcdef",t="klmnopqrstuvwxyz",i={},a={},c=0;c<16;c++)i[t[c]]=e[c],a[e[c]]=t[c];var _=function(U){return"0x"+parseInt(U,10).toString(16)},y=n.__fontmetrics__.compress=function(U){var M,Q,ae,ye,ie=["{"];for(var oe in U){if(M=U[oe],isNaN(parseInt(oe,10))?Q="'"+oe+"'":(oe=parseInt(oe,10),Q=(Q=_(oe).slice(2)).slice(0,-1)+a[Q.slice(-1)]),typeof M=="number")M<0?(ae=_(M).slice(3),ye="-"):(ae=_(M).slice(2),ye=""),ae=ye+ae.slice(0,-1)+a[ae.slice(-1)];else{if(dl(M)!=="object")throw new Error("Don't know what to do with value type "+dl(M)+".");ae=y(M)}ie.push(Q+ae)}return ie.push("}"),ie.join("")},s=n.__fontmetrics__.uncompress=function(U){if(typeof U!="string")throw new Error("Invalid argument passed to uncompress.");for(var M,Q,ae,ye,ie={},oe=1,ve=ie,de=[],Pe="",Be="",_e=U.length-1,G=1;G<_e;G+=1)(ye=U[G])=="'"?M?(ae=M.join(""),M=void 0):M=[]:M?M.push(ye):ye=="{"?(de.push([ve,ae]),ve={},ae=void 0):ye=="}"?((Q=de.pop())[0][Q[1]]=ve,ae=void 0,ve=Q[0]):ye=="-"?oe=-1:ae===void 0?i.hasOwnProperty(ye)?(Pe+=i[ye],ae=parseInt(Pe,16)*oe,oe=1,Pe=""):Pe+=ye:i.hasOwnProperty(ye)?(Be+=i[ye],ve[ae]=parseInt(Be,16)*oe,oe=1,ae=void 0,Be=""):Be+=ye;return ie},T={codePages:["WinAnsiEncoding"],WinAnsiEncoding:s("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},L={Unicode:{Courier:T,"Courier-Bold":T,"Courier-BoldOblique":T,"Courier-Oblique":T,Helvetica:T,"Helvetica-Bold":T,"Helvetica-BoldOblique":T,"Helvetica-Oblique":T,"Times-Roman":T,"Times-Bold":T,"Times-BoldItalic":T,"Times-Italic":T}},R={Unicode:{"Courier-Oblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":s("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":s("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:s("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:s("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":s("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":s("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};n.events.push(["addFont",function(U){var M=U.font,Q=R.Unicode[M.postScriptName];Q&&(M.metadata.Unicode={},M.metadata.Unicode.widths=Q.widths,M.metadata.Unicode.kerning=Q.kerning);var ae=L.Unicode[M.postScriptName];ae&&(M.metadata.Unicode.encoding=ae,M.encoding=ae.codePages[0])}])})($i.API),(function(n){var e=function(t){for(var i=t.length,a=new Uint8Array(i),c=0;c<i;c++)a[c]=t.charCodeAt(c);return a};n.API.events.push(["addFont",function(t){var i=void 0,a=t.font,c=t.instance;if(!a.isStandardFont){if(c===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");if(typeof(i=c.existsFileInVFS(a.postScriptName)===!1?c.loadFile(a.postScriptName):c.getFileFromVFS(a.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");(function(_,y){y=/^\x00\x01\x00\x00/.test(y)?e(y):e(lv(y)),_.metadata=n.API.TTFFont.open(y),_.metadata.Unicode=_.metadata.Unicode||{encoding:{},kerning:{},widths:[]},_.metadata.glyIdsUsed=[0]})(a,i)}}])})($i),$i.API.addSvgAsImage=function(n,e,t,i,a,c,_,y){if(isNaN(e)||isNaN(t))throw Dl.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(i)||isNaN(a))throw Dl.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var s=document.createElement("canvas");s.width=i,s.height=a;var T=s.getContext("2d");T.fillStyle="#fff",T.fillRect(0,0,s.width,s.height);var L={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},R=this;return(js.canvg?Promise.resolve(js.canvg):$b(()=>import("./index.es-aHzVbSfI.js"),[])).catch(function(U){return Promise.reject(new Error("Could not load canvg: "+U))}).then(function(U){return U.default?U.default:U}).then(function(U){return U.fromString(T,n,L)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(U){return U.render(L)}).then(function(){R.addImage(s.toDataURL("image/jpeg",1),e,t,i,a,_,y)})},$i.API.putTotalPages=function(n){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(n,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(n,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var i=1;i<=this.internal.getNumberOfPages();i++)for(var a=0;a<this.internal.pages[i].length;a++)this.internal.pages[i][a]=this.internal.pages[i][a].replace(e,t);return this},$i.API.viewerPreferences=function(n,e){var t;n=n||{},e=e||!1;var i,a,c,_={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},y=Object.keys(_),s=[],T=0,L=0,R=0;function U(Q,ae){var ye,ie=!1;for(ye=0;ye<Q.length;ye+=1)Q[ye]===ae&&(ie=!0);return ie}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(_)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,n==="reset"||e===!0){var M=y.length;for(R=0;R<M;R+=1)t[y[R]].value=t[y[R]].defaultValue,t[y[R]].explicitSet=!1}if(dl(n)==="object"){for(a in n)if(c=n[a],U(y,a)&&c!==void 0){if(t[a].type==="boolean"&&typeof c=="boolean")t[a].value=c;else if(t[a].type==="name"&&U(t[a].valueSet,c))t[a].value=c;else if(t[a].type==="integer"&&Number.isInteger(c))t[a].value=c;else if(t[a].type==="array"){for(T=0;T<c.length;T+=1)if(i=!0,c[T].length===1&&typeof c[T][0]=="number")s.push(String(c[T]-1));else if(c[T].length>1){for(L=0;L<c[T].length;L+=1)typeof c[T][L]!="number"&&(i=!1);i===!0&&s.push([c[T][0]-1,c[T][1]-1].join(" "))}t[a].value="["+s.join(" ")+"]"}else t[a].value=t[a].defaultValue;t[a].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var Q,ae=[];for(Q in t)t[Q].explicitSet===!0&&(t[Q].type==="name"?ae.push("/"+Q+" /"+t[Q].value):ae.push("/"+Q+" "+t[Q].value));ae.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+ae.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},(function(n){var e=function(){var i='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',a=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),c=unescape(encodeURIComponent(i)),_=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),y=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),s=unescape(encodeURIComponent("</x:xmpmeta>")),T=c.length+_.length+y.length+a.length+s.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+T+" >>"),this.internal.write("stream"),this.internal.write(a+c+_+y+s),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};n.addMetadata=function(i,a){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:i,namespaceuri:a||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}})($i.API),(function(n){var e=n.API,t=e.pdfEscape16=function(c,_){for(var y,s=_.metadata.Unicode.widths,T=["","0","00","000","0000"],L=[""],R=0,U=c.length;R<U;++R){if(y=_.metadata.characterToGlyph(c.charCodeAt(R)),_.metadata.glyIdsUsed.push(y),_.metadata.toUnicode[y]=c.charCodeAt(R),s.indexOf(y)==-1&&(s.push(y),s.push([parseInt(_.metadata.widthOfGlyph(y),10)])),y=="0")return L.join("");y=y.toString(16),L.push(T[4-y.length],y)}return L.join("")},i=function(c){var _,y,s,T,L,R,U;for(L=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,s=[],R=0,U=(y=Object.keys(c).sort(function(M,Q){return M-Q})).length;R<U;R++)_=y[R],s.length>=100&&(L+=`
`+s.length+` beginbfchar
`+s.join(`
`)+`
endbfchar`,s=[]),c[_]!==void 0&&c[_]!==null&&typeof c[_].toString=="function"&&(T=("0000"+c[_].toString(16)).slice(-4),_=("0000"+(+_).toString(16)).slice(-4),s.push("<"+_+"><"+T+">"));return s.length&&(L+=`
`+s.length+` beginbfchar
`+s.join(`
`)+`
endbfchar
`),L+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(c){(function(_){var y=_.font,s=_.out,T=_.newObject,L=_.putStream;if(y.metadata instanceof n.API.TTFFont&&y.encoding==="Identity-H"){for(var R=y.metadata.Unicode.widths,U=y.metadata.subset.encode(y.metadata.glyIdsUsed,1),M="",Q=0;Q<U.length;Q++)M+=String.fromCharCode(U[Q]);var ae=T();L({data:M,addLength1:!0,objectId:ae}),s("endobj");var ye=T();L({data:i(y.metadata.toUnicode),addLength1:!0,objectId:ye}),s("endobj");var ie=T();s("<<"),s("/Type /FontDescriptor"),s("/FontName /"+cy(y.fontName)),s("/FontFile2 "+ae+" 0 R"),s("/FontBBox "+n.API.PDFObject.convert(y.metadata.bbox)),s("/Flags "+y.metadata.flags),s("/StemV "+y.metadata.stemV),s("/ItalicAngle "+y.metadata.italicAngle),s("/Ascent "+y.metadata.ascender),s("/Descent "+y.metadata.decender),s("/CapHeight "+y.metadata.capHeight),s(">>"),s("endobj");var oe=T();s("<<"),s("/Type /Font"),s("/BaseFont /"+cy(y.fontName)),s("/FontDescriptor "+ie+" 0 R"),s("/W "+n.API.PDFObject.convert(R)),s("/CIDToGIDMap /Identity"),s("/DW 1000"),s("/Subtype /CIDFontType2"),s("/CIDSystemInfo"),s("<<"),s("/Supplement 0"),s("/Registry (Adobe)"),s("/Ordering ("+y.encoding+")"),s(">>"),s(">>"),s("endobj"),y.objectNumber=T(),s("<<"),s("/Type /Font"),s("/Subtype /Type0"),s("/ToUnicode "+ye+" 0 R"),s("/BaseFont /"+cy(y.fontName)),s("/Encoding /"+y.encoding),s("/DescendantFonts ["+oe+" 0 R]"),s(">>"),s("endobj"),y.isAlreadyPutted=!0}})(c)}]),e.events.push(["putFont",function(c){(function(_){var y=_.font,s=_.out,T=_.newObject,L=_.putStream;if(y.metadata instanceof n.API.TTFFont&&y.encoding==="WinAnsiEncoding"){for(var R=y.metadata.rawData,U="",M=0;M<R.length;M++)U+=String.fromCharCode(R[M]);var Q=T();L({data:U,addLength1:!0,objectId:Q}),s("endobj");var ae=T();L({data:i(y.metadata.toUnicode),addLength1:!0,objectId:ae}),s("endobj");var ye=T();s("<<"),s("/Descent "+y.metadata.decender),s("/CapHeight "+y.metadata.capHeight),s("/StemV "+y.metadata.stemV),s("/Type /FontDescriptor"),s("/FontFile2 "+Q+" 0 R"),s("/Flags 96"),s("/FontBBox "+n.API.PDFObject.convert(y.metadata.bbox)),s("/FontName /"+cy(y.fontName)),s("/ItalicAngle "+y.metadata.italicAngle),s("/Ascent "+y.metadata.ascender),s(">>"),s("endobj"),y.objectNumber=T();for(var ie=0;ie<y.metadata.hmtx.widths.length;ie++)y.metadata.hmtx.widths[ie]=parseInt(y.metadata.hmtx.widths[ie]*(1e3/y.metadata.head.unitsPerEm));s("<</Subtype/TrueType/Type/Font/ToUnicode "+ae+" 0 R/BaseFont/"+cy(y.fontName)+"/FontDescriptor "+ye+" 0 R/Encoding/"+y.encoding+" /FirstChar 29 /LastChar 255 /Widths "+n.API.PDFObject.convert(y.metadata.hmtx.widths)+">>"),s("endobj"),y.isAlreadyPutted=!0}})(c)}]);var a=function(c){var _,y=c.text||"",s=c.x,T=c.y,L=c.options||{},R=c.mutex||{},U=R.pdfEscape,M=R.activeFontKey,Q=R.fonts,ae=M,ye="",ie=0,oe="",ve=Q[ae].encoding;if(Q[ae].encoding!=="Identity-H")return{text:y,x:s,y:T,options:L,mutex:R};for(oe=y,ae=M,Array.isArray(y)&&(oe=y[0]),ie=0;ie<oe.length;ie+=1)Q[ae].metadata.hasOwnProperty("cmap")&&(_=Q[ae].metadata.cmap.unicode.codeMap[oe[ie].charCodeAt(0)]),_||oe[ie].charCodeAt(0)<256&&Q[ae].metadata.hasOwnProperty("Unicode")?ye+=oe[ie]:ye+="";var de="";return parseInt(ae.slice(1))<14||ve==="WinAnsiEncoding"?de=U(ye,ae).split("").map(function(Pe){return Pe.charCodeAt(0).toString(16)}).join(""):ve==="Identity-H"&&(de=t(ye,Q[ae])),R.isHex=!0,{text:de,x:s,y:T,options:L,mutex:R}};e.events.push(["postProcessText",function(c){var _=c.text||"",y=[],s={text:_,x:c.x,y:c.y,options:c.options,mutex:c.mutex};if(Array.isArray(_)){var T=0;for(T=0;T<_.length;T+=1)Array.isArray(_[T])&&_[T].length===3?y.push([a(Object.assign({},s,{text:_[T][0]})).text,_[T][1],_[T][2]]):y.push(a(Object.assign({},s,{text:_[T]})).text);c.text=y}else c.text=a(Object.assign({},s,{text:_})).text}])})($i),(function(n){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};n.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},n.addFileToVFS=function(t,i){return e.call(this),this.internal.vFS[t]=i,this},n.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}})($i.API),(function(n){n.__bidiEngine__=n.prototype.__bidiEngine__=function(i){var a,c,_,y,s,T,L,R=e,U=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],M=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],Q={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},ae={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},ye=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],ie=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),oe=!1,ve=0;this.__bidiEngine__={};var de=function($){var J=$.charCodeAt(),te=J>>8,Se=ae[te];return Se!==void 0?R[256*Se+(255&J)]:te===252||te===253?"AL":ie.test(te)?"L":te===8?"R":"N"},Pe=function($){for(var J,te=0;te<$.length;te++){if((J=de($.charAt(te)))==="L")return!1;if(J==="R")return!0}return!1},Be=function($,J,te,Se){var De,$e,Ue,Le,He=J[Se];switch(He){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":oe=!1;break;case"N":case"AN":break;case"EN":oe&&(He="AN");break;case"AL":oe=!0,He="R";break;case"WS":case"BN":He="N";break;case"CS":Se<1||Se+1>=J.length||(De=te[Se-1])!=="EN"&&De!=="AN"||($e=J[Se+1])!=="EN"&&$e!=="AN"?He="N":oe&&($e="AN"),He=$e===De?$e:"N";break;case"ES":He=(De=Se>0?te[Se-1]:"B")==="EN"&&Se+1<J.length&&J[Se+1]==="EN"?"EN":"N";break;case"ET":if(Se>0&&te[Se-1]==="EN"){He="EN";break}if(oe){He="N";break}for(Ue=Se+1,Le=J.length;Ue<Le&&J[Ue]==="ET";)Ue++;He=Ue<Le&&J[Ue]==="EN"?"EN":"N";break;case"NSM":if(_&&!y){for(Le=J.length,Ue=Se+1;Ue<Le&&J[Ue]==="NSM";)Ue++;if(Ue<Le){var Ke=$[Se],Ce=Ke>=1425&&Ke<=2303||Ke===64286;if(De=J[Ue],Ce&&(De==="R"||De==="AL")){He="R";break}}}He=Se<1||(De=J[Se-1])==="B"?"N":te[Se-1];break;case"B":oe=!1,a=!0,He=ve;break;case"S":c=!0,He="N"}return He},_e=function($,J,te){var Se=$.split("");return te&&G(Se,te,{hiLevel:ve}),Se.reverse(),J&&J.reverse(),Se.join("")},G=function($,J,te){var Se,De,$e,Ue,Le,He=-1,Ke=$.length,Ce=0,ge=[],We=ve?M:U,Ve=[];for(oe=!1,a=!1,c=!1,De=0;De<Ke;De++)Ve[De]=de($[De]);for($e=0;$e<Ke;$e++){if(Le=Ce,ge[$e]=Be($,Ve,ge,$e),Se=240&(Ce=We[Le][Q[ge[$e]]]),Ce&=15,J[$e]=Ue=We[Ce][5],Se>0)if(Se===16){for(De=He;De<$e;De++)J[De]=1;He=-1}else He=-1;if(We[Ce][6])He===-1&&(He=$e);else if(He>-1){for(De=He;De<$e;De++)J[De]=Ue;He=-1}Ve[$e]==="B"&&(J[$e]=0),te.hiLevel|=Ue}c&&(function(ut,pt,It){for(var Oe=0;Oe<It;Oe++)if(ut[Oe]==="S"){pt[Oe]=ve;for(var Wt=Oe-1;Wt>=0&&ut[Wt]==="WS";Wt--)pt[Wt]=ve}})(Ve,J,Ke)},B=function($,J,te,Se,De){if(!(De.hiLevel<$)){if($===1&&ve===1&&!a)return J.reverse(),void(te&&te.reverse());for(var $e,Ue,Le,He,Ke=J.length,Ce=0;Ce<Ke;){if(Se[Ce]>=$){for(Le=Ce+1;Le<Ke&&Se[Le]>=$;)Le++;for(He=Ce,Ue=Le-1;He<Ue;He++,Ue--)$e=J[He],J[He]=J[Ue],J[Ue]=$e,te&&($e=te[He],te[He]=te[Ue],te[Ue]=$e);Ce=Le}Ce++}}},Y=function($,J,te){var Se=$.split(""),De={hiLevel:ve};return te||(te=[]),G(Se,te,De),(function($e,Ue,Le){if(Le.hiLevel!==0&&L)for(var He,Ke=0;Ke<$e.length;Ke++)Ue[Ke]===1&&(He=ye.indexOf($e[Ke]))>=0&&($e[Ke]=ye[He+1])})(Se,te,De),B(2,Se,J,te,De),B(1,Se,J,te,De),Se.join("")};return this.__bidiEngine__.doBidiReorder=function($,J,te){if((function(De,$e){if($e)for(var Ue=0;Ue<De.length;Ue++)$e[Ue]=Ue;y===void 0&&(y=Pe(De)),T===void 0&&(T=Pe(De))})($,J),_||!s||T)if(_&&s&&y^T)ve=y?1:0,$=_e($,J,te);else if(!_&&s&&T)ve=y?1:0,$=Y($,J,te),$=_e($,J);else if(!_||y||s||T){if(_&&!s&&y^T)$=_e($,J),y?(ve=0,$=Y($,J,te)):(ve=1,$=Y($,J,te),$=_e($,J));else if(_&&y&&!s&&T)ve=1,$=Y($,J,te),$=_e($,J);else if(!_&&!s&&y^T){var Se=L;y?(ve=1,$=Y($,J,te),ve=0,L=!1,$=Y($,J,te),L=Se):(ve=0,$=Y($,J,te),$=_e($,J),ve=1,L=!1,$=Y($,J,te),L=Se,$=_e($,J))}}else ve=0,$=Y($,J,te);else ve=y?1:0,$=Y($,J,te);return $},this.__bidiEngine__.setOptions=function($){$&&(_=$.isInputVisual,s=$.isOutputVisual,y=$.isInputRtl,T=$.isOutputRtl,L=$.isSymmetricSwapping)},this.__bidiEngine__.setOptions(i),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new n.__bidiEngine__({isInputVisual:!0});n.API.events.push(["postProcessText",function(i){var a=i.text;i.x,i.y;var c=i.options||{};i.mutex,c.lang;var _=[];if(c.isInputVisual=typeof c.isInputVisual!="boolean"||c.isInputVisual,t.setOptions(c),Object.prototype.toString.call(a)==="[object Array]"){var y=0;for(_=[],y=0;y<a.length;y+=1)Object.prototype.toString.call(a[y])==="[object Array]"?_.push([t.doBidiReorder(a[y][0]),a[y][1],a[y][2]]):_.push([t.doBidiReorder(a[y])]);i.text=_}else i.text=t.doBidiReorder(a);t.setOptions({isInputVisual:!0})}])})($i),$i.API.TTFFont=(function(){function n(e){var t;if(this.rawData=e,t=this.contents=new ym(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new C7(this),this.registerTTF()}return n.open=function(e){return new n(e)},n.prototype.parse=function(){return this.directory=new p7(this.contents),this.head=new g7(this),this.name=new b7(this),this.cmap=new XC(this),this.toUnicode={},this.hhea=new y7(this),this.maxp=new w7(this),this.hmtx=new S7(this),this.post=new v7(this),this.os2=new _7(this),this.loca=new I7(this),this.glyf=new E7(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},n.prototype.registerTTF=function(){var e,t,i,a,c;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var _,y,s,T;for(T=[],_=0,y=(s=this.bbox).length;_<y;_++)e=s[_],T.push(Math.round(e*this.scaleFactor));return T}).call(this),this.stemV=0,this.post.exists?(i=255&(a=this.post.italic_angle),32768&(t=a>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+i)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(c=this.familyClass)===1||c===2||c===3||c===4||c===5||c===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},n.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},n.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},n.prototype.widthOfString=function(e,t,i){var a,c,_,y;for(_=0,c=0,y=(e=""+e).length;0<=y?c<y:c>y;c=0<=y?++c:--c)a=e.charCodeAt(c),_+=this.widthOfGlyph(this.characterToGlyph(a))+i*(1e3/t)||0;return _*(t/1e3)},n.prototype.lineHeight=function(e,t){var i;return t==null&&(t=!1),i=t?this.lineGap:0,(this.ascender+i-this.decender)/1e3*e},n})();var yd,ym=(function(){function n(e){this.data=e??[],this.pos=0,this.length=this.data.length}return n.prototype.readByte=function(){return this.data[this.pos++]},n.prototype.writeByte=function(e){return this.data[this.pos++]=e},n.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},n.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},n.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},n.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},n.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},n.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},n.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},n.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},n.prototype.readString=function(e){var t,i;for(i=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)i[t]=String.fromCharCode(this.readByte());return i.join("")},n.prototype.writeString=function(e){var t,i,a;for(a=[],t=0,i=e.length;0<=i?t<i:t>i;t=0<=i?++t:--t)a.push(this.writeByte(e.charCodeAt(t)));return a},n.prototype.readShort=function(){return this.readInt16()},n.prototype.writeShort=function(e){return this.writeInt16(e)},n.prototype.readLongLong=function(){var e,t,i,a,c,_,y,s;return e=this.readByte(),t=this.readByte(),i=this.readByte(),a=this.readByte(),c=this.readByte(),_=this.readByte(),y=this.readByte(),s=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^i)+4294967296*(255^a)+16777216*(255^c)+65536*(255^_)+256*(255^y)+(255^s)+1):72057594037927940*e+281474976710656*t+1099511627776*i+4294967296*a+16777216*c+65536*_+256*y+s},n.prototype.writeLongLong=function(e){var t,i;return t=Math.floor(e/4294967296),i=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(i>>24&255),this.writeByte(i>>16&255),this.writeByte(i>>8&255),this.writeByte(255&i)},n.prototype.readInt=function(){return this.readInt32()},n.prototype.writeInt=function(e){return this.writeInt32(e)},n.prototype.read=function(e){var t,i;for(t=[],i=0;0<=e?i<e:i>e;i=0<=e?++i:--i)t.push(this.readByte());return t},n.prototype.write=function(e){var t,i,a,c;for(c=[],i=0,a=e.length;i<a;i++)t=e[i],c.push(this.writeByte(t));return c},n})(),p7=(function(){var n;function e(t){var i,a,c;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},a=0,c=this.tableCount;0<=c?a<c:a>c;a=0<=c?++a:--a)i={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[i.tag]=i}return e.prototype.encode=function(t){var i,a,c,_,y,s,T,L,R,U,M,Q,ae;for(ae in M=Object.keys(t).length,s=Math.log(2),R=16*Math.floor(Math.log(M)/s),_=Math.floor(R/s),L=16*M-R,(a=new ym).writeInt(this.scalarType),a.writeShort(M),a.writeShort(R),a.writeShort(_),a.writeShort(L),c=16*M,T=a.pos+c,y=null,Q=[],t)for(U=t[ae],a.writeString(ae),a.writeInt(n(U)),a.writeInt(T),a.writeInt(U.length),Q=Q.concat(U),ae==="head"&&(y=T),T+=U.length;T%4;)Q.push(0),T++;return a.write(Q),i=2981146554-n(a.data),a.pos=y+8,a.writeUInt32(i),a.data},n=function(t){var i,a,c,_;for(t=YC.call(t);t.length%4;)t.push(0);for(c=new ym(t),a=0,i=0,_=t.length;i<_;i=i+=4)a+=c.readUInt32();return 4294967295&a},e})(),m7={}.hasOwnProperty,tp=function(n,e){for(var t in e)m7.call(e,t)&&(n[t]=e[t]);function i(){this.constructor=n}return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n};yd=(function(){function n(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return n.prototype.parse=function(){},n.prototype.encode=function(){},n.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},n})();var g7=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return tp(n,yd),n.prototype.tag="head",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},n.prototype.encode=function(e){var t;return(t=new ym).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},n})(),LE=(function(){function n(e,t){var i,a,c,_,y,s,T,L,R,U,M,Q,ae,ye,ie,oe,ve;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),R=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(s=0;s<256;++s)this.codeMap[s]=e.readByte();break;case 4:for(M=e.readUInt16(),U=M/2,e.pos+=6,c=(function(){var de,Pe;for(Pe=[],s=de=0;0<=U?de<U:de>U;s=0<=U?++de:--de)Pe.push(e.readUInt16());return Pe})(),e.pos+=2,ae=(function(){var de,Pe;for(Pe=[],s=de=0;0<=U?de<U:de>U;s=0<=U?++de:--de)Pe.push(e.readUInt16());return Pe})(),T=(function(){var de,Pe;for(Pe=[],s=de=0;0<=U?de<U:de>U;s=0<=U?++de:--de)Pe.push(e.readUInt16());return Pe})(),L=(function(){var de,Pe;for(Pe=[],s=de=0;0<=U?de<U:de>U;s=0<=U?++de:--de)Pe.push(e.readUInt16());return Pe})(),a=(this.length-e.pos+this.offset)/2,y=(function(){var de,Pe;for(Pe=[],s=de=0;0<=a?de<a:de>a;s=0<=a?++de:--de)Pe.push(e.readUInt16());return Pe})(),s=ie=0,ve=c.length;ie<ve;s=++ie)for(ye=c[s],i=oe=Q=ae[s];Q<=ye?oe<=ye:oe>=ye;i=Q<=ye?++oe:--oe)L[s]===0?_=i+T[s]:(_=y[L[s]/2+(i-Q)-(U-s)]||0)!==0&&(_+=T[s]),this.codeMap[i]=65535&_}e.pos=R}return n.encode=function(e,t){var i,a,c,_,y,s,T,L,R,U,M,Q,ae,ye,ie,oe,ve,de,Pe,Be,_e,G,B,Y,$,J,te,Se,De,$e,Ue,Le,He,Ke,Ce,ge,We,Ve,ut,pt,It,Oe,Wt,Zt,Xt,Ze;switch(Se=new ym,_=Object.keys(e).sort(function(zn,on){return zn-on}),t){case"macroman":for(ae=0,ye=(function(){var zn=[];for(Q=0;Q<256;++Q)zn.push(0);return zn})(),oe={0:0},c={},De=0,He=_.length;De<He;De++)oe[Wt=e[a=_[De]]]==null&&(oe[Wt]=++ae),c[a]={old:e[a],new:oe[e[a]]},ye[a]=oe[e[a]];return Se.writeUInt16(1),Se.writeUInt16(0),Se.writeUInt32(12),Se.writeUInt16(0),Se.writeUInt16(262),Se.writeUInt16(0),Se.write(ye),{charMap:c,subtable:Se.data,maxGlyphID:ae+1};case"unicode":for(J=[],R=[],ve=0,oe={},i={},ie=T=null,$e=0,Ke=_.length;$e<Ke;$e++)oe[Pe=e[a=_[$e]]]==null&&(oe[Pe]=++ve),i[a]={old:Pe,new:oe[Pe]},y=oe[Pe]-a,ie!=null&&y===T||(ie&&R.push(ie),J.push(a),T=y),ie=a;for(ie&&R.push(ie),R.push(65535),J.push(65535),Y=2*(B=J.length),G=2*Math.pow(Math.log(B)/Math.LN2,2),U=Math.log(G/2)/Math.LN2,_e=2*B-G,s=[],Be=[],M=[],Q=Ue=0,Ce=J.length;Ue<Ce;Q=++Ue){if($=J[Q],L=R[Q],$===65535){s.push(0),Be.push(0);break}if($-(te=i[$].new)>=32768)for(s.push(0),Be.push(2*(M.length+B-Q)),a=Le=$;$<=L?Le<=L:Le>=L;a=$<=L?++Le:--Le)M.push(i[a].new);else s.push(te-$),Be.push(0)}for(Se.writeUInt16(3),Se.writeUInt16(1),Se.writeUInt32(12),Se.writeUInt16(4),Se.writeUInt16(16+8*B+2*M.length),Se.writeUInt16(0),Se.writeUInt16(Y),Se.writeUInt16(G),Se.writeUInt16(U),Se.writeUInt16(_e),It=0,ge=R.length;It<ge;It++)a=R[It],Se.writeUInt16(a);for(Se.writeUInt16(0),Oe=0,We=J.length;Oe<We;Oe++)a=J[Oe],Se.writeUInt16(a);for(Zt=0,Ve=s.length;Zt<Ve;Zt++)y=s[Zt],Se.writeUInt16(y);for(Xt=0,ut=Be.length;Xt<ut;Xt++)de=Be[Xt],Se.writeUInt16(de);for(Ze=0,pt=M.length;Ze<pt;Ze++)ae=M[Ze],Se.writeUInt16(ae);return{charMap:i,subtable:Se.data,maxGlyphID:ve+1}}},n})(),XC=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return tp(n,yd),n.prototype.tag="cmap",n.prototype.parse=function(e){var t,i,a;for(e.pos=this.offset,this.version=e.readUInt16(),a=e.readUInt16(),this.tables=[],this.unicode=null,i=0;0<=a?i<a:i>a;i=0<=a?++i:--i)t=new LE(e,this.offset),this.tables.push(t),t.isUnicode&&this.unicode==null&&(this.unicode=t);return!0},n.encode=function(e,t){var i,a;return t==null&&(t="macroman"),i=LE.encode(e,t),(a=new ym).writeUInt16(0),a.writeUInt16(1),i.table=a.data.concat(i.subtable),i},n})(),y7=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return tp(n,yd),n.prototype.tag="hhea",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},n})(),_7=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return tp(n,yd),n.prototype.tag="OS/2",n.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=(function(){var t,i;for(i=[],t=0;t<10;++t)i.push(e.readByte());return i})(),this.charRange=(function(){var t,i;for(i=[],t=0;t<4;++t)i.push(e.readInt());return i})(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=(function(){var t,i;for(i=[],t=0;t<2;t=++t)i.push(e.readInt());return i})(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},n})(),v7=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return tp(n,yd),n.prototype.tag="post",n.prototype.parse=function(e){var t,i,a;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var c;for(i=e.readUInt16(),this.glyphNameIndex=[],c=0;0<=i?c<i:c>i;c=0<=i?++c:--c)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],a=[];e.pos<this.offset+this.length;)t=e.readByte(),a.push(this.names.push(e.readString(t)));return a;case 151552:return i=e.readUInt16(),this.offsets=e.read(i);case 262144:return this.map=(function(){var _,y,s;for(s=[],c=_=0,y=this.file.maxp.numGlyphs;0<=y?_<y:_>y;c=0<=y?++_:--_)s.push(e.readUInt32());return s}).call(this)}},n})(),x7=function(n,e){this.raw=n,this.length=n.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},b7=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return tp(n,yd),n.prototype.tag="name",n.prototype.parse=function(e){var t,i,a,c,_,y,s,T,L,R,U;for(e.pos=this.offset,e.readShort(),t=e.readShort(),y=e.readShort(),i=[],c=0;0<=t?c<t:c>t;c=0<=t?++c:--c)i.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+y+e.readShort()});for(s={},c=L=0,R=i.length;L<R;c=++L)a=i[c],e.pos=a.offset,T=e.readString(a.length),_=new x7(T,a),s[U=a.nameID]==null&&(s[U]=[]),s[a.nameID].push(_);this.strings=s,this.copyright=s[0],this.fontFamily=s[1],this.fontSubfamily=s[2],this.uniqueSubfamily=s[3],this.fontName=s[4],this.version=s[5];try{this.postscriptName=s[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=s[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=s[7],this.manufacturer=s[8],this.designer=s[9],this.description=s[10],this.vendorUrl=s[11],this.designerUrl=s[12],this.license=s[13],this.licenseUrl=s[14],this.preferredFamily=s[15],this.preferredSubfamily=s[17],this.compatibleFull=s[18],this.sampleText=s[19]},n})(),w7=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return tp(n,yd),n.prototype.tag="maxp",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},n})(),S7=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return tp(n,yd),n.prototype.tag="hmtx",n.prototype.parse=function(e){var t,i,a,c,_,y,s;for(e.pos=this.offset,this.metrics=[],t=0,y=this.file.hhea.numberOfMetrics;0<=y?t<y:t>y;t=0<=y?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(a=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var T,L;for(L=[],t=T=0;0<=a?T<a:T>a;t=0<=a?++T:--T)L.push(e.readInt16());return L})(),this.widths=(function(){var T,L,R,U;for(U=[],T=0,L=(R=this.metrics).length;T<L;T++)c=R[T],U.push(c.advance);return U}).call(this),i=this.widths[this.widths.length-1],s=[],t=_=0;0<=a?_<a:_>a;t=0<=a?++_:--_)s.push(this.widths.push(i));return s},n.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},n})(),YC=[].slice,E7=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return tp(n,yd),n.prototype.tag="glyf",n.prototype.parse=function(){return this.cache={}},n.prototype.glyphFor=function(e){var t,i,a,c,_,y,s,T,L,R;return e in this.cache?this.cache[e]:(c=this.file.loca,t=this.file.contents,i=c.indexOf(e),(a=c.lengthOf(e))===0?this.cache[e]=null:(t.pos=this.offset+i,_=(y=new ym(t.read(a))).readShort(),T=y.readShort(),R=y.readShort(),s=y.readShort(),L=y.readShort(),this.cache[e]=_===-1?new A7(y,T,R,s,L):new T7(y,_,T,R,s,L),this.cache[e]))},n.prototype.encode=function(e,t,i){var a,c,_,y,s;for(_=[],c=[],y=0,s=t.length;y<s;y++)a=e[t[y]],c.push(_.length),a&&(_=_.concat(a.encode(i)));return c.push(_.length),{table:_,offsets:c}},n})(),T7=(function(){function n(e,t,i,a,c,_){this.raw=e,this.numberOfContours=t,this.xMin=i,this.yMin=a,this.xMax=c,this.yMax=_,this.compound=!1}return n.prototype.encode=function(){return this.raw.data},n})(),A7=(function(){function n(e,t,i,a,c){var _,y;for(this.raw=e,this.xMin=t,this.yMin=i,this.xMax=a,this.yMax=c,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],_=this.raw;y=_.readShort(),this.glyphOffsets.push(_.pos),this.glyphIDs.push(_.readUInt16()),32&y;)_.pos+=1&y?4:2,128&y?_.pos+=8:64&y?_.pos+=4:8&y&&(_.pos+=2)}return n.prototype.encode=function(){var e,t,i;for(t=new ym(YC.call(this.raw.data)),e=0,i=this.glyphIDs.length;e<i;++e)t.pos=this.glyphOffsets[e];return t.data},n})(),I7=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return tp(n,yd),n.prototype.tag="loca",n.prototype.parse=function(e){var t,i;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=t===0?(function(){var a,c;for(c=[],i=0,a=this.length;i<a;i+=2)c.push(2*e.readUInt16());return c}).call(this):(function(){var a,c;for(c=[],i=0,a=this.length;i<a;i+=4)c.push(e.readUInt32());return c}).call(this)},n.prototype.indexOf=function(e){return this.offsets[e]},n.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},n.prototype.encode=function(e,t){for(var i=new Uint32Array(this.offsets.length),a=0,c=0,_=0;_<i.length;++_)if(i[_]=a,c<t.length&&t[c]==_){++c,i[_]=a;var y=this.offsets[_],s=this.offsets[_+1]-y;s>0&&(a+=s)}for(var T=new Array(4*i.length),L=0;L<i.length;++L)T[4*L+3]=255&i[L],T[4*L+2]=(65280&i[L])>>8,T[4*L+1]=(16711680&i[L])>>16,T[4*L]=(4278190080&i[L])>>24;return T},n})(),C7=(function(){function n(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return n.prototype.generateCmap=function(){var e,t,i,a,c;for(t in a=this.font.cmap.tables[0].codeMap,e={},c=this.subset)i=c[t],e[t]=a[i];return e},n.prototype.glyphsFor=function(e){var t,i,a,c,_,y,s;for(a={},_=0,y=e.length;_<y;_++)a[c=e[_]]=this.font.glyf.glyphFor(c);for(c in t=[],a)(i=a[c])!=null&&i.compound&&t.push.apply(t,i.glyphIDs);if(t.length>0)for(c in s=this.glyphsFor(t))i=s[c],a[c]=i;return a},n.prototype.encode=function(e,t){var i,a,c,_,y,s,T,L,R,U,M,Q,ae,ye,ie;for(a in i=XC.encode(this.generateCmap(),"unicode"),_=this.glyphsFor(e),M={0:0},ie=i.charMap)M[(s=ie[a]).old]=s.new;for(Q in U=i.maxGlyphID,_)Q in M||(M[Q]=U++);return L=(function(oe){var ve,de;for(ve in de={},oe)de[oe[ve]]=ve;return de})(M),R=Object.keys(L).sort(function(oe,ve){return oe-ve}),ae=(function(){var oe,ve,de;for(de=[],oe=0,ve=R.length;oe<ve;oe++)y=R[oe],de.push(L[y]);return de})(),c=this.font.glyf.encode(_,ae,M),T=this.font.loca.encode(c.offsets,ae),ye={cmap:this.font.cmap.raw(),glyf:c.table,loca:T,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(ye["OS/2"]=this.font.os2.raw()),this.font.directory.encode(ye)},n})();$i.API.PDFObject=(function(){var n;function e(){}return n=function(t,i){return(Array(i+1).join("0")+t).slice(-i)},e.convert=function(t){var i,a,c,_;if(Array.isArray(t))return"["+(function(){var y,s,T;for(T=[],y=0,s=t.length;y<s;y++)i=t[y],T.push(e.convert(i));return T})().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t?.isString)return"("+t+")";if(t instanceof Date)return"(D:"+n(t.getUTCFullYear(),4)+n(t.getUTCMonth(),2)+n(t.getUTCDate(),2)+n(t.getUTCHours(),2)+n(t.getUTCMinutes(),2)+n(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(a in c=["<<"],t)_=t[a],c.push("/"+a+" "+e.convert(_));return c.push(">>"),c.join(`
`)}return""+t},e})();var PE={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KC=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let a=n.charCodeAt(i);a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):(a&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(a=65536+((a&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128)}return e},k7=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const a=n[t++];if(a<128)e[i++]=String.fromCharCode(a);else if(a>191&&a<224){const c=n[t++];e[i++]=String.fromCharCode((a&31)<<6|c&63)}else if(a>239&&a<365){const c=n[t++],_=n[t++],y=n[t++],s=((a&7)<<18|(c&63)<<12|(_&63)<<6|y&63)-65536;e[i++]=String.fromCharCode(55296+(s>>10)),e[i++]=String.fromCharCode(56320+(s&1023))}else{const c=n[t++],_=n[t++];e[i++]=String.fromCharCode((a&15)<<12|(c&63)<<6|_&63)}}return e.join("")},ZC={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let a=0;a<n.length;a+=3){const c=n[a],_=a+1<n.length,y=_?n[a+1]:0,s=a+2<n.length,T=s?n[a+2]:0,L=c>>2,R=(c&3)<<4|y>>4;let U=(y&15)<<2|T>>6,M=T&63;s||(M=64,_||(U=64)),i.push(t[L],t[R],t[U],t[M])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(KC(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):k7(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let a=0;a<n.length;){const c=t[n.charAt(a++)],y=a<n.length?t[n.charAt(a)]:0;++a;const T=a<n.length?t[n.charAt(a)]:64;++a;const R=a<n.length?t[n.charAt(a)]:64;if(++a,c==null||y==null||T==null||R==null)throw new L7;const U=c<<2|y>>4;if(i.push(U),T!==64){const M=y<<4&240|T>>2;if(i.push(M),R!==64){const Q=T<<6&192|R;i.push(Q)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class L7 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const P7=function(n){const e=KC(n);return ZC.encodeByteArray(e,!0)},Uv=function(n){return P7(n).replace(/\./g,"")},JC=function(n){try{return ZC.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N7(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R7=()=>N7().__FIREBASE_DEFAULTS__,M7=()=>{if(typeof process>"u"||typeof PE>"u")return;const n=PE.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},D7=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&JC(n[1]);return e&&JSON.parse(e)},Nx=()=>{try{return R7()||M7()||D7()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},QC=n=>{var e,t;return(t=(e=Nx())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},O7=n=>{const e=QC(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},ek=()=>{var n;return(n=Nx())===null||n===void 0?void 0:n.config},tk=n=>{var e;return(e=Nx())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F7{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B7(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",a=n.iat||0,c=n.sub||n.user_id;if(!c)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const _=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:a,exp:a+3600,auth_time:a,sub:c,user_id:c,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Uv(JSON.stringify(t)),Uv(JSON.stringify(_)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ch(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function z7(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ch())}function j7(){var n;const e=(n=Nx())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function U7(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function V7(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function q7(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function G7(){const n=Ch();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function $7(){return!j7()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function H7(){try{return typeof indexedDB=="object"}catch{return!1}}function W7(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(i);a.onsuccess=()=>{a.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},a.onupgradeneeded=()=>{t=!1},a.onerror=()=>{var c;e(((c=a.error)===null||c===void 0?void 0:c.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X7="FirebaseError";class Op extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=X7,Object.setPrototypeOf(this,Op.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,z_.prototype.create)}}class z_{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},a=`${this.service}/${e}`,c=this.errors[e],_=c?Y7(c,i):"Error",y=`${this.serviceName}: ${_} (${a}).`;return new Op(a,y,i)}}function Y7(n,e){return n.replace(K7,(t,i)=>{const a=e[i];return a!=null?String(a):`<${i}?>`})}const K7=/\{\$([^}]+)}/g;function Z7(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Vv(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const a of t){if(!i.includes(a))return!1;const c=n[a],_=e[a];if(NE(c)&&NE(_)){if(!Vv(c,_))return!1}else if(c!==_)return!1}for(const a of i)if(!t.includes(a))return!1;return!0}function NE(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j_(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(a=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function J7(n,e){const t=new Q7(n,e);return t.subscribe.bind(t)}class Q7{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let a;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");eD(e,["next","error","complete"])?a=e:a={next:e,error:t,complete:i},a.next===void 0&&(a.next=dw),a.error===void 0&&(a.error=dw),a.complete===void 0&&(a.complete=dw);const c=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),c}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eD(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function dw(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vh(n){return n&&n._delegate?n._delegate:n}class fg{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jm="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tD{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new F7;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&i.resolve(a)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e?.identifier),a=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(c){if(a)return null;throw c}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(rD(e))try{this.getOrInitializeService({instanceIdentifier:Jm})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(t);try{const c=this.getOrInitializeService({instanceIdentifier:a});i.resolve(c)}catch{}}}}clearInstance(e=Jm){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Jm){return this.instances.has(e)}getOptions(e=Jm){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[c,_]of this.instancesDeferred.entries()){const y=this.normalizeInstanceIdentifier(c);i===y&&_.resolve(a)}return a}onInit(e,t){var i;const a=this.normalizeInstanceIdentifier(t),c=(i=this.onInitCallbacks.get(a))!==null&&i!==void 0?i:new Set;c.add(e),this.onInitCallbacks.set(a,c);const _=this.instances.get(a);return _&&e(_,a),()=>{c.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const a of i)try{a(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:nD(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Jm){return this.component?this.component.multipleInstances?e:Jm:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function nD(n){return n===Jm?void 0:n}function rD(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iD{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new tD(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qo;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Qo||(Qo={}));const sD={debug:Qo.DEBUG,verbose:Qo.VERBOSE,info:Qo.INFO,warn:Qo.WARN,error:Qo.ERROR,silent:Qo.SILENT},oD=Qo.INFO,aD={[Qo.DEBUG]:"log",[Qo.VERBOSE]:"log",[Qo.INFO]:"info",[Qo.WARN]:"warn",[Qo.ERROR]:"error"},lD=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),a=aD[e];if(a)console[a](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class c3{constructor(e){this.name=e,this._logLevel=oD,this._logHandler=lD,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Qo))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?sD[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Qo.DEBUG,...e),this._logHandler(this,Qo.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Qo.VERBOSE,...e),this._logHandler(this,Qo.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Qo.INFO,...e),this._logHandler(this,Qo.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Qo.WARN,...e),this._logHandler(this,Qo.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Qo.ERROR,...e),this._logHandler(this,Qo.ERROR,...e)}}const uD=(n,e)=>e.some(t=>n instanceof t);let RE,ME;function cD(){return RE||(RE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function hD(){return ME||(ME=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const nk=new WeakMap,u5=new WeakMap,rk=new WeakMap,pw=new WeakMap,h3=new WeakMap;function fD(n){const e=new Promise((t,i)=>{const a=()=>{n.removeEventListener("success",c),n.removeEventListener("error",_)},c=()=>{t(hm(n.result)),a()},_=()=>{i(n.error),a()};n.addEventListener("success",c),n.addEventListener("error",_)});return e.then(t=>{t instanceof IDBCursor&&nk.set(t,n)}).catch(()=>{}),h3.set(e,n),e}function dD(n){if(u5.has(n))return;const e=new Promise((t,i)=>{const a=()=>{n.removeEventListener("complete",c),n.removeEventListener("error",_),n.removeEventListener("abort",_)},c=()=>{t(),a()},_=()=>{i(n.error||new DOMException("AbortError","AbortError")),a()};n.addEventListener("complete",c),n.addEventListener("error",_),n.addEventListener("abort",_)});u5.set(n,e)}let c5={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return u5.get(n);if(e==="objectStoreNames")return n.objectStoreNames||rk.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return hm(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function pD(n){c5=n(c5)}function mD(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(mw(this),e,...t);return rk.set(i,e.sort?e.sort():[e]),hm(i)}:hD().includes(n)?function(...e){return n.apply(mw(this),e),hm(nk.get(this))}:function(...e){return hm(n.apply(mw(this),e))}}function gD(n){return typeof n=="function"?mD(n):(n instanceof IDBTransaction&&dD(n),uD(n,cD())?new Proxy(n,c5):n)}function hm(n){if(n instanceof IDBRequest)return fD(n);if(pw.has(n))return pw.get(n);const e=gD(n);return e!==n&&(pw.set(n,e),h3.set(e,n)),e}const mw=n=>h3.get(n);function yD(n,e,{blocked:t,upgrade:i,blocking:a,terminated:c}={}){const _=indexedDB.open(n,e),y=hm(_);return i&&_.addEventListener("upgradeneeded",s=>{i(hm(_.result),s.oldVersion,s.newVersion,hm(_.transaction),s)}),t&&_.addEventListener("blocked",s=>t(s.oldVersion,s.newVersion,s)),y.then(s=>{c&&s.addEventListener("close",()=>c()),a&&s.addEventListener("versionchange",T=>a(T.oldVersion,T.newVersion,T))}).catch(()=>{}),y}const _D=["get","getKey","getAll","getAllKeys","count"],vD=["put","add","delete","clear"],gw=new Map;function DE(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(gw.get(e))return gw.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,a=vD.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(a||_D.includes(t)))return;const c=async function(_,...y){const s=this.transaction(_,a?"readwrite":"readonly");let T=s.store;return i&&(T=T.index(y.shift())),(await Promise.all([T[t](...y),a&&s.done]))[0]};return gw.set(e,c),c}pD(n=>({...n,get:(e,t,i)=>DE(e,t)||n.get(e,t,i),has:(e,t)=>!!DE(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xD{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(bD(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function bD(n){const e=n.getComponent();return e?.type==="VERSION"}const h5="@firebase/app",OE="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pp=new c3("@firebase/app"),wD="@firebase/app-compat",SD="@firebase/analytics-compat",ED="@firebase/analytics",TD="@firebase/app-check-compat",AD="@firebase/app-check",ID="@firebase/auth",CD="@firebase/auth-compat",kD="@firebase/database",LD="@firebase/data-connect",PD="@firebase/database-compat",ND="@firebase/functions",RD="@firebase/functions-compat",MD="@firebase/installations",DD="@firebase/installations-compat",OD="@firebase/messaging",FD="@firebase/messaging-compat",BD="@firebase/performance",zD="@firebase/performance-compat",jD="@firebase/remote-config",UD="@firebase/remote-config-compat",VD="@firebase/storage",qD="@firebase/storage-compat",GD="@firebase/firestore",$D="@firebase/vertexai-preview",HD="@firebase/firestore-compat",WD="firebase",XD="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f5="[DEFAULT]",YD={[h5]:"fire-core",[wD]:"fire-core-compat",[ED]:"fire-analytics",[SD]:"fire-analytics-compat",[AD]:"fire-app-check",[TD]:"fire-app-check-compat",[ID]:"fire-auth",[CD]:"fire-auth-compat",[kD]:"fire-rtdb",[LD]:"fire-data-connect",[PD]:"fire-rtdb-compat",[ND]:"fire-fn",[RD]:"fire-fn-compat",[MD]:"fire-iid",[DD]:"fire-iid-compat",[OD]:"fire-fcm",[FD]:"fire-fcm-compat",[BD]:"fire-perf",[zD]:"fire-perf-compat",[jD]:"fire-rc",[UD]:"fire-rc-compat",[VD]:"fire-gcs",[qD]:"fire-gcs-compat",[GD]:"fire-fst",[HD]:"fire-fst-compat",[$D]:"fire-vertex","fire-js":"fire-js",[WD]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qv=new Map,KD=new Map,d5=new Map;function FE(n,e){try{n.container.addComponent(e)}catch(t){Pp.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ly(n){const e=n.name;if(d5.has(e))return Pp.debug(`There were multiple attempts to register component ${e}.`),!1;d5.set(e,n);for(const t of qv.values())FE(t,n);for(const t of KD.values())FE(t,n);return!0}function f3(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function zd(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZD={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},fm=new z_("app","Firebase",ZD);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JD{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new fg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw fm.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yy=XD;function ik(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i=Object.assign({name:f5,automaticDataCollectionEnabled:!1},e),a=i.name;if(typeof a!="string"||!a)throw fm.create("bad-app-name",{appName:String(a)});if(t||(t=ek()),!t)throw fm.create("no-options");const c=qv.get(a);if(c){if(Vv(t,c.options)&&Vv(i,c.config))return c;throw fm.create("duplicate-app",{appName:a})}const _=new iD(a);for(const s of d5.values())_.addComponent(s);const y=new JD(t,i,_);return qv.set(a,y),y}function sk(n=f5){const e=qv.get(n);if(!e&&n===f5&&ek())return ik();if(!e)throw fm.create("no-app",{appName:n});return e}function dm(n,e,t){var i;let a=(i=YD[n])!==null&&i!==void 0?i:n;t&&(a+=`-${t}`);const c=a.match(/\s|\//),_=e.match(/\s|\//);if(c||_){const y=[`Unable to register library "${a}" with version "${e}":`];c&&y.push(`library name "${a}" contains illegal characters (whitespace or "/")`),c&&_&&y.push("and"),_&&y.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Pp.warn(y.join(" "));return}Ly(new fg(`${a}-version`,()=>({library:a,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QD="firebase-heartbeat-database",eO=1,w_="firebase-heartbeat-store";let yw=null;function ok(){return yw||(yw=yD(QD,eO,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(w_)}catch(t){console.warn(t)}}}}).catch(n=>{throw fm.create("idb-open",{originalErrorMessage:n.message})})),yw}async function tO(n){try{const t=(await ok()).transaction(w_),i=await t.objectStore(w_).get(ak(n));return await t.done,i}catch(e){if(e instanceof Op)Pp.warn(e.message);else{const t=fm.create("idb-get",{originalErrorMessage:e?.message});Pp.warn(t.message)}}}async function BE(n,e){try{const i=(await ok()).transaction(w_,"readwrite");await i.objectStore(w_).put(e,ak(n)),await i.done}catch(t){if(t instanceof Op)Pp.warn(t.message);else{const i=fm.create("idb-set",{originalErrorMessage:t?.message});Pp.warn(i.message)}}}function ak(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nO=1024,rO=720*60*60*1e3;class iO{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new oO(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),c=zE();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===c||this._heartbeatsCache.heartbeats.some(_=>_.date===c)?void 0:(this._heartbeatsCache.heartbeats.push({date:c,agent:a}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(_=>{const y=new Date(_.date).valueOf();return Date.now()-y<=rO}),this._storage.overwrite(this._heartbeatsCache))}catch(i){Pp.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=zE(),{heartbeatsToSend:i,unsentEntries:a}=sO(this._heartbeatsCache.heartbeats),c=Uv(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,a.length>0?(this._heartbeatsCache.heartbeats=a,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),c}catch(t){return Pp.warn(t),""}}}function zE(){return new Date().toISOString().substring(0,10)}function sO(n,e=nO){const t=[];let i=n.slice();for(const a of n){const c=t.find(_=>_.agent===a.agent);if(c){if(c.dates.push(a.date),jE(t)>e){c.dates.pop();break}}else if(t.push({agent:a.agent,dates:[a.date]}),jE(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class oO{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return H7()?W7().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await tO(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return BE(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return BE(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}else return}}function jE(n){return Uv(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aO(n){Ly(new fg("platform-logger",e=>new xD(e),"PRIVATE")),Ly(new fg("heartbeat",e=>new iO(e),"PRIVATE")),dm(h5,OE,n),dm(h5,OE,"esm2017"),dm("fire-js","")}aO("");var lO="firebase",uO="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */dm(lO,uO,"app");var UE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ag,lk;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(_e,G){function B(){}B.prototype=G.prototype,_e.D=G.prototype,_e.prototype=new B,_e.prototype.constructor=_e,_e.C=function(Y,$,J){for(var te=Array(arguments.length-2),Se=2;Se<arguments.length;Se++)te[Se-2]=arguments[Se];return G.prototype[$].apply(Y,te)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(_e,G,B){B||(B=0);var Y=Array(16);if(typeof G=="string")for(var $=0;16>$;++$)Y[$]=G.charCodeAt(B++)|G.charCodeAt(B++)<<8|G.charCodeAt(B++)<<16|G.charCodeAt(B++)<<24;else for($=0;16>$;++$)Y[$]=G[B++]|G[B++]<<8|G[B++]<<16|G[B++]<<24;G=_e.g[0],B=_e.g[1],$=_e.g[2];var J=_e.g[3],te=G+(J^B&($^J))+Y[0]+3614090360&4294967295;G=B+(te<<7&4294967295|te>>>25),te=J+($^G&(B^$))+Y[1]+3905402710&4294967295,J=G+(te<<12&4294967295|te>>>20),te=$+(B^J&(G^B))+Y[2]+606105819&4294967295,$=J+(te<<17&4294967295|te>>>15),te=B+(G^$&(J^G))+Y[3]+3250441966&4294967295,B=$+(te<<22&4294967295|te>>>10),te=G+(J^B&($^J))+Y[4]+4118548399&4294967295,G=B+(te<<7&4294967295|te>>>25),te=J+($^G&(B^$))+Y[5]+1200080426&4294967295,J=G+(te<<12&4294967295|te>>>20),te=$+(B^J&(G^B))+Y[6]+2821735955&4294967295,$=J+(te<<17&4294967295|te>>>15),te=B+(G^$&(J^G))+Y[7]+4249261313&4294967295,B=$+(te<<22&4294967295|te>>>10),te=G+(J^B&($^J))+Y[8]+1770035416&4294967295,G=B+(te<<7&4294967295|te>>>25),te=J+($^G&(B^$))+Y[9]+2336552879&4294967295,J=G+(te<<12&4294967295|te>>>20),te=$+(B^J&(G^B))+Y[10]+4294925233&4294967295,$=J+(te<<17&4294967295|te>>>15),te=B+(G^$&(J^G))+Y[11]+2304563134&4294967295,B=$+(te<<22&4294967295|te>>>10),te=G+(J^B&($^J))+Y[12]+1804603682&4294967295,G=B+(te<<7&4294967295|te>>>25),te=J+($^G&(B^$))+Y[13]+4254626195&4294967295,J=G+(te<<12&4294967295|te>>>20),te=$+(B^J&(G^B))+Y[14]+2792965006&4294967295,$=J+(te<<17&4294967295|te>>>15),te=B+(G^$&(J^G))+Y[15]+1236535329&4294967295,B=$+(te<<22&4294967295|te>>>10),te=G+($^J&(B^$))+Y[1]+4129170786&4294967295,G=B+(te<<5&4294967295|te>>>27),te=J+(B^$&(G^B))+Y[6]+3225465664&4294967295,J=G+(te<<9&4294967295|te>>>23),te=$+(G^B&(J^G))+Y[11]+643717713&4294967295,$=J+(te<<14&4294967295|te>>>18),te=B+(J^G&($^J))+Y[0]+3921069994&4294967295,B=$+(te<<20&4294967295|te>>>12),te=G+($^J&(B^$))+Y[5]+3593408605&4294967295,G=B+(te<<5&4294967295|te>>>27),te=J+(B^$&(G^B))+Y[10]+38016083&4294967295,J=G+(te<<9&4294967295|te>>>23),te=$+(G^B&(J^G))+Y[15]+3634488961&4294967295,$=J+(te<<14&4294967295|te>>>18),te=B+(J^G&($^J))+Y[4]+3889429448&4294967295,B=$+(te<<20&4294967295|te>>>12),te=G+($^J&(B^$))+Y[9]+568446438&4294967295,G=B+(te<<5&4294967295|te>>>27),te=J+(B^$&(G^B))+Y[14]+3275163606&4294967295,J=G+(te<<9&4294967295|te>>>23),te=$+(G^B&(J^G))+Y[3]+4107603335&4294967295,$=J+(te<<14&4294967295|te>>>18),te=B+(J^G&($^J))+Y[8]+1163531501&4294967295,B=$+(te<<20&4294967295|te>>>12),te=G+($^J&(B^$))+Y[13]+2850285829&4294967295,G=B+(te<<5&4294967295|te>>>27),te=J+(B^$&(G^B))+Y[2]+4243563512&4294967295,J=G+(te<<9&4294967295|te>>>23),te=$+(G^B&(J^G))+Y[7]+1735328473&4294967295,$=J+(te<<14&4294967295|te>>>18),te=B+(J^G&($^J))+Y[12]+2368359562&4294967295,B=$+(te<<20&4294967295|te>>>12),te=G+(B^$^J)+Y[5]+4294588738&4294967295,G=B+(te<<4&4294967295|te>>>28),te=J+(G^B^$)+Y[8]+2272392833&4294967295,J=G+(te<<11&4294967295|te>>>21),te=$+(J^G^B)+Y[11]+1839030562&4294967295,$=J+(te<<16&4294967295|te>>>16),te=B+($^J^G)+Y[14]+4259657740&4294967295,B=$+(te<<23&4294967295|te>>>9),te=G+(B^$^J)+Y[1]+2763975236&4294967295,G=B+(te<<4&4294967295|te>>>28),te=J+(G^B^$)+Y[4]+1272893353&4294967295,J=G+(te<<11&4294967295|te>>>21),te=$+(J^G^B)+Y[7]+4139469664&4294967295,$=J+(te<<16&4294967295|te>>>16),te=B+($^J^G)+Y[10]+3200236656&4294967295,B=$+(te<<23&4294967295|te>>>9),te=G+(B^$^J)+Y[13]+681279174&4294967295,G=B+(te<<4&4294967295|te>>>28),te=J+(G^B^$)+Y[0]+3936430074&4294967295,J=G+(te<<11&4294967295|te>>>21),te=$+(J^G^B)+Y[3]+3572445317&4294967295,$=J+(te<<16&4294967295|te>>>16),te=B+($^J^G)+Y[6]+76029189&4294967295,B=$+(te<<23&4294967295|te>>>9),te=G+(B^$^J)+Y[9]+3654602809&4294967295,G=B+(te<<4&4294967295|te>>>28),te=J+(G^B^$)+Y[12]+3873151461&4294967295,J=G+(te<<11&4294967295|te>>>21),te=$+(J^G^B)+Y[15]+530742520&4294967295,$=J+(te<<16&4294967295|te>>>16),te=B+($^J^G)+Y[2]+3299628645&4294967295,B=$+(te<<23&4294967295|te>>>9),te=G+($^(B|~J))+Y[0]+4096336452&4294967295,G=B+(te<<6&4294967295|te>>>26),te=J+(B^(G|~$))+Y[7]+1126891415&4294967295,J=G+(te<<10&4294967295|te>>>22),te=$+(G^(J|~B))+Y[14]+2878612391&4294967295,$=J+(te<<15&4294967295|te>>>17),te=B+(J^($|~G))+Y[5]+4237533241&4294967295,B=$+(te<<21&4294967295|te>>>11),te=G+($^(B|~J))+Y[12]+1700485571&4294967295,G=B+(te<<6&4294967295|te>>>26),te=J+(B^(G|~$))+Y[3]+2399980690&4294967295,J=G+(te<<10&4294967295|te>>>22),te=$+(G^(J|~B))+Y[10]+4293915773&4294967295,$=J+(te<<15&4294967295|te>>>17),te=B+(J^($|~G))+Y[1]+2240044497&4294967295,B=$+(te<<21&4294967295|te>>>11),te=G+($^(B|~J))+Y[8]+1873313359&4294967295,G=B+(te<<6&4294967295|te>>>26),te=J+(B^(G|~$))+Y[15]+4264355552&4294967295,J=G+(te<<10&4294967295|te>>>22),te=$+(G^(J|~B))+Y[6]+2734768916&4294967295,$=J+(te<<15&4294967295|te>>>17),te=B+(J^($|~G))+Y[13]+1309151649&4294967295,B=$+(te<<21&4294967295|te>>>11),te=G+($^(B|~J))+Y[4]+4149444226&4294967295,G=B+(te<<6&4294967295|te>>>26),te=J+(B^(G|~$))+Y[11]+3174756917&4294967295,J=G+(te<<10&4294967295|te>>>22),te=$+(G^(J|~B))+Y[2]+718787259&4294967295,$=J+(te<<15&4294967295|te>>>17),te=B+(J^($|~G))+Y[9]+3951481745&4294967295,_e.g[0]=_e.g[0]+G&4294967295,_e.g[1]=_e.g[1]+($+(te<<21&4294967295|te>>>11))&4294967295,_e.g[2]=_e.g[2]+$&4294967295,_e.g[3]=_e.g[3]+J&4294967295}i.prototype.u=function(_e,G){G===void 0&&(G=_e.length);for(var B=G-this.blockSize,Y=this.B,$=this.h,J=0;J<G;){if($==0)for(;J<=B;)a(this,_e,J),J+=this.blockSize;if(typeof _e=="string"){for(;J<G;)if(Y[$++]=_e.charCodeAt(J++),$==this.blockSize){a(this,Y),$=0;break}}else for(;J<G;)if(Y[$++]=_e[J++],$==this.blockSize){a(this,Y),$=0;break}}this.h=$,this.o+=G},i.prototype.v=function(){var _e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);_e[0]=128;for(var G=1;G<_e.length-8;++G)_e[G]=0;var B=8*this.o;for(G=_e.length-8;G<_e.length;++G)_e[G]=B&255,B/=256;for(this.u(_e),_e=Array(16),G=B=0;4>G;++G)for(var Y=0;32>Y;Y+=8)_e[B++]=this.g[G]>>>Y&255;return _e};function c(_e,G){var B=y;return Object.prototype.hasOwnProperty.call(B,_e)?B[_e]:B[_e]=G(_e)}function _(_e,G){this.h=G;for(var B=[],Y=!0,$=_e.length-1;0<=$;$--){var J=_e[$]|0;Y&&J==G||(B[$]=J,Y=!1)}this.g=B}var y={};function s(_e){return-128<=_e&&128>_e?c(_e,function(G){return new _([G|0],0>G?-1:0)}):new _([_e|0],0>_e?-1:0)}function T(_e){if(isNaN(_e)||!isFinite(_e))return R;if(0>_e)return ye(T(-_e));for(var G=[],B=1,Y=0;_e>=B;Y++)G[Y]=_e/B|0,B*=4294967296;return new _(G,0)}function L(_e,G){if(_e.length==0)throw Error("number format error: empty string");if(G=G||10,2>G||36<G)throw Error("radix out of range: "+G);if(_e.charAt(0)=="-")return ye(L(_e.substring(1),G));if(0<=_e.indexOf("-"))throw Error('number format error: interior "-" character');for(var B=T(Math.pow(G,8)),Y=R,$=0;$<_e.length;$+=8){var J=Math.min(8,_e.length-$),te=parseInt(_e.substring($,$+J),G);8>J?(J=T(Math.pow(G,J)),Y=Y.j(J).add(T(te))):(Y=Y.j(B),Y=Y.add(T(te)))}return Y}var R=s(0),U=s(1),M=s(16777216);n=_.prototype,n.m=function(){if(ae(this))return-ye(this).m();for(var _e=0,G=1,B=0;B<this.g.length;B++){var Y=this.i(B);_e+=(0<=Y?Y:4294967296+Y)*G,G*=4294967296}return _e},n.toString=function(_e){if(_e=_e||10,2>_e||36<_e)throw Error("radix out of range: "+_e);if(Q(this))return"0";if(ae(this))return"-"+ye(this).toString(_e);for(var G=T(Math.pow(_e,6)),B=this,Y="";;){var $=de(B,G).g;B=ie(B,$.j(G));var J=((0<B.g.length?B.g[0]:B.h)>>>0).toString(_e);if(B=$,Q(B))return J+Y;for(;6>J.length;)J="0"+J;Y=J+Y}},n.i=function(_e){return 0>_e?0:_e<this.g.length?this.g[_e]:this.h};function Q(_e){if(_e.h!=0)return!1;for(var G=0;G<_e.g.length;G++)if(_e.g[G]!=0)return!1;return!0}function ae(_e){return _e.h==-1}n.l=function(_e){return _e=ie(this,_e),ae(_e)?-1:Q(_e)?0:1};function ye(_e){for(var G=_e.g.length,B=[],Y=0;Y<G;Y++)B[Y]=~_e.g[Y];return new _(B,~_e.h).add(U)}n.abs=function(){return ae(this)?ye(this):this},n.add=function(_e){for(var G=Math.max(this.g.length,_e.g.length),B=[],Y=0,$=0;$<=G;$++){var J=Y+(this.i($)&65535)+(_e.i($)&65535),te=(J>>>16)+(this.i($)>>>16)+(_e.i($)>>>16);Y=te>>>16,J&=65535,te&=65535,B[$]=te<<16|J}return new _(B,B[B.length-1]&-2147483648?-1:0)};function ie(_e,G){return _e.add(ye(G))}n.j=function(_e){if(Q(this)||Q(_e))return R;if(ae(this))return ae(_e)?ye(this).j(ye(_e)):ye(ye(this).j(_e));if(ae(_e))return ye(this.j(ye(_e)));if(0>this.l(M)&&0>_e.l(M))return T(this.m()*_e.m());for(var G=this.g.length+_e.g.length,B=[],Y=0;Y<2*G;Y++)B[Y]=0;for(Y=0;Y<this.g.length;Y++)for(var $=0;$<_e.g.length;$++){var J=this.i(Y)>>>16,te=this.i(Y)&65535,Se=_e.i($)>>>16,De=_e.i($)&65535;B[2*Y+2*$]+=te*De,oe(B,2*Y+2*$),B[2*Y+2*$+1]+=J*De,oe(B,2*Y+2*$+1),B[2*Y+2*$+1]+=te*Se,oe(B,2*Y+2*$+1),B[2*Y+2*$+2]+=J*Se,oe(B,2*Y+2*$+2)}for(Y=0;Y<G;Y++)B[Y]=B[2*Y+1]<<16|B[2*Y];for(Y=G;Y<2*G;Y++)B[Y]=0;return new _(B,0)};function oe(_e,G){for(;(_e[G]&65535)!=_e[G];)_e[G+1]+=_e[G]>>>16,_e[G]&=65535,G++}function ve(_e,G){this.g=_e,this.h=G}function de(_e,G){if(Q(G))throw Error("division by zero");if(Q(_e))return new ve(R,R);if(ae(_e))return G=de(ye(_e),G),new ve(ye(G.g),ye(G.h));if(ae(G))return G=de(_e,ye(G)),new ve(ye(G.g),G.h);if(30<_e.g.length){if(ae(_e)||ae(G))throw Error("slowDivide_ only works with positive integers.");for(var B=U,Y=G;0>=Y.l(_e);)B=Pe(B),Y=Pe(Y);var $=Be(B,1),J=Be(Y,1);for(Y=Be(Y,2),B=Be(B,2);!Q(Y);){var te=J.add(Y);0>=te.l(_e)&&($=$.add(B),J=te),Y=Be(Y,1),B=Be(B,1)}return G=ie(_e,$.j(G)),new ve($,G)}for($=R;0<=_e.l(G);){for(B=Math.max(1,Math.floor(_e.m()/G.m())),Y=Math.ceil(Math.log(B)/Math.LN2),Y=48>=Y?1:Math.pow(2,Y-48),J=T(B),te=J.j(G);ae(te)||0<te.l(_e);)B-=Y,J=T(B),te=J.j(G);Q(J)&&(J=U),$=$.add(J),_e=ie(_e,te)}return new ve($,_e)}n.A=function(_e){return de(this,_e).h},n.and=function(_e){for(var G=Math.max(this.g.length,_e.g.length),B=[],Y=0;Y<G;Y++)B[Y]=this.i(Y)&_e.i(Y);return new _(B,this.h&_e.h)},n.or=function(_e){for(var G=Math.max(this.g.length,_e.g.length),B=[],Y=0;Y<G;Y++)B[Y]=this.i(Y)|_e.i(Y);return new _(B,this.h|_e.h)},n.xor=function(_e){for(var G=Math.max(this.g.length,_e.g.length),B=[],Y=0;Y<G;Y++)B[Y]=this.i(Y)^_e.i(Y);return new _(B,this.h^_e.h)};function Pe(_e){for(var G=_e.g.length+1,B=[],Y=0;Y<G;Y++)B[Y]=_e.i(Y)<<1|_e.i(Y-1)>>>31;return new _(B,_e.h)}function Be(_e,G){var B=G>>5;G%=32;for(var Y=_e.g.length-B,$=[],J=0;J<Y;J++)$[J]=0<G?_e.i(J+B)>>>G|_e.i(J+B+1)<<32-G:_e.i(J+B);return new _($,_e.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,lk=i,_.prototype.add=_.prototype.add,_.prototype.multiply=_.prototype.j,_.prototype.modulo=_.prototype.A,_.prototype.compare=_.prototype.l,_.prototype.toNumber=_.prototype.m,_.prototype.toString=_.prototype.toString,_.prototype.getBits=_.prototype.i,_.fromNumber=T,_.fromString=L,ag=_}).apply(typeof UE<"u"?UE:typeof self<"u"?self:typeof window<"u"?window:{});var F1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var uk,$0,ck,dv,p5,hk,fk,dk;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(O,me,ke){return O==Array.prototype||O==Object.prototype||(O[me]=ke.value),O};function t(O){O=[typeof globalThis=="object"&&globalThis,O,typeof window=="object"&&window,typeof self=="object"&&self,typeof F1=="object"&&F1];for(var me=0;me<O.length;++me){var ke=O[me];if(ke&&ke.Math==Math)return ke}throw Error("Cannot find global object")}var i=t(this);function a(O,me){if(me)e:{var ke=i;O=O.split(".");for(var nt=0;nt<O.length-1;nt++){var hn=O[nt];if(!(hn in ke))break e;ke=ke[hn]}O=O[O.length-1],nt=ke[O],me=me(nt),me!=nt&&me!=null&&e(ke,O,{configurable:!0,writable:!0,value:me})}}function c(O,me){O instanceof String&&(O+="");var ke=0,nt=!1,hn={next:function(){if(!nt&&ke<O.length){var Cn=ke++;return{value:me(Cn,O[Cn]),done:!1}}return nt=!0,{done:!0,value:void 0}}};return hn[Symbol.iterator]=function(){return hn},hn}a("Array.prototype.values",function(O){return O||function(){return c(this,function(me,ke){return ke})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var _=_||{},y=this||self;function s(O){var me=typeof O;return me=me!="object"?me:O?Array.isArray(O)?"array":me:"null",me=="array"||me=="object"&&typeof O.length=="number"}function T(O){var me=typeof O;return me=="object"&&O!=null||me=="function"}function L(O,me,ke){return O.call.apply(O.bind,arguments)}function R(O,me,ke){if(!O)throw Error();if(2<arguments.length){var nt=Array.prototype.slice.call(arguments,2);return function(){var hn=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(hn,nt),O.apply(me,hn)}}return function(){return O.apply(me,arguments)}}function U(O,me,ke){return U=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?L:R,U.apply(null,arguments)}function M(O,me){var ke=Array.prototype.slice.call(arguments,1);return function(){var nt=ke.slice();return nt.push.apply(nt,arguments),O.apply(this,nt)}}function Q(O,me){function ke(){}ke.prototype=me.prototype,O.aa=me.prototype,O.prototype=new ke,O.prototype.constructor=O,O.Qb=function(nt,hn,Cn){for(var Sr=Array(arguments.length-2),Rs=2;Rs<arguments.length;Rs++)Sr[Rs-2]=arguments[Rs];return me.prototype[hn].apply(nt,Sr)}}function ae(O){const me=O.length;if(0<me){const ke=Array(me);for(let nt=0;nt<me;nt++)ke[nt]=O[nt];return ke}return[]}function ye(O,me){for(let ke=1;ke<arguments.length;ke++){const nt=arguments[ke];if(s(nt)){const hn=O.length||0,Cn=nt.length||0;O.length=hn+Cn;for(let Sr=0;Sr<Cn;Sr++)O[hn+Sr]=nt[Sr]}else O.push(nt)}}class ie{constructor(me,ke){this.i=me,this.j=ke,this.h=0,this.g=null}get(){let me;return 0<this.h?(this.h--,me=this.g,this.g=me.next,me.next=null):me=this.i(),me}}function oe(O){return/^[\s\xa0]*$/.test(O)}function ve(){var O=y.navigator;return O&&(O=O.userAgent)?O:""}function de(O){return de[" "](O),O}de[" "]=function(){};var Pe=ve().indexOf("Gecko")!=-1&&!(ve().toLowerCase().indexOf("webkit")!=-1&&ve().indexOf("Edge")==-1)&&!(ve().indexOf("Trident")!=-1||ve().indexOf("MSIE")!=-1)&&ve().indexOf("Edge")==-1;function Be(O,me,ke){for(const nt in O)me.call(ke,O[nt],nt,O)}function _e(O,me){for(const ke in O)me.call(void 0,O[ke],ke,O)}function G(O){const me={};for(const ke in O)me[ke]=O[ke];return me}const B="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(O,me){let ke,nt;for(let hn=1;hn<arguments.length;hn++){nt=arguments[hn];for(ke in nt)O[ke]=nt[ke];for(let Cn=0;Cn<B.length;Cn++)ke=B[Cn],Object.prototype.hasOwnProperty.call(nt,ke)&&(O[ke]=nt[ke])}}function $(O){var me=1;O=O.split(":");const ke=[];for(;0<me&&O.length;)ke.push(O.shift()),me--;return O.length&&ke.push(O.join(":")),ke}function J(O){y.setTimeout(()=>{throw O},0)}function te(){var O=He;let me=null;return O.g&&(me=O.g,O.g=O.g.next,O.g||(O.h=null),me.next=null),me}class Se{constructor(){this.h=this.g=null}add(me,ke){const nt=De.get();nt.set(me,ke),this.h?this.h.next=nt:this.g=nt,this.h=nt}}var De=new ie(()=>new $e,O=>O.reset());class $e{constructor(){this.next=this.g=this.h=null}set(me,ke){this.h=me,this.g=ke,this.next=null}reset(){this.next=this.g=this.h=null}}let Ue,Le=!1,He=new Se,Ke=()=>{const O=y.Promise.resolve(void 0);Ue=()=>{O.then(Ce)}};var Ce=()=>{for(var O;O=te();){try{O.h.call(O.g)}catch(ke){J(ke)}var me=De;me.j(O),100>me.h&&(me.h++,O.next=me.g,me.g=O)}Le=!1};function ge(){this.s=this.s,this.C=this.C}ge.prototype.s=!1,ge.prototype.ma=function(){this.s||(this.s=!0,this.N())},ge.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function We(O,me){this.type=O,this.g=this.target=me,this.defaultPrevented=!1}We.prototype.h=function(){this.defaultPrevented=!0};var Ve=(function(){if(!y.addEventListener||!Object.defineProperty)return!1;var O=!1,me=Object.defineProperty({},"passive",{get:function(){O=!0}});try{const ke=()=>{};y.addEventListener("test",ke,me),y.removeEventListener("test",ke,me)}catch{}return O})();function ut(O,me){if(We.call(this,O?O.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,O){var ke=this.type=O.type,nt=O.changedTouches&&O.changedTouches.length?O.changedTouches[0]:null;if(this.target=O.target||O.srcElement,this.g=me,me=O.relatedTarget){if(Pe){e:{try{de(me.nodeName);var hn=!0;break e}catch{}hn=!1}hn||(me=null)}}else ke=="mouseover"?me=O.fromElement:ke=="mouseout"&&(me=O.toElement);this.relatedTarget=me,nt?(this.clientX=nt.clientX!==void 0?nt.clientX:nt.pageX,this.clientY=nt.clientY!==void 0?nt.clientY:nt.pageY,this.screenX=nt.screenX||0,this.screenY=nt.screenY||0):(this.clientX=O.clientX!==void 0?O.clientX:O.pageX,this.clientY=O.clientY!==void 0?O.clientY:O.pageY,this.screenX=O.screenX||0,this.screenY=O.screenY||0),this.button=O.button,this.key=O.key||"",this.ctrlKey=O.ctrlKey,this.altKey=O.altKey,this.shiftKey=O.shiftKey,this.metaKey=O.metaKey,this.pointerId=O.pointerId||0,this.pointerType=typeof O.pointerType=="string"?O.pointerType:pt[O.pointerType]||"",this.state=O.state,this.i=O,O.defaultPrevented&&ut.aa.h.call(this)}}Q(ut,We);var pt={2:"touch",3:"pen",4:"mouse"};ut.prototype.h=function(){ut.aa.h.call(this);var O=this.i;O.preventDefault?O.preventDefault():O.returnValue=!1};var It="closure_listenable_"+(1e6*Math.random()|0),Oe=0;function Wt(O,me,ke,nt,hn){this.listener=O,this.proxy=null,this.src=me,this.type=ke,this.capture=!!nt,this.ha=hn,this.key=++Oe,this.da=this.fa=!1}function Zt(O){O.da=!0,O.listener=null,O.proxy=null,O.src=null,O.ha=null}function Xt(O){this.src=O,this.g={},this.h=0}Xt.prototype.add=function(O,me,ke,nt,hn){var Cn=O.toString();O=this.g[Cn],O||(O=this.g[Cn]=[],this.h++);var Sr=zn(O,me,nt,hn);return-1<Sr?(me=O[Sr],ke||(me.fa=!1)):(me=new Wt(me,this.src,Cn,!!nt,hn),me.fa=ke,O.push(me)),me};function Ze(O,me){var ke=me.type;if(ke in O.g){var nt=O.g[ke],hn=Array.prototype.indexOf.call(nt,me,void 0),Cn;(Cn=0<=hn)&&Array.prototype.splice.call(nt,hn,1),Cn&&(Zt(me),O.g[ke].length==0&&(delete O.g[ke],O.h--))}}function zn(O,me,ke,nt){for(var hn=0;hn<O.length;++hn){var Cn=O[hn];if(!Cn.da&&Cn.listener==me&&Cn.capture==!!ke&&Cn.ha==nt)return hn}return-1}var on="closure_lm_"+(1e6*Math.random()|0),mt={};function Ir(O,me,ke,nt,hn){if(Array.isArray(me)){for(var Cn=0;Cn<me.length;Cn++)Ir(O,me[Cn],ke,nt,hn);return null}return ke=sr(ke),O&&O[It]?O.K(me,ke,T(nt)?!!nt.capture:!1,hn):Fr(O,me,ke,!1,nt,hn)}function Fr(O,me,ke,nt,hn,Cn){if(!me)throw Error("Invalid event type");var Sr=T(hn)?!!hn.capture:!!hn,Rs=nn(O);if(Rs||(O[on]=Rs=new Xt(O)),ke=Rs.add(me,ke,nt,Sr,Cn),ke.proxy)return ke;if(nt=qr(),ke.proxy=nt,nt.src=O,nt.listener=ke,O.addEventListener)Ve||(hn=Sr),hn===void 0&&(hn=!1),O.addEventListener(me.toString(),nt,hn);else if(O.attachEvent)O.attachEvent(dr(me.toString()),nt);else if(O.addListener&&O.removeListener)O.addListener(nt);else throw Error("addEventListener and attachEvent are unavailable.");return ke}function qr(){function O(ke){return me.call(O.src,O.listener,ke)}const me=ni;return O}function $t(O,me,ke,nt,hn){if(Array.isArray(me))for(var Cn=0;Cn<me.length;Cn++)$t(O,me[Cn],ke,nt,hn);else nt=T(nt)?!!nt.capture:!!nt,ke=sr(ke),O&&O[It]?(O=O.i,me=String(me).toString(),me in O.g&&(Cn=O.g[me],ke=zn(Cn,ke,nt,hn),-1<ke&&(Zt(Cn[ke]),Array.prototype.splice.call(Cn,ke,1),Cn.length==0&&(delete O.g[me],O.h--)))):O&&(O=nn(O))&&(me=O.g[me.toString()],O=-1,me&&(O=zn(me,ke,nt,hn)),(ke=-1<O?me[O]:null)&&xr(ke))}function xr(O){if(typeof O!="number"&&O&&!O.da){var me=O.src;if(me&&me[It])Ze(me.i,O);else{var ke=O.type,nt=O.proxy;me.removeEventListener?me.removeEventListener(ke,nt,O.capture):me.detachEvent?me.detachEvent(dr(ke),nt):me.addListener&&me.removeListener&&me.removeListener(nt),(ke=nn(me))?(Ze(ke,O),ke.h==0&&(ke.src=null,me[on]=null)):Zt(O)}}}function dr(O){return O in mt?mt[O]:mt[O]="on"+O}function ni(O,me){if(O.da)O=!0;else{me=new ut(me,this);var ke=O.listener,nt=O.ha||O.src;O.fa&&xr(O),O=ke.call(nt,me)}return O}function nn(O){return O=O[on],O instanceof Xt?O:null}var yn="__closure_events_fn_"+(1e9*Math.random()>>>0);function sr(O){return typeof O=="function"?O:(O[yn]||(O[yn]=function(me){return O.handleEvent(me)}),O[yn])}function Zn(){ge.call(this),this.i=new Xt(this),this.M=this,this.F=null}Q(Zn,ge),Zn.prototype[It]=!0,Zn.prototype.removeEventListener=function(O,me,ke,nt){$t(this,O,me,ke,nt)};function $r(O,me){var ke,nt=O.F;if(nt)for(ke=[];nt;nt=nt.F)ke.push(nt);if(O=O.M,nt=me.type||me,typeof me=="string")me=new We(me,O);else if(me instanceof We)me.target=me.target||O;else{var hn=me;me=new We(nt,O),Y(me,hn)}if(hn=!0,ke)for(var Cn=ke.length-1;0<=Cn;Cn--){var Sr=me.g=ke[Cn];hn=qn(Sr,nt,!0,me)&&hn}if(Sr=me.g=O,hn=qn(Sr,nt,!0,me)&&hn,hn=qn(Sr,nt,!1,me)&&hn,ke)for(Cn=0;Cn<ke.length;Cn++)Sr=me.g=ke[Cn],hn=qn(Sr,nt,!1,me)&&hn}Zn.prototype.N=function(){if(Zn.aa.N.call(this),this.i){var O=this.i,me;for(me in O.g){for(var ke=O.g[me],nt=0;nt<ke.length;nt++)Zt(ke[nt]);delete O.g[me],O.h--}}this.F=null},Zn.prototype.K=function(O,me,ke,nt){return this.i.add(String(O),me,!1,ke,nt)},Zn.prototype.L=function(O,me,ke,nt){return this.i.add(String(O),me,!0,ke,nt)};function qn(O,me,ke,nt){if(me=O.i.g[String(me)],!me)return!0;me=me.concat();for(var hn=!0,Cn=0;Cn<me.length;++Cn){var Sr=me[Cn];if(Sr&&!Sr.da&&Sr.capture==ke){var Rs=Sr.listener,so=Sr.ha||Sr.src;Sr.fa&&Ze(O.i,Sr),hn=Rs.call(so,nt)!==!1&&hn}}return hn&&!nt.defaultPrevented}function jr(O,me,ke){if(typeof O=="function")ke&&(O=U(O,ke));else if(O&&typeof O.handleEvent=="function")O=U(O.handleEvent,O);else throw Error("Invalid listener argument");return 2147483647<Number(me)?-1:y.setTimeout(O,me||0)}function ir(O){O.g=jr(()=>{O.g=null,O.i&&(O.i=!1,ir(O))},O.l);const me=O.h;O.h=null,O.m.apply(null,me)}class Xn extends ge{constructor(me,ke){super(),this.m=me,this.l=ke,this.h=null,this.i=!1,this.g=null}j(me){this.h=arguments,this.g?this.i=!0:ir(this)}N(){super.N(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Bi(O){ge.call(this),this.h=O,this.g={}}Q(Bi,ge);var bi=[];function wr(O){Be(O.g,function(me,ke){this.g.hasOwnProperty(ke)&&xr(me)},O),O.g={}}Bi.prototype.N=function(){Bi.aa.N.call(this),wr(this)},Bi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var or=y.JSON.stringify,ui=y.JSON.parse,Kr=class{stringify(O){return y.JSON.stringify(O,void 0)}parse(O){return y.JSON.parse(O,void 0)}};function wi(){}wi.prototype.h=null;function si(O){return O.h||(O.h=O.i())}function vt(){}var Ne={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ze(){We.call(this,"d")}Q(ze,We);function ft(){We.call(this,"c")}Q(ft,We);var wt={},Ut=null;function Gt(){return Ut=Ut||new Zn}wt.La="serverreachability";function Tt(O){We.call(this,wt.La,O)}Q(Tt,We);function Ot(O){const me=Gt();$r(me,new Tt(me))}wt.STAT_EVENT="statevent";function zt(O,me){We.call(this,wt.STAT_EVENT,O),this.stat=me}Q(zt,We);function Pn(O){const me=Gt();$r(me,new zt(me,O))}wt.Ma="timingevent";function Jn(O,me){We.call(this,wt.Ma,O),this.size=me}Q(Jn,We);function Fn(O,me){if(typeof O!="function")throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){O()},me)}function Gr(){this.g=!0}Gr.prototype.xa=function(){this.g=!1};function Mr(O,me,ke,nt,hn,Cn){O.info(function(){if(O.g)if(Cn)for(var Sr="",Rs=Cn.split("&"),so=0;so<Rs.length;so++){var hs=Rs[so].split("=");if(1<hs.length){var es=hs[0];hs=hs[1];var Js=es.split("_");Sr=2<=Js.length&&Js[1]=="type"?Sr+(es+"="+hs+"&"):Sr+(es+"=redacted&")}}else Sr=null;else Sr=Cn;return"XMLHTTP REQ ("+nt+") [attempt "+hn+"]: "+me+`
`+ke+`
`+Sr})}function Zr(O,me,ke,nt,hn,Cn,Sr){O.info(function(){return"XMLHTTP RESP ("+nt+") [ attempt "+hn+"]: "+me+`
`+ke+`
`+Cn+" "+Sr})}function Br(O,me,ke,nt){O.info(function(){return"XMLHTTP TEXT ("+me+"): "+ms(O,ke)+(nt?" "+nt:"")})}function zi(O,me){O.info(function(){return"TIMEOUT: "+me})}Gr.prototype.info=function(){};function ms(O,me){if(!O.g)return me;if(!me)return null;try{var ke=JSON.parse(me);if(ke){for(O=0;O<ke.length;O++)if(Array.isArray(ke[O])){var nt=ke[O];if(!(2>nt.length)){var hn=nt[1];if(Array.isArray(hn)&&!(1>hn.length)){var Cn=hn[0];if(Cn!="noop"&&Cn!="stop"&&Cn!="close")for(var Sr=1;Sr<hn.length;Sr++)hn[Sr]=""}}}}return or(ke)}catch{return me}}var Os={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},cs={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ps;function vo(){}Q(vo,wi),vo.prototype.g=function(){return new XMLHttpRequest},vo.prototype.i=function(){return{}},ps=new vo;function is(O,me,ke,nt){this.j=O,this.i=me,this.l=ke,this.R=nt||1,this.U=new Bi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new xo}function xo(){this.i=null,this.g="",this.h=!1}var ua={},tl={};function Pa(O,me,ke){O.L=1,O.v=Tl(Ur(me)),O.m=ke,O.P=!0,di(O,null)}function di(O,me){O.F=Date.now(),Ss(O),O.A=Ur(O.v);var ke=O.A,nt=O.R;Array.isArray(nt)||(nt=[String(nt)]),gi(ke.i,"t",nt),O.C=0,ke=O.j.J,O.h=new xo,O.g=Zs(O.j,ke?me:null,!O.m),0<O.O&&(O.M=new Xn(U(O.Y,O,O.g),O.O)),me=O.U,ke=O.g,nt=O.ca;var hn="readystatechange";Array.isArray(hn)||(hn&&(bi[0]=hn.toString()),hn=bi);for(var Cn=0;Cn<hn.length;Cn++){var Sr=Ir(ke,hn[Cn],nt||me.handleEvent,!1,me.h||me);if(!Sr)break;me.g[Sr.key]=Sr}me=O.H?G(O.H):{},O.m?(O.u||(O.u="POST"),me["Content-Type"]="application/x-www-form-urlencoded",O.g.ea(O.A,O.u,O.m,me)):(O.u="GET",O.g.ea(O.A,O.u,null,me)),Ot(),Mr(O.i,O.u,O.A,O.l,O.R,O.m)}is.prototype.ca=function(O){O=O.target;const me=this.M;me&&qs(O)==3?me.j():this.Y(O)},is.prototype.Y=function(O){try{if(O==this.g)e:{const Js=qs(this.g);var me=this.g.Ba();const da=this.g.Z();if(!(3>Js)&&(Js!=3||this.g&&(this.h.h||this.g.oa()||Lo(this.g)))){this.J||Js!=4||me==7||(me==8||0>=da?Ot(3):Ot(2)),ga(this);var ke=this.g.Z();this.X=ke;t:if(ou(this)){var nt=Lo(this.g);O="";var hn=nt.length,Cn=qs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){nl(this),uo(this);var Sr="";break t}this.h.i=new y.TextDecoder}for(me=0;me<hn;me++)this.h.h=!0,O+=this.h.i.decode(nt[me],{stream:!(Cn&&me==hn-1)});nt.length=0,this.h.g+=O,this.C=0,Sr=this.h.g}else Sr=this.g.oa();if(this.o=ke==200,Zr(this.i,this.u,this.A,this.l,this.R,Js,ke),this.o){if(this.T&&!this.K){t:{if(this.g){var Rs,so=this.g;if((Rs=so.g?so.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!oe(Rs)){var hs=Rs;break t}}hs=null}if(ke=hs)Br(this.i,this.l,ke,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Kl(this,ke);else{this.o=!1,this.s=3,Pn(12),nl(this),uo(this);break e}}if(this.P){ke=!0;let oo;for(;!this.J&&this.C<Sr.length;)if(oo=yc(this,Sr),oo==tl){Js==4&&(this.s=4,Pn(14),ke=!1),Br(this.i,this.l,null,"[Incomplete Response]");break}else if(oo==ua){this.s=4,Pn(15),Br(this.i,this.l,Sr,"[Invalid Chunk]"),ke=!1;break}else Br(this.i,this.l,oo,null),Kl(this,oo);if(ou(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Js!=4||Sr.length!=0||this.h.h||(this.s=1,Pn(16),ke=!1),this.o=this.o&&ke,!ke)Br(this.i,this.l,Sr,"[Invalid Chunked Response]"),nl(this),uo(this);else if(0<Sr.length&&!this.W){this.W=!0;var es=this.j;es.g==this&&es.ba&&!es.M&&(es.j.info("Great, no buffering proxy detected. Bytes received: "+Sr.length),Xr(es),es.M=!0,Pn(11))}}else Br(this.i,this.l,Sr,null),Kl(this,Sr);Js==4&&nl(this),this.o&&!this.J&&(Js==4?Ui(this.j,this):(this.o=!1,Ss(this)))}else _a(this.g),ke==400&&0<Sr.indexOf("Unknown SID")?(this.s=3,Pn(12)):(this.s=0,Pn(13)),nl(this),uo(this)}}}catch{}finally{}};function ou(O){return O.g?O.u=="GET"&&O.L!=2&&O.j.Ca:!1}function yc(O,me){var ke=O.C,nt=me.indexOf(`
`,ke);return nt==-1?tl:(ke=Number(me.substring(ke,nt)),isNaN(ke)?ua:(nt+=1,nt+ke>me.length?tl:(me=me.slice(nt,nt+ke),O.C=nt+ke,me)))}is.prototype.cancel=function(){this.J=!0,nl(this)};function Ss(O){O.S=Date.now()+O.I,au(O,O.I)}function au(O,me){if(O.B!=null)throw Error("WatchDog timer not null");O.B=Fn(U(O.ba,O),me)}function ga(O){O.B&&(y.clearTimeout(O.B),O.B=null)}is.prototype.ba=function(){this.B=null;const O=Date.now();0<=O-this.S?(zi(this.i,this.A),this.L!=2&&(Ot(),Pn(17)),nl(this),this.s=2,uo(this)):au(this,this.S-O)};function uo(O){O.j.G==0||O.J||Ui(O.j,O)}function nl(O){ga(O);var me=O.M;me&&typeof me.ma=="function"&&me.ma(),O.M=null,wr(O.U),O.g&&(me=O.g,O.g=null,me.abort(),me.ma())}function Kl(O,me){try{var ke=O.j;if(ke.G!=0&&(ke.g==O||co(ke.h,O))){if(!O.K&&co(ke.h,O)&&ke.G==3){try{var nt=ke.Da.g.parse(me)}catch{nt=null}if(Array.isArray(nt)&&nt.length==3){var hn=nt;if(hn[0]==0){e:if(!ke.u){if(ke.g)if(ke.g.F+3e3<O.F)oi(ke),fa(ke);else break e;Qn(ke),Pn(18)}}else ke.za=hn[1],0<ke.za-ke.T&&37500>hn[2]&&ke.F&&ke.v==0&&!ke.C&&(ke.C=Fn(U(ke.Za,ke),6e3));if(1>=En(ke.h)&&ke.ca){try{ke.ca()}catch{}ke.ca=void 0}}else Bs(ke,11)}else if((O.K||ke.g==O)&&oi(ke),!oe(me))for(hn=ke.Da.g.parse(me),me=0;me<hn.length;me++){let hs=hn[me];if(ke.T=hs[0],hs=hs[1],ke.G==2)if(hs[0]=="c"){ke.K=hs[1],ke.ia=hs[2];const es=hs[3];es!=null&&(ke.la=es,ke.j.info("VER="+ke.la));const Js=hs[4];Js!=null&&(ke.Aa=Js,ke.j.info("SVER="+ke.Aa));const da=hs[5];da!=null&&typeof da=="number"&&0<da&&(nt=1.5*da,ke.L=nt,ke.j.info("backChannelRequestTimeoutMs_="+nt)),nt=ke;const oo=O.g;if(oo){const Vi=oo.g?oo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Vi){var Cn=nt.h;Cn.g||Vi.indexOf("spdy")==-1&&Vi.indexOf("quic")==-1&&Vi.indexOf("h2")==-1||(Cn.j=Cn.l,Cn.g=new Set,Cn.h&&(Io(Cn,Cn.h),Cn.h=null))}if(nt.D){const Zl=oo.g?oo.g.getResponseHeader("X-HTTP-Session-Id"):null;Zl&&(nt.ya=Zl,Hi(nt.I,nt.D,Zl))}}ke.G=3,ke.l&&ke.l.ua(),ke.ba&&(ke.R=Date.now()-O.F,ke.j.info("Handshake RTT: "+ke.R+"ms")),nt=ke;var Sr=O;if(nt.qa=Ys(nt,nt.J?nt.ia:null,nt.W),Sr.K){Ni(nt.h,Sr);var Rs=Sr,so=nt.L;so&&(Rs.I=so),Rs.B&&(ga(Rs),Ss(Rs)),nt.g=Sr}else fn(nt);0<ke.i.length&&ee(ke)}else hs[0]!="stop"&&hs[0]!="close"||Bs(ke,7);else ke.G==3&&(hs[0]=="stop"||hs[0]=="close"?hs[0]=="stop"?Bs(ke,7):Po(ke):hs[0]!="noop"&&ke.l&&ke.l.ta(hs),ke.v=0)}}Ot(4)}catch{}}var ea=class{constructor(O,me){this.g=O,this.map=me}};function Wo(O){this.l=O||10,y.PerformanceNavigationTiming?(O=y.performance.getEntriesByType("navigation"),O=0<O.length&&(O[0].nextHopProtocol=="hq"||O[0].nextHopProtocol=="h2")):O=!!(y.chrome&&y.chrome.loadTimes&&y.chrome.loadTimes()&&y.chrome.loadTimes().wasFetchedViaSpdy),this.j=O?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ta(O){return O.h?!0:O.g?O.g.size>=O.j:!1}function En(O){return O.h?1:O.g?O.g.size:0}function co(O,me){return O.h?O.h==me:O.g?O.g.has(me):!1}function Io(O,me){O.g?O.g.add(me):O.h=me}function Ni(O,me){O.h&&O.h==me?O.h=null:O.g&&O.g.has(me)&&O.g.delete(me)}Wo.prototype.cancel=function(){if(this.i=ic(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const O of this.g.values())O.cancel();this.g.clear()}};function ic(O){if(O.h!=null)return O.i.concat(O.h.D);if(O.g!=null&&O.g.size!==0){let me=O.i;for(const ke of O.g.values())me=me.concat(ke.D);return me}return ae(O.i)}function rl(O){if(O.V&&typeof O.V=="function")return O.V();if(typeof Map<"u"&&O instanceof Map||typeof Set<"u"&&O instanceof Set)return Array.from(O.values());if(typeof O=="string")return O.split("");if(s(O)){for(var me=[],ke=O.length,nt=0;nt<ke;nt++)me.push(O[nt]);return me}me=[],ke=0;for(nt in O)me[ke++]=O[nt];return me}function il(O){if(O.na&&typeof O.na=="function")return O.na();if(!O.V||typeof O.V!="function"){if(typeof Map<"u"&&O instanceof Map)return Array.from(O.keys());if(!(typeof Set<"u"&&O instanceof Set)){if(s(O)||typeof O=="string"){var me=[];O=O.length;for(var ke=0;ke<O;ke++)me.push(ke);return me}me=[],ke=0;for(const nt in O)me[ke++]=nt;return me}}}function Ga(O,me){if(O.forEach&&typeof O.forEach=="function")O.forEach(me,void 0);else if(s(O)||typeof O=="string")Array.prototype.forEach.call(O,me,void 0);else for(var ke=il(O),nt=rl(O),hn=nt.length,Cn=0;Cn<hn;Cn++)me.call(void 0,nt[Cn],ke&&ke[Cn],O)}var ho=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function lr(O,me){if(O){O=O.split("&");for(var ke=0;ke<O.length;ke++){var nt=O[ke].indexOf("="),hn=null;if(0<=nt){var Cn=O[ke].substring(0,nt);hn=O[ke].substring(nt+1)}else Cn=O[ke];me(Cn,hn?decodeURIComponent(hn.replace(/\+/g," ")):"")}}}function Wr(O){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,O instanceof Wr){this.h=O.h,ca(this,O.j),this.o=O.o,this.g=O.g,$a(this,O.s),this.l=O.l;var me=O.i,ke=new sl;ke.i=me.i,me.g&&(ke.g=new Map(me.g),ke.h=me.h),Ri(this,ke),this.m=O.m}else O&&(me=String(O).match(ho))?(this.h=!1,ca(this,me[1]||"",!0),this.o=Wi(me[2]||""),this.g=Wi(me[3]||"",!0),$a(this,me[4]),this.l=Wi(me[5]||"",!0),Ri(this,me[6]||"",!0),this.m=Wi(me[7]||"")):(this.h=!1,this.i=new sl(null,this.h))}Wr.prototype.toString=function(){var O=[],me=this.j;me&&O.push(ko(me,$u,!0),":");var ke=this.g;return(ke||me=="file")&&(O.push("//"),(me=this.o)&&O.push(ko(me,$u,!0),"@"),O.push(encodeURIComponent(String(ke)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ke=this.s,ke!=null&&O.push(":",String(ke))),(ke=this.l)&&(this.g&&ke.charAt(0)!="/"&&O.push("/"),O.push(ko(ke,ke.charAt(0)=="/"?mu:lu,!0))),(ke=this.i.toString())&&O.push("?",ke),(ke=this.m)&&O.push("#",ko(ke,Ha)),O.join("")};function Ur(O){return new Wr(O)}function ca(O,me,ke){O.j=ke?Wi(me,!0):me,O.j&&(O.j=O.j.replace(/:$/,""))}function $a(O,me){if(me){if(me=Number(me),isNaN(me)||0>me)throw Error("Bad port number "+me);O.s=me}else O.s=null}function Ri(O,me,ke){me instanceof sl?(O.i=me,Vs(O.i,O.h)):(ke||(me=ko(me,Us)),O.i=new sl(me,O.h))}function Hi(O,me,ke){O.i.set(me,ke)}function Tl(O){return Hi(O,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),O}function Wi(O,me){return O?me?decodeURI(O.replace(/%25/g,"%2525")):decodeURIComponent(O):""}function ko(O,me,ke){return typeof O=="string"?(O=encodeURI(O).replace(me,ss),ke&&(O=O.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),O):null}function ss(O){return O=O.charCodeAt(0),"%"+(O>>4&15).toString(16)+(O&15).toString(16)}var $u=/[#\/\?@]/g,lu=/[#\?:]/g,mu=/[#\?]/g,Us=/[#\?@]/g,Ha=/#/g;function sl(O,me){this.h=this.g=null,this.i=O||null,this.j=!!me}function Vo(O){O.g||(O.g=new Map,O.h=0,O.i&&lr(O.i,function(me,ke){O.add(decodeURIComponent(me.replace(/\+/g," ")),ke)}))}n=sl.prototype,n.add=function(O,me){Vo(this),this.i=null,O=wo(this,O);var ke=this.g.get(O);return ke||this.g.set(O,ke=[]),ke.push(me),this.h+=1,this};function Ei(O,me){Vo(O),me=wo(O,me),O.g.has(me)&&(O.i=null,O.h-=O.g.get(me).length,O.g.delete(me))}function bo(O,me){return Vo(O),me=wo(O,me),O.g.has(me)}n.forEach=function(O,me){Vo(this),this.g.forEach(function(ke,nt){ke.forEach(function(hn){O.call(me,hn,nt,this)},this)},this)},n.na=function(){Vo(this);const O=Array.from(this.g.values()),me=Array.from(this.g.keys()),ke=[];for(let nt=0;nt<me.length;nt++){const hn=O[nt];for(let Cn=0;Cn<hn.length;Cn++)ke.push(me[nt])}return ke},n.V=function(O){Vo(this);let me=[];if(typeof O=="string")bo(this,O)&&(me=me.concat(this.g.get(wo(this,O))));else{O=Array.from(this.g.values());for(let ke=0;ke<O.length;ke++)me=me.concat(O[ke])}return me},n.set=function(O,me){return Vo(this),this.i=null,O=wo(this,O),bo(this,O)&&(this.h-=this.g.get(O).length),this.g.set(O,[me]),this.h+=1,this},n.get=function(O,me){return O?(O=this.V(O),0<O.length?String(O[0]):me):me};function gi(O,me,ke){Ei(O,me),0<ke.length&&(O.i=null,O.g.set(wo(O,me),ae(ke)),O.h+=ke.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const O=[],me=Array.from(this.g.keys());for(var ke=0;ke<me.length;ke++){var nt=me[ke];const Cn=encodeURIComponent(String(nt)),Sr=this.V(nt);for(nt=0;nt<Sr.length;nt++){var hn=Cn;Sr[nt]!==""&&(hn+="="+encodeURIComponent(String(Sr[nt]))),O.push(hn)}}return this.i=O.join("&")};function wo(O,me){return me=String(me),O.j&&(me=me.toLowerCase()),me}function Vs(O,me){me&&!O.j&&(Vo(O),O.i=null,O.g.forEach(function(ke,nt){var hn=nt.toLowerCase();nt!=hn&&(Ei(this,nt),gi(this,hn,ke))},O)),O.j=me}function Nc(O,me){const ke=new Gr;if(y.Image){const nt=new Image;nt.onload=M(Fs,ke,"TestLoadImage: loaded",!0,me,nt),nt.onerror=M(Fs,ke,"TestLoadImage: error",!1,me,nt),nt.onabort=M(Fs,ke,"TestLoadImage: abort",!1,me,nt),nt.ontimeout=M(Fs,ke,"TestLoadImage: timeout",!1,me,nt),y.setTimeout(function(){nt.ontimeout&&nt.ontimeout()},1e4),nt.src=O}else me(!1)}function Pu(O,me){const ke=new Gr,nt=new AbortController,hn=setTimeout(()=>{nt.abort(),Fs(ke,"TestPingServer: timeout",!1,me)},1e4);fetch(O,{signal:nt.signal}).then(Cn=>{clearTimeout(hn),Cn.ok?Fs(ke,"TestPingServer: ok",!0,me):Fs(ke,"TestPingServer: server error",!1,me)}).catch(()=>{clearTimeout(hn),Fs(ke,"TestPingServer: error",!1,me)})}function Fs(O,me,ke,nt,hn){try{hn&&(hn.onload=null,hn.onerror=null,hn.onabort=null,hn.ontimeout=null),nt(ke)}catch{}}function na(){this.g=new Kr}function Es(O,me,ke){const nt=ke||"";try{Ga(O,function(hn,Cn){let Sr=hn;T(hn)&&(Sr=or(hn)),me.push(nt+Cn+"="+encodeURIComponent(Sr))})}catch(hn){throw me.push(nt+"type="+encodeURIComponent("_badmap")),hn}}function xs(O){this.l=O.Ub||null,this.j=O.eb||!1}Q(xs,wi),xs.prototype.g=function(){return new Ts(this.l,this.j)},xs.prototype.i=(function(O){return function(){return O}})({});function Ts(O,me){Zn.call(this),this.D=O,this.o=me,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}Q(Ts,Zn),n=Ts.prototype,n.open=function(O,me){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=O,this.A=me,this.readyState=1,ra(this)},n.send=function(O){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const me={headers:this.u,method:this.B,credentials:this.m,cache:void 0};O&&(me.body=O),(this.D||y).fetch(new Request(this.A,me)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ha(this)),this.readyState=0},n.Sa=function(O){if(this.g&&(this.l=O,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=O.headers,this.readyState=2,ra(this)),this.g&&(this.readyState=3,ra(this),this.g)))if(this.responseType==="arraybuffer")O.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof y.ReadableStream<"u"&&"body"in O){if(this.j=O.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ol(this)}else O.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ol(O){O.j.read().then(O.Pa.bind(O)).catch(O.ga.bind(O))}n.Pa=function(O){if(this.g){if(this.o&&O.value)this.response.push(O.value);else if(!this.o){var me=O.value?O.value:new Uint8Array(0);(me=this.v.decode(me,{stream:!O.done}))&&(this.response=this.responseText+=me)}O.done?ha(this):ra(this),this.readyState==3&&Ol(this)}},n.Ra=function(O){this.g&&(this.response=this.responseText=O,ha(this))},n.Qa=function(O){this.g&&(this.response=O,ha(this))},n.ga=function(){this.g&&ha(this)};function ha(O){O.readyState=4,O.l=null,O.j=null,O.v=null,ra(O)}n.setRequestHeader=function(O,me){this.u.append(O,me)},n.getResponseHeader=function(O){return this.h&&this.h.get(O.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const O=[],me=this.h.entries();for(var ke=me.next();!ke.done;)ke=ke.value,O.push(ke[0]+": "+ke[1]),ke=me.next();return O.join(`\r
`)};function ra(O){O.onreadystatechange&&O.onreadystatechange.call(O)}Object.defineProperty(Ts.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(O){this.m=O?"include":"same-origin"}});function os(O){let me="";return Be(O,function(ke,nt){me+=nt,me+=":",me+=ke,me+=`\r
`}),me}function gu(O,me,ke){e:{for(nt in ke){var nt=!1;break e}nt=!0}nt||(ke=os(ke),typeof O=="string"?ke!=null&&encodeURIComponent(String(ke)):Hi(O,me,ke))}function ro(O){Zn.call(this),this.headers=new Map,this.o=O||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}Q(ro,Zn);var ya=/^https?$/i,ol=["POST","PUT"];n=ro.prototype,n.Ha=function(O){this.J=O},n.ea=function(O,me,ke,nt){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+O);me=me?me.toUpperCase():"GET",this.D=O,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ps.g(),this.v=this.o?si(this.o):si(ps),this.g.onreadystatechange=U(this.Ea,this);try{this.B=!0,this.g.open(me,String(O),!0),this.B=!1}catch(Cn){Al(this,Cn);return}if(O=ke||"",ke=new Map(this.headers),nt)if(Object.getPrototypeOf(nt)===Object.prototype)for(var hn in nt)ke.set(hn,nt[hn]);else if(typeof nt.keys=="function"&&typeof nt.get=="function")for(const Cn of nt.keys())ke.set(Cn,nt.get(Cn));else throw Error("Unknown input type for opt_headers: "+String(nt));nt=Array.from(ke.keys()).find(Cn=>Cn.toLowerCase()=="content-type"),hn=y.FormData&&O instanceof y.FormData,!(0<=Array.prototype.indexOf.call(ol,me,void 0))||nt||hn||ke.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Cn,Sr]of ke)this.g.setRequestHeader(Cn,Sr);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ji(this),this.u=!0,this.g.send(O),this.u=!1}catch(Cn){Al(this,Cn)}};function Al(O,me){O.h=!1,O.g&&(O.j=!0,O.g.abort(),O.j=!1),O.l=me,O.m=5,Nu(O),qo(O)}function Nu(O){O.A||(O.A=!0,$r(O,"complete"),$r(O,"error"))}n.abort=function(O){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=O||7,$r(this,"complete"),$r(this,"abort"),qo(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),qo(this,!0)),ro.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Na(this):this.bb())},n.bb=function(){Na(this)};function Na(O){if(O.h&&typeof _<"u"&&(!O.v[1]||qs(O)!=4||O.Z()!=2)){if(O.u&&qs(O)==4)jr(O.Ea,0,O);else if($r(O,"readystatechange"),qs(O)==4){O.h=!1;try{const Sr=O.Z();e:switch(Sr){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var me=!0;break e;default:me=!1}var ke;if(!(ke=me)){var nt;if(nt=Sr===0){var hn=String(O.D).match(ho)[1]||null;!hn&&y.self&&y.self.location&&(hn=y.self.location.protocol.slice(0,-1)),nt=!ya.test(hn?hn.toLowerCase():"")}ke=nt}if(ke)$r(O,"complete"),$r(O,"success");else{O.m=6;try{var Cn=2<qs(O)?O.g.statusText:""}catch{Cn=""}O.l=Cn+" ["+O.Z()+"]",Nu(O)}}finally{qo(O)}}}}function qo(O,me){if(O.g){ji(O);const ke=O.g,nt=O.v[0]?()=>{}:null;O.g=null,O.v=null,me||$r(O,"ready");try{ke.onreadystatechange=nt}catch{}}}function ji(O){O.I&&(y.clearTimeout(O.I),O.I=null)}n.isActive=function(){return!!this.g};function qs(O){return O.g?O.g.readyState:0}n.Z=function(){try{return 2<qs(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(O){if(this.g){var me=this.g.responseText;return O&&me.indexOf(O)==0&&(me=me.substring(O.length)),ui(me)}};function Lo(O){try{if(!O.g)return null;if("response"in O.g)return O.g.response;switch(O.H){case"":case"text":return O.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in O.g)return O.g.mozResponseArrayBuffer}return null}catch{return null}}function _a(O){const me={};O=(O.g&&2<=qs(O)&&O.g.getAllResponseHeaders()||"").split(`\r
`);for(let nt=0;nt<O.length;nt++){if(oe(O[nt]))continue;var ke=$(O[nt]);const hn=ke[0];if(ke=ke[1],typeof ke!="string")continue;ke=ke.trim();const Cn=me[hn]||[];me[hn]=Cn,Cn.push(ke)}_e(me,function(nt){return nt.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function zo(O,me,ke){return ke&&ke.internalChannelParams&&ke.internalChannelParams[O]||me}function ml(O){this.Aa=0,this.i=[],this.j=new Gr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=zo("failFast",!1,O),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=zo("baseRetryDelayMs",5e3,O),this.cb=zo("retryDelaySeedMs",1e4,O),this.Wa=zo("forwardChannelMaxRetries",2,O),this.wa=zo("forwardChannelRequestTimeoutMs",2e4,O),this.pa=O&&O.xmlHttpFactory||void 0,this.Xa=O&&O.Tb||void 0,this.Ca=O&&O.useFetchStreams||!1,this.L=void 0,this.J=O&&O.supportsCrossDomainXhr||!1,this.K="",this.h=new Wo(O&&O.concurrentRequestLimit),this.Da=new na,this.P=O&&O.fastHandshake||!1,this.O=O&&O.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=O&&O.Rb||!1,O&&O.xa&&this.j.xa(),O&&O.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&O&&O.detectBufferingProxy||!1,this.ja=void 0,O&&O.longPollingTimeout&&0<O.longPollingTimeout&&(this.ja=O.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=ml.prototype,n.la=8,n.G=1,n.connect=function(O,me,ke,nt){Pn(0),this.W=O,this.H=me||{},ke&&nt!==void 0&&(this.H.OSID=ke,this.H.OAID=nt),this.F=this.X,this.I=Ys(this,null,this.W),ee(this)};function Po(O){if(va(O),O.G==3){var me=O.U++,ke=Ur(O.I);if(Hi(ke,"SID",O.K),Hi(ke,"RID",me),Hi(ke,"TYPE","terminate"),kt(O,ke),me=new is(O,O.j,me),me.L=2,me.v=Tl(Ur(ke)),ke=!1,y.navigator&&y.navigator.sendBeacon)try{ke=y.navigator.sendBeacon(me.v.toString(),"")}catch{}!ke&&y.Image&&(new Image().src=me.v,ke=!0),ke||(me.g=Zs(me.j,null),me.g.ea(me.v)),me.F=Date.now(),Ss(me)}fo(O)}function fa(O){O.g&&(Xr(O),O.g.cancel(),O.g=null)}function va(O){fa(O),O.u&&(y.clearTimeout(O.u),O.u=null),oi(O),O.h.cancel(),O.s&&(typeof O.s=="number"&&y.clearTimeout(O.s),O.s=null)}function ee(O){if(!ta(O.h)&&!O.s){O.s=!0;var me=O.Ga;Ue||Ke(),Le||(Ue(),Le=!0),He.add(me,O),O.B=0}}function je(O,me){return En(O.h)>=O.h.j-(O.s?1:0)?!1:O.s?(O.i=me.D.concat(O.i),!0):O.G==1||O.G==2||O.B>=(O.Va?0:O.Wa)?!1:(O.s=Fn(U(O.Ga,O,me),Ps(O,O.B)),O.B++,!0)}n.Ga=function(O){if(this.s)if(this.s=null,this.G==1){if(!O){this.U=Math.floor(1e5*Math.random()),O=this.U++;const hn=new is(this,this.j,O);let Cn=this.o;if(this.S&&(Cn?(Cn=G(Cn),Y(Cn,this.S)):Cn=this.S),this.m!==null||this.O||(hn.H=Cn,Cn=null),this.P)e:{for(var me=0,ke=0;ke<this.i.length;ke++){t:{var nt=this.i[ke];if("__data__"in nt.map&&(nt=nt.map.__data__,typeof nt=="string")){nt=nt.length;break t}nt=void 0}if(nt===void 0)break;if(me+=nt,4096<me){me=ke;break e}if(me===4096||ke===this.i.length-1){me=ke+1;break e}}me=1e3}else me=1e3;me=sn(this,hn,me),ke=Ur(this.I),Hi(ke,"RID",O),Hi(ke,"CVER",22),this.D&&Hi(ke,"X-HTTP-Session-Id",this.D),kt(this,ke),Cn&&(this.O?me="headers="+encodeURIComponent(String(os(Cn)))+"&"+me:this.m&&gu(ke,this.m,Cn)),Io(this.h,hn),this.Ua&&Hi(ke,"TYPE","init"),this.P?(Hi(ke,"$req",me),Hi(ke,"SID","null"),hn.T=!0,Pa(hn,ke,null)):Pa(hn,ke,me),this.G=2}}else this.G==3&&(O?At(this,O):this.i.length==0||ta(this.h)||At(this))};function At(O,me){var ke;me?ke=me.l:ke=O.U++;const nt=Ur(O.I);Hi(nt,"SID",O.K),Hi(nt,"RID",ke),Hi(nt,"AID",O.T),kt(O,nt),O.m&&O.o&&gu(nt,O.m,O.o),ke=new is(O,O.j,ke,O.B+1),O.m===null&&(ke.H=O.o),me&&(O.i=me.D.concat(O.i)),me=sn(O,ke,1e3),ke.I=Math.round(.5*O.wa)+Math.round(.5*O.wa*Math.random()),Io(O.h,ke),Pa(ke,nt,me)}function kt(O,me){O.H&&Be(O.H,function(ke,nt){Hi(me,nt,ke)}),O.l&&Ga({},function(ke,nt){Hi(me,nt,ke)})}function sn(O,me,ke){ke=Math.min(O.i.length,ke);var nt=O.l?U(O.l.Na,O.l,O):null;e:{var hn=O.i;let Cn=-1;for(;;){const Sr=["count="+ke];Cn==-1?0<ke?(Cn=hn[0].g,Sr.push("ofs="+Cn)):Cn=0:Sr.push("ofs="+Cn);let Rs=!0;for(let so=0;so<ke;so++){let hs=hn[so].g;const es=hn[so].map;if(hs-=Cn,0>hs)Cn=Math.max(0,hn[so].g-100),Rs=!1;else try{Es(es,Sr,"req"+hs+"_")}catch{nt&&nt(es)}}if(Rs){nt=Sr.join("&");break e}}}return O=O.i.splice(0,ke),me.D=O,nt}function fn(O){if(!O.g&&!O.u){O.Y=1;var me=O.Fa;Ue||Ke(),Le||(Ue(),Le=!0),He.add(me,O),O.v=0}}function Qn(O){return O.g||O.u||3<=O.v?!1:(O.Y++,O.u=Fn(U(O.Fa,O),Ps(O,O.v)),O.v++,!0)}n.Fa=function(){if(this.u=null,Qr(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var O=2*this.R;this.j.info("BP detection timer enabled: "+O),this.A=Fn(U(this.ab,this),O)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Pn(10),fa(this),Qr(this))};function Xr(O){O.A!=null&&(y.clearTimeout(O.A),O.A=null)}function Qr(O){O.g=new is(O,O.j,"rpc",O.Y),O.m===null&&(O.g.H=O.o),O.g.O=0;var me=Ur(O.qa);Hi(me,"RID","rpc"),Hi(me,"SID",O.K),Hi(me,"AID",O.T),Hi(me,"CI",O.F?"0":"1"),!O.F&&O.ja&&Hi(me,"TO",O.ja),Hi(me,"TYPE","xmlhttp"),kt(O,me),O.m&&O.o&&gu(me,O.m,O.o),O.L&&(O.g.I=O.L);var ke=O.g;O=O.ia,ke.L=1,ke.v=Tl(Ur(me)),ke.m=null,ke.P=!0,di(ke,O)}n.Za=function(){this.C!=null&&(this.C=null,fa(this),Qn(this),Pn(19))};function oi(O){O.C!=null&&(y.clearTimeout(O.C),O.C=null)}function Ui(O,me){var ke=null;if(O.g==me){oi(O),Xr(O),O.g=null;var nt=2}else if(co(O.h,me))ke=me.D,Ni(O.h,me),nt=1;else return;if(O.G!=0){if(me.o)if(nt==1){ke=me.m?me.m.length:0,me=Date.now()-me.F;var hn=O.B;nt=Gt(),$r(nt,new Jn(nt,ke)),ee(O)}else fn(O);else if(hn=me.s,hn==3||hn==0&&0<me.X||!(nt==1&&je(O,me)||nt==2&&Qn(O)))switch(ke&&0<ke.length&&(me=O.h,me.i=me.i.concat(ke)),hn){case 1:Bs(O,5);break;case 4:Bs(O,10);break;case 3:Bs(O,6);break;default:Bs(O,2)}}}function Ps(O,me){let ke=O.Ta+Math.floor(Math.random()*O.cb);return O.isActive()||(ke*=2),ke*me}function Bs(O,me){if(O.j.info("Error code "+me),me==2){var ke=U(O.fb,O),nt=O.Xa;const hn=!nt;nt=new Wr(nt||"//www.google.com/images/cleardot.gif"),y.location&&y.location.protocol=="http"||ca(nt,"https"),Tl(nt),hn?Nc(nt.toString(),ke):Pu(nt.toString(),ke)}else Pn(2);O.G=0,O.l&&O.l.sa(me),fo(O),va(O)}n.fb=function(O){O?(this.j.info("Successfully pinged google.com"),Pn(2)):(this.j.info("Failed to ping google.com"),Pn(1))};function fo(O){if(O.G=0,O.ka=[],O.l){const me=ic(O.h);(me.length!=0||O.i.length!=0)&&(ye(O.ka,me),ye(O.ka,O.i),O.h.i.length=0,ae(O.i),O.i.length=0),O.l.ra()}}function Ys(O,me,ke){var nt=ke instanceof Wr?Ur(ke):new Wr(ke);if(nt.g!="")me&&(nt.g=me+"."+nt.g),$a(nt,nt.s);else{var hn=y.location;nt=hn.protocol,me=me?me+"."+hn.hostname:hn.hostname,hn=+hn.port;var Cn=new Wr(null);nt&&ca(Cn,nt),me&&(Cn.g=me),hn&&$a(Cn,hn),ke&&(Cn.l=ke),nt=Cn}return ke=O.D,me=O.ya,ke&&me&&Hi(nt,ke,me),Hi(nt,"VER",O.la),kt(O,nt),nt}function Zs(O,me,ke){if(me&&!O.J)throw Error("Can't create secondary domain capable XhrIo object.");return me=O.Ca&&!O.pa?new ro(new xs({eb:ke})):new ro(O.pa),me.Ha(O.J),me}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function go(){}n=go.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Ns(){}Ns.prototype.g=function(O,me){return new io(O,me)};function io(O,me){Zn.call(this),this.g=new ml(me),this.l=O,this.h=me&&me.messageUrlParams||null,O=me&&me.messageHeaders||null,me&&me.clientProtocolHeaderRequired&&(O?O["X-Client-Protocol"]="webchannel":O={"X-Client-Protocol":"webchannel"}),this.g.o=O,O=me&&me.initMessageHeaders||null,me&&me.messageContentType&&(O?O["X-WebChannel-Content-Type"]=me.messageContentType:O={"X-WebChannel-Content-Type":me.messageContentType}),me&&me.va&&(O?O["X-WebChannel-Client-Profile"]=me.va:O={"X-WebChannel-Client-Profile":me.va}),this.g.S=O,(O=me&&me.Sb)&&!oe(O)&&(this.g.m=O),this.v=me&&me.supportsCrossDomainXhr||!1,this.u=me&&me.sendRawJson||!1,(me=me&&me.httpSessionIdParam)&&!oe(me)&&(this.g.D=me,O=this.h,O!==null&&me in O&&(O=this.h,me in O&&delete O[me])),this.j=new gl(this)}Q(io,Zn),io.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},io.prototype.close=function(){Po(this.g)},io.prototype.o=function(O){var me=this.g;if(typeof O=="string"){var ke={};ke.__data__=O,O=ke}else this.u&&(ke={},ke.__data__=or(O),O=ke);me.i.push(new ea(me.Ya++,O)),me.G==3&&ee(me)},io.prototype.N=function(){this.g.l=null,delete this.j,Po(this.g),delete this.g,io.aa.N.call(this)};function zs(O){ze.call(this),O.__headers__&&(this.headers=O.__headers__,this.statusCode=O.__status__,delete O.__headers__,delete O.__status__);var me=O.__sm__;if(me){e:{for(const ke in me){O=ke;break e}O=void 0}(this.i=O)&&(O=this.i,me=me!==null&&O in me?me[O]:void 0),this.data=me}else this.data=O}Q(zs,ze);function Fl(){ft.call(this),this.status=1}Q(Fl,ft);function gl(O){this.g=O}Q(gl,go),gl.prototype.ua=function(){$r(this.g,"a")},gl.prototype.ta=function(O){$r(this.g,new zs(O))},gl.prototype.sa=function(O){$r(this.g,new Fl)},gl.prototype.ra=function(){$r(this.g,"b")},Ns.prototype.createWebChannel=Ns.prototype.g,io.prototype.send=io.prototype.o,io.prototype.open=io.prototype.m,io.prototype.close=io.prototype.close,dk=function(){return new Ns},fk=function(){return Gt()},hk=wt,p5={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Os.NO_ERROR=0,Os.TIMEOUT=8,Os.HTTP_ERROR=6,dv=Os,cs.COMPLETE="complete",ck=cs,vt.EventType=Ne,Ne.OPEN="a",Ne.CLOSE="b",Ne.ERROR="c",Ne.MESSAGE="d",Zn.prototype.listen=Zn.prototype.K,$0=vt,ro.prototype.listenOnce=ro.prototype.L,ro.prototype.getLastError=ro.prototype.Ka,ro.prototype.getLastErrorCode=ro.prototype.Ba,ro.prototype.getStatus=ro.prototype.Z,ro.prototype.getResponseJson=ro.prototype.Oa,ro.prototype.getResponseText=ro.prototype.oa,ro.prototype.send=ro.prototype.ea,ro.prototype.setWithCredentials=ro.prototype.Ha,uk=ro}).apply(typeof F1<"u"?F1:typeof self<"u"?self:typeof window<"u"?window:{});const VE="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ah.UNAUTHENTICATED=new Ah(null),Ah.GOOGLE_CREDENTIALS=new Ah("google-credentials-uid"),Ah.FIRST_PARTY=new Ah("first-party-uid"),Ah.MOCK_USER=new Ah("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ky="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dg=new c3("@firebase/firestore");function B0(){return dg.logLevel}function Fi(n,...e){if(dg.logLevel<=Qo.DEBUG){const t=e.map(d3);dg.debug(`Firestore (${Ky}): ${n}`,...t)}}function Np(n,...e){if(dg.logLevel<=Qo.ERROR){const t=e.map(d3);dg.error(`Firestore (${Ky}): ${n}`,...t)}}function Py(n,...e){if(dg.logLevel<=Qo.WARN){const t=e.map(d3);dg.warn(`Firestore (${Ky}): ${n}`,...t)}}function d3(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xs(n="Unexpected state"){const e=`FIRESTORE (${Ky}) INTERNAL ASSERTION FAILED: `+n;throw Np(e),new Error(e)}function pl(n,e){n||Xs()}function no(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ci extends Op{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ip{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class cO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ah.UNAUTHENTICATED)))}shutdown(){}}class hO{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class fO{constructor(e){this.t=e,this.currentUser=Ah.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){pl(this.o===void 0);let i=this.i;const a=s=>this.i!==i?(i=this.i,t(s)):Promise.resolve();let c=new Ip;this.o=()=>{this.i++,this.currentUser=this.u(),c.resolve(),c=new Ip,e.enqueueRetryable((()=>a(this.currentUser)))};const _=()=>{const s=c;e.enqueueRetryable((async()=>{await s.promise,await a(this.currentUser)}))},y=s=>{Fi("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=s,this.o&&(this.auth.addAuthTokenListener(this.o),_())};this.t.onInit((s=>y(s))),setTimeout((()=>{if(!this.auth){const s=this.t.getImmediate({optional:!0});s?y(s):(Fi("FirebaseAuthCredentialsProvider","Auth not yet detected"),c.resolve(),c=new Ip)}}),0),_()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((i=>this.i!==e?(Fi("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(pl(typeof i.accessToken=="string"),new pk(i.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return pl(e===null||typeof e=="string"),new Ah(e)}}class dO{constructor(e,t,i){this.l=e,this.h=t,this.P=i,this.type="FirstParty",this.user=Ah.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class pO{constructor(e,t,i){this.l=e,this.h=t,this.P=i}getToken(){return Promise.resolve(new dO(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(Ah.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class mO{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class gO{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){pl(this.o===void 0);const i=c=>{c.error!=null&&Fi("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${c.error.message}`);const _=c.token!==this.R;return this.R=c.token,Fi("FirebaseAppCheckTokenProvider",`Received ${_?"new":"existing"} token.`),_?t(c.token):Promise.resolve()};this.o=c=>{e.enqueueRetryable((()=>i(c)))};const a=c=>{Fi("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=c,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((c=>a(c))),setTimeout((()=>{if(!this.appCheck){const c=this.A.getImmediate({optional:!0});c?a(c):Fi("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(pl(typeof t.token=="string"),this.R=t.token,new mO(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yO(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let i="";for(;i.length<20;){const a=yO(40);for(let c=0;c<a.length;++c)i.length<20&&a[c]<t&&(i+=e.charAt(a[c]%e.length))}return i}}function ka(n,e){return n<e?-1:n>e?1:0}function Ny(n,e,t){return n.length===e.length&&n.every(((i,a)=>t(i,e[a])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ci(mr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ci(mr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Ci(mr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ci(mr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Pc.fromMillis(Date.now())}static fromDate(e){return Pc.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new Pc(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ka(this.nanoseconds,e.nanoseconds):ka(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to{constructor(e){this.timestamp=e}static fromTimestamp(e){return new to(e)}static min(){return new to(new Pc(0,0))}static max(){return new to(new Pc(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S_{constructor(e,t,i){t===void 0?t=0:t>e.length&&Xs(),i===void 0?i=e.length-t:i>e.length-t&&Xs(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return S_.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof S_?e.forEach((i=>{t.push(i)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let a=0;a<i;a++){const c=e.get(a),_=t.get(a);if(c<_)return-1;if(c>_)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class iu extends S_{construct(e,t,i){return new iu(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new Ci(mr.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter((a=>a.length>0)))}return new iu(t)}static emptyPath(){return new iu([])}}const _O=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class oh extends S_{construct(e,t,i){return new oh(e,t,i)}static isValidIdentifier(e){return _O.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),oh.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new oh(["__name__"])}static fromServerFormat(e){const t=[];let i="",a=0;const c=()=>{if(i.length===0)throw new Ci(mr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let _=!1;for(;a<e.length;){const y=e[a];if(y==="\\"){if(a+1===e.length)throw new Ci(mr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const s=e[a+1];if(s!=="\\"&&s!=="."&&s!=="`")throw new Ci(mr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=s,a+=2}else y==="`"?(_=!_,a++):y!=="."||_?(i+=y,a++):(c(),a++)}if(c(),_)throw new Ci(mr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new oh(t)}static emptyPath(){return new oh([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class us{constructor(e){this.path=e}static fromPath(e){return new us(iu.fromString(e))}static fromName(e){return new us(iu.fromString(e).popFirst(5))}static empty(){return new us(iu.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&iu.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return iu.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new us(new iu(e.slice()))}}function vO(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,a=to.fromTimestamp(i===1e9?new Pc(t+1,0):new Pc(t,i));return new _m(a,us.empty(),e)}function xO(n){return new _m(n.readTime,n.key,-1)}class _m{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new _m(to.min(),us.empty(),-1)}static max(){return new _m(to.max(),us.empty(),-1)}}function bO(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=us.comparator(n.documentKey,e.documentKey),t!==0?t:ka(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wO="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class SO{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function U_(n){if(n.code!==mr.FAILED_PRECONDITION||n.message!==wO)throw n;Fi("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Xs(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ar(((i,a)=>{this.nextCallback=c=>{this.wrapSuccess(e,c).next(i,a)},this.catchCallback=c=>{this.wrapFailure(t,c).next(i,a)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Ar?t:Ar.resolve(t)}catch(t){return Ar.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Ar.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Ar.reject(t)}static resolve(e){return new Ar(((t,i)=>{t(e)}))}static reject(e){return new Ar(((t,i)=>{i(e)}))}static waitFor(e){return new Ar(((t,i)=>{let a=0,c=0,_=!1;e.forEach((y=>{++a,y.next((()=>{++c,_&&c===a&&t()}),(s=>i(s)))})),_=!0,c===a&&t()}))}static or(e){let t=Ar.resolve(!1);for(const i of e)t=t.next((a=>a?Ar.resolve(a):i()));return t}static forEach(e,t){const i=[];return e.forEach(((a,c)=>{i.push(t.call(this,a,c))})),this.waitFor(i)}static mapArray(e,t){return new Ar(((i,a)=>{const c=e.length,_=new Array(c);let y=0;for(let s=0;s<c;s++){const T=s;t(e[T]).next((L=>{_[T]=L,++y,y===c&&i(_)}),(L=>a(L)))}}))}static doWhile(e,t){return new Ar(((i,a)=>{const c=()=>{e()===!0?t().next((()=>{c()}),a):i()};c()}))}}function EO(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function V_(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p3{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ie(i),this.se=i=>t.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}p3.oe=-1;function Rx(n){return n==null}function Gv(n){return n===0&&1/n==-1/0}function TO(n){return typeof n=="number"&&Number.isInteger(n)&&!Gv(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qE(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Zy(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function gk(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lu{constructor(e,t){this.comparator=e,this.root=t||sh.EMPTY}insert(e,t){return new Lu(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,sh.BLACK,null,null))}remove(e){return new Lu(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sh.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const a=this.comparator(e,i.key);if(a===0)return t+i.left.size;a<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,i)=>(e(t,i),!1)))}toString(){const e=[];return this.inorderTraversal(((t,i)=>(e.push(`${t}:${i}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new B1(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new B1(this.root,e,this.comparator,!1)}getReverseIterator(){return new B1(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new B1(this.root,e,this.comparator,!0)}}class B1{constructor(e,t,i,a){this.isReverse=a,this.nodeStack=[];let c=1;for(;!e.isEmpty();)if(c=t?i(e.key,t):1,t&&a&&(c*=-1),c<0)e=this.isReverse?e.left:e.right;else{if(c===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class sh{constructor(e,t,i,a,c){this.key=e,this.value=t,this.color=i??sh.RED,this.left=a??sh.EMPTY,this.right=c??sh.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,a,c){return new sh(e??this.key,t??this.value,i??this.color,a??this.left,c??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let a=this;const c=i(e,a.key);return a=c<0?a.copy(null,null,null,a.left.insert(e,t,i),null):c===0?a.copy(null,t,null,null,null):a.copy(null,null,null,null,a.right.insert(e,t,i)),a.fixUp()}removeMin(){if(this.left.isEmpty())return sh.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,a=this;if(t(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),t(e,a.key)===0){if(a.right.isEmpty())return sh.EMPTY;i=a.right.min(),a=a.copy(i.key,i.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,sh.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,sh.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Xs();const e=this.left.check();if(e!==this.right.check())throw Xs();return e+(this.isRed()?0:1)}}sh.EMPTY=null,sh.RED=!0,sh.BLACK=!1;sh.EMPTY=new class{constructor(){this.size=0}get key(){throw Xs()}get value(){throw Xs()}get color(){throw Xs()}get left(){throw Xs()}get right(){throw Xs()}copy(e,t,i,a,c){return this}insert(e,t,i){return new sh(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ah{constructor(e){this.comparator=e,this.data=new Lu(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,i)=>(e(t),!1)))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const a=i.getNext();if(this.comparator(a.key,e[1])>=0)return;t(a.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new GE(this.data.getIterator())}getIteratorFrom(e){return new GE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((i=>{t=t.add(i)})),t}isEqual(e){if(!(e instanceof ah)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const a=t.getNext().key,c=i.getNext().key;if(this.comparator(a,c)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ah(this.comparator);return t.data=e,t}}class GE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hd{constructor(e){this.fields=e,e.sort(oh.comparator)}static empty(){return new hd([])}unionWith(e){let t=new ah(oh.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new hd(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ny(this.fields,e.fields,((t,i)=>t.isEqual(i)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lh{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(a){try{return atob(a)}catch(c){throw typeof DOMException<"u"&&c instanceof DOMException?new yk("Invalid base64 string: "+c):c}})(e);return new lh(t)}static fromUint8Array(e){const t=(function(a){let c="";for(let _=0;_<a.length;++_)c+=String.fromCharCode(a[_]);return c})(e);return new lh(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const i=new Uint8Array(t.length);for(let a=0;a<t.length;a++)i[a]=t.charCodeAt(a);return i})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ka(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}lh.EMPTY_BYTE_STRING=new lh("");const AO=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vm(n){if(pl(!!n),typeof n=="string"){let e=0;const t=AO.exec(n);if(pl(!!t),t[1]){let a=t[1];a=(a+"000000000").substr(0,9),e=Number(a)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ec(n.seconds),nanos:ec(n.nanos)}}function ec(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function pg(n){return typeof n=="string"?lh.fromBase64String(n):lh.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m3(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function g3(n){const e=n.mapValue.fields.__previous_value__;return m3(e)?g3(e):e}function E_(n){const e=vm(n.mapValue.fields.__local_write_time__.timestampValue);return new Pc(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IO{constructor(e,t,i,a,c,_,y,s,T){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=a,this.ssl=c,this.forceLongPolling=_,this.autoDetectLongPolling=y,this.longPollingOptions=s,this.useFetchStreams=T}}class T_{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new T_("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof T_&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z1={mapValue:{}};function mg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?m3(n)?4:kO(n)?9007199254740991:CO(n)?10:11:Xs()}function Kd(n,e){if(n===e)return!0;const t=mg(n);if(t!==mg(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return E_(n).isEqual(E_(e));case 3:return(function(a,c){if(typeof a.timestampValue=="string"&&typeof c.timestampValue=="string"&&a.timestampValue.length===c.timestampValue.length)return a.timestampValue===c.timestampValue;const _=vm(a.timestampValue),y=vm(c.timestampValue);return _.seconds===y.seconds&&_.nanos===y.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(a,c){return pg(a.bytesValue).isEqual(pg(c.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(a,c){return ec(a.geoPointValue.latitude)===ec(c.geoPointValue.latitude)&&ec(a.geoPointValue.longitude)===ec(c.geoPointValue.longitude)})(n,e);case 2:return(function(a,c){if("integerValue"in a&&"integerValue"in c)return ec(a.integerValue)===ec(c.integerValue);if("doubleValue"in a&&"doubleValue"in c){const _=ec(a.doubleValue),y=ec(c.doubleValue);return _===y?Gv(_)===Gv(y):isNaN(_)&&isNaN(y)}return!1})(n,e);case 9:return Ny(n.arrayValue.values||[],e.arrayValue.values||[],Kd);case 10:case 11:return(function(a,c){const _=a.mapValue.fields||{},y=c.mapValue.fields||{};if(qE(_)!==qE(y))return!1;for(const s in _)if(_.hasOwnProperty(s)&&(y[s]===void 0||!Kd(_[s],y[s])))return!1;return!0})(n,e);default:return Xs()}}function A_(n,e){return(n.values||[]).find((t=>Kd(t,e)))!==void 0}function Ry(n,e){if(n===e)return 0;const t=mg(n),i=mg(e);if(t!==i)return ka(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return ka(n.booleanValue,e.booleanValue);case 2:return(function(c,_){const y=ec(c.integerValue||c.doubleValue),s=ec(_.integerValue||_.doubleValue);return y<s?-1:y>s?1:y===s?0:isNaN(y)?isNaN(s)?0:-1:1})(n,e);case 3:return $E(n.timestampValue,e.timestampValue);case 4:return $E(E_(n),E_(e));case 5:return ka(n.stringValue,e.stringValue);case 6:return(function(c,_){const y=pg(c),s=pg(_);return y.compareTo(s)})(n.bytesValue,e.bytesValue);case 7:return(function(c,_){const y=c.split("/"),s=_.split("/");for(let T=0;T<y.length&&T<s.length;T++){const L=ka(y[T],s[T]);if(L!==0)return L}return ka(y.length,s.length)})(n.referenceValue,e.referenceValue);case 8:return(function(c,_){const y=ka(ec(c.latitude),ec(_.latitude));return y!==0?y:ka(ec(c.longitude),ec(_.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return HE(n.arrayValue,e.arrayValue);case 10:return(function(c,_){var y,s,T,L;const R=c.fields||{},U=_.fields||{},M=(y=R.value)===null||y===void 0?void 0:y.arrayValue,Q=(s=U.value)===null||s===void 0?void 0:s.arrayValue,ae=ka(((T=M?.values)===null||T===void 0?void 0:T.length)||0,((L=Q?.values)===null||L===void 0?void 0:L.length)||0);return ae!==0?ae:HE(M,Q)})(n.mapValue,e.mapValue);case 11:return(function(c,_){if(c===z1.mapValue&&_===z1.mapValue)return 0;if(c===z1.mapValue)return 1;if(_===z1.mapValue)return-1;const y=c.fields||{},s=Object.keys(y),T=_.fields||{},L=Object.keys(T);s.sort(),L.sort();for(let R=0;R<s.length&&R<L.length;++R){const U=ka(s[R],L[R]);if(U!==0)return U;const M=Ry(y[s[R]],T[L[R]]);if(M!==0)return M}return ka(s.length,L.length)})(n.mapValue,e.mapValue);default:throw Xs()}}function $E(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ka(n,e);const t=vm(n),i=vm(e),a=ka(t.seconds,i.seconds);return a!==0?a:ka(t.nanos,i.nanos)}function HE(n,e){const t=n.values||[],i=e.values||[];for(let a=0;a<t.length&&a<i.length;++a){const c=Ry(t[a],i[a]);if(c)return c}return ka(t.length,i.length)}function My(n){return m5(n)}function m5(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const i=vm(t);return`time(${i.seconds},${i.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return pg(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return us.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let i="[",a=!0;for(const c of t.values||[])a?a=!1:i+=",",i+=m5(c);return i+"]"})(n.arrayValue):"mapValue"in n?(function(t){const i=Object.keys(t.fields||{}).sort();let a="{",c=!0;for(const _ of i)c?c=!1:a+=",",a+=`${_}:${m5(t.fields[_])}`;return a+"}"})(n.mapValue):Xs()}function WE(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function g5(n){return!!n&&"integerValue"in n}function y3(n){return!!n&&"arrayValue"in n}function XE(n){return!!n&&"nullValue"in n}function YE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function pv(n){return!!n&&"mapValue"in n}function CO(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function o_(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Zy(n.mapValue.fields,((t,i)=>e.mapValue.fields[t]=o_(i))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=o_(n.arrayValue.values[t]);return e}return Object.assign({},n)}function kO(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vf{constructor(e){this.value=e}static empty(){return new Vf({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!pv(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=o_(t)}setAll(e){let t=oh.emptyPath(),i={},a=[];e.forEach(((_,y)=>{if(!t.isImmediateParentOf(y)){const s=this.getFieldsMap(t);this.applyChanges(s,i,a),i={},a=[],t=y.popLast()}_?i[y.lastSegment()]=o_(_):a.push(y.lastSegment())}));const c=this.getFieldsMap(t);this.applyChanges(c,i,a)}delete(e){const t=this.field(e.popLast());pv(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Kd(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let a=t.mapValue.fields[e.get(i)];pv(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=a),t=a}return t.mapValue.fields}applyChanges(e,t,i){Zy(t,((a,c)=>e[a]=c));for(const a of i)delete e[a]}clone(){return new Vf(o_(this.value))}}function _k(n){const e=[];return Zy(n.fields,((t,i)=>{const a=new oh([t]);if(pv(i)){const c=_k(i.mapValue).fields;if(c.length===0)e.push(a);else for(const _ of c)e.push(a.child(_))}else e.push(a)})),new hd(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ih{constructor(e,t,i,a,c,_,y){this.key=e,this.documentType=t,this.version=i,this.readTime=a,this.createTime=c,this.data=_,this.documentState=y}static newInvalidDocument(e){return new Ih(e,0,to.min(),to.min(),to.min(),Vf.empty(),0)}static newFoundDocument(e,t,i,a){return new Ih(e,1,t,to.min(),i,a,0)}static newNoDocument(e,t){return new Ih(e,2,t,to.min(),to.min(),Vf.empty(),0)}static newUnknownDocument(e,t){return new Ih(e,3,t,to.min(),to.min(),Vf.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(to.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Vf.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Vf.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=to.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ih&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ih(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $v{constructor(e,t){this.position=e,this.inclusive=t}}function KE(n,e,t){let i=0;for(let a=0;a<n.position.length;a++){const c=e[a],_=n.position[a];if(c.field.isKeyField()?i=us.comparator(us.fromName(_.referenceValue),t.key):i=Ry(_,t.data.field(c.field)),c.dir==="desc"&&(i*=-1),i!==0)break}return i}function ZE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Kd(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv{constructor(e,t="asc"){this.field=e,this.dir=t}}function LO(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk{}class mc extends vk{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new NO(e,t,i):t==="array-contains"?new DO(e,i):t==="in"?new OO(e,i):t==="not-in"?new FO(e,i):t==="array-contains-any"?new BO(e,i):new mc(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new RO(e,i):new MO(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ry(t,this.value)):t!==null&&mg(this.value)===mg(t)&&this.matchesComparison(Ry(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Xs()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class md extends vk{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new md(e,t)}matches(e){return xk(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function xk(n){return n.op==="and"}function bk(n){return PO(n)&&xk(n)}function PO(n){for(const e of n.filters)if(e instanceof md)return!1;return!0}function y5(n){if(n instanceof mc)return n.field.canonicalString()+n.op.toString()+My(n.value);if(bk(n))return n.filters.map((e=>y5(e))).join(",");{const e=n.filters.map((t=>y5(t))).join(",");return`${n.op}(${e})`}}function wk(n,e){return n instanceof mc?(function(i,a){return a instanceof mc&&i.op===a.op&&i.field.isEqual(a.field)&&Kd(i.value,a.value)})(n,e):n instanceof md?(function(i,a){return a instanceof md&&i.op===a.op&&i.filters.length===a.filters.length?i.filters.reduce(((c,_,y)=>c&&wk(_,a.filters[y])),!0):!1})(n,e):void Xs()}function Sk(n){return n instanceof mc?(function(t){return`${t.field.canonicalString()} ${t.op} ${My(t.value)}`})(n):n instanceof md?(function(t){return t.op.toString()+" {"+t.getFilters().map(Sk).join(" ,")+"}"})(n):"Filter"}class NO extends mc{constructor(e,t,i){super(e,t,i),this.key=us.fromName(i.referenceValue)}matches(e){const t=us.comparator(e.key,this.key);return this.matchesComparison(t)}}class RO extends mc{constructor(e,t){super(e,"in",t),this.keys=Ek("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class MO extends mc{constructor(e,t){super(e,"not-in",t),this.keys=Ek("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Ek(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map((i=>us.fromName(i.referenceValue)))}class DO extends mc{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return y3(t)&&A_(t.arrayValue,this.value)}}class OO extends mc{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&A_(this.value.arrayValue,t)}}class FO extends mc{constructor(e,t){super(e,"not-in",t)}matches(e){if(A_(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!A_(this.value.arrayValue,t)}}class BO extends mc{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!y3(t)||!t.arrayValue.values)&&t.arrayValue.values.some((i=>A_(this.value.arrayValue,i)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zO{constructor(e,t=null,i=[],a=[],c=null,_=null,y=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=a,this.limit=c,this.startAt=_,this.endAt=y,this.ue=null}}function JE(n,e=null,t=[],i=[],a=null,c=null,_=null){return new zO(n,e,t,i,a,c,_)}function _3(n){const e=no(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((i=>y5(i))).join(","),t+="|ob:",t+=e.orderBy.map((i=>(function(c){return c.field.canonicalString()+c.dir})(i))).join(","),Rx(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((i=>My(i))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((i=>My(i))).join(",")),e.ue=t}return e.ue}function v3(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!LO(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!wk(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!ZE(n.startAt,e.startAt)&&ZE(n.endAt,e.endAt)}function _5(n){return us.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q_{constructor(e,t=null,i=[],a=[],c=null,_="F",y=null,s=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=a,this.limit=c,this.limitType=_,this.startAt=y,this.endAt=s,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function jO(n,e,t,i,a,c,_,y){return new q_(n,e,t,i,a,c,_,y)}function Mx(n){return new q_(n)}function QE(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Tk(n){return n.collectionGroup!==null}function a_(n){const e=no(n);if(e.ce===null){e.ce=[];const t=new Set;for(const c of e.explicitOrderBy)e.ce.push(c),t.add(c.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(_){let y=new ah(oh.comparator);return _.filters.forEach((s=>{s.getFlattenedFilters().forEach((T=>{T.isInequality()&&(y=y.add(T.field))}))})),y})(e).forEach((c=>{t.has(c.canonicalString())||c.isKeyField()||e.ce.push(new Hv(c,i))})),t.has(oh.keyField().canonicalString())||e.ce.push(new Hv(oh.keyField(),i))}return e.ce}function Gd(n){const e=no(n);return e.le||(e.le=UO(e,a_(n))),e.le}function UO(n,e){if(n.limitType==="F")return JE(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((a=>{const c=a.dir==="desc"?"asc":"desc";return new Hv(a.field,c)}));const t=n.endAt?new $v(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new $v(n.startAt.position,n.startAt.inclusive):null;return JE(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function v5(n,e){const t=n.filters.concat([e]);return new q_(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function x5(n,e,t){return new q_(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Dx(n,e){return v3(Gd(n),Gd(e))&&n.limitType===e.limitType}function Ak(n){return`${_3(Gd(n))}|lt:${n.limitType}`}function hy(n){return`Query(target=${(function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map((a=>Sk(a))).join(", ")}]`),Rx(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map((a=>(function(_){return`${_.field.canonicalString()} (${_.dir})`})(a))).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map((a=>My(a))).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map((a=>My(a))).join(",")),`Target(${i})`})(Gd(n))}; limitType=${n.limitType})`}function Ox(n,e){return e.isFoundDocument()&&(function(i,a){const c=a.key.path;return i.collectionGroup!==null?a.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(c):us.isDocumentKey(i.path)?i.path.isEqual(c):i.path.isImmediateParentOf(c)})(n,e)&&(function(i,a){for(const c of a_(i))if(!c.field.isKeyField()&&a.data.field(c.field)===null)return!1;return!0})(n,e)&&(function(i,a){for(const c of i.filters)if(!c.matches(a))return!1;return!0})(n,e)&&(function(i,a){return!(i.startAt&&!(function(_,y,s){const T=KE(_,y,s);return _.inclusive?T<=0:T<0})(i.startAt,a_(i),a)||i.endAt&&!(function(_,y,s){const T=KE(_,y,s);return _.inclusive?T>=0:T>0})(i.endAt,a_(i),a))})(n,e)}function VO(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Ik(n){return(e,t)=>{let i=!1;for(const a of a_(n)){const c=qO(a,e,t);if(c!==0)return c;i=i||a.field.isKeyField()}return 0}}function qO(n,e,t){const i=n.field.isKeyField()?us.comparator(e.key,t.key):(function(c,_,y){const s=_.data.field(c),T=y.data.field(c);return s!==null&&T!==null?Ry(s,T):Xs()})(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return Xs()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jy{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[a,c]of i)if(this.equalsFn(a,e))return c}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),a=this.inner[i];if(a===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let c=0;c<a.length;c++)if(this.equalsFn(a[c][0],e))return void(a[c]=[e,t]);a.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let a=0;a<i.length;a++)if(this.equalsFn(i[a][0],e))return i.length===1?delete this.inner[t]:i.splice(a,1),this.innerSize--,!0;return!1}forEach(e){Zy(this.inner,((t,i)=>{for(const[a,c]of i)e(a,c)}))}isEmpty(){return gk(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GO=new Lu(us.comparator);function Rp(){return GO}const Ck=new Lu(us.comparator);function H0(...n){let e=Ck;for(const t of n)e=e.insert(t.key,t);return e}function kk(n){let e=Ck;return n.forEach(((t,i)=>e=e.insert(t,i.overlayedDocument))),e}function ng(){return l_()}function Lk(){return l_()}function l_(){return new Jy((n=>n.toString()),((n,e)=>n.isEqual(e)))}const $O=new Lu(us.comparator),HO=new ah(us.comparator);function Ho(...n){let e=HO;for(const t of n)e=e.add(t);return e}const WO=new ah(ka);function XO(){return WO}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x3(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Gv(e)?"-0":e}}function Pk(n){return{integerValue:""+n}}function YO(n,e){return TO(e)?Pk(e):x3(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fx{constructor(){this._=void 0}}function KO(n,e,t){return n instanceof I_?(function(a,c){const _={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return c&&m3(c)&&(c=g3(c)),c&&(_.fields.__previous_value__=c),{mapValue:_}})(t,e):n instanceof C_?Rk(n,e):n instanceof k_?Mk(n,e):(function(a,c){const _=Nk(a,c),y=eT(_)+eT(a.Pe);return g5(_)&&g5(a.Pe)?Pk(y):x3(a.serializer,y)})(n,e)}function ZO(n,e,t){return n instanceof C_?Rk(n,e):n instanceof k_?Mk(n,e):t}function Nk(n,e){return n instanceof Wv?(function(i){return g5(i)||(function(c){return!!c&&"doubleValue"in c})(i)})(e)?e:{integerValue:0}:null}class I_ extends Fx{}class C_ extends Fx{constructor(e){super(),this.elements=e}}function Rk(n,e){const t=Dk(e);for(const i of n.elements)t.some((a=>Kd(a,i)))||t.push(i);return{arrayValue:{values:t}}}class k_ extends Fx{constructor(e){super(),this.elements=e}}function Mk(n,e){let t=Dk(e);for(const i of n.elements)t=t.filter((a=>!Kd(a,i)));return{arrayValue:{values:t}}}class Wv extends Fx{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function eT(n){return ec(n.integerValue||n.doubleValue)}function Dk(n){return y3(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JO{constructor(e,t){this.field=e,this.transform=t}}function QO(n,e){return n.field.isEqual(e.field)&&(function(i,a){return i instanceof C_&&a instanceof C_||i instanceof k_&&a instanceof k_?Ny(i.elements,a.elements,Kd):i instanceof Wv&&a instanceof Wv?Kd(i.Pe,a.Pe):i instanceof I_&&a instanceof I_})(n.transform,e.transform)}class eF{constructor(e,t){this.version=e,this.transformResults=t}}class $d{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new $d}static exists(e){return new $d(void 0,e)}static updateTime(e){return new $d(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function mv(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Bx{}function Ok(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Bk(n.key,$d.none()):new G_(n.key,n.data,$d.none());{const t=n.data,i=Vf.empty();let a=new ah(oh.comparator);for(let c of e.fields)if(!a.has(c)){let _=t.field(c);_===null&&c.length>1&&(c=c.popLast(),_=t.field(c)),_===null?i.delete(c):i.set(c,_),a=a.add(c)}return new Eg(n.key,i,new hd(a.toArray()),$d.none())}}function tF(n,e,t){n instanceof G_?(function(a,c,_){const y=a.value.clone(),s=nT(a.fieldTransforms,c,_.transformResults);y.setAll(s),c.convertToFoundDocument(_.version,y).setHasCommittedMutations()})(n,e,t):n instanceof Eg?(function(a,c,_){if(!mv(a.precondition,c))return void c.convertToUnknownDocument(_.version);const y=nT(a.fieldTransforms,c,_.transformResults),s=c.data;s.setAll(Fk(a)),s.setAll(y),c.convertToFoundDocument(_.version,s).setHasCommittedMutations()})(n,e,t):(function(a,c,_){c.convertToNoDocument(_.version).setHasCommittedMutations()})(0,e,t)}function u_(n,e,t,i){return n instanceof G_?(function(c,_,y,s){if(!mv(c.precondition,_))return y;const T=c.value.clone(),L=rT(c.fieldTransforms,s,_);return T.setAll(L),_.convertToFoundDocument(_.version,T).setHasLocalMutations(),null})(n,e,t,i):n instanceof Eg?(function(c,_,y,s){if(!mv(c.precondition,_))return y;const T=rT(c.fieldTransforms,s,_),L=_.data;return L.setAll(Fk(c)),L.setAll(T),_.convertToFoundDocument(_.version,L).setHasLocalMutations(),y===null?null:y.unionWith(c.fieldMask.fields).unionWith(c.fieldTransforms.map((R=>R.field)))})(n,e,t,i):(function(c,_,y){return mv(c.precondition,_)?(_.convertToNoDocument(_.version).setHasLocalMutations(),null):y})(n,e,t)}function nF(n,e){let t=null;for(const i of n.fieldTransforms){const a=e.data.field(i.field),c=Nk(i.transform,a||null);c!=null&&(t===null&&(t=Vf.empty()),t.set(i.field,c))}return t||null}function tT(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(i,a){return i===void 0&&a===void 0||!(!i||!a)&&Ny(i,a,((c,_)=>QO(c,_)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class G_ extends Bx{constructor(e,t,i,a=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class Eg extends Bx{constructor(e,t,i,a,c=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=a,this.fieldTransforms=c,this.type=1}getFieldMask(){return this.fieldMask}}function Fk(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}})),e}function nT(n,e,t){const i=new Map;pl(n.length===t.length);for(let a=0;a<t.length;a++){const c=n[a],_=c.transform,y=e.data.field(c.field);i.set(c.field,ZO(_,y,t[a]))}return i}function rT(n,e,t){const i=new Map;for(const a of n){const c=a.transform,_=t.data.field(a.field);i.set(a.field,KO(c,_,e))}return i}class Bk extends Bx{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class rF extends Bx{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iF{constructor(e,t,i,a){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=a}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let a=0;a<this.mutations.length;a++){const c=this.mutations[a];c.key.isEqual(e.key)&&tF(c,e,i[a])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=u_(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=u_(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=Lk();return this.mutations.forEach((a=>{const c=e.get(a.key),_=c.overlayedDocument;let y=this.applyToLocalView(_,c.mutatedFields);y=t.has(a.key)?null:y;const s=Ok(_,y);s!==null&&i.set(a.key,s),_.isValidDocument()||_.convertToNoDocument(to.min())})),i}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Ho())}isEqual(e){return this.batchId===e.batchId&&Ny(this.mutations,e.mutations,((t,i)=>tT(t,i)))&&Ny(this.baseMutations,e.baseMutations,((t,i)=>tT(t,i)))}}class b3{constructor(e,t,i,a){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=a}static from(e,t,i){pl(e.mutations.length===i.length);let a=(function(){return $O})();const c=e.mutations;for(let _=0;_<c.length;_++)a=a.insert(c[_].key,i[_].version);return new b3(e,t,i,a)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sF{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oF{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pc,la;function aF(n){switch(n){default:return Xs();case mr.CANCELLED:case mr.UNKNOWN:case mr.DEADLINE_EXCEEDED:case mr.RESOURCE_EXHAUSTED:case mr.INTERNAL:case mr.UNAVAILABLE:case mr.UNAUTHENTICATED:return!1;case mr.INVALID_ARGUMENT:case mr.NOT_FOUND:case mr.ALREADY_EXISTS:case mr.PERMISSION_DENIED:case mr.FAILED_PRECONDITION:case mr.ABORTED:case mr.OUT_OF_RANGE:case mr.UNIMPLEMENTED:case mr.DATA_LOSS:return!0}}function zk(n){if(n===void 0)return Np("GRPC error has no .code"),mr.UNKNOWN;switch(n){case pc.OK:return mr.OK;case pc.CANCELLED:return mr.CANCELLED;case pc.UNKNOWN:return mr.UNKNOWN;case pc.DEADLINE_EXCEEDED:return mr.DEADLINE_EXCEEDED;case pc.RESOURCE_EXHAUSTED:return mr.RESOURCE_EXHAUSTED;case pc.INTERNAL:return mr.INTERNAL;case pc.UNAVAILABLE:return mr.UNAVAILABLE;case pc.UNAUTHENTICATED:return mr.UNAUTHENTICATED;case pc.INVALID_ARGUMENT:return mr.INVALID_ARGUMENT;case pc.NOT_FOUND:return mr.NOT_FOUND;case pc.ALREADY_EXISTS:return mr.ALREADY_EXISTS;case pc.PERMISSION_DENIED:return mr.PERMISSION_DENIED;case pc.FAILED_PRECONDITION:return mr.FAILED_PRECONDITION;case pc.ABORTED:return mr.ABORTED;case pc.OUT_OF_RANGE:return mr.OUT_OF_RANGE;case pc.UNIMPLEMENTED:return mr.UNIMPLEMENTED;case pc.DATA_LOSS:return mr.DATA_LOSS;default:return Xs()}}(la=pc||(pc={}))[la.OK=0]="OK",la[la.CANCELLED=1]="CANCELLED",la[la.UNKNOWN=2]="UNKNOWN",la[la.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",la[la.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",la[la.NOT_FOUND=5]="NOT_FOUND",la[la.ALREADY_EXISTS=6]="ALREADY_EXISTS",la[la.PERMISSION_DENIED=7]="PERMISSION_DENIED",la[la.UNAUTHENTICATED=16]="UNAUTHENTICATED",la[la.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",la[la.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",la[la.ABORTED=10]="ABORTED",la[la.OUT_OF_RANGE=11]="OUT_OF_RANGE",la[la.UNIMPLEMENTED=12]="UNIMPLEMENTED",la[la.INTERNAL=13]="INTERNAL",la[la.UNAVAILABLE=14]="UNAVAILABLE",la[la.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lF(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uF=new ag([4294967295,4294967295],0);function iT(n){const e=lF().encode(n),t=new lk;return t.update(e),new Uint8Array(t.digest())}function sT(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),a=e.getUint32(8,!0),c=e.getUint32(12,!0);return[new ag([t,i],0),new ag([a,c],0)]}class w3{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new W0(`Invalid padding: ${t}`);if(i<0)throw new W0(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new W0(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new W0(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=ag.fromNumber(this.Ie)}Ee(e,t,i){let a=e.add(t.multiply(ag.fromNumber(i)));return a.compare(uF)===1&&(a=new ag([a.getBits(0),a.getBits(1)],0)),a.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=iT(e),[i,a]=sT(t);for(let c=0;c<this.hashCount;c++){const _=this.Ee(i,a,c);if(!this.de(_))return!1}return!0}static create(e,t,i){const a=e%8==0?0:8-e%8,c=new Uint8Array(Math.ceil(e/8)),_=new w3(c,a,t);return i.forEach((y=>_.insert(y))),_}insert(e){if(this.Ie===0)return;const t=iT(e),[i,a]=sT(t);for(let c=0;c<this.hashCount;c++){const _=this.Ee(i,a,c);this.Ae(_)}}Ae(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class W0 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zx{constructor(e,t,i,a,c){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=a,this.resolvedLimboDocuments=c}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const a=new Map;return a.set(e,$_.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new zx(to.min(),a,new Lu(ka),Rp(),Ho())}}class $_{constructor(e,t,i,a,c){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=a,this.removedDocuments=c}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new $_(i,t,Ho(),Ho(),Ho())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gv{constructor(e,t,i,a){this.Re=e,this.removedTargetIds=t,this.key=i,this.Ve=a}}class jk{constructor(e,t){this.targetId=e,this.me=t}}class Uk{constructor(e,t,i=lh.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=a}}class oT{constructor(){this.fe=0,this.ge=lT(),this.pe=lh.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Ho(),t=Ho(),i=Ho();return this.ge.forEach(((a,c)=>{switch(c){case 0:e=e.add(a);break;case 2:t=t.add(a);break;case 1:i=i.add(a);break;default:Xs()}})),new $_(this.pe,this.ye,e,t,i)}Ce(){this.we=!1,this.ge=lT()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,pl(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class cF{constructor(e){this.Le=e,this.Be=new Map,this.ke=Rp(),this.qe=aT(),this.Qe=new Lu(ka)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,(t=>{const i=this.Ge(t);switch(e.state){case 0:this.ze(t)&&i.De(e.resumeToken);break;case 1:i.Oe(),i.Se||i.Ce(),i.De(e.resumeToken);break;case 2:i.Oe(),i.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(i.Ne(),i.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),i.De(e.resumeToken));break;default:Xs()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach(((i,a)=>{this.ze(a)&&t(a)}))}He(e){const t=e.targetId,i=e.me.count,a=this.Je(t);if(a){const c=a.target;if(_5(c))if(i===0){const _=new us(c.path);this.Ue(t,_,Ih.newNoDocument(_,to.min()))}else pl(i===1);else{const _=this.Ye(t);if(_!==i){const y=this.Ze(e),s=y?this.Xe(y,e,_):1;if(s!==0){this.je(t);const T=s===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,T)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:a=0},hashCount:c=0}=t;let _,y;try{_=pg(i).toUint8Array()}catch(s){if(s instanceof yk)return Py("Decoding the base64 bloom filter in existence filter failed ("+s.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw s}try{y=new w3(_,a,c)}catch(s){return Py(s instanceof W0?"BloomFilter error: ":"Applying bloom filter failed: ",s),null}return y.Ie===0?null:y}Xe(e,t,i){return t.me.count===i-this.nt(e,t.targetId)?0:2}nt(e,t){const i=this.Le.getRemoteKeysForTarget(t);let a=0;return i.forEach((c=>{const _=this.Le.tt(),y=`projects/${_.projectId}/databases/${_.database}/documents/${c.path.canonicalString()}`;e.mightContain(y)||(this.Ue(t,c,null),a++)})),a}rt(e){const t=new Map;this.Be.forEach(((c,_)=>{const y=this.Je(_);if(y){if(c.current&&_5(y.target)){const s=new us(y.target.path);this.ke.get(s)!==null||this.it(_,s)||this.Ue(_,s,Ih.newNoDocument(s,e))}c.be&&(t.set(_,c.ve()),c.Ce())}}));let i=Ho();this.qe.forEach(((c,_)=>{let y=!0;_.forEachWhile((s=>{const T=this.Je(s);return!T||T.purpose==="TargetPurposeLimboResolution"||(y=!1,!1)})),y&&(i=i.add(c))})),this.ke.forEach(((c,_)=>_.setReadTime(e)));const a=new zx(e,t,this.Qe,this.ke,i);return this.ke=Rp(),this.qe=aT(),this.Qe=new Lu(ka),a}$e(e,t){if(!this.ze(e))return;const i=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,i),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,i){if(!this.ze(e))return;const a=this.Ge(e);this.it(e,t)?a.Fe(t,1):a.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),i&&(this.ke=this.ke.insert(t,i))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new oT,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ah(ka),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||Fi("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new oT),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.Ue(e,t,null)}))}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function aT(){return new Lu(us.comparator)}function lT(){return new Lu(us.comparator)}const hF={asc:"ASCENDING",desc:"DESCENDING"},fF={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},dF={and:"AND",or:"OR"};class pF{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function b5(n,e){return n.useProto3Json||Rx(e)?e:{value:e}}function Xv(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Vk(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function mF(n,e){return Xv(n,e.toTimestamp())}function Hd(n){return pl(!!n),to.fromTimestamp((function(t){const i=vm(t);return new Pc(i.seconds,i.nanos)})(n))}function S3(n,e){return w5(n,e).canonicalString()}function w5(n,e){const t=(function(a){return new iu(["projects",a.projectId,"databases",a.database])})(n).child("documents");return e===void 0?t:t.child(e)}function qk(n){const e=iu.fromString(n);return pl(Xk(e)),e}function S5(n,e){return S3(n.databaseId,e.path)}function _w(n,e){const t=qk(e);if(t.get(1)!==n.databaseId.projectId)throw new Ci(mr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Ci(mr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new us($k(t))}function Gk(n,e){return S3(n.databaseId,e)}function gF(n){const e=qk(n);return e.length===4?iu.emptyPath():$k(e)}function E5(n){return new iu(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function $k(n){return pl(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function uT(n,e,t){return{name:S5(n,e),fields:t.value.mapValue.fields}}function yF(n,e){let t;if("targetChange"in e){e.targetChange;const i=(function(T){return T==="NO_CHANGE"?0:T==="ADD"?1:T==="REMOVE"?2:T==="CURRENT"?3:T==="RESET"?4:Xs()})(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],c=(function(T,L){return T.useProto3Json?(pl(L===void 0||typeof L=="string"),lh.fromBase64String(L||"")):(pl(L===void 0||L instanceof Buffer||L instanceof Uint8Array),lh.fromUint8Array(L||new Uint8Array))})(n,e.targetChange.resumeToken),_=e.targetChange.cause,y=_&&(function(T){const L=T.code===void 0?mr.UNKNOWN:zk(T.code);return new Ci(L,T.message||"")})(_);t=new Uk(i,a,c,y||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const a=_w(n,i.document.name),c=Hd(i.document.updateTime),_=i.document.createTime?Hd(i.document.createTime):to.min(),y=new Vf({mapValue:{fields:i.document.fields}}),s=Ih.newFoundDocument(a,c,_,y),T=i.targetIds||[],L=i.removedTargetIds||[];t=new gv(T,L,s.key,s)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const a=_w(n,i.document),c=i.readTime?Hd(i.readTime):to.min(),_=Ih.newNoDocument(a,c),y=i.removedTargetIds||[];t=new gv([],y,_.key,_)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const a=_w(n,i.document),c=i.removedTargetIds||[];t=new gv([],c,a,null)}else{if(!("filter"in e))return Xs();{e.filter;const i=e.filter;i.targetId;const{count:a=0,unchangedNames:c}=i,_=new oF(a,c),y=i.targetId;t=new jk(y,_)}}return t}function _F(n,e){let t;if(e instanceof G_)t={update:uT(n,e.key,e.value)};else if(e instanceof Bk)t={delete:S5(n,e.key)};else if(e instanceof Eg)t={update:uT(n,e.key,e.data),updateMask:IF(e.fieldMask)};else{if(!(e instanceof rF))return Xs();t={verify:S5(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((i=>(function(c,_){const y=_.transform;if(y instanceof I_)return{fieldPath:_.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(y instanceof C_)return{fieldPath:_.field.canonicalString(),appendMissingElements:{values:y.elements}};if(y instanceof k_)return{fieldPath:_.field.canonicalString(),removeAllFromArray:{values:y.elements}};if(y instanceof Wv)return{fieldPath:_.field.canonicalString(),increment:y.Pe};throw Xs()})(0,i)))),e.precondition.isNone||(t.currentDocument=(function(a,c){return c.updateTime!==void 0?{updateTime:mF(a,c.updateTime)}:c.exists!==void 0?{exists:c.exists}:Xs()})(n,e.precondition)),t}function vF(n,e){return n&&n.length>0?(pl(e!==void 0),n.map((t=>(function(a,c){let _=a.updateTime?Hd(a.updateTime):Hd(c);return _.isEqual(to.min())&&(_=Hd(c)),new eF(_,a.transformResults||[])})(t,e)))):[]}function xF(n,e){return{documents:[Gk(n,e.path)]}}function bF(n,e){const t={structuredQuery:{}},i=e.path;let a;e.collectionGroup!==null?(a=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=Gk(n,a);const c=(function(T){if(T.length!==0)return Wk(md.create(T,"and"))})(e.filters);c&&(t.structuredQuery.where=c);const _=(function(T){if(T.length!==0)return T.map((L=>(function(U){return{field:fy(U.field),direction:EF(U.dir)}})(L)))})(e.orderBy);_&&(t.structuredQuery.orderBy=_);const y=b5(n,e.limit);return y!==null&&(t.structuredQuery.limit=y),e.startAt&&(t.structuredQuery.startAt=(function(T){return{before:T.inclusive,values:T.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(T){return{before:!T.inclusive,values:T.position}})(e.endAt)),{_t:t,parent:a}}function wF(n){let e=gF(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let a=null;if(i>0){pl(i===1);const L=t.from[0];L.allDescendants?a=L.collectionId:e=e.child(L.collectionId)}let c=[];t.where&&(c=(function(R){const U=Hk(R);return U instanceof md&&bk(U)?U.getFilters():[U]})(t.where));let _=[];t.orderBy&&(_=(function(R){return R.map((U=>(function(Q){return new Hv(dy(Q.field),(function(ye){switch(ye){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(Q.direction))})(U)))})(t.orderBy));let y=null;t.limit&&(y=(function(R){let U;return U=typeof R=="object"?R.value:R,Rx(U)?null:U})(t.limit));let s=null;t.startAt&&(s=(function(R){const U=!!R.before,M=R.values||[];return new $v(M,U)})(t.startAt));let T=null;return t.endAt&&(T=(function(R){const U=!R.before,M=R.values||[];return new $v(M,U)})(t.endAt)),jO(e,a,_,c,y,"F",s,T)}function SF(n,e){const t=(function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Xs()}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Hk(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=dy(t.unaryFilter.field);return mc.create(i,"==",{doubleValue:NaN});case"IS_NULL":const a=dy(t.unaryFilter.field);return mc.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const c=dy(t.unaryFilter.field);return mc.create(c,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const _=dy(t.unaryFilter.field);return mc.create(_,"!=",{nullValue:"NULL_VALUE"});default:return Xs()}})(n):n.fieldFilter!==void 0?(function(t){return mc.create(dy(t.fieldFilter.field),(function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Xs()}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return md.create(t.compositeFilter.filters.map((i=>Hk(i))),(function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return Xs()}})(t.compositeFilter.op))})(n):Xs()}function EF(n){return hF[n]}function TF(n){return fF[n]}function AF(n){return dF[n]}function fy(n){return{fieldPath:n.canonicalString()}}function dy(n){return oh.fromServerFormat(n.fieldPath)}function Wk(n){return n instanceof mc?(function(t){if(t.op==="=="){if(YE(t.value))return{unaryFilter:{field:fy(t.field),op:"IS_NAN"}};if(XE(t.value))return{unaryFilter:{field:fy(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(YE(t.value))return{unaryFilter:{field:fy(t.field),op:"IS_NOT_NAN"}};if(XE(t.value))return{unaryFilter:{field:fy(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:fy(t.field),op:TF(t.op),value:t.value}}})(n):n instanceof md?(function(t){const i=t.getFilters().map((a=>Wk(a)));return i.length===1?i[0]:{compositeFilter:{op:AF(t.op),filters:i}}})(n):Xs()}function IF(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Xk(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lm{constructor(e,t,i,a,c=to.min(),_=to.min(),y=lh.EMPTY_BYTE_STRING,s=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=a,this.snapshotVersion=c,this.lastLimboFreeSnapshotVersion=_,this.resumeToken=y,this.expectedCount=s}withSequenceNumber(e){return new lm(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new lm(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new lm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new lm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CF{constructor(e){this.ct=e}}function kF(n){const e=wF({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?x5(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LF{constructor(){this.un=new PF}addToCollectionParentIndex(e,t){return this.un.add(t),Ar.resolve()}getCollectionParents(e,t){return Ar.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return Ar.resolve()}deleteFieldIndex(e,t){return Ar.resolve()}deleteAllFieldIndexes(e){return Ar.resolve()}createTargetIndexes(e,t){return Ar.resolve()}getDocumentsMatchingTarget(e,t){return Ar.resolve(null)}getIndexType(e,t){return Ar.resolve(0)}getFieldIndexes(e,t){return Ar.resolve([])}getNextCollectionGroupToUpdate(e){return Ar.resolve(null)}getMinOffset(e,t){return Ar.resolve(_m.min())}getMinOffsetFromCollectionGroup(e,t){return Ar.resolve(_m.min())}updateCollectionGroup(e,t,i){return Ar.resolve()}updateIndexEntries(e,t){return Ar.resolve()}}class PF{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),a=this.index[t]||new ah(iu.comparator),c=!a.has(i);return this.index[t]=a.add(i),c}has(e){const t=e.lastSegment(),i=e.popLast(),a=this.index[t];return a&&a.has(i)}getEntries(e){return(this.index[e]||new ah(iu.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dy{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Dy(0)}static kn(){return new Dy(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NF{constructor(){this.changes=new Jy((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ih.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?Ar.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RF{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MF{constructor(e,t,i,a){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=a}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next((a=>(i=a,this.remoteDocumentCache.getEntry(e,t)))).next((a=>(i!==null&&u_(i.mutation,a,hd.empty(),Pc.now()),a)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.getLocalViewOfDocuments(e,i,Ho()).next((()=>i))))}getLocalViewOfDocuments(e,t,i=Ho()){const a=ng();return this.populateOverlays(e,a,t).next((()=>this.computeViews(e,t,a,i).next((c=>{let _=H0();return c.forEach(((y,s)=>{_=_.insert(y,s.overlayedDocument)})),_}))))}getOverlayedDocuments(e,t){const i=ng();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,Ho())))}populateOverlays(e,t,i){const a=[];return i.forEach((c=>{t.has(c)||a.push(c)})),this.documentOverlayCache.getOverlays(e,a).next((c=>{c.forEach(((_,y)=>{t.set(_,y)}))}))}computeViews(e,t,i,a){let c=Rp();const _=l_(),y=(function(){return l_()})();return t.forEach(((s,T)=>{const L=i.get(T.key);a.has(T.key)&&(L===void 0||L.mutation instanceof Eg)?c=c.insert(T.key,T):L!==void 0?(_.set(T.key,L.mutation.getFieldMask()),u_(L.mutation,T,L.mutation.getFieldMask(),Pc.now())):_.set(T.key,hd.empty())})),this.recalculateAndSaveOverlays(e,c).next((s=>(s.forEach(((T,L)=>_.set(T,L))),t.forEach(((T,L)=>{var R;return y.set(T,new RF(L,(R=_.get(T))!==null&&R!==void 0?R:null))})),y)))}recalculateAndSaveOverlays(e,t){const i=l_();let a=new Lu(((_,y)=>_-y)),c=Ho();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((_=>{for(const y of _)y.keys().forEach((s=>{const T=t.get(s);if(T===null)return;let L=i.get(s)||hd.empty();L=y.applyToLocalView(T,L),i.set(s,L);const R=(a.get(y.batchId)||Ho()).add(s);a=a.insert(y.batchId,R)}))})).next((()=>{const _=[],y=a.getReverseIterator();for(;y.hasNext();){const s=y.getNext(),T=s.key,L=s.value,R=Lk();L.forEach((U=>{if(!c.has(U)){const M=Ok(t.get(U),i.get(U));M!==null&&R.set(U,M),c=c.add(U)}})),_.push(this.documentOverlayCache.saveOverlays(e,T,R))}return Ar.waitFor(_)})).next((()=>i))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.recalculateAndSaveOverlays(e,i)))}getDocumentsMatchingQuery(e,t,i,a){return(function(_){return us.isDocumentKey(_.path)&&_.collectionGroup===null&&_.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Tk(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,a):this.getDocumentsMatchingCollectionQuery(e,t,i,a)}getNextDocuments(e,t,i,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,a).next((c=>{const _=a-c.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,a-c.size):Ar.resolve(ng());let y=-1,s=c;return _.next((T=>Ar.forEach(T,((L,R)=>(y<R.largestBatchId&&(y=R.largestBatchId),c.get(L)?Ar.resolve():this.remoteDocumentCache.getEntry(e,L).next((U=>{s=s.insert(L,U)}))))).next((()=>this.populateOverlays(e,T,c))).next((()=>this.computeViews(e,s,T,Ho()))).next((L=>({batchId:y,changes:kk(L)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new us(t)).next((i=>{let a=H0();return i.isFoundDocument()&&(a=a.insert(i.key,i)),a}))}getDocumentsMatchingCollectionGroupQuery(e,t,i,a){const c=t.collectionGroup;let _=H0();return this.indexManager.getCollectionParents(e,c).next((y=>Ar.forEach(y,(s=>{const T=(function(R,U){return new q_(U,null,R.explicitOrderBy.slice(),R.filters.slice(),R.limit,R.limitType,R.startAt,R.endAt)})(t,s.child(c));return this.getDocumentsMatchingCollectionQuery(e,T,i,a).next((L=>{L.forEach(((R,U)=>{_=_.insert(R,U)}))}))})).next((()=>_))))}getDocumentsMatchingCollectionQuery(e,t,i,a){let c;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next((_=>(c=_,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,c,a)))).next((_=>{c.forEach(((s,T)=>{const L=T.getKey();_.get(L)===null&&(_=_.insert(L,Ih.newInvalidDocument(L)))}));let y=H0();return _.forEach(((s,T)=>{const L=c.get(s);L!==void 0&&u_(L.mutation,T,hd.empty(),Pc.now()),Ox(t,T)&&(y=y.insert(s,T))})),y}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DF{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return Ar.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,(function(a){return{id:a.id,version:a.version,createTime:Hd(a.createTime)}})(t)),Ar.resolve()}getNamedQuery(e,t){return Ar.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,(function(a){return{name:a.name,query:kF(a.bundledQuery),readTime:Hd(a.readTime)}})(t)),Ar.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OF{constructor(){this.overlays=new Lu(us.comparator),this.Ir=new Map}getOverlay(e,t){return Ar.resolve(this.overlays.get(t))}getOverlays(e,t){const i=ng();return Ar.forEach(t,(a=>this.getOverlay(e,a).next((c=>{c!==null&&i.set(a,c)})))).next((()=>i))}saveOverlays(e,t,i){return i.forEach(((a,c)=>{this.ht(e,t,c)})),Ar.resolve()}removeOverlaysForBatchId(e,t,i){const a=this.Ir.get(i);return a!==void 0&&(a.forEach((c=>this.overlays=this.overlays.remove(c))),this.Ir.delete(i)),Ar.resolve()}getOverlaysForCollection(e,t,i){const a=ng(),c=t.length+1,_=new us(t.child("")),y=this.overlays.getIteratorFrom(_);for(;y.hasNext();){const s=y.getNext().value,T=s.getKey();if(!t.isPrefixOf(T.path))break;T.path.length===c&&s.largestBatchId>i&&a.set(s.getKey(),s)}return Ar.resolve(a)}getOverlaysForCollectionGroup(e,t,i,a){let c=new Lu(((T,L)=>T-L));const _=this.overlays.getIterator();for(;_.hasNext();){const T=_.getNext().value;if(T.getKey().getCollectionGroup()===t&&T.largestBatchId>i){let L=c.get(T.largestBatchId);L===null&&(L=ng(),c=c.insert(T.largestBatchId,L)),L.set(T.getKey(),T)}}const y=ng(),s=c.getIterator();for(;s.hasNext()&&(s.getNext().value.forEach(((T,L)=>y.set(T,L))),!(y.size()>=a)););return Ar.resolve(y)}ht(e,t,i){const a=this.overlays.get(i.key);if(a!==null){const _=this.Ir.get(a.largestBatchId).delete(i.key);this.Ir.set(a.largestBatchId,_)}this.overlays=this.overlays.insert(i.key,new sF(t,i));let c=this.Ir.get(t);c===void 0&&(c=Ho(),this.Ir.set(t,c)),this.Ir.set(t,c.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FF{constructor(){this.sessionToken=lh.EMPTY_BYTE_STRING}getSessionToken(e){return Ar.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Ar.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E3{constructor(){this.Tr=new ah(qc.Er),this.dr=new ah(qc.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const i=new qc(e,t);this.Tr=this.Tr.add(i),this.dr=this.dr.add(i)}Rr(e,t){e.forEach((i=>this.addReference(i,t)))}removeReference(e,t){this.Vr(new qc(e,t))}mr(e,t){e.forEach((i=>this.removeReference(i,t)))}gr(e){const t=new us(new iu([])),i=new qc(t,e),a=new qc(t,e+1),c=[];return this.dr.forEachInRange([i,a],(_=>{this.Vr(_),c.push(_.key)})),c}pr(){this.Tr.forEach((e=>this.Vr(e)))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new us(new iu([])),i=new qc(t,e),a=new qc(t,e+1);let c=Ho();return this.dr.forEachInRange([i,a],(_=>{c=c.add(_.key)})),c}containsKey(e){const t=new qc(e,0),i=this.Tr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class qc{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return us.comparator(e.key,t.key)||ka(e.wr,t.wr)}static Ar(e,t){return ka(e.wr,t.wr)||us.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BF{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new ah(qc.Er)}checkEmpty(e){return Ar.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,a){const c=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const _=new iF(c,t,i,a);this.mutationQueue.push(_);for(const y of a)this.br=this.br.add(new qc(y.key,c)),this.indexManager.addToCollectionParentIndex(e,y.key.path.popLast());return Ar.resolve(_)}lookupMutationBatch(e,t){return Ar.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,a=this.vr(i),c=a<0?0:a;return Ar.resolve(this.mutationQueue.length>c?this.mutationQueue[c]:null)}getHighestUnacknowledgedBatchId(){return Ar.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return Ar.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new qc(t,0),a=new qc(t,Number.POSITIVE_INFINITY),c=[];return this.br.forEachInRange([i,a],(_=>{const y=this.Dr(_.wr);c.push(y)})),Ar.resolve(c)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new ah(ka);return t.forEach((a=>{const c=new qc(a,0),_=new qc(a,Number.POSITIVE_INFINITY);this.br.forEachInRange([c,_],(y=>{i=i.add(y.wr)}))})),Ar.resolve(this.Cr(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,a=i.length+1;let c=i;us.isDocumentKey(c)||(c=c.child(""));const _=new qc(new us(c),0);let y=new ah(ka);return this.br.forEachWhile((s=>{const T=s.key.path;return!!i.isPrefixOf(T)&&(T.length===a&&(y=y.add(s.wr)),!0)}),_),Ar.resolve(this.Cr(y))}Cr(e){const t=[];return e.forEach((i=>{const a=this.Dr(i);a!==null&&t.push(a)})),t}removeMutationBatch(e,t){pl(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let i=this.br;return Ar.forEach(t.mutations,(a=>{const c=new qc(a.key,t.batchId);return i=i.delete(c),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)})).next((()=>{this.br=i}))}On(e){}containsKey(e,t){const i=new qc(t,0),a=this.br.firstAfterOrEqual(i);return Ar.resolve(t.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ar.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zF{constructor(e){this.Mr=e,this.docs=(function(){return new Lu(us.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,a=this.docs.get(i),c=a?a.size:0,_=this.Mr(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:_}),this.size+=_-c,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return Ar.resolve(i?i.document.mutableCopy():Ih.newInvalidDocument(t))}getEntries(e,t){let i=Rp();return t.forEach((a=>{const c=this.docs.get(a);i=i.insert(a,c?c.document.mutableCopy():Ih.newInvalidDocument(a))})),Ar.resolve(i)}getDocumentsMatchingQuery(e,t,i,a){let c=Rp();const _=t.path,y=new us(_.child("")),s=this.docs.getIteratorFrom(y);for(;s.hasNext();){const{key:T,value:{document:L}}=s.getNext();if(!_.isPrefixOf(T.path))break;T.path.length>_.length+1||bO(xO(L),i)<=0||(a.has(L.key)||Ox(t,L))&&(c=c.insert(L.key,L.mutableCopy()))}return Ar.resolve(c)}getAllFromCollectionGroup(e,t,i,a){Xs()}Or(e,t){return Ar.forEach(this.docs,(i=>t(i)))}newChangeBuffer(e){return new jF(this)}getSize(e){return Ar.resolve(this.size)}}class jF extends NF{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach(((i,a)=>{a.isValidDocument()?t.push(this.cr.addEntry(e,a)):this.cr.removeEntry(i)})),Ar.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UF{constructor(e){this.persistence=e,this.Nr=new Jy((t=>_3(t)),v3),this.lastRemoteSnapshotVersion=to.min(),this.highestTargetId=0,this.Lr=0,this.Br=new E3,this.targetCount=0,this.kr=Dy.Bn()}forEachTarget(e,t){return this.Nr.forEach(((i,a)=>t(a))),Ar.resolve()}getLastRemoteSnapshotVersion(e){return Ar.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ar.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),Ar.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.Lr&&(this.Lr=t),Ar.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Dy(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,Ar.resolve()}updateTargetData(e,t){return this.Kn(t),Ar.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,Ar.resolve()}removeTargets(e,t,i){let a=0;const c=[];return this.Nr.forEach(((_,y)=>{y.sequenceNumber<=t&&i.get(y.targetId)===null&&(this.Nr.delete(_),c.push(this.removeMatchingKeysForTargetId(e,y.targetId)),a++)})),Ar.waitFor(c).next((()=>a))}getTargetCount(e){return Ar.resolve(this.targetCount)}getTargetData(e,t){const i=this.Nr.get(t)||null;return Ar.resolve(i)}addMatchingKeys(e,t,i){return this.Br.Rr(t,i),Ar.resolve()}removeMatchingKeys(e,t,i){this.Br.mr(t,i);const a=this.persistence.referenceDelegate,c=[];return a&&t.forEach((_=>{c.push(a.markPotentiallyOrphaned(e,_))})),Ar.waitFor(c)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),Ar.resolve()}getMatchingKeysForTargetId(e,t){const i=this.Br.yr(t);return Ar.resolve(i)}containsKey(e,t){return Ar.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VF{constructor(e,t){this.qr={},this.overlays={},this.Qr=new p3(0),this.Kr=!1,this.Kr=!0,this.$r=new FF,this.referenceDelegate=e(this),this.Ur=new UF(this),this.indexManager=new LF,this.remoteDocumentCache=(function(a){return new zF(a)})((i=>this.referenceDelegate.Wr(i))),this.serializer=new CF(t),this.Gr=new DF(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new OF,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.qr[e.toKey()];return i||(i=new BF(t,this.referenceDelegate),this.qr[e.toKey()]=i),i}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,i){Fi("MemoryPersistence","Starting transaction:",e);const a=new qF(this.Qr.next());return this.referenceDelegate.zr(),i(a).next((c=>this.referenceDelegate.jr(a).next((()=>c)))).toPromise().then((c=>(a.raiseOnCommittedEvent(),c)))}Hr(e,t){return Ar.or(Object.values(this.qr).map((i=>()=>i.containsKey(e,t))))}}class qF extends SO{constructor(e){super(),this.currentSequenceNumber=e}}class T3{constructor(e){this.persistence=e,this.Jr=new E3,this.Yr=null}static Zr(e){return new T3(e)}get Xr(){if(this.Yr)return this.Yr;throw Xs()}addReference(e,t,i){return this.Jr.addReference(i,t),this.Xr.delete(i.toString()),Ar.resolve()}removeReference(e,t,i){return this.Jr.removeReference(i,t),this.Xr.add(i.toString()),Ar.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),Ar.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach((a=>this.Xr.add(a.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next((a=>{a.forEach((c=>this.Xr.add(c.toString())))})).next((()=>i.removeTargetData(e,t)))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ar.forEach(this.Xr,(i=>{const a=us.fromPath(i);return this.ei(e,a).next((c=>{c||t.removeEntry(a,to.min())}))})).next((()=>(this.Yr=null,t.apply(e))))}updateLimboDocument(e,t){return this.ei(e,t).next((i=>{i?this.Xr.delete(t.toString()):this.Xr.add(t.toString())}))}Wr(e){return 0}ei(e,t){return Ar.or([()=>Ar.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A3{constructor(e,t,i,a){this.targetId=e,this.fromCache=t,this.$i=i,this.Ui=a}static Wi(e,t){let i=Ho(),a=Ho();for(const c of t.docChanges)switch(c.type){case 0:i=i.add(c.doc.key);break;case 1:a=a.add(c.doc.key)}return new A3(e,t.fromCache,i,a)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GF{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $F{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(function(){return $7()?8:EO(Ch())>0?6:4})()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,i,a){const c={result:null};return this.Yi(e,t).next((_=>{c.result=_})).next((()=>{if(!c.result)return this.Zi(e,t,a,i).next((_=>{c.result=_}))})).next((()=>{if(c.result)return;const _=new GF;return this.Xi(e,t,_).next((y=>{if(c.result=y,this.zi)return this.es(e,t,_,y.size)}))})).next((()=>c.result))}es(e,t,i,a){return i.documentReadCount<this.ji?(B0()<=Qo.DEBUG&&Fi("QueryEngine","SDK will not create cache indexes for query:",hy(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Ar.resolve()):(B0()<=Qo.DEBUG&&Fi("QueryEngine","Query:",hy(t),"scans",i.documentReadCount,"local documents and returns",a,"documents as results."),i.documentReadCount>this.Hi*a?(B0()<=Qo.DEBUG&&Fi("QueryEngine","The SDK decides to create cache indexes for query:",hy(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Gd(t))):Ar.resolve())}Yi(e,t){if(QE(t))return Ar.resolve(null);let i=Gd(t);return this.indexManager.getIndexType(e,i).next((a=>a===0?null:(t.limit!==null&&a===1&&(t=x5(t,null,"F"),i=Gd(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next((c=>{const _=Ho(...c);return this.Ji.getDocuments(e,_).next((y=>this.indexManager.getMinOffset(e,i).next((s=>{const T=this.ts(t,y);return this.ns(t,T,_,s.readTime)?this.Yi(e,x5(t,null,"F")):this.rs(e,T,t,s)}))))})))))}Zi(e,t,i,a){return QE(t)||a.isEqual(to.min())?Ar.resolve(null):this.Ji.getDocuments(e,i).next((c=>{const _=this.ts(t,c);return this.ns(t,_,i,a)?Ar.resolve(null):(B0()<=Qo.DEBUG&&Fi("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),hy(t)),this.rs(e,_,t,vO(a,-1)).next((y=>y)))}))}ts(e,t){let i=new ah(Ik(e));return t.forEach(((a,c)=>{Ox(e,c)&&(i=i.add(c))})),i}ns(e,t,i,a){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const c=e.limitType==="F"?t.last():t.first();return!!c&&(c.hasPendingWrites||c.version.compareTo(a)>0)}Xi(e,t,i){return B0()<=Qo.DEBUG&&Fi("QueryEngine","Using full collection scan to execute query:",hy(t)),this.Ji.getDocumentsMatchingQuery(e,t,_m.min(),i)}rs(e,t,i,a){return this.Ji.getDocumentsMatchingQuery(e,i,a).next((c=>(t.forEach((_=>{c=c.insert(_.key,_)})),c)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HF{constructor(e,t,i,a){this.persistence=e,this.ss=t,this.serializer=a,this.os=new Lu(ka),this._s=new Jy((c=>_3(c)),v3),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(i)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new MF(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.os)))}}function WF(n,e,t,i){return new HF(n,e,t,i)}async function Yk(n,e){const t=no(n);return await t.persistence.runTransaction("Handle user change","readonly",(i=>{let a;return t.mutationQueue.getAllMutationBatches(i).next((c=>(a=c,t.ls(e),t.mutationQueue.getAllMutationBatches(i)))).next((c=>{const _=[],y=[];let s=Ho();for(const T of a){_.push(T.batchId);for(const L of T.mutations)s=s.add(L.key)}for(const T of c){y.push(T.batchId);for(const L of T.mutations)s=s.add(L.key)}return t.localDocuments.getDocuments(i,s).next((T=>({hs:T,removedBatchIds:_,addedBatchIds:y})))}))}))}function XF(n,e){const t=no(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(i=>{const a=e.batch.keys(),c=t.cs.newChangeBuffer({trackRemovals:!0});return(function(y,s,T,L){const R=T.batch,U=R.keys();let M=Ar.resolve();return U.forEach((Q=>{M=M.next((()=>L.getEntry(s,Q))).next((ae=>{const ye=T.docVersions.get(Q);pl(ye!==null),ae.version.compareTo(ye)<0&&(R.applyToRemoteDocument(ae,T),ae.isValidDocument()&&(ae.setReadTime(T.commitVersion),L.addEntry(ae)))}))})),M.next((()=>y.mutationQueue.removeMutationBatch(s,R)))})(t,i,e,c).next((()=>c.apply(i))).next((()=>t.mutationQueue.performConsistencyCheck(i))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(i,a,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,(function(y){let s=Ho();for(let T=0;T<y.mutationResults.length;++T)y.mutationResults[T].transformResults.length>0&&(s=s.add(y.batch.mutations[T].key));return s})(e)))).next((()=>t.localDocuments.getDocuments(i,a)))}))}function Kk(n){const e=no(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Ur.getLastRemoteSnapshotVersion(t)))}function YF(n,e){const t=no(n),i=e.snapshotVersion;let a=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(c=>{const _=t.cs.newChangeBuffer({trackRemovals:!0});a=t.os;const y=[];e.targetChanges.forEach(((L,R)=>{const U=a.get(R);if(!U)return;y.push(t.Ur.removeMatchingKeys(c,L.removedDocuments,R).next((()=>t.Ur.addMatchingKeys(c,L.addedDocuments,R))));let M=U.withSequenceNumber(c.currentSequenceNumber);e.targetMismatches.get(R)!==null?M=M.withResumeToken(lh.EMPTY_BYTE_STRING,to.min()).withLastLimboFreeSnapshotVersion(to.min()):L.resumeToken.approximateByteSize()>0&&(M=M.withResumeToken(L.resumeToken,i)),a=a.insert(R,M),(function(ae,ye,ie){return ae.resumeToken.approximateByteSize()===0||ye.snapshotVersion.toMicroseconds()-ae.snapshotVersion.toMicroseconds()>=3e8?!0:ie.addedDocuments.size+ie.modifiedDocuments.size+ie.removedDocuments.size>0})(U,M,L)&&y.push(t.Ur.updateTargetData(c,M))}));let s=Rp(),T=Ho();if(e.documentUpdates.forEach((L=>{e.resolvedLimboDocuments.has(L)&&y.push(t.persistence.referenceDelegate.updateLimboDocument(c,L))})),y.push(KF(c,_,e.documentUpdates).next((L=>{s=L.Ps,T=L.Is}))),!i.isEqual(to.min())){const L=t.Ur.getLastRemoteSnapshotVersion(c).next((R=>t.Ur.setTargetsMetadata(c,c.currentSequenceNumber,i)));y.push(L)}return Ar.waitFor(y).next((()=>_.apply(c))).next((()=>t.localDocuments.getLocalViewOfDocuments(c,s,T))).next((()=>s))})).then((c=>(t.os=a,c)))}function KF(n,e,t){let i=Ho(),a=Ho();return t.forEach((c=>i=i.add(c))),e.getEntries(n,i).next((c=>{let _=Rp();return t.forEach(((y,s)=>{const T=c.get(y);s.isFoundDocument()!==T.isFoundDocument()&&(a=a.add(y)),s.isNoDocument()&&s.version.isEqual(to.min())?(e.removeEntry(y,s.readTime),_=_.insert(y,s)):!T.isValidDocument()||s.version.compareTo(T.version)>0||s.version.compareTo(T.version)===0&&T.hasPendingWrites?(e.addEntry(s),_=_.insert(y,s)):Fi("LocalStore","Ignoring outdated watch update for ",y,". Current version:",T.version," Watch version:",s.version)})),{Ps:_,Is:a}}))}function ZF(n,e){const t=no(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(i=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e))))}function JF(n,e){const t=no(n);return t.persistence.runTransaction("Allocate target","readwrite",(i=>{let a;return t.Ur.getTargetData(i,e).next((c=>c?(a=c,Ar.resolve(a)):t.Ur.allocateTargetId(i).next((_=>(a=new lm(e,_,"TargetPurposeListen",i.currentSequenceNumber),t.Ur.addTargetData(i,a).next((()=>a)))))))})).then((i=>{const a=t.os.get(i.targetId);return(a===null||i.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(t.os=t.os.insert(i.targetId,i),t._s.set(e,i.targetId)),i}))}async function T5(n,e,t){const i=no(n),a=i.os.get(e),c=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",c,(_=>i.persistence.referenceDelegate.removeTarget(_,a)))}catch(_){if(!V_(_))throw _;Fi("LocalStore",`Failed to update sequence numbers for target ${e}: ${_}`)}i.os=i.os.remove(e),i._s.delete(a.target)}function cT(n,e,t){const i=no(n);let a=to.min(),c=Ho();return i.persistence.runTransaction("Execute query","readwrite",(_=>(function(s,T,L){const R=no(s),U=R._s.get(L);return U!==void 0?Ar.resolve(R.os.get(U)):R.Ur.getTargetData(T,L)})(i,_,Gd(e)).next((y=>{if(y)return a=y.lastLimboFreeSnapshotVersion,i.Ur.getMatchingKeysForTargetId(_,y.targetId).next((s=>{c=s}))})).next((()=>i.ss.getDocumentsMatchingQuery(_,e,t?a:to.min(),t?c:Ho()))).next((y=>(QF(i,VO(e),y),{documents:y,Ts:c})))))}function QF(n,e,t){let i=n.us.get(e)||to.min();t.forEach(((a,c)=>{c.readTime.compareTo(i)>0&&(i=c.readTime)})),n.us.set(e,i)}class hT{constructor(){this.activeTargetIds=XO()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class eB{constructor(){this.so=new hT,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,i){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new hT,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tB{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fT{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Fi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){Fi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let j1=null;function vw(){return j1===null?j1=(function(){return 268435456+Math.round(2147483648*Math.random())})():j1++,"0x"+j1.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nB={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rB{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sh="WebChannelConnection";class iB extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const i=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),c=encodeURIComponent(this.databaseId.database);this.Do=i+"://"+t.host,this.vo=`projects/${a}/databases/${c}`,this.Co=this.databaseId.database==="(default)"?`project_id=${a}`:`project_id=${a}&database_id=${c}`}get Fo(){return!1}Mo(t,i,a,c,_){const y=vw(),s=this.xo(t,i.toUriEncodedString());Fi("RestConnection",`Sending RPC '${t}' ${y}:`,s,a);const T={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(T,c,_),this.No(t,s,T,a).then((L=>(Fi("RestConnection",`Received RPC '${t}' ${y}: `,L),L)),(L=>{throw Py("RestConnection",`RPC '${t}' ${y} failed with error: `,L,"url: ",s,"request:",a),L}))}Lo(t,i,a,c,_,y){return this.Mo(t,i,a,c,_)}Oo(t,i,a){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Ky})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach(((c,_)=>t[_]=c)),a&&a.headers.forEach(((c,_)=>t[_]=c))}xo(t,i){const a=nB[t];return`${this.Do}/v1/${i}:${a}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,i,a){const c=vw();return new Promise(((_,y)=>{const s=new uk;s.setWithCredentials(!0),s.listenOnce(ck.COMPLETE,(()=>{try{switch(s.getLastErrorCode()){case dv.NO_ERROR:const L=s.getResponseJson();Fi(Sh,`XHR for RPC '${e}' ${c} received:`,JSON.stringify(L)),_(L);break;case dv.TIMEOUT:Fi(Sh,`RPC '${e}' ${c} timed out`),y(new Ci(mr.DEADLINE_EXCEEDED,"Request time out"));break;case dv.HTTP_ERROR:const R=s.getStatus();if(Fi(Sh,`RPC '${e}' ${c} failed with status:`,R,"response text:",s.getResponseText()),R>0){let U=s.getResponseJson();Array.isArray(U)&&(U=U[0]);const M=U?.error;if(M&&M.status&&M.message){const Q=(function(ye){const ie=ye.toLowerCase().replace(/_/g,"-");return Object.values(mr).indexOf(ie)>=0?ie:mr.UNKNOWN})(M.status);y(new Ci(Q,M.message))}else y(new Ci(mr.UNKNOWN,"Server responded with status "+s.getStatus()))}else y(new Ci(mr.UNAVAILABLE,"Connection failed."));break;default:Xs()}}finally{Fi(Sh,`RPC '${e}' ${c} completed.`)}}));const T=JSON.stringify(a);Fi(Sh,`RPC '${e}' ${c} sending request:`,a),s.send(t,"POST",T,i,15)}))}Bo(e,t,i){const a=vw(),c=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],_=dk(),y=fk(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},T=this.longPollingOptions.timeoutSeconds;T!==void 0&&(s.longPollingTimeout=Math.round(1e3*T)),this.useFetchStreams&&(s.useFetchStreams=!0),this.Oo(s.initMessageHeaders,t,i),s.encodeInitMessageHeaders=!0;const L=c.join("");Fi(Sh,`Creating RPC '${e}' stream ${a}: ${L}`,s);const R=_.createWebChannel(L,s);let U=!1,M=!1;const Q=new rB({Io:ye=>{M?Fi(Sh,`Not sending because RPC '${e}' stream ${a} is closed:`,ye):(U||(Fi(Sh,`Opening RPC '${e}' stream ${a} transport.`),R.open(),U=!0),Fi(Sh,`RPC '${e}' stream ${a} sending:`,ye),R.send(ye))},To:()=>R.close()}),ae=(ye,ie,oe)=>{ye.listen(ie,(ve=>{try{oe(ve)}catch(de){setTimeout((()=>{throw de}),0)}}))};return ae(R,$0.EventType.OPEN,(()=>{M||(Fi(Sh,`RPC '${e}' stream ${a} transport opened.`),Q.yo())})),ae(R,$0.EventType.CLOSE,(()=>{M||(M=!0,Fi(Sh,`RPC '${e}' stream ${a} transport closed`),Q.So())})),ae(R,$0.EventType.ERROR,(ye=>{M||(M=!0,Py(Sh,`RPC '${e}' stream ${a} transport errored:`,ye),Q.So(new Ci(mr.UNAVAILABLE,"The operation could not be completed")))})),ae(R,$0.EventType.MESSAGE,(ye=>{var ie;if(!M){const oe=ye.data[0];pl(!!oe);const ve=oe,de=ve.error||((ie=ve[0])===null||ie===void 0?void 0:ie.error);if(de){Fi(Sh,`RPC '${e}' stream ${a} received error:`,de);const Pe=de.status;let Be=(function(B){const Y=pc[B];if(Y!==void 0)return zk(Y)})(Pe),_e=de.message;Be===void 0&&(Be=mr.INTERNAL,_e="Unknown error status: "+Pe+" with message "+de.message),M=!0,Q.So(new Ci(Be,_e)),R.close()}else Fi(Sh,`RPC '${e}' stream ${a} received:`,oe),Q.bo(oe)}})),ae(y,hk.STAT_EVENT,(ye=>{ye.stat===p5.PROXY?Fi(Sh,`RPC '${e}' stream ${a} detected buffering proxy`):ye.stat===p5.NOPROXY&&Fi(Sh,`RPC '${e}' stream ${a} detected no buffering proxy`)})),setTimeout((()=>{Q.wo()}),0),Q}}function xw(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jx(n){return new pF(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zk{constructor(e,t,i=1e3,a=1.5,c=6e4){this.ui=e,this.timerId=t,this.ko=i,this.qo=a,this.Qo=c,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),i=Math.max(0,Date.now()-this.Uo),a=Math.max(0,t-i);a>0&&Fi("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,a,(()=>(this.Uo=Date.now(),e()))),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jk{constructor(e,t,i,a,c,_,y,s){this.ui=e,this.Ho=i,this.Jo=a,this.connection=c,this.authCredentialsProvider=_,this.appCheckCredentialsProvider=y,this.listener=s,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Zk(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,(()=>this.__())))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===mr.RESOURCE_EXHAUSTED?(Np(t.toString()),Np("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===mr.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([i,a])=>{this.Yo===t&&this.P_(i,a)}),(i=>{e((()=>{const a=new Ci(mr.UNKNOWN,"Fetching auth token failed: "+i.message);return this.I_(a)}))}))}P_(e,t){const i=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo((()=>{i((()=>this.listener.Eo()))})),this.stream.Ro((()=>{i((()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,(()=>(this.r_()&&(this.state=3),Promise.resolve()))),this.listener.Ro())))})),this.stream.mo((a=>{i((()=>this.I_(a)))})),this.stream.onMessage((a=>{i((()=>++this.e_==1?this.E_(a):this.onNext(a)))}))}i_(){this.state=5,this.t_.Go((async()=>{this.state=0,this.start()}))}I_(e){return Fi("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget((()=>this.Yo===e?t():(Fi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class sB extends Jk{constructor(e,t,i,a,c,_){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,a,_),this.serializer=c}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=yF(this.serializer,e),i=(function(c){if(!("targetChange"in c))return to.min();const _=c.targetChange;return _.targetIds&&_.targetIds.length?to.min():_.readTime?Hd(_.readTime):to.min()})(e);return this.listener.d_(t,i)}A_(e){const t={};t.database=E5(this.serializer),t.addTarget=(function(c,_){let y;const s=_.target;if(y=_5(s)?{documents:xF(c,s)}:{query:bF(c,s)._t},y.targetId=_.targetId,_.resumeToken.approximateByteSize()>0){y.resumeToken=Vk(c,_.resumeToken);const T=b5(c,_.expectedCount);T!==null&&(y.expectedCount=T)}else if(_.snapshotVersion.compareTo(to.min())>0){y.readTime=Xv(c,_.snapshotVersion.toTimestamp());const T=b5(c,_.expectedCount);T!==null&&(y.expectedCount=T)}return y})(this.serializer,e);const i=SF(this.serializer,e);i&&(t.labels=i),this.a_(t)}R_(e){const t={};t.database=E5(this.serializer),t.removeTarget=e,this.a_(t)}}class oB extends Jk{constructor(e,t,i,a,c,_){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,a,_),this.serializer=c}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return pl(!!e.streamToken),this.lastStreamToken=e.streamToken,pl(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){pl(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=vF(e.writeResults,e.commitTime),i=Hd(e.commitTime);return this.listener.g_(i,t)}p_(){const e={};e.database=E5(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map((i=>_F(this.serializer,i)))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aB extends class{}{constructor(e,t,i,a){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=a,this.y_=!1}w_(){if(this.y_)throw new Ci(mr.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,i,a){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([c,_])=>this.connection.Mo(e,w5(t,i),a,c,_))).catch((c=>{throw c.name==="FirebaseError"?(c.code===mr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new Ci(mr.UNKNOWN,c.toString())}))}Lo(e,t,i,a,c){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([_,y])=>this.connection.Lo(e,w5(t,i),a,_,y,c))).catch((_=>{throw _.name==="FirebaseError"?(_.code===mr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),_):new Ci(mr.UNKNOWN,_.toString())}))}terminate(){this.y_=!0,this.connection.terminate()}}class lB{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve()))))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Np(t),this.D_=!1):Fi("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uB{constructor(e,t,i,a,c){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=c,this.k_._o((_=>{i.enqueueAndForget((async()=>{Tg(this)&&(Fi("RemoteStore","Restarting streams for network reachability change."),await(async function(s){const T=no(s);T.L_.add(4),await H_(T),T.q_.set("Unknown"),T.L_.delete(4),await Ux(T)})(this))}))})),this.q_=new lB(i,a)}}async function Ux(n){if(Tg(n))for(const e of n.B_)await e(!0)}async function H_(n){for(const e of n.B_)await e(!1)}function Qk(n,e){const t=no(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),L3(t)?k3(t):Qy(t).r_()&&C3(t,e))}function I3(n,e){const t=no(n),i=Qy(t);t.N_.delete(e),i.r_()&&e6(t,e),t.N_.size===0&&(i.r_()?i.o_():Tg(t)&&t.q_.set("Unknown"))}function C3(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(to.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Qy(n).A_(e)}function e6(n,e){n.Q_.xe(e),Qy(n).R_(e)}function k3(n){n.Q_=new cF({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Qy(n).start(),n.q_.v_()}function L3(n){return Tg(n)&&!Qy(n).n_()&&n.N_.size>0}function Tg(n){return no(n).L_.size===0}function t6(n){n.Q_=void 0}async function cB(n){n.q_.set("Online")}async function hB(n){n.N_.forEach(((e,t)=>{C3(n,e)}))}async function fB(n,e){t6(n),L3(n)?(n.q_.M_(e),k3(n)):n.q_.set("Unknown")}async function dB(n,e,t){if(n.q_.set("Online"),e instanceof Uk&&e.state===2&&e.cause)try{await(async function(a,c){const _=c.cause;for(const y of c.targetIds)a.N_.has(y)&&(await a.remoteSyncer.rejectListen(y,_),a.N_.delete(y),a.Q_.removeTarget(y))})(n,e)}catch(i){Fi("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),await Yv(n,i)}else if(e instanceof gv?n.Q_.Ke(e):e instanceof jk?n.Q_.He(e):n.Q_.We(e),!t.isEqual(to.min()))try{const i=await Kk(n.localStore);t.compareTo(i)>=0&&await(function(c,_){const y=c.Q_.rt(_);return y.targetChanges.forEach(((s,T)=>{if(s.resumeToken.approximateByteSize()>0){const L=c.N_.get(T);L&&c.N_.set(T,L.withResumeToken(s.resumeToken,_))}})),y.targetMismatches.forEach(((s,T)=>{const L=c.N_.get(s);if(!L)return;c.N_.set(s,L.withResumeToken(lh.EMPTY_BYTE_STRING,L.snapshotVersion)),e6(c,s);const R=new lm(L.target,s,T,L.sequenceNumber);C3(c,R)})),c.remoteSyncer.applyRemoteEvent(y)})(n,t)}catch(i){Fi("RemoteStore","Failed to raise snapshot:",i),await Yv(n,i)}}async function Yv(n,e,t){if(!V_(e))throw e;n.L_.add(1),await H_(n),n.q_.set("Offline"),t||(t=()=>Kk(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{Fi("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Ux(n)}))}function n6(n,e){return e().catch((t=>Yv(n,t,e)))}async function Vx(n){const e=no(n),t=xm(e);let i=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;pB(e);)try{const a=await ZF(e.localStore,i);if(a===null){e.O_.length===0&&t.o_();break}i=a.batchId,mB(e,a)}catch(a){await Yv(e,a)}r6(e)&&i6(e)}function pB(n){return Tg(n)&&n.O_.length<10}function mB(n,e){n.O_.push(e);const t=xm(n);t.r_()&&t.V_&&t.m_(e.mutations)}function r6(n){return Tg(n)&&!xm(n).n_()&&n.O_.length>0}function i6(n){xm(n).start()}async function gB(n){xm(n).p_()}async function yB(n){const e=xm(n);for(const t of n.O_)e.m_(t.mutations)}async function _B(n,e,t){const i=n.O_.shift(),a=b3.from(i,e,t);await n6(n,(()=>n.remoteSyncer.applySuccessfulWrite(a))),await Vx(n)}async function vB(n,e){e&&xm(n).V_&&await(async function(i,a){if((function(_){return aF(_)&&_!==mr.ABORTED})(a.code)){const c=i.O_.shift();xm(i).s_(),await n6(i,(()=>i.remoteSyncer.rejectFailedWrite(c.batchId,a))),await Vx(i)}})(n,e),r6(n)&&i6(n)}async function dT(n,e){const t=no(n);t.asyncQueue.verifyOperationInProgress(),Fi("RemoteStore","RemoteStore received new credentials");const i=Tg(t);t.L_.add(3),await H_(t),i&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Ux(t)}async function xB(n,e){const t=no(n);e?(t.L_.delete(2),await Ux(t)):e||(t.L_.add(2),await H_(t),t.q_.set("Unknown"))}function Qy(n){return n.K_||(n.K_=(function(t,i,a){const c=no(t);return c.w_(),new sB(i,c.connection,c.authCredentials,c.appCheckCredentials,c.serializer,a)})(n.datastore,n.asyncQueue,{Eo:cB.bind(null,n),Ro:hB.bind(null,n),mo:fB.bind(null,n),d_:dB.bind(null,n)}),n.B_.push((async e=>{e?(n.K_.s_(),L3(n)?k3(n):n.q_.set("Unknown")):(await n.K_.stop(),t6(n))}))),n.K_}function xm(n){return n.U_||(n.U_=(function(t,i,a){const c=no(t);return c.w_(),new oB(i,c.connection,c.authCredentials,c.appCheckCredentials,c.serializer,a)})(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:gB.bind(null,n),mo:vB.bind(null,n),f_:yB.bind(null,n),g_:_B.bind(null,n)}),n.B_.push((async e=>{e?(n.U_.s_(),await Vx(n)):(await n.U_.stop(),n.O_.length>0&&(Fi("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P3{constructor(e,t,i,a,c){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=a,this.removalCallback=c,this.deferred=new Ip,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((_=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,a,c){const _=Date.now()+i,y=new P3(e,t,_,a,c);return y.start(i),y}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ci(mr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function N3(n,e){if(Np("AsyncQueue",`${e}: ${n}`),V_(n))return new Ci(mr.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ay{constructor(e){this.comparator=e?(t,i)=>e(t,i)||us.comparator(t.key,i.key):(t,i)=>us.comparator(t.key,i.key),this.keyedMap=H0(),this.sortedSet=new Lu(this.comparator)}static emptySet(e){return new Ay(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,i)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ay)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const a=t.getNext().key,c=i.getNext().key;if(!a.isEqual(c))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new Ay;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pT{constructor(){this.W_=new Lu(us.comparator)}track(e){const t=e.doc.key,i=this.W_.get(t);i?e.type!==0&&i.type===3?this.W_=this.W_.insert(t,e):e.type===3&&i.type!==1?this.W_=this.W_.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.W_=this.W_.remove(t):e.type===1&&i.type===2?this.W_=this.W_.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Xs():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal(((t,i)=>{e.push(i)})),e}}class Oy{constructor(e,t,i,a,c,_,y,s,T){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=a,this.mutatedKeys=c,this.fromCache=_,this.syncStateChanged=y,this.excludesMetadataChanges=s,this.hasCachedResults=T}static fromInitialDocuments(e,t,i,a,c){const _=[];return t.forEach((y=>{_.push({type:0,doc:y})})),new Oy(e,t,Ay.emptySet(t),_,i,a,!0,!1,c)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Dx(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let a=0;a<t.length;a++)if(t[a].type!==i[a].type||!t[a].doc.isEqual(i[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bB{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some((e=>e.J_()))}}class wB{constructor(){this.queries=mT(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,i){const a=no(t),c=a.queries;a.queries=mT(),c.forEach(((_,y)=>{for(const s of y.j_)s.onError(i)}))})(this,new Ci(mr.ABORTED,"Firestore shutting down"))}}function mT(){return new Jy((n=>Ak(n)),Dx)}async function R3(n,e){const t=no(n);let i=3;const a=e.query;let c=t.queries.get(a);c?!c.H_()&&e.J_()&&(i=2):(c=new bB,i=e.J_()?0:1);try{switch(i){case 0:c.z_=await t.onListen(a,!0);break;case 1:c.z_=await t.onListen(a,!1);break;case 2:await t.onFirstRemoteStoreListen(a)}}catch(_){const y=N3(_,`Initialization of query '${hy(e.query)}' failed`);return void e.onError(y)}t.queries.set(a,c),c.j_.push(e),e.Z_(t.onlineState),c.z_&&e.X_(c.z_)&&D3(t)}async function M3(n,e){const t=no(n),i=e.query;let a=3;const c=t.queries.get(i);if(c){const _=c.j_.indexOf(e);_>=0&&(c.j_.splice(_,1),c.j_.length===0?a=e.J_()?0:1:!c.H_()&&e.J_()&&(a=2))}switch(a){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}}function SB(n,e){const t=no(n);let i=!1;for(const a of e){const c=a.query,_=t.queries.get(c);if(_){for(const y of _.j_)y.X_(a)&&(i=!0);_.z_=a}}i&&D3(t)}function EB(n,e,t){const i=no(n),a=i.queries.get(e);if(a)for(const c of a.j_)c.onError(t);i.queries.delete(e)}function D3(n){n.Y_.forEach((e=>{e.next()}))}var A5,gT;(gT=A5||(A5={})).ea="default",gT.Cache="cache";class O3{constructor(e,t,i){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=i||{}}X_(e){if(!this.options.includeMetadataChanges){const i=[];for(const a of e.docChanges)a.type!==3&&i.push(a);e=new Oy(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const i=t!=="Offline";return(!this.options._a||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Oy.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==A5.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s6{constructor(e){this.key=e}}class o6{constructor(e){this.key=e}}class TB{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Ho(),this.mutatedKeys=Ho(),this.Aa=Ik(e),this.Ra=new Ay(this.Aa)}get Va(){return this.Ta}ma(e,t){const i=t?t.fa:new pT,a=t?t.Ra:this.Ra;let c=t?t.mutatedKeys:this.mutatedKeys,_=a,y=!1;const s=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,T=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal(((L,R)=>{const U=a.get(L),M=Ox(this.query,R)?R:null,Q=!!U&&this.mutatedKeys.has(U.key),ae=!!M&&(M.hasLocalMutations||this.mutatedKeys.has(M.key)&&M.hasCommittedMutations);let ye=!1;U&&M?U.data.isEqual(M.data)?Q!==ae&&(i.track({type:3,doc:M}),ye=!0):this.ga(U,M)||(i.track({type:2,doc:M}),ye=!0,(s&&this.Aa(M,s)>0||T&&this.Aa(M,T)<0)&&(y=!0)):!U&&M?(i.track({type:0,doc:M}),ye=!0):U&&!M&&(i.track({type:1,doc:U}),ye=!0,(s||T)&&(y=!0)),ye&&(M?(_=_.add(M),c=ae?c.add(L):c.delete(L)):(_=_.delete(L),c=c.delete(L)))})),this.query.limit!==null)for(;_.size>this.query.limit;){const L=this.query.limitType==="F"?_.last():_.first();_=_.delete(L.key),c=c.delete(L.key),i.track({type:1,doc:L})}return{Ra:_,fa:i,ns:y,mutatedKeys:c}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,a){const c=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const _=e.fa.G_();_.sort(((L,R)=>(function(M,Q){const ae=ye=>{switch(ye){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Xs()}};return ae(M)-ae(Q)})(L.type,R.type)||this.Aa(L.doc,R.doc))),this.pa(i),a=a!=null&&a;const y=t&&!a?this.ya():[],s=this.da.size===0&&this.current&&!a?1:0,T=s!==this.Ea;return this.Ea=s,_.length!==0||T?{snapshot:new Oy(this.query,e.Ra,c,_,e.mutatedKeys,s===0,T,!1,!!i&&i.resumeToken.approximateByteSize()>0),wa:y}:{wa:y}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new pT,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach((t=>this.Ta=this.Ta.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ta=this.Ta.delete(t))),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Ho(),this.Ra.forEach((i=>{this.Sa(i.key)&&(this.da=this.da.add(i.key))}));const t=[];return e.forEach((i=>{this.da.has(i)||t.push(new o6(i))})),this.da.forEach((i=>{e.has(i)||t.push(new s6(i))})),t}ba(e){this.Ta=e.Ts,this.da=Ho();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Oy.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class AB{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class IB{constructor(e){this.key=e,this.va=!1}}class CB{constructor(e,t,i,a,c,_){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=a,this.currentUser=c,this.maxConcurrentLimboResolutions=_,this.Ca={},this.Fa=new Jy((y=>Ak(y)),Dx),this.Ma=new Map,this.xa=new Set,this.Oa=new Lu(us.comparator),this.Na=new Map,this.La=new E3,this.Ba={},this.ka=new Map,this.qa=Dy.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function kB(n,e,t=!0){const i=f6(n);let a;const c=i.Fa.get(e);return c?(i.sharedClientState.addLocalQueryTarget(c.targetId),a=c.view.Da()):a=await a6(i,e,t,!0),a}async function LB(n,e){const t=f6(n);await a6(t,e,!0,!1)}async function a6(n,e,t,i){const a=await JF(n.localStore,Gd(e)),c=a.targetId,_=n.sharedClientState.addLocalQueryTarget(c,t);let y;return i&&(y=await PB(n,e,c,_==="current",a.resumeToken)),n.isPrimaryClient&&t&&Qk(n.remoteStore,a),y}async function PB(n,e,t,i,a){n.Ka=(R,U,M)=>(async function(ae,ye,ie,oe){let ve=ye.view.ma(ie);ve.ns&&(ve=await cT(ae.localStore,ye.query,!1).then((({documents:_e})=>ye.view.ma(_e,ve))));const de=oe&&oe.targetChanges.get(ye.targetId),Pe=oe&&oe.targetMismatches.get(ye.targetId)!=null,Be=ye.view.applyChanges(ve,ae.isPrimaryClient,de,Pe);return _T(ae,ye.targetId,Be.wa),Be.snapshot})(n,R,U,M);const c=await cT(n.localStore,e,!0),_=new TB(e,c.Ts),y=_.ma(c.documents),s=$_.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",a),T=_.applyChanges(y,n.isPrimaryClient,s);_T(n,t,T.wa);const L=new AB(e,t,_);return n.Fa.set(e,L),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),T.snapshot}async function NB(n,e,t){const i=no(n),a=i.Fa.get(e),c=i.Ma.get(a.targetId);if(c.length>1)return i.Ma.set(a.targetId,c.filter((_=>!Dx(_,e)))),void i.Fa.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(a.targetId),i.sharedClientState.isActiveQueryTarget(a.targetId)||await T5(i.localStore,a.targetId,!1).then((()=>{i.sharedClientState.clearQueryState(a.targetId),t&&I3(i.remoteStore,a.targetId),I5(i,a.targetId)})).catch(U_)):(I5(i,a.targetId),await T5(i.localStore,a.targetId,!0))}async function RB(n,e){const t=no(n),i=t.Fa.get(e),a=t.Ma.get(i.targetId);t.isPrimaryClient&&a.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),I3(t.remoteStore,i.targetId))}async function MB(n,e,t){const i=UB(n);try{const a=await(function(_,y){const s=no(_),T=Pc.now(),L=y.reduce(((M,Q)=>M.add(Q.key)),Ho());let R,U;return s.persistence.runTransaction("Locally write mutations","readwrite",(M=>{let Q=Rp(),ae=Ho();return s.cs.getEntries(M,L).next((ye=>{Q=ye,Q.forEach(((ie,oe)=>{oe.isValidDocument()||(ae=ae.add(ie))}))})).next((()=>s.localDocuments.getOverlayedDocuments(M,Q))).next((ye=>{R=ye;const ie=[];for(const oe of y){const ve=nF(oe,R.get(oe.key).overlayedDocument);ve!=null&&ie.push(new Eg(oe.key,ve,_k(ve.value.mapValue),$d.exists(!0)))}return s.mutationQueue.addMutationBatch(M,T,ie,y)})).next((ye=>{U=ye;const ie=ye.applyToLocalDocumentSet(R,ae);return s.documentOverlayCache.saveOverlays(M,ye.batchId,ie)}))})).then((()=>({batchId:U.batchId,changes:kk(R)})))})(i.localStore,e);i.sharedClientState.addPendingMutation(a.batchId),(function(_,y,s){let T=_.Ba[_.currentUser.toKey()];T||(T=new Lu(ka)),T=T.insert(y,s),_.Ba[_.currentUser.toKey()]=T})(i,a.batchId,t),await W_(i,a.changes),await Vx(i.remoteStore)}catch(a){const c=N3(a,"Failed to persist write");t.reject(c)}}async function l6(n,e){const t=no(n);try{const i=await YF(t.localStore,e);e.targetChanges.forEach(((a,c)=>{const _=t.Na.get(c);_&&(pl(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?_.va=!0:a.modifiedDocuments.size>0?pl(_.va):a.removedDocuments.size>0&&(pl(_.va),_.va=!1))})),await W_(t,i,e)}catch(i){await U_(i)}}function yT(n,e,t){const i=no(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const a=[];i.Fa.forEach(((c,_)=>{const y=_.view.Z_(e);y.snapshot&&a.push(y.snapshot)})),(function(_,y){const s=no(_);s.onlineState=y;let T=!1;s.queries.forEach(((L,R)=>{for(const U of R.j_)U.Z_(y)&&(T=!0)})),T&&D3(s)})(i.eventManager,e),a.length&&i.Ca.d_(a),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function DB(n,e,t){const i=no(n);i.sharedClientState.updateQueryState(e,"rejected",t);const a=i.Na.get(e),c=a&&a.key;if(c){let _=new Lu(us.comparator);_=_.insert(c,Ih.newNoDocument(c,to.min()));const y=Ho().add(c),s=new zx(to.min(),new Map,new Lu(ka),_,y);await l6(i,s),i.Oa=i.Oa.remove(c),i.Na.delete(e),F3(i)}else await T5(i.localStore,e,!1).then((()=>I5(i,e,t))).catch(U_)}async function OB(n,e){const t=no(n),i=e.batch.batchId;try{const a=await XF(t.localStore,e);c6(t,i,null),u6(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await W_(t,a)}catch(a){await U_(a)}}async function FB(n,e,t){const i=no(n);try{const a=await(function(_,y){const s=no(_);return s.persistence.runTransaction("Reject batch","readwrite-primary",(T=>{let L;return s.mutationQueue.lookupMutationBatch(T,y).next((R=>(pl(R!==null),L=R.keys(),s.mutationQueue.removeMutationBatch(T,R)))).next((()=>s.mutationQueue.performConsistencyCheck(T))).next((()=>s.documentOverlayCache.removeOverlaysForBatchId(T,L,y))).next((()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(T,L))).next((()=>s.localDocuments.getDocuments(T,L)))}))})(i.localStore,e);c6(i,e,t),u6(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await W_(i,a)}catch(a){await U_(a)}}function u6(n,e){(n.ka.get(e)||[]).forEach((t=>{t.resolve()})),n.ka.delete(e)}function c6(n,e,t){const i=no(n);let a=i.Ba[i.currentUser.toKey()];if(a){const c=a.get(e);c&&(t?c.reject(t):c.resolve(),a=a.remove(e)),i.Ba[i.currentUser.toKey()]=a}}function I5(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.Ma.get(e))n.Fa.delete(i),t&&n.Ca.$a(i,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach((i=>{n.La.containsKey(i)||h6(n,i)}))}function h6(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(I3(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),F3(n))}function _T(n,e,t){for(const i of t)i instanceof s6?(n.La.addReference(i.key,e),BB(n,i)):i instanceof o6?(Fi("SyncEngine","Document no longer in limbo: "+i.key),n.La.removeReference(i.key,e),n.La.containsKey(i.key)||h6(n,i.key)):Xs()}function BB(n,e){const t=e.key,i=t.path.canonicalString();n.Oa.get(t)||n.xa.has(i)||(Fi("SyncEngine","New document in limbo: "+t),n.xa.add(i),F3(n))}function F3(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new us(iu.fromString(e)),i=n.qa.next();n.Na.set(i,new IB(t)),n.Oa=n.Oa.insert(t,i),Qk(n.remoteStore,new lm(Gd(Mx(t.path)),i,"TargetPurposeLimboResolution",p3.oe))}}async function W_(n,e,t){const i=no(n),a=[],c=[],_=[];i.Fa.isEmpty()||(i.Fa.forEach(((y,s)=>{_.push(i.Ka(s,e,t).then((T=>{var L;if((T||t)&&i.isPrimaryClient){const R=T?!T.fromCache:(L=t?.targetChanges.get(s.targetId))===null||L===void 0?void 0:L.current;i.sharedClientState.updateQueryState(s.targetId,R?"current":"not-current")}if(T){a.push(T);const R=A3.Wi(s.targetId,T);c.push(R)}})))})),await Promise.all(_),i.Ca.d_(a),await(async function(s,T){const L=no(s);try{await L.persistence.runTransaction("notifyLocalViewChanges","readwrite",(R=>Ar.forEach(T,(U=>Ar.forEach(U.$i,(M=>L.persistence.referenceDelegate.addReference(R,U.targetId,M))).next((()=>Ar.forEach(U.Ui,(M=>L.persistence.referenceDelegate.removeReference(R,U.targetId,M)))))))))}catch(R){if(!V_(R))throw R;Fi("LocalStore","Failed to update sequence numbers: "+R)}for(const R of T){const U=R.targetId;if(!R.fromCache){const M=L.os.get(U),Q=M.snapshotVersion,ae=M.withLastLimboFreeSnapshotVersion(Q);L.os=L.os.insert(U,ae)}}})(i.localStore,c))}async function zB(n,e){const t=no(n);if(!t.currentUser.isEqual(e)){Fi("SyncEngine","User change. New user:",e.toKey());const i=await Yk(t.localStore,e);t.currentUser=e,(function(c,_){c.ka.forEach((y=>{y.forEach((s=>{s.reject(new Ci(mr.CANCELLED,_))}))})),c.ka.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await W_(t,i.hs)}}function jB(n,e){const t=no(n),i=t.Na.get(e);if(i&&i.va)return Ho().add(i.key);{let a=Ho();const c=t.Ma.get(e);if(!c)return a;for(const _ of c){const y=t.Fa.get(_);a=a.unionWith(y.view.Va)}return a}}function f6(n){const e=no(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=l6.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=jB.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=DB.bind(null,e),e.Ca.d_=SB.bind(null,e.eventManager),e.Ca.$a=EB.bind(null,e.eventManager),e}function UB(n){const e=no(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=OB.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=FB.bind(null,e),e}class Kv{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=jx(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return WF(this.persistence,new $F,e.initialUser,this.serializer)}Ga(e){return new VF(T3.Zr,this.serializer)}Wa(e){return new eB}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Kv.provider={build:()=>new Kv};class C5{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>yT(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=zB.bind(null,this.syncEngine),await xB(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new wB})()}createDatastore(e){const t=jx(e.databaseInfo.databaseId),i=(function(c){return new iB(c)})(e.databaseInfo);return(function(c,_,y,s){return new aB(c,_,y,s)})(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return(function(i,a,c,_,y){return new uB(i,a,c,_,y)})(this.localStore,this.datastore,e.asyncQueue,(t=>yT(this.syncEngine,t,0)),(function(){return fT.D()?new fT:new tB})())}createSyncEngine(e,t){return(function(a,c,_,y,s,T,L){const R=new CB(a,c,_,y,s,T);return L&&(R.Qa=!0),R})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(a){const c=no(a);Fi("RemoteStore","RemoteStore shutting down."),c.L_.add(5),await H_(c),c.k_.shutdown(),c.q_.set("Unknown")})(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}C5.provider={build:()=>new C5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B3{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Np("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VB{constructor(e,t,i,a,c){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=a,this.user=Ah.UNAUTHENTICATED,this.clientId=mk.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=c,this.authCredentials.start(i,(async _=>{Fi("FirestoreClient","Received user=",_.uid),await this.authCredentialListener(_),this.user=_})),this.appCheckCredentials.start(i,(_=>(Fi("FirestoreClient","Received new app check token=",_),this.appCheckCredentialListener(_,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ip;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=N3(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}}async function bw(n,e){n.asyncQueue.verifyOperationInProgress(),Fi("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener((async a=>{i.isEqual(a)||(await Yk(e.localStore,a),i=a)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function vT(n,e){n.asyncQueue.verifyOperationInProgress();const t=await qB(n);Fi("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((i=>dT(e.remoteStore,i))),n.setAppCheckTokenChangeListener(((i,a)=>dT(e.remoteStore,a))),n._onlineComponents=e}async function qB(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Fi("FirestoreClient","Using user provided OfflineComponentProvider");try{await bw(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(a){return a.name==="FirebaseError"?a.code===mr.FAILED_PRECONDITION||a.code===mr.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11})(t))throw t;Py("Error using user provided cache. Falling back to memory cache: "+t),await bw(n,new Kv)}}else Fi("FirestoreClient","Using default OfflineComponentProvider"),await bw(n,new Kv);return n._offlineComponents}async function d6(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Fi("FirestoreClient","Using user provided OnlineComponentProvider"),await vT(n,n._uninitializedComponentsProvider._online)):(Fi("FirestoreClient","Using default OnlineComponentProvider"),await vT(n,new C5))),n._onlineComponents}function GB(n){return d6(n).then((e=>e.syncEngine))}async function Zv(n){const e=await d6(n),t=e.eventManager;return t.onListen=kB.bind(null,e.syncEngine),t.onUnlisten=NB.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=LB.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=RB.bind(null,e.syncEngine),t}function $B(n,e,t={}){const i=new Ip;return n.asyncQueue.enqueueAndForget((async()=>(function(c,_,y,s,T){const L=new B3({next:U=>{L.Za(),_.enqueueAndForget((()=>M3(c,R)));const M=U.docs.has(y);!M&&U.fromCache?T.reject(new Ci(mr.UNAVAILABLE,"Failed to get document because the client is offline.")):M&&U.fromCache&&s&&s.source==="server"?T.reject(new Ci(mr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):T.resolve(U)},error:U=>T.reject(U)}),R=new O3(Mx(y.path),L,{includeMetadataChanges:!0,_a:!0});return R3(c,R)})(await Zv(n),n.asyncQueue,e,t,i))),i.promise}function HB(n,e,t={}){const i=new Ip;return n.asyncQueue.enqueueAndForget((async()=>(function(c,_,y,s,T){const L=new B3({next:U=>{L.Za(),_.enqueueAndForget((()=>M3(c,R))),U.fromCache&&s.source==="server"?T.reject(new Ci(mr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):T.resolve(U)},error:U=>T.reject(U)}),R=new O3(y,L,{includeMetadataChanges:!0,_a:!0});return R3(c,R)})(await Zv(n),n.asyncQueue,e,t,i))),i.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p6(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xT=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m6(n,e,t){if(!t)throw new Ci(mr.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function WB(n,e,t,i){if(e===!0&&i===!0)throw new Ci(mr.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function bT(n){if(!us.isDocumentKey(n))throw new Ci(mr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function wT(n){if(us.isDocumentKey(n))throw new Ci(mr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function qx(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(i){return i.constructor?i.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Xs()}function fd(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Ci(mr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=qx(n);throw new Ci(mr.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ST{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new Ci(mr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Ci(mr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}WB("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=p6((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),(function(c){if(c.timeoutSeconds!==void 0){if(isNaN(c.timeoutSeconds))throw new Ci(mr.INVALID_ARGUMENT,`invalid long polling timeout: ${c.timeoutSeconds} (must not be NaN)`);if(c.timeoutSeconds<5)throw new Ci(mr.INVALID_ARGUMENT,`invalid long polling timeout: ${c.timeoutSeconds} (minimum allowed value is 5)`);if(c.timeoutSeconds>30)throw new Ci(mr.INVALID_ARGUMENT,`invalid long polling timeout: ${c.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(i,a){return i.timeoutSeconds===a.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Gx{constructor(e,t,i,a){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ST({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ci(mr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ci(mr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ST(e),e.credentials!==void 0&&(this._authCredentials=(function(i){if(!i)return new cO;switch(i.type){case"firstParty":return new pO(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new Ci(mr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const i=xT.get(t);i&&(Fi("ComponentProvider","Removing Datastore"),xT.delete(t),i.terminate())})(this),Promise.resolve()}}function XB(n,e,t,i={}){var a;const c=(n=fd(n,Gx))._getSettings(),_=`${e}:${t}`;if(c.host!=="firestore.googleapis.com"&&c.host!==_&&Py("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},c),{host:_,ssl:!1})),i.mockUserToken){let y,s;if(typeof i.mockUserToken=="string")y=i.mockUserToken,s=Ah.MOCK_USER;else{y=B7(i.mockUserToken,(a=n._app)===null||a===void 0?void 0:a.options.projectId);const T=i.mockUserToken.sub||i.mockUserToken.user_id;if(!T)throw new Ci(mr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");s=new Ah(T)}n._authCredentials=new hO(new pk(y,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ag{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new Ag(this.firestore,e,this._query)}}class Uh{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Uh(this.firestore,e,this._key)}}class pm extends Ag{constructor(e,t,i){super(e,t,Mx(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Uh(this.firestore,null,new us(e))}withConverter(e){return new pm(this.firestore,e,this._path)}}function $m(n,e,...t){if(n=Vh(n),m6("collection","path",e),n instanceof Gx){const i=iu.fromString(e,...t);return wT(i),new pm(n,null,i)}{if(!(n instanceof Uh||n instanceof pm))throw new Ci(mr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(iu.fromString(e,...t));return wT(i),new pm(n.firestore,null,i)}}function yy(n,e,...t){if(n=Vh(n),arguments.length===1&&(e=mk.newId()),m6("doc","path",e),n instanceof Gx){const i=iu.fromString(e,...t);return bT(i),new Uh(n,null,new us(i))}{if(!(n instanceof Uh||n instanceof pm))throw new Ci(mr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(iu.fromString(e,...t));return bT(i),new Uh(n.firestore,n instanceof pm?n.converter:null,new us(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ET{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Zk(this,"async_queue_retry"),this.Vu=()=>{const i=xw();i&&Fi("AsyncQueue","Visibility state changed to "+i.visibilityState),this.t_.jo()},this.mu=e;const t=xw();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=xw();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise((()=>{}));const t=new Ip;return this.gu((()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Pu.push(e),this.pu())))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!V_(e))throw e;Fi("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go((()=>this.pu()))}}gu(e){const t=this.mu.then((()=>(this.du=!0,e().catch((i=>{this.Eu=i,this.du=!1;const a=(function(_){let y=_.message||"";return _.stack&&(y=_.stack.includes(_.message)?_.stack:_.message+`
`+_.stack),y})(i);throw Np("INTERNAL UNHANDLED ERROR: ",a),i})).then((i=>(this.du=!1,i))))));return this.mu=t,t}enqueueAfterDelay(e,t,i){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const a=P3.createAndSchedule(this,e,t,i,(c=>this.yu(c)));return this.Tu.push(a),a}fu(){this.Eu&&Xs()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then((()=>{this.Tu.sort(((t,i)=>t.targetTimeMs-i.targetTimeMs));for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()}))}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function TT(n){return(function(t,i){if(typeof t!="object"||t===null)return!1;const a=t;for(const c of i)if(c in a&&typeof a[c]=="function")return!0;return!1})(n,["next","error","complete"])}class gg extends Gx{constructor(e,t,i,a){super(e,t,i,a),this.type="firestore",this._queue=new ET,this._persistenceKey=a?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ET(e),this._firestoreClient=void 0,await e}}}function YB(n,e){const t=typeof n=="object"?n:sk(),i=typeof n=="string"?n:"(default)",a=f3(t,"firestore").getImmediate({identifier:i});if(!a._initialized){const c=O7("firestore");c&&XB(a,...c)}return a}function $x(n){if(n._terminated)throw new Ci(mr.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||KB(n),n._firestoreClient}function KB(n){var e,t,i;const a=n._freezeSettings(),c=(function(y,s,T,L){return new IO(y,s,T,L.host,L.ssl,L.experimentalForceLongPolling,L.experimentalAutoDetectLongPolling,p6(L.experimentalLongPollingOptions),L.useFetchStreams)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,a);n._componentsProvider||!((t=a.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=a.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),n._firestoreClient=new VB(n._authCredentials,n._appCheckCredentials,n._queue,c,n._componentsProvider&&(function(y){const s=y?._online.build();return{_offline:y?._offline.build(s),_online:s}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fy{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Fy(lh.fromBase64String(e))}catch(t){throw new Ci(mr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Fy(lh.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z3{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Ci(mr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new oh(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j3{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hx{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ci(mr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ci(mr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ka(this._lat,e._lat)||ka(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U3{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(i,a){if(i.length!==a.length)return!1;for(let c=0;c<i.length;++c)if(i[c]!==a[c])return!1;return!0})(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZB=/^__.*__$/;class JB{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Eg(e,this.data,this.fieldMask,t,this.fieldTransforms):new G_(e,this.data,t,this.fieldTransforms)}}function g6(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Xs()}}class V3{constructor(e,t,i,a,c,_){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=a,c===void 0&&this.vu(),this.fieldTransforms=c||[],this.fieldMask=_||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new V3(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.Fu({path:i,xu:!1});return a.Ou(e),a}Nu(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.Fu({path:i,xu:!1});return a.vu(),a}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Jv(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(g6(this.Cu)&&ZB.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class QB{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||jx(e)}Qu(e,t,i,a=!1){return new V3({Cu:e,methodName:t,qu:i,path:oh.emptyPath(),xu:!1,ku:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function q3(n){const e=n._freezeSettings(),t=jx(n._databaseId);return new QB(n._databaseId,!!e.ignoreUndefinedProperties,t)}function y6(n,e,t,i,a,c={}){const _=n.Qu(c.merge||c.mergeFields?2:0,e,t,a);x6("Data must be an object, but it was:",_,i);const y=_6(i,_);let s,T;if(c.merge)s=new hd(_.fieldMask),T=_.fieldTransforms;else if(c.mergeFields){const L=[];for(const R of c.mergeFields){const U=tz(e,R,t);if(!_.contains(U))throw new Ci(mr.INVALID_ARGUMENT,`Field '${U}' is specified in your field mask but missing from your input data.`);rz(L,U)||L.push(U)}s=new hd(L),T=_.fieldTransforms.filter((R=>s.covers(R.field)))}else s=null,T=_.fieldTransforms;return new JB(new Vf(y),s,T)}class G3 extends j3{_toFieldTransform(e){return new JO(e.path,new I_)}isEqual(e){return e instanceof G3}}function ez(n,e,t,i=!1){return $3(t,n.Qu(i?4:3,e))}function $3(n,e){if(v6(n=Vh(n)))return x6("Unsupported field value:",e,n),_6(n,e);if(n instanceof j3)return(function(i,a){if(!g6(a.Cu))throw a.Bu(`${i._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Bu(`${i._methodName}() is not currently supported inside arrays`);const c=i._toFieldTransform(a);c&&a.fieldTransforms.push(c)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return(function(i,a){const c=[];let _=0;for(const y of i){let s=$3(y,a.Lu(_));s==null&&(s={nullValue:"NULL_VALUE"}),c.push(s),_++}return{arrayValue:{values:c}}})(n,e)}return(function(i,a){if((i=Vh(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return YO(a.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const c=Pc.fromDate(i);return{timestampValue:Xv(a.serializer,c)}}if(i instanceof Pc){const c=new Pc(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Xv(a.serializer,c)}}if(i instanceof Hx)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof Fy)return{bytesValue:Vk(a.serializer,i._byteString)};if(i instanceof Uh){const c=a.databaseId,_=i.firestore._databaseId;if(!_.isEqual(c))throw a.Bu(`Document reference is for database ${_.projectId}/${_.database} but should be for database ${c.projectId}/${c.database}`);return{referenceValue:S3(i.firestore._databaseId||a.databaseId,i._key.path)}}if(i instanceof U3)return(function(_,y){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:_.toArray().map((s=>{if(typeof s!="number")throw y.Bu("VectorValues must only contain numeric values.");return x3(y.serializer,s)}))}}}}}})(i,a);throw a.Bu(`Unsupported field value: ${qx(i)}`)})(n,e)}function _6(n,e){const t={};return gk(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Zy(n,((i,a)=>{const c=$3(a,e.Mu(i));c!=null&&(t[i]=c)})),{mapValue:{fields:t}}}function v6(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Pc||n instanceof Hx||n instanceof Fy||n instanceof Uh||n instanceof j3||n instanceof U3)}function x6(n,e,t){if(!v6(t)||!(function(a){return typeof a=="object"&&a!==null&&(Object.getPrototypeOf(a)===Object.prototype||Object.getPrototypeOf(a)===null)})(t)){const i=qx(t);throw i==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+i)}}function tz(n,e,t){if((e=Vh(e))instanceof z3)return e._internalPath;if(typeof e=="string")return b6(n,e);throw Jv("Field path arguments must be of type string or ",n,!1,void 0,t)}const nz=new RegExp("[~\\*/\\[\\]]");function b6(n,e,t){if(e.search(nz)>=0)throw Jv(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new z3(...e.split("."))._internalPath}catch{throw Jv(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Jv(n,e,t,i,a){const c=i&&!i.isEmpty(),_=a!==void 0;let y=`Function ${e}() called with invalid data`;t&&(y+=" (via `toFirestore()`)"),y+=". ";let s="";return(c||_)&&(s+=" (found",c&&(s+=` in field ${i}`),_&&(s+=` in document ${a}`),s+=")"),new Ci(mr.INVALID_ARGUMENT,y+n+s)}function rz(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w6{constructor(e,t,i,a,c){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=a,this._converter=c}get id(){return this._key.path.lastSegment()}get ref(){return new Uh(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new iz(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(H3("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class iz extends w6{data(){return super.data()}}function H3(n,e){return typeof e=="string"?b6(n,e):e instanceof z3?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S6(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Ci(mr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class W3{}class sz extends W3{}function AT(n,e,...t){let i=[];e instanceof W3&&i.push(e),i=i.concat(t),(function(c){const _=c.filter((s=>s instanceof X3)).length,y=c.filter((s=>s instanceof Wx)).length;if(_>1||_>0&&y>0)throw new Ci(mr.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(i);for(const a of i)n=a._apply(n);return n}class Wx extends sz{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new Wx(e,t,i)}_apply(e){const t=this._parse(e);return E6(e._query,t),new Ag(e.firestore,e.converter,v5(e._query,t))}_parse(e){const t=q3(e.firestore);return(function(c,_,y,s,T,L,R){let U;if(T.isKeyField()){if(L==="array-contains"||L==="array-contains-any")throw new Ci(mr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${L}' queries on documentId().`);if(L==="in"||L==="not-in"){CT(R,L);const M=[];for(const Q of R)M.push(IT(s,c,Q));U={arrayValue:{values:M}}}else U=IT(s,c,R)}else L!=="in"&&L!=="not-in"&&L!=="array-contains-any"||CT(R,L),U=ez(y,_,R,L==="in"||L==="not-in");return mc.create(T,L,U)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function oz(n,e,t){const i=e,a=H3("where",n);return Wx._create(a,i,t)}class X3 extends W3{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new X3(e,t)}_parse(e){const t=this._queryConstraints.map((i=>i._parse(e))).filter((i=>i.getFilters().length>0));return t.length===1?t[0]:md.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(a,c){let _=a;const y=c.getFlattenedFilters();for(const s of y)E6(_,s),_=v5(_,s)})(e._query,t),new Ag(e.firestore,e.converter,v5(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function IT(n,e,t){if(typeof(t=Vh(t))=="string"){if(t==="")throw new Ci(mr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Tk(e)&&t.indexOf("/")!==-1)throw new Ci(mr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(iu.fromString(t));if(!us.isDocumentKey(i))throw new Ci(mr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return WE(n,new us(i))}if(t instanceof Uh)return WE(n,t._key);throw new Ci(mr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${qx(t)}.`)}function CT(n,e){if(!Array.isArray(n)||n.length===0)throw new Ci(mr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function E6(n,e){const t=(function(a,c){for(const _ of a)for(const y of _.getFlattenedFilters())if(c.indexOf(y.op)>=0)return y.op;return null})(n.filters,(function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new Ci(mr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ci(mr.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class az{convertValue(e,t="none"){switch(mg(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ec(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(pg(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Xs()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return Zy(e,((a,c)=>{i[a]=this.convertValue(c,t)})),i}convertVectorValue(e){var t,i,a;const c=(a=(i=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||i===void 0?void 0:i.values)===null||a===void 0?void 0:a.map((_=>ec(_.doubleValue)));return new U3(c)}convertGeoPoint(e){return new Hx(ec(e.latitude),ec(e.longitude))}convertArray(e,t){return(e.values||[]).map((i=>this.convertValue(i,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const i=g3(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(E_(e));default:return null}}convertTimestamp(e){const t=vm(e);return new Pc(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=iu.fromString(e);pl(Xk(i));const a=new T_(i.get(1),i.get(3)),c=new us(i.popFirst(5));return a.isEqual(t)||Np(`Document ${c} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T6(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X0{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class A6 extends w6{constructor(e,t,i,a,c,_){super(e,t,i,a,_),this._firestore=e,this._firestoreImpl=e,this.metadata=c}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new yv(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(H3("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class yv extends A6{data(e={}){return super.data(e)}}class I6{constructor(e,t,i,a){this._firestore=e,this._userDataWriter=t,this._snapshot=a,this.metadata=new X0(a.hasPendingWrites,a.fromCache),this.query=i}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((i=>{e.call(t,new yv(this._firestore,this._userDataWriter,i.key,i,new X0(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ci(mr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(a,c){if(a._snapshot.oldDocs.isEmpty()){let _=0;return a._snapshot.docChanges.map((y=>{const s=new yv(a._firestore,a._userDataWriter,y.doc.key,y.doc,new X0(a._snapshot.mutatedKeys.has(y.doc.key),a._snapshot.fromCache),a.query.converter);return y.doc,{type:"added",doc:s,oldIndex:-1,newIndex:_++}}))}{let _=a._snapshot.oldDocs;return a._snapshot.docChanges.filter((y=>c||y.type!==3)).map((y=>{const s=new yv(a._firestore,a._userDataWriter,y.doc.key,y.doc,new X0(a._snapshot.mutatedKeys.has(y.doc.key),a._snapshot.fromCache),a.query.converter);let T=-1,L=-1;return y.type!==0&&(T=_.indexOf(y.doc.key),_=_.delete(y.doc.key)),y.type!==1&&(_=_.add(y.doc),L=_.indexOf(y.doc.key)),{type:lz(y.type),doc:s,oldIndex:T,newIndex:L}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function lz(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Xs()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kT(n){n=fd(n,Uh);const e=fd(n.firestore,gg);return $B($x(e),n._key).then((t=>k6(e,n,t)))}class Y3 extends az{constructor(e){super(),this.firestore=e}convertBytes(e){return new Fy(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Uh(this.firestore,null,t)}}function U1(n){n=fd(n,Ag);const e=fd(n.firestore,gg),t=$x(e),i=new Y3(e);return S6(n._query),HB(t,n._query).then((a=>new I6(e,i,n,a)))}function k5(n,e,t){n=fd(n,Uh);const i=fd(n.firestore,gg),a=T6(n.converter,e,t);return C6(i,[y6(q3(i),"setDoc",n._key,a,n.converter!==null,t).toMutation(n._key,$d.none())])}function LT(n,e){const t=fd(n.firestore,gg),i=yy(n),a=T6(n.converter,e);return C6(t,[y6(q3(n.firestore),"addDoc",i._key,a,n.converter!==null,{}).toMutation(i._key,$d.exists(!1))]).then((()=>i))}function uz(n,...e){var t,i,a;n=Vh(n);let c={includeMetadataChanges:!1,source:"default"},_=0;typeof e[_]!="object"||TT(e[_])||(c=e[_],_++);const y={includeMetadataChanges:c.includeMetadataChanges,source:c.source};if(TT(e[_])){const R=e[_];e[_]=(t=R.next)===null||t===void 0?void 0:t.bind(R),e[_+1]=(i=R.error)===null||i===void 0?void 0:i.bind(R),e[_+2]=(a=R.complete)===null||a===void 0?void 0:a.bind(R)}let s,T,L;if(n instanceof Uh)T=fd(n.firestore,gg),L=Mx(n._key.path),s={next:R=>{e[_]&&e[_](k6(T,n,R))},error:e[_+1],complete:e[_+2]};else{const R=fd(n,Ag);T=fd(R.firestore,gg),L=R._query;const U=new Y3(T);s={next:M=>{e[_]&&e[_](new I6(T,U,R,M))},error:e[_+1],complete:e[_+2]},S6(n._query)}return(function(U,M,Q,ae){const ye=new B3(ae),ie=new O3(M,ye,Q);return U.asyncQueue.enqueueAndForget((async()=>R3(await Zv(U),ie))),()=>{ye.Za(),U.asyncQueue.enqueueAndForget((async()=>M3(await Zv(U),ie)))}})($x(T),L,y,s)}function C6(n,e){return(function(i,a){const c=new Ip;return i.asyncQueue.enqueueAndForget((async()=>MB(await GB(i),a,c))),c.promise})($x(n),e)}function k6(n,e,t){const i=t.docs.get(e._key),a=new Y3(n);return new A6(n,a,e._key,i,new X0(t.hasPendingWrites,t.fromCache),e.converter)}function V1(){return new G3("serverTimestamp")}(function(e,t=!0){(function(a){Ky=a})(Yy),Ly(new fg("firestore",((i,{instanceIdentifier:a,options:c})=>{const _=i.getProvider("app").getImmediate(),y=new gg(new fO(i.getProvider("auth-internal")),new gO(i.getProvider("app-check-internal")),(function(T,L){if(!Object.prototype.hasOwnProperty.apply(T.options,["projectId"]))throw new Ci(mr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new T_(T.options.projectId,L)})(_,a),_);return c=Object.assign({useFetchStreams:t},c),y._setSettings(c),y}),"PUBLIC").setMultipleInstances(!0)),dm(VE,"4.7.3",e),dm(VE,"4.7.3","esm2017")})();function K3(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,i=Object.getOwnPropertySymbols(n);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(n,i[a])&&(t[i[a]]=n[i[a]]);return t}function L6(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const cz=L6,P6=new z_("auth","Firebase",L6());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qv=new c3("@firebase/auth");function hz(n,...e){Qv.logLevel<=Qo.WARN&&Qv.warn(`Auth (${Yy}): ${n}`,...e)}function _v(n,...e){Qv.logLevel<=Qo.ERROR&&Qv.error(`Auth (${Yy}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zd(n,...e){throw J3(n,...e)}function dd(n,...e){return J3(n,...e)}function Z3(n,e,t){const i=Object.assign(Object.assign({},cz()),{[e]:t});return new z_("auth","Firebase",i).create(e,{appName:n.name})}function mm(n){return Z3(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function N6(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&Zd(n,"argument-error"),Z3(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function J3(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return P6.create(n,...e)}function Ws(n,e,...t){if(!n)throw J3(e,...t)}function Sp(n){const e="INTERNAL ASSERTION FAILED: "+n;throw _v(e),new Error(e)}function Mp(n,e){n||Sp(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L5(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function fz(){return PT()==="http:"||PT()==="https:"}function PT(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dz(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(fz()||V7()||"connection"in navigator)?navigator.onLine:!0}function pz(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X_{constructor(e,t){this.shortDelay=e,this.longDelay=t,Mp(t>e,"Short delay should be less than long delay!"),this.isMobile=z7()||q7()}get(){return dz()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q3(n,e){Mp(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R6{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Sp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Sp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Sp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mz={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gz=new X_(3e4,6e4);function e2(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function e0(n,e,t,i,a={}){return M6(n,a,async()=>{let c={},_={};i&&(e==="GET"?_=i:c={body:JSON.stringify(i)});const y=j_(Object.assign({key:n.config.apiKey},_)).slice(1),s=await n._getAdditionalHeaders();s["Content-Type"]="application/json",n.languageCode&&(s["X-Firebase-Locale"]=n.languageCode);const T=Object.assign({method:e,headers:s},c);return U7()||(T.referrerPolicy="no-referrer"),R6.fetch()(D6(n,n.config.apiHost,t,y),T)})}async function M6(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},mz),e);try{const a=new _z(n),c=await Promise.race([t(),a.promise]);a.clearNetworkTimeout();const _=await c.json();if("needConfirmation"in _)throw q1(n,"account-exists-with-different-credential",_);if(c.ok&&!("errorMessage"in _))return _;{const y=c.ok?_.errorMessage:_.error.message,[s,T]=y.split(" : ");if(s==="FEDERATED_USER_ID_ALREADY_LINKED")throw q1(n,"credential-already-in-use",_);if(s==="EMAIL_EXISTS")throw q1(n,"email-already-in-use",_);if(s==="USER_DISABLED")throw q1(n,"user-disabled",_);const L=i[s]||s.toLowerCase().replace(/[_\s]+/g,"-");if(T)throw Z3(n,L,T);Zd(n,L)}}catch(a){if(a instanceof Op)throw a;Zd(n,"network-request-failed",{message:String(a)})}}async function yz(n,e,t,i,a={}){const c=await e0(n,e,t,i,a);return"mfaPendingCredential"in c&&Zd(n,"multi-factor-auth-required",{_serverResponse:c}),c}function D6(n,e,t,i){const a=`${e}${t}?${i}`;return n.config.emulator?Q3(n.config,a):`${n.config.apiScheme}://${a}`}class _z{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(dd(this.auth,"network-request-failed")),gz.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function q1(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const a=dd(n,e,i);return a.customData._tokenResponse=t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vz(n,e){return e0(n,"POST","/v1/accounts:delete",e)}async function O6(n,e){return e0(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c_(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function xz(n,e=!1){const t=Vh(n),i=await t.getIdToken(e),a=t2(i);Ws(a&&a.exp&&a.auth_time&&a.iat,t.auth,"internal-error");const c=typeof a.firebase=="object"?a.firebase:void 0,_=c?.sign_in_provider;return{claims:a,token:i,authTime:c_(ww(a.auth_time)),issuedAtTime:c_(ww(a.iat)),expirationTime:c_(ww(a.exp)),signInProvider:_||null,signInSecondFactor:c?.sign_in_second_factor||null}}function ww(n){return Number(n)*1e3}function t2(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return _v("JWT malformed, contained fewer than 3 sections"),null;try{const a=JC(t);return a?JSON.parse(a):(_v("Failed to decode base64 JWT payload"),null)}catch(a){return _v("Caught error parsing JWT payload as JSON",a?.toString()),null}}function NT(n){const e=t2(n);return Ws(e,"internal-error"),Ws(typeof e.exp<"u","internal-error"),Ws(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L_(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof Op&&bz(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function bz({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wz{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const a=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,a)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P5{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=c_(this.lastLoginAt),this.creationTime=c_(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ex(n){var e;const t=n.auth,i=await n.getIdToken(),a=await L_(n,O6(t,{idToken:i}));Ws(a?.users.length,t,"internal-error");const c=a.users[0];n._notifyReloadListener(c);const _=!((e=c.providerUserInfo)===null||e===void 0)&&e.length?F6(c.providerUserInfo):[],y=Ez(n.providerData,_),s=n.isAnonymous,T=!(n.email&&c.passwordHash)&&!y?.length,L=s?T:!1,R={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:y,metadata:new P5(c.createdAt,c.lastLoginAt),isAnonymous:L};Object.assign(n,R)}async function Sz(n){const e=Vh(n);await ex(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Ez(n,e){return[...n.filter(i=>!e.some(a=>a.providerId===i.providerId)),...e]}function F6(n){return n.map(e=>{var{providerId:t}=e,i=K3(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tz(n,e){const t=await M6(n,{},async()=>{const i=j_({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:c}=n.config,_=D6(n,a,"/v1/token",`key=${c}`),y=await n._getAdditionalHeaders();return y["Content-Type"]="application/x-www-form-urlencoded",R6.fetch()(_,{method:"POST",headers:y,body:i})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Az(n,e){return e0(n,"POST","/v2/accounts:revokeToken",e2(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iy{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ws(e.idToken,"internal-error"),Ws(typeof e.idToken<"u","internal-error"),Ws(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):NT(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ws(e.length!==0,"internal-error");const t=NT(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ws(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:a,expiresIn:c}=await Tz(e,t);this.updateTokensAndExpiration(i,a,Number(c))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:a,expirationTime:c}=t,_=new Iy;return i&&(Ws(typeof i=="string","internal-error",{appName:e}),_.refreshToken=i),a&&(Ws(typeof a=="string","internal-error",{appName:e}),_.accessToken=a),c&&(Ws(typeof c=="number","internal-error",{appName:e}),_.expirationTime=c),_}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Iy,this.toJSON())}_performRefresh(){return Sp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qp(n,e){Ws(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Ep{constructor(e){var{uid:t,auth:i,stsTokenManager:a}=e,c=K3(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new wz(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=c.displayName||null,this.email=c.email||null,this.emailVerified=c.emailVerified||!1,this.phoneNumber=c.phoneNumber||null,this.photoURL=c.photoURL||null,this.isAnonymous=c.isAnonymous||!1,this.tenantId=c.tenantId||null,this.providerData=c.providerData?[...c.providerData]:[],this.metadata=new P5(c.createdAt||void 0,c.lastLoginAt||void 0)}async getIdToken(e){const t=await L_(this,this.stsTokenManager.getToken(this.auth,e));return Ws(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return xz(this,e)}reload(){return Sz(this)}_assign(e){this!==e&&(Ws(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ep(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ws(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await ex(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(zd(this.auth.app))return Promise.reject(mm(this.auth));const e=await this.getIdToken();return await L_(this,vz(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,a,c,_,y,s,T,L;const R=(i=t.displayName)!==null&&i!==void 0?i:void 0,U=(a=t.email)!==null&&a!==void 0?a:void 0,M=(c=t.phoneNumber)!==null&&c!==void 0?c:void 0,Q=(_=t.photoURL)!==null&&_!==void 0?_:void 0,ae=(y=t.tenantId)!==null&&y!==void 0?y:void 0,ye=(s=t._redirectEventId)!==null&&s!==void 0?s:void 0,ie=(T=t.createdAt)!==null&&T!==void 0?T:void 0,oe=(L=t.lastLoginAt)!==null&&L!==void 0?L:void 0,{uid:ve,emailVerified:de,isAnonymous:Pe,providerData:Be,stsTokenManager:_e}=t;Ws(ve&&_e,e,"internal-error");const G=Iy.fromJSON(this.name,_e);Ws(typeof ve=="string",e,"internal-error"),Qp(R,e.name),Qp(U,e.name),Ws(typeof de=="boolean",e,"internal-error"),Ws(typeof Pe=="boolean",e,"internal-error"),Qp(M,e.name),Qp(Q,e.name),Qp(ae,e.name),Qp(ye,e.name),Qp(ie,e.name),Qp(oe,e.name);const B=new Ep({uid:ve,auth:e,email:U,emailVerified:de,displayName:R,isAnonymous:Pe,photoURL:Q,phoneNumber:M,tenantId:ae,stsTokenManager:G,createdAt:ie,lastLoginAt:oe});return Be&&Array.isArray(Be)&&(B.providerData=Be.map(Y=>Object.assign({},Y))),ye&&(B._redirectEventId=ye),B}static async _fromIdTokenResponse(e,t,i=!1){const a=new Iy;a.updateFromServerResponse(t);const c=new Ep({uid:t.localId,auth:e,stsTokenManager:a,isAnonymous:i});return await ex(c),c}static async _fromGetAccountInfoResponse(e,t,i){const a=t.users[0];Ws(a.localId!==void 0,"internal-error");const c=a.providerUserInfo!==void 0?F6(a.providerUserInfo):[],_=!(a.email&&a.passwordHash)&&!c?.length,y=new Iy;y.updateFromIdToken(i);const s=new Ep({uid:a.localId,auth:e,stsTokenManager:y,isAnonymous:_}),T={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:c,metadata:new P5(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!c?.length};return Object.assign(s,T),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RT=new Map;function Tp(n){Mp(n instanceof Function,"Expected a class definition");let e=RT.get(n);return e?(Mp(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,RT.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B6{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}B6.type="NONE";const MT=B6;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vv(n,e,t){return`firebase:${n}:${e}:${t}`}class Cy{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:a,name:c}=this.auth;this.fullUserKey=vv(this.userKey,a.apiKey,c),this.fullPersistenceKey=vv("persistence",a.apiKey,c),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Ep._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new Cy(Tp(MT),e,i);const a=(await Promise.all(t.map(async T=>{if(await T._isAvailable())return T}))).filter(T=>T);let c=a[0]||Tp(MT);const _=vv(i,e.config.apiKey,e.name);let y=null;for(const T of t)try{const L=await T._get(_);if(L){const R=Ep._fromJSON(e,L);T!==c&&(y=R),c=T;break}}catch{}const s=a.filter(T=>T._shouldAllowMigration);return!c._shouldAllowMigration||!s.length?new Cy(c,e,i):(c=s[0],y&&await c._set(_,y.toJSON()),await Promise.all(t.map(async T=>{if(T!==c)try{await T._remove(_)}catch{}})),new Cy(c,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DT(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(V6(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(z6(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(G6(e))return"Blackberry";if($6(e))return"Webos";if(j6(e))return"Safari";if((e.includes("chrome/")||U6(e))&&!e.includes("edge/"))return"Chrome";if(q6(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if(i?.length===2)return i[1]}return"Other"}function z6(n=Ch()){return/firefox\//i.test(n)}function j6(n=Ch()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function U6(n=Ch()){return/crios\//i.test(n)}function V6(n=Ch()){return/iemobile/i.test(n)}function q6(n=Ch()){return/android/i.test(n)}function G6(n=Ch()){return/blackberry/i.test(n)}function $6(n=Ch()){return/webos/i.test(n)}function n2(n=Ch()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Iz(n=Ch()){var e;return n2(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Cz(){return G7()&&document.documentMode===10}function H6(n=Ch()){return n2(n)||q6(n)||$6(n)||G6(n)||/windows phone/i.test(n)||V6(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W6(n,e=[]){let t;switch(n){case"Browser":t=DT(Ch());break;case"Worker":t=`${DT(Ch())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Yy}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kz{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=c=>new Promise((_,y)=>{try{const s=e(c);_(s)}catch(s){y(s)}});i.onAbort=t,this.queue.push(i);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const a of t)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lz(n,e={}){return e0(n,"GET","/v2/passwordPolicy",e2(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pz=6;class Nz{constructor(e){var t,i,a,c;const _=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=_.minPasswordLength)!==null&&t!==void 0?t:Pz,_.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=_.maxPasswordLength),_.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=_.containsLowercaseCharacter),_.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=_.containsUppercaseCharacter),_.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=_.containsNumericCharacter),_.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=_.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(a=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&a!==void 0?a:"",this.forceUpgradeOnSignin=(c=e.forceUpgradeOnSignin)!==null&&c!==void 0?c:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,a,c,_,y;const s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,s),this.validatePasswordCharacterOptions(e,s),s.isValid&&(s.isValid=(t=s.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),s.isValid&&(s.isValid=(i=s.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),s.isValid&&(s.isValid=(a=s.containsLowercaseLetter)!==null&&a!==void 0?a:!0),s.isValid&&(s.isValid=(c=s.containsUppercaseLetter)!==null&&c!==void 0?c:!0),s.isValid&&(s.isValid=(_=s.containsNumericCharacter)!==null&&_!==void 0?_:!0),s.isValid&&(s.isValid=(y=s.containsNonAlphanumericCharacter)!==null&&y!==void 0?y:!0),s}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),a&&(t.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let a=0;a<e.length;a++)i=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,a,c){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rz{constructor(e,t,i,a){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new OT(this),this.idTokenSubscription=new OT(this),this.beforeStateQueue=new kz(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=P6,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Tp(t)),this._initializationPromise=this.queue(async()=>{var i,a;if(!this._deleted&&(this.persistenceManager=await Cy.create(this,e),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((a=this.currentUser)===null||a===void 0?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await O6(this,{idToken:e}),i=await Ep._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(zd(this.app)){const _=this.app.settings.authIdToken;return _?new Promise(y=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(_).then(y,y))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let a=i,c=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const _=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,y=a?._redirectEventId,s=await this.tryRedirectSignIn(e);(!_||_===y)&&s?.user&&(a=s.user,c=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(c)try{await this.beforeStateQueue.runMiddleware(a)}catch(_){a=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(_))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return Ws(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ex(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=pz()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(zd(this.app))return Promise.reject(mm(this));const t=e?Vh(e):null;return t&&Ws(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ws(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return zd(this.app)?Promise.reject(mm(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return zd(this.app)?Promise.reject(mm(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Tp(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Lz(this),t=new Nz(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new z_("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await Az(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Tp(e)||this._popupRedirectResolver;Ws(t,this,"argument-error"),this.redirectPersistenceManager=await Cy.create(this,[Tp(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,a){if(this._deleted)return()=>{};const c=typeof t=="function"?t:t.next.bind(t);let _=!1;const y=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ws(y,this,"internal-error"),y.then(()=>{_||c(this.currentUser)}),typeof t=="function"){const s=e.addObserver(t,i,a);return()=>{_=!0,s()}}else{const s=e.addObserver(t);return()=>{_=!0,s()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ws(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=W6(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());i&&(t["X-Firebase-Client"]=i);const a=await this._getAppCheckToken();return a&&(t["X-Firebase-AppCheck"]=a),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t?.error&&hz(`Error while retrieving App Check token: ${t.error}`),t?.token}}function t0(n){return Vh(n)}class OT{constructor(e){this.auth=e,this.observer=null,this.addObserver=J7(t=>this.observer=t)}get next(){return Ws(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r2={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Mz(n){r2=n}function Dz(n){return r2.loadJS(n)}function Oz(){return r2.gapiScript}function Fz(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bz(n,e){const t=f3(n,"auth");if(t.isInitialized()){const a=t.getImmediate(),c=t.getOptions();if(Vv(c,e??{}))return a;Zd(a,"already-initialized")}return t.initialize({options:e})}function zz(n,e){const t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(Tp);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}function jz(n,e,t){const i=t0(n);Ws(i._canInitEmulator,i,"emulator-config-failed"),Ws(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const a=!1,c=X6(e),{host:_,port:y}=Uz(e),s=y===null?"":`:${y}`;i.config.emulator={url:`${c}//${_}${s}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:_,port:y,protocol:c.replace(":",""),options:Object.freeze({disableWarnings:a})}),Vz()}function X6(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Uz(n){const e=X6(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(i);if(a){const c=a[1];return{host:c,port:FT(i.substr(c.length+1))}}else{const[c,_]=i.split(":");return{host:c,port:FT(_)}}}function FT(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Vz(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y6{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Sp("not implemented")}_getIdTokenResponse(e){return Sp("not implemented")}_linkToIdToken(e,t){return Sp("not implemented")}_getReauthenticationResolver(e){return Sp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ky(n,e){return yz(n,"POST","/v1/accounts:signInWithIdp",e2(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qz="http://localhost";class yg extends Y6{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new yg(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Zd("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:a}=t,c=K3(t,["providerId","signInMethod"]);if(!i||!a)return null;const _=new yg(i,a);return _.idToken=c.idToken||void 0,_.accessToken=c.accessToken||void 0,_.secret=c.secret,_.nonce=c.nonce,_.pendingToken=c.pendingToken||null,_}_getIdTokenResponse(e){const t=this.buildRequest();return ky(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,ky(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ky(e,t)}buildRequest(){const e={requestUri:qz,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=j_(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xx{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y_ extends Xx{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class im extends Y_{constructor(){super("facebook.com")}static credential(e){return yg._fromParams({providerId:im.PROVIDER_ID,signInMethod:im.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return im.credentialFromTaggedObject(e)}static credentialFromError(e){return im.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return im.credential(e.oauthAccessToken)}catch{return null}}}im.FACEBOOK_SIGN_IN_METHOD="facebook.com";im.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fd extends Y_{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return yg._fromParams({providerId:Fd.PROVIDER_ID,signInMethod:Fd.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Fd.credentialFromTaggedObject(e)}static credentialFromError(e){return Fd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return Fd.credential(t,i)}catch{return null}}}Fd.GOOGLE_SIGN_IN_METHOD="google.com";Fd.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sm extends Y_{constructor(){super("github.com")}static credential(e){return yg._fromParams({providerId:sm.PROVIDER_ID,signInMethod:sm.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return sm.credentialFromTaggedObject(e)}static credentialFromError(e){return sm.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return sm.credential(e.oauthAccessToken)}catch{return null}}}sm.GITHUB_SIGN_IN_METHOD="github.com";sm.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class om extends Y_{constructor(){super("twitter.com")}static credential(e,t){return yg._fromParams({providerId:om.PROVIDER_ID,signInMethod:om.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return om.credentialFromTaggedObject(e)}static credentialFromError(e){return om.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return om.credential(t,i)}catch{return null}}}om.TWITTER_SIGN_IN_METHOD="twitter.com";om.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,a=!1){const c=await Ep._fromIdTokenResponse(e,i,a),_=BT(i);return new By({user:c,providerId:_,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const a=BT(i);return new By({user:e,providerId:a,_tokenResponse:i,operationType:t})}}function BT(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tx extends Op{constructor(e,t,i,a){var c;super(t.code,t.message),this.operationType=i,this.user=a,Object.setPrototypeOf(this,tx.prototype),this.customData={appName:e.name,tenantId:(c=e.tenantId)!==null&&c!==void 0?c:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,a){return new tx(e,t,i,a)}}function K6(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(c=>{throw c.code==="auth/multi-factor-auth-required"?tx._fromErrorAndOperation(n,c,e,i):c})}async function Gz(n,e,t=!1){const i=await L_(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return By._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $z(n,e,t=!1){const{auth:i}=n;if(zd(i.app))return Promise.reject(mm(i));const a="reauthenticate";try{const c=await L_(n,K6(i,a,e,n),t);Ws(c.idToken,i,"internal-error");const _=t2(c.idToken);Ws(_,i,"internal-error");const{sub:y}=_;return Ws(n.uid===y,i,"user-mismatch"),By._forOperation(n,a,c)}catch(c){throw c?.code==="auth/user-not-found"&&Zd(i,"user-mismatch"),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hz(n,e,t=!1){if(zd(n.app))return Promise.reject(mm(n));const i="signIn",a=await K6(n,i,e),c=await By._fromIdTokenResponse(n,i,a);return t||await n._updateCurrentUser(c.user),c}function Wz(n,e,t,i){return Vh(n).onIdTokenChanged(e,t,i)}function Xz(n,e,t){return Vh(n).beforeAuthStateChanged(e,t)}function Yz(n,e,t,i){return Vh(n).onAuthStateChanged(e,t,i)}function Kz(n){return Vh(n).signOut()}const nx="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z6{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(nx,"1"),this.storage.removeItem(nx),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zz=1e3,Jz=10;class J6 extends Z6{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=H6(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),a=this.localCache[t];i!==a&&e(t,a,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((_,y,s)=>{this.notifyListeners(_,s)});return}const i=e.key;t?this.detachListener():this.stopPolling();const a=()=>{const _=this.storage.getItem(i);!t&&this.localCache[i]===_||this.notifyListeners(i,_)},c=this.storage.getItem(i);Cz()&&c!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,Jz):a()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const a of Array.from(i))a(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},Zz)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}J6.type="LOCAL";const Qz=J6;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q6 extends Z6{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Q6.type="SESSION";const e9=Q6;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ej(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yx{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(a=>a.isListeningto(e));if(t)return t;const i=new Yx(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:a,data:c}=t.data,_=this.handlersMap[a];if(!_?.size)return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:a});const y=Array.from(_).map(async T=>T(t.origin,c)),s=await ej(y);t.ports[0].postMessage({status:"done",eventId:i,eventType:a,response:s})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Yx.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i2(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let c,_;return new Promise((y,s)=>{const T=i2("",20);a.port1.start();const L=setTimeout(()=>{s(new Error("unsupported_event"))},i);_={messageChannel:a,onMessage(R){const U=R;if(U.data.eventId===T)switch(U.data.status){case"ack":clearTimeout(L),c=setTimeout(()=>{s(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),y(U.data.response);break;default:clearTimeout(L),clearTimeout(c),s(new Error("invalid_response"));break}}},this.handlers.add(_),a.port1.addEventListener("message",_.onMessage),this.target.postMessage({eventType:e,eventId:T,data:t},[a.port2])}).finally(()=>{_&&this.removeMessageHandler(_)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wd(){return window}function nj(n){Wd().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t9(){return typeof Wd().WorkerGlobalScope<"u"&&typeof Wd().importScripts=="function"}async function rj(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function ij(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function sj(){return t9()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n9="firebaseLocalStorageDb",oj=1,rx="firebaseLocalStorage",r9="fbase_key";class K_{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Kx(n,e){return n.transaction([rx],e?"readwrite":"readonly").objectStore(rx)}function aj(){const n=indexedDB.deleteDatabase(n9);return new K_(n).toPromise()}function N5(){const n=indexedDB.open(n9,oj);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(rx,{keyPath:r9})}catch(a){t(a)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(rx)?e(i):(i.close(),await aj(),e(await N5()))})})}async function zT(n,e,t){const i=Kx(n,!0).put({[r9]:e,value:t});return new K_(i).toPromise()}async function lj(n,e){const t=Kx(n,!1).get(e),i=await new K_(t).toPromise();return i===void 0?null:i.value}function jT(n,e){const t=Kx(n,!0).delete(e);return new K_(t).toPromise()}const uj=800,cj=3;class i9{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await N5(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>cj)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return t9()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Yx._getInstance(sj()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await rj(),!this.activeServiceWorker)return;this.sender=new tj(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&!((e=i[0])===null||e===void 0)&&e.fulfilled&&!((t=i[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||ij()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await N5();return await zT(e,nx,"1"),await jT(e,nx),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>zT(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>lj(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>jT(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const c=Kx(a,!1).getAll();return new K_(c).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:a,value:c}of e)i.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(c)&&(this.notifyListeners(a,c),t.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!i.has(a)&&(this.notifyListeners(a,null),t.push(a));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const a of Array.from(i))a(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),uj)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}i9.type="LOCAL";const hj=i9;new X_(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s2(n,e){return e?Tp(e):(Ws(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o2 extends Y6{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ky(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ky(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ky(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function fj(n){return Hz(n.auth,new o2(n),n.bypassAuthState)}function dj(n){const{auth:e,user:t}=n;return Ws(t,e,"internal-error"),$z(t,new o2(n),n.bypassAuthState)}async function pj(n){const{auth:e,user:t}=n;return Ws(t,e,"internal-error"),Gz(t,new o2(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s9{constructor(e,t,i,a,c=!1){this.auth=e,this.resolver=i,this.user=a,this.bypassAuthState=c,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:a,tenantId:c,error:_,type:y}=e;if(_){this.reject(_);return}const s={auth:this.auth,requestUri:t,sessionId:i,tenantId:c||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(y)(s))}catch(T){this.reject(T)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return fj;case"linkViaPopup":case"linkViaRedirect":return pj;case"reauthViaPopup":case"reauthViaRedirect":return dj;default:Zd(this.auth,"internal-error")}}resolve(e){Mp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Mp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mj=new X_(2e3,1e4);async function gj(n,e,t){if(zd(n.app))return Promise.reject(dd(n,"operation-not-supported-in-this-environment"));const i=t0(n);N6(n,e,Xx);const a=s2(i,t);return new rg(i,"signInViaPopup",e,a).executeNotNull()}class rg extends s9{constructor(e,t,i,a,c){super(e,t,a,c),this.provider=i,this.authWindow=null,this.pollId=null,rg.currentPopupAction&&rg.currentPopupAction.cancel(),rg.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ws(e,this.auth,"internal-error"),e}async onExecution(){Mp(this.filter.length===1,"Popup operations only handle one event");const e=i2();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(dd(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(dd(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,rg.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if(!((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(dd(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,mj.get())};e()}}rg.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yj="pendingRedirect",xv=new Map;class _j extends s9{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=xv.get(this.auth._key());if(!e){try{const i=await vj(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}xv.set(this.auth._key(),e)}return this.bypassAuthState||xv.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function vj(n,e){const t=a9(e),i=o9(n);if(!await i._isAvailable())return!1;const a=await i._get(t)==="true";return await i._remove(t),a}async function xj(n,e){return o9(n)._set(a9(e),"true")}function bj(n,e){xv.set(n._key(),e)}function o9(n){return Tp(n._redirectPersistence)}function a9(n){return vv(yj,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wj(n,e,t){return Sj(n,e,t)}async function Sj(n,e,t){if(zd(n.app))return Promise.reject(mm(n));const i=t0(n);N6(n,e,Xx),await i._initializationPromise;const a=s2(i,t);return await xj(a,i),a._openRedirect(i,e,"signInViaRedirect")}async function Ej(n,e){return await t0(n)._initializationPromise,l9(n,e,!1)}async function l9(n,e,t=!1){if(zd(n.app))return Promise.reject(mm(n));const i=t0(n),a=s2(i,e),_=await new _j(i,a,t).execute();return _&&!t&&(delete _.user._redirectEventId,await i._persistUserIfCurrent(_.user),await i._setRedirectUser(null,e)),_}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tj=600*1e3;class Aj{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Ij(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!u9(e)){const a=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(dd(this.auth,a))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Tj&&this.cachedEventUids.clear(),this.cachedEventUids.has(UT(e))}saveEventToCache(e){this.cachedEventUids.add(UT(e)),this.lastProcessedEventTime=Date.now()}}function UT(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function u9({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function Ij(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return u9(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cj(n,e={}){return e0(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kj=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Lj=/^https?/;async function Pj(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Cj(n);for(const t of e)try{if(Nj(t))return}catch{}Zd(n,"unauthorized-domain")}function Nj(n){const e=L5(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const _=new URL(n);return _.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&_.hostname===i}if(!Lj.test(t))return!1;if(kj.test(n))return i===n;const a=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rj=new X_(3e4,6e4);function VT(){const n=Wd().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Mj(n){return new Promise((e,t)=>{var i,a,c;function _(){VT(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{VT(),t(dd(n,"network-request-failed"))},timeout:Rj.get()})}if(!((a=(i=Wd().gapi)===null||i===void 0?void 0:i.iframes)===null||a===void 0)&&a.Iframe)e(gapi.iframes.getContext());else if(!((c=Wd().gapi)===null||c===void 0)&&c.load)_();else{const y=Fz("iframefcb");return Wd()[y]=()=>{gapi.load?_():t(dd(n,"network-request-failed"))},Dz(`${Oz()}?onload=${y}`).catch(s=>t(s))}}).catch(e=>{throw bv=null,e})}let bv=null;function Dj(n){return bv=bv||Mj(n),bv}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oj=new X_(5e3,15e3),Fj="__/auth/iframe",Bj="emulator/auth/iframe",zj={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},jj=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Uj(n){const e=n.config;Ws(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Q3(e,Bj):`https://${n.config.authDomain}/${Fj}`,i={apiKey:e.apiKey,appName:n.name,v:Yy},a=jj.get(n.config.apiHost);a&&(i.eid=a);const c=n._getFrameworks();return c.length&&(i.fw=c.join(",")),`${t}?${j_(i).slice(1)}`}async function Vj(n){const e=await Dj(n),t=Wd().gapi;return Ws(t,n,"internal-error"),e.open({where:document.body,url:Uj(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:zj,dontclear:!0},i=>new Promise(async(a,c)=>{await i.restyle({setHideOnLeave:!1});const _=dd(n,"network-request-failed"),y=Wd().setTimeout(()=>{c(_)},Oj.get());function s(){Wd().clearTimeout(y),a(i)}i.ping(s).then(s,()=>{c(_)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qj={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Gj=500,$j=600,Hj="_blank",Wj="http://localhost";class qT{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Xj(n,e,t,i=Gj,a=$j){const c=Math.max((window.screen.availHeight-a)/2,0).toString(),_=Math.max((window.screen.availWidth-i)/2,0).toString();let y="";const s=Object.assign(Object.assign({},qj),{width:i.toString(),height:a.toString(),top:c,left:_}),T=Ch().toLowerCase();t&&(y=U6(T)?Hj:t),z6(T)&&(e=e||Wj,s.scrollbars="yes");const L=Object.entries(s).reduce((U,[M,Q])=>`${U}${M}=${Q},`,"");if(Iz(T)&&y!=="_self")return Yj(e||"",y),new qT(null);const R=window.open(e||"",y,L);Ws(R,n,"popup-blocked");try{R.focus()}catch{}return new qT(R)}function Yj(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kj="__/auth/handler",Zj="emulator/auth/handler",Jj=encodeURIComponent("fac");async function GT(n,e,t,i,a,c){Ws(n.config.authDomain,n,"auth-domain-config-required"),Ws(n.config.apiKey,n,"invalid-api-key");const _={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:Yy,eventId:a};if(e instanceof Xx){e.setDefaultLanguage(n.languageCode),_.providerId=e.providerId||"",Z7(e.getCustomParameters())||(_.customParameters=JSON.stringify(e.getCustomParameters()));for(const[L,R]of Object.entries({}))_[L]=R}if(e instanceof Y_){const L=e.getScopes().filter(R=>R!=="");L.length>0&&(_.scopes=L.join(","))}n.tenantId&&(_.tid=n.tenantId);const y=_;for(const L of Object.keys(y))y[L]===void 0&&delete y[L];const s=await n._getAppCheckToken(),T=s?`#${Jj}=${encodeURIComponent(s)}`:"";return`${Qj(n)}?${j_(y).slice(1)}${T}`}function Qj({config:n}){return n.emulator?Q3(n,Zj):`https://${n.authDomain}/${Kj}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sw="webStorageSupport";class eU{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=e9,this._completeRedirectFn=l9,this._overrideRedirectResult=bj}async _openPopup(e,t,i,a){var c;Mp((c=this.eventManagers[e._key()])===null||c===void 0?void 0:c.manager,"_initialize() not called before _openPopup()");const _=await GT(e,t,i,L5(),a);return Xj(e,_,i2())}async _openRedirect(e,t,i,a){await this._originValidation(e);const c=await GT(e,t,i,L5(),a);return nj(c),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:a,promise:c}=this.eventManagers[t];return a?Promise.resolve(a):(Mp(c,"If manager is not set, promise should be"),c)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await Vj(e),i=new Aj(e);return t.register("authEvent",a=>(Ws(a?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Sw,{type:Sw},a=>{var c;const _=(c=a?.[0])===null||c===void 0?void 0:c[Sw];_!==void 0&&t(!!_),Zd(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Pj(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return H6()||j6()||n2()}}const tU=eU;var $T="@firebase/auth",HT="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nU{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ws(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rU(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function iU(n){Ly(new fg("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),c=e.getProvider("app-check-internal"),{apiKey:_,authDomain:y}=i.options;Ws(_&&!_.includes(":"),"invalid-api-key",{appName:i.name});const s={apiKey:_,authDomain:y,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:W6(n)},T=new Rz(i,a,c,s);return zz(T,t),T},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),Ly(new fg("auth-internal",e=>{const t=t0(e.getProvider("auth").getImmediate());return(i=>new nU(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),dm($T,HT,rU(n)),dm($T,HT,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sU=300,oU=tk("authIdTokenMaxAge")||sU;let WT=null;const aU=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>oU)return;const a=t?.token;WT!==a&&(WT=a,await fetch(n,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function wv(n=sk()){const e=f3(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Bz(n,{popupRedirectResolver:tU,persistence:[hj,Qz,e9]}),i=tk("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const c=new URL(i,location.origin);if(location.origin===c.origin){const _=aU(c.toString());Xz(t,_,()=>_(t.currentUser)),Wz(t,y=>_(y))}}const a=QC("auth");return a&&jz(t,`http://${a}`),t}function lU(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Mz({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=a=>{const c=dd("internal-error");c.customData=a,t(c)},i.type="text/javascript",i.charset="UTF-8",lU().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});iU("Browser");const uU={apiKey:"AIzaSyDqdNAi8z3vx8TJcbVwUN37GJtt4vGH_Cs",authDomain:"stakeholder-map-a4bdc.firebaseapp.com",projectId:"stakeholder-map-a4bdc",storageBucket:"stakeholder-map-a4bdc.firebasestorage.app",messagingSenderId:"201968932417",appId:"1:201968932417:web:c6053a304f5dc5f2ffd8c0",measurementId:"G-BEB17GFMBJ"},c9=ik(uU),Th=YB(c9);wv(c9);new Fd;const cU=[{value:5,label:"5 - Excellent"},{value:4,label:"4 - Good"},{value:3,label:"3 - Adequate"},{value:2,label:"2 - Poor"},{value:1,label:"1 - Very Poor"},{value:0,label:"0 - Not Set"}],XT={buildingName:"",notes:"",scores:{architecture:{exterior:0,entrances:0,interiorFinishes:0,lifeSafety:0,codesAndAccessibility:0},engineering:{superstructure:0,conveyingSystems:0,fireProtection:0,plumbing:0,mechanical:0,power:0,lighting:0},functionality:{telecomm:0,fireAlarm:0,spaceSize:0,technology:0}}},hU=({buildingId:n,assessments:e,onClose:t,onSave:i,universityId:a,panelPos:c,isAdminRole:_})=>{const[y,s]=tr.useState(XT);tr.useEffect(()=>{if(n&&e){const M=e[n]||{...XT,buildingName:n};s(M)}},[n,e]);const T=(M,Q,ae)=>{s(ye=>({...ye,scores:{...ye.scores,[M]:{...ye.scores[M],[Q]:Number(ae)}}}))},L=M=>{s(Q=>({...Q,notes:M.target.value}))},R=async()=>{if(!_){alert("Save failed: you are not signed in as an admin.");return}if(!n||!a)return;const M=n.replace(/\//g,"__"),Q=yy(Th,"universities",a,"buildingAssessments",M),ae={...y,originalId:n};try{await k5(Q,ae),i(ae),alert("Assessment saved successfully!"),t()}catch(ye){console.error("Error saving assessment:",ye),alert("Failed to save assessment. See console for details.")}};if(!n)return null;const U=c?{position:"absolute",left:c.x??80,top:c.y??160,zIndex:6}:void 0;return se.jsxs("div",{className:"assessment-panel",style:U,children:[se.jsxs("div",{className:"panel-header",children:[se.jsx("h3",{children:"Technical Assessment"}),se.jsx("button",{onClick:t,className:"close-button",children:""})]}),se.jsxs("div",{className:"panel-content",children:[se.jsx("h4",{children:y.buildingName||n}),y.scores&&Object.entries(y.scores).map(([M,Q])=>se.jsxs("div",{className:"category-section",children:[se.jsx("h5",{children:M.charAt(0).toUpperCase()+M.slice(1)}),Object.entries(Q).map(([ae,ye])=>se.jsxs("div",{className:"score-item",children:[se.jsx("label",{children:ae.replace(/([A-Z])/g," $1").trim()}),se.jsx("select",{value:ye,onChange:ie=>T(M,ae,ie.target.value),children:cU.map(ie=>se.jsx("option",{value:ie.value,children:ie.label},ie.value))})]},ae))]},M)),se.jsxs("div",{className:"notes-section",children:[se.jsx("h5",{children:"Notes"}),se.jsx("textarea",{value:y.notes||"",onChange:L,rows:"4"})]}),se.jsx("button",{className:"save-button",onClick:R,children:"Save Changes"})]})]})},fU=({buildingId:n,buildingName:e,currentCondition:t,onSave:i,onOpenTechnical:a,onClose:c,floorplans:_,onSelectFloorplan:y})=>{const[s,T]=tr.useState(t??"");tr.useEffect(()=>{T(t??"")},[n,t]);const L=()=>{n&&s&&i(n,s)},R=(s||"")!==(t||"");return se.jsxs("div",{className:"interaction-panel",children:[se.jsx("button",{className:"close-button",onClick:c,children:""}),se.jsx("h4",{children:e||n}),se.jsxs("div",{className:"control-section",children:[se.jsx("h5",{children:"Stakeholder Condition"}),se.jsxs("select",{value:s,onChange:U=>T(U.target.value),children:[se.jsx("option",{value:"",disabled:!0,children:"Select condition..."}),se.jsx("option",{value:"5",children:"5 = Excellent"}),se.jsx("option",{value:"4",children:"4 = Good"}),se.jsx("option",{value:"3",children:"3 = Adequate"}),se.jsx("option",{value:"2",children:"2 = Poor"}),se.jsx("option",{value:"1",children:"1 = Very Poor"})]}),se.jsx("div",{className:"button-row",style:{marginTop:8},children:se.jsx("button",{onClick:L,disabled:!R||!s,children:"Save Stakeholder Condition"})})]}),se.jsx("div",{className:"button-row",style:{marginTop:8},children:se.jsx("button",{onClick:a,children:"Technical Assessment"})}),_&&_.length>0&&se.jsxs("div",{className:"control-section",children:[se.jsx("h5",{children:"Floor Plans"}),se.jsx("div",{className:"floorplan-buttons",children:_.map((U,M)=>se.jsx("button",{onClick:()=>y?.(U),children:U.name},M))})]})]})},YT={"This is one of my go-to study spots":"#006400","This is a go-to hangout spot for me and my friends":"#008000","I would like to use this space more, but it needs improvement":"#9cdef1ff","This space feels outdated or run-down":"#f4e806ff","The furniture in this space is uncomfortable or not functional":"#e9a804ff","The lighting or temperature in this space makes it uncomfortable":"#f29008ff","I rarely or never use this space":"#f05555ff","I do not feel safe in this space":"#e00905bc","Just leave a comment about this space":"#9E9E9E"},dU={"This space supports my teaching and/or professional work effectively":"#007330ff","I wish this space were more flexible or adaptable for different uses":"#31f579ff","I would like to use this space more, but it needs some improvement":"#94d2bd","The layout or furniture is not functional for my needs":"#e9d8a6","The technology in this space is inadequate or unreliable":"#f4d804ff","This space lacks the privacy needed for my work":"#f97c3eff","I rarely or never use this space":"#f25f54ff","I do not feel safe in this space":"#ae2012","Just leave a comment about this space":"#9E9E9E"},G1={student:YT,staff:dU,default:YT};var Uc=63710088e-1,h9={centimeters:Uc*100,centimetres:Uc*100,degrees:360/(2*Math.PI),feet:Uc*3.28084,inches:Uc*39.37,kilometers:Uc/1e3,kilometres:Uc/1e3,meters:Uc,metres:Uc,miles:Uc/1609.344,millimeters:Uc*1e3,millimetres:Uc*1e3,nauticalmiles:Uc/1852,radians:1,yards:Uc*1.0936};function Zx(n,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=n,i}function ma(n,e,t={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!KT(n[0])||!KT(n[1]))throw new Error("coordinates must contain numbers");return Zx({type:"Point",coordinates:n},e,t)}function a2(n,e,t={}){for(const a of n){if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(a[a.length-1].length!==a[0].length)throw new Error("First and last Position are not equivalent.");for(let c=0;c<a[a.length-1].length;c++)if(a[a.length-1][c]!==a[0][c])throw new Error("First and last Position are not equivalent.")}return Zx({type:"Polygon",coordinates:n},e,t)}function zy(n,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function pU(n,e,t={}){return Zx({type:"MultiPolygon",coordinates:n},e,t)}function l2(n,e="kilometers"){const t=h9[e];if(!t)throw new Error(e+" units is invalid");return n*t}function f9(n,e="kilometers"){const t=h9[e];if(!t)throw new Error(e+" units is invalid");return n/t}function d9(n){return n%(2*Math.PI)*180/Math.PI}function Ef(n){return n%360*Math.PI/180}function p9(n,e="kilometers",t="kilometers"){if(!(n>=0))throw new Error("length must be a positive number");return l2(f9(n,e),t)}function KT(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function u2(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}function Tf(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function c2(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function mU(n){return n.type==="Feature"?n.geometry:n}function gU(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function Qm(n,e,t={}){if(t.final===!0)return yU(n,e);const i=Tf(n),a=Tf(e),c=Ef(i[0]),_=Ef(a[0]),y=Ef(i[1]),s=Ef(a[1]),T=Math.sin(_-c)*Math.cos(s),L=Math.cos(y)*Math.sin(s)-Math.sin(y)*Math.cos(s)*Math.cos(_-c);return d9(Math.atan2(T,L))}function yU(n,e){let t=Qm(e,n);return t=(t+180)%360,t}function Uf(n,e,t={}){var i=Tf(n),a=Tf(e),c=Ef(a[1]-i[1]),_=Ef(a[0]-i[0]),y=Ef(i[1]),s=Ef(a[1]),T=Math.pow(Math.sin(c/2),2)+Math.pow(Math.sin(_/2),2)*Math.cos(y)*Math.cos(s);return l2(2*Math.atan2(Math.sqrt(T),Math.sqrt(1-T)),t.units)}function m9(n,e,t={}){let i;return t.final?i=ZT(Tf(e),Tf(n)):i=ZT(Tf(n),Tf(e)),i>180?-(360-i):i}function ZT(n,e){const t=Ef(n[1]),i=Ef(e[1]);let a=Ef(e[0]-n[0]);a>Math.PI&&(a-=2*Math.PI),a<-Math.PI&&(a+=2*Math.PI);const c=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(t/2+Math.PI/4)),_=Math.atan2(a,c);return(d9(_)+360)%360}function Ig(n,e,t){if(n!==null)for(var i,a,c,_,y,s,T,L=0,R=0,U,M=n.type,Q=M==="FeatureCollection",ae=M==="Feature",ye=Q?n.features.length:1,ie=0;ie<ye;ie++){T=Q?n.features[ie].geometry:ae?n.geometry:n,U=T?T.type==="GeometryCollection":!1,y=U?T.geometries.length:1;for(var oe=0;oe<y;oe++){var ve=0,de=0;if(_=U?T.geometries[oe]:T,_!==null){s=_.coordinates;var Pe=_.type;switch(L=t&&(Pe==="Polygon"||Pe==="MultiPolygon")?1:0,Pe){case null:break;case"Point":if(e(s,R,ie,ve,de)===!1)return!1;R++,ve++;break;case"LineString":case"MultiPoint":for(i=0;i<s.length;i++){if(e(s[i],R,ie,ve,de)===!1)return!1;R++,Pe==="MultiPoint"&&ve++}Pe==="LineString"&&ve++;break;case"Polygon":case"MultiLineString":for(i=0;i<s.length;i++){for(a=0;a<s[i].length-L;a++){if(e(s[i][a],R,ie,ve,de)===!1)return!1;R++}Pe==="MultiLineString"&&ve++,Pe==="Polygon"&&de++}Pe==="Polygon"&&ve++;break;case"MultiPolygon":for(i=0;i<s.length;i++){for(de=0,a=0;a<s[i].length;a++){for(c=0;c<s[i][a].length-L;c++){if(e(s[i][a][c],R,ie,ve,de)===!1)return!1;R++}de++}ve++}break;case"GeometryCollection":for(i=0;i<_.geometries.length;i++)if(Ig(_.geometries[i],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function R5(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var t=0;t<n.features.length&&e(n.features[t],t)!==!1;t++);}function Jx(n,e){var t,i,a,c,_,y,s,T,L,R,U=0,M=n.type==="FeatureCollection",Q=n.type==="Feature",ae=M?n.features.length:1;for(t=0;t<ae;t++){for(y=M?n.features[t].geometry:Q?n.geometry:n,T=M?n.features[t].properties:Q?n.properties:{},L=M?n.features[t].bbox:Q?n.bbox:void 0,R=M?n.features[t].id:Q?n.id:void 0,s=y?y.type==="GeometryCollection":!1,_=s?y.geometries.length:1,a=0;a<_;a++){if(c=s?y.geometries[a]:y,c===null){if(e(null,U,T,L,R)===!1)return!1;continue}switch(c.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(c,U,T,L,R)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<c.geometries.length;i++)if(e(c.geometries[i],U,T,L,R)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}U++}}function _U(n,e,t){var i=t;return Jx(n,function(a,c,_,y,s){i=e(i,a,c,_,y,s)}),i}function JT(n){return _U(n,(e,t)=>e+vU(t),0)}function vU(n){let e=0,t;switch(n.type){case"Polygon":return QT(n.coordinates);case"MultiPolygon":for(t=0;t<n.coordinates.length;t++)e+=QT(n.coordinates[t]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function QT(n){let e=0;if(n&&n.length>0){e+=Math.abs(eA(n[0]));for(let t=1;t<n.length;t++)e-=Math.abs(eA(n[t]))}return e}var xU=Uc*Uc/2,Ew=Math.PI/180;function eA(n){const e=n.length-1;if(e<=2)return 0;let t=0,i=0;for(;i<e;){const a=n[i],c=n[i+1===e?0:i+1],_=n[i+2>=e?(i+2)%e:i+2],y=a[0]*Ew,s=c[1]*Ew,T=_[0]*Ew;t+=(T-y)*Math.sin(s),i++}return t*xU}function Lc(n,e={}){if(n.bbox!=null&&e.recompute!==!0)return n.bbox;const t=[1/0,1/0,-1/0,-1/0];return Ig(n,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}const Cp=11102230246251565e-32,Eh=134217729,bU=(3+8*Cp)*Cp;function Tw(n,e,t,i,a){let c,_,y,s,T=e[0],L=i[0],R=0,U=0;L>T==L>-T?(c=T,T=e[++R]):(c=L,L=i[++U]);let M=0;if(R<n&&U<t)for(L>T==L>-T?(_=T+c,y=c-(_-T),T=e[++R]):(_=L+c,y=c-(_-L),L=i[++U]),c=_,y!==0&&(a[M++]=y);R<n&&U<t;)L>T==L>-T?(_=c+T,s=_-c,y=c-(_-s)+(T-s),T=e[++R]):(_=c+L,s=_-c,y=c-(_-s)+(L-s),L=i[++U]),c=_,y!==0&&(a[M++]=y);for(;R<n;)_=c+T,s=_-c,y=c-(_-s)+(T-s),T=e[++R],c=_,y!==0&&(a[M++]=y);for(;U<t;)_=c+L,s=_-c,y=c-(_-s)+(L-s),L=i[++U],c=_,y!==0&&(a[M++]=y);return(c!==0||M===0)&&(a[M++]=c),M}function wU(n,e){let t=e[0];for(let i=1;i<n;i++)t+=e[i];return t}function Z_(n){return new Float64Array(n)}const SU=(3+16*Cp)*Cp,EU=(2+12*Cp)*Cp,TU=(9+64*Cp)*Cp*Cp,ry=Z_(4),tA=Z_(8),nA=Z_(12),rA=Z_(16),zh=Z_(4);function AU(n,e,t,i,a,c,_){let y,s,T,L,R,U,M,Q,ae,ye,ie,oe,ve,de,Pe,Be,_e,G;const B=n-a,Y=t-a,$=e-c,J=i-c;de=B*J,U=Eh*B,M=U-(U-B),Q=B-M,U=Eh*J,ae=U-(U-J),ye=J-ae,Pe=Q*ye-(de-M*ae-Q*ae-M*ye),Be=$*Y,U=Eh*$,M=U-(U-$),Q=$-M,U=Eh*Y,ae=U-(U-Y),ye=Y-ae,_e=Q*ye-(Be-M*ae-Q*ae-M*ye),ie=Pe-_e,R=Pe-ie,ry[0]=Pe-(ie+R)+(R-_e),oe=de+ie,R=oe-de,ve=de-(oe-R)+(ie-R),ie=ve-Be,R=ve-ie,ry[1]=ve-(ie+R)+(R-Be),G=oe+ie,R=G-oe,ry[2]=oe-(G-R)+(ie-R),ry[3]=G;let te=wU(4,ry),Se=EU*_;if(te>=Se||-te>=Se||(R=n-B,y=n-(B+R)+(R-a),R=t-Y,T=t-(Y+R)+(R-a),R=e-$,s=e-($+R)+(R-c),R=i-J,L=i-(J+R)+(R-c),y===0&&s===0&&T===0&&L===0)||(Se=TU*_+bU*Math.abs(te),te+=B*L+J*y-($*T+Y*s),te>=Se||-te>=Se))return te;de=y*J,U=Eh*y,M=U-(U-y),Q=y-M,U=Eh*J,ae=U-(U-J),ye=J-ae,Pe=Q*ye-(de-M*ae-Q*ae-M*ye),Be=s*Y,U=Eh*s,M=U-(U-s),Q=s-M,U=Eh*Y,ae=U-(U-Y),ye=Y-ae,_e=Q*ye-(Be-M*ae-Q*ae-M*ye),ie=Pe-_e,R=Pe-ie,zh[0]=Pe-(ie+R)+(R-_e),oe=de+ie,R=oe-de,ve=de-(oe-R)+(ie-R),ie=ve-Be,R=ve-ie,zh[1]=ve-(ie+R)+(R-Be),G=oe+ie,R=G-oe,zh[2]=oe-(G-R)+(ie-R),zh[3]=G;const De=Tw(4,ry,4,zh,tA);de=B*L,U=Eh*B,M=U-(U-B),Q=B-M,U=Eh*L,ae=U-(U-L),ye=L-ae,Pe=Q*ye-(de-M*ae-Q*ae-M*ye),Be=$*T,U=Eh*$,M=U-(U-$),Q=$-M,U=Eh*T,ae=U-(U-T),ye=T-ae,_e=Q*ye-(Be-M*ae-Q*ae-M*ye),ie=Pe-_e,R=Pe-ie,zh[0]=Pe-(ie+R)+(R-_e),oe=de+ie,R=oe-de,ve=de-(oe-R)+(ie-R),ie=ve-Be,R=ve-ie,zh[1]=ve-(ie+R)+(R-Be),G=oe+ie,R=G-oe,zh[2]=oe-(G-R)+(ie-R),zh[3]=G;const $e=Tw(De,tA,4,zh,nA);de=y*L,U=Eh*y,M=U-(U-y),Q=y-M,U=Eh*L,ae=U-(U-L),ye=L-ae,Pe=Q*ye-(de-M*ae-Q*ae-M*ye),Be=s*T,U=Eh*s,M=U-(U-s),Q=s-M,U=Eh*T,ae=U-(U-T),ye=T-ae,_e=Q*ye-(Be-M*ae-Q*ae-M*ye),ie=Pe-_e,R=Pe-ie,zh[0]=Pe-(ie+R)+(R-_e),oe=de+ie,R=oe-de,ve=de-(oe-R)+(ie-R),ie=ve-Be,R=ve-ie,zh[1]=ve-(ie+R)+(R-Be),G=oe+ie,R=G-oe,zh[2]=oe-(G-R)+(ie-R),zh[3]=G;const Ue=Tw($e,nA,4,zh,rA);return rA[Ue-1]}function IU(n,e,t,i,a,c){const _=(e-c)*(t-a),y=(n-a)*(i-c),s=_-y,T=Math.abs(_+y);return Math.abs(s)>=SU*T?s:-AU(n,e,t,i,a,c,T)}function CU(n,e){var t,i,a=0,c,_,y,s,T,L,R,U=n[0],M=n[1],Q=e.length;for(t=0;t<Q;t++){i=0;var ae=e[t],ye=ae.length-1;if(L=ae[0],L[0]!==ae[ye][0]&&L[1]!==ae[ye][1])throw new Error("First and last coordinates in a ring must be the same");for(_=L[0]-U,y=L[1]-M,i;i<ye;i++){if(R=ae[i+1],s=R[0]-U,T=R[1]-M,y===0&&T===0){if(s<=0&&_>=0||_<=0&&s>=0)return 0}else if(T>=0&&y<=0||T<=0&&y>=0){if(c=IU(_,s,y,T,0,0),c===0)return 0;(c>0&&T>0&&y<=0||c<0&&T<=0&&y>0)&&a++}L=R,y=T,_=s}}return a%2!==0}function kU(n,e,t={}){if(!n)throw new Error("point is required");if(!e)throw new Error("polygon is required");const i=Tf(n),a=mU(e),c=a.type,_=e.bbox;let y=a.coordinates;if(_&&LU(i,_)===!1)return!1;c==="Polygon"&&(y=[y]);let s=!1;for(var T=0;T<y.length;++T){const L=CU(i,y[T]);if(L===0)return!t.ignoreBoundary;L&&(s=!0)}return s}function LU(n,e){return e[0]<=n[0]&&e[1]<=n[1]&&e[2]>=n[0]&&e[3]>=n[1]}function g9(n,e={}){const t=Lc(n),i=(t[0]+t[2])/2,a=(t[1]+t[3])/2;return ma([i,a],e.properties,e)}var Sv={exports:{}},PU=Sv.exports,iA;function NU(){return iA||(iA=1,(function(n,e){(function(t,i){n.exports=i()})(PU,(function(){function t(E,f){(f==null||f>E.length)&&(f=E.length);for(var d=0,S=Array(f);d<f;d++)S[d]=E[d];return S}function i(E,f,d){return f=L(f),(function(S,N){if(N&&(typeof N=="object"||typeof N=="function"))return N;if(N!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(X){if(X===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return X})(S)})(E,U()?Reflect.construct(f,d||[],L(E).constructor):f.apply(E,d))}function a(E,f){if(!(E instanceof f))throw new TypeError("Cannot call a class as a function")}function c(E,f,d){if(U())return Reflect.construct.apply(null,arguments);var S=[null];S.push.apply(S,f);var N=new(E.bind.apply(E,S));return d&&M(N,d.prototype),N}function _(E,f){for(var d=0;d<f.length;d++){var S=f[d];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(E,ye(S.key),S)}}function y(E,f,d){return f&&_(E.prototype,f),d&&_(E,d),Object.defineProperty(E,"prototype",{writable:!1}),E}function s(E,f){var d=typeof Symbol<"u"&&E[Symbol.iterator]||E["@@iterator"];if(!d){if(Array.isArray(E)||(d=ie(E))||f){d&&(E=d);var S=0,N=function(){};return{s:N,n:function(){return S>=E.length?{done:!0}:{done:!1,value:E[S++]}},e:function(Ye){throw Ye},f:N}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var X,he=!0,Ae=!1;return{s:function(){d=d.call(E)},n:function(){var Ye=d.next();return he=Ye.done,Ye},e:function(Ye){Ae=!0,X=Ye},f:function(){try{he||d.return==null||d.return()}finally{if(Ae)throw X}}}}function T(){return T=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(E,f,d){var S=(function(X,he){for(;!{}.hasOwnProperty.call(X,he)&&(X=L(X))!==null;);return X})(E,f);if(S){var N=Object.getOwnPropertyDescriptor(S,f);return N.get?N.get.call(arguments.length<3?E:d):N.value}},T.apply(null,arguments)}function L(E){return L=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(f){return f.__proto__||Object.getPrototypeOf(f)},L(E)}function R(E,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function");E.prototype=Object.create(f&&f.prototype,{constructor:{value:E,writable:!0,configurable:!0}}),Object.defineProperty(E,"prototype",{writable:!1}),f&&M(E,f)}function U(){try{var E=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(U=function(){return!!E})()}function M(E,f){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,S){return d.__proto__=S,d},M(E,f)}function Q(E,f,d,S){var N=T(L(1&S?E.prototype:E),f,d);return 2&S&&typeof N=="function"?function(X){return N.apply(d,X)}:N}function ae(E){return(function(f){if(Array.isArray(f))return t(f)})(E)||(function(f){if(typeof Symbol<"u"&&f[Symbol.iterator]!=null||f["@@iterator"]!=null)return Array.from(f)})(E)||ie(E)||(function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function ye(E){var f=(function(d,S){if(typeof d!="object"||!d)return d;var N=d[Symbol.toPrimitive];if(N!==void 0){var X=N.call(d,S);if(typeof X!="object")return X;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)})(E,"string");return typeof f=="symbol"?f:f+""}function ie(E,f){if(E){if(typeof E=="string")return t(E,f);var d={}.toString.call(E).slice(8,-1);return d==="Object"&&E.constructor&&(d=E.constructor.name),d==="Map"||d==="Set"?Array.from(E):d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d)?t(E,f):void 0}}function oe(E){var f=typeof Map=="function"?new Map:void 0;return oe=function(d){if(d===null||!(function(N){try{return Function.toString.call(N).indexOf("[native code]")!==-1}catch{return typeof N=="function"}})(d))return d;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(f!==void 0){if(f.has(d))return f.get(d);f.set(d,S)}function S(){return c(d,arguments,L(this).constructor)}return S.prototype=Object.create(d.prototype,{constructor:{value:S,enumerable:!1,writable:!0,configurable:!0}}),M(S,d)},oe(E)}var ve=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(f){this._quadrantSegments=f,this._quadrantSegments===0&&(this._joinStyle=E.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=E.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),f<=0&&(this._quadrantSegments=1),this._joinStyle!==E.JOIN_ROUND&&(this._quadrantSegments=E.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(f){this._joinStyle=f}},{key:"setSimplifyFactor",value:function(f){this._simplifyFactor=f<0?0:f}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(f){this._endCapStyle=f}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(f){this._mitreLimit=f}},{key:"setSingleSided",value:function(f){this._isSingleSided=f}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=E.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=E.CAP_ROUND,this._joinStyle=E.JOIN_ROUND,this._mitreLimit=E.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=E.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var f=arguments[0];this.setQuadrantSegments(f)}else if(arguments.length===2){var d=arguments[0],S=arguments[1];this.setQuadrantSegments(d),this.setEndCapStyle(S)}else if(arguments.length===4){var N=arguments[0],X=arguments[1],he=arguments[2],Ae=arguments[3];this.setQuadrantSegments(N),this.setEndCapStyle(X),this.setJoinStyle(he),this.setMitreLimit(Ae)}}}},{key:"bufferDistanceError",value:function(f){var d=Math.PI/2/f;return 1-Math.cos(d/2)}}])})();ve.CAP_ROUND=1,ve.CAP_FLAT=2,ve.CAP_SQUARE=3,ve.JOIN_ROUND=1,ve.JOIN_MITRE=2,ve.JOIN_BEVEL=3,ve.DEFAULT_QUADRANT_SEGMENTS=8,ve.DEFAULT_MITRE_LIMIT=5,ve.DEFAULT_SIMPLIFY_FACTOR=.01;var de=(function(E){function f(d){var S;return a(this,f),(S=i(this,f,[d])).name=Object.keys({Exception:f})[0],S}return R(f,E),y(f,[{key:"toString",value:function(){return this.message}}])})(oe(Error)),Pe=(function(E){function f(d){var S;return a(this,f),(S=i(this,f,[d])).name=Object.keys({IllegalArgumentException:f})[0],S}return R(f,E),y(f)})(de),Be=(function(){return y((function E(){a(this,E)}),[{key:"filter",value:function(E){}}])})();function _e(){}function G(){}function B(){}var Y,$,J,te,Se,De,$e,Ue,Le=(function(){return y((function E(){a(this,E)}),null,[{key:"equalsWithTolerance",value:function(E,f,d){return Math.abs(E-f)<=d}}])})(),He=(function(){return y((function E(f,d){a(this,E),this.low=d||0,this.high=f||0}),null,[{key:"toBinaryString",value:function(E){var f,d="";for(f=2147483648;f>0;f>>>=1)d+=(E.high&f)===f?"1":"0";for(f=2147483648;f>0;f>>>=1)d+=(E.low&f)===f?"1":"0";return d}}])})();function Ke(){}function Ce(){}Ke.NaN=NaN,Ke.isNaN=function(E){return Number.isNaN(E)},Ke.isInfinite=function(E){return!Number.isFinite(E)},Ke.MAX_VALUE=Number.MAX_VALUE,Ke.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,Ke.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(De=2146435072,$e=new Float64Array(1),Ue=new Int32Array($e.buffer),Ke.doubleToLongBits=function(E){$e[0]=E;var f=0|Ue[0],d=0|Ue[1];return(d&De)===De&&1048575&d&&f!==0&&(f=0,d=2146959360),new He(d,f)},Ke.longBitsToDouble=function(E){return Ue[0]=E.low,Ue[1]=E.high,$e[0]}):(Y=1023,$=Math.log2,J=Math.floor,te=Math.pow,Se=(function(){for(var E=53;E>0;E--){var f=te(2,E)-1;if(J($(f))+1===E)return f}return 0})(),Ke.doubleToLongBits=function(E){var f,d,S,N,X,he,Ae,Ye,bt;if(E<0||1/E===Number.NEGATIVE_INFINITY?(he=1<<31,E=-E):he=0,E===0)return new He(Ye=he,bt=0);if(E===1/0)return new He(Ye=2146435072|he,bt=0);if(E!=E)return new He(Ye=2146959360,bt=0);if(N=0,bt=0,(f=J(E))>1)if(f<=Se)(N=J($(f)))<=20?(bt=0,Ye=f<<20-N&1048575):(bt=f%(d=te(2,S=N-20))<<32-S,Ye=f/d&1048575);else for(S=f,bt=0;(S=J(d=S/2))!==0;)N++,bt>>>=1,bt|=(1&Ye)<<31,Ye>>>=1,d!==S&&(Ye|=524288);if(Ae=N+Y,X=f===0,f=E-f,N<52&&f!==0)for(S=0;;){if((d=2*f)>=1?(f=d-1,X?(Ae--,X=!1):(S<<=1,S|=1,N++)):(f=d,X?--Ae==0&&(N++,X=!1):(S<<=1,N++)),N===20)Ye|=S,S=0;else if(N===52){bt|=S;break}if(d===1){N<20?Ye|=S<<20-N:N<52&&(bt|=S<<52-N);break}}return Ye|=Ae<<20,new He(Ye|=he,bt)},Ke.longBitsToDouble=function(E){var f,d,S,N,X=E.high,he=E.low,Ae=X&1<<31?-1:1;for(S=((2146435072&X)>>20)-Y,N=0,d=1<<19,f=1;f<=20;f++)X&d&&(N+=te(2,-f)),d>>>=1;for(d=1<<31,f=21;f<=52;f++)he&d&&(N+=te(2,-f)),d>>>=1;if(S===-1023){if(N===0)return 0*Ae;S=-1022}else{if(S===1024)return N===0?Ae/0:NaN;N+=1}return Ae*N*te(2,S)});var ge=(function(E){function f(d){var S;return a(this,f),(S=i(this,f,[d])).name=Object.keys({RuntimeException:f})[0],S}return R(f,E),y(f)})(de),We=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,null,[{key:"constructor_",value:function(){if(arguments.length===0)ge.constructor_.call(this);else if(arguments.length===1){var d=arguments[0];ge.constructor_.call(this,d)}}}])})(ge),Ve=(function(){function E(){a(this,E)}return y(E,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)E.shouldNeverReachHere(null);else if(arguments.length===1){var f=arguments[0];throw new We("Should never reach here"+(f!==null?": "+f:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var f=arguments[0];E.isTrue(f,null)}else if(arguments.length===2){var d=arguments[1];if(!arguments[0])throw d===null?new We:new We(d)}}},{key:"equals",value:function(){if(arguments.length===2){var f=arguments[0],d=arguments[1];E.equals(f,d,null)}else if(arguments.length===3){var S=arguments[0],N=arguments[1],X=arguments[2];if(!N.equals(S))throw new We("Expected "+S+" but encountered "+N+(X!==null?": "+X:""))}}}])})(),ut=new ArrayBuffer(8),pt=new Float64Array(ut),It=new Int32Array(ut),Oe=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"getM",value:function(){return Ke.NaN}},{key:"setOrdinate",value:function(f,d){switch(f){case E.X:this.x=d;break;case E.Y:this.y=d;break;case E.Z:this.setZ(d);break;default:throw new Pe("Invalid ordinate index: "+f)}}},{key:"equals2D",value:function(){if(arguments.length===1){var f=arguments[0];return this.x===f.x&&this.y===f.y}if(arguments.length===2){var d=arguments[0],S=arguments[1];return!!Le.equalsWithTolerance(this.x,d.x,S)&&!!Le.equalsWithTolerance(this.y,d.y,S)}}},{key:"setM",value:function(f){throw new Pe("Invalid ordinate index: "+E.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(f){switch(f){case E.X:return this.x;case E.Y:return this.y;case E.Z:return this.getZ()}throw new Pe("Invalid ordinate index: "+f)}},{key:"equals3D",value:function(f){return this.x===f.x&&this.y===f.y&&(this.getZ()===f.getZ()||Ke.isNaN(this.getZ())&&Ke.isNaN(f.getZ()))}},{key:"equals",value:function(f){return f instanceof E&&this.equals2D(f)}},{key:"equalInZ",value:function(f,d){return Le.equalsWithTolerance(this.getZ(),f.getZ(),d)}},{key:"setX",value:function(f){this.x=f}},{key:"compareTo",value:function(f){var d=f;return this.x<d.x?-1:this.x>d.x?1:this.y<d.y?-1:this.y>d.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(f){this.z=f}},{key:"clone",value:function(){try{return null}catch(f){if(f instanceof CloneNotSupportedException)return Ve.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw f}}},{key:"copy",value:function(){return new E(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(f){var d=this.x-f.x,S=this.y-f.y,N=this.getZ()-f.getZ();return Math.sqrt(d*d+S*S+N*N)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(f){this.y=f}},{key:"distance",value:function(f){var d=this.x-f.x,S=this.y-f.y;return Math.sqrt(d*d+S*S)}},{key:"hashCode",value:function(){var f=17;return f=37*(f=37*f+E.hashCode(this.x))+E.hashCode(this.y)}},{key:"setCoordinate",value:function(f){this.x=f.x,this.y=f.y,this.z=f.getZ()}},{key:"interfaces_",get:function(){return[_e,G,B]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)E.constructor_.call(this,0,0);else if(arguments.length===1){var f=arguments[0];E.constructor_.call(this,f.x,f.y,f.getZ())}else if(arguments.length===2){var d=arguments[0],S=arguments[1];E.constructor_.call(this,d,S,E.NULL_ORDINATE)}else if(arguments.length===3){var N=arguments[0],X=arguments[1],he=arguments[2];this.x=N,this.y=X,this.z=he}}},{key:"hashCode",value:function(f){return pt[0]=f,It[0]^It[1]}}])})(),Wt=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"compare",value:function(f,d){var S=E.compare(f.x,d.x);if(S!==0)return S;var N=E.compare(f.y,d.y);return N!==0?N:this._dimensionsToTest<=2?0:E.compare(f.getZ(),d.getZ())}},{key:"interfaces_",get:function(){return[Ce]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)E.constructor_.call(this,2);else if(arguments.length===1){var f=arguments[0];if(f!==2&&f!==3)throw new Pe("only 2 or 3 dimensions may be specified");this._dimensionsToTest=f}}},{key:"compare",value:function(f,d){return f<d?-1:f>d?1:Ke.isNaN(f)?Ke.isNaN(d)?0:-1:Ke.isNaN(d)?1:0}}])})();Oe.DimensionalComparator=Wt,Oe.NULL_ORDINATE=Ke.NaN,Oe.X=0,Oe.Y=1,Oe.Z=2,Oe.M=3;var Zt=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(f){if(!(f instanceof E))return!1;var d=f;return this.isNull()?d.isNull():this._maxx===d.getMaxX()&&this._maxy===d.getMaxY()&&this._minx===d.getMinX()&&this._miny===d.getMinY()}},{key:"intersection",value:function(f){if(this.isNull()||f.isNull()||!this.intersects(f))return new E;var d=this._minx>f._minx?this._minx:f._minx,S=this._miny>f._miny?this._miny:f._miny;return new E(d,this._maxx<f._maxx?this._maxx:f._maxx,S,this._maxy<f._maxy?this._maxy:f._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof Oe){var f=arguments[0];return this.covers(f.x,f.y)}if(arguments[0]instanceof E){var d=arguments[0];return!this.isNull()&&!d.isNull()&&d.getMinX()>=this._minx&&d.getMaxX()<=this._maxx&&d.getMinY()>=this._miny&&d.getMaxY()<=this._maxy}}else if(arguments.length===2){var S=arguments[0],N=arguments[1];return!this.isNull()&&S>=this._minx&&S<=this._maxx&&N>=this._miny&&N<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof E){var f=arguments[0];return!this.isNull()&&!f.isNull()&&!(f._minx>this._maxx||f._maxx<this._minx||f._miny>this._maxy||f._maxy<this._miny)}if(arguments[0]instanceof Oe){var d=arguments[0];return this.intersects(d.x,d.y)}}else if(arguments.length===2){if(arguments[0]instanceof Oe&&arguments[1]instanceof Oe){var S=arguments[0],N=arguments[1];return!this.isNull()&&!((S.x<N.x?S.x:N.x)>this._maxx)&&!((S.x>N.x?S.x:N.x)<this._minx)&&!((S.y<N.y?S.y:N.y)>this._maxy)&&!((S.y>N.y?S.y:N.y)<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var X=arguments[0],he=arguments[1];return!this.isNull()&&!(X>this._maxx||X<this._minx||he>this._maxy||he<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var f=this.getWidth(),d=this.getHeight();return Math.sqrt(f*f+d*d)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof Oe){var f=arguments[0];this.expandToInclude(f.x,f.y)}else if(arguments[0]instanceof E){var d=arguments[0];if(d.isNull())return null;this.isNull()?(this._minx=d.getMinX(),this._maxx=d.getMaxX(),this._miny=d.getMinY(),this._maxy=d.getMaxY()):(d._minx<this._minx&&(this._minx=d._minx),d._maxx>this._maxx&&(this._maxx=d._maxx),d._miny<this._miny&&(this._miny=d._miny),d._maxy>this._maxy&&(this._maxy=d._maxy))}}else if(arguments.length===2){var S=arguments[0],N=arguments[1];this.isNull()?(this._minx=S,this._maxx=S,this._miny=N,this._maxy=N):(S<this._minx&&(this._minx=S),S>this._maxx&&(this._maxx=S),N<this._miny&&(this._miny=N),N>this._maxy&&(this._maxy=N))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var f=this.getWidth(),d=this.getHeight();return f<d?f:d}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(f){var d=f;return this.isNull()?d.isNull()?0:-1:d.isNull()?1:this._minx<d._minx?-1:this._minx>d._minx?1:this._miny<d._miny?-1:this._miny>d._miny?1:this._maxx<d._maxx?-1:this._maxx>d._maxx?1:this._maxy<d._maxy?-1:this._maxy>d._maxy?1:0}},{key:"translate",value:function(f,d){if(this.isNull())return null;this.init(this.getMinX()+f,this.getMaxX()+f,this.getMinY()+d,this.getMaxY()+d)}},{key:"copy",value:function(){return new E(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(f){return!(!this.isNull()&&!f.isNull())||f._minx>this._maxx||f._maxx<this._minx||f._miny>this._maxy||f._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var f=this.getWidth(),d=this.getHeight();return f>d?f:d}},{key:"expandBy",value:function(){if(arguments.length===1){var f=arguments[0];this.expandBy(f,f)}else if(arguments.length===2){var d=arguments[0],S=arguments[1];if(this.isNull())return null;this._minx-=d,this._maxx+=d,this._miny-=S,this._maxy+=S,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof E){var f=arguments[0];return this.covers(f)}if(arguments[0]instanceof Oe){var d=arguments[0];return this.covers(d)}}else if(arguments.length===2){var S=arguments[0],N=arguments[1];return this.covers(S,N)}}},{key:"centre",value:function(){return this.isNull()?null:new Oe((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Oe){var f=arguments[0];this.init(f.x,f.x,f.y,f.y)}else if(arguments[0]instanceof E){var d=arguments[0];this._minx=d._minx,this._maxx=d._maxx,this._miny=d._miny,this._maxy=d._maxy}}else if(arguments.length===2){var S=arguments[0],N=arguments[1];this.init(S.x,N.x,S.y,N.y)}else if(arguments.length===4){var X=arguments[0],he=arguments[1],Ae=arguments[2],Ye=arguments[3];X<he?(this._minx=X,this._maxx=he):(this._minx=he,this._maxx=X),Ae<Ye?(this._miny=Ae,this._maxy=Ye):(this._miny=Ye,this._maxy=Ae)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(f){if(this.intersects(f))return 0;var d=0;this._maxx<f._minx?d=f._minx-this._maxx:this._minx>f._maxx&&(d=this._minx-f._maxx);var S=0;return this._maxy<f._miny?S=f._miny-this._maxy:this._miny>f._maxy&&(S=this._miny-f._maxy),d===0?S:S===0?d:Math.sqrt(d*d+S*S)}},{key:"hashCode",value:function(){var f=17;return f=37*(f=37*(f=37*(f=37*f+Oe.hashCode(this._minx))+Oe.hashCode(this._maxx))+Oe.hashCode(this._miny))+Oe.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[_e,B]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Oe){var f=arguments[0];this.init(f.x,f.x,f.y,f.y)}else if(arguments[0]instanceof E){var d=arguments[0];this.init(d)}}else if(arguments.length===2){var S=arguments[0],N=arguments[1];this.init(S.x,N.x,S.y,N.y)}else if(arguments.length===4){var X=arguments[0],he=arguments[1],Ae=arguments[2],Ye=arguments[3];this.init(X,he,Ae,Ye)}}},{key:"intersects",value:function(){if(arguments.length===3){var f=arguments[0],d=arguments[1],S=arguments[2];return S.x>=(f.x<d.x?f.x:d.x)&&S.x<=(f.x>d.x?f.x:d.x)&&S.y>=(f.y<d.y?f.y:d.y)&&S.y<=(f.y>d.y?f.y:d.y)}if(arguments.length===4){var N=arguments[0],X=arguments[1],he=arguments[2],Ae=arguments[3],Ye=Math.min(he.x,Ae.x),bt=Math.max(he.x,Ae.x),an=Math.min(N.x,X.x),mn=Math.max(N.x,X.x);return!(an>bt)&&!(mn<Ye)&&(Ye=Math.min(he.y,Ae.y),bt=Math.max(he.y,Ae.y),an=Math.min(N.y,X.y),mn=Math.max(N.y,X.y),!(an>bt)&&!(mn<Ye))}}}])})(),Xt=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===E.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(f){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(f){return this===f||this.equalsExact(f,0)}},{key:"geometryChanged",value:function(){this.apply(E.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(f){return f!==null&&this.norm().equalsExact(f.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var f;if(arguments.length===1){var d=arguments[0];return f=d,this.getTypeCode()!==f.getTypeCode()?this.getTypeCode()-f.getTypeCode():this.isEmpty()&&f.isEmpty()?0:this.isEmpty()?-1:f.isEmpty()?1:this.compareToSameClass(d)}if(arguments.length===2){var S=arguments[0],N=arguments[1];return f=S,this.getTypeCode()!==f.getTypeCode()?this.getTypeCode()-f.getTypeCode():this.isEmpty()&&f.isEmpty()?0:this.isEmpty()?-1:f.isEmpty()?1:this.compareToSameClass(S,N)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(f){if(f.getTypeCode()===E.TYPECODE_GEOMETRYCOLLECTION)throw new Pe("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(f,d,S){return S===0?f.equals(d):f.distance(d)<=S}},{key:"norm",value:function(){var f=this.copy();return f.normalize(),f}},{key:"reverse",value:function(){var f=this.reverseInternal();return this.envelope!=null&&(f.envelope=this.envelope.copy()),f.setSRID(this.getSRID()),f}},{key:"copy",value:function(){var f=this.copyInternal();return f.envelope=this._envelope==null?null:this._envelope.copy(),f._SRID=this._SRID,f._userData=this._userData,f}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Zt(this._envelope)}},{key:"setSRID",value:function(f){this._SRID=f}},{key:"setUserData",value:function(f){this._userData=f}},{key:"compare",value:function(f,d){for(var S=f.iterator(),N=d.iterator();S.hasNext()&&N.hasNext();){var X=S.next(),he=N.next(),Ae=X.compareTo(he);if(Ae!==0)return Ae}return S.hasNext()?1:N.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(f){return this.getClass()===f.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===E.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===E.TYPECODE_MULTIPOINT||this.getTypeCode()===E.TYPECODE_MULTILINESTRING||this.getTypeCode()===E.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[G,_e,B]}},{key:"getClass",value:function(){return E}}],[{key:"hasNonEmptyElements",value:function(f){for(var d=0;d<f.length;d++)if(!f[d].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(f){for(var d=0;d<f.length;d++)if(f[d]===null)return!0;return!1}}])})();Xt.constructor_=function(E){E&&(this._envelope=null,this._userData=null,this._factory=E,this._SRID=E.getSRID())},Xt.TYPECODE_POINT=0,Xt.TYPECODE_MULTIPOINT=1,Xt.TYPECODE_LINESTRING=2,Xt.TYPECODE_LINEARRING=3,Xt.TYPECODE_MULTILINESTRING=4,Xt.TYPECODE_POLYGON=5,Xt.TYPECODE_MULTIPOLYGON=6,Xt.TYPECODE_GEOMETRYCOLLECTION=7,Xt.TYPENAME_POINT="Point",Xt.TYPENAME_MULTIPOINT="MultiPoint",Xt.TYPENAME_LINESTRING="LineString",Xt.TYPENAME_LINEARRING="LinearRing",Xt.TYPENAME_MULTILINESTRING="MultiLineString",Xt.TYPENAME_POLYGON="Polygon",Xt.TYPENAME_MULTIPOLYGON="MultiPolygon",Xt.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",Xt.geometryChangedFilter={get interfaces_(){return[Be]},filter:function(E){E.geometryChangedAction()}};var Ze=(function(){function E(){a(this,E)}return y(E,null,[{key:"toLocationSymbol",value:function(f){switch(f){case E.EXTERIOR:return"e";case E.BOUNDARY:return"b";case E.INTERIOR:return"i";case E.NONE:return"-"}throw new Pe("Unknown location value: "+f)}}])})();Ze.INTERIOR=0,Ze.BOUNDARY=1,Ze.EXTERIOR=2,Ze.NONE=-1;var zn=(function(){return y((function E(){a(this,E)}),[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}])})(),on=(function(E){function f(d){var S;return a(this,f),(S=i(this,f,[d])).name=Object.keys({NoSuchElementException:f})[0],S}return R(f,E),y(f)})(de),mt=(function(E){function f(d){var S;return a(this,f),(S=i(this,f,[d])).name=Object.keys({UnsupportedOperationException:f})[0],S}return R(f,E),y(f)})(de),Ir=(function(E){function f(){return a(this,f),i(this,f,arguments)}return R(f,E),y(f,[{key:"contains",value:function(){}}])})(zn),Fr=(function(E){function f(d){var S;return a(this,f),(S=i(this,f)).map=new Map,d instanceof zn&&S.addAll(d),S}return R(f,E),y(f,[{key:"contains",value:function(d){var S=d.hashCode?d.hashCode():d;return!!this.map.has(S)}},{key:"add",value:function(d){var S=d.hashCode?d.hashCode():d;return!this.map.has(S)&&!!this.map.set(S,d)}},{key:"addAll",value:function(d){var S,N=s(d);try{for(N.s();!(S=N.n()).done;){var X=S.value;this.add(X)}}catch(he){N.e(he)}finally{N.f()}return!0}},{key:"remove",value:function(){throw new mt}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new qr(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])})(Ir),qr=(function(){return y((function E(f){a(this,E),this.iterator=f.values();var d=this.iterator.next(),S=d.done,N=d.value;this.done=S,this.value=N}),[{key:"next",value:function(){if(this.done)throw new on;var E=this.value,f=this.iterator.next(),d=f.done,S=f.value;return this.done=d,this.value=S,E}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new mt}}])})(),$t=(function(){function E(){a(this,E)}return y(E,null,[{key:"opposite",value:function(f){return f===E.LEFT?E.RIGHT:f===E.RIGHT?E.LEFT:f}}])})();$t.ON=0,$t.LEFT=1,$t.RIGHT=2;var xr=(function(E){function f(d){var S;return a(this,f),(S=i(this,f,[d])).name=Object.keys({EmptyStackException:f})[0],S}return R(f,E),y(f)})(de),dr=(function(E){function f(d){var S;return a(this,f),(S=i(this,f,[d])).name=Object.keys({IndexOutOfBoundsException:f})[0],S}return R(f,E),y(f)})(de),ni=(function(E){function f(){return a(this,f),i(this,f,arguments)}return R(f,E),y(f,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])})(zn),nn=(function(E){function f(){var d;return a(this,f),(d=i(this,f)).array=[],d}return R(f,E),y(f,[{key:"add",value:function(d){return this.array.push(d),!0}},{key:"get",value:function(d){if(d<0||d>=this.size())throw new dr;return this.array[d]}},{key:"push",value:function(d){return this.array.push(d),d}},{key:"pop",value:function(){if(this.array.length===0)throw new xr;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new xr;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(d){return this.array.indexOf(d)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])})(ni);function yn(E,f){return E.interfaces_&&E.interfaces_.indexOf(f)>-1}var sr=(function(){return y((function E(f){a(this,E),this.str=f}),[{key:"append",value:function(E){this.str+=E}},{key:"setCharAt",value:function(E,f){this.str=this.str.substr(0,E)+f+this.str.substr(E+1)}},{key:"toString",value:function(){return this.str}}])})(),Zn=(function(){function E(f){a(this,E),this.value=f}return y(E,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(f){return this.value<f?-1:this.value>f?1:0}}],[{key:"compare",value:function(f,d){return f<d?-1:f>d?1:0}},{key:"isNan",value:function(f){return Number.isNaN(f)}},{key:"valueOf",value:function(f){return new E(f)}}])})(),$r=(function(){return y((function E(){a(this,E)}),null,[{key:"isWhitespace",value:function(E){return E<=32&&E>=0||E===127}},{key:"toUpperCase",value:function(E){return E.toUpperCase()}}])})(),qn=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"le",value:function(f){return this._hi<f._hi||this._hi===f._hi&&this._lo<=f._lo}},{key:"extractSignificantDigits",value:function(f,d){var S=this.abs(),N=E.magnitude(S._hi),X=E.TEN.pow(N);(S=S.divide(X)).gt(E.TEN)?(S=S.divide(E.TEN),N+=1):S.lt(E.ONE)&&(S=S.multiply(E.TEN),N-=1);for(var he=N+1,Ae=new sr,Ye=E.MAX_PRINT_DIGITS-1,bt=0;bt<=Ye;bt++){f&&bt===he&&Ae.append(".");var an=Math.trunc(S._hi);if(an<0)break;var mn=!1,Kn=0;an>9?(mn=!0,Kn="9"):Kn="0"+an,Ae.append(Kn),S=S.subtract(E.valueOf(an)).multiply(E.TEN),mn&&S.selfAdd(E.TEN);var Pr=!0,Yr=E.magnitude(S._hi);if(Yr<0&&Math.abs(Yr)>=Ye-bt&&(Pr=!1),!Pr)break}return d[0]=N,Ae.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof E){var f=arguments[0];return this.add(f.negate())}if(typeof arguments[0]=="number"){var d=arguments[0];return this.add(-d)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof E){var f=arguments[0];return this._hi===f._hi&&this._lo===f._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof E){var f=arguments[0];return this.isNaN()?this:this.selfAdd(-f._hi,-f._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.isNaN()?this:this.selfAdd(-d,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(f){return this.le(f)?this:f}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof E){var f=arguments[0];return this.selfDivide(f._hi,f._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.selfDivide(d,0)}}else if(arguments.length===2){var S,N,X,he,Ae=arguments[0],Ye=arguments[1],bt=null,an=null,mn=null,Kn=null;return X=this._hi/Ae,Kn=(bt=(mn=E.SPLIT*X)-(bt=mn-X))*(an=(Kn=E.SPLIT*Ae)-(an=Kn-Ae))-(he=X*Ae)+bt*(N=Ae-an)+(S=X-bt)*an+S*N,Kn=X+(mn=(this._hi-he-Kn+this._lo-X*Ye)/Ae),this._hi=Kn,this._lo=X-Kn+mn,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof E){var f,d,S,N,X=arguments[0],he=null,Ae=null,Ye=null,bt=null;return f=(S=this._hi/X._hi)-(he=(Ye=E.SPLIT*S)-(he=Ye-S)),bt=he*(Ae=(bt=E.SPLIT*X._hi)-(Ae=bt-X._hi))-(N=S*X._hi)+he*(d=X._hi-Ae)+f*Ae+f*d,new E(bt=S+(Ye=(this._hi-N-bt+this._lo-S*X._lo)/X._hi),S-bt+Ye)}if(typeof arguments[0]=="number"){var an=arguments[0];return Ke.isNaN(an)?E.createNaN():E.copy(this).selfDivide(an,0)}}},{key:"ge",value:function(f){return this._hi>f._hi||this._hi===f._hi&&this._lo>=f._lo}},{key:"pow",value:function(f){if(f===0)return E.valueOf(1);var d=new E(this),S=E.valueOf(1),N=Math.abs(f);if(N>1)for(;N>0;)N%2==1&&S.selfMultiply(d),(N/=2)>0&&(d=d.sqr());else S=d;return f<0?S.reciprocal():S}},{key:"ceil",value:function(){if(this.isNaN())return E.NaN;var f=Math.ceil(this._hi),d=0;return f===this._hi&&(d=Math.ceil(this._lo)),new E(f,d)}},{key:"compareTo",value:function(f){var d=f;return this._hi<d._hi?-1:this._hi>d._hi?1:this._lo<d._lo?-1:this._lo>d._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof E){var f=arguments[0];return this.init(f),this}if(typeof arguments[0]=="number"){var d=arguments[0];return this.init(d),this}}},{key:"max",value:function(f){return this.ge(f)?this:f}},{key:"sqrt",value:function(){if(this.isZero())return E.valueOf(0);if(this.isNegative())return E.NaN;var f=1/Math.sqrt(this._hi),d=this._hi*f,S=E.valueOf(d),N=this.subtract(S.sqr())._hi*(.5*f);return S.add(N)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof E){var f=arguments[0];return this.selfAdd(f._hi,f._lo)}if(typeof arguments[0]=="number"){var d,S,N,X,he,Ae=arguments[0],Ye=null;return Ye=(N=this._hi+Ae)-(X=N-this._hi),S=(he=(Ye=Ae-X+(this._hi-Ye))+this._lo)+(N-(d=N+he)),this._hi=d+S,this._lo=S+(d-this._hi),this}}else if(arguments.length===2){var bt,an,mn,Kn,Pr=arguments[0],Yr=arguments[1],yi=null,Ms=null,Xi=null;mn=this._hi+Pr,an=this._lo+Yr,Ms=mn-(Xi=mn-this._hi),yi=an-(Kn=an-this._lo);var Ds=(bt=mn+(Xi=(Ms=Pr-Xi+(this._hi-Ms))+an))+(Xi=(yi=Yr-Kn+(this._lo-yi))+(Xi+(mn-bt))),As=Xi+(bt-Ds);return this._hi=Ds,this._lo=As,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof E){var f=arguments[0];return this.selfMultiply(f._hi,f._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.selfMultiply(d,0)}}else if(arguments.length===2){var S,N,X=arguments[0],he=arguments[1],Ae=null,Ye=null,bt=null,an=null;Ae=(bt=E.SPLIT*this._hi)-this._hi,an=E.SPLIT*X,Ae=bt-Ae,S=this._hi-Ae,Ye=an-X;var mn=(bt=this._hi*X)+(an=Ae*(Ye=an-Ye)-bt+Ae*(N=X-Ye)+S*Ye+S*N+(this._hi*he+this._lo*X)),Kn=an+(Ae=bt-mn);return this._hi=mn,this._lo=Kn,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return E.NaN;var f=Math.floor(this._hi),d=0;return f===this._hi&&(d=Math.floor(this._lo)),new E(f,d)}},{key:"negate",value:function(){return this.isNaN()?this:new E(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(f){if(f instanceof CloneNotSupportedException)return null;throw f}}},{key:"multiply",value:function(){if(arguments[0]instanceof E){var f=arguments[0];return f.isNaN()?E.createNaN():E.copy(this).selfMultiply(f)}if(typeof arguments[0]=="number"){var d=arguments[0];return Ke.isNaN(d)?E.createNaN():E.copy(this).selfMultiply(d,0)}}},{key:"isNaN",value:function(){return Ke.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var f=E.magnitude(this._hi);return f>=-3&&f<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var f=this.getSpecialNumberString();if(f!==null)return f;var d=new Array(1).fill(null),S=this.extractSignificantDigits(!0,d),N=d[0]+1,X=S;if(S.charAt(0)===".")X="0"+S;else if(N<0)X="0."+E.stringOfChar("0",-N)+S;else if(S.indexOf(".")===-1){var he=N-S.length;X=S+E.stringOfChar("0",he)+".0"}return this.isNegative()?"-"+X:X}},{key:"reciprocal",value:function(){var f,d,S,N,X=null,he=null,Ae=null,Ye=null;f=(S=1/this._hi)-(X=(Ae=E.SPLIT*S)-(X=Ae-S)),he=(Ye=E.SPLIT*this._hi)-this._hi;var bt=S+(Ae=(1-(N=S*this._hi)-(Ye=X*(he=Ye-he)-N+X*(d=this._hi-he)+f*he+f*d)-S*this._lo)/this._hi);return new E(bt,S-bt+Ae)}},{key:"toSciNotation",value:function(){if(this.isZero())return E.SCI_NOT_ZERO;var f=this.getSpecialNumberString();if(f!==null)return f;var d=new Array(1).fill(null),S=this.extractSignificantDigits(!1,d),N=E.SCI_NOT_EXPONENT_CHAR+d[0];if(S.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+S);var X="";S.length>1&&(X=S.substring(1));var he=S.charAt(0)+"."+X;return this.isNegative()?"-"+he+N:he+N}},{key:"abs",value:function(){return this.isNaN()?E.NaN:this.isNegative()?this.negate():new E(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(f){return this._hi<f._hi||this._hi===f._hi&&this._lo<f._lo}},{key:"add",value:function(){if(arguments[0]instanceof E){var f=arguments[0];return E.copy(this).selfAdd(f)}if(typeof arguments[0]=="number"){var d=arguments[0];return E.copy(this).selfAdd(d)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var f=arguments[0];this._hi=f,this._lo=0}else if(arguments[0]instanceof E){var d=arguments[0];this._hi=d._hi,this._lo=d._lo}}else if(arguments.length===2){var S=arguments[0],N=arguments[1];this._hi=S,this._lo=N}}},{key:"gt",value:function(f){return this._hi>f._hi||this._hi===f._hi&&this._lo>f._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?E.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[B,_e,G]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var f=arguments[0];this.init(f)}else if(arguments[0]instanceof E){var d=arguments[0];this.init(d)}else if(typeof arguments[0]=="string"){var S=arguments[0];E.constructor_.call(this,E.parse(S))}}else if(arguments.length===2){var N=arguments[0],X=arguments[1];this.init(N,X)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var f=arguments[0],d=arguments[1],S=arguments[2],N=arguments[3];return E.determinant(E.valueOf(f),E.valueOf(d),E.valueOf(S),E.valueOf(N))}if(arguments[3]instanceof E&&arguments[2]instanceof E&&arguments[0]instanceof E&&arguments[1]instanceof E){var X=arguments[1],he=arguments[2],Ae=arguments[3];return arguments[0].multiply(Ae).selfSubtract(X.multiply(he))}}},{key:"sqr",value:function(f){return E.valueOf(f).selfMultiply(f)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var f=arguments[0];return E.parse(f)}if(typeof arguments[0]=="number")return new E(arguments[0])}},{key:"sqrt",value:function(f){return E.valueOf(f).sqrt()}},{key:"parse",value:function(f){for(var d=0,S=f.length;$r.isWhitespace(f.charAt(d));)d++;var N=!1;if(d<S){var X=f.charAt(d);X!=="-"&&X!=="+"||(d++,X==="-"&&(N=!0))}for(var he=new E,Ae=0,Ye=0,bt=0,an=!1;!(d>=S);){var mn=f.charAt(d);if(d++,$r.isDigit(mn)){var Kn=mn-"0";he.selfMultiply(E.TEN),he.selfAdd(Kn),Ae++}else{if(mn!=="."){if(mn==="e"||mn==="E"){var Pr=f.substring(d);try{bt=Zn.parseInt(Pr)}catch(Ds){throw Ds instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+Pr+" in string "+f):Ds}break}throw new NumberFormatException("Unexpected character '"+mn+"' at position "+d+" in string "+f)}Ye=Ae,an=!0}}var Yr=he;an||(Ye=Ae);var yi=Ae-Ye-bt;if(yi===0)Yr=he;else if(yi>0){var Ms=E.TEN.pow(yi);Yr=he.divide(Ms)}else if(yi<0){var Xi=E.TEN.pow(-yi);Yr=he.multiply(Xi)}return N?Yr.negate():Yr}},{key:"createNaN",value:function(){return new E(Ke.NaN,Ke.NaN)}},{key:"copy",value:function(f){return new E(f)}},{key:"magnitude",value:function(f){var d=Math.abs(f),S=Math.log(d)/Math.log(10),N=Math.trunc(Math.floor(S));return 10*Math.pow(10,N)<=d&&(N+=1),N}},{key:"stringOfChar",value:function(f,d){for(var S=new sr,N=0;N<d;N++)S.append(f);return S.toString()}}])})();qn.PI=new qn(3.141592653589793,12246467991473532e-32),qn.TWO_PI=new qn(6.283185307179586,24492935982947064e-32),qn.PI_2=new qn(1.5707963267948966,6123233995736766e-32),qn.E=new qn(2.718281828459045,14456468917292502e-32),qn.NaN=new qn(Ke.NaN,Ke.NaN),qn.EPS=123259516440783e-46,qn.SPLIT=134217729,qn.MAX_PRINT_DIGITS=32,qn.TEN=qn.valueOf(10),qn.ONE=qn.valueOf(1),qn.SCI_NOT_EXPONENT_CHAR="E",qn.SCI_NOT_ZERO="0.0E0";var jr=(function(){function E(){a(this,E)}return y(E,null,[{key:"orientationIndex",value:function(f,d,S){var N=E.orientationIndexFilter(f,d,S);if(N<=1)return N;var X=qn.valueOf(d.x).selfAdd(-f.x),he=qn.valueOf(d.y).selfAdd(-f.y),Ae=qn.valueOf(S.x).selfAdd(-d.x),Ye=qn.valueOf(S.y).selfAdd(-d.y);return X.selfMultiply(Ye).selfSubtract(he.selfMultiply(Ae)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof qn&&arguments[2]instanceof qn&&arguments[0]instanceof qn&&arguments[1]instanceof qn){var f=arguments[1],d=arguments[2],S=arguments[3];return arguments[0].multiply(S).selfSubtract(f.multiply(d)).signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var N=arguments[0],X=arguments[1],he=arguments[2],Ae=arguments[3],Ye=qn.valueOf(N),bt=qn.valueOf(X),an=qn.valueOf(he),mn=qn.valueOf(Ae);return Ye.multiply(mn).selfSubtract(bt.multiply(an)).signum()}}},{key:"intersection",value:function(f,d,S,N){var X=new qn(f.y).selfSubtract(d.y),he=new qn(d.x).selfSubtract(f.x),Ae=new qn(f.x).selfMultiply(d.y).selfSubtract(new qn(d.x).selfMultiply(f.y)),Ye=new qn(S.y).selfSubtract(N.y),bt=new qn(N.x).selfSubtract(S.x),an=new qn(S.x).selfMultiply(N.y).selfSubtract(new qn(N.x).selfMultiply(S.y)),mn=he.multiply(an).selfSubtract(bt.multiply(Ae)),Kn=Ye.multiply(Ae).selfSubtract(X.multiply(an)),Pr=X.multiply(bt).selfSubtract(Ye.multiply(he)),Yr=mn.selfDivide(Pr).doubleValue(),yi=Kn.selfDivide(Pr).doubleValue();return Ke.isNaN(Yr)||Ke.isInfinite(Yr)||Ke.isNaN(yi)||Ke.isInfinite(yi)?null:new Oe(Yr,yi)}},{key:"orientationIndexFilter",value:function(f,d,S){var N=null,X=(f.x-S.x)*(d.y-S.y),he=(f.y-S.y)*(d.x-S.x),Ae=X-he;if(X>0){if(he<=0)return E.signum(Ae);N=X+he}else{if(!(X<0)||he>=0)return E.signum(Ae);N=-X-he}var Ye=E.DP_SAFE_EPSILON*N;return Ae>=Ye||-Ae>=Ye?E.signum(Ae):2}},{key:"signum",value:function(f){return f>0?1:f<0?-1:0}}])})();jr.DP_SAFE_EPSILON=1e-15;var ir=(function(){return y((function E(){a(this,E)}),[{key:"getM",value:function(E){if(this.hasM()){var f=this.getDimension()-this.getMeasures();return this.getOrdinate(E,f)}return Ke.NaN}},{key:"setOrdinate",value:function(E,f,d){}},{key:"getZ",value:function(E){return this.hasZ()?this.getOrdinate(E,2):Ke.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(E,f){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(E){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(E){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(E){}},{key:"copy",value:function(){}},{key:"getY",value:function(E){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[G]}}])})();ir.X=0,ir.Y=1,ir.Z=2,ir.M=3;var Xn=(function(){function E(){a(this,E)}return y(E,null,[{key:"index",value:function(f,d,S){return jr.orientationIndex(f,d,S)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var f=arguments[0],d=f.length-1;if(d<3)throw new Pe("Ring has fewer than 4 points, so orientation cannot be determined");for(var S=f[0],N=0,X=1;X<=d;X++){var he=f[X];he.y>S.y&&(S=he,N=X)}var Ae=N;do(Ae-=1)<0&&(Ae=d);while(f[Ae].equals2D(S)&&Ae!==N);var Ye=N;do Ye=(Ye+1)%d;while(f[Ye].equals2D(S)&&Ye!==N);var bt=f[Ae],an=f[Ye];if(bt.equals2D(S)||an.equals2D(S)||bt.equals2D(an))return!1;var mn=E.index(bt,S,an);return mn===0?bt.x>an.x:mn>0}if(yn(arguments[0],ir)){var Kn=arguments[0],Pr=Kn.size()-1;if(Pr<3)throw new Pe("Ring has fewer than 4 points, so orientation cannot be determined");for(var Yr=Kn.getCoordinate(0),yi=0,Ms=1;Ms<=Pr;Ms++){var Xi=Kn.getCoordinate(Ms);Xi.y>Yr.y&&(Yr=Xi,yi=Ms)}var Ds=null,As=yi;do(As-=1)<0&&(As=Pr),Ds=Kn.getCoordinate(As);while(Ds.equals2D(Yr)&&As!==yi);var Xo=null,cl=yi;do cl=(cl+1)%Pr,Xo=Kn.getCoordinate(cl);while(Xo.equals2D(Yr)&&cl!==yi);if(Ds.equals2D(Yr)||Xo.equals2D(Yr)||Ds.equals2D(Xo))return!1;var Ma=E.index(Ds,Yr,Xo);return Ma===0?Ds.x>Xo.x:Ma>0}}}])})();Xn.CLOCKWISE=-1,Xn.RIGHT=Xn.CLOCKWISE,Xn.COUNTERCLOCKWISE=1,Xn.LEFT=Xn.COUNTERCLOCKWISE,Xn.COLLINEAR=0,Xn.STRAIGHT=Xn.COLLINEAR;var Bi=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(E,f){var d=this.getRightmostSideOfSegment(E,f);return d<0&&(d=this.getRightmostSideOfSegment(E,f-1)),d<0&&(this._minCoord=null,this.checkForRightmostCoordinate(E)),d}},{key:"findRightmostEdgeAtVertex",value:function(){var E=this._minDe.getEdge().getCoordinates();Ve.isTrue(this._minIndex>0&&this._minIndex<E.length,"rightmost point expected to be interior vertex of edge");var f=E[this._minIndex-1],d=E[this._minIndex+1],S=Xn.index(this._minCoord,d,f),N=!1;(f.y<this._minCoord.y&&d.y<this._minCoord.y&&S===Xn.COUNTERCLOCKWISE||f.y>this._minCoord.y&&d.y>this._minCoord.y&&S===Xn.CLOCKWISE)&&(N=!0),N&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(E,f){var d=E.getEdge().getCoordinates();if(f<0||f+1>=d.length||d[f].y===d[f+1].y)return-1;var S=$t.LEFT;return d[f].y<d[f+1].y&&(S=$t.RIGHT),S}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(E){for(var f=E.getEdge().getCoordinates(),d=0;d<f.length-1;d++)(this._minCoord===null||f[d].x>this._minCoord.x)&&(this._minDe=E,this._minIndex=d,this._minCoord=f[d])}},{key:"findRightmostEdgeAtNode",value:function(){var E=this._minDe.getNode().getEdges();this._minDe=E.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(E){for(var f=E.iterator();f.hasNext();){var d=f.next();d.isForward()&&this.checkForRightmostCoordinate(d)}Ve.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===$t.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}])})(),bi=(function(E){function f(d,S){var N;return a(this,f),(N=i(this,f,[S?d+" [ "+S+" ]":d])).pt=S?new Oe(S):void 0,N.name=Object.keys({TopologyException:f})[0],N}return R(f,E),y(f,[{key:"getCoordinate",value:function(){return this.pt}}])})(ge),wr=(function(){return y((function E(){a(this,E),this.array=[]}),[{key:"addLast",value:function(E){this.array.push(E)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}])})(),or=(function(E){function f(d){var S;return a(this,f),(S=i(this,f)).array=[],d instanceof zn&&S.addAll(d),S}return R(f,E),y(f,[{key:"interfaces_",get:function(){return[ni,zn]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(d){return arguments.length===1?this.array.push(d):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(d){var S,N=s(d);try{for(N.s();!(S=N.n()).done;){var X=S.value;this.array.push(X)}}catch(he){N.e(he)}finally{N.f()}}},{key:"set",value:function(d,S){var N=this.array[d];return this.array[d]=S,N}},{key:"iterator",value:function(){return new ui(this)}},{key:"get",value:function(d){if(d<0||d>=this.size())throw new dr;return this.array[d]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(d){d?this.array.sort((function(S,N){return d.compare(S,N)})):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(d){for(var S=0,N=this.array.length;S<N;S++)if(this.array[S]===d)return!!this.array.splice(S,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])})(ni),ui=(function(){return y((function E(f){a(this,E),this.arrayList=f,this.position=0}),[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new on;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(E){return this.arrayList.set(this.position-1,E)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}])})(),Kr=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"clearVisitedEdges",value:function(){for(var E=this._dirEdgeList.iterator();E.hasNext();)E.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(E){for(var f=null,d=E.getEdges().iterator();d.hasNext();){var S=d.next();if(S.isVisited()||S.getSym().isVisited()){f=S;break}}if(f===null)throw new bi("unable to find edge to compute depths at "+E.getCoordinate());E.getEdges().computeDepths(f);for(var N=E.getEdges().iterator();N.hasNext();){var X=N.next();X.setVisited(!0),this.copySymDepths(X)}}},{key:"computeDepth",value:function(E){this.clearVisitedEdges();var f=this._finder.getEdge();f.getNode(),f.getLabel(),f.setEdgeDepths($t.RIGHT,E),this.copySymDepths(f),this.computeDepths(f)}},{key:"create",value:function(E){this.addReachable(E),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var E=this._dirEdgeList.iterator();E.hasNext();){var f=E.next();f.getDepth($t.RIGHT)>=1&&f.getDepth($t.LEFT)<=0&&!f.isInteriorAreaEdge()&&f.setInResult(!0)}}},{key:"computeDepths",value:function(E){var f=new Fr,d=new wr,S=E.getNode();for(d.addLast(S),f.add(S),E.setVisited(!0);!d.isEmpty();){var N=d.removeFirst();f.add(N),this.computeNodeDepth(N);for(var X=N.getEdges().iterator();X.hasNext();){var he=X.next().getSym();if(!he.isVisited()){var Ae=he.getNode();f.contains(Ae)||(d.addLast(Ae),f.add(Ae))}}}}},{key:"compareTo",value:function(E){var f=E;return this._rightMostCoord.x<f._rightMostCoord.x?-1:this._rightMostCoord.x>f._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var E=new Zt,f=this._dirEdgeList.iterator();f.hasNext();)for(var d=f.next().getEdge().getCoordinates(),S=0;S<d.length-1;S++)E.expandToInclude(d[S]);this._env=E}return this._env}},{key:"addReachable",value:function(E){var f=new nn;for(f.add(E);!f.empty();){var d=f.pop();this.add(d,f)}}},{key:"copySymDepths",value:function(E){var f=E.getSym();f.setDepth($t.LEFT,E.getDepth($t.RIGHT)),f.setDepth($t.RIGHT,E.getDepth($t.LEFT))}},{key:"add",value:function(E,f){E.setVisited(!0),this._nodes.add(E);for(var d=E.getEdges().iterator();d.hasNext();){var S=d.next();this._dirEdgeList.add(S);var N=S.getSym().getNode();N.isVisited()||f.push(N)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[_e]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new or,this._nodes=new or,this._rightMostCoord=null,this._env=null,this._finder=new Bi}}])})(),wi=(function(){return y((function E(){a(this,E)}),null,[{key:"intersection",value:function(E,f,d,S){var N=E.x<f.x?E.x:f.x,X=E.y<f.y?E.y:f.y,he=E.x>f.x?E.x:f.x,Ae=E.y>f.y?E.y:f.y,Ye=d.x<S.x?d.x:S.x,bt=d.y<S.y?d.y:S.y,an=d.x>S.x?d.x:S.x,mn=d.y>S.y?d.y:S.y,Kn=((N>Ye?N:Ye)+(he<an?he:an))/2,Pr=((X>bt?X:bt)+(Ae<mn?Ae:mn))/2,Yr=E.x-Kn,yi=E.y-Pr,Ms=f.x-Kn,Xi=f.y-Pr,Ds=d.x-Kn,As=d.y-Pr,Xo=S.x-Kn,cl=S.y-Pr,Ma=yi-Xi,Go=Ms-Yr,_c=Yr*Xi-Ms*yi,ri=As-cl,gs=Xo-Ds,oc=Ds*cl-Xo*As,Xa=Ma*gs-ri*Go,Ya=(Go*oc-gs*_c)/Xa,ba=(ri*_c-Ma*oc)/Xa;return Ke.isNaN(Ya)||Ke.isInfinite(Ya)||Ke.isNaN(ba)||Ke.isInfinite(ba)?null:new Oe(Ya+Kn,ba+Pr)}}])})(),si=(function(){return y((function E(){a(this,E)}),null,[{key:"arraycopy",value:function(E,f,d,S,N){for(var X=0,he=f;he<f+N;he++)d[S+X]=E[he],X++}},{key:"getProperty",value:function(E){return{"line.separator":`
`}[E]}}])})(),vt=(function(){function E(){a(this,E)}return y(E,null,[{key:"log10",value:function(f){var d=Math.log(f);return Ke.isInfinite(d)||Ke.isNaN(d)?d:d/E.LOG_10}},{key:"min",value:function(f,d,S,N){var X=f;return d<X&&(X=d),S<X&&(X=S),N<X&&(X=N),X}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var f=arguments[0],d=arguments[1],S=arguments[2];return f<d?d:f>S?S:f}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var N=arguments[0],X=arguments[1],he=arguments[2];return N<X?X:N>he?he:N}}},{key:"wrap",value:function(f,d){return f<0?d- -f%d:f%d}},{key:"max",value:function(){if(arguments.length===3){var f=arguments[1],d=arguments[2],S=arguments[0];return f>S&&(S=f),d>S&&(S=d),S}if(arguments.length===4){var N=arguments[1],X=arguments[2],he=arguments[3],Ae=arguments[0];return N>Ae&&(Ae=N),X>Ae&&(Ae=X),he>Ae&&(Ae=he),Ae}}},{key:"average",value:function(f,d){return(f+d)/2}}])})();vt.LOG_10=Math.log(10);var Ne=(function(){function E(){a(this,E)}return y(E,null,[{key:"segmentToSegment",value:function(f,d,S,N){if(f.equals(d))return E.pointToSegment(f,S,N);if(S.equals(N))return E.pointToSegment(N,f,d);var X=!1;if(Zt.intersects(f,d,S,N)){var he=(d.x-f.x)*(N.y-S.y)-(d.y-f.y)*(N.x-S.x);if(he===0)X=!0;else{var Ae=(f.y-S.y)*(N.x-S.x)-(f.x-S.x)*(N.y-S.y),Ye=((f.y-S.y)*(d.x-f.x)-(f.x-S.x)*(d.y-f.y))/he,bt=Ae/he;(bt<0||bt>1||Ye<0||Ye>1)&&(X=!0)}}else X=!0;return X?vt.min(E.pointToSegment(f,S,N),E.pointToSegment(d,S,N),E.pointToSegment(S,f,d),E.pointToSegment(N,f,d)):0}},{key:"pointToSegment",value:function(f,d,S){if(d.x===S.x&&d.y===S.y)return f.distance(d);var N=(S.x-d.x)*(S.x-d.x)+(S.y-d.y)*(S.y-d.y),X=((f.x-d.x)*(S.x-d.x)+(f.y-d.y)*(S.y-d.y))/N;if(X<=0)return f.distance(d);if(X>=1)return f.distance(S);var he=((d.y-f.y)*(S.x-d.x)-(d.x-f.x)*(S.y-d.y))/N;return Math.abs(he)*Math.sqrt(N)}},{key:"pointToLinePerpendicular",value:function(f,d,S){var N=(S.x-d.x)*(S.x-d.x)+(S.y-d.y)*(S.y-d.y),X=((d.y-f.y)*(S.x-d.x)-(d.x-f.x)*(S.y-d.y))/N;return Math.abs(X)*Math.sqrt(N)}},{key:"pointToSegmentString",value:function(f,d){if(d.length===0)throw new Pe("Line array must contain at least one vertex");for(var S=f.distance(d[0]),N=0;N<d.length-1;N++){var X=E.pointToSegment(f,d[N],d[N+1]);X<S&&(S=X)}return S}}])})(),ze=(function(){return y((function E(){a(this,E)}),[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||yn(arguments[0],ir);else if(arguments.length!==2){if(arguments.length===3){var E=arguments[0],f=arguments[1];return this.create(E,f)}}}}])})(),ft=(function(){return y((function E(){a(this,E)}),[{key:"filter",value:function(E){}}])})(),wt=(function(){return y((function E(){a(this,E)}),null,[{key:"ofLine",value:function(E){var f=E.size();if(f<=1)return 0;var d=0,S=new Oe;E.getCoordinate(0,S);for(var N=S.x,X=S.y,he=1;he<f;he++){E.getCoordinate(he,S);var Ae=S.x,Ye=S.y,bt=Ae-N,an=Ye-X;d+=Math.sqrt(bt*bt+an*an),N=Ae,X=Ye}return d}}])})(),Ut=y((function E(){a(this,E)})),Gt=(function(){function E(){a(this,E)}return y(E,null,[{key:"copyCoord",value:function(f,d,S,N){for(var X=Math.min(f.getDimension(),S.getDimension()),he=0;he<X;he++)S.setOrdinate(N,he,f.getOrdinate(d,he))}},{key:"isRing",value:function(f){var d=f.size();return d===0||!(d<=3)&&f.getOrdinate(0,ir.X)===f.getOrdinate(d-1,ir.X)&&f.getOrdinate(0,ir.Y)===f.getOrdinate(d-1,ir.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(yn(arguments[0],ir)&&Number.isInteger(arguments[1])){var f=arguments[0],d=arguments[1];E.scroll(f,d,E.isRing(f))}else if(yn(arguments[0],ir)&&arguments[1]instanceof Oe){var S=arguments[0],N=arguments[1],X=E.indexOf(N,S);if(X<=0)return null;E.scroll(S,X)}}else if(arguments.length===3){var he=arguments[0],Ae=arguments[1],Ye=arguments[2];if(Ae<=0)return null;for(var bt=he.copy(),an=Ye?he.size()-1:he.size(),mn=0;mn<an;mn++)for(var Kn=0;Kn<he.getDimension();Kn++)he.setOrdinate(mn,Kn,bt.getOrdinate((Ae+mn)%an,Kn));if(Ye)for(var Pr=0;Pr<he.getDimension();Pr++)he.setOrdinate(an,Pr,he.getOrdinate(0,Pr))}}},{key:"isEqual",value:function(f,d){var S=f.size();if(S!==d.size())return!1;for(var N=Math.min(f.getDimension(),d.getDimension()),X=0;X<S;X++)for(var he=0;he<N;he++){var Ae=f.getOrdinate(X,he),Ye=d.getOrdinate(X,he);if(f.getOrdinate(X,he)!==d.getOrdinate(X,he)&&(!Ke.isNaN(Ae)||!Ke.isNaN(Ye)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var f=arguments[0];return E.minCoordinateIndex(f,0,f.size()-1)}if(arguments.length===3){for(var d=arguments[0],S=arguments[2],N=-1,X=null,he=arguments[1];he<=S;he++){var Ae=d.getCoordinate(he);(X===null||X.compareTo(Ae)>0)&&(X=Ae,N=he)}return N}}},{key:"extend",value:function(f,d,S){var N=f.create(S,d.getDimension()),X=d.size();if(E.copy(d,0,N,0,X),X>0)for(var he=X;he<S;he++)E.copy(d,X-1,N,he,1);return N}},{key:"reverse",value:function(f){for(var d=f.size()-1,S=Math.trunc(d/2),N=0;N<=S;N++)E.swap(f,N,d-N)}},{key:"swap",value:function(f,d,S){if(d===S)return null;for(var N=0;N<f.getDimension();N++){var X=f.getOrdinate(d,N);f.setOrdinate(d,N,f.getOrdinate(S,N)),f.setOrdinate(S,N,X)}}},{key:"copy",value:function(f,d,S,N,X){for(var he=0;he<X;he++)E.copyCoord(f,d+he,S,N+he)}},{key:"ensureValidRing",value:function(f,d){var S=d.size();return S===0?d:S<=3?E.createClosedRing(f,d,4):d.getOrdinate(0,ir.X)===d.getOrdinate(S-1,ir.X)&&d.getOrdinate(0,ir.Y)===d.getOrdinate(S-1,ir.Y)?d:E.createClosedRing(f,d,S+1)}},{key:"indexOf",value:function(f,d){for(var S=0;S<d.size();S++)if(f.x===d.getOrdinate(S,ir.X)&&f.y===d.getOrdinate(S,ir.Y))return S;return-1}},{key:"createClosedRing",value:function(f,d,S){var N=f.create(S,d.getDimension()),X=d.size();E.copy(d,0,N,0,X);for(var he=X;he<S;he++)E.copy(d,0,N,he,1);return N}},{key:"minCoordinate",value:function(f){for(var d=null,S=0;S<f.size();S++){var N=f.getCoordinate(S);(d===null||d.compareTo(N)>0)&&(d=N)}return d}}])})(),Tt=(function(){function E(){a(this,E)}return y(E,null,[{key:"toDimensionSymbol",value:function(f){switch(f){case E.FALSE:return E.SYM_FALSE;case E.TRUE:return E.SYM_TRUE;case E.DONTCARE:return E.SYM_DONTCARE;case E.P:return E.SYM_P;case E.L:return E.SYM_L;case E.A:return E.SYM_A}throw new Pe("Unknown dimension value: "+f)}},{key:"toDimensionValue",value:function(f){switch($r.toUpperCase(f)){case E.SYM_FALSE:return E.FALSE;case E.SYM_TRUE:return E.TRUE;case E.SYM_DONTCARE:return E.DONTCARE;case E.SYM_P:return E.P;case E.SYM_L:return E.L;case E.SYM_A:return E.A}throw new Pe("Unknown dimension symbol: "+f)}}])})();Tt.P=0,Tt.L=1,Tt.A=2,Tt.FALSE=-1,Tt.TRUE=-2,Tt.DONTCARE=-3,Tt.SYM_FALSE="F",Tt.SYM_TRUE="T",Tt.SYM_DONTCARE="*",Tt.SYM_P="0",Tt.SYM_L="1",Tt.SYM_A="2";var Ot=(function(){return y((function E(){a(this,E)}),[{key:"filter",value:function(E){}}])})(),zt=(function(){return y((function E(){a(this,E)}),[{key:"filter",value:function(E,f){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}])})(),Pn=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new Zt:this._points.expandEnvelope(new Zt)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new f(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Xt){var d=arguments[0],S=arguments[1];if(!this.isEquivalentClass(d))return!1;var N=d;if(this._points.size()!==N._points.size())return!1;for(var X=0;X<this._points.size();X++)if(!this.equal(this._points.getCoordinate(X),N._points.getCoordinate(X),S))return!1;return!0}return Q(f,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var d=0;d<Math.trunc(this._points.size()/2);d++){var S=this._points.size()-1-d;if(!this._points.getCoordinate(d).equals(this._points.getCoordinate(S))){if(this._points.getCoordinate(d).compareTo(this._points.getCoordinate(S))>0){var N=this._points.copy();Gt.reverse(N),this._points=N}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?Tt.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var d=this._points.copy();return Gt.reverse(d),this.getFactory().createLineString(d)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return Xt.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return wt.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var d=arguments[0],S=0,N=0;S<this._points.size()&&N<d._points.size();){var X=this._points.getCoordinate(S).compareTo(d._points.getCoordinate(N));if(X!==0)return X;S++,N++}return S<this._points.size()?1:N<d._points.size()?-1:0}if(arguments.length===2){var he=arguments[0];return arguments[1].compare(this._points,he._points)}}},{key:"apply",value:function(){if(yn(arguments[0],ft))for(var d=arguments[0],S=0;S<this._points.size();S++)d.filter(this._points.getCoordinate(S));else if(yn(arguments[0],zt)){var N=arguments[0];if(this._points.size()===0)return null;for(var X=0;X<this._points.size()&&(N.filter(this._points,X),!N.isDone());X++);N.isGeometryChanged()&&this.geometryChanged()}else yn(arguments[0],Ot)?arguments[0].filter(this):yn(arguments[0],Be)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new mt}},{key:"isEquivalentClass",value:function(d){return d instanceof f}},{key:"getCoordinateN",value:function(d){return this._points.getCoordinate(d)}},{key:"getGeometryType",value:function(){return Xt.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(d){if(d===null&&(d=this.getFactory().getCoordinateSequenceFactory().create([])),d.size()===1)throw new Pe("Invalid number of points in LineString (found "+d.size()+" - must be 0 or >= 2)");this._points=d}},{key:"isCoordinate",value:function(d){for(var S=0;S<this._points.size();S++)if(this._points.getCoordinate(S).equals(d))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(d){return this.getFactory().createPoint(this._points.getCoordinate(d))}},{key:"interfaces_",get:function(){return[Ut]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var d=arguments[0],S=arguments[1];Xt.constructor_.call(this,S),this.init(d)}}}}])})(Xt),Jn=y((function E(){a(this,E)})),Fn=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new Zt;var d=new Zt;return d.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),d}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new f(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Xt){var d=arguments[0],S=arguments[1];return!!this.isEquivalentClass(d)&&(!(!this.isEmpty()||!d.isEmpty())||this.isEmpty()===d.isEmpty()&&this.equal(d.getCoordinate(),this.getCoordinate(),S))}return Q(f,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return Tt.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return Xt.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var d=arguments[0];return this.getCoordinate().compareTo(d.getCoordinate())}if(arguments.length===2){var S=arguments[0];return arguments[1].compare(this._coordinates,S._coordinates)}}},{key:"apply",value:function(){if(yn(arguments[0],ft)){var d=arguments[0];if(this.isEmpty())return null;d.filter(this.getCoordinate())}else if(yn(arguments[0],zt)){var S=arguments[0];if(this.isEmpty())return null;S.filter(this._coordinates,0),S.isGeometryChanged()&&this.geometryChanged()}else yn(arguments[0],Ot)?arguments[0].filter(this):yn(arguments[0],Be)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Xt.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(d){d===null&&(d=this.getFactory().getCoordinateSequenceFactory().create([])),Ve.isTrue(d.size()<=1),this._coordinates=d}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[Jn]}}],[{key:"constructor_",value:function(){this._coordinates=null;var d=arguments[0],S=arguments[1];Xt.constructor_.call(this,S),this.init(d)}}])})(Xt),Gr=(function(){function E(){a(this,E)}return y(E,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var f=arguments[0];return Math.abs(E.ofRingSigned(f))}if(yn(arguments[0],ir)){var d=arguments[0];return Math.abs(E.ofRingSigned(d))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var f=arguments[0];if(f.length<3)return 0;for(var d=0,S=f[0].x,N=1;N<f.length-1;N++){var X=f[N].x-S,he=f[N+1].y;d+=X*(f[N-1].y-he)}return d/2}if(yn(arguments[0],ir)){var Ae=arguments[0],Ye=Ae.size();if(Ye<3)return 0;var bt=new Oe,an=new Oe,mn=new Oe;Ae.getCoordinate(0,an),Ae.getCoordinate(1,mn);var Kn=an.x;mn.x-=Kn;for(var Pr=0,Yr=1;Yr<Ye-1;Yr++)bt.y=an.y,an.x=mn.x,an.y=mn.y,Ae.getCoordinate(Yr+1,mn),mn.x-=Kn,Pr+=an.x*(bt.y-mn.y);return Pr/2}}}])})(),Mr=(function(){return y((function E(){a(this,E)}),null,[{key:"sort",value:function(){var E=arguments,f=arguments[0];if(arguments.length===1)f.sort((function(Kn,Pr){return Kn.compareTo(Pr)}));else if(arguments.length===2)f.sort((function(Kn,Pr){return E[1].compare(Kn,Pr)}));else if(arguments.length===3){var d=f.slice(arguments[1],arguments[2]);d.sort();var S=f.slice(0,arguments[1]).concat(d,f.slice(arguments[2],f.length));f.splice(0,f.length);var N,X=s(S);try{for(X.s();!(N=X.n()).done;){var he=N.value;f.push(he)}}catch(Kn){X.e(Kn)}finally{X.f()}}else if(arguments.length===4){var Ae=f.slice(arguments[1],arguments[2]);Ae.sort((function(Kn,Pr){return E[3].compare(Kn,Pr)}));var Ye=f.slice(0,arguments[1]).concat(Ae,f.slice(arguments[2],f.length));f.splice(0,f.length);var bt,an=s(Ye);try{for(an.s();!(bt=an.n()).done;){var mn=bt.value;f.push(mn)}}catch(Kn){an.e(Kn)}finally{an.f()}}}},{key:"asList",value:function(E){var f,d=new or,S=s(E);try{for(S.s();!(f=S.n()).done;){var N=f.value;d.add(N)}}catch(X){S.e(X)}finally{S.f()}return d}},{key:"copyOf",value:function(E,f){return E.slice(0,f)}}])})(),Zr=y((function E(){a(this,E)})),Br=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var d=new Array(this.getNumPoints()).fill(null),S=-1,N=this._shell.getCoordinates(),X=0;X<N.length;X++)d[++S]=N[X];for(var he=0;he<this._holes.length;he++)for(var Ae=this._holes[he].getCoordinates(),Ye=0;Ye<Ae.length;Ye++)d[++S]=Ae[Ye];return d}},{key:"getArea",value:function(){var d=0;d+=Gr.ofRing(this._shell.getCoordinateSequence());for(var S=0;S<this._holes.length;S++)d-=Gr.ofRing(this._holes[S].getCoordinateSequence());return d}},{key:"copyInternal",value:function(){for(var d=this._shell.copy(),S=new Array(this._holes.length).fill(null),N=0;N<this._holes.length;N++)S[N]=this._holes[N].copy();return new f(d,S,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var d=this._shell.getCoordinateSequence(),S=this.getEnvelopeInternal(),N=0;N<5;N++){var X=d.getX(N);if(X!==S.getMinX()&&X!==S.getMaxX())return!1;var he=d.getY(N);if(he!==S.getMinY()&&he!==S.getMaxY())return!1}for(var Ae=d.getX(0),Ye=d.getY(0),bt=1;bt<=4;bt++){var an=d.getX(bt),mn=d.getY(bt);if(an!==Ae==(mn!==Ye))return!1;Ae=an,Ye=mn}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Xt){var d=arguments[0],S=arguments[1];if(!this.isEquivalentClass(d))return!1;var N=d,X=this._shell,he=N._shell;if(!X.equalsExact(he,S)||this._holes.length!==N._holes.length)return!1;for(var Ae=0;Ae<this._holes.length;Ae++)if(!this._holes[Ae].equalsExact(N._holes[Ae],S))return!1;return!0}return Q(f,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var d=0;d<this._holes.length;d++)this._holes[d]=this.normalized(this._holes[d],!1);Mr.sort(this._holes)}else if(arguments.length===2){var S=arguments[0],N=arguments[1];if(S.isEmpty())return null;var X=S.getCoordinateSequence(),he=Gt.minCoordinateIndex(X,0,X.size()-2);Gt.scroll(X,he,!0),Xn.isCCW(X)===N&&Gt.reverse(X)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var d=this.getExteriorRing().reverse(),S=new Array(this.getNumInteriorRing()).fill(null),N=0;N<S.length;N++)S[N]=this.getInteriorRingN(N).reverse();return this.getFactory().createPolygon(d,S)}},{key:"getTypeCode",value:function(){return Xt.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var d=0;d+=this._shell.getLength();for(var S=0;S<this._holes.length;S++)d+=this._holes[S].getLength();return d}},{key:"getNumPoints",value:function(){for(var d=this._shell.getNumPoints(),S=0;S<this._holes.length;S++)d+=this._holes[S].getNumPoints();return d}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(d,S){var N=d.copy();return this.normalize(N,S),N}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var d=arguments[0],S=this._shell,N=d._shell;return S.compareToSameClass(N)}if(arguments.length===2){var X=arguments[1],he=arguments[0],Ae=this._shell,Ye=he._shell,bt=Ae.compareToSameClass(Ye,X);if(bt!==0)return bt;for(var an=this.getNumInteriorRing(),mn=he.getNumInteriorRing(),Kn=0;Kn<an&&Kn<mn;){var Pr=this.getInteriorRingN(Kn),Yr=he.getInteriorRingN(Kn),yi=Pr.compareToSameClass(Yr,X);if(yi!==0)return yi;Kn++}return Kn<an?1:Kn<mn?-1:0}}},{key:"apply",value:function(){if(yn(arguments[0],ft)){var d=arguments[0];this._shell.apply(d);for(var S=0;S<this._holes.length;S++)this._holes[S].apply(d)}else if(yn(arguments[0],zt)){var N=arguments[0];if(this._shell.apply(N),!N.isDone())for(var X=0;X<this._holes.length&&(this._holes[X].apply(N),!N.isDone());X++);N.isGeometryChanged()&&this.geometryChanged()}else if(yn(arguments[0],Ot))arguments[0].filter(this);else if(yn(arguments[0],Be)){var he=arguments[0];he.filter(this),this._shell.apply(he);for(var Ae=0;Ae<this._holes.length;Ae++)this._holes[Ae].apply(he)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var d=new Array(this._holes.length+1).fill(null);d[0]=this._shell;for(var S=0;S<this._holes.length;S++)d[S+1]=this._holes[S];return d.length<=1?this.getFactory().createLinearRing(d[0].getCoordinateSequence()):this.getFactory().createMultiLineString(d)}},{key:"getGeometryType",value:function(){return Xt.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(d){return this._holes[d]}},{key:"interfaces_",get:function(){return[Zr]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var d=arguments[0],S=arguments[1],N=arguments[2];if(Xt.constructor_.call(this,N),d===null&&(d=this.getFactory().createLinearRing()),S===null&&(S=[]),Xt.hasNullElements(S))throw new Pe("holes must not contain null elements");if(d.isEmpty()&&Xt.hasNonEmptyElements(S))throw new Pe("shell is empty but holes are not");this._shell=d,this._holes=S}}])})(Xt),zi=(function(E){function f(){return a(this,f),i(this,f,arguments)}return R(f,E),y(f)})(Ir),ms=(function(E){function f(d){var S;return a(this,f),(S=i(this,f)).array=[],d instanceof zn&&S.addAll(d),S}return R(f,E),y(f,[{key:"contains",value:function(d){var S,N=s(this.array);try{for(N.s();!(S=N.n()).done;)if(S.value.compareTo(d)===0)return!0}catch(X){N.e(X)}finally{N.f()}return!1}},{key:"add",value:function(d){if(this.contains(d))return!1;for(var S=0,N=this.array.length;S<N;S++)if(this.array[S].compareTo(d)===1)return!!this.array.splice(S,0,d);return this.array.push(d),!0}},{key:"addAll",value:function(d){var S,N=s(d);try{for(N.s();!(S=N.n()).done;){var X=S.value;this.add(X)}}catch(he){N.e(he)}finally{N.f()}return!0}},{key:"remove",value:function(){throw new mt}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new Os(this.array)}}])})(zi),Os=(function(){return y((function E(f){a(this,E),this.array=f,this.position=0}),[{key:"next",value:function(){if(this.position===this.array.length)throw new on;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new mt}}])})(),cs=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"computeEnvelopeInternal",value:function(){for(var d=new Zt,S=0;S<this._geometries.length;S++)d.expandToInclude(this._geometries[S].getEnvelopeInternal());return d}},{key:"getGeometryN",value:function(d){return this._geometries[d]}},{key:"getCoordinates",value:function(){for(var d=new Array(this.getNumPoints()).fill(null),S=-1,N=0;N<this._geometries.length;N++)for(var X=this._geometries[N].getCoordinates(),he=0;he<X.length;he++)d[++S]=X[he];return d}},{key:"getArea",value:function(){for(var d=0,S=0;S<this._geometries.length;S++)d+=this._geometries[S].getArea();return d}},{key:"copyInternal",value:function(){for(var d=new Array(this._geometries.length).fill(null),S=0;S<d.length;S++)d[S]=this._geometries[S].copy();return new f(d,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Xt){var d=arguments[0],S=arguments[1];if(!this.isEquivalentClass(d))return!1;var N=d;if(this._geometries.length!==N._geometries.length)return!1;for(var X=0;X<this._geometries.length;X++)if(!this._geometries[X].equalsExact(N._geometries[X],S))return!1;return!0}return Q(f,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var d=0;d<this._geometries.length;d++)this._geometries[d].normalize();Mr.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var d=Tt.FALSE,S=0;S<this._geometries.length;S++)d=Math.max(d,this._geometries[S].getBoundaryDimension());return d}},{key:"reverseInternal",value:function(){for(var d=this._geometries.length,S=new or(d),N=0;N<d;N++)S.add(this._geometries[N].reverse());return this.getFactory().buildGeometry(S)}},{key:"getTypeCode",value:function(){return Xt.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var d=Tt.FALSE,S=0;S<this._geometries.length;S++)d=Math.max(d,this._geometries[S].getDimension());return d}},{key:"getLength",value:function(){for(var d=0,S=0;S<this._geometries.length;S++)d+=this._geometries[S].getLength();return d}},{key:"getNumPoints",value:function(){for(var d=0,S=0;S<this._geometries.length;S++)d+=this._geometries[S].getNumPoints();return d}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var d=arguments[0],S=new ms(Mr.asList(this._geometries)),N=new ms(Mr.asList(d._geometries));return this.compare(S,N)}if(arguments.length===2){for(var X=arguments[1],he=arguments[0],Ae=this.getNumGeometries(),Ye=he.getNumGeometries(),bt=0;bt<Ae&&bt<Ye;){var an=this.getGeometryN(bt),mn=he.getGeometryN(bt),Kn=an.compareToSameClass(mn,X);if(Kn!==0)return Kn;bt++}return bt<Ae?1:bt<Ye?-1:0}}},{key:"apply",value:function(){if(yn(arguments[0],ft))for(var d=arguments[0],S=0;S<this._geometries.length;S++)this._geometries[S].apply(d);else if(yn(arguments[0],zt)){var N=arguments[0];if(this._geometries.length===0)return null;for(var X=0;X<this._geometries.length&&(this._geometries[X].apply(N),!N.isDone());X++);N.isGeometryChanged()&&this.geometryChanged()}else if(yn(arguments[0],Ot)){var he=arguments[0];he.filter(this);for(var Ae=0;Ae<this._geometries.length;Ae++)this._geometries[Ae].apply(he)}else if(yn(arguments[0],Be)){var Ye=arguments[0];Ye.filter(this);for(var bt=0;bt<this._geometries.length;bt++)this._geometries[bt].apply(Ye)}}},{key:"getBoundary",value:function(){return Xt.checkNotGeometryCollection(this),Ve.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return Xt.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var d=0;d<this._geometries.length;d++)if(!this._geometries[d].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var d=arguments[0],S=arguments[1];if(Xt.constructor_.call(this,S),d===null&&(d=[]),Xt.hasNullElements(d))throw new Pe("geometries must not contain null elements");this._geometries=d}}}}])})(Xt),ps=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"copyInternal",value:function(){for(var d=new Array(this._geometries.length).fill(null),S=0;S<d.length;S++)d[S]=this._geometries[S].copy();return new f(d,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Xt){var d=arguments[0],S=arguments[1];return!!this.isEquivalentClass(d)&&Q(f,"equalsExact",this,1).call(this,d,S)}return Q(f,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var d=arguments[0];return this._geometries[d].getCoordinate()}return Q(f,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return Tt.FALSE}},{key:"getTypeCode",value:function(){return Xt.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Xt.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[Jn]}}],[{key:"constructor_",value:function(){var d=arguments[0],S=arguments[1];cs.constructor_.call(this,d,S)}}])})(cs),vo=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"copyInternal",value:function(){return new f(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return Tt.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||Q(f,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var d=this._points.copy();return Gt.reverse(d),this.getFactory().createLinearRing(d)}},{key:"getTypeCode",value:function(){return Xt.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!Q(f,"isClosed",this,1).call(this))throw new Pe("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<f.MINIMUM_VALID_SIZE)throw new Pe("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return Xt.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var d=arguments[0],S=arguments[1];Pn.constructor_.call(this,d,S),this.validateConstruction()}}])})(Pn);vo.MINIMUM_VALID_SIZE=4;var is=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"setOrdinate",value:function(d,S){switch(d){case f.X:this.x=S;break;case f.Y:this.y=S;break;default:throw new Pe("Invalid ordinate index: "+d)}}},{key:"getZ",value:function(){return Oe.NULL_ORDINATE}},{key:"getOrdinate",value:function(d){switch(d){case f.X:return this.x;case f.Y:return this.y}throw new Pe("Invalid ordinate index: "+d)}},{key:"setZ",value:function(d){throw new Pe("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new f(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(d){this.x=d.x,this.y=d.y,this.z=d.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)Oe.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof f){var d=arguments[0];Oe.constructor_.call(this,d.x,d.y)}else if(arguments[0]instanceof Oe){var S=arguments[0];Oe.constructor_.call(this,S.x,S.y)}}else if(arguments.length===2){var N=arguments[0],X=arguments[1];Oe.constructor_.call(this,N,X,Oe.NULL_ORDINATE)}}}])})(Oe);is.X=0,is.Y=1,is.Z=-1,is.M=-1;var xo=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(d,S){switch(d){case f.X:this.x=S;break;case f.Y:this.y=S;break;case f.M:this._m=S;break;default:throw new Pe("Invalid ordinate index: "+d)}}},{key:"setM",value:function(d){this._m=d}},{key:"getZ",value:function(){return Oe.NULL_ORDINATE}},{key:"getOrdinate",value:function(d){switch(d){case f.X:return this.x;case f.Y:return this.y;case f.M:return this._m}throw new Pe("Invalid ordinate index: "+d)}},{key:"setZ",value:function(d){throw new Pe("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new f(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(d){this.x=d.x,this.y=d.y,this.z=d.getZ(),this._m=d.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Oe.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof f){var d=arguments[0];Oe.constructor_.call(this,d.x,d.y),this._m=d._m}else if(arguments[0]instanceof Oe){var S=arguments[0];Oe.constructor_.call(this,S.x,S.y),this._m=this.getM()}}else if(arguments.length===3){var N=arguments[0],X=arguments[1],he=arguments[2];Oe.constructor_.call(this,N,X,Oe.NULL_ORDINATE),this._m=he}}}])})(Oe);xo.X=0,xo.Y=1,xo.Z=-1,xo.M=2;var ua=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(d,S){switch(d){case Oe.X:this.x=S;break;case Oe.Y:this.y=S;break;case Oe.Z:this.z=S;break;case Oe.M:this._m=S;break;default:throw new Pe("Invalid ordinate index: "+d)}}},{key:"setM",value:function(d){this._m=d}},{key:"getOrdinate",value:function(d){switch(d){case Oe.X:return this.x;case Oe.Y:return this.y;case Oe.Z:return this.getZ();case Oe.M:return this.getM()}throw new Pe("Invalid ordinate index: "+d)}},{key:"copy",value:function(){return new f(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(d){this.x=d.x,this.y=d.y,this.z=d.getZ(),this._m=d.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Oe.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof f){var d=arguments[0];Oe.constructor_.call(this,d),this._m=d._m}else if(arguments[0]instanceof Oe){var S=arguments[0];Oe.constructor_.call(this,S),this._m=this.getM()}}else if(arguments.length===4){var N=arguments[0],X=arguments[1],he=arguments[2],Ae=arguments[3];Oe.constructor_.call(this,N,X,he),this._m=Ae}}}])})(Oe),tl=(function(){function E(){a(this,E)}return y(E,null,[{key:"measures",value:function(f){return f instanceof is?0:f instanceof xo||f instanceof ua?1:0}},{key:"dimension",value:function(f){return f instanceof is?2:f instanceof xo?3:f instanceof ua?4:3}},{key:"create",value:function(){if(arguments.length===1){var f=arguments[0];return E.create(f,0)}if(arguments.length===2){var d=arguments[0],S=arguments[1];return d===2?new is:d===3&&S===0?new Oe:d===3&&S===1?new xo:d===4&&S===1?new ua:new Oe}}}])})(),Pa=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"getCoordinate",value:function(d){return this.get(d)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&yn(arguments[0],zn)){for(var d=arguments[1],S=!1,N=arguments[0].iterator();N.hasNext();)this.add(N.next(),d),S=!0;return S}return Q(f,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var d=Q(f,"clone",this,1).call(this),S=0;S<this.size();S++)d.add(S,this.get(S).clone());return d}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(f.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(f.coordArrayType);for(var d=this.size(),S=new Array(d).fill(null),N=0;N<d;N++)S[N]=this.get(d-N-1);return S}}},{key:"add",value:function(){if(arguments.length===1){var d=arguments[0];return Q(f,"add",this,1).call(this,d)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var S=arguments[0],N=arguments[1];return this.add(S,N,!0),!0}if(arguments[0]instanceof Oe&&typeof arguments[1]=="boolean"){var X=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(X))return null;Q(f,"add",this,1).call(this,X)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var he=arguments[0],Ae=arguments[1];return this.add(he,Ae),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var Ye=arguments[0],bt=arguments[1];if(arguments[2])for(var an=0;an<Ye.length;an++)this.add(Ye[an],bt);else for(var mn=Ye.length-1;mn>=0;mn--)this.add(Ye[mn],bt);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Oe){var Kn=arguments[0],Pr=arguments[1];if(!arguments[2]){var Yr=this.size();if(Yr>0&&(Kn>0&&this.get(Kn-1).equals2D(Pr)||Kn<Yr&&this.get(Kn).equals2D(Pr)))return null}Q(f,"add",this,1).call(this,Kn,Pr)}}else if(arguments.length===4){var yi=arguments[0],Ms=arguments[1],Xi=arguments[2],Ds=arguments[3],As=1;Xi>Ds&&(As=-1);for(var Xo=Xi;Xo!==Ds;Xo+=As)this.add(yi[Xo],Ms);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var d=this.get(0).copy();this.add(d,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var d=arguments[0];this.ensureCapacity(d.length),this.add(d,!0)}else if(arguments.length===2){var S=arguments[0],N=arguments[1];this.ensureCapacity(S.length),this.add(S,N)}}}}])})(or);Pa.coordArrayType=new Array(0).fill(null);var di=(function(){function E(){a(this,E)}return y(E,null,[{key:"isRing",value:function(f){return!(f.length<4)&&!!f[0].equals2D(f[f.length-1])}},{key:"ptNotInList",value:function(f,d){for(var S=0;S<f.length;S++){var N=f[S];if(E.indexOf(N,d)<0)return N}return null}},{key:"scroll",value:function(f,d){var S=E.indexOf(d,f);if(S<0)return null;var N=new Array(f.length).fill(null);si.arraycopy(f,S,N,0,f.length-S),si.arraycopy(f,0,N,f.length-S,S),si.arraycopy(N,0,f,0,f.length)}},{key:"equals",value:function(){if(arguments.length===2){var f=arguments[0],d=arguments[1];if(f===d)return!0;if(f===null||d===null||f.length!==d.length)return!1;for(var S=0;S<f.length;S++)if(!f[S].equals(d[S]))return!1;return!0}if(arguments.length===3){var N=arguments[0],X=arguments[1],he=arguments[2];if(N===X)return!0;if(N===null||X===null||N.length!==X.length)return!1;for(var Ae=0;Ae<N.length;Ae++)if(he.compare(N[Ae],X[Ae])!==0)return!1;return!0}}},{key:"intersection",value:function(f,d){for(var S=new Pa,N=0;N<f.length;N++)d.intersects(f[N])&&S.add(f[N],!0);return S.toCoordinateArray()}},{key:"measures",value:function(f){if(f===null||f.length===0)return 0;var d,S=0,N=s(f);try{for(N.s();!(d=N.n()).done;){var X=d.value;S=Math.max(S,tl.measures(X))}}catch(he){N.e(he)}finally{N.f()}return S}},{key:"hasRepeatedPoints",value:function(f){for(var d=1;d<f.length;d++)if(f[d-1].equals(f[d]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(f){return E.hasRepeatedPoints(f)?new Pa(f,!1).toCoordinateArray():f}},{key:"reverse",value:function(f){for(var d=f.length-1,S=Math.trunc(d/2),N=0;N<=S;N++){var X=f[N];f[N]=f[d-N],f[d-N]=X}}},{key:"removeNull",value:function(f){for(var d=0,S=0;S<f.length;S++)f[S]!==null&&d++;var N=new Array(d).fill(null);if(d===0)return N;for(var X=0,he=0;he<f.length;he++)f[he]!==null&&(N[X++]=f[he]);return N}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var f=arguments[0],d=new Array(f.length).fill(null),S=0;S<f.length;S++)d[S]=f[S].copy();return d}if(arguments.length===5)for(var N=arguments[0],X=arguments[1],he=arguments[2],Ae=arguments[3],Ye=arguments[4],bt=0;bt<Ye;bt++)he[Ae+bt]=N[X+bt].copy()}},{key:"isEqualReversed",value:function(f,d){for(var S=0;S<f.length;S++){var N=f[S],X=d[f.length-S-1];if(N.compareTo(X)!==0)return!1}return!0}},{key:"envelope",value:function(f){for(var d=new Zt,S=0;S<f.length;S++)d.expandToInclude(f[S]);return d}},{key:"toCoordinateArray",value:function(f){return f.toArray(E.coordArrayType)}},{key:"dimension",value:function(f){if(f===null||f.length===0)return 3;var d,S=0,N=s(f);try{for(N.s();!(d=N.n()).done;){var X=d.value;S=Math.max(S,tl.dimension(X))}}catch(he){N.e(he)}finally{N.f()}return S}},{key:"atLeastNCoordinatesOrNothing",value:function(f,d){return d.length>=f?d:[]}},{key:"indexOf",value:function(f,d){for(var S=0;S<d.length;S++)if(f.equals(d[S]))return S;return-1}},{key:"increasingDirection",value:function(f){for(var d=0;d<Math.trunc(f.length/2);d++){var S=f.length-1-d,N=f[d].compareTo(f[S]);if(N!==0)return N}return 1}},{key:"compare",value:function(f,d){for(var S=0;S<f.length&&S<d.length;){var N=f[S].compareTo(d[S]);if(N!==0)return N;S++}return S<d.length?-1:S<f.length?1:0}},{key:"minCoordinate",value:function(f){for(var d=null,S=0;S<f.length;S++)(d===null||d.compareTo(f[S])>0)&&(d=f[S]);return d}},{key:"extract",value:function(f,d,S){d=vt.clamp(d,0,f.length);var N=(S=vt.clamp(S,-1,f.length))-d+1;S<0&&(N=0),d>=f.length&&(N=0),S<d&&(N=0);var X=new Array(N).fill(null);if(N===0)return X;for(var he=0,Ae=d;Ae<=S;Ae++)X[he++]=f[Ae];return X}}])})(),ou=(function(){return y((function E(){a(this,E)}),[{key:"compare",value:function(E,f){var d=E,S=f;return di.compare(d,S)}},{key:"interfaces_",get:function(){return[Ce]}}])})(),yc=(function(){return y((function E(){a(this,E)}),[{key:"compare",value:function(E,f){var d=E,S=f;if(d.length<S.length)return-1;if(d.length>S.length)return 1;if(d.length===0)return 0;var N=di.compare(d,S);return di.isEqualReversed(d,S)?0:N}},{key:"OLDcompare",value:function(E,f){var d=E,S=f;if(d.length<S.length)return-1;if(d.length>S.length)return 1;if(d.length===0)return 0;for(var N=di.increasingDirection(d),X=di.increasingDirection(S),he=N>0?0:d.length-1,Ae=X>0?0:d.length-1,Ye=0;Ye<d.length;Ye++){var bt=d[he].compareTo(S[Ae]);if(bt!==0)return bt;he+=N,Ae+=X}return 0}},{key:"interfaces_",get:function(){return[Ce]}}])})();di.ForwardComparator=ou,di.BidirectionalComparator=yc,di.coordArrayType=new Array(0).fill(null);var Ss=(function(){return y((function E(f){a(this,E),this.str=f}),[{key:"append",value:function(E){this.str+=E}},{key:"setCharAt",value:function(E,f){this.str=this.str.substr(0,E)+f+this.str.substr(E+1)}},{key:"toString",value:function(){return this.str}}])})(),au=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"getM",value:function(f){return this.hasM()?this._coordinates[f].getM():Ke.NaN}},{key:"setOrdinate",value:function(f,d,S){switch(d){case ir.X:this._coordinates[f].x=S;break;case ir.Y:this._coordinates[f].y=S;break;default:this._coordinates[f].setOrdinate(d,S)}}},{key:"getZ",value:function(f){return this.hasZ()?this._coordinates[f].getZ():Ke.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(f,d){switch(d){case ir.X:return this._coordinates[f].x;case ir.Y:return this._coordinates[f].y;default:return this._coordinates[f].getOrdinate(d)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var f=arguments[0];return this._coordinates[f]}if(arguments.length===2){var d=arguments[0];arguments[1].setCoordinate(this._coordinates[d])}}},{key:"getCoordinateCopy",value:function(f){var d=this.createCoordinate();return d.setCoordinate(this._coordinates[f]),d}},{key:"createCoordinate",value:function(){return tl.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(f){return this._coordinates[f].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(f){for(var d=0;d<this._coordinates.length;d++)f.expandToInclude(this._coordinates[d]);return f}},{key:"copy",value:function(){for(var f=new Array(this.size()).fill(null),d=0;d<this._coordinates.length;d++){var S=this.createCoordinate();S.setCoordinate(this._coordinates[d]),f[d]=S}return new E(f,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var f=new Ss(17*this._coordinates.length);f.append("("),f.append(this._coordinates[0]);for(var d=1;d<this._coordinates.length;d++)f.append(", "),f.append(this._coordinates[d]);return f.append(")"),f.toString()}return"()"}},{key:"getY",value:function(f){return this._coordinates[f].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[ir,B]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var f=arguments[0];E.constructor_.call(this,f,di.dimension(f),di.measures(f))}else if(Number.isInteger(arguments[0])){var d=arguments[0];this._coordinates=new Array(d).fill(null);for(var S=0;S<d;S++)this._coordinates[S]=new Oe}else if(yn(arguments[0],ir)){var N=arguments[0];if(N===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=N.getDimension(),this._measures=N.getMeasures(),this._coordinates=new Array(N.size()).fill(null);for(var X=0;X<this._coordinates.length;X++)this._coordinates[X]=N.getCoordinateCopy(X)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var he=arguments[0],Ae=arguments[1];E.constructor_.call(this,he,Ae,di.measures(he))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Ye=arguments[0],bt=arguments[1];this._coordinates=new Array(Ye).fill(null),this._dimension=bt;for(var an=0;an<Ye;an++)this._coordinates[an]=tl.create(bt)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var mn=arguments[0],Kn=arguments[1],Pr=arguments[2];this._dimension=Kn,this._measures=Pr,this._coordinates=mn===null?new Array(0).fill(null):mn}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Yr=arguments[0],yi=arguments[1],Ms=arguments[2];this._coordinates=new Array(Yr).fill(null),this._dimension=yi,this._measures=Ms;for(var Xi=0;Xi<Yr;Xi++)this._coordinates[Xi]=this.createCoordinate()}}}}])})(),ga=(function(){function E(){a(this,E)}return y(E,[{key:"readResolve",value:function(){return E.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array)return new au(arguments[0]);if(yn(arguments[0],ir))return new au(arguments[0])}else{if(arguments.length===2){var f=arguments[1];return f>3&&(f=3),f<2&&(f=2),new au(arguments[0],f)}if(arguments.length===3){var d=arguments[2],S=arguments[1]-d;return d>1&&(d=1),S>3&&(S=3),S<2&&(S=2),new au(arguments[0],S+d,d)}}}},{key:"interfaces_",get:function(){return[ze,B]}}],[{key:"instance",value:function(){return E.instanceObject}}])})();ga.instanceObject=new ga;var uo=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"copyInternal",value:function(){for(var d=new Array(this._geometries.length).fill(null),S=0;S<d.length;S++)d[S]=this._geometries[S].copy();return new f(d,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Xt){var d=arguments[0],S=arguments[1];return!!this.isEquivalentClass(d)&&Q(f,"equalsExact",this,1).call(this,d,S)}return Q(f,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return Xt.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var d=new or,S=0;S<this._geometries.length;S++)for(var N=this._geometries[S].getBoundary(),X=0;X<N.getNumGeometries();X++)d.add(N.getGeometryN(X));var he=new Array(d.size()).fill(null);return this.getFactory().createMultiLineString(d.toArray(he))}},{key:"getGeometryType",value:function(){return Xt.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Zr]}}],[{key:"constructor_",value:function(){var d=arguments[0],S=arguments[1];cs.constructor_.call(this,d,S)}}])})(cs),nl=(function(){return y((function E(){a(this,E)}),[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}])})(),Kl=(function(E){function f(){var d;return a(this,f),(d=i(this,f)).map=new Map,d}return R(f,E),y(f,[{key:"get",value:function(d){return this.map.get(d)||null}},{key:"put",value:function(d,S){return this.map.set(d,S),S}},{key:"values",value:function(){for(var d=new or,S=this.map.values(),N=S.next();!N.done;)d.add(N.value),N=S.next();return d}},{key:"entrySet",value:function(){var d=new Fr;return this.map.entries().forEach((function(S){return d.add(S)})),d}},{key:"size",value:function(){return this.map.size()}}])})(nl),ea=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"equals",value:function(f){if(!(f instanceof E))return!1;var d=f;return this._modelType===d._modelType&&this._scale===d._scale}},{key:"compareTo",value:function(f){var d=f,S=this.getMaximumSignificantDigits(),N=d.getMaximumSignificantDigits();return Zn.compare(S,N)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===E.FLOATING||this._modelType===E.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var f="UNKNOWN";return this._modelType===E.FLOATING?f="Floating":this._modelType===E.FLOATING_SINGLE?f="Floating-Single":this._modelType===E.FIXED&&(f="Fixed (Scale="+this.getScale()+")"),f}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var f=arguments[0];return Ke.isNaN(f)||this._modelType===E.FLOATING_SINGLE?f:this._modelType===E.FIXED?Math.round(f*this._scale)/this._scale:f}if(arguments[0]instanceof Oe){var d=arguments[0];if(this._modelType===E.FLOATING)return null;d.x=this.makePrecise(d.x),d.y=this.makePrecise(d.y)}}},{key:"getMaximumSignificantDigits",value:function(){var f=16;return this._modelType===E.FLOATING?f=16:this._modelType===E.FLOATING_SINGLE?f=6:this._modelType===E.FIXED&&(f=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),f}},{key:"setScale",value:function(f){this._scale=Math.abs(f)}},{key:"interfaces_",get:function(){return[B,_e]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=E.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Wo){var f=arguments[0];this._modelType=f,f===E.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var d=arguments[0];this._modelType=E.FIXED,this.setScale(d)}else if(arguments[0]instanceof E){var S=arguments[0];this._modelType=S._modelType,this._scale=S._scale}}}},{key:"mostPrecise",value:function(f,d){return f.compareTo(d)>=0?f:d}}])})(),Wo=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"readResolve",value:function(){return E.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[B]}}],[{key:"constructor_",value:function(){this._name=null;var f=arguments[0];this._name=f,E.nameToTypeMap.put(f,this)}}])})();Wo.nameToTypeMap=new Kl,ea.Type=Wo,ea.FIXED=new Wo("FIXED"),ea.FLOATING=new Wo("FLOATING"),ea.FLOATING_SINGLE=new Wo("FLOATING SINGLE"),ea.maximumPreciseValue=9007199254740992;var ta=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"copyInternal",value:function(){for(var d=new Array(this._geometries.length).fill(null),S=0;S<d.length;S++)d[S]=this._geometries[S].copy();return new f(d,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Xt){var d=arguments[0],S=arguments[1];return!!this.isEquivalentClass(d)&&Q(f,"equalsExact",this,1).call(this,d,S)}return Q(f,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?Tt.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var d=0;d<this._geometries.length;d++)if(!this._geometries[d].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return Xt.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new mt}},{key:"getGeometryType",value:function(){return Xt.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[Ut]}}],[{key:"constructor_",value:function(){var d=arguments[0],S=arguments[1];cs.constructor_.call(this,d,S)}}])})(cs),En=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"createEmpty",value:function(f){switch(f){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new Pe("Invalid dimension: "+f)}}},{key:"toGeometry",value:function(f){return f.isNull()?this.createPoint():f.getMinX()===f.getMaxX()&&f.getMinY()===f.getMaxY()?this.createPoint(new Oe(f.getMinX(),f.getMinY())):f.getMinX()===f.getMaxX()||f.getMinY()===f.getMaxY()?this.createLineString([new Oe(f.getMinX(),f.getMinY()),new Oe(f.getMaxX(),f.getMaxY())]):this.createPolygon(this.createLinearRing([new Oe(f.getMinX(),f.getMinY()),new Oe(f.getMinX(),f.getMaxY()),new Oe(f.getMaxX(),f.getMaxY()),new Oe(f.getMaxX(),f.getMinY()),new Oe(f.getMinX(),f.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var f=arguments[0];return this.createLineString(f!==null?this.getCoordinateSequenceFactory().create(f):null)}if(yn(arguments[0],ir))return new Pn(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return arguments.length===0?new ta(null,this):arguments.length===1?new ta(arguments[0],this):void 0}},{key:"buildGeometry",value:function(f){for(var d=null,S=!1,N=!1,X=f.iterator();X.hasNext();){var he=X.next(),Ae=he.getTypeCode();d===null&&(d=Ae),Ae!==d&&(S=!0),he instanceof cs&&(N=!0)}if(d===null)return this.createGeometryCollection();if(S||N)return this.createGeometryCollection(E.toGeometryArray(f));var Ye=f.iterator().next();if(f.size()>1){if(Ye instanceof Br)return this.createMultiPolygon(E.toPolygonArray(f));if(Ye instanceof Pn)return this.createMultiLineString(E.toLineStringArray(f));if(Ye instanceof Fn)return this.createMultiPoint(E.toPointArray(f));Ve.shouldNeverReachHere("Unhandled geometry type: "+Ye.getGeometryType())}return Ye}},{key:"createMultiPointFromCoords",value:function(f){return this.createMultiPoint(f!==null?this.getCoordinateSequenceFactory().create(f):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Oe){var f=arguments[0];return this.createPoint(f!==null?this.getCoordinateSequenceFactory().create([f]):null)}if(yn(arguments[0],ir))return new Fn(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(yn(arguments[0],ir)){var f=arguments[0];return this.createPolygon(this.createLinearRing(f))}if(arguments[0]instanceof Array){var d=arguments[0];return this.createPolygon(this.createLinearRing(d))}if(arguments[0]instanceof vo){var S=arguments[0];return this.createPolygon(S,null)}}else if(arguments.length===2)return new Br(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return arguments.length===0?new cs(null,this):arguments.length===1?new cs(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var f=arguments[0];return this.createLinearRing(f!==null?this.getCoordinateSequenceFactory().create(f):null)}if(yn(arguments[0],ir))return new vo(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return arguments.length===0?new uo(null,this):arguments.length===1?new uo(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new ps(null,this);if(arguments.length===1){if(arguments[0]instanceof Array)return new ps(arguments[0],this);if(yn(arguments[0],ir)){var f=arguments[0];if(f===null)return this.createMultiPoint(new Array(0).fill(null));for(var d=new Array(f.size()).fill(null),S=0;S<f.size();S++){var N=this.getCoordinateSequenceFactory().create(1,f.getDimension(),f.getMeasures());Gt.copy(f,S,N,0,1),d[S]=this.createPoint(N)}return this.createMultiPoint(d)}}}},{key:"interfaces_",get:function(){return[B]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)E.constructor_.call(this,new ea,0);else if(arguments.length===1){if(yn(arguments[0],ze)){var f=arguments[0];E.constructor_.call(this,new ea,0,f)}else if(arguments[0]instanceof ea){var d=arguments[0];E.constructor_.call(this,d,0,E.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var S=arguments[0],N=arguments[1];E.constructor_.call(this,S,N,E.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var X=arguments[0],he=arguments[1],Ae=arguments[2];this._precisionModel=X,this._coordinateSequenceFactory=Ae,this._SRID=he}}},{key:"toMultiPolygonArray",value:function(f){var d=new Array(f.size()).fill(null);return f.toArray(d)}},{key:"toGeometryArray",value:function(f){if(f===null)return null;var d=new Array(f.size()).fill(null);return f.toArray(d)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return ga.instance()}},{key:"toMultiLineStringArray",value:function(f){var d=new Array(f.size()).fill(null);return f.toArray(d)}},{key:"toLineStringArray",value:function(f){var d=new Array(f.size()).fill(null);return f.toArray(d)}},{key:"toMultiPointArray",value:function(f){var d=new Array(f.size()).fill(null);return f.toArray(d)}},{key:"toLinearRingArray",value:function(f){var d=new Array(f.size()).fill(null);return f.toArray(d)}},{key:"toPointArray",value:function(f){var d=new Array(f.size()).fill(null);return f.toArray(d)}},{key:"toPolygonArray",value:function(f){var d=new Array(f.size()).fill(null);return f.toArray(d)}},{key:"createPointFromInternalCoord",value:function(f,d){return d.getPrecisionModel().makePrecise(f),d.getFactory().createPoint(f)}}])})(),co="XY",Io="XYZ",Ni="XYM",ic="XYZM",rl={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},il="EMPTY",Ga=1,ho=2,lr=3,Wr=4,Ur=5,ca=6;for(var $a in rl)rl[$a].toUpperCase();var Ri=(function(){return y((function E(f){a(this,E),this.wkt=f,this.index_=-1}),[{key:"isAlpha_",value:function(E){return E>="a"&&E<="z"||E>="A"&&E<="Z"}},{key:"isNumeric_",value:function(E,f){return E>="0"&&E<="9"||E=="."&&!(f!==void 0&&f)}},{key:"isWhiteSpace_",value:function(E){return E==" "||E=="	"||E=="\r"||E==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var E,f=this.nextChar_(),d=this.index_,S=f;if(f=="(")E=ho;else if(f==",")E=Ur;else if(f==")")E=lr;else if(this.isNumeric_(f)||f=="-")E=Wr,S=this.readNumber_();else if(this.isAlpha_(f))E=Ga,S=this.readText_();else{if(this.isWhiteSpace_(f))return this.nextToken();if(f!=="")throw new Error("Unexpected character: "+f);E=ca}return{position:d,value:S,type:E}}},{key:"readNumber_",value:function(){var E,f=this.index_,d=!1,S=!1;do E=="."?d=!0:E!="e"&&E!="E"||(S=!0),E=this.nextChar_();while(this.isNumeric_(E,d)||!S&&(E=="e"||E=="E")||S&&(E=="-"||E=="+"));return parseFloat(this.wkt.substring(f,this.index_--))}},{key:"readText_",value:function(){var E,f=this.index_;do E=this.nextChar_();while(this.isAlpha_(E));return this.wkt.substring(f,this.index_--).toUpperCase()}}])})(),Hi=(function(){return y((function E(f,d){a(this,E),this.lexer_=f,this.token_,this.layout_=co,this.factory=d}),[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(E){return this.token_.type==E}},{key:"match",value:function(E){var f=this.isTokenType(E);return f&&this.consume_(),f}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var E=co,f=this.token_;if(this.isTokenType(Ga)){var d=f.value;d==="Z"?E=Io:d==="M"?E=Ni:d==="ZM"&&(E=ic),E!==co&&this.consume_()}return E}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(ho)){var E=[];do E.push(this.parseGeometry_());while(this.match(Ur));if(this.match(lr))return E}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(ho)){var E=this.parsePoint_();if(this.match(lr))return E}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(ho)){var E=this.parsePointList_();if(this.match(lr))return E}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(ho)){var E=this.parseLineStringTextList_();if(this.match(lr))return E}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var E;if(this.match(ho)){if(E=this.token_.type==ho?this.parsePointTextList_():this.parsePointList_(),this.match(lr))return E}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(ho)){var E=this.parseLineStringTextList_();if(this.match(lr))return E}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(ho)){var E=this.parsePolygonTextList_();if(this.match(lr))return E}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var E=[],f=this.layout_.length,d=0;d<f;++d){var S=this.token_;if(!this.match(Wr))break;E.push(S.value)}if(E.length==f)return E;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var E=[this.parsePoint_()];this.match(Ur);)E.push(this.parsePoint_());return E}},{key:"parsePointTextList_",value:function(){for(var E=[this.parsePointText_()];this.match(Ur);)E.push(this.parsePointText_());return E}},{key:"parseLineStringTextList_",value:function(){for(var E=[this.parseLineStringText_()];this.match(Ur);)E.push(this.parseLineStringText_());return E}},{key:"parsePolygonTextList_",value:function(){for(var E=[this.parsePolygonText_()];this.match(Ur);)E.push(this.parsePolygonText_());return E}},{key:"isEmptyGeometry_",value:function(){var E=this.isTokenType(Ga)&&this.token_.value==il;return E&&this.consume_(),E}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var E=this.factory,f=function(yi){return c(Oe,ae(yi))},d=function(yi){var Ms=yi.map((function(Xi){return E.createLinearRing(Xi.map(f))}));return Ms.length>1?E.createPolygon(Ms[0],Ms.slice(1)):E.createPolygon(Ms[0])},S=this.token_;if(this.match(Ga)){var N=S.value;if(this.layout_=this.parseGeometryLayout_(),N=="GEOMETRYCOLLECTION"){var X=this.parseGeometryCollectionText_();return E.createGeometryCollection(X)}switch(N){case"POINT":var he=this.parsePointText_();return he?E.createPoint(c(Oe,ae(he))):E.createPoint();case"LINESTRING":var Ae=this.parseLineStringText_().map(f);return E.createLineString(Ae);case"LINEARRING":var Ye=this.parseLineStringText_().map(f);return E.createLinearRing(Ye);case"POLYGON":var bt=this.parsePolygonText_();return bt&&bt.length!==0?d(bt):E.createPolygon();case"MULTIPOINT":var an=this.parseMultiPointText_();if(!an||an.length===0)return E.createMultiPoint();var mn=an.map(f).map((function(yi){return E.createPoint(yi)}));return E.createMultiPoint(mn);case"MULTILINESTRING":var Kn=this.parseMultiLineStringText_().map((function(yi){return E.createLineString(yi.map(f))}));return E.createMultiLineString(Kn);case"MULTIPOLYGON":var Pr=this.parseMultiPolygonText_();if(!Pr||Pr.length===0)return E.createMultiPolygon();var Yr=Pr.map(d);return E.createMultiPolygon(Yr);default:throw new Error("Invalid geometry type: "+N)}}throw new Error(this.formatErrorMessage_())}}])})();function Tl(E){if(E.isEmpty())return"";var f=E.getCoordinate(),d=[f.x,f.y];return f.z===void 0||Number.isNaN(f.z)||d.push(f.z),f.m===void 0||Number.isNaN(f.m)||d.push(f.m),d.join(" ")}function Wi(E){for(var f=E.getCoordinates().map((function(X){var he=[X.x,X.y];return X.z===void 0||Number.isNaN(X.z)||he.push(X.z),X.m===void 0||Number.isNaN(X.m)||he.push(X.m),he})),d=[],S=0,N=f.length;S<N;++S)d.push(f[S].join(" "));return d.join(", ")}function ko(E){var f=[];f.push("("+Wi(E.getExteriorRing())+")");for(var d=0,S=E.getNumInteriorRing();d<S;++d)f.push("("+Wi(E.getInteriorRingN(d))+")");return f.join(", ")}var ss={Point:Tl,LineString:Wi,LinearRing:Wi,Polygon:ko,MultiPoint:function(E){for(var f=[],d=0,S=E.getNumGeometries();d<S;++d)f.push("("+Tl(E.getGeometryN(d))+")");return f.join(", ")},MultiLineString:function(E){for(var f=[],d=0,S=E.getNumGeometries();d<S;++d)f.push("("+Wi(E.getGeometryN(d))+")");return f.join(", ")},MultiPolygon:function(E){for(var f=[],d=0,S=E.getNumGeometries();d<S;++d)f.push("("+ko(E.getGeometryN(d))+")");return f.join(", ")},GeometryCollection:function(E){for(var f=[],d=0,S=E.getNumGeometries();d<S;++d)f.push($u(E.getGeometryN(d)));return f.join(", ")}};function $u(E){var f=E.getGeometryType(),d=ss[f];f=f.toUpperCase();var S=(function(N){var X="";if(N.isEmpty())return X;var he=N.getCoordinate();return he.z===void 0||Number.isNaN(he.z)||(X+="Z"),he.m===void 0||Number.isNaN(he.m)||(X+="M"),X})(E);return S.length>0&&(f+=" "+S),E.isEmpty()?f+" "+il:f+" ("+d(E)+")"}var lu=(function(){return y((function E(f){a(this,E),this.geometryFactory=f||new En,this.precisionModel=this.geometryFactory.getPrecisionModel()}),[{key:"read",value:function(E){var f=new Ri(E);return new Hi(f,this.geometryFactory).parse()}},{key:"write",value:function(E){return $u(E)}}])})(),mu=(function(){return y((function E(f){a(this,E),this.parser=new lu(f)}),[{key:"write",value:function(E){return this.parser.write(E)}}],[{key:"toLineString",value:function(E,f){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+E.x+" "+E.y+", "+f.x+" "+f.y+" )"}}])})(),Us=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"getIndexAlongSegment",value:function(f,d){return this.computeIntLineIndex(),this._intLineIndex[f][d]}},{key:"getTopologySummary",value:function(){var f=new Ss;return this.isEndPoint()&&f.append(" endpoint"),this._isProper&&f.append(" proper"),this.isCollinear()&&f.append(" collinear"),f.toString()}},{key:"computeIntersection",value:function(f,d,S,N){this._inputLines[0][0]=f,this._inputLines[0][1]=d,this._inputLines[1][0]=S,this._inputLines[1][1]=N,this._result=this.computeIntersect(f,d,S,N)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var f=arguments[0];this.getEdgeDistance(f,0)>this.getEdgeDistance(f,1)?(this._intLineIndex[f][0]=0,this._intLineIndex[f][1]=1):(this._intLineIndex[f][0]=1,this._intLineIndex[f][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(f){this._precisionModel=f}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var f=arguments[0],d=0;d<this._result;d++)if(!this._intPt[d].equals2D(this._inputLines[f][0])&&!this._intPt[d].equals2D(this._inputLines[f][1]))return!0;return!1}}},{key:"getIntersection",value:function(f){return this._intPt[f]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==E.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(f,d){return E.computeEdgeDistance(this._intPt[d],this._inputLines[f][0],this._inputLines[f][1])}},{key:"isCollinear",value:function(){return this._result===E.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return mu.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+mu.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(f,d){return this._inputLines[f][d]}},{key:"isIntersection",value:function(f){for(var d=0;d<this._result;d++)if(this._intPt[d].equals2D(f))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(f,d){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[f][d]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Oe,this._intPt[1]=new Oe,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(f,d,S){var N=Math.abs(S.x-d.x),X=Math.abs(S.y-d.y),he=-1;if(f.equals(d))he=0;else if(f.equals(S))he=N>X?N:X;else{var Ae=Math.abs(f.x-d.x),Ye=Math.abs(f.y-d.y);(he=N>X?Ae:Ye)!==0||f.equals(d)||(he=Math.max(Ae,Ye))}return Ve.isTrue(!(he===0&&!f.equals(d)),"Bad distance calculation"),he}},{key:"nonRobustComputeEdgeDistance",value:function(f,d,S){var N=f.x-d.x,X=f.y-d.y,he=Math.sqrt(N*N+X*X);return Ve.isTrue(!(he===0&&!f.equals(d)),"Invalid distance calculation"),he}}])})();Us.DONT_INTERSECT=0,Us.DO_INTERSECT=1,Us.COLLINEAR=2,Us.NO_INTERSECTION=0,Us.POINT_INTERSECTION=1,Us.COLLINEAR_INTERSECTION=2;var Ha=(function(E){function f(){return a(this,f),i(this,f)}return R(f,E),y(f,[{key:"isInSegmentEnvelopes",value:function(d){var S=new Zt(this._inputLines[0][0],this._inputLines[0][1]),N=new Zt(this._inputLines[1][0],this._inputLines[1][1]);return S.contains(d)&&N.contains(d)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return Q(f,"computeIntersection",this,1).apply(this,arguments);var d=arguments[0],S=arguments[1],N=arguments[2];if(this._isProper=!1,Zt.intersects(S,N,d)&&Xn.index(S,N,d)===0&&Xn.index(N,S,d)===0)return this._isProper=!0,(d.equals(S)||d.equals(N))&&(this._isProper=!1),this._result=Us.POINT_INTERSECTION,null;this._result=Us.NO_INTERSECTION}},{key:"intersection",value:function(d,S,N,X){var he=this.intersectionSafe(d,S,N,X);return this.isInSegmentEnvelopes(he)||(he=new Oe(f.nearestEndpoint(d,S,N,X))),this._precisionModel!==null&&this._precisionModel.makePrecise(he),he}},{key:"checkDD",value:function(d,S,N,X,he){var Ae=jr.intersection(d,S,N,X),Ye=this.isInSegmentEnvelopes(Ae);si.out.println("DD in env = "+Ye+"  --------------------- "+Ae),he.distance(Ae)>1e-4&&si.out.println("Distance = "+he.distance(Ae))}},{key:"intersectionSafe",value:function(d,S,N,X){var he=wi.intersection(d,S,N,X);return he===null&&(he=f.nearestEndpoint(d,S,N,X)),he}},{key:"computeCollinearIntersection",value:function(d,S,N,X){var he=Zt.intersects(d,S,N),Ae=Zt.intersects(d,S,X),Ye=Zt.intersects(N,X,d),bt=Zt.intersects(N,X,S);return he&&Ae?(this._intPt[0]=N,this._intPt[1]=X,Us.COLLINEAR_INTERSECTION):Ye&&bt?(this._intPt[0]=d,this._intPt[1]=S,Us.COLLINEAR_INTERSECTION):he&&Ye?(this._intPt[0]=N,this._intPt[1]=d,!N.equals(d)||Ae||bt?Us.COLLINEAR_INTERSECTION:Us.POINT_INTERSECTION):he&&bt?(this._intPt[0]=N,this._intPt[1]=S,!N.equals(S)||Ae||Ye?Us.COLLINEAR_INTERSECTION:Us.POINT_INTERSECTION):Ae&&Ye?(this._intPt[0]=X,this._intPt[1]=d,!X.equals(d)||he||bt?Us.COLLINEAR_INTERSECTION:Us.POINT_INTERSECTION):Ae&&bt?(this._intPt[0]=X,this._intPt[1]=S,!X.equals(S)||he||Ye?Us.COLLINEAR_INTERSECTION:Us.POINT_INTERSECTION):Us.NO_INTERSECTION}},{key:"computeIntersect",value:function(d,S,N,X){if(this._isProper=!1,!Zt.intersects(d,S,N,X))return Us.NO_INTERSECTION;var he=Xn.index(d,S,N),Ae=Xn.index(d,S,X);if(he>0&&Ae>0||he<0&&Ae<0)return Us.NO_INTERSECTION;var Ye=Xn.index(N,X,d),bt=Xn.index(N,X,S);return Ye>0&&bt>0||Ye<0&&bt<0?Us.NO_INTERSECTION:he===0&&Ae===0&&Ye===0&&bt===0?this.computeCollinearIntersection(d,S,N,X):(he===0||Ae===0||Ye===0||bt===0?(this._isProper=!1,d.equals2D(N)||d.equals2D(X)?this._intPt[0]=d:S.equals2D(N)||S.equals2D(X)?this._intPt[0]=S:he===0?this._intPt[0]=new Oe(N):Ae===0?this._intPt[0]=new Oe(X):Ye===0?this._intPt[0]=new Oe(d):bt===0&&(this._intPt[0]=new Oe(S))):(this._isProper=!0,this._intPt[0]=this.intersection(d,S,N,X)),Us.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(d,S,N,X){var he=d,Ae=Ne.pointToSegment(d,N,X),Ye=Ne.pointToSegment(S,N,X);return Ye<Ae&&(Ae=Ye,he=S),(Ye=Ne.pointToSegment(N,d,S))<Ae&&(Ae=Ye,he=N),(Ye=Ne.pointToSegment(X,d,S))<Ae&&(Ae=Ye,he=X),he}}])})(Us),sl=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"countSegment",value:function(f,d){if(f.x<this._p.x&&d.x<this._p.x)return null;if(this._p.x===d.x&&this._p.y===d.y)return this._isPointOnSegment=!0,null;if(f.y===this._p.y&&d.y===this._p.y){var S=f.x,N=d.x;return S>N&&(S=d.x,N=f.x),this._p.x>=S&&this._p.x<=N&&(this._isPointOnSegment=!0),null}if(f.y>this._p.y&&d.y<=this._p.y||d.y>this._p.y&&f.y<=this._p.y){var X=Xn.index(f,d,this._p);if(X===Xn.COLLINEAR)return this._isPointOnSegment=!0,null;d.y<f.y&&(X=-X),X===Xn.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==Ze.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?Ze.BOUNDARY:this._crossingCount%2==1?Ze.INTERIOR:Ze.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var f=arguments[0];this._p=f}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof Oe&&yn(arguments[1],ir)){for(var f=arguments[1],d=new E(arguments[0]),S=new Oe,N=new Oe,X=1;X<f.size();X++)if(f.getCoordinate(X,S),f.getCoordinate(X-1,N),d.countSegment(S,N),d.isOnSegment())return d.getLocation();return d.getLocation()}if(arguments[0]instanceof Oe&&arguments[1]instanceof Array){for(var he=arguments[1],Ae=new E(arguments[0]),Ye=1;Ye<he.length;Ye++){var bt=he[Ye],an=he[Ye-1];if(Ae.countSegment(bt,an),Ae.isOnSegment())return Ae.getLocation()}return Ae.getLocation()}}}])})(),Vo=(function(){function E(){a(this,E)}return y(E,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof Oe&&yn(arguments[1],ir)){for(var f=arguments[0],d=arguments[1],S=new Ha,N=new Oe,X=new Oe,he=d.size(),Ae=1;Ae<he;Ae++)if(d.getCoordinate(Ae-1,N),d.getCoordinate(Ae,X),S.computeIntersection(f,N,X),S.hasIntersection())return!0;return!1}if(arguments[0]instanceof Oe&&arguments[1]instanceof Array){for(var Ye=arguments[0],bt=arguments[1],an=new Ha,mn=1;mn<bt.length;mn++){var Kn=bt[mn-1],Pr=bt[mn];if(an.computeIntersection(Ye,Kn,Pr),an.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(f,d){return sl.locatePointInRing(f,d)}},{key:"isInRing",value:function(f,d){return E.locateInRing(f,d)!==Ze.EXTERIOR}}])})(),Ei=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"setAllLocations",value:function(f){for(var d=0;d<this.location.length;d++)this.location[d]=f}},{key:"isNull",value:function(){for(var f=0;f<this.location.length;f++)if(this.location[f]!==Ze.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(f){for(var d=0;d<this.location.length;d++)this.location[d]===Ze.NONE&&(this.location[d]=f)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(f){if(f.location.length>this.location.length){var d=new Array(3).fill(null);d[$t.ON]=this.location[$t.ON],d[$t.LEFT]=Ze.NONE,d[$t.RIGHT]=Ze.NONE,this.location=d}for(var S=0;S<this.location.length;S++)this.location[S]===Ze.NONE&&S<f.location.length&&(this.location[S]=f.location[S])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var f=this.location[$t.LEFT];this.location[$t.LEFT]=this.location[$t.RIGHT],this.location[$t.RIGHT]=f}},{key:"toString",value:function(){var f=new sr;return this.location.length>1&&f.append(Ze.toLocationSymbol(this.location[$t.LEFT])),f.append(Ze.toLocationSymbol(this.location[$t.ON])),this.location.length>1&&f.append(Ze.toLocationSymbol(this.location[$t.RIGHT])),f.toString()}},{key:"setLocations",value:function(f,d,S){this.location[$t.ON]=f,this.location[$t.LEFT]=d,this.location[$t.RIGHT]=S}},{key:"get",value:function(f){return f<this.location.length?this.location[f]:Ze.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var f=0;f<this.location.length;f++)if(this.location[f]===Ze.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var f=arguments[0];this.setLocation($t.ON,f)}else if(arguments.length===2){var d=arguments[0],S=arguments[1];this.location[d]=S}}},{key:"init",value:function(f){this.location=new Array(f).fill(null),this.setAllLocations(Ze.NONE)}},{key:"isEqualOnSide",value:function(f,d){return this.location[d]===f.location[d]}},{key:"allPositionsEqual",value:function(f){for(var d=0;d<this.location.length;d++)if(this.location[d]!==f)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var f=arguments[0];this.init(f.length)}else if(Number.isInteger(arguments[0])){var d=arguments[0];this.init(1),this.location[$t.ON]=d}else if(arguments[0]instanceof E){var S=arguments[0];if(this.init(S.location.length),S!==null)for(var N=0;N<this.location.length;N++)this.location[N]=S.location[N]}}else if(arguments.length===3){var X=arguments[0],he=arguments[1],Ae=arguments[2];this.init(3),this.location[$t.ON]=X,this.location[$t.LEFT]=he,this.location[$t.RIGHT]=Ae}}}])})(),bo=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"getGeometryCount",value:function(){var f=0;return this.elt[0].isNull()||f++,this.elt[1].isNull()||f++,f}},{key:"setAllLocations",value:function(f,d){this.elt[f].setAllLocations(d)}},{key:"isNull",value:function(f){return this.elt[f].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var f=arguments[0];this.setAllLocationsIfNull(0,f),this.setAllLocationsIfNull(1,f)}else if(arguments.length===2){var d=arguments[0],S=arguments[1];this.elt[d].setAllLocationsIfNull(S)}}},{key:"isLine",value:function(f){return this.elt[f].isLine()}},{key:"merge",value:function(f){for(var d=0;d<2;d++)this.elt[d]===null&&f.elt[d]!==null?this.elt[d]=new Ei(f.elt[d]):this.elt[d].merge(f.elt[d])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var f=arguments[0];return this.elt[f].get($t.ON)}if(arguments.length===2){var d=arguments[0],S=arguments[1];return this.elt[d].get(S)}}},{key:"toString",value:function(){var f=new sr;return this.elt[0]!==null&&(f.append("A:"),f.append(this.elt[0].toString())),this.elt[1]!==null&&(f.append(" B:"),f.append(this.elt[1].toString())),f.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var f=arguments[0];return this.elt[f].isArea()}}},{key:"isAnyNull",value:function(f){return this.elt[f].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var f=arguments[0],d=arguments[1];this.elt[f].setLocation($t.ON,d)}else if(arguments.length===3){var S=arguments[0],N=arguments[1],X=arguments[2];this.elt[S].setLocation(N,X)}}},{key:"isEqualOnSide",value:function(f,d){return this.elt[0].isEqualOnSide(f.elt[0],d)&&this.elt[1].isEqualOnSide(f.elt[1],d)}},{key:"allPositionsEqual",value:function(f,d){return this.elt[f].allPositionsEqual(d)}},{key:"toLine",value:function(f){this.elt[f].isArea()&&(this.elt[f]=new Ei(this.elt[f].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var f=arguments[0];this.elt[0]=new Ei(f),this.elt[1]=new Ei(f)}else if(arguments[0]instanceof E){var d=arguments[0];this.elt[0]=new Ei(d.elt[0]),this.elt[1]=new Ei(d.elt[1])}}else if(arguments.length===2){var S=arguments[0],N=arguments[1];this.elt[0]=new Ei(Ze.NONE),this.elt[1]=new Ei(Ze.NONE),this.elt[S].setLocation(N)}else if(arguments.length===3){var X=arguments[0],he=arguments[1],Ae=arguments[2];this.elt[0]=new Ei(X,he,Ae),this.elt[1]=new Ei(X,he,Ae)}else if(arguments.length===4){var Ye=arguments[0],bt=arguments[1],an=arguments[2],mn=arguments[3];this.elt[0]=new Ei(Ze.NONE,Ze.NONE,Ze.NONE),this.elt[1]=new Ei(Ze.NONE,Ze.NONE,Ze.NONE),this.elt[Ye].setLocations(bt,an,mn)}}},{key:"toLineLabel",value:function(f){for(var d=new E(Ze.NONE),S=0;S<2;S++)d.setLocation(S,f.getLocation(S));return d}}])})(),gi=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var E=new Array(this._pts.size()).fill(null),f=0;f<this._pts.size();f++)E[f]=this._pts.get(f);this._ring=this._geometryFactory.createLinearRing(E),this._isHole=Xn.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(E){this._startDe=E;var f=E,d=!0;do{if(f===null)throw new bi("Found null DirectedEdge");if(f.getEdgeRing()===this)throw new bi("Directed Edge visited twice during ring-building at "+f.getCoordinate());this._edges.add(f);var S=f.getLabel();Ve.isTrue(S.isArea()),this.mergeLabel(S),this.addPoints(f.getEdge(),f.isForward(),d),d=!1,this.setEdgeRing(f,this),f=this.getNext(f)}while(f!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(E){return this._pts.get(E)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var E=this._startDe;do{var f=E.getNode().getEdges().getOutgoingDegree(this);f>this._maxNodeDegree&&(this._maxNodeDegree=f),E=this.getNext(E)}while(E!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(E,f,d){var S=E.getCoordinates();if(f){var N=1;d&&(N=0);for(var X=N;X<S.length;X++)this._pts.add(S[X])}else{var he=S.length-2;d&&(he=S.length-1);for(var Ae=he;Ae>=0;Ae--)this._pts.add(S[Ae])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var E=this._startDe;do E.getEdge().setInResult(!0),E=E.getNext();while(E!==this._startDe)}},{key:"containsPoint",value:function(E){var f=this.getLinearRing();if(!f.getEnvelopeInternal().contains(E)||!Vo.isInRing(E,f.getCoordinates()))return!1;for(var d=this._holes.iterator();d.hasNext();)if(d.next().containsPoint(E))return!1;return!0}},{key:"addHole",value:function(E){this._holes.add(E)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var E=arguments[0];this.mergeLabel(E,0),this.mergeLabel(E,1)}else if(arguments.length===2){var f=arguments[1],d=arguments[0].getLocation(f,$t.RIGHT);if(d===Ze.NONE)return null;if(this._label.getLocation(f)===Ze.NONE)return this._label.setLocation(f,d),null}}},{key:"setShell",value:function(E){this._shell=E,E!==null&&E.addHole(this)}},{key:"toPolygon",value:function(E){for(var f=new Array(this._holes.size()).fill(null),d=0;d<this._holes.size();d++)f[d]=this._holes.get(d).getLinearRing();return E.createPolygon(this.getLinearRing(),f)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new or,this._pts=new or,this._label=new bo(Ze.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new or,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var E=arguments[0],f=arguments[1];this._geometryFactory=f,this.computePoints(E),this.computeRing()}}}}])})(),wo=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"setEdgeRing",value:function(d,S){d.setMinEdgeRing(S)}},{key:"getNext",value:function(d){return d.getNextMin()}}],[{key:"constructor_",value:function(){var d=arguments[0],S=arguments[1];gi.constructor_.call(this,d,S)}}])})(gi),Vs=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"buildMinimalRings",value:function(){var d=new or,S=this._startDe;do{if(S.getMinEdgeRing()===null){var N=new wo(S,this._geometryFactory);d.add(N)}S=S.getNext()}while(S!==this._startDe);return d}},{key:"setEdgeRing",value:function(d,S){d.setEdgeRing(S)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var d=this._startDe;do d.getNode().getEdges().linkMinimalDirectedEdges(this),d=d.getNext();while(d!==this._startDe)}},{key:"getNext",value:function(d){return d.getNext()}}],[{key:"constructor_",value:function(){var d=arguments[0],S=arguments[1];gi.constructor_.call(this,d,S)}}])})(gi),Nc=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"setVisited",value:function(E){this._isVisited=E}},{key:"setInResult",value:function(E){this._isInResult=E}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(E){this._label=E}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(E){this._isCovered=E,this._isCoveredSet=!0}},{key:"updateIM",value:function(E){Ve.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(E)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var E=arguments[0];this._label=E}}}}])})(),Pu=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"isIncidentEdgeInResult",value:function(){for(var d=this.getEdges().getEdges().iterator();d.hasNext();)if(d.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(d){d.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(d){}},{key:"computeMergedLocation",value:function(d,S){var N=Ze.NONE;if(N=this._label.getLocation(S),!d.isNull(S)){var X=d.getLocation(S);N!==Ze.BOUNDARY&&(N=X)}return N}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return Q(f,"setLabel",this,1).apply(this,arguments);var d=arguments[0],S=arguments[1];this._label===null?this._label=new bo(d,S):this._label.setLocation(d,S)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof f){var d=arguments[0];this.mergeLabel(d._label)}else if(arguments[0]instanceof bo)for(var S=arguments[0],N=0;N<2;N++){var X=this.computeMergedLocation(S,N);this._label.getLocation(N)===Ze.NONE&&this._label.setLocation(N,X)}}},{key:"add",value:function(d){this._edges.insert(d),d.setNode(this)}},{key:"setLabelBoundary",value:function(d){if(this._label===null)return null;var S=Ze.NONE;this._label!==null&&(S=this._label.getLocation(d));var N=null;switch(S){case Ze.BOUNDARY:N=Ze.INTERIOR;break;case Ze.INTERIOR:default:N=Ze.BOUNDARY}this._label.setLocation(d,N)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var d=arguments[0],S=arguments[1];this._coord=d,this._edges=S,this._label=new bo(0,Ze.NONE)}}])})(Nc),Fs=(function(E){function f(){return a(this,f),i(this,f,arguments)}return R(f,E),y(f)})(nl);function na(E){return E==null?0:E.color}function Es(E){return E==null?null:E.parent}function xs(E,f){E!==null&&(E.color=f)}function Ts(E){return E==null?null:E.left}function Ol(E){return E==null?null:E.right}var ha=(function(E){function f(){var d;return a(this,f),(d=i(this,f)).root_=null,d.size_=0,d}return R(f,E),y(f,[{key:"get",value:function(d){for(var S=this.root_;S!==null;){var N=d.compareTo(S.key);if(N<0)S=S.left;else{if(!(N>0))return S.value;S=S.right}}return null}},{key:"put",value:function(d,S){if(this.root_===null)return this.root_={key:d,value:S,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var N,X,he=this.root_;do if(N=he,(X=d.compareTo(he.key))<0)he=he.left;else{if(!(X>0)){var Ae=he.value;return he.value=S,Ae}he=he.right}while(he!==null);var Ye={key:d,left:null,right:null,value:S,parent:N,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return X<0?N.left=Ye:N.right=Ye,this.fixAfterInsertion(Ye),this.size_++,null}},{key:"fixAfterInsertion",value:function(d){var S;for(d.color=1;d!=null&&d!==this.root_&&d.parent.color===1;)Es(d)===Ts(Es(Es(d)))?na(S=Ol(Es(Es(d))))===1?(xs(Es(d),0),xs(S,0),xs(Es(Es(d)),1),d=Es(Es(d))):(d===Ol(Es(d))&&(d=Es(d),this.rotateLeft(d)),xs(Es(d),0),xs(Es(Es(d)),1),this.rotateRight(Es(Es(d)))):na(S=Ts(Es(Es(d))))===1?(xs(Es(d),0),xs(S,0),xs(Es(Es(d)),1),d=Es(Es(d))):(d===Ts(Es(d))&&(d=Es(d),this.rotateRight(d)),xs(Es(d),0),xs(Es(Es(d)),1),this.rotateLeft(Es(Es(d))));this.root_.color=0}},{key:"values",value:function(){var d=new or,S=this.getFirstEntry();if(S!==null)for(d.add(S.value);(S=f.successor(S))!==null;)d.add(S.value);return d}},{key:"entrySet",value:function(){var d=new Fr,S=this.getFirstEntry();if(S!==null)for(d.add(S);(S=f.successor(S))!==null;)d.add(S);return d}},{key:"rotateLeft",value:function(d){if(d!=null){var S=d.right;d.right=S.left,S.left!=null&&(S.left.parent=d),S.parent=d.parent,d.parent==null?this.root_=S:d.parent.left===d?d.parent.left=S:d.parent.right=S,S.left=d,d.parent=S}}},{key:"rotateRight",value:function(d){if(d!=null){var S=d.left;d.left=S.right,S.right!=null&&(S.right.parent=d),S.parent=d.parent,d.parent==null?this.root_=S:d.parent.right===d?d.parent.right=S:d.parent.left=S,S.right=d,d.parent=S}}},{key:"getFirstEntry",value:function(){var d=this.root_;if(d!=null)for(;d.left!=null;)d=d.left;return d}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(d){for(var S=this.root_;S!==null;){var N=d.compareTo(S.key);if(N<0)S=S.left;else{if(!(N>0))return!0;S=S.right}}return!1}}],[{key:"successor",value:function(d){var S;if(d===null)return null;if(d.right!==null){for(S=d.right;S.left!==null;)S=S.left;return S}S=d.parent;for(var N=d;S!==null&&N===S.right;)N=S,S=S.parent;return S}}])})(Fs),ra=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"find",value:function(E){return this.nodeMap.get(E)}},{key:"addNode",value:function(){if(arguments[0]instanceof Oe){var E=arguments[0],f=this.nodeMap.get(E);return f===null&&(f=this.nodeFact.createNode(E),this.nodeMap.put(E,f)),f}if(arguments[0]instanceof Pu){var d=arguments[0],S=this.nodeMap.get(d.getCoordinate());return S===null?(this.nodeMap.put(d.getCoordinate(),d),d):(S.mergeLabel(d),S)}}},{key:"print",value:function(E){for(var f=this.iterator();f.hasNext();)f.next().print(E)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(E){for(var f=new or,d=this.iterator();d.hasNext();){var S=d.next();S.getLabel().getLocation(E)===Ze.BOUNDARY&&f.add(S)}return f}},{key:"add",value:function(E){var f=E.getCoordinate();this.addNode(f).add(E)}}],[{key:"constructor_",value:function(){this.nodeMap=new ha,this.nodeFact=null;var E=arguments[0];this.nodeFact=E}}])})(),os=(function(){function E(){a(this,E)}return y(E,null,[{key:"isNorthern",value:function(f){return f===E.NE||f===E.NW}},{key:"isOpposite",value:function(f,d){return f!==d&&(f-d+4)%4===2}},{key:"commonHalfPlane",value:function(f,d){if(f===d)return f;if((f-d+4)%4===2)return-1;var S=f<d?f:d;return S===0&&(f>d?f:d)===3?3:S}},{key:"isInHalfPlane",value:function(f,d){return d===E.SE?f===E.SE||f===E.SW:f===d||f===d+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var f=arguments[0],d=arguments[1];if(f===0&&d===0)throw new Pe("Cannot compute the quadrant for point ( "+f+", "+d+" )");return f>=0?d>=0?E.NE:E.SE:d>=0?E.NW:E.SW}if(arguments[0]instanceof Oe&&arguments[1]instanceof Oe){var S=arguments[0],N=arguments[1];if(N.x===S.x&&N.y===S.y)throw new Pe("Cannot compute the quadrant for two identical points "+S);return N.x>=S.x?N.y>=S.y?E.NE:E.SE:N.y>=S.y?E.NW:E.SW}}}])})();os.NE=0,os.NW=1,os.SW=2,os.SE=3;var gu=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"compareDirection",value:function(f){return this._dx===f._dx&&this._dy===f._dy?0:this._quadrant>f._quadrant?1:this._quadrant<f._quadrant?-1:Xn.index(f._p0,f._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(f){this._node=f}},{key:"print",value:function(f){var d=Math.atan2(this._dy,this._dx),S=this.getClass().getName(),N=S.lastIndexOf("."),X=S.substring(N+1);f.print("  "+X+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+d+"   "+this._label)}},{key:"compareTo",value:function(f){var d=f;return this.compareDirection(d)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var f=Math.atan2(this._dy,this._dx),d=this.getClass().getName(),S=d.lastIndexOf(".");return"  "+d.substring(S+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+f+"   "+this._label}},{key:"computeLabel",value:function(f){}},{key:"init",value:function(f,d){this._p0=f,this._p1=d,this._dx=d.x-f.x,this._dy=d.y-f.y,this._quadrant=os.quadrant(this._dx,this._dy),Ve.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[_e]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var f=arguments[0];this._edge=f}else if(arguments.length===3){var d=arguments[0],S=arguments[1],N=arguments[2];E.constructor_.call(this,d,S,N,null)}else if(arguments.length===4){var X=arguments[0],he=arguments[1],Ae=arguments[2],Ye=arguments[3];E.constructor_.call(this,X),this.init(he,Ae),this._label=Ye}}}])})(),ro=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(d){return this._depth[d]}},{key:"setVisited",value:function(d){this._isVisited=d}},{key:"computeDirectedLabel",value:function(){this._label=new bo(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(d,S){if(this._depth[d]!==-999&&this._depth[d]!==S)throw new bi("assigned depths do not match",this.getCoordinate());this._depth[d]=S}},{key:"isInteriorAreaEdge",value:function(){for(var d=!0,S=0;S<2;S++)this._label.isArea(S)&&this._label.getLocation(S,$t.LEFT)===Ze.INTERIOR&&this._label.getLocation(S,$t.RIGHT)===Ze.INTERIOR||(d=!1);return d}},{key:"setNextMin",value:function(d){this._nextMin=d}},{key:"print",value:function(d){Q(f,"print",this,1).call(this,d),d.print(" "+this._depth[$t.LEFT]+"/"+this._depth[$t.RIGHT]),d.print(" ("+this.getDepthDelta()+")"),this._isInResult&&d.print(" inResult")}},{key:"setMinEdgeRing",value:function(d){this._minEdgeRing=d}},{key:"isLineEdge",value:function(){var d=this._label.isLine(0)||this._label.isLine(1),S=!this._label.isArea(0)||this._label.allPositionsEqual(0,Ze.EXTERIOR),N=!this._label.isArea(1)||this._label.allPositionsEqual(1,Ze.EXTERIOR);return d&&S&&N}},{key:"setEdgeRing",value:function(d){this._edgeRing=d}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var d=this._edge.getDepthDelta();return this._isForward||(d=-d),d}},{key:"setInResult",value:function(d){this._isInResult=d}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(d){this.print(d),d.print(" "),this._isForward?this._edge.print(d):this._edge.printReverse(d)}},{key:"setSym",value:function(d){this._sym=d}},{key:"setVisitedEdge",value:function(d){this.setVisited(d),this._sym.setVisited(d)}},{key:"setEdgeDepths",value:function(d,S){var N=this.getEdge().getDepthDelta();this._isForward||(N=-N);var X=1;d===$t.LEFT&&(X=-1);var he=$t.opposite(d),Ae=S+N*X;this.setDepth(d,S),this.setDepth(he,Ae)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(d){this._next=d}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var d=arguments[0],S=arguments[1];if(gu.constructor_.call(this,d),this._isForward=S,S)this.init(d.getCoordinate(0),d.getCoordinate(1));else{var N=d.getNumPoints()-1;this.init(d.getCoordinate(N),d.getCoordinate(N-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(d,S){return d===Ze.EXTERIOR&&S===Ze.INTERIOR?1:d===Ze.INTERIOR&&S===Ze.EXTERIOR?-1:0}}])})(gu),ya=(function(){return y((function E(){a(this,E)}),[{key:"createNode",value:function(E){return new Pu(E,null)}}])})(),ol=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"printEdges",value:function(E){E.println("Edges:");for(var f=0;f<this._edges.size();f++){E.println("edge "+f+":");var d=this._edges.get(f);d.print(E),d.eiList.print(E)}}},{key:"find",value:function(E){return this._nodes.find(E)}},{key:"addNode",value:function(){if(arguments[0]instanceof Pu){var E=arguments[0];return this._nodes.addNode(E)}if(arguments[0]instanceof Oe){var f=arguments[0];return this._nodes.addNode(f)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var E=this._nodes.iterator();E.hasNext();)E.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(E){si.out.println(E)}},{key:"isBoundaryNode",value:function(E,f){var d=this._nodes.find(f);if(d===null)return!1;var S=d.getLabel();return S!==null&&S.getLocation(E)===Ze.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var E=this._nodes.iterator();E.hasNext();)E.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(E,f,d,S){return!!E.equals(d)&&Xn.index(E,f,S)===Xn.COLLINEAR&&os.quadrant(E,f)===os.quadrant(d,S)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(E){si.out.print(E)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(E,f){for(var d=0;d<this._edges.size();d++){var S=this._edges.get(d),N=S.getCoordinates();if(this.matchInSameDirection(E,f,N[0],N[1])||this.matchInSameDirection(E,f,N[N.length-1],N[N.length-2]))return S}return null}},{key:"insertEdge",value:function(E){this._edges.add(E)}},{key:"findEdgeEnd",value:function(E){for(var f=this.getEdgeEnds().iterator();f.hasNext();){var d=f.next();if(d.getEdge()===E)return d}return null}},{key:"addEdges",value:function(E){for(var f=E.iterator();f.hasNext();){var d=f.next();this._edges.add(d);var S=new ro(d,!0),N=new ro(d,!1);S.setSym(N),N.setSym(S),this.add(S),this.add(N)}}},{key:"add",value:function(E){this._nodes.add(E),this._edgeEndList.add(E)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(E,f){for(var d=0;d<this._edges.size();d++){var S=this._edges.get(d),N=S.getCoordinates();if(E.equals(N[0])&&f.equals(N[1]))return S}return null}}],[{key:"constructor_",value:function(){if(this._edges=new or,this._nodes=null,this._edgeEndList=new or,arguments.length===0)this._nodes=new ra(new ya);else if(arguments.length===1){var E=arguments[0];this._nodes=new ra(E)}}},{key:"linkResultDirectedEdges",value:function(E){for(var f=E.iterator();f.hasNext();)f.next().getEdges().linkResultDirectedEdges()}}])})(),Al=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"sortShellsAndHoles",value:function(f,d,S){for(var N=f.iterator();N.hasNext();){var X=N.next();X.isHole()?S.add(X):d.add(X)}}},{key:"computePolygons",value:function(f){for(var d=new or,S=f.iterator();S.hasNext();){var N=S.next().toPolygon(this._geometryFactory);d.add(N)}return d}},{key:"placeFreeHoles",value:function(f,d){for(var S=d.iterator();S.hasNext();){var N=S.next();if(N.getShell()===null){var X=E.findEdgeRingContaining(N,f);if(X===null)throw new bi("unable to assign hole to a shell",N.getCoordinate(0));N.setShell(X)}}}},{key:"buildMinimalEdgeRings",value:function(f,d,S){for(var N=new or,X=f.iterator();X.hasNext();){var he=X.next();if(he.getMaxNodeDegree()>2){he.linkDirectedEdgesForMinimalEdgeRings();var Ae=he.buildMinimalRings(),Ye=this.findShell(Ae);Ye!==null?(this.placePolygonHoles(Ye,Ae),d.add(Ye)):S.addAll(Ae)}else N.add(he)}return N}},{key:"buildMaximalEdgeRings",value:function(f){for(var d=new or,S=f.iterator();S.hasNext();){var N=S.next();if(N.isInResult()&&N.getLabel().isArea()&&N.getEdgeRing()===null){var X=new Vs(N,this._geometryFactory);d.add(X),X.setInResult()}}return d}},{key:"placePolygonHoles",value:function(f,d){for(var S=d.iterator();S.hasNext();){var N=S.next();N.isHole()&&N.setShell(f)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(f){for(var d=0,S=null,N=f.iterator();N.hasNext();){var X=N.next();X.isHole()||(S=X,d++)}return Ve.isTrue(d<=1,"found two shells in MinimalEdgeRing list"),S}},{key:"add",value:function(){if(arguments.length===1){var f=arguments[0];this.add(f.getEdgeEnds(),f.getNodes())}else if(arguments.length===2){var d=arguments[0],S=arguments[1];ol.linkResultDirectedEdges(S);var N=this.buildMaximalEdgeRings(d),X=new or,he=this.buildMinimalEdgeRings(N,this._shellList,X);this.sortShellsAndHoles(he,this._shellList,X),this.placeFreeHoles(this._shellList,X)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new or;var f=arguments[0];this._geometryFactory=f}},{key:"findEdgeRingContaining",value:function(f,d){for(var S=f.getLinearRing(),N=S.getEnvelopeInternal(),X=S.getCoordinateN(0),he=null,Ae=null,Ye=d.iterator();Ye.hasNext();){var bt=Ye.next(),an=bt.getLinearRing(),mn=an.getEnvelopeInternal();if(!mn.equals(N)&&mn.contains(N)){X=di.ptNotInList(S.getCoordinates(),an.getCoordinates());var Kn=!1;Vo.isInRing(X,an.getCoordinates())&&(Kn=!0),Kn&&(he===null||Ae.contains(mn))&&(Ae=(he=bt).getLinearRing().getEnvelopeInternal())}}return he}}])})(),Nu=(function(){return y((function E(){a(this,E)}),[{key:"getBounds",value:function(){}}])})(),Na=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[Nu,B]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var E=arguments[0],f=arguments[1];this._bounds=E,this._item=f}}])})(),qo=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"poll",value:function(){if(this.isEmpty())return null;var E=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),E}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(E){for(var f=null,d=this._items.get(E);2*E<=this._size&&((f=2*E)!==this._size&&this._items.get(f+1).compareTo(this._items.get(f))<0&&f++,this._items.get(f).compareTo(d)<0);E=f)this._items.set(E,this._items.get(f));this._items.set(E,d)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(E){this._items.add(null),this._size+=1;var f=this._size;for(this._items.set(0,E);E.compareTo(this._items.get(Math.trunc(f/2)))<0;f/=2)this._items.set(f,this._items.get(Math.trunc(f/2)));this._items.set(f,E)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new or,this._items.add(null)}}])})(),ji=(function(){return y((function E(){a(this,E)}),[{key:"insert",value:function(E,f){}},{key:"remove",value:function(E,f){}},{key:"query",value:function(){}}])})(),qs=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(E){Ve.isTrue(this._bounds===null),this._childBoundables.add(E)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[Nu,B]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new or,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var E=arguments[0];this._level=E}}}}])})(),Lo={reverseOrder:function(){return{compare:function(E,f){return f.compareTo(E)}}},min:function(E){return Lo.sort(E),E.get(0)},sort:function(E,f){var d=E.toArray();f?Mr.sort(d,f):Mr.sort(d);for(var S=E.iterator(),N=0,X=d.length;N<X;N++)S.next(),S.set(d[N])},singletonList:function(E){var f=new or;return f.add(E),f}},_a=(function(){function E(){a(this,E)}return y(E,null,[{key:"maxDistance",value:function(f,d,S,N,X,he,Ae,Ye){var bt=E.distance(f,d,X,he);return bt=Math.max(bt,E.distance(f,d,Ae,Ye)),bt=Math.max(bt,E.distance(S,N,X,he)),bt=Math.max(bt,E.distance(S,N,Ae,Ye))}},{key:"distance",value:function(f,d,S,N){var X=S-f,he=N-d;return Math.sqrt(X*X+he*he)}},{key:"maximumDistance",value:function(f,d){var S=Math.min(f.getMinX(),d.getMinX()),N=Math.min(f.getMinY(),d.getMinY()),X=Math.max(f.getMaxX(),d.getMaxX()),he=Math.max(f.getMaxY(),d.getMaxY());return E.distance(S,N,X,he)}},{key:"minMaxDistance",value:function(f,d){var S=f.getMinX(),N=f.getMinY(),X=f.getMaxX(),he=f.getMaxY(),Ae=d.getMinX(),Ye=d.getMinY(),bt=d.getMaxX(),an=d.getMaxY(),mn=E.maxDistance(S,N,S,he,Ae,Ye,Ae,an);return mn=Math.min(mn,E.maxDistance(S,N,S,he,Ae,Ye,bt,Ye)),mn=Math.min(mn,E.maxDistance(S,N,S,he,bt,an,Ae,an)),mn=Math.min(mn,E.maxDistance(S,N,S,he,bt,an,bt,Ye)),mn=Math.min(mn,E.maxDistance(S,N,X,N,Ae,Ye,Ae,an)),mn=Math.min(mn,E.maxDistance(S,N,X,N,Ae,Ye,bt,Ye)),mn=Math.min(mn,E.maxDistance(S,N,X,N,bt,an,Ae,an)),mn=Math.min(mn,E.maxDistance(S,N,X,N,bt,an,bt,Ye)),mn=Math.min(mn,E.maxDistance(X,he,S,he,Ae,Ye,Ae,an)),mn=Math.min(mn,E.maxDistance(X,he,S,he,Ae,Ye,bt,Ye)),mn=Math.min(mn,E.maxDistance(X,he,S,he,bt,an,Ae,an)),mn=Math.min(mn,E.maxDistance(X,he,S,he,bt,an,bt,Ye)),mn=Math.min(mn,E.maxDistance(X,he,X,N,Ae,Ye,Ae,an)),mn=Math.min(mn,E.maxDistance(X,he,X,N,Ae,Ye,bt,Ye)),mn=Math.min(mn,E.maxDistance(X,he,X,N,bt,an,Ae,an)),mn=Math.min(mn,E.maxDistance(X,he,X,N,bt,an,bt,Ye))}}])})(),zo=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"maximumDistance",value:function(){return _a.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(f,d){var S=E.isComposite(this._boundable1),N=E.isComposite(this._boundable2);if(S&&N)return E.area(this._boundable1)>E.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,f,d),null):(this.expand(this._boundable2,this._boundable1,!0,f,d),null);if(S)return this.expand(this._boundable1,this._boundable2,!1,f,d),null;if(N)return this.expand(this._boundable2,this._boundable1,!0,f,d),null;throw new Pe("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(E.isComposite(this._boundable1)||E.isComposite(this._boundable2))}},{key:"compareTo",value:function(f){var d=f;return this._distance<d._distance?-1:this._distance>d._distance?1:0}},{key:"expand",value:function(f,d,S,N,X){for(var he=f.getChildBoundables().iterator();he.hasNext();){var Ae=he.next(),Ye=null;(Ye=S?new E(d,Ae,this._itemDistance):new E(Ae,d,this._itemDistance)).getDistance()<X&&N.add(Ye)}}},{key:"getBoundable",value:function(f){return f===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[_e]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var f=arguments[0],d=arguments[1],S=arguments[2];this._boundable1=f,this._boundable2=d,this._itemDistance=S,this._distance=this.distance()}},{key:"area",value:function(f){return f.getBounds().getArea()}},{key:"isComposite",value:function(f){return f instanceof qs}}])})(),ml=(function(){return y((function E(){a(this,E)}),[{key:"visitItem",value:function(E){}}])})(),Po=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"queryInternal",value:function(){if(yn(arguments[2],ml)&&arguments[0]instanceof Object&&arguments[1]instanceof qs)for(var f=arguments[0],d=arguments[2],S=arguments[1].getChildBoundables(),N=0;N<S.size();N++){var X=S.get(N);this.getIntersectsOp().intersects(X.getBounds(),f)&&(X instanceof qs?this.queryInternal(f,X,d):X instanceof Na?d.visitItem(X.getItem()):Ve.shouldNeverReachHere())}else if(yn(arguments[2],ni)&&arguments[0]instanceof Object&&arguments[1]instanceof qs)for(var he=arguments[0],Ae=arguments[2],Ye=arguments[1].getChildBoundables(),bt=0;bt<Ye.size();bt++){var an=Ye.get(bt);this.getIntersectsOp().intersects(an.getBounds(),he)&&(an instanceof qs?this.queryInternal(he,an,Ae):an instanceof Na?Ae.add(an.getItem()):Ve.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(f){return f.get(f.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var f=0,d=arguments[0].getChildBoundables().iterator();d.hasNext();){var S=d.next();S instanceof qs?f+=this.size(S):S instanceof Na&&(f+=1)}return f}}},{key:"removeItem",value:function(f,d){for(var S=null,N=f.getChildBoundables().iterator();N.hasNext();){var X=N.next();X instanceof Na&&X.getItem()===d&&(S=X)}return S!==null&&(f.getChildBoundables().remove(S),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var f=this.itemsTree(this._root);return f===null?new or:f}if(arguments.length===1){for(var d=arguments[0],S=new or,N=d.getChildBoundables().iterator();N.hasNext();){var X=N.next();if(X instanceof qs){var he=this.itemsTree(X);he!==null&&S.add(he)}else X instanceof Na?S.add(X.getItem()):Ve.shouldNeverReachHere()}return S.size()<=0?null:S}}},{key:"insert",value:function(f,d){Ve.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Na(f,d))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var f=arguments[0],d=new or;return this.boundablesAtLevel(f,this._root,d),d}if(arguments.length===3){var S=arguments[0],N=arguments[1],X=arguments[2];if(Ve.isTrue(S>-2),N.getLevel()===S)return X.add(N),null;for(var he=N.getChildBoundables().iterator();he.hasNext();){var Ae=he.next();Ae instanceof qs?this.boundablesAtLevel(S,Ae,X):(Ve.isTrue(Ae instanceof Na),S===-1&&X.add(Ae))}return null}}},{key:"query",value:function(){if(arguments.length===1){var f=arguments[0];this.build();var d=new or;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),f)&&this.queryInternal(f,this._root,d),d}if(arguments.length===2){var S=arguments[0],N=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),S)&&this.queryInternal(S,this._root,N)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var f=arguments[0],d=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),f)&&this.remove(f,this._root,d)}if(arguments.length===3){var S=arguments[0],N=arguments[1],X=arguments[2],he=this.removeItem(N,X);if(he)return!0;for(var Ae=null,Ye=N.getChildBoundables().iterator();Ye.hasNext();){var bt=Ye.next();if(this.getIntersectsOp().intersects(bt.getBounds(),S)&&bt instanceof qs&&(he=this.remove(S,bt,X))){Ae=bt;break}}return Ae!==null&&Ae.getChildBoundables().isEmpty()&&N.getChildBoundables().remove(Ae),he}}},{key:"createHigherLevels",value:function(f,d){Ve.isTrue(!f.isEmpty());var S=this.createParentBoundables(f,d+1);return S.size()===1?S.get(0):this.createHigherLevels(S,d+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var f=0,d=arguments[0].getChildBoundables().iterator();d.hasNext();){var S=d.next();if(S instanceof qs){var N=this.depth(S);N>f&&(f=N)}}return f+1}}},{key:"createParentBoundables",value:function(f,d){Ve.isTrue(!f.isEmpty());var S=new or;S.add(this.createNode(d));var N=new or(f);Lo.sort(N,this.getComparator());for(var X=N.iterator();X.hasNext();){var he=X.next();this.lastNode(S).getChildBoundables().size()===this.getNodeCapacity()&&S.add(this.createNode(d)),this.lastNode(S).addChildBoundable(he)}return S}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[B]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new or,this._nodeCapacity=null,arguments.length===0)E.constructor_.call(this,E.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var f=arguments[0];Ve.isTrue(f>1,"Node capacity must be greater than 1"),this._nodeCapacity=f}}},{key:"compareDoubles",value:function(f,d){return f>d?1:f<d?-1:0}}])})();Po.IntersectsOp=function(){},Po.DEFAULT_NODE_CAPACITY=10;var fa=(function(){return y((function E(){a(this,E)}),[{key:"distance",value:function(E,f){}}])})(),va=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"createParentBoundablesFromVerticalSlices",value:function(d,S){Ve.isTrue(d.length>0);for(var N=new or,X=0;X<d.length;X++)N.addAll(this.createParentBoundablesFromVerticalSlice(d[X],S));return N}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var d=arguments[0],S=arguments[1];return this.nearestNeighbourK(d,Ke.POSITIVE_INFINITY,S)}if(arguments.length===3){var N=arguments[0],X=arguments[2],he=arguments[1],Ae=new qo;Ae.add(N);for(var Ye=new qo;!Ae.isEmpty()&&he>=0;){var bt=Ae.poll(),an=bt.getDistance();if(an>=he)break;bt.isLeaves()?Ye.size()<X?Ye.add(bt):(Ye.peek().getDistance()>an&&(Ye.poll(),Ye.add(bt)),he=Ye.peek().getDistance()):bt.expandToQueue(Ae,he)}return f.getItems(Ye)}}},{key:"createNode",value:function(d){return new ee(d)}},{key:"size",value:function(){return arguments.length===0?Q(f,"size",this,1).call(this):Q(f,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Zt))return Q(f,"insert",this,1).apply(this,arguments);var d=arguments[0],S=arguments[1];if(d.isNull())return null;Q(f,"insert",this,1).call(this,d,S)}},{key:"getIntersectsOp",value:function(){return f.intersectsOp}},{key:"verticalSlices",value:function(d,S){for(var N=Math.trunc(Math.ceil(d.size()/S)),X=new Array(S).fill(null),he=d.iterator(),Ae=0;Ae<S;Ae++){X[Ae]=new or;for(var Ye=0;he.hasNext()&&Ye<N;){var bt=he.next();X[Ae].add(bt),Ye++}}return X}},{key:"query",value:function(){if(arguments.length===1){var d=arguments[0];return Q(f,"query",this,1).call(this,d)}if(arguments.length===2){var S=arguments[0],N=arguments[1];Q(f,"query",this,1).call(this,S,N)}}},{key:"getComparator",value:function(){return f.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(d,S){return Q(f,"createParentBoundables",this,1).call(this,d,S)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Zt){var d=arguments[0],S=arguments[1];return Q(f,"remove",this,1).call(this,d,S)}return Q(f,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?Q(f,"depth",this,1).call(this):Q(f,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(d,S){Ve.isTrue(!d.isEmpty());var N=Math.trunc(Math.ceil(d.size()/this.getNodeCapacity())),X=new or(d);Lo.sort(X,f.xComparator);var he=this.verticalSlices(X,Math.trunc(Math.ceil(Math.sqrt(N))));return this.createParentBoundablesFromVerticalSlices(he,S)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(yn(arguments[0],fa)){var d=arguments[0];if(this.isEmpty())return null;var S=new zo(this.getRoot(),this.getRoot(),d);return this.nearestNeighbour(S)}if(arguments[0]instanceof zo){var N=arguments[0],X=Ke.POSITIVE_INFINITY,he=null,Ae=new qo;for(Ae.add(N);!Ae.isEmpty()&&X>0;){var Ye=Ae.poll(),bt=Ye.getDistance();if(bt>=X)break;Ye.isLeaves()?(X=bt,he=Ye):Ye.expandToQueue(Ae,X)}return he===null?null:[he.getBoundable(0).getItem(),he.getBoundable(1).getItem()]}}else{if(arguments.length===2){var an=arguments[0],mn=arguments[1];if(this.isEmpty()||an.isEmpty())return null;var Kn=new zo(this.getRoot(),an.getRoot(),mn);return this.nearestNeighbour(Kn)}if(arguments.length===3){var Pr=arguments[2],Yr=new Na(arguments[0],arguments[1]),yi=new zo(this.getRoot(),Yr,Pr);return this.nearestNeighbour(yi)[0]}if(arguments.length===4){var Ms=arguments[2],Xi=arguments[3],Ds=new Na(arguments[0],arguments[1]),As=new zo(this.getRoot(),Ds,Ms);return this.nearestNeighbourK(As,Xi)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var d=arguments[0],S=arguments[1],N=Ke.POSITIVE_INFINITY,X=new qo;for(X.add(d);!X.isEmpty();){var he=X.poll(),Ae=he.getDistance();if(Ae>S)return!1;if(he.maximumDistance()<=S)return!0;if(he.isLeaves()){if((N=Ae)<=S)return!0}else he.expandToQueue(X,N)}return!1}if(arguments.length===3){var Ye=arguments[0],bt=arguments[1],an=arguments[2],mn=new zo(this.getRoot(),Ye.getRoot(),bt);return this.isWithinDistance(mn,an)}}},{key:"interfaces_",get:function(){return[ji,B]}}],[{key:"constructor_",value:function(){if(arguments.length===0)f.constructor_.call(this,f.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var d=arguments[0];Po.constructor_.call(this,d)}}},{key:"centreX",value:function(d){return f.avg(d.getMinX(),d.getMaxX())}},{key:"avg",value:function(d,S){return(d+S)/2}},{key:"getItems",value:function(d){for(var S=new Array(d.size()).fill(null),N=0;!d.isEmpty();){var X=d.poll();S[N]=X.getBoundable(0).getItem(),N++}return S}},{key:"centreY",value:function(d){return f.avg(d.getMinY(),d.getMaxY())}}])})(Po),ee=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"computeBounds",value:function(){for(var d=null,S=this.getChildBoundables().iterator();S.hasNext();){var N=S.next();d===null?d=new Zt(N.getBounds()):d.expandToInclude(N.getBounds())}return d}}],[{key:"constructor_",value:function(){var d=arguments[0];qs.constructor_.call(this,d)}}])})(qs);va.STRtreeNode=ee,va.xComparator=new((function(){return y((function E(){a(this,E)}),[{key:"interfaces_",get:function(){return[Ce]}},{key:"compare",value:function(E,f){return Po.compareDoubles(va.centreX(E.getBounds()),va.centreX(f.getBounds()))}}])})()),va.yComparator=new((function(){return y((function E(){a(this,E)}),[{key:"interfaces_",get:function(){return[Ce]}},{key:"compare",value:function(E,f){return Po.compareDoubles(va.centreY(E.getBounds()),va.centreY(f.getBounds()))}}])})()),va.intersectsOp=new((function(){return y((function E(){a(this,E)}),[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(E,f){return E.intersects(f)}}])})()),va.DEFAULT_NODE_CAPACITY=10;var je=(function(){function E(){a(this,E)}return y(E,null,[{key:"relativeSign",value:function(f,d){return f<d?-1:f>d?1:0}},{key:"compare",value:function(f,d,S){if(d.equals2D(S))return 0;var N=E.relativeSign(d.x,S.x),X=E.relativeSign(d.y,S.y);switch(f){case 0:return E.compareValue(N,X);case 1:return E.compareValue(X,N);case 2:return E.compareValue(X,-N);case 3:return E.compareValue(-N,X);case 4:return E.compareValue(-N,-X);case 5:return E.compareValue(-X,-N);case 6:return E.compareValue(-X,N);case 7:return E.compareValue(N,-X)}return Ve.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(f,d){return f<0?-1:f>0?1:d<0?-1:d>0?1:0}}])})(),At=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(E){E.print(this.coord),E.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(E){var f=E;return this.segmentIndex<f.segmentIndex?-1:this.segmentIndex>f.segmentIndex?1:this.coord.equals2D(f.coord)?0:this._isInterior?f._isInterior?je.compare(this._segmentOctant,this.coord,f.coord):1:-1}},{key:"isEndPoint",value:function(E){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===E}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[_e]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var E=arguments[0],f=arguments[1],d=arguments[2],S=arguments[3];this._segString=E,this.coord=new Oe(f),this.segmentIndex=d,this._segmentOctant=S,this._isInterior=!f.equals2D(E.getCoordinate(d))}}])})(),kt=(function(){return y((function E(){a(this,E)}),[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}])})(),sn=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"getSplitCoordinates",value:function(){var E=new Pa;this.addEndpoints();for(var f=this.iterator(),d=f.next();f.hasNext();){var S=f.next();this.addEdgeCoordinates(d,S,E),d=S}return E.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var E=new or;this.findCollapsesFromInsertedNodes(E),this.findCollapsesFromExistingVertices(E);for(var f=E.iterator();f.hasNext();){var d=f.next().intValue();this.add(this._edge.getCoordinate(d),d)}}},{key:"createSplitEdgePts",value:function(E,f){var d=f.segmentIndex-E.segmentIndex+2;if(d===2)return[new Oe(E.coord),new Oe(f.coord)];var S=this._edge.getCoordinate(f.segmentIndex),N=f.isInterior()||!f.coord.equals2D(S);N||d--;var X=new Array(d).fill(null),he=0;X[he++]=new Oe(E.coord);for(var Ae=E.segmentIndex+1;Ae<=f.segmentIndex;Ae++)X[he++]=this._edge.getCoordinate(Ae);return N&&(X[he]=new Oe(f.coord)),X}},{key:"print",value:function(E){E.println("Intersections:");for(var f=this.iterator();f.hasNext();)f.next().print(E)}},{key:"findCollapsesFromExistingVertices",value:function(E){for(var f=0;f<this._edge.size()-2;f++){var d=this._edge.getCoordinate(f);this._edge.getCoordinate(f+1);var S=this._edge.getCoordinate(f+2);d.equals2D(S)&&E.add(Zn.valueOf(f+1))}}},{key:"addEdgeCoordinates",value:function(E,f,d){var S=this.createSplitEdgePts(E,f);d.add(S,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(E){this.addEndpoints(),this.addCollapsedNodes();for(var f=this.iterator(),d=f.next();f.hasNext();){var S=f.next(),N=this.createSplitEdge(d,S);E.add(N),d=S}}},{key:"findCollapseIndex",value:function(E,f,d){if(!E.coord.equals2D(f.coord))return!1;var S=f.segmentIndex-E.segmentIndex;return f.isInterior()||S--,S===1&&(d[0]=E.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(E){for(var f=new Array(1).fill(null),d=this.iterator(),S=d.next();d.hasNext();){var N=d.next();this.findCollapseIndex(S,N,f)&&E.add(Zn.valueOf(f[0])),S=N}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var E=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(E),E)}},{key:"createSplitEdge",value:function(E,f){var d=this.createSplitEdgePts(E,f);return new Qr(d,this._edge.getData())}},{key:"add",value:function(E,f){var d=new At(this._edge,E,f,this._edge.getSegmentOctant(f)),S=this._nodeMap.get(d);return S!==null?(Ve.isTrue(S.coord.equals2D(E),"Found equal nodes with different coordinates"),S):(this._nodeMap.put(d,d),d)}},{key:"checkSplitEdgesCorrectness",value:function(E){var f=this._edge.getCoordinates(),d=E.get(0).getCoordinate(0);if(!d.equals2D(f[0]))throw new ge("bad split edge start point at "+d);var S=E.get(E.size()-1).getCoordinates(),N=S[S.length-1];if(!N.equals2D(f[f.length-1]))throw new ge("bad split edge end point at "+N)}}],[{key:"constructor_",value:function(){this._nodeMap=new ha,this._edge=null;var E=arguments[0];this._edge=E}}])})(),fn=(function(){function E(){a(this,E)}return y(E,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var f=arguments[0],d=arguments[1];if(f===0&&d===0)throw new Pe("Cannot compute the octant for point ( "+f+", "+d+" )");var S=Math.abs(f),N=Math.abs(d);return f>=0?d>=0?S>=N?0:1:S>=N?7:6:d>=0?S>=N?3:2:S>=N?4:5}if(arguments[0]instanceof Oe&&arguments[1]instanceof Oe){var X=arguments[0],he=arguments[1],Ae=he.x-X.x,Ye=he.y-X.y;if(Ae===0&&Ye===0)throw new Pe("Cannot compute the octant for two identical points "+X);return E.octant(Ae,Ye)}}}])})(),Qn=(function(){return y((function E(){a(this,E)}),[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(E){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(E){}},{key:"getData",value:function(){}}])})(),Xr=(function(){return y((function E(){a(this,E)}),[{key:"addIntersection",value:function(E,f){}},{key:"interfaces_",get:function(){return[Qn]}}])})(),Qr=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(f){return this._pts[f]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(f){return f===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(f),this.getCoordinate(f+1))}},{key:"setData",value:function(f){this._data=f}},{key:"safeOctant",value:function(f,d){return f.equals2D(d)?0:fn.octant(f,d)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var f=arguments[0],d=arguments[1];this.addIntersectionNode(f,d)}else if(arguments.length===4){var S=arguments[1],N=arguments[3],X=new Oe(arguments[0].getIntersection(N));this.addIntersection(X,S)}}},{key:"toString",value:function(){return mu.toLineString(new au(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(f,d){var S=d,N=S+1;if(N<this._pts.length){var X=this._pts[N];f.equals2D(X)&&(S=N)}return this._nodeList.add(f,S)}},{key:"addIntersections",value:function(f,d,S){for(var N=0;N<f.getIntersectionNum();N++)this.addIntersection(f,d,S,N)}},{key:"interfaces_",get:function(){return[Xr]}}],[{key:"constructor_",value:function(){this._nodeList=new sn(this),this._pts=null,this._data=null;var f=arguments[0],d=arguments[1];this._pts=f,this._data=d}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var f=arguments[0],d=new or;return E.getNodedSubstrings(f,d),d}if(arguments.length===2)for(var S=arguments[1],N=arguments[0].iterator();N.hasNext();)N.next().getNodeList().addSplitEdges(S)}}])})(),oi=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof E){var f=arguments[0],d=Xn.index(this.p0,this.p1,f.p0),S=Xn.index(this.p0,this.p1,f.p1);return d>=0&&S>=0||d<=0&&S<=0?Math.max(d,S):0}if(arguments[0]instanceof Oe){var N=arguments[0];return Xn.index(this.p0,this.p1,N)}}},{key:"toGeometry",value:function(f){return f.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(f){if(!(f instanceof E))return!1;var d=f;return this.p0.equals(d.p0)&&this.p1.equals(d.p1)}},{key:"intersection",value:function(f){var d=new Ha;return d.computeIntersection(this.p0,this.p1,f.p0,f.p1),d.hasIntersection()?d.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof Oe){var f=arguments[0];if(f.equals(this.p0)||f.equals(this.p1))return new Oe(f);var d=this.projectionFactor(f),S=new Oe;return S.x=this.p0.x+d*(this.p1.x-this.p0.x),S.y=this.p0.y+d*(this.p1.y-this.p0.y),S}if(arguments[0]instanceof E){var N=arguments[0],X=this.projectionFactor(N.p0),he=this.projectionFactor(N.p1);if(X>=1&&he>=1||X<=0&&he<=0)return null;var Ae=this.project(N.p0);X<0&&(Ae=this.p0),X>1&&(Ae=this.p1);var Ye=this.project(N.p1);return he<0&&(Ye=this.p0),he>1&&(Ye=this.p1),new E(Ae,Ye)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(f){return f===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(f){return Ne.pointToLinePerpendicular(f,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return E.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(f){if(f.equals(this.p0))return 0;if(f.equals(this.p1))return 1;var d=this.p1.x-this.p0.x,S=this.p1.y-this.p0.y,N=d*d+S*S;return N<=0?Ke.NaN:((f.x-this.p0.x)*d+(f.y-this.p0.y)*S)/N}},{key:"closestPoints",value:function(f){var d=this.intersection(f);if(d!==null)return[d,d];var S=new Array(2).fill(null),N=Ke.MAX_VALUE,X=null,he=this.closestPoint(f.p0);N=he.distance(f.p0),S[0]=he,S[1]=f.p0;var Ae=this.closestPoint(f.p1);(X=Ae.distance(f.p1))<N&&(N=X,S[0]=Ae,S[1]=f.p1);var Ye=f.closestPoint(this.p0);(X=Ye.distance(this.p0))<N&&(N=X,S[0]=this.p0,S[1]=Ye);var bt=f.closestPoint(this.p1);return(X=bt.distance(this.p1))<N&&(N=X,S[0]=this.p1,S[1]=bt),S}},{key:"closestPoint",value:function(f){var d=this.projectionFactor(f);return d>0&&d<1?this.project(f):this.p0.distance(f)<this.p1.distance(f)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(f){var d=f,S=this.p0.compareTo(d.p0);return S!==0?S:this.p1.compareTo(d.p1)}},{key:"reverse",value:function(){var f=this.p0;this.p0=this.p1,this.p1=f}},{key:"equalsTopo",value:function(f){return this.p0.equals(f.p0)&&this.p1.equals(f.p1)||this.p0.equals(f.p1)&&this.p1.equals(f.p0)}},{key:"lineIntersection",value:function(f){return wi.intersection(this.p0,this.p1,f.p0,f.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(f,d){var S=this.p0.x+f*(this.p1.x-this.p0.x),N=this.p0.y+f*(this.p1.y-this.p0.y),X=this.p1.x-this.p0.x,he=this.p1.y-this.p0.y,Ae=Math.sqrt(X*X+he*he),Ye=0,bt=0;if(d!==0){if(Ae<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");Ye=d*X/Ae,bt=d*he/Ae}return new Oe(S-bt,N+Ye)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var f=arguments[0];this.setCoordinates(f.p0,f.p1)}else if(arguments.length===2){var d=arguments[0],S=arguments[1];this.p0.x=d.x,this.p0.y=d.y,this.p1.x=S.x,this.p1.y=S.y}}},{key:"segmentFraction",value:function(f){var d=this.projectionFactor(f);return d<0?d=0:(d>1||Ke.isNaN(d))&&(d=1),d}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(f){var d=this.p1.getY()-this.p0.getY(),S=this.p0.getX()-this.p1.getX(),N=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),X=d*d+S*S,he=d*d-S*S,Ae=f.getX(),Ye=f.getY();return new Oe((-he*Ae-2*d*S*Ye-2*d*N)/X,(he*Ye-2*d*S*Ae-2*S*N)/X)}},{key:"distance",value:function(){if(arguments[0]instanceof E){var f=arguments[0];return Ne.segmentToSegment(this.p0,this.p1,f.p0,f.p1)}if(arguments[0]instanceof Oe){var d=arguments[0];return Ne.pointToSegment(d,this.p0,this.p1)}}},{key:"pointAlong",value:function(f){var d=new Oe;return d.x=this.p0.x+f*(this.p1.x-this.p0.x),d.y=this.p0.y+f*(this.p1.y-this.p0.y),d}},{key:"hashCode",value:function(){var f=Ke.doubleToLongBits(this.p0.x);f^=31*Ke.doubleToLongBits(this.p0.y);var d=Math.trunc(f)^Math.trunc(f>>32),S=Ke.doubleToLongBits(this.p1.x);return S^=31*Ke.doubleToLongBits(this.p1.y),d^(Math.trunc(S)^Math.trunc(S>>32))}},{key:"interfaces_",get:function(){return[_e,B]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)E.constructor_.call(this,new Oe,new Oe);else if(arguments.length===1){var f=arguments[0];E.constructor_.call(this,f.p0,f.p1)}else if(arguments.length===2){var d=arguments[0],S=arguments[1];this.p0=d,this.p1=S}else if(arguments.length===4){var N=arguments[0],X=arguments[1],he=arguments[2],Ae=arguments[3];E.constructor_.call(this,new Oe(N,X),new Oe(he,Ae))}}},{key:"midPoint",value:function(f,d){return new Oe((f.x+d.x)/2,(f.y+d.y)/2)}}])})(),Ui=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var E=arguments[1],f=arguments[2],d=arguments[3];arguments[0].getLineSegment(E,this._overlapSeg1),f.getLineSegment(d,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new oi,this._overlapSeg2=new oi}}])})(),Ps=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"getLineSegment",value:function(E,f){f.p0=this._pts[E],f.p1=this._pts[E+1]}},{key:"computeSelect",value:function(E,f,d,S){var N=this._pts[f],X=this._pts[d];if(d-f==1)return S.select(this,f),null;if(!E.intersects(N,X))return null;var he=Math.trunc((f+d)/2);f<he&&this.computeSelect(E,f,he,S),he<d&&this.computeSelect(E,he,d,S)}},{key:"getCoordinates",value:function(){for(var E=new Array(this._end-this._start+1).fill(null),f=0,d=this._start;d<=this._end;d++)E[f++]=this._pts[d];return E}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var E=arguments[0],f=arguments[1];this.computeOverlaps(this._start,this._end,E,E._start,E._end,f)}else if(arguments.length===6){var d=arguments[0],S=arguments[1],N=arguments[2],X=arguments[3],he=arguments[4],Ae=arguments[5];if(S-d==1&&he-X==1)return Ae.overlap(this,d,N,X),null;if(!this.overlaps(d,S,N,X,he))return null;var Ye=Math.trunc((d+S)/2),bt=Math.trunc((X+he)/2);d<Ye&&(X<bt&&this.computeOverlaps(d,Ye,N,X,bt,Ae),bt<he&&this.computeOverlaps(d,Ye,N,bt,he,Ae)),Ye<S&&(X<bt&&this.computeOverlaps(Ye,S,N,X,bt,Ae),bt<he&&this.computeOverlaps(Ye,S,N,bt,he,Ae))}}},{key:"setId",value:function(E){this._id=E}},{key:"select",value:function(E,f){this.computeSelect(E,this._start,this._end,f)}},{key:"getEnvelope",value:function(){if(this._env===null){var E=this._pts[this._start],f=this._pts[this._end];this._env=new Zt(E,f)}return this._env}},{key:"overlaps",value:function(E,f,d,S,N){return Zt.intersects(this._pts[E],this._pts[f],d._pts[S],d._pts[N])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var E=arguments[0],f=arguments[1],d=arguments[2],S=arguments[3];this._pts=E,this._start=f,this._end=d,this._context=S}}])})(),Bs=(function(){function E(){a(this,E)}return y(E,null,[{key:"findChainEnd",value:function(f,d){for(var S=d;S<f.length-1&&f[S].equals2D(f[S+1]);)S++;if(S>=f.length-1)return f.length-1;for(var N=os.quadrant(f[S],f[S+1]),X=d+1;X<f.length&&!(!f[X-1].equals2D(f[X])&&os.quadrant(f[X-1],f[X])!==N);)X++;return X-1}},{key:"getChains",value:function(){if(arguments.length===1){var f=arguments[0];return E.getChains(f,null)}if(arguments.length===2){var d=arguments[0],S=arguments[1],N=new or,X=0;do{var he=E.findChainEnd(d,X),Ae=new Ps(d,X,he,S);N.add(Ae),X=he}while(X<d.length-1);return N}}}])})(),fo=(function(){return y((function E(){a(this,E)}),[{key:"computeNodes",value:function(E){}},{key:"getNodedSubstrings",value:function(){}}])})(),Ys=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"setSegmentIntersector",value:function(E){this._segInt=E}},{key:"interfaces_",get:function(){return[fo]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var E=arguments[0];this.setSegmentIntersector(E)}}}}])})(),Zs=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return Qr.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(d){for(var S=Bs.getChains(d.getCoordinates(),d).iterator();S.hasNext();){var N=S.next();N.setId(this._idCounter++),this._index.insert(N.getEnvelope(),N),this._monoChains.add(N)}}},{key:"computeNodes",value:function(d){this._nodedSegStrings=d;for(var S=d.iterator();S.hasNext();)this.add(S.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var d=new go(this._segInt),S=this._monoChains.iterator();S.hasNext();)for(var N=S.next(),X=this._index.query(N.getEnvelope()).iterator();X.hasNext();){var he=X.next();if(he.getId()>N.getId()&&(N.computeOverlaps(he,d),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new or,this._index=new va,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var d=arguments[0];Ys.constructor_.call(this,d)}}}}])})(Ys),go=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"overlap",value:function(){if(arguments.length!==4)return Q(f,"overlap",this,1).apply(this,arguments);var d=arguments[1],S=arguments[2],N=arguments[3],X=arguments[0].getContext(),he=S.getContext();this._si.processIntersections(X,d,he,N)}}],[{key:"constructor_",value:function(){this._si=null;var d=arguments[0];this._si=d}}])})(Ui);Zs.SegmentOverlapAction=go;var Ns=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"isDeletable",value:function(f,d,S,N){var X=this._inputLine[f],he=this._inputLine[d],Ae=this._inputLine[S];return!!this.isConcave(X,he,Ae)&&!!this.isShallow(X,he,Ae,N)&&this.isShallowSampled(X,he,f,S,N)}},{key:"deleteShallowConcavities",value:function(){for(var f=1,d=this.findNextNonDeletedIndex(f),S=this.findNextNonDeletedIndex(d),N=!1;S<this._inputLine.length;){var X=!1;this.isDeletable(f,d,S,this._distanceTol)&&(this._isDeleted[d]=E.DELETE,X=!0,N=!0),f=X?S:d,d=this.findNextNonDeletedIndex(f),S=this.findNextNonDeletedIndex(d)}return N}},{key:"isShallowConcavity",value:function(f,d,S,N){return Xn.index(f,d,S)===this._angleOrientation&&Ne.pointToSegment(d,f,S)<N}},{key:"isShallowSampled",value:function(f,d,S,N,X){var he=Math.trunc((N-S)/E.NUM_PTS_TO_CHECK);he<=0&&(he=1);for(var Ae=S;Ae<N;Ae+=he)if(!this.isShallow(f,d,this._inputLine[Ae],X))return!1;return!0}},{key:"isConcave",value:function(f,d,S){var N=Xn.index(f,d,S)===this._angleOrientation;return N}},{key:"simplify",value:function(f){this._distanceTol=Math.abs(f),f<0&&(this._angleOrientation=Xn.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var d=!1;do d=this.deleteShallowConcavities();while(d);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(f){for(var d=f+1;d<this._inputLine.length&&this._isDeleted[d]===E.DELETE;)d++;return d}},{key:"isShallow",value:function(f,d,S,N){return Ne.pointToSegment(d,f,S)<N}},{key:"collapseLine",value:function(){for(var f=new Pa,d=0;d<this._inputLine.length;d++)this._isDeleted[d]!==E.DELETE&&f.add(this._inputLine[d]);return f.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Xn.COUNTERCLOCKWISE;var f=arguments[0];this._inputLine=f}},{key:"simplify",value:function(f,d){return new E(f).simplify(d)}}])})();Ns.INIT=0,Ns.DELETE=1,Ns.KEEP=1,Ns.NUM_PTS_TO_CHECK=10;var io=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"getCoordinates",value:function(){return this._ptList.toArray(E.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(f){this._precisionModel=f}},{key:"addPt",value:function(f){var d=new Oe(f);if(this._precisionModel.makePrecise(d),this.isRedundant(d))return null;this._ptList.add(d)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(f,d){if(d)for(var S=0;S<f.length;S++)this.addPt(f[S]);else for(var N=f.length-1;N>=0;N--)this.addPt(f[N])}},{key:"isRedundant",value:function(f){if(this._ptList.size()<1)return!1;var d=this._ptList.get(this._ptList.size()-1);return f.distance(d)<this._minimimVertexDistance}},{key:"toString",value:function(){return new En().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var f=new Oe(this._ptList.get(0)),d=this._ptList.get(this._ptList.size()-1);if(f.equals(d))return null;this._ptList.add(f)}},{key:"setMinimumVertexDistance",value:function(f){this._minimimVertexDistance=f}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new or}}])})();io.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var zs=(function(){function E(){a(this,E)}return y(E,null,[{key:"toDegrees",value:function(f){return 180*f/Math.PI}},{key:"normalize",value:function(f){for(;f>Math.PI;)f-=E.PI_TIMES_2;for(;f<=-Math.PI;)f+=E.PI_TIMES_2;return f}},{key:"angle",value:function(){if(arguments.length===1){var f=arguments[0];return Math.atan2(f.y,f.x)}if(arguments.length===2){var d=arguments[0],S=arguments[1],N=S.x-d.x,X=S.y-d.y;return Math.atan2(X,N)}}},{key:"isAcute",value:function(f,d,S){var N=f.x-d.x,X=f.y-d.y;return N*(S.x-d.x)+X*(S.y-d.y)>0}},{key:"isObtuse",value:function(f,d,S){var N=f.x-d.x,X=f.y-d.y;return N*(S.x-d.x)+X*(S.y-d.y)<0}},{key:"interiorAngle",value:function(f,d,S){var N=E.angle(d,f),X=E.angle(d,S);return Math.abs(X-N)}},{key:"normalizePositive",value:function(f){if(f<0){for(;f<0;)f+=E.PI_TIMES_2;f>=E.PI_TIMES_2&&(f=0)}else{for(;f>=E.PI_TIMES_2;)f-=E.PI_TIMES_2;f<0&&(f=0)}return f}},{key:"angleBetween",value:function(f,d,S){var N=E.angle(d,f),X=E.angle(d,S);return E.diff(N,X)}},{key:"diff",value:function(f,d){var S=null;return(S=f<d?d-f:f-d)>Math.PI&&(S=2*Math.PI-S),S}},{key:"toRadians",value:function(f){return f*Math.PI/180}},{key:"getTurn",value:function(f,d){var S=Math.sin(d-f);return S>0?E.COUNTERCLOCKWISE:S<0?E.CLOCKWISE:E.NONE}},{key:"angleBetweenOriented",value:function(f,d,S){var N=E.angle(d,f),X=E.angle(d,S)-N;return X<=-Math.PI?X+E.PI_TIMES_2:X>Math.PI?X-E.PI_TIMES_2:X}}])})();zs.PI_TIMES_2=2*Math.PI,zs.PI_OVER_2=Math.PI/2,zs.PI_OVER_4=Math.PI/4,zs.COUNTERCLOCKWISE=Xn.COUNTERCLOCKWISE,zs.CLOCKWISE=Xn.CLOCKWISE,zs.NONE=Xn.COLLINEAR;var Fl=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"addNextSegment",value:function(f,d){if(this._s0=this._s1,this._s1=this._s2,this._s2=f,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var S=Xn.index(this._s0,this._s1,this._s2),N=S===Xn.CLOCKWISE&&this._side===$t.LEFT||S===Xn.COUNTERCLOCKWISE&&this._side===$t.RIGHT;S===0?this.addCollinear(d):N?this.addOutsideTurn(S,d):this.addInsideTurn(S,d)}},{key:"addLineEndCap",value:function(f,d){var S=new oi(f,d),N=new oi;this.computeOffsetSegment(S,$t.LEFT,this._distance,N);var X=new oi;this.computeOffsetSegment(S,$t.RIGHT,this._distance,X);var he=d.x-f.x,Ae=d.y-f.y,Ye=Math.atan2(Ae,he);switch(this._bufParams.getEndCapStyle()){case ve.CAP_ROUND:this._segList.addPt(N.p1),this.addDirectedFillet(d,Ye+Math.PI/2,Ye-Math.PI/2,Xn.CLOCKWISE,this._distance),this._segList.addPt(X.p1);break;case ve.CAP_FLAT:this._segList.addPt(N.p1),this._segList.addPt(X.p1);break;case ve.CAP_SQUARE:var bt=new Oe;bt.x=Math.abs(this._distance)*Math.cos(Ye),bt.y=Math.abs(this._distance)*Math.sin(Ye);var an=new Oe(N.p1.x+bt.x,N.p1.y+bt.y),mn=new Oe(X.p1.x+bt.x,X.p1.y+bt.y);this._segList.addPt(an),this._segList.addPt(mn)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(f,d,S,N){var X=wi.intersection(d.p0,d.p1,S.p0,S.p1);if(X!==null&&(N<=0?1:X.distance(f)/Math.abs(N))<=this._bufParams.getMitreLimit())return this._segList.addPt(X),null;this.addLimitedMitreJoin(d,S,N,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(f,d){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*E.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===ve.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===ve.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(d&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,f,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(f){this._segList.addPt(new Oe(f.x+this._distance,f.y+this._distance)),this._segList.addPt(new Oe(f.x+this._distance,f.y-this._distance)),this._segList.addPt(new Oe(f.x-this._distance,f.y-this._distance)),this._segList.addPt(new Oe(f.x-this._distance,f.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(f,d){this._segList.addPts(f,d)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(f,d,S,N,X){var he=d.x-f.x,Ae=d.y-f.y,Ye=Math.atan2(Ae,he),bt=S.x-f.x,an=S.y-f.y,mn=Math.atan2(an,bt);N===Xn.CLOCKWISE?Ye<=mn&&(Ye+=2*Math.PI):Ye>=mn&&(Ye-=2*Math.PI),this._segList.addPt(d),this.addDirectedFillet(f,Ye,mn,N,X),this._segList.addPt(S)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(f,d,S){this._s1=f,this._s2=d,this._side=S,this._seg1.setCoordinates(f,d),this.computeOffsetSegment(this._seg1,S,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(f,d,S,N){var X=this._seg0.p1,he=zs.angle(X,this._seg0.p0),Ae=zs.angleBetweenOriented(this._seg0.p0,X,this._seg1.p1)/2,Ye=zs.normalize(he+Ae),bt=zs.normalize(Ye+Math.PI),an=N*S,mn=S-an*Math.abs(Math.sin(Ae)),Kn=X.x+an*Math.cos(bt),Pr=X.y+an*Math.sin(bt),Yr=new Oe(Kn,Pr),yi=new oi(X,Yr),Ms=yi.pointAlongOffset(1,mn),Xi=yi.pointAlongOffset(1,-mn);this._side===$t.LEFT?(this._segList.addPt(Ms),this._segList.addPt(Xi)):(this._segList.addPt(Xi),this._segList.addPt(Ms))}},{key:"addDirectedFillet",value:function(f,d,S,N,X){var he=N===Xn.CLOCKWISE?-1:1,Ae=Math.abs(d-S),Ye=Math.trunc(Ae/this._filletAngleQuantum+.5);if(Ye<1)return null;for(var bt=Ae/Ye,an=new Oe,mn=0;mn<Ye;mn++){var Kn=d+he*mn*bt;an.x=f.x+X*Math.cos(Kn),an.y=f.y+X*Math.sin(Kn),this._segList.addPt(an)}}},{key:"computeOffsetSegment",value:function(f,d,S,N){var X=d===$t.LEFT?1:-1,he=f.p1.x-f.p0.x,Ae=f.p1.y-f.p0.y,Ye=Math.sqrt(he*he+Ae*Ae),bt=X*S*he/Ye,an=X*S*Ae/Ye;N.p0.x=f.p0.x-an,N.p0.y=f.p0.y+bt,N.p1.x=f.p1.x-an,N.p1.y=f.p1.y+bt}},{key:"addInsideTurn",value:function(f,d){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*E.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var S=new Oe((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(S);var N=new Oe((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(N)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(f){var d=new Oe(f.x+this._distance,f.y);this._segList.addPt(d),this.addDirectedFillet(f,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(f,d){this._segList.addPt(f.p1),this._segList.addPt(d.p0)}},{key:"init",value:function(f){this._distance=f,this._maxCurveSegmentError=f*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new io,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(f*E.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(f){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===ve.JOIN_BEVEL||this._bufParams.getJoinStyle()===ve.JOIN_MITRE?(f&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,Xn.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new oi,this._seg1=new oi,this._offset0=new oi,this._offset1=new oi,this._side=0,this._hasNarrowConcaveAngle=!1;var f=arguments[0],d=arguments[1],S=arguments[2];this._precisionModel=f,this._bufParams=d,this._li=new Ha,this._filletAngleQuantum=Math.PI/2/d.getQuadrantSegments(),d.getQuadrantSegments()>=8&&d.getJoinStyle()===ve.JOIN_ROUND&&(this._closingSegLengthFactor=E.MAX_CLOSING_SEG_LEN_FACTOR),this.init(S)}}])})();Fl.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Fl.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Fl.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Fl.MAX_CLOSING_SEG_LEN_FACTOR=80;var gl=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"getOffsetCurve",value:function(f,d){if(this._distance=d,d===0)return null;var S=d<0,N=Math.abs(d),X=this.getSegGen(N);f.length<=1?this.computePointCurve(f[0],X):this.computeOffsetCurve(f,S,X);var he=X.getCoordinates();return S&&di.reverse(he),he}},{key:"computeSingleSidedBufferCurve",value:function(f,d,S){var N=this.simplifyTolerance(this._distance);if(d){S.addSegments(f,!0);var X=Ns.simplify(f,-N),he=X.length-1;S.initSideSegments(X[he],X[he-1],$t.LEFT),S.addFirstSegment();for(var Ae=he-2;Ae>=0;Ae--)S.addNextSegment(X[Ae],!0)}else{S.addSegments(f,!1);var Ye=Ns.simplify(f,N),bt=Ye.length-1;S.initSideSegments(Ye[0],Ye[1],$t.LEFT),S.addFirstSegment();for(var an=2;an<=bt;an++)S.addNextSegment(Ye[an],!0)}S.addLastSegment(),S.closeRing()}},{key:"computeRingBufferCurve",value:function(f,d,S){var N=this.simplifyTolerance(this._distance);d===$t.RIGHT&&(N=-N);var X=Ns.simplify(f,N),he=X.length-1;S.initSideSegments(X[he-1],X[0],d);for(var Ae=1;Ae<=he;Ae++){var Ye=Ae!==1;S.addNextSegment(X[Ae],Ye)}S.closeRing()}},{key:"computeLineBufferCurve",value:function(f,d){var S=this.simplifyTolerance(this._distance),N=Ns.simplify(f,S),X=N.length-1;d.initSideSegments(N[0],N[1],$t.LEFT);for(var he=2;he<=X;he++)d.addNextSegment(N[he],!0);d.addLastSegment(),d.addLineEndCap(N[X-1],N[X]);var Ae=Ns.simplify(f,-S),Ye=Ae.length-1;d.initSideSegments(Ae[Ye],Ae[Ye-1],$t.LEFT);for(var bt=Ye-2;bt>=0;bt--)d.addNextSegment(Ae[bt],!0);d.addLastSegment(),d.addLineEndCap(Ae[1],Ae[0]),d.closeRing()}},{key:"computePointCurve",value:function(f,d){switch(this._bufParams.getEndCapStyle()){case ve.CAP_ROUND:d.createCircle(f);break;case ve.CAP_SQUARE:d.createSquare(f)}}},{key:"getLineCurve",value:function(f,d){if(this._distance=d,this.isLineOffsetEmpty(d))return null;var S=Math.abs(d),N=this.getSegGen(S);if(f.length<=1)this.computePointCurve(f[0],N);else if(this._bufParams.isSingleSided()){var X=d<0;this.computeSingleSidedBufferCurve(f,X,N)}else this.computeLineBufferCurve(f,N);return N.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(f){return f*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(f,d,S){if(this._distance=S,f.length<=2)return this.getLineCurve(f,S);if(S===0)return E.copyCoordinates(f);var N=this.getSegGen(S);return this.computeRingBufferCurve(f,d,N),N.getCoordinates()}},{key:"computeOffsetCurve",value:function(f,d,S){var N=this.simplifyTolerance(this._distance);if(d){var X=Ns.simplify(f,-N),he=X.length-1;S.initSideSegments(X[he],X[he-1],$t.LEFT),S.addFirstSegment();for(var Ae=he-2;Ae>=0;Ae--)S.addNextSegment(X[Ae],!0)}else{var Ye=Ns.simplify(f,N),bt=Ye.length-1;S.initSideSegments(Ye[0],Ye[1],$t.LEFT),S.addFirstSegment();for(var an=2;an<=bt;an++)S.addNextSegment(Ye[an],!0)}S.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(f){return f===0||f<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(f){return new Fl(this._precisionModel,this._bufParams,f)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var f=arguments[0],d=arguments[1];this._precisionModel=f,this._bufParams=d}},{key:"copyCoordinates",value:function(f){for(var d=new Array(f.length).fill(null),S=0;S<d.length;S++)d[S]=new Oe(f[S]);return d}}])})(),O=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var E=arguments[0],f=new or,d=this._subgraphs.iterator();d.hasNext();){var S=d.next(),N=S.getEnvelope();E.y<N.getMinY()||E.y>N.getMaxY()||this.findStabbedSegments(E,S.getDirectedEdges(),f)}return f}if(arguments.length===3){if(yn(arguments[2],ni)&&arguments[0]instanceof Oe&&arguments[1]instanceof ro){for(var X=arguments[0],he=arguments[1],Ae=arguments[2],Ye=he.getEdge().getCoordinates(),bt=0;bt<Ye.length-1;bt++)if(this._seg.p0=Ye[bt],this._seg.p1=Ye[bt+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<X.x||this._seg.isHorizontal()||X.y<this._seg.p0.y||X.y>this._seg.p1.y||Xn.index(this._seg.p0,this._seg.p1,X)===Xn.RIGHT)){var an=he.getDepth($t.LEFT);this._seg.p0.equals(Ye[bt])||(an=he.getDepth($t.RIGHT));var mn=new me(this._seg,an);Ae.add(mn)}}else if(yn(arguments[2],ni)&&arguments[0]instanceof Oe&&yn(arguments[1],ni))for(var Kn=arguments[0],Pr=arguments[2],Yr=arguments[1].iterator();Yr.hasNext();){var yi=Yr.next();yi.isForward()&&this.findStabbedSegments(Kn,yi,Pr)}}}},{key:"getDepth",value:function(E){var f=this.findStabbedSegments(E);return f.size()===0?0:Lo.min(f)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new oi;var E=arguments[0];this._subgraphs=E}}])})(),me=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"compareTo",value:function(E){var f=E;if(this._upwardSeg.minX()>=f._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=f._upwardSeg.minX())return-1;var d=this._upwardSeg.orientationIndex(f._upwardSeg);return d!==0||(d=-1*f._upwardSeg.orientationIndex(this._upwardSeg))!==0?d:this._upwardSeg.compareTo(f._upwardSeg)}},{key:"compareX",value:function(E,f){var d=E.p0.compareTo(f.p0);return d!==0?d:E.p1.compareTo(f.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[_e]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var E=arguments[0],f=arguments[1];this._upwardSeg=new oi(E),this._leftDepth=f}}])})();O.DepthSegment=me;var ke=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,null,[{key:"constructor_",value:function(){de.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])})(de),nt=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"getY",value:function(){var f=this.y/this.w;if(Ke.isNaN(f)||Ke.isInfinite(f))throw new ke;return f}},{key:"getX",value:function(){var f=this.x/this.w;if(Ke.isNaN(f)||Ke.isInfinite(f))throw new ke;return f}},{key:"getCoordinate",value:function(){var f=new Oe;return f.x=this.getX(),f.y=this.getY(),f}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var f=arguments[0];this.x=f.x,this.y=f.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var d=arguments[0],S=arguments[1];this.x=d,this.y=S,this.w=1}else if(arguments[0]instanceof E&&arguments[1]instanceof E){var N=arguments[0],X=arguments[1];this.x=N.y*X.w-X.y*N.w,this.y=X.x*N.w-N.x*X.w,this.w=N.x*X.y-X.x*N.y}else if(arguments[0]instanceof Oe&&arguments[1]instanceof Oe){var he=arguments[0],Ae=arguments[1];this.x=he.y-Ae.y,this.y=Ae.x-he.x,this.w=he.x*Ae.y-Ae.x*he.y}}else if(arguments.length===3){var Ye=arguments[0],bt=arguments[1],an=arguments[2];this.x=Ye,this.y=bt,this.w=an}else if(arguments.length===4){var mn=arguments[0],Kn=arguments[1],Pr=arguments[2],Yr=arguments[3],yi=mn.y-Kn.y,Ms=Kn.x-mn.x,Xi=mn.x*Kn.y-Kn.x*mn.y,Ds=Pr.y-Yr.y,As=Yr.x-Pr.x,Xo=Pr.x*Yr.y-Yr.x*Pr.y;this.x=Ms*Xo-As*Xi,this.y=Ds*Xi-yi*Xo,this.w=yi*As-Ds*Ms}}}])})(),hn=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"area",value:function(){return E.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return E.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(f){if(f===null)throw new Pe("Supplied point is null.");return E.interpolateZ(f,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return E.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return E.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return E.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return E.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return E.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return E.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var f=arguments[0],d=arguments[1],S=arguments[2];this.p0=f,this.p1=d,this.p2=S}},{key:"area",value:function(f,d,S){return Math.abs(((S.x-f.x)*(d.y-f.y)-(d.x-f.x)*(S.y-f.y))/2)}},{key:"signedArea",value:function(f,d,S){return((S.x-f.x)*(d.y-f.y)-(d.x-f.x)*(S.y-f.y))/2}},{key:"det",value:function(f,d,S,N){return f*N-d*S}},{key:"interpolateZ",value:function(f,d,S,N){var X=d.x,he=d.y,Ae=S.x-X,Ye=N.x-X,bt=S.y-he,an=N.y-he,mn=Ae*an-Ye*bt,Kn=f.x-X,Pr=f.y-he,Yr=(an*Kn-Ye*Pr)/mn,yi=(-bt*Kn+Ae*Pr)/mn;return d.getZ()+Yr*(S.getZ()-d.getZ())+yi*(N.getZ()-d.getZ())}},{key:"longestSideLength",value:function(f,d,S){var N=f.distance(d),X=d.distance(S),he=S.distance(f),Ae=N;return X>Ae&&(Ae=X),he>Ae&&(Ae=he),Ae}},{key:"circumcentreDD",value:function(f,d,S){var N=qn.valueOf(f.x).subtract(S.x),X=qn.valueOf(f.y).subtract(S.y),he=qn.valueOf(d.x).subtract(S.x),Ae=qn.valueOf(d.y).subtract(S.y),Ye=qn.determinant(N,X,he,Ae).multiply(2),bt=N.sqr().add(X.sqr()),an=he.sqr().add(Ae.sqr()),mn=qn.determinant(X,bt,Ae,an),Kn=qn.determinant(N,bt,he,an),Pr=qn.valueOf(S.x).subtract(mn.divide(Ye)).doubleValue(),Yr=qn.valueOf(S.y).add(Kn.divide(Ye)).doubleValue();return new Oe(Pr,Yr)}},{key:"isAcute",value:function(f,d,S){return!!zs.isAcute(f,d,S)&&!!zs.isAcute(d,S,f)&&!!zs.isAcute(S,f,d)}},{key:"circumcentre",value:function(f,d,S){var N=S.x,X=S.y,he=f.x-N,Ae=f.y-X,Ye=d.x-N,bt=d.y-X,an=2*E.det(he,Ae,Ye,bt),mn=E.det(Ae,he*he+Ae*Ae,bt,Ye*Ye+bt*bt),Kn=E.det(he,he*he+Ae*Ae,Ye,Ye*Ye+bt*bt);return new Oe(N-mn/an,X+Kn/an)}},{key:"perpendicularBisector",value:function(f,d){var S=d.x-f.x,N=d.y-f.y,X=new nt(f.x+S/2,f.y+N/2,1),he=new nt(f.x-N+S/2,f.y+S+N/2,1);return new nt(X,he)}},{key:"angleBisector",value:function(f,d,S){var N=d.distance(f),X=N/(N+d.distance(S)),he=S.x-f.x,Ae=S.y-f.y;return new Oe(f.x+X*he,f.y+X*Ae)}},{key:"area3D",value:function(f,d,S){var N=d.x-f.x,X=d.y-f.y,he=d.getZ()-f.getZ(),Ae=S.x-f.x,Ye=S.y-f.y,bt=S.getZ()-f.getZ(),an=X*bt-he*Ye,mn=he*Ae-N*bt,Kn=N*Ye-X*Ae,Pr=an*an+mn*mn+Kn*Kn,Yr=Math.sqrt(Pr)/2;return Yr}},{key:"centroid",value:function(f,d,S){var N=(f.x+d.x+S.x)/3,X=(f.y+d.y+S.y)/3;return new Oe(N,X)}},{key:"inCentre",value:function(f,d,S){var N=d.distance(S),X=f.distance(S),he=f.distance(d),Ae=N+X+he,Ye=(N*f.x+X*d.x+he*S.x)/Ae,bt=(N*f.y+X*d.y+he*S.y)/Ae;return new Oe(Ye,bt)}}])})(),Cn=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"addRingSide",value:function(E,f,d,S,N){if(f===0&&E.length<vo.MINIMUM_VALID_SIZE)return null;var X=S,he=N;E.length>=vo.MINIMUM_VALID_SIZE&&Xn.isCCW(E)&&(X=N,he=S,d=$t.opposite(d));var Ae=this._curveBuilder.getRingCurve(E,d,f);this.addCurve(Ae,X,he)}},{key:"addRingBothSides",value:function(E,f){this.addRingSide(E,f,$t.LEFT,Ze.EXTERIOR,Ze.INTERIOR),this.addRingSide(E,f,$t.RIGHT,Ze.INTERIOR,Ze.EXTERIOR)}},{key:"addPoint",value:function(E){if(this._distance<=0)return null;var f=E.getCoordinates(),d=this._curveBuilder.getLineCurve(f,this._distance);this.addCurve(d,Ze.EXTERIOR,Ze.INTERIOR)}},{key:"addPolygon",value:function(E){var f=this._distance,d=$t.LEFT;this._distance<0&&(f=-this._distance,d=$t.RIGHT);var S=E.getExteriorRing(),N=di.removeRepeatedPoints(S.getCoordinates());if(this._distance<0&&this.isErodedCompletely(S,this._distance)||this._distance<=0&&N.length<3)return null;this.addRingSide(N,f,d,Ze.EXTERIOR,Ze.INTERIOR);for(var X=0;X<E.getNumInteriorRing();X++){var he=E.getInteriorRingN(X),Ae=di.removeRepeatedPoints(he.getCoordinates());this._distance>0&&this.isErodedCompletely(he,-this._distance)||this.addRingSide(Ae,f,$t.opposite(d),Ze.INTERIOR,Ze.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(E,f){var d=new hn(E[0],E[1],E[2]),S=d.inCentre();return Ne.pointToSegment(S,d.p0,d.p1)<Math.abs(f)}},{key:"addLineString",value:function(E){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var f=di.removeRepeatedPoints(E.getCoordinates());if(di.isRing(f)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(f,this._distance);else{var d=this._curveBuilder.getLineCurve(f,this._distance);this.addCurve(d,Ze.EXTERIOR,Ze.INTERIOR)}}},{key:"addCurve",value:function(E,f,d){if(E===null||E.length<2)return null;var S=new Qr(E,new bo(0,Ze.BOUNDARY,f,d));this._curveList.add(S)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(E){if(E.isEmpty())return null;if(E instanceof Br)this.addPolygon(E);else if(E instanceof Pn)this.addLineString(E);else if(E instanceof Fn)this.addPoint(E);else if(E instanceof ps)this.addCollection(E);else if(E instanceof ta)this.addCollection(E);else if(E instanceof uo)this.addCollection(E);else{if(!(E instanceof cs))throw new mt(E.getGeometryType());this.addCollection(E)}}},{key:"isErodedCompletely",value:function(E,f){var d=E.getCoordinates();if(d.length<4)return f<0;if(d.length===4)return this.isTriangleErodedCompletely(d,f);var S=E.getEnvelopeInternal(),N=Math.min(S.getHeight(),S.getWidth());return f<0&&2*Math.abs(f)>N}},{key:"addCollection",value:function(E){for(var f=0;f<E.getNumGeometries();f++){var d=E.getGeometryN(f);this.add(d)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new or;var E=arguments[0],f=arguments[1],d=arguments[2];this._inputGeom=E,this._distance=f,this._curveBuilder=d}}])})(),Sr=(function(){return y((function E(){a(this,E)}),[{key:"locate",value:function(E){}}])})(),Rs=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,E.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new on;var f=this._parent.getGeometryN(this._index++);return f instanceof cs?(this._subcollectionIterator=new E(f),this._subcollectionIterator.next()):f}},{key:"remove",value:function(){throw new mt(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[kt]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var f=arguments[0];this._parent=f,this._atStart=!0,this._index=0,this._max=f.getNumGeometries()}},{key:"isAtomic",value:function(f){return!(f instanceof cs)}}])})(),so=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"locate",value:function(f){return E.locate(f,this._geom)}},{key:"interfaces_",get:function(){return[Sr]}}],[{key:"constructor_",value:function(){this._geom=null;var f=arguments[0];this._geom=f}},{key:"locatePointInPolygon",value:function(f,d){if(d.isEmpty())return Ze.EXTERIOR;var S=d.getExteriorRing(),N=E.locatePointInRing(f,S);if(N!==Ze.INTERIOR)return N;for(var X=0;X<d.getNumInteriorRing();X++){var he=d.getInteriorRingN(X),Ae=E.locatePointInRing(f,he);if(Ae===Ze.BOUNDARY)return Ze.BOUNDARY;if(Ae===Ze.INTERIOR)return Ze.EXTERIOR}return Ze.INTERIOR}},{key:"locatePointInRing",value:function(f,d){return d.getEnvelopeInternal().intersects(f)?Vo.locateInRing(f,d.getCoordinates()):Ze.EXTERIOR}},{key:"containsPointInPolygon",value:function(f,d){return Ze.EXTERIOR!==E.locatePointInPolygon(f,d)}},{key:"locateInGeometry",value:function(f,d){if(d instanceof Br)return E.locatePointInPolygon(f,d);if(d instanceof cs)for(var S=new Rs(d);S.hasNext();){var N=S.next();if(N!==d){var X=E.locateInGeometry(f,N);if(X!==Ze.EXTERIOR)return X}}return Ze.EXTERIOR}},{key:"isContained",value:function(f,d){return Ze.EXTERIOR!==E.locate(f,d)}},{key:"locate",value:function(f,d){return d.isEmpty()?Ze.EXTERIOR:d.getEnvelopeInternal().intersects(f)?E.locateInGeometry(f,d):Ze.EXTERIOR}}])})(),hs=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"getNextCW",value:function(E){this.getEdges();var f=this._edgeList.indexOf(E),d=f-1;return f===0&&(d=this._edgeList.size()-1),this._edgeList.get(d)}},{key:"propagateSideLabels",value:function(E){for(var f=Ze.NONE,d=this.iterator();d.hasNext();){var S=d.next().getLabel();S.isArea(E)&&S.getLocation(E,$t.LEFT)!==Ze.NONE&&(f=S.getLocation(E,$t.LEFT))}if(f===Ze.NONE)return null;for(var N=f,X=this.iterator();X.hasNext();){var he=X.next(),Ae=he.getLabel();if(Ae.getLocation(E,$t.ON)===Ze.NONE&&Ae.setLocation(E,$t.ON,N),Ae.isArea(E)){var Ye=Ae.getLocation(E,$t.LEFT),bt=Ae.getLocation(E,$t.RIGHT);if(bt!==Ze.NONE){if(bt!==N)throw new bi("side location conflict",he.getCoordinate());Ye===Ze.NONE&&Ve.shouldNeverReachHere("found single null side (at "+he.getCoordinate()+")"),N=Ye}else Ve.isTrue(Ae.getLocation(E,$t.LEFT)===Ze.NONE,"found single null side"),Ae.setLocation(E,$t.RIGHT,N),Ae.setLocation(E,$t.LEFT,N)}}}},{key:"getCoordinate",value:function(){var E=this.iterator();return E.hasNext()?E.next().getCoordinate():null}},{key:"print",value:function(E){si.out.println("EdgeEndStar:   "+this.getCoordinate());for(var f=this.iterator();f.hasNext();)f.next().print(E)}},{key:"isAreaLabelsConsistent",value:function(E){return this.computeEdgeEndLabels(E.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(E){var f=this.getEdges();if(f.size()<=0)return!0;var d=f.size()-1,S=f.get(d).getLabel().getLocation(E,$t.LEFT);Ve.isTrue(S!==Ze.NONE,"Found unlabelled area edge");for(var N=S,X=this.iterator();X.hasNext();){var he=X.next().getLabel();Ve.isTrue(he.isArea(E),"Found non-area edge");var Ae=he.getLocation(E,$t.LEFT),Ye=he.getLocation(E,$t.RIGHT);if(Ae===Ye||Ye!==N)return!1;N=Ae}return!0}},{key:"findIndex",value:function(E){this.iterator();for(var f=0;f<this._edgeList.size();f++)if(this._edgeList.get(f)===E)return f;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new or(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(E,f,d){return this._ptInAreaLocation[E]===Ze.NONE&&(this._ptInAreaLocation[E]=so.locate(f,d[E].getGeometry())),this._ptInAreaLocation[E]}},{key:"toString",value:function(){var E=new sr;E.append("EdgeEndStar:   "+this.getCoordinate()),E.append(`
`);for(var f=this.iterator();f.hasNext();){var d=f.next();E.append(d),E.append(`
`)}return E.toString()}},{key:"computeEdgeEndLabels",value:function(E){for(var f=this.iterator();f.hasNext();)f.next().computeLabel(E)}},{key:"computeLabelling",value:function(E){this.computeEdgeEndLabels(E[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var f=[!1,!1],d=this.iterator();d.hasNext();)for(var S=d.next().getLabel(),N=0;N<2;N++)S.isLine(N)&&S.getLocation(N)===Ze.BOUNDARY&&(f[N]=!0);for(var X=this.iterator();X.hasNext();)for(var he=X.next(),Ae=he.getLabel(),Ye=0;Ye<2;Ye++)if(Ae.isAnyNull(Ye)){var bt=Ze.NONE;if(f[Ye])bt=Ze.EXTERIOR;else{var an=he.getCoordinate();bt=this.getLocation(Ye,an,E)}Ae.setAllLocationsIfNull(Ye,bt)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(E,f){this._edgeMap.put(E,f),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new ha,this._edgeList=null,this._ptInAreaLocation=[Ze.NONE,Ze.NONE]}}])})(),es=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var d=null,S=null,N=this._SCANNING_FOR_INCOMING,X=0;X<this._resultAreaEdgeList.size();X++){var he=this._resultAreaEdgeList.get(X),Ae=he.getSym();if(he.getLabel().isArea())switch(d===null&&he.isInResult()&&(d=he),N){case this._SCANNING_FOR_INCOMING:if(!Ae.isInResult())continue;S=Ae,N=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!he.isInResult())continue;S.setNext(he),N=this._SCANNING_FOR_INCOMING}}if(N===this._LINKING_TO_OUTGOING){if(d===null)throw new bi("no outgoing dirEdge found",this.getCoordinate());Ve.isTrue(d.isInResult(),"unable to link last incoming dirEdge"),S.setNext(d)}}},{key:"insert",value:function(d){var S=d;this.insertEdgeEnd(S,S)}},{key:"getRightmostEdge",value:function(){var d=this.getEdges(),S=d.size();if(S<1)return null;var N=d.get(0);if(S===1)return N;var X=d.get(S-1),he=N.getQuadrant(),Ae=X.getQuadrant();return os.isNorthern(he)&&os.isNorthern(Ae)?N:os.isNorthern(he)||os.isNorthern(Ae)?N.getDy()!==0?N:X.getDy()!==0?X:(Ve.shouldNeverReachHere("found two horizontal edges incident on node"),null):X}},{key:"print",value:function(d){si.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var S=this.iterator();S.hasNext();){var N=S.next();d.print("out "),N.print(d),d.println(),d.print("in "),N.getSym().print(d),d.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new or;for(var d=this.iterator();d.hasNext();){var S=d.next();(S.isInResult()||S.getSym().isInResult())&&this._resultAreaEdgeList.add(S)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(d){for(var S=this.iterator();S.hasNext();){var N=S.next().getLabel();N.setAllLocationsIfNull(0,d.getLocation(0)),N.setAllLocationsIfNull(1,d.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var d=null,S=null,N=this._edgeList.size()-1;N>=0;N--){var X=this._edgeList.get(N),he=X.getSym();S===null&&(S=he),d!==null&&he.setNext(d),d=X}S.setNext(d)}},{key:"computeDepths",value:function(){if(arguments.length===1){var d=arguments[0],S=this.findIndex(d),N=d.getDepth($t.LEFT),X=d.getDepth($t.RIGHT),he=this.computeDepths(S+1,this._edgeList.size(),N);if(this.computeDepths(0,S,he)!==X)throw new bi("depth mismatch at "+d.getCoordinate())}else if(arguments.length===3){for(var Ae=arguments[1],Ye=arguments[2],bt=arguments[0];bt<Ae;bt++){var an=this._edgeList.get(bt);an.setEdgeDepths($t.RIGHT,Ye),Ye=an.getDepth($t.LEFT)}return Ye}}},{key:"mergeSymLabels",value:function(){for(var d=this.iterator();d.hasNext();){var S=d.next();S.getLabel().merge(S.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(d){for(var S=null,N=null,X=this._SCANNING_FOR_INCOMING,he=this._resultAreaEdgeList.size()-1;he>=0;he--){var Ae=this._resultAreaEdgeList.get(he),Ye=Ae.getSym();switch(S===null&&Ae.getEdgeRing()===d&&(S=Ae),X){case this._SCANNING_FOR_INCOMING:if(Ye.getEdgeRing()!==d)continue;N=Ye,X=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(Ae.getEdgeRing()!==d)continue;N.setNextMin(Ae),X=this._SCANNING_FOR_INCOMING}}X===this._LINKING_TO_OUTGOING&&(Ve.isTrue(S!==null,"found null for first outgoing dirEdge"),Ve.isTrue(S.getEdgeRing()===d,"unable to link last incoming dirEdge"),N.setNextMin(S))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var d=0,S=this.iterator();S.hasNext();)S.next().isInResult()&&d++;return d}if(arguments.length===1){for(var N=arguments[0],X=0,he=this.iterator();he.hasNext();)he.next().getEdgeRing()===N&&X++;return X}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var d=Ze.NONE,S=this.iterator();S.hasNext();){var N=S.next(),X=N.getSym();if(!N.isLineEdge()){if(N.isInResult()){d=Ze.INTERIOR;break}if(X.isInResult()){d=Ze.EXTERIOR;break}}}if(d===Ze.NONE)return null;for(var he=d,Ae=this.iterator();Ae.hasNext();){var Ye=Ae.next(),bt=Ye.getSym();Ye.isLineEdge()?Ye.getEdge().setCovered(he===Ze.INTERIOR):(Ye.isInResult()&&(he=Ze.EXTERIOR),bt.isInResult()&&(he=Ze.INTERIOR))}}},{key:"computeLabelling",value:function(d){Q(f,"computeLabelling",this,1).call(this,d),this._label=new bo(Ze.NONE);for(var S=this.iterator();S.hasNext();)for(var N=S.next().getEdge().getLabel(),X=0;X<2;X++){var he=N.getLocation(X);he!==Ze.INTERIOR&&he!==Ze.BOUNDARY||this._label.setLocation(X,Ze.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])})(hs),Js=(function(E){function f(){return a(this,f),i(this,f)}return R(f,E),y(f,[{key:"createNode",value:function(d){return new Pu(d,new es)}}])})(ya),da=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"compareTo",value:function(f){var d=f;return E.compareOriented(this._pts,this._orientation,d._pts,d._orientation)}},{key:"interfaces_",get:function(){return[_e]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var f=arguments[0];this._pts=f,this._orientation=E.orientation(f)}},{key:"orientation",value:function(f){return di.increasingDirection(f)===1}},{key:"compareOriented",value:function(f,d,S,N){for(var X=d?1:-1,he=N?1:-1,Ae=d?f.length:-1,Ye=N?S.length:-1,bt=d?0:f.length-1,an=N?0:S.length-1;;){var mn=f[bt].compareTo(S[an]);if(mn!==0)return mn;var Kn=(bt+=X)===Ae,Pr=(an+=he)===Ye;if(Kn&&!Pr)return-1;if(!Kn&&Pr)return 1;if(Kn&&Pr)return 0}}}])})(),oo=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"print",value:function(E){E.print("MULTILINESTRING ( ");for(var f=0;f<this._edges.size();f++){var d=this._edges.get(f);f>0&&E.print(","),E.print("(");for(var S=d.getCoordinates(),N=0;N<S.length;N++)N>0&&E.print(","),E.print(S[N].x+" "+S[N].y);E.println(")")}E.print(")  ")}},{key:"addAll",value:function(E){for(var f=E.iterator();f.hasNext();)this.add(f.next())}},{key:"findEdgeIndex",value:function(E){for(var f=0;f<this._edges.size();f++)if(this._edges.get(f).equals(E))return f;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(E){return this._edges.get(E)}},{key:"findEqualEdge",value:function(E){var f=new da(E.getCoordinates());return this._ocaMap.get(f)}},{key:"add",value:function(E){this._edges.add(E);var f=new da(E.getCoordinates());this._ocaMap.put(f,E)}}],[{key:"constructor_",value:function(){this._edges=new or,this._ocaMap=new ha}}])})(),Vi=(function(){return y((function E(){a(this,E)}),[{key:"processIntersections",value:function(E,f,d,S){}},{key:"isDone",value:function(){}}])})(),Zl=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"isTrivialIntersection",value:function(f,d,S,N){if(f===S&&this._li.getIntersectionNum()===1){if(E.isAdjacentSegments(d,N))return!0;if(f.isClosed()){var X=f.size()-1;if(d===0&&N===X||N===0&&d===X)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(f,d,S,N){if(f===S&&d===N)return null;this.numTests++;var X=f.getCoordinates()[d],he=f.getCoordinates()[d+1],Ae=S.getCoordinates()[N],Ye=S.getCoordinates()[N+1];this._li.computeIntersection(X,he,Ae,Ye),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(f,d,S,N)||(this._hasIntersection=!0,f.addIntersections(this._li,d,0),S.addIntersections(this._li,N,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Vi]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var f=arguments[0];this._li=f}},{key:"isAdjacentSegments",value:function(f,d){return Math.abs(f-d)===1}}])})(),xa=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(E){E.print(this.coord),E.print(" seg # = "+this.segmentIndex),E.println(" dist = "+this.dist)}},{key:"compareTo",value:function(E){var f=E;return this.compare(f.segmentIndex,f.dist)}},{key:"isEndPoint",value:function(E){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===E}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(E,f){return this.segmentIndex<E?-1:this.segmentIndex>E?1:this.dist<f?-1:this.dist>f?1:0}},{key:"interfaces_",get:function(){return[_e]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var E=arguments[0],f=arguments[1],d=arguments[2];this.coord=new Oe(E),this.segmentIndex=f,this.dist=d}}])})(),Rc=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"print",value:function(E){E.println("Intersections:");for(var f=this.iterator();f.hasNext();)f.next().print(E)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(E){this.addEndpoints();for(var f=this.iterator(),d=f.next();f.hasNext();){var S=f.next(),N=this.createSplitEdge(d,S);E.add(N),d=S}}},{key:"addEndpoints",value:function(){var E=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[E],E,0)}},{key:"createSplitEdge",value:function(E,f){var d=f.segmentIndex-E.segmentIndex+2,S=this.edge.pts[f.segmentIndex],N=f.dist>0||!f.coord.equals2D(S);N||d--;var X=new Array(d).fill(null),he=0;X[he++]=new Oe(E.coord);for(var Ae=E.segmentIndex+1;Ae<=f.segmentIndex;Ae++)X[he++]=this.edge.pts[Ae];return N&&(X[he]=f.coord),new yo(X,new bo(this.edge._label))}},{key:"add",value:function(E,f,d){var S=new xa(E,f,d),N=this._nodeMap.get(S);return N!==null?N:(this._nodeMap.put(S,S),S)}},{key:"isIntersection",value:function(E){for(var f=this.iterator();f.hasNext();)if(f.next().coord.equals(E))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new ha,this.edge=null;var E=arguments[0];this.edge=E}}])})(),Ru=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(E.isTrue(this._matrix[Ze.INTERIOR][Ze.INTERIOR])||E.isTrue(this._matrix[Ze.INTERIOR][Ze.BOUNDARY])||E.isTrue(this._matrix[Ze.BOUNDARY][Ze.INTERIOR])||E.isTrue(this._matrix[Ze.BOUNDARY][Ze.BOUNDARY]))&&this._matrix[Ze.EXTERIOR][Ze.INTERIOR]===Tt.FALSE&&this._matrix[Ze.EXTERIOR][Ze.BOUNDARY]===Tt.FALSE}},{key:"isCoveredBy",value:function(){return(E.isTrue(this._matrix[Ze.INTERIOR][Ze.INTERIOR])||E.isTrue(this._matrix[Ze.INTERIOR][Ze.BOUNDARY])||E.isTrue(this._matrix[Ze.BOUNDARY][Ze.INTERIOR])||E.isTrue(this._matrix[Ze.BOUNDARY][Ze.BOUNDARY]))&&this._matrix[Ze.INTERIOR][Ze.EXTERIOR]===Tt.FALSE&&this._matrix[Ze.BOUNDARY][Ze.EXTERIOR]===Tt.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var f=arguments[0],d=0;d<f.length;d++){var S=Math.trunc(d/3),N=d%3;this._matrix[S][N]=Tt.toDimensionValue(f.charAt(d))}else if(arguments.length===3){var X=arguments[0],he=arguments[1],Ae=arguments[2];this._matrix[X][he]=Ae}}},{key:"isContains",value:function(){return E.isTrue(this._matrix[Ze.INTERIOR][Ze.INTERIOR])&&this._matrix[Ze.EXTERIOR][Ze.INTERIOR]===Tt.FALSE&&this._matrix[Ze.EXTERIOR][Ze.BOUNDARY]===Tt.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var f=arguments[0],d=0;d<f.length;d++){var S=Math.trunc(d/3),N=d%3;this.setAtLeast(S,N,Tt.toDimensionValue(f.charAt(d)))}else if(arguments.length===3){var X=arguments[0],he=arguments[1],Ae=arguments[2];this._matrix[X][he]<Ae&&(this._matrix[X][he]=Ae)}}},{key:"setAtLeastIfValid",value:function(f,d,S){f>=0&&d>=0&&this.setAtLeast(f,d,S)}},{key:"isWithin",value:function(){return E.isTrue(this._matrix[Ze.INTERIOR][Ze.INTERIOR])&&this._matrix[Ze.INTERIOR][Ze.EXTERIOR]===Tt.FALSE&&this._matrix[Ze.BOUNDARY][Ze.EXTERIOR]===Tt.FALSE}},{key:"isTouches",value:function(f,d){return f>d?this.isTouches(d,f):(f===Tt.A&&d===Tt.A||f===Tt.L&&d===Tt.L||f===Tt.L&&d===Tt.A||f===Tt.P&&d===Tt.A||f===Tt.P&&d===Tt.L)&&this._matrix[Ze.INTERIOR][Ze.INTERIOR]===Tt.FALSE&&(E.isTrue(this._matrix[Ze.INTERIOR][Ze.BOUNDARY])||E.isTrue(this._matrix[Ze.BOUNDARY][Ze.INTERIOR])||E.isTrue(this._matrix[Ze.BOUNDARY][Ze.BOUNDARY]))}},{key:"isOverlaps",value:function(f,d){return f===Tt.P&&d===Tt.P||f===Tt.A&&d===Tt.A?E.isTrue(this._matrix[Ze.INTERIOR][Ze.INTERIOR])&&E.isTrue(this._matrix[Ze.INTERIOR][Ze.EXTERIOR])&&E.isTrue(this._matrix[Ze.EXTERIOR][Ze.INTERIOR]):f===Tt.L&&d===Tt.L&&this._matrix[Ze.INTERIOR][Ze.INTERIOR]===1&&E.isTrue(this._matrix[Ze.INTERIOR][Ze.EXTERIOR])&&E.isTrue(this._matrix[Ze.EXTERIOR][Ze.INTERIOR])}},{key:"isEquals",value:function(f,d){return f===d&&E.isTrue(this._matrix[Ze.INTERIOR][Ze.INTERIOR])&&this._matrix[Ze.INTERIOR][Ze.EXTERIOR]===Tt.FALSE&&this._matrix[Ze.BOUNDARY][Ze.EXTERIOR]===Tt.FALSE&&this._matrix[Ze.EXTERIOR][Ze.INTERIOR]===Tt.FALSE&&this._matrix[Ze.EXTERIOR][Ze.BOUNDARY]===Tt.FALSE}},{key:"toString",value:function(){for(var f=new Ss("123456789"),d=0;d<3;d++)for(var S=0;S<3;S++)f.setCharAt(3*d+S,Tt.toDimensionSymbol(this._matrix[d][S]));return f.toString()}},{key:"setAll",value:function(f){for(var d=0;d<3;d++)for(var S=0;S<3;S++)this._matrix[d][S]=f}},{key:"get",value:function(f,d){return this._matrix[f][d]}},{key:"transpose",value:function(){var f=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=f,f=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=f,f=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=f,this}},{key:"matches",value:function(f){if(f.length!==9)throw new Pe("Should be length 9: "+f);for(var d=0;d<3;d++)for(var S=0;S<3;S++)if(!E.matches(this._matrix[d][S],f.charAt(3*d+S)))return!1;return!0}},{key:"add",value:function(f){for(var d=0;d<3;d++)for(var S=0;S<3;S++)this.setAtLeast(d,S,f.get(d,S))}},{key:"isDisjoint",value:function(){return this._matrix[Ze.INTERIOR][Ze.INTERIOR]===Tt.FALSE&&this._matrix[Ze.INTERIOR][Ze.BOUNDARY]===Tt.FALSE&&this._matrix[Ze.BOUNDARY][Ze.INTERIOR]===Tt.FALSE&&this._matrix[Ze.BOUNDARY][Ze.BOUNDARY]===Tt.FALSE}},{key:"isCrosses",value:function(f,d){return f===Tt.P&&d===Tt.L||f===Tt.P&&d===Tt.A||f===Tt.L&&d===Tt.A?E.isTrue(this._matrix[Ze.INTERIOR][Ze.INTERIOR])&&E.isTrue(this._matrix[Ze.INTERIOR][Ze.EXTERIOR]):f===Tt.L&&d===Tt.P||f===Tt.A&&d===Tt.P||f===Tt.A&&d===Tt.L?E.isTrue(this._matrix[Ze.INTERIOR][Ze.INTERIOR])&&E.isTrue(this._matrix[Ze.EXTERIOR][Ze.INTERIOR]):f===Tt.L&&d===Tt.L&&this._matrix[Ze.INTERIOR][Ze.INTERIOR]===0}},{key:"interfaces_",get:function(){return[G]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map((function(){return Array(3)})),this.setAll(Tt.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var f=arguments[0];E.constructor_.call(this),this.set(f)}else if(arguments[0]instanceof E){var d=arguments[0];E.constructor_.call(this),this._matrix[Ze.INTERIOR][Ze.INTERIOR]=d._matrix[Ze.INTERIOR][Ze.INTERIOR],this._matrix[Ze.INTERIOR][Ze.BOUNDARY]=d._matrix[Ze.INTERIOR][Ze.BOUNDARY],this._matrix[Ze.INTERIOR][Ze.EXTERIOR]=d._matrix[Ze.INTERIOR][Ze.EXTERIOR],this._matrix[Ze.BOUNDARY][Ze.INTERIOR]=d._matrix[Ze.BOUNDARY][Ze.INTERIOR],this._matrix[Ze.BOUNDARY][Ze.BOUNDARY]=d._matrix[Ze.BOUNDARY][Ze.BOUNDARY],this._matrix[Ze.BOUNDARY][Ze.EXTERIOR]=d._matrix[Ze.BOUNDARY][Ze.EXTERIOR],this._matrix[Ze.EXTERIOR][Ze.INTERIOR]=d._matrix[Ze.EXTERIOR][Ze.INTERIOR],this._matrix[Ze.EXTERIOR][Ze.BOUNDARY]=d._matrix[Ze.EXTERIOR][Ze.BOUNDARY],this._matrix[Ze.EXTERIOR][Ze.EXTERIOR]=d._matrix[Ze.EXTERIOR][Ze.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var f=arguments[0],d=arguments[1];return d===Tt.SYM_DONTCARE||d===Tt.SYM_TRUE&&(f>=0||f===Tt.TRUE)||d===Tt.SYM_FALSE&&f===Tt.FALSE||d===Tt.SYM_P&&f===Tt.P||d===Tt.SYM_L&&f===Tt.L||d===Tt.SYM_A&&f===Tt.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var S=arguments[1];return new E(arguments[0]).matches(S)}}},{key:"isTrue",value:function(f){return f>=0||f===Tt.TRUE}}])})(),yu=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(f){return f===null||f.length===0?null:(this.ensureCapacity(this._size+f.length),si.arraycopy(f,0,this._data,this._size,f.length),void(this._size+=f.length))}},{key:"ensureCapacity",value:function(f){if(f<=this._data.length)return null;var d=Math.max(f,2*this._data.length);this._data=Mr.copyOf(this._data,d)}},{key:"toArray",value:function(){var f=new Array(this._size).fill(null);return si.arraycopy(this._data,0,f,0,this._size),f}},{key:"add",value:function(f){this.ensureCapacity(this._size+1),this._data[this._size]=f,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)E.constructor_.call(this,10);else if(arguments.length===1){var f=arguments[0];this._data=new Array(f).fill(null)}}}])})(),Wa=(function(){function E(){a(this,E)}return y(E,[{key:"getChainStartIndices",value:function(f){var d=0,S=new yu(Math.trunc(f.length/2));S.add(d);do{var N=this.findChainEnd(f,d);S.add(N),d=N}while(d<f.length-1);return S.toArray()}},{key:"findChainEnd",value:function(f,d){for(var S=os.quadrant(f[d],f[d+1]),N=d+1;N<f.length&&os.quadrant(f[N-1],f[N])===S;)N++;return N-1}},{key:"OLDgetChainStartIndices",value:function(f){var d=0,S=new or;S.add(d);do{var N=this.findChainEnd(f,d);S.add(N),d=N}while(d<f.length-1);return E.toIntArray(S)}}],[{key:"toIntArray",value:function(f){for(var d=new Array(f.size()).fill(null),S=0;S<d.length;S++)d[S]=f.get(S).intValue();return d}}])})(),al=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(E){var f=this.pts[this.startIndex[E]].x,d=this.pts[this.startIndex[E+1]].x;return f>d?f:d}},{key:"getMinX",value:function(E){var f=this.pts[this.startIndex[E]].x,d=this.pts[this.startIndex[E+1]].x;return f<d?f:d}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var E=arguments[0],f=arguments[1],d=arguments[2],S=arguments[3];this.computeIntersectsForChain(this.startIndex[E],this.startIndex[E+1],f,f.startIndex[d],f.startIndex[d+1],S)}else if(arguments.length===6){var N=arguments[0],X=arguments[1],he=arguments[2],Ae=arguments[3],Ye=arguments[4],bt=arguments[5];if(X-N==1&&Ye-Ae==1)return bt.addIntersections(this.e,N,he.e,Ae),null;if(!this.overlaps(N,X,he,Ae,Ye))return null;var an=Math.trunc((N+X)/2),mn=Math.trunc((Ae+Ye)/2);N<an&&(Ae<mn&&this.computeIntersectsForChain(N,an,he,Ae,mn,bt),mn<Ye&&this.computeIntersectsForChain(N,an,he,mn,Ye,bt)),an<X&&(Ae<mn&&this.computeIntersectsForChain(an,X,he,Ae,mn,bt),mn<Ye&&this.computeIntersectsForChain(an,X,he,mn,Ye,bt))}}},{key:"overlaps",value:function(E,f,d,S,N){return Zt.intersects(this.pts[E],this.pts[f],d.pts[S],d.pts[N])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(E,f){for(var d=0;d<this.startIndex.length-1;d++)for(var S=0;S<E.startIndex.length-1;S++)this.computeIntersectsForChain(d,E,S,f)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var E=arguments[0];this.e=E,this.pts=E.getCoordinates();var f=new Wa;this.startIndex=f.getChainStartIndices(this.pts)}}])})(),Hu=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"getDepth",value:function(f,d){return this._depth[f][d]}},{key:"setDepth",value:function(f,d,S){this._depth[f][d]=S}},{key:"isNull",value:function(){if(arguments.length===0){for(var f=0;f<2;f++)for(var d=0;d<3;d++)if(this._depth[f][d]!==E.NULL_VALUE)return!1;return!0}if(arguments.length===1){var S=arguments[0];return this._depth[S][1]===E.NULL_VALUE}if(arguments.length===2){var N=arguments[0],X=arguments[1];return this._depth[N][X]===E.NULL_VALUE}}},{key:"normalize",value:function(){for(var f=0;f<2;f++)if(!this.isNull(f)){var d=this._depth[f][1];this._depth[f][2]<d&&(d=this._depth[f][2]),d<0&&(d=0);for(var S=1;S<3;S++){var N=0;this._depth[f][S]>d&&(N=1),this._depth[f][S]=N}}}},{key:"getDelta",value:function(f){return this._depth[f][$t.RIGHT]-this._depth[f][$t.LEFT]}},{key:"getLocation",value:function(f,d){return this._depth[f][d]<=0?Ze.EXTERIOR:Ze.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var f=arguments[0],d=0;d<2;d++)for(var S=1;S<3;S++){var N=f.getLocation(d,S);N!==Ze.EXTERIOR&&N!==Ze.INTERIOR||(this.isNull(d,S)?this._depth[d][S]=E.depthAtLocation(N):this._depth[d][S]+=E.depthAtLocation(N))}else if(arguments.length===3){var X=arguments[0],he=arguments[1];arguments[2]===Ze.INTERIOR&&this._depth[X][he]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var f=0;f<2;f++)for(var d=0;d<3;d++)this._depth[f][d]=E.NULL_VALUE}},{key:"depthAtLocation",value:function(f){return f===Ze.EXTERIOR?0:f===Ze.INTERIOR?1:E.NULL_VALUE}}])})();Hu.NULL_VALUE=-1;var yo=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var d=new Array(2).fill(null);return d[0]=this.pts[0],d[1]=this.pts[1],new f(d,bo.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(d){this._isIsolated=d}},{key:"setName",value:function(d){this._name=d}},{key:"equals",value:function(d){if(!(d instanceof f))return!1;var S=d;if(this.pts.length!==S.pts.length)return!1;for(var N=!0,X=!0,he=this.pts.length,Ae=0;Ae<this.pts.length;Ae++)if(this.pts[Ae].equals2D(S.pts[Ae])||(N=!1),this.pts[Ae].equals2D(S.pts[--he])||(X=!1),!N&&!X)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var d=arguments[0];return this.pts[d]}}},{key:"print",value:function(d){d.print("edge "+this._name+": "),d.print("LINESTRING (");for(var S=0;S<this.pts.length;S++)S>0&&d.print(","),d.print(this.pts[S].x+" "+this.pts[S].y);d.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(d){f.updateIM(this._label,d)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(d){d.print("edge "+this._name+": ");for(var S=this.pts.length-1;S>=0;S--)d.print(this.pts[S]+" ");d.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new al(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new Zt;for(var d=0;d<this.pts.length;d++)this._env.expandToInclude(this.pts[d])}return this._env}},{key:"addIntersection",value:function(d,S,N,X){var he=new Oe(d.getIntersection(X)),Ae=S,Ye=d.getEdgeDistance(N,X),bt=Ae+1;if(bt<this.pts.length){var an=this.pts[bt];he.equals2D(an)&&(Ae=bt,Ye=0)}this.eiList.add(he,Ae,Ye)}},{key:"toString",value:function(){var d=new Ss;d.append("edge "+this._name+": "),d.append("LINESTRING (");for(var S=0;S<this.pts.length;S++)S>0&&d.append(","),d.append(this.pts[S].x+" "+this.pts[S].y);return d.append(")  "+this._label+" "+this._depthDelta),d.toString()}},{key:"isPointwiseEqual",value:function(d){if(this.pts.length!==d.pts.length)return!1;for(var S=0;S<this.pts.length;S++)if(!this.pts[S].equals2D(d.pts[S]))return!1;return!0}},{key:"setDepthDelta",value:function(d){this._depthDelta=d}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(d,S,N){for(var X=0;X<d.getIntersectionNum();X++)this.addIntersection(d,S,N,X)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new Rc(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Hu,this._depthDelta=0,arguments.length===1){var d=arguments[0];f.constructor_.call(this,d,null)}else if(arguments.length===2){var S=arguments[0],N=arguments[1];this.pts=S,this._label=N}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Ru&&arguments[0]instanceof bo))return Q(f,"updateIM",this).apply(this,arguments);var d=arguments[0],S=arguments[1];S.setAtLeastIfValid(d.getLocation(0,$t.ON),d.getLocation(1,$t.ON),1),d.isArea()&&(S.setAtLeastIfValid(d.getLocation(0,$t.LEFT),d.getLocation(1,$t.LEFT),2),S.setAtLeastIfValid(d.getLocation(0,$t.RIGHT),d.getLocation(1,$t.RIGHT),2))}}])})(Nc),ia=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"setWorkingPrecisionModel",value:function(f){this._workingPrecisionModel=f}},{key:"insertUniqueEdge",value:function(f){var d=this._edgeList.findEqualEdge(f);if(d!==null){var S=d.getLabel(),N=f.getLabel();d.isPointwiseEqual(f)||(N=new bo(f.getLabel())).flip(),S.merge(N);var X=E.depthDelta(N),he=d.getDepthDelta()+X;d.setDepthDelta(he)}else this._edgeList.add(f),f.setDepthDelta(E.depthDelta(f.getLabel()))}},{key:"buildSubgraphs",value:function(f,d){for(var S=new or,N=f.iterator();N.hasNext();){var X=N.next(),he=X.getRightmostCoordinate(),Ae=new O(S).getDepth(he);X.computeDepth(Ae),X.findResultEdges(),S.add(X),d.add(X.getDirectedEdges(),X.getNodes())}}},{key:"createSubgraphs",value:function(f){for(var d=new or,S=f.getNodes().iterator();S.hasNext();){var N=S.next();if(!N.isVisited()){var X=new Kr;X.create(N),d.add(X)}}return Lo.sort(d,Lo.reverseOrder()),d}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(f){if(this._workingNoder!==null)return this._workingNoder;var d=new Zs,S=new Ha;return S.setPrecisionModel(f),d.setSegmentIntersector(new Zl(S)),d}},{key:"buffer",value:function(f,d){var S=this._workingPrecisionModel;S===null&&(S=f.getPrecisionModel()),this._geomFact=f.getFactory();var N=new gl(S,this._bufParams),X=new Cn(f,d,N).getCurves();if(X.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(X,S),this._graph=new ol(new Js),this._graph.addEdges(this._edgeList.getEdges());var he=this.createSubgraphs(this._graph),Ae=new Al(this._geomFact);this.buildSubgraphs(he,Ae);var Ye=Ae.getPolygons();return Ye.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(Ye)}},{key:"computeNodedEdges",value:function(f,d){var S=this.getNoder(d);S.computeNodes(f);for(var N=S.getNodedSubstrings().iterator();N.hasNext();){var X=N.next(),he=X.getCoordinates();if(he.length!==2||!he[0].equals2D(he[1])){var Ae=X.getData(),Ye=new yo(X.getCoordinates(),new bo(Ae));this.insertUniqueEdge(Ye)}}}},{key:"setNoder",value:function(f){this._workingNoder=f}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new oo;var f=arguments[0];this._bufParams=f}},{key:"depthDelta",value:function(f){var d=f.getLocation(0,$t.LEFT),S=f.getLocation(0,$t.RIGHT);return d===Ze.INTERIOR&&S===Ze.EXTERIOR?1:d===Ze.EXTERIOR&&S===Ze.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(f){for(var d=new En,S=new or;f.hasNext();){var N=f.next(),X=d.createLineString(N.getCoordinates());S.add(X)}return d.buildGeometry(S)}}])})(),ll=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"rescale",value:function(){if(yn(arguments[0],zn))for(var f=arguments[0].iterator();f.hasNext();){var d=f.next();this.rescale(d.getCoordinates())}else if(arguments[0]instanceof Array){for(var S=arguments[0],N=0;N<S.length;N++)S[N].x=S[N].x/this._scaleFactor+this._offsetX,S[N].y=S[N].y/this._scaleFactor+this._offsetY;S.length===2&&S[0].equals2D(S[1])&&si.out.println(S)}}},{key:"scale",value:function(){if(yn(arguments[0],zn)){for(var f=arguments[0],d=new or(f.size()),S=f.iterator();S.hasNext();){var N=S.next();d.add(new Qr(this.scale(N.getCoordinates()),N.getData()))}return d}if(arguments[0]instanceof Array){for(var X=arguments[0],he=new Array(X.length).fill(null),Ae=0;Ae<X.length;Ae++)he[Ae]=new Oe(Math.round((X[Ae].x-this._offsetX)*this._scaleFactor),Math.round((X[Ae].y-this._offsetY)*this._scaleFactor),X[Ae].getZ());return di.removeRepeatedPoints(he)}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var f=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(f),f}},{key:"computeNodes",value:function(f){var d=f;this._isScaled&&(d=this.scale(f)),this._noder.computeNodes(d)}},{key:"interfaces_",get:function(){return[fo]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var f=arguments[0],d=arguments[1];E.constructor_.call(this,f,d,0,0)}else if(arguments.length===4){var S=arguments[0],N=arguments[1];this._noder=S,this._scaleFactor=N,this._isScaled=!this.isIntegerPrecision()}}}])})(),Bl=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var f=this._segStrings.iterator();f.hasNext();){var d=f.next().getCoordinates();this.checkEndPtVertexIntersections(d[0],this._segStrings),this.checkEndPtVertexIntersections(d[d.length-1],this._segStrings)}else if(arguments.length===2){for(var S=arguments[0],N=arguments[1].iterator();N.hasNext();)for(var X=N.next().getCoordinates(),he=1;he<X.length-1;he++)if(X[he].equals(S))throw new ge("found endpt/interior pt intersection at index "+he+" :pt "+S)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var f=this._segStrings.iterator();f.hasNext();)for(var d=f.next(),S=this._segStrings.iterator();S.hasNext();){var N=S.next();this.checkInteriorIntersections(d,N)}else if(arguments.length===2)for(var X=arguments[0],he=arguments[1],Ae=X.getCoordinates(),Ye=he.getCoordinates(),bt=0;bt<Ae.length-1;bt++)for(var an=0;an<Ye.length-1;an++)this.checkInteriorIntersections(X,bt,he,an);else if(arguments.length===4){var mn=arguments[0],Kn=arguments[1],Pr=arguments[2],Yr=arguments[3];if(mn===Pr&&Kn===Yr)return null;var yi=mn.getCoordinates()[Kn],Ms=mn.getCoordinates()[Kn+1],Xi=Pr.getCoordinates()[Yr],Ds=Pr.getCoordinates()[Yr+1];if(this._li.computeIntersection(yi,Ms,Xi,Ds),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,yi,Ms)||this.hasInteriorIntersection(this._li,Xi,Ds)))throw new ge("found non-noded intersection at "+yi+"-"+Ms+" and "+Xi+"-"+Ds)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var f=this._segStrings.iterator();f.hasNext();){var d=f.next();this.checkCollapses(d)}else if(arguments.length===1)for(var S=arguments[0].getCoordinates(),N=0;N<S.length-2;N++)this.checkCollapse(S[N],S[N+1],S[N+2])}},{key:"hasInteriorIntersection",value:function(f,d,S){for(var N=0;N<f.getIntersectionNum();N++){var X=f.getIntersection(N);if(!X.equals(d)&&!X.equals(S))return!0}return!1}},{key:"checkCollapse",value:function(f,d,S){if(f.equals(S))throw new ge("found non-noded collapse at "+E.fact.createLineString([f,d,S]))}}],[{key:"constructor_",value:function(){this._li=new Ha,this._segStrings=null;var f=arguments[0];this._segStrings=f}}])})();Bl.fact=new En;var No=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"intersectsScaled",value:function(f,d){var S=Math.min(f.x,d.x),N=Math.max(f.x,d.x),X=Math.min(f.y,d.y),he=Math.max(f.y,d.y),Ae=this._maxx<S||this._minx>N||this._maxy<X||this._miny>he;if(Ae)return!1;var Ye=this.intersectsToleranceSquare(f,d);return Ve.isTrue(!(Ae&&Ye),"Found bad envelope test"),Ye}},{key:"initCorners",value:function(f){var d=.5;this._minx=f.x-d,this._maxx=f.x+d,this._miny=f.y-d,this._maxy=f.y+d,this._corner[0]=new Oe(this._maxx,this._maxy),this._corner[1]=new Oe(this._minx,this._maxy),this._corner[2]=new Oe(this._minx,this._miny),this._corner[3]=new Oe(this._maxx,this._miny)}},{key:"intersects",value:function(f,d){return this._scaleFactor===1?this.intersectsScaled(f,d):(this.copyScaled(f,this._p0Scaled),this.copyScaled(d,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(f){return Math.round(f*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(f,d){d.x=this.scale(f.x),d.y=this.scale(f.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var f=E.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Zt(this._originalPt.x-f,this._originalPt.x+f,this._originalPt.y-f,this._originalPt.y+f)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(f,d){return this._li.computeIntersection(f,d,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(f,d,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(f,d,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(f,d,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(f,d){var S=!1,N=!1;return this._li.computeIntersection(f,d,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(f,d,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(S=!0),this._li.computeIntersection(f,d,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(N=!0),this._li.computeIntersection(f,d,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!S||!N)||!!f.equals(this._pt)||!!d.equals(this._pt))))}},{key:"addSnappedNode",value:function(f,d){var S=f.getCoordinate(d),N=f.getCoordinate(d+1);return!!this.intersects(S,N)&&(f.addIntersection(this.getCoordinate(),d),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var f=arguments[0],d=arguments[1],S=arguments[2];if(this._originalPt=f,this._pt=f,this._scaleFactor=d,this._li=S,d<=0)throw new Pe("Scale factor must be non-zero");d!==1&&(this._pt=new Oe(this.scale(f.x),this.scale(f.y)),this._p0Scaled=new Oe,this._p1Scaled=new Oe),this.initCorners(this._pt)}}])})();No.SAFE_ENV_EXPANSION_FACTOR=.75;var po=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var E=arguments[1];arguments[0].getLineSegment(E,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new oi}}])})(),Ra=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"snap",value:function(){if(arguments.length===1){var E=arguments[0];return this.snap(E,null,-1)}if(arguments.length===3){var f=arguments[0],d=arguments[1],S=arguments[2],N=f.getSafeEnvelope(),X=new sa(f,d,S);return this._index.query(N,new((function(){return y((function he(){a(this,he)}),[{key:"interfaces_",get:function(){return[ml]}},{key:"visitItem",value:function(he){he.select(N,X)}}])})())),X.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var E=arguments[0];this._index=E}}])})(),sa=(function(E){function f(){var d;return a(this,f),d=i(this,f),f.constructor_.apply(d,arguments),d}return R(f,E),y(f,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof Ps))return Q(f,"select",this,1).apply(this,arguments);var d=arguments[1],S=arguments[0].getContext();if(this._parentEdge===S&&(d===this._hotPixelVertexIndex||d+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(S,d)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var d=arguments[0],S=arguments[1],N=arguments[2];this._hotPixel=d,this._parentEdge=S,this._hotPixelVertexIndex=N}}])})(po);Ra.HotPixelSnapAction=sa;var sc=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"processIntersections",value:function(E,f,d,S){if(E===d&&f===S)return null;var N=E.getCoordinates()[f],X=E.getCoordinates()[f+1],he=d.getCoordinates()[S],Ae=d.getCoordinates()[S+1];if(this._li.computeIntersection(N,X,he,Ae),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var Ye=0;Ye<this._li.getIntersectionNum();Ye++)this._interiorIntersections.add(this._li.getIntersection(Ye));E.addIntersections(this._li,f,0),d.addIntersections(this._li,S,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Vi]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var E=arguments[0];this._li=E,this._interiorIntersections=new or}}])})(),_u=(function(){return y((function E(){a(this,E),E.constructor_.apply(this,arguments)}),[{key:"checkCorrectness",value:function(E){var f=Qr.getNodedSubstrings(E),d=new Bl(f);try{d.checkValid()}catch(S){if(!(S instanceof de))throw S;S.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return Qr.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(E,f){var d=this.findInteriorIntersections(E,f);this.computeIntersectionSnaps(d),this.computeVertexSnaps(E)}},{key:"findInteriorIntersections",value:function(E,f){var d=new sc(f);return this._noder.setSegmentIntersector(d),this._noder.computeNodes(E),d.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(yn(arguments[0],zn))for(var E=arguments[0].iterator();E.hasNext();){var f=E.next();this.computeVertexSnaps(f)}else if(arguments[0]instanceof Qr)for(var d=arguments[0],S=d.getCoordinates(),N=0;N<S.length;N++){var X=new No(S[N],this._scaleFactor,this._li);this._pointSnapper.snap(X,d,N)&&d.addIntersection(S[N],N)}}},{key:"computeNodes",value:function(E){this._nodedSegStrings=E,this._noder=new Zs,this._pointSnapper=new Ra(this._noder.getIndex()),this.snapRound(E,this._li)}},{key:"computeIntersectionSnaps",value:function(E){for(var f=E.iterator();f.hasNext();){var d=f.next(),S=new No(d,this._scaleFactor,this._li);this._pointSnapper.snap(S)}}},{key:"interfaces_",get:function(){return[fo]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var E=arguments[0];this._pm=E,this._li=new Ha,this._li.setPrecisionModel(E),this._scaleFactor=E.getScale()}}])})(),zl=(function(){function E(){a(this,E),E.constructor_.apply(this,arguments)}return y(E,[{key:"bufferFixedPrecision",value:function(f){var d=new ll(new _u(new ea(1)),f.getScale()),S=new ia(this._bufParams);S.setWorkingPrecisionModel(f),S.setNoder(d),this._resultGeometry=S.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var f=E.MAX_PRECISION_DIGITS;f>=0;f--){try{this.bufferReducedPrecision(f)}catch(X){if(!(X instanceof bi))throw X;this._saveException=X}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var d=arguments[0],S=E.precisionScaleFactor(this._argGeom,this._distance,d),N=new ea(S);this.bufferFixedPrecision(N)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var f=this._argGeom.getFactory().getPrecisionModel();f.getType()===ea.FIXED?this.bufferFixedPrecision(f):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(f){this._bufParams.setQuadrantSegments(f)}},{key:"bufferOriginalPrecision",value:function(){try{var f=new ia(this._bufParams);this._resultGeometry=f.buffer(this._argGeom,this._distance)}catch(d){if(!(d instanceof ge))throw d;this._saveException=d}}},{key:"getResultGeometry",value:function(f){return this._distance=f,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(f){this._bufParams.setEndCapStyle(f)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new ve,this._resultGeometry=null,this._saveException=null,arguments.length===1){var f=arguments[0];this._argGeom=f}else if(arguments.length===2){var d=arguments[0],S=arguments[1];this._argGeom=d,this._bufParams=S}}},{key:"bufferOp",value:function(){if(arguments.length===2){var f=arguments[1];return new E(arguments[0]).getResultGeometry(f)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Xt&&typeof arguments[1]=="number"){var d=arguments[1],S=arguments[2],N=new E(arguments[0]);return N.setQuadrantSegments(S),N.getResultGeometry(d)}if(arguments[2]instanceof ve&&arguments[0]instanceof Xt&&typeof arguments[1]=="number"){var X=arguments[1];return new E(arguments[0],arguments[2]).getResultGeometry(X)}}else if(arguments.length===4){var he=arguments[1],Ae=arguments[2],Ye=arguments[3],bt=new E(arguments[0]);return bt.setQuadrantSegments(Ae),bt.setEndCapStyle(Ye),bt.getResultGeometry(he)}}},{key:"precisionScaleFactor",value:function(f,d,S){var N=f.getEnvelopeInternal(),X=vt.max(Math.abs(N.getMaxX()),Math.abs(N.getMaxY()),Math.abs(N.getMinX()),Math.abs(N.getMinY()))+2*(d>0?d:0),he=S-Math.trunc(Math.log(X)/Math.log(10)+1);return Math.pow(10,he)}}])})();zl.CAP_ROUND=ve.CAP_ROUND,zl.CAP_BUTT=ve.CAP_FLAT,zl.CAP_FLAT=ve.CAP_FLAT,zl.CAP_SQUARE=ve.CAP_SQUARE,zl.MAX_PRECISION_DIGITS=12;var ul=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Jl=(function(){return y((function E(f){a(this,E),this.geometryFactory=f||new En}),[{key:"read",value:function(E){var f,d=(f=typeof E=="string"?JSON.parse(E):E).type;if(!jo[d])throw new Error("Unknown GeoJSON type: "+f.type);return ul.indexOf(d)!==-1?jo[d].call(this,f.coordinates):d==="GeometryCollection"?jo[d].call(this,f.geometries):jo[d].call(this,f)}},{key:"write",value:function(E){var f=E.getGeometryType();if(!oa[f])throw new Error("Geometry is not supported");return oa[f].call(this,E)}}])})(),jo={Feature:function(E){var f={};for(var d in E)f[d]=E[d];if(E.geometry){var S=E.geometry.type;if(!jo[S])throw new Error("Unknown GeoJSON type: "+E.type);f.geometry=this.read(E.geometry)}return E.bbox&&(f.bbox=jo.bbox.call(this,E.bbox)),f},FeatureCollection:function(E){var f={};if(E.features){f.features=[];for(var d=0;d<E.features.length;++d)f.features.push(this.read(E.features[d]))}return E.bbox&&(f.bbox=this.parse.bbox.call(this,E.bbox)),f},coordinates:function(E){for(var f=[],d=0;d<E.length;++d){var S=E[d];f.push(c(Oe,ae(S)))}return f},bbox:function(E){return this.geometryFactory.createLinearRing([new Oe(E[0],E[1]),new Oe(E[2],E[1]),new Oe(E[2],E[3]),new Oe(E[0],E[3]),new Oe(E[0],E[1])])},Point:function(E){var f=c(Oe,ae(E));return this.geometryFactory.createPoint(f)},MultiPoint:function(E){for(var f=[],d=0;d<E.length;++d)f.push(jo.Point.call(this,E[d]));return this.geometryFactory.createMultiPoint(f)},LineString:function(E){var f=jo.coordinates.call(this,E);return this.geometryFactory.createLineString(f)},MultiLineString:function(E){for(var f=[],d=0;d<E.length;++d)f.push(jo.LineString.call(this,E[d]));return this.geometryFactory.createMultiLineString(f)},Polygon:function(E){for(var f=jo.coordinates.call(this,E[0]),d=this.geometryFactory.createLinearRing(f),S=[],N=1;N<E.length;++N){var X=E[N],he=jo.coordinates.call(this,X),Ae=this.geometryFactory.createLinearRing(he);S.push(Ae)}return this.geometryFactory.createPolygon(d,S)},MultiPolygon:function(E){for(var f=[],d=0;d<E.length;++d){var S=E[d];f.push(jo.Polygon.call(this,S))}return this.geometryFactory.createMultiPolygon(f)},GeometryCollection:function(E){for(var f=[],d=0;d<E.length;++d){var S=E[d];f.push(this.read(S))}return this.geometryFactory.createGeometryCollection(f)}},oa={coordinate:function(E){var f=[E.x,E.y];return E.z&&f.push(E.z),E.m&&f.push(E.m),f},Point:function(E){return{type:"Point",coordinates:oa.coordinate.call(this,E.getCoordinate())}},MultiPoint:function(E){for(var f=[],d=0;d<E._geometries.length;++d){var S=E._geometries[d],N=oa.Point.call(this,S);f.push(N.coordinates)}return{type:"MultiPoint",coordinates:f}},LineString:function(E){for(var f=[],d=E.getCoordinates(),S=0;S<d.length;++S){var N=d[S];f.push(oa.coordinate.call(this,N))}return{type:"LineString",coordinates:f}},MultiLineString:function(E){for(var f=[],d=0;d<E._geometries.length;++d){var S=E._geometries[d],N=oa.LineString.call(this,S);f.push(N.coordinates)}return{type:"MultiLineString",coordinates:f}},Polygon:function(E){var f=[],d=oa.LineString.call(this,E._shell);f.push(d.coordinates);for(var S=0;S<E._holes.length;++S){var N=E._holes[S],X=oa.LineString.call(this,N);f.push(X.coordinates)}return{type:"Polygon",coordinates:f}},MultiPolygon:function(E){for(var f=[],d=0;d<E._geometries.length;++d){var S=E._geometries[d],N=oa.Polygon.call(this,S);f.push(N.coordinates)}return{type:"MultiPolygon",coordinates:f}},GeometryCollection:function(E){for(var f=[],d=0;d<E._geometries.length;++d){var S=E._geometries[d],N=S.getGeometryType();f.push(oa[N].call(this,S))}return{type:"GeometryCollection",geometries:f}}};return{BufferOp:zl,GeoJSONReader:(function(){return y((function E(f){a(this,E),this.parser=new Jl(f||new En)}),[{key:"read",value:function(E){return this.parser.read(E)}}])})(),GeoJSONWriter:(function(){return y((function E(){a(this,E),this.parser=new Jl(this.geometryFactory)}),[{key:"write",value:function(E){return this.parser.write(E)}}])})()}}))})(Sv)),Sv.exports}var RU=NU();const MU=M_(RU);function wm(){return new ix}function ix(){this.reset()}ix.prototype={constructor:ix,reset:function(){this.s=this.t=0},add:function(n){sA($1,n,this.t),sA(this,$1.s,this.s),this.s?this.t+=$1.t:this.s=$1.t},valueOf:function(){return this.s}};var $1=new ix;function sA(n,e,t){var i=n.s=e+t,a=i-e,c=i-a;n.t=e-c+(t-a)}var Yl=1e-6,La=Math.PI,jd=La/2,oA=La/4,Jd=La*2,em=180/La,jf=La/180,$c=Math.abs,DU=Math.atan,jy=Math.atan2,Iu=Math.cos,Cu=Math.sin,n0=Math.sqrt;function y9(n){return n>1?0:n<-1?La:Math.acos(n)}function _g(n){return n>1?jd:n<-1?-jd:Math.asin(n)}function Y0(){}function sx(n,e){n&&lA.hasOwnProperty(n.type)&&lA[n.type](n,e)}var aA={Feature:function(n,e){sx(n.geometry,e)},FeatureCollection:function(n,e){for(var t=n.features,i=-1,a=t.length;++i<a;)sx(t[i].geometry,e)}},lA={Sphere:function(n,e){e.sphere()},Point:function(n,e){n=n.coordinates,e.point(n[0],n[1],n[2])},MultiPoint:function(n,e){for(var t=n.coordinates,i=-1,a=t.length;++i<a;)n=t[i],e.point(n[0],n[1],n[2])},LineString:function(n,e){M5(n.coordinates,e,0)},MultiLineString:function(n,e){for(var t=n.coordinates,i=-1,a=t.length;++i<a;)M5(t[i],e,0)},Polygon:function(n,e){uA(n.coordinates,e)},MultiPolygon:function(n,e){for(var t=n.coordinates,i=-1,a=t.length;++i<a;)uA(t[i],e)},GeometryCollection:function(n,e){for(var t=n.geometries,i=-1,a=t.length;++i<a;)sx(t[i],e)}};function M5(n,e,t){var i=-1,a=n.length-t,c;for(e.lineStart();++i<a;)c=n[i],e.point(c[0],c[1],c[2]);e.lineEnd()}function uA(n,e){var t=-1,i=n.length;for(e.polygonStart();++t<i;)M5(n[t],e,1);e.polygonEnd()}function OU(n,e){n&&aA.hasOwnProperty(n.type)?aA[n.type](n,e):sx(n,e)}wm();wm();function D5(n){return[jy(n[1],n[0]),_g(n[2])]}function Uy(n){var e=n[0],t=n[1],i=Iu(t);return[i*Iu(e),i*Cu(e),Cu(t)]}function H1(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function ox(n,e){return[n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]]}function Aw(n,e){n[0]+=e[0],n[1]+=e[1],n[2]+=e[2]}function W1(n,e){return[n[0]*e,n[1]*e,n[2]*e]}function O5(n){var e=n0(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=e,n[1]/=e,n[2]/=e}wm();function _9(n,e){function t(i,a){return i=n(i,a),e(i[0],i[1])}return n.invert&&e.invert&&(t.invert=function(i,a){return i=e.invert(i,a),i&&n.invert(i[0],i[1])}),t}function F5(n,e){return[n>La?n-Jd:n<-La?n+Jd:n,e]}F5.invert=F5;function FU(n,e,t){return(n%=Jd)?e||t?_9(hA(n),fA(e,t)):hA(n):e||t?fA(e,t):F5}function cA(n){return function(e,t){return e+=n,[e>La?e-Jd:e<-La?e+Jd:e,t]}}function hA(n){var e=cA(n);return e.invert=cA(-n),e}function fA(n,e){var t=Iu(n),i=Cu(n),a=Iu(e),c=Cu(e);function _(y,s){var T=Iu(s),L=Iu(y)*T,R=Cu(y)*T,U=Cu(s),M=U*t+L*i;return[jy(R*a-M*c,L*t-U*i),_g(M*a+R*c)]}return _.invert=function(y,s){var T=Iu(s),L=Iu(y)*T,R=Cu(y)*T,U=Cu(s),M=U*a-R*c;return[jy(R*a+U*c,L*t+M*i),_g(M*t-L*i)]},_}function BU(n,e,t,i,a,c){if(t){var _=Iu(e),y=Cu(e),s=i*t;a==null?(a=e+i*Jd,c=e-s/2):(a=dA(_,a),c=dA(_,c),(i>0?a<c:a>c)&&(a+=i*Jd));for(var T,L=a;i>0?L>c:L<c;L-=s)T=D5([_,-y*Iu(L),-y*Cu(L)]),n.point(T[0],T[1])}}function dA(n,e){e=Uy(e),e[0]-=n,O5(e);var t=y9(-e[1]);return((-e[2]<0?-t:t)+Jd-Yl)%Jd}function v9(){var n=[],e;return{point:function(t,i){e.push([t,i])},lineStart:function(){n.push(e=[])},lineEnd:Y0,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var t=n;return n=[],e=null,t}}}function zU(n,e,t,i,a,c){var _=n[0],y=n[1],s=e[0],T=e[1],L=0,R=1,U=s-_,M=T-y,Q;if(Q=t-_,!(!U&&Q>0)){if(Q/=U,U<0){if(Q<L)return;Q<R&&(R=Q)}else if(U>0){if(Q>R)return;Q>L&&(L=Q)}if(Q=a-_,!(!U&&Q<0)){if(Q/=U,U<0){if(Q>R)return;Q>L&&(L=Q)}else if(U>0){if(Q<L)return;Q<R&&(R=Q)}if(Q=i-y,!(!M&&Q>0)){if(Q/=M,M<0){if(Q<L)return;Q<R&&(R=Q)}else if(M>0){if(Q>R)return;Q>L&&(L=Q)}if(Q=c-y,!(!M&&Q<0)){if(Q/=M,M<0){if(Q>R)return;Q>L&&(L=Q)}else if(M>0){if(Q<L)return;Q<R&&(R=Q)}return L>0&&(n[0]=_+L*U,n[1]=y+L*M),R<1&&(e[0]=_+R*U,e[1]=y+R*M),!0}}}}}function Ev(n,e){return $c(n[0]-e[0])<Yl&&$c(n[1]-e[1])<Yl}function X1(n,e,t,i){this.x=n,this.z=e,this.o=t,this.e=i,this.v=!1,this.n=this.p=null}function x9(n,e,t,i,a){var c=[],_=[],y,s;if(n.forEach(function(Q){if(!((ae=Q.length-1)<=0)){var ae,ye=Q[0],ie=Q[ae],oe;if(Ev(ye,ie)){for(a.lineStart(),y=0;y<ae;++y)a.point((ye=Q[y])[0],ye[1]);a.lineEnd();return}c.push(oe=new X1(ye,Q,null,!0)),_.push(oe.o=new X1(ye,null,oe,!1)),c.push(oe=new X1(ie,Q,null,!1)),_.push(oe.o=new X1(ie,null,oe,!0))}}),!!c.length){for(_.sort(e),pA(c),pA(_),y=0,s=_.length;y<s;++y)_[y].e=t=!t;for(var T=c[0],L,R;;){for(var U=T,M=!0;U.v;)if((U=U.n)===T)return;L=U.z,a.lineStart();do{if(U.v=U.o.v=!0,U.e){if(M)for(y=0,s=L.length;y<s;++y)a.point((R=L[y])[0],R[1]);else i(U.x,U.n.x,1,a);U=U.n}else{if(M)for(L=U.p.z,y=L.length-1;y>=0;--y)a.point((R=L[y])[0],R[1]);else i(U.x,U.p.x,-1,a);U=U.p}U=U.o,L=U.z,M=!M}while(!U.v);a.lineEnd()}}}function pA(n){if(e=n.length){for(var e,t=0,i=n[0],a;++t<e;)i.n=a=n[t],a.p=i,i=a;i.n=a=n[0],a.p=i}}function b9(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function jU(n){return n.length===1&&(n=UU(n)),{left:function(e,t,i,a){for(i==null&&(i=0),a==null&&(a=e.length);i<a;){var c=i+a>>>1;n(e[c],t)<0?i=c+1:a=c}return i},right:function(e,t,i,a){for(i==null&&(i=0),a==null&&(a=e.length);i<a;){var c=i+a>>>1;n(e[c],t)>0?a=c:i=c+1}return i}}}function UU(n){return function(e,t){return b9(n(e),t)}}jU(b9);function w9(n){for(var e=n.length,t,i=-1,a=0,c,_;++i<e;)a+=n[i].length;for(c=new Array(a);--e>=0;)for(_=n[e],t=_.length;--t>=0;)c[--a]=_[t];return c}var K0=1e9,Y1=-K0;function VU(n,e,t,i){function a(T,L){return n<=T&&T<=t&&e<=L&&L<=i}function c(T,L,R,U){var M=0,Q=0;if(T==null||(M=_(T,R))!==(Q=_(L,R))||s(T,L)<0^R>0)do U.point(M===0||M===3?n:t,M>1?i:e);while((M=(M+R+4)%4)!==Q);else U.point(L[0],L[1])}function _(T,L){return $c(T[0]-n)<Yl?L>0?0:3:$c(T[0]-t)<Yl?L>0?2:1:$c(T[1]-e)<Yl?L>0?1:0:L>0?3:2}function y(T,L){return s(T.x,L.x)}function s(T,L){var R=_(T,1),U=_(L,1);return R!==U?R-U:R===0?L[1]-T[1]:R===1?T[0]-L[0]:R===2?T[1]-L[1]:L[0]-T[0]}return function(T){var L=T,R=v9(),U,M,Q,ae,ye,ie,oe,ve,de,Pe,Be,_e={point:G,lineStart:J,lineEnd:te,polygonStart:Y,polygonEnd:$};function G(De,$e){a(De,$e)&&L.point(De,$e)}function B(){for(var De=0,$e=0,Ue=M.length;$e<Ue;++$e)for(var Le=M[$e],He=1,Ke=Le.length,Ce=Le[0],ge,We,Ve=Ce[0],ut=Ce[1];He<Ke;++He)ge=Ve,We=ut,Ce=Le[He],Ve=Ce[0],ut=Ce[1],We<=i?ut>i&&(Ve-ge)*(i-We)>(ut-We)*(n-ge)&&++De:ut<=i&&(Ve-ge)*(i-We)<(ut-We)*(n-ge)&&--De;return De}function Y(){L=R,U=[],M=[],Be=!0}function $(){var De=B(),$e=Be&&De,Ue=(U=w9(U)).length;($e||Ue)&&(T.polygonStart(),$e&&(T.lineStart(),c(null,null,1,T),T.lineEnd()),Ue&&x9(U,y,De,c,T),T.polygonEnd()),L=T,U=M=Q=null}function J(){_e.point=Se,M&&M.push(Q=[]),Pe=!0,de=!1,oe=ve=NaN}function te(){U&&(Se(ae,ye),ie&&de&&R.rejoin(),U.push(R.result())),_e.point=G,de&&L.lineEnd()}function Se(De,$e){var Ue=a(De,$e);if(M&&Q.push([De,$e]),Pe)ae=De,ye=$e,ie=Ue,Pe=!1,Ue&&(L.lineStart(),L.point(De,$e));else if(Ue&&de)L.point(De,$e);else{var Le=[oe=Math.max(Y1,Math.min(K0,oe)),ve=Math.max(Y1,Math.min(K0,ve))],He=[De=Math.max(Y1,Math.min(K0,De)),$e=Math.max(Y1,Math.min(K0,$e))];zU(Le,He,n,e,t,i)?(de||(L.lineStart(),L.point(Le[0],Le[1])),L.point(He[0],He[1]),Ue||L.lineEnd(),Be=!1):Ue&&(L.lineStart(),L.point(De,$e),Be=!1)}oe=De,ve=$e,de=Ue}return _e}}var Iw=wm();function qU(n,e){var t=e[0],i=e[1],a=[Cu(t),-Iu(t),0],c=0,_=0;Iw.reset();for(var y=0,s=n.length;y<s;++y)if(L=(T=n[y]).length)for(var T,L,R=T[L-1],U=R[0],M=R[1]/2+oA,Q=Cu(M),ae=Iu(M),ye=0;ye<L;++ye,U=oe,Q=de,ae=Pe,R=ie){var ie=T[ye],oe=ie[0],ve=ie[1]/2+oA,de=Cu(ve),Pe=Iu(ve),Be=oe-U,_e=Be>=0?1:-1,G=_e*Be,B=G>La,Y=Q*de;if(Iw.add(jy(Y*_e*Cu(G),ae*Pe+Y*Iu(G))),c+=B?Be+_e*Jd:Be,B^U>=t^oe>=t){var $=ox(Uy(R),Uy(ie));O5($);var J=ox(a,$);O5(J);var te=(B^Be>=0?-1:1)*_g(J[2]);(i>te||i===te&&($[0]||$[1]))&&(_+=B^Be>=0?1:-1)}}return(c<-Yl||c<Yl&&Iw<-Yl)^_&1}wm();function mA(n){return n}wm();wm();var Vy=1/0,ax=Vy,P_=-Vy,lx=P_,gA={point:GU,lineStart:Y0,lineEnd:Y0,polygonStart:Y0,polygonEnd:Y0,result:function(){var n=[[Vy,ax],[P_,lx]];return P_=lx=-(ax=Vy=1/0),n}};function GU(n,e){n<Vy&&(Vy=n),n>P_&&(P_=n),e<ax&&(ax=e),e>lx&&(lx=e)}wm();function S9(n,e,t,i){return function(a,c){var _=e(c),y=a.invert(i[0],i[1]),s=v9(),T=e(s),L=!1,R,U,M,Q={point:ae,lineStart:ie,lineEnd:oe,polygonStart:function(){Q.point=ve,Q.lineStart=de,Q.lineEnd=Pe,U=[],R=[]},polygonEnd:function(){Q.point=ae,Q.lineStart=ie,Q.lineEnd=oe,U=w9(U);var Be=qU(R,y);U.length?(L||(c.polygonStart(),L=!0),x9(U,HU,Be,t,c)):Be&&(L||(c.polygonStart(),L=!0),c.lineStart(),t(null,null,1,c),c.lineEnd()),L&&(c.polygonEnd(),L=!1),U=R=null},sphere:function(){c.polygonStart(),c.lineStart(),t(null,null,1,c),c.lineEnd(),c.polygonEnd()}};function ae(Be,_e){var G=a(Be,_e);n(Be=G[0],_e=G[1])&&c.point(Be,_e)}function ye(Be,_e){var G=a(Be,_e);_.point(G[0],G[1])}function ie(){Q.point=ye,_.lineStart()}function oe(){Q.point=ae,_.lineEnd()}function ve(Be,_e){M.push([Be,_e]);var G=a(Be,_e);T.point(G[0],G[1])}function de(){T.lineStart(),M=[]}function Pe(){ve(M[0][0],M[0][1]),T.lineEnd();var Be=T.clean(),_e=s.result(),G,B=_e.length,Y,$,J;if(M.pop(),R.push(M),M=null,!!B){if(Be&1){if($=_e[0],(Y=$.length-1)>0){for(L||(c.polygonStart(),L=!0),c.lineStart(),G=0;G<Y;++G)c.point((J=$[G])[0],J[1]);c.lineEnd()}return}B>1&&Be&2&&_e.push(_e.pop().concat(_e.shift())),U.push(_e.filter($U))}}return Q}}function $U(n){return n.length>1}function HU(n,e){return((n=n.x)[0]<0?n[1]-jd-Yl:jd-n[1])-((e=e.x)[0]<0?e[1]-jd-Yl:jd-e[1])}const yA=S9(function(){return!0},WU,YU,[-La,-jd]);function WU(n){var e=NaN,t=NaN,i=NaN,a;return{lineStart:function(){n.lineStart(),a=1},point:function(c,_){var y=c>0?La:-La,s=$c(c-e);$c(s-La)<Yl?(n.point(e,t=(t+_)/2>0?jd:-jd),n.point(i,t),n.lineEnd(),n.lineStart(),n.point(y,t),n.point(c,t),a=0):i!==y&&s>=La&&($c(e-i)<Yl&&(e-=i*Yl),$c(c-y)<Yl&&(c-=y*Yl),t=XU(e,t,c,_),n.point(i,t),n.lineEnd(),n.lineStart(),n.point(y,t),a=0),n.point(e=c,t=_),i=y},lineEnd:function(){n.lineEnd(),e=t=NaN},clean:function(){return 2-a}}}function XU(n,e,t,i){var a,c,_=Cu(n-t);return $c(_)>Yl?DU((Cu(e)*(c=Iu(i))*Cu(t)-Cu(i)*(a=Iu(e))*Cu(n))/(a*c*_)):(e+i)/2}function YU(n,e,t,i){var a;if(n==null)a=t*jd,i.point(-La,a),i.point(0,a),i.point(La,a),i.point(La,0),i.point(La,-a),i.point(0,-a),i.point(-La,-a),i.point(-La,0),i.point(-La,a);else if($c(n[0]-e[0])>Yl){var c=n[0]<e[0]?La:-La;a=t*c/2,i.point(-c,a),i.point(0,a),i.point(c,a)}else i.point(e[0],e[1])}function KU(n,e){var t=Iu(n),i=t>0,a=$c(t)>Yl;function c(L,R,U,M){BU(M,n,e,U,L,R)}function _(L,R){return Iu(L)*Iu(R)>t}function y(L){var R,U,M,Q,ae;return{lineStart:function(){Q=M=!1,ae=1},point:function(ye,ie){var oe=[ye,ie],ve,de=_(ye,ie),Pe=i?de?0:T(ye,ie):de?T(ye+(ye<0?La:-La),ie):0;if(!R&&(Q=M=de)&&L.lineStart(),de!==M&&(ve=s(R,oe),(!ve||Ev(R,ve)||Ev(oe,ve))&&(oe[0]+=Yl,oe[1]+=Yl,de=_(oe[0],oe[1]))),de!==M)ae=0,de?(L.lineStart(),ve=s(oe,R),L.point(ve[0],ve[1])):(ve=s(R,oe),L.point(ve[0],ve[1]),L.lineEnd()),R=ve;else if(a&&R&&i^de){var Be;!(Pe&U)&&(Be=s(oe,R,!0))&&(ae=0,i?(L.lineStart(),L.point(Be[0][0],Be[0][1]),L.point(Be[1][0],Be[1][1]),L.lineEnd()):(L.point(Be[1][0],Be[1][1]),L.lineEnd(),L.lineStart(),L.point(Be[0][0],Be[0][1])))}de&&(!R||!Ev(R,oe))&&L.point(oe[0],oe[1]),R=oe,M=de,U=Pe},lineEnd:function(){M&&L.lineEnd(),R=null},clean:function(){return ae|(Q&&M)<<1}}}function s(L,R,U){var M=Uy(L),Q=Uy(R),ae=[1,0,0],ye=ox(M,Q),ie=H1(ye,ye),oe=ye[0],ve=ie-oe*oe;if(!ve)return!U&&L;var de=t*ie/ve,Pe=-t*oe/ve,Be=ox(ae,ye),_e=W1(ae,de),G=W1(ye,Pe);Aw(_e,G);var B=Be,Y=H1(_e,B),$=H1(B,B),J=Y*Y-$*(H1(_e,_e)-1);if(!(J<0)){var te=n0(J),Se=W1(B,(-Y-te)/$);if(Aw(Se,_e),Se=D5(Se),!U)return Se;var De=L[0],$e=R[0],Ue=L[1],Le=R[1],He;$e<De&&(He=De,De=$e,$e=He);var Ke=$e-De,Ce=$c(Ke-La)<Yl,ge=Ce||Ke<Yl;if(!Ce&&Le<Ue&&(He=Ue,Ue=Le,Le=He),ge?Ce?Ue+Le>0^Se[1]<($c(Se[0]-De)<Yl?Ue:Le):Ue<=Se[1]&&Se[1]<=Le:Ke>La^(De<=Se[0]&&Se[0]<=$e)){var We=W1(B,(-Y+te)/$);return Aw(We,_e),[Se,D5(We)]}}}function T(L,R){var U=i?n:La-n,M=0;return L<-U?M|=1:L>U&&(M|=2),R<-U?M|=4:R>U&&(M|=8),M}return S9(_,y,c,i?[0,-n]:[-La,n-La])}function E9(n){return function(e){var t=new B5;for(var i in n)t[i]=n[i];return t.stream=e,t}}function B5(){}B5.prototype={constructor:B5,point:function(n,e){this.stream.point(n,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function T9(n,e,t){var i=e[1][0]-e[0][0],a=e[1][1]-e[0][1],c=n.clipExtent&&n.clipExtent();n.scale(150).translate([0,0]),c!=null&&n.clipExtent(null),OU(t,n.stream(gA));var _=gA.result(),y=Math.min(i/(_[1][0]-_[0][0]),a/(_[1][1]-_[0][1])),s=+e[0][0]+(i-y*(_[1][0]+_[0][0]))/2,T=+e[0][1]+(a-y*(_[1][1]+_[0][1]))/2;return c!=null&&n.clipExtent(c),n.scale(y*150).translate([s,T])}function ZU(n,e,t){return T9(n,[[0,0],e],t)}var _A=16,JU=Iu(30*jf);function vA(n,e){return+e?eV(n,e):QU(n)}function QU(n){return E9({point:function(e,t){e=n(e,t),this.stream.point(e[0],e[1])}})}function eV(n,e){function t(i,a,c,_,y,s,T,L,R,U,M,Q,ae,ye){var ie=T-i,oe=L-a,ve=ie*ie+oe*oe;if(ve>4*e&&ae--){var de=_+U,Pe=y+M,Be=s+Q,_e=n0(de*de+Pe*Pe+Be*Be),G=_g(Be/=_e),B=$c($c(Be)-1)<Yl||$c(c-R)<Yl?(c+R)/2:jy(Pe,de),Y=n(B,G),$=Y[0],J=Y[1],te=$-i,Se=J-a,De=oe*te-ie*Se;(De*De/ve>e||$c((ie*te+oe*Se)/ve-.5)>.3||_*U+y*M+s*Q<JU)&&(t(i,a,c,_,y,s,$,J,B,de/=_e,Pe/=_e,Be,ae,ye),ye.point($,J),t($,J,B,de,Pe,Be,T,L,R,U,M,Q,ae,ye))}}return function(i){var a,c,_,y,s,T,L,R,U,M,Q,ae,ye={point:ie,lineStart:oe,lineEnd:de,polygonStart:function(){i.polygonStart(),ye.lineStart=Pe},polygonEnd:function(){i.polygonEnd(),ye.lineStart=oe}};function ie(G,B){G=n(G,B),i.point(G[0],G[1])}function oe(){R=NaN,ye.point=ve,i.lineStart()}function ve(G,B){var Y=Uy([G,B]),$=n(G,B);t(R,U,L,M,Q,ae,R=$[0],U=$[1],L=G,M=Y[0],Q=Y[1],ae=Y[2],_A,i),i.point(R,U)}function de(){ye.point=ie,i.lineEnd()}function Pe(){oe(),ye.point=Be,ye.lineEnd=_e}function Be(G,B){ve(a=G,B),c=R,_=U,y=M,s=Q,T=ae,ye.point=ve}function _e(){t(R,U,L,M,Q,ae,c,_,a,y,s,T,_A,i),ye.lineEnd=de,de()}return ye}}var tV=E9({point:function(n,e){this.stream.point(n*jf,e*jf)}});function nV(n){return rV(function(){return n})()}function rV(n){var e,t=150,i=480,a=250,c,_,y=0,s=0,T=0,L=0,R=0,U,M,Q=null,ae=yA,ye=null,ie,oe,ve,de=mA,Pe=.5,Be=vA($,Pe),_e,G;function B(Se){return Se=M(Se[0]*jf,Se[1]*jf),[Se[0]*t+c,_-Se[1]*t]}function Y(Se){return Se=M.invert((Se[0]-c)/t,(_-Se[1])/t),Se&&[Se[0]*em,Se[1]*em]}function $(Se,De){return Se=e(Se,De),[Se[0]*t+c,_-Se[1]*t]}B.stream=function(Se){return _e&&G===Se?_e:_e=tV(ae(U,Be(de(G=Se))))},B.clipAngle=function(Se){return arguments.length?(ae=+Se?KU(Q=Se*jf,6*jf):(Q=null,yA),te()):Q*em},B.clipExtent=function(Se){return arguments.length?(de=Se==null?(ye=ie=oe=ve=null,mA):VU(ye=+Se[0][0],ie=+Se[0][1],oe=+Se[1][0],ve=+Se[1][1]),te()):ye==null?null:[[ye,ie],[oe,ve]]},B.scale=function(Se){return arguments.length?(t=+Se,J()):t},B.translate=function(Se){return arguments.length?(i=+Se[0],a=+Se[1],J()):[i,a]},B.center=function(Se){return arguments.length?(y=Se[0]%360*jf,s=Se[1]%360*jf,J()):[y*em,s*em]},B.rotate=function(Se){return arguments.length?(T=Se[0]%360*jf,L=Se[1]%360*jf,R=Se.length>2?Se[2]%360*jf:0,J()):[T*em,L*em,R*em]},B.precision=function(Se){return arguments.length?(Be=vA($,Pe=Se*Se),te()):n0(Pe)},B.fitExtent=function(Se,De){return T9(B,Se,De)},B.fitSize=function(Se,De){return ZU(B,Se,De)};function J(){M=_9(U=FU(T,L,R),e);var Se=e(y,s);return c=i-Se[0]*t,_=a+Se[1]*t,te()}function te(){return _e=G=null,B}return function(){return e=n.apply(this,arguments),B.invert=e.invert&&Y,J()}}function A9(n){return function(e,t){var i=Iu(e),a=Iu(t),c=n(i*a);return[c*a*Cu(e),c*Cu(t)]}}function I9(n){return function(e,t){var i=n0(e*e+t*t),a=n(i),c=Cu(a),_=Iu(a);return[jy(e*c,i*_),_g(i&&t*c/i)]}}var iV=A9(function(n){return n0(2/(1+n))});iV.invert=I9(function(n){return 2*_g(n/2)});var C9=A9(function(n){return(n=y9(n))&&n/Cu(n)});C9.invert=I9(function(n){return n});function sV(){return nV(C9).scale(79.4188).clipAngle(180-.001)}function xA(n,e){return[n,e]}xA.invert=xA;var{BufferOp:oV,GeoJSONReader:aV,GeoJSONWriter:lV}=MU;function uV(n,e,t){t=t||{};var i=t.units||"kilometers",a=t.steps||8;if(!n)throw new Error("geojson is required");if(typeof t!="object")throw new Error("options must be an object");if(typeof a!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(a<=0)throw new Error("steps must be greater than 0");var c=[];switch(n.type){case"GeometryCollection":return Jx(n,function(_){var y=Tv(_,e,i,a);y&&c.push(y)}),zy(c);case"FeatureCollection":return R5(n,function(_){var y=Tv(_,e,i,a);y&&R5(y,function(s){s&&c.push(s)})}),zy(c)}return Tv(n,e,i,a)}function Tv(n,e,t,i){var a=n.properties||{},c=n.type==="Feature"?n.geometry:n;if(c.type==="GeometryCollection"){var _=[];return Jx(n,function(ae){var ye=Tv(ae,e,t,i);ye&&_.push(ye)}),zy(_)}var y=cV(c),s={type:c.type,coordinates:L9(c.coordinates,y)},T=new aV,L=T.read(s),R=l2(f9(e,t),"meters"),U=oV.bufferOp(L,R,i),M=new lV;if(U=M.write(U),!k9(U.coordinates)){var Q={type:U.type,coordinates:P9(U.coordinates,y)};return Zx(Q,a)}}function k9(n){return Array.isArray(n[0])?k9(n[0]):isNaN(n[0])}function L9(n,e){return typeof n[0]!="object"?e(n):n.map(function(t){return L9(t,e)})}function P9(n,e){return typeof n[0]!="object"?e.invert(n):n.map(function(t){return P9(t,e)})}function cV(n){var e=g9(n).geometry.coordinates,t=[-e[0],-e[1]];return sV().rotate(t).scale(Uc)}function Gu(n,e={}){let t=0,i=0,a=0;return Ig(n,function(c){t+=c[0],i+=c[1],a++},!0),ma([t/a,i/a],e.properties)}var K1={exports:{}},Av={exports:{}},hV=Av.exports,bA;function fV(){return bA||(bA=1,(function(n,e){(function(t,i){n.exports=i()})(hV,function(){function t(oe,ve,de,Pe,Be){(function _e(G,B,Y,$,J){for(;$>Y;){if($-Y>600){var te=$-Y+1,Se=B-Y+1,De=Math.log(te),$e=.5*Math.exp(2*De/3),Ue=.5*Math.sqrt(De*$e*(te-$e)/te)*(Se-te/2<0?-1:1),Le=Math.max(Y,Math.floor(B-Se*$e/te+Ue)),He=Math.min($,Math.floor(B+(te-Se)*$e/te+Ue));_e(G,B,Le,He,J)}var Ke=G[B],Ce=Y,ge=$;for(i(G,Y,B),J(G[$],Ke)>0&&i(G,Y,$);Ce<ge;){for(i(G,Ce,ge),Ce++,ge--;J(G[Ce],Ke)<0;)Ce++;for(;J(G[ge],Ke)>0;)ge--}J(G[Y],Ke)===0?i(G,Y,ge):i(G,++ge,$),ge<=B&&(Y=ge+1),B<=ge&&($=ge-1)}})(oe,ve,de||0,Pe||oe.length-1,Be||a)}function i(oe,ve,de){var Pe=oe[ve];oe[ve]=oe[de],oe[de]=Pe}function a(oe,ve){return oe<ve?-1:oe>ve?1:0}var c=function(oe){oe===void 0&&(oe=9),this._maxEntries=Math.max(4,oe),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function _(oe,ve,de){if(!de)return ve.indexOf(oe);for(var Pe=0;Pe<ve.length;Pe++)if(de(oe,ve[Pe]))return Pe;return-1}function y(oe,ve){s(oe,0,oe.children.length,ve,oe)}function s(oe,ve,de,Pe,Be){Be||(Be=ye(null)),Be.minX=1/0,Be.minY=1/0,Be.maxX=-1/0,Be.maxY=-1/0;for(var _e=ve;_e<de;_e++){var G=oe.children[_e];T(Be,oe.leaf?Pe(G):G)}return Be}function T(oe,ve){return oe.minX=Math.min(oe.minX,ve.minX),oe.minY=Math.min(oe.minY,ve.minY),oe.maxX=Math.max(oe.maxX,ve.maxX),oe.maxY=Math.max(oe.maxY,ve.maxY),oe}function L(oe,ve){return oe.minX-ve.minX}function R(oe,ve){return oe.minY-ve.minY}function U(oe){return(oe.maxX-oe.minX)*(oe.maxY-oe.minY)}function M(oe){return oe.maxX-oe.minX+(oe.maxY-oe.minY)}function Q(oe,ve){return oe.minX<=ve.minX&&oe.minY<=ve.minY&&ve.maxX<=oe.maxX&&ve.maxY<=oe.maxY}function ae(oe,ve){return ve.minX<=oe.maxX&&ve.minY<=oe.maxY&&ve.maxX>=oe.minX&&ve.maxY>=oe.minY}function ye(oe){return{children:oe,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ie(oe,ve,de,Pe,Be){for(var _e=[ve,de];_e.length;)if(!((de=_e.pop())-(ve=_e.pop())<=Pe)){var G=ve+Math.ceil((de-ve)/Pe/2)*Pe;t(oe,G,ve,de,Be),_e.push(ve,G,G,de)}}return c.prototype.all=function(){return this._all(this.data,[])},c.prototype.search=function(oe){var ve=this.data,de=[];if(!ae(oe,ve))return de;for(var Pe=this.toBBox,Be=[];ve;){for(var _e=0;_e<ve.children.length;_e++){var G=ve.children[_e],B=ve.leaf?Pe(G):G;ae(oe,B)&&(ve.leaf?de.push(G):Q(oe,B)?this._all(G,de):Be.push(G))}ve=Be.pop()}return de},c.prototype.collides=function(oe){var ve=this.data;if(!ae(oe,ve))return!1;for(var de=[];ve;){for(var Pe=0;Pe<ve.children.length;Pe++){var Be=ve.children[Pe],_e=ve.leaf?this.toBBox(Be):Be;if(ae(oe,_e)){if(ve.leaf||Q(oe,_e))return!0;de.push(Be)}}ve=de.pop()}return!1},c.prototype.load=function(oe){if(!oe||!oe.length)return this;if(oe.length<this._minEntries){for(var ve=0;ve<oe.length;ve++)this.insert(oe[ve]);return this}var de=this._build(oe.slice(),0,oe.length-1,0);if(this.data.children.length)if(this.data.height===de.height)this._splitRoot(this.data,de);else{if(this.data.height<de.height){var Pe=this.data;this.data=de,de=Pe}this._insert(de,this.data.height-de.height-1,!0)}else this.data=de;return this},c.prototype.insert=function(oe){return oe&&this._insert(oe,this.data.height-1),this},c.prototype.clear=function(){return this.data=ye([]),this},c.prototype.remove=function(oe,ve){if(!oe)return this;for(var de,Pe,Be,_e=this.data,G=this.toBBox(oe),B=[],Y=[];_e||B.length;){if(_e||(_e=B.pop(),Pe=B[B.length-1],de=Y.pop(),Be=!0),_e.leaf){var $=_(oe,_e.children,ve);if($!==-1)return _e.children.splice($,1),B.push(_e),this._condense(B),this}Be||_e.leaf||!Q(_e,G)?Pe?(de++,_e=Pe.children[de],Be=!1):_e=null:(B.push(_e),Y.push(de),de=0,Pe=_e,_e=_e.children[0])}return this},c.prototype.toBBox=function(oe){return oe},c.prototype.compareMinX=function(oe,ve){return oe.minX-ve.minX},c.prototype.compareMinY=function(oe,ve){return oe.minY-ve.minY},c.prototype.toJSON=function(){return this.data},c.prototype.fromJSON=function(oe){return this.data=oe,this},c.prototype._all=function(oe,ve){for(var de=[];oe;)oe.leaf?ve.push.apply(ve,oe.children):de.push.apply(de,oe.children),oe=de.pop();return ve},c.prototype._build=function(oe,ve,de,Pe){var Be,_e=de-ve+1,G=this._maxEntries;if(_e<=G)return y(Be=ye(oe.slice(ve,de+1)),this.toBBox),Be;Pe||(Pe=Math.ceil(Math.log(_e)/Math.log(G)),G=Math.ceil(_e/Math.pow(G,Pe-1))),(Be=ye([])).leaf=!1,Be.height=Pe;var B=Math.ceil(_e/G),Y=B*Math.ceil(Math.sqrt(G));ie(oe,ve,de,Y,this.compareMinX);for(var $=ve;$<=de;$+=Y){var J=Math.min($+Y-1,de);ie(oe,$,J,B,this.compareMinY);for(var te=$;te<=J;te+=B){var Se=Math.min(te+B-1,J);Be.children.push(this._build(oe,te,Se,Pe-1))}}return y(Be,this.toBBox),Be},c.prototype._chooseSubtree=function(oe,ve,de,Pe){for(;Pe.push(ve),!ve.leaf&&Pe.length-1!==de;){for(var Be=1/0,_e=1/0,G=void 0,B=0;B<ve.children.length;B++){var Y=ve.children[B],$=U(Y),J=(te=oe,Se=Y,(Math.max(Se.maxX,te.maxX)-Math.min(Se.minX,te.minX))*(Math.max(Se.maxY,te.maxY)-Math.min(Se.minY,te.minY))-$);J<_e?(_e=J,Be=$<Be?$:Be,G=Y):J===_e&&$<Be&&(Be=$,G=Y)}ve=G||ve.children[0]}var te,Se;return ve},c.prototype._insert=function(oe,ve,de){var Pe=de?oe:this.toBBox(oe),Be=[],_e=this._chooseSubtree(Pe,this.data,ve,Be);for(_e.children.push(oe),T(_e,Pe);ve>=0&&Be[ve].children.length>this._maxEntries;)this._split(Be,ve),ve--;this._adjustParentBBoxes(Pe,Be,ve)},c.prototype._split=function(oe,ve){var de=oe[ve],Pe=de.children.length,Be=this._minEntries;this._chooseSplitAxis(de,Be,Pe);var _e=this._chooseSplitIndex(de,Be,Pe),G=ye(de.children.splice(_e,de.children.length-_e));G.height=de.height,G.leaf=de.leaf,y(de,this.toBBox),y(G,this.toBBox),ve?oe[ve-1].children.push(G):this._splitRoot(de,G)},c.prototype._splitRoot=function(oe,ve){this.data=ye([oe,ve]),this.data.height=oe.height+1,this.data.leaf=!1,y(this.data,this.toBBox)},c.prototype._chooseSplitIndex=function(oe,ve,de){for(var Pe,Be,_e,G,B,Y,$,J=1/0,te=1/0,Se=ve;Se<=de-ve;Se++){var De=s(oe,0,Se,this.toBBox),$e=s(oe,Se,de,this.toBBox),Ue=(Be=De,_e=$e,G=void 0,B=void 0,Y=void 0,$=void 0,G=Math.max(Be.minX,_e.minX),B=Math.max(Be.minY,_e.minY),Y=Math.min(Be.maxX,_e.maxX),$=Math.min(Be.maxY,_e.maxY),Math.max(0,Y-G)*Math.max(0,$-B)),Le=U(De)+U($e);Ue<J?(J=Ue,Pe=Se,te=Le<te?Le:te):Ue===J&&Le<te&&(te=Le,Pe=Se)}return Pe||de-ve},c.prototype._chooseSplitAxis=function(oe,ve,de){var Pe=oe.leaf?this.compareMinX:L,Be=oe.leaf?this.compareMinY:R;this._allDistMargin(oe,ve,de,Pe)<this._allDistMargin(oe,ve,de,Be)&&oe.children.sort(Pe)},c.prototype._allDistMargin=function(oe,ve,de,Pe){oe.children.sort(Pe);for(var Be=this.toBBox,_e=s(oe,0,ve,Be),G=s(oe,de-ve,de,Be),B=M(_e)+M(G),Y=ve;Y<de-ve;Y++){var $=oe.children[Y];T(_e,oe.leaf?Be($):$),B+=M(_e)}for(var J=de-ve-1;J>=ve;J--){var te=oe.children[J];T(G,oe.leaf?Be(te):te),B+=M(G)}return B},c.prototype._adjustParentBBoxes=function(oe,ve,de){for(var Pe=de;Pe>=0;Pe--)T(ve[Pe],oe)},c.prototype._condense=function(oe){for(var ve=oe.length-1,de=void 0;ve>=0;ve--)oe[ve].children.length===0?ve>0?(de=oe[ve-1].children).splice(de.indexOf(oe[ve]),1):this.clear():y(oe[ve],this.toBBox)},c})})(Av)),Av.exports}class dV{constructor(e=[],t=pV){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,a=t[e];for(;e>0;){const c=e-1>>1,_=t[c];if(i(a,_)>=0)break;t[e]=_,e=c}t[e]=a}_down(e){const{data:t,compare:i}=this,a=this.length>>1,c=t[e];for(;e<a;){let _=(e<<1)+1,y=t[_];const s=_+1;if(s<this.length&&i(t[s],y)<0&&(_=s,y=t[s]),i(y,c)>=0)break;t[e]=y,e=_}t[e]=c}}function pV(n,e){return n<e?-1:n>e?1:0}const mV=Object.freeze(Object.defineProperty({__proto__:null,default:dV},Symbol.toStringTag,{value:"Module"})),gV=Q8(mV);var z0={exports:{}},Cw,wA;function yV(){return wA||(wA=1,Cw=function(e,t,i,a){var c=e[0],_=e[1],y=!1;i===void 0&&(i=0),a===void 0&&(a=t.length);for(var s=(a-i)/2,T=0,L=s-1;T<s;L=T++){var R=t[i+T*2+0],U=t[i+T*2+1],M=t[i+L*2+0],Q=t[i+L*2+1],ae=U>_!=Q>_&&c<(M-R)*(_-U)/(Q-U)+R;ae&&(y=!y)}return y}),Cw}var kw,SA;function _V(){return SA||(SA=1,kw=function(e,t,i,a){var c=e[0],_=e[1],y=!1;i===void 0&&(i=0),a===void 0&&(a=t.length);for(var s=a-i,T=0,L=s-1;T<s;L=T++){var R=t[T+i][0],U=t[T+i][1],M=t[L+i][0],Q=t[L+i][1],ae=U>_!=Q>_&&c<(M-R)*(_-U)/(Q-U)+R;ae&&(y=!y)}return y}),kw}var EA;function vV(){if(EA)return z0.exports;EA=1;var n=yV(),e=_V();return z0.exports=function(i,a,c,_){return a.length>0&&Array.isArray(a[0])?e(i,a,c,_):n(i,a,c,_)},z0.exports.nested=e,z0.exports.flat=n,z0.exports}var Z0={exports:{}},xV=Z0.exports,TA;function bV(){return TA||(TA=1,(function(n,e){(function(t,i){i(e)})(xV,function(t){const a=33306690738754706e-32;function c(ae,ye,ie,oe,ve){let de,Pe,Be,_e,G=ye[0],B=oe[0],Y=0,$=0;B>G==B>-G?(de=G,G=ye[++Y]):(de=B,B=oe[++$]);let J=0;if(Y<ae&&$<ie)for(B>G==B>-G?(Be=de-((Pe=G+de)-G),G=ye[++Y]):(Be=de-((Pe=B+de)-B),B=oe[++$]),de=Pe,Be!==0&&(ve[J++]=Be);Y<ae&&$<ie;)B>G==B>-G?(Be=de-((Pe=de+G)-(_e=Pe-de))+(G-_e),G=ye[++Y]):(Be=de-((Pe=de+B)-(_e=Pe-de))+(B-_e),B=oe[++$]),de=Pe,Be!==0&&(ve[J++]=Be);for(;Y<ae;)Be=de-((Pe=de+G)-(_e=Pe-de))+(G-_e),G=ye[++Y],de=Pe,Be!==0&&(ve[J++]=Be);for(;$<ie;)Be=de-((Pe=de+B)-(_e=Pe-de))+(B-_e),B=oe[++$],de=Pe,Be!==0&&(ve[J++]=Be);return de===0&&J!==0||(ve[J++]=de),J}function _(ae){return new Float64Array(ae)}const y=33306690738754716e-32,s=22204460492503146e-32,T=11093356479670487e-47,L=_(4),R=_(8),U=_(12),M=_(16),Q=_(4);t.orient2d=function(ae,ye,ie,oe,ve,de){const Pe=(ye-de)*(ie-ve),Be=(ae-ve)*(oe-de),_e=Pe-Be;if(Pe===0||Be===0||Pe>0!=Be>0)return _e;const G=Math.abs(Pe+Be);return Math.abs(_e)>=y*G?_e:-(function(B,Y,$,J,te,Se,De){let $e,Ue,Le,He,Ke,Ce,ge,We,Ve,ut,pt,It,Oe,Wt,Zt,Xt,Ze,zn;const on=B-te,mt=$-te,Ir=Y-Se,Fr=J-Se;Ke=(Zt=(We=on-(ge=(Ce=134217729*on)-(Ce-on)))*(ut=Fr-(Ve=(Ce=134217729*Fr)-(Ce-Fr)))-((Wt=on*Fr)-ge*Ve-We*Ve-ge*ut))-(pt=Zt-(Ze=(We=Ir-(ge=(Ce=134217729*Ir)-(Ce-Ir)))*(ut=mt-(Ve=(Ce=134217729*mt)-(Ce-mt)))-((Xt=Ir*mt)-ge*Ve-We*Ve-ge*ut))),L[0]=Zt-(pt+Ke)+(Ke-Ze),Ke=(Oe=Wt-((It=Wt+pt)-(Ke=It-Wt))+(pt-Ke))-(pt=Oe-Xt),L[1]=Oe-(pt+Ke)+(Ke-Xt),Ke=(zn=It+pt)-It,L[2]=It-(zn-Ke)+(pt-Ke),L[3]=zn;let qr=(function(nn,yn){let sr=yn[0];for(let Zn=1;Zn<nn;Zn++)sr+=yn[Zn];return sr})(4,L),$t=s*De;if(qr>=$t||-qr>=$t||($e=B-(on+(Ke=B-on))+(Ke-te),Le=$-(mt+(Ke=$-mt))+(Ke-te),Ue=Y-(Ir+(Ke=Y-Ir))+(Ke-Se),He=J-(Fr+(Ke=J-Fr))+(Ke-Se),$e===0&&Ue===0&&Le===0&&He===0)||($t=T*De+a*Math.abs(qr),(qr+=on*He+Fr*$e-(Ir*Le+mt*Ue))>=$t||-qr>=$t))return qr;Ke=(Zt=(We=$e-(ge=(Ce=134217729*$e)-(Ce-$e)))*(ut=Fr-(Ve=(Ce=134217729*Fr)-(Ce-Fr)))-((Wt=$e*Fr)-ge*Ve-We*Ve-ge*ut))-(pt=Zt-(Ze=(We=Ue-(ge=(Ce=134217729*Ue)-(Ce-Ue)))*(ut=mt-(Ve=(Ce=134217729*mt)-(Ce-mt)))-((Xt=Ue*mt)-ge*Ve-We*Ve-ge*ut))),Q[0]=Zt-(pt+Ke)+(Ke-Ze),Ke=(Oe=Wt-((It=Wt+pt)-(Ke=It-Wt))+(pt-Ke))-(pt=Oe-Xt),Q[1]=Oe-(pt+Ke)+(Ke-Xt),Ke=(zn=It+pt)-It,Q[2]=It-(zn-Ke)+(pt-Ke),Q[3]=zn;const xr=c(4,L,4,Q,R);Ke=(Zt=(We=on-(ge=(Ce=134217729*on)-(Ce-on)))*(ut=He-(Ve=(Ce=134217729*He)-(Ce-He)))-((Wt=on*He)-ge*Ve-We*Ve-ge*ut))-(pt=Zt-(Ze=(We=Ir-(ge=(Ce=134217729*Ir)-(Ce-Ir)))*(ut=Le-(Ve=(Ce=134217729*Le)-(Ce-Le)))-((Xt=Ir*Le)-ge*Ve-We*Ve-ge*ut))),Q[0]=Zt-(pt+Ke)+(Ke-Ze),Ke=(Oe=Wt-((It=Wt+pt)-(Ke=It-Wt))+(pt-Ke))-(pt=Oe-Xt),Q[1]=Oe-(pt+Ke)+(Ke-Xt),Ke=(zn=It+pt)-It,Q[2]=It-(zn-Ke)+(pt-Ke),Q[3]=zn;const dr=c(xr,R,4,Q,U);Ke=(Zt=(We=$e-(ge=(Ce=134217729*$e)-(Ce-$e)))*(ut=He-(Ve=(Ce=134217729*He)-(Ce-He)))-((Wt=$e*He)-ge*Ve-We*Ve-ge*ut))-(pt=Zt-(Ze=(We=Ue-(ge=(Ce=134217729*Ue)-(Ce-Ue)))*(ut=Le-(Ve=(Ce=134217729*Le)-(Ce-Le)))-((Xt=Ue*Le)-ge*Ve-We*Ve-ge*ut))),Q[0]=Zt-(pt+Ke)+(Ke-Ze),Ke=(Oe=Wt-((It=Wt+pt)-(Ke=It-Wt))+(pt-Ke))-(pt=Oe-Xt),Q[1]=Oe-(pt+Ke)+(Ke-Xt),Ke=(zn=It+pt)-It,Q[2]=It-(zn-Ke)+(pt-Ke),Q[3]=zn;const ni=c(dr,U,4,Q,M);return M[ni-1]})(ae,ye,ie,oe,ve,de,G)},t.orient2dfast=function(ae,ye,ie,oe,ve,de){return(ye-de)*(ie-ve)-(ae-ve)*(oe-de)},Object.defineProperty(t,"__esModule",{value:!0})})})(Z0,Z0.exports)),Z0.exports}var AA;function wV(){if(AA)return K1.exports;AA=1;var n=fV(),e=gV,t=vV(),i=bV().orient2d;e.default&&(e=e.default),K1.exports=a,K1.exports.default=a;function a(de,Pe,Be){Pe=Math.max(0,Pe===void 0?2:Pe),Be=Be||0;var _e=M(de),G=new n(16);G.toBBox=function(ge){return{minX:ge[0],minY:ge[1],maxX:ge[0],maxY:ge[1]}},G.compareMinX=function(ge,We){return ge[0]-We[0]},G.compareMinY=function(ge,We){return ge[1]-We[1]},G.load(de);for(var B=[],Y=0,$;Y<_e.length;Y++){var J=_e[Y];G.remove(J),$=Q(J,$),B.push($)}var te=new n(16);for(Y=0;Y<B.length;Y++)te.insert(U(B[Y]));for(var Se=Pe*Pe,De=Be*Be;B.length;){var $e=B.shift(),Ue=$e.p,Le=$e.next.p,He=ae(Ue,Le);if(!(He<De)){var Ke=He/Se;J=c(G,$e.prev.p,Ue,Le,$e.next.next.p,Ke,te),J&&Math.min(ae(J,Ue),ae(J,Le))<=Ke&&(B.push($e),B.push(Q(J,$e)),G.remove(J),te.remove($e),te.insert(U($e)),te.insert(U($e.next)))}}$e=$;var Ce=[];do Ce.push($e.p),$e=$e.next;while($e!==$);return Ce.push($e.p),Ce}function c(de,Pe,Be,_e,G,B,Y){for(var $=new e([],_),J=de.data;J;){for(var te=0;te<J.children.length;te++){var Se=J.children[te],De=J.leaf?ye(Se,Be,_e):y(Be,_e,Se);De>B||$.push({node:Se,dist:De})}for(;$.length&&!$.peek().node.children;){var $e=$.pop(),Ue=$e.node,Le=ye(Ue,Pe,Be),He=ye(Ue,_e,G);if($e.dist<Le&&$e.dist<He&&T(Be,Ue,Y)&&T(_e,Ue,Y))return Ue}J=$.pop(),J&&(J=J.node)}return null}function _(de,Pe){return de.dist-Pe.dist}function y(de,Pe,Be){if(s(de,Be)||s(Pe,Be))return 0;var _e=ie(de[0],de[1],Pe[0],Pe[1],Be.minX,Be.minY,Be.maxX,Be.minY);if(_e===0)return 0;var G=ie(de[0],de[1],Pe[0],Pe[1],Be.minX,Be.minY,Be.minX,Be.maxY);if(G===0)return 0;var B=ie(de[0],de[1],Pe[0],Pe[1],Be.maxX,Be.minY,Be.maxX,Be.maxY);if(B===0)return 0;var Y=ie(de[0],de[1],Pe[0],Pe[1],Be.minX,Be.maxY,Be.maxX,Be.maxY);return Y===0?0:Math.min(_e,G,B,Y)}function s(de,Pe){return de[0]>=Pe.minX&&de[0]<=Pe.maxX&&de[1]>=Pe.minY&&de[1]<=Pe.maxY}function T(de,Pe,Be){for(var _e=Math.min(de[0],Pe[0]),G=Math.min(de[1],Pe[1]),B=Math.max(de[0],Pe[0]),Y=Math.max(de[1],Pe[1]),$=Be.search({minX:_e,minY:G,maxX:B,maxY:Y}),J=0;J<$.length;J++)if(R($[J].p,$[J].next.p,de,Pe))return!1;return!0}function L(de,Pe,Be){return i(de[0],de[1],Pe[0],Pe[1],Be[0],Be[1])}function R(de,Pe,Be,_e){return de!==_e&&Pe!==Be&&L(de,Pe,Be)>0!=L(de,Pe,_e)>0&&L(Be,_e,de)>0!=L(Be,_e,Pe)>0}function U(de){var Pe=de.p,Be=de.next.p;return de.minX=Math.min(Pe[0],Be[0]),de.minY=Math.min(Pe[1],Be[1]),de.maxX=Math.max(Pe[0],Be[0]),de.maxY=Math.max(Pe[1],Be[1]),de}function M(de){for(var Pe=de[0],Be=de[0],_e=de[0],G=de[0],B=0;B<de.length;B++){var Y=de[B];Y[0]<Pe[0]&&(Pe=Y),Y[0]>_e[0]&&(_e=Y),Y[1]<Be[1]&&(Be=Y),Y[1]>G[1]&&(G=Y)}var $=[Pe,Be,_e,G],J=$.slice();for(B=0;B<de.length;B++)t(de[B],$)||J.push(de[B]);return ve(J)}function Q(de,Pe){var Be={p:de,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return Pe?(Be.next=Pe.next,Be.prev=Pe,Pe.next.prev=Be,Pe.next=Be):(Be.prev=Be,Be.next=Be),Be}function ae(de,Pe){var Be=de[0]-Pe[0],_e=de[1]-Pe[1];return Be*Be+_e*_e}function ye(de,Pe,Be){var _e=Pe[0],G=Pe[1],B=Be[0]-_e,Y=Be[1]-G;if(B!==0||Y!==0){var $=((de[0]-_e)*B+(de[1]-G)*Y)/(B*B+Y*Y);$>1?(_e=Be[0],G=Be[1]):$>0&&(_e+=B*$,G+=Y*$)}return B=de[0]-_e,Y=de[1]-G,B*B+Y*Y}function ie(de,Pe,Be,_e,G,B,Y,$){var J=Be-de,te=_e-Pe,Se=Y-G,De=$-B,$e=de-G,Ue=Pe-B,Le=J*J+te*te,He=J*Se+te*De,Ke=Se*Se+De*De,Ce=J*$e+te*Ue,ge=Se*$e+De*Ue,We=Le*Ke-He*He,Ve,ut,pt,It,Oe=We,Wt=We;We===0?(ut=0,Oe=1,It=ge,Wt=Ke):(ut=He*ge-Ke*Ce,It=Le*ge-He*Ce,ut<0?(ut=0,It=ge,Wt=Ke):ut>Oe&&(ut=Oe,It=ge+He,Wt=Ke)),It<0?(It=0,-Ce<0?ut=0:-Ce>Le?ut=Oe:(ut=-Ce,Oe=Le)):It>Wt&&(It=Wt,-Ce+He<0?ut=0:-Ce+He>Le?ut=Oe:(ut=-Ce+He,Oe=Le)),Ve=ut===0?0:ut/Oe,pt=It===0?0:It/Wt;var Zt=(1-Ve)*de+Ve*Be,Xt=(1-Ve)*Pe+Ve*_e,Ze=(1-pt)*G+pt*Y,zn=(1-pt)*B+pt*$,on=Ze-Zt,mt=zn-Xt;return on*on+mt*mt}function oe(de,Pe){return de[0]===Pe[0]?de[1]-Pe[1]:de[0]-Pe[0]}function ve(de){de.sort(oe);for(var Pe=[],Be=0;Be<de.length;Be++){for(;Pe.length>=2&&L(Pe[Pe.length-2],Pe[Pe.length-1],de[Be])<=0;)Pe.pop();Pe.push(de[Be])}for(var _e=[],G=de.length-1;G>=0;G--){for(;_e.length>=2&&L(_e[_e.length-2],_e[_e.length-1],de[G])<=0;)_e.pop();_e.push(de[G])}return _e.pop(),Pe.pop(),Pe.concat(_e)}return K1.exports}var SV=wV();const EV=M_(SV);function TV(n,e={}){e.concavity=e.concavity||1/0;const t=[];if(Ig(n,a=>{t.push([a[0],a[1]])}),!t.length)return null;const i=EV(t,e.concavity);return i.length>3?a2([i]):null}function h2(n){if(!n)throw new Error("geojson is required");switch(n.type){case"Feature":return N9(n);case"FeatureCollection":return AV(n);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return f2(n);default:throw new Error("unknown GeoJSON type")}}function N9(n){const e={type:"Feature"};return Object.keys(n).forEach(t=>{switch(t){case"type":case"properties":case"geometry":return;default:e[t]=n[t]}}),e.properties=R9(n.properties),n.geometry==null?e.geometry=null:e.geometry=f2(n.geometry),e}function R9(n){const e={};return n&&Object.keys(n).forEach(t=>{const i=n[t];typeof i=="object"?i===null?e[t]=null:Array.isArray(i)?e[t]=i.map(a=>a):e[t]=R9(i):e[t]=i}),e}function AV(n){const e={type:"FeatureCollection"};return Object.keys(n).forEach(t=>{switch(t){case"type":case"features":return;default:e[t]=n[t]}}),e.features=n.features.map(t=>N9(t)),e}function f2(n){const e={type:n.type};return n.bbox&&(e.bbox=n.bbox),n.type==="GeometryCollection"?(e.geometries=n.geometries.map(t=>f2(t)),e):(e.coordinates=M9(n.coordinates),e)}function M9(n){const e=n;return typeof e[0]!="object"?e.slice():e.map(t=>M9(t))}var IV=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Lw=Math.ceil,Ff=Math.floor,of="[BigNumber Error] ",IA=of+"Number primitive has more than 15 significant digits: ",id=1e14,ao=14,Pw=9007199254740991,Nw=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],tm=1e7,zc=1e9;function D9(n){var e,t,i,a=oe.prototype={constructor:oe,toString:null,valueOf:null},c=new oe(1),_=20,y=4,s=-7,T=21,L=-1e7,R=1e7,U=!1,M=1,Q=0,ae={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},ye="0123456789abcdefghijklmnopqrstuvwxyz",ie=!0;function oe(G,B){var Y,$,J,te,Se,De,$e,Ue,Le=this;if(!(Le instanceof oe))return new oe(G,B);if(B==null){if(G&&G._isBigNumber===!0){Le.s=G.s,!G.c||G.e>R?Le.c=Le.e=null:G.e<L?Le.c=[Le.e=0]:(Le.e=G.e,Le.c=G.c.slice());return}if((De=typeof G=="number")&&G*0==0){if(Le.s=1/G<0?(G=-G,-1):1,G===~~G){for(te=0,Se=G;Se>=10;Se/=10,te++);te>R?Le.c=Le.e=null:(Le.e=te,Le.c=[G]);return}Ue=String(G)}else{if(!IV.test(Ue=String(G)))return i(Le,Ue,De);Le.s=Ue.charCodeAt(0)==45?(Ue=Ue.slice(1),-1):1}(te=Ue.indexOf("."))>-1&&(Ue=Ue.replace(".","")),(Se=Ue.search(/e/i))>0?(te<0&&(te=Se),te+=+Ue.slice(Se+1),Ue=Ue.substring(0,Se)):te<0&&(te=Ue.length)}else{if(Au(B,2,ye.length,"Base"),B==10&&ie)return Le=new oe(G),Be(Le,_+Le.e+1,y);if(Ue=String(G),De=typeof G=="number"){if(G*0!=0)return i(Le,Ue,De,B);if(Le.s=1/G<0?(Ue=Ue.slice(1),-1):1,oe.DEBUG&&Ue.replace(/^0\.0*|\./,"").length>15)throw Error(IA+G)}else Le.s=Ue.charCodeAt(0)===45?(Ue=Ue.slice(1),-1):1;for(Y=ye.slice(0,B),te=Se=0,$e=Ue.length;Se<$e;Se++)if(Y.indexOf($=Ue.charAt(Se))<0){if($=="."){if(Se>te){te=$e;continue}}else if(!J&&(Ue==Ue.toUpperCase()&&(Ue=Ue.toLowerCase())||Ue==Ue.toLowerCase()&&(Ue=Ue.toUpperCase()))){J=!0,Se=-1,te=0;continue}return i(Le,String(G),De,B)}De=!1,Ue=t(Ue,B,10,Le.s),(te=Ue.indexOf("."))>-1?Ue=Ue.replace(".",""):te=Ue.length}for(Se=0;Ue.charCodeAt(Se)===48;Se++);for($e=Ue.length;Ue.charCodeAt(--$e)===48;);if(Ue=Ue.slice(Se,++$e)){if($e-=Se,De&&oe.DEBUG&&$e>15&&(G>Pw||G!==Ff(G)))throw Error(IA+Le.s*G);if((te=te-Se-1)>R)Le.c=Le.e=null;else if(te<L)Le.c=[Le.e=0];else{if(Le.e=te,Le.c=[],Se=(te+1)%ao,te<0&&(Se+=ao),Se<$e){for(Se&&Le.c.push(+Ue.slice(0,Se)),$e-=ao;Se<$e;)Le.c.push(+Ue.slice(Se,Se+=ao));Se=ao-(Ue=Ue.slice(Se)).length}else Se-=$e;for(;Se--;Ue+="0");Le.c.push(+Ue)}}else Le.c=[Le.e=0]}oe.clone=D9,oe.ROUND_UP=0,oe.ROUND_DOWN=1,oe.ROUND_CEIL=2,oe.ROUND_FLOOR=3,oe.ROUND_HALF_UP=4,oe.ROUND_HALF_DOWN=5,oe.ROUND_HALF_EVEN=6,oe.ROUND_HALF_CEIL=7,oe.ROUND_HALF_FLOOR=8,oe.EUCLID=9,oe.config=oe.set=function(G){var B,Y;if(G!=null)if(typeof G=="object"){if(G.hasOwnProperty(B="DECIMAL_PLACES")&&(Y=G[B],Au(Y,0,zc,B),_=Y),G.hasOwnProperty(B="ROUNDING_MODE")&&(Y=G[B],Au(Y,0,8,B),y=Y),G.hasOwnProperty(B="EXPONENTIAL_AT")&&(Y=G[B],Y&&Y.pop?(Au(Y[0],-zc,0,B),Au(Y[1],0,zc,B),s=Y[0],T=Y[1]):(Au(Y,-zc,zc,B),s=-(T=Y<0?-Y:Y))),G.hasOwnProperty(B="RANGE"))if(Y=G[B],Y&&Y.pop)Au(Y[0],-zc,-1,B),Au(Y[1],1,zc,B),L=Y[0],R=Y[1];else if(Au(Y,-zc,zc,B),Y)L=-(R=Y<0?-Y:Y);else throw Error(of+B+" cannot be zero: "+Y);if(G.hasOwnProperty(B="CRYPTO"))if(Y=G[B],Y===!!Y)if(Y)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))U=Y;else throw U=!Y,Error(of+"crypto unavailable");else U=Y;else throw Error(of+B+" not true or false: "+Y);if(G.hasOwnProperty(B="MODULO_MODE")&&(Y=G[B],Au(Y,0,9,B),M=Y),G.hasOwnProperty(B="POW_PRECISION")&&(Y=G[B],Au(Y,0,zc,B),Q=Y),G.hasOwnProperty(B="FORMAT"))if(Y=G[B],typeof Y=="object")ae=Y;else throw Error(of+B+" not an object: "+Y);if(G.hasOwnProperty(B="ALPHABET"))if(Y=G[B],typeof Y=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(Y))ie=Y.slice(0,10)=="0123456789",ye=Y;else throw Error(of+B+" invalid: "+Y)}else throw Error(of+"Object expected: "+G);return{DECIMAL_PLACES:_,ROUNDING_MODE:y,EXPONENTIAL_AT:[s,T],RANGE:[L,R],CRYPTO:U,MODULO_MODE:M,POW_PRECISION:Q,FORMAT:ae,ALPHABET:ye}},oe.isBigNumber=function(G){if(!G||G._isBigNumber!==!0)return!1;if(!oe.DEBUG)return!0;var B,Y,$=G.c,J=G.e,te=G.s;e:if({}.toString.call($)=="[object Array]"){if((te===1||te===-1)&&J>=-zc&&J<=zc&&J===Ff(J)){if($[0]===0){if(J===0&&$.length===1)return!0;break e}if(B=(J+1)%ao,B<1&&(B+=ao),String($[0]).length==B){for(B=0;B<$.length;B++)if(Y=$[B],Y<0||Y>=id||Y!==Ff(Y))break e;if(Y!==0)return!0}}}else if($===null&&J===null&&(te===null||te===1||te===-1))return!0;throw Error(of+"Invalid BigNumber: "+G)},oe.maximum=oe.max=function(){return de(arguments,-1)},oe.minimum=oe.min=function(){return de(arguments,1)},oe.random=(function(){var G=9007199254740992,B=Math.random()*G&2097151?function(){return Ff(Math.random()*G)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(Y){var $,J,te,Se,De,$e=0,Ue=[],Le=new oe(c);if(Y==null?Y=_:Au(Y,0,zc),Se=Lw(Y/ao),U)if(crypto.getRandomValues){for($=crypto.getRandomValues(new Uint32Array(Se*=2));$e<Se;)De=$[$e]*131072+($[$e+1]>>>11),De>=9e15?(J=crypto.getRandomValues(new Uint32Array(2)),$[$e]=J[0],$[$e+1]=J[1]):(Ue.push(De%1e14),$e+=2);$e=Se/2}else if(crypto.randomBytes){for($=crypto.randomBytes(Se*=7);$e<Se;)De=($[$e]&31)*281474976710656+$[$e+1]*1099511627776+$[$e+2]*4294967296+$[$e+3]*16777216+($[$e+4]<<16)+($[$e+5]<<8)+$[$e+6],De>=9e15?crypto.randomBytes(7).copy($,$e):(Ue.push(De%1e14),$e+=7);$e=Se/7}else throw U=!1,Error(of+"crypto unavailable");if(!U)for(;$e<Se;)De=B(),De<9e15&&(Ue[$e++]=De%1e14);for(Se=Ue[--$e],Y%=ao,Se&&Y&&(De=Nw[ao-Y],Ue[$e]=Ff(Se/De)*De);Ue[$e]===0;Ue.pop(),$e--);if($e<0)Ue=[te=0];else{for(te=-1;Ue[0]===0;Ue.splice(0,1),te-=ao);for($e=1,De=Ue[0];De>=10;De/=10,$e++);$e<ao&&(te-=ao-$e)}return Le.e=te,Le.c=Ue,Le}})(),oe.sum=function(){for(var G=1,B=arguments,Y=new oe(B[0]);G<B.length;)Y=Y.plus(B[G++]);return Y},t=(function(){var G="0123456789";function B(Y,$,J,te){for(var Se,De=[0],$e,Ue=0,Le=Y.length;Ue<Le;){for($e=De.length;$e--;De[$e]*=$);for(De[0]+=te.indexOf(Y.charAt(Ue++)),Se=0;Se<De.length;Se++)De[Se]>J-1&&(De[Se+1]==null&&(De[Se+1]=0),De[Se+1]+=De[Se]/J|0,De[Se]%=J)}return De.reverse()}return function(Y,$,J,te,Se){var De,$e,Ue,Le,He,Ke,Ce,ge,We=Y.indexOf("."),Ve=_,ut=y;for(We>=0&&(Le=Q,Q=0,Y=Y.replace(".",""),ge=new oe($),Ke=ge.pow(Y.length-We),Q=Le,ge.c=B(vp(Of(Ke.c),Ke.e,"0"),10,J,G),ge.e=ge.c.length),Ce=B(Y,$,J,Se?(De=ye,G):(De=G,ye)),Ue=Le=Ce.length;Ce[--Le]==0;Ce.pop());if(!Ce[0])return De.charAt(0);if(We<0?--Ue:(Ke.c=Ce,Ke.e=Ue,Ke.s=te,Ke=e(Ke,ge,Ve,ut,J),Ce=Ke.c,He=Ke.r,Ue=Ke.e),$e=Ue+Ve+1,We=Ce[$e],Le=J/2,He=He||$e<0||Ce[$e+1]!=null,He=ut<4?(We!=null||He)&&(ut==0||ut==(Ke.s<0?3:2)):We>Le||We==Le&&(ut==4||He||ut==6&&Ce[$e-1]&1||ut==(Ke.s<0?8:7)),$e<1||!Ce[0])Y=He?vp(De.charAt(1),-Ve,De.charAt(0)):De.charAt(0);else{if(Ce.length=$e,He)for(--J;++Ce[--$e]>J;)Ce[$e]=0,$e||(++Ue,Ce=[1].concat(Ce));for(Le=Ce.length;!Ce[--Le];);for(We=0,Y="";We<=Le;Y+=De.charAt(Ce[We++]));Y=vp(Y,Ue,De.charAt(0))}return Y}})(),e=(function(){function G($,J,te){var Se,De,$e,Ue,Le=0,He=$.length,Ke=J%tm,Ce=J/tm|0;for($=$.slice();He--;)$e=$[He]%tm,Ue=$[He]/tm|0,Se=Ce*$e+Ue*Ke,De=Ke*$e+Se%tm*tm+Le,Le=(De/te|0)+(Se/tm|0)+Ce*Ue,$[He]=De%te;return Le&&($=[Le].concat($)),$}function B($,J,te,Se){var De,$e;if(te!=Se)$e=te>Se?1:-1;else for(De=$e=0;De<te;De++)if($[De]!=J[De]){$e=$[De]>J[De]?1:-1;break}return $e}function Y($,J,te,Se){for(var De=0;te--;)$[te]-=De,De=$[te]<J[te]?1:0,$[te]=De*Se+$[te]-J[te];for(;!$[0]&&$.length>1;$.splice(0,1));}return function($,J,te,Se,De){var $e,Ue,Le,He,Ke,Ce,ge,We,Ve,ut,pt,It,Oe,Wt,Zt,Xt,Ze,zn=$.s==J.s?1:-1,on=$.c,mt=J.c;if(!on||!on[0]||!mt||!mt[0])return new oe(!$.s||!J.s||(on?mt&&on[0]==mt[0]:!mt)?NaN:on&&on[0]==0||!mt?zn*0:zn/0);for(We=new oe(zn),Ve=We.c=[],Ue=$.e-J.e,zn=te+Ue+1,De||(De=id,Ue=Bf($.e/ao)-Bf(J.e/ao),zn=zn/ao|0),Le=0;mt[Le]==(on[Le]||0);Le++);if(mt[Le]>(on[Le]||0)&&Ue--,zn<0)Ve.push(1),He=!0;else{for(Wt=on.length,Xt=mt.length,Le=0,zn+=2,Ke=Ff(De/(mt[0]+1)),Ke>1&&(mt=G(mt,Ke,De),on=G(on,Ke,De),Xt=mt.length,Wt=on.length),Oe=Xt,ut=on.slice(0,Xt),pt=ut.length;pt<Xt;ut[pt++]=0);Ze=mt.slice(),Ze=[0].concat(Ze),Zt=mt[0],mt[1]>=De/2&&Zt++;do{if(Ke=0,$e=B(mt,ut,Xt,pt),$e<0){if(It=ut[0],Xt!=pt&&(It=It*De+(ut[1]||0)),Ke=Ff(It/Zt),Ke>1)for(Ke>=De&&(Ke=De-1),Ce=G(mt,Ke,De),ge=Ce.length,pt=ut.length;B(Ce,ut,ge,pt)==1;)Ke--,Y(Ce,Xt<ge?Ze:mt,ge,De),ge=Ce.length,$e=1;else Ke==0&&($e=Ke=1),Ce=mt.slice(),ge=Ce.length;if(ge<pt&&(Ce=[0].concat(Ce)),Y(ut,Ce,pt,De),pt=ut.length,$e==-1)for(;B(mt,ut,Xt,pt)<1;)Ke++,Y(ut,Xt<pt?Ze:mt,pt,De),pt=ut.length}else $e===0&&(Ke++,ut=[0]);Ve[Le++]=Ke,ut[0]?ut[pt++]=on[Oe]||0:(ut=[on[Oe]],pt=1)}while((Oe++<Wt||ut[0]!=null)&&zn--);He=ut[0]!=null,Ve[0]||Ve.splice(0,1)}if(De==id){for(Le=1,zn=Ve[0];zn>=10;zn/=10,Le++);Be(We,te+(We.e=Le+Ue*ao-1)+1,Se,He)}else We.e=Ue,We.r=+He;return We}})();function ve(G,B,Y,$){var J,te,Se,De,$e;if(Y==null?Y=y:Au(Y,0,8),!G.c)return G.toString();if(J=G.c[0],Se=G.e,B==null)$e=Of(G.c),$e=$==1||$==2&&(Se<=s||Se>=T)?J1($e,Se):vp($e,Se,"0");else if(G=Be(new oe(G),B,Y),te=G.e,$e=Of(G.c),De=$e.length,$==1||$==2&&(B<=te||te<=s)){for(;De<B;$e+="0",De++);$e=J1($e,te)}else if(B-=Se+($===2&&te>Se),$e=vp($e,te,"0"),te+1>De){if(--B>0)for($e+=".";B--;$e+="0");}else if(B+=te-De,B>0)for(te+1==De&&($e+=".");B--;$e+="0");return G.s<0&&J?"-"+$e:$e}function de(G,B){for(var Y,$,J=1,te=new oe(G[0]);J<G.length;J++)$=new oe(G[J]),(!$.s||(Y=Hm(te,$))===B||Y===0&&te.s===B)&&(te=$);return te}function Pe(G,B,Y){for(var $=1,J=B.length;!B[--J];B.pop());for(J=B[0];J>=10;J/=10,$++);return(Y=$+Y*ao-1)>R?G.c=G.e=null:Y<L?G.c=[G.e=0]:(G.e=Y,G.c=B),G}i=(function(){var G=/^(-?)0([xbo])(?=\w[\w.]*$)/i,B=/^([^.]+)\.$/,Y=/^\.([^.]+)$/,$=/^-?(Infinity|NaN)$/,J=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(te,Se,De,$e){var Ue,Le=De?Se:Se.replace(J,"");if($.test(Le))te.s=isNaN(Le)?null:Le<0?-1:1;else{if(!De&&(Le=Le.replace(G,function(He,Ke,Ce){return Ue=(Ce=Ce.toLowerCase())=="x"?16:Ce=="b"?2:8,!$e||$e==Ue?Ke:He}),$e&&(Ue=$e,Le=Le.replace(B,"$1").replace(Y,"0.$1")),Se!=Le))return new oe(Le,Ue);if(oe.DEBUG)throw Error(of+"Not a"+($e?" base "+$e:"")+" number: "+Se);te.s=null}te.c=te.e=null}})();function Be(G,B,Y,$){var J,te,Se,De,$e,Ue,Le,He=G.c,Ke=Nw;if(He){e:{for(J=1,De=He[0];De>=10;De/=10,J++);if(te=B-J,te<0)te+=ao,Se=B,$e=He[Ue=0],Le=Ff($e/Ke[J-Se-1]%10);else if(Ue=Lw((te+1)/ao),Ue>=He.length)if($){for(;He.length<=Ue;He.push(0));$e=Le=0,J=1,te%=ao,Se=te-ao+1}else break e;else{for($e=De=He[Ue],J=1;De>=10;De/=10,J++);te%=ao,Se=te-ao+J,Le=Se<0?0:Ff($e/Ke[J-Se-1]%10)}if($=$||B<0||He[Ue+1]!=null||(Se<0?$e:$e%Ke[J-Se-1]),$=Y<4?(Le||$)&&(Y==0||Y==(G.s<0?3:2)):Le>5||Le==5&&(Y==4||$||Y==6&&(te>0?Se>0?$e/Ke[J-Se]:0:He[Ue-1])%10&1||Y==(G.s<0?8:7)),B<1||!He[0])return He.length=0,$?(B-=G.e+1,He[0]=Ke[(ao-B%ao)%ao],G.e=-B||0):He[0]=G.e=0,G;if(te==0?(He.length=Ue,De=1,Ue--):(He.length=Ue+1,De=Ke[ao-te],He[Ue]=Se>0?Ff($e/Ke[J-Se]%Ke[Se])*De:0),$)for(;;)if(Ue==0){for(te=1,Se=He[0];Se>=10;Se/=10,te++);for(Se=He[0]+=De,De=1;Se>=10;Se/=10,De++);te!=De&&(G.e++,He[0]==id&&(He[0]=1));break}else{if(He[Ue]+=De,He[Ue]!=id)break;He[Ue--]=0,De=1}for(te=He.length;He[--te]===0;He.pop());}G.e>R?G.c=G.e=null:G.e<L&&(G.c=[G.e=0])}return G}function _e(G){var B,Y=G.e;return Y===null?G.toString():(B=Of(G.c),B=Y<=s||Y>=T?J1(B,Y):vp(B,Y,"0"),G.s<0?"-"+B:B)}return a.absoluteValue=a.abs=function(){var G=new oe(this);return G.s<0&&(G.s=1),G},a.comparedTo=function(G,B){return Hm(this,new oe(G,B))},a.decimalPlaces=a.dp=function(G,B){var Y,$,J,te=this;if(G!=null)return Au(G,0,zc),B==null?B=y:Au(B,0,8),Be(new oe(te),G+te.e+1,B);if(!(Y=te.c))return null;if($=((J=Y.length-1)-Bf(this.e/ao))*ao,J=Y[J])for(;J%10==0;J/=10,$--);return $<0&&($=0),$},a.dividedBy=a.div=function(G,B){return e(this,new oe(G,B),_,y)},a.dividedToIntegerBy=a.idiv=function(G,B){return e(this,new oe(G,B),0,1)},a.exponentiatedBy=a.pow=function(G,B){var Y,$,J,te,Se,De,$e,Ue,Le,He=this;if(G=new oe(G),G.c&&!G.isInteger())throw Error(of+"Exponent not an integer: "+_e(G));if(B!=null&&(B=new oe(B)),De=G.e>14,!He.c||!He.c[0]||He.c[0]==1&&!He.e&&He.c.length==1||!G.c||!G.c[0])return Le=new oe(Math.pow(+_e(He),De?G.s*(2-Z1(G)):+_e(G))),B?Le.mod(B):Le;if($e=G.s<0,B){if(B.c?!B.c[0]:!B.s)return new oe(NaN);$=!$e&&He.isInteger()&&B.isInteger(),$&&(He=He.mod(B))}else{if(G.e>9&&(He.e>0||He.e<-1||(He.e==0?He.c[0]>1||De&&He.c[1]>=24e7:He.c[0]<8e13||De&&He.c[0]<=9999975e7)))return te=He.s<0&&Z1(G)?-0:0,He.e>-1&&(te=1/te),new oe($e?1/te:te);Q&&(te=Lw(Q/ao+2))}for(De?(Y=new oe(.5),$e&&(G.s=1),Ue=Z1(G)):(J=Math.abs(+_e(G)),Ue=J%2),Le=new oe(c);;){if(Ue){if(Le=Le.times(He),!Le.c)break;te?Le.c.length>te&&(Le.c.length=te):$&&(Le=Le.mod(B))}if(J){if(J=Ff(J/2),J===0)break;Ue=J%2}else if(G=G.times(Y),Be(G,G.e+1,1),G.e>14)Ue=Z1(G);else{if(J=+_e(G),J===0)break;Ue=J%2}He=He.times(He),te?He.c&&He.c.length>te&&(He.c.length=te):$&&(He=He.mod(B))}return $?Le:($e&&(Le=c.div(Le)),B?Le.mod(B):te?Be(Le,Q,y,Se):Le)},a.integerValue=function(G){var B=new oe(this);return G==null?G=y:Au(G,0,8),Be(B,B.e+1,G)},a.isEqualTo=a.eq=function(G,B){return Hm(this,new oe(G,B))===0},a.isFinite=function(){return!!this.c},a.isGreaterThan=a.gt=function(G,B){return Hm(this,new oe(G,B))>0},a.isGreaterThanOrEqualTo=a.gte=function(G,B){return(B=Hm(this,new oe(G,B)))===1||B===0},a.isInteger=function(){return!!this.c&&Bf(this.e/ao)>this.c.length-2},a.isLessThan=a.lt=function(G,B){return Hm(this,new oe(G,B))<0},a.isLessThanOrEqualTo=a.lte=function(G,B){return(B=Hm(this,new oe(G,B)))===-1||B===0},a.isNaN=function(){return!this.s},a.isNegative=function(){return this.s<0},a.isPositive=function(){return this.s>0},a.isZero=function(){return!!this.c&&this.c[0]==0},a.minus=function(G,B){var Y,$,J,te,Se=this,De=Se.s;if(G=new oe(G,B),B=G.s,!De||!B)return new oe(NaN);if(De!=B)return G.s=-B,Se.plus(G);var $e=Se.e/ao,Ue=G.e/ao,Le=Se.c,He=G.c;if(!$e||!Ue){if(!Le||!He)return Le?(G.s=-B,G):new oe(He?Se:NaN);if(!Le[0]||!He[0])return He[0]?(G.s=-B,G):new oe(Le[0]?Se:y==3?-0:0)}if($e=Bf($e),Ue=Bf(Ue),Le=Le.slice(),De=$e-Ue){for((te=De<0)?(De=-De,J=Le):(Ue=$e,J=He),J.reverse(),B=De;B--;J.push(0));J.reverse()}else for($=(te=(De=Le.length)<(B=He.length))?De:B,De=B=0;B<$;B++)if(Le[B]!=He[B]){te=Le[B]<He[B];break}if(te&&(J=Le,Le=He,He=J,G.s=-G.s),B=($=He.length)-(Y=Le.length),B>0)for(;B--;Le[Y++]=0);for(B=id-1;$>De;){if(Le[--$]<He[$]){for(Y=$;Y&&!Le[--Y];Le[Y]=B);--Le[Y],Le[$]+=id}Le[$]-=He[$]}for(;Le[0]==0;Le.splice(0,1),--Ue);return Le[0]?Pe(G,Le,Ue):(G.s=y==3?-1:1,G.c=[G.e=0],G)},a.modulo=a.mod=function(G,B){var Y,$,J=this;return G=new oe(G,B),!J.c||!G.s||G.c&&!G.c[0]?new oe(NaN):!G.c||J.c&&!J.c[0]?new oe(J):(M==9?($=G.s,G.s=1,Y=e(J,G,0,3),G.s=$,Y.s*=$):Y=e(J,G,0,M),G=J.minus(Y.times(G)),!G.c[0]&&M==1&&(G.s=J.s),G)},a.multipliedBy=a.times=function(G,B){var Y,$,J,te,Se,De,$e,Ue,Le,He,Ke,Ce,ge,We,Ve,ut=this,pt=ut.c,It=(G=new oe(G,B)).c;if(!pt||!It||!pt[0]||!It[0])return!ut.s||!G.s||pt&&!pt[0]&&!It||It&&!It[0]&&!pt?G.c=G.e=G.s=null:(G.s*=ut.s,!pt||!It?G.c=G.e=null:(G.c=[0],G.e=0)),G;for($=Bf(ut.e/ao)+Bf(G.e/ao),G.s*=ut.s,$e=pt.length,He=It.length,$e<He&&(ge=pt,pt=It,It=ge,J=$e,$e=He,He=J),J=$e+He,ge=[];J--;ge.push(0));for(We=id,Ve=tm,J=He;--J>=0;){for(Y=0,Ke=It[J]%Ve,Ce=It[J]/Ve|0,Se=$e,te=J+Se;te>J;)Ue=pt[--Se]%Ve,Le=pt[Se]/Ve|0,De=Ce*Ue+Le*Ke,Ue=Ke*Ue+De%Ve*Ve+ge[te]+Y,Y=(Ue/We|0)+(De/Ve|0)+Ce*Le,ge[te--]=Ue%We;ge[te]=Y}return Y?++$:ge.splice(0,1),Pe(G,ge,$)},a.negated=function(){var G=new oe(this);return G.s=-G.s||null,G},a.plus=function(G,B){var Y,$=this,J=$.s;if(G=new oe(G,B),B=G.s,!J||!B)return new oe(NaN);if(J!=B)return G.s=-B,$.minus(G);var te=$.e/ao,Se=G.e/ao,De=$.c,$e=G.c;if(!te||!Se){if(!De||!$e)return new oe(J/0);if(!De[0]||!$e[0])return $e[0]?G:new oe(De[0]?$:J*0)}if(te=Bf(te),Se=Bf(Se),De=De.slice(),J=te-Se){for(J>0?(Se=te,Y=$e):(J=-J,Y=De),Y.reverse();J--;Y.push(0));Y.reverse()}for(J=De.length,B=$e.length,J-B<0&&(Y=$e,$e=De,De=Y,B=J),J=0;B;)J=(De[--B]=De[B]+$e[B]+J)/id|0,De[B]=id===De[B]?0:De[B]%id;return J&&(De=[J].concat(De),++Se),Pe(G,De,Se)},a.precision=a.sd=function(G,B){var Y,$,J,te=this;if(G!=null&&G!==!!G)return Au(G,1,zc),B==null?B=y:Au(B,0,8),Be(new oe(te),G,B);if(!(Y=te.c))return null;if(J=Y.length-1,$=J*ao+1,J=Y[J]){for(;J%10==0;J/=10,$--);for(J=Y[0];J>=10;J/=10,$++);}return G&&te.e+1>$&&($=te.e+1),$},a.shiftedBy=function(G){return Au(G,-Pw,Pw),this.times("1e"+G)},a.squareRoot=a.sqrt=function(){var G,B,Y,$,J,te=this,Se=te.c,De=te.s,$e=te.e,Ue=_+4,Le=new oe("0.5");if(De!==1||!Se||!Se[0])return new oe(!De||De<0&&(!Se||Se[0])?NaN:Se?te:1/0);if(De=Math.sqrt(+_e(te)),De==0||De==1/0?(B=Of(Se),(B.length+$e)%2==0&&(B+="0"),De=Math.sqrt(+B),$e=Bf(($e+1)/2)-($e<0||$e%2),De==1/0?B="5e"+$e:(B=De.toExponential(),B=B.slice(0,B.indexOf("e")+1)+$e),Y=new oe(B)):Y=new oe(De+""),Y.c[0]){for($e=Y.e,De=$e+Ue,De<3&&(De=0);;)if(J=Y,Y=Le.times(J.plus(e(te,J,Ue,1))),Of(J.c).slice(0,De)===(B=Of(Y.c)).slice(0,De))if(Y.e<$e&&--De,B=B.slice(De-3,De+1),B=="9999"||!$&&B=="4999"){if(!$&&(Be(J,J.e+_+2,0),J.times(J).eq(te))){Y=J;break}Ue+=4,De+=4,$=1}else{(!+B||!+B.slice(1)&&B.charAt(0)=="5")&&(Be(Y,Y.e+_+2,1),G=!Y.times(Y).eq(te));break}}return Be(Y,Y.e+_+1,y,G)},a.toExponential=function(G,B){return G!=null&&(Au(G,0,zc),G++),ve(this,G,B,1)},a.toFixed=function(G,B){return G!=null&&(Au(G,0,zc),G=G+this.e+1),ve(this,G,B)},a.toFormat=function(G,B,Y){var $,J=this;if(Y==null)G!=null&&B&&typeof B=="object"?(Y=B,B=null):G&&typeof G=="object"?(Y=G,G=B=null):Y=ae;else if(typeof Y!="object")throw Error(of+"Argument not an object: "+Y);if($=J.toFixed(G,B),J.c){var te,Se=$.split("."),De=+Y.groupSize,$e=+Y.secondaryGroupSize,Ue=Y.groupSeparator||"",Le=Se[0],He=Se[1],Ke=J.s<0,Ce=Ke?Le.slice(1):Le,ge=Ce.length;if($e&&(te=De,De=$e,$e=te,ge-=te),De>0&&ge>0){for(te=ge%De||De,Le=Ce.substr(0,te);te<ge;te+=De)Le+=Ue+Ce.substr(te,De);$e>0&&(Le+=Ue+Ce.slice(te)),Ke&&(Le="-"+Le)}$=He?Le+(Y.decimalSeparator||"")+(($e=+Y.fractionGroupSize)?He.replace(new RegExp("\\d{"+$e+"}\\B","g"),"$&"+(Y.fractionGroupSeparator||"")):He):Le}return(Y.prefix||"")+$+(Y.suffix||"")},a.toFraction=function(G){var B,Y,$,J,te,Se,De,$e,Ue,Le,He,Ke,Ce=this,ge=Ce.c;if(G!=null&&(De=new oe(G),!De.isInteger()&&(De.c||De.s!==1)||De.lt(c)))throw Error(of+"Argument "+(De.isInteger()?"out of range: ":"not an integer: ")+_e(De));if(!ge)return new oe(Ce);for(B=new oe(c),Ue=Y=new oe(c),$=$e=new oe(c),Ke=Of(ge),te=B.e=Ke.length-Ce.e-1,B.c[0]=Nw[(Se=te%ao)<0?ao+Se:Se],G=!G||De.comparedTo(B)>0?te>0?B:Ue:De,Se=R,R=1/0,De=new oe(Ke),$e.c[0]=0;Le=e(De,B,0,1),J=Y.plus(Le.times($)),J.comparedTo(G)!=1;)Y=$,$=J,Ue=$e.plus(Le.times(J=Ue)),$e=J,B=De.minus(Le.times(J=B)),De=J;return J=e(G.minus(Y),$,0,1),$e=$e.plus(J.times(Ue)),Y=Y.plus(J.times($)),$e.s=Ue.s=Ce.s,te=te*2,He=e(Ue,$,te,y).minus(Ce).abs().comparedTo(e($e,Y,te,y).minus(Ce).abs())<1?[Ue,$]:[$e,Y],R=Se,He},a.toNumber=function(){return+_e(this)},a.toPrecision=function(G,B){return G!=null&&Au(G,1,zc),ve(this,G,B,2)},a.toString=function(G){var B,Y=this,$=Y.s,J=Y.e;return J===null?$?(B="Infinity",$<0&&(B="-"+B)):B="NaN":(G==null?B=J<=s||J>=T?J1(Of(Y.c),J):vp(Of(Y.c),J,"0"):G===10&&ie?(Y=Be(new oe(Y),_+J+1,y),B=vp(Of(Y.c),Y.e,"0")):(Au(G,2,ye.length,"Base"),B=t(vp(Of(Y.c),J,"0"),10,G,$,!0)),$<0&&Y.c[0]&&(B="-"+B)),B},a.valueOf=a.toJSON=function(){return _e(this)},a._isBigNumber=!0,a[Symbol.toStringTag]="BigNumber",a[Symbol.for("nodejs.util.inspect.custom")]=a.valueOf,n!=null&&oe.set(n),oe}function Bf(n){var e=n|0;return n>0||n===e?e:e-1}function Of(n){for(var e,t,i=1,a=n.length,c=n[0]+"";i<a;){for(e=n[i++]+"",t=ao-e.length;t--;e="0"+e);c+=e}for(a=c.length;c.charCodeAt(--a)===48;);return c.slice(0,a+1||1)}function Hm(n,e){var t,i,a=n.c,c=e.c,_=n.s,y=e.s,s=n.e,T=e.e;if(!_||!y)return null;if(t=a&&!a[0],i=c&&!c[0],t||i)return t?i?0:-y:_;if(_!=y)return _;if(t=_<0,i=s==T,!a||!c)return i?0:!a^t?1:-1;if(!i)return s>T^t?1:-1;for(y=(s=a.length)<(T=c.length)?s:T,_=0;_<y;_++)if(a[_]!=c[_])return a[_]>c[_]^t?1:-1;return s==T?0:s>T^t?1:-1}function Au(n,e,t,i){if(n<e||n>t||n!==Ff(n))throw Error(of+(i||"Argument")+(typeof n=="number"?n<e||n>t?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function Z1(n){var e=n.c.length-1;return Bf(n.e/ao)==e&&n.c[e]%2!=0}function J1(n,e){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(e<0?"e":"e+")+e}function vp(n,e,t){var i,a;if(e<0){for(a=t+".";++e;a+=t);n=a+n}else if(i=n.length,++e>i){for(a=t,e-=i;--e;a+=t);n+=a}else e<i&&(n=n.slice(0,e)+"."+n.slice(e));return n}var Ud=D9(),CV=class{key;left=null;right=null;constructor(n){this.key=n}},j0=class extends CV{constructor(n){super(n)}},kV=class{size=0;modificationCount=0;splayCount=0;splay(n){const e=this.root;if(e==null)return this.compare(n,n),-1;let t=null,i=null,a=null,c=null,_=e;const y=this.compare;let s;for(;;)if(s=y(_.key,n),s>0){let T=_.left;if(T==null||(s=y(T.key,n),s>0&&(_.left=T.right,T.right=_,_=T,T=_.left,T==null)))break;t==null?i=_:t.left=_,t=_,_=T}else if(s<0){let T=_.right;if(T==null||(s=y(T.key,n),s<0&&(_.right=T.left,T.left=_,_=T,T=_.right,T==null)))break;a==null?c=_:a.right=_,a=_,_=T}else break;return a!=null&&(a.right=_.left,_.left=c),t!=null&&(t.left=_.right,_.right=i),this.root!==_&&(this.root=_,this.splayCount++),s}splayMin(n){let e=n,t=e.left;for(;t!=null;){const i=t;e.left=i.right,i.right=e,e=i,t=e.left}return e}splayMax(n){let e=n,t=e.right;for(;t!=null;){const i=t;e.right=i.left,i.left=e,e=i,t=e.right}return e}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let t=this.root;const i=t,a=t.left;if(this.size--,a==null)this.root=t.right;else{const c=t.right;t=this.splayMax(a),t.right=c,this.root=t}return this.modificationCount++,i}addNewRoot(n,e){this.size++,this.modificationCount++;const t=this.root;if(t==null){this.root=n;return}e<0?(n.left=t,n.right=t.right,t.right=null):(n.right=t,n.left=t.left,t.left=null),this.root=n}_first(){const n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){const n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,e)=>n<e?-1:n>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}},ux=class J0 extends kV{root=null;compare;validKey;constructor(e,t){super(),this.compare=e??this.defaultCompare(),this.validKey=t??(i=>i!=null&&i!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const t of e)this.delete(t)}forEach(e){const t=this[Symbol.iterator]();let i;for(;i=t.next(),!i.done;)e(i.value,i.value,this)}add(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new j0(e),t),this}addAndReturn(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new j0(e),t),this.root.key}addAll(e){for(const t of e)this.add(t)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let i=this.root.left;if(i==null)return null;let a=i.right;for(;a!=null;)i=a,a=i.right;return i.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let i=this.root.right;if(i==null)return null;let a=i.left;for(;a!=null;)i=a,a=i.left;return i.key}retainAll(e){const t=new J0(this.compare,this.validKey),i=this.modificationCount;for(const a of e){if(i!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(a)&&this.splay(a)==0&&t.add(this.root.key)}t.size!=this.size&&(this.root=t.root,this.size=t.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const t=new J0(this.compare,this.validKey);for(const i of this)e.has(i)&&t.add(i);return t}difference(e){const t=new J0(this.compare,this.validKey);for(const i of this)e.has(i)||t.add(i);return t}union(e){const t=this.clone();return t.addAll(e),t}clone(){const e=new J0(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function t(a,c){let _,y;do{if(_=a.left,y=a.right,_!=null){const s=new j0(_.key);c.left=s,t(_,s)}if(y!=null){const s=new j0(y.key);c.right=s,a=y,c=s}}while(y!=null)}const i=new j0(e.key);return t(e,i),i}toSet(){return this.clone()}entries(){return new PV(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new LV(this.wrap())}[Symbol.toStringTag]="[object Set]"},O9=class{tree;path=new Array;modificationCount=null;splayCount;constructor(n){this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let t=this.tree.getRoot();for(;t!=null;)this.path.push(t),t=t.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],e=n.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},LV=class extends O9{getValue(n){return n.key}},PV=class extends O9{getValue(n){return[n.key,n.key]}},F9=n=>()=>n,z5=n=>{const e=n?(t,i)=>i.minus(t).abs().isLessThanOrEqualTo(n):F9(!1);return(t,i)=>e(t,i)?0:t.comparedTo(i)};function NV(n){const e=n?(t,i,a,c,_)=>t.exponentiatedBy(2).isLessThanOrEqualTo(c.minus(i).exponentiatedBy(2).plus(_.minus(a).exponentiatedBy(2)).times(n)):F9(!1);return(t,i,a)=>{const c=t.x,_=t.y,y=a.x,s=a.y,T=_.minus(s).times(i.x.minus(y)).minus(c.minus(y).times(i.y.minus(s)));return e(T,c,_,y,s)?0:T.comparedTo(0)}}var RV=n=>n,MV=n=>{if(n){const e=new ux(z5(n)),t=new ux(z5(n)),i=(c,_)=>_.addAndReturn(c),a=c=>({x:i(c.x,e),y:i(c.y,t)});return a({x:new Ud(0),y:new Ud(0)}),a}return RV},j5=n=>({set:e=>{Dp=j5(e)},reset:()=>j5(n),compare:z5(n),snap:MV(n),orient:NV(n)}),Dp=j5(),U0=(n,e)=>n.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(n.ur.y),U5=(n,e)=>{if(e.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(e.ll.y))return null;const t=n.ll.x.isLessThan(e.ll.x)?e.ll.x:n.ll.x,i=n.ur.x.isLessThan(e.ur.x)?n.ur.x:e.ur.x,a=n.ll.y.isLessThan(e.ll.y)?e.ll.y:n.ll.y,c=n.ur.y.isLessThan(e.ur.y)?n.ur.y:e.ur.y;return{ll:{x:t,y:a},ur:{x:i,y:c}}},Iv=(n,e)=>n.x.times(e.y).minus(n.y.times(e.x)),B9=(n,e)=>n.x.times(e.x).plus(n.y.times(e.y)),cx=n=>B9(n,n).sqrt(),DV=(n,e,t)=>{const i={x:e.x.minus(n.x),y:e.y.minus(n.y)},a={x:t.x.minus(n.x),y:t.y.minus(n.y)};return Iv(a,i).div(cx(a)).div(cx(i))},OV=(n,e,t)=>{const i={x:e.x.minus(n.x),y:e.y.minus(n.y)},a={x:t.x.minus(n.x),y:t.y.minus(n.y)};return B9(a,i).div(cx(a)).div(cx(i))},CA=(n,e,t)=>e.y.isZero()?null:{x:n.x.plus(e.x.div(e.y).times(t.minus(n.y))),y:t},kA=(n,e,t)=>e.x.isZero()?null:{x:t,y:n.y.plus(e.y.div(e.x).times(t.minus(n.x)))},FV=(n,e,t,i)=>{if(e.x.isZero())return kA(t,i,n.x);if(i.x.isZero())return kA(n,e,t.x);if(e.y.isZero())return CA(t,i,n.y);if(i.y.isZero())return CA(n,e,t.y);const a=Iv(e,i);if(a.isZero())return null;const c={x:t.x.minus(n.x),y:t.y.minus(n.y)},_=Iv(c,e).div(a),y=Iv(c,i).div(a),s=n.x.plus(y.times(e.x)),T=t.x.plus(_.times(i.x)),L=n.y.plus(y.times(e.y)),R=t.y.plus(_.times(i.y)),U=s.plus(T).div(2),M=L.plus(R).div(2);return{x:U,y:M}},Dd=class z9{point;isLeft;segment;otherSE;consumedBy;static compare(e,t){const i=z9.comparePoints(e.point,t.point);return i!==0?i:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:hx.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let i=0,a=t.length;i<a;i++){const c=t[i];this.point.events.push(c),c.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const i=this.point.events[t];if(i.segment.consumedBy===void 0)for(let a=t+1;a<e;a++){const c=this.point.events[a];c.consumedBy===void 0&&i.otherSE.point.events===c.otherSE.point.events&&i.segment.consume(c.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,i=this.point.events.length;t<i;t++){const a=this.point.events[t];a!==this&&!a.segment.ringOut&&a.segment.isInResult()&&e.push(a)}return e}getLeftmostComparator(e){const t=new Map,i=a=>{const c=a.otherSE;t.set(a,{sine:DV(this.point,e.point,c.point),cosine:OV(this.point,e.point,c.point)})};return(a,c)=>{t.has(a)||i(a),t.has(c)||i(c);const{sine:_,cosine:y}=t.get(a),{sine:s,cosine:T}=t.get(c);return _.isGreaterThanOrEqualTo(0)&&s.isGreaterThanOrEqualTo(0)?y.isLessThan(T)?1:y.isGreaterThan(T)?-1:0:_.isLessThan(0)&&s.isLessThan(0)?y.isLessThan(T)?-1:y.isGreaterThan(T)?1:0:s.isLessThan(_)?-1:s.isGreaterThan(_)?1:0}}},BV=class V5{events;poly;_isExteriorRing;_enclosingRing;static factory(e){const t=[];for(let i=0,a=e.length;i<a;i++){const c=e[i];if(!c.isInResult()||c.ringOut)continue;let _=null,y=c.leftSE,s=c.rightSE;const T=[y],L=y.point,R=[];for(;_=y,y=s,T.push(y),y.point!==L;)for(;;){const U=y.getAvailableLinkedEvents();if(U.length===0){const ae=T[0].point,ye=T[T.length-1].point;throw new Error(`Unable to complete output ring starting at [${ae.x}, ${ae.y}]. Last matching segment found ends at [${ye.x}, ${ye.y}].`)}if(U.length===1){s=U[0].otherSE;break}let M=null;for(let ae=0,ye=R.length;ae<ye;ae++)if(R[ae].point===y.point){M=ae;break}if(M!==null){const ae=R.splice(M)[0],ye=T.splice(ae.index);ye.unshift(ye[0].otherSE),t.push(new V5(ye.reverse()));continue}R.push({index:T.length,point:y.point});const Q=y.getLeftmostComparator(_);s=U.sort(Q)[0].otherSE;break}t.push(new V5(T))}return t}constructor(e){this.events=e;for(let t=0,i=e.length;t<i;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let T=1,L=this.events.length-1;T<L;T++){const R=this.events[T].point,U=this.events[T+1].point;Dp.orient(R,e,U)!==0&&(t.push(R),e=R)}if(t.length===1)return null;const i=t[0],a=t[1];Dp.orient(i,e,a)===0&&t.shift(),t.push(t[0]);const c=this.isExteriorRing()?1:-1,_=this.isExteriorRing()?0:t.length-1,y=this.isExteriorRing()?t.length:-1,s=[];for(let T=_;T!=y;T+=c)s.push([t[T].x.toNumber(),t[T].y.toNumber()]);return s}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let a=1,c=this.events.length;a<c;a++){const _=this.events[a];Dd.compare(e,_)>0&&(e=_)}let t=e.segment.prevInResult(),i=t?t.prevInResult():null;for(;;){if(!t)return null;if(!i)return t.ringOut;if(i.ringOut!==t.ringOut)return i.ringOut?.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut?.enclosingRing();t=i.prevInResult(),i=t?t.prevInResult():null}}},LA=class{exteriorRing;interiorRings;constructor(n){this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){const n=this.exteriorRing.getGeom();if(n===null)return null;const e=[n];for(let t=0,i=this.interiorRings.length;t<i;t++){const a=this.interiorRings[t].getGeom();a!==null&&e.push(a)}return e}},zV=class{rings;polys;constructor(n){this.rings=n,this.polys=this._composePolys(n)}getGeom(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const i=this.polys[e].getGeom();i!==null&&n.push(i)}return n}_composePolys(n){const e=[];for(let t=0,i=n.length;t<i;t++){const a=n[t];if(!a.poly)if(a.isExteriorRing())e.push(new LA(a));else{const c=a.enclosingRing();c?.poly||e.push(new LA(c)),c?.poly?.addInterior(a)}}return e}},jV=class{queue;tree;segments;constructor(n,e=hx.compare){this.queue=n,this.tree=new ux(e),this.segments=[]}process(n){const e=n.segment,t=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(e),t;n.isLeft&&this.tree.add(e);let i=e,a=e;do i=this.tree.lastBefore(i);while(i!=null&&i.consumedBy!=null);do a=this.tree.firstAfter(a);while(a!=null&&a.consumedBy!=null);if(n.isLeft){let c=null;if(i){const y=i.getIntersection(e);if(y!==null&&(e.isAnEndpoint(y)||(c=y),!i.isAnEndpoint(y))){const s=this._splitSafely(i,y);for(let T=0,L=s.length;T<L;T++)t.push(s[T])}}let _=null;if(a){const y=a.getIntersection(e);if(y!==null&&(e.isAnEndpoint(y)||(_=y),!a.isAnEndpoint(y))){const s=this._splitSafely(a,y);for(let T=0,L=s.length;T<L;T++)t.push(s[T])}}if(c!==null||_!==null){let y=null;c===null?y=_:_===null?y=c:y=Dd.comparePoints(c,_)<=0?c:_,this.queue.delete(e.rightSE),t.push(e.rightSE);const s=e.split(y);for(let T=0,L=s.length;T<L;T++)t.push(s[T])}t.length>0?(this.tree.delete(e),t.push(n)):(this.segments.push(e),e.prev=i)}else{if(i&&a){const c=i.getIntersection(a);if(c!==null){if(!i.isAnEndpoint(c)){const _=this._splitSafely(i,c);for(let y=0,s=_.length;y<s;y++)t.push(_[y])}if(!a.isAnEndpoint(c)){const _=this._splitSafely(a,c);for(let y=0,s=_.length;y<s;y++)t.push(_[y])}}}this.tree.delete(e)}return t}_splitSafely(n,e){this.tree.delete(n);const t=n.rightSE;this.queue.delete(t);const i=n.split(e);return i.push(t),n.consumedBy===void 0&&this.tree.add(n),i}},UV=class{type;numMultiPolys;run(n,e,t){Q0.type=n;const i=[new NA(e,!0)];for(let T=0,L=t.length;T<L;T++)i.push(new NA(t[T],!1));if(Q0.numMultiPolys=i.length,Q0.type==="difference"){const T=i[0];let L=1;for(;L<i.length;)U5(i[L].bbox,T.bbox)!==null?L++:i.splice(L,1)}if(Q0.type==="intersection")for(let T=0,L=i.length;T<L;T++){const R=i[T];for(let U=T+1,M=i.length;U<M;U++)if(U5(R.bbox,i[U].bbox)===null)return[]}const a=new ux(Dd.compare);for(let T=0,L=i.length;T<L;T++){const R=i[T].getSweepEvents();for(let U=0,M=R.length;U<M;U++)a.add(R[U])}const c=new jV(a);let _=null;for(a.size!=0&&(_=a.first(),a.delete(_));_;){const T=c.process(_);for(let L=0,R=T.length;L<R;L++){const U=T[L];U.consumedBy===void 0&&a.add(U)}a.size!=0?(_=a.first(),a.delete(_)):_=null}Dp.reset();const y=BV.factory(c.segments);return new zV(y).getGeom()}},Q0=new UV,q5=Q0,VV=0,hx=class Cv{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(e,t){const i=e.leftSE.point.x,a=t.leftSE.point.x,c=e.rightSE.point.x,_=t.rightSE.point.x;if(_.isLessThan(i))return 1;if(c.isLessThan(a))return-1;const y=e.leftSE.point.y,s=t.leftSE.point.y,T=e.rightSE.point.y,L=t.rightSE.point.y;if(i.isLessThan(a)){if(s.isLessThan(y)&&s.isLessThan(T))return 1;if(s.isGreaterThan(y)&&s.isGreaterThan(T))return-1;const R=e.comparePoint(t.leftSE.point);if(R<0)return 1;if(R>0)return-1;const U=t.comparePoint(e.rightSE.point);return U!==0?U:-1}if(i.isGreaterThan(a)){if(y.isLessThan(s)&&y.isLessThan(L))return-1;if(y.isGreaterThan(s)&&y.isGreaterThan(L))return 1;const R=t.comparePoint(e.leftSE.point);if(R!==0)return R;const U=e.comparePoint(t.rightSE.point);return U<0?1:U>0?-1:1}if(y.isLessThan(s))return-1;if(y.isGreaterThan(s))return 1;if(c.isLessThan(_)){const R=t.comparePoint(e.rightSE.point);if(R!==0)return R}if(c.isGreaterThan(_)){const R=e.comparePoint(t.rightSE.point);if(R<0)return 1;if(R>0)return-1}if(!c.eq(_)){const R=T.minus(y),U=c.minus(i),M=L.minus(s),Q=_.minus(a);if(R.isGreaterThan(U)&&M.isLessThan(Q))return 1;if(R.isLessThan(U)&&M.isGreaterThan(Q))return-1}return c.isGreaterThan(_)?1:c.isLessThan(_)||T.isLessThan(L)?-1:T.isGreaterThan(L)?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,i,a){this.id=++VV,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=i,this.windings=a}static fromRing(e,t,i){let a,c,_;const y=Dd.comparePoints(e,t);if(y<0)a=e,c=t,_=1;else if(y>0)a=t,c=e,_=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const s=new Dd(a,!0),T=new Dd(c,!1);return new Cv(s,T,[i],[_])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return Dp.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const t=this.bbox(),i=e.bbox(),a=U5(t,i);if(a===null)return null;const c=this.leftSE.point,_=this.rightSE.point,y=e.leftSE.point,s=e.rightSE.point,T=U0(t,y)&&this.comparePoint(y)===0,L=U0(i,c)&&e.comparePoint(c)===0,R=U0(t,s)&&this.comparePoint(s)===0,U=U0(i,_)&&e.comparePoint(_)===0;if(L&&T)return U&&!R?_:!U&&R?s:null;if(L)return R&&c.x.eq(s.x)&&c.y.eq(s.y)?null:c;if(T)return U&&_.x.eq(y.x)&&_.y.eq(y.y)?null:y;if(U&&R)return null;if(U)return _;if(R)return s;const M=FV(c,this.vector(),y,e.vector());return M===null||!U0(a,M)?null:Dp.snap(M)}split(e){const t=[],i=e.events!==void 0,a=new Dd(e,!0),c=new Dd(e,!1),_=this.rightSE;this.replaceRightSE(c),t.push(c),t.push(a);const y=new Cv(a,_,this.rings.slice(),this.windings.slice());return Dd.comparePoints(y.leftSE.point,y.rightSE.point)>0&&y.swapEvents(),Dd.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(a.checkForConsuming(),c.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,i=this.windings.length;t<i;t++)this.windings[t]*=-1}consume(e){let t=this,i=e;for(;t.consumedBy;)t=t.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const a=Cv.compare(t,i);if(a!==0){if(a>0){const c=t;t=i,i=c}if(t.prev===i){const c=t;t=i,i=c}for(let c=0,_=i.rings.length;c<_;c++){const y=i.rings[c],s=i.windings[c],T=t.rings.indexOf(y);T===-1?(t.rings.push(y),t.windings.push(s)):t.windings[T]+=s}i.rings=null,i.windings=null,i.consumedBy=t,i.leftSE.consumedBy=t.leftSE,i.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,i=this._afterState.windings,a=this._afterState.multiPolys;for(let y=0,s=this.rings.length;y<s;y++){const T=this.rings[y],L=this.windings[y],R=t.indexOf(T);R===-1?(t.push(T),i.push(L)):i[R]+=L}const c=[],_=[];for(let y=0,s=t.length;y<s;y++){if(i[y]===0)continue;const T=t[y],L=T.poly;if(_.indexOf(L)===-1)if(T.isExterior)c.push(L);else{_.indexOf(L)===-1&&_.push(L);const R=c.indexOf(T.poly);R!==-1&&c.splice(R,1)}}for(let y=0,s=c.length;y<s;y++){const T=c[y].multiPoly;a.indexOf(T)===-1&&a.push(T)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(q5.type){case"union":{const i=e.length===0,a=t.length===0;this._isInResult=i!==a;break}case"intersection":{let i,a;e.length<t.length?(i=e.length,a=t.length):(i=t.length,a=e.length),this._isInResult=a===q5.numMultiPolys&&i<a;break}case"xor":{const i=Math.abs(e.length-t.length);this._isInResult=i%2===1;break}case"difference":{const i=a=>a.length===1&&a[0].isSubject;this._isInResult=i(e)!==i(t);break}}return this._isInResult}},PA=class{poly;isExterior;segments;bbox;constructor(n,e,t){if(!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=t,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=Dp.snap({x:new Ud(n[0][0]),y:new Ud(n[0][1])});this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let a=i;for(let c=1,_=n.length;c<_;c++){if(typeof n[c][0]!="number"||typeof n[c][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const y=Dp.snap({x:new Ud(n[c][0]),y:new Ud(n[c][1])});y.x.eq(a.x)&&y.y.eq(a.y)||(this.segments.push(hx.fromRing(a,y,this)),y.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=y.x),y.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=y.y),y.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=y.x),y.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=y.y),a=y)}(!i.x.eq(a.x)||!i.y.eq(a.y))&&this.segments.push(hx.fromRing(a,i,this))}getSweepEvents(){const n=[];for(let e=0,t=this.segments.length;e<t;e++){const i=this.segments[e];n.push(i.leftSE),n.push(i.rightSE)}return n}},qV=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new PA(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,i=n.length;t<i;t++){const a=new PA(n[t],this,!1);a.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=e}getSweepEvents(){const n=this.exteriorRing.getSweepEvents();for(let e=0,t=this.interiorRings.length;e<t;e++){const i=this.interiorRings[e].getSweepEvents();for(let a=0,c=i.length;a<c;a++)n.push(i[a])}return n}},NA=class{isSubject;polys;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new Ud(Number.POSITIVE_INFINITY),y:new Ud(Number.POSITIVE_INFINITY)},ur:{x:new Ud(Number.NEGATIVE_INFINITY),y:new Ud(Number.NEGATIVE_INFINITY)}};for(let t=0,i=n.length;t<i;t++){const a=new qV(n[t],this);a.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=e}getSweepEvents(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const i=this.polys[e].getSweepEvents();for(let a=0,c=i.length;a<c;a++)n.push(i[a])}return n}},GV=(n,...e)=>q5.run("intersection",n,e);Dp.set;function d2(n,e,t,i={}){const a=e<0;let c=p9(Math.abs(e),i.units,"meters");a&&(c=-Math.abs(c));const _=Tf(n),y=$V(_,c,t);return y[0]+=y[0]-_[0]>180?-360:_[0]-y[0]>180?360:0,ma(y,i.properties)}function $V(n,e,t,i){i=i===void 0?Uc:Number(i);const a=e/i,c=n[0]*Math.PI/180,_=Ef(n[1]),y=Ef(t),s=a*Math.cos(y);let T=_+s;Math.abs(T)>Math.PI/2&&(T=T>0?Math.PI-T:-Math.PI-T);const L=Math.log(Math.tan(T/2+Math.PI/4)/Math.tan(_/2+Math.PI/4)),R=Math.abs(L)>1e-11?s/L:Math.cos(_),U=a*Math.sin(y)/R;return[((c+U)*180/Math.PI+540)%360-180,T*180/Math.PI]}function j9(n,e,t={}){const i=Tf(n),a=Tf(e);a[0]+=a[0]-i[0]>180?-360:i[0]-a[0]>180?360:0;const c=HV(i,a);return p9(c,"meters",t.units)}function HV(n,e,t){t=t===void 0?Uc:Number(t);const i=t,a=n[1]*Math.PI/180,c=e[1]*Math.PI/180,_=c-a;let y=Math.abs(e[0]-n[0])*Math.PI/180;y>Math.PI&&(y-=2*Math.PI);const s=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(a/2+Math.PI/4)),T=Math.abs(s)>1e-11?_/s:Math.cos(a);return Math.sqrt(_*_+T*T*y*y)*i}function af(n,e,t){if(t=t||{},!u2(t))throw new Error("options is invalid");const i=t.pivot,a=t.mutate;if(!n)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("angle is required");if(e===0)return n;const c=i??Gu(n);return(a===!1||a===void 0)&&(n=h2(n)),Ig(n,function(_){const s=m9(c,_)+e,T=j9(c,_),L=c2(d2(c,T,s));_[0]=L[0],_[1]=L[1]}),n}function U9(n,e={}){const t=[];if(Jx(n,a=>{t.push(a.coordinates)}),t.length<2)throw new Error("Must specify at least 2 geometries");const i=GV(t[0],...t.slice(1));return i.length===0?null:i.length===1?a2(i[0],e.properties):pU(i,e.properties)}function qy(n,e,t){if(t=t||{},!u2(t))throw new Error("options is invalid");const i=t.origin||"centroid",a=t.mutate||!1;if(!n)throw new Error("geojson required");if(typeof e!="number"||e<=0)throw new Error("invalid factor");const c=Array.isArray(i)||typeof i=="object";return a!==!0&&(n=h2(n)),n.type==="FeatureCollection"&&!c?(R5(n,function(_,y){n.features[y]=RA(_,e,i)}),n):RA(n,e,i)}function RA(n,e,t){const i=gU(n)==="Point",a=WV(n,t);return e===1||i||(Ig(n,function(c){const _=j9(a,c),y=m9(a,c),s=_*e,T=c2(d2(a,s,y));c[0]=T[0],c[1]=T[1],c.length===3&&(c[2]*=e)}),delete n.bbox),n}function WV(n,e){if(e==null&&(e="centroid"),Array.isArray(e)||typeof e=="object")return Tf(e);const t=n.bbox?n.bbox:Lc(n,{recompute:!0}),i=t[0],a=t[1],c=t[2],_=t[3];switch(e){case"sw":case"southwest":case"westsouth":case"bottomleft":return ma([i,a]);case"se":case"southeast":case"eastsouth":case"bottomright":return ma([c,a]);case"nw":case"northwest":case"westnorth":case"topleft":return ma([i,_]);case"ne":case"northeast":case"eastnorth":case"topright":return ma([c,_]);case"center":return g9(n);case void 0:case null:case"centroid":return Gu(n);default:throw new Error("invalid origin")}}function ig(n,e,t,i){if(i=i||{},!u2(i))throw new Error("options is invalid");var a=i.units,c=i.zTranslation,_=i.mutate;if(!n)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("distance is required");if(c&&typeof c!="number"&&isNaN(c))throw new Error("zTranslation is not a number");if(c=c!==void 0?c:0,e===0&&c===0)return n;if(t==null||isNaN(t))throw new Error("direction is required");return e<0&&(e=-e,t=t+180),(_===!1||_===void 0)&&(n=h2(n)),Ig(n,function(y){var s=c2(d2(y,e,t,{units:a}));y[0]=s[0],y[1]=s[1],c&&y.length===3&&(y[2]+=c)}),n}function gc(n){return String(n??"").trim().toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")||"na"}function xp(n){return gc(n)}function El(n){return gc(n)}function ld(...n){if(!n?.length)return"na";const e=n.flatMap(t=>Array.isArray(t)?t:[t]).map(t=>t==null?"":String(t)).map(t=>t.trim()).filter(Boolean);if(!e.length)return"na";if(e.length===1){const t=e[0];return t.match(/^\d+$/)?t:gc(t)}return gc(e.join("_"))}const p2={"Academic Support":"#f68a69",Admissions:"#b3b3b3","Admin-General":"#dcf4b4","Alumni & Foundation":"#4CAF50",Art:"#ea0ea0",Athletics:"#ea550a",Biology:"#17becf","Bronco Blend":"#5a4b22","Business Economics":"#d77cf8","Business Office":"#C44E52","Career Services":"#ff7f50",Chaplain:"#7B7F9E",Chemistry:"#f24516",Classroom:"#c20583",CFO:"#789051",CIO:"#2282bd",Communication:"#109014","Creighton Coll of Nursing":"#76C7C0","Digital Art":"#ffb347",Esports:"#00B894",Facilities:"#2CA02C","Financial Aid":"#8C564B",Forensics:"#aef2e1","Health Center":"#f50909","History, Religion, Philosophy":"#649515",Housing:"#f54d4d",HR:"#3498DB",IR:"#3b580e",IT:"#836377","Languages & Literatures":"#4a64b9",Library:"#079c29","Maintenance & Facilities":"#a6a6a6",Math:"#427b75",Music:"#9467bd",Offline:"#515250",OMC:"#9273f7",Open:"#95A5A6","Physical Education":"#a6d854",PM:"#d7a0fa","President Office":"#d884d8",Psychology:"#2bf087",Registrar:"#F1C40F","Service Learning/Chaplain":"#66c2a5","Student Accounts":"#86e6ed","Student Engagement":"#1584ed","Student Union":"#7cb0ef","Teacher Education":"#2E86AB",Theatre:"#f1374c",Unknown:"#8d776c",VPAA:"#1568f9","VPAA - Academic Admin":"#dde80d",Physics:"#ff24ab"},MA=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];function XV(n){let e=0;for(let t=0;t<n.length;t++)e=e*31+n.charCodeAt(t)>>>0;return e}function cd(n){if(!n)return"#AAAAAA";const e=p2[n];if(e)return e;const t=XV(n)%MA.length;return MA[t]}function DA(n){const e=n||{},t=Array.isArray(e.features)?e.features:[];let i=0,a=0,c=0,_=0;const y=new Map;for(const L of t){const R=L.properties||{},U=R.__areaSf??R.Area_SF??R.Area_SF??R.area??R.Area??R.SF??R["Area (SF)"]??R.NetArea??0,M=Number(U);if(!Number.isFinite(M)||M<=0)continue;a+=1,i+=M;const Q=String(R.__roomType??R.NCES_Type??"").trim(),ae=R.Name??R.Room??R["Room Name"]??"",ye=String(ae).toUpperCase(),ie=Q.toUpperCase();(ie.includes("CLASSROOM")||ie.includes("LECTURE")||ye.includes("CLASSROOM")||ye.includes("LECTURE"))&&(_+=1,c+=M);const ve=R.__dept??R.NCES_Department??R.NCES_Department??R.NCES_Dept??R["NCES Dept"]??R.department??R.Department??R.Dept??"",de=String(ve).trim();de&&y.set(de,(y.get(de)||0)+M)}const s=Array.from(y.entries()).sort((L,R)=>R[1]-L[1]).slice(0,12).map(([L,R])=>({name:L,sf:R,color:cd(L)})),T=Object.fromEntries(y);return{totalSf:i,rooms:a,classroomSf:c,classroomCount:_,totalsByDept:T,keyDepts:s}}const YV=n=>Number.isFinite(n)?Math.max(0,Math.min(n,100)):null,KV=n=>Number.isFinite(n)?`${Math.round(n)}%`:"--",OA=({label:n,value:e,color:t,compact:i})=>{if(!Number.isFinite(e))return se.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[se.jsx("div",{style:{fontSize:i?11:12,color:"#344054"},children:n}),se.jsx("div",{style:{fontSize:i?11:12,color:"#667085"},children:"--"})]});const a=YV(e),c=i?6:8;return se.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[se.jsxs("div",{children:[se.jsx("div",{style:{fontSize:i?11:12,color:"#344054",marginBottom:3},children:n}),se.jsx("div",{style:{height:c,background:"#e4e7ec",borderRadius:999,overflow:"hidden"},children:se.jsx("div",{style:{width:`${a}%`,height:"100%",background:t}})})]}),se.jsx("div",{style:{fontSize:i?11:12,color:"#475467",fontWeight:600},children:KV(e)})]})};function V9({timePct:n,seatPct:e,compact:t=!1}){return Number.isFinite(n)||Number.isFinite(e)?se.jsxs("div",{style:{display:"grid",gap:t?6:10},children:[se.jsx(OA,{label:"Time Utilization",value:n,color:"#3b82f6",compact:t}),se.jsx(OA,{label:"Seat Utilization",value:e,color:"#f59e0b",compact:t})]}):null}function ZV({buildingName:n,stats:e,keyDepts:t=[],floors:i=[],selectedFloor:a,onChangeFloor:c,onLoadFloorplan:_,onClose:y,onExportPDF:s,onExportCSV:T,onExplainBuilding:L,explainBuildingLoading:R=!1,explainBuildingDisabled:U=!1,explainBuildingError:M="",utilization:Q,dragHandleProps:ae}){const ye=_e=>Number.isFinite(_e)?Math.round(_e).toLocaleString():"-",ie=_e=>Number.isFinite(_e)?Number(_e).toLocaleString():"-",oe=!!ae,{style:ve,...de}=ae||{},Pe=Q&&(Number.isFinite(Q.timeUtilization)||Number.isFinite(Q.seatUtilization)),Be={display:"flex",justifyContent:"space-between",alignItems:"center",paddingRight:6,...oe?{cursor:"grab",userSelect:"none",touchAction:"none"}:{},...ve||{}};return se.jsxs("div",{style:{minWidth:320,maxWidth:360,padding:12,fontSize:13},children:[se.jsxs("div",{style:Be,...de,children:[se.jsx("div",{style:{fontWeight:700},children:n}),se.jsx("button",{onClick:y,"aria-label":"Close",style:{marginRight:4},children:""})]}),se.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) minmax(0, 1fr)",gap:8,marginTop:8},children:[se.jsxs("div",{children:[se.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"BUILDING TOTALS"}),se.jsxs("div",{children:[se.jsx("b",{children:"Total SF:"})," ",ye(e?.totalSf)]}),se.jsxs("div",{children:[se.jsx("b",{children:"Rooms:"})," ",ie(e?.rooms)]}),se.jsxs("div",{children:[se.jsx("b",{children:"Classroom SF:"})," ",ye(e?.classroomSf)]}),se.jsxs("div",{children:[se.jsx("b",{children:"Classrooms:"})," ",ie(e?.classroomCount)]}),se.jsxs("div",{children:[se.jsx("b",{children:"Levels:"})," ",i?.length??0]})]}),se.jsxs("div",{children:[se.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Key Departments"}),t.length===0?se.jsx("div",{style:{color:"#666"},children:""}):t.map(_e=>se.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,fontSize:12,lineHeight:1.25},children:[se.jsx("div",{style:{width:14,height:14,borderRadius:3,background:cd(_e.name),border:"1px solid #999"}}),se.jsxs("div",{style:{flex:1},children:[_e.name," ",Number.isFinite(_e.areaSf||_e.Area||_e.sf)?` (${Math.round(_e.areaSf||_e.Area||_e.sf).toLocaleString()} SF)`:""]})]},_e.name))]})]}),Pe?se.jsxs("div",{style:{marginTop:10},children:[se.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Classroom Utilization"}),se.jsx(V9,{timePct:Q.timeUtilization,seatPct:Q.seatUtilization,compact:!0})]}):null,se.jsxs("div",{style:{marginTop:12,display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[se.jsx("div",{children:se.jsx("b",{children:"Floor"})}),se.jsx("select",{value:a??"",onChange:_e=>c?.(_e.target.value),children:i.map(_e=>se.jsx("option",{value:_e,children:_e},_e))}),se.jsx("button",{className:"btn primary",onClick:_,children:"Load"}),se.jsx("button",{className:"btn secondary",onClick:s,children:"Export to PDF"}),se.jsx("button",{className:"btn",onClick:T,children:"Export CSV"}),se.jsx("button",{className:"btn",onClick:L,disabled:U||R,children:R?"Explaining...":" Explain this building"})]}),M?se.jsx("div",{style:{color:"crimson",marginTop:6,fontSize:12},children:M}):null]})}function JV({buildingName:n,floorLabel:e,stats:t,legendItems:i=[],floors:a=[],selectedFloor:c,onChangeFloor:_,onLoadFloorplan:y,onUnloadFloorplan:s,onClose:T,onExportPDF:L,onExportCSV:R,colorMode:U="department",onChangeColorMode:M,legendTitle:Q="Key Departments",legendSelection:ae,onLegendClick:ye,onExplainFloor:ie,explainLoading:oe=!1,explainDisabled:ve=!1,explainError:de="",moveScenarioMode:Pe=!1,onToggleMoveScenarioMode:Be,rotateActive:_e=!1,moveActive:G=!1,rotateValue:B=0,scaleValue:Y=1,rotateNotice:$="",rotateStored:J=!1,adjustDebugInfo:te=null,onStartRotate:Se,onStartMove:De,onCancelRotate:$e,onClearRotate:Ue,onScaleChange:Le,onSaveAdjust:He,saveAdjustDisabled:Ke=!1,dragHandleProps:Ce}){const ge=Oe=>Number.isFinite(Oe)?Math.round(Oe).toLocaleString():"-",We=Oe=>Number.isFinite(Oe)?Number(Oe).toLocaleString():"-",Ve=!!Ce,{style:ut,...pt}=Ce||{},It={display:"flex",justifyContent:"space-between",...Ve?{cursor:"grab",userSelect:"none",touchAction:"none"}:{},...ut||{}};return se.jsxs("div",{style:{minWidth:340,maxWidth:380,padding:12,fontSize:13},children:[se.jsxs("div",{style:It,...pt,children:[se.jsx("div",{style:{fontWeight:700},children:n}),se.jsx("button",{onClick:T,"aria-label":"Close",children:""})]}),se.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 0.95fr) minmax(0, 1.05fr)",gap:10,marginTop:8},children:[se.jsxs("div",{children:[se.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"FLOOR TOTALS"}),se.jsxs("div",{children:[se.jsx("b",{children:"Floor:"})," ",e??"-"]}),se.jsxs("div",{children:[se.jsx("b",{children:"Total SF:"})," ",ge(t?.totalSf)]}),se.jsxs("div",{children:[se.jsx("b",{children:"Rooms:"})," ",We(t?.rooms)]}),se.jsxs("div",{children:[se.jsx("b",{children:"Classroom SF:"})," ",ge(t?.classroomSf)]}),se.jsxs("div",{children:[se.jsx("b",{children:"Classrooms:"})," ",We(t?.classroomCount)]})]}),se.jsxs("div",{children:[se.jsx("div",{style:{fontWeight:600,marginBottom:6},children:Q}),i.length===0?se.jsx("div",{style:{color:"#666"},children:""}):se.jsx("div",{style:{maxHeight:"46vh",overflowY:"auto"},children:i.map(Oe=>se.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,padding:"2px 0",borderRadius:4,cursor:ye?"pointer":"default",background:ae===Oe.name?"#f0f4ff":"transparent",fontSize:12,lineHeight:1.25},onClick:()=>ye?.(Oe.name),children:[se.jsx("div",{style:{width:14,height:14,borderRadius:3,background:Oe.color||cd(Oe.name),border:"1px solid #999"}}),se.jsxs("div",{style:{flex:1},children:[Oe.name," ",Number.isFinite(Oe.areaSf||Oe.Area||Oe.sf)?` (${Math.round(Oe.areaSf||Oe.Area||Oe.sf).toLocaleString()} SF)`:""]})]},Oe.name))})]})]}),se.jsxs("div",{style:{marginTop:12,display:"flex",flexDirection:"column",gap:10},children:[se.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[se.jsx("div",{children:se.jsx("b",{children:"Floor"})}),se.jsx("select",{value:c??"",onChange:Oe=>_?.(Oe.target.value),children:a.map(Oe=>se.jsx("option",{value:Oe,children:Oe},Oe))}),se.jsx("button",{className:"btn primary",onClick:y,children:"Load"}),s?se.jsx("button",{className:"btn",onClick:s,children:"Unload"}):null]}),se.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:6},children:[se.jsx("button",{className:"btn secondary",onClick:L,children:"Export to PDF"}),R?se.jsx("button",{className:"btn",onClick:R,children:"Export CSV"}):null,se.jsx("button",{className:"btn",onClick:ie,disabled:ve||oe,children:oe?"Explaining...":" Explain this floor"})]}),de?se.jsx("div",{style:{color:"crimson",fontSize:12},children:de}):null,se.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[se.jsx("div",{style:{fontWeight:600},children:"Highlight By"}),se.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:6},children:[{key:"department",label:"Department"},{key:"type",label:"Type"},{key:"occupancy",label:"Occupancy"}].map(Oe=>se.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13},children:[se.jsx("input",{type:"radio",name:"highlight-mode",value:Oe.key,checked:U===Oe.key,onChange:Wt=>M?.(Wt.target.value)}),Oe.label]},Oe.key))}),Be?se.jsxs("div",{style:{marginTop:6},children:[se.jsxs("button",{className:"btn",style:{width:"100%",fontWeight:600},onClick:Be,children:["Move Scenario Mode ",Pe?"ON":"OFF"]}),se.jsx("div",{style:{marginTop:4,fontSize:11,color:"#555",textAlign:"center"},children:"Click rooms to add/remove them from a what-if scenario. Real data is not changed."})]}):null,Se?se.jsxs("div",{style:{marginTop:10,paddingTop:8,borderTop:"1px solid #e5e5e5"},children:[se.jsx("div",{style:{fontWeight:600},children:"Adjust Floorplan"}),se.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:_e||G?"Drag on the map. Release to save.":"Use Rotate or Move, then drag on the map to adjust rooms + linework together."}),se.jsxs("div",{style:{fontSize:12,marginTop:2},children:["Rotation: ",Number.isFinite(B)?`${B.toFixed(1)}`:"0","  Scale: ",Number.isFinite(Y)?Y.toFixed(2):"1.00"]}),se.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:6},children:[se.jsx("button",{className:"btn",onClick:_e?$e:Se,children:_e?"Cancel Rotate":"Rotate"}),De?se.jsx("button",{className:"btn",onClick:G?$e:De,children:G?"Cancel Move":"Move"}):null,Le?se.jsxs(se.Fragment,{children:[se.jsx("button",{className:"btn",onClick:()=>Le(-.02),children:"- Scale"}),se.jsx("button",{className:"btn",onClick:()=>Le(.02),children:"+ Scale"})]}):null,He?se.jsx("button",{className:"btn primary",onClick:He,disabled:Ke,children:"Save Adjust"}):null,Ue?se.jsx("button",{className:"btn",onClick:Ue,disabled:!J,children:"Clear Adjust"}):null]}),$?se.jsx("div",{style:{color:"crimson",fontSize:12,marginTop:4},children:$}):null,null]}):null]})]})]})}function FA({label:n,value:e,onChange:t,options:i,placeholder:a}){const[c,_]=tr.useState(!1),[y,s]=tr.useState(""),T=tr.useRef(null),L=tr.useMemo(()=>{const Q=new Set,ae=[];return(i||[]).forEach(ye=>{const ie=typeof ye=="string"?{value:ye,label:ye}:ye;!ie||!ie.value||Q.has(ie.value)||(Q.add(ie.value),ae.push({value:ie.value,label:ie.label??ie.value}))}),ae},[i]),R=tr.useMemo(()=>L.find(ae=>ae.value===e)?.label??e??"",[L,e]),U=tr.useMemo(()=>{const Q=(y||"").toLowerCase();return Q?L.filter(ae=>{const ye=(ae.label??"").toLowerCase(),ie=(ae.value??"").toLowerCase();return ye.includes(Q)||ie.includes(Q)}):L},[L,y]),M=y||R||"";return se.jsxs("div",{className:"mf-form-row",style:{position:"relative"},children:[se.jsx("label",{children:n}),se.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[se.jsx("input",{ref:T,className:"mf-input",placeholder:a,value:M,onChange:Q=>{const ae=Q.target.value;s(ae),t?.(ae)},onFocus:()=>_(!0)}),se.jsx("button",{type:"button",className:"mf-input",style:{width:34,padding:0,display:"grid",placeItems:"center"},onClick:()=>{_(Q=>{const ae=!Q;return ae&&T.current?.focus(),ae})},title:"Toggle options",children:""})]}),c&&se.jsx("div",{style:{position:"absolute",zIndex:9999,left:0,right:0,top:"100%",background:"#fff",border:"1px solid #ddd",borderRadius:8,maxHeight:240,overflow:"auto",marginTop:6,boxShadow:"0 8px 24px rgba(0,0,0,.12)"},onMouseDown:Q=>Q.preventDefault(),children:U.length===0?se.jsx("div",{style:{padding:10,color:"#777"},children:"No matches"}):U.map(Q=>se.jsx("div",{style:{padding:"8px 10px",cursor:"pointer"},onClick:()=>{t?.(Q.value),s(""),_(!1)},children:Q.label},Q.value))})]})}function Rw(n,e=8){if(!n)return[];const t=Object.entries(n);return t.sort((i,a)=>(a[1]||0)-(i[1]||0)),t.slice(0,e).map(([i,a])=>({name:i,areaSf:a}))}const QV=n=>{const e=Number(n||0);return Number.isFinite(e)?Math.round(e).toLocaleString():"0"},eq=({label:n,value:e})=>se.jsxs("div",{style:{background:"#f9fafb",border:"1px solid #e4e7ec",borderRadius:8,padding:8},children:[se.jsx("div",{style:{fontSize:10,textTransform:"uppercase",letterSpacing:.4,color:"#667085"},children:n}),se.jsx("div",{style:{fontSize:16,fontWeight:800,color:"#1d2939"},children:e})]}),Mw=({children:n,style:e})=>se.jsx("div",{style:{background:"#f9fafb",border:"1px solid #e4e7ec",borderRadius:8,padding:8,...e},children:n}),tq=({pct:n,occupied:e=0,vacant:t=0,unknown:i=0,scopeLabel:a=""})=>{const c=Number.isFinite(n)?Math.max(0,Math.min(1,n)):null,_=-90+(c||0)*180,y=c==null?"--":`${Math.round(c*100)}%`;return se.jsxs("div",{className:"mf-gauge",children:[se.jsx("div",{className:"mf-gauge-title",children:"OFFICE OCCUPANCY"}),a?se.jsx("div",{style:{fontSize:11,color:"#667085",marginTop:-2,marginBottom:6},children:a}):null,se.jsxs("svg",{width:"170",height:"110",viewBox:"0 0 200 130","aria-label":"Office Occupancy",children:[se.jsx("path",{d:"M 20 110 A 80 80 0 0 1 80 30",fill:"none",stroke:"#d64545",strokeWidth:"16",strokeLinecap:"round"}),se.jsx("path",{d:"M 80 30 A 80 80 0 0 1 120 30",fill:"none",stroke:"#f0a23b",strokeWidth:"16",strokeLinecap:"round"}),se.jsx("path",{d:"M 120 30 A 80 80 0 0 1 180 110",fill:"none",stroke:"#2aa84a",strokeWidth:"16",strokeLinecap:"round"}),se.jsxs("g",{transform:`translate(100 110) rotate(${_})`,children:[se.jsx("line",{x1:"0",y1:"0",x2:"0",y2:"-70",stroke:"#222",strokeWidth:"3"}),se.jsx("circle",{cx:"0",cy:"0",r:"6",fill:"#222"})]}),se.jsx("text",{x:"20",y:"125",fontSize:"11",fill:"#666",children:"low"}),se.jsx("text",{x:"92",y:"20",fontSize:"11",fill:"#666",children:"mid"}),se.jsx("text",{x:"168",y:"125",fontSize:"11",fill:"#666",children:"high"}),se.jsx("text",{x:"100",y:"90",textAnchor:"middle",fontSize:"16",fontWeight:"700",fill:"#1d2939",children:y})]}),se.jsxs("div",{className:"mf-gauge-meta",children:[c==null?se.jsx("div",{className:"muted",children:"No occupancy data"}):se.jsxs("div",{children:[se.jsx("b",{children:y})," occupied"]}),se.jsxs("div",{className:"muted",children:["Occ: ",e," | Vac: ",t," | Unk: ",i]})]})]})},nq=({entries:n=[],maxSlices:e=8})=>{const t=n.slice(0,e),i=n.slice(e).reduce((U,M)=>U+Number(M?.sf||0),0),a=i>0?[...t,{name:"Other",sf:i}]:t,c=a.reduce((U,M)=>U+Number(M?.sf||0),0)||1,_="#94a3b8";let y=0;const s=60,T=60,L=50,R=a.map((U,M)=>{const Q=U?.name||"Unknown",ae=Number(U?.sf||0),ye=ae/c,ie=y+ye*Math.PI*2,oe=s+L*Math.cos(y),ve=T+L*Math.sin(y),de=s+L*Math.cos(ie),Pe=T+L*Math.sin(ie),Be=ye>.5?1:0,_e=[`M ${s} ${T}`,`L ${oe} ${ve}`,`A ${L} ${L} 0 ${Be} 1 ${de} ${Pe}`,"Z"].join(" "),G=Q==="Other"?_:cd(Q);return y=ie,{d:_e,name:Q,sf:ae,color:G}});return se.jsxs("div",{className:"mf-pie",children:[se.jsx("div",{className:"mf-section-title",children:"Departments (SF)"}),se.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[se.jsx("svg",{width:"120",height:"120",viewBox:"0 0 120 120","aria-label":"Department share by SF",children:R.map((U,M)=>se.jsx("path",{d:U.d,fill:U.color,stroke:"#fff",strokeWidth:"1"},M))}),se.jsx("div",{className:"mf-pie-legend",children:R.slice(0,6).map((U,M)=>se.jsxs("div",{className:"mf-legend-row",children:[se.jsx("span",{className:"mf-swatch",style:{background:U.color}}),se.jsx("span",{className:"mf-legend-name",title:U.name,children:U.name}),se.jsx("span",{className:"mf-legend-sf",children:Math.round(U.sf).toLocaleString()})]},M))})]})]})};function rq({title:n,metrics:e,loading:t,error:i,scopeLabel:a,utilization:c,utilizationScopeLabel:_,heatmapOn:y,onToggleHeatmap:s}){const T=e?.officeOccupancy||{},L=c&&(Number.isFinite(c.timeUtilization)||Number.isFinite(c.seatUtilization));return se.jsxs("div",{style:{padding:6,width:"100%",display:"flex",flexDirection:"column",height:"100%"},children:[se.jsx("div",{style:{fontWeight:800,fontSize:13,marginBottom:6},children:n}),t&&se.jsx("div",{style:{fontSize:12,color:"#667085"},children:"Loading dashboard..."}),i&&se.jsx("div",{style:{fontSize:12,color:"#b00020"},children:String(i)}),!t&&!i&&e&&se.jsxs(se.Fragment,{children:[se.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) 1.3fr",gap:6},children:[se.jsx(eq,{label:"Total SF",value:QV(e.totalSf)}),se.jsx(Mw,{children:se.jsx(tq,{pct:T.pct,occupied:T.occupied,vacant:T.vacant,unknown:T.unknown,scopeLabel:a})})]}),se.jsxs("div",{style:{flex:1,overflowY:"auto",paddingRight:4,marginTop:8},children:[se.jsx(Mw,{children:se.jsx(nq,{entries:e.byDept||[]})}),L?se.jsxs(Mw,{style:{marginTop:8},children:[se.jsx("div",{className:"mf-section-title",children:"Classroom Utilization"}),_?se.jsx("div",{style:{fontSize:11,color:"#667085",marginTop:-2,marginBottom:6},children:_}):null,se.jsx(V9,{timePct:c.timeUtilization,seatPct:c.seatUtilization,compact:!0}),se.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,marginTop:8,fontSize:12},children:[se.jsx("input",{type:"checkbox",checked:!!y,onChange:R=>s?.(R.target.checked)}),"Classroom Utilization Heat Map"]})]}):null]})]})]})}function q9(n={}){const e=n.area??n.Area??n["Area (SF)"]??n.SF??n.NetArea??n.Area_SF??n.Area_SF??0,t=Number(e);return!Number.isFinite(t)||t<=0?null:t}function m2(n={}){const e=n.occupancyStatus??n["Occupancy Status"]??n.vacancy??n.Vacancy??n.Vacant??n.Occupancy??n.OccupancyStatus??n.Status??"",t=String(e).trim().toUpperCase(),i=typeof e=="string"&&t.length>0||typeof e=="boolean"||typeof e=="number",a=e===!0||t==="VACANT"||t.includes("VACANT")||t.includes("UNOCCUPIED")||t.includes("AVAILABLE"),c=e===!1||t==="OCCUPIED"||t.includes("OCCUPIED");return i?a&&!c?"Vacant":c?"Occupied":"Unknown":(n.occupant??n.Occupant??n.AssignedTo??n.Assignee??"").toString().trim().length>0?"Occupied":"Unknown"}const iq=["Office - Staff","Office - Prof and Admin","Office - Prof & Admin","Office - Prof/Admin","Office - Faculty","Office - Adjunct Faculty","Office - Emeritus Faculty"],G9=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\b(and|&)\b/g," ").replace(/\s+/g," ").trim(),sq=new Set(iq.map(G9).filter(Boolean));function oq(n={}){const e=(n.NCES_Type??n.NCES_Type_Desc??n.__roomType??n.RoomTypeName??n.RoomType??n.Type??n.type??"").toString().toLowerCase();return sq.has(G9(e))}function aq(n){const e=Array.isArray(n)?n:Array.isArray(n?.features)?n.features:[];let t=0,i=0,a=0;for(const c of e){const _=c?.properties||{};if(!oq(_))continue;const y=m2(_);y==="Occupied"?t+=1:y==="Vacant"?i+=1:a+=1}return{pct:t+i>0?t/(t+i):null,occupied:t,vacant:i,unknown:a,totalOffices:t+i+a}}function lq(n={}){const e=q9(n);if(!e)return null;const t=(n.NCES_Department??n.department??n.Department??n.Dept??"").toString().trim()||"Unspecified",i=(n.NCES_Type??n.NCES_Type_Desc??n.RoomTypeName??n.RoomType??n.Type??n.type??"").toString().trim()||"Unknown",a=m2(n);return{sf:e,dept:t,type:i,occupancy:a}}function uq(n){const e=Array.isArray(n)?n:Array.isArray(n?.features)?n.features:[];let t=0,i=0,a=0,c=0,_=0,y=0;for(const L of e){const R=L?.properties||{},U=q9(R);if(!U)continue;const M=m2(R);M==="Vacant"?(i+=U,_+=1):M==="Occupied"?(t+=U,c+=1):(a+=U,y+=1)}const s=t+i+a,T=c+_+y;return{totalSF:s,totalRooms:T,occupiedSF:t,vacantSF:i,unknownSF:a,occupiedRooms:c,vacantRooms:_,unknownRooms:y,occupancyRate:s>0?t/s:null}}function cq(n=[]){let e=0,t=0;const i=new Map,a=new Map,c=new Map,_=L=>{const R=String(L||"").trim();if(!R)return!1;const U=R.toUpperCase();return/^rec[a-z0-9]{6,}$/i.test(R)?!1:U!=="UNSPECIFIED"&&U!=="UNKNOWN"&&U!=="N/A"&&U!=="NA"};for(const L of n){const R=lq(L?.properties||{});R&&(t+=1,e+=R.sf,_(R.dept)&&i.set(R.dept,(i.get(R.dept)||0)+R.sf),a.set(R.type,(a.get(R.type)||0)+R.sf),c.set(R.occupancy,(c.get(R.occupancy)||0)+R.sf))}const y=(L,R=10)=>Array.from(L.entries()).map(([U,M])=>({name:U,sf:M})).sort((U,M)=>M.sf-U.sf).slice(0,R),s=uq(n),T=aq(n);return{totalSf:e,roomCount:t,byDept:y(i,10),byType:y(a,10),byOccupancy:y(c,6),occupancySummary:s,officeOccupancy:T}}const hq={},{useRef:Ks,useEffect:Oi,useState:rr,useCallback:vr,useMemo:Ml}=iP,fq="https://github-stakeholder-ai.onrender.com";function $9(){const n="".trim();return n||(typeof window<"u"&&window.location.hostname.includes("github.io")?fq:"")}function dq(){const n=[];for(const[e,t]of Object.entries(p2))n.push(e,t);return["match",["coalesce",["feature-state","department"],["get","department"],["get","Department"],["get","Dept"],["get","NCES_Department"],["get","NCES_Dept"]],...n,"#e6e6e6"]}const pq=n=>{let e=0;for(let t=0;t<n.length;t++)e=e*31+n.charCodeAt(t)>>>0;return e},BA=["#ef4444","#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#2563eb","#4f46e5","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e","#fb7185","#f472b6","#38bdf8","#2dd4bf","#34d399","#a3e635","#facc15","#fb923c","#f87171","#60a5fa","#818cf8","#22d3ee","#4ade80"],mq=(n,e=0)=>{const t=String(n||"").replace("#","");if(!/^[0-9a-fA-F]{6}$/.test(t)||!Number.isFinite(e)||e===0)return n;const i=y=>Math.max(0,Math.min(255,y+e)),a=i(parseInt(t.slice(0,2),16)),c=i(parseInt(t.slice(2,4),16)),_=i(parseInt(t.slice(4,6),16));return`#${[a,c,_].map(y=>y.toString(16).padStart(2,"0")).join("")}`},G5=n=>{if(!n)return"#CCCCCC";const e=String(n).trim().toLowerCase();if(e==="public corridor"||e.includes("corridor")||e.includes("circulation"))return"#D9D9D9";const t=pq(e),i=BA[t%BA.length],a=[0,18,-12][(t>>>5)%3];return mq(i,a)};function gq(n){return n?.length?n.map(e=>{const t=e.dept||e.name||e.Dept||e.Department;return t?`<div style="display:flex;align-items:center;gap:8px;margin:3px 0;">
        <span style="width:14px;height:14px;border-radius:3px;background:${cd(t)};border:1px solid #00000022"></span>
        <span>${t}</span>
      </div>`:""}).filter(Boolean).join(""):""}const zA=(n,e,t)=>Math.max(e,Math.min(n,t)),yq=n=>n instanceof Element?!!n.closest('button, a, input, select, textarea, [role="button"]'):!1,V0=(n,e,t,i)=>{if(n.button!==0||yq(n.target))return;const a=e.current;if(!a||!i)return;const c=i();if(!c)return;n.preventDefault(),n.stopPropagation();const _=a.getBoundingClientRect(),y=n.clientX-_.left,s=n.clientY-_.top,T=8,L=document.body.style.userSelect,R=(Q,ae)=>{const ye=Q-c.left-y,ie=ae-c.top-s,oe=Math.max(T,c.width-_.width-T),ve=Math.max(T,c.height-_.height-T);t({x:zA(ye,T,oe),y:zA(ie,T,ve)})},U=Q=>{R(Q.clientX,Q.clientY)},M=()=>{window.removeEventListener("pointermove",U),window.removeEventListener("pointerup",M),window.removeEventListener("pointercancel",M),document.body.style.userSelect=L};document.body.style.userSelect="none",window.addEventListener("pointermove",U),window.addEventListener("pointerup",M),window.addEventListener("pointercancel",M)},_q=["Classroom - General (111)","Classroom - Lecture Hall","Classroom - Indoor Amphitheater / Auditorium","Classroom - Multipurpose","Classroom - Service","Classroom - Seminar","Classroom - Dist Ed / Interactive","Classroom - Computer","Classroom - Collaborative","Laboratory - Class","Laboratory - Computer (non-scheduled)","Laboratory - Studio","Laboratory - Service","Laboratory - Open (non-scheduled)","Laboratory - Music Practice (non-scheduled)","Laboratory - Special Nonclass","Special Nonclass Lab Svs","Office - Prof and Admin (310)","Office - Staff (311)","Office - Faculty","Office - Adjunct Faculty","Office - Graduate / Post Doc Students","Office - Service","Office - Research / Non-Faculty","Office - Emeritus Faculty","Office - Other","Office - Waiting / Reception","Office - Student / Organization","Office - Pantry / Kitchenette","Office - Lounge / Lunch Room","Office - File Room","Office - Work Room","Office - Mail Room","Office - Vault","Office - Department / Suite Circulation","Office - Conference Room","Office - Conference Room Service","Office - Library / Reference Room","Office - Collaborative Work Space","Library - Study / Collaborative Area","Library / Testing / Study Room Service","Training / Tutorial Room","Library - Resource Room","Library Circulation or Reference","Library - Stack","Library / Testing / Study - Storage","Library - Open Stack, Study Area","Library - Processing Room","Academic Assistance","Academic Testing","Interview Room","Departmental Library","Recreation - Health or Physical Education","Athletics - Intercollegiate Sports","Spectator Seating","Fitness Area","Recreation - Service","Athletics - Intercollegiate Sports Service","Ice Rink","Swimming Pool","Athletics - Locker Room or Shower Area","Media - Multi Media Production","Media - Television Studio","Media - Radio Station","Media - Newspaper or Publications","Media - Service","Clinic - (Non-Health care)","Clinic - Observation Room (Non-Health care)","Clinic - Service (Non-Health care)","Clinic - Interview Room (Non-Health care)","Demonstration","Demonstration Service","Special Use - Other (All Purpose)","Public Performance / Assembly","Auditorium","Multi-Purpose Room","Dressing Room","Checkroom","Assembly Room Service (All Types)","Gallery","Museum","Exhibition / Display","Museum / Display / Exhibit Service","Dining / Food Facility","Vending","Dining / Food Service","Kitchen","Dry Food Storage","Cold Food Storage","Lounge - Public","Lounge - Faculty","Lounge - Staff","Lounge - Student","Lounge - Service","Merchandising","Bookstore","Merchandising Service","Recreation - General Use","Recreation Service - General Use","General - Locker Room","General - Locker Room (All Gender)","General - Locker Room Service","Computing or Networking (Central)","Telecom Room (Central)","Telecom / Audio / Video Room","Server Room","IT / Telecom / Network Service","Shop","Shop Service","Storage Room - Central","Storage Room - General","Vehicle / Equipment Storage","Vehicle / Equipment Storage Service","Central Services","Laundry - Central","Central Service Support","Hazardous Materials","Hazardous Materials Service","Parking Garage","Parking Garage Service","Patient Bedroom","Patient Bedroom Service","Health Care - Nurse Station","Utility Room","Record Room","Health Care - Recovery Room","Health Care - Treatment / Examination","Procedure Room","Health Care - Examining Room","Health Care - Therapy Room","Recreation Room","Health Care - Treatment / Examination Service","Health Care - X-Ray Treatment Room","Pharmacy","Health Care - Miscellaneous Storage","Health Care - Patient Reception","Dorm - Sleep / Study NO Toilet & Bath","Dorm - Bedroom Closet","Dorm - Lounge / Study Room","Dorm - Hallway","Dorm - Living Room","Dorm - Toilet or Bath","Sleep / Study WITH Toilet & Bath","Staff Quarters With Bath","Sleep / Study Service","Residence - Laundry","Residence - Storage Room","Apartment - Whole Building","Apartment - Whole Unit","Apartment - Bedroom","Apartment - Closet","Apartment - Living Room","Apartment - Service","Apartment - Kitchen","Apartment - Hallway","Apartment - Bathroom","Apartment - Storage","House","Rental House","Visiting/Special Residence","Other University Residence","Vacant - Assigned","Inactive Area","Available Unassigned","Alteration or Conversion Area","Unfinished Area","Clear Story (open to below)","Leased to Others","Unknown / No Data","Public Corridor","Non-Public Corridor","Lobby","Stairway","Escalator","Elevators","Vestibule","Ramp","Receiving / Loading Dock","Exterior Space - Covered","Commons Area","Custodial Area","Custodial Storage","Custodial Locker Room","Utility Room","Building Storage","Women's Restroom","Men's Restroom","Single Stall Restroom","Private Restroom","Trash / Recycle Room","Nursing / Lactation Room","Emergency Management Command Room","Mechanical Area","Mechanical Duct / Chase or Shaft Area","Interior Incinerator","Central Utility Plant Facility","Electrical Equipment Area","Structural Area","Storage Room - General","Testing"],g2=["Teacher Education","Business Office","Registrar","VPAA - Academic Admin","Chaplain","Financial Aid","Facilities","HR","Music","Open","Physical Education","Admissions","IT","Library","Student Accounts","Student Engagement","Health Center","Biology","Chemistry","Physics","Psychology","History, Religion, Philosophy","Languages & Literatures","Math","Art","Digital Art","Communication","Academic Support","Athletics","Esports","Forensics","CIO","CFO","President Office","Alumni & Foundation","Business Economics","Classroom","Creighton Coll of Nursing","Admin-General","Bronco Blend"],qa=n=>(n??"").toString().trim(),_y=n=>{if(n==null)return"";if(typeof n=="string"||typeof n=="number")return String(n).trim();if(typeof n=="object"){const e=n.id??n.floorId??n.floor??n.name??n.label??n.value??"";return e!=null?String(e).trim():""}return String(n).trim()},iy=(n,e)=>{if(!n)return null;const t=typeof n=="object"?n.id??n.buildingId??n.name??n.label??n.value??"":n;return t?e(t):null};function h_(n={}){return n.Department||n.department||n.Dept||n.NCES_Department||n.NCES_Department||n["Department Owner Text"]||""}function Xd(n={},e=[]){if(!n||!Array.isArray(e))return null;for(const t of e){const i=n[t];if(i!=null&&String(i).trim()!=="")return i}return null}function vq(n,e,t){const i=(n||"").toString().trim(),a=qa(e),c=qa(t);return a&&c?`${a} - ${c} ${i}`.trim():a?`${a} ${i}`.trim():i||""}function H9(n,e={}){const t=qa(n);if(!t)return null;const i=qa(e.typeDesc??e.typeLabel??e.typeName),a=vq(i||t,e.categoryCode,e.typeCode)||t;return{value:t,label:a}}function xq(n=[]){const e=new Map;return(n||[]).forEach(t=>{const i=H9(t);i&&e.set(i.value,i)}),Array.from(e.values()).sort((t,i)=>t.label.localeCompare(i.label))}function bq(n=[],e=[]){const t=new Map;return(n||[]).forEach(i=>{i?.value&&t.set(i.value,i)}),(e||[]).forEach(i=>{i?.value&&t.set(i.value,i)}),Array.from(t.values()).sort((i,a)=>i.label.localeCompare(a.label))}function W9(n,e=.35){if(!n)return`rgba(255,165,0,${e})`;const t=n.replace("#","");if(!/^[0-9a-fA-F]+$/.test(t))return`rgba(255,165,0,${e})`;const i=parseInt(t,16);if(Number.isNaN(i))return`rgba(255,165,0,${e})`;const a=i>>16&255,c=i>>8&255,_=i&255;return`rgba(${a},${c},${_},${e})`}function X9(n={}){const e=Xd(n,["RoomCategory","Category","CategoryCode","rm_cat","rm_cat_id","NCES_Category","NCES Category","NCES_Category_Code","NCES Category Code"]);return e?String(e).trim():null}function Dw(n={}){const e=n.seatCount??n.SeatCount??n["Seat Count"]??n.Seats??n.Capacity??n.rm_seats??n.SeatingCapacity??n["NCES_Seat Count"]??n.NCES_Seat_Count??n["NCES_Seat Count"]??n.NCES_SeatCount??null,t=Number(e);return Number.isFinite(t)&&t>0?t:null}function Y9(n){if(!n)return!1;const e=String(n).trim();return e.length>0&&e.startsWith("3")}function wq(n){if(!n)return!1;const t=String(n).trim().charAt(0);return t==="1"||t==="2"}function K9(n={}){const e=Xd(n,["RoomType","roomType","Name","type","RoomTypeName","NCES_Type Description_Sh","NCES_Type Description","NCES Type Description","NCES_Type Description_Short"])??"",t=String(e).toLowerCase(),i=t.includes("office"),a=t.includes("classroom")||t.includes("lab")||t.includes("studio");return{norm:t,isOfficeText:i,isTeachingText:a}}function lg(n={}){const e=Xd(n,["FeatureClass","featureClass","Layer","layer","Type","type","Feature","feature","Name","name"])??"",t=String(e).toLowerCase();return t.includes("door")||t.includes("entrance")?"door":t.includes("stair")?"stair":"room"}function Sq(n){const e=new Map,t=new Set(g2.map(qa)),i=y=>Xd(y,["NCES_Category","NCES Category","NCES_Category_Code","NCES Category Code"]),a=y=>Xd(y,["NCES_Type","NCES Type","NCES_Type_Code","NCES Type Code"]),c=y=>Xd(y,["NCES_Type Description_Sh","NCES_Type Description","NCES Type Description","NCES_Type Description_Short"]),_=(y,s={})=>{const T=H9(y,s);T&&e.set(T.value,T)};for(const y of n||[]){const s=y.properties||{},T=qa(wf(s)),L=qa(s.department??s.Department??s.Dept),R=i(s),U=a(s),M=c(s);T&&_(T,{categoryCode:R,typeCode:U,typeDesc:M}),L&&t.add(L)}return{typeOptions:Array.from(e.values()).sort((y,s)=>y.label.localeCompare(s.label)),deptOptions:Array.from(t).filter(Boolean).sort()}}function Eq(n,e={}){if(!n||!Array.isArray(n.features)||!n.features.length)return null;const t=Lc(n);if(!t||t.some(_e=>!Number.isFinite(_e)))return null;const i=720,a=t[2]-t[0],c=t[3]-t[1];if(a<=0||c<=0)return null;const _=c/a,y=Math.max(260,Math.round(i*Math.max(.33,Math.min(_,2.5)))),s=document.createElement("canvas");s.width=i,s.height=y;const T=s.getContext("2d");T.fillStyle="#ffffff",T.fillRect(0,0,i,y);const L=_e=>{const G=(_e[0]-t[0])/a*i,B=y-(_e[1]-t[1])/c*y;return[G,B]},R=_e=>{if(!Array.isArray(_e))return;T.beginPath();const G=L(_e[0]);T.moveTo(G[0],G[1]);for(let B=1;B<_e.length;B++){const Y=L(_e[B]);T.lineTo(Y[0],Y[1])}T.closePath()},U=_e=>{if(!Array.isArray(_e))return;T.beginPath();const G=L(_e[0]);T.moveTo(G[0],G[1]);for(let B=1;B<_e.length;B++){const Y=L(_e[B]);T.lineTo(Y[0],Y[1])}},M=_e=>qa(_e?.department??_e?.Department??_e?.Dept??"")||"",Q=_e=>{if(Number.isFinite(_e))return _e;const G=Number(_e);return Number.isFinite(G)?G:_e!=null?String(_e):null},ae=new Set((e?.selectedIds||[]).map(_e=>Q(_e)).filter(_e=>_e!=null)),ye=e?.solidFill===!0,ie=e?.labelOptions||{},oe=ie.enabled!==!1,ve=ie.hideDrawing===!0,de={font:ie.font||'bold 10px "Open Sans", Arial, sans-serif',lineHeight:ie.lineHeight||12,maxLines:ie.maxLines||4,minWidth:ie.minWidth||32,minHeight:ie.minHeight||14},Pe=(_e,G,B,Y)=>{const $=[],J=te=>{const Se=qa(te);Se&&(ve&&Se.toLowerCase()==="drawing"||$.length>=de.maxLines||$.push(Se))};return J(_e?.Number??_e?.RoomNumber??_e?.number),J(wf(_e)||_e?.Name),J(G||B),Y>0&&J(`${Math.round(Y).toLocaleString()} SF`),$},Be=(_e,G)=>{if(!oe||!G.length)return;const Y=Gu(_e)?.geometry?.coordinates;if(!Y)return;const $=Lc(_e);if(!$)return;const J=($[2]-$[0])/a*i,te=($[3]-$[1])/c*y,Se=de.lineHeight*G.length;if(J<de.minWidth||te<Math.max(Se,de.minHeight))return;const[De,$e]=L(Y),Ue=de.lineHeight*G.length,Le=$e-Ue/2+de.lineHeight/2;T.save(),T.font=de.font,T.textAlign="center",T.textBaseline="middle",T.lineJoin="round",T.fillStyle="#101010",T.strokeStyle="rgba(255,255,255,0.95)",T.lineWidth=3;for(let He=0;He<G.length;He+=1){const Ke=Le+He*de.lineHeight;T.strokeText(G[He],De,Ke),T.fillText(G[He],De,Ke)}T.restore()};for(const _e of n.features){const G=_e?.properties||{},B=lg(G),Y=qa(G?.scenarioDepartment??G?.ScenarioDepartment??G?.scenarioDept??""),$=M(G),J=Y||$,te=G?.__roomType||wf(G)||G?.Name||"",Se=(G?.occupant??G?.Occupant??"").toString().trim(),De=e?.colorMode||"department";let $e="#f7f7f7";De==="type"?$e=G5(te):De==="occupancy"?$e=Se?"#29b6f6":"#e0e0e0":De==="vacancy"?$e=Se?"#29b6f6":"#ff7043":$e=J?cd(J):"#f7f7f7";let Ue=$e?W9($e,ye?1:Y?.9:.4):"#f7f7f7",Le="#2b2b2b",He=B==="room"?2.2:1.5;const Ke=Q(_e?.id??G?.RevitId??G?.Revit_UniqueId??G?.RevitUniqueId??G?.Revit_UniqueID??G?.["Revit Unique Id"]??G?.["Room GUID"]??G?.roomGuid??G?.id),Ce=Ke!=null&&ae.has(Ke);B==="door"?(Ue="#1d1d1d",Le="#0d0d0d",He=1.5):B==="stair"?(Ue="#6b6b6b",Le="#3a3a3a",He=1.5):$e&&(Le="#202020"),Ce&&(B==="room"&&(Ue="rgba(0, 200, 255, 0.35)"),Le="#00c8ff",He=4);const ge=_e?.geometry;if(!ge||!ge.coordinates)continue;const We=(pt,It)=>{Array.isArray(pt)&&(It==="Polygon"?(T.fillStyle=Ue,T.strokeStyle=Le,T.lineWidth=He,pt.forEach(Oe=>{R(Oe),T.fill(),T.stroke()})):It==="MultiPolygon"?pt.forEach(Oe=>We(Oe,"Polygon")):It==="LineString"?(T.strokeStyle=Le,T.lineWidth=B==="door"?2:1.5,U(pt),T.stroke()):It==="MultiLineString"&&pt.forEach(Oe=>We(Oe,"LineString")))};We(ge.coordinates,ge.type);const Ve=Number(G?.Area_SF??G?.Area??G?.["Area (SF)"]??G?.Area_sf??G?.NetArea??G?.SF??0),ut=Number.isFinite(Ve)&&Ve>0?Ve:0;if(B==="room"){const pt=Pe(G,Y,$,ut);Be(_e,pt)}}return{width:s.width,height:s.height,data:s.toDataURL("image/png")}}function sy(n={}){const e=n?.fc??n;return e?Eq(e,n):null}const wf=(n={})=>{const e=n["Room Type Description"]??n.RoomTypeDescription??n.roomTypeDescription;if(e&&String(e).trim())return String(e).trim();const t=n.NCES_Type??n["NCES Type"]??n["NCES Types"]??n.NCES_Types??n.nces_type??n.ncesType;if(t&&String(t).trim())return String(t).trim();const i=n["NCES_Type Description_Sh"]??n["NCES_Type Description"]??n["NCES Type Description"]??n["NCES_Type Description_Short"]??n["NCES Type Description Short"];return i&&String(i).trim()?String(i).trim():(n["Room Type"]||n.RoomType||n.RoomTypeName||n.Type||n.type||n.Category||n.category||n.Name||n["Room Name"]||"").toString().trim()};function y2(n={}){return(n.NCES_Type??n["NCES Types"]??n.NCES_Types??n.nces_type??n.ncesType??"").toString().trim()}function Z9(n={}){return(n.NCES_Department??n.NCES_Department??n.NCES_Dept??n["NCES Dept"]??n.department??n.Department??n.Dept??"").toString().trim()}function J9(n={}){const e=n.Area_SF??n.Area_SF??n.area??n.Area??n.SF??n["Area (SF)"]??n.NetArea??0,t=Number(e);return Number.isFinite(t)?t:0}function Tq(n){if(!n?.features?.length)return n;const e=n.features.map(t=>{const i=t?.properties||{};if("__roomType"in i)return t;const a=y2(i),c=a&&String(a).trim();return c?{...t,properties:{...i,__roomType:c}}:t});return{...n,features:e}}function Q9(n){if(!n)return null;const e=n.anchor_feet||n.anchorFeet||n.anchor;return[n.target_lon??n.targetLon,n.target_lat??n.targetLat,n.rotation_deg_cw??n.rotation_deg,n.scale_deg_per_foot??n.scale_deg_per_ft??n.scale,Array.isArray(e)?e.join(","):""].map(i=>i==null?"":String(i)).join("|")}const Aq="mfDrawingAlign:",f_=new Map,eL="mfFloorAdjust:",tL="mfFloorAdjustUrl:",nL="mfFloorAdjustFloor:",d_=new Map,p_=new Map,m_=new Map;function _2(n,e){const t=gc(n||""),i=El(e||"");return`${Aq}${t}/${i}`}function Qx(n,e){const t=gc(n||""),i=El(e||"");return`${eL}${t}/${i}`}function eb(n){const e=gc(n||"");return`${tL}${e}`}function tb(n,e){const t=n?qf(n):"",i=gc(t||n||""),a=El(e||"");return`${nL}${i}/${a}`}function rL(n){return n?[n.rotationDeg,n.scale,Array.isArray(n.pivot)?n.pivot.join(","):"",Array.isArray(n.target)?n.target.join(","):""].map(t=>t==null?"":String(t)).join("|"):null}function iL(n,e){const t=_2(n,e);if(!t)return null;if(f_.has(t))return f_.get(t);if(typeof window>"u"||!window.localStorage)return null;try{const i=window.localStorage.getItem(t);if(!i)return null;const a=JSON.parse(i);return!a||!Array.isArray(a.pivot)||!Array.isArray(a.target)?null:(f_.set(t,a),a)}catch{return null}}function eg(n,e){const t=Qx(n,e);if(!t)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};if(d_.has(t))return d_.get(t);if(typeof window>"u"||!window.localStorage)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};try{const i=window.localStorage.getItem(t);if(!i)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};const a=JSON.parse(i),c=Number(a?.rotationDeg),_=Number(a?.scale),y=Array.isArray(a?.translateMeters)?a.translateMeters:[0,0],s=Array.isArray(a?.translateLngLat)?a.translateLngLat:null,T=Number(a?.savedAt),L=Array.isArray(a?.pivot)?a.pivot:null,R=Array.isArray(a?.anchorLngLat)?a.anchorLngLat:null,U={rotationDeg:Number.isFinite(c)?c:0,scale:Number.isFinite(_)&&_>0?_:1,translateMeters:[Number.isFinite(y[0])?y[0]:0,Number.isFinite(y[1])?y[1]:0],translateLngLat:Array.isArray(s)?[Number.isFinite(s[0])?s[0]:0,Number.isFinite(s[1])?s[1]:0]:null,anchorLngLat:Array.isArray(R)?[Number.isFinite(R[0])?R[0]:0,Number.isFinite(R[1])?R[1]:0]:null,savedAt:Number.isFinite(T)?T:0,pivot:Array.isArray(L)&&L.length>=2?L:null};return d_.set(t,U),U}catch{return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0}}}function e_(n){const e=eb(n);if(!e)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};if(p_.has(e))return p_.get(e);if(typeof window>"u"||!window.localStorage)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};try{const t=window.localStorage.getItem(e);if(!t)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};const i=JSON.parse(t),a=Number(i?.rotationDeg),c=Number(i?.scale),_=Array.isArray(i?.translateMeters)?i.translateMeters:[0,0],y=Array.isArray(i?.translateLngLat)?i.translateLngLat:null,s=Number(i?.savedAt),T=Array.isArray(i?.pivot)?i.pivot:null,L=Array.isArray(i?.anchorLngLat)?i.anchorLngLat:null,R={rotationDeg:Number.isFinite(a)?a:0,scale:Number.isFinite(c)&&c>0?c:1,translateMeters:[Number.isFinite(_[0])?_[0]:0,Number.isFinite(_[1])?_[1]:0],translateLngLat:Array.isArray(y)?[Number.isFinite(y[0])?y[0]:0,Number.isFinite(y[1])?y[1]:0]:null,anchorLngLat:Array.isArray(L)?[Number.isFinite(L[0])?L[0]:0,Number.isFinite(L[1])?L[1]:0]:null,savedAt:Number.isFinite(s)?s:0,pivot:Array.isArray(T)&&T.length>=2?T:null};return p_.set(e,R),R}catch{return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0}}}function t_(n,e){const t=tb(n,e);if(!t)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};if(m_.has(t))return m_.get(t);if(typeof window>"u"||!window.localStorage)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};try{const i=window.localStorage.getItem(t);if(!i)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};const a=JSON.parse(i),c=Number(a?.rotationDeg),_=Number(a?.scale),y=Array.isArray(a?.translateMeters)?a.translateMeters:[0,0],s=Array.isArray(a?.translateLngLat)?a.translateLngLat:null,T=Number(a?.savedAt),L=Array.isArray(a?.pivot)?a.pivot:null,R=Array.isArray(a?.anchorLngLat)?a.anchorLngLat:null,U={rotationDeg:Number.isFinite(c)?c:0,scale:Number.isFinite(_)&&_>0?_:1,translateMeters:[Number.isFinite(y[0])?y[0]:0,Number.isFinite(y[1])?y[1]:0],translateLngLat:Array.isArray(s)?[Number.isFinite(s[0])?s[0]:0,Number.isFinite(s[1])?s[1]:0]:null,anchorLngLat:Array.isArray(R)?[Number.isFinite(R[0])?R[0]:0,Number.isFinite(R[1])?R[1]:0]:null,savedAt:Number.isFinite(T)?T:0,pivot:Array.isArray(L)&&L.length>=2?L:null};return m_.set(t,U),U}catch{return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0}}}function Iq(n,e,t){const i=_2(n,e);if(!i||!t||typeof window>"u"||!window.localStorage)return!1;try{return window.localStorage.setItem(i,JSON.stringify(t)),f_.set(i,t),!0}catch{return!1}}function Q1(n,e,t){const i=Qx(n,e);if(!i||!t||typeof window>"u"||!window.localStorage)return!1;const a=Array.isArray(t.pivot)?t.pivot:null,c=Array.isArray(t.translateLngLat)?t.translateLngLat:null,_=Array.isArray(t.anchorLngLat)?t.anchorLngLat:null,y={rotationDeg:Number.isFinite(t.rotationDeg)?t.rotationDeg:0,scale:Number.isFinite(t.scale)&&t.scale>0?t.scale:1,translateMeters:Array.isArray(t.translateMeters)?[Number.isFinite(t.translateMeters[0])?t.translateMeters[0]:0,Number.isFinite(t.translateMeters[1])?t.translateMeters[1]:0]:[0,0],translateLngLat:Array.isArray(c)?[Number.isFinite(c[0])?c[0]:0,Number.isFinite(c[1])?c[1]:0]:null,anchorLngLat:Array.isArray(_)?[Number.isFinite(_[0])?_[0]:0,Number.isFinite(_[1])?_[1]:0]:null,savedAt:Date.now(),pivot:Array.isArray(a)&&a.length>=2?a:null};try{return window.localStorage.setItem(i,JSON.stringify(y)),d_.set(i,y),!0}catch{return!1}}function ev(n,e){const t=eb(n);if(!t||!e||typeof window>"u"||!window.localStorage)return!1;const i=Array.isArray(e.pivot)?e.pivot:null,a=Array.isArray(e.translateLngLat)?e.translateLngLat:null,c=Array.isArray(e.anchorLngLat)?e.anchorLngLat:null,_={rotationDeg:Number.isFinite(e.rotationDeg)?e.rotationDeg:0,scale:Number.isFinite(e.scale)&&e.scale>0?e.scale:1,translateMeters:Array.isArray(e.translateMeters)?[Number.isFinite(e.translateMeters[0])?e.translateMeters[0]:0,Number.isFinite(e.translateMeters[1])?e.translateMeters[1]:0]:[0,0],translateLngLat:Array.isArray(a)?[Number.isFinite(a[0])?a[0]:0,Number.isFinite(a[1])?a[1]:0]:null,anchorLngLat:Array.isArray(c)?[Number.isFinite(c[0])?c[0]:0,Number.isFinite(c[1])?c[1]:0]:null,savedAt:Date.now(),pivot:Array.isArray(i)&&i.length>=2?i:null};try{return window.localStorage.setItem(t,JSON.stringify(_)),p_.set(t,_),!0}catch{return!1}}function tv(n,e,t){const i=tb(n,e);if(!i||!t||typeof window>"u"||!window.localStorage)return!1;const a=Array.isArray(t.pivot)?t.pivot:null,c=Array.isArray(t.translateLngLat)?t.translateLngLat:null,_=Array.isArray(t.anchorLngLat)?t.anchorLngLat:null,y={rotationDeg:Number.isFinite(t.rotationDeg)?t.rotationDeg:0,scale:Number.isFinite(t.scale)&&t.scale>0?t.scale:1,translateMeters:Array.isArray(t.translateMeters)?[Number.isFinite(t.translateMeters[0])?t.translateMeters[0]:0,Number.isFinite(t.translateMeters[1])?t.translateMeters[1]:0]:[0,0],translateLngLat:Array.isArray(c)?[Number.isFinite(c[0])?c[0]:0,Number.isFinite(c[1])?c[1]:0]:null,anchorLngLat:Array.isArray(_)?[Number.isFinite(_[0])?_[0]:0,Number.isFinite(_[1])?_[1]:0]:null,savedAt:Date.now(),pivot:Array.isArray(a)&&a.length>=2?a:null};try{return window.localStorage.setItem(i,JSON.stringify(y)),m_.set(i,y),!0}catch{return!1}}function Cq(n,e){const t=_2(n,e);if(t&&(f_.delete(t),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(t)}catch{}}function kq(n,e){const t=Qx(n,e);if(t&&(d_.delete(t),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(t)}catch{}}function Lq(n){const e=eb(n);if(e&&(p_.delete(e),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(e)}catch{}}function Pq(n,e){const t=tb(n,e);if(t&&(m_.delete(t),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(t)}catch{}}function Nq(n,e){if(!n?.features?.length||!e)return n;const t=rL(e);if(t&&n.__mfDrawingAlignSignature===t)return n;const i=Array.isArray(e.pivot)?e.pivot:null,a=Array.isArray(e.target)?e.target:null;if(!i||!a)return n;const c=Number.isFinite(e.scale)?e.scale:1,y=(Number.isFinite(e.rotationDeg)?e.rotationDeg:0)*Math.PI/180,s=Math.cos(y),T=Math.sin(y),[L,R]=i,[U,M]=a,Q=ie=>{const oe=ie[0]-L,ve=ie[1]-R,de=(oe*s-ve*T)*c,Pe=(oe*T+ve*s)*c;return[U+de,M+Pe]},ae=n.features.map(ie=>!jh(ie?.properties||{})||!ie?.geometry?ie:{...ie,geometry:{...ie.geometry,coordinates:Vd(ie.geometry.coordinates,Q)}}),ye={...n,features:ae};return t&&(ye.__mfDrawingAlignSignature=t),ye}function fx({buildingLabel:n,buildingId:e,floorBasePath:t,fitBuilding:i}={}){const a=n||e||i?.properties?.id||i?.properties?.name||"",c=Rd(a)||a;if(c)return c;if(t){const _=qf(t);if(_)return by?.[_]||_}return""}function Rq({buildingLabel:n,buildingId:e,floorBasePath:t,fitBuilding:i}={}){const a=t?qf(t):null;return a||fx({buildingLabel:n,buildingId:e,floorBasePath:t,fitBuilding:i})}function dx(n){return n?[n.rotationDeg,n.scale,Array.isArray(n.translateMeters)?n.translateMeters.join(","):"",Array.isArray(n.translateLngLat)?n.translateLngLat.join(","):"",Array.isArray(n.anchorLngLat)?n.anchorLngLat.join(","):""].map(t=>t==null?"":String(t)).join("|"):null}function bp(n){return n?Math.abs(n.rotationDeg||0)>1e-6||Math.abs((n.scale||1)-1)>1e-6||Math.abs(n.translateMeters?.[0]||0)>1e-6||Math.abs(n.translateMeters?.[1]||0)>1e-6||Math.abs(n.translateLngLat?.[0]||0)>1e-12||Math.abs(n.translateLngLat?.[1]||0)>1e-12||Math.abs(n.anchorLngLat?.[0]||0)>1e-12||Math.abs(n.anchorLngLat?.[1]||0)>1e-12:!1}function $5({base:n,url:e,label:t}){const i=[{source:"basePath",adjust:n},{source:"url",adjust:e},{source:"label",adjust:t}].filter(_=>_.adjust),a=i.filter(_=>bp(_.adjust));if(a.length){let _=null;for(const y of a){const s=Number(y.adjust?.savedAt)||0;(!_||s>_.savedAt)&&(_={...y,savedAt:s})}if(_)return _}return i.find(_=>_.source==="label")||i[0]||{source:"label",adjust:null,savedAt:0}}function kv(n){if(!n?.features?.length)return null;try{const e=Gu(n)?.geometry?.coordinates||null;return!Array.isArray(e)||e.length<2||!Number.isFinite(e[0])||!Number.isFinite(e[1])?null:e}catch{return null}}function Mq(n,e,t){if(!n?.features?.length||!e)return{fc:n,fitTransform:t};const i=dx(e);if(i&&n.__mfUserAdjustSignature===i)return{fc:n,fitTransform:t};const a=Number.isFinite(e.rotationDeg)?e.rotationDeg:0,c=Number.isFinite(e.scale)?e.scale:1,_=Array.isArray(e.translateMeters)?e.translateMeters:[0,0],y=Array.isArray(e.translateLngLat)?e.translateLngLat:null,s=Array.isArray(e.anchorLngLat)?e.anchorLngLat:null;let T=n;const L=(Array.isArray(e.pivot)?e.pivot:null)||t?.scaleOrigin||t?.rotationPivot||Gu(T)?.geometry?.coordinates||null;if(Number.isFinite(c)&&Math.abs(c-1)>1e-6&&L&&(T=qy(T,c,{origin:L})),Number.isFinite(a)&&Math.abs(a)>1e-6&&L&&(T=af(T,a,{pivot:L})),y&&(Math.abs(y[0]||0)>1e-12||Math.abs(y[1]||0)>1e-12)?T=W5(T,y):_&&(Math.abs(_[0]||0)>1e-6||Math.abs(_[1]||0)>1e-6)&&(T=x2(T,_)),s&&Number.isFinite(s[0])&&Number.isFinite(s[1])){const U=kv(T);if(U){const M=s[0]-U[0],Q=s[1]-U[1];(Math.abs(M)>1e-12||Math.abs(Q)>1e-12)&&(T=W5(T,[M,Q]))}}T&&typeof T=="object"&&(T.__mfUserAdjustSignature=i);let R=t;if((Number.isFinite(c)||Number.isFinite(a)||Array.isArray(_))&&(R=R||{rotationDeg:0,rotationPivot:L,scale:1,scaleOrigin:L,translateKm:0,translateBearing:0,nudgeMeters:[0,0],refineRotationDeg:0,refineRotationPivot:L},L&&(Array.isArray(R.rotationPivot)||(R.rotationPivot=L),Array.isArray(R.scaleOrigin)||(R.scaleOrigin=L),Array.isArray(R.refineRotationPivot)||(R.refineRotationPivot=L)),Number.isFinite(c)&&Math.abs(c-1)>1e-6&&(R.scale=(Number.isFinite(R.scale)?R.scale:1)*c),Number.isFinite(a)&&Math.abs(a)>1e-6&&(R.rotationDeg=(Number.isFinite(R.rotationDeg)?R.rotationDeg:0)+a),Array.isArray(_))){const U=Array.isArray(R.nudgeMeters)?R.nudgeMeters:[0,0];R.nudgeMeters=[(Number(U[0])||0)+(Number(_[0])||0),(Number(U[1])||0)+(Number(_[1])||0)]}return{fc:T,fitTransform:R}}function jh(n={}){return n?String(n.type??n.Type??"").toLowerCase()==="drawing"?!0:n.interactive===!1:!1}function Dq(n,e){if(!n?.geometry||!Array.isArray(e))return e;const t=Gf(n.geometry,4e3);if(!t.length)return e;let i=e,a=1/0;for(const[c,_]of t){const y=c-e[0],s=_-e[1],T=y*y+s*s;T<a&&(a=T,i=[c,_])}return i}function Oq(n,e=4e3){let t=1/0,i=1/0,a=-1/0,c=-1/0,_=0;const y=s=>{if(!(!Array.isArray(s)||_>=e)){if(s.length>=2&&typeof s[0]=="number"&&typeof s[1]=="number"){const T=s[0],L=s[1];T<t&&(t=T),L<i&&(i=L),T>a&&(a=T),L>c&&(c=L),_+=1;return}s.forEach(y)}};return y(n),_?{minX:t,minY:i,maxX:a,maxY:c}:null}function Fq(n,e=.12){if(!n?.features?.length)return n;const t=n.features.filter(ie=>!jh(ie?.properties||{}));if(!t.length)return n;let i=1/0,a=1/0,c=-1/0,_=-1/0,y=0;for(const ie of t){const oe=Gf(ie?.geometry,4e3);for(const[ve,de]of oe)ve<i&&(i=ve),de<a&&(a=de),ve>c&&(c=ve),de>_&&(_=de),y+=1;if(y>2e4)break}if(!y)return n;const s=Math.max(1e-9,c-i),T=Math.max(1e-9,_-a),L=s*e,R=T*e,U=i-L,M=a-R,Q=c+L,ae=_+R,ye=[];for(const ie of n.features){if(!jh(ie?.properties||{})){ye.push(ie);continue}const oe=Oq(ie?.geometry?.coordinates,4e3);if(!oe)continue;!(oe.maxX<U||oe.minX>Q||oe.maxY<M||oe.minY>ae)&&ye.push(ie)}return ye.length===n.features.length?n:{...n,features:ye}}function Bq(n,e={}){if(!n?.features?.length||n.__mfAutoDrawingAlign)return n;const t=n.features.filter(ye=>jh(ye?.properties||{})),i=n.features.filter(ye=>!jh(ye?.properties||{}));if(!t.length||!i.length)return n;const a=(ye,ie=2e4)=>{let oe=1/0,ve=1/0,de=-1/0,Pe=-1/0,Be=0;for(const _e of ye){const G=Gf(_e?.geometry,Math.max(0,ie-Be));Be+=G.length;for(const[B,Y]of G)B<oe&&(oe=B),Y<ve&&(ve=Y),B>de&&(de=B),Y>Pe&&(Pe=Y);if(Be>=ie)break}return!Number.isFinite(oe)||!Number.isFinite(ve)||!Number.isFinite(de)||!Number.isFinite(Pe)?null:{minX:oe,minY:ve,maxX:de,maxY:Pe,spanX:de-oe,spanY:Pe-ve,cx:(oe+de)/2,cy:(ve+Pe)/2}},c=a(i),_=a(t);if(!c||!_||!(_.maxX<c.minX||_.minX>c.maxX||_.maxY<c.minY||_.minY>c.maxY))return n;const s=c.spanX>0?_.spanX/c.spanX:0,T=c.spanY>0?_.spanY/c.spanY:0;if(s<.5||s>2||T<.5||T>2)return n;const L=VG(e.buildingLabel,e.floorId);let R=n.features;if(L){const ye=[_.cx,_.cy];R=R.map(ie=>!jh(ie?.properties||{})||!ie?.geometry?ie:{...ie,geometry:{...ie.geometry,coordinates:Vd(ie.geometry.coordinates,oe=>n_(oe,ye,180))}})}const U=a(R.filter(ye=>jh(ye?.properties||{})));if(!U)return n;const M=c.cx-U.cx,Q=c.cy-U.cy;if(!Number.isFinite(M)||!Number.isFinite(Q))return n;const ae={...n,features:R.map(ye=>!jh(ye?.properties||{})||!ye?.geometry?ye:{...ye,geometry:{...ye.geometry,coordinates:Vd(ye.geometry.coordinates,([ie,oe])=>[ie+M,oe+Q])}})};return ae.__mfAutoDrawingAlign=!0,ae}function Ow({map:n,fc:e,isDrawing:t,screenPoint:i,maxPixels:a,maxPoints:c}){if(!n||!e?.features?.length||!i)return null;const _=Number.isFinite(a)?a:null,y=Number.isFinite(c)?c:8e3;let s=null,T=1/0,L=0;for(const R of e.features){const U=R?.properties||{},M=jh(U),Q=R?.geometry?.type||"",ye=M||(Q==="LineString"||Q==="MultiLineString");if((t?!ye:ye)||!R?.geometry)continue;const ie=Gf(R.geometry,Math.max(0,y-L));L+=ie.length;for(const[oe,ve]of ie){const de=n.project({lng:oe,lat:ve}),Pe=de.x-i.x,Be=de.y-i.y,_e=Pe*Pe+Be*Be;_e<T&&(T=_e,s=[oe,ve])}if(L>=y)break}return s&&(_==null||T<=_*_)?s:null}function zq(n){if(!n||!Array.isArray(n.features)||n.features.length===0)return n;const e=n.features.filter(t=>!jh(t?.properties||{}));return e.length===0||e.length===n.features.length?n:{...n,features:e,__mfFitCandidate:!0}}const jA=[{key:"roomA",label:"Click room point A (rooms layer)"},{key:"roomB",label:"Click room point B (rooms layer)"},{key:"drawingA",label:"Click drawing point A (linework)"},{key:"drawingB",label:"Click drawing point B (linework)"}],jq=40,Uq=140,Fw=12e3,sL=hq?"/StakeholderMap/":"/",ud=n=>`${sL}${n}`.replace(/\/{2,}/g,"/"),Lv=ud("floorplans/manifest.json"),H5="Hastings",Vq=!1,vy=["==",["get","Element"],"Room"];async function N_(n){try{const e=await fetch(n,{cache:"no-store"});if(!e.ok)return null;const t=(e.headers.get("content-type")||"").toLowerCase(),i=await e.text();if(t.includes("text/html"))return null;const a=i.replace(/^\uFEFF/,"");try{return JSON.parse(a)}catch{return null}}catch{return null}}async function oL(n){if(!n)return null;try{const e=await fetch(n,{cache:"no-store"});if(!e.ok)return null;const t=(e.headers.get("content-type")||"").toLowerCase(),i=await e.text();if(t.includes("text/html"))return null;try{const a=i.replace(/^\uFEFF/,"");return JSON.parse(a)}catch{return null}}catch{return null}}function v2(n){return n?n.type==="FeatureCollection"&&Array.isArray(n.features)?n:Array.isArray(n.features)?{type:"FeatureCollection",features:n.features}:n.type==="Feature"?{type:"FeatureCollection",features:[n]}:null:null}function Pv(n,e){if(!n||!e||n.__mfAffineApplied||lG(n))return n;const t=uL(n,e);return t&&typeof t=="object"&&(t.__mfAffineApplied=!0,t.__mfAffineSignature=Q9(e)),t}function aL(n,e,t){if(!n||!Number.isFinite(e)||Math.abs(e)<1e-6||n.__mfRotationOverride===e)return n;try{const i=Array.isArray(t)&&t.length>=2?t:t?.geometry?.coordinates||Gu(n)?.geometry?.coordinates||null,a=af(n,e,i?{pivot:i}:void 0);if(a&&typeof a=="object")return a.__mfRotationOverride=e,i&&(a.__mfRotationPivot=i),n.__mfFitTransform&&(a.__mfFitTransform=n.__mfFitTransform),n.__mfFitted&&(a.__mfFitted=n.__mfFitted),n.__mfFittedBuilding&&(a.__mfFittedBuilding=n.__mfFittedBuilding),n.__mfAffineApplied&&(a.__mfAffineApplied=n.__mfAffineApplied),a}catch{}return n}function Bw(n){if(!n)return null;const e=String(n).split("?")[0],t=e.lastIndexOf("/Rooms/");if(t>=0)return e.slice(0,t);const i=e.lastIndexOf("/");return i>0?e.slice(0,i):null}function x2(n,e){if(!n||!Array.isArray(e)||e.length<2)return n;const t=Number(e[0]),i=Number(e[1]);let a=n;if(Number.isFinite(t)&&Math.abs(t)>1e-6){const c=Math.abs(t)/1e3,_=t>=0?90:270;a=ig(a,c,_,{units:"kilometers"})}if(Number.isFinite(i)&&Math.abs(i)>1e-6){const c=Math.abs(i)/1e3,_=i>=0?0:180;a=ig(a,c,_,{units:"kilometers"})}return a}function W5(n,e){if(!n||!Array.isArray(e)||e.length<2)return n;const t=Number(e[0]),i=Number(e[1]);if(!Number.isFinite(t)&&!Number.isFinite(i))return n;const a=c=>[c[0]+(Number.isFinite(t)?t:0),c[1]+(Number.isFinite(i)?i:0)];return{...n,features:(n.features||[]).map(c=>({...c,geometry:c.geometry?{...c.geometry,coordinates:Vd(c.geometry.coordinates,a)}:c.geometry}))}}function lL(n,e){if(!n||!e||n.__mfFitTransformApplied)return n;let t=n;try{const{rotationDeg:i,rotationPivot:a,scale:c,scaleOrigin:_,translateKm:y,translateBearing:s,nudgeMeters:T,refineRotationDeg:L,refineRotationPivot:R}=e;Number.isFinite(i)&&Math.abs(i)>1e-6&&Array.isArray(a)&&(t=af(t,i,{pivot:a})),Number.isFinite(c)&&c>0&&Math.abs(c-1)>1e-6&&Array.isArray(_)&&(t=qy(t,c,{origin:_})),Number.isFinite(y)&&Number.isFinite(s)&&Math.abs(y)>1e-9&&(t=ig(t,y,s,{units:"kilometers"})),Array.isArray(T)&&(t=x2(t,T)),Number.isFinite(L)&&Math.abs(L)>1e-6&&Array.isArray(R)&&(t=af(t,L,{pivot:R}))}catch{}return t&&typeof t=="object"&&(t.__mfFitTransformApplied=!0),t}function Nv(n,e){if(!n||!e)return null;try{const t=n.getSource("buildings");let a=(t?._data||t?.serialize?.().data||null)?.features||[];if(!a.length&&typeof n.querySourceFeatures=="function")try{a=n.querySourceFeatures("buildings")||[]}catch{}return Nd(a,e)}catch{return null}}function qq(n,e){if(!n||!Number.isFinite(e)||Math.abs(e)<1e-6||!Array.isArray(n.features)||!n.features.length)return n;const t=Math.PI/180,i=-e*t,a=Math.cos(i),c=Math.sin(i),_=s=>{const T=s*t,L=Math.sin(T),R=Math.cos(T),U=L*a-R*c,M=L*c+R*a;return(Math.atan2(U,M)/t+360)%360};return{...n,features:n.features.map(s=>{const T=s?.properties||{},L=Number(T.bearing_deg);if(!Number.isFinite(L))return s;const R=_(L);return{...s,properties:{...T,bearing_deg:R}}})}}function Gq(n,e,t,i={}){if(!n)return n;const a=i.adjustBearings&&Number.isFinite(i.bearingRotationDeg)&&Math.abs(i.bearingRotationDeg)>1e-6;if(!e&&!t&&!a||n.__mfOverlayTransformApplied)return n;let c=n;if(e?.deg!=null&&(c=aL(c,e.deg,e.pivot)),t&&(c=lL(c,t)),i.adjustBearings){const _=(Number.isFinite(i.bearingRotationDeg)?i.bearingRotationDeg:0)+(Number.isFinite(e?.deg)?e.deg:0)+(Number.isFinite(t?.rotationDeg)?t.rotationDeg:0)+(Number.isFinite(t?.refineRotationDeg)?t.refineRotationDeg:0);c=qq(c,_)}return c&&typeof c=="object"&&(c.__mfOverlayTransformApplied=!0),c}const $q=new Set(["calvin_french_chapel/basement","kiewit/level_2"]);async function py(n,e){if(!n||!e)return null;const t=gc(qf(n)||""),i=El(e),c=$q.has(`${t}/${i}`)?[`${n}/${e}_Dept.affine.json`,`${n}/affine.json`]:[`${n}/affine.json`],_=Array.from(new Set([...c,...c.map(y=>{try{return encodeURI(y)}catch{return y}})]));for(const y of _){const s=await oL(y);if(s)return s}return null}async function Hq(n){for(const e of(n||[]).filter(Boolean)){const t=await oL(e);if(t)return{url:e,data:t}}return{url:n?.[0]||"",data:null}}async function Wq({basePath:n,floorId:e,skipAffine:t=!1}){const i=[`${n}/Rooms/${e}_Dept_Rooms.geojson`,`${n}/Rooms/${e}_Dept.geojson`,`${n}/${e}_Dept_Rooms.geojson`,`${n}/${e}_Dept.geojson`],[{data:a},c]=await Promise.all([Hq(i),t?Promise.resolve(null):py(n,e)]),_=v2(a);if(!_)return{rawFC:null,patchedFC:null,affine:null};_.features=(_.features||[]).map(s=>{const T=s?.properties||{},L=y2(T),R=Z9(T);return{...s,properties:{...T,__roomType:L||"",__dept:R||"",__areaSf:J9(T)}}});const y=Pv(_,c);return{rawFC:_,patchedFC:y,affine:c}}function Xq(n,e){function t(i){if(!i)return i;if(typeof i[0]=="number"){const a=i[0],c=i[1];return[e.a*a+e.b*c+e.c,e.d*a+e.e*c+e.f]}return i.map(t)}return{...n,features:n.features.map(i=>({...i,geometry:i.geometry?{...i.geometry,coordinates:t(i.geometry.coordinates)}:i.geometry}))}}function uL(n,e){if(!n||!e)return n;const t=e.anchor_feet||e.anchorFeet||e.anchor;if(!Array.isArray(t)||t.length<2)return n;const i=Number(e.target_lon??e.targetLon),a=Number(e.target_lat??e.targetLat);if(!Number.isFinite(i)||!Number.isFinite(a))return n;const c=Number(e.rotation_deg_cw??e.rotation_deg??0),_=e.effective_scale_deg_per_foot!=null,y=Number(_?e.effective_scale_deg_per_foot:e.scale_deg_per_foot??e.scale_deg_per_ft??e.scale);if(!Number.isFinite(y)||y===0)return n;const s=Number(e.scale_percent??100),T=_?y:y*(Number.isFinite(s)?s/100:1),L=a*Math.PI/180,R=Math.max(1e-9,Math.cos(L)),U=T/R,M=c*Math.PI/180,Q=Math.cos(M),ae=Math.sin(M),[ye,ie]=t,oe=U*Q,ve=-U*ae,de=i-(oe*ye+ve*ie),Pe=T*ae,Be=T*Q,_e=a-(Pe*ye+Be*ie);return Xq(n,{a:oe,b:ve,c:de,d:Pe,e:Be,f:_e})}async function cL(n){for(const e of(n||[]).filter(Boolean))try{const t=await fetch(e,{cache:"no-store"}),i=(t.headers.get("content-type")||"").toLowerCase(),a=await t.text();if(!t.ok||i.includes("text/html"))continue;try{const c=a.replace(/^\uFEFF/,""),_=JSON.parse(c);return{ok:!0,url:e,data:_}}catch{continue}}catch{continue}return{ok:!1,url:n?.[0]||"",error:"No valid JSON response from any candidate URL."}}async function Yq({basePath:n,floorId:e,map:t,roomsFC:i,affine:a,rotationOverride:c,fitTransform:_}){if(!n||!e||!t)return;const y=String(e).trim(),s=[`${n}/${y}_-_Map_Export_Walls_RAW.geojson`,`${n}/${y}_Walls_RAW.geojson`,`${n}/${y}_-_Map_Export_Walls.geojson`,`${n}/${y}_Walls.geojson`],T=await xf(s);let L=v2(T);if(!L?.features?.length)return;console.log("[walls] loaded features",L.features.length);function R(ae,ye=20){let ie=0;const oe=ve=>{if(!ve||ie>=ye)return!0;if(typeof ve[0]=="number"&&typeof ve[1]=="number"){const de=ve[0],Pe=ve[1];return ie+=1,Math.abs(de)<=180&&Math.abs(Pe)<=90}for(const de of ve)if(!oe(de))return!1;return!0};for(const ve of ae?.features||[]){if(!oe(ve?.geometry?.coordinates))return!1;if(ie>=ye)break}return ie>0}a&&!R(L)?(L=uL(L,a),console.log("[walls] applied affine")):a&&console.log("[walls] skipped affine (already lon/lat)"),L=Gq(L,c,_,{adjustBearings:!1});const M="walls-source",Q="walls-layer";t.getSource(M)?t.getSource(M).setData(L):t.addSource(M,{type:"geojson",data:L});try{const ae=Lc(L);console.log("[walls] bbox",ae)}catch{console.log("[walls] first coord",L.features?.[0]?.geometry?.coordinates?.[0]?.[0])}if(!t.getLayer(Q)){const ae=t.getLayer(lo)?lo:void 0;t.addLayer({id:Q,type:"line",source:M,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#000","line-width":["interpolate",["linear"],["zoom"],16,.15,18,.25,20,.45],"line-opacity":.25}},ae)}}async function Kq({basePath:n,floorId:e,map:t,affine:i,rotationOverride:a,fitTransform:c,roomsFC:_,buildingLabel:y}){}function UA(n,e){if(!e||!Array.isArray(n)||n.length<2)return n;const t=Number(e.target_lon??e.targetLon),i=Number(e.target_lat??e.targetLat),a=Number(e.rotation_deg_cw??e.rotation_deg??0),c=Number(e.effective_scale_deg_per_foot??e.scale_deg_per_foot??e.scale_deg_per_ft??e.scale),_=e.anchor_feet||e.anchorFeet||e.anchor;if(!Number.isFinite(t)||!Number.isFinite(i)||!Number.isFinite(c)||!Array.isArray(_))return n;const y=c,s=y/Math.max(1e-9,Math.cos(i*Math.PI/180)),[T,L]=n,R=(T-t)/s,U=(L-i)/y,M=a*Math.PI/180,Q=Math.cos(M),ae=Math.sin(M),[ye,ie]=_;return[Q*R+ae*U+ye,-ae*R+Q*U+ie]}function n_(n,e,t){if(!Array.isArray(n)||n.length<2)return n;const[i,a]=n,[c,_]=e||[0,0],y=t*Math.PI/180,s=Math.cos(y),T=Math.sin(y),L=i-c,R=a-_;return[c+s*L-T*R,_+T*L+s*R]}function Vd(n,e){return n&&(typeof n[0]=="number"?e(n):n.map(t=>Vd(t,e)))}function Wm(n){let e=1/0,t=1/0,i=-1/0,a=-1/0;return n.forEach(([c,_])=>{!Number.isFinite(c)||!Number.isFinite(_)||(c<e&&(e=c),_<t&&(t=_),c>i&&(i=c),_>a&&(a=_))}),{minx:e,miny:t,maxx:i,maxy:a,spanX:i-e,spanY:a-t,cx:(e+i)/2,cy:(t+a)/2}}function Zq({buildingLabel:n,floorId:e,floorBasePath:t}={}){if(El(e||"")!=="basement")return!1;if(t&&String(t).includes("/Calvin French Chapel/"))return!0;const a=mi(n);return a&&[mi("Calvin French Chapel"),mi("Calvin H. French Chapel"),mi("Calvin H. French Memorial Chapel")].includes(a)}function VA({buildingLabel:n,floorId:e,floorBasePath:t}={}){if(El(e||"")!=="level_3")return!1;if(t&&(()=>{try{return decodeURIComponent(String(t))}catch{return String(t)}})().includes("/Babcock Hall/"))return!0;const a=mi(n);return a&&[mi("Babcock Hall"),mi("Babcock Hall Residence")].includes(a)}function qA(n){let e=0,t=0,i=0;const a=c=>{if(Array.isArray(c)){if(c.length>=2&&typeof c[0]=="number"&&typeof c[1]=="number"){e+=c[0],t+=c[1],i+=1;return}c.forEach(a)}};return(n||[]).forEach(c=>{c?.geometry?.coordinates&&a(c.geometry.coordinates)}),i?[e/i,t/i]:null}function GA(n,e,t){if(!n?.features?.length||n.__mfBabcockL3AutoRotated)return n;const i=90*Math.PI/180,a=Math.cos(i),c=Math.sin(i),_=s=>{const T=s[0],L=s[1];return[T*a-L*c,T*c+L*a]},y=n.features.map(s=>!jh(s?.properties||{})||!s?.geometry?s:{...s,geometry:{...s.geometry,coordinates:Vd(s.geometry.coordinates,_)}});return{...n,features:y,__mfBabcockL3AutoRotated:!0}}function Jq(n,e,t){if(!n?.features?.length||n.__mfBasementFixed)return n;const i=n.features.filter(Ce=>jh(Ce?.properties||{})),a=n.features.filter(Ce=>!jh(Ce?.properties||{}));if(i.length&&a.length){const Ce={type:"FeatureCollection",features:i},ge={type:"FeatureCollection",features:a},We=gm(Ce,1200)||Ce,Ve=gm(ge,1200)||ge,ut=my(We,2e3),pt=my(Ve,2e3),It=Wm(ut),Oe=Wm(pt),Wt=qA(i)||(It?[It.cx,It.cy]:null),Zt=qA(a)||(Oe?[Oe.cx,Oe.cy]:null);if(It&&Oe&&Wt&&Zt){const Xt=Math.max(Oe.spanX||0,Oe.spanY||0,1e-9);if(Math.hypot(Wt[0]-Zt[0],Wt[1]-Zt[1])>Xt*.18){const on=xy(We?.geometry)??0,mt=xy(Ve?.geometry)??0,Ir=Mv(mt-on),Fr=It.spanX?Oe.spanX/It.spanX:1,qr=It.spanY?Oe.spanY/It.spanY:1;let $t=1;Number.isFinite(Fr)&&Number.isFinite(qr)&&Fr>0&&qr>0&&($t=Math.min(Fr,qr)),$t=Math.max(.2,Math.min(5,$t||1));const xr=Ir*Math.PI/180,dr=Math.cos(xr),ni=Math.sin(xr),[nn,yn]=Wt,[sr,Zn]=Zt,$r=ir=>{const Xn=ir[0]-nn,Bi=ir[1]-yn,bi=(Xn*dr-Bi*ni)*$t,wr=(Xn*ni+Bi*dr)*$t;return[sr+bi,Zn+wr]},qn=n.features.map(ir=>!jh(ir?.properties||{})||!ir?.geometry?ir:{...ir,geometry:{...ir.geometry,coordinates:Vd(ir.geometry.coordinates,$r)}}),jr={...n,features:qn};return jr.__mfBasementFixed=!0,jr}}}if(!e||!t)return n;const c=n.features.map((Ce,ge)=>{const We=Ce?.geometry?.coordinates;if(!We)return null;const Ve=Gf({coordinates:We},1e3);if(!Ve.length)return null;const ut=Ve.reduce((It,Oe)=>It+Oe[0],0)/Ve.length,pt=Ve.reduce((It,Oe)=>It+Oe[1],0)/Ve.length;return{i:ge,c:[ut,pt]}}).filter(Boolean);if(c.length<6)return n;const _=c.map(Ce=>Ce.c[0]).sort((Ce,ge)=>Ce-ge),y=_[Math.floor(_.length/2)],s=new Set(c.filter(Ce=>Ce.c[0]<=y).map(Ce=>Ce.i));if(!s.size||s.size===n.features.length)return n;const T={type:"FeatureCollection",features:n.features.filter((Ce,ge)=>s.has(ge))},L=gm(T,1200),R=xy(t?.geometry)??0,U=xy(L?.geometry)??0,M=Number.isFinite(R)&&Number.isFinite(U)?R-U:0,Q=Gu(t)?.geometry?.coordinates||null;if(!Q)return n;const ae=Ce=>n_(Ce,Q,-R),ye=Ce=>n_(Ce,Q,R),ie={type:"Feature",properties:{},geometry:{...t.geometry,coordinates:Vd(t.geometry.coordinates,ae)}},oe=my(ie,4e3),ve=Wm(oe);if(!Number.isFinite(ve.cx))return n;const de=ve.cx,Pe=a2([[[de-10,ve.miny-10],[de,ve.miny-10],[de,ve.maxy+10],[de-10,ve.maxy+10],[de-10,ve.miny-10]]]),Be=U9(zy([ie,Pe]));if(!Be?.geometry)return n;const _e={type:"Feature",geometry:{...Be.geometry,coordinates:Vd(Be.geometry.coordinates,ye)}},G=my(_e,4e3),B=Wm(G);if(!Number.isFinite(B.minx))return n;const Y=Wm([UA([B.minx,B.miny],e),UA([B.maxx,B.maxy],e)]),$=my(T,4e3),J=Wm($),te=[J.cx,J.cy],Se=$.map(Ce=>n_(Ce,te,M)),De=Wm(Se);if(!Number.isFinite(De.spanX)||!Number.isFinite(De.spanY))return n;const $e=Math.min(Y.spanX/Math.max(1e-9,De.spanX),Y.spanY/Math.max(1e-9,De.spanY)),Ue=[Y.cx-De.cx,Y.cy-De.cy],Le=Ce=>{const ge=n_(Ce,te,M),We=[(ge[0]-De.cx)*$e+De.cx,(ge[1]-De.cy)*$e+De.cy];return[We[0]+Ue[0],We[1]+Ue[1]]},He=n.features.map((Ce,ge)=>!s.has(ge)||!Ce?.geometry?.coordinates?Ce:{...Ce,geometry:{...Ce.geometry,coordinates:Vd(Ce.geometry.coordinates,Le)}}),Ke={...n,features:He};return Ke.__mfBasementFixed=!0,Ke}async function Qq({basePath:n,floorId:e,map:t,affine:i,rotationOverride:a,fitTransform:c}){}let zw=0;function hL(n){if(!n||/^https?:\/\//i.test(n))return n;const e=$9();if(!e)return n;const t=e.replace(/\/$/,""),i=n.startsWith("/")?n:`/${n}`,a=i.startsWith("/ai/")?i.replace(/^\/ai/,""):i;return`${t}${a}`}async function sd(n,e={}){const t=Date.now();if(t<zw)throw new Error(`Rate limited. Try again in ${Math.ceil((zw-t)/1e3)}s`);const i=Number(e.timeoutMs),a=Number.isFinite(i)&&i>0?new AbortController:null,c={...e};a&&(c.signal=a.signal),delete c.timeoutMs;let _=null;a&&(_=setTimeout(()=>a.abort(),i));let y;try{y=await fetch(hL(n),c)}finally{_&&clearTimeout(_)}if(y.status===429)throw zw=Date.now()+6e4,new Error("Rate limited (429). AI paused for 60 seconds.");return y}async function $A(n,e=H5){if(!n)return[];const t=M=>String(M||"").trim().toLowerCase().replace(/[^a-z0-9]/g,""),i=(M=[])=>{const Q=Array.isArray(M)?M:M?[M]:[];return Q.length?Q.map(ae=>{if(typeof ae=="string")return{id:ae,url:null};if(!ae)return null;const ye=_y(ae.id||ae.floorId||ae.name||ae.label),ie=ae.url||ae.path||null;return ye?{id:ye,url:ie}:null}).filter(Boolean):[]},a=encodeURIComponent(e),c=encodeURIComponent(n),_=ud(`floorplans/${a}/${c}/manifest.json`),y=await N_(_),T=(await N_(Lv))?.floorsByBuilding||{};let L=T[n];if(!L){const M=Object.keys(T).find(Q=>t(Q)===t(n));L=M?T[M]:null}const R=i(L||[]),U=i(y?.floors);if(!U.length)return R;if(R.length&&U.some(M=>!M.url)){const M=new Map(R.filter(Q=>Q?.id&&Q?.url).map(Q=>[Q.id,Q.url]));return U.map(Q=>({...Q,url:Q.url||M.get(Q.id)||null}))}return U}const eG=()=>{if(typeof window>"u")return"";const n=String(window.__MAPBOX_PUBLIC_TOKEN__??"").trim();if(n)return n;try{const e=String(window.localStorage?.getItem("MAPBOX_PUBLIC_TOKEN")??"").trim();if(e)return e}catch{}return""};zf.accessToken=eG();console.log("Mapbox token length:",(zf.accessToken||"").length);const Va="floor-source",lo="floor-fill",lf="floor-line",kp="floor-drawing",qd="floor-highlight",vg="floor-highlight-border",Vc="floor-room-labels",px="floor-doors",mx="floor-stairs",Xm="engagement-heat-source",od="engagement-heat-warm-halo-layer",ad="engagement-heat-cool-halo-layer",gx="walls-source",Gy="walls-layer",HA="doors-source",WA="stairs-source",yx="doors-layer",_x="stairs-layer",Jo=new Map,ih=new Map,jw=new Map,tG=n=>n?/^https?:\/\//i.test(n)||n.startsWith(sL)?n:ud(String(n).replace(/^\//,"")):null;async function nG(n){const e=tG(n);if(!e)return[];if(jw.has(e))return jw.get(e);const t=await N_(e),i=Array.isArray(t?.features)?t.features:[];return jw.set(e,i),i}async function rG(n,e,t){const i=[],a=[...n],c=Math.max(1,Number(e)||1),_=Array.from({length:c},async()=>{for(;a.length;){const y=a.shift();try{i.push(await t(y))}catch(s){console.warn("dashboard fetch failed",y,s)}}});return await Promise.all(_),i}function XA(n){if(!n)return;const e="buildings-fill";if(n.getLayer(e))try{n.setPaintProperty(e,"fill-color",vf("#ffffff")),n.setPaintProperty(e,"fill-opacity",1),n.setPaintProperty(e,"fill-outline-color","#cbd5e1")}catch{}}const iG={"fill-color":"#e6e6e6","fill-opacity":1};function X5(n,e="department",t={}){if(!n||!n.getLayer(lo))return;const i=[">",["length",["coalesce",["to-string",["get","occupant"]],["to-string",["get","Occupant"]],""]],0],c=["upcase",["to-string",["coalesce",["get","occupancyStatus"],["get","Occupancy Status"],["get","OccupancyStatus"],["get","Occupancy"],["get","Vacancy"],["get","vacancy"],["get","Vacant"],""]]],y=["in",["upcase",["to-string",["coalesce",["get","__roomType"],["get","NCES_Type"],["get","RoomType"],["get","Room Type"],["get","Type"],["get","type"],["get","Name"],""]]],["literal",WG]],R=["case",[">",["length",c],0],["case",["any",[">=",["index-of","VACANT",c],0],[">=",["index-of","UNOCCUPIED",c],0],[">=",["index-of","AVAILABLE",c],0],[">=",["index-of","UNASSIGNED",c],0]],"Vacant",[">=",["index-of","OCCUPIED",c],0],"Occupied","Unknown"],i,"Occupied","Unknown"],U=["case",y,["match",R,"Occupied","#29b6f6","Vacant","#ff7043","Unknown","#e0e0e0","#e0e0e0"],"#e6e6e6"],M=["case",y,["match",R,"Vacant","#ff7043","Occupied","#cfd8dc","Unknown","#cfd8dc","#cfd8dc"],"#e6e6e6"];try{e==="occupancy"?n.setPaintProperty(lo,"fill-color",U):e==="vacancy"?n.setPaintProperty(lo,"fill-color",M):n.setPaintProperty(lo,"fill-color",dq()),n.setPaintProperty(lo,"fill-opacity",1)}catch{}}function sG(n){if(!(!n||n.getLayer(qd)))try{n.addLayer({id:qd,type:"fill",source:Va,paint:{"fill-color":"rgba(0,255,255,0.4)","fill-outline-color":"#00ffff"},filter:["==",["id"],-1]},lo),n.addLayer({id:vg,type:"line",source:Va,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00ffff","line-width":6,"line-opacity":1,"line-gap-width":0},filter:["==",["id"],-1]})}catch{}}function oG(n,e,t){!n||!e||!t||(n.getSource(e)?n.getSource(e).setData(t):n.addSource(e,{type:"geojson",data:t}))}async function YA(n,e,t){if(!n||!e||!t)return;try{if(n.hasImage(e))return}catch{}const i=await new Promise((a,c)=>{n.loadImage(t,(_,y)=>_?c(_):a(y))});try{n.addImage(e,i,{sdf:!0})}catch(a){console.warn("addImage failed for",e,a)}}function aG(n){if(n)try{n.getLayer(Gy)&&n.getLayer(lo)&&n.moveLayer(Gy,lo),n.getLayer(lf)&&n.getLayer(lo)&&n.moveLayer(lf),n.getLayer(kp)&&(n.getLayer(Vc)?n.moveLayer(kp,Vc):n.moveLayer(kp)),n.getLayer(yx)&&n.moveLayer(yx),n.getLayer(_x)&&n.moveLayer(_x)}catch{}}function KA(n=[],e=[]){const t=[];return n.length&&t.push(["in",["id"],["literal",n]]),e.length&&t.push(["in",["get","RevitId"],["literal",e]]),t.length?t.length===1?t[0]:["any",...t]:["==",["id"],""]}async function xf(n){const e=Array.isArray(n)?n.filter(Boolean):[n].filter(Boolean);if(!e.length)return null;const t=await cL(e);return t.ok?t.data:(console.debug("GeoJSON fetch failed",{tried:e,lastUrl:t.url,error:t.error}),null)}function lG(n){try{if(!n?.features?.length)return!1;const e=Lc(n);if(!e||e.some(s=>!Number.isFinite(s)))return!1;const[t,i,a,c]=e;if(t<-180||a>180||i<-90||c>90)return!1;const _=Math.abs(a-t),y=Math.abs(c-i);return _<=.25&&y<=.25}catch{return!1}}async function uG(n,e,t,i,a={}){if(!n||!e)return;const{buildingId:c,floor:_,roomPatches:y,onOptionsCollected:s,currentFloorContextRef:T,airtableLookup:L}=a,R=a?.roomsBasePath||a?.wallsBasePath,U=a?.roomsFloorId||a?.wallsFloorId||_||null;let M=i?.fitBuilding||null;if(!M&&c&&(M=Nv(n,c)),!M&&R){const nn=qf(R);nn&&(M=Nv(n,nn))}if(!M&&R){const nn=await Gw();if(nn?.features?.length){const yn=qf(R),sr=by?.[yn]||yn;M=Nd(nn.features,c)||Nd(nn.features,sr)||Nd(nn.features,yn)||null}}if(!M&&R){const nn=qf(R),yn=by?.[nn]||nn,Zn=mi(c||yn);Zn&&Z5.has(Zn)&&(M=Nv(n,yn))}let Q=y_(M);const ae=M?.properties?.id||M?.properties?.name||c||"",ye=fx({buildingLabel:ae,buildingId:c,floorBasePath:R,fitBuilding:M}),ie=Rq({buildingLabel:ae,buildingId:c,floorBasePath:R,fitBuilding:M}),oe=SG({buildingLabel:ae}),ve=UG(ae||c||"",U||_||"")||0,de=R&&U?t_(R,U):null,Pe=e_(e),Be=eg(ie,U||_),G=$5({base:de,url:Pe,label:Be}).adjust,B=ve;let Y=null,$=null,J=Jo.get(e);const te=iL(ye,U||_),Se=rL(te);if(J&&qG(ae||c||"",U||_||"")&&(Jo.delete(e),ih.delete(e),J=null),J&&Q&&(J.__mfTransformed||J.__mfFitted||J.__mfFitTransform)&&(Jo.delete(e),J=null),J&&Number.isFinite(B)&&J.__mfPostRotation!==B&&(Jo.delete(e),ih.delete(e),J=null),J&&R&&U&&!oe){const nn=await py(R,U),yn=Q9(nn);yn&&J.__mfAffineSignature&&J.__mfAffineSignature!==yn||yn&&J.__mfAffineApplied&&!J.__mfAffineSignature?(Jo.delete(e),ih.delete(e),J=null):Y=nn}if(J&&!Y&&!oe&&U){const nn=Bw(e);nn&&(Y=await py(nn,U))}if(J&&(J.__mfDrawingAlignSignature||Se)&&J.__mfDrawingAlignSignature!==Se&&(Jo.delete(e),ih.delete(e),J=null),J){const nn=dx(G);(nn&&J.__mfUserAdjustSignature&&J.__mfUserAdjustSignature!==nn||nn&&J.__mfTransformed&&!J.__mfUserAdjustSignature)&&(Jo.delete(e),ih.delete(e),J=null)}if(!J){if(R&&U){const nn=await Wq({basePath:R,floorId:U,skipAffine:oe});if(!nn.rawFC){console.warn("Floor summary: no data returned",`${R}/${U}_Dept.geojson`);return}if(J=nn.rawFC,Y=nn.affine,!oe&&!Y){const yn=Bw(e);yn&&(Y=await py(yn,U))}if(oe&&(Y=null),Zq({buildingLabel:c,floorId:U,floorBasePath:R})){const yn=Jq(nn.rawFC,Y,M);$=Pv(yn,Y)}else if(VA({buildingLabel:c,floorId:U,floorBasePath:R})){const yn=GA(nn.rawFC);$=Pv(yn,Y)}else $=nn.patchedFC}else if(J=await xf(e),!J)return;Jo.set(e,J)}if(!$){if($=v2(J)||Qu(J),!$?.features?.length)return;if(!oe&&!Y&&U&&(R&&(Y=await py(R,U)),!Y)){const nn=Bw(e);nn&&(Y=await py(nn,U))}VA({buildingLabel:c,floorId:U,floorBasePath:R})&&($=GA($)),$=Pv($,Y)}te&&($=Nq($,te)),$=Bq($,{buildingLabel:ae||c||"",floorId:U||_||""}),$=Fq($),$=Tq($);const De=ae||M?.properties?.id||M?.properties?.name||c||"";if($G(De,U||_||"")&&($.__mfNoFit=!0),!M&&R){const nn=await Gw();if(nn?.features?.length){const yn=qf(R),sr=by?.[yn]||yn;M=Nd(nn.features,c)||Nd(nn.features,sr)||Nd(nn.features,yn)||null,Q=y_(M)}}if(!M&&R){const nn=qf(R),yn=by?.[nn]||nn,Zn=mi(c||yn);if(Zn&&Z5.has(Zn)){const $r=await Gw();$r?.features?.length&&(M=Nd($r.features,yn)||Nd($r.features,nn)||null,Q=y_(M))}}const Ue=Number.isFinite(i?.rotationOverrideDeg)?i.rotationOverrideDeg:null,Le=ih.get(e)||{};Q&&delete Le.fitTransform;let He=null;if(Ue!=null){const nn=Le.rotationPivot||Gu($)?.geometry?.coordinates||null;He=nn?{deg:Ue,pivot:nn}:{deg:Ue},!Le.rotationPivot&&nn&&(Le.rotationPivot=nn,ih.set(e,Le));const yn=aL($,Ue,nn);yn&&yn!==$&&($=yn,Q||Jo.set(e,$))}$.features.forEach((nn,yn)=>{nn&&nn.id==null&&(nn.id=nn.properties?.RevitId??yn)});const Ke=[],Ce=[],ge=[],We=[];$.features.forEach(nn=>{if(!nn)return;const yn=nn.id??nn.properties?.RevitId??nn.properties?.id;if(yn==null)return;const sr=lg(nn.properties);sr==="door"?(Ke.push(yn),nn.properties?.RevitId!=null&&Ce.push(nn.properties.RevitId)):sr==="stair"&&(ge.push(yn),nn.properties?.RevitId!=null&&We.push(nn.properties.RevitId))});const Ve=(nn,yn)=>{if(!nn)return;const sr=yn?.features;if(!(!Array.isArray(sr)||sr.length===0))try{const Zn=selectedBuildingIdRef.current||selectedBuilding||i?.fitBuilding?.properties?.id,$r=i?.floorLabel||sr[0]?.properties?.Floor||e?.match(/(BASEMENT|LEVEL_\\d+|LEVEL|L\\d+)/)?.[0]||"LEVEL_1";if(Zn){const jr={...floorStatsByBuildingRef.current[Zn]||{},[$r]:nn};floorStatsByBuildingRef.current[Zn]=jr,setFloorStatsByBuilding({...floorStatsByBuildingRef.current})}panelBuildingKeyRef.current&&panelBuildingKeyRef.current===Zn&&setPanelStats(qn=>({...qn||{},floor:nn}))}catch{}};let ut=DA($);Ve(ut,$);const pt=zq($),It=pt&&pt!==$?pt:$;let Oe=$?.__mfFitTransform||Le.fitTransform||null;try{if(M&&kG(It,M)){const nn=_G(It,M);if(nn?.features?.length){if(Oe=nn.__mfFitTransform||null,It!==$&&Oe){const yn=lL($,Oe);yn?.features?.length&&($.__mfAffineApplied&&(yn.__mfAffineApplied=$.__mfAffineApplied),$.__mfRotationOverride!=null&&(yn.__mfRotationOverride=$.__mfRotationOverride),$.__mfRotationPivot&&(yn.__mfRotationPivot=$.__mfRotationPivot),yn.__mfFitted=!0,yn.__mfFittedBuilding=nn.__mfFittedBuilding||"",yn.__mfFitTransform=Oe,$=yn)}else $=nn;J.__mfTransformed=!0,Q||Jo.set(e,$)}}}catch{}const Wt=jG(ae||c||"",U||_||"");if(Number.isFinite(Wt)&&Math.abs(Wt-1)>.001){const nn=Oe?.scaleOrigin||Gu($)?.geometry?.coordinates||null;nn&&($=qy($,Wt,{origin:nn}),Oe=Oe||{rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:nn,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null},Oe.scale=(Number.isFinite(Oe.scale)?Oe.scale:1)*Wt,Oe.scaleOrigin=nn,J.__mfTransformed=!0,Q||Jo.set(e,$))}if(Number.isFinite(B)&&Math.abs(B)>.001){const nn=Oe?.scaleOrigin||Oe?.rotationPivot||Gu(M||$)?.geometry?.coordinates||null;nn&&($=af($,B,{pivot:nn}),Oe=Oe||{rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:nn,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null},Oe.refineRotationDeg=(Number.isFinite(Oe.refineRotationDeg)?Oe.refineRotationDeg:0)+B,Oe.refineRotationPivot=nn,J.__mfTransformed=!0,J.__mfPostRotation=B,Q||Jo.set(e,$))}const Zt=Oe?.scaleOrigin||Oe?.rotationPivot||Gu($)?.geometry?.coordinates||null;if(G&&bp(G)){const yn=Mq($,G,Oe);yn?.fc&&yn.fc!==$&&($=yn.fc,Oe=yn.fitTransform||Oe,J.__mfTransformed=!0,Q||Jo.set(e,$))}Oe&&(Le.fitTransform=Oe,ih.set(e,Le)),$&&Array.isArray($.features)&&T&&typeof T=="object"&&(T.current={url:e,buildingId:c,floor:_,fc:$,floorAdjustLabel:ie,floorAdjustFloorId:U||_||"",floorAdjustBasePath:R||null,floorAdjustBasePivot:Zt||null});let Xt=$,Ze=[];const zn=c&&_&&y instanceof Map,on=!!L;if(zn||on){const nn=($.features||[]).map(yn=>{const sr=yn.properties||{};let Zn=sr;if(on&&lg(sr)==="room"){const qn=AL(sr,L,c,_);qn&&(Zn=xx(Zn,qn))}if(zn){const qn=yn.id??sr.RevitId??sr.id,jr=ld(c,_,qn),ir=y.get(jr);ir&&(Zn=xx(Zn,ir))}const $r=wf(Zn);return{...yn,properties:{...Zn,__roomType:$r?String($r).trim():Zn.__roomType||""}}});if(Xt={...$,features:nn},typeof s=="function"){const{typeOptions:yn,deptOptions:sr}=Sq(nn);s({typeOptions:yn,deptOptions:sr})}}T&&typeof T=="object"&&(T.current={...T.current||{},buildingId:c,floor:U||_||"",fc:Xt}),Array.isArray(Xt?.features)&&(Ze=Xt.features.map(nn=>{const yn=nn?.properties??{},sr=nn?.id??yn.RevitId??yn.id,Zn=c&&_&&sr!=null?ld(c,_,sr):null,$r=y instanceof Map&&Zn&&y.get(Zn)||null;return{geo:{...yn},db:$r?{...$r}:null,roomId:Zn||String(sr??"")}}));const mt=Array.isArray(Xt?.features)&&Xt.features.length?DA(Xt):null;mt&&(ut=mt),Ve(ut,Xt),CL(n);const Ir=jc(n,Va);if(Ir?Ir.setData(Xt):n.addSource(Va,{type:"geojson",data:Xt,promoteId:"RevitId"}),!n.getLayer(lo))n.addLayer({id:lo,type:"fill",source:Va,paint:iG,filter:vy});else try{n.setFilter(lo,vy)}catch{}if(X5(n),sG(n),!GG(ae||c||"",U||_||"")&&Array.isArray(Xt?.features)&&Xt.features.some(nn=>nn?.properties?.interactive===!1||nn?.properties?.type==="drawing")){const nn=["downcase",["to-string",["coalesce",["get","Layer"],["get","layer"],["get","FeatureClass"],["get","featureClass"],["get","type"],["get","Type"]]]],sr=["all",["==",["get","interactive"],!1],["!",["any",[">=",["index-of","grid",nn],0],[">=",["index-of","area-bndy",nn],0],[">=",["index-of","area bndy",nn],0]]]];if(!n.getLayer(kp))n.addLayer({id:kp,type:"line",source:Va,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#2f2f2f","line-width":["interpolate",["linear"],["zoom"],16,.15,18,.25,20,.45],"line-opacity":.6},filter:sr});else try{n.setFilter(kp,sr)}catch{}}if(!n.getLayer(lf))n.addLayer({id:lf,type:"line",source:Va,paint:{"line-color":"#444","line-width":["interpolate",["linear"],["zoom"],16,.4,18,.8,20,1.2],"line-opacity":.7},filter:vy});else try{n.setFilter(lf,vy)}catch{}if(kL(n),a?.enableWalls&&a?.wallsBasePath){const nn=a.wallsFloorId||_||e?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||null;await Yq({basePath:a.wallsBasePath,floorId:nn,map:n,roomsFC:Xt,affine:Y,rotationOverride:He,fitTransform:Oe});try{n.setPaintProperty(lo,"fill-opacity",.25)}catch{}}const $t=a?.roomsBasePath||a?.wallsBasePath,xr=c||i?.fitBuilding?.properties?.id||i?.fitBuilding?.properties?.name||null;if($t){const nn=a?.roomsFloorId||a?.wallsFloorId||_||e?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||null;nn&&(await Kq({basePath:$t,floorId:nn,map:n,affine:Y,rotationOverride:He,fitTransform:Oe||Le.fitTransform||null,roomsFC:Xt,buildingLabel:xr}),await Qq({basePath:$t,floorId:nn,map:n,affine:Y,rotationOverride:He,fitTransform:Oe||Le.fitTransform||null}))}aG(n);const dr=KA(Ke,Ce),ni=KA(ge,We);try{n.getLayer(px)&&n.setFilter(px,dr),n.getLayer(mx)&&n.setFilter(mx,ni)}catch{}try{n.getLayer(qd)&&n.getLayer(lf)&&n.moveLayer(qd,lf)}catch{}if(t!=null&&n.getLayer(qd)){const nn=Array.isArray(t)?t.filter(sr=>sr!=null):[t],yn=nn.length?["any",["in",["id"],["literal",nn]],["in",["get","RevitId"],["literal",nn]]]:["==",["id"],""];n.setFilter(qd,yn),n.getLayer(vg)&&n.setFilter(vg,yn)}try{const nn=Lc($);nn&&isFinite(nn[0])&&n.fitBounds([[nn[0],nn[1]],[nn[2],nn[3]]],{padding:40,duration:400})}catch{}return{summary:ut,rooms:Ze}}function Qu(n){return n?n.type==="FeatureCollection"?n:n.type==="Feature"?{type:"FeatureCollection",features:[n]}:n.type==="GeometryCollection"?{type:"FeatureCollection",features:(n.geometries||[]).map(e=>({type:"Feature",geometry:e,properties:{}}))}:n.type&&n.coordinates?{type:"FeatureCollection",features:[{type:"Feature",geometry:n,properties:{}}]}:null:null}function cG(n){if(n==null)return 0;if(typeof n=="number")return n;const e=Number(String(n).replace(/,/g,""));return Number.isFinite(e)?e:0}function Od(n={}){if(Number.isFinite(n.areaSF))return Number(n.areaSF);const e=n.Area_SF??n.Area??n["Area SF"];return e==null||e===""?null:cG(e)}function Rv(){return{totalSf:0,rooms:0,classroomSf:0,classroomCount:0,labSf:0,labCount:0,officeSf:0,officeCount:0,deptCounts:new Map}}function hG(n={}){const e=X9(n)||"",t=String(e).trim().charAt(0),i=Xd(n,["NCES_Type","NCES Type","NCES_Type_Code","NCES Type Code"]),a=String(i||"").trim().charAt(0),c=K9(n),_=(c?.norm||"").toLowerCase(),y=_.includes("classroom")||_.includes("lecture")||t==="1"||a==="1",s=_.includes("lab")||_.includes("laboratory")||_.includes("studio")||t==="2"||a==="2",T=c?.isOfficeText||Y9(e);return y?"classroom":s?"lab":T?"office":"other"}function Y5(n,e={}){if(!n)return;const t=Od(e),i=Number.isFinite(t)?t:0;n.totalSf+=i,n.rooms+=1;const a=hG(e);a==="classroom"?(n.classroomSf+=i,n.classroomCount+=1):a==="lab"?(n.labSf+=i,n.labCount+=1):a==="office"&&(n.officeSf+=i,n.officeCount+=1);const c=qa(h_(e));c&&n.deptCounts.set(c,(n.deptCounts.get(c)||0)+i)}function b2(n=[]){const e=Rv();return n.forEach(t=>Y5(e,t?.properties)),r_(e)}function r_(n){if(!n)return null;const t=Array.from((n.deptCounts||new Map).entries()).sort((a,c)=>c[1]-a[1]),i=Object.fromEntries(t);return{totalSf:n.totalSf||0,classroomSf:n.classroomSf||0,labSf:n.labSf||0,officeSf:n.officeSf||0,rooms:n.rooms||0,classroomCount:n.classroomCount||0,labCount:n.labCount||0,officeCount:n.officeCount||0,deptCounts:i,totalsByDept:i,keyDepts:t.slice(0,6).map(([a])=>a)}}function fG(n){const e=String(n||"").trim();if(!e||T2(e))return!1;const t=e.toUpperCase();return t!=="UNSPECIFIED"&&t!=="UNKNOWN"&&t!=="N/A"&&t!=="NA"}function fL(n){const t=Object.entries(n||{}).filter(([i])=>fG(i));return Object.fromEntries(t)}function oy(n=[]){const e=(n||[]).map(IL).filter(Boolean);if(!e.length)return null;const t=b2(e);if(!t)return null;const i=fL(t.totalsByDept||t.deptCounts||{}),a=Object.entries(i).sort((c,_)=>(_[1]||0)-(c[1]||0));return{...t,deptCounts:i,totalsByDept:i,keyDepts:a.slice(0,6).map(([c])=>c)}}function dG(n=[]){const e=b2(n);if(!e)return null;const t=fL(e.totalsByDept||e.deptCounts||{}),i=Object.entries(t).sort((a,c)=>(c[1]||0)-(a[1]||0));return{...e,deptCounts:t,totalsByDept:t,keyDepts:i.slice(0,6).map(([a])=>a)}}function pG(n,e){const t=(e||"").trim().toLowerCase();if(!t||!Array.isArray(n))return null;let i=0,a=0;const c={},_={};for(const y of n){const s=y?.properties||{};if(String(h_(s)||"").trim().toLowerCase()!==t)continue;const L=wf(s)||"Unspecified",R=Od(s),U=Number.isFinite(R)?R:Number(s.sf??s.SF??s.AreaSF??s.Area??s.area??s.areaSF??s["Area SF"]??0)||0;a+=1,i+=U,c[L]=(c[L]||0)+1,_[L]=(_[L]||0)+U}return{totalSF:i,rooms:a,roomTypes:c,sfByRoomType:_}}function Uw(n,e=1200){return Array.isArray(n)?n.slice(0,e).map((i,a)=>{const c=String(i.buildingName??i.buildingLabel??i.building??"").trim(),_=String(i.floor??i.floorId??"").trim(),y=String(i.roomNumber??i.roomLabel??i.name??"").trim(),s=String(i.roomId??i.revitId??i.id??"").trim(),T=i.roomGuid??i.roomGUID??i.revitUniqueId??i.revitUniqueID??i["Room GUID"]??null,L=[c,_,y].filter(Boolean).join("|")||`room-${a}`,R=s||L,U=String(i.occupant??"").trim(),M=String(i.vacancy??(U?"Occupied":"Unknown")).trim();return{id:R,revitId:i.revitId??T??null,roomGuid:T,roomId:s||L,buildingLabel:c,floorId:_,floorName:_,roomLabel:y,type:String(i.type??i.roomType??"").trim(),sf:Number(i.sf??i.areaSF??i.area??0)||0,department:String(i.department??"").trim(),occupant:U,vacancy:M,occupancyStatus:U?"Occupied":"Vacant",occupantDept:String(i.department??"").trim()||null}}).filter(i=>i.id):null}function dL(n){return Array.isArray(n)?n.map(e=>({id:e?.id??e?.roomId??"",roomId:e?.roomId??e?.id??"",revitId:e?.revitId??e?.roomGuid??null,buildingLabel:e?.buildingLabel??e?.buildingName??e?.building??"",floorId:e?.floorId??e?.floorName??"",floorName:e?.floorName??e?.floorId??"",roomLabel:e?.roomLabel??e?.roomNumber??"",type:e?.type??e?.roomType??"",sf:Number(e?.sf??e?.area??e?.areaSF??0)||0,department:e?.department??""})).filter(e=>e.id||e.roomId):[]}function pL(n,e={}){if(!Array.isArray(n)||n.length===0)return[];const t=Number.isFinite(e.maxTotal)?e.maxTotal:700,i=Number.isFinite(e.maxPerBuilding)?e.maxPerBuilding:120,a=Number.isFinite(e.maxPerType)?e.maxPerType:30,c=dL(n);if(c.length<=t)return c;const _=new Map;for(const L of c){const R=Hs(L.buildingLabel||""),U=xg(L.type||"")||"other";_.has(R)||_.set(R,new Map);const M=_.get(R);M.has(U)||M.set(U,[]),M.get(U).push(L)}const y=[],s=(L,R)=>{if(!(!Array.isArray(L)||R<=0)){L.sort((U,M)=>(Number(M.sf)||0)-(Number(U.sf)||0));for(const U of L.slice(0,R))if(y.push(U),y.length>=t)return}};for(const[,L]of _.entries()){if(y.length>=t)break;let R=0;for(const U of L.values()){if(y.length>=t)break;const M=i-R;if(M<=0)break;const Q=Math.min(a,M);s(U,Q),R+=Math.min(U.length,Q)}}if(y.length>=t)return y.slice(0,t);const T=new Set(y.map(L=>L.id||L.roomId));for(const L of c){if(y.length>=t)break;const R=L.id||L.roomId;T.has(R)||(y.push(L),T.add(R))}return y.slice(0,t)}function mG(n=[]){const e={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}};return(n||[]).forEach(t=>{const i=Number(t?.sf??0)||0,a=qa(t?.type??t?.roomType??"Unknown")||"Unknown";e.rooms+=1,e.totalSF+=i,e.roomTypes[a]=(e.roomTypes[a]||0)+1,e.sfByRoomType[a]=(e.sfByRoomType[a]||0)+i}),e}function gG(n,e,t={}){if(!Array.isArray(n)||!e)return n||[];const i=Number.isFinite(t.maxTotal)?t.maxTotal:180,a=Number.isFinite(t.minPerType)?t.minPerType:4,c=Number.isFinite(t.maxPerType)?t.maxPerType:30,_=e?.sfByRoomType||{},y=e?.roomTypes||{},s=Number(e?.totalSF??0)||0,T=Number(e?.rooms??0)||0,L=Object.entries(_).map(([ie,oe])=>{const ve=xg(ie),de=Number(oe||0)||0,Pe=Number(y[ie]||0)||0;return{key:ve,label:ie,sf:de,count:Pe}}).filter(ie=>ie.key);if(!L.length)return pL(n,{maxTotal:i,maxPerBuilding:i,maxPerType:c});L.sort((ie,oe)=>(oe.sf||0)-(ie.sf||0));const R=new Map;L.forEach(ie=>{const oe=s>0?ie.sf/s:0,ve=T>0?ie.count/T:0,de=Math.round(oe*i),Pe=Math.round(ve*i),Be=Math.max(a,de,Pe);R.set(ie.key,Math.min(c,Be))});const U=new Map;n.forEach(ie=>{const oe=xg(ie?.type??ie?.roomType??"")||"other";U.has(oe)||U.set(oe,[]),U.get(oe).push(ie)}),U.forEach(ie=>ie.sort((oe,ve)=>(Number(ve.sf)||0)-(Number(oe.sf)||0)));const M=[],Q=new Set,ae=ie=>{const oe=String(ie?.roomId??ie?.id??ie?.revitId??"");!oe||Q.has(oe)||(M.push(ie),Q.add(oe))};for(const ie of L){if(M.length>=i)break;const oe=U.get(ie.key)||[],ve=R.get(ie.key)||0;let de=0;for(const Pe of oe){if(M.length>=i||de>=ve)break;ae(Pe),de+=1}}if(M.length>=i)return M.slice(0,i);const ye=[];U.forEach(ie=>ie.forEach(oe=>{const ve=String(oe?.roomId??oe?.id??oe?.revitId??"");!ve||Q.has(ve)||ye.push(oe)})),ye.sort((ie,oe)=>(Number(oe.sf)||0)-(Number(ie.sf)||0));for(const ie of ye){if(M.length>=i)break;ae(ie)}return M.slice(0,i)}function ZA(n,e,t,i={}){if(!t||!Array.isArray(e))return{candidates:n||[],added:0};const a=Number(t.totalSF??0)||0;if(!a)return{candidates:n||[],added:0};const c=Number.isFinite(i.targetTolerance)?i.targetTolerance:.1,_=a*(1-c),y=Number.isFinite(i.maxCandidates)?i.maxCandidates:25,s=i.primaryBuilding||"",T=Array.isArray(n)?[...n]:[],L=mG(T);if(L.totalSF>=_||T.length>=y)return{candidates:T,added:0};const R=new Set(T.map(ie=>String(ie?.roomId??ie?.id??ie?.revitId??""))),U=new Map;e.forEach(ie=>{const oe=String(ie?.roomId??ie?.id??ie?.revitId??"");if(!oe||R.has(oe))return;const ve=xg(ie?.type??ie?.roomType??"")||"other";U.has(ve)||U.set(ve,[]),U.get(ve).push(ie)}),U.forEach(ie=>ie.sort((oe,ve)=>mL(oe,ve,s)));const M=Object.entries(t.sfByRoomType||{}).map(([ie,oe])=>({key:xg(ie),label:ie,sf:Number(oe||0)||0})).filter(ie=>ie.key);M.sort((ie,oe)=>{const ve=vx(ie.label),de=vx(oe.label);return ve!==de?ve-de:(oe.sf||0)-(ie.sf||0)});const Q=M.map(ie=>ie.key);let ae=0;const ye=(ie,oe)=>!ie||T.length>=y?!1:(T.push({roomId:ie?.roomId??ie?.id??"",id:ie?.id??ie?.roomId??"",revitId:ie?.revitId??ie?.roomGuid??null,buildingLabel:ie?.buildingLabel??"",floorId:ie?.floorId??ie?.floorName??"",floorName:ie?.floorName??ie?.floorId??"",roomLabel:ie?.roomLabel??"",type:ie?.type??"",sf:Number(ie?.sf??0)||0,rationale:oe||"Added to reach baseline target."}),L.totalSF+=Number(ie?.sf??0)||0,ae+=1,!0);for(const ie of Q){if(L.totalSF>=_||T.length>=y)break;const oe=U.get(ie)||[];for(;oe.length&&L.totalSF<_&&T.length<y;){const ve=oe.shift();ye(ve,"Added to better match baseline room-type mix.")}}if(L.totalSF<_&&T.length<y){const ie=[];U.forEach(ve=>ve.forEach(de=>ie.push(de)));const oe=gL(ie,s);for(const ve of oe){if(L.totalSF>=_||T.length>=y)break;ye(ve,"Added to reach baseline total SF.")}}return{candidates:T,added:ae}}function Vw(n){return n&&String(n).replace(/^\s*vacant\s*[:\-]\s*/i,"").replace(/^\s*vacant\?\s*[:\-]\s*/i,"").replace(/\bvacancy status\b/ig,"availability").replace(/\bvacant\b/ig,"available")}const vx=n=>{const e=String(n??"").toLowerCase();return e?/(office|workstation|admin|faculty|staff|suite|open office)/i.test(e)?0:/(lab|laboratory|studio|shop|clinic|research)/i.test(e)?2:/(classroom|lecture|seminar|training|teaching)/i.test(e)?3:1:1},JA=n=>/(lab|laboratory|studio|shop|clinic|research)/i.test(String(n??"")),QA=n=>/(classroom|lecture|seminar|training|teaching)/i.test(String(n??"")),eI=n=>Hs(n?.buildingLabel??n?.buildingName??n?.building??""),mL=(n,e,t)=>{const i=Hs(t||""),a=eI(n),c=eI(e);if(i){const L=a===i;if(L!==(c===i))return L?-1:1}const _=Number(n?.sf??n?.area??n?.areaSF??0)||0,y=Number(e?.sf??e?.area??e?.areaSF??0)||0;if(_!==y)return y-_;const s=vx(n?.type??n?.roomType??""),T=vx(e?.type??e?.roomType??"");return s!==T?s-T:0},gL=(n,e)=>{if(!Array.isArray(n))return[];const t=[...n];return t.sort((i,a)=>mL(i,a,e)),t},tI=(n=[])=>{if(!Array.isArray(n)||!n.length)return"";const e=new Map;return n.forEach(t=>{const i=qa(t?.buildingLabel||"");if(!i)return;const a=Number(t?.sf??t?.area??t?.areaSF??0)||0;e.set(i,(e.get(i)||0)+a)}),Array.from(e.entries()).sort((t,i)=>i[1]-t[1])[0]?.[0]||""};function jc(n,e){try{const t=n?.getSource(e);return t&&typeof t.setData=="function"?t:null}catch{return null}}function yG(n,e="",t="",i=1200){return Array.isArray(n)?n.slice(0,i).map((a,c)=>{const _=a?.properties||{},y=a?.id??_.RevitId??_.id??_.roomId??_.RoomId,s=String(_.roomNumber??_.RoomNumber??_.Number??_.Room??_.Name??"").trim(),T=wf(_)||"Unknown",L=String(_.department??_.Department??_.Dept??"").trim(),R=String(_.occupant??_.Occupant??"").trim(),U=Od(_),M=Number.isFinite(U)?U:Number(_.sf??_.SF??_.AreaSF??_.Area??_.area??0)||0,Q=[e,t||_.Floor,s||c].filter(Boolean).join("|")||`feat-${c}`,ae=String(y??"").trim()||Q;return{id:ae,revitId:_.RevitId??y??null,roomId:ae,buildingLabel:e||String(_.buildingLabel??_.Building??_.building??"").trim(),floorId:t||String(_.floorId??_.floor??_.Floor??"").trim(),floorName:t||String(_.floorId??_.floor??_.Floor??"").trim(),roomLabel:s,type:T,sf:M,department:L,occupant:R,vacancy:R?"Occupied":"Unknown",occupancyStatus:R?"Occupied":"Vacant",occupantDept:L||null}}).filter(a=>a.id):null}const nI=async(n,e)=>{const{ensureFloorsForBuilding:t,buildFloorUrl:i,floorCache:a,fetchGeoJSON:c}=e||{},_=(n||"").trim();if(!_)return{perBuilding:{},campusTotals:null};const y=_.toLowerCase(),s={},T={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}};for(const L of bf){const R=L?.name;if(!R)continue;let U=await t(R);if(!U?.length)continue;const M={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}};for(const Q of U){const ae=i(R,Q);if(!ae)continue;let ye=a.get(ae);if(!ye)try{ye=await c(ae),ye&&a.set(ae,ye)}catch{continue}const ie=Qu(ye),oe=pG(ie?.features||[],y);oe&&(M.totalSF+=oe.totalSF||0,M.rooms+=oe.rooms||0,Object.entries(oe.roomTypes||{}).forEach(([ve,de])=>{M.roomTypes[ve]=(M.roomTypes[ve]||0)+de}),Object.entries(oe.sfByRoomType||{}).forEach(([ve,de])=>{M.sfByRoomType[ve]=(M.sfByRoomType[ve]||0)+de}))}(M.rooms||M.totalSF)&&(s[R]=M,T.totalSF+=M.totalSF,T.rooms+=M.rooms,Object.entries(M.roomTypes||{}).forEach(([Q,ae])=>{T.roomTypes[Q]=(T.roomTypes[Q]||0)+ae}),Object.entries(M.sfByRoomType||{}).forEach(([Q,ae])=>{T.sfByRoomType[Q]=(T.sfByRoomType[Q]||0)+ae}))}return!T.rooms&&!T.totalSF?{perBuilding:{},campusTotals:null}:{perBuilding:s,campusTotals:T}};function rh(n,e){if(!n)return{loading:!1,mode:e,totalSf:"-",classroomSf:"-",rooms:"-",classroomCount:"-",labSf:"-",officeSf:"-",labCount:"-",officeCount:"-",deptCount:"-",keyDepts:[]};const t=c=>Number.isFinite(c)?Math.round(c).toLocaleString():"-",i=c=>Number.isFinite(c)?Number(c).toLocaleString():"-",a=n.deptCounts?Object.keys(n.deptCounts).length:0;return{loading:!1,mode:e,totalSf:t(n.totalSf),classroomSf:t(n.classroomSf),labSf:t(n.labSf),officeSf:t(n.officeSf),rooms:i(n.rooms),classroomCount:i(n.classroomCount),labCount:i(n.labCount),officeCount:i(n.officeCount),deptCount:a?a.toString():"-",keyDepts:n.keyDepts||[]}}function _G(n,e){try{if(!n||!Array.isArray(n.features)||n.features.length===0)return n;const t=e?.type==="Feature"?e:e?.type?{type:"Feature",properties:{},geometry:e}:null;if(!t)return n;const i=y_(t);if(i){const Ue={rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:null,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null,snapCorner:i},Le=IG(t),He=TG(t),Ke=Array.isArray(He)?He[0]:null,Ce=Array.isArray(He)?He[1]:null,ge=!!(Ke&&Ce),We=AG(t);let Ve=n,ut=Gu(n);if(Le!=="none"&&!ge){const wt=K5(n,t);if(Number.isFinite(wt)&&Math.abs(wt)>1.5){const Ut=ut?.geometry?.coordinates||null;Ue.rotationDeg=wt,Ue.rotationPivot=Ut;const Gt=af(n,wt,Ut?{pivot:Ut}:void 0);Gt?.features?.length&&(Ve=Gt,ut=Gu(Ve))}}const[pt,It,Oe,Wt]=Lc(Ve),[Zt,Xt,Ze,zn]=Lc(t);if(![pt,It,Oe,Wt,Zt,Xt,Ze,zn].every(Number.isFinite))return n;const on=Math.max(1e-9,Oe-pt),mt=Math.max(1e-9,Wt-It),Ir=Math.max(1e-9,Ze-Zt),Fr=Math.max(1e-9,zn-Xt),$t=$w(t)==="directional",xr=$t?rm(Ve):nm([pt,It,Oe,Wt]),dr=$t?rm(t):nm([Zt,Xt,Ze,zn]);let ni=null,nn=0,yn=null,sr=null,Zn=null,$r=null;if(Ke&&Ce&&xr&&dr&&(yn=xr[Ke],sr=xr[Ce],Zn=dr[Ke],$r=dr[Ce],yn&&sr&&Zn&&$r)){const wt=Uf(ma(yn),ma(sr),{units:"kilometers"}),Ut=Uf(ma(Zn),ma($r),{units:"kilometers"});Number.isFinite(wt)&&Number.isFinite(Ut)&&wt>0&&(ni=Ut/wt);const Gt=Qm(ma(yn),ma(sr)),Ot=(Qm(ma(Zn),ma($r))-Gt+540)%360-180;Number.isFinite(Ot)&&(nn=Ot)}const qn=yn||ut?.geometry?.coordinates||null;Ue.scaleOrigin=qn;const jr=.96,ir=sI(t),Xn=Math.min(Ir/on,Fr/mt)*jr,Bi=We!=="legacy"&&Number.isFinite(ni)&&ni>0,bi=(Bi?ni:Xn)*ir,or=Bi||Math.abs(ir-1)>1e-6||bi<.9||bi>1.1;Ue.scale=or?bi:1;let ui=or?qy(Ve,bi,qn?{origin:qn}:void 0):Ve;const Kr=EG(t),wi=(Number.isFinite(nn)?nn:0)+(Number.isFinite(Kr)?Kr:0);ge&&We!=="legacy"&&Number.isFinite(wi)&&Math.abs(wi)>1e-6&&Array.isArray(qn)&&(ui=af(ui,wi,{pivot:qn}),Ue.rotationDeg=wi,Ue.rotationPivot=qn);const si=$t?null:Lc(ui),vt=$t?rm(ui):nm(si),Ne=dr||($t?rm(t):nm([Zt,Xt,Ze,zn]));if(vt&&Ne){const wt=Ke===i&&Ce,Ut=wt?vt[Ke]:vt[i],Gt=wt?Ne[Ke]:Ne[i];if(Ut&&Gt){const Tt=ma(Ut),Ot=ma(Gt),zt=Uf(Tt,Ot,{units:"kilometers"}),Pn=Qm(Tt,Ot);Number.isFinite(zt)&&Number.isFinite(Pn)&&(ui=zt>0?ig(ui,zt,Pn,{units:"kilometers"}):ui,Ue.translateKm=zt,Ue.translateBearing=Pn)}if(ge&&wt&&We!=="legacy"&&We!=="match"){const Tt=vt[Ke],Ot=Ne[Ke];if(Tt&&Ot){const zt=Uf(ma(Tt),ma(Ot),{units:"kilometers"}),Pn=Qm(ma(Tt),ma(Ot));Number.isFinite(zt)&&Number.isFinite(Pn)&&zt>1e-9&&(ui=ig(ui,zt,Pn,{units:"kilometers"}),Ue.translateKm=(Ue.translateKm||0)+zt,Ue.translateBearing=Pn)}}}const ze=Zn||Ne?.[i]||null;if(ge&&We==="legacy"&&Number.isFinite(wi)&&Math.abs(wi)>1e-6&&ze&&(ui=af(ui,wi,{pivot:ze}),Ue.refineRotationDeg=(Ue.refineRotationDeg||0)+wi,Ue.refineRotationPivot=ze),ze&&Le!=="none"&&!ge){const wt=iI(ui,t,ze,{maxDeg:6,stepDeg:.4,fineStep:.1,fineWindow:1.5,hullLimit:1200});wt?.fc&&(ui=wt.fc),Ue.refineRotationDeg=wt?.angle||0,Ue.refineRotationPivot=ze}ge||Number.isFinite(Kr)&&Math.abs(Kr)>1e-6&&ze&&(ui=af(ui,Kr,{pivot:ze}),Ue.refineRotationDeg=(Ue.refineRotationDeg||0)+Kr,Ue.refineRotationPivot=ze);const ft=CG(t);return Array.isArray(ft)&&(ui=x2(ui,ft),Ue.nudgeMeters=ft),ui&&typeof ui=="object"&&(ui.__mfFitted=!0,ui.__mfFittedBuilding=t?.properties?.id||t?.properties?.name||"",ui.__mfFitTransform=Ue,n.__mfAffineApplied&&(ui.__mfAffineApplied=n.__mfAffineApplied),n.__mfRotationOverride!=null&&(ui.__mfRotationOverride=n.__mfRotationOverride),n.__mfRotationPivot&&(ui.__mfRotationPivot=n.__mfRotationPivot),n.__mfFitTransformApplied&&(ui.__mfFitTransformApplied=n.__mfFitTransformApplied)),ui}let a=Gu(n);const c=Gu(t),_={rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:null,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null},y=K5(n,t);if(Number.isFinite(y)&&Math.abs(y)>1.5){const Ue=a?.geometry?.coordinates||null;_.rotationDeg=y,_.rotationPivot=Ue;const Le=af(n,y,Ue?{pivot:Ue}:void 0);Le?.features?.length&&(n=Le,a=Gu(n))}const[s,T,L,R]=Lc(n),[U,M,Q,ae]=Lc(t),ye=Math.max(1e-9,L-s),ie=Math.max(1e-9,R-T),oe=Math.max(1e-9,Q-U),ve=Math.max(1e-9,ae-M),de=.96,Pe=sI(t),Be=Math.min(oe/ye,ve/ie)*de*Pe,_e=Be<.9||Be>1.1,G=a?.geometry?.coordinates||null;_.scale=_e?Be:1,_.scaleOrigin=G;let B=_e?qy(n,Be,G?{origin:G}:void 0):n;const Y=Lc(B),$=[(U+Q)/2,(M+ae)/2],J=Array.isArray(Y)&&Y.length===4&&Y.every(Ue=>Number.isFinite(Ue)),te=Number.isFinite($[0])&&Number.isFinite($[1]);if(i&&J){const Le=$w(t)==="directional",He=Le?rm(B):nm(Y),Ke=Le?rm(t):nm([U,M,Q,ae]);if(He&&Ke){const Ce=He[i],ge=Ke[i];if(Ce&&ge){const We=ma(Ce),Ve=ma(ge),ut=Uf(We,Ve,{units:"kilometers"}),pt=Qm(We,Ve);Number.isFinite(ut)&&Number.isFinite(pt)&&(B=ut>0?ig(B,ut,pt,{units:"kilometers"}):B,_.translateKm=ut,_.translateBearing=pt,_.snapCorner=i)}}}else{const Ue=[],Le=(He,Ke,Ce)=>{if(!Array.isArray(Ke)||!Array.isArray(Ce))return;const ge=ma(Ke),We=ma(Ce),Ve=Uf(ge,We,{units:"kilometers"}),ut=Qm(ge,We);if(!Number.isFinite(Ve)||!Number.isFinite(ut))return;const pt=Ve>0?ig(B,Ve,ut,{units:"kilometers"}):B,It=gm(pt,1200),Oe=It?g_(It,t):0;Ue.push({label:He,distKm:Ve,bearing:ut,fc:pt,score:Oe})};if(J&&te){const He=[(Y[0]+Y[2])/2,(Y[1]+Y[3])/2];Le("center",He,$);const Ce=$w(t)==="directional",ge=Ce?rm(B):nm(Y),We=Ce?rm(t):nm([U,M,Q,ae]);ge&&We&&Object.keys(ge).forEach(Ve=>{Le(`corner-${Ve}`,ge[Ve],We[Ve])})}else Le("centroid",a?.geometry?.coordinates,c?.geometry?.coordinates);if(Ue.length){const He=Ue.reduce((Ke,Ce)=>!Ke||Ce.score>Ke.score+1e-6||Math.abs(Ce.score-Ke.score)<=1e-6&&Ce.distKm<Ke.distKm?Ce:Ke,null);He?.fc&&(B=He.fc,_.translateKm=He.distKm,_.translateBearing=He.bearing)}}const Se=c?.geometry?.coordinates||$,De=iI(B,t,Se,{maxDeg:6,stepDeg:.4,fineStep:.1,fineWindow:1.5,hullLimit:1200}),$e=De?.fc||B;return _.refineRotationDeg=De?.angle||0,_.refineRotationPivot=Se,$e&&typeof $e=="object"&&($e.__mfFitted=!0,$e.__mfFittedBuilding=t?.properties?.id||t?.properties?.name||"",$e.__mfFitTransform=_,n.__mfAffineApplied&&($e.__mfAffineApplied=n.__mfAffineApplied),n.__mfRotationOverride!=null&&($e.__mfRotationOverride=n.__mfRotationOverride),n.__mfRotationPivot&&($e.__mfRotationPivot=n.__mfRotationPivot),n.__mfFitTransformApplied&&($e.__mfFitTransformApplied=n.__mfFitTransformApplied)),$e}catch{return n}}function Gf(n,e=1/0){const t=[];function i(a){if(!(!a||t.length>=e)){if(typeof a[0]=="number"){t.push([a[0],a[1]]);return}for(const c of a){if(t.length>=e)break;i(c)}}}return n?.type==="GeometryCollection"?(n.geometries||[]).forEach(a=>i(a.coordinates)):i(n?.coordinates),t}function my(n,e=1/0){if(!n)return[];if(n.type==="FeatureCollection"){const t=[];for(const i of n.features||[]){if(t.length>=e)break;const a=Gf(i.geometry,e-t.length);a?.length&&t.push(...a)}return t}return n.type==="Feature"?Gf(n.geometry,e):n.type?Gf(n,e):[]}function yL(n){if(!Array.isArray(n)||n.length<2)return 0;let e=0,t=0;n.forEach(([y,s])=>{e+=y,t+=s}),e/=n.length,t/=n.length;let i=0,a=0,c=0;return n.forEach(([y,s])=>{const T=y-e,L=s-t;i+=T*T,a+=L*L,c+=T*L}),!Number.isFinite(i)||!Number.isFinite(a)||!Number.isFinite(c)?0:.5*Math.atan2(2*c,i-a)*180/Math.PI}function sg(n){return Array.isArray(n)&&n.length>=2&&typeof n[0]=="number"&&typeof n[1]=="number"}function w2(n,e){if(Array.isArray(n)){if(n.length&&sg(n[0])){e.push(n);return}n.forEach(t=>w2(t,e))}}function xy(n){if(!n?.coordinates)return null;const e=[];w2(n.coordinates,e);let t=0,i=null;const a=(c,_)=>Math.abs(c[0]-_[0])<1e-9&&Math.abs(c[1]-_[1])<1e-9;return e.forEach(c=>{if(!Array.isArray(c)||c.length<2)return;for(let s=0;s<c.length-1;s+=1){const T=c[s],L=c[s+1];if(!sg(T)||!sg(L))continue;const R=L[0]-T[0],U=L[1]-T[1],M=Math.hypot(R,U);M>t&&(t=M,i=Math.atan2(U,R)*180/Math.PI)}const _=c[c.length-1],y=c[0];if(sg(_)&&sg(y)&&!a(_,y)){const s=y[0]-_[0],T=y[1]-_[1],L=Math.hypot(s,T);L>t&&(t=L,i=Math.atan2(T,s)*180/Math.PI)}}),i}function rI(n){if(!n?.coordinates)return null;const e=[];w2(n.coordinates,e);let t=0,i=0,a=0;return e.forEach(_=>{if(!(!Array.isArray(_)||_.length<2))for(let y=0;y<_.length-1;y+=1){const s=_[y],T=_[y+1];if(!sg(s)||!sg(T))continue;const L=T[0]-s[0],R=T[1]-s[1],U=Math.hypot(L,R);if(U<=0)continue;const M=Math.atan2(R,L);i+=U*Math.cos(2*M),t+=U*Math.sin(2*M),a+=U}}),a<=0?null:.5*Math.atan2(t,i)*180/Math.PI}function Mv(n){let e=(n+180)%360-180;return e>90&&(e-=180),e<-90&&(e+=180),e}function vG(n,e=2e3){if(!n?.geometry)return 0;const t=Gf(n.geometry,e);return yL(t)}function xG(n,e=4e3){if(!n?.features?.length)return 0;const t=[];for(const i of n.features){if(t.length>=e)break;const a=Gf(i.geometry,e-t.length);a?.length&&t.push(...a)}return yL(t)}function gm(n,e=3e3){if(!n?.features?.length)return null;const t=[];for(const c of n.features){if(t.length>=e)break;const _=Gf(c.geometry,e-t.length);_?.length&&t.push(..._)}if(t.length<3)return null;const i=t.map(c=>ma(c));return TV(zy(i))||null}function K5(n,e){const t=gm(n),i=xy(t?.geometry),a=xy(e?.geometry),c=xG(n),_=vG(e),y=rI(t?.geometry),s=rI(e?.geometry),T=[];return Number.isFinite(i)&&Number.isFinite(a)&&T.push(Mv(a-i)),Number.isFinite(c)&&Number.isFinite(_)&&T.push(Mv(_-c)),Number.isFinite(y)&&Number.isFinite(s)&&T.push(Mv(s-y)),T.length?T.length===1?T[0]:(T.sort((L,R)=>L-R),T[Math.floor(T.length/2)]):null}function g_(n,e){try{const t=U9(zy([n,e]));if(!t)return 0;const i=JT(t),a=JT(n);return!Number.isFinite(i)||!Number.isFinite(a)||a<=0?0:i/a}catch{return 0}}function iI(n,e,t,i={}){if(!n||!e||!t)return{fc:n,angle:0};const a=Number.isFinite(i.maxDeg)?i.maxDeg:5,c=Number.isFinite(i.stepDeg)?i.stepDeg:.5,_=Number.isFinite(i.fineStep)?i.fineStep:.1,y=Number.isFinite(i.fineWindow)?i.fineWindow:1.2,s=gm(n,i.hullLimit||1200);if(!s)return{fc:n,angle:0};const T=g_(s,e);let L=0,R=T;for(let M=-a;M<=a;M+=c){if(Math.abs(M)<1e-6)continue;const Q=af(s,M,{pivot:t}),ae=g_(Q,e);ae>R+1e-4&&(R=ae,L=M)}if(_>0&&y>0){const M=L-y,Q=L+y;for(let ae=M;ae<=Q;ae+=_){if(Math.abs(ae)<1e-6)continue;const ye=af(s,ae,{pivot:t}),ie=g_(ye,e);ie>R+1e-4&&(R=ie,L=ae)}}if(Math.abs(L)<.001)return{fc:n,angle:0};const U=af(n,L,{pivot:t});return{fc:U?.features?.length?U:n,angle:L}}function bG(n){let e=1/0,t=1/0,i=-1/0,a=-1/0;return(n?.features||[]).forEach(c=>{Gf(c.geometry).forEach(([_,y])=>{_<e&&(e=_),y<t&&(t=y),_>i&&(i=_),y>a&&(a=y)})}),[e,t,i,a]}function nm(n){if(!Array.isArray(n)||n.length!==4)return null;const[e,t,i,a]=n;return[e,t,i,a].every(Number.isFinite)?{nw:[e,a],ne:[i,a],sw:[e,t],se:[i,t]}:null}function rm(n,e=4e3){let t=n;if(n?.type==="FeatureCollection"){const _=gm(n,e);_?.geometry&&(t=_)}const i=my(t,e);if(!i.length)return null;const a={nw:[-1,1],ne:[1,1],sw:[-1,-1],se:[1,-1]},c={nw:{score:-1/0,pt:null},ne:{score:-1/0,pt:null},sw:{score:-1/0,pt:null},se:{score:-1/0,pt:null}};for(const[_,y]of i)if(!(!Number.isFinite(_)||!Number.isFinite(y)))for(const s of Object.keys(a)){const[T,L]=a[s],R=_*T+y*L;R>c[s].score&&(c[s]={score:R,pt:[_,y]})}return{nw:c.nw.pt,ne:c.ne.pt,sw:c.sw.pt,se:c.se.pt}}function mi(n){return String(n||"").replace(/\u00a0/g," ").trim().toLowerCase().replace(/\bthe\b/g,"").replace(/\bmemorial\b/g,"").replace(/\bresidence\b/g,"").replace(/\bresidency\b/g,"").replace(/\b[a-z]\b/g,"").replace(/theatre/g,"theater").replace(/centre/g,"center").replace(/[^a-z0-9]/g,"")}const J_=[{keys:["Morrison Reeves","Morrison-Reeves Science Center"],corner:"nw",cornerMethod:"directional",cornerPair:["nw","sw"],pairMode:"match",rotationMode:"none"},{keys:["Calvin French Chapel","Calvin H. French Chapel","French Memorial Chapel"],corner:"nw",cornerMethod:"directional",cornerPair:["nw","sw"],pairMode:"match"}];function Q_(n,e){const t={};return n.forEach(i=>{!i||!i.keys||i[e]==null||i.keys.forEach(a=>{const c=mi(a);c&&(t[c]=i[e])})}),t}const wG=new Set([]),Z5=new Set([mi("Calvin French Chapel"),mi("Calvin H. French Chapel"),mi("Calvin H. French Memorial Chapel"),mi("Kiewit Building"),mi("Taylor Hall"),mi("Taylor Hall Residence")]);function SG({buildingLabel:n}={}){const e=mi(n);return e&&wG.has(e)}let qw=null;async function Gw(){if(qw)return qw;try{const n=[ud("Hastings_College_Buildings.json"),"/Hastings_College_Buildings.json","Hastings_College_Buildings.json"],e=await cL(n);if(e?.ok&&e.data&&Array.isArray(e.data.features))return qw=e.data,e.data}catch{}return null}function qf(n){const t=(()=>{try{return decodeURIComponent(String(n||""))}catch{return String(n||"")}})().split("/").filter(Boolean);if(!t.length)return"";const i=t.indexOf("floorplans");return i>=0&&t.length>i+2?t[i+2]:t[t.length-1]||""}function y_(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const a=mi(i);if(a&&aI[a])return aI[a]}return null}function EG(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const a=mi(i);if(a&&Number.isFinite(lI[a]))return lI[a]}return null}function $w(n){if(!n)return"bbox";const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const a=mi(i);if(a&&uI[a])return uI[a]}return"bbox"}function TG(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const a=mi(i);if(a&&cI[a])return cI[a]}return null}function AG(n){if(!n)return"match";const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const a=mi(i);if(a&&hI[a])return hI[a]}return"match"}function IG(n){if(!n)return"auto";const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const a=mi(i);if(a&&fI[a])return fI[a]}return"auto"}function sI(n){if(!n)return 1;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const a=mi(i),c=DG[a];if(a&&Number.isFinite(c))return c}return 1}function CG(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const a=mi(i),c=OG[a];if(a&&Array.isArray(c)&&c.length>=2)return c}return null}function Nd(n=[],e){if(!Array.isArray(n)||!n.length||!e)return null;const t=mi(e);if(!t)return null;let i=null,a=0;for(const c of n){const _=c?.properties||{},y=[mi(_.id),mi(_.name),mi(_.Name),mi(_.buildingId),mi(_.buildingName),mi(_.Building),mi(_.building)].filter(Boolean);for(const s of y){if(!s)continue;const T=s===t,L=s.includes(t)||t.includes(s);if(!T&&!L)continue;const R=s.length;R>a&&(i=c,a=R)}}return i}function kG(n,e){try{if(!n||!n.features?.length||!e||n.__mfGeoreferenced||n.__mfNoFit)return!1;const t=mi(e?.properties?.id||e?.properties?.name||"");if(t&&Z5.has(t)||y_(e))return!0;if(n?.__mfFitted)return!1;const[i,a,c,_]=Lc(n),[y,s,T,L]=Lc(e);if(![i,a,c,_,y,s,T,L].every(Number.isFinite))return!1;const R=Math.max(1e-9,c-i),U=Math.max(1e-9,_-a),M=Math.max(1e-9,T-y),Q=Math.max(1e-9,L-s),ae=Math.min(M/R,Q/U),ye=ae<.75||ae>1.35,ie=Gu(n),oe=Gu(e),ve=Uf(ie,oe,{units:"kilometers"}),de=Number.isFinite(ve)&&ve>.06,Pe=Uf(ma([y,s]),ma([T,L]),{units:"kilometers"}),_e=(Number.isFinite(ve)&&Number.isFinite(Pe)&&Pe>0?ve/Pe:0)>.18,G=c<y||i>T||_<s||a>L,B=K5(n,e),Y=Number.isFinite(B)&&Math.abs(B)>1.5,$=gm(n,1200),J=$?g_($,e):1,te=J>0&&J<.85;return ye||de||G||Y||_e||te}catch{return!1}}const bf=[{name:"Hurley-McDonald Hall",folder:"HurleyMcDonald"},{name:"Gray Center",folder:"Gray Center"},{name:"Morrison-Reeves Science Center",folder:"Morrison Reeves"},{name:"1882",folder:"1882"},{name:"Altman Hall",folder:"Altman Hall"},{name:"Babcock Hall",folder:"Babcock Hall"},{name:"Barrett Alumni",folder:"Barrett Alumni"},{name:"Batchelder Services Bldg",folder:"Batchelder"},{name:"Bronc Hall",folder:"Bronc Hall"},{name:"Bronco Village Apt 911",folder:"Bronco Village Apt 911"},{name:"Bronco Village Apt 915",folder:"Bronco Village Apt 915"},{name:"Bronco Village Apt 917",folder:"Bronco Village Apt 917"},{name:"Bronco Village Apt 919",folder:"Bronco Village Apt 919"},{name:"Bronco Village Apt 921",folder:"Bronco Village Apt 921"},{name:"Bronco Village Apt 923",folder:"Bronco Village Apt 923"},{name:"Calvin H. French Chapel",folder:"Calvin French Chapel"},{name:"Daugherty Student Engagement Center",folder:"Daugherty"},{name:"Farrell-Fleharty",folder:"Fleharty"},{name:"Hazelrigg Student Union",folder:"Hazzelrig"},{name:"Jackson Dinsdale Art Center",folder:"Jackson Dinsdale"},{name:"Kiewit Building",folder:"Kiewit"},{name:"Lloyd Wilson Stadium",folder:"Lloyd Wilson Stadium"},{name:"McCormick Hall",folder:"McCormick"},{name:"Perkins Library",folder:"Perkins"},{name:"Physical Fitness Facility",folder:"Physical Fitness Facility"},{name:"Scott Studio Theater",folder:"Scott Theater"},{name:"Stone Health Center",folder:"Stone Health Center"},{name:"Taylor Hall",folder:"Taylor Hall"},{name:"Wilson Center",folder:"WilsonCenter"}],um=Object.fromEntries(bf.map(n=>[n.name,n.folder])),_L=new Set(bf.map(n=>n.folder)),by=Object.fromEntries(bf.map(n=>[n.folder,n.name])),vL=n=>String(n||"").replace(/\u00a0/g," ").trim().toLowerCase().replace(/theatre/g,"theater").replace(/centre/g,"center").replace(/\bmemorial\b/g,""),R_=n=>vL(n).replace(/[^a-z0-9]/g,""),J5=n=>vL(n).replace(/\b[a-z]\b/gi,"").replace(/[^a-z0-9]/g,""),LG=n=>{if(!n)return null;const e=R_(n);if(!e)return null;const t=bL?.[e];if(t&&um[t])return t;for(const i of Object.keys(um))if(R_(i)===e)return i;return null},Rd=n=>{if(!n)return null;if(um[n])return n;if(_L.has(n))return by[n]||null;const e=S2[n];if(e&&um[e])return e;const t=R_(n),i=J5(n),a=t&&bL?.[t]||i&&PG?.[i]||null;if(a&&um[a])return a;let c=null,_=0;for(const y of Object.keys(um)){const s=R_(y),T=J5(y),L=t===s||i===T,R=t&&s&&(t.includes(s)||s.includes(t))||i&&T&&(i.includes(T)||T.includes(i));if(!L&&!R)continue;const U=s.length;U>_&&(c=y,_=U)}return c},xL={1882:"The 1882 Residence Hall","Altman Hall":"Altman Hall Residency","Babcock Hall":"Babcock Hall Residence","Barrett Alumni":"Barrett Alumni Center","Batchelder Services Bldg":"Batchelder General Services","Bronc Hall":"Bronc Hall Residence","Hurley-McDonald Hall":"hurley_mcdonald","Gray Center":"gray_center","Hazelrigg Student Union":"Hazelrigg Student Union","Lloyd Wilson Stadium":"Lloyd Wilson Field/Stadium","Morrison-Reeves Science Center":"morrison_reeves","Scott Studio Theater":"Scott Studio Theatre","Stone Health Center":"The Stone Health Center","Taylor Hall":"Taylor Hall Residence","Wilson Center":"wilson_center","Farrell-Fleharty":"Lynn Farrell Arena/Fleharty Educational Center","Calvin H. French Chapel":"Calvin French Chapel","Bronco Village Apt 911":"Bronco Village Apartments 1","Bronco Village Apt 915":"Bronco Village Apartments 2","Bronco Village Apt 917":"Bronco Village Apartments 3","Bronco Village Apt 919":"Bronco Village Apartments 4","Bronco Village Apt 921":"Bronco Village Apartments 5","Bronco Village Apt 923":"Bronco Village Apartments 6"},S2={...Object.fromEntries(Object.entries(xL).map(([n,e])=>[e,n])),"Farrell Arena Fleharty Educational Center":"Farrell-Fleharty","Daugherty Center for Student Engagement":"Daugherty Student Engagement Center","Daugherty Center For Student Engagement":"Daugherty Student Engagement Center","Fleharty Center":"Farrell-Fleharty","Calvin H. French Memorial Chapel":"Calvin H. French Chapel","French Memorial Chapel":"Calvin H. French Chapel","Hazzelrig Student Union":"Hazelrigg Student Union","Hazelrigg Student Union":"Hazelrigg Student Union",Kiewit:"Kiewit Building","Scott Theatre":"Scott Studio Theater","Scott Theater":"Scott Studio Theater","Wilson Math and Computer Sci Center":"Wilson Center"},bL=Object.fromEntries(Object.entries(S2).map(([n,e])=>[R_(n),e])),PG=Object.fromEntries(Object.entries(S2).map(([n,e])=>[J5(n),e])),NG="Data/Utilization/classroom_utilization.csv",oI=n=>{const e=[];let t="",i=!1;for(let a=0;a<n.length;a+=1){const c=n[a];if(c==='"'){i&&n[a+1]==='"'?(t+='"',a+=1):i=!i;continue}if(c===","&&!i){e.push(t),t="";continue}t+=c}return e.push(t),e},ay=n=>{const e=String(n??"").replace(/,/g,"").trim();if(!e)return null;const t=Number(e);return Number.isFinite(t)?t:null},ly=n=>{const e=String(n??"").replace(/[%\s]/g,"").replace(/,/g,"").trim();if(!e)return null;const t=Number(e);return Number.isFinite(t)?t:null},RG=n=>{const e=String(n??"").trim().toLowerCase();return e?/^0+\d+$/.test(e)?String(Number(e)):e:""},wL=(n,e)=>`${n}||${RG(e)}`,MG=(n="")=>{const e=n.split(/\r?\n/).filter(Q=>Q.trim().length>0);if(!e.length)return{buildings:{},rooms:{},campus:null};const t=oI(e[0]).map(Q=>Q.trim()),i=t.findIndex(Q=>Q.toLowerCase().includes("building")),a=t.findIndex(Q=>Q.toLowerCase().includes("weekly")),c=t.findIndex(Q=>Q.toLowerCase().includes("enrollment")),_=t.findIndex(Q=>Q.toLowerCase().includes("capacity")),y=t.findIndex(Q=>Q.toLowerCase().includes("time")),s=t.findIndex(Q=>Q.toLowerCase().includes("seat")),T=t.findIndex(Q=>Q.toLowerCase().includes("overall"));if(i<0)return{buildings:{},rooms:{},campus:null};const L={},R={};let U=null,M=null;for(let Q=1;Q<e.length;Q+=1){const ae=oI(e[Q]),ye=(ae[i]??"").trim();if(!ye)continue;if(/^grand total$/i.test(ye)){U={weeklyHours:ay(ae[a]),finalEnrollment:ay(ae[c]),totalCapacity:ay(ae[_]),timeUtilization:ly(ae[y]),seatUtilization:ly(ae[s]),overallUtilization:ly(ae[T])},M=null;continue}const oe=LG(ye)||null,ve=ay(ae[a]),de=ay(ae[c]),Pe=ay(ae[_]),Be=ly(ae[y]),_e=ly(ae[s]),G=ly(ae[T]);if(oe){M=oe,L[oe]={weeklyHours:ve,finalEnrollment:de,totalCapacity:Pe,timeUtilization:Be,seatUtilization:_e,overallUtilization:G};continue}if(!M)continue;const B=wL(M,ye);R[B]={building:M,roomLabel:ye,weeklyHours:ve,finalEnrollment:de,totalCapacity:Pe,timeUtilization:Be,seatUtilization:_e,overallUtilization:G}}return{buildings:L,rooms:R,campus:U}},aI={[mi("Babcock Hall")]:"nw",[mi("Babcock Hall Residence")]:"nw",[mi("Gray Center")]:"sw",[mi("Lloyd Wilson Stadium")]:"nw",[mi("Lloyd Wilson Field/Stadium")]:"nw",[mi("Stone Health Center")]:"nw",[mi("The Stone Health Center")]:"nw",[mi("McCormick Hall")]:"nw",[mi("Jackson Dinsdale Art Center")]:"nw",[mi("Farrell-Fleharty")]:"nw",[mi("Lynn Farrell Arena/Fleharty Educational Center")]:"nw",...Q_(J_,"corner")},lI={[mi("Gray Center")]:0,[mi("McCormick Hall")]:90},uI={[mi("Gray Center")]:"directional",[mi("Lloyd Wilson Stadium")]:"directional",[mi("Lloyd Wilson Field/Stadium")]:"directional",...Q_(J_,"cornerMethod")},cI={[mi("Gray Center")]:["sw","nw"],[mi("Lloyd Wilson Stadium")]:["nw","sw"],[mi("Lloyd Wilson Field/Stadium")]:["nw","sw"],[mi("Stone Health Center")]:["nw","sw"],[mi("The Stone Health Center")]:["nw","sw"],[mi("Jackson Dinsdale Art Center")]:["nw","sw"],[mi("Farrell-Fleharty")]:["nw","sw"],[mi("Lynn Farrell Arena/Fleharty Educational Center")]:["nw","sw"],[mi("Daugherty Student Engagement Center")]:["nw","sw"],[mi("McCormick Hall")]:["nw","sw"],...Q_(J_,"cornerPair")},hI={[mi("Lloyd Wilson Stadium")]:"match",[mi("Lloyd Wilson Field/Stadium")]:"match",[mi("Stone Health Center")]:"legacy",[mi("The Stone Health Center")]:"legacy",...Q_(J_,"pairMode")},fI={[mi("Babcock Hall")]:"none",[mi("Babcock Hall Residence")]:"none",...Q_(J_,"rotationMode")},DG={[mi("Gray Center")]:1.035,[mi("Lloyd Wilson Stadium")]:1,[mi("Lloyd Wilson Field/Stadium")]:1},OG={},dI={"wilson_center/basement":184.5,"wilson_center/level_1":180.5,"daugherty_student_engagement_center/basement":42,"daugherty_student_engagement_center/level_1":42,hurley_mcdonald_hall:180,"mccormick_hall/basement":84.5,"mccormick_hall/level_1":88.5,"mccormick_hall/level_2":88.5,"mccormick_hall/level_3":100,morrison_reeves_science_center:0,morrison_reeves:0,"morrison_reeves/level_1":0,"morrison_reeves/level_2":0},pI={"babcock_hall/level_2":1.12},mI={},gI=new Set(["kiewit/level_2","kiewit_building/level_2","babcock_hall/level_3","taylor_hall","taylor_hall_residence"]),yI=new Set(["calvin_french_chapel/level_2","calvin_h_french_chapel/level_2","calvin_h_french_memorial_chapel/level_2"]),FG=new Set(["bronc_hall/basement","bronc_hall_residence/basement"]),BG=new Set(["calvin_french_chapel/basement","calvin_h_french_chapel/basement","calvin_h_french_memorial_chapel/basement","kiewit/level_2","kiewit_building/level_2"]);function zG(n,e){if(!n)return null;const t=gc(n),i=e?El(e):null;if(i){const c=`${t}/${i}`,_=dI[c];if(Number.isFinite(_))return _}const a=dI[t];return Number.isFinite(a)?a:null}function jG(n,e){if(!n||!e)return null;const t=gc(n),i=El(e),a=`${t}/${i}`,c=pI[a]??pI[t];return Number.isFinite(c)?c:null}function UG(n,e){if(!n||!e)return null;const t=gc(n),i=El(e),a=`${t}/${i}`,c=mI[a]??mI[t];return Number.isFinite(c)?c:null}function VG(n,e){if(!n||!e)return!1;const t=gc(n),i=El(e);return FG.has(`${t}/${i}`)}function qG(n,e){if(!n||!e)return!1;const t=gc(n),i=El(e);return gI.has(`${t}/${i}`)||gI.has(t)}function GG(n,e){if(!n||!e)return!1;const t=gc(n),i=El(e);return yI.has(`${t}/${i}`)||yI.has(t)}function $G(n,e){if(!n||!e)return!1;const t=gc(n),i=El(e);return BG.has(`${t}/${i}`)}const xx=(n,e)=>({...n,...e}),Hs=n=>{const e=String(n??"").trim();if(!e)return"";const t=Rd(e)||e;return gc(t)},bm=n=>String(n||"").trim().toLowerCase().replace(/[^a-z0-9]/g,""),HG=/[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}/i,E2=n=>{const e=String(n||"").trim();if(!e)return[];const t=new Set,i=bm(e);i&&t.add(i);const a=e.match(HG);if(a&&a[0]){const c=bm(a[0]);c&&t.add(c)}return Array.from(t)},_I=n=>{const e=String(n||"").trim();if(!e)return"";const t=bm(e);return t?t.startsWith("room")&&t.length>4?t.slice(4):t:""},xg=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),$y=n=>String(n||"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]+/g," ").trim(),__=n=>n?.building??n?.buildingName??n?.buildingLabel??"",vI=(n=[])=>{const e=new Map;return(g2||[]).forEach(t=>{const i=$y(t);i&&e.set(i,t)}),(n||[]).forEach(t=>{const i=String(t?.department??"").trim(),a=$y(i);a&&e.set(a,i)}),Array.from(e.values())},xI=(n,e=[])=>{const t=$y(n);if(!t)return"";let i="",a=0;return(e||[]).forEach(c=>{const _=$y(c);_&&t.includes(_)&&_.length>a&&(i=c,a=_.length)}),i},bx=n=>String(n||"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]+/g," ").trim(),bI=(n=[])=>{const e=new Map;return(bf||[]).forEach(t=>{const i=String(t?.name||"").trim(),a=bx(i);a&&e.set(a,i)}),(n||[]).forEach(t=>{const i=String(t?.building??t?.buildingName??t?.buildingLabel??"").trim(),a=bx(i);a&&e.set(a,i)}),Array.from(e.values())},wI=(n,e=[])=>{const t=bx(n);if(!t)return"";let i="",a=0;return(e||[]).forEach(c=>{const _=bx(c);_&&t.includes(_)&&_.length>a&&(i=c,a=_.length)}),i},SI=(n=[],e="")=>{const t=$y(e);if(!t)return[];const i=new Set;return(n||[]).forEach(a=>{const c=$y(a?.department??"");if(c&&c===t){const _=__(a);_&&i.add(_)}}),Array.from(i)},Hw=n=>{if(n==null)return[];const e=new Set,t=String(n);t&&e.add(t);const i=Number(t);return Number.isFinite(i)&&e.add(i),Array.from(e)},T2=n=>/^rec[a-z0-9]{6,}$/i.test(String(n||"")),wx=n=>Array.isArray(n)&&n.length>0&&n.every(e=>T2(e)),SL=["Office - Staff","Office - Prof and Admin","Office - Prof & Admin","Office - Prof/Admin","Office - Faculty","Office - Adjunct Faculty","Office - Emeritus Faculty"],WG=SL.map(n=>n.toUpperCase()),EL=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\b(and|&)\b/g," ").replace(/\s+/g," ").trim(),XG=new Set(SL.map(EL).filter(Boolean)),Dv=n=>XG.has(EL(n)),YG=/^[{(]?[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}(?:-[0-9a-f]{2,})?[)}]?$/i,KG=/^[0-9a-f]{24,}$/i,ZG=/[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}(?:-[0-9a-f]{2,})?/i,cm=n=>{const e=String(n||"").trim();return e?!!(YG.test(e)||ZG.test(e)&&e.length>=24||KG.test(e)||e.includes("|")||/^[a-f0-9-]{24,}$/i.test(e)||T2(e)):!1},A2=n=>{const e=[n?.roomNumber,n?.roomLabel,n?.number,n?.Number,n?.RoomNumber,n?.Room];for(const i of e){const a=String(i??"").trim();if(a&&!cm(a))return a}const t=String(n?.roomId??"").trim();return t&&!cm(t)?t:""},JG=(n="")=>{const e=String(n||"").toLowerCase();return!/\bvacan(t|cy)\b/.test(e)||!/\boffice(s)?\b/.test(e)?!1:/\b(list|show|give|display|return|all|which|what)\b/.test(e)},QG=(n="")=>{const e=String(n||"").toLowerCase();return!/\bvacan(t|cy)\b/.test(e)||!/\boffice(s)?\b/.test(e)?!1:/\bhow many\b|\bcount\b|\bnumber of\b/.test(e)},e$=(n="")=>{const e=String(n||"").toLowerCase();return/\bclassroom(s)?\b/.test(e)?/\bhow many\b|\bcount\b|\bnumber of\b/.test(e):!1},t$=n=>{const e=String(n?.occupancyStatus??n?.occupancy??n?.Vacancy??n?.vacancy??"").toLowerCase();return String(n?.occupant??"").trim()||e.includes("occupied")||e.includes("assigned")&&!e.includes("unassigned")?!1:e.includes("vacant")||e.includes("available")},EI=(n=[])=>{const e=new Set,t=[];return(n||[]).forEach(i=>{const a=String(i?.type??i?.roomType??"").trim();if(!a||!a.toLowerCase().includes("office")&&!Dv(a)||!t$(i))return;const _=String(__(i)||"").trim(),y=String(i?.floor??i?.floorName??i?.floorId??"").trim(),s=A2(i),T=bm(i?.roomGuid??i?.revitId??i?.roomId??i?.id??""),L=Number(i?.areaSF??i?.area??i?.sf??0),R=Number.isFinite(L)&&L>0?Math.round(L):"",U=[_,y,s,a,R].join("|").toLowerCase();e.has(U)||(e.add(U),t.push({Building:_||"Unknown","Room Number":s,"Room Type":a,"Square Feet":R,__lookupKey:T,__floor:y}))}),t.sort((i,a)=>String(i.Building||"").localeCompare(String(a.Building||""),void 0,{sensitivity:"base"})||String(i["Room Number"]||"").localeCompare(String(a["Room Number"]||""),void 0,{numeric:!0,sensitivity:"base"})),t},n$=n=>{if(A2(n))return!1;const t=String(n?.roomId??n?.id??"").trim();return String(n?.roomGuid??n?.revitId??n?.revitUniqueId??"").trim()||!t?!0:cm(t)},r$=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),nv=n=>{const e=r$(n);return e?e.includes("classroom")?!0:e.includes("laboratory class")||e.includes("laboratory studio")||e.includes("lab class")||e.includes("lab studio"):!1},Md=n=>{const e=String(n??"").trim();if(!e)return[];const t=new Set,i=El(e);t.add(i);const a=Number(e);return Number.isFinite(a)&&(t.add(`level_${a}`),a===0&&t.add("basement")),Array.from(t)},Pd=(n,e)=>{if(!e?.length)return!0;const t=Md(n);return t.length?t.some(i=>e.includes(i)):!1},rv=(n,e=[])=>{const t=_y(n);if(!t)return"";if(e.includes(t))return t;const i=Md(t);return i.length&&e.find(a=>Pd(a,i))||""};function TL(n=[]){const e=new Map,t=new Map,i=new Map;if(!Array.isArray(n))return{byGuid:e,byComposite:t,byBuildingRoom:i};const a=(c,_,y)=>{if(!_)return;if(!c.has(_)){c.set(_,y);return}c.get(_)!==y&&c.set(_,null)};return n.forEach(c=>{if(!c)return;const _=c.roomGuid??c.revitId??c.revitUniqueId??c["Room GUID"]??c.roomId??"";E2(_).forEach(R=>a(e,R,c));const s=bm(c.roomId??c.roomNumber??c.roomLabel??c.id??""),T=Hs(c.building??c.buildingName??c.buildingLabel??""),L=Hs(c.floor??c.floorName??c.floorId??"");if(s&&T&&L){const R=`${T}|${L}|${s}`;t.has(R)||t.set(R,c)}s&&T&&a(i,`${T}|${s}`,c)}),{byGuid:e,byComposite:t,byBuildingRoom:i}}function i$(n=[],e=[]){if(!Array.isArray(n)||n.length===0)return[];if(!Array.isArray(e)||e.length===0)return n;const t=TL(e);return n.map(i=>{if(!i)return i;const a=i.roomGuid??i.revitId??i.roomId??i.revitUniqueId??"",_=E2(a).reduce((L,R)=>L||t.byGuid.get(R)||null,null);if(!_)return i;const y={...i};!y.roomGuid&&_.roomGuid&&(y.roomGuid=_.roomGuid),!y.roomId&&_.roomId&&(y.roomId=_.roomId);const s=String(y.roomNumber??"").trim(),T=String(y.roomLabel??"").trim();if((!s||cm(s))&&_.roomNumber){const L=String(_.roomNumber).trim();L&&!cm(L)&&(y.roomNumber=L)}if((!T||cm(T))&&_.roomLabel){const L=String(_.roomLabel).trim();L&&!cm(L)&&(y.roomLabel=L)}return!y.building&&_.building&&(y.building=_.building),!y.floor&&_.floor&&(y.floor=_.floor),(!y.type||wx(y.type))&&_.type&&(y.type=_.type),(!y.department||wx(y.department))&&_.department&&(y.department=_.department),(!Number.isFinite(Number(y.areaSF))||Number(y.areaSF)<=0)&&Number.isFinite(Number(_.areaSF))&&Number(_.areaSF)>0&&(y.areaSF=Number(_.areaSF)),y})}function AL(n={},e,t,i){if(!e)return null;let a=null;const c=n.Revit_UniqueId??n.RevitUniqueId??n["Room GUID"]??n.roomGuid??"";if(E2(c).forEach(M=>{a||(a=e.byGuid.get(M)||null)}),!a){const M=bm(n.Number??n.RoomNumber??n.number??n.Room??n.roomNumber??""),Q=Hs(t??n.Building??n.BuildingName??n.buildingId??""),ae=Hs(i??n.Floor??n.floor??"");M&&Q&&ae&&(a=e.byComposite.get(`${Q}|${ae}|${M}`)||null),!a&&M&&Q&&(a=e.byBuildingRoom?.get(`${Q}|${M}`)||null)}if(!a)return null;const y=String(a.occupancyStatus??"").trim(),s=String(a.occupant??"").trim(),T=String(a.type??"").trim(),L=String(a.department??"").trim();if(!y&&!s&&!T&&!L)return null;const R={};y&&(R.occupancyStatus=y,R.OccupancyStatus=y,R["Occupancy Status"]=y),s&&(R.occupant=s,R.Occupant=s),T&&(R.type=T,R.Type=T,R["Room Type"]=T,R["Room Type Description"]=T),L&&(R.department=L,R.Department=L);const U=Number(a.seatCount??a.SeatCount??a["Seat Count"]??0);return Number.isFinite(U)&&U>0&&(R.seatCount=U,R.SeatCount=U,R["Seat Count"]=U),R}const s$=n=>{const e=Number(n?.areaSF??n?.area??n?.sf??0);return Number.isFinite(e)&&e>0},o$=(n,e)=>{if(!n)return null;const t=n?.properties||{},i=J9(t);if(!Number.isFinite(i)||i<=0)return null;const a=(t.occupancyStatus??t["Occupancy Status"]??t.OccupancyStatus??t.vacancy??t.Vacancy??t.Occupancy??t.Status??"").toString().trim(),c=(t.occupant??t.Occupant??t.AssignedTo??t.Assignee??"").toString().trim(),_=String(t.Revit_UniqueId??t.RevitUniqueId??t["Room GUID"]??"").trim(),y=String(t.Number??t.RoomNumber??t.number??t.Room??"").trim(),s=t.Floor??t.Level??t.LevelName??t["Level Name"]??"";return{building:e||"",floor:s,areaSF:i,area:i,sf:i,roomId:y||"",roomNumber:y||"",roomLabel:y||"",roomGuid:_,department:Z9(t),type:y2(t),occupancyStatus:a,occupant:c}},TI=async n=>{const e=n?.floorsByBuilding||{},t=[],i=new Map;return Array.isArray(n?.buildings)?n.buildings.forEach(c=>{c?.id&&i.set(String(c.id),c?.name||c.id)}):n?.buildings&&typeof n.buildings=="object"&&Object.entries(n.buildings).forEach(([c,_])=>{c&&i.set(String(c),_?.name||c)}),Object.entries(e).forEach(([c,_])=>{const y=i.get(String(c))||c;(_||[]).forEach(s=>{const T=typeof s=="string"?s:s?.url;T&&t.push({url:T,buildingLabel:y})})}),t.length?(await rG(t,6,async c=>{const _=await nG(c.url),y=[];return(_||[]).forEach(s=>{const T=o$(s,c.buildingLabel);T&&y.push(T)}),y})).flat():[]},IL=n=>{if(!n)return null;const e=Number(n.areaSF??n.area??n.sf??0);if(!Number.isFinite(e)||e<=0)return null;const t=String(n.department??"").trim(),i=String(n.type??"").trim(),a=String(n.occupancyStatus??"").trim(),c=String(n.occupant??"").trim();return{type:"Feature",properties:{Area_SF:e,Area:e,area:e,"Area (SF)":e,NCES_Department:t,Department:t,department:t,NCES_Type:i,__roomType:i,OccupancyStatus:a,"Occupancy Status":a,occupancyStatus:a,Occupant:c,occupant:c}}};function CL(n,e){if(n){try{n.getLayer(qd)&&n.removeLayer(qd),n.getLayer(vg)&&n.removeLayer(vg),n.getLayer(Vc)&&n.removeLayer(Vc),n.getLayer(kp)&&n.removeLayer(kp),n.getLayer(lf)&&n.removeLayer(lf),n.getLayer(px)&&n.removeLayer(px),n.getLayer(mx)&&n.removeLayer(mx),n.getLayer(lo)&&n.removeLayer(lo),jc(n,Va)&&n.removeSource(Va),n.getLayer(Gy)&&n.removeLayer(Gy),n.getSource(gx)&&n.removeSource(gx),n.getLayer(yx)&&n.removeLayer(yx),n.getSource(HA)&&n.removeSource(HA),n.getLayer(_x)&&n.removeLayer(_x),n.getSource(WA)&&n.removeSource(WA)}catch{}e&&(e.current=null)}}function AI(n){try{const e=jc(n,Va),t=e?._data||e?.serialize?.()?.data,i=Qu(t);if(!i)return;const a=Lc(i);a&&isFinite(a[0])&&n.fitBounds([[a[0],a[1]],[a[2],a[3]]],{padding:40,duration:500})}catch{}}function kL(n){if(!n)return;const i=["case",["==",["get","Element"],"Room"],["concat",["coalesce",["get","Number"],["get","RoomNumber"],["get","name"],["literal","-"]],`
`,["coalesce",["get","__roomType"],["get","RoomType"],["get","Room Type"],["get","Type"],["get","type"],["get","Name"],["literal","-"]],`
`,["coalesce",["get","scenarioDepartment"],["get","department"],["get","Department"],["literal","-"]],`
`,["concat",["to-string",["round",["coalesce",["get","Area_SF"],["get","Area"],0]]]," SF"]],""],a=["interpolate",["linear"],["zoom"],14,0,15,0,16,3,17,5,18,7,19,10];if(n.getLayer(Vc)){try{n.setLayoutProperty(Vc,"text-field",i),n.setLayoutProperty(Vc,"text-size",a),n.setLayoutProperty(Vc,"symbol-placement","point"),n.setLayoutProperty(Vc,"text-allow-overlap",!1),n.setLayoutProperty(Vc,"text-ignore-placement",!1),n.setLayoutProperty(Vc,"text-max-width",6),n.setLayoutProperty(Vc,"visibility","visible"),n.setFilter(Vc,vy)}catch{}Sx(n);return}try{n.addLayer({id:Vc,type:"symbol",source:Va,filter:["all",vy,["!=",["id"],-1]],layout:{"text-field":i,"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":a,"text-line-height":1,"text-variable-anchor":["center"],"text-radial-offset":0,"text-anchor":"center","text-justify":"center","symbol-placement":"point","text-allow-overlap":!1,"text-ignore-placement":!1,"text-max-width":6,visibility:"visible"},paint:{"text-color":"#0b0b0b","text-halo-color":"rgba(255,255,255,0.95)","text-halo-width":1}},lf),Sx(n)}catch{}}function Sx(n){if(n)try{n.getLayer(Vc)&&n.moveLayer(Vc)}catch{}}const a$={5:{label:"5 = Excellent condition",color:"#4CAF50"},4:{label:"4 = Good condition",color:"#8BC34A"},3:{label:"3 = Adequate condition",color:"#FFEB3B"},2:{label:"2 = Poor condition",color:"#FF9800"},1:{label:"1 = Very poor condition",color:"#F44336"}},l$={0:"#85474b",1:"#aed6f1",2:"#5dade2",3:"#2e86c1"},Ym="#85474b",u$=["603 E 9th St","603 E. 9th St","607 E 9th St","MacKay House","McKay House","905 N Elm St","905 N Elm Ave","Name 1","Name1","706 E. 7th St","706 E 7th St","706 E. 7th St. Residence","710 E. 7th St.","710 E 7th St","710 E. 7th St. Residence","714 E. 7th St.","714 E 7th St","714 E. 7th St. Residence","812 N Ash St","812 N Ash Ave","906 E 9th St","Campus Safety","The 1882 Residence Hall","1882 Residence Hall","Hayes M. Fuhr Hall of Music","Hayes M Fuhr Hall of Music"],c$=u$.map(n=>String(n||"").toLowerCase()),h$=["downcase",["to-string",["coalesce",["get","id"],["get","name"]]]],f$=["in",h$,["literal",c$]],vf=(n,e="#d1d5db")=>["case",f$,e,n],d$=n=>Number.isFinite(n)?n>=80?"#22c55e":n>=60?"#84cc16":n>=40?"#facc15":n>=20?"#f97316":"#ef4444":"#e5e7eb",ug={study:{color:"#ef4444",heatValue:1,rgb:"255,56,56",haloRgb:"255,230,210"},hangout:{color:"#fb923c",heatValue:.95,rgb:"255,142,44",haloRgb:"255,234,204"},improve:{color:"#fde047",heatValue:.9,rgb:"255,230,88",haloRgb:"255,247,214"},outdated:{color:"#60a5fa",heatValue:.8,rgb:"82,148,255",haloRgb:"180,220,255"},rarely:{color:"#67e8f9",heatValue:.9,rgb:"78,228,250",haloRgb:"190,246,255"},unsafe:{color:"#1d4ed8",heatValue:1.03,rgb:"30,78,216",haloRgb:"142,181,255"},comment:{color:"#9ca3af",heatValue:0,rgb:"156,163,175",haloRgb:"125,250,255"}},p$={study:"Go-to Study",hangout:"Go-to Hang Out",improve:"Needs Improvement",outdated:"Outdated / Run Down",rarely:"Rarely / Never Use",unsafe:"Do Not Feel Safe",comment:"Comment"},Ww=24,m$=["study","hangout","improve"],g$=["outdated","rarely","unsafe"],Ex=["coalesce",["get","weight"],0],Xw=[">",Ex,0],II=!0,CI=[{category:"rarely",layerId:"engagement-heat-rarely"},{category:"outdated",layerId:"engagement-heat-outdated"},{category:"unsafe",layerId:"engagement-heat-unsafe"},{category:"improve",layerId:"engagement-heat-improve"},{category:"hangout",layerId:"engagement-heat-hangout"},{category:"study",layerId:"engagement-heat-study"}],Tx="engagement-room-sentiment-gradient-source",LL="engagement-room-sentiment-gradient-band-",Ax=10,y$=[.06,.09,.13,.19,.27,.38,.5,.64,.79,.93],q0=n=>{if(n){for(let e=0;e<Ax;e+=1){const t=`${LL}${e}`;try{n.getLayer(t)&&n.removeLayer(t)}catch{}}try{n.getSource(Tx)&&n.removeSource(Tx)}catch{}}},_$=(n,e)=>{const t=Qu(n),i=[],a=t?.features||[];for(const c of a){const _=c?.properties||{};if(lg(_)!=="room")continue;const y=String(c?.geometry?.type||"");if(y!=="Polygon"&&y!=="MultiPolygon")continue;const s=c.id??_.RevitId??_.id;if(s==null)continue;const T=String(s),L=e.get(T);if(!L)continue;let R=.22;try{const U=Lc(c);if(Array.isArray(U)&&U.length===4&&U.every(M=>Number.isFinite(M))){const M=Uf([U[0],U[1]],[U[2],U[1]],{units:"meters"}),Q=Uf([U[0],U[1]],[U[0],U[3]],{units:"meters"}),ae=Math.max(0,Math.min(M,Q));ae>0&&(R=Math.max(.3,ae*.42)/Math.max(1,Ax-1))}}catch{}for(let U=0;U<Ax;U+=1){let M=c;if(U>0){const ie=R*U;try{M=uV(c,-ie,{units:"meters"})}catch{M=null}}const ae=Qu(M)?.features?.[0];if(!ae?.geometry)continue;const ye=String(ae.geometry?.type||"");ye!=="Polygon"&&ye!=="MultiPolygon"||i.push({type:"Feature",properties:{band:U,color:L,roomId:T},geometry:ae.geometry})}}return{type:"FeatureCollection",features:i}},Ix=n=>{const e=String(n||"").trim().toLowerCase();return!e||/just leave a ?comment|leave a comment about this space/.test(e)?"comment":/do not feel safe|unsafe/.test(e)?"unsafe":/rarely|never/.test(e)?"rarely":/outdated|run-down|run down/.test(e)||/furniture.*uncomfortable|layout.*not functional|lighting|temperature|technology.*inadequate|unreliable|privacy/.test(e)?"outdated":/needs improvement|need improvement|more flexible|adaptable|wish this space were more flexible|improv/.test(e)?"improve":/go[- ]to hang ?out|hang ?out/.test(e)?"hangout":/go[- ]to study|study spot|supports my teaching|professional work effectively|supports .*work effectively/.test(e)?"study":"comment"},v$=n=>ug[Ix(n)]?.heatValue??0,x$=n=>ug[Ix(n)]?.color||"#9ca3af",b$=n=>n==="outdated"||n==="rarely"||n==="unsafe",w$=n=>{const e=ug[n]?.rgb||"156,163,175",t=ug[n]?.haloRgb||e;return b$(n)?["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.03,`rgba(${t},0.12)`,.1,`rgba(${t},0.24)`,.2,`rgba(${e},0.58)`,.36,`rgba(${e},0.82)`,.62,`rgba(${e},0.93)`,1,`rgba(${e},0.995)`]:["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.03,"rgba(255,255,255,0.05)",.1,"rgba(255,255,255,0.14)",.22,`rgba(${t},0.26)`,.36,`rgba(${t},0.42)`,.54,`rgba(${e},0.74)`,.76,`rgba(${e},0.93)`,1,`rgba(${e},1.0)`]},S$=()=>["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.06,"rgba(255,237,128,0.20)",.22,"rgba(253,224,71,0.40)",.48,"rgba(251,146,60,0.58)",.72,"rgba(239,68,68,0.70)",1,"rgba(220,38,38,0.82)"],E$=()=>["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.05,"rgba(207,250,254,0.24)",.18,"rgba(125,250,255,0.44)",.42,"rgba(56,189,248,0.62)",.7,"rgba(59,130,246,0.78)",1,"rgba(30,64,175,0.90)"],kI=n=>{const e=["coalesce",["get","weight"],0];return n==="unsafe"?["*",e,1.08]:n==="rarely"?["*",e,.95]:n==="outdated"?["*",e,.88]:n==="improve"?["*",e,.88]:n==="hangout"?["*",e,1.02]:n==="study"?["*",e,1.12]:["*",e,1]},LI=()=>["*",Ex,["match",["coalesce",["get","heatCategory"],""],"study",1.12,"hangout",1,"improve",.74,1]],PI=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,1.02,18,1.14,20,1.24,22,1.32]:["interpolate",["linear"],["zoom"],10,.86,13,.96,15,1.06,17,1.16,19,1.24],NI=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,20,18,30,20,44,22,60]:["interpolate",["linear"],["zoom"],10,34,12,52,14,74,16,98,18,124,20,152],RI=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,.84,18,.89,20,.94,22,.97]:["interpolate",["linear"],["zoom"],10,.68,13,.72,16,.76,19,.8],MI=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,1.04,18,1.14,20,1.24,22,1.32]:["interpolate",["linear"],["zoom"],10,.9,13,1,15,1.1,17,1.18,19,1.26],DI=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,18,18,28,20,40,22,54]:["interpolate",["linear"],["zoom"],10,28,12,42,14,58,16,78,18,98,20,120],OI=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,.82,18,.88,20,.94,22,.97]:["interpolate",["linear"],["zoom"],10,.62,13,.68,16,.74,19,.8],FI=(n,e=!1)=>e?n==="unsafe"?["interpolate",["linear"],["zoom"],16,7,18,11,20,16,22,22]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],16,8,18,12,20,18,22,24]:n==="improve"?["interpolate",["linear"],["zoom"],16,11,18,16,20,22,22,30]:["interpolate",["linear"],["zoom"],16,11,18,18,20,24,22,34]:n==="unsafe"?["interpolate",["linear"],["zoom"],10,13,12,18,14,26,16,36,18,46,20,56]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],10,14,12,22,14,30,16,40,18,52,20,64]:n==="improve"?["interpolate",["linear"],["zoom"],10,18,12,28,14,40,16,54,18,70,20,86]:["interpolate",["linear"],["zoom"],10,20,12,30,14,44,16,58,18,76,20,94],BI=(n,e=!1)=>e?n==="unsafe"?["interpolate",["linear"],["zoom"],16,1.24,18,1.34,20,1.44,22,1.56]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],16,1.16,18,1.26,20,1.36,22,1.48]:["interpolate",["linear"],["zoom"],16,1.14,18,1.24,20,1.34,22,1.46]:n==="unsafe"?["interpolate",["linear"],["zoom"],10,1.12,13,1.22,15,1.32,17,1.44,19,1.54]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],10,1,13,1.1,15,1.2,17,1.3,19,1.38]:["interpolate",["linear"],["zoom"],10,.98,13,1.08,15,1.18,17,1.3,19,1.4],zI=(n,e=!1)=>e?n==="unsafe"?["interpolate",["linear"],["zoom"],16,1,18,1,20,1,22,1]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],16,.94,18,.97,20,.99,22,1]:["interpolate",["linear"],["zoom"],16,.97,18,.99,20,1,22,1]:n==="unsafe"?["interpolate",["linear"],["zoom"],10,.88,13,.92,16,.95,19,.97]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],10,.78,13,.83,16,.89,19,.93]:["interpolate",["linear"],["zoom"],10,.85,13,.89,16,.93,19,.96],Yw=(n,e,t)=>{try{if(!n?.getLayer(e))return;n.setLayoutProperty(e,"visibility",t?"visible":"none")}catch{}},PL=({config:n,universityId:e,mode:t="public",persona:i,engagementMode:a=!1})=>{const c=Ks(null),_=Ks(null),y=Ks(null),s=Ks(null),T=Ks({}),L=Ks(null),R=Ks(null),U=Ks(null),[M,Q]=rr(!1),[ae,ye]=rr("select"),[ie,oe]=rr(t==="admin"),[ve,de]=rr([]),[Pe,Be]=rr({}),[_e,G]=rr({}),[B,Y]=rr(null),[$,J]=rr(bf[0]?.name||""),Se=n?.universityName||n?.name||""||e||"Campus",De={SPACE_DATA:"space-data",ASSESSMENT:"assessment",TECHNICAL:"technical"},$e=a?De.ASSESSMENT:De.SPACE_DATA,[Ue,Le]=rr($e),[He,Ke]=rr(!!a),[Ce,ge]=rr(()=>{if(typeof window>"u")return!1;try{const q=new URLSearchParams(window.location.search||""),be=String(q.get("presentation")||"").trim().toLowerCase();return be==="1"||be==="true"||be==="yes"}catch{return!1}}),[We,Ve]=rr(!1),ut=[{value:De.SPACE_DATA,label:"Space Data"},{value:De.ASSESSMENT,label:"Assessment Progress"},{value:De.TECHNICAL,label:"Technical"}],pt=t==="admin"?ut:ut.filter(q=>q.value===De.SPACE_DATA),[It,Oe]=rr(!0),[Wt,Zt]=rr(!1),[Xt,Ze]=rr(!0),[zn,on]=rr(!1),[mt,Ir]=rr(""),[Fr,qr]=rr("");Oi(()=>{if(!(!zn||mt))try{const q=String(window.localStorage?.getItem("MAPBOX_PUBLIC_TOKEN")??"").trim();q&&Ir(q)}catch{}},[zn,mt]),Oi(()=>{const q=_.current;if(!q)return()=>{};const be=()=>{q.querySelectorAll('.mapboxgl-popup-close-button[aria-hidden="true"]').forEach(ct=>ct.removeAttribute("aria-hidden"))};be();const Me=new MutationObserver(be);return Me.observe(q,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["aria-hidden"]}),()=>Me.disconnect()},[]);const[$t,xr]=rr(!0),dr=Ml(()=>xq(_q),[]),ni=Ml(()=>Array.from(new Set([...Object.keys(p2),...g2])).sort(),[]),[nn,yn]=rr(null),[sr,Zn]=rr(null),[$r,qn]=rr(null),[jr,ir]=rr(null),[Xn,Bi]=rr("building"),[bi,wr]=rr(null),[or,ui]=rr({}),[Kr,wi]=rr(0),[si,vt]=rr([]),[Ne,ze]=rr(new Map),[ft,wt]=rr(null),Ut=Ks([]),[Gt,Tt]=rr(null),[Ot,zt]=rr(""),Pn=Ks(null),Jn=Ks(!1),Fn=Ks(""),[Gr,Mr]=rr(null),[Zr,Br]=rr(""),zi=Ks(null),ms=Ks(!1),Os=Ks(""),cs=Ks(null),[ps,vo]=rr(dr),[is,xo]=rr(ni),[ua,tl]=rr(new Set),[Pa,di]=rr("__all__"),[ou,yc]=rr(""),[Ss,au]=rr("rooms"),[ga,uo]=rr(!1),[nl,Kl]=rr(""),[ea,Wo]=rr(!1),[ta,En]=rr(!1),[co,Io]=rr(""),[Ni,ic]=rr(null),[rl,il]=rr(!1),[Ga,ho]=rr(!1),[lr,Wr]=rr(""),[Ur,ca]=rr(null),[$a,Ri]=rr(!1),[Hi,Tl]=rr(!1),[Wi,ko]=rr(""),[ss,$u]=rr(null),[lu,mu]=rr(!1),[Us,Ha]=rr(!1),[sl,Vo]=rr(""),[Ei,bo]=rr(null),[gi,wo]=rr(!1),[Vs,Nc]=rr(""),[Pu,Fs]=rr(!1),[na,Es]=rr(""),[xs,Ts]=rr(null),[Ol,ha]=rr(!0),[ra,os]=rr(!1),[gu,ro]=rr(!1),[ya,ol]=rr(""),[Al,Nu]=rr(!1),[Na,qo]=rr(""),[ji,qs]=rr(null),[Lo,_a]=rr(null),[zo,ml]=rr("Campus Summary"),[Po,fa]=rr(!1),[va,ee]=rr(null),[je,At]=rr([]),[kt,sn]=rr([]),[fn,Qn]=rr(!1),[Xr,Qr]=rr(!1),[oi,Ui]=rr(""),[Ps,Bs]=rr(null),[fo,Ys]=rr({buildings:{},rooms:{},campus:null}),[Zs,go]=rr(!1),Ns=Ks(null),io=Ks(null),zs=Ml(()=>TL(je.length?je:kt),[je,kt]),Fl=Ml(()=>fo?.buildings||{},[fo]),gl=Ml(()=>fo?.rooms||{},[fo]),O=fo?.campus||null,me=Ml(()=>{const q={};return Object.entries(Fl||{}).forEach(([be,Me])=>{if(!be)return;q[be]=Me;const Qe=xL[be];Qe&&(q[Qe]=Me)}),q},[Fl]),ke=vr(q=>{if(!q)return null;const be=Rd(q)||q;return Fl[be]||null},[Fl]),nt=vr((q,be)=>{if(!q||!be)return null;const Me=Rd(q)||q,Qe=wL(Me,be);return gl[Qe]||null},[gl]),[hn,Cn]=rr(null),[Sr,Rs]=rr(!1),[so,hs]=rr("unknown"),es=so==="down",Js=so==="ok",da=so==="unknown",oo=Ml(()=>({DEPARTMENT:"department",TYPE:"type",OCCUPANCY:"occupancy",VACANCY:"vacancy",PLAIN:"plain"}),[]),[Vi,Zl]=rr("department"),[xa,Rc]=rr(!1),[Ru,yu]=rr(!1),[Wa,al]=rr("solid"),Hu=(q,be)=>{const Me=new Set(q);return(be||[]).forEach(Qe=>{Qe&&Me.add(Qe)}),Array.from(Me).sort()},yo=vr(q=>{const be=y.current;if(!be||!be.getLayer(qd))return;const Me=Array.isArray(q)?q.filter(ct=>ct!=null):q!=null?[q]:[];Ut.current=Me;const Qe=Me.length?["any",["in",["id"],["literal",Me]],["in",["get","RevitId"],["literal",Me]]]:["==",["id"],""];try{be.setFilter(qd,Qe),be.getLayer(vg)&&be.setFilter(vg,Qe)}catch{}},[]),[ia,ll]=rr(new Map),[Bl,No]=rr(!1),[po,Ra]=rr(null),[sa,sc]=rr([]),[_u,zl]=rr(null),ul=Ks([]),Jl=vr((q=[])=>(q||[]).map(be=>be?.highlightId??be?.revitId??be?.roomId??null).filter(be=>be!=null),[]),jo=vr((q=[])=>{const be=Jl(q);yo(be.length?be:null)},[Jl,yo]),oa=vr(()=>{ul.current=[],sc([]),jo([])},[jo]),E=vr(q=>{const be=y.current,Me=jc(be,Va);if(!Me)return;const Qe=Me._data||Me.serialize?.()?.data||null,ct=Qu(Qe);if(!ct?.features?.length)return;const Xe=new Map,ot=new Map,Lt=Ct=>{if(Number.isFinite(Ct))return Ct;const en=Number(Ct);return Number.isFinite(en)?en:String(Ct)};ct.features.forEach(Ct=>{const en=Ct.properties||{},xn=Od(en);if(!Number.isFinite(xn)||xn<=0)return;const Gn=en.__roomType??en.NCES_Type??en.RoomType??en["Room Type"]??en.Type??en.type??en.Name??"",dn=Dv(Gn);let ln="",Tn="#e6e6e6";const kr=(Lr={})=>{const _i=Lr.occupancyStatus??Lr["Occupancy Status"]??Lr.OccupancyStatus??Lr.Occupancy??Lr.Vacancy??Lr.vacancy??Lr.Vacant??"",xi=String(_i??"").trim();if(xi){const Qi=xi.toUpperCase();return Qi.includes("VACANT")||Qi.includes("UNOCCUPIED")||Qi.includes("AVAILABLE")||Qi.includes("UNASSIGNED")?"Vacant":Qi.includes("OCCUPIED")?"Occupied":"Unknown"}return(Lr.occupant??Lr.Occupant??"").toString().trim()?"Occupied":"Unknown"};if(q===oo.TYPE)ln=(en.__roomType||"").toString().trim()||"Unknown",Tn=G5(ln);else if(q===oo.OCCUPANCY){if(!dn)return;ln=kr(en),Tn=ln==="Occupied"?"#29b6f6":ln==="Vacant"?"#ff7043":"#cfd8dc"}else if(q===oo.VACANCY){if(!dn)return;ln=kr(en),Tn=ln==="Vacant"?"#ff7043":"#cfd8dc"}else ln=h_(en)||"Unspecified",Tn=cd(ln)||"#e6e6e6";const ti=Xe.get(ln)||{name:ln,areaSf:0,color:Tn};ti.areaSf+=xn,ti.color=Tn,Xe.set(ln,ti);const cr=Lt(Ct.id??en.RevitId??en.id);if(cr!=null){const Lr=ot.get(ln)||[];Lr.push(cr),ot.set(ln,Lr)}});const Ht=Array.from(Xe.values()).map(Ct=>({...Ct,ids:ot.get(Ct.name)||[]})).sort((Ct,en)=>(en.areaSf||0)-(Ct.areaSf||0));vt(Ht),ze(new Map(Ht.map(Ct=>[Ct.name,Ct.ids||[]])))},[oo.OCCUPANCY,oo.TYPE,oo.VACANCY]),f=vr(q=>{const be=y.current;if(!be||!be.getLayer(lo))return;const Me=jc(be,Va),Qe=Me&&(Me._data||Me.serialize?.().data)||null,ct=Qu(Qe),Xe=q===oo.VACANCY?oo.OCCUPANCY:q,ot=a?oo.PLAIN:Xe;if(!(a&&xa)){if(ot===oo.PLAIN)try{be.setPaintProperty(lo,"fill-color","#f3f4f6"),be.setPaintProperty(lo,"fill-opacity",.86),vt([]),ze(new Map),wt(null);return}catch{}if(ot===oo.DEPARTMENT&&ct?.features?.length){const Lt=new Map,Ht=new Map,Ct=new Map,en=dn=>{if(Number.isFinite(dn))return dn;const ln=Number(dn);return Number.isFinite(ln)?ln:dn!=null?String(dn):null};ct.features.forEach(dn=>{const ln=dn.properties||{},Tn=h_(ln)||"Unspecified",kr=cd(Tn)||"#e6e6e6";Lt.set(Tn,kr);const ti=Od(ln);if(Number.isFinite(ti)&&ti>0){const Lr=Ht.get(Tn)||0;Ht.set(Tn,Lr+ti)}const cr=en(dn.id??ln.RevitId??ln.id);if(cr!=null){const Lr=Ct.get(Tn)||[];Lr.push(cr),Ct.set(Tn,Lr)}});const xn=[];Lt.forEach((dn,ln)=>{xn.push(ln,dn)});const Gn=["match",["coalesce",["feature-state","department"],["get","department"],["get","Department"],["get","Dept"],["get","NCES_Department"],["get","NCES_Dept"]],...xn,"#e6e6e6"];try{be.setPaintProperty(lo,"fill-color",Gn),be.setPaintProperty(lo,"fill-opacity",1);const dn=Array.from(Lt.entries()).map(([ln,Tn])=>({name:ln,color:Tn,areaSf:Ht.get(ln)||0,ids:Ct.get(ln)||[]})).sort((ln,Tn)=>(Tn.areaSf||0)-(ln.areaSf||0));vt(dn),ze(new Map(dn.map(ln=>[ln.name,ln.ids||[]])));return}catch{}}if(ot===oo.TYPE&&ct?.features?.length){const Lt=new Map,Ht=new Map,Ct=new Map,en=ln=>{if(Number.isFinite(ln))return ln;const Tn=Number(ln);return Number.isFinite(Tn)?Tn:ln!=null?String(ln):null};ct.features.forEach(ln=>{const Tn=ln.properties||{},kr=(Tn.__roomType||"").toString().trim()||"Unknown",ti=G5(kr);Lt.set(kr,ti);const cr=Od(Tn);if(Number.isFinite(cr)&&cr>0){const _i=Ht.get(kr)||0;Ht.set(kr,_i+cr)}const Lr=en(ln.id??Tn.RevitId??Tn.id);if(Lr!=null){const _i=Ct.get(kr)||[];_i.push(Lr),Ct.set(kr,_i)}});const xn=[];Lt.forEach((ln,Tn)=>{xn.push(Tn,ln)});const dn=["match",["case",["any",["!",["has","__roomType"]],["==",["get","__roomType"],""]],"Unknown",["get","__roomType"]],...xn,"#e6e6e6"];try{be.setPaintProperty(lo,"fill-color",dn),be.setPaintProperty(lo,"fill-opacity",1);const ln=Array.from(Lt.entries()).map(([Tn,kr])=>({name:Tn,color:kr,areaSf:Ht.get(Tn)||0,ids:Ct.get(Tn)||[]})).sort((Tn,kr)=>(kr.areaSf||0)-(Tn.areaSf||0));vt(ln),ze(new Map(ln.map(Tn=>[Tn.name,Tn.ids||[]])));return}catch{}}X5(be,ot),E(ot),Zl(ot)}},[oo.OCCUPANCY,oo.PLAIN,oo.TYPE,oo.VACANCY,X5,E,a,xa]);Oi(()=>{ul.current=sa},[sa]);const d=vr(()=>{No(!1),Ra(null),oa(),yo(null),tl(new Set),zl(null)},[oa,yo]);Oi(()=>{a&&(No(!1),Ra(null),tl(new Set),zl(null),oa(),yo(null))},[a,oa,yo]);const S=po?.targets?.length?po.targets:po?[po]:[],he={...(S[0]||null)?.feature?.properties||{},...po?.properties||{}},Ae=["Occupied","Vacant","Unknown"],Ye=(q={})=>q.occupancyStatus??q["Occupancy Status"]??q.OccupancyStatus??q.Occupancy??q.occupancy??"",bt=(q={})=>q.seatCount??q.SeatCount??q["Seat Count"]??q.Seats??q.Capacity??q.rm_seats??q.SeatingCapacity??q["NCES_Seat Count"]??q.NCES_Seat_Count??q["NCES_Seat Count"]??q.NCES_SeatCount??"",an=(q=[])=>{const be=Array.from(new Set((q||[]).map(Me=>(Me??"").toString().trim()).filter(Boolean)));return be.length?be.length===1?be[0]:"__MIXED__":""},mn=S.length>1,Kn=po?.properties?.occupancyStatus,Pr=Kn!=null?String(Kn).trim():"",Yr=Pr.length>0,yi=mn?Yr?Pr:an(S.map(q=>{const be={...q?.feature?.properties||{},...q?.properties||{}};return Ye(be)})):Pr||String(Ye(he)||"").trim(),Ms=po?.properties?.seatCount,Xi=Ms!=null?String(Ms).trim():"",Ds=mn?Xi||an(S.map(q=>{const be={...q?.feature?.properties||{},...q?.properties||{}};return bt(be)})):Xi||String(bt(he)||"").trim(),As=S.length>0&&S.every(q=>{const be={...q?.feature?.properties||{},...q?.properties||{},...po?.properties||{}},Me=wf(be)||be.type||be["Room Type"]||be["Room Type Description"]||"";return Dv(Me)}),Xo=S.length>0&&S.every(q=>{const be={...q?.feature?.properties||{},...q?.properties||{},...po?.properties||{}},Me=wf(be)||be.type||be["Room Type"]||be["Room Type Description"]||"";return nv(Me)});Xd(he,["NCES_Category","NCES Category","NCES_Category_Code","NCES Category Code"]),Xd(he,["NCES_Type","NCES Type","NCES_Type_Code","NCES Type Code"]),Xd(he,["NCES_Type Description_Sh","NCES_Type Description","NCES Type Description","NCES_Type Description_Short"]);const cl=Ks(null),Ma=Ks(null),Go=Ks(null),_c=Ks(null),ri=Ks({url:null,key:null,buildingId:null,floorId:null}),gs=Ks(null),oc=Ks({}),Xa=Ks({}),Ya=Ks(new Map),ba=Ks(new Map);Ks({});const jl=Ks(""),Wu=Ks(null),Ka=Ks(null);Ks({});const[kh,ac]=rr(()=>a?"campus":"floor"),[Dr,Is]=rr("LEVEL_1"),[Ql,vc]=rr([]),Mu=Ks(new Map),xc=Ks(new Map),bc=Ml(()=>{const q=n?.buildings?.features||[],be=q.find(Qe=>String(Qe?.properties?.id)===String(B));return be||q.find(Qe=>(Qe?.properties?.name||"")===($||""))||null},[n,B,$]),jn=bc?.properties?.name||$||B||"Building",pa=Dr??(Ql?.[0]||""),Co=a&&kh==="floor",uu=vr(q=>q?Mu.current.get(q)??[]:[],[]),hl=vr(q=>{if(!q)return null;const be=Rd(q);return be&&um[be]?um[be]:_L.has(q)?q:null},[]),Ji=vr((q,be)=>{const Me=_y(be);if(!q||!Me)return null;const Qe=hl(q);if(!Qe||!uu(Qe).includes(Me))return null;const ot=xc.current.get(Qe)?.get(Me);if(ot)return/^https?:\/\//i.test(ot)?ot:ud(ot);const Lt=encodeURIComponent(H5),Ht=encodeURIComponent(Qe),Ct=encodeURIComponent(Me);return ud(`floorplans/${Lt}/${Ht}/Rooms/${Ct}_Dept_Rooms.geojson`)},[uu,hl]),Za=vr(async q=>{const be=hl(q);if(!be)return[];const Me=uu(be),Qe=xc.current.has(be);if(Me.length&&Qe)return Me;const ct=await $A(be),Xe=(ct||[]).map(Lt=>_y(Lt?.id)).filter(Boolean),ot=new Map((ct||[]).filter(Lt=>Lt?.id&&Lt?.url).map(Lt=>[Lt.id,Lt.url]));return Mu.current.set(be,Xe),xc.current.set(be,ot),Xe},[hl,uu]),[qh,Lh]=rr([]),[Si,Mc]=rr(!1);Ks([]);const Gh=Ks(null),Da=Ml(()=>Ji($,Dr),[$,Dr,Ji]);Oi(()=>{Gh.current=Da},[Da]),Oi(()=>{Pn.current=Gt,Jn.current=!!Gt},[Gt]),Oi(()=>{zi.current=Gr,ms.current=!!Gr},[Gr]),Oi(()=>{if(!M||!y.current)return;const be=y.current.getCanvas();if(be){if(Gt){Fn.current=be.style.cursor||"",be.style.cursor="crosshair";return}Gr||(be.style.cursor=Fn.current||"")}},[M,Gt]),Oi(()=>{if(!M||!y.current)return;const be=y.current.getCanvas();if(be){if(Gr){Os.current=be.style.cursor||"",be.style.cursor=Gr==="move"?"move":"grab";return}Gt||(be.style.cursor=Os.current||"")}},[M,Gr,Gt]),Oi(()=>{!M||!Da||f(Vi)},[M,Da,Vi,f]),Oi(()=>{!M||!Da||E(Vi)},[M,Da,Vi,E]),Oi(()=>{wt(null),yo(null)},[Vi,Da,yo]),Oi(()=>{oa()},[B,Da,oa]),Oi(()=>{Wo(!1),En(!1),ic(null),Io(""),il(!1),ho(!1),ca(null),Wr(""),wo(!1),Fs(!1),Ts(null),Es("")},[B,$,Dr]),Oi(()=>{Gt&&(Tt(null),zt(""))},[B,$,Dr]),Oi(()=>{Gr&&(Mr(null),Br(""))},[B,$,Dr]);const[Ul,$h]=rr(!1),[lc,Hc]=rr(new Set),[Af,Il]=rr({}),[as,Ja]=rr(""),[Cl,wc]=rr(""),[Cs,cu]=rr({totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}}),Hh=Ml(()=>{const q=new Set([...Object.keys(Cs.roomTypes||{}),...Object.keys(Cs.sfByRoomType||{})]);return Array.from(q).map(be=>({type:be,count:Cs.roomTypes?.[be]??0,sf:Cs.sfByRoomType?.[be]??0}))},[Cs]),[_d,Vl]=rr(!1),yl=Ks(new Map),Xu=Ks(new Set),[cf,Ph]=rr(20),[kl,Du]=rr(null),So=Ks(null),fs=Ks(null),Ou="scenario-highlight",ql="rgba(255, 159, 64, 0.9)",vu="#ff9f40",uh=vr(()=>{const q=y.current;if(q&&q.getLayer(Ou))try{q.removeLayer(Ou)}catch{}},[]),_l=vr((q=[])=>{if(!q.length)return;const be=y.current;if(!be)return;const Me=jc(be,Va);if(!Me)return;const Qe=Me._data||Me.serialize?.()?.data,ct=Qu(Qe);if(!ct?.features?.length)return;const Xe=new Map;if(q.forEach(({revitId:Ct,dept:en})=>{Ct!=null&&Xe.set(String(Ct),en??null)}),!Xe.size)return;let ot=!1;const Lt=ct.features.map(Ct=>{const en=Ct.id??Ct.properties?.RevitId;if(en==null)return Ct;const xn=String(en);if(!Xe.has(xn))return Ct;const Gn=Xe.get(xn),dn={...Ct.properties||{}},ln=Ct.properties?.scenarioDepartment??null;Gn?dn.scenarioDepartment=Gn:delete dn.scenarioDepartment;const Tn=dn.scenarioDepartment??null;return ln===Tn?Ct:(ot=!0,{...Ct,properties:dn})});if(!ot)return;const Ht={...ct,features:Lt};try{Me.setData(Ht)}catch{}ri.current&&(ri.current={...ri.current||{},fc:Ht})},[]),vl=vr((q=[],be=yl.current)=>{const Me=y.current;Me&&jc(Me,Va)&&q.forEach(Qe=>{const ct=be.get(Qe);if(ct?.revitId)try{Hw(ct.revitId).forEach(ot=>{Me.removeFeatureState({source:Va,id:ot},"scenarioColor"),Me.removeFeatureState({source:Va,id:ot},"scenarioOutlineColor"),Me.removeFeatureState({source:Va,id:ot},"scenarioDepartment")})}catch{}})},[]),hf=vr(()=>{const be=Array.from(yl.current.values()).filter(Me=>Me?.revitId!=null).map(Me=>({revitId:Me.revitId,dept:null}));vl(Array.from(Xu.current),yl.current),be.length&&_l(be),yl.current=new Map,Xu.current=new Set,Hc(new Set),Il({}),cu({totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}}),Ja(""),wc(""),Vl(!1),Du(null),Ph(20),os(!1),uh()},[vl,uh,_l]),Fu=vr(()=>{hf()},[hf]),xu=vr(()=>{const q=y.current;if(!(!q||!jc(q,Va))&&!q.getLayer(Ou))try{q.addLayer({id:Ou,type:"fill",source:Va,paint:{"fill-color":["coalesce",["feature-state","scenarioColor"],ql],"fill-outline-color":["coalesce",["feature-state","scenarioOutlineColor"],vu],"fill-opacity":1},filter:["==",["get","id"],""]}),q.getLayer(lf)&&q.moveLayer(Ou,lf),Sx(q)}catch{}},[]),hu=vr(q=>{xu();const be=y.current;if(!be||!be.getLayer(Ou))return;const Me=Array.isArray(q)?q.flatMap(Xe=>Hw(Xe)):[],Qe=Array.from(new Set(Me)),ct=Qe.length?["any",["in",["id"],["literal",Qe]],["in",["get","RevitId"],["literal",Qe]],["in",["get","Revit_UniqueId"],["literal",Qe]],["in",["get","Revit Unique Id"],["literal",Qe]],["in",["get","Room GUID"],["literal",Qe]]]:["==",["id"],""];try{be.setFilter(Ou,ct)}catch{}},[xu]),ch=vr(q=>{const be={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}},Me=[],Qe=yl.current;return q.forEach(ct=>{const Xe=Qe.get(ct);if(!Xe)return;const ot=Number.isFinite(Number(Xe.area))?Number(Xe.area):0,Lt=qa(Xe.roomType??Xe.type??"Unknown")||"Unknown";be.rooms+=1,be.totalSF+=ot,be.roomTypes[Lt]=(be.roomTypes[Lt]||0)+1,be.sfByRoomType[Lt]=(be.sfByRoomType[Lt]||0)+ot,Xe.revitId!=null&&Me.push(Xe.revitId),Xe.roomGuid&&Xe.roomGuid!==Xe.revitId&&Me.push(Xe.roomGuid)}),{totals:be,highlightIds:Me}},[]),Cr=vr((q,be)=>{const Me=q?.buildingLabel&&(q?.floorName||q?.floorId)&&q?.revitId!=null?ld(q.buildingLabel,q.floorName||q.floorId,q.revitId):null,Qe=q?.roomId||Me||q?.id||[q?.buildingLabel,q?.floorName||q?.floorId,q?.roomLabel,be].filter(Boolean).join("|")||`cand-${be}`,ct=q?.roomGuid??q?.revitUniqueId??q?.revitUniqueID??null,Xe=q?.revitId??ct??null;return{roomId:Qe,buildingId:q?.buildingLabel||"",buildingName:q?.buildingLabel||"",floorName:q?.floorName||q?.floorId||"",revitId:Xe,roomGuid:ct,roomNumber:q?.roomLabel||"",roomType:q?.type||"Unspecified",department:q?.department||"",area:Number(q?.sf||0)||0}},[]),hh=vr(q=>{Il(be=>{const Me={};return q.forEach(Qe=>{be[Qe]&&(Me[Qe]=be[Qe])}),Me})},[]),D=vr(q=>{const{totals:be,highlightIds:Me}=ch(q),Qe=Xu.current,ct=Array.from(Qe).filter(Xe=>!q.has(Xe));ct.length&&vl(ct,yl.current),Xu.current=new Set(q),cu(be),Vl(q.size>0),hu(Me),hh(q)},[ch,hu,vl,hh]),H=vr((q=[])=>{const be=Xu.current;be?.size&&vl(Array.from(be),yl.current),yl.current=new Map,Xu.current=new Set;const Me=new Set;(q||[]).forEach((Qe,ct)=>{const Xe=Cr(Qe,ct);Xe?.roomId&&(yl.current.set(Xe.roomId,Xe),Me.add(Xe.roomId))}),Hc(Me),D(Me)},[Cr,vl,D]),ue=vr(q=>{q?.roomId&&Hc(be=>{const Me=new Set(be);return Me.has(q.roomId)?Me.delete(q.roomId):(Me.add(q.roomId),yl.current.set(q.roomId,q)),D(Me),Me})},[D]),pe=vr((q,be=.35)=>W9(q,be),[]),Ge=vr((q,be={})=>{const Me=yl.current.get(q);if(!Me?.revitId)return;const Qe=y.current;if(!Qe||!jc(Qe,Va))return;const ct={...be};if(Object.keys(ct).length)try{Hw(Me.revitId).forEach(ot=>{Qe.setFeatureState({source:Va,id:ot},ct)})}catch{}},[]),tt=vr(()=>{if(!as||lc.size===0)return;const q=cd(as)||vu,be=pe(q,.9);Il(Qe=>{const ct={...Qe};return lc.forEach(Xe=>{ct[Xe]=as,Ge(Xe,{scenarioColor:be,scenarioOutlineColor:q,scenarioDepartment:as})}),ct});const Me=[];lc.forEach(Qe=>{const ct=yl.current.get(Qe);ct?.revitId!=null&&Me.push({revitId:ct.revitId,dept:as})}),Me.length&&_l(Me)},[as,lc,Ge,pe,_l]),it=vr(async()=>{if(!Ei){alert("No scenario comparison available yet.");return}try{const q=new $i("p","pt","letter"),be=q.internal.pageSize.getWidth(),Me=q.internal.pageSize.getHeight(),Qe=36,ct=be-Qe*2,Xe=14;let ot=Qe;const Lt=(li=Xe)=>{ot+li>Me-Qe&&(q.addPage(),ot=Qe)},Ht=(li,Hr={})=>{const qi=Hr.indent||0;Lt(Xe),q.text(String(li),Qe+qi,ot),ot+=Xe},Ct=(li,Hr={})=>{const qi=Hr.indent||0,Yn=Math.max(50,ct-qi);q.splitTextToSize(String(li),Yn).forEach(Dn=>Ht(Dn,{indent:qi}))},en=li=>{li&&(Lt(Xe*1.2),q.setFont(void 0,"bold"),q.setFontSize(12),Ct(li),q.setFont(void 0,"normal"),q.setFontSize(11))},xn=(li=[])=>{const Hr=Array.isArray(li)?li:[];Hr.length&&Hr.forEach(qi=>Ct(`- ${qi}`,{indent:8}))},Gn=(li={})=>{let Hr=0,qi=0,Yn=0;for(const[_n,Dn]of Object.entries(li||{})){const ur=String(_n||"").toLowerCase(),yr=Number(Dn||0)||0;ur.includes("office")?Hr+=yr:ur.includes("class")?qi+=yr:ur.includes("lab")&&(Yn+=yr)}return{offices:Hr,classrooms:qi,labs:Yn}},dn=Ei?.scenarioDept||as||"Scenario",ln=hn?.__label||"baseline",Tn=jn||$||B||"scenario",kr=Dr?` (${Dr})`:"";q.setFontSize(16),q.setFont(void 0,"bold"),Ht("Scenario Comparison"),q.setFont(void 0,"normal"),q.setFontSize(11),Ct(`${dn} - ${ln} to ${Tn}${kr}`),Ei.summary&&(en("Summary"),Ct(Ei.summary)),en("Totals");const ti=hn||{},cr=Cs||{},Lr=Gn(ti.roomTypes),_i=Gn(cr.roomTypes);Ht(`Baseline (${ln})`),Ht(`Total SF: ${Math.round(ti.totalSF||0).toLocaleString()}`,{indent:8}),Ht(`Rooms: ${Math.round(ti.rooms||0).toLocaleString()}`,{indent:8}),(Lr.offices||Lr.classrooms||Lr.labs)&&(Ht(`Offices: ${Lr.offices}`,{indent:8}),Ht(`Classrooms: ${Lr.classrooms}`,{indent:8}),Ht(`Labs: ${Lr.labs}`,{indent:8})),ot+=Xe/2,Ht(`Scenario (${Tn})`),Ht(`Total SF: ${Math.round(cr.totalSF||0).toLocaleString()}`,{indent:8}),Ht(`Rooms: ${Math.round(cr.rooms||0).toLocaleString()}`,{indent:8}),(_i.offices||_i.classrooms||_i.labs)&&(Ht(`Offices: ${_i.offices}`,{indent:8}),Ht(`Classrooms: ${_i.classrooms}`,{indent:8}),Ht(`Labs: ${_i.labs}`,{indent:8}));const xi=(cr.totalSF||0)-(ti.totalSF||0),ci=(cr.rooms||0)-(ti.rooms||0);Ht(`Delta SF: ${Math.round(xi).toLocaleString()}`,{indent:8}),Ht(`Delta Rooms: ${Math.round(ci).toLocaleString()}`,{indent:8}),Ei?.scenarioPros?.length&&(en("Pluses"),xn(Ei.scenarioPros)),Ei?.scenarioCons?.length&&(en("Minuses"),xn(Ei.scenarioCons)),Ei?.risks?.length&&(en("Risks / watchouts"),xn(Ei.risks)),Ei?.notes?.length&&(en("Notes"),xn(Ei.notes)),Array.isArray(Ei?.data_used)&&Ei.data_used.length&&(en("Data used"),Ct(Ei.data_used.join(", ")));const Qi=(li,Hr)=>{if(!li?.data)return;q.addPage();const qi=36,Yn=q.internal.pageSize.getWidth(),_n=q.internal.pageSize.getHeight(),Dn=Hr?`Floorplan - ${Hr}`:"Floorplan";q.setFont(void 0,"bold"),q.setFontSize(14),q.text(Dn,qi,qi),q.setFont(void 0,"normal"),q.setFontSize(11);const ur=li.height&&li.width?li.height/li.width:1;let yr=Yn-qi*2,vi=yr*ur;const er=_n-qi*2-18;vi>er&&(vi=er,yr=vi/(ur||1));const Mo=qi,ls=qi+18;q.addImage(li.data,"PNG",Mo,ls,yr,vi)},Jr=new Map;lc.forEach(li=>{const Hr=yl.current.get(li);if(!Hr)return;const qi=Hr?.buildingName||Hr?.buildingId||jn||$||"",Yn=Hr?.floorName||Hr?.floorId||Dr||"";if(!qi||!Yn)return;const _n=`${gc(qi)}|${El(Yn)}`;Jr.has(_n)||Jr.set(_n,{buildingLabel:qi,floorLabel:Yn,ids:[]});const Dn=Jr.get(_n);Hr?.revitId!=null&&Dn.ids.push(Hr.revitId),Hr?.roomGuid&&Hr.roomGuid!==Hr.revitId&&Dn.ids.push(Hr.roomGuid)});const ai=[];if(Jr.size)for(const li of Jr.values()){const Hr=await Za(li.buildingLabel),qi=rv(li.floorLabel,Hr)||li.floorLabel,Yn=Ji(li.buildingLabel,qi);if(!Yn)continue;let _n=Jo.get(Yn);if(!_n)try{_n=await xf(Yn),_n&&Jo.set(Yn,_n)}catch{}const Dn=Qu(_n);if(!Dn?.features?.length)continue;const ur=sy({fc:Dn,colorMode:Vi,solidFill:!0,selectedIds:li.ids,labelOptions:{hideDrawing:!0}});ur?.data&&ai.push({img:ur,label:`${li.buildingLabel} - ${qi}`})}if(ai.length)ai.forEach(li=>Qi(li.img,li.label));else{const li=[];lc.forEach(Yn=>{const _n=yl.current.get(Yn);_n?.revitId!=null&&li.push(_n.revitId),_n?.roomGuid&&_n.roomGuid!==_n.revitId&&li.push(_n.roomGuid)});const Hr=ri?.current;let qi=Hr?.fc?sy({...Hr,colorMode:Vi,solidFill:!0,selectedIds:li,labelOptions:{hideDrawing:!0}}):null;if(!qi?.data&&$&&Dr){const Yn=Ji($,Dr);if(Yn){let _n=Jo.get(Yn);if(!_n)try{_n=await xf(Yn),_n&&Jo.set(Yn,_n)}catch{}const Dn=Qu(_n);Dn?.features?.length&&(qi=sy({fc:Dn,colorMode:Vi,solidFill:!0,selectedIds:li,labelOptions:{hideDrawing:!0}}))}}if(qi?.data){const Yn=Hr?.floor||Hr?.floorId||Dr||"";Qi(qi,Yn||"")}}const ds=`${dn}-scenario-compare`.replace(/\s+/g,"-").replace(/[^\w-]+/g,"").toLowerCase();q.save(`${ds}.pdf`)}catch(q){console.error("Scenario export failed",q),alert("Export failed - see console for details.")}},[Ei,as,hn,Cs,jn,$,B,Dr,lc,Vi,Za,rv,Ji,xf]);Oi(()=>{Ul&&xu()},[Ul,xu]),Oi(()=>{if(!Ul||lc.size===0)return;const{highlightIds:q}=ch(lc);hu(q)},[Ul,lc,Da,ch,hu]);const[ht,dt]=rr(!1),[St,Yt]=rr(null),[pn,Et]=rr(null);Oi(()=>{ht||Ul||jo(sa)},[sa,jo,ht,Ul]);const Qt=q=>{const be=_.current?.clientWidth??0,Me=_.current?.clientHeight??0,Qe=be||1e3,ct=Me||800,Xe=q.x+110,ot=q.y-160,Lt=Math.max(8,ct*.15),Ht=Math.max(Lt,Math.min(ct-220,ct*.65));return{x:Math.min(Math.max(Xe,8),Qe-260),y:Math.min(Math.max(ot,Lt),Ht)}},gn=vr(q=>{!q||kl||Ph(()=>{const be=_.current?.clientHeight??0,Me=Math.max(360,(be||0)*.7),Qe=Math.max(8,(be||800)-Me-40),ct=q.y-120;return Math.max(8,Math.min(ct,Qe))})},[kl]),Bn=vr(()=>{kl||Ph(q=>{const be=_.current?.clientHeight??0,Me=Math.max(360,(be||0)*.7),Qe=Math.max(8,(be||800)-Me-40);return Math.max(8,Math.min(q-40,Qe))})},[kl]),[x,l]=rr(null),[m,b]=rr(!1),[I,P]=rr(!1),[j,W]=rr(!1),[Z,le]=rr([]),ce=vr(q=>q?Rd(q):null,[]),Ee=vr(async q=>{if(!q)return null;const be=[];if(typeof q=="string"&&q.endsWith("_Dept.geojson")){const ot=q.replace(/\/([^/]+)$/,"/Rooms/$1");be.push(q.replace("_Dept.geojson","_Dept_Rooms.geojson").replace(/\/([^/]+)$/,"/Rooms/$1")),be.push(ot),be.push(q.replace("_Dept.geojson","_Dept_Rooms.geojson")),be.push(q)}else be.push(q);for(const ot of be)if(Xa.current[ot])return Xa.current[ot];let Me=null,Qe=null;for(const ot of be)if(Me=Jo.get(ot),Me||(Me=await xf(ot),Me&&Jo.set(ot,Me)),Me){Qe=ot;break}if(!Me)return console.warn("Floor summary: no data returned",q),null;const ct=Qu(Me);if(!Array.isArray(ct?.features))return console.warn("Floor summary: no features, skipping",Qe||q),null;const Xe=b2(ct.features);for(const ot of be)Xa.current[ot]=Xe;return Xe},[]),Fe=vr(async(q,be)=>{const Me=Ji(q,be);return Me?Ee(Me):null},[Ji,Ee]),qe=vr(async q=>{if(!q)return null;const be=ce(q)||q;if(!be)return null;if(oc.current[be])return oc.current[be];const Me=hl(be);let Qe=Me?uu(Me):[];if(Qe.length||(Qe=await Za(be)),!Qe.length)return null;const ct=xp(q),Xe={totalSf:0,classroomSf:0,labSf:0,officeSf:0,rooms:0,classroomCount:0,labCount:0,officeCount:0,deptCounts:new Map};for(const Lt of Qe){const Ht=Ji(be,Lt);if(!Ht)continue;const Ct=El(Lt),en=`${ct}/${Ct}`;let xn=Ya.current.get(en);xn||(xn=Xa.current[Ht],xn||(xn=await Fe(be,Lt)),xn&&Ya.current.set(en,xn)),xn&&(Xe.totalSf+=xn.totalSf||0,Xe.classroomSf+=xn.classroomSf||0,Xe.labSf+=xn.labSf||0,Xe.officeSf+=xn.officeSf||0,Xe.rooms+=xn.rooms||0,Xe.classroomCount+=xn.classroomCount||0,Xe.labCount+=xn.labCount||0,Xe.officeCount+=xn.officeCount||0,Object.entries(xn.deptCounts||{}).forEach(([Gn,dn])=>{Xe.deptCounts.set(Gn,(Xe.deptCounts.get(Gn)||0)+dn)}))}const ot=r_(Xe);return oc.current[be]=ot,ot},[Fe,ce,uu,hl,Ji,Za]),at=vr(async q=>{if(!q)return{totalSf:void 0,rooms:void 0,classroomSf:void 0,classroomCount:void 0,labSf:void 0,labCount:void 0,officeSf:void 0,officeCount:void 0,totalsByDept:{}};if(fn&&Array.isArray(kt)&&kt.length){const Me=Hs(q);if(Me){const Qe=kt.filter(Xe=>{const ot=Xe?.building??Xe?.buildingName??Xe?.buildingLabel??"";return Hs(ot)===Me}),ct=oy(Qe);if(ct)return ct}}return await qe(q)??{totalSf:void 0,rooms:void 0,classroomSf:void 0,classroomCount:void 0,labSf:void 0,labCount:void 0,officeSf:void 0,officeCount:void 0,totalsByDept:{}}},[qe,fn,kt]),et=vr(async()=>{const q=Rv();return(await Promise.all(bf.map(async Me=>{if(!Me?.name)return null;try{return await at(Me.name)}catch(Qe){return console.warn("Campus summary: failed to load building stats for",Me.name,Qe),null}}))).forEach(Me=>{if(!Me)return;q.totalSf+=Me.totalSf||0,q.classroomSf+=Me.classroomSf||0,q.labSf+=Me.labSf||0,q.officeSf+=Me.officeSf||0,q.rooms+=Me.rooms||0,q.classroomCount+=Me.classroomCount||0,q.labCount+=Me.labCount||0,q.officeCount+=Me.officeCount||0;const Qe=Me.deptCounts||Me.totalsByDept||{};Object.entries(Qe).forEach(([ct,Xe])=>{const ot=Number(Xe)||0;q.deptCounts.set(ct,(q.deptCounts.get(ct)||0)+ot)})}),r_(q)},[at]);Oi(()=>{let q=!1;return(async()=>{try{const Me=await et();if(q)return;qn(Me),ir(rh(Me,"campus"))}catch(Me){if(q)return;console.warn("Campus summary load failed",Me),qn(null),ir(rh(null,"campus"))}})(),()=>{q=!0}},[et]);const lt=vr(async q=>{const be=hl(q);if(!be)return;let Me=uu(be);if(Me.length||(Me=await Za(q)),!!Me.length)try{await Promise.all(Me.map(Qe=>Fe(q,Qe)))}catch(Qe){console.warn("Floor summary prefetch failed:",Qe)}},[hl,uu,Fe,Za]),Ie=vr(q=>{if(Bi("building"),Zn(null),!q){yn(null),wr(rh(null,"building"));return}const be=ce(q)||q;if(Wu.current=be,Go.current=null,ri.current={url:null,key:null,buildingId:null,floorId:null},wr({loading:!0,mode:"building"}),fn&&Array.isArray(kt)&&kt.length){const Me=Hs(q);if(Me){const Qe=kt.filter(Xe=>{const ot=Xe?.building??Xe?.buildingName??Xe?.buildingLabel??"";return Hs(ot)===Me}),ct=oy(Qe);if(ct){yn(ct),wr(rh(ct,"building"));return}}}at(q).then(Me=>{Wu.current===be&&(Go.current||(yn(Me),wr(rh(Me,"building"))))}).catch(()=>{Wu.current===be&&(Go.current||(yn(null),wr(rh(null,"building"))))})},[at,ce]),rt=vr(q=>{if(!q)return;Bi("floor"),Go.current=q,wr({loading:!0,mode:"floor"});const be=ri.current;if(fn&&Array.isArray(kt)&&kt.length){const Qe=be?.buildingId||B||$,ct=be?.floorLabel||Dr||"",Xe=kt.filter(Lt=>{const Ht=Lt?.building??Lt?.buildingName??Lt?.buildingLabel??"";if(Hs(Ht)!==Hs(Qe))return!1;if(!ct)return!0;const Ct=Md(ct);return Ct.length?Pd(Lt?.floor??Lt?.floorName??Lt?.floorId??"",Ct):!0}),ot=oy(Xe);if(ot){const Lt={...ot,floorLabel:ct};Xa.current[q]=ot,Zn(Lt);try{E(Vi)}catch{}wr(rh(ot,"floor"));return}}const Me=Xa.current[q];if(Me){const Qe=be?.floorLabel||Dr||"";Zn({...Me,floorLabel:Qe});try{E(Vi)}catch{}wr(rh(Me,"floor"));return}if(be?.url===q&&be?.key){const Qe=Ya.current.get(be.key);if(Qe){const ct=be.floorLabel||Dr||"";Zn({...Qe,floorLabel:ct});try{E(Vi)}catch{}wr(rh(Qe,"floor"));return}}Ee(q).then(Qe=>{if(Go.current!==q)return;const ct=ri.current;ct?.url===q&&ct?.key&&Qe&&Ya.current.set(ct.key,Qe);const Xe=ct?.floorLabel||Dr||"";Zn(Qe?{...Qe,floorLabel:Xe}:null);try{E(Vi)}catch{}wr(rh(Qe,"floor"))}).catch(()=>{Go.current===q&&(Zn(null),wr(rh(null,"floor")))})},[E,Ee,Vi,Dr]),gt=vr(async()=>{try{const q=await sd("/ai/api/rooms",{cache:"no-store",timeoutMs:8e3});let be=null;try{be=await q.json()}catch{}if(q.ok&&be?.ok&&Array.isArray(be.rooms))return At(be.rooms),Bs(new Date),!0}catch{}return!1},[]),yt=vr(()=>{io.current||(io.current=setTimeout(()=>{io.current=null,gt()},300))},[gt]),Mt=vr(async()=>{if(Xr)return;Qr(!0),Ui("");const q=await gt(),be=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});Ui(q?`Refreshed ${be}`:"Refresh failed"),Qr(!1)},[Xr,gt]);Oi(()=>()=>{io.current&&(clearTimeout(io.current),io.current=null)},[]);const Dt=vr(async q=>{if(t!=="admin"||!m||!q||!e)return null;const{buildingId:be,buildingName:Me,floorName:Qe,revitId:ct,roomId:Xe,roomLabel:ot,roomNumber:Lt,roomGuid:Ht,properties:Ct={}}=q;if(!be||!Qe||ct==null)return console.warn("Missing ids for room edit",q),null;const en=ld(be,Qe,ct);try{const xn=yy(Th,"universities",e,"buildings",be,"floors",Qe,"rooms",en),Gn=String(Ct.type??"").trim(),dn=wf(Ct)||Gn,ln=Dv(dn),Tn=ln?String(Ct.occupancyStatus??"").trim():"",kr=String(Ct.department??"").trim(),ti=Ct.occupant!=null,cr=String(Ct.occupant??"").trim(),Lr=Ct.seatCount!=null,_i=Ct.seatCount,xi=Number(_i),ci=Number.isFinite(xi)&&xi>0?xi:null,Qi={type:Gn||"",department:kr||"",comments:Ct.comments||"",updatedAt:V1()};ln&&(Qi.occupant=Ct.occupant||"",Qi.occupancyStatus=Ct.occupancyStatus||""),Lr&&(Qi.seatCount=ci),await k5(xn,Qi,{merge:!0});const Jr=Ct.airtableId||Ct.AirtableId||Ct.airtableID||Ct["Airtable ID"]||Ct["Airtable Id"]||null,ai={};Tn&&(ai.occupancyStatus=Tn),Gn&&(ai.type=Gn),kr&&(ai.department=kr),ln&&ti&&(ai.occupant=cr),Lr&&(ai.seatCount=ci);const ds=String(Lt??Ct.roomNumber??Ct.RoomNumber??Ct.Number??ot??"").trim(),li=String(Ht??Ct.Revit_UniqueId??Ct.revit_unique_id??Ct.revitUniqueId??Ct.RevitUniqueId??Ct["Room GUID"]??Ct.roomGuid??"").trim();let Hr=!1;if(Jr&&Object.keys(ai).length)try{const _n=await sd(`/ai/api/rooms/${Jr}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(ai)});if(_n.ok)Hr=!0;else{const Dn=await _n.text().catch(()=>"");console.warn("Airtable update failed",_n.status,Dn)}}catch(_n){console.warn("Airtable update failed",_n)}if(!Hr&&(li||ds)&&Object.keys(ai).length)try{const _n=await sd("/ai/api/rooms",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomId:li||ds,roomGuid:li||void 0,building:be,buildingName:Me||"",floor:Qe,...ai})});if(_n.ok)Hr=!0;else{const Dn=await _n.text().catch(()=>"");console.warn("Airtable update by roomId failed",_n.status,Dn)}}catch(_n){console.warn("Airtable update by roomId failed",_n)}const qi={type:Ct.type||"",department:Ct.department||"",occupant:ln?Ct.occupant||"":Ct.occupant??"",occupancyStatus:ln?Ct.occupancyStatus||"":Ct.occupancyStatus??"",comments:Ct.comments||""};Lr&&(qi.seatCount=ci,qi.SeatCount=ci,qi["Seat Count"]=ci),ll(_n=>{const Dn=new Map(_n||[]),ur=Xe||en,yr=Dn.get(ur)||{};return Dn.set(ur,{...yr,...qi}),Dn});let Yn=!1;sn(_n=>{if(!Array.isArray(_n)||!_n.length)return _n;const Dn=Ct.airtableId||Ct.AirtableId||Ct.airtableID||Ct["Airtable ID"]||Ct["Airtable Id"]||null,ur=_r=>String(_r||"").trim().toLowerCase().replace(/[^a-z0-9]/g,""),yr=String(Xe??"").trim(),vi=String(ot??"").trim(),er=ct!=null?String(ct):"",Mo=Ct.area??Ct.areaSF??Ct["Area (SF)"]??Ct.Area_SF??Ct.Area??null,ls=Number(Mo)||0,mo=Hs(be),Qs=Hs(Qe),bl=ur(be),Do=ur(Qe),wl=[];let To=_n.map((_r,Dc)=>{if(!_r)return _r;const Qc=_r.airtableId||_r.AirtableId||_r["Airtable ID"]||null,Jh=String(_r.roomId??_r.id??"").trim(),_o=Hs(_r.building??_r.buildingName??_r.buildingLabel??""),nu=Hs(_r.floor??_r.floorId??_r.floorName??""),Ll=ur(_r.building??_r.buildingName??_r.buildingLabel??""),Qh=ur(_r.floor??_r.floorId??_r.floorName??""),ef=mo&&_o===mo||bl&&Ll===bl,Uu=Qs&&nu===Qs||Do&&Qh===Do,Kf=Dn&&Qc&&String(Qc)===String(Dn)||yr&&Jh===yr||er&&Jh===er||vi&&Jh===vi;let Oc=!1;if(!Kf&&ef&&Uu&&vi){const eh=String(_r.roomLabel??_r.name??_r.number??_r.roomNumber??"").trim(),Di=String(_r.roomId??_r.id??"").trim();Oc=eh&&eh===vi||Di&&Di===vi}if(!Kf&&!Oc){if(vi&&!ef&&!Uu){const eh=String(_r.roomId??_r.id??"").trim();eh&&eh===vi&&wl.push(Dc)}return _r}return Yn=!0,{..._r,type:Ct.type!=null?Ct.type:_r.type,department:Ct.department!=null?Ct.department:_r.department,occupant:Ct.occupant!=null?Ct.occupant:_r.occupant,occupancyStatus:Ct.occupancyStatus!=null?Ct.occupancyStatus:_r.occupancyStatus,seatCount:Lr?ci:_r.seatCount??_r.SeatCount??_r["Seat Count"],area:ls>0?ls:_r.area??_r.areaSF??_r.sf??_r.Area_SF??_r.Area??_r["Area (SF)"],areaSF:ls>0?ls:_r.areaSF??_r.sf??_r.area??_r.Area_SF??_r.Area??_r["Area (SF)"],sf:ls>0?ls:_r.sf??_r.areaSF??_r.area??_r.Area_SF??_r.Area??_r["Area (SF)"],roomLabel:_r.roomLabel??_r.name??_r.number??_r.roomNumber??vi,comments:Ct.comments!=null?Ct.comments:_r.comments}});if(!Yn&&vi&&wl.length===1){const _r=wl[0];To[_r]&&(Yn=!0,To[_r]={...To[_r],type:Ct.type!=null?Ct.type:To[_r].type,department:Ct.department!=null?Ct.department:To[_r].department,occupant:Ct.occupant!=null?Ct.occupant:To[_r].occupant,occupancyStatus:Ct.occupancyStatus!=null?Ct.occupancyStatus:To[_r].occupancyStatus,seatCount:Lr?ci:To[_r].seatCount??To[_r].SeatCount??To[_r]["Seat Count"],area:ls>0?ls:To[_r].area??To[_r].areaSF??To[_r].sf,areaSF:ls>0?ls:To[_r].areaSF??To[_r].sf??To[_r].area,sf:ls>0?ls:To[_r].sf??To[_r].areaSF??To[_r].area,roomLabel:To[_r].roomLabel??To[_r].name??To[_r].number??vi,comments:Ct.comments!=null?Ct.comments:To[_r].comments})}if(!Yn&&vi){const _r=ur(vi),Dc=ur(be),Qc=ur(Qe);To.some(_o=>{const nu=ur(_o?.building??_o?.buildingName??_o?.buildingLabel??""),Ll=ur(_o?.floor??_o?.floorId??_o?.floorName??""),Qh=ur(_o?.roomLabel??_o?.name??_o?.number??_o?.roomNumber??_o?.roomId??_o?.id??"");return Qh&&Qh===_r&&(!Dc||nu===Dc)&&(!Qc||Ll===Qc)})||(Yn=!0,To=[...To,{roomId:vi,roomLabel:vi,building:be,floor:Qe,area:ls||0,areaSF:ls||0,sf:ls||0,type:Ct.type||"",department:Ct.department||"",occupant:Ct.occupant||"",occupancyStatus:Ct.occupancyStatus||"",seatCount:Lr?ci:null,comments:Ct.comments||""}])}return To}),Hr&&yt();try{const _n=ri.current;_n&&_n.url===Go.current&&Ya.current.get(_n.key)&&Ya.current.delete(_n.key)}catch(_n){console.warn("Failed to invalidate floor summary cache",_n)}return Qi}catch(xn){return console.error("Failed to save room edits",xn),null}},[Th,e,yt,t,m]);Oi(()=>{if($||!bf.length)return;const q=bf[0].name;J(q),Is("LEVEL_1")},[]),vr(q=>{const be=y.current,Me=_.current?.clientWidth||1e3,Qe=_.current?.clientHeight||800;if(!be||!q?.geometry)return null;const ct=Lc(q);if(!ct||ct.length!==4||ct.some(Ct=>!Number.isFinite(Ct)))return null;const Xe=(ct[1]+ct[3])/2,ot=be.project({lng:ct[2],lat:Xe}),Lt=Math.min(Math.max(ot.x+12,8),Me-360),Ht=Math.min(Math.max(ot.y-120,8),Qe-260);return{x:Lt,y:Ht}},[]);const Nt=vr(async q=>{await ts(q)},[ts]),qt=vr(()=>{const q=jn;return{buildingLabel:fx({buildingLabel:q,buildingId:B||$||""})||q,floorId:pa||Dr||""}},[jn,B,$,pa,Dr]),Bt=vr(()=>{const q=pa||Dr||"",be=ri.current?.url||null,Me=ri.current?.floorAdjustBasePath||null,Qe=be?qf(be):null,ct=hl(B||$)||Qe,Xe=ri.current?.floorAdjustLabel||null,ot=ri.current?.floorAdjustFloorId||null,Lt=jn,Ht=Xe||ct||fx({buildingLabel:Lt,buildingId:B||$||""})||Lt,Ct=ot&&El(ot)===El(q)?ot:q;return{buildingLabel:Ht,floorId:Ct,url:be,basePath:Me}},[jn,B,$,pa,Dr,hl]),rn=vr((q,be)=>{const Me=gc(q||""),Qe=El(be||"");return`${Me}__${Qe}`},[]),Rn=vr(async(q,be)=>{if(!e||!q||!be)return null;const Me=rn(q,be);if(!Me)return null;try{const Qe=yy(Th,"universities",e,"floorAdjustments",Me),ct=await kT(Qe);return ct.exists()&&ct.data()||null}catch{return null}},[Th,e,rn]),Jt=vr(async(q,be,Me)=>{if(!e||!q||!be||!Me)return;const Qe=rn(q,be);if(Qe)try{const ct=yy(Th,"universities",e,"floorAdjustments",Qe);await k5(ct,{buildingLabel:q,floorId:be,rotationDeg:Number.isFinite(Me.rotationDeg)?Me.rotationDeg:0,scale:Number.isFinite(Me.scale)?Me.scale:1,translateMeters:Array.isArray(Me.translateMeters)?Me.translateMeters:[0,0],translateLngLat:Array.isArray(Me.translateLngLat)?Me.translateLngLat:null,anchorLngLat:Array.isArray(Me.anchorLngLat)?Me.anchorLngLat:null,pivot:Array.isArray(Me.pivot)?Me.pivot:null,updatedAt:V1(),updatedBy:x?.uid||x?.email||null},{merge:!0})}catch{}},[Th,e,rn,x]),An=vr((q,be)=>{if(!Array.isArray(q)||q.length<2||!Array.isArray(be)||be.length<2)return null;const[Me,Qe]=q,[ct,Xe]=be,ot=Qe[0]-Me[0],Lt=Qe[1]-Me[1],Ht=Xe[0]-ct[0],Ct=Xe[1]-ct[1],en=Math.hypot(ot,Lt),xn=Math.hypot(Ht,Ct);if(!Number.isFinite(en)||!Number.isFinite(xn)||en<=0||xn<=0)return null;const Gn=Math.atan2(Lt,ot),dn=Math.atan2(Ct,Ht),ln=(Gn-dn)*180/Math.PI,Tn=en/xn;return{rotationDeg:ln,scale:Tn,pivot:ct,target:Me}},[]);vr(()=>{Tt(null),zt("")},[]),vr(()=>{if(!y.current||!y.current.getLayer(lo)){alert("Load a floorplan first, then start align.");return}const{buildingLabel:q,floorId:be}=qt();if(!q||!be){alert("Select a building and floor before aligning.");return}zt(""),Tt({buildingLabel:q,floorId:be,roomPts:[],drawingPts:[],step:0})},[qt]),vr(async()=>{const{buildingLabel:q,floorId:be}=qt();if(!q||!be)return;Cq(q,be),zt("");const Me=Ji($,be);Me&&(Jo.delete(Me),ih.delete(Me)),await ts(be)},[qt,$,Ji,ts]);const cn=vr(()=>{if(!y.current||!y.current.getLayer(lo)){alert("Load a floorplan first, then rotate.");return}const{buildingLabel:q,floorId:be}=Bt();if(!q||!be){alert("Select a building and floor before rotating.");return}Br(""),Mr("rotate")},[Bt]),Vn=vr(()=>{if(!y.current||!y.current.getLayer(lo)){alert("Load a floorplan first, then move.");return}const{buildingLabel:q,floorId:be}=Bt();if(!q||!be){alert("Select a building and floor before moving.");return}Br(""),Mr("move")},[Bt]),tn=vr(()=>{Mr(null),Br("");try{y.current?.dragPan?.enable()}catch{}},[]),bn=vr(async()=>{const{buildingLabel:q,floorId:be}=Bt();if(!q||!be)return;const Me=ri.current?.floorAdjustLabel||q;kq(Me,be);const Qe=ri.current?.floorAdjustBasePath||null;Qe&&Pq(Qe,be);const ct=ri.current?.url||Ji($,be);ct&&Lq(ct);try{await Jt(Me,be,{rotationDeg:0,scale:1,translateMeters:[0,0],translateLngLat:null,anchorLngLat:null,pivot:null})}catch{}Br("");const Xe=ct||Ji($,be);Xe&&(Jo.delete(Xe),ih.delete(Xe)),await ts(be)},[Bt,$,Ji,ts,Jt]),Un=qt();iL(Un.buildingLabel,Un.floorId),Gt&&jA[Gt.step]?.label,Gt&&Gt.step;const In=Bt(),Wn=In.basePath?t_(In.basePath,In.floorId):null,Nr=In.url?e_(In.url):null,ei=eg(In.buildingLabel,In.floorId),Er=$5({base:Wn,url:Nr,label:ei}),gr=Er.adjust,Ai=m?{source:Er.source,labelKey:Qx(In.buildingLabel,In.floorId),urlKey:In.url?eb(In.url):null,baseKey:In.basePath?tb(In.basePath,In.floorId):null,floorId:In.floorId,url:In.url,basePath:In.basePath,savedAt:gr?.savedAt||0,rotationDeg:gr?.rotationDeg||0,scale:gr?.scale||1,translateMeters:gr?.translateMeters||[0,0],translateLngLat:gr?.translateLngLat||null,anchorLngLat:gr?.anchorLngLat||null,pivot:gr?.pivot||ri.current?.floorAdjustBasePivot||null,storedKeys:(()=>{if(typeof window>"u"||!window.localStorage)return[];try{const q=Object.keys(window.localStorage).filter(Me=>Me.startsWith(eL)||Me.startsWith(tL)||Me.startsWith(nL)),be=El(In.floorId||"");return q.filter(Me=>be&&Me.includes(`/${be}`))}catch{return[]}})()}:null,Mi=gr?.rotationDeg||0,Vr=gr?.scale||1;gr?.translateMeters;const Yi=bp(gr),Ki=vr(()=>{pa&&(pa!==Dr&&Is(pa),Nt(pa))},[pa,Nt,Dr]);async function ts(q){if(!M||!y.current)return!1;const Me=!!(q&&typeof q=="object"&&("nativeEvent"in q||"target"in q||"preventDefault"in q))?null:q,Qe=_y(Me||Dr),ct=iy(B,hl)||iy($,hl);let Xe=ct?uu(ct):Ql;(!Xe||Xe.length===0)&&ct&&(Xe=await Za(ct));let ot=rv(Qe,Xe),Lt=null;if(!ot&&Xe?.length&&(ot=Xe[0]),!ot&&Qe&&Me&&ct&&(!Xe||Xe.length===0)&&(ot=Qe,Lt=ud(`floorplans/${H5}/${ct}/Rooms/${ot}_Dept_Rooms.geojson`),Xe&&!Xe.includes(ot)&&(Xe=[...Xe,ot],Mu.current.set(ct,Xe))),!ot)return alert("This floor is not available for this building."),!1;ot!==Dr&&Is(ot);const Ht=Lt||Ji($,ot);if(!Ht)return alert("No file mapped for that floor."),!1;try{Bi("floor"),Zn(null),wr({loading:!0,mode:"floor"});const Ct=T.current?.[Ht],en=iy(B,hl)||iy($,hl),xn=en?ud(`floorplans/Hastings/${en}`):null,Gn=Ht?qf(Ht):null,dn=ct||Gn||Rd(B||$||"")||B||$,ln=xn?t_(xn,ot):null,Tn=Ht?e_(Ht):null,kr=eg(dn,ot),cr=$5({base:ln,url:Tn,label:kr}).adjust,Lr=bp(cr),_i=Number(cr?.savedAt)||0,xi=await Rn(dn,ot);if(xi){const Dn={rotationDeg:Number(xi.rotationDeg)||0,scale:Number(xi.scale)||1,translateMeters:Array.isArray(xi.translateMeters)?xi.translateMeters:[0,0],translateLngLat:Array.isArray(xi.translateLngLat)?xi.translateLngLat:null,anchorLngLat:Array.isArray(xi.anchorLngLat)?xi.anchorLngLat:null,pivot:Array.isArray(xi.pivot)?xi.pivot:null},ur=bp(Dn),yr=(()=>{const er=xi.updatedAt;return er?.toMillis?er.toMillis():Number.isFinite(er?.seconds)?er.seconds*1e3:0})();(yr?yr>=_i:!Lr&&ur)&&(Q1(dn,ot,Dn),Ht&&ev(Ht,Dn),xn&&tv(xn,ot,Dn),Ht&&(Jo.delete(Ht),ih.delete(Ht)))}let ci=Ma.current||null;const Qi=String(B||$||"");try{const Dn=mi(Qi),ur=mi(ci?.properties?.id||ci?.properties?.name||"");(!ur||Dn&&ur!==Dn)&&(ci=null)}catch{}if(!ci)try{const Dn=n?.buildings?.features||[],ur=Dn.find(yr=>String(yr.properties?.id)===Qi)||null;ur?ci=ur:ci=Nd(Dn,Qi),ci&&(Ma.current=ci)}catch{}!ci&&bc&&(ci=bc,Ma.current=bc),ci||(ci=Nv(y.current,Qi),ci&&(Ma.current=ci));const Jr=zG(ci?.properties?.id||ci?.properties?.name||B||$,ot),ai=t==="admin"&&Vq,ds=await uG(y.current,Ht,Ct,{fitBuilding:ci,rotationOverrideDeg:Jr},{buildingId:B||$,floor:ot,roomPatches:ia,airtableLookup:zs,currentFloorContextRef:ri,roomsBasePath:xn,roomsFloorId:ot,enableWalls:ai,wallsBasePath:xn,wallsFloorId:ot,onOptionsCollected:({typeOptions:Dn,deptOptions:ur})=>{Dn?.length&&vo(yr=>bq(yr,Dn)),ur&&xo(yr=>Hu(yr,ur))}});if(!ds)return wr(rh(null,"floor")),!1;Mc(!0),wi(Dn=>Dn+1),Go.current=Ht,_c.current=Ht;const li=xp(B||$||""),Hr=El(ot||""),qi=li&&Hr?`${li}/${Hr}`:null;qi&&ds.summary&&(Ya.current.set(qi,ds.summary),ba.current.set(qi,ds.rooms)),ri.current={...ri.current||{},url:Ht,key:qi,buildingId:li,floorId:Hr,floorLabel:ot,floorAdjustLabel:dn||ri.current?.floorAdjustLabel||null,floorAdjustFloorId:ot,floorAdjustBasePath:xn||ri.current?.floorAdjustBasePath||null};const _n=(fn&&Array.isArray(kt)&&kt.length?oy(kt.filter(Dn=>{const ur=Dn?.building??Dn?.buildingName??Dn?.buildingLabel??"";if(Hs(ur)!==Hs(B||$))return!1;const yr=Md(ot);return yr.length?Pd(Dn?.floor??Dn?.floorName??Dn?.floorId??"",yr):!0})):null)||ds.summary||null;if(_n){Xa.current[Ht]=_n,Ya.current.set(Ht,_n);const Dn={..._n,floorLabel:ot};Zn(Dn);try{E(Vi)}catch{}Go.current===Ht&&wr(rh(_n,"floor"))}else Zn(null),wr(rh(null,"floor"));try{f(Vi),E(Vi)}catch{}return xr(!1),Bi("floor"),dh({x:12,y:12}),Ue===De.SPACE_DATA&&XA(y.current),!0}catch(Ct){return console.error(Ct),alert("Failed to load floor plan. See console for details."),Mc(!1),!1}}const Gs=(q,be,Me,Qe,ct,Xe,ot="Key Departments")=>{if(!be&&!Xe&&!Me?.length)return;const Lt=14,Ht=Qe+6,Ct=24,en=Xe||"Totals";q.setFontSize(12),q.setFont(void 0,"bold"),q.text(en,Ht,Ct);let xn=Ct+Lt;if(q.setFont(void 0,"normal"),be&&[be.totalSF!=null?`Total SF: ${Math.round(be.totalSF).toLocaleString()}`:null,be.rooms!=null?`Rooms: ${be.rooms}`:null,be.classroomSf!=null?`Classroom SF: ${Math.round(be.classroomSf).toLocaleString()}`:null,be.classroomCount!=null?`Classrooms: ${be.classroomCount}`:null,be.levels!=null?`Levels: ${be.levels}`:null].filter(Boolean).forEach(dn=>{q.text(dn,Ht,xn),xn+=Lt}),Me?.length){xn+=Lt/2,q.setFont(void 0,"bold"),q.text(ot,Ht,xn),xn+=Lt,q.setFont(void 0,"normal");const Gn=10;Me.slice(0,8).forEach(dn=>{const ln=dn.color||cd(dn.name);q.setFillColor(ln),q.rect(Qe+6,xn-8,Gn,Gn,"F"),q.setTextColor("#000");const Tn=dn.areaSf?`${dn.name} (${Math.round(dn.areaSf).toLocaleString()} SF)`:dn.name;q.text(Tn,Qe+6+Gn+4,xn),xn+=Lt})}},wa=vr((q,be={})=>{if(!Array.isArray(q)||!q.length){alert("No floorplan data to export.");return}try{const Me=new $i("p","pt","letter"),Qe=Me.internal.pageSize.getWidth(),ct=Me.internal.pageSize.getHeight(),Xe=24,ot=be.stats||null,Lt=be.keyDepts||[],Ht=be.summaryLabel||"",Ct=be.legendTitle||"Key Departments",en=be.filenameBase||"floorplan",xn=!!(ot||Lt&&Lt.length),Gn=xn?130:0,dn=xn?Gn-12:0;q.forEach((Tn,kr)=>{const ti=Tn?.img;if(!ti?.data)return;kr>0&&Me.addPage();const cr=ti.height&&ti.width?ti.height/ti.width:1,Lr=xn?Qe-Xe*2-Gn-Xe:Qe-Xe*2;let _i=Math.min(Lr,ti.width),xi=_i*cr;const ci=ct-Xe*2-40;xi>ci&&(xi=ci,_i=xi/(cr||1));const Qi=Xe;Me.addImage(ti.data,"PNG",Qi,Xe+20,_i,xi),Me.setFontSize(12);const Jr=Tn.label||"";if(Jr&&Me.text(Jr,Xe,Xe),xn){const ai=Math.min(Qe-Gn-Xe,Qi+_i+Xe*.75);Gs(Me,ot,Lt,ai,dn,Ht||Jr,Ct)}});const ln=`${en.replace(/\s+/g,"-").toLowerCase()}.pdf`;Me.save(ln)}catch(Me){console.error("Floor export failed",Me),alert("Export failed - see console for details.")}},[]),$o=vr(async({context:q,floorStats:be,panelStats:Me})=>{const Qe=await sd("/ai/explain-floor",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:q,floorStats:be,panelStats:Me})}),ct=await Qe.text();let Xe=null;try{Xe=JSON.parse(ct)}catch{}if(!Qe.ok)throw new Error(Xe?.error||ct||`HTTP ${Qe.status}`);return Xe},[]),Bu=vr(async({context:q,campusStats:be,panelStats:Me})=>{const Qe=await sd("/ai/explain-campus",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:q,campusStats:be,panelStats:Me})}),ct=await Qe.text();let Xe=null;try{Xe=JSON.parse(ct)}catch{}if(!Qe.ok)throw new Error(Xe?.error||ct||`HTTP ${Qe.status}`);return Xe},[]),Yu=vr(async({context:q,baselineStats:be,scenarioStats:Me,deltas:Qe})=>{const ct=await sd("/ai/compare-scenario",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:q,baselineStats:be,scenarioStats:Me,deltas:Qe})}),Xe=await ct.text();let ot=null;try{ot=JSON.parse(Xe)}catch{}if(!ct.ok)throw new Error(ot?.error||Xe||`HTTP ${ct.status}`);return ot},[]),Zi=vr(async({request:q,context:be,inventory:Me,constraints:Qe})=>{const ct=await sd("/ai/create-move-scenario",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({request:q,context:be,inventory:Me,constraints:Qe})}),Xe=await ct.text();let ot=null;try{ot=JSON.parse(Xe)}catch{}if(!ct.ok)throw new Error(ot?.error||Xe||`HTTP ${ct.status}`);return ot},[]),ks=vr(async({question:q,context:be,data:Me})=>{const Qe=await sd("/ai/ask-mapfluence",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:q,context:be,data:Me})}),ct=await Qe.text();let Xe=null;try{Xe=JSON.parse(ct)}catch{}if(!Qe.ok)throw new Error(Xe?.error||ct||`HTTP ${Qe.status}`);return Xe},[]),$s=vr(async({context:q,buildingStats:be,panelStats:Me})=>{const Qe=await sd("/ai/explain-building",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:q,buildingStats:be,panelStats:Me})}),ct=await Qe.text();let Xe=null;try{Xe=JSON.parse(ct)}catch{}if(!Qe.ok)throw new Error(Xe?.error||ct||`HTTP ${Qe.status}`);return Xe},[]),Sa=vr(async()=>{Io(""),En(!0),ic(null);try{const q=ri.current,be={universityId:e,buildingId:q?.buildingId||B||$||"",buildingLabel:q?.buildingLabel||"",floorId:q?.floorId||Dr||"",floorLabel:q?.floorLabel||sr?.floorLabel||Dr||"",url:q?.url||""},Me=await $o({context:be,floorStats:sr,panelStats:bi});ic(Me),Wo(!0)}catch(q){Io(String(q?.message||q))}finally{En(!1)}},[$o,sr,bi,B,$,Dr,e]),Gl=vr(async()=>{ko(""),Tl(!0),$u(null);try{const q=Lo?{totalSf:Math.round(Lo.totalSf||0),rooms:Math.round(Lo.roomCount||0),totalsByDept:Object.fromEntries((Lo.byDept||[]).map(Qe=>[Qe.name,Math.round(Number(Qe.sf||0))])),byType:(Lo.byType||[]).map(Qe=>({type:Qe.name,sf:Math.round(Number(Qe.sf||0))})),occupancySummary:Lo.occupancySummary||null,officeOccupancy:Lo.officeOccupancy||null}:null,Me=await Bu({context:{universityId:e,campusLabel:Se||e||"Campus",buildingId:"",buildingLabel:"",floorId:"",floorLabel:"",url:""},campusStats:q||$r,panelStats:jr});$u(Me),Ri(!0)}catch(q){ko(String(q?.message||q))}finally{Tl(!1)}},[Se,jr,$r,Lo,Bu,e]),Eo=vr(async()=>{Vo(""),Ha(!0),bo(null);try{if(!Cs)throw new Error("No scenario totals available. Turn on Move Scenario Mode and make changes.");if(!as)throw new Error("Select a department for the scenario before comparing.");const{perBuilding:q,campusTotals:be}=await nI(as,{ensureFloorsForBuilding:Za,buildFloorUrl:Ji,floorCache:Jo,fetchGeoJSON:xf});if(!be)throw new Error("No baseline stats for the selected department on this campus.");const Qe=qa(jn||$||B||"").toLowerCase(),ct=Object.entries(q||{}).sort((ln,Tn)=>(Tn[1]?.totalSF||0)-(ln[1]?.totalSF||0)||(Tn[1]?.rooms||0)-(ln[1]?.rooms||0)),Xe=ct.find(([ln])=>qa(ln).toLowerCase()!==Qe)||ct[0]||null,ot=Xe?Xe[0]:"campus",Lt=Xe?Xe[1]:be;Lt&&(Lt.__label=ot||"campus");const Ht="campus",Ct=B||$||"",en=Rd(B||$)||$||B||"",xn={universityId:e,baselineScope:Ht,buildingId:Ct,buildingLabel:jn||"",floorId:Dr||"",scenarioDepartment:as,baselineLabel:`Current allocation for ${as} (${ot})`};console.log("Scenario compare baseline (dept campus-wide):",Lt),console.log("Scenario compare scenario (selection totals):",Cs),Cn(Lt);const Gn={totalSF:(Cs?.totalSF||0)-(Lt?.totalSF||0),rooms:(Cs?.rooms||0)-(Lt?.rooms||0)},dn=await Yu({context:xn,baselineStats:Lt,scenarioStats:Cs,deltas:Gn,scenarioDept:as||""});bo(dn),mu(!0)}catch(q){Vo(String(q?.message||q))}finally{Ha(!1)}},[jn,Yu,as,Cs,jn,Za,Ji,Jo,xf,$,B,Dr,e]);Oi(()=>{ra&&(!as||!Cs?.rooms||(os(!1),Eo()))},[ra,as,Cs,Eo]);const Ea=vr(async()=>{Wr(""),ho(!0),ca(null);try{const Me=await $s({context:{universityId:e,buildingId:B||$||"",buildingLabel:jn||"",floorId:"",floorLabel:"",url:""},buildingStats:nn,panelStats:bi});ca(Me),il(!0)}catch(q){Wr(String(q?.message||q))}finally{ho(!1)}},[jn,nn,$s,bi,$,B,e]);Oi(()=>{const q=$9();if(typeof window<"u"&&window.location.hostname.includes("github.io"))return hs(q?"ok":"down"),()=>{};if(!q)return hs("down"),()=>{};const Me=hL("/ai/health"),Qe=async()=>{try{const Xe=await sd(Me,{cache:"no-store",timeoutMs:3e3});hs(Xe.ok?"ok":"down")}catch{hs("down")}};Qe();const ct=setInterval(Qe,3e4);return()=>clearInterval(ct)},[]);const Yo=vr(()=>{const q=ri?.current;if(!q?.fc){alert("No floor loaded.");return}const be=ft?Ne.get(ft)||[]:[],Me=Jl(ul.current||[]),Qe=Ut.current||[],ct=Array.from(new Set([...be||[],...Me||[],...Qe||[]])),Xe=sy({...q,colorMode:Vi,selectedIds:ct,solidFill:!0,labelOptions:{hideDrawing:!0}});if(!Xe){alert("Unable to render floorplan.");return}const ot=`${jn} - ${q.floorLabel||Dr||""}`.trim()||"Floor",Lt=q?.url?Xa.current[q.url]:null,Ht=sr??(Lt?{...Lt,floorLabel:q.floorLabel||Dr}:null),Ct=si&&si.length?si:Rw(Ht?.totalsByDept),en={department:"Key Departments",type:"Key Types",occupancy:"Occupancy",vacancy:"Vacancy"}[Vi]||"Legend";wa([{img:Xe,label:ot}],{filenameBase:`${jn}-${q.floorLabel||Dr||"floor"}`,stats:Ht,keyDepts:Ct,summaryLabel:`${jn} - ${q.floorLabel||Dr||""} (${Vi||"department"})`,legendTitle:en})},[jn,Dr,wa,Vi,si]),Ro=vr(()=>{CL(y.current,Go);try{const be=y.current;be?.getLayer(Gy)&&be.removeLayer(Gy),be?.getSource(gx)&&be.removeSource(gx)}catch{}Mc(!1),a&&ac("campus"),jl.current="",Go.current=null,_c.current=null,ri.current={url:null,key:null,buildingId:null,floorId:null},Zn(null),Bi("building");const q=cl.current||$;q&&Ie(q)},[$,Ie,a]);vr(()=>{AI(y.current)},[]);const aa=vr(()=>{const q=!Ul;$h(q),q?(Vl(!0),Du(null),Ph(20)):Fu()},[Fu,Ul,Vl]),zu=vr(()=>{try{const q={markers:ve,buildingConditions:Pe,buildingAssessments:_e},be=new Blob([JSON.stringify(q,null,2)],{type:"application/json"}),Me=document.createElement("a");Me.href=URL.createObjectURL(be),Me.download=`${e||"campus"}-map-data.json`,document.body.appendChild(Me),Me.click(),document.body.removeChild(Me)}catch(q){console.warn("Export failed",q),alert("Export failed. See console for details.")}},[ve,Pe,_e,e]);vr(()=>{alert("Export Drawing Entries not implemented in this build.")},[]);const Ta=vr(async(q="__all__",be="")=>{const Me=q&&q!=="__all__"?[q]:bf.map(Xe=>Xe.name).filter(Boolean),Qe=be.toLowerCase().trim(),ct=[];for(const Xe of Me){if(!Xe)continue;const ot=await Za(Xe);if(ot?.length)for(const Lt of ot){const Ht=Ji(Xe,Lt);if(!Ht)continue;let Ct;try{const en=await xf(Ht);Ct=Qu(en)}catch(en){console.warn("Space export: failed to load",Ht,en);continue}if(Ct?.features?.length)for(const en of Ct.features){const xn=en?.properties||{},Gn=en?.id??xn.RevitId??xn.id,dn=Xe&&Lt&&Gn!=null?ld(Xe,Lt,Gn):null,ln=dn&&ia instanceof Map?ia.get(dn):null,Tn=ln?{...xn,...ln}:xn,kr=Tn.Number??Tn.RoomNumber??Tn.number??Tn.Room??"",ti=wf(Tn)||Tn.Name||"",cr=(Tn.department??Tn.Department??Tn.Dept??"").toString().trim();if(Qe&&!cr.toLowerCase().includes(Qe))continue;const Lr=Od(Tn),_i=Dw(Tn),xi=Tn.occupant??Tn.Occupant??"";ct.push({building:Xe,floor:Lt,roomNumber:kr||"",type:ti||"",department:cr||"",area:Number.isFinite(Lr)?Lr:"",seatCount:_i??"",occupant:xi||"",roomId:dn||"",revitId:Gn??null})}}}return ct},[Ji,Za,ia]);vr(async()=>{const q=await Ta("__all__","");return Uw(q,250)||[]},[Ta]);const Ku=vr(async(q="__all__",be="")=>{const Me=q&&q!=="__all__"?[q]:bf.map(en=>en.name).filter(Boolean),Qe=be.toLowerCase().trim(),ct=[],Xe=Rv(),ot=(en,xn,Gn)=>{if(!en)return null;const dn=Tn=>Number.isFinite(Tn)?Math.round(Tn):"",ln=Tn=>Number.isFinite(Tn)?Number(Tn):0;return{buildingId:Gn||xp(xn||""),buildingName:xn||"",totalSf:dn(en.totalSf),rooms:ln(en.rooms),classroomSf:dn(en.classroomSf),classrooms:ln(en.classroomCount),labSf:dn(en.labSf),labs:ln(en.labCount),officeSf:dn(en.officeSf),offices:ln(en.officeCount),keyDepts:(en.keyDepts||[]).join("; ")}};for(const en of Me){if(!en)continue;const xn=await Za(en);if(!xn?.length)continue;const Gn=Rv();for(const Tn of xn){const kr=Ji(en,Tn);if(!kr)continue;let ti=Jo.get(kr);ti||(ti=await xf(kr),ti&&Jo.set(kr,ti));const cr=Qu(ti);if(cr?.features?.length)for(const Lr of cr.features){const _i=Lr?.properties||{},xi=Lr?.id??_i.RevitId??_i.id,ci=en&&Tn&&xi!=null?ld(en,Tn,xi):null,Qi=ci&&ia instanceof Map?ia.get(ci):null,Jr=Qi?{..._i,...Qi}:_i,ai=(Jr.department??Jr.Department??Jr.Dept??"").toString().trim();Qe&&!ai.toLowerCase().includes(Qe)||(Y5(Gn,Jr),Y5(Xe,Jr))}}const dn=r_(Gn),ln=dn?ot(dn,en):null;ln&&(ln.rooms||ln.totalSf)&&ct.push(ln)}const Lt=r_(Xe);return{campusRow:(!q||q==="__all__")&&Lt&&(Lt.rooms||Lt.totalSf)?ot(Lt,"Campus Total","campus"):null,buildingRows:ct}},[Ji,Za,ia]),If=vr(async()=>{Es(""),Fs(!0),Ts(null);try{if(so==="down")throw new Error("AI server is offline.");const q=(Vs||"").trim();if(!q)throw new Error("Enter a short request for the move scenario.");const be=fn&&Array.isArray(kt)?kt:[],Me=vI(be),Qe=as||xI(q,Me)||"",ct=Qe?SI(be,Qe):[],Xe=new Set((ct||[]).map(Yn=>Hs(Yn)).filter(Boolean)),ot=bI(be),Lt=wI(q,ot)||"",Ht=Lt||"",Ct="";let en=[];if(fn&&Array.isArray(kt)&&kt.length)en=Uw(kt,2e3)||[];else try{const Yn=await Ta("__all__","");en=Uw(Yn,250)||[]}catch{}if(!en.length){const Yn=ri?.current?.fc?.features||[];en=yG(Yn,Ht,Ct,250)||[]}if(!en.length)throw new Error("No room inventory loaded yet. Load Space Data or a floorplan first.");if(Lt){const Yn=Hs(Lt),_n=en.filter(Dn=>{const ur=Dn?.buildingLabel??Dn?.building??Dn?.buildingName??"";return Hs(ur)===Yn});if(!_n.length)throw new Error(`No rooms found for ${Lt}.`);en=_n}if(Xe.size){const Yn=en.filter(_n=>{const Dn=_n?.buildingLabel??_n?.building??_n?.buildingName??"";return!Xe.has(Hs(Dn))});if(!Yn.length)throw new Error(`No rooms available outside the current ${Qe||"department"} home building(s).`);en=Yn}en=dL(en);let xn=null,Gn="";if(Qe)try{const{perBuilding:Yn,campusTotals:_n}=await nI(Qe,{ensureFloorsForBuilding:Za,buildFloorUrl:Ji,floorCache:Jo,fetchGeoJSON:xf}),Dn=Object.entries(Yn||{}).sort((ur,yr)=>(yr[1]?.totalSF||0)-(ur[1]?.totalSF||0)||(yr[1]?.rooms||0)-(ur[1]?.rooms||0))[0]||null;xn=Dn?Dn[1]:_n,Gn=Dn?Dn[0]:"",xn&&(xn={...xn,__label:Gn||"campus"})}catch{}const dn=Lt?{maxTotal:260,maxPerBuilding:260,maxPerType:35}:{maxTotal:220,maxPerBuilding:90,maxPerType:25};xn&&en.length>dn.maxTotal?en=gG(en,xn,{maxTotal:dn.maxTotal,minPerType:Lt?8:5,maxPerType:Lt?45:35}):en=pL(en,dn);const ln=new Map;en.forEach(Yn=>{if(!Yn)return;[Yn.roomId,Yn.id,Yn.revitId].filter(Dn=>Dn!=null).map(Dn=>String(Dn)).forEach(Dn=>{ln.has(Dn)||ln.set(Dn,Yn)})});const Tn=Yn=>{if(!Yn||!en.length)return null;const _n=Hs(Yn?.buildingLabel||""),Dn=Md(Yn?.floorName||Yn?.floorId||""),ur=_I(Yn?.roomLabel||Yn?.roomNumber||"");if(ur){const mo=en.find(Qs=>{const bl=Hs(Qs?.buildingLabel??Qs?.buildingName??Qs?.building??"");if(_n&&bl!==_n||Dn.length&&!Pd(Qs?.floorName??Qs?.floorId??"",Dn))return!1;const Do=_I(Qs?.roomLabel??Qs?.roomNumber??"");return Do&&Do===ur});if(mo)return mo}const yr=xg(Yn?.type||""),vi=Number(Yn?.sf||0),er=Number.isFinite(vi)&&vi>0;let Mo=null,ls=Number.POSITIVE_INFINITY;return en.forEach(mo=>{const Qs=Hs(mo?.buildingLabel??mo?.buildingName??mo?.building??"");if(_n&&Qs!==_n||Dn.length&&!Pd(mo?.floorName??mo?.floorId??"",Dn))return;const bl=xg(mo?.type||mo?.roomType||"");let Do=0;if(yr&&bl?Do+=bl===yr?0:1e3:yr&&(Do+=500),er){const wl=Number(mo?.sf??mo?.area??mo?.areaSF??0);Number.isFinite(wl)&&(Do+=Math.abs(wl-vi))}Do<ls&&(ls=Do,Mo=mo)}),Mo},kr={universityId:e,campusLabel:Se||e||"Campus",buildingLabel:Lt||"",floorId:Ct,moveScenarioMode:!0,scenarioDepartment:as||Qe||"",targetDepartment:Qe||as||"",excludeBuildings:ct||[],scenarioLabel:(Cl||"").trim(),scope:Lt?"building":"campus"},ti=xn?{totalSF:Math.round(xn.totalSF||0),rooms:Math.round(xn.rooms||0),sfByType:Object.entries(xn.sfByRoomType||{}).map(([Yn,_n])=>({type:Yn,sf:Math.round(Number(_n||0)||0)})),roomTypes:Object.entries(xn.roomTypes||{}).map(([Yn,_n])=>({type:Yn,count:Math.round(Number(_n||0)||0)}))}:null,cr=ti?{baselineTotals:ti,targetSfTolerance:Ol?.05:.1}:null,Lr=await Zi({request:q,context:kr,inventory:en,constraints:cr}),_i=Array.isArray(Lr?.recommendedCandidates)?Lr.recommendedCandidates.map(Yn=>{const Dn=[Yn?.roomId,Yn?.id,Yn?.revitId].filter(vi=>vi!=null).map(vi=>String(vi)).map(vi=>ln.get(vi)).find(Boolean)||Tn(Yn);if(!Dn)return{...Yn,floorName:Yn?.floorName||Yn?.floorId||"",rationale:Vw(Yn?.rationale)};const ur=Number(Dn.sf??Dn.area??Dn.areaSF??0),yr=Number(Yn?.sf??0);return{...Yn,roomId:Yn?.roomId||Dn.roomId||Dn.id||"",id:Yn?.id||Dn.id||Dn.roomId||"",revitId:Yn?.revitId??Dn.revitId??null,roomGuid:Yn?.roomGuid??Dn.roomGuid??Dn.revitId??null,buildingLabel:Yn?.buildingLabel||Dn.buildingLabel||Dn.buildingName||Dn.building||"",roomLabel:Yn?.roomLabel||Dn.roomLabel||Dn.roomNumber||"",type:Yn?.type||Dn.type||Dn.roomType||"",sf:Number.isFinite(yr)&&yr>0?yr:Number.isFinite(ur)?ur:0,vacancy:Dn.vacancy??Yn.vacancy,occupant:Dn.occupant??Yn.occupant,occupancyStatus:Dn.occupancyStatus??Yn.occupancyStatus,occupantDept:Dn.occupantDept??Yn.occupantDept,department:Dn.department??Yn.department,floorName:Yn?.floorName||Yn?.floorId||Dn.floorName||Dn.floorId||"",rationale:Vw(Yn?.rationale)}}):[],xi=qa(Lt||tI(_i)||"");let ci=_i,Qi="";if(xn){const{candidates:Yn,added:_n}=ZA(_i,en,xn,{targetTolerance:cr?.targetSfTolerance??.1,maxCandidates:Ol?40:30,primaryBuilding:xi});_n>0&&(ci=Yn,Qi=`Auto-filled ${_n} rooms to better match baseline SF and room-type mix.`)}const Jr=Yn=>QA(Yn?.type)||JA(Yn?.type),ai=xi||tI(ci)||"";if(ai){const Yn=ci.filter(_n=>qa(_n?.buildingLabel||"")===ai?!0:Jr(_n));if(Yn.length&&(ci=Yn,Qi=`${Qi?Qi+" ":""}Constrained scenario to a single building (${ai}), allowing labs/classrooms to remain outside if needed.`),xn){const _n=en.filter(yr=>{if(qa(yr?.buildingLabel??yr?.building??yr?.buildingName??"")===ai)return!0;const er=yr?.type??yr?.roomType??"";return QA(er)||JA(er)}),{candidates:Dn,added:ur}=ZA(ci,_n,xn,{targetTolerance:cr?.targetSfTolerance??.1,maxCandidates:Ol?40:30,primaryBuilding:ai});ur>0&&(ci=Dn,Qi=`${Qi?Qi+" ":""}Auto-filled ${ur} rooms to better match baseline SF.`)}}ci=gL(ci,ai);const ds=xn?.totalSF||Lr?.baselineTotals?.totalSF||0,li=Math.round((cr?.targetSfTolerance??.1)*100),Hr=ds?[`Aim for total SF within +/-${li}% of baseline department total SF (${Math.round(ds).toLocaleString()} SF).`]:[],qi=Array.isArray(Lr?.selectionCriteria)?Lr.selectionCriteria.filter(Yn=>!/baseline|total\s*sf|sf within/i.test(Yn||"")):[];Ts({...Lr,baselineTotals:xn||Lr?.baselineTotals,selectionCriteria:[...Hr,...Qi?[Qi]:[],...qi],recommendedCandidates:ci}),wo(!1)}catch(q){Es(String(q?.message||q))}finally{Fs(!1)}},[jn,Se,Vs,so,fn,kt,Ta,Zi,Za,Ji,xf,as,Cl,$,Dr,e]),Oa=vr(async()=>{qo(""),Nu(!0),qs(null);try{const q=(ya||"").trim();if(!q)throw new Error("Type a question first.");const be=fn&&Array.isArray(kt)?kt:[],Me=vI(be),Qe=xI(q,Me)||"",ct=bI(be),Xe=wI(q,ct)||"",ot=/best new suitable home|suitable home|best home|relocat|move|find space|new home|anywhere|entire campus|campus[-\s]?wide|across campus/i.test(q),Lt=/\b(basement|ground floor|first floor|second floor|third floor|fourth floor|fifth floor|sixth floor|seventh floor|eighth floor|ninth floor|tenth floor|level\s*\d+|level\s*(one|two|three|four|five|six|seven|eight|nine|ten)|lvl\s*\d+|floor\s*\d+|floor\s*(one|two|three|four|five|six|seven|eight|nine|ten))\b/i.test(q),Ht=/\b(entire campus|campus[-\s]?wide|across campus|anywhere on campus)\b/i.test(q)||/\bwhere\s+(is|are)\b|\blocation of\b|\bwhere\b.*\b(located|location)\b|\bwhich building\b|\bwhat building\b/i.test(q)&&!Xe,Ct=ot&&Qe?SI(be,Qe):[],en=new Set((Ct||[]).map(_n=>Hs(_n)).filter(Boolean)),xn={first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,tenth:10},Gn=(()=>{if(!Lt)return"";const _n=q.toLowerCase();if(_n.includes("basement"))return"BASEMENT";if(_n.includes("ground floor"))return"LEVEL_1";const Dn=_n.match(/level\s*(\d+)/);if(Dn)return`LEVEL_${Dn[1]}`;const ur=_n.match(/floor\s*(\d+)/);if(ur)return`LEVEL_${ur[1]}`;const yr=_n.match(/\b(first|second|third|fourth|fifth|sixth|seventh|eighth|ninth|tenth)\s+floor\b/);return yr?`LEVEL_${xn[yr[1]]}`:""})(),dn=Xe||"",ln=Xe||"",Tn=!Xe||ot||Ht,kr=!Tn&&!!Xe&&!!Gn,ti={universityId:e,campusLabel:Se||e||"Campus",buildingId:dn,buildingLabel:Xe||"",floorId:kr?Gn:"",scope:Tn?"campus":kr?"floor":Xe?"building":"campus",targetDepartment:Qe||"",excludeBuildings:Ct||[]},cr=(()=>{if(!fn)return[];if(Tn||!Xe)return kt;const _n=Hs(Xe);if(!_n)return kt;const Dn=kt.filter(yr=>{const vi=yr?.building??yr?.buildingName??yr?.buildingLabel??"";return Hs(vi)===_n});if(!kr)return Dn;const ur=Md(Gn);return ur.length?Dn.filter(yr=>Pd(yr?.floor??yr?.floorName??yr?.floorId??"",ur)):Dn})(),Lr=en.size?cr.filter(_n=>{const Dn=__(_n);return!en.has(Hs(Dn))}):cr,_i=(_n,Dn={})=>{if(!Array.isArray(_n))return[];const ur=Number(Dn.maxRows||400);if(_n.length<=ur)return _n;const yr=Hs(Dn.inferredDept||"");let vi=_n;if(yr&&(vi=_n.filter(Qs=>{const bl=String(Qs?.department??Qs?.occupantDept??"").trim();return Hs(bl)===yr}),vi.length<=ur))return vi;const er=new Map;vi.forEach(Qs=>{const bl=Hs(__(Qs));er.has(bl)||er.set(bl,[]),er.get(bl).push(Qs)});const Mo=Math.max(1,Math.floor(ur/Math.max(1,er.size||1))),ls=[];if(er.forEach(Qs=>{ls.push(...Qs.slice(0,Mo))}),ls.length>=ur)return ls.slice(0,ur);const mo=vi.filter(Qs=>!ls.includes(Qs));return ls.concat(mo.slice(0,Math.max(0,ur-ls.length)))};if(e$(q)){const _n=Lr.filter(ur=>nv(ur?.type??ur?.roomType??"")),Dn=Tn?"campus":Xe||"selected scope";qs({answer:`Found ${_n.length.toLocaleString()} classrooms in ${Dn}.`,bullets:["Count is based on room type labels that include classroom/teaching room definitions."],resultType:"none",columns:[],rows:[],dataUsed:["roomRows"],missingData:[]});return}if(QG(q)){const _n=EI(Lr),Dn=Tn?"campus":Xe||"selected scope";qs({answer:`Found ${_n.length.toLocaleString()} vacant offices in ${Dn}.`,bullets:["Only rooms marked vacant/available and without an occupant are counted."],resultType:"none",columns:[],rows:[],dataUsed:["roomRows"],missingData:_n.length?[]:["Vacancy status","Room inventory"]});return}if(JG(q)){let _n=EI(Lr);if(_n.some(yr=>!String(yr?.["Room Number"]||"").trim()))try{const vi=await Ta(Tn?"__all__":ln||"__all__",""),er=new Map;(vi||[]).forEach(Mo=>{const ls=String(Mo?.roomNumber??"").trim();if(!ls||cm(ls))return;const mo=bm(Mo?.revitId??Mo?.roomId??"");mo&&(er.has(mo)||er.set(mo,ls))}),_n=_n.map(Mo=>{if(String(Mo?.["Room Number"]||"").trim())return Mo;const mo=bm(Mo?.__lookupKey??"");if(!mo)return Mo;const Qs=er.get(mo)||"";return Qs?{...Mo,"Room Number":Qs}:Mo})}catch{}const Dn=Tn?"campus":Xe||"selected scope",ur=_n.length?`Found ${_n.length.toLocaleString()} vacant offices in ${Dn}.`:`No vacant offices were found in ${Dn} with explicit vacancy data.`;qs({answer:ur,bullets:["Only rooms marked as vacant/available and not currently assigned to an occupant are included."],resultType:_n.length?"table":"none",columns:_n.length?["Building","Room Number","Room Type","Square Feet"]:[],rows:_n,dataUsed:["roomRows"],missingData:_n.length?[]:["Vacancy status","Room inventory"]});return}const xi=/\bwhere\s+(is|are)\b|\blocation of\b|\bwhere\b.*\b(located|location)\b|\bwhich building\b|\bwhat building\b/i.test(q),ci=(()=>{const _n=[];if(Qe&&_n.push(Qe),/\bpresident'?s?\b/i.test(q)&&_n.push("president"),/\bprovost\b/i.test(q)&&_n.push("provost"),/\bdean\b/i.test(q)&&_n.push("dean"),!_n.length)return[];const Dn=_n.map(ur=>Hs(ur)).filter(Boolean);return Lr.filter(ur=>{const yr=String(ur?.department??ur?.occupantDept??"").trim(),vi=String(ur?.occupant??"").trim(),er=String(ur?.roomNumber??ur?.roomLabel??"").trim(),Mo=Hs(`${yr} ${vi} ${er}`);return Dn.some(ls=>ls&&Mo.includes(ls))})})();if(xi&&ci.length){const _n=new Map;ci.forEach(ur=>{const yr=__(ur)||"Unknown Building";_n.has(yr)||_n.set(yr,[]),_n.get(yr).push(ur)});const Dn=Array.from(_n.entries()).map(([ur,yr])=>{const vi=yr.map(Qs=>Qs?.roomNumber||Qs?.roomLabel||Qs?.roomId||Qs?.id||Qs?.revitId||"").filter(Boolean),er=Array.from(new Set(vi)),Mo=yr.map(Qs=>Qs?.occupant||Qs?.department||Qs?.type||"").filter(Boolean),ls=Array.from(new Set(Mo)),mo=er.length?`Rooms: ${er.slice(0,12).join(", ")}`:ls.length?`Rooms: (not labeled)  ${ls.slice(0,3).join(", ")}`:"Rooms: (not labeled)";return`${ur}  ${mo}`});qs({answer:"Here are the rooms matching that request across campus.",bullets:Dn,resultType:"none",columns:[],rows:[],dataUsed:["roomRows"],missingData:[]});return}const Qi=ci.length?ci:Lr,Jr=_i(Qi,{maxRows:Qe?180:100,inferredDept:Qe}),ai=oy(Lr),ds=kr&&ai?{...ai,floorLabel:Gn}:null,li=!kr&&Xe&&ai?ai:null;let Hr=null;if(Jr.length)Hr=Jr.map(_n=>{const Dn=Number(_n?.areaSF??_n?.area??_n?.sf??0),ur=Number(_n?.seatCount??_n?.SeatCount??_n?.["Seat Count"]??0),yr=A2(_n);return{building:_n?.building??_n?.buildingName??_n?.buildingLabel??ln,floor:_n?.floor??_n?.floorName??_n?.floorId??"",roomNumber:yr||"",type:String(_n?.type??_n?.roomType??"").trim(),department:String(_n?.department??"").trim(),area:Number.isFinite(Dn)?Math.round(Dn):"",seatCount:Number.isFinite(ur)&&ur>0?ur:"",occupant:String(_n?.occupant??"").trim(),occupancyStatus:String(_n?.occupancyStatus??"").trim()}});else try{const Dn=await Ta(Tn?"__all__":ln||"__all__","");if(Array.isArray(Dn)){const ur=en.size?Dn.filter(vi=>!en.has(Hs(vi.building))):Dn,yr=_i(ur,{maxRows:Qe?180:100,inferredDept:Qe});Hr=ln?yr:yr.slice(0,Qe?180:100)}else Hr=null}catch{Hr=null}const Yn=await ks({question:q,context:ti,data:{campusStats:$r,buildingStats:!Tn&&Xe&&!kr&&li||void 0,floorStats:kr&&ds||void 0,dashboardMetrics:void 0,scopeSummary:ai||void 0,roomRows:Hr||void 0}});qs(Yn)}catch(q){qo(String(q?.message||q))}finally{Nu(!1)}},[jn,Se,ya,B,$,Dr,e,fn,kt,$r,nn,sr,Lo,Si,ks,Rd,Ta]),Wh=vr(()=>{if(ji)try{const q=new $i("p","pt","letter"),be=q.internal.pageSize.getWidth(),Me=q.internal.pageSize.getHeight(),Qe=24,ct=be-Qe*2,Xe=14;let ot=Qe;const Lt=(dn=Xe)=>{ot+dn<=Me-Qe||(q.addPage(),ot=Qe)},Ht=(dn,ln={})=>{const Tn=String(dn??"").trim();if(!Tn)return;const kr=ln.fontStyle||"normal",ti=ln.fontSize||11;q.setFont(void 0,kr),q.setFontSize(ti),q.splitTextToSize(Tn,ct).forEach(Lr=>{Lt(Xe),q.text(Lr,Qe,ot),ot+=Xe})},Ct=(dn=8)=>{Lt(dn),ot+=dn};Ht("Ask Mapfluence",{fontStyle:"bold",fontSize:14}),Ct(4),Ht(`Question: ${ya||"(no question)"}`,{fontSize:10}),Ct(8),Ht(`Answer: ${ji.answer||""}`),Array.isArray(ji.bullets)&&ji.bullets.length&&(Ct(8),Ht("Notes:",{fontStyle:"bold"}),ji.bullets.forEach(dn=>Ht(`- ${dn}`)));const en=Array.isArray(ji.columns)?ji.columns:[],xn=Array.isArray(ji.rows)?ji.rows:[];en.length&&xn.length&&(Ct(10),Ht("Table:",{fontStyle:"bold"}),Ht(en.join(" | "),{fontStyle:"bold",fontSize:10}),xn.forEach(dn=>{const ln=en.map(Tn=>{const kr=dn&&dn[Tn]!=null?dn[Tn]:"";return String(kr)});Ht(ln.join(" | "),{fontSize:10})})),Array.isArray(ji.missingData)&&ji.missingData.length&&(Ct(8),Ht(`Missing data: ${ji.missingData.join(", ")}`,{fontSize:10}));const Gn=String(ya||"ask-mapfluence").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,60)||"ask-mapfluence";q.save(`${Gn}.pdf`)}catch(q){console.error("Ask Mapfluence PDF export failed",q),alert("PDF export failed - see console for details.")}},[ji,ya]),Cf=vr(async()=>{if(!ji)return;const q=Array.isArray(ji.columns)?ji.columns:[],be=Array.isArray(ji.rows)?ji.rows:[];if(!q.length||!be.length){alert("No table data available to copy.");return}const Me=Xe=>{if(Xe==null)return"";const ot=String(Xe);return/[",\n]/.test(ot)?`"${ot.replace(/"/g,'""')}"`:ot},Qe=[q.map(Me).join(",")];be.forEach(Xe=>{Qe.push(q.map(ot=>Me(Xe&&Xe[ot]!=null?Xe[ot]:"")).join(","))});const ct=Qe.join(`
`);try{if(navigator?.clipboard?.writeText)await navigator.clipboard.writeText(ct);else throw new Error("Clipboard API unavailable")}catch{try{const Xe=document.createElement("textarea");Xe.value=ct,Xe.setAttribute("readonly",""),Xe.style.position="fixed",Xe.style.left="-9999px",document.body.appendChild(Xe),Xe.select(),document.execCommand("copy"),document.body.removeChild(Xe)}catch{alert("Copy failed. Please use Export PDF.");return}}alert(`Copied ${be.length.toLocaleString()} rows to clipboard (CSV).`)},[ji]),Wc=vr(()=>{const q=String(mt||"").trim();if(!/^pk\./i.test(q)){qr("Enter a valid Mapbox public token (starts with pk.).");return}try{window.localStorage.setItem("MAPBOX_PUBLIC_TOKEN",q)}catch{}zf.accessToken=q,qr(""),on(!1),window.location.reload()},[mt]);Oi(()=>{const q=So.current;if(!q||q.buildingLabel!==$||q.floorId!==Dr)return;So.current=null;const be=fs.current||[];fs.current=null,(async()=>{try{if(!await ts())return}catch{}H(be)})()},[$,Dr,ts,H]);const Xc=vr(async()=>{const q=xs?.recommendedCandidates||[];if(!q.length)return;const be=xs?.scenarioDept||as||"";$h(!0),be&&Ja(be);const Me=q[0],Qe=Me?.buildingLabel||$,ct=Me?.floorName||Me?.floorId||Dr;let Xe=ct;if(Qe){const Lt=await Za(Qe);Xe=rv(ct,Lt)||Lt?.[0]||ct}if(Qe&&Xe&&(Qe!==$||Xe!==Dr)){So.current={buildingLabel:Qe,floorId:Xe},fs.current=q,J(Qe),Is(Xe);return}H(q)},[xs?.recommendedCandidates,xs?.scenarioDept,H,Za,as,$,Dr,$h,Ja,J,Is]),Zu=vr(q=>{const be=q?.recommendedCandidates||[];if(!be.length)return;const Me=q?.scenarioDept||as||"";$h(!0),Me&&Ja(Me),H(be),os(!0)},[H,as,$h,Ja]),fh=vr(async(q,be)=>{const Me=q&&typeof q=="object"?null:q,Qe=be||Ss||"rooms";uo(!0),Kl(Qe==="summary"?"Preparing summary export...":"Building export data...");try{const ct=Gn=>{if(Gn==null)return"";const dn=String(Gn);return/[",\n]/.test(dn)?`"${dn.replace(/"/g,'""')}"`:dn};if(Qe==="summary"){const{campusRow:Gn,buildingRows:dn}=await Ku(Me||Pa,ou),ln=[...Gn?[Gn]:[],...dn];if(!ln.length){Kl("No matching rooms found."),uo(!1);return}const kr=[["BuildingId","BuildingName","TotalSF","Rooms","ClassroomSF","Classrooms","LabSF","Labs","OfficeSF","Offices","KeyDepts"].join(",")];ln.forEach(xi=>{kr.push([ct(xi.buildingId),ct(xi.buildingName),ct(xi.totalSf),ct(xi.rooms),ct(xi.classroomSf),ct(xi.classrooms),ct(xi.labSf),ct(xi.labs),ct(xi.officeSf),ct(xi.offices),ct(xi.keyDepts)].join(","))});const ti=new Blob([kr.join(`
`)],{type:"text/csv;charset=utf-8;"}),cr=document.createElement("a");cr.href=URL.createObjectURL(ti);const Lr=Me||Pa,_i=Lr&&Lr!=="__all__"?Lr.replace(/\s+/g,"-").toLowerCase():"campus";cr.download=`${_i}-space-summary.csv`,document.body.appendChild(cr),cr.click(),document.body.removeChild(cr),Kl(`Exported ${ln.length} summary rows`);return}const Xe=await Ta(Me||Pa,ou);if(!Xe.length){Kl("No matching rooms found."),uo(!1);return}const Lt=[["Building","Floor","Room","Type","Department","AreaSF","SeatCount","Occupant"].join(",")];Xe.forEach(Gn=>{Lt.push([ct(Gn.building),ct(Gn.floor),ct(Gn.roomNumber),ct(Gn.type),ct(Gn.department),ct(Gn.area),ct(Gn.seatCount),ct(Gn.occupant)].join(","))});const Ht=new Blob([Lt.join(`
`)],{type:"text/csv;charset=utf-8;"}),Ct=document.createElement("a");Ct.href=URL.createObjectURL(Ht);const en=Me||Pa,xn=en&&en!=="__all__"?en.replace(/\s+/g,"-").toLowerCase():"campus";Ct.download=`${xn}-space-data.csv`,document.body.appendChild(Ct),Ct.click(),document.body.removeChild(Ct),Kl(`Exported ${Xe.length} rows`)}catch(ct){console.warn("Space export failed",ct),Kl("Export failed. See console.")}finally{uo(!1)}},[Ta,Ku,Pa,ou,Ss]);vr(()=>{try{de([]),le([])}catch{}},[]);const Hf=vr(()=>{try{const be=y.current?.getCanvas?.();if(!be){alert("Map is not ready yet.");return}const Me=new Date().toISOString().replace(/[:.]/g,"-"),Qe=He?"heatmap":"markers",ct=(e||"campus").replace(/\s+/g,"-").toLowerCase(),Xe=document.createElement("a");Xe.href=be.toDataURL("image/png"),Xe.download=`${ct}-${Qe}-${Me}.png`,document.body.appendChild(Xe),Xe.click(),document.body.removeChild(Xe)}catch(q){console.warn("PNG export failed",q),alert("PNG export failed. See console for details.")}},[He,e]),Yc=vr(()=>{ge(q=>{const be=!q;try{const Me=new URL(window.location.href);be?Me.searchParams.set("presentation","1"):Me.searchParams.delete("presentation"),window.history.replaceState({},"",`${Me.pathname}${Me.search}${Me.hash}`)}catch{}return be})},[]),kf=vr(()=>{const be=y.current?.getCanvas?.();if(!be){alert("Map is not ready yet.");return}const Me=Ce,Qe=It;Ve(!0),ge(!0),Oe(!1);const ct=()=>{try{const Xe=new Date().toISOString().replace(/[:.]/g,"-"),ot=(e||"campus").replace(/\s+/g,"-").toLowerCase(),Lt=document.createElement("a");Lt.href=be.toDataURL("image/png"),Lt.download=`${ot}-presentation-${Xe}.png`,document.body.appendChild(Lt),Lt.click(),document.body.removeChild(Lt)}catch(Xe){console.warn("Clean PNG export failed",Xe),alert("Clean PNG export failed. See console for details.")}finally{ge(Me),Oe(Qe),Ve(!1)}};requestAnimationFrame(()=>requestAnimationFrame(ct))},[Ce,It,e]),Kc=vr(()=>{try{Be({}),G({})}catch{}},[]),[Nh,dh]=rr(null),[Wf,Xh]=rr(null),[Yh,Xf]=rr(null),[eu,Sc]=rr(null),tu=vr(()=>c.current?.getBoundingClientRect()||{left:0,top:0,width:window.innerWidth,height:window.innerHeight},[]),$l=vr(()=>({left:0,top:0,width:window.innerWidth,height:window.innerHeight}),[]),uc=vr(q=>V0(q,L,Xh,tu),[tu]),Zc=vr(q=>V0(q,R,zl,$l),[$l]),Rh=vr(q=>V0(q,U,Du,tu),[tu]),Jc=Ks(null),Yf=Ks(null),Cg=vr(q=>V0(q,Jc,Xf,$l),[$l]),Sm=vr(q=>V0(q,Yf,Sc,$l),[$l]),Em={onPointerDown:uc,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},Tm={onPointerDown:Zc,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},Am={onPointerDown:Rh,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},Mh={onPointerDown:Cg,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},kg={onPointerDown:Sm,style:{cursor:"grab",userSelect:"none",touchAction:"none"}};if(Ks(null),!e)return se.jsx("div",{children:"Loading University..."});const np=Ml(()=>$m(Th,"universities",e,"markers"),[e]),xl=Ml(()=>$m(Th,"universities",e,"buildingConditions"),[e]),pi=Ml(()=>$m(Th,"universities",e,"buildingAssessments"),[e]);Ml(()=>$m(Th,"universities",e,"drawingEntries"),[e]);const Kh=Ml(()=>$m(Th,"moves"),[Th]),rp=({person:q,from:be,to:Me,effectiveDate:Qe,comments:ct,createdBy:Xe})=>({person:q||"",fromRoomId:be?.roomId||"",toRoomId:Me?.roomId||"",fromBuildingId:be?.buildingId||"",toBuildingId:Me?.buildingId||"",fromFloorId:be?.floorId||"",toFloorId:Me?.floorId||"",fromRoomLabel:be?.roomLabel||"",toRoomLabel:Me?.roomLabel||"",effectiveDate:Qe||"",comments:ct||"",createdAt:V1(),createdBy:Xe||"unknown"}),Ju=vr(async q=>{if(q)try{await LT(Kh,q)}catch(be){console.warn("Failed to log move",be)}},[Kh]),Im=()=>{Yt(null),Et(null),yo(null)},Lg=async()=>{if(!pn)return;const{from:q,to:be,effectiveDate:Me,comments:Qe,person:ct}=pn,Xe=qa(ct||q?.occupantName||"");if(!(!q||!be||!Xe))try{const ot=await Dt({roomId:q.roomId,buildingId:q.buildingId,buildingName:q.buildingName,floorName:q.floorId,revitId:q.revitId,roomLabel:q.roomLabel,properties:{occupant:""}}),Lt=await Dt({roomId:be.roomId,buildingId:be.buildingId,buildingName:be.buildingName,floorName:be.floorId,revitId:be.revitId,roomLabel:be.roomLabel,properties:{occupant:Xe}});ot&&Lt?await Ju(rp({person:Xe,from:q,to:be,effectiveDate:Me,comments:Qe,createdBy:x?.email||"unknown"})):console.warn("Move update incomplete, skipping move log.")}catch(ot){console.warn("Move confirmation failed",ot)}finally{Im()}},ph=Ml(()=>t!=="admin"?ve:ve.filter(q=>{const be=(q.persona||"").toLowerCase();return be.includes("student")?I:be.includes("staff")||be.includes("faculty")?j:!0}),[ve,I,j,t]),ju=Ml(()=>{if(!a||!Si)return ve;const q=ri.current||{},be=xp(q?.buildingId||B||$||""),Me=El(q?.floorId||Dr||""),Qe=String(q?.floorLabel||Dr||"").trim(),ct=Md(Qe||Me);return(ve||[]).filter(Xe=>{if(xp(Xe?.buildingId||Xe?.buildingName||Xe?.building||"")!==be)return!1;const Lt=String(Xe?.floorId||Xe?.floorLabel||Xe?.floor||"").trim();return El(Lt)===Me?!0:ct.length?Pd(Lt,ct):!1})},[ve,a,Si,B,$,Dr,Kr]),Dh=Ml(()=>({type:"FeatureCollection",features:(ju||[]).filter(q=>Array.isArray(q?.coordinates)&&Number.isFinite(Number(q.coordinates[0]))&&Number.isFinite(Number(q.coordinates[1]))).map(q=>({type:"Feature",properties:{heatCategory:Ix(q?.type),weight:v$(q?.type),markerType:q?.type||""},geometry:{type:"Point",coordinates:[Number(q.coordinates[0]),Number(q.coordinates[1])]}}))}),[ju]),Ec=Ml(()=>{const q={matchPairs:[],legendItems:[],roomCount:0,markerCount:0};if(!a||!xa||!Si||!Co)return q;const be=y.current,Me=be?jc(be,Va):null,Qe=Me&&(Me._data||Me.serialize?.().data)||null,ct=ri.current?.fc||null,Xe=Qu(ct||Qe);if(!Xe?.features?.length)return q;const ot=Xe.features.filter(dn=>lg(dn?.properties)==="room").filter(dn=>{const ln=String(dn?.geometry?.type||"");return ln==="Polygon"||ln==="MultiPolygon"}).map(dn=>{const ln=dn.properties||{},Tn=dn.id??ln.RevitId??ln.id;if(Tn==null)return null;const kr=Od(ln);return{feature:dn,idRaw:Tn,idKey:String(Tn),areaSf:Number.isFinite(kr)?kr:0}}).filter(Boolean);if(!ot.length)return q;const Lt=new Map;ot.forEach(dn=>Lt.set(dn.idKey,{counts:new Map,total:0}));let Ht=0;(ju||[]).filter(dn=>Array.isArray(dn?.coordinates)).forEach(dn=>{const ln=Number(dn?.coordinates?.[0]),Tn=Number(dn?.coordinates?.[1]);if(!Number.isFinite(ln)||!Number.isFinite(Tn))return;const kr=ma([ln,Tn]);for(const ti of ot){let cr=!1;try{cr=kU(kr,ti.feature)}catch{cr=!1}if(!cr)continue;const Lr=Ix(dn?.type),_i=Lt.get(ti.idKey),xi=_i.counts.get(Lr)||0;_i.counts.set(Lr,xi+1),_i.total+=1,Ht+=1;break}});const Ct=new Map,en=[];let xn=0;ot.forEach(dn=>{const ln=Lt.get(dn.idKey);if(!ln||!ln.total)return;xn+=1;const kr=Array.from(ln.counts.entries()).sort((Lr,_i)=>{if((_i[1]||0)!==(Lr[1]||0))return(_i[1]||0)-(Lr[1]||0);const xi=ug[Lr[0]]?.heatValue??0;return(ug[_i[0]]?.heatValue??0)-xi})[0]?.[0]||"comment",ti=ug[kr]?.color||"#9ca3af";en.push(dn.idKey,ti);const cr=Ct.get(kr)||{category:kr,label:p$[kr]||kr,color:ti,roomCount:0,markerCount:0,areaSf:0};cr.roomCount+=1,cr.markerCount+=ln.total,cr.areaSf+=dn.areaSf||0,Ct.set(kr,cr)});const Gn=Array.from(Ct.values()).sort((dn,ln)=>(ln.roomCount||0)-(dn.roomCount||0));return{matchPairs:en,legendItems:Gn,roomCount:xn,markerCount:Ht}},[a,xa,Si,Co,ju,Kr]);Oi(()=>{if(!M)return;const q=y.current;if(!(!q||!q.getLayer(lo))){if(!a||!xa||!Si||!Co){q0(q);return}if(Wa==="solid"){q0(q);try{const be=Ec.matchPairs.length?["match",["to-string",["coalesce",["id"],["get","RevitId"],["get","id"]]],...Ec.matchPairs,"#f3f4f6"]:"#f3f4f6";q.setPaintProperty(lo,"fill-color",be),q.setPaintProperty(lo,"fill-opacity",.9)}catch{}return}try{q.setPaintProperty(lo,"fill-color","#ffffff"),q.setPaintProperty(lo,"fill-opacity",.96)}catch{}try{const be=jc(q,Va),Me=be&&(be._data||be.serialize?.().data)||null,Qe=Qu(ri.current?.fc||Me),ct=new Map,Xe=Ec.matchPairs||[];for(let Ht=0;Ht<Xe.length;Ht+=2){const Ct=Xe[Ht],en=Xe[Ht+1];Ct==null||!en||ct.set(String(Ct),en)}const ot=_$(Qe,ct);if(!ot?.features?.length){q0(q);return}oG(q,Tx,ot);const Lt=q.getLayer(lf)?lf:q.getLayer(Vc)?Vc:void 0;for(let Ht=0;Ht<Ax;Ht+=1){const Ct=`${LL}${Ht}`,en=y$[Ht]??.5;if(!q.getLayer(Ct))q.addLayer({id:Ct,type:"fill",source:Tx,filter:["==",["get","band"],Ht],paint:{"fill-color":["get","color"],"fill-opacity":en}},Lt);else{try{q.setFilter(Ct,["==",["get","band"],Ht])}catch{}try{q.setPaintProperty(Ct,"fill-color",["get","color"])}catch{}try{q.setPaintProperty(Ct,"fill-opacity",en)}catch{}}}Sx(q)}catch{q0(q)}}},[M,a,xa,Wa,Si,Co,Ec,Kr]),Oi(()=>{!M||!a||!Si||xa||(q0(y.current),f(Vi))},[M,a,Si,xa,Vi,f]),Oi(()=>{(!xa||!Si||!Co)&&yu(!1)},[xa,Si,Co]);const Tc=Ml(()=>t==="admin"?{...G1.student,...G1.staff}:G1[i]||G1.default,[i,t]),vd=Ml(()=>{const q={};return Object.keys(Tc||{}).forEach(be=>{q[be]=x$(be)}),q},[Tc]);Oi(()=>{const q=wv();Ej(q).catch(()=>{});const be=Yz(q,async Me=>{if(l(Me||null),!Me){b(!1);return}try{const Qe=await kT(yy(Th,"universities",e,"roles",Me.uid));b(!!Qe.exists()&&Qe.data()?.role==="admin")}catch{b(!1)}});return()=>be()},[e]);async function ip(){try{const q=wv(),be=new Fd;try{await gj(q,be)}catch{await wj(q,be)}}catch{}}function Fp(){try{Kz(wv())}catch{}}Oi(()=>{e&&(async()=>{try{const q=$m(Th,"universities",e,"buildings"),be=await U1(q);if(!be.empty){const Qe=be.docs.map(ct=>({id:ct.id,name:ct.data()?.name||ct.id}));!$&&Qe.length&&J(Qe[0].id);return}const Me=await fetch(Lv);if(Me.ok){const Qe=await Me.json(),ct=Object.entries(Qe.buildings||{}).map(([Xe,ot])=>({id:Xe,name:ot?.name||Xe}));!$&&ct.length&&J(ct[0].id)}}catch(q){console.warn("Building options load failed:",q)}})()},[e]),Oi(()=>{let q=!1;const be=()=>{vc([]),Is(void 0)};return(async()=>{const Me=iy(B,hl)||iy($,hl);if(!Me){be();return}const Qe=await $A(Me);if(q)return;const ct=(Qe||[]).map(ot=>_y(ot?.id)).filter(Boolean),Xe=new Map((Qe||[]).filter(ot=>ot?.id&&ot?.url).map(ot=>[ot.id,ot.url]));Mu.current.set(Me,ct),xc.current.set(Me,Xe),ct.length?(vc(ct),Is(ot=>ot&&ct.includes(ot)?ot:ct[0])):be()})(),()=>{q=!0}},[B,$,hl]),Oi(()=>{let q=!1;return(async()=>{fa(!0),ee(null),ml("Campus Summary");try{const be=await sd("/ai/api/rooms",{cache:"no-store",timeoutMs:8e3});let Me=null;try{Me=await be.json()}catch{}if(!be.ok){const Qe=Me?.error||Me?.message||`Rooms fetch failed (${be.status})`;throw new Error(Qe)}if(Me?.ok&&Array.isArray(Me.rooms)&&(q||(At(Me.rooms),Bs(new Date)),Me.rooms.some(s$)))return;throw new Error("Rooms payload missing or invalid")}catch{try{let Me=Ns.current;Me||(Me=await N_(Lv),Ns.current=Me);const Qe=await TI(Me);if(!Qe.length)throw new Error("No floorplan rooms found for dashboard");q||(sn(Qe),ee(null),Qn(!0))}catch(Me){q||ee(Me)}}finally{q||fa(!1)}})(),()=>{q=!0}},[e]),Oi(()=>{const be=setInterval(()=>{gt()},18e5);return()=>clearInterval(be)},[gt]),Oi(()=>{let q=!1;return(async()=>{try{const be=await fetch(ud(NG),{cache:"no-store"});if(!be.ok)throw new Error(`Utilization CSV fetch failed (${be.status})`);const Me=await be.text(),Qe=MG(Me);q||Ys(Qe)}catch(be){console.warn("Unable to load classroom utilization data",be)}})(),()=>{q=!0}},[]);const Lf=Ml(()=>{if(!fn)return[];if(!(!!B||Si))return kt;const be=qa(jn);if(!!!be)return kt;const Qe=new Set([Hs(jn),Hs(B),Hs($)].filter(Boolean));if(!Qe.size)return kt;const ct=kt.filter(Ht=>{const Ct=Ht?.building??Ht?.buildingName??Ht?.buildingLabel??"";return Qe.has(Hs(Ct))});if(!!!(Si&&be))return ct;const ot=qa(ri.current?.floorLabel||Dr||""),Lt=Md(ot);return Lt.length?ct.filter(Ht=>Pd(Ht?.floor??Ht?.floorName??Ht?.floorId??"",Lt)):ct},[kt,fn,jn,B,$,Si,Dr]),Cm=Ml(()=>{if(!(!!B||Si))return"Campus";const be=qa(jn);if(!!!be)return"Campus";const Qe=qa(sr?.floorLabel||ri.current?.floorLabel||Dr||"");return!!(Si&&be&&Qe)?`${be} ${Qe}`:be},[jn,B,$,Si,Dr,sr]),sp=Ml(()=>{if(!!B||Si){const be=qa(jn);return be?ke(be):null}return O},[jn,B,$,Si,O,ke]),Pg=Ml(()=>!!B||Si?qa(jn)||"":O?Se:"",[jn,B,$,Si,O,Se]),Zh=Ml(()=>{if(!Si)return[];const q=ri.current||{},be=Hs(B||$||""),Me=Hs(q.buildingLabel||q.buildingId||q.building||"");if(be&&Me&&be!==Me)return[];const Qe=Md(Dr||"");if(Qe.length){const ot=q.floorLabel||q.floorId||q.floor||"";if(!Pd(ot,Qe))return[]}const ct=q.fc,Xe=Array.isArray(ct?.features)?ct.features:[];return Xe.length?Xe.filter(ot=>lg(ot?.properties)==="room"):[]},[Si,Kr,B,$,Dr]),Pf=Ml(()=>Si?Zh:(Lf||[]).map(IL).filter(Boolean),[Lf,Zh,Si]);Oi(()=>{if(!je.length)return;let q=!1;if(!je.some(Me=>wx(Me?.type)||wx(Me?.department)||n$(Me))){q||(sn(je),Qn(!0));return}return(async()=>{try{let Me=Ns.current;Me||(Me=await N_(Lv),Ns.current=Me);const Qe=await TI(Me);if(q)return;const ct=i$(je,Qe);sn(ct),Qn(!0)}catch{q||(sn(je),Qn(!0))}})(),()=>{q=!0}},[je]),Oi(()=>{if(!fn)return;const q=!!B||Si,be=qa(jn),Me=qa(sr?.floorLabel||ri.current?.floorLabel||Dr||""),Xe=!!(Si&&be&&Me)?`${be} ${Me} Summary`:!!(q&&be)?`${be} Summary`:"Campus Summary";ml(Xe);try{const ot=cq(Pf);_a(ot)}catch(ot){ee(ot)}},[fn,Pf,jn,B,$,Si,Dr,sr]),Oi(()=>{if(!fn||!Array.isArray(kt)||!kt.length||Si)return;const q=B||$;if(!q)return;const be=Hs(q);if(!be)return;const Me=kt.filter(ct=>{const Xe=ct?.building??ct?.buildingName??ct?.buildingLabel??"";return Hs(Xe)===be}),Qe=oy(Me);Qe&&(yn(Qe),wr(rh(Qe,"building")))},[fn,kt,Si,B,$]),Oi(()=>{if(!Si||!Zh.length)return;const q=ri.current||{},be=q.url||Go.current,Me=q.floorLabel||Dr||q.floor||"";if(!be)return;const Qe=dG(Zh);if(!Qe)return;const ct={...Qe,floorLabel:Me};Xa.current[be]=Qe,Ya.current.set(be,Qe),q.key&&Ya.current.set(q.key,Qe),Zn(ct);try{E(Vi)}catch{}wr(rh(Qe,"floor"))},[E,Vi,Si,Zh,Dr]),Oi(()=>{if(!M||!y.current||!Si)return;const q=!!(zs?.byGuid?.size||zs?.byComposite?.size),be=ia instanceof Map&&ia.size>0;if(!q&&!be)return;const Me=y.current,Qe=jc(Me,Va);if(!Qe)return;const ct=Qe._data||Qe.serialize?.()?.data||null,Xe=Qu(ct);if(!Xe?.features?.length)return;const ot=ri.current||{},Lt=ot.buildingId||B||$,Ht=ot.floorLabel||ot.floorId||ot.floor||Dr;let Ct=!1;const en=Xe.features.map(Gn=>{if(!Gn)return Gn;const dn=Gn.properties||{};if(lg(dn)!=="room")return Gn;let ln=dn,Tn=!1;if(q){const cr=AL(dn,zs,Lt,Ht);cr&&(ln=xx(ln,cr),Tn=!0)}if(be&&Lt&&Ht){const cr=Gn.id??dn.RevitId??dn.id,Lr=cr!=null?ld(Lt,Ht,cr):null,_i=Lr&&ia.get(Lr)||null;_i&&(ln=xx(ln,_i),Tn=!0)}const kr=wf(ln),ti=kr?String(kr).trim():ln.__roomType||"";return!Tn&&ti===dn.__roomType?Gn:(Ct=!0,{...Gn,properties:{...ln,__roomType:ti}})});if(!Ct)return;const xn={...Xe,features:en};try{Qe.setData(xn)}catch{}ri.current&&(ri.current={...ri.current,fc:xn}),wi(Gn=>Gn+1);try{f(Vi)}catch{}},[zs,ia,Vi,Si,M,B,$,Dr,f]),Oi(()=>{if(!n)return;let q=null,be=null;const Me=_.current;if(!Me)return;const Qe=()=>Me.clientWidth>0&&Me.clientHeight>0,ct=()=>{if(y.current)return;const ot=n&&n.style||"mapbox://styles/mapbox/streets-v12",Lt=typeof ot=="string"&&/^mapbox:\/\//i.test(ot),Ht=!!(zf.accessToken||"").trim();if(Lt&&!Ht){on(!0);return}on(!1);const Ct=ot,en=n?.initialCenter||[-98.3739,40.5939],xn=n?.initialZoom??16;console.log("Mapbox token length:",(zf.accessToken||"").length),console.log("Using style:",Ct);let Gn=null;try{Gn=new zf.Map({container:Me,style:Ct,center:en,zoom:xn,attributionControl:!1,preserveDrawingBuffer:!0})}catch(dn){console.error("Map constructor failed:",dn);return}if(!Gn){console.error("Map was not created (mapInstance is falsy).");return}Gn.on("error",dn=>{const ln=String(dn?.error?.message||"");/access token/i.test(ln)&&on(!0)}),y.current=Gn,typeof window<"u"&&(window.__map=Gn);try{Gn.addControl(new zf.NavigationControl,"top-right")}catch(dn){console.warn("Adding controls failed:",dn)}Gn.once("load",()=>{(async()=>{try{await YA(Gn,"mf-door-swing","/StakeholderMap/icons/door-swing.png")}catch(dn){console.warn("Door icon load failed:",dn)}try{await YA(Gn,"mf-stairs-run","/StakeholderMap/icons/stairs-run.png")}catch(dn){console.warn("Stairs icon load failed:",dn)}Q(!0);try{Gn.resize()}catch(dn){console.warn("resize() failed:",dn)}try{const dn=Qu(n?.boundary);if(dn?.features?.length){const[ln,Tn,kr,ti]=bG(dn);Number.isFinite(ln)&&Number.isFinite(Tn)&&Number.isFinite(kr)&&Number.isFinite(ti)&&Gn.fitBounds([[ln,Tn],[kr,ti]],{padding:40,duration:0})}}catch(dn){console.warn("fitBounds from boundary failed:",dn)}})()})};if(Qe())ct();else{try{be=new ResizeObserver(()=>{if(Qe()){try{be.disconnect()}catch{}be=void 0,ct()}}),be.observe(Me)}catch{}q=requestAnimationFrame(()=>{if(Qe()){if(be){try{be.disconnect()}catch{}be=void 0}ct()}})}const Xe=()=>{if(y.current)try{y.current.resize()}catch{}};try{window.addEventListener("resize",Xe)}catch{}return()=>{if(q&&cancelAnimationFrame(q),be)try{be.disconnect()}catch{}try{window.removeEventListener("resize",Xe)}catch{}if(y.current){try{y.current.remove()}catch{}y.current=null}}},[n]),Oi(()=>{t!=="admin"&&(!Bl&&!po&&sa.length===0||(No(!1),Ra(null),sc([]),ul.current=[]))},[t,Bl,po,sa.length]),Oi(()=>{(async()=>{try{let q;if(t==="admin"||a)q=AT(np);else{if(!i){de([]);return}q=AT(np,oz("persona","==",i))}const be=await U1(q);if(de(be.docs.map(ot=>({id:ot.id,...ot.data(),coordinates:[ot.data().coordinates.longitude,ot.data().coordinates.latitude]}))),t!=="admin"){Be({}),G({});return}const[Me,Qe]=await Promise.all([U1(xl),U1(pi)]),ct={};Me.forEach(ot=>{const Lt=ot.data().originalId||ot.id.replace(/__/g,"/");ct[Lt]=ot.data().condition}),Be(ct);const Xe={};Qe.forEach(ot=>{const Lt=ot.data().originalId||ot.id.replace(/__/g,"/");Xe[Lt]=ot.data()}),G(Xe)}catch(q){console.error("Failed to fetch data:",q),t==="admin"&&(Be({}),G({}))}})()},[t,a,e,i,np,xl,pi]),Oi(()=>{if(!B)return;const q=ce(B)||B;$!==q&&J(q)},[B,ce,$]),Oi(()=>{if(!a||!M)return;if(!Co){jl.current="";return}const q=xp(B||$||""),be=El(Dr||""),Me=uu(q),Qe=Me.some(Ht=>El(Ht)===be);if(!Me.length||!Qe){jl.current="";return}const ct=ri.current||{},Xe=xp(ct.buildingId||""),ot=El(ct.floorId||""),Lt=`${q}/${be}`;if(Si&&Xe===q&&ot===be){jl.current=Lt;return}jl.current!==Lt&&(jl.current=Lt,ts(Dr))},[a,Co,M,B,$,Dr,uu,Si,Kr]),Oi(()=>{a&&(Co||Si&&Ro())},[a,Co,Si,Ro]),Oi(()=>{a&&(Co||Ke(!0))},[a,Co]),Oi(()=>{(!a||!Co||!Si)&&Rc(!1)},[a,Co,Si]),Oi(()=>{if(Ka.current){try{Ka.current()}catch{}Ka.current=null}const q=B||$;if(!q||!Dr||!e)return;const be=gc(e),Me=xp(q),Qe=El(Dr),ct=$m(Th,"universities",be,"buildings",Me,"floors",Qe,"rooms");return Ka.current=uz(ct,Xe=>{const ot=new Map;Xe.forEach(Lt=>{const Ht=Lt.data();ot.set(Lt.id,{...Ht,buildingId:Ht.original?.buildingName??q,floor:Ht.original?.floorLabel??Dr,revitId:Ht.original?.featureId??Ht.revitId??Lt.id})}),ll(ot)}),()=>{if(Ka.current){try{Ka.current()}catch{}Ka.current=null}}},[B,$,Dr,e]),Oi(()=>{cl.current=B,B||(Wu.current=null,Ma.current=null,yn(null),Zn(null),Bi("building"),Go.current||wr(null))},[B]),Oi(()=>{if(a||!M||!y.current||!n)return;const q=y.current;if(!q.getSource("buildings")){if(q.addSource("buildings",{type:"geojson",data:n.buildings,promoteId:"id"}),q.addLayer({id:"buildings-layer",type:"fill-extrusion",source:"buildings",paint:{"fill-extrusion-color":vf(Ym),"fill-extrusion-height":15,"fill-extrusion-opacity":.7}}),q.addLayer({id:"buildings-outline-base",type:"line",source:"buildings",paint:{"line-color":"rgba(0,0,0,0.35)","line-width":1.6,"line-opacity":.8}}),q.addLayer({id:"buildings-outline",type:"line",source:"buildings",paint:{"line-color":"#1d4ed8","line-width":2.6,"line-opacity":["case",["boolean",["feature-state","selected"],!1],1,0]}}),!q.getLayer("buildings-fill"))try{q.addLayer({id:"buildings-fill",type:"fill",source:"buildings",paint:{"fill-opacity":0}},"buildings-outline")}catch{q.addLayer({id:"buildings-fill",type:"fill",source:"buildings",paint:{"fill-opacity":0}})}q.addLayer({id:"buildings-labels",type:"symbol",source:"buildings",layout:{"text-field":["coalesce",["get","name"],["get","id"]],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":10,"text-anchor":"center","text-variable-anchor":["center"],"text-offset":[0,0],"text-line-height":1,"text-allow-overlap":!1,"text-max-width":10,"symbol-placement":"point"},paint:{"text-color":"#111111","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":1}}),q.getLayer("buildings-hit")||q.addLayer({id:"buildings-hit",type:"line",source:"buildings",paint:{"line-color":"#007aff","line-width":2},filter:["==",["get","id"],B||""]})}if(n.boundary&&!q.getSource("boundary")){const be=Qu(n.boundary);be?(q.addSource("boundary",{type:"geojson",data:be}),q.addLayer({id:"boundary-layer",type:"line",source:"boundary",paint:{"line-color":"#a9040e","line-width":3,"line-dasharray":[2,2]}})):console.warn("Boundary provided but could not normalize to FeatureCollection.")}},[M,n]),Oi(()=>{if(!M||!y.current||!n)return;const q=y.current;q.getSource("buildings")||(q.addSource("buildings",{type:"geojson",data:n.buildings,promoteId:"id"}),q.addLayer({id:"buildings-layer",type:"fill-extrusion",source:"buildings",paint:{"fill-extrusion-color":vf(Ym),"fill-extrusion-height":15,"fill-extrusion-opacity":.7}}),q.addLayer({id:"buildings-outline",type:"line",source:"buildings",paint:{"line-color":"#1d4ed8","line-width":2.2,"line-opacity":["case",["boolean",["feature-state","selected"],!1],1,0]}}),q.getLayer("buildings-fill")||q.addLayer({id:"buildings-fill",type:"fill",source:"buildings",paint:{"fill-opacity":0}},"buildings-outline"));const be=async Me=>{if(!q)return;let Qe=null;try{if(q.getLayer(lo)){const Lt=q.queryRenderedFeatures(Me.point,{layers:[lo]});Qe=Lt&&Lt[0]}}catch{}if(Qe)return;const ct=Me.features&&Me.features[0];if(!ct)return;Ma.current=ct;const Xe=ct.properties?.id;if(!Xe)return;try{s.current&&q.setFeatureState({source:"buildings",id:s.current},{selected:!1}),q.setFeatureState({source:"buildings",id:Xe},{selected:!0}),s.current=Xe}catch{}Y(Xe),cl.current=Xe;const ot=q.project(Me.lngLat);dh(Qt(ot)),xr(!1),Bi("building"),Zn(null),yn(null),wr({loading:!0,mode:"building"}),lt(Xe);try{const Lt=await at(Xe);if(cl.current!==Xe)return;if(Go.current||(yn(Lt),wr(rh(Lt,"building"))),Ue!==De.SPACE_DATA){const Ht=await qe?.(Xe)||Lt||{},Ct=dn=>Number.isFinite(dn)?Math.round(dn).toLocaleString():"-",en=dn=>Number.isFinite(dn)?Number(dn).toLocaleString():"-",xn=gq(Ht.keyDepts||[]),Gn=`
          <div class="mf-popup mf-popup--building" style="min-width:280px;padding:8px 10px;">
            <div style="display:flex;gap:18px;align-items:flex-start;">
              <div style="flex:1">
                <div style="font-weight:700;margin-bottom:6px;">${buildingName}</div>
                <div><b>Total SF:</b> ${Ct(Ht.totalSf)}</div>
                <div><b>Rooms:</b> ${en(Ht.rooms)}</div>
                <div><b>Classroom SF:</b> ${Ct(Ht.classroomSf)}</div>
                <div><b>Classrooms:</b> ${en(Ht.classroomCount)}</div>
              </div>
              <div style="min-width:180px;">
                <div style="font-weight:600;margin-bottom:4px;">Key Departments</div>
                ${xn||'<div class="mf-subtle">?</div>'}
              </div>
            </div>
          </div>`;new zf.Popup({offset:12}).setLngLat(Me.lngLat).setHTML(Gn).addTo(q)}}catch(Lt){console.warn("Failed to load building totals for popup:",Lt)}};return q.__mf_building_click_bound||(q.on("click","buildings-fill",be),q.__mf_building_click_bound=!0),()=>{try{q.__mf_building_click_bound&&(q.off("click","buildings-fill",be),q.__mf_building_click_bound=!1)}catch{}}},[a,M,n,Ue,lt,at,qe]),Oi(()=>{if(!M||!y.current)return;const q=y.current,be=(Xe,ot)=>{try{q.setPaintProperty("buildings-layer","fill-extrusion-color",Xe),q.setPaintProperty("buildings-layer","fill-extrusion-opacity",ot)}catch{}},Me=(Xe,ot,Lt)=>{try{q.setPaintProperty(Xe,"fill-color",ot),q.setPaintProperty(Xe,"fill-opacity",Lt)}catch{}},Qe=q.getLayer("buildings-layer"),ct=q.getLayer("buildings-fill");if(Ue===De.SPACE_DATA)Qe&&(Qe.type==="fill-extrusion"?be(vf("#ffffff"),1):Me("buildings-layer",vf("#ffffff"),1)),XA(q);else if(Qe&&(Qe.type==="fill-extrusion"?be(vf(Ym),.7):Me("buildings-layer",vf(Ym),.7)),ct){Me("buildings-fill",vf(Ym),.2);try{q.setPaintProperty("buildings-fill","fill-outline-color","#00000000")}catch{}kL(q)}},[M,Ue]),Oi(()=>{if(!M||!y.current)return;const q=y.current;try{q.getLayer("buildings-hit")&&q.setFilter("buildings-hit",["==",["get","id"],B||""])}catch{}},[B,M]),Oi(()=>{if(!M||!y.current)return;const q=y.current;s.current&&q.setFeatureState({source:"buildings",id:s.current},{selected:!1}),B&&q.setFeatureState({source:"buildings",id:B},{selected:!0}),s.current=B},[B,M,t]),Oi(()=>{if(!M||!y.current)return;const q=y.current,be=()=>{const Qe=q.getStyle?.(),ct=Qe?.layers||[],Xe=Qe?.sources||{};try{q.getLayer(od)&&q.removeLayer(od)}catch{}try{q.getLayer(ad)&&q.removeLayer(ad)}catch{}ct.map(ot=>ot?.id).filter(ot=>typeof ot=="string"&&ot.startsWith("engagement-heat-layer-")).forEach(ot=>{try{q.removeLayer(ot)}catch{}}),Object.keys(Xe).filter(ot=>ot.startsWith("engagement-heat-source-")).forEach(ot=>{try{q.removeSource(ot)}catch{}})},Me=()=>{CI.forEach(({layerId:Qe})=>{try{q.getLayer(Qe)&&q.removeLayer(Qe)}catch{}});try{q.getLayer(od)&&q.removeLayer(od)}catch{}try{q.getLayer(ad)&&q.removeLayer(ad)}catch{}try{q.getSource(Xm)&&q.removeSource(Xm)}catch{}};if(!a){Me(),be();return}try{be();const Qe=q.getSource(Xm);Qe&&typeof Qe.setData=="function"?Qe.setData(Dh):q.addSource(Xm,{type:"geojson",data:Dh});const ct=q.getLayer("boundary-layer")?"boundary-layer":q.getLayer("buildings-labels")?"buildings-labels":void 0,Xe=!0,ot=!!Si;q.getLayer(od)||q.addLayer({id:od,type:"heatmap",source:Xm,maxzoom:Ww,filter:["all",["in",["coalesce",["get","heatCategory"],""],["literal",m$]],Xw],paint:{"heatmap-weight":LI(),"heatmap-intensity":PI(Xe),"heatmap-radius":NI(ot),"heatmap-opacity":RI(Xe),"heatmap-color":S$()}},ct),q.setPaintProperty(od,"heatmap-weight",LI()),q.setPaintProperty(od,"heatmap-intensity",PI(Xe)),q.setPaintProperty(od,"heatmap-radius",NI(ot)),q.setPaintProperty(od,"heatmap-opacity",RI(Xe)),Yw(q,od,He&&II),q.getLayer(ad)||q.addLayer({id:ad,type:"heatmap",source:Xm,maxzoom:Ww,filter:["all",["in",["coalesce",["get","heatCategory"],""],["literal",g$]],Xw],paint:{"heatmap-weight":["*",Ex,.98],"heatmap-intensity":MI(Xe),"heatmap-radius":DI(ot),"heatmap-opacity":OI(Xe),"heatmap-color":E$()}},ct),q.setPaintProperty(ad,"heatmap-weight",["*",Ex,.98]),q.setPaintProperty(ad,"heatmap-intensity",MI(Xe)),q.setPaintProperty(ad,"heatmap-radius",DI(ot)),q.setPaintProperty(ad,"heatmap-opacity",OI(Xe)),Yw(q,ad,He&&II),CI.forEach(({category:Lt,layerId:Ht})=>{q.getLayer(Ht)||q.addLayer({id:Ht,type:"heatmap",source:Xm,maxzoom:Ww,filter:["all",["==",["coalesce",["get","heatCategory"],""],Lt],Xw],paint:{"heatmap-weight":kI(Lt),"heatmap-intensity":BI(Lt,Xe),"heatmap-radius":FI(Lt,ot),"heatmap-opacity":zI(Lt,Xe),"heatmap-color":w$(Lt)}},ct),q.setPaintProperty(Ht,"heatmap-weight",kI(Lt)),q.setPaintProperty(Ht,"heatmap-intensity",BI(Lt,Xe)),q.setPaintProperty(Ht,"heatmap-radius",FI(Lt,ot)),q.setPaintProperty(Ht,"heatmap-opacity",zI(Lt,Xe)),Yw(q,Ht,He)})}catch(Qe){console.warn("Engagement heatmap update failed",Qe)}},[M,a,Dh,He,Si]),Oi(()=>{if(!M||!y.current)return;const q=y.current;q.getCanvas().parentElement.querySelectorAll(".custom-mapbox-marker").forEach(Qe=>Qe.remove());const be=t==="admin"?ie?ph:[]:a?ju:Z;a&&(He||Ru)||be.forEach(Qe=>{const ct=document.createElement("div");ct.className="custom-marker custom-mapbox-marker";const Xe=a?vd[Qe.type]||Tc[Qe.type]||"#9E9E9E":Tc[Qe.type]||"#9E9E9E";ct.style.backgroundColor=Xe;const ot=new zf.Marker(ct).setLngLat(Qe.coordinates);Ue!==De.SPACE_DATA&&ot.setPopup(new zf.Popup({offset:25}).setText(Qe.comment||Qe.type)),ot.addTo(q)})},[ph,Z,ju,Tc,vd,M,t,ie,a,He,Ru]),Oi(()=>{if(!M||!y.current||!y.current.getSource("buildings"))return;const q=y.current;if(Ue===De.SPACE_DATA){if(Zs&&me&&Object.keys(me).length>0){const ct=["match",["get","id"]];Object.entries(me).forEach(([ot,Lt])=>{const Ht=Number.isFinite(Lt?.overallUtilization)?Lt.overallUtilization:null,Ct=d$(Ht);ct.push(ot,Ct)}),ct.push("#e5e7eb");const Xe=vf(ct);try{q.setPaintProperty("buildings-layer","fill-extrusion-color",Xe),q.setPaintProperty("buildings-layer","fill-extrusion-opacity",.2),q.getLayer("buildings-fill")&&(q.setPaintProperty("buildings-fill","fill-color",Xe),q.setPaintProperty("buildings-fill","fill-opacity",.55),q.setPaintProperty("buildings-fill","fill-outline-color","rgba(0,0,0,0)"))}catch{}}else try{q.setPaintProperty("buildings-layer","fill-extrusion-color",vf("#ffffff")),q.setPaintProperty("buildings-layer","fill-extrusion-opacity",.7),q.getLayer("buildings-fill")&&(q.setPaintProperty("buildings-fill","fill-color",vf("#ffffff")),q.setPaintProperty("buildings-fill","fill-opacity",0))}catch{}return}if(q.getLayer("buildings-fill"))try{q.setPaintProperty("buildings-fill","fill-opacity",0)}catch{}try{q.setPaintProperty("buildings-layer","fill-extrusion-opacity",.7)}catch{}const be=["match",["get","id"]];let Me=!1;t==="admin"&&Ue===De.ASSESSMENT&&Object.keys(_e).length>0?Object.entries(_e).forEach(ct=>{const Xe=ct[0],ot=ct[1];let Lt=0;const Ht=ot&&ot.scores?ot.scores:{};Ht.architecture&&Object.values(Ht.architecture).some(Ct=>Ct>0)&&Lt++,Ht.engineering&&Object.values(Ht.engineering).some(Ct=>Ct>0)&&Lt++,Ht.functionality&&Object.values(Ht.functionality).some(Ct=>Ct>0)&&Lt++,be.push(ot&&ot.originalId||Xe,l$[Lt]),Me=!0}):t==="admin"&&Ue===De.SPACE_DATA&&Object.keys(Pe).length>0&&Object.entries(Pe).forEach(ct=>{const Xe=ct[0],ot=ct[1],Lt=a$[ot];Lt&&(be.push(Xe,Lt.color),Me=!0)}),be.push(Ym);const Qe=vf(be);Me?q.setPaintProperty("buildings-layer","fill-extrusion-color",Qe):q.setPaintProperty("buildings-layer","fill-extrusion-color",vf(Ym))},[Pe,_e,M,t,Ue,Zs,me]);const Oh=vr(q=>{if(!y.current)return;const be=document.createElement("div");be.className="marker-prompt-popup",be.innerHTML=`
      <h4>Add a Marker</h4>
      <select id="marker-type">${Object.keys(Tc).map(Qe=>`<option value="${Qe}">${Qe}</option>`).join("")}</select>
      <textarea id="marker-comment" placeholder="Optional comment..."></textarea>
      <div class="button-group">
        <button id="confirm-marker">Add</button>
        <button id="cancel-marker">Cancel</button>
      </div>`;const Me=new zf.Popup({closeOnClick:!1,maxWidth:"280px"}).setDOMContent(be).setLngLat(q).addTo(y.current);be.querySelector("#confirm-marker").addEventListener("click",async()=>{const Qe=be.querySelector("#marker-type").value,ct=be.querySelector("#marker-comment").value.trim(),Xe=ri.current||{},ot=Co&&Si,Lt=ot&&(Xe.buildingId||B||$)||"",Ht=xp(Lt||""),Ct=String(Rd(Lt)||jn).trim(),en=ot?El(Xe.floorId||Dr||""):"",xn=ot?String(Xe.floorLabel||Dr||"").trim():"",Gn=ot?String(Xe.url||Da||"").trim():"",dn={coordinates:new Hx(q.lat,q.lng),type:Qe,comment:ct,buildingId:Ht,buildingName:Ct,floorId:en,floorLabel:xn,floorUrl:Gn,persona:i||(a?"student":"admin"),createdAt:V1()},ln=await LT(np,dn),Tn={...dn,id:ln.id,coordinates:[q.lng,q.lat]};de(kr=>[...kr,Tn]),le(kr=>[...kr,Tn]),Me.remove()}),be.querySelector("#cancel-marker").addEventListener("click",()=>Me.remove())},[Tc,np,i,a,B,$,Dr,Da,jn,Co,Si]);Oi(()=>{if(!a||t==="admin"||!M||!y.current)return;const q=y.current,be=Me=>{if(!(Jn.current||ms.current)&&!(Co&&!Si)){try{if(Co){const Qe=q.queryRenderedFeatures(Me.point,{layers:["buildings-fill"]})||[],ct=String(Qe[0]?.properties?.id||""),Xe=String(cl.current||B||$||"");if(ct&&Xe&&ct!==Xe)return}}catch{}Oh(Me.lngLat)}};return q.on("click",be),()=>{try{q.off("click",be)}catch{}}},[a,t,M,Oh,Si,B,$,Co]),Oi(()=>{if(!M||!y.current)return;const q=y.current,be=Me=>{const Qe=Pn.current;if(!Qe)return;try{Me.preventDefault?.(),Me.originalEvent&&(Me.originalEvent.preventDefault?.(),Me.originalEvent.stopPropagation?.(),Me.originalEvent.cancelBubble=!0)}catch{}const ct=Number(Qe.step)||0,Xe=ct<2,ot=Xe?lo:kp,Ht=ri.current?.fc||null;let Ct=null;if(Xe){if(q.getLayer(ot)){const xn=q.queryRenderedFeatures(Me.point,{layers:[ot]})||[];if(xn.length){const Gn=[Me.lngLat.lng,Me.lngLat.lat];Ct=Dq(xn[0],Gn)}}if(!Ct&&Ht&&(Ct=Ow({map:q,fc:Ht,isDrawing:!1,screenPoint:Me.point,maxPixels:jq,maxPoints:Fw})),!Ct){zt("Click closer to a room polygon (or zoom in).");return}}else{const xn=!!Ht?.features?.some(Gn=>{const dn=Gn?.geometry?.type||"";return jh(Gn?.properties||{})||dn==="LineString"||dn==="MultiLineString"});if(Ht&&(Ct=Ow({map:q,fc:Ht,isDrawing:!0,screenPoint:Me.point,maxPixels:Uq,maxPoints:Fw})),!Ct&&xn&&Ht&&(Ct=Ow({map:q,fc:Ht,isDrawing:!0,screenPoint:Me.point,maxPixels:null,maxPoints:Fw})),!Ct){zt(xn?"No drawing vertex nearby. Zoom in and click closer to linework.":"No drawing linework found on this floor.");return}}const en={...Qe,roomPts:Array.isArray(Qe.roomPts)?[...Qe.roomPts]:[],drawingPts:Array.isArray(Qe.drawingPts)?[...Qe.drawingPts]:[]};if(Xe?en.roomPts.push(Ct):en.drawingPts.push(Ct),en.step=ct+1,en.step>=jA.length){const xn=An(en.roomPts,en.drawingPts);if(!xn){zt("Unable to compute alignment from those points.");return}if(!Iq(Qe.buildingLabel,Qe.floorId,xn)){zt("Failed to save alignment in local storage.");return}Tt(null),zt("");const dn=Ji($,Qe.floorId);dn&&(Jo.delete(dn),ih.delete(dn)),ts(Qe.floorId);return}zt(""),Tt(en)};return q.on("click",be),()=>{try{q.off("click",be)}catch{}}},[M,$,Ji,ts,An]),Oi(()=>{if(!M||!y.current)return;const q=y.current,be=(Xe,ot)=>{const Lt=Uf(ma([Xe.lng,Xe.lat]),ma([ot.lng,Xe.lat]),{units:"kilometers"}),Ht=Uf(ma([Xe.lng,Xe.lat]),ma([Xe.lng,ot.lat]),{units:"kilometers"}),Ct=(ot.lng>=Xe.lng?1:-1)*Lt*1e3,en=(ot.lat>=Xe.lat?1:-1)*Ht*1e3;return[Ct,en]},Me=Xe=>{if(!ms.current)return;try{Xe.preventDefault?.(),Xe.originalEvent&&(Xe.originalEvent.preventDefault?.(),Xe.originalEvent.stopPropagation?.(),Xe.originalEvent.cancelBubble=!0)}catch{}const ot=zi.current;if(!ot)return;const Lt=Bt(),Ht=Lt.url||Ji($,Lt.floorId),Ct=Lt.basePath||ri.current?.floorAdjustBasePath||null,en=ri.current?.floorAdjustBasePivot||null,xn=Ct?t_(Ct,Lt.floorId):null,Gn=bp(xn),dn=Ht?e_(Ht):null,ln=bp(dn),Tn=Gn?xn:ln?dn:eg(Lt.buildingLabel,Lt.floorId),kr=Array.isArray(Tn.translateLngLat)?Tn.translateLngLat:[0,0],ti=ri.current?.floorAdjustLabel||(Ht?qf(Ht):null)||Lt.buildingLabel,Lr=jc(q,Va)?._data||ri.current?.fc||null;if(!Lr){Br("No floor data to adjust.");return}let _i=null;try{_i=Gu(Lr)?.geometry?.coordinates||null}catch{_i=null}if(!_i){Br("Unable to find a transform pivot.");return}const xi=q.project({lng:_i[0],lat:_i[1]}),ci=Math.atan2(Xe.point.y-xi.y,Xe.point.x-xi.x);cs.current={mode:ot,baseData:JSON.parse(JSON.stringify(Lr)),pivot:_i,pivotScreen:xi,startAngle:ci,startRotation:Tn.rotationDeg||0,startScale:Tn.scale||1,startTranslate:Tn.translateMeters||[0,0],startTranslateLngLat:kr,startLngLat:Xe.lngLat,buildingLabel:Lt.buildingLabel,floorId:Lt.floorId,adjustUrl:Ht,adjustLabel:ti,adjustBasePath:Ct,basePivot:en};try{q.dragPan.disable()}catch{}try{q.getCanvas().style.cursor="grabbing"}catch{}},Qe=Xe=>{const ot=cs.current;if(!ot)return;const Lt=jc(q,Va);if(Lt){if(ot.mode==="rotate"){const Ct=(Math.atan2(Xe.point.y-ot.pivotScreen.y,Xe.point.x-ot.pivotScreen.x)-ot.startAngle)*180/Math.PI,en=af(ot.baseData,Ct,{pivot:ot.pivot});Lt.setData(en);return}if(ot.mode==="move"){be(ot.startLngLat,Xe.lngLat);const Ht=Xe.lngLat.lng-ot.startLngLat.lng,Ct=Xe.lngLat.lat-ot.startLngLat.lat,en=W5(ot.baseData,[Ht,Ct]);Lt.setData(en)}}},ct=Xe=>{const ot=cs.current;if(!ot)return;let Lt=eg(ot.buildingLabel,ot.floorId);if(ot.mode==="rotate"){const Tn=(Math.atan2(Xe.point.y-ot.pivotScreen.y,Xe.point.x-ot.pivotScreen.x)-ot.startAngle)*180/Math.PI,kr=Array.isArray(ot.basePivot)?ot.basePivot:Array.isArray(ot.pivot)?ot.pivot:Lt.pivot;Lt={...Lt,rotationDeg:(ot.startRotation||0)+Tn,pivot:kr}}else if(ot.mode==="move"){const[ln,Tn]=be(ot.startLngLat,Xe.lngLat),kr=Xe.lngLat.lng-ot.startLngLat.lng,ti=Xe.lngLat.lat-ot.startLngLat.lat,cr=Array.isArray(ot.basePivot)?ot.basePivot:Array.isArray(ot.pivot)?ot.pivot:Lt.pivot;Lt={...Lt,translateMeters:[(ot.startTranslate?.[0]||0)+ln,(ot.startTranslate?.[1]||0)+Tn],translateLngLat:[(ot.startTranslateLngLat?.[0]||0)+kr,(ot.startTranslateLngLat?.[1]||0)+ti],pivot:cr}}const Ct=jc(q,Va)?._data||ri.current?.fc||null,en=kv(Ct);en&&(Lt={...Lt,anchorLngLat:en});const xn=ot.adjustLabel||ot.buildingLabel;Q1(xn,ot.floorId,Lt),ot.adjustUrl&&ev(ot.adjustUrl,Lt),ot.adjustBasePath&&tv(ot.adjustBasePath,ot.floorId,Lt);try{Jt(xn,ot.floorId,Lt)}catch{}const Gn=dx(Lt);if(Gn&&Ct){const ln={...Ct,__mfUserAdjustSignature:Gn};ot.adjustUrl&&Jo.set(ot.adjustUrl,ln),ri.current={...ri.current||{},fc:ln}}cs.current=null,Mr(null),Br("");const dn=ot.adjustUrl||Ji($,ot.floorId);dn&&!ot.adjustUrl&&(Jo.delete(dn),ih.delete(dn));try{q.dragPan.enable()}catch{}try{q.getCanvas().style.cursor=ot.mode==="move"?"move":"grab"}catch{}};return q.on("mousedown",Me),q.on("mousemove",Qe),q.on("mouseup",ct),()=>{try{q.off("mousedown",Me)}catch{}try{q.off("mousemove",Qe)}catch{}try{q.off("mouseup",ct)}catch{}}},[M,$,Ji,Bt,Jt,E,Vi]),Oi(()=>{if(!M||!y.current)return;const q=y.current,be=ct=>{try{ct.preventDefault?.(),ct.originalEvent&&(ct.originalEvent.preventDefault?.(),ct.originalEvent.stopPropagation?.(),ct.originalEvent.cancelBubble=!0)}catch{}if(Jn.current||ms.current)return;if(a){yo(null);return}gs.current=null;const Xe=ct.features?.[0];if(!Xe)return;if(Ul){try{const Di=Xe.properties||{},Ko=B||$||Di.Building||Di.buildingId||"",fl=Di.Floor||Dr||Da?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||"LEVEL_1",Fh=Xe.id??Di.RevitId??Di.revitId??null,bu=Di.Number??Di.RoomNumber??Di.number??Di.Room??"",Ac=qa(wf(Di)||Di.__roomType||""),ff=Di.department??Di.Department??Di.Dept??"",Fa=Od(Di),hi=Number.isFinite(Fa)?Fa:0,Pl=Ko&&fl&&Fh!=null?ld(Ko,fl,Fh):null;if(!Pl){console.warn("Scenario click: could not build roomId",{buildingId:Ko,floorName:fl,revitId:Fh,props:Di});return}const Zo=ct.point||q.project(ct.lngLat);ue({roomId:Pl,buildingId:Ko,buildingName:Di.BuildingName||Di.buildingName||Ko,floorName:fl,revitId:Fh,roomNumber:bu,roomType:Ac,department:ff,area:Number(hi)||0}),gn(Zo),Bn()}catch(Di){console.warn("Scenario click failed",Di)}return}gs.current=Xe;const ot=Xe.id??Xe.properties?.RevitId??null;ht||yo(ot),Da&&(T.current||(T.current={}),T.current[Da]=ot);const Lt=Xe.properties||{},Ht=B||$,Ct=jn,en=Xe.id??Lt.RevitId??null,xn=Lt.Floor||Dr||Da?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||"LEVEL_1",Gn=Ht&&en!=null?ld(Ht,xn,en):null;if(Ul){if(!Gn)return;Hc(Di=>{const Ko=new Set(Di);return Ko.has(Gn)?Ko.delete(Gn):Ko.add(Gn),D(Ko),Ko});return}const dn=Gn?ia.get(Gn):null,ln=dn?{...Lt,...dn}:Lt,Tn=ln.Number??ln.RoomNumber??ln.number??ln.Room??"",kr=qa(wf(ln)||ln.__roomType||""),ti=qa(ln.__dept||h_(ln)||""),cr=ln.occupant??ln.Occupant??"",Lr=ln.comments??ln.Comments??"",_i=Ye(ln),xi=Od(ln);let ci=kr,Qi=ti,Jr=Number.isFinite(xi)?xi:null,ai=cr;const ds=X9(ln),li=Dw(ln),Hr=K9(ln),qi=Y9(ds)||Hr.isOfficeText,Yn=nv(kr)||wq(ds)||Hr.isTeachingText,_n=Ht&&xn&&en!=null?ld(Ht,xn,en):null,Dn=(ai??"").toString().trim(),ur=Tn||"-",yr=String(ln.Revit_UniqueId??ln.RevitUniqueId??Lt.Revit_UniqueId??Lt.RevitUniqueId??Lt["Room GUID"]??"").trim(),vi=Hs(Ht),er=Md(xn),Mo=String(Tn??"").trim(),ls=je?.length?je:kt,mo=Array.isArray(ls)?ls.find(Di=>{if(!Di)return!1;const Ko=String(Di?.roomId??Di?.roomNumber??Di?.roomLabel??"").trim(),fl=String(Di?.roomGuid??Di?.revitUniqueId??"").trim();if(yr&&(fl===yr||Ko===yr))return!0;const Fh=Hs(Di?.building??Di?.buildingName??Di?.buildingLabel??"");return vi&&Fh!==vi||er.length&&!Pd(Di?.floor??Di?.floorName??Di?.floorId??"",er)?!1:Mo&&Ko===Mo}):null,Qs=mo?.airtableId||mo?.AirtableId||mo?.["Airtable ID"]||null;if(ht){if(!St){if(!Dn||!_n||ot==null){console.warn("Cannot start move: missing occupant or identifiers.");return}Yt({roomId:_n,roomLabel:ur,buildingId:Ht,buildingName:Ct,floorId:xn,occupantName:Dn,revitId:en,highlightId:ot}),Et(null),yo(ot);return}if(ot===St.highlightId){Yt(null),Et(null),yo(null);return}if(Ht!==St.buildingId||xn!==St.floorId){Yt(null),Et(null),yo(null);return}Et({person:St.occupantName,effectiveDate:"",comments:"",from:St,to:{roomId:_n,roomLabel:ur,buildingId:Ht,buildingName:Ct,floorId:xn,revitId:en,highlightId:ot}});return}const bl=m,Do=ln.Floor||xn,wl=!!(t==="admin"&&bl&&Ht&&Do&&en!=null&&e),To=wl?ld(Ht,Do,en):null,_r=wl?{roomId:To,buildingId:Ht,floorName:Do,revitId:en,roomGuid:yr||null,roomLabel:ur,roomNumber:Tn||"",feature:Xe,flags:{isOffice:qi,isTeaching:Yn},highlightId:ot,properties:{type:ci||"",department:Qi||"",area:Number.isFinite(Jr)?Jr:"",occupant:ai||"",occupancyStatus:_i||"",comments:Lr||"",roomGuid:yr||"",Revit_UniqueId:yr||"",airtableId:Qs}}:null;let Dc=ul.current||[];if(_r){const Di=ul.current||[];Di.findIndex(fl=>fl.roomId===_r.roomId)>=0?Dc=Di.filter(fl=>fl.roomId!==_r.roomId):Dc=[...Di,_r],ul.current=Dc,sc(Dc),jo(Dc)}const Qc=()=>{const Di=Number.isFinite(Jr)&&Jr!==0?Math.round(Jr).toLocaleString():"",fl=(ul.current||[]).length,Fh=fl>0,bu=fl>1?`Edit ${fl} Rooms`:"Edit",Ac=wl?`<div class="mf-popup-actions" style="margin-top:6px;padding-top:6px;gap:6px;flex-wrap:wrap;width:100%;">
               <button id="mf-room-edit-btn" class="mf-btn tiny">${bu}</button>
               ${Fh?'<button id="mf-clear-edit-selection" class="mf-btn tiny" style="background:#f4f4f4;color:#333;">Clear Selection</button>':""}
             </div>`:"",ff=Number.isFinite(li)&&li>0,Fa=(ai??"").toString().trim(),hi=nv(ci||""),Pl=ff?li.toLocaleString():"-",Zo=hi?`<div><b>Seat Count:</b> ${Pl}</div>`:"",Qa=Fa.length?Fa:"-",Nl=hi?"":`<div><b>Occupant:</b> ${Qa}</div>`,Hl=hi?nt(Ct,Tn||ur):null,Ao=Hl&&(Number.isFinite(Hl.timeUtilization)||Number.isFinite(Hl.seatUtilization)),Zf=(Nf,df,Ic)=>{if(!Number.isFinite(df))return"";const ap=Math.max(0,Math.min(df,100));return`
            <div style="margin-top:3px;">
              <div style="font-size:10px;color:#444;">${Nf}: ${Math.round(df)}%</div>
              <div style="height:4px;background:#e4e7ec;border-radius:999px;overflow:hidden;">
                <div style="width:${ap}%;height:100%;background:${Ic};"></div>
              </div>
            </div>
          `},Sl=Ao?`
            <div style="margin-top:6px; width:100%; max-width:220px;">
              ${Zf("Time Util",Hl.timeUtilization,"#3b82f6")}
              ${Zf("Seat Util",Hl.seatUtilization,"#f59e0b")}
            </div>
          `:"",op=wl&&fl?`<div style="font-size:11px;color:#555;margin-top:6px;">Rooms selected: ${fl}</div>`:"";return`
          <div class="mf-popup" style="min-width:340px;max-width:460px;background:#fff;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,0.15);padding:2px;">
            <div class="mf-popup-body" style="padding:8px 12px 16px 12px;">
              <div class="mf-title">Room ${Tn||"-"}</div>
              <div><b>Room Type:</b></div>
              <div style="white-space:normal;word-break:break-word;margin-bottom:2px;">${ci||"-"}</div>
              <div><b>Department:</b> ${Qi||"-"}</div>
              <div><b>Area (SF):</b> ${Di||"-"}</div>
              <div><b>Floor:</b> ${Do}</div>
              ${Zo}
              ${Nl}
              ${Sl}
              ${op}
              ${Ac}
            </div>
          </div>`},Jh=q.project(ct.lngLat),_o=_.current?.clientWidth||1e3,nu=Jh.x>_o*.56?"right":"left",Ll=nu==="left"?240:-240,Qh={top:[Ll,12],"top-left":[Ll,12],"top-right":[Ll,12],bottom:[Ll,-12],"bottom-left":[Ll,-12],"bottom-right":[Ll,-12],left:[Ll,0],right:[Ll,0]},ef=new zf.Popup({closeButton:!0,offset:Qh,anchor:nu,maxWidth:"520px"}).setLngLat(ct.lngLat).setHTML(Qc()).addTo(q);ef.on("close",()=>{if(!ht&&!St){const Di=Jl(ul.current||[]);yo(Di.length?Di:null)}});const Uu=async()=>{try{ef.remove()}catch{}const Di=Go.current||_c.current;if(Di){Le(De.SPACE_DATA),Zt(!1),xr(!1);try{const Ko=q.project(ct.lngLat);dh(Qt(Ko))}catch{}cl.current?Y(cl.current):$&&Y($),rt(Di)}},Kf=()=>{if(!wl)return;const Ko=sa.length?To&&sa.some(Ac=>Ac.roomId===To)||!_r?sa:[...sa,_r]:_r?[_r]:[];if(!Ko.length)return;const fl=bu=>{const Ac=Ko.map(Fa=>Fa?.properties?.[bu]??""),ff=Ac[0];return Ac.every(Fa=>Fa===ff)?ff:""},Fh={type:fl("type"),department:fl("department"),occupant:fl("occupant"),occupancyStatus:fl("occupancyStatus"),comments:fl("comments"),area:fl("area")};Ra({...Ko[0],targets:Ko,roomLabel:Ko.length===1?Ko[0]?.roomLabel||"-":`${Ko.length} rooms`,properties:Fh,includedKeys:new Set(Ko.map(bu=>bu.roomId||String(bu.revitId??""))),refreshPopup:()=>{ef.setHTML(Qc()),eh()},onApply:bu=>{"type"in bu&&(ci=bu.type),"department"in bu&&(Qi=bu.department),"occupant"in bu&&(ai=bu.occupant)}}),tl(new Set(Ko.map(bu=>bu.roomId||String(bu.revitId??"")))),No(!0)},Oc=()=>{ul.current=[],sc([]),jo([]);try{ef.remove()}catch{}};function eh(){const Di=ef.getElement();Di&&(Di.querySelector("#mf-show-floor")?.addEventListener("click",Uu),wl&&(Di.querySelector("#mf-room-edit-btn")?.addEventListener("click",Kf),Di.querySelector("#mf-clear-edit-selection")?.addEventListener("click",Oc)))}eh()},Me=()=>{if(!(Jn.current||ms.current)&&!a)try{q.getCanvas().style.cursor="pointer"}catch{}},Qe=()=>{if(!(Jn.current||ms.current))try{q.getCanvas().style.cursor=""}catch{}};return q.on("click",lo,be),q.on("mouseenter",lo,Me),q.on("mouseleave",lo,Qe),()=>{try{q.off("click",lo,be),q.off("mouseenter",lo,Me),q.off("mouseleave",lo,Qe)}catch{}gs.current=null}},[M,Da,$,B,Dr,rt,Le,Zt,xr,dh,bi,ia,kt,je,m,x,e,ce,qe,Ee,Ue,or,Ul,ht,St,yo,sa,oa,jo,Jl,a]),Oi(()=>{if(!M||!y.current)return;const q=y.current,be=Me=>{const Qe=y.current;if(!Qe||Jn.current||ms.current)return;const ct=cl.current;if(!ct)return;if(!!!Qe.getLayer(lo)){Ie(ct);return}const ot=Me.point,Lt=Qe.queryRenderedFeatures(ot,{layers:[lo]});if(Lt&&Lt.length||!!!Qe.getLayer("buildings-fill"))return;Qe.queryRenderedFeatures(ot,{layers:["buildings-fill"]})?.some(xn=>xn.properties?.id===ct)&&(Go.current=null,Ie(ct))};return q.on("click",be),()=>{try{q.off("click",be)}catch{}}},[M,Ie]);const Bp=vr(()=>{},[]),km=vr(async()=>{const q=Wu.current||B||$;if(!q){alert("No building selected for export.");return}if(!Ql.length){alert("No floors available for export.");return}const be=[];for(const Xe of Ql){const ot=Ji(q,Xe);if(!ot)continue;const Lt=await xf(ot),Ht=Qu(Lt);if(!Ht?.features?.length)continue;const Ct=sy({fc:Ht,colorMode:Vi,solidFill:!0,labelOptions:{hideDrawing:!0}});Ct&&be.push({img:Ct,label:`${jn} - ${Xe}`})}if(!be.length){alert("No floorplans could be rendered for export.");return}const Me=Rw(nn?.totalsByDept),Qe={totalSF:nn?.totalSf,rooms:nn?.rooms,classroomSf:nn?.classroomSf,classroomCount:nn?.classroomCount,levels:Ql.length},ct=`${jn.replace(/\s+/g,"-").toLowerCase()}-floors`;wa(be,{filenameBase:ct,stats:Qe,keyDepts:Me,summaryLabel:`${jn} Floors`})},[Ql,jn,Ji,wa,$,B]);return se.jsxs("div",{ref:c,className:"map-page-container",children:[se.jsx("div",{className:"page",children:se.jsx("div",{className:"map-wrapper",children:se.jsx("div",{ref:_,className:"map-container"})})}),zn&&se.jsx("div",{style:{position:"fixed",inset:0,zIndex:10010,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:se.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(560px, 92vw)",padding:16},children:[se.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Mapbox Token Required"}),se.jsx("div",{style:{marginTop:8,fontSize:13,color:"#333"},children:"Enter a Mapbox public token (`pk...`) once for this browser to load the map."}),se.jsx("input",{value:mt,onChange:q=>{Ir(q.target.value),Fr&&qr("")},placeholder:"pk.eyJ...",style:{width:"100%",marginTop:10,padding:"8px 10px",borderRadius:8,border:"1px solid #d0d0d0"}}),Fr?se.jsx("div",{style:{marginTop:8,color:"crimson",fontSize:12},children:Fr}):null,se.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[se.jsx("button",{className:"btn",onClick:()=>{try{window.localStorage.removeItem("MAPBOX_PUBLIC_TOKEN")}catch{}Ir("")},children:"Clear"}),se.jsx("button",{className:"btn primary",onClick:Wc,children:"Save & Reload"})]})]})}),t==="admin"&&!Ce&&se.jsx("button",{className:"controls-toggle-button",onClick:()=>Oe(q=>!q),children:It?"Hide Controls":"Show Controls"}),a&&Ce&&!We&&se.jsxs("div",{style:{position:"absolute",left:16,top:16,zIndex:40,display:"flex",gap:8},children:[se.jsx("button",{className:"btn",onClick:Yc,children:"Exit Presentation"}),se.jsx("button",{className:"btn",onClick:kf,children:"Export Clean PNG"})]}),gu&&se.jsx("div",{style:{position:"fixed",inset:0,zIndex:10002,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:se.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(520px, 92vw)",padding:16,lineHeight:1.4},children:[se.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[se.jsxs("div",{children:[se.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[se.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Ask Mapfluence"}),se.jsx("span",{title:"AI-generated response based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),se.jsx("div",{style:{fontSize:12,color:"#555"},children:"Ask questions about loaded campus data."})]}),se.jsx("button",{className:"btn",onClick:()=>ro(!1),children:"Close"})]}),se.jsxs("div",{style:{marginTop:10},children:[se.jsx("label",{style:{fontWeight:600,fontSize:12},children:"Question"}),se.jsx("textarea",{value:ya,onChange:q=>ol(q.target.value),rows:3,placeholder:"e.g. How many vacant offices are on campus?",style:{width:"100%",resize:"vertical",padding:8,borderRadius:8,border:"1px solid #d0d0d0",marginTop:4}})]}),Na?se.jsx("div",{style:{color:"crimson",marginTop:6,fontSize:12},children:Na}):null,se.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:10},children:se.jsx("button",{className:"btn",disabled:Al||!ya.trim()||es,onClick:Oa,children:Al?"Asking...":"Ask"})})]})}),ji&&se.jsx("div",{style:{position:"fixed",inset:0,zIndex:10004,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:se.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(720px, 94vw)",padding:16,lineHeight:1.45,maxHeight:"86vh",overflowY:"auto"},children:[se.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[se.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[se.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Ask Mapfluence"}),se.jsx("span",{title:"AI-generated response based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),se.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[se.jsx("button",{className:"btn",onClick:Cf,children:"Copy CSV"}),se.jsx("button",{className:"btn",onClick:Wh,children:"Export PDF"}),se.jsx("button",{className:"btn",onClick:()=>qs(null),children:"Close"})]})]}),se.jsx("p",{style:{marginTop:10},children:ji.answer}),ji.bullets?.length?se.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:ji.bullets.map((q,be)=>se.jsx("li",{children:q},be))}):null,ji.resultType==="table"&&ji.columns?.length&&ji.rows?.length?se.jsx("div",{style:{marginTop:10,overflowX:"auto"},children:se.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[se.jsx("thead",{style:{background:"#f8f9fb"},children:se.jsx("tr",{children:ji.columns.map(q=>se.jsx("th",{style:{textAlign:"left",padding:"6px 8px",borderBottom:"1px solid #e0e0e0"},children:q},q))})}),se.jsx("tbody",{children:ji.rows.map((q,be)=>se.jsx("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:ji.columns.map(Me=>se.jsx("td",{style:{padding:"6px 8px"},children:q&&q[Me]!=null?String(q[Me]):""},Me))},be))})]})}):null,ji.missingData?.length?se.jsxs("div",{style:{marginTop:10,fontSize:12,color:"#555"},children:["Missing data: ",ji.missingData.join(", ")]}):null]})}),!Ce&&se.jsxs("div",{className:"mf-right-rail",children:[se.jsxs("div",{className:"mf-right-logos",children:[se.jsxs("div",{className:"logo-box",children:[se.jsx("div",{className:"mapfluence-title",children:"MAPFLUENCE"}),se.jsx("img",{className:"mf-logo mf-logo--mapfluence",src:ud("Clark_Enersen_Logo.png"),alt:"Clark & Enersen Logo"})]}),se.jsx("div",{className:"logo-box",children:se.jsx("img",{className:"mf-logo mf-logo--hc",src:ud("HC_image.png"),alt:"Hastings College"})})]}),!a&&se.jsx("div",{className:"dashboard-box",children:se.jsx(rq,{title:zo,scopeLabel:Cm,metrics:Lo,loading:Po,error:va,utilization:sp,utilizationScopeLabel:Pg,heatmapOn:Zs,onToggleHeatmap:go})})]}),t==="admin"&&se.jsxs(se.Fragment,{children:[Ue===De.ASSESSMENT&&B&&!Wt&&Nh&&se.jsx("div",{className:"floating-panel",style:{position:"absolute",zIndex:40,left:Math.max(8,Math.min(Nh.x+12,(_.current?.clientWidth||1e3)-360)),top:Math.max(8,Math.min(Nh.y+12,(_.current?.clientHeight||800)-260)),width:340},children:se.jsx(fU,{buildingId:B,buildingName:n?.buildings?.features?.find(q=>q.properties.id===B)?.properties?.name,currentCondition:Pe[B],onSave:Bp,onOpenTechnical:()=>Zt(!0),onClose:()=>{Y(null),Zt(!1),dh(null)},canWrite:m})}),Ue===De.TECHNICAL&&B&&Wt&&se.jsx(hU,{buildingId:B,assessments:_e,universityId:e,panelPos:Nh,isAdminRole:m,onClose:()=>Zt(!1),onSave:handleAssessmentSave})]}),Ue===De.SPACE_DATA&&(B||$)&&!$t&&(()=>{const q=_.current?.clientWidth||1e3,be=_.current?.clientHeight||800,Me=360,Qe=420,ct=16,Xe=260,ot=24,Lt=140,Ht=(Jr,ai,ds)=>Math.max(ai,Math.min(Jr,ds)),Ct=Math.max(300,Math.min(Me,q-ct*2)),en=ct+40,xn=Ht(q-Ct-en,12,q-Ct-12),Gn=Ht(q-Ct-Xe-ot-Lt,320,q-Ct-12),dn=12,ln=Nh||{y:be*.65},Tn=Ht(ln.y,8,be-Qe-8),kr=Gn,ti=Tn,cr=Ma.current;let Lr=null;if(cr&&cr.geometry)try{const Jr=Lc(cr);if(Jr&&Jr.length===4&&Jr.every(ai=>Number.isFinite(ai))){const ai=(Jr[1]+Jr[3])/2,ds=y.current?.project?y.current.project({lng:Jr[2],lat:ai}):null;if(ds){const li=xn,Hr=Ht(ds.y-Qe*.35,8,be-Qe-8);Lr={left:li,top:Hr}}}}catch{}const _i={position:"absolute",zIndex:40,left:kr,top:ti,width:Ct,maxHeight:"75vh",overflow:"auto"},xi=Lr?{position:"absolute",zIndex:40,left:Math.max(12,Math.min(Lr.left,q-Ct-ct)),top:dn,width:Ct,maxHeight:"80vh",overflow:"auto"}:_i,ci=Xn==="floor"?xi:_i,Qi=Wf?{...ci,left:Wf.x,top:Wf.y}:ci;return se.jsxs("div",{ref:L,className:"floating-panel",style:Qi,children:[Xn==="building"&&se.jsx(ZV,{buildingName:jn,stats:nn,keyDepts:Rw(nn?.totalsByDept),utilization:ke(jn),floors:Ql,selectedFloor:pa,onChangeFloor:Jr=>Is(Jr),onLoadFloorplan:Ki,onExportCSV:()=>fh(jn),onClose:()=>{xr(!0),Y(null),dh(null),Xh(null),Go.current=null,Wu.current=null,Ma.current=null,yn(null),Zn(null),wr(null),Bi("building")},onExportPDF:km,onExplainBuilding:Ea,explainBuildingLoading:Ga,explainBuildingDisabled:es||!nn,explainBuildingError:lr,dragHandleProps:Em}),Xn==="floor"&&se.jsx(JV,{buildingName:jn,floorLabel:sr?.floorLabel||pa,stats:sr,legendItems:si,legendTitle:{department:"Key Departments",type:"Key Types",occupancy:"Occupancy",vacancy:"Vacancy"}[Vi]||"Legend",floors:Ql,selectedFloor:pa,onChangeFloor:Jr=>Is(Jr),onLoadFloorplan:Ki,onUnloadFloorplan:Ro,onExportCSV:()=>fh(jn),colorMode:Vi,onChangeColorMode:Jr=>{Zl(Jr),f(Jr)},legendSelection:ft,onLegendClick:Jr=>{const ai=Ne.get(Jr)||[];wt(ds=>{const li=ds===Jr?null:Jr;return yo(li?ai:null),li})},onClose:()=>{xr(!0),Y(null),dh(null),Xh(null),Go.current=null,Wu.current=null,Ma.current=null,yn(null),Zn(null),wr(null),Bi("building")},onExportPDF:Yo,onExplainFloor:Sa,explainLoading:ta,explainDisabled:es||!sr,explainError:co,moveScenarioMode:Ul,onToggleMoveScenarioMode:aa,rotateActive:t==="admin"&&Gr==="rotate",moveActive:t==="admin"&&Gr==="move",rotateValue:t==="admin"?Mi:0,scaleValue:t==="admin"?Vr:1,rotateNotice:t==="admin"?Zr:"",rotateStored:t==="admin"?Yi:!1,adjustDebugInfo:t==="admin"?Ai:null,onStartRotate:t==="admin"?cn:void 0,onStartMove:t==="admin"?Vn:void 0,onCancelRotate:t==="admin"?tn:void 0,onClearRotate:t==="admin"?bn:void 0,onSaveAdjust:t==="admin"?async()=>{const Jr=Bt();if(!Jr?.buildingLabel||!Jr?.floorId)return;const ai=ri.current?.floorAdjustLabel||Jr.buildingLabel,ds=Jr.url||ri.current?.url||Ji($,Jr.floorId),li=Jr.basePath||ri.current?.floorAdjustBasePath||null,Hr=gr||eg(ai,Jr.floorId),qi=ri.current?.floorAdjustBasePivot||ri.current?.fc&&Gu(ri.current.fc)?.geometry?.coordinates||null,_n=jc(y.current,Va)?._data||ri.current?.fc||null,Dn=kv(_n),ur={...Hr,pivot:Array.isArray(Hr.pivot)?Hr.pivot:Array.isArray(qi)?qi:null,anchorLngLat:Dn||Hr.anchorLngLat||null};Q1(ai,Jr.floorId,ur),ds&&ev(ds,ur),li&&tv(li,Jr.floorId,ur);try{await Jt(ai,Jr.floorId,ur)}catch{}ds&&(Jo.delete(ds),ih.delete(ds))}:void 0,saveAdjustDisabled:t==="admin"?!Yi:!0,onScaleChange:t==="admin"?Jr=>{const ai=Bt();if(!ai?.buildingLabel||!ai?.floorId)return;const ds=ai.url||ri.current?.url||Ji($,ai.floorId),li=ai.basePath||ri.current?.floorAdjustBasePath||null,Hr=li?t_(li,ai.floorId):null,qi=bp(Hr),Yn=ds?e_(ds):null,_n=bp(Yn),Dn=qi?Hr:_n?Yn:eg(ai.buildingLabel,ai.floorId),ur=Math.max(.5,Math.min(2.5,(Dn.scale||1)+Jr)),yr=ur/(Dn.scale||1),vi=jc(y.current,Va),er=vi?._data||ri.current?.fc||null,Mo=er&&Gu(er)?.geometry?.coordinates||null;let ls=null;er&&Mo&&Number.isFinite(yr)&&Math.abs(yr-1)>1e-6&&(ls=qy(er,yr,{origin:Mo}),vi&&vi.setData(ls));const mo={...Dn,scale:ur},Qs=ri.current?.floorAdjustLabel||ai.buildingLabel,bl=ri.current?.floorAdjustBasePivot||er&&Gu(er)?.geometry?.coordinates||null,Do={...mo,pivot:Array.isArray(bl)?bl:mo.pivot,anchorLngLat:kv(ls||vi?._data||er)||mo.anchorLngLat||null};Q1(Qs,ai.floorId,Do),ds&&ev(ds,Do),li&&tv(li,ai.floorId,Do);try{Jt(Qs,ai.floorId,Do)}catch{}const wl=dx(Do),To=er||ri.current?.fc||null;if(wl&&To){const Dc={...To,__mfUserAdjustSignature:wl};ds&&Jo.set(ds,Dc),ri.current={...ri.current||{},fc:Dc}}const _r=ds||Ji($,ai.floorId);_r&&!ds&&(Jo.delete(_r),ih.delete(_r))}:void 0,dragHandleProps:Em})]})})(),Ul&&_d&&se.jsxs("div",{ref:U,className:"floating-panel mf-move-scenario-panel",style:{position:"absolute",zIndex:60,right:kl?"auto":16,left:kl?kl.x:"auto",top:kl?kl.y:cf,width:320,maxHeight:"70vh",overflow:"auto",padding:12,fontSize:13},children:[se.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},...Am,children:[se.jsx("div",{style:{fontWeight:600},children:"Move Scenario"}),se.jsx("button",{className:"btn secondary",style:{fontSize:11,padding:"2px 6px"},onClick:Fu,children:"Clear"})]}),se.jsxs("div",{style:{marginBottom:8},children:[se.jsx("label",{style:{display:"block",fontSize:12,marginBottom:2},children:"Scenario label (optional)"}),se.jsx("input",{className:"mf-input",value:Cl,onChange:q=>wc(q.target.value),placeholder:"e.g. Art Dept to Hurley - Option A",style:{width:"100%"}})]}),se.jsxs("div",{style:{marginBottom:8},children:[se.jsxs("div",{children:[se.jsx("b",{children:"Total SF:"})," ",Math.round(Cs.totalSF).toLocaleString()]}),se.jsxs("div",{children:[se.jsx("b",{children:"Rooms:"})," ",Cs.rooms]})]}),se.jsxs("div",{style:{marginBottom:8},children:[se.jsx("div",{style:{fontWeight:600,marginBottom:2},children:"Rooms by Room Type Description"}),Hh.length===0?se.jsx("div",{style:{fontSize:12,fontStyle:"italic",color:"#666"},children:"No rooms selected."}):se.jsxs("table",{style:{width:"100%",fontSize:12},children:[se.jsx("thead",{children:se.jsxs("tr",{children:[se.jsx("th",{style:{textAlign:"left"},children:"Room Type Description"}),se.jsx("th",{style:{textAlign:"right"},children:"Qty"}),se.jsx("th",{style:{textAlign:"right"},children:"SF"})]})}),se.jsx("tbody",{children:Hh.map(({type:q,count:be,sf:Me})=>se.jsxs("tr",{children:[se.jsx("td",{children:q}),se.jsx("td",{style:{textAlign:"right"},children:be}),se.jsx("td",{style:{textAlign:"right"},children:Math.round(Me).toLocaleString()})]},q))})]})]}),se.jsxs("div",{style:{marginTop:4},children:[se.jsx("label",{style:{fontSize:12},children:"Scenario Department"}),se.jsxs("select",{className:"mf-input",value:as,onChange:q=>Ja(q.target.value),children:[se.jsx("option",{value:"",children:"Choose department..."}),is.map(q=>se.jsx("option",{value:q,children:q},q))]}),se.jsx("button",{className:"btn primary",style:{marginTop:6},onClick:tt,disabled:!as||lc.size===0,children:"Commit"})]}),se.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",marginTop:8},children:[se.jsx("button",{className:"btn primary",onClick:Eo,disabled:es||Us||!as||!Cs,title:as?Cs?"Compare scenario vs current allocation for this department.":"Enable Move Scenario Mode and create a scenario to compare.":"Select a department for the scenario before comparing.",children:Us?"Comparing...":" Compare scenario vs current"}),sl?se.jsx("div",{style:{color:"crimson",fontSize:12},children:sl}):null]}),se.jsx("button",{className:"btn secondary",style:{width:"100%",marginTop:6},onClick:async()=>{try{const q=new $i("p","pt","letter"),be=q.internal.pageSize.getWidth(),Me=q.internal.pageSize.getHeight(),Qe=20,ct=sy({...ri.current,labelOptions:{hideDrawing:!0}});let Xe=!1,ot=0,Lt=0;if(ct){const Jr=ct.height&&ct.width?ct.height/ct.width:1,ai=Math.min(be*.55,be-Qe*3),ds=Me-Qe*2;ot=ai,Lt=ot*Jr,Lt>ds&&(Lt=ds,ot=Lt/(Jr||1)),q.addImage(ct.data,"PNG",Qe,Qe,ot,Lt),Xe=!0}const Ht="Move Scenario",Ct=Cl||"Move Scenario",en=Cl?.trim()?Cl.trim():"",xn=Xe?ot+Qe*2:Qe,Gn=be-xn-Qe,dn=16;let ln=Qe;q.setFontSize(14),q.text(Ht,xn,ln),en&&q.text(en,xn+Gn,ln,{align:"right"}),ln+=dn,q.setFontSize(12);const Tn=Jr=>{q.text(Jr,xn,ln,{maxWidth:Gn}),ln+=dn},kr=as||"None selected",ti=cd(as)||"#AAAAAA",cr=14;q.setDrawColor(0),q.setFillColor(ti),q.rect(xn,ln,cr,cr,"FD");const Lr=`Scenario Dept: ${kr}`;q.setTextColor("#000000"),q.setFont(void 0,"bold");const _i=q.splitTextToSize(Lr,Math.max(50,Gn-cr-6));_i.forEach((Jr,ai)=>{q.text(Jr,xn+cr+6,ln+cr-4+ai*dn)}),q.setFont(void 0,"normal"),ln+=Math.max(cr,_i.length*dn)+dn/2,q.setFontSize(12),Tn(`Total SF: ${Math.round(Cs.totalSF).toLocaleString()}`),Tn(`Rooms: ${Cs.rooms}`),ln+=dn/2,q.setFont(void 0,"bold"),q.text("Rooms by Type",xn,ln),ln+=dn;const xi=xn+Gn*.65,ci=xn+Gn;if(q.setFontSize(11),q.text("Type",xn,ln),q.text("Qty",xi,ln,{align:"right"}),q.text("SF",ci,ln,{align:"right"}),ln+=dn,q.setFont(void 0,"normal"),!Hh.length)q.text("No rooms selected.",xn,ln),ln+=dn;else{const Jr=Math.max(Gn-120,100);Hh.forEach(({type:ai,count:ds,sf:li})=>{const Hr=Math.round(li).toLocaleString(),qi=q.splitTextToSize(ai,Jr);qi.forEach((Yn,_n)=>{q.text(Yn,xn,ln+_n*(dn*.9))}),q.text(String(ds),xi,ln,{align:"right"}),q.text(Hr,ci,ln,{align:"right"}),ln+=dn*Math.max(1,qi.length*.9)})}q.setFont(void 0,"normal"),q.setFontSize(12),ln+=dn/4;const Qi=`${(Ct||"move-scenario").replace(/\s+/g,"-").toLowerCase()}.pdf`;q.save(Qi)}catch(q){console.error("Scenario export failed",q),alert("Export failed - see console for details.")}},children:"Export Scenario (PDF)"})]}),It&&!Ce&&se.jsx("div",{className:"map-controls-panel",style:{width:270,fontSize:12.5,lineHeight:1.25},children:se.jsxs("div",{className:"map-controls",children:[t==="admin"&&se.jsx("div",{className:"control-section",style:{background:"#fff",padding:6,border:"1px solid #ddd",borderRadius:6,marginBottom:4},children:se.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,justifyContent:"space-between"},children:[se.jsx("h5",{style:{margin:0,fontSize:13},children:"Admin access"}),x?se.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[se.jsxs("span",{style:{fontSize:12,whiteSpace:"nowrap"},children:[x.email," ",m?"(admin)":"(no admin)"]}),se.jsx("button",{onClick:Fp,children:"Sign out"})]}):se.jsx("button",{onClick:ip,children:"Sign in with Google"})]})}),!a&&se.jsxs("div",{className:"control-section theme-selector",style:{marginTop:6},children:[se.jsx("label",{htmlFor:"theme-select",style:{marginRight:8},children:"Map View:"}),se.jsx("select",{id:"theme-select",value:Ue,onChange:q=>Le(q.target.value),disabled:pt.length<=1,children:pt.map(q=>se.jsx("option",{value:q.value,children:q.label},q.value))})]}),a&&se.jsxs("div",{className:"legend",style:{marginTop:6},children:[se.jsx("h4",{children:"Legend"}),se.jsxs("div",{style:{display:"grid",gap:6,marginBottom:10},children:[se.jsx("button",{className:"btn",onClick:()=>Ke(q=>!q),children:He?"Show Marker Dots":"Show Engagement Heatmap"}),se.jsx("button",{className:"btn",onClick:()=>Rc(q=>!q),disabled:!Si||!Co,children:xa?"Hide Room Sentiment":"Show Room Sentiment"}),se.jsx("button",{className:"btn",onClick:()=>{yu(q=>{const be=!q;return be&&Ke(!1),be})},disabled:!xa||!Si||!Co,children:Ru?"Exit Room Sentiment Only":"Room Sentiment Only"}),se.jsx("button",{className:"btn",onClick:Hf,children:"Export PNG"}),se.jsx("button",{className:"btn",onClick:Yc,children:Ce?"Exit Presentation":"Presentation Mode"}),se.jsx("button",{className:"btn",onClick:kf,children:"Export Clean PNG"}),se.jsx("div",{style:{fontSize:11,color:"#555"},children:"Tip: add `?presentation=1` to the URL for clean preview mode."}),(!Si||!Co)&&se.jsx("div",{style:{fontSize:11,color:"#666"},children:"Room sentiment coloring is available in Floorplan mode with a loaded floor."})]}),xa&&Si&&Co&&se.jsxs("div",{className:"legend-section",style:{marginBottom:10},children:[se.jsx("h5",{children:"Room Fill Style"}),se.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[se.jsx("button",{className:"btn",style:{width:"100%",fontWeight:Wa==="solid"?700:500},onClick:()=>al("solid"),children:"Solid"}),se.jsx("button",{className:"btn",style:{width:"100%",fontWeight:Wa==="gradient"?700:500},onClick:()=>al("gradient"),children:"Gradient"})]})]}),He&&se.jsxs("div",{className:"legend-section",style:{marginBottom:10},children:[se.jsx("h5",{children:"Heat Colors"}),se.jsx("div",{style:{height:10,borderRadius:6,border:"1px solid #ddd",background:"linear-gradient(90deg, #1d4ed8 0%, #60a5fa 14%, #67e8f9 30%, #facc15 56%, #fb923c 78%, #ef4444 100%)"}}),se.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:"#555",marginTop:4},children:[se.jsx("span",{children:"Cool"}),se.jsx("span",{children:"Warm"})]}),se.jsx("div",{style:{fontSize:11,color:"#666",marginTop:4},children:"Category cores plus thermal multicolor halo (comments stay gray dots only)."})]}),xa&&Si&&Co&&se.jsxs("div",{className:"legend-section",style:{marginBottom:10},children:[se.jsx("h5",{children:"Room Sentiment (Dominant)"}),Ec.legendItems.length?se.jsxs(se.Fragment,{children:[Ec.legendItems.map(q=>se.jsxs("div",{className:"legend-item",style:{justifyContent:"space-between"},children:[se.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[se.jsx("span",{className:"legend-color-box",style:{backgroundColor:q.color}}),se.jsx("span",{children:q.label})]}),se.jsxs("span",{style:{fontSize:11,color:"#555"},children:[q.roomCount," rooms"]})]},q.category)),se.jsxs("div",{style:{fontSize:11,color:"#666",marginTop:4},children:[Ec.markerCount.toLocaleString()," markers matched inside ",Ec.roomCount.toLocaleString()," rooms."]})]}):se.jsx("div",{style:{fontSize:11,color:"#666"},children:"No markers are currently inside room polygons on this loaded floor."})]}),se.jsxs("div",{className:"legend-section",children:[se.jsx("h5",{children:"Marker Types"}),Object.entries(Tc||{}).map(([q,be])=>se.jsxs("div",{className:"legend-item",children:[se.jsx("span",{className:"legend-color-box",style:{backgroundColor:a&&vd[q]||be}}),se.jsx("span",{children:q})]},q))]})]}),se.jsxs("div",{className:"floorplans-section",style:{marginTop:8,padding:6,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(235,250,240,0.9), rgba(220,242,230,0.9))"},children:[se.jsx("h4",{style:{margin:"0 0 6px 0",fontSize:12.5},children:"Floorplans"}),se.jsxs("div",{className:"floorplans",style:{display:"grid",gap:6},children:[a&&se.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[se.jsx("button",{className:"btn",style:{width:"100%",fontWeight:kh==="campus"?700:500,borderColor:kh==="campus"?"#1f2937":void 0},onClick:()=>{ac("campus"),Ro()},children:"Campus"}),se.jsx("button",{className:"btn",style:{width:"100%",fontWeight:kh==="floor"?700:500,borderColor:kh==="floor"?"#1f2937":void 0},onClick:()=>{ac("floor"),Si||ts()},disabled:!Ql.length,children:"Floorplan"})]}),se.jsx("select",{id:"fp-building",style:{width:"100%"},value:$,onChange:q=>{const be=q.target.value;J(be)},children:bf.map(q=>se.jsx("option",{value:q.name,children:q.name},q.name))}),se.jsx("select",{id:"fp-floor",style:{width:"100%"},value:Dr??"",onChange:q=>Is(q.target.value),disabled:!Ql.length,children:Ql.map(q=>se.jsx("option",{value:q,children:q},q))}),se.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>{a&&ac("floor"),ts()},disabled:!Ql.length,children:"Load"}),se.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>{a&&ac("campus"),Ro()},children:"Unload"}),se.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>AI(y.current),disabled:!Si,children:"Center"})]}),!a&&se.jsxs("div",{style:{marginTop:8},children:[se.jsxs("button",{className:"mf-btn",style:{width:"100%",fontWeight:600},onClick:aa,children:["Move Scenario Mode ",Ul?"ON":"OFF"]}),Ul&&se.jsx("div",{style:{marginTop:6,fontSize:11,color:"#555",textAlign:"center"},children:"Click rooms to add/remove them from a what-if scenario. Real data is not changed."})]})]}),!a&&se.jsxs("div",{className:"floorplans-section",style:{marginTop:8,padding:6,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(255,247,235,0.9), rgba(255,239,219,0.9))"},children:[se.jsx("h4",{style:{margin:"2px 0 4px 0",fontSize:12.5},children:"Space Data Export"}),se.jsxs("div",{style:{display:"grid",gap:6},children:[se.jsxs("select",{style:{width:"100%"},value:Pa,onChange:q=>di(q.target.value),children:[se.jsx("option",{value:"__all__",children:"All buildings"}),bf.map(q=>se.jsx("option",{value:q.name,children:q.name},q.name))]}),se.jsx("input",{className:"mf-input",style:{width:"100%"},placeholder:"Filter department (optional)",value:ou,onChange:q=>yc(q.target.value)}),se.jsxs("select",{style:{width:"100%"},value:Ss,onChange:q=>au(q.target.value),children:[se.jsx("option",{value:"rooms",children:"Room rows"}),se.jsx("option",{value:"summary",children:"Building summary"})]}),se.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>fh(),disabled:ga,children:ga?"Exporting...":Ss==="summary"?"Export Summary CSV":"Export Space CSV"}),t==="admin"&&se.jsx("button",{className:"btn",style:{width:"100%"},onClick:Mt,disabled:Xr,children:Xr?"Refreshing Airtable...":"Refresh Airtable Data"})]}),se.jsx("div",{style:{fontSize:11,color:"#555",marginTop:2,minHeight:0},children:nl||(Ss==="summary"?"Summary export adds a campus total (when exporting all buildings) plus one row per building.":"")}),t==="admin"&&oi&&se.jsx("div",{style:{fontSize:11,color:"#555",marginTop:2},children:oi}),t==="admin"&&se.jsxs("div",{style:{fontSize:11,color:"#555",marginTop:2},children:["Last synced: ",Ps?Ps.toLocaleString([],{hour:"2-digit",minute:"2-digit",month:"short",day:"numeric"}):"Not yet"]})]}),!a&&se.jsxs("div",{style:{marginTop:4,padding:6,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(240,246,255,0.94), rgba(228,238,255,0.94))",boxShadow:"0 2px 6px rgba(0,0,0,0.05)"},children:[se.jsx("style",{children:"@keyframes aiSparklePulse { 0% { transform: translateY(0); } 50% { transform: translateY(-1px); } 100% { transform: translateY(0); } }"}),se.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:10},children:[se.jsxs("div",{children:[se.jsxs("div",{style:{fontWeight:800,letterSpacing:.2,display:"flex",alignItems:"center",gap:6,flexWrap:"nowrap"},children:[se.jsx("span",{style:{color:"#c62828",fontFamily:"'Trebuchet MS', 'Gill Sans', 'Helvetica Neue', Arial, sans-serif",fontWeight:700},children:"MAPFLUENCE"}),se.jsx("span",{children:"AI"}),se.jsx("span",{title:"AI-generated summaries based on currently loaded space data.",style:{display:"inline-flex",alignItems:"center",marginLeft:"auto",padding:"2px 6px",borderRadius:999,fontSize:10,fontWeight:700,border:"1px solid rgba(0,0,0,0.15)",background:"rgba(255,255,255,0.9)",animation:Js?"aiSparklePulse 2.8s ease-in-out infinite":"none"},children:" AI Summary"})]}),se.jsxs("div",{style:{marginTop:4,fontSize:11,opacity:.8,display:"flex",alignItems:"center",justifyContent:"space-between",gap:6},children:[se.jsx("span",{children:"Summaries from loaded space data"}),se.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[se.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:Js?"rgba(0,255,0,0.10)":da?"rgba(255,193,7,0.18)":"rgba(255,0,0,0.08)"},title:Js?"AI server available":da?"Checking AI status":"AI server not reachable",children:Js?"Online":da?"Checking":"Unavailable"}),se.jsx("button",{onClick:()=>Rs(!0),title:"What Mapfluence AI is doing",style:{border:"1px solid rgba(0,0,0,0.15)",borderRadius:999,background:"white",width:18,height:18,display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:10},"aria-label":"What Mapfluence AI is doing",children:"?"})]})]})]}),se.jsxs("div",{style:{display:"none",alignItems:"center",gap:6,marginTop:10},children:[se.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:Js?"rgba(0,255,0,0.10)":da?"rgba(255,193,7,0.18)":"rgba(255,0,0,0.08)"},title:Js?"AI server available":da?"Checking AI status":"AI server not reachable",children:Js?"Online":da?"Checking":"Unavailable"}),se.jsx("button",{onClick:()=>Rs(!0),title:"What Mapfluence AI is doing",style:{border:"1px solid rgba(0,0,0,0.15)",borderRadius:999,background:"white",width:20,height:20,display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:11,marginTop:2},"aria-label":"What Mapfluence AI is doing",children:"i"})]})]}),se.jsxs("div",{style:{display:"grid",gap:6,marginTop:6},children:[se.jsx("button",{style:{padding:"5px 7px",fontSize:11},disabled:es||!sr||ta,onClick:Sa,children:ta?"Explaining...":" Explain this floor"}),se.jsx("button",{style:{padding:"5px 7px",fontSize:11},disabled:es||!nn||Ga,onClick:Ea,children:Ga?"Explaining...":" Explain this building"}),se.jsx("button",{style:{padding:"5px 7px",fontSize:11},disabled:es||!$r||Hi,onClick:Gl,children:Hi?"Explaining...":" Explain campus"})]}),se.jsx("div",{style:{marginTop:6,display:"grid",gap:4},children:se.jsx("button",{style:{padding:"5px 7px",fontSize:11},onClick:()=>ro(!0),children:" Ask Mapfluence"})}),t==="admin"&&se.jsx("div",{style:{marginTop:6},children:se.jsx("button",{disabled:es,onClick:()=>wo(!0),style:{width:"100%",padding:"5px 7px",fontSize:11},children:" Create move scenario"})}),se.jsx("div",{style:{marginTop:10,fontSize:11,opacity:.75,lineHeight:1.35},children:"Results are descriptive and do not modify project data."}),co||lr||Wi?se.jsx("div",{style:{marginTop:8,color:"crimson",fontSize:12},children:co||lr||Wi}):null]})]})}),t==="admin"&&It&&!Ce&&se.jsxs("div",{style:{position:"absolute",left:20,bottom:20,width:270,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(245,245,245,0.96), rgba(230,230,230,0.96))",padding:8,boxShadow:"0 2px 6px rgba(0,0,0,0.05)"},children:[se.jsx("h4",{style:{margin:"0 0 6px 0",fontSize:12.5},children:"Data Filters"}),se.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[se.jsx("button",{className:"btn",onClick:zu,children:"Export Map Data"}),se.jsx("button",{className:"btn",onClick:Kc,children:"Clear Conditions"})]})]}),a&&Xt&&!Ce&&se.jsxs("div",{className:"help-panel",style:{right:20,bottom:20},children:[se.jsx("button",{className:"close-button","aria-label":"Close help",onClick:()=>Ze(!1),children:""}),se.jsx("h4",{children:"How to Use This Map"}),se.jsxs("ul",{children:[se.jsx("li",{children:"Click anywhere on the map to add a marker."}),se.jsx("li",{children:"Select a marker type and add an optional comment."}),se.jsx("li",{children:"Markers are saved to the engagement demo dataset."})]}),se.jsx("button",{className:"close-button-main",onClick:()=>Ze(!1),children:"Close"})]}),!a&&Bl&&po&&se.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.35)"},children:se.jsxs("div",{ref:R,className:"mf-room-edit-panel",style:{position:"absolute",left:_u?_u.x:"50%",top:_u?_u.y:"50%",transform:_u?"none":"translate(-50%, -50%)",width:520,maxWidth:"90vw",background:"#fff",borderRadius:14,padding:16,boxShadow:"0 18px 36px rgba(0,0,0,0.2)"},children:[se.jsx("div",{style:{display:"flex",alignItems:"center",marginBottom:12},...Tm,children:se.jsx("h4",{style:{margin:0},children:S.length>1?`Edit ${S.length} Rooms`:`Edit Room ${po.feature?.properties?.name||po.roomLabel||""}`})}),S.length>1&&se.jsxs("div",{style:{marginBottom:12},children:[se.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Selected Rooms"}),se.jsx("div",{style:{maxHeight:180,overflow:"auto",border:"1px solid #e5e5e5",borderRadius:6},children:se.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[se.jsx("thead",{style:{background:"#f9f9f9",position:"sticky",top:0},children:se.jsxs("tr",{children:[se.jsx("th",{style:{padding:"6px 8px",width:40,textAlign:"center"},children:se.jsx("input",{type:"checkbox",checked:ua.size===S.length,onChange:q=>{const be=q.target.checked?new Set(S.map(Me=>Me.roomId||String(Me.revitId??""))):new Set;tl(be)}})}),se.jsx("th",{style:{padding:"6px 8px",textAlign:"left"},children:"Room"}),se.jsx("th",{style:{padding:"6px 8px",textAlign:"right"},children:"Area (SF)"}),se.jsx("th",{style:{padding:"6px 8px",textAlign:"left"},children:"Department"}),se.jsx("th",{style:{padding:"6px 8px",textAlign:"left"},children:"Room Type Description"})]})}),se.jsx("tbody",{children:S.map(q=>{const be=q.roomId||String(q.revitId??""),Me=ua.has(be),Qe=Number.isFinite(q.properties?.area)?Math.round(q.properties.area):"";return se.jsxs("tr",{style:{borderTop:"1px solid #f0f0f0"},children:[se.jsx("td",{style:{padding:"6px 8px",textAlign:"center"},children:se.jsx("input",{type:"checkbox",checked:Me,onChange:ct=>{tl(Xe=>{const ot=new Set(Xe||[]);return ct.target.checked?ot.add(be):ot.delete(be),ot})}})}),se.jsx("td",{style:{padding:"6px 8px",fontWeight:600},children:q.roomLabel||q.feature?.properties?.name||be}),se.jsx("td",{style:{padding:"6px 8px",textAlign:"right",whiteSpace:"nowrap"},children:Qe?Qe.toLocaleString():""}),se.jsx("td",{style:{padding:"6px 8px"},children:q.properties?.department||q.feature?.properties?.department||""}),se.jsx("td",{style:{padding:"6px 8px"},children:q.properties?.type||q.feature?.properties?.type||""})]},be)})})]})})]}),se.jsx(FA,{label:"Room Type",value:po.properties?.type??po.feature?.properties?.type??"",onChange:q=>Ra(be=>be&&{...be,properties:{...be.properties,type:q}}),options:ps,placeholder:"Search or choose a type..."}),se.jsx(FA,{label:"Department",value:po.properties?.department??po.feature?.properties?.department??"",onChange:q=>Ra(be=>be&&{...be,properties:{...be.properties,department:q}}),options:is,placeholder:"Search or choose a department..."}),As&&se.jsxs("div",{className:"mf-form-row",children:[se.jsx("label",{children:"Occupant"}),se.jsx("input",{className:"mf-input",type:"text",value:po.properties?.occupant??"",onChange:q=>Ra(be=>be&&{...be,properties:{...be.properties,occupant:q.target.value}}),placeholder:"(optional)"})]}),se.jsxs("div",{className:"mf-form-row",children:[se.jsx("label",{children:"Area (SF)"}),se.jsx("input",{className:"mf-input",value:po.properties?.area??"",disabled:!0,readOnly:!0})]}),Xo&&se.jsxs("div",{className:"mf-form-row",children:[se.jsx("label",{children:"Seat Count"}),se.jsx("input",{className:"mf-input",type:"number",min:"0",value:Ds==="__MIXED__"?"":Ds,placeholder:mn&&Ds==="__MIXED__"?"varies":"",onChange:q=>{const be=q.target.value;Ra(Me=>Me&&{...Me,properties:{...Me.properties,seatCount:be}})}})]}),As&&se.jsxs("div",{className:"mf-form-row",children:[se.jsx("label",{children:"Occupancy Status"}),se.jsxs("select",{className:"mf-input",value:yi==="__MIXED__"?"":yi,onChange:q=>{const be=q.target.value;Ra(Me=>Me&&{...Me,properties:{...Me.properties,occupancyStatus:be||(mn?null:"")}})},children:[mn&&yi==="__MIXED__"?se.jsx("option",{value:"",children:"-- Mixed --"}):se.jsx("option",{value:"",children:"--"}),Ae.map(q=>se.jsx("option",{value:q,children:q},q))]})]}),se.jsxs("div",{className:"mf-form-row",children:[se.jsx("label",{children:"Comments"}),se.jsx("textarea",{className:"mf-input",rows:3,value:po.properties?.comments??"",onChange:q=>Ra(be=>be&&{...be,properties:{...be.properties,comments:q.target.value}})})]}),se.jsxs("div",{className:"mf-actions",children:[se.jsx("button",{className:"btn",onClick:d,children:"Cancel"}),se.jsx("button",{className:"btn",onClick:async()=>{const q=ua,be=S.length?S.filter(Ct=>q.has(Ct.roomId||String(Ct.revitId??""))):[];if(!be.length)return;let Me=0;const Qe=be.length>1,ct=po.properties||{},Xe=y.current,ot=jc(Xe,Va),Lt=ot&&(ot._data||ot.serialize?.().data)||null,Ht=Lt?Qu(Lt)?.features||[]:[];for(const Ct of be){const en={type:Ct.properties?.type??Ct.feature?.properties?.type??"",department:Ct.properties?.department??Ct.feature?.properties?.department??"",occupant:Ct.properties?.occupant??Ct.feature?.properties?.occupant??"",occupancyStatus:Ct.properties?.occupancyStatus??Ct.feature?.properties?.occupancyStatus??Ct.properties?.["Occupancy Status"]??Ct.feature?.properties?.["Occupancy Status"]??Ct.properties?.OccupancyStatus??Ct.feature?.properties?.OccupancyStatus??"",comments:Ct.properties?.comments??Ct.feature?.properties?.comments??"",seatCount:Dw({...Ct.feature?.properties||{},...Ct.properties||{}})},Gn=ct.occupancyStatus!=null&&String(ct.occupancyStatus).trim()!==""?ct.occupancyStatus:en.occupancyStatus,dn=As?Qe?ct.occupant!=null&&String(ct.occupant).trim()!==""?ct.occupant:en.occupant:ct.occupant??en.occupant:void 0,ln=Xo?ct.seatCount!=null?ct.seatCount:en.seatCount:void 0,Tn={...Ct.properties,...ct,type:ct.type!=null&&String(ct.type).trim()!==""?ct.type:en.type,department:ct.department!=null&&String(ct.department).trim()!==""?ct.department:en.department,...As?{occupancyStatus:Gn,occupant:dn}:{},...Xo?{seatCount:ln}:{}};if(As&&(Tn.OccupancyStatus=Gn,Tn["Occupancy Status"]=Gn),await Dt({roomId:Ct.roomId,buildingId:Ct.buildingId,buildingName:Ct.buildingName,floorName:Ct.floorName,revitId:Ct.revitId,roomLabel:Ct.roomLabel,roomNumber:Ct.roomNumber,properties:Tn})&&(Me+=1,Ht.length)){const ti=Ct.revitId??Ct.feature?.id??Ct.feature?.properties?.RevitId??null;if(ti!=null){const cr=Ht.find(Lr=>(Lr.id??Lr.properties?.RevitId)===ti);cr&&cr.properties&&(cr.properties.department=Tn.department??cr.properties.department,cr.properties.department=cr.properties.department||Tn.department||"",cr.properties.Department=cr.properties.department,cr.properties.type=Tn.type??cr.properties.type,cr.properties.Type=cr.properties.type,cr.properties.RoomType=cr.properties.type,As&&(cr.properties.Occupant=Tn.occupant??cr.properties.Occupant,cr.properties.occupant=cr.properties.Occupant,cr.properties.occupancyStatus=Tn.occupancyStatus??cr.properties.occupancyStatus,cr.properties.OccupancyStatus=Tn.OccupancyStatus??cr.properties.OccupancyStatus,cr.properties["Occupancy Status"]=Tn["Occupancy Status"]??cr.properties["Occupancy Status"]),Xo&&(cr.properties.SeatCount=Tn.seatCount??cr.properties.SeatCount,cr.properties["Seat Count"]=Tn.seatCount??cr.properties["Seat Count"],cr.properties.seatCount=Tn.seatCount??cr.properties.seatCount))}}}if(Me>0){try{if(ot&&Ht.length){const Ct=Qu(Lt)||{type:"FeatureCollection",features:[]};Ct.features=Ht,ot.setData(Ct)}}catch{}po.refreshPopup?.(),oa(),d()}},children:S.length>1?`Save ${S.length} Rooms`:"Save"})]})]})}),ea&&Ni&&se.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:se.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(760px, 92vw)",padding:16},children:[se.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[se.jsxs("div",{children:[se.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[se.jsx("div",{style:{fontWeight:700,fontSize:16},children:Ni.title&&Ni.title.includes("Summary")?Ni.title:`${Ni.title||"Level"} - Summary`}),se.jsx("span",{title:"AI-generated summary based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI Summary"})]}),se.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:"AI-assisted overview"})]}),se.jsx("button",{className:"btn",onClick:()=>Wo(!1),children:"Close"})]}),se.jsxs("div",{style:{marginTop:10,lineHeight:1.45},children:[Ni.summary?se.jsx("p",{style:{margin:"6px 0 10px 0"},children:Ni.summary}):null,se.jsxs("div",{children:[se.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Insights"}),se.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:(Ni.insights||[]).map((q,be)=>se.jsx("li",{children:q},be))})]}),Array.isArray(Ni.watchouts)&&Ni.watchouts.length?se.jsxs("div",{children:[se.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Watchouts"}),se.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:Ni.watchouts.map((q,be)=>se.jsx("li",{children:q},be))})]}):null,Array.isArray(Ni.data_used)&&Ni.data_used.length?se.jsxs("small",{style:{color:"#555"},children:["Data used: ",Ni.data_used.join(", ")]}):null,se.jsx("div",{style:{marginTop:12,fontSize:11,color:"#666"},children:"AI summaries reflect available data at the time of generation."})]})]})}),rl&&Ur&&se.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:se.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(760px, 92vw)",padding:16},children:[se.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[se.jsxs("div",{children:[se.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[se.jsx("div",{style:{fontWeight:700,fontSize:16},children:Ur.title&&Ur.title.includes("Summary")?Ur.title:`${Ur.title||"Building"} - Summary`}),se.jsx("span",{title:"AI-generated summary based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI Summary"})]}),se.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:"AI-assisted overview"})]}),se.jsx("button",{className:"btn",onClick:()=>il(!1),children:"Close"})]}),se.jsxs("div",{style:{marginTop:10,lineHeight:1.45},children:[Ur.summary?se.jsx("p",{style:{margin:"6px 0 10px 0"},children:Ur.summary}):null,se.jsxs("div",{children:[se.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Insights"}),se.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:(Ur.insights||[]).map((q,be)=>se.jsx("li",{children:q},be))})]}),Array.isArray(Ur.watchouts)&&Ur.watchouts.length?se.jsxs("div",{children:[se.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Watchouts"}),se.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:Ur.watchouts.map((q,be)=>se.jsx("li",{children:q},be))})]}):null,Array.isArray(Ur.data_used)&&Ur.data_used.length?se.jsxs("small",{style:{color:"#555"},children:["Data used: ",Ur.data_used.join(", ")]}):null,se.jsx("div",{style:{marginTop:12,fontSize:11,color:"#666"},children:"AI summaries reflect available data at the time of generation."})]})]})}),$a&&ss&&se.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:se.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(760px, 92vw)",padding:16},children:[se.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[se.jsxs("div",{children:[se.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[se.jsx("div",{style:{fontWeight:700,fontSize:16},children:ss.title&&ss.title.includes("Summary")?ss.title:`${ss.title||Se} - Summary`}),se.jsx("span",{title:"AI-generated summary based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI Summary"})]}),se.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:"AI-assisted overview"})]}),se.jsx("button",{className:"btn",onClick:()=>Ri(!1),children:"Close"})]}),se.jsxs("div",{style:{marginTop:10,lineHeight:1.45},children:[ss.summary?se.jsx("p",{style:{margin:"6px 0 10px 0"},children:ss.summary}):null,se.jsxs("div",{children:[se.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Insights"}),se.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:(ss.insights||[]).map((q,be)=>se.jsx("li",{children:q},be))})]}),Array.isArray(ss.watchouts)&&ss.watchouts.length?se.jsxs("div",{children:[se.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Watchouts"}),se.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:ss.watchouts.map((q,be)=>se.jsx("li",{children:q},be))})]}):null,Array.isArray(ss.data_used)&&ss.data_used.length?se.jsxs("small",{style:{color:"#555"},children:["Data used: ",ss.data_used.join(", ")]}):null,se.jsx("div",{style:{marginTop:12,fontSize:11,color:"#666"},children:"AI summaries reflect available data at the time of generation."})]})]})}),lu&&Ei&&(()=>{const q=(en={})=>{let xn=0,Gn=0,dn=0;for(const[ln,Tn]of Object.entries(en||{})){const kr=String(ln||"").toLowerCase(),ti=Number(Tn||0)||0;kr.includes("office")?xn+=ti:kr.includes("class")?Gn+=ti:kr.includes("lab")&&(dn+=ti)}return{offices:xn,classrooms:Gn,labs:dn}},be=hn||{},Me=Cs||{},Qe=Ei?.scenarioDept||as||"Selected Dept",ct=hn?.__label||"baseline",Xe=jn,ot=`Baseline (${Qe} in ${ct})`,Lt=`Scenario (${Qe} to ${Xe})`,Ht=q(be.roomTypes),Ct=q(Me.roomTypes);return se.jsx("div",{style:{position:"fixed",inset:0,zIndex:10006,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:se.jsxs("div",{ref:Jc,className:"mf-ai-modal-panel",style:{position:"fixed",left:Yh?Yh.x:"50%",top:Yh?Yh.y:"50%",transform:Yh?"none":"translate(-50%, -50%)",width:"min(760px, 92vw)",padding:16,maxHeight:"90vh",overflow:"auto"},children:[se.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[se.jsx("div",{...Mh,style:{fontWeight:700},children:`${as||"Scenario"} - ${hn?.__label||"baseline"} to ${jn}${Dr?` (${Dr})`:""}`}),se.jsxs("div",{style:{display:"flex",gap:8},children:[se.jsx("button",{className:"btn",onClick:it,children:"Export Scenario (PDF)"}),se.jsx("button",{className:"btn",onClick:()=>mu(!1),children:"Close"})]})]}),se.jsx("p",{style:{marginTop:10},children:Ei.summary}),se.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:10,marginBottom:10},children:[se.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[se.jsx("div",{style:{fontWeight:700,marginBottom:4},children:ot}),se.jsxs("div",{style:{fontSize:13},children:["SF: ",Math.round(hn?.totalSF||0).toLocaleString()]}),se.jsxs("div",{style:{fontSize:13},children:["Rooms: ",Math.round(hn?.rooms||0).toLocaleString()]}),Ht.offices||Ht.classrooms||Ht.labs?se.jsxs(se.Fragment,{children:[se.jsxs("div",{style:{fontSize:13},children:["Offices: ",Ht.offices]}),se.jsxs("div",{style:{fontSize:13},children:["Classrooms: ",Ht.classrooms]}),se.jsxs("div",{style:{fontSize:13},children:["Labs: ",Ht.labs]})]}):null]}),se.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[se.jsx("div",{style:{fontWeight:700,marginBottom:4},children:Lt}),se.jsxs("div",{style:{fontSize:13},children:["SF: ",Math.round(Cs?.totalSF||0).toLocaleString()]}),se.jsxs("div",{style:{fontSize:13},children:["Rooms: ",Math.round(Cs?.rooms||0).toLocaleString()]}),Ct.offices||Ct.classrooms||Ct.labs?se.jsxs(se.Fragment,{children:[se.jsxs("div",{style:{fontSize:13},children:["Offices: ",Ct.offices]}),se.jsxs("div",{style:{fontSize:13},children:["Classrooms: ",Ct.classrooms]}),se.jsxs("div",{style:{fontSize:13},children:["Labs: ",Ct.labs]})]}):null]})]}),se.jsx("b",{children:`Scenario - ${Ei?.scenarioDept||as||"Selected Dept"}`}),se.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:8},children:[se.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[se.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"Pluses"}),se.jsx("ul",{style:{margin:0,paddingLeft:18},children:(Ei?.scenarioPros||[]).map((en,xn)=>se.jsx("li",{children:en},xn))})]}),se.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[se.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"Minuses"}),se.jsx("ul",{style:{margin:0,paddingLeft:18},children:(Ei?.scenarioCons||[]).map((en,xn)=>se.jsx("li",{children:en},xn))})]})]}),Ei.risks?.length?se.jsxs(se.Fragment,{children:[se.jsx("b",{children:"Risks / watchouts"}),se.jsx("ul",{children:Ei.risks.map((en,xn)=>se.jsx("li",{children:en},xn))})]}):null,Ei.notes?.length?se.jsxs(se.Fragment,{children:[se.jsx("b",{children:"Notes"}),se.jsx("ul",{children:Ei.notes.map((en,xn)=>se.jsx("li",{children:en},xn))})]}):null]})})})(),gi&&se.jsx("div",{style:{position:"fixed",inset:0,zIndex:10002,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:se.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(560px, 92vw)",padding:16,lineHeight:1.4},children:[se.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[se.jsxs("div",{children:[se.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[se.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Create move scenario (AI)"}),se.jsx("span",{title:"AI-generated scenario plan based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),se.jsx("div",{style:{fontSize:12,color:"#555"},children:"Uses campus-wide room inventory to suggest candidates."})]}),se.jsx("button",{className:"btn",onClick:()=>wo(!1),children:"Close"})]}),se.jsxs("div",{style:{marginTop:10},children:[se.jsx("label",{style:{fontWeight:600,fontSize:12},children:"Request"}),se.jsx("textarea",{value:Vs,onChange:q=>Nc(q.target.value),rows:3,placeholder:"e.g. Find a new home for Physics; move the Art department to the Gray Center.",style:{width:"100%",resize:"vertical",padding:8,borderRadius:8,border:"1px solid #d0d0d0",marginTop:4}})]}),na?se.jsx("div",{style:{color:"crimson",marginTop:6,fontSize:12},children:na}):null,se.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginTop:10},children:[se.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:12,color:"#444"},children:[se.jsx("input",{type:"checkbox",checked:Ol,onChange:q=>ha(q.target.checked)}),"Strict fit (5% target)"]}),se.jsx("button",{className:"btn",disabled:Pu||!Vs.trim()||es,onClick:If,children:Pu?"Planning...":"Create move scenario"})]})]})}),xs&&se.jsx("div",{style:{position:"fixed",inset:0,zIndex:10004,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:se.jsxs("div",{ref:Yf,className:"mf-ai-modal-panel",style:{position:"fixed",left:eu?eu.x:"50%",top:eu?eu.y:"50%",transform:eu?"none":"translate(-50%, -50%)",width:"min(760px, 92vw)",padding:12,lineHeight:1.35,fontSize:12,maxHeight:"90vh",overflow:"auto"},children:[se.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[se.jsxs("div",{children:[se.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},...kg,children:[se.jsx("div",{style:{fontWeight:700,fontSize:16},children:xs.title||"Move scenario plan"}),se.jsx("span",{title:"AI-generated scenario plan based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),xs.interpretedIntent?se.jsx("div",{style:{fontSize:12,color:"#555"},children:xs.interpretedIntent}):null]}),se.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[se.jsx("button",{className:"btn",onClick:()=>Zu(xs),children:"Add to Scenario Comparison"}),se.jsx("button",{className:"btn",onClick:()=>Ts(null),children:"Close"})]})]}),xs.selectionCriteria?.filter(q=>!/vacan/i.test(q||"")).length?se.jsxs("div",{style:{marginTop:10},children:[se.jsx("b",{children:"Selection criteria"}),se.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:xs.selectionCriteria.filter(q=>!/vacan/i.test(q||"")).map((q,be)=>se.jsx("li",{children:q},be))})]}):null,se.jsxs("div",{style:{marginTop:10},children:[se.jsx("b",{children:"Recommended candidates"}),xs.recommendedCandidates?.length?se.jsxs("div",{style:{marginTop:6,border:"1px solid #e0e0e0",borderRadius:8,overflow:"hidden"},children:[se.jsx("div",{style:{display:"flex",justifyContent:"flex-end",padding:"6px 8px",background:"#f8f9fb"},children:se.jsx("button",{className:"btn",onClick:Xc,children:"Select these rooms in Move Scenario"})}),se.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 3fr",background:"#f8f9fb",padding:"6px 8px",fontWeight:600,fontSize:12},children:[se.jsx("div",{children:"Location"}),se.jsx("div",{children:"Room"}),se.jsx("div",{style:{textAlign:"right"},children:"SF"}),se.jsx("div",{style:{textAlign:"right"},children:"Match / Notes"}),se.jsx("div",{children:"Rationale"})]}),se.jsx("div",{children:xs.recommendedCandidates.map((q,be)=>se.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 3fr",padding:"6px 8px",borderTop:"1px solid #f0f0f0",fontSize:12},children:[se.jsxs("div",{children:[se.jsx("div",{style:{fontWeight:600},children:q.buildingLabel||"Building"}),se.jsx("div",{style:{opacity:.75},children:q.floorId||""})]}),se.jsxs("div",{children:[se.jsx("div",{style:{fontWeight:600},children:q.roomLabel||"Room"}),se.jsx("div",{style:{opacity:.75},children:q.type||"Unspecified"})]}),se.jsx("div",{style:{textAlign:"right"},children:Math.round(Number(q.sf||0)).toLocaleString()}),se.jsx("div",{style:{textAlign:"right"},children:(()=>{const Me=String(q.occupant||"").trim(),Qe=String(q.occupantDept||q.department||"").trim();return Me?` Occupied  requires relocation${Qe?` of ${Qe}`:""}`:""})()}),se.jsx("div",{children:Vw(q.rationale)||""})]},q.id||be))})]}):se.jsx("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:"No candidates returned."})]}),xs.assumptions?.length?se.jsxs("div",{style:{marginTop:10},children:[se.jsx("b",{children:"Assumptions"}),se.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:xs.assumptions.map((q,be)=>se.jsx("li",{children:q},be))})]}):null,xs.nextSteps?.length?se.jsxs("div",{style:{marginTop:10},children:[se.jsx("b",{children:"Next steps"}),se.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:xs.nextSteps.map((q,be)=>se.jsx("li",{children:q},be))})]}):null]})}),Sr&&se.jsx("div",{style:{position:"fixed",inset:0,zIndex:10002,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:se.jsxs("div",{style:{width:"min(520px, 92vw)",background:"#fff",borderRadius:12,padding:16,boxShadow:"0 22px 44px rgba(0,0,0,0.25)",lineHeight:1.5,fontSize:13},children:[se.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[se.jsx("div",{style:{fontWeight:700,fontSize:16},children:"What Mapfluence AI is doing"}),se.jsx("button",{className:"btn",onClick:()=>Rs(!1),children:"Close"})]}),se.jsxs("div",{style:{marginTop:10},children:[se.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"What Mapfluence AI is doing"}),se.jsxs("ul",{style:{paddingLeft:18,margin:"0 0 10px 0"},children:[se.jsx("li",{children:"Generates summaries and comparisons from the statistics currently loaded in this session."}),se.jsx("li",{children:"Uses your selected scope (campus / building / floor) and scenario totals when available."}),se.jsx("li",{children:"Produces descriptive output and does not modify project data."})]}),se.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"What Mapfluence AI is not doing"}),se.jsxs("ul",{style:{paddingLeft:18,margin:0},children:[se.jsx("li",{children:"Not writing to the database automatically."}),se.jsx("li",{children:"Not making final planning decisions."}),se.jsx("li",{children:"Not inventing missing data; it will note what's unavailable."})]})]})]})}),pn&&se.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:se.jsxs("div",{style:{width:480,maxWidth:"90vw",background:"#fff",borderRadius:14,padding:18,boxShadow:"0 22px 44px rgba(0,0,0,0.25)"},children:[se.jsx("h4",{style:{margin:"0 0 10px 0"},children:"Confirm Move"}),se.jsx("div",{style:{fontSize:13,color:"#333",marginBottom:10},children:`Move ${pn.person||pn.from?.occupantName||"-"} from ${pn.from?.buildingId||""} ${pn.from?.roomLabel||"-"} to ${pn.to?.buildingId||""} ${pn.to?.roomLabel||"-"}.`}),se.jsxs("div",{className:"mf-form-row",children:[se.jsx("label",{children:"Person"}),se.jsx("input",{className:"mf-input",value:pn.person||"",onChange:q=>Et(be=>be&&{...be,person:q.target.value})})]}),se.jsxs("div",{className:"mf-form-row",children:[se.jsx("label",{children:"Effective Date"}),se.jsx("input",{className:"mf-input",type:"date",value:pn.effectiveDate||"",onChange:q=>Et(be=>be&&{...be,effectiveDate:q.target.value})})]}),se.jsxs("div",{className:"mf-form-row",children:[se.jsx("label",{children:"Comments"}),se.jsx("textarea",{className:"mf-input",rows:3,value:pn.comments||"",onChange:q=>Et(be=>be&&{...be,comments:q.target.value})})]}),se.jsxs("div",{className:"mf-actions",style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[se.jsx("button",{className:"btn",onClick:Im,children:"Cancel"}),se.jsx("button",{className:"btn",onClick:Lg,children:"Confirm move"})]})]})})]})},T$=({config:n,universityId:e,persona:t,engagementMode:i=!1})=>se.jsx(PL,{config:n,universityId:e,persona:t,engagementMode:i}),A$=({config:n,universityId:e})=>se.jsx("div",{className:"admin-page",style:{width:"100%",height:"100%"},children:se.jsx(PL,{config:n,universityId:e,mode:"admin"})}),I$=[{universityName:"Hastings College",enableDrawingEntry:!0,buildings:"Hastings_College_Buildings.geojson",boundary:"Hastings_College_Boundary.geojson",outdoorSpacesUrl:"geojson/HC_Outdoor_map.geojson",style:"mapbox://styles/mapbox/streets-v12",lng:-98.371164,lat:40.592958,zoom:15.8,pitch:39,bearing:0,logos:{clarkEnersen:"Clark_Enersen_Logo.png",university:"HC_image.png"}}],C$="rockhurst",k$="Rockhurst University",L$=!1,P$="mapbox://styles/mapbox/light-v10",N$=39.038,R$=-94.57,M$=16,D$=45,O$=-17.6,F$={universityId:C$,universityName:k$,enableDrawingEntry:L$,style:P$,lat:N$,lng:R$,zoom:M$,pitch:D$,bearing:O$},B$=`\uFEFF{"type":"FeatureCollection", "features": [\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37413233965788,40.590313487951285],[-98.37471259730057,40.59032045203848],[-98.37471509841112,40.5901317883289],[-98.3741348407684,40.590126090423354],[-98.37413233965788,40.590313487951285]]]},"properties":{"id":"Perkins Library"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3736191179045,40.59064334156154],[-98.37362033072382,40.59056689953065],[-98.37387380996378,40.59057058348595],[-98.37387866124111,40.5903256000165],[-98.3736639922197,40.59032283703991],[-98.37366520503903,40.59030073322319],[-98.37333455263524,40.590296927283184],[-98.37333901987164,40.59001629518303],[-98.37333621176148,40.59001558437107],[-98.37294307634048,40.59001416274713],[-98.37294319965034,40.59029870430257],[-98.37297039172454,40.59029870430257],[-98.37297048222555,40.590645772706125],[-98.3736191179045,40.59064334156154]]]},"properties":{"id":"Kiewit Building"}},\r
{\r
  "type": "Feature",\r
  "geometry": {\r
    "type": "Polygon",\r
    "coordinates": [\r
      [\r
        [-98.374702, 40.590876],\r
        [-98.374710, 40.590479],\r
        [-98.374496, 40.590477],\r
        [-98.374487, 40.590874],\r
        [-98.374702, 40.590876]\r
      ]\r
    ]\r
  },\r
  "properties": {\r
    "id": "Hurley-McDonald Hall",\r
    "floorplans": [\r
      {\r
        "name": "Basement",\r
        "url": "/floorplans/hastings/Hurley_McDonald_Floor0.png",\r
        "bounds": [\r
          [-98.374714, 40.590887], \r
          [-98.374499, 40.590891], \r
          [-98.374507, 40.590498], \r
          [-98.374739, 40.590506]  \r
        ]\r
      },\r
      {\r
        "name": "First Floor",\r
        "url": "/floorplans/hastings/Hurley_McDonald_Floor1.png",\r
        "bounds": [\r
          [-98.374714, 40.590887],\r
          [-98.374499, 40.590891],\r
          [-98.374507, 40.590498],\r
          [-98.374739, 40.590506]\r
        ]\r
      },\r
      {\r
        "name": "Second Floor",\r
        "url": "/floorplans/hastings/HurleyMcDonald_Floor2.png",\r
        "bounds": [\r
          [-98.374714, 40.590887],\r
          [-98.374499, 40.590891],\r
          [-98.374507, 40.590498],\r
          [-98.374739, 40.590506]\r
        ]\r
      }\r
    ]\r
  }\r
},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37353314553962,40.59087905110178],[-98.37353314553962,40.590708779882675],[-98.37343235743603,40.590709639839424],[-98.37342896008421,40.59087905110178],[-98.37353314553962,40.59087905110178]]]},"properties":{"id":"Name1"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37382750296666,40.591193020762205],[-98.37382980649612,40.59115891068626],[-98.37386551120254,40.59115891068626],[-98.37387127002614,40.590980488467004],[-98.37383211002555,40.59097961384712],[-98.37382980649612,40.59094812752329],[-98.37358217708065,40.59094462904195],[-98.37357987355122,40.5911921461451],[-98.37382750296666,40.591193020762205]]]},"properties":{"id":"Daugherty Student Engagement Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37229446140842,40.59159148756918],[-98.37223367991126,40.591483310642786],[-98.37238183481058,40.59144580926746],[-98.37226027181626,40.59117752958438],[-98.37226217123805,40.59064529412409],[-98.37211591576053,40.59063952461079],[-98.3721178151823,40.59070587398362],[-98.372022844093,40.59070731636056],[-98.372022844093,40.590756357157964],[-98.37191647647298,40.590759241909645],[-98.3719107782076,40.59114002803756],[-98.37187278977188,40.591154451711894],[-98.37211211691694,40.59164773950174],[-98.37229446140842,40.59159148756918]]]},"properties":{"id":"Morrison-Reeves Science Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37336463965526,40.591802138119164],[-98.37337046026076,40.59172257877987],[-98.37363587987099,40.59172611475252],[-98.3736393722343,40.59156345981731],[-98.37337046026076,40.59155903984072],[-98.37337395262405,40.59147948021219],[-98.37323658633453,40.591475060230046],[-98.37323891457672,40.59155903984072],[-98.373206319186,40.59155815584537],[-98.37320748330708,40.591719042807036],[-98.37323891457672,40.591719042807036],[-98.37323658633453,40.59179860215054],[-98.37336463965526,40.591802138119164]]]},"properties":{"id":"Calvin H. French Memorial Chapel"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37201576628836,40.59262743658687],[-98.37201700980901,40.592578334337375],[-98.37203317557764,40.592578334337375],[-98.37204312374293,40.59206842423039],[-98.37202695797433,40.59206747994882],[-98.37202944501566,40.59201271159418],[-98.3719846782718,40.59201271159418],[-98.37198343475114,40.592025931545955],[-98.37195607729657,40.592026875828125],[-98.37195483377592,40.5920627585407],[-98.37188768366015,40.592063702822344],[-98.3718789790155,40.592578334337375],[-98.37194364208995,40.59257927861174],[-98.37194239856929,40.59260666256263],[-98.3719809477098,40.59260666256263],[-98.37197970418916,40.59262743658687],[-98.37201576628836,40.59262743658687]]]},"properties":{"id":"Altman Hall Residency"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37345908377378,40.592428311631785],[-98.37346414649254,40.592127677901516],[-98.37348540991137,40.592127677901516],[-98.37354717508036,40.59209077136578],[-98.37348844754263,40.59203771818496],[-98.3731381074038,40.59203694929797],[-98.3731340572288,40.592211486417455],[-98.37322214853538,40.59221379307237],[-98.3732170858166,40.592428311631785],[-98.37345908377378,40.592428311631785]]]},"properties":{"id":"Scott Studio Theatre"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37378031069133,40.59233336628362],[-98.37378112606382,40.592306742401384],[-98.37381863319813,40.59230736156156],[-98.37382271006055,40.592159382117295],[-98.37378520292624,40.59215876295575],[-98.37378520292624,40.59213151984219],[-98.37363680513397,40.59212966235677],[-98.37363680513397,40.59215133301679],[-98.37359522113724,40.59215133301679],[-98.37359032890232,40.59231107652247],[-98.37363272827155,40.59231107652247],[-98.37363354364403,40.59233336628362],[-98.37378031069133,40.59233336628362]]]},"properties":{"id":"McCormick Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37472106546831,40.59285396151976],[-98.3747264832459,40.59266057179469],[-98.3747658645213,40.59266160297934],[-98.37476450654628,40.59255229731774],[-98.37474549489609,40.59255126613141],[-98.37474549489609,40.59250692510384],[-98.37467895412038,40.59250692510384],[-98.37467895412038,40.592480114235705],[-98.37464228879502,40.592479083048254],[-98.37464093082,40.59250795629086],[-98.37457846396934,40.59250795629086],[-98.37457826932462,40.59254912199468],[-98.37452034258709,40.59254809904091],[-98.37451764832021,40.59265857795722],[-98.37457018652402,40.59265755500513],[-98.37456479799032,40.59285498446884],[-98.37472106546831,40.59285396151976]]]},"properties":{"id":"Taylor Hall Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3737386139963,40.592822505804655],[-98.3737406459065,40.592765417120646],[-98.37377315646964,40.59276618858968],[-98.37377417242475,40.59266744048179],[-98.37374369377179,40.59266666901163],[-98.37374470972688,40.59260417989853],[-98.37339826903835,40.59259955107303],[-98.37339217330776,40.592818648462675],[-98.3737386139963,40.592822505804655]]]},"properties":{"id":"Wilson Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3710880581408,40.59285384881594],[-98.37108495134117,40.59269460559814],[-98.37111757273735,40.59269460559814],[-98.37111912613716,40.592625010294974],[-98.37109116494044,40.59262265113089],[-98.37109116494044,40.592462227777595],[-98.37088766956425,40.59245986860776],[-98.37088922296408,40.59250115406781],[-98.3708488345688,40.59249997448359],[-98.37084572776917,40.59285384881594],[-98.3710880581408,40.59285384881594]]]},"properties":{"id":"Batchelder General Services"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37139804641792,40.59329458891759],[-98.37139804641792,40.59319899088562],[-98.37129990788338,40.59319823814465],[-98.3712969339884,40.59329308343783],[-98.37139804641792,40.59329458891759]]]},"properties":{"id":"Campus Safety"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37252975651616,40.593156827790594],[-98.37252881637454,40.59312398858383],[-98.37250813325893,40.59312327468785],[-98.37251095368379,40.59305259894826],[-98.37230600281096,40.59304902946449],[-98.37230882323581,40.59292195571781],[-98.37217062241788,40.59292195571781],[-98.37217062241788,40.593047601670925],[-98.37191960460574,40.593045459980516],[-98.37191866446413,40.59312184689587],[-98.37189234049882,40.59312184689587],[-98.37189328064044,40.593152544416704],[-98.3719572102705,40.593152544416704],[-98.3719572102705,40.59316468064199],[-98.37217062241788,40.59316468064199],[-98.37217156255952,40.59315325831238],[-98.37224959431384,40.593155399999326],[-98.37224865417222,40.59316682232858],[-98.37246206631963,40.59316967791059],[-98.37246394660288,40.59315468610369],[-98.37252975651616,40.593156827790594]]]},"properties":{"id":"Bronc Hall Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37189410131195,40.59411717917972],[-98.3718924278385,40.594065714506016],[-98.37190665236291,40.594065714506016],[-98.37190748909967,40.593829357718064],[-98.37189410131195,40.59382999308689],[-98.37189661152215,40.59378170503864],[-98.37176022343498,40.59378043430005],[-98.37175938669823,40.59382745161154],[-98.37174683564726,40.59382745161154],[-98.3717451621738,40.5940663498726],[-98.37175603975129,40.5940663498726],[-98.37175603975129,40.5941152730814],[-98.37189410131195,40.59411717917972]]]},"properties":{"id":"The 1882 Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37297358496218,40.594287236848594],[-98.37302656725574,40.594179361354826],[-98.37318062346203,40.59422593696438],[-98.37321057883548,40.59415661511511],[-98.37328903338498,40.594179361354826],[-98.3734202664496,40.59391832071013],[-98.37334181190009,40.59389665754029],[-98.37335892925634,40.5938717448863],[-98.37293670113542,40.593748264638194],[-98.37292243667187,40.59377317733819],[-98.37255726640511,40.593660528533846],[-98.37249307631916,40.59376559521309],[-98.37264713252546,40.593813254270884],[-98.37260576558117,40.59390857228456],[-98.37245313582125,40.59386199645395],[-98.37236130461655,40.5940333213648],[-98.37244344372661,40.594057941663856],[-98.37243407698598,40.59407927924903],[-98.3725123372465,40.594103359502135],[-98.37250152675315,40.59412524968894],[-98.37257936230517,40.59414878163177],[-98.37257071391052,40.594169030041066],[-98.37297358496218,40.594287236848594]]]},"properties":{"id":"Hazelrigg Student Union"}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37003093644454,40.59489319890186],[-98.37002539427893,40.594554427576305],[-98.36991824574359,40.594554427576305],[-98.36991824574359,40.594491302294855],[-98.36939635848097,40.59449551064881],[-98.36939635848097,40.59456985819158],[-98.36930768383104,40.59456915680006],[-98.36931045491386,40.5949002127828],[-98.37003093644454,40.59489319890186]]]},"properties":{"id":"Physical Fitness Facility"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3707569741431,40.595997812186724],[-98.3707609796432,40.59595345634213],[-98.37093925863765,40.59595608489197],[-98.37093579690959,40.59587065696967],[-98.37126985366618,40.59587459979926],[-98.37126985366618,40.595589401192704],[-98.37099983887846,40.59558677262847],[-98.37099983887846,40.595392258587665],[-98.36994747355205,40.59538963001566],[-98.3699455880793,40.59587362637473],[-98.3702990362079,40.59587224653109],[-98.37030085342192,40.59595296733678],[-98.37043169283199,40.59595227741577],[-98.37042896701095,40.595997812186724],[-98.3707569741431,40.595997812186724]]]},"properties":{"id":"Lynn Farrell Arena/Fleharty Educational Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37211946976164,40.595036751142146],[-98.37209853033835,40.595007397045535],[-98.37215327445425,40.59498984579718],[-98.37194527282195,40.59469129454744],[-98.37194712982472,40.594305952303756],[-98.37169736008775,40.5943052575816],[-98.37169708368509,40.594470035453604],[-98.37176513394347,40.59446865751005],[-98.37176604128025,40.5945802708457],[-98.37153514181085,40.59467504115343],[-98.37155328864164,40.59470053315958],[-98.37153877117701,40.59470397802453],[-98.37157052813086,40.594785965758],[-98.37158504559547,40.59478114295293],[-98.37158595293702,40.59481421360927],[-98.37186178476472,40.594816280524746],[-98.37186178476472,40.59482661510118],[-98.3718844683032,40.59482799304458],[-98.3718826536201,40.59485210704955],[-98.37185180400779,40.59486313059177],[-98.37190170779242,40.59493685048371],[-98.3718871903278,40.594941673277546],[-98.37198881258011,40.59508980177594],[-98.37211946976164,40.595036751142146]]]},"properties":{"id":"Hayes M. Fuhr Hall of Music"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37538555821986,40.59328018799004],[-98.37538724870973,40.59309726484104],[-98.37520974727416,40.59309405565852],[-98.37521059251908,40.5931608066232],[-98.37519875909004,40.5931608066232],[-98.37519537811033,40.59327890432057],[-98.37538555821986,40.59328018799004]]]},"properties":{"id":"The Stone Health Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37471015347589,40.59324279822121],[-98.37471437942709,40.592969393604285],[-98.37457407784693,40.5929681100119],[-98.37457069708597,40.59313433502105],[-98.37436278028643,40.59313369322644],[-98.3743602447157,40.59324023104691],[-98.37471015347589,40.59324279822121]]]},"properties":{"id":"Babcock Hall Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37464990421633,40.59375608706591],[-98.37465352180178,40.593639797917334],[-98.37456187630376,40.59363888225395],[-98.3745570528565,40.59375608706591],[-98.37464990421633,40.59375608706591]]]},"properties":{"id":"MacKay House"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3742242349953,40.593824761664976],[-98.3742242349953,40.593780809929704],[-98.37426523429703,40.593780809929704],[-98.37427005774431,40.593658111182506],[-98.37412414846457,40.59365627985621],[-98.37412173674093,40.593824761664976],[-98.3742242349953,40.593824761664976]]]},"properties":{"id":"905 N Elm Ave"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37328303907076,40.59576922084294],[-98.37317465862661,40.595267009011295],[-98.37290194299486,40.59530583646519],[-98.37292020520233,40.595377020072085],[-98.3728508088139,40.595386264690795],[-98.37291395234293,40.595698179498136],[-98.37300321983061,40.59568449262486],[-98.37301866997268,40.59575031994207],[-98.37316630466383,40.59573076728035],[-98.37316973802872,40.59576335504669],[-98.37323926366815,40.59575227520792],[-98.37324527205675,40.59577573839374],[-98.37328303907076,40.59576922084294]]]},"properties":{"id":"Gray Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37355669887391,40.59683971651677],[-98.37346882100307,40.59659623606328],[-98.37349312764819,40.59659197692209],[-98.3734622769063,40.596499695463045],[-98.37332952522907,40.596526670056555],[-98.37330428371297,40.59644929553547],[-98.37297801374571,40.59651176304569],[-98.37254797310115,40.59649259688399],[-98.37254516848826,40.596542996778915],[-98.37256106129469,40.59659481634959],[-98.37255171258502,40.596682128686005],[-98.37264706942358,40.59668425825375],[-98.37264426481069,40.596737497425636],[-98.3727667329073,40.59674175655755],[-98.37276766777826,40.59669277652411],[-98.37282376003624,40.596682128686005],[-98.37300979935856,40.59668851738907],[-98.37300512500373,40.596779378877706],[-98.37291163790708,40.59679499568363],[-98.3729247261006,40.59683758695397],[-98.37296586042312,40.5968361672454],[-98.37296586042312,40.596802094230576],[-98.37299110193923,40.596887986588825],[-98.37307617519718,40.59686882053498],[-98.37309393774554,40.596929158093324],[-98.37355669887391,40.59683971651677]]]},"properties":{"id":"Jackson Dinsdale Art Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36946922209306,40.59663009808219],[-98.36946309192157,40.59646951080968],[-98.36938339969201,40.596471838164206],[-98.36938646477778,40.59621582868018],[-98.36946922209306,40.59621582868018],[-98.36946309192157,40.59595516347105],[-98.36938952986353,40.59595516347105],[-98.36938646477778,40.59568984248238],[-98.36946615700731,40.59568984248238],[-98.36946309192157,40.59554321727376],[-98.36923321049021,40.595536235112945],[-98.36923321049021,40.596632425431125],[-98.36946922209306,40.59663009808219]]]},"properties":{"id":"Lloyd Wilson Field/Stadium"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36635224661157,40.5952162806942],[-98.36635339463838,40.594929482162954],[-98.36611345703568,40.594929482162954],[-98.36611116098207,40.595215408968],[-98.36635224661157,40.5952162806942]]]},"properties":{"id":"Bronco Village Apartments 3"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36594778233456,40.59521075896037],[-98.36594433215241,40.595025407005174],[-98.36560448920957,40.59502671691478],[-98.36560621430067,40.595043090782795],[-98.36556481211473,40.595043090782795],[-98.36556912484242,40.59519242027393],[-98.36560362666404,40.595191765320756],[-98.36560362666404,40.59521337877231],[-98.36594778233456,40.59521075896037]]]},"properties":{"id":"Bronco Village Apartments 4"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36581753737377,40.59488116136897],[-98.36582035820989,40.594594140268],[-98.36557917672252,40.594593069291435],[-98.36557776630447,40.59489829691811],[-98.36562431010026,40.59489936788978],[-98.36562431010026,40.594879019425015],[-98.36581753737377,40.59488116136897]]]},"properties":{"id":"Bronco Village Apartments 1"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36636763296093,40.59478975582371],[-98.3663640756504,40.59460499524451],[-98.36598486634739,40.594606075717216],[-98.36598842365792,40.59476814642561],[-98.36602186237695,40.59476868666066],[-98.36602186237695,40.59479029605858],[-98.36636763296093,40.59478975582371]]]},"properties":{"id":"Bronco Village Apartments 2"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36542716760385,40.59439543172675],[-98.36542432429836,40.59422414915383],[-98.36538736132702,40.594225588505026],[-98.36538830909551,40.59420543758567],[-98.36508217987125,40.59420543758567],[-98.36508407540826,40.59422630818061],[-98.3650442691314,40.59422630818061],[-98.3650433213629,40.59437815955442],[-98.36508217987125,40.59437815955442],[-98.36508312763975,40.59439615140052],[-98.36542716760385,40.59439543172675]]]},"properties":{"id":"Bronco Village Apartments 5"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36597687333165,40.594175930871394],[-98.36597687333165,40.59398737546289],[-98.3655949226277,40.59398881481917],[-98.36559302709068,40.594155060260746],[-98.36563188559904,40.5941543405844],[-98.36563283336753,40.59417521119527],[-98.36597687333165,40.594175930871394]]]},"properties":{"id":"Bronco Village Apartments 6"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3646686039858,40.595412581009995],[-98.36494650785933,40.595223709584495],[-98.36492058096735,40.59520402262996],[-98.36498701862807,40.595156035653986],[-98.36490680730597,40.595086515999505],[-98.36483631856838,40.59513450302537],[-98.36481120189175,40.59511481604457],[-98.36470911475455,40.595181874799174],[-98.36465645075519,40.59513327258924],[-98.36458110072535,40.595182490016796],[-98.36463295450933,40.59522801610503],[-98.3645316775875,40.59529938126202],[-98.3646686039858,40.595412581009995]]]},"properties":{"id":"Barrett Alumni Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37338949046577,40.58959597891962],[-98.3733933780237,40.58945132240717],[-98.37327675128608,40.589449551101],[-98.37327286372816,40.58959361718315],[-98.37338949046577,40.58959597891962]]]},"properties":{"id":"706 E. 7th St. Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37321144031304,40.58958535110486],[-98.37321299533619,40.589450141536396],[-98.37309792362176,40.5894489606656],[-98.37309559108701,40.58958535110486],[-98.37321144031304,40.58958535110486]]]},"properties":{"id":"710 E. 7th St. Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37301550739384,40.58959538848551],[-98.3730225049981,40.58935803355154],[-98.37315079440947,40.58935921442396],[-98.37315312694422,40.58927655330535],[-98.37305827053098,40.58927537243149],[-98.37305749301939,40.58930607514516],[-98.37299218204632,40.58930489427181],[-98.37299140453474,40.5893633474772],[-98.37294008877019,40.5893633474772],[-98.37294164379337,40.58939582145811],[-98.37290976581842,40.58939523102224],[-98.3729058782605,40.58959538848551],[-98.37301550739384,40.58959538848551]]]},"properties":{"id":"714 E. 7th St. Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37481677520717,40.59378243356543],[-98.3748159702016,40.59364459103049],[-98.37470492415694,40.59364364015712],[-98.37470219608254,40.59378243356543],[-98.37481677520717,40.59378243356543]]]},"properties":{"id":"607 E 9th St"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37505232877834,40.59378603329276],[-98.37505232877834,40.59363389370436],[-98.3749411932886,40.59363270511246],[-98.37493806271144,40.59378603329276],[-98.37505232877834,40.59378603329276]]]},"properties":{"id":"603 E 9th St"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37020808429642,40.59325096070355],[-98.3702087922692,40.59304678270344],[-98.37012640522326,40.59305025829369],[-98.37007453189801,40.59300275854457],[-98.3700699548399,40.59284403962595],[-98.36997383661961,40.59284403962595],[-98.36996925956151,40.59300275854457],[-98.37007148052594,40.59305373388376],[-98.37007497105584,40.59325096070355],[-98.37020808429642,40.59325096070355]]]},"properties":{"id":"906 E 9th St"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3713716620568,40.59216760861196],[-98.3713716620568,40.59208501885758],[-98.37123658640381,40.592083686763935],[-98.37123658640381,40.592170272795876],[-98.3713716620568,40.59216760861196]]]},"properties":{"id":"812 N Ash Ave"}}\r
]}
`,z$=`{"type":"GeometryCollection", "geometries": [\r
{"type":"Polygon","coordinates":[[[-98.3702723467576,40.59295246060802],[-98.3712898200761,40.59296962250515],[-98.37127145248702,40.593452202532475],[-98.3693821617939,40.59343919245249],[-98.3693821617939,40.59396210621867],[-98.36898697694681,40.59395690670241],[-98.36897317608825,40.595313897438444],[-98.36666104991127,40.59530626415921],[-98.3666645004967,40.59434137689304],[-98.3660775631237,40.594328458560554],[-98.3660903226318,40.59391184099969],[-98.36552890427502,40.593908611396046],[-98.3655251986316,40.59414249211982],[-98.36432525734347,40.59413791286647],[-98.36427367897022,40.59707709495426],[-98.37377329389933,40.59709097965043],[-98.37386191086847,40.59401359006412],[-98.37508078915154,40.594020829208134],[-98.37509913072566,40.59343618356128],[-98.37541607762186,40.59342916474601],[-98.37541607762186,40.59304686495786],[-98.37491595389913,40.593044333163895],[-98.37497941341485,40.58982081072618],[-98.37347119813148,40.58981164082747],[-98.373477248548,40.58922812309826],[-98.37287220689669,40.589232717745936],[-98.37286010606364,40.58981164082747],[-98.37161977067842,40.58981164082747],[-98.37159980641273,40.59071814140597],[-98.37034264550859,40.590714592488666],[-98.37035943903622,40.59162321748957],[-98.37107540475405,40.59163250297191],[-98.37106656585733,40.592037456704084],[-98.37065419418758,40.59203614756078],[-98.37065535506281,40.59209797250316],[-98.37051258408789,40.59209551837214],[-98.37051409247337,40.59219975052995],[-98.37028934303831,40.59219975052995],[-98.3702875945045,40.59227459272085],[-98.37028731105269,40.59253351783216],[-98.37009609918391,40.59252977623261],[-98.36990069493494,40.59252314685871],[-98.36990818515268,40.5933535522459],[-98.37026022538576,40.59335639608224],[-98.3702723467576,40.59295246060802]]]}\r
]}`,j$='{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"id":"Kiewit_MR_SEcorner"},"geometry":{"coordinates":[[[-98.37163503619607,40.59063976074893],[-98.37216212045448,40.590601318073],[-98.37257008962634,40.59062619274795],[-98.37289765611462,40.59063523808223],[-98.37286192158837,40.59039101362893],[-98.37285894371118,40.590234980871685],[-98.37290658974618,40.58994326648016],[-98.37282320918538,40.5896877326733],[-98.3716618370903,40.58968320994222],[-98.37163503619607,40.59063976074893]]],"type":"Polygon"},"id":0},{"type":"Feature","properties":{"id":"Daughtery_MR_Chapel"},"geometry":{"coordinates":[[[-98.37352702156389,40.5914658384647],[-98.37355230279564,40.59090910098766],[-98.37337280605138,40.590895662440005],[-98.37336774980503,40.59069984328954],[-98.37309471250403,40.590674885905486],[-98.3723160505715,40.590648008712265],[-98.37231099432515,40.591164432888604],[-98.3724626817145,40.5914312824801],[-98.37242728799043,40.591569506310634],[-98.37239189426599,40.5917653229138],[-98.37310482499674,40.5917787612872],[-98.37321100616931,40.591446640697654],[-98.37352702156389,40.5914658384647]]],"type":"Polygon"},"id":1},{"type":"Feature","properties":{"id":"801 Block"},"geometry":{"coordinates":[[[-98.37164381749396,40.591608632859675],[-98.37164919913825,40.59068913232153],[-98.37024189916244,40.59066052543514],[-98.37033069629301,40.591596372935584],[-98.37164381749396,40.591608632859675]]],"type":"Polygon"},"id":2},{"type":"Feature","properties":{"id":"South of Arboretum"},"geometry":{"coordinates":[[[-98.37476627281052,40.5910136742458],[-98.37477964615867,40.59092227590415],[-98.37446537247885,40.590915505651594],[-98.37446537247885,40.59037726838508],[-98.37394604079577,40.590356957462575],[-98.37393266744795,40.59120662589234],[-98.37434278345529,40.591032292413445],[-98.37476627281052,40.5910136742458]]],"type":"Polygon"},"id":3},{"type":"Feature","properties":{"id":"Arboretum"},"geometry":{"coordinates":[[[-98.37489112509611,40.59219972777811],[-98.37490794950106,40.591069061838084],[-98.37470325257557,40.59106054450788],[-98.37460230614677,40.59105628584243],[-98.37443686616615,40.59106693250561],[-98.37431068312993,40.59109035515871],[-98.37407514146206,40.591215985611285],[-98.3739938235057,40.59130328799105],[-98.37399101943821,40.59197189267704],[-98.37412561467688,40.59209965077304],[-98.37435554820935,40.59219333988858],[-98.37489112509611,40.59219972777811]]],"type":"Polygon"},"id":4},{"type":"Feature","properties":{"id":"North of Arboretum"},"geometry":{"coordinates":[[[-98.37431231320465,40.59336193656449],[-98.37433594448096,40.593078415557756],[-98.37448482150404,40.59306047115021],[-98.37451081590508,40.59293306571445],[-98.37449191088317,40.59276797661897],[-98.37448245837369,40.59257776476619],[-98.37449900026525,40.592471891896395],[-98.37483456434931,40.5924557417828],[-98.37483929060404,40.59226194011691],[-98.37479202805706,40.592233228710995],[-98.37449191088317,40.59222963978439],[-98.37424378251136,40.59221348961228],[-98.3740381904318,40.59213453315965],[-98.37391767093679,40.59193355267803],[-98.37388222402663,40.59336014213147],[-98.37431231320465,40.59336193656449]]],"type":"Polygon"},"id":5},{"type":"Feature","properties":{"id":"PickleBall Cts"},"geometry":{"coordinates":[[[-98.37301888192918,40.592758212922234],[-98.37305404173038,40.59270862956615],[-98.3730665988024,40.59181802995374],[-98.3720670558787,40.591791330852686],[-98.3720544988067,40.59201445872537],[-98.3720821243651,40.59211553349891],[-98.3720896586079,40.59233866028978],[-98.37207961295069,40.5925408087046],[-98.3720544988067,40.592636161518556],[-98.37203691890592,40.592884078198324],[-98.37301888192918,40.592758212922234]]],"type":"Polygon"},"id":6},{"type":"Feature","properties":{"id":"Steinhart Plz"},"geometry":{"coordinates":[[[-98.37375767305471,40.59380937954694],[-98.37381334284255,40.59285824408735],[-98.37336179901064,40.592860592586646],[-98.37332777858475,40.59276195554597],[-98.37319478964805,40.59273847051469],[-98.3726349990074,40.59282771358974],[-98.37261334964592,40.59363559284384],[-98.37317004752059,40.59373422859568],[-98.37375767305471,40.59380937954694]]],"type":"Polygon"},"id":7},{"type":"Feature","properties":{"id":"SE of Union"},"geometry":{"coordinates":[[[-98.37251903104057,40.59362476563635],[-98.37254773304886,40.593196135370334],[-98.37197369288644,40.59318887042687],[-98.37166753813338,40.593159810645574],[-98.37171059114546,40.59367925233752],[-98.37217939061152,40.593824549991155],[-98.37251903104057,40.59362476563635]]],"type":"Polygon"},"id":8},{"type":"Feature","properties":{"id":"Heartwell"},"geometry":{"coordinates":[[[-98.37407601600557,40.595375081069506],[-98.37397063105409,40.594673938335205],[-98.37389033775756,40.594109970364855],[-98.37308740479394,40.59428906881678],[-98.37294689152506,40.59433098540674],[-98.37263575500172,40.5942509628037],[-98.37250527839498,40.59418237192435],[-98.37237982011926,40.594094727921146],[-98.37199842696151,40.594033758112204],[-98.37202351861642,40.594334796004546],[-98.37202853694748,40.59470823353095],[-98.37212890356825,40.594822550724416],[-98.37225436184359,40.59499021558764],[-98.37219916020231,40.5950397528529],[-98.37206366526487,40.595108342852654],[-98.37216403188529,40.59528362808683],[-98.3728164149183,40.595218848814255],[-98.37322289973137,40.595119774511886],[-98.37330821135897,40.5956418182227],[-98.37353905458613,40.595710407604884],[-98.37407601600557,40.595375081069506]]],"type":"Polygon"},"id":9},{"type":"Feature","properties":{"id":"Heartwell North"},"geometry":{"coordinates":[[[-98.37364723125614,40.59642709268644],[-98.37372717366044,40.595729025036405],[-98.37348068458046,40.595744200497705],[-98.37331413790477,40.59580996078944],[-98.37317423869737,40.5958504286296],[-98.37308763442599,40.59580996078944],[-98.37296772081977,40.595789726860176],[-98.37289444028254,40.595739142010984],[-98.37274121734099,40.59567844014052],[-98.37272123173979,40.59534963738679],[-98.37165533301602,40.59529905220464],[-98.37130891593102,40.59546598316149],[-98.3713555489995,40.59585548710561],[-98.37149803178302,40.59612724032186],[-98.37170454966062,40.59618288333169],[-98.37166457845869,40.59672413564374],[-98.37141142751166,40.59705293163782],[-98.37241070756525,40.596997289352856],[-98.37251063557076,40.596410513342704],[-98.37364723125614,40.59642709268644]]],"type":"Polygon"},"id":10},{"type":"Feature","properties":{"id":"Athletic Parking lot"},"geometry":{"coordinates":[[[-98.37135713636462,40.59703881753842],[-98.37159398256752,40.59675342106121],[-98.37164547087292,40.59621781068529],[-98.37141377350018,40.59613570944552],[-98.37124901092368,40.59594804909017],[-98.37084225331375,40.5960575176949],[-98.37024498897541,40.59604578892433],[-98.36962198048437,40.5960184217856],[-98.36954474802666,40.596280363943634],[-98.3695498968572,40.59707400332135],[-98.37135713636462,40.59703881753842]]],"type":"Polygon"},"id":11},{"type":"Feature","properties":{"id":"Fle+PFF"},"geometry":{"coordinates":[[[-98.36986465261369,40.595478850474535],[-98.37011842595624,40.594928288639665],[-98.36931682444536,40.59493746470747],[-98.36901874147125,40.59488240828182],[-98.36905499480616,40.59548190913873],[-98.36986465261369,40.595478850474535]]],"type":"Polygon"},"id":12},{"type":"Feature","properties":{"id":"Football field"},"geometry":{"coordinates":[[[-98.36913306842247,40.59687166324542],[-98.36912125095233,40.595575039769074],[-98.36904443739681,40.59551222692079],[-98.36897944131144,40.59530135478337],[-98.36831766298764,40.59536416782973],[-98.36827630184256,40.596880636330724],[-98.36913306842247,40.59687166324542]]],"type":"Polygon"},"id":13},{"type":"Feature","properties":{"id":"Practice field"},"geometry":{"coordinates":[[[-98.36817488651938,40.596967941434826],[-98.3682206392564,40.5952830148853],[-98.36668220346046,40.59530907080216],[-98.36580718237055,40.59530907080216],[-98.36588153056778,40.59700268176945],[-98.36817488651938,40.596967941434826]]],"type":"Polygon"},"id":14},{"type":"Feature","properties":{"id":"track"},"geometry":{"coordinates":[[[-98.3658412178937,40.597004912936484],[-98.36577780942038,40.595387736092704],[-98.36551671491901,40.59541889048063],[-98.3653525983754,40.59530276950733],[-98.36468494243638,40.59548119921246],[-98.36468494243638,40.59674435461838],[-98.36463272353635,40.59700491285406],[-98.3658412178937,40.597004912936484]]],"type":"Polygon"},"id":15},{"type":"Feature","properties":{"id":"BVH outdoor"},"geometry":{"coordinates":[[[-98.36606218586846,40.594981336403094],[-98.36621039516318,40.5948299194323],[-98.36602176515188,40.59482378089922],[-98.36595709200517,40.59480741147544],[-98.36594361843285,40.59475011845865],[-98.36585738757081,40.59474807227855],[-98.36586277699975,40.594981336403094],[-98.36606218586846,40.594981336403094]]],"type":"Polygon"},"id":16},{"type":"Feature","properties":{"id":"BVH south outdoor"},"geometry":{"coordinates":[[[-98.36605957398896,40.59455423531671],[-98.36605957398896,40.59420722418943],[-98.36571163584682,40.59422694077912],[-98.36549871847637,40.59418750759389],[-98.36547794604984,40.59433735357291],[-98.36543120809051,40.59455817861465],[-98.36605957398896,40.59455423531671]]],"type":"Polygon"},"id":17}]}',U$=`{"type":"FeatureCollection", "features": [\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5732546949417,39.033957896346706],[-94.57326522382158,39.033796212560006],[-94.5729226302682,39.033781742786736],[-94.57291453112981,39.03394783044083],[-94.5732546949417,39.033957896346706]]]},"properties":{"id":"Physical Plant Operations"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57330618126248,39.03329184109743],[-94.57333069079144,39.032868879640596],[-94.57332112401924,39.03286702180975],[-94.57332590740536,39.03279828203385],[-94.57289061927166,39.032835438677765],[-94.57286046661933,39.03328233695542],[-94.57330618126248,39.03329184109743]]]},"properties":{"id":"St. Luke's Urgent Care"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57151501542803,39.03292423985276],[-94.57151293405649,39.032993004805604],[-94.57184717798721,39.03300418514015],[-94.57184478733176,39.03304318257621],[-94.57179856799333,39.03305618171678],[-94.57179298979729,39.03312055837771],[-94.571829646514,39.033121177383784],[-94.57181849012196,39.033266024655184],[-94.5720280709153,39.03327654773599],[-94.57204321173309,39.033054943703505],[-94.5720575556657,39.03305556271014],[-94.5720631338617,39.03295156951771],[-94.572026477145,39.032949093487446],[-94.57203205534103,39.03290576294391],[-94.57191730388003,39.03289895385609],[-94.57191252256916,39.0329466174571],[-94.57185434995351,39.03294537944191],[-94.57185275618323,39.03297261577139],[-94.57165911309279,39.032966425697424],[-94.57166230063338,39.032929904250025],[-94.57151501542803,39.03292423985276]]]},"properties":{"id":"St. Peter Claver Jesuit Community"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57320143143617,39.03248280295288],[-94.5732236476623,39.03206766728228],[-94.57287806192237,39.03205807982458],[-94.57285214299189,39.0324693805906],[-94.57320143143617,39.03248280295288]]]},"properties":{"id":"Greenlease Library"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57258061133909,39.03244157711775],[-94.57259171945215,39.03223353009446],[-94.57203878226827,39.03221147899157],[-94.57202520568563,39.03242240230252],[-94.57258061133909,39.03244157711775]]]},"properties":{"id":"Conway Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5729983573256,39.031851550588144],[-94.57299756184071,39.031777457537544],[-94.57321564931763,39.03178334435931],[-94.57323249004943,39.03143209646873],[-94.57296205948676,39.031423909721845],[-94.57296447934267,39.03135905846342],[-94.57280960856365,39.03135529896836],[-94.5728071887077,39.03138819454341],[-94.57269708526324,39.03138631479668],[-94.57269708526324,39.03142109010315],[-94.57267409663196,39.03142015023023],[-94.572672886704,39.03149158053676],[-94.57274790223761,39.0314934602807],[-94.57273580295798,39.03168519389932],[-94.5727950894281,39.031686133768716],[-94.57279387950013,39.031724668403285],[-94.5728701049617,39.03172748800987],[-94.57286526524985,39.03184873098651],[-94.5729983573256,39.031851550588144]]]},"properties":{"id":"Sedgewick Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57326241323847,39.03143368161774],[-94.57327626990363,39.03124423732891],[-94.5730261570974,39.03123347343362],[-94.57301275849636,39.0314254445335],[-94.57326241323847,39.03143368161774]]]},"properties":{"id":"Greenlease Gallery"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.573095990435,39.03111733680814],[-94.57308496704151,39.031231510274026],[-94.57308922652759,39.0312361877],[-94.57325910712441,39.03124349870881],[-94.57328155089225,39.03098889143854],[-94.57264954299825,39.03095820723238],[-94.57262565897899,39.031273611693024],[-94.57279744019438,39.0312828882735],[-94.57281213805237,39.03110377869681],[-94.573095990435,39.03111733680814]]]},"properties":{"id":"Van Ackeren Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57168446809365,39.032022569107156],[-94.57169184016705,39.03180937961588],[-94.57179868570213,39.031816109120946],[-94.57180734885364,39.0318116227843],[-94.57183045059094,39.03127774669104],[-94.57147526137969,39.031266530763475],[-94.57148969996551,39.030961456851074],[-94.57133665095579,39.03095921365567],[-94.57130690259424,39.031697853704856],[-94.57146028857838,39.031697853704856],[-94.57144848965653,39.032017331773794],[-94.57168446809365,39.032022569107156]]]},"properties":{"id":"Massman Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57102622899816,39.03227668523504],[-94.57041136868395,39.032248511124756],[-94.57038028024108,39.03258659970685],[-94.57099514055531,39.03261611529995],[-94.57102622899816,39.03227668523504]]]},"properties":{"id":"Mason-Halpin Fieldhouse"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57102622899816,39.03227668523504],[-94.5710435003553,39.03201775132257],[-94.57017475109112,39.0319855522205],[-94.57016266114111,39.03223509487781],[-94.57102622899816,39.03227668523504]]]},"properties":{"id":"Convocation Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57003078591215,39.032220762006155],[-94.57011418121974,39.032159390693046],[-94.57010430545964,39.032152571654976],[-94.57011857044647,39.0321355240569],[-94.57007906740601,39.03210654313074],[-94.57011857044647,39.03207244790827],[-94.57010211084628,39.03205880981468],[-94.57012515428654,39.03204005743169],[-94.57007687279265,39.03200340503239],[-94.57005492665907,39.03201960028093],[-94.57003627244553,39.03200425741399],[-94.56983546532327,39.03214575261624],[-94.56986180068357,39.03216620973048],[-94.56983985454998,39.03218837159754],[-94.56987935759042,39.03221479535305],[-94.56989910911065,39.032200304907704],[-94.56992434716427,39.03221905724818],[-94.56996714212474,39.03218496207999],[-94.57000993708525,39.032220762006155],[-94.57001981284535,39.03221309059493],[-94.57003078591215,39.032220762006155]]]},"properties":{"id":"Student Activities Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5700079120054,39.03251153999033],[-94.57007391952787,39.03239788275361],[-94.56962616850038,39.03226029743301],[-94.56963937000486,39.03224064236535],[-94.56956236122863,39.03221756901809],[-94.569545859348,39.0322355149555],[-94.56911791057726,39.032091092758456],[-94.56905630355628,39.03220047764487],[-94.56942814593293,39.03231926260322],[-94.56943254643443,39.03240899211564],[-94.56956566160477,39.032447447586094],[-94.56962836875111,39.03238335512371],[-94.5700079120054,39.03251153999033]]]},"properties":{"id":"Corcoran Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.56854799775466,39.03168092891154],[-94.56855120851591,39.03148472512313],[-94.5683842489311,39.03148306237683],[-94.56838210842359,39.031552066315285],[-94.56833501725863,39.03155040357058],[-94.5683318064974,39.03160527412545],[-94.56837889766234,39.031604442753725],[-94.5683756869011,39.03167843479901],[-94.56854799775466,39.03168092891154]]]},"properties":{"id":"Town House Village"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5694451877561,39.031137040617324],[-94.56944931800915,39.031079289457125],[-94.56924142860419,39.03107180319216],[-94.56923729835111,39.031130623824076],[-94.5694451877561,39.031137040617324]]]},"properties":{"id":"The Birdhouse"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57023544284519,39.03101832984793],[-94.57024370335134,39.03090603569337],[-94.56974669623084,39.03088999365672],[-94.56974531947982,39.03083117282454],[-94.56960626762614,39.03082582547373],[-94.56960351412411,39.03088250737171],[-94.56911752101182,39.03087074320795],[-94.56911201400773,39.03097982901504],[-94.57023544284519,39.03101832984793]]]},"properties":{"id":"Xavier-Loyola Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57110683934017,39.030625006944845],[-94.5711103812666,39.03058465303729],[-94.57115524566798,39.03058648730631],[-94.57116351016298,39.030412231536324],[-94.57103836209599,39.030407645852364],[-94.57103836209599,39.03042507144983],[-94.57075146605564,39.030415900083284],[-94.5707502854135,39.03054338197162],[-94.57072076935995,39.03054429910667],[-94.57071722743352,39.03061583560425],[-94.57110683934017,39.030625006944845]]]},"properties":{"id":"Magis Activity Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57198788526269,39.03047484462258],[-94.57200861727132,39.03025032364125],[-94.57210130154519,39.03026832323989],[-94.57212569214357,39.03018021989759],[-94.57206837423735,39.02993485624719],[-94.57194154312575,39.02995664533168],[-94.57194032359583,39.029975592356216],[-94.57188544474947,39.02997275030286],[-94.57188544474947,39.029948119168985],[-94.57170739338125,39.029948119168985],[-94.57155373261142,39.029932961543864],[-94.57155373261142,39.02994906652044],[-94.57146348739738,39.0299414877084],[-94.57145373115803,39.03010916873508],[-94.57150129282489,39.03011201078295],[-94.57148665846586,39.03031758527588],[-94.57179885812519,39.03032705874041],[-94.5717927604756,39.030445476939825],[-94.57185373697156,39.03044831897417],[-94.57185495650148,39.030468213211414],[-94.57198788526269,39.03047484462258]]]},"properties":{"id":"Pedro Arrupe, S.J., Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57284047860178,39.0302797832297],[-94.57286427952926,39.029831426558175],[-94.5727080859427,39.02982911543394],[-94.572694697921,39.03005444969102],[-94.5725905688633,39.03005329413256],[-94.57258164351548,39.030234716579436],[-94.57268279745728,39.030237027690404],[-94.57267982234133,39.03027631656532],[-94.57284047860178,39.0302797832297]]]},"properties":{"id":"McGee Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5730942108803,39.03066445893382],[-94.57317199672308,39.030664613464],[-94.57325985414333,39.030643791903515],[-94.57335366799886,39.03057901367613],[-94.57337898284875,39.03051307863372],[-94.57340366198356,39.02995448923646],[-94.57335443753462,39.029949304371044],[-94.57335193459656,39.029918843279034],[-94.57318507205777,39.02991495462804],[-94.57317172305467,39.03002707731239],[-94.57310581235186,39.03002837352735],[-94.5730700106048,39.030426554038584],[-94.57268280619707,39.03041812687501],[-94.57267696475127,39.03046998632717],[-94.57261938478547,39.03048035821303],[-94.57261604681642,39.03052508695338],[-94.57264692302996,39.03053999652721],[-94.57264692302996,39.030585373471666],[-94.57268864764288,39.03067936847824],[-94.5730858659577,39.03068714736974],[-94.5730942108803,39.03066445893382]]]},"properties":{"id":"St. Ignatius Science Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57292884511348,39.02885017929442],[-94.57292884511348,39.02878607947923],[-94.57289583924593,39.02878607947923],[-94.57289790211264,39.02876043953688],[-94.57268542684032,39.02875242705299],[-94.57268336397358,39.02881973188946],[-94.57272049557459,39.02881973188946],[-94.57271843270787,39.02884697430505],[-94.57292884511348,39.02885017929442]]]},"properties":{"id":"University Marketing and Communication"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57283326901032,39.028729445595104],[-94.57284341632814,39.02854814224998],[-94.57270405983009,39.028544463626574],[-94.57270270685437,39.028568111916584],[-94.57268511817016,39.028568111916584],[-94.57268308870658,39.028620663643835],[-94.5727020303665,39.028622240195055],[-94.57270000090294,39.02865902638007],[-94.57268241221873,39.02865902638007],[-94.57268173573087,39.02870684839195],[-94.5727006773908,39.028707899424816],[-94.5726993244151,39.028725766981125],[-94.57283326901032,39.028729445595104]]]},"properties":{"id":"Rock Row Housing N"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57284691787102,39.02851897602392],[-94.57285908326953,39.0283383666503],[-94.57271782947576,39.02833311637091],[-94.57271715362029,39.02835674262511],[-94.5726975538116,39.02835726765288],[-94.57269417453423,39.02840924538392],[-94.57271512605388,39.02840924538392],[-94.572712422632,39.02844599729188],[-94.5726975538116,39.02844809740033],[-94.5726948503897,39.0284948247972],[-94.572712422632,39.028496399877454],[-94.57271174677652,39.02851582586437],[-94.57284691787102,39.02851897602392]]]},"properties":{"id":"Rock Row Housing S"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57359514381248,39.02847208180017],[-94.57361271431651,39.028083475715746],[-94.57327990829927,39.02807143210462],[-94.57325923711807,39.028461644061366],[-94.57359514381248,39.02847208180017]]]},"properties":{"id":"Security Department"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57480409573863,39.03238485708068],[-94.57475834188774,39.03234294052741],[-94.57478743748095,39.0323230514835],[-94.57466523598949,39.03222270213117],[-94.57465592539967,39.03222903047291],[-94.57456281950141,39.032149474135494],[-94.57455234508787,39.032154898434065],[-94.57453256008448,39.03213591338722],[-94.5745418706743,39.03212868098708],[-94.57443596271503,39.03204189212767],[-94.57444294565741,39.03200392196817],[-94.57448600713533,39.031963239631786],[-94.57446854977943,39.03195419910939],[-94.57445691154213,39.0319668558404],[-94.57437893535234,39.031978608517164],[-94.57437078858625,39.03197318420506],[-94.57426022533207,39.03199216929562],[-94.57421018091178,39.031950582900116],[-94.57410660059993,39.03202561920467],[-94.5741217303084,39.03203737187166],[-94.57391816391097,39.03218429006349],[-94.5739193483118,39.03221373112918],[-94.57398567475879,39.03222937169034],[-94.57396790874621,39.03229653406067],[-94.57383525585222,39.03238485708068],[-94.5738127522363,39.03243637879136],[-94.57379024862033,39.03244833918312],[-94.57380209262874,39.03245661945314],[-94.573822227443,39.03244281900256],[-94.57387552548074,39.03242901854928],[-94.57400462517222,39.032327815142885],[-94.57410885244606,39.03231401466714],[-94.57411122124773,39.032375656771244],[-94.57415030647543,39.03237933689516],[-94.5743552078206,39.03223397185472],[-94.574367051829,39.03224501224803],[-94.57443811587935,39.03218705016392],[-94.57453642114899,39.032267093029475],[-94.57452220833892,39.03227813341762],[-94.57461577600522,39.03235817618002],[-94.57462880441446,39.032348055835755],[-94.57464538602619,39.03236553642948],[-94.57466078323709,39.03235541608627],[-94.57474369129585,39.03242809851896],[-94.57480409573863,39.03238485708068]]]},"properties":{"id":"St. Francis Xavier Church"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57151501542803,39.03292423985276],[-94.57133748256577,39.032919396176545],[-94.57133184858787,39.03302943092199],[-94.57151052617259,39.03303443249725],[-94.57151501542803,39.03292423985276]]]},"properties":{"id":"Campus Ministry Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57133184858787,39.03302943092199],[-94.57132503847693,39.033133258595875],[-94.57150408963523,39.03313923484835],[-94.57151052617259,39.03303443249725],[-94.57133184858787,39.03302943092199]]]},"properties":{"id":"Kateri Community Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57286010900144,39.03328693338342],[-94.57283532620258,39.03371719964933],[-94.5732878874704,39.0337356369808],[-94.57330546295397,39.03329801918155],[-94.57286010900144,39.03328693338342]]]},"properties":{"id":"Prosperity Center for Financial Opportunity"}}\r
]}`,V$=`{"type":"GeometryCollection", "geometries": [\r
{"type":"Polygon","coordinates":[[[-94.5733601221702,39.033991702842954],[-94.57343057843688,39.032627336829854],[-94.57483618218124,39.03266045740923],[-94.57483618218124,39.03225653248882],[-94.57456975228335,39.031925844267924],[-94.57443769998508,39.031865057522765],[-94.5734766527032,39.03184416206704],[-94.5737667714431,39.02721317928421],[-94.57318118713299,39.027186419902776],[-94.5731396822614,39.02830719202791],[-94.5726236948803,39.02827994478758],[-94.57256476148764,39.028963612429386],[-94.5679483123955,39.02883237317173],[-94.56774097288552,39.032390935290124],[-94.5688957036816,39.03245419936561],[-94.57042657308332,39.032720791128675],[-94.57108453863592,39.03274057444863],[-94.57121364975842,39.03280827134139],[-94.57119428309004,39.03315176939054],[-94.57150092200602,39.03315929122695],[-94.57153965534276,39.03306150729117],[-94.57173977758268,39.03306652185526],[-94.57178173869748,39.03329719141926],[-94.57214002206244,39.033307220513656],[-94.57216584428696,39.0332119440594],[-94.57283722212401,39.03322949499484],[-94.57279848878727,39.033964123097064],[-94.5733601221702,39.033991702842954]]]}\r
]}`;function e1(n){return typeof n=="string"?n.replace(/^\uFEFF/,""):n}const q$=JSON.parse(e1(B$)),G$=JSON.parse(e1(z$)),$$=JSON.parse(e1(j$)),H$=JSON.parse(e1(U$)),W$=JSON.parse(e1(V$));function NL(n){return Array.isArray(n)?n[0]||{}:n||{}}const X$=NL(I$),Y$=NL(F$),jI={...X$,buildings:q$,boundary:G$,outdoorSpaces:$$},K$={...Y$,buildings:H$,boundary:W$},Z$={hastings:jI,"hastings-demo":jI,rockhurst:K$};function J$(n){return Z$[n]}function G0({engagementMode:n=!1}){const{universityId:e,persona:t}=VP(),i=J$(e);return i?window.location.pathname.includes("/admin")?se.jsx(A$,{config:i,universityId:e}):se.jsx(T$,{config:i,universityId:e,persona:t,engagementMode:n}):se.jsxs("div",{children:['Error: Configuration not found for "',e,'".']})}function Q$(){return se.jsx(AN,{basename:"/StakeholderMap",children:se.jsxs(rN,{children:[se.jsx(Km,{path:"/:universityId/admin",element:se.jsx(G0,{})}),se.jsx(Km,{path:"/:universityId/engagement",element:se.jsx(G0,{engagementMode:!0})}),se.jsx(Km,{path:"/:universityId/:persona",element:se.jsx(G0,{})}),se.jsx(Km,{path:"/:universityId/survey",element:se.jsx(G0,{})}),se.jsx(Km,{path:"/:universityId",element:se.jsx(G0,{})}),se.jsx(Km,{path:"/",element:se.jsx("div",{children:"Please select a university by navigating to its URL (e.g., /hastings)"})})]})})}const eH=hP.createRoot(document.getElementById("root"));eH.render(se.jsx(Q$,{}));export{dl as _,tH as c,M_ as g};
