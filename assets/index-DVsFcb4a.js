function YC(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const c in i)if(c!=="default"&&!(c in n)){const u=Object.getOwnPropertyDescriptor(i,c);u&&Object.defineProperty(n,c,u.get?u:{enumerable:!0,get:()=>i[c]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))i(c);new MutationObserver(c=>{for(const u of c)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&i(m)}).observe(document,{childList:!0,subtree:!0});function t(c){const u={};return c.integrity&&(u.integrity=c.integrity),c.referrerPolicy&&(u.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?u.credentials="include":c.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(c){if(c.ep)return;c.ep=!0;const u=t(c);fetch(c.href,u)}})();var JV=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Dv(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function JC(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function i(){var c=!1;try{c=this instanceof i}catch{}return c?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var c=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,c.get?c:{enumerable:!0,get:function(){return n[i]}})}),t}var Gx={exports:{}},ly={},Wx={exports:{}},Zo={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K4;function QC(){if(K4)return Zo;K4=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),m=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),o=Symbol.for("react.suspense"),w=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),O=Symbol.iterator;function V(xe){return xe===null||typeof xe!="object"?null:(xe=O&&xe[O]||xe["@@iterator"],typeof xe=="function"?xe:null)}var M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},se=Object.assign,ce={};function fe(xe,ae,Me){this.props=xe,this.context=ae,this.refs=ce,this.updater=Me||M}fe.prototype.isReactComponent={},fe.prototype.setState=function(xe,ae){if(typeof xe!="object"&&typeof xe!="function"&&xe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,xe,ae,"setState")},fe.prototype.forceUpdate=function(xe){this.updater.enqueueForceUpdate(this,xe,"forceUpdate")};function ne(){}ne.prototype=fe.prototype;function oe(xe,ae,Me){this.props=xe,this.context=ae,this.refs=ce,this.updater=Me||M}var ye=oe.prototype=new ne;ye.constructor=oe,se(ye,fe.prototype),ye.isPureReactComponent=!0;var he=Array.isArray,Ne=Object.prototype.hasOwnProperty,Ve={current:null},de={key:!0,ref:!0,__self:!0,__source:!0};function j(xe,ae,Me){var Fe,Ze={},et=null,mt=null;if(ae!=null)for(Fe in ae.ref!==void 0&&(mt=ae.ref),ae.key!==void 0&&(et=""+ae.key),ae)Ne.call(ae,Fe)&&!de.hasOwnProperty(Fe)&&(Ze[Fe]=ae[Fe]);var ht=arguments.length-2;if(ht===1)Ze.children=Me;else if(1<ht){for(var Nt=Array(ht),Jt=0;Jt<ht;Jt++)Nt[Jt]=arguments[Jt+2];Ze.children=Nt}if(xe&&xe.defaultProps)for(Fe in ht=xe.defaultProps,ht)Ze[Fe]===void 0&&(Ze[Fe]=ht[Fe]);return{$$typeof:n,type:xe,key:et,ref:mt,props:Ze,_owner:Ve.current}}function D(xe,ae){return{$$typeof:n,type:xe.type,key:ae,ref:xe.ref,props:xe.props,_owner:xe._owner}}function $(xe){return typeof xe=="object"&&xe!==null&&xe.$$typeof===n}function z(xe){var ae={"=":"=0",":":"=2"};return"$"+xe.replace(/[=:]/g,function(Me){return ae[Me]})}var W=/\/+/g;function Z(xe,ae){return typeof xe=="object"&&xe!==null&&xe.key!=null?z(""+xe.key):ae.toString(36)}function Ee(xe,ae,Me,Fe,Ze){var et=typeof xe;(et==="undefined"||et==="boolean")&&(xe=null);var mt=!1;if(xe===null)mt=!0;else switch(et){case"string":case"number":mt=!0;break;case"object":switch(xe.$$typeof){case n:case e:mt=!0}}if(mt)return mt=xe,Ze=Ze(mt),xe=Fe===""?"."+Z(mt,0):Fe,he(Ze)?(Me="",xe!=null&&(Me=xe.replace(W,"$&/")+"/"),Ee(Ze,ae,Me,"",function(Jt){return Jt})):Ze!=null&&($(Ze)&&(Ze=D(Ze,Me+(!Ze.key||mt&&mt.key===Ze.key?"":(""+Ze.key).replace(W,"$&/")+"/")+xe)),ae.push(Ze)),1;if(mt=0,Fe=Fe===""?".":Fe+":",he(xe))for(var ht=0;ht<xe.length;ht++){et=xe[ht];var Nt=Fe+Z(et,ht);mt+=Ee(et,ae,Me,Nt,Ze)}else if(Nt=V(xe),typeof Nt=="function")for(xe=Nt.call(xe),ht=0;!(et=xe.next()).done;)et=et.value,Nt=Fe+Z(et,ht++),mt+=Ee(et,ae,Me,Nt,Ze);else if(et==="object")throw ae=String(xe),Error("Objects are not valid as a React child (found: "+(ae==="[object Object]"?"object with keys {"+Object.keys(xe).join(", ")+"}":ae)+"). If you meant to render a collection of children, use an array instead.");return mt}function ke(xe,ae,Me){if(xe==null)return xe;var Fe=[],Ze=0;return Ee(xe,Fe,"","",function(et){return ae.call(Me,et,Ze++)}),Fe}function Oe(xe){if(xe._status===-1){var ae=xe._result;ae=ae(),ae.then(function(Me){(xe._status===0||xe._status===-1)&&(xe._status=1,xe._result=Me)},function(Me){(xe._status===0||xe._status===-1)&&(xe._status=2,xe._result=Me)}),xe._status===-1&&(xe._status=0,xe._result=ae)}if(xe._status===1)return xe._result.default;throw xe._result}var Re={current:null},be={transition:null},De={ReactCurrentDispatcher:Re,ReactCurrentBatchConfig:be,ReactCurrentOwner:Ve};function Qe(){throw Error("act(...) is not supported in production builds of React.")}return Zo.Children={map:ke,forEach:function(xe,ae,Me){ke(xe,function(){ae.apply(this,arguments)},Me)},count:function(xe){var ae=0;return ke(xe,function(){ae++}),ae},toArray:function(xe){return ke(xe,function(ae){return ae})||[]},only:function(xe){if(!$(xe))throw Error("React.Children.only expected to receive a single React element child.");return xe}},Zo.Component=fe,Zo.Fragment=t,Zo.Profiler=c,Zo.PureComponent=oe,Zo.StrictMode=i,Zo.Suspense=o,Zo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=De,Zo.act=Qe,Zo.cloneElement=function(xe,ae,Me){if(xe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+xe+".");var Fe=se({},xe.props),Ze=xe.key,et=xe.ref,mt=xe._owner;if(ae!=null){if(ae.ref!==void 0&&(et=ae.ref,mt=Ve.current),ae.key!==void 0&&(Ze=""+ae.key),xe.type&&xe.type.defaultProps)var ht=xe.type.defaultProps;for(Nt in ae)Ne.call(ae,Nt)&&!de.hasOwnProperty(Nt)&&(Fe[Nt]=ae[Nt]===void 0&&ht!==void 0?ht[Nt]:ae[Nt])}var Nt=arguments.length-2;if(Nt===1)Fe.children=Me;else if(1<Nt){ht=Array(Nt);for(var Jt=0;Jt<Nt;Jt++)ht[Jt]=arguments[Jt+2];Fe.children=ht}return{$$typeof:n,type:xe.type,key:Ze,ref:et,props:Fe,_owner:mt}},Zo.createContext=function(xe){return xe={$$typeof:m,_currentValue:xe,_currentValue2:xe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},xe.Provider={$$typeof:u,_context:xe},xe.Consumer=xe},Zo.createElement=j,Zo.createFactory=function(xe){var ae=j.bind(null,xe);return ae.type=xe,ae},Zo.createRef=function(){return{current:null}},Zo.forwardRef=function(xe){return{$$typeof:_,render:xe}},Zo.isValidElement=$,Zo.lazy=function(xe){return{$$typeof:I,_payload:{_status:-1,_result:xe},_init:Oe}},Zo.memo=function(xe,ae){return{$$typeof:w,type:xe,compare:ae===void 0?null:ae}},Zo.startTransition=function(xe){var ae=be.transition;be.transition={};try{xe()}finally{be.transition=ae}},Zo.unstable_act=Qe,Zo.useCallback=function(xe,ae){return Re.current.useCallback(xe,ae)},Zo.useContext=function(xe){return Re.current.useContext(xe)},Zo.useDebugValue=function(){},Zo.useDeferredValue=function(xe){return Re.current.useDeferredValue(xe)},Zo.useEffect=function(xe,ae){return Re.current.useEffect(xe,ae)},Zo.useId=function(){return Re.current.useId()},Zo.useImperativeHandle=function(xe,ae,Me){return Re.current.useImperativeHandle(xe,ae,Me)},Zo.useInsertionEffect=function(xe,ae){return Re.current.useInsertionEffect(xe,ae)},Zo.useLayoutEffect=function(xe,ae){return Re.current.useLayoutEffect(xe,ae)},Zo.useMemo=function(xe,ae){return Re.current.useMemo(xe,ae)},Zo.useReducer=function(xe,ae,Me){return Re.current.useReducer(xe,ae,Me)},Zo.useRef=function(xe){return Re.current.useRef(xe)},Zo.useState=function(xe){return Re.current.useState(xe)},Zo.useSyncExternalStore=function(xe,ae,Me){return Re.current.useSyncExternalStore(xe,ae,Me)},Zo.useTransition=function(){return Re.current.useTransition()},Zo.version="18.3.1",Zo}var Z4;function X5(){return Z4||(Z4=1,Wx.exports=QC()),Wx.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y4;function eL(){if(Y4)return ly;Y4=1;var n=X5(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,c=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function m(_,o,w){var I,O={},V=null,M=null;w!==void 0&&(V=""+w),o.key!==void 0&&(V=""+o.key),o.ref!==void 0&&(M=o.ref);for(I in o)i.call(o,I)&&!u.hasOwnProperty(I)&&(O[I]=o[I]);if(_&&_.defaultProps)for(I in o=_.defaultProps,o)O[I]===void 0&&(O[I]=o[I]);return{$$typeof:e,type:_,key:V,ref:M,props:O,_owner:c.current}}return ly.Fragment=t,ly.jsx=m,ly.jsxs=m,ly}var J4;function tL(){return J4||(J4=1,Gx.exports=eL()),Gx.exports}var Q=tL(),Fn=X5();const nL=Dv(Fn),rL=YC({__proto__:null,default:nL},[Fn]);var Z_={},Hx={exports:{}},Bh={},Xx={exports:{}},Kx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q4;function iL(){return Q4||(Q4=1,(function(n){function e(be,De){var Qe=be.length;be.push(De);e:for(;0<Qe;){var xe=Qe-1>>>1,ae=be[xe];if(0<c(ae,De))be[xe]=De,be[Qe]=ae,Qe=xe;else break e}}function t(be){return be.length===0?null:be[0]}function i(be){if(be.length===0)return null;var De=be[0],Qe=be.pop();if(Qe!==De){be[0]=Qe;e:for(var xe=0,ae=be.length,Me=ae>>>1;xe<Me;){var Fe=2*(xe+1)-1,Ze=be[Fe],et=Fe+1,mt=be[et];if(0>c(Ze,Qe))et<ae&&0>c(mt,Ze)?(be[xe]=mt,be[et]=Qe,xe=et):(be[xe]=Ze,be[Fe]=Qe,xe=Fe);else if(et<ae&&0>c(mt,Qe))be[xe]=mt,be[et]=Qe,xe=et;else break e}}return De}function c(be,De){var Qe=be.sortIndex-De.sortIndex;return Qe!==0?Qe:be.id-De.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var m=Date,_=m.now();n.unstable_now=function(){return m.now()-_}}var o=[],w=[],I=1,O=null,V=3,M=!1,se=!1,ce=!1,fe=typeof setTimeout=="function"?setTimeout:null,ne=typeof clearTimeout=="function"?clearTimeout:null,oe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ye(be){for(var De=t(w);De!==null;){if(De.callback===null)i(w);else if(De.startTime<=be)i(w),De.sortIndex=De.expirationTime,e(o,De);else break;De=t(w)}}function he(be){if(ce=!1,ye(be),!se)if(t(o)!==null)se=!0,Oe(Ne);else{var De=t(w);De!==null&&Re(he,De.startTime-be)}}function Ne(be,De){se=!1,ce&&(ce=!1,ne(j),j=-1),M=!0;var Qe=V;try{for(ye(De),O=t(o);O!==null&&(!(O.expirationTime>De)||be&&!z());){var xe=O.callback;if(typeof xe=="function"){O.callback=null,V=O.priorityLevel;var ae=xe(O.expirationTime<=De);De=n.unstable_now(),typeof ae=="function"?O.callback=ae:O===t(o)&&i(o),ye(De)}else i(o);O=t(o)}if(O!==null)var Me=!0;else{var Fe=t(w);Fe!==null&&Re(he,Fe.startTime-De),Me=!1}return Me}finally{O=null,V=Qe,M=!1}}var Ve=!1,de=null,j=-1,D=5,$=-1;function z(){return!(n.unstable_now()-$<D)}function W(){if(de!==null){var be=n.unstable_now();$=be;var De=!0;try{De=de(!0,be)}finally{De?Z():(Ve=!1,de=null)}}else Ve=!1}var Z;if(typeof oe=="function")Z=function(){oe(W)};else if(typeof MessageChannel<"u"){var Ee=new MessageChannel,ke=Ee.port2;Ee.port1.onmessage=W,Z=function(){ke.postMessage(null)}}else Z=function(){fe(W,0)};function Oe(be){de=be,Ve||(Ve=!0,Z())}function Re(be,De){j=fe(function(){be(n.unstable_now())},De)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(be){be.callback=null},n.unstable_continueExecution=function(){se||M||(se=!0,Oe(Ne))},n.unstable_forceFrameRate=function(be){0>be||125<be?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<be?Math.floor(1e3/be):5},n.unstable_getCurrentPriorityLevel=function(){return V},n.unstable_getFirstCallbackNode=function(){return t(o)},n.unstable_next=function(be){switch(V){case 1:case 2:case 3:var De=3;break;default:De=V}var Qe=V;V=De;try{return be()}finally{V=Qe}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(be,De){switch(be){case 1:case 2:case 3:case 4:case 5:break;default:be=3}var Qe=V;V=be;try{return De()}finally{V=Qe}},n.unstable_scheduleCallback=function(be,De,Qe){var xe=n.unstable_now();switch(typeof Qe=="object"&&Qe!==null?(Qe=Qe.delay,Qe=typeof Qe=="number"&&0<Qe?xe+Qe:xe):Qe=xe,be){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=Qe+ae,be={id:I++,callback:De,priorityLevel:be,startTime:Qe,expirationTime:ae,sortIndex:-1},Qe>xe?(be.sortIndex=Qe,e(w,be),t(o)===null&&be===t(w)&&(ce?(ne(j),j=-1):ce=!0,Re(he,Qe-xe))):(be.sortIndex=ae,e(o,be),se||M||(se=!0,Oe(Ne))),be},n.unstable_shouldYield=z,n.unstable_wrapCallback=function(be){var De=V;return function(){var Qe=V;V=De;try{return be.apply(this,arguments)}finally{V=Qe}}}})(Kx)),Kx}var e2;function oL(){return e2||(e2=1,Xx.exports=iL()),Xx.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t2;function sL(){if(t2)return Bh;t2=1;var n=X5(),e=oL();function t(d){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+d,E=1;E<arguments.length;E++)g+="&args[]="+encodeURIComponent(arguments[E]);return"Minified React error #"+d+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,c={};function u(d,g){m(d,g),m(d+"Capture",g)}function m(d,g){for(c[d]=g,d=0;d<g.length;d++)i.add(g[d])}var _=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),o=Object.prototype.hasOwnProperty,w=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,I={},O={};function V(d){return o.call(O,d)?!0:o.call(I,d)?!1:w.test(d)?O[d]=!0:(I[d]=!0,!1)}function M(d,g,E,N){if(E!==null&&E.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return N?!1:E!==null?!E.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function se(d,g,E,N){if(g===null||typeof g>"u"||M(d,g,E,N))return!0;if(N)return!1;if(E!==null)switch(E.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function ce(d,g,E,N,X,le,ze){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=N,this.attributeNamespace=X,this.mustUseProperty=E,this.propertyName=d,this.type=g,this.sanitizeURL=le,this.removeEmptyString=ze}var fe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){fe[d]=new ce(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var g=d[0];fe[g]=new ce(g,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){fe[d]=new ce(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){fe[d]=new ce(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){fe[d]=new ce(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){fe[d]=new ce(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){fe[d]=new ce(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){fe[d]=new ce(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){fe[d]=new ce(d,5,!1,d.toLowerCase(),null,!1,!1)});var ne=/[\-:]([a-z])/g;function oe(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var g=d.replace(ne,oe);fe[g]=new ce(g,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var g=d.replace(ne,oe);fe[g]=new ce(g,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var g=d.replace(ne,oe);fe[g]=new ce(g,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){fe[d]=new ce(d,1,!1,d.toLowerCase(),null,!1,!1)}),fe.xlinkHref=new ce("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){fe[d]=new ce(d,1,!1,d.toLowerCase(),null,!0,!0)});function ye(d,g,E,N){var X=fe.hasOwnProperty(g)?fe[g]:null;(X!==null?X.type!==0:N||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(se(g,E,X,N)&&(E=null),N||X===null?V(g)&&(E===null?d.removeAttribute(g):d.setAttribute(g,""+E)):X.mustUseProperty?d[X.propertyName]=E===null?X.type===3?!1:"":E:(g=X.attributeName,N=X.attributeNamespace,E===null?d.removeAttribute(g):(X=X.type,E=X===3||X===4&&E===!0?"":""+E,N?d.setAttributeNS(N,g,E):d.setAttribute(g,E))))}var he=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ne=Symbol.for("react.element"),Ve=Symbol.for("react.portal"),de=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),$=Symbol.for("react.provider"),z=Symbol.for("react.context"),W=Symbol.for("react.forward_ref"),Z=Symbol.for("react.suspense"),Ee=Symbol.for("react.suspense_list"),ke=Symbol.for("react.memo"),Oe=Symbol.for("react.lazy"),Re=Symbol.for("react.offscreen"),be=Symbol.iterator;function De(d){return d===null||typeof d!="object"?null:(d=be&&d[be]||d["@@iterator"],typeof d=="function"?d:null)}var Qe=Object.assign,xe;function ae(d){if(xe===void 0)try{throw Error()}catch(E){var g=E.stack.trim().match(/\n( *(at )?)/);xe=g&&g[1]||""}return`
`+xe+d}var Me=!1;function Fe(d,g){if(!d||Me)return"";Me=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(yn){var N=yn}Reflect.construct(d,[],g)}else{try{g.call()}catch(yn){N=yn}d.call(g.prototype)}else{try{throw Error()}catch(yn){N=yn}d()}}catch(yn){if(yn&&N&&typeof yn.stack=="string"){for(var X=yn.stack.split(`
`),le=N.stack.split(`
`),ze=X.length-1,Et=le.length-1;1<=ze&&0<=Et&&X[ze]!==le[Et];)Et--;for(;1<=ze&&0<=Et;ze--,Et--)if(X[ze]!==le[Et]){if(ze!==1||Et!==1)do if(ze--,Et--,0>Et||X[ze]!==le[Et]){var Ft=`
`+X[ze].replace(" at new "," at ");return d.displayName&&Ft.includes("<anonymous>")&&(Ft=Ft.replace("<anonymous>",d.displayName)),Ft}while(1<=ze&&0<=Et);break}}}finally{Me=!1,Error.prepareStackTrace=E}return(d=d?d.displayName||d.name:"")?ae(d):""}function Ze(d){switch(d.tag){case 5:return ae(d.type);case 16:return ae("Lazy");case 13:return ae("Suspense");case 19:return ae("SuspenseList");case 0:case 2:case 15:return d=Fe(d.type,!1),d;case 11:return d=Fe(d.type.render,!1),d;case 1:return d=Fe(d.type,!0),d;default:return""}}function et(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case de:return"Fragment";case Ve:return"Portal";case D:return"Profiler";case j:return"StrictMode";case Z:return"Suspense";case Ee:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case z:return(d.displayName||"Context")+".Consumer";case $:return(d._context.displayName||"Context")+".Provider";case W:var g=d.render;return d=d.displayName,d||(d=g.displayName||g.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case ke:return g=d.displayName||null,g!==null?g:et(d.type)||"Memo";case Oe:g=d._payload,d=d._init;try{return et(d(g))}catch{}}return null}function mt(d){var g=d.type;switch(d.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=g.render,d=d.displayName||d.name||"",g.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return et(g);case 8:return g===j?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function ht(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function Nt(d){var g=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Jt(d){var g=Nt(d)?"checked":"value",E=Object.getOwnPropertyDescriptor(d.constructor.prototype,g),N=""+d[g];if(!d.hasOwnProperty(g)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var X=E.get,le=E.set;return Object.defineProperty(d,g,{configurable:!0,get:function(){return X.call(this)},set:function(ze){N=""+ze,le.call(this,ze)}}),Object.defineProperty(d,g,{enumerable:E.enumerable}),{getValue:function(){return N},setValue:function(ze){N=""+ze},stopTracking:function(){d._valueTracker=null,delete d[g]}}}}function tn(d){d._valueTracker||(d._valueTracker=Jt(d))}function fn(d){if(!d)return!1;var g=d._valueTracker;if(!g)return!0;var E=g.getValue(),N="";return d&&(N=Nt(d)?d.checked?"true":"false":d.value),d=N,d!==E?(g.setValue(d),!0):!1}function An(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function zt(d,g){var E=g.checked;return Qe({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:E??d._wrapperState.initialChecked})}function it(d,g){var E=g.defaultValue==null?"":g.defaultValue,N=g.checked!=null?g.checked:g.defaultChecked;E=ht(g.value!=null?g.value:E),d._wrapperState={initialChecked:N,initialValue:E,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function ur(d,g){g=g.checked,g!=null&&ye(d,"checked",g,!1)}function xr(d,g){ur(d,g);var E=ht(g.value),N=g.type;if(E!=null)N==="number"?(E===0&&d.value===""||d.value!=E)&&(d.value=""+E):d.value!==""+E&&(d.value=""+E);else if(N==="submit"||N==="reset"){d.removeAttribute("value");return}g.hasOwnProperty("value")?Tn(d,g.type,E):g.hasOwnProperty("defaultValue")&&Tn(d,g.type,ht(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(d.defaultChecked=!!g.defaultChecked)}function Tr(d,g,E){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var N=g.type;if(!(N!=="submit"&&N!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+d._wrapperState.initialValue,E||g===d.value||(d.value=g),d.defaultValue=g}E=d.name,E!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,E!==""&&(d.name=E)}function Tn(d,g,E){(g!=="number"||An(d.ownerDocument)!==d)&&(E==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+E&&(d.defaultValue=""+E))}var Yn=Array.isArray;function $n(d,g,E,N){if(d=d.options,g){g={};for(var X=0;X<E.length;X++)g["$"+E[X]]=!0;for(E=0;E<d.length;E++)X=g.hasOwnProperty("$"+d[E].value),d[E].selected!==X&&(d[E].selected=X),X&&N&&(d[E].defaultSelected=!0)}else{for(E=""+ht(E),g=null,X=0;X<d.length;X++){if(d[X].value===E){d[X].selected=!0,N&&(d[X].defaultSelected=!0);return}g!==null||d[X].disabled||(g=d[X])}g!==null&&(g.selected=!0)}}function hr(d,g){if(g.dangerouslySetInnerHTML!=null)throw Error(t(91));return Qe({},g,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function Wt(d,g){var E=g.value;if(E==null){if(E=g.children,g=g.defaultValue,E!=null){if(g!=null)throw Error(t(92));if(Yn(E)){if(1<E.length)throw Error(t(93));E=E[0]}g=E}g==null&&(g=""),E=g}d._wrapperState={initialValue:ht(E)}}function Nn(d,g){var E=ht(g.value),N=ht(g.defaultValue);E!=null&&(E=""+E,E!==d.value&&(d.value=E),g.defaultValue==null&&d.defaultValue!==E&&(d.defaultValue=E)),N!=null&&(d.defaultValue=""+N)}function tr(d){var g=d.textContent;g===d._wrapperState.initialValue&&g!==""&&g!==null&&(d.value=g)}function Hn(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Rr(d,g){return d==null||d==="http://www.w3.org/1999/xhtml"?Hn(g):d==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var lr,wr=(function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,E,N,X){MSApp.execUnsafeLocalFunction(function(){return d(g,E,N,X)})}:d})(function(d,g){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=g;else{for(lr=lr||document.createElement("div"),lr.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=lr.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;g.firstChild;)d.appendChild(g.firstChild)}});function br(d,g){if(g){var E=d.firstChild;if(E&&E===d.lastChild&&E.nodeType===3){E.nodeValue=g;return}}d.textContent=g}var Ir={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Bi=["Webkit","ms","Moz","O"];Object.keys(Ir).forEach(function(d){Bi.forEach(function(g){g=g+d.charAt(0).toUpperCase()+d.substring(1),Ir[g]=Ir[d]})});function Mi(d,g,E){return g==null||typeof g=="boolean"||g===""?"":E||typeof g!="number"||g===0||Ir.hasOwnProperty(d)&&Ir[d]?(""+g).trim():g+"px"}function pr(d,g){d=d.style;for(var E in g)if(g.hasOwnProperty(E)){var N=E.indexOf("--")===0,X=Mi(E,g[E],N);E==="float"&&(E="cssFloat"),N?d.setProperty(E,X):d[E]=X}}var Jr=Qe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Kr(d,g){if(g){if(Jr[d]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(t(137,d));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(t(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(t(61))}if(g.style!=null&&typeof g.style!="object")throw Error(t(62))}}function Sr(d,g){if(d.indexOf("-")===-1)return typeof g.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ui=null;function ii(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var ut=null,we=null,Ie=null;function Ye(d){if(d=Rc(d)){if(typeof ut!="function")throw Error(t(280));var g=d.stateNode;g&&(g=Ph(g),ut(d.stateNode,d.type,g))}}function ct(d){we?Ie?Ie.push(d):Ie=[d]:we=d}function Ct(){if(we){var d=we,g=Ie;if(Ie=we=null,Ye(d),g)for(d=0;d<g.length;d++)Ye(g[d])}}function Rt(d,g){return d(g)}function Bt(){}var St=!1;function Mt(d,g,E){if(St)return d(g,E);St=!0;try{return Rt(d,g,E)}finally{St=!1,(we!==null||Ie!==null)&&(Bt(),Ct())}}function vn(d,g){var E=d.stateNode;if(E===null)return null;var N=Ph(E);if(N===null)return null;E=N[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(N=!N.disabled)||(d=d.type,N=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!N;break e;default:d=!1}if(d)return null;if(E&&typeof E!="function")throw Error(t(231,g,typeof E));return E}var Bn=!1;if(_)try{var Ln={};Object.defineProperty(Ln,"passive",{get:function(){Bn=!0}}),window.addEventListener("test",Ln,Ln),window.removeEventListener("test",Ln,Ln)}catch{Bn=!1}function qr(d,g,E,N,X,le,ze,Et,Ft){var yn=Array.prototype.slice.call(arguments,3);try{g.apply(E,yn)}catch(Jn){this.onError(Jn)}}var Cr=!1,Ar=null,Dr=!1,_i=null,ko={onError:function(d){Cr=!0,Ar=d}};function ro(d,g,E,N,X,le,ze,Et,Ft){Cr=!1,Ar=null,qr.apply(ko,arguments)}function os(d,g,E,N,X,le,ze,Et,Ft){if(ro.apply(this,arguments),Cr){if(Cr){var yn=Ar;Cr=!1,Ar=null}else throw Error(t(198));Dr||(Dr=!0,_i=yn)}}function Ji(d){var g=d,E=d;if(d.alternate)for(;g.return;)g=g.return;else{d=g;do g=d,(g.flags&4098)!==0&&(E=g.return),d=g.return;while(d)}return g.tag===3?E:null}function Yo(d){if(d.tag===13){var g=d.memoizedState;if(g===null&&(d=d.alternate,d!==null&&(g=d.memoizedState)),g!==null)return g.dehydrated}return null}function oo(d){if(Ji(d)!==d)throw Error(t(188))}function Jo(d){var g=d.alternate;if(!g){if(g=Ji(d),g===null)throw Error(t(188));return g!==d?null:d}for(var E=d,N=g;;){var X=E.return;if(X===null)break;var le=X.alternate;if(le===null){if(N=X.return,N!==null){E=N;continue}break}if(X.child===le.child){for(le=X.child;le;){if(le===E)return oo(X),d;if(le===N)return oo(X),g;le=le.sibling}throw Error(t(188))}if(E.return!==N.return)E=X,N=le;else{for(var ze=!1,Et=X.child;Et;){if(Et===E){ze=!0,E=X,N=le;break}if(Et===N){ze=!0,N=X,E=le;break}Et=Et.sibling}if(!ze){for(Et=le.child;Et;){if(Et===E){ze=!0,E=le,N=X;break}if(Et===N){ze=!0,N=le,E=X;break}Et=Et.sibling}if(!ze)throw Error(t(189))}}if(E.alternate!==N)throw Error(t(190))}if(E.tag!==3)throw Error(t(188));return E.stateNode.current===E?d:g}function La(d){return d=Jo(d),d!==null?zl(d):null}function zl(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var g=zl(d);if(g!==null)return g;d=d.sibling}return null}var jl=e.unstable_scheduleCallback,Fi=e.unstable_cancelCallback,nc=e.unstable_shouldYield,Hc=e.unstable_requestPaint,Oi=e.unstable_now,Sc=e.unstable_getCurrentPriorityLevel,Pa=e.unstable_ImmediatePriority,Qo=e.unstable_UserBlockingPriority,Sa=e.unstable_NormalPriority,Ec=e.unstable_LowPriority,hl=e.unstable_IdlePriority,Ea=null,Ro=null;function pn(d){if(Ro&&typeof Ro.onCommitFiberRoot=="function")try{Ro.onCommitFiberRoot(Ea,d,void 0,(d.current.flags&128)===128)}catch{}}var ss=Math.clz32?Math.clz32:Au,as=Math.log,Qi=Math.LN2;function Au(d){return d>>>=0,d===0?32:31-(as(d)/Qi|0)|0}var ka=64,Za=4194304;function ls(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function Us(d,g){var E=d.pendingLanes;if(E===0)return 0;var N=0,X=d.suspendedLanes,le=d.pingedLanes,ze=E&268435455;if(ze!==0){var Et=ze&~X;Et!==0?N=ls(Et):(le&=ze,le!==0&&(N=ls(le)))}else ze=E&~X,ze!==0?N=ls(ze):le!==0&&(N=ls(le));if(N===0)return 0;if(g!==0&&g!==N&&(g&X)===0&&(X=N&-N,le=g&-g,X>=le||X===16&&(le&4194240)!==0))return g;if((N&4)!==0&&(N|=E&16),g=d.entangledLanes,g!==0)for(d=d.entanglements,g&=N;0<g;)E=31-ss(g),X=1<<E,N|=d[E],g&=~X;return N}function Qn(d,g){switch(d){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Fr(d,g){for(var E=d.suspendedLanes,N=d.pingedLanes,X=d.expirationTimes,le=d.pendingLanes;0<le;){var ze=31-ss(le),Et=1<<ze,Ft=X[ze];Ft===-1?((Et&E)===0||(Et&N)!==0)&&(X[ze]=Qn(Et,g)):Ft<=g&&(d.expiredLanes|=Et),le&=~Et}}function ei(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function aa(){var d=ka;return ka<<=1,(ka&4194240)===0&&(ka=64),d}function fa(d){for(var g=[],E=0;31>E;E++)g.push(d);return g}function vi(d,g,E){d.pendingLanes|=g,g!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,g=31-ss(g),d[g]=E}function Lr(d,g){var E=d.pendingLanes&~g;d.pendingLanes=g,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=g,d.mutableReadLanes&=g,d.entangledLanes&=g,g=d.entanglements;var N=d.eventTimes;for(d=d.expirationTimes;0<E;){var X=31-ss(E),le=1<<X;g[X]=0,N[X]=-1,d[X]=-1,E&=~le}}function dl(d,g){var E=d.entangledLanes|=g;for(d=d.entanglements;E;){var N=31-ss(E),X=1<<N;X&g|d[N]&g&&(d[N]|=g),E&=~X}}var zi=0;function es(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var _o,Tu,Sl,Ac,rc,El=!1,Mo=[],ys=null,Ps=null,ja=null,oi=new Map,ts=new Map,No=[],Xu="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ul(d,g){switch(d){case"focusin":case"focusout":ys=null;break;case"dragenter":case"dragleave":Ps=null;break;case"mouseover":case"mouseout":ja=null;break;case"pointerover":case"pointerout":oi.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":ts.delete(g.pointerId)}}function Ao(d,g,E,N,X,le){return d===null||d.nativeEvent!==le?(d={blockedOn:g,domEventName:E,eventSystemFlags:N,nativeEvent:le,targetContainers:[X]},g!==null&&(g=Rc(g),g!==null&&Tu(g)),d):(d.eventSystemFlags|=N,g=d.targetContainers,X!==null&&g.indexOf(X)===-1&&g.push(X),d)}function Vs(d,g,E,N,X){switch(g){case"focusin":return ys=Ao(ys,d,g,E,N,X),!0;case"dragenter":return Ps=Ao(Ps,d,g,E,N,X),!0;case"mouseover":return ja=Ao(ja,d,g,E,N,X),!0;case"pointerover":var le=X.pointerId;return oi.set(le,Ao(oi.get(le)||null,d,g,E,N,X)),!0;case"gotpointercapture":return le=X.pointerId,ts.set(le,Ao(ts.get(le)||null,d,g,E,N,X)),!0}return!1}function Ku(d){var g=Fa(d.target);if(g!==null){var E=Ji(g);if(E!==null){if(g=E.tag,g===13){if(g=Yo(E),g!==null){d.blockedOn=g,rc(d.priority,function(){Sl(E)});return}}else if(g===3&&E.stateNode.current.memoizedState.isDehydrated){d.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}d.blockedOn=null}function fl(d){if(d.blockedOn!==null)return!1;for(var g=d.targetContainers;0<g.length;){var E=ic(d.domEventName,d.eventSystemFlags,g[0],d.nativeEvent);if(E===null){E=d.nativeEvent;var N=new E.constructor(E.type,E);ui=N,E.target.dispatchEvent(N),ui=null}else return g=Rc(E),g!==null&&Tu(g),d.blockedOn=E,!1;g.shift()}return!0}function To(d,g,E){fl(d)&&E.delete(g)}function vo(){El=!1,ys!==null&&fl(ys)&&(ys=null),Ps!==null&&fl(Ps)&&(Ps=null),ja!==null&&fl(ja)&&(ja=null),oi.forEach(To),ts.forEach(To)}function Ss(d,g){d.blockedOn===g&&(d.blockedOn=null,El||(El=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,vo)))}function Oo(d){function g(X){return Ss(X,d)}if(0<Mo.length){Ss(Mo[0],d);for(var E=1;E<Mo.length;E++){var N=Mo[E];N.blockedOn===d&&(N.blockedOn=null)}}for(ys!==null&&Ss(ys,d),Ps!==null&&Ss(Ps,d),ja!==null&&Ss(ja,d),oi.forEach(g),ts.forEach(g),E=0;E<No.length;E++)N=No[E],N.blockedOn===d&&(N.blockedOn=null);for(;0<No.length&&(E=No[0],E.blockedOn===null);)Ku(E),E.blockedOn===null&&No.shift()}var Vo=he.ReactCurrentBatchConfig,Tc=!0;function Bo(d,g,E,N){var X=zi,le=Vo.transition;Vo.transition=null;try{zi=1,Ma(d,g,E,N)}finally{zi=X,Vo.transition=le}}function Al(d,g,E,N){var X=zi,le=Vo.transition;Vo.transition=null;try{zi=4,Ma(d,g,E,N)}finally{zi=X,Vo.transition=le}}function Ma(d,g,E,N){if(Tc){var X=ic(d,g,E,N);if(X===null)cc(d,g,N,pl,E),Ul(d,N);else if(Vs(X,d,g,E,N))N.stopPropagation();else if(Ul(d,N),g&4&&-1<Xu.indexOf(d)){for(;X!==null;){var le=Rc(X);if(le!==null&&_o(le),le=ic(d,g,E,N),le===null&&cc(d,g,N,pl,E),le===X)break;X=le}X!==null&&N.stopPropagation()}else cc(d,g,N,null,E)}}var pl=null;function ic(d,g,E,N){if(pl=null,d=ii(N),d=Fa(d),d!==null)if(g=Ji(d),g===null)d=null;else if(E=g.tag,E===13){if(d=Yo(g),d!==null)return d;d=null}else if(E===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;d=null}else g!==d&&(d=null);return pl=d,null}function qs(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Sc()){case Pa:return 1;case Qo:return 4;case Sa:case Ec:return 16;case hl:return 536870912;default:return 16}default:return 16}}var $s=null,si=null,Gs=null;function qo(){if(Gs)return Gs;var d,g=si,E=g.length,N,X="value"in $s?$s.value:$s.textContent,le=X.length;for(d=0;d<E&&g[d]===X[d];d++);var ze=E-d;for(N=1;N<=ze&&g[E-N]===X[le-N];N++);return Gs=X.slice(d,1<N?1-N:void 0)}function Es(d){var g=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&g===13&&(d=13)):d=g,d===10&&(d=13),32<=d||d===13?d:0}function As(){return!0}function Ya(){return!1}function ks(d){function g(E,N,X,le,ze){this._reactName=E,this._targetInst=X,this.type=N,this.nativeEvent=le,this.target=ze,this.currentTarget=null;for(var Et in d)d.hasOwnProperty(Et)&&(E=d[Et],this[Et]=E?E(le):le[Et]);return this.isDefaultPrevented=(le.defaultPrevented!=null?le.defaultPrevented:le.returnValue===!1)?As:Ya,this.isPropagationStopped=Ya,this}return Qe(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=As)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=As)},persist:function(){},isPersistent:As}),g}var Ws={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Vl=ks(Ws),H=Qe({},Ws,{view:0,detail:0}),Le=ks(H),pt,Pt,qt,on=Qe({},H,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hs,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==qt&&(qt&&d.type==="mousemove"?(pt=d.screenX-qt.screenX,Pt=d.screenY-qt.screenY):Pt=pt=0,qt=d),pt)},movementY:function(d){return"movementY"in d?d.movementY:Pt}}),Dn=ks(on),Pr=Qe({},on,{dataTransfer:0}),$r=ks(Pr),gi=Qe({},H,{relatedTarget:0}),xi=ks(gi),so=Qe({},Ws,{animationName:0,elapsedTime:0,pseudoElement:0}),lo=ks(so),_s=Qe({},Ws,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),eo=ks(_s),$o=Qe({},Ws,{data:0}),Go=ks($o),ds={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ms={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ja(d){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(d):(d=Ms[d])?!!g[d]:!1}function Hs(){return Ja}var L=Qe({},H,{key:function(d){if(d.key){var g=ds[d.key]||d.key;if(g!=="Unidentified")return g}return d.type==="keypress"?(d=Es(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?zo[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hs,charCode:function(d){return d.type==="keypress"?Es(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?Es(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),re=ks(L),_e=Qe({},on,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$e=ks(_e),Xt=Qe({},H,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hs}),nn=ks(Xt),Un=Qe({},Ws,{propertyName:0,elapsedTime:0,pseudoElement:0}),mo=ks(Un),jo=Qe({},on,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),Hi=ks(jo),Qr=[9,13,27,32],xo=_&&"CompositionEvent"in window,fs=null;_&&"documentMode"in document&&(fs=document.documentMode);var pa=_&&"TextEvent"in window&&!fs,Rs=_&&(!xo||fs&&8<fs&&11>=fs),Tl=" ",Ua=!1;function Xc(d,g){switch(d){case"keyup":return Qr.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ml(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var Qa=!1;function ma(d,g){switch(d){case"compositionend":return ml(g);case"keypress":return g.which!==32?null:(Ua=!0,Tl);case"textInput":return d=g.data,d===Tl&&Ua?null:d;default:return null}}function Xs(d,g){if(Qa)return d==="compositionend"||!xo&&Xc(d,g)?(d=qo(),Gs=si=$s=null,Qa=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Rs&&g.locale!=="ko"?null:g.data;default:return null}}var Kc={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Uo(d){var g=d&&d.nodeName&&d.nodeName.toLowerCase();return g==="input"?!!Kc[d.type]:g==="textarea"}function au(d,g,E,N){ct(N),g=go(g,"onChange"),0<g.length&&(E=new Vl("onChange","change",null,E,N),d.push({event:E,listeners:g}))}var el=null,tl=null;function Ks(d){Aa(d,0)}function Ic(d){var g=eh(d);if(fn(g))return d}function Cc(d,g){if(d==="change")return g}var ql=!1;if(_){var Zc;if(_){var lu="oninput"in document;if(!lu){var Yc=document.createElement("div");Yc.setAttribute("oninput","return;"),lu=typeof Yc.oninput=="function"}Zc=lu}else Zc=!1;ql=Zc&&(!document.documentMode||9<document.documentMode)}function cu(){el&&(el.detachEvent("onpropertychange",Lc),tl=el=null)}function Lc(d){if(d.propertyName==="value"&&Ic(tl)){var g=[];au(g,tl,d,ii(d)),Mt(Ks,g)}}function Jc(d,g,E){d==="focusin"?(cu(),el=g,tl=E,el.attachEvent("onpropertychange",Lc)):d==="focusout"&&cu()}function uu(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return Ic(tl)}function Qc(d,g){if(d==="click")return Ic(g)}function $l(d,g){if(d==="input"||d==="change")return Ic(g)}function Gl(d,g){return d===g&&(d!==0||1/d===1/g)||d!==d&&g!==g}var ns=typeof Object.is=="function"?Object.is:Gl;function Ts(d,g){if(ns(d,g))return!0;if(typeof d!="object"||d===null||typeof g!="object"||g===null)return!1;var E=Object.keys(d),N=Object.keys(g);if(E.length!==N.length)return!1;for(N=0;N<E.length;N++){var X=E[N];if(!o.call(g,X)||!ns(d[X],g[X]))return!1}return!0}function Li(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function Io(d,g){var E=Li(d);d=0;for(var N;E;){if(E.nodeType===3){if(N=d+E.textContent.length,d<=g&&N>=g)return{node:E,offset:g-d};d=N}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=Li(E)}}function yr(d,g){return d&&g?d===g?!0:d&&d.nodeType===3?!1:g&&g.nodeType===3?yr(d,g.parentNode):"contains"in d?d.contains(g):d.compareDocumentPosition?!!(d.compareDocumentPosition(g)&16):!1:!1}function la(){for(var d=window,g=An();g instanceof d.HTMLIFrameElement;){try{var E=typeof g.contentWindow.location.href=="string"}catch{E=!1}if(E)d=g.contentWindow;else break;g=An(d.document)}return g}function oc(d){var g=d&&d.nodeName&&d.nodeName.toLowerCase();return g&&(g==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||g==="textarea"||d.contentEditable==="true")}function sc(d){var g=la(),E=d.focusedElem,N=d.selectionRange;if(g!==E&&E&&E.ownerDocument&&yr(E.ownerDocument.documentElement,E)){if(N!==null&&oc(E)){if(g=N.start,d=N.end,d===void 0&&(d=g),"selectionStart"in E)E.selectionStart=g,E.selectionEnd=Math.min(d,E.value.length);else if(d=(g=E.ownerDocument||document)&&g.defaultView||window,d.getSelection){d=d.getSelection();var X=E.textContent.length,le=Math.min(N.start,X);N=N.end===void 0?le:Math.min(N.end,X),!d.extend&&le>N&&(X=N,N=le,le=X),X=Io(E,le);var ze=Io(E,N);X&&ze&&(d.rangeCount!==1||d.anchorNode!==X.node||d.anchorOffset!==X.offset||d.focusNode!==ze.node||d.focusOffset!==ze.offset)&&(g=g.createRange(),g.setStart(X.node,X.offset),d.removeAllRanges(),le>N?(d.addRange(g),d.extend(ze.node,ze.offset)):(g.setEnd(ze.node,ze.offset),d.addRange(g)))}}for(g=[],d=E;d=d.parentNode;)d.nodeType===1&&g.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<g.length;E++)d=g[E],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var Il=_&&"documentMode"in document&&11>=document.documentMode,hu=null,ac=null,nl=null,Ur=!1;function Wl(d,g,E){var N=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;Ur||hu==null||hu!==An(N)||(N=hu,"selectionStart"in N&&oc(N)?N={start:N.selectionStart,end:N.selectionEnd}:(N=(N.ownerDocument&&N.ownerDocument.defaultView||window).getSelection(),N={anchorNode:N.anchorNode,anchorOffset:N.anchorOffset,focusNode:N.focusNode,focusOffset:N.focusOffset}),nl&&Ts(nl,N)||(nl=N,N=go(ac,"onSelect"),0<N.length&&(g=new Vl("onSelect","select",null,g,E),d.push({event:g,listeners:N}),g.target=hu)))}function Zs(d,g){var E={};return E[d.toLowerCase()]=g.toLowerCase(),E["Webkit"+d]="webkit"+g,E["Moz"+d]="moz"+g,E}var eu={animationend:Zs("Animation","AnimationEnd"),animationiteration:Zs("Animation","AnimationIteration"),animationstart:Zs("Animation","AnimationStart"),transitionend:Zs("Transition","TransitionEnd")},ga={},du={};_&&(du=document.createElement("div").style,"AnimationEvent"in window||(delete eu.animationend.animation,delete eu.animationiteration.animation,delete eu.animationstart.animation),"TransitionEvent"in window||delete eu.transitionend.transition);function Iu(d){if(ga[d])return ga[d];if(!eu[d])return d;var g=eu[d],E;for(E in g)if(g.hasOwnProperty(E)&&E in du)return ga[d]=g[E];return d}var Ai=Iu("animationend"),Ra=Iu("animationiteration"),Hl=Iu("animationstart"),ca=Iu("transitionend"),Or=new Map,Ys="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function fu(d,g){Or.set(d,g),u(g,[d])}for(var Zu=0;Zu<Ys.length;Zu++){var Ui=Ys[Zu],Cl=Ui.toLowerCase(),vh=Ui[0].toUpperCase()+Ui.slice(1);fu(Cl,"on"+vh)}fu(Ai,"onAnimationEnd"),fu(Ra,"onAnimationIteration"),fu(Hl,"onAnimationStart"),fu("dblclick","onDoubleClick"),fu("focusin","onFocus"),fu("focusout","onBlur"),fu(ca,"onTransitionEnd"),m("onMouseEnter",["mouseout","mouseover"]),m("onMouseLeave",["mouseout","mouseover"]),m("onPointerEnter",["pointerout","pointerover"]),m("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var rs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rl=new Set("cancel close invalid load scroll toggle".split(" ").concat(rs));function Pc(d,g,E){var N=d.type||"unknown-event";d.currentTarget=E,os(N,g,void 0,d),d.currentTarget=null}function Aa(d,g){g=(g&4)!==0;for(var E=0;E<d.length;E++){var N=d[E],X=N.event;N=N.listeners;e:{var le=void 0;if(g)for(var ze=N.length-1;0<=ze;ze--){var Et=N[ze],Ft=Et.instance,yn=Et.currentTarget;if(Et=Et.listener,Ft!==le&&X.isPropagationStopped())break e;Pc(X,Et,yn),le=Ft}else for(ze=0;ze<N.length;ze++){if(Et=N[ze],Ft=Et.instance,yn=Et.currentTarget,Et=Et.listener,Ft!==le&&X.isPropagationStopped())break e;Pc(X,Et,yn),le=Ft}}}if(Dr)throw d=_i,Dr=!1,_i=null,d}function Co(d,g){var E=g[qa];E===void 0&&(E=g[qa]=new Set);var N=d+"__bubble";E.has(N)||(lc(g,d,2,!1),E.add(N))}function Vh(d,g,E){var N=0;g&&(N|=4),lc(E,d,N,g)}var kc="_reactListening"+Math.random().toString(36).slice(2);function Vi(d){if(!d[kc]){d[kc]=!0,i.forEach(function(E){E!=="selectionchange"&&(rl.has(E)||Vh(E,!1,d),Vh(E,!0,d))});var g=d.nodeType===9?d:d.ownerDocument;g===null||g[kc]||(g[kc]=!0,Vh("selectionchange",!1,g))}}function lc(d,g,E,N){switch(qs(g)){case 1:var X=Bo;break;case 4:X=Al;break;default:X=Ma}E=X.bind(null,g,E,d),X=void 0,!Bn||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(X=!0),N?X!==void 0?d.addEventListener(g,E,{capture:!0,passive:X}):d.addEventListener(g,E,!0):X!==void 0?d.addEventListener(g,E,{passive:X}):d.addEventListener(g,E,!1)}function cc(d,g,E,N,X){var le=N;if((g&1)===0&&(g&2)===0&&N!==null)e:for(;;){if(N===null)return;var ze=N.tag;if(ze===3||ze===4){var Et=N.stateNode.containerInfo;if(Et===X||Et.nodeType===8&&Et.parentNode===X)break;if(ze===4)for(ze=N.return;ze!==null;){var Ft=ze.tag;if((Ft===3||Ft===4)&&(Ft=ze.stateNode.containerInfo,Ft===X||Ft.nodeType===8&&Ft.parentNode===X))return;ze=ze.return}for(;Et!==null;){if(ze=Fa(Et),ze===null)return;if(Ft=ze.tag,Ft===5||Ft===6){N=le=ze;continue e}Et=Et.parentNode}}N=N.return}Mt(function(){var yn=le,Jn=ii(E),rr=[];e:{var Vn=Or.get(d);if(Vn!==void 0){var Zr=Vl,li=d;switch(d){case"keypress":if(Es(E)===0)break e;case"keydown":case"keyup":Zr=re;break;case"focusin":li="focus",Zr=xi;break;case"focusout":li="blur",Zr=xi;break;case"beforeblur":case"afterblur":Zr=xi;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Zr=Dn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Zr=$r;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Zr=nn;break;case Ai:case Ra:case Hl:Zr=lo;break;case ca:Zr=mo;break;case"scroll":Zr=Le;break;case"wheel":Zr=Hi;break;case"copy":case"cut":case"paste":Zr=eo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Zr=$e}var di=(g&4)!==0,bl=!di&&d==="scroll",cn=di?Vn!==null?Vn+"Capture":null:Vn;di=[];for(var Gt=yn,mn;Gt!==null;){mn=Gt;var fr=mn.stateNode;if(mn.tag===5&&fr!==null&&(mn=fr,cn!==null&&(fr=vn(Gt,cn),fr!=null&&di.push(or(Gt,fr,mn)))),bl)break;Gt=Gt.return}0<di.length&&(Vn=new Zr(Vn,li,null,E,Jn),rr.push({event:Vn,listeners:di}))}}if((g&7)===0){e:{if(Vn=d==="mouseover"||d==="pointerover",Zr=d==="mouseout"||d==="pointerout",Vn&&E!==ui&&(li=E.relatedTarget||E.fromElement)&&(Fa(li)||li[_a]))break e;if((Zr||Vn)&&(Vn=Jn.window===Jn?Jn:(Vn=Jn.ownerDocument)?Vn.defaultView||Vn.parentWindow:window,Zr?(li=E.relatedTarget||E.toElement,Zr=yn,li=li?Fa(li):null,li!==null&&(bl=Ji(li),li!==bl||li.tag!==5&&li.tag!==6)&&(li=null)):(Zr=null,li=yn),Zr!==li)){if(di=Dn,fr="onMouseLeave",cn="onMouseEnter",Gt="mouse",(d==="pointerout"||d==="pointerover")&&(di=$e,fr="onPointerLeave",cn="onPointerEnter",Gt="pointer"),bl=Zr==null?Vn:eh(Zr),mn=li==null?Vn:eh(li),Vn=new di(fr,Gt+"leave",Zr,E,Jn),Vn.target=bl,Vn.relatedTarget=mn,fr=null,Fa(Jn)===yn&&(di=new di(cn,Gt+"enter",li,E,Jn),di.target=mn,di.relatedTarget=bl,fr=di),bl=fr,Zr&&li)t:{for(di=Zr,cn=li,Gt=0,mn=di;mn;mn=Cu(mn))Gt++;for(mn=0,fr=cn;fr;fr=Cu(fr))mn++;for(;0<Gt-mn;)di=Cu(di),Gt--;for(;0<mn-Gt;)cn=Cu(cn),mn--;for(;Gt--;){if(di===cn||cn!==null&&di===cn.alternate)break t;di=Cu(di),cn=Cu(cn)}di=null}else di=null;Zr!==null&&Lu(rr,Vn,Zr,di,!1),li!==null&&bl!==null&&Lu(rr,bl,li,di,!0)}}e:{if(Vn=yn?eh(yn):window,Zr=Vn.nodeName&&Vn.nodeName.toLowerCase(),Zr==="select"||Zr==="input"&&Vn.type==="file")var fi=Cc;else if(Uo(Vn))if(ql)fi=$l;else{fi=uu;var Pi=Jc}else(Zr=Vn.nodeName)&&Zr.toLowerCase()==="input"&&(Vn.type==="checkbox"||Vn.type==="radio")&&(fi=Qc);if(fi&&(fi=fi(d,yn))){au(rr,fi,E,Jn);break e}Pi&&Pi(d,Vn,yn),d==="focusout"&&(Pi=Vn._wrapperState)&&Pi.controlled&&Vn.type==="number"&&Tn(Vn,"number",Vn.value)}switch(Pi=yn?eh(yn):window,d){case"focusin":(Uo(Pi)||Pi.contentEditable==="true")&&(hu=Pi,ac=yn,nl=null);break;case"focusout":nl=ac=hu=null;break;case"mousedown":Ur=!0;break;case"contextmenu":case"mouseup":case"dragend":Ur=!1,Wl(rr,E,Jn);break;case"selectionchange":if(Il)break;case"keydown":case"keyup":Wl(rr,E,Jn)}var ki;if(xo)e:{switch(d){case"compositionstart":var no="onCompositionStart";break e;case"compositionend":no="onCompositionEnd";break e;case"compositionupdate":no="onCompositionUpdate";break e}no=void 0}else Qa?Xc(d,E)&&(no="onCompositionEnd"):d==="keydown"&&E.keyCode===229&&(no="onCompositionStart");no&&(Rs&&E.locale!=="ko"&&(Qa||no!=="onCompositionStart"?no==="onCompositionEnd"&&Qa&&(ki=qo()):($s=Jn,si="value"in $s?$s.value:$s.textContent,Qa=!0)),Pi=go(yn,no),0<Pi.length&&(no=new Go(no,d,null,E,Jn),rr.push({event:no,listeners:Pi}),ki?no.data=ki:(ki=ml(E),ki!==null&&(no.data=ki)))),(ki=pa?ma(d,E):Xs(d,E))&&(yn=go(yn,"onBeforeInput"),0<yn.length&&(Jn=new Go("onBeforeInput","beforeinput",null,E,Jn),rr.push({event:Jn,listeners:yn}),Jn.data=ki))}Aa(rr,g)})}function or(d,g,E){return{instance:d,listener:g,currentTarget:E}}function go(d,g){for(var E=g+"Capture",N=[];d!==null;){var X=d,le=X.stateNode;X.tag===5&&le!==null&&(X=le,le=vn(d,E),le!=null&&N.unshift(or(d,le,X)),le=vn(d,g),le!=null&&N.push(or(d,le,X))),d=d.return}return N}function Cu(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function Lu(d,g,E,N,X){for(var le=g._reactName,ze=[];E!==null&&E!==N;){var Et=E,Ft=Et.alternate,yn=Et.stateNode;if(Ft!==null&&Ft===N)break;Et.tag===5&&yn!==null&&(Et=yn,X?(Ft=vn(E,le),Ft!=null&&ze.unshift(or(E,Ft,Et))):X||(Ft=vn(E,le),Ft!=null&&ze.push(or(E,Ft,Et)))),E=E.return}ze.length!==0&&d.push({event:g,listeners:ze})}var qh=/\r\n?/g,ya=/\u0000|\uFFFD/g;function Na(d){return(typeof d=="string"?d:""+d).replace(qh,`
`).replace(ya,"")}function Mc(d,g,E){if(g=Na(g),Na(d)!==g&&E)throw Error(t(425))}function Yu(){}var tu=null,gl=null;function Ju(d,g){return d==="textarea"||d==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var pu=typeof setTimeout=="function"?setTimeout:void 0,Ch=typeof clearTimeout=="function"?clearTimeout:void 0,Qu=typeof Promise=="function"?Promise:void 0,Qd=typeof queueMicrotask=="function"?queueMicrotask:typeof Qu<"u"?function(d){return Qu.resolve(null).then(d).catch(xh)}:pu;function xh(d){setTimeout(function(){throw d})}function Lh(d,g){var E=g,N=0;do{var X=E.nextSibling;if(d.removeChild(E),X&&X.nodeType===8)if(E=X.data,E==="/$"){if(N===0){d.removeChild(X),Oo(g);return}N--}else E!=="$"&&E!=="$?"&&E!=="$!"||N++;E=X}while(E);Oo(g)}function Ta(d){for(;d!=null;d=d.nextSibling){var g=d.nodeType;if(g===1||g===3)break;if(g===8){if(g=d.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return d}function Da(d){d=d.previousSibling;for(var g=0;d;){if(d.nodeType===8){var E=d.data;if(E==="$"||E==="$!"||E==="$?"){if(g===0)return d;g--}else E==="/$"&&g++}d=d.previousSibling}return null}var Va=Math.random().toString(36).slice(2),yl="__reactFiber$"+Va,uc="__reactProps$"+Va,_a="__reactContainer$"+Va,qa="__reactEvents$"+Va,od="__reactListeners$"+Va,Id="__reactHandles$"+Va;function Fa(d){var g=d[yl];if(g)return g;for(var E=d.parentNode;E;){if(g=E[_a]||E[yl]){if(E=g.alternate,g.child!==null||E!==null&&E.child!==null)for(d=Da(d);d!==null;){if(E=d[yl])return E;d=Da(d)}return g}d=E,E=d.parentNode}return null}function Rc(d){return d=d[yl]||d[_a],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function eh(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(t(33))}function Ph(d){return d[uc]||null}var $h=[],nu=-1;function Nc(d){return{current:d}}function Lo(d){0>nu||(d.current=$h[nu],$h[nu]=null,nu--)}function Xi(d,g){nu++,$h[nu]=d.current,d.current=g}var Ll={},va=Nc(Ll),Is=Nc(!1),Xl=Ll;function $a(d,g){var E=d.type.contextTypes;if(!E)return Ll;var N=d.stateNode;if(N&&N.__reactInternalMemoizedUnmaskedChildContext===g)return N.__reactInternalMemoizedMaskedChildContext;var X={},le;for(le in E)X[le]=g[le];return N&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=g,d.__reactInternalMemoizedMaskedChildContext=X),X}function Pl(d){return d=d.childContextTypes,d!=null}function sd(){Lo(Is),Lo(va)}function Ga(d,g,E){if(va.current!==Ll)throw Error(t(168));Xi(va,g),Xi(Is,E)}function Dc(d,g,E){var N=d.stateNode;if(g=g.childContextTypes,typeof N.getChildContext!="function")return E;N=N.getChildContext();for(var X in N)if(!(X in g))throw Error(t(108,mt(d)||"Unknown",X));return Qe({},E,N)}function Ia(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||Ll,Xl=va.current,Xi(va,d),Xi(Is,Is.current),!0}function bh(d,g,E){var N=d.stateNode;if(!N)throw Error(t(169));E?(d=Dc(d,g,Xl),N.__reactInternalMemoizedMergedChildContext=d,Lo(Is),Lo(va),Xi(va,d)):Lo(Is),Xi(Is,E)}var sr=null,kh=!1,C=!1;function F(d){sr===null?sr=[d]:sr.push(d)}function Y(d){kh=!0,F(d)}function ie(){if(!C&&sr!==null){C=!0;var d=0,g=zi;try{var E=sr;for(zi=1;d<E.length;d++){var N=E[d];do N=N(!0);while(N!==null)}sr=null,kh=!1}catch(X){throw sr!==null&&(sr=sr.slice(d+1)),jl(Pa,ie),X}finally{zi=g,C=!1}}return null}var Ce=[],Be=0,qe=null,Ke=0,Je=[],dt=0,Dt=null,Qt=1,ft="";function Ot(d,g){Ce[Be++]=Ke,Ce[Be++]=qe,qe=d,Ke=g}function Kt(d,g,E){Je[dt++]=Qt,Je[dt++]=ft,Je[dt++]=Dt,Dt=d;var N=Qt;d=ft;var X=32-ss(N)-1;N&=~(1<<X),E+=1;var le=32-ss(g)+X;if(30<le){var ze=X-X%5;le=(N&(1<<ze)-1).toString(32),N>>=ze,X-=ze,Qt=1<<32-ss(g)+X|E<<X|N,ft=le+d}else Qt=1<<le|E<<X|N,ft=d}function Sn(d){d.return!==null&&(Ot(d,1),Kt(d,1,0))}function y(d){for(;d===qe;)qe=Ce[--Be],Ce[Be]=null,Ke=Ce[--Be],Ce[Be]=null;for(;d===Dt;)Dt=Je[--dt],Je[dt]=null,ft=Je[--dt],Je[dt]=null,Qt=Je[--dt],Je[dt]=null}var a=null,f=null,v=!1,S=null;function T(d,g){var E=jc(5,null,null,0);E.elementType="DELETED",E.stateNode=g,E.return=d,g=d.deletions,g===null?(d.deletions=[E],d.flags|=16):g.push(E)}function R(d,g){switch(d.tag){case 5:var E=d.type;return g=g.nodeType!==1||E.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(d.stateNode=g,a=d,f=Ta(g.firstChild),!0):!1;case 6:return g=d.pendingProps===""||g.nodeType!==3?null:g,g!==null?(d.stateNode=g,a=d,f=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(E=Dt!==null?{id:Qt,overflow:ft}:null,d.memoizedState={dehydrated:g,treeContext:E,retryLane:1073741824},E=jc(18,null,null,0),E.stateNode=g,E.return=d,d.child=E,a=d,f=null,!0):!1;default:return!1}}function B(d){return(d.mode&1)!==0&&(d.flags&128)===0}function G(d){if(v){var g=f;if(g){var E=g;if(!R(d,g)){if(B(d))throw Error(t(418));g=Ta(E.nextSibling);var N=a;g&&R(d,g)?T(N,E):(d.flags=d.flags&-4097|2,v=!1,a=d)}}else{if(B(d))throw Error(t(418));d.flags=d.flags&-4097|2,v=!1,a=d}}}function J(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;a=d}function ee(d){if(d!==a)return!1;if(!v)return J(d),v=!0,!1;var g;if((g=d.tag!==3)&&!(g=d.tag!==5)&&(g=d.type,g=g!=="head"&&g!=="body"&&!Ju(d.type,d.memoizedProps)),g&&(g=f)){if(B(d))throw me(),Error(t(418));for(;g;)T(d,g),g=Ta(g.nextSibling)}if(J(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(t(317));e:{for(d=d.nextSibling,g=0;d;){if(d.nodeType===8){var E=d.data;if(E==="/$"){if(g===0){f=Ta(d.nextSibling);break e}g--}else E!=="$"&&E!=="$!"&&E!=="$?"||g++}d=d.nextSibling}f=null}}else f=a?Ta(d.stateNode.nextSibling):null;return!0}function me(){for(var d=f;d;)d=Ta(d.nextSibling)}function Ae(){f=a=null,v=!1}function Te(d){S===null?S=[d]:S.push(d)}var He=he.ReactCurrentBatchConfig;function je(d,g,E){if(d=E.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(E._owner){if(E=E._owner,E){if(E.tag!==1)throw Error(t(309));var N=E.stateNode}if(!N)throw Error(t(147,d));var X=N,le=""+d;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===le?g.ref:(g=function(ze){var Et=X.refs;ze===null?delete Et[le]:Et[le]=ze},g._stringRef=le,g)}if(typeof d!="string")throw Error(t(284));if(!E._owner)throw Error(t(290,d))}return d}function We(d,g){throw d=Object.prototype.toString.call(g),Error(t(31,d==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":d))}function ve(d){var g=d._init;return g(d._payload)}function Ue(d){function g(cn,Gt){if(d){var mn=cn.deletions;mn===null?(cn.deletions=[Gt],cn.flags|=16):mn.push(Gt)}}function E(cn,Gt){if(!d)return null;for(;Gt!==null;)g(cn,Gt),Gt=Gt.sibling;return null}function N(cn,Gt){for(cn=new Map;Gt!==null;)Gt.key!==null?cn.set(Gt.key,Gt):cn.set(Gt.index,Gt),Gt=Gt.sibling;return cn}function X(cn,Gt){return cn=cf(cn,Gt),cn.index=0,cn.sibling=null,cn}function le(cn,Gt,mn){return cn.index=mn,d?(mn=cn.alternate,mn!==null?(mn=mn.index,mn<Gt?(cn.flags|=2,Gt):mn):(cn.flags|=2,Gt)):(cn.flags|=1048576,Gt)}function ze(cn){return d&&cn.alternate===null&&(cn.flags|=2),cn}function Et(cn,Gt,mn,fr){return Gt===null||Gt.tag!==6?(Gt=z0(mn,cn.mode,fr),Gt.return=cn,Gt):(Gt=X(Gt,mn),Gt.return=cn,Gt)}function Ft(cn,Gt,mn,fr){var fi=mn.type;return fi===de?Jn(cn,Gt,mn.props.children,fr,mn.key):Gt!==null&&(Gt.elementType===fi||typeof fi=="object"&&fi!==null&&fi.$$typeof===Oe&&ve(fi)===Gt.type)?(fr=X(Gt,mn.props),fr.ref=je(cn,Gt,mn),fr.return=cn,fr):(fr=dg(mn.type,mn.key,mn.props,null,cn.mode,fr),fr.ref=je(cn,Gt,mn),fr.return=cn,fr)}function yn(cn,Gt,mn,fr){return Gt===null||Gt.tag!==4||Gt.stateNode.containerInfo!==mn.containerInfo||Gt.stateNode.implementation!==mn.implementation?(Gt=j0(mn,cn.mode,fr),Gt.return=cn,Gt):(Gt=X(Gt,mn.children||[]),Gt.return=cn,Gt)}function Jn(cn,Gt,mn,fr,fi){return Gt===null||Gt.tag!==7?(Gt=Wf(mn,cn.mode,fr,fi),Gt.return=cn,Gt):(Gt=X(Gt,mn),Gt.return=cn,Gt)}function rr(cn,Gt,mn){if(typeof Gt=="string"&&Gt!==""||typeof Gt=="number")return Gt=z0(""+Gt,cn.mode,mn),Gt.return=cn,Gt;if(typeof Gt=="object"&&Gt!==null){switch(Gt.$$typeof){case Ne:return mn=dg(Gt.type,Gt.key,Gt.props,null,cn.mode,mn),mn.ref=je(cn,null,Gt),mn.return=cn,mn;case Ve:return Gt=j0(Gt,cn.mode,mn),Gt.return=cn,Gt;case Oe:var fr=Gt._init;return rr(cn,fr(Gt._payload),mn)}if(Yn(Gt)||De(Gt))return Gt=Wf(Gt,cn.mode,mn,null),Gt.return=cn,Gt;We(cn,Gt)}return null}function Vn(cn,Gt,mn,fr){var fi=Gt!==null?Gt.key:null;if(typeof mn=="string"&&mn!==""||typeof mn=="number")return fi!==null?null:Et(cn,Gt,""+mn,fr);if(typeof mn=="object"&&mn!==null){switch(mn.$$typeof){case Ne:return mn.key===fi?Ft(cn,Gt,mn,fr):null;case Ve:return mn.key===fi?yn(cn,Gt,mn,fr):null;case Oe:return fi=mn._init,Vn(cn,Gt,fi(mn._payload),fr)}if(Yn(mn)||De(mn))return fi!==null?null:Jn(cn,Gt,mn,fr,null);We(cn,mn)}return null}function Zr(cn,Gt,mn,fr,fi){if(typeof fr=="string"&&fr!==""||typeof fr=="number")return cn=cn.get(mn)||null,Et(Gt,cn,""+fr,fi);if(typeof fr=="object"&&fr!==null){switch(fr.$$typeof){case Ne:return cn=cn.get(fr.key===null?mn:fr.key)||null,Ft(Gt,cn,fr,fi);case Ve:return cn=cn.get(fr.key===null?mn:fr.key)||null,yn(Gt,cn,fr,fi);case Oe:var Pi=fr._init;return Zr(cn,Gt,mn,Pi(fr._payload),fi)}if(Yn(fr)||De(fr))return cn=cn.get(mn)||null,Jn(Gt,cn,fr,fi,null);We(Gt,fr)}return null}function li(cn,Gt,mn,fr){for(var fi=null,Pi=null,ki=Gt,no=Gt=0,Uc=null;ki!==null&&no<mn.length;no++){ki.index>no?(Uc=ki,ki=null):Uc=ki.sibling;var Xo=Vn(cn,ki,mn[no],fr);if(Xo===null){ki===null&&(ki=Uc);break}d&&ki&&Xo.alternate===null&&g(cn,ki),Gt=le(Xo,Gt,no),Pi===null?fi=Xo:Pi.sibling=Xo,Pi=Xo,ki=Uc}if(no===mn.length)return E(cn,ki),v&&Ot(cn,no),fi;if(ki===null){for(;no<mn.length;no++)ki=rr(cn,mn[no],fr),ki!==null&&(Gt=le(ki,Gt,no),Pi===null?fi=ki:Pi.sibling=ki,Pi=ki);return v&&Ot(cn,no),fi}for(ki=N(cn,ki);no<mn.length;no++)Uc=Zr(ki,cn,no,mn[no],fr),Uc!==null&&(d&&Uc.alternate!==null&&ki.delete(Uc.key===null?no:Uc.key),Gt=le(Uc,Gt,no),Pi===null?fi=Uc:Pi.sibling=Uc,Pi=Uc);return d&&ki.forEach(function(Dh){return g(cn,Dh)}),v&&Ot(cn,no),fi}function di(cn,Gt,mn,fr){var fi=De(mn);if(typeof fi!="function")throw Error(t(150));if(mn=fi.call(mn),mn==null)throw Error(t(151));for(var Pi=fi=null,ki=Gt,no=Gt=0,Uc=null,Xo=mn.next();ki!==null&&!Xo.done;no++,Xo=mn.next()){ki.index>no?(Uc=ki,ki=null):Uc=ki.sibling;var Dh=Vn(cn,ki,Xo.value,fr);if(Dh===null){ki===null&&(ki=Uc);break}d&&ki&&Dh.alternate===null&&g(cn,ki),Gt=le(Dh,Gt,no),Pi===null?fi=Dh:Pi.sibling=Dh,Pi=Dh,ki=Uc}if(Xo.done)return E(cn,ki),v&&Ot(cn,no),fi;if(ki===null){for(;!Xo.done;no++,Xo=mn.next())Xo=rr(cn,Xo.value,fr),Xo!==null&&(Gt=le(Xo,Gt,no),Pi===null?fi=Xo:Pi.sibling=Xo,Pi=Xo);return v&&Ot(cn,no),fi}for(ki=N(cn,ki);!Xo.done;no++,Xo=mn.next())Xo=Zr(ki,cn,no,Xo.value,fr),Xo!==null&&(d&&Xo.alternate!==null&&ki.delete(Xo.key===null?no:Xo.key),Gt=le(Xo,Gt,no),Pi===null?fi=Xo:Pi.sibling=Xo,Pi=Xo);return d&&ki.forEach(function(P_){return g(cn,P_)}),v&&Ot(cn,no),fi}function bl(cn,Gt,mn,fr){if(typeof mn=="object"&&mn!==null&&mn.type===de&&mn.key===null&&(mn=mn.props.children),typeof mn=="object"&&mn!==null){switch(mn.$$typeof){case Ne:e:{for(var fi=mn.key,Pi=Gt;Pi!==null;){if(Pi.key===fi){if(fi=mn.type,fi===de){if(Pi.tag===7){E(cn,Pi.sibling),Gt=X(Pi,mn.props.children),Gt.return=cn,cn=Gt;break e}}else if(Pi.elementType===fi||typeof fi=="object"&&fi!==null&&fi.$$typeof===Oe&&ve(fi)===Pi.type){E(cn,Pi.sibling),Gt=X(Pi,mn.props),Gt.ref=je(cn,Pi,mn),Gt.return=cn,cn=Gt;break e}E(cn,Pi);break}else g(cn,Pi);Pi=Pi.sibling}mn.type===de?(Gt=Wf(mn.props.children,cn.mode,fr,mn.key),Gt.return=cn,cn=Gt):(fr=dg(mn.type,mn.key,mn.props,null,cn.mode,fr),fr.ref=je(cn,Gt,mn),fr.return=cn,cn=fr)}return ze(cn);case Ve:e:{for(Pi=mn.key;Gt!==null;){if(Gt.key===Pi)if(Gt.tag===4&&Gt.stateNode.containerInfo===mn.containerInfo&&Gt.stateNode.implementation===mn.implementation){E(cn,Gt.sibling),Gt=X(Gt,mn.children||[]),Gt.return=cn,cn=Gt;break e}else{E(cn,Gt);break}else g(cn,Gt);Gt=Gt.sibling}Gt=j0(mn,cn.mode,fr),Gt.return=cn,cn=Gt}return ze(cn);case Oe:return Pi=mn._init,bl(cn,Gt,Pi(mn._payload),fr)}if(Yn(mn))return li(cn,Gt,mn,fr);if(De(mn))return di(cn,Gt,mn,fr);We(cn,mn)}return typeof mn=="string"&&mn!==""||typeof mn=="number"?(mn=""+mn,Gt!==null&&Gt.tag===6?(E(cn,Gt.sibling),Gt=X(Gt,mn),Gt.return=cn,cn=Gt):(E(cn,Gt),Gt=z0(mn,cn.mode,fr),Gt.return=cn,cn=Gt),ze(cn)):E(cn,Gt)}return bl}var rt=Ue(!0),st=Ue(!1),bt=Nc(null),wt=null,vt=null,At=null;function kt(){At=vt=wt=null}function Vt(d){var g=bt.current;Lo(bt),d._currentValue=g}function gn(d,g,E){for(;d!==null;){var N=d.alternate;if((d.childLanes&g)!==g?(d.childLanes|=g,N!==null&&(N.childLanes|=g)):N!==null&&(N.childLanes&g)!==g&&(N.childLanes|=g),d===E)break;d=d.return}}function Ut(d,g){wt=d,At=vt=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&g)!==0&&(hn=!0),d.firstContext=null)}function un(d){var g=d._currentValue;if(At!==d)if(d={context:d,memoizedValue:g,next:null},vt===null){if(wt===null)throw Error(t(308));vt=d,wt.dependencies={lanes:0,firstContext:d}}else vt=vt.next=d;return g}var $t=null;function In(d){$t===null?$t=[d]:$t.push(d)}function jt(d,g,E,N){var X=g.interleaved;return X===null?(E.next=E,In(g)):(E.next=X.next,X.next=E),g.interleaved=E,sn(d,N)}function sn(d,g){d.lanes|=g;var E=d.alternate;for(E!==null&&(E.lanes|=g),E=d,d=d.return;d!==null;)d.childLanes|=g,E=d.alternate,E!==null&&(E.childLanes|=g),E=d,d=d.return;return E.tag===3?E.stateNode:null}var Cn=!1;function _n(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Mn(d,g){d=d.updateQueue,g.updateQueue===d&&(g.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function cr(d,g){return{eventTime:d,lane:g,tag:0,payload:null,callback:null,next:null}}function kr(d,g,E){var N=d.updateQueue;if(N===null)return null;if(N=N.shared,(ai&2)!==0){var X=N.pending;return X===null?g.next=g:(g.next=X.next,X.next=g),N.pending=g,sn(d,E)}return X=N.interleaved,X===null?(g.next=g,In(N)):(g.next=X.next,X.next=g),N.interleaved=g,sn(d,E)}function er(d,g,E){if(g=g.updateQueue,g!==null&&(g=g.shared,(E&4194240)!==0)){var N=g.lanes;N&=d.pendingLanes,E|=N,g.lanes=E,dl(d,E)}}function ar(d,g){var E=d.updateQueue,N=d.alternate;if(N!==null&&(N=N.updateQueue,E===N)){var X=null,le=null;if(E=E.firstBaseUpdate,E!==null){do{var ze={eventTime:E.eventTime,lane:E.lane,tag:E.tag,payload:E.payload,callback:E.callback,next:null};le===null?X=le=ze:le=le.next=ze,E=E.next}while(E!==null);le===null?X=le=g:le=le.next=g}else X=le=g;E={baseState:N.baseState,firstBaseUpdate:X,lastBaseUpdate:le,shared:N.shared,effects:N.effects},d.updateQueue=E;return}d=E.lastBaseUpdate,d===null?E.firstBaseUpdate=g:d.next=g,E.lastBaseUpdate=g}function Wr(d,g,E,N){var X=d.updateQueue;Cn=!1;var le=X.firstBaseUpdate,ze=X.lastBaseUpdate,Et=X.shared.pending;if(Et!==null){X.shared.pending=null;var Ft=Et,yn=Ft.next;Ft.next=null,ze===null?le=yn:ze.next=yn,ze=Ft;var Jn=d.alternate;Jn!==null&&(Jn=Jn.updateQueue,Et=Jn.lastBaseUpdate,Et!==ze&&(Et===null?Jn.firstBaseUpdate=yn:Et.next=yn,Jn.lastBaseUpdate=Ft))}if(le!==null){var rr=X.baseState;ze=0,Jn=yn=Ft=null,Et=le;do{var Vn=Et.lane,Zr=Et.eventTime;if((N&Vn)===Vn){Jn!==null&&(Jn=Jn.next={eventTime:Zr,lane:0,tag:Et.tag,payload:Et.payload,callback:Et.callback,next:null});e:{var li=d,di=Et;switch(Vn=g,Zr=E,di.tag){case 1:if(li=di.payload,typeof li=="function"){rr=li.call(Zr,rr,Vn);break e}rr=li;break e;case 3:li.flags=li.flags&-65537|128;case 0:if(li=di.payload,Vn=typeof li=="function"?li.call(Zr,rr,Vn):li,Vn==null)break e;rr=Qe({},rr,Vn);break e;case 2:Cn=!0}}Et.callback!==null&&Et.lane!==0&&(d.flags|=64,Vn=X.effects,Vn===null?X.effects=[Et]:Vn.push(Et))}else Zr={eventTime:Zr,lane:Vn,tag:Et.tag,payload:Et.payload,callback:Et.callback,next:null},Jn===null?(yn=Jn=Zr,Ft=rr):Jn=Jn.next=Zr,ze|=Vn;if(Et=Et.next,Et===null){if(Et=X.shared.pending,Et===null)break;Vn=Et,Et=Vn.next,Vn.next=null,X.lastBaseUpdate=Vn,X.shared.pending=null}}while(!0);if(Jn===null&&(Ft=rr),X.baseState=Ft,X.firstBaseUpdate=yn,X.lastBaseUpdate=Jn,g=X.shared.interleaved,g!==null){X=g;do ze|=X.lane,X=X.next;while(X!==g)}else le===null&&(X.shared.lanes=0);Ha|=ze,d.lanes=ze,d.memoizedState=rr}}function hi(d,g,E){if(d=g.effects,g.effects=null,d!==null)for(g=0;g<d.length;g++){var N=d[g],X=N.callback;if(X!==null){if(N.callback=null,N=E,typeof X!="function")throw Error(t(191,X));X.call(N)}}}var _r={},Ti=Nc(_r),Ii=Nc(_r),yo=Nc(_r);function co(d){if(d===_r)throw Error(t(174));return d}function Js(d,g){switch(Xi(yo,g),Xi(Ii,d),Xi(Ti,_r),d=g.nodeType,d){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:Rr(null,"");break;default:d=d===8?g.parentNode:g,g=d.namespaceURI||null,d=d.tagName,g=Rr(g,d)}Lo(Ti),Xi(Ti,g)}function ps(){Lo(Ti),Lo(Ii),Lo(yo)}function il(d){co(yo.current);var g=co(Ti.current),E=Rr(g,d.type);g!==E&&(Xi(Ii,d),Xi(Ti,E))}function Wa(d){Ii.current===d&&(Lo(Ti),Lo(Ii))}var Si=Nc(0);function Ki(d){for(var g=d;g!==null;){if(g.tag===13){var E=g.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||E.data==="$?"||E.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===d)break;for(;g.sibling===null;){if(g.return===null||g.return===d)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var to=[];function Qs(){for(var d=0;d<to.length;d++)to[d]._workInProgressVersionPrimary=null;to.length=0}var ua=he.ReactCurrentDispatcher,Wo=he.ReactCurrentBatchConfig,vs=0,Fo=null,xs=null,Cs=null,Kl=!1,ol=!1,hc=0,ad=0;function ea(){throw Error(t(321))}function wh(d,g){if(g===null)return!1;for(var E=0;E<g.length&&E<d.length;E++)if(!ns(d[E],g[E]))return!1;return!0}function ld(d,g,E,N,X,le){if(vs=le,Fo=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,ua.current=d===null||d.memoizedState===null?bn:rn,d=E(N,X),ol){le=0;do{if(ol=!1,hc=0,25<=le)throw Error(t(301));le+=1,Cs=xs=null,g.updateQueue=null,ua.current=Zt,d=E(N,X)}while(ol)}if(ua.current=Yt,g=xs!==null&&xs.next!==null,vs=0,Cs=xs=Fo=null,Kl=!1,g)throw Error(t(300));return d}function Pu(){var d=hc!==0;return hc=0,d}function ku(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Cs===null?Fo.memoizedState=Cs=d:Cs=Cs.next=d,Cs}function dc(){if(xs===null){var d=Fo.alternate;d=d!==null?d.memoizedState:null}else d=xs.next;var g=Cs===null?Fo.memoizedState:Cs.next;if(g!==null)Cs=g,xs=d;else{if(d===null)throw Error(t(310));xs=d,d={memoizedState:xs.memoizedState,baseState:xs.baseState,baseQueue:xs.baseQueue,queue:xs.queue,next:null},Cs===null?Fo.memoizedState=Cs=d:Cs=Cs.next=d}return Cs}function mu(d,g){return typeof g=="function"?g(d):g}function cd(d){var g=dc(),E=g.queue;if(E===null)throw Error(t(311));E.lastRenderedReducer=d;var N=xs,X=N.baseQueue,le=E.pending;if(le!==null){if(X!==null){var ze=X.next;X.next=le.next,le.next=ze}N.baseQueue=X=le,E.pending=null}if(X!==null){le=X.next,N=N.baseState;var Et=ze=null,Ft=null,yn=le;do{var Jn=yn.lane;if((vs&Jn)===Jn)Ft!==null&&(Ft=Ft.next={lane:0,action:yn.action,hasEagerState:yn.hasEagerState,eagerState:yn.eagerState,next:null}),N=yn.hasEagerState?yn.eagerState:d(N,yn.action);else{var rr={lane:Jn,action:yn.action,hasEagerState:yn.hasEagerState,eagerState:yn.eagerState,next:null};Ft===null?(Et=Ft=rr,ze=N):Ft=Ft.next=rr,Fo.lanes|=Jn,Ha|=Jn}yn=yn.next}while(yn!==null&&yn!==le);Ft===null?ze=N:Ft.next=Et,ns(N,g.memoizedState)||(hn=!0),g.memoizedState=N,g.baseState=ze,g.baseQueue=Ft,E.lastRenderedState=N}if(d=E.interleaved,d!==null){X=d;do le=X.lane,Fo.lanes|=le,Ha|=le,X=X.next;while(X!==d)}else X===null&&(E.lanes=0);return[g.memoizedState,E.dispatch]}function Mu(d){var g=dc(),E=g.queue;if(E===null)throw Error(t(311));E.lastRenderedReducer=d;var N=E.dispatch,X=E.pending,le=g.memoizedState;if(X!==null){E.pending=null;var ze=X=X.next;do le=d(le,ze.action),ze=ze.next;while(ze!==X);ns(le,g.memoizedState)||(hn=!0),g.memoizedState=le,g.baseQueue===null&&(g.baseState=le),E.lastRenderedState=le}return[le,N]}function ud(){}function Ru(d,g){var E=Fo,N=dc(),X=g(),le=!ns(N.memoizedState,X);if(le&&(N.memoizedState=X,hn=!0),N=N.queue,mc(Of.bind(null,E,N,d),[d]),N.getSnapshot!==g||le||Cs!==null&&Cs.memoizedState.tag&1){if(E.flags|=2048,fc(9,Ld.bind(null,E,N,X,g),void 0,null),Yl===null)throw Error(t(349));(vs&30)!==0||Cd(E,g,X)}return X}function Cd(d,g,E){d.flags|=16384,d={getSnapshot:g,value:E},g=Fo.updateQueue,g===null?(g={lastEffect:null,stores:null},Fo.updateQueue=g,g.stores=[d]):(E=g.stores,E===null?g.stores=[d]:E.push(d))}function Ld(d,g,E,N){g.value=E,g.getSnapshot=N,Gh(g)&&Mh(d)}function Of(d,g,E){return E(function(){Gh(g)&&Mh(d)})}function Gh(d){var g=d.getSnapshot;d=d.value;try{var E=g();return!ns(d,E)}catch{return!0}}function Mh(d){var g=sn(d,1);g!==null&&Zh(g,d,1,-1)}function Pd(d){var g=ku();return typeof d=="function"&&(d=d()),g.memoizedState=g.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:mu,lastRenderedState:d},g.queue=d,d=d.dispatch=Lt.bind(null,Fo,d),[g.memoizedState,d]}function fc(d,g,E,N){return d={tag:d,create:g,destroy:E,deps:N,next:null},g=Fo.updateQueue,g===null?(g={lastEffect:null,stores:null},Fo.updateQueue=g,g.lastEffect=d.next=d):(E=g.lastEffect,E===null?g.lastEffect=d.next=d:(N=E.next,E.next=d,d.next=N,g.lastEffect=d)),d}function Fc(){return dc().memoizedState}function Zl(d,g,E,N){var X=ku();Fo.flags|=d,X.memoizedState=fc(1|g,E,void 0,N===void 0?null:N)}function pc(d,g,E,N){var X=dc();N=N===void 0?null:N;var le=void 0;if(xs!==null){var ze=xs.memoizedState;if(le=ze.destroy,N!==null&&wh(N,ze.deps)){X.memoizedState=fc(g,E,le,N);return}}Fo.flags|=d,X.memoizedState=fc(1|g,E,le,N)}function Oc(d,g){return Zl(8390656,8,d,g)}function mc(d,g){return pc(2048,8,d,g)}function th(d,g){return pc(4,2,d,g)}function Nu(d,g){return pc(4,4,d,g)}function ef(d,g){if(typeof g=="function")return d=d(),g(d),function(){g(null)};if(g!=null)return d=d(),g.current=d,function(){g.current=null}}function rg(d,g,E){return E=E!=null?E.concat([d]):null,pc(4,4,ef.bind(null,g,d),E)}function U(){}function ge(d,g){var E=dc();g=g===void 0?null:g;var N=E.memoizedState;return N!==null&&g!==null&&wh(g,N[1])?N[0]:(E.memoizedState=[d,g],d)}function Pe(d,g){var E=dc();g=g===void 0?null:g;var N=E.memoizedState;return N!==null&&g!==null&&wh(g,N[1])?N[0]:(d=d(),E.memoizedState=[d,g],d)}function Xe(d,g,E){return(vs&21)===0?(d.baseState&&(d.baseState=!1,hn=!0),d.memoizedState=E):(ns(E,g)||(E=aa(),Fo.lanes|=E,Ha|=E,d.baseState=!0),g)}function nt(d,g){var E=zi;zi=E!==0&&4>E?E:4,d(!0);var N=Wo.transition;Wo.transition={};try{d(!1),g()}finally{zi=E,Wo.transition=N}}function tt(){return dc().memoizedState}function ot(d,g,E){var N=gd(d);if(E={lane:N,action:E,hasEagerState:!1,eagerState:null,next:null},_t(d))gt(g,E);else if(E=jt(d,g,E,N),E!==null){var X=Bu();Zh(E,d,N,X),Ht(E,g,N)}}function Lt(d,g,E){var N=gd(d),X={lane:N,action:E,hasEagerState:!1,eagerState:null,next:null};if(_t(d))gt(g,X);else{var le=d.alternate;if(d.lanes===0&&(le===null||le.lanes===0)&&(le=g.lastRenderedReducer,le!==null))try{var ze=g.lastRenderedState,Et=le(ze,E);if(X.hasEagerState=!0,X.eagerState=Et,ns(Et,ze)){var Ft=g.interleaved;Ft===null?(X.next=X,In(g)):(X.next=Ft.next,Ft.next=X),g.interleaved=X;return}}catch{}finally{}E=jt(d,g,X,N),E!==null&&(X=Bu(),Zh(E,d,N,X),Ht(E,g,N))}}function _t(d){var g=d.alternate;return d===Fo||g!==null&&g===Fo}function gt(d,g){ol=Kl=!0;var E=d.pending;E===null?g.next=g:(g.next=E.next,E.next=g),d.pending=g}function Ht(d,g,E){if((E&4194240)!==0){var N=g.lanes;N&=d.pendingLanes,E|=N,g.lanes=E,dl(d,E)}}var Yt={readContext:un,useCallback:ea,useContext:ea,useEffect:ea,useImperativeHandle:ea,useInsertionEffect:ea,useLayoutEffect:ea,useMemo:ea,useReducer:ea,useRef:ea,useState:ea,useDebugValue:ea,useDeferredValue:ea,useTransition:ea,useMutableSource:ea,useSyncExternalStore:ea,useId:ea,unstable_isNewReconciler:!1},bn={readContext:un,useCallback:function(d,g){return ku().memoizedState=[d,g===void 0?null:g],d},useContext:un,useEffect:Oc,useImperativeHandle:function(d,g,E){return E=E!=null?E.concat([d]):null,Zl(4194308,4,ef.bind(null,g,d),E)},useLayoutEffect:function(d,g){return Zl(4194308,4,d,g)},useInsertionEffect:function(d,g){return Zl(4,2,d,g)},useMemo:function(d,g){var E=ku();return g=g===void 0?null:g,d=d(),E.memoizedState=[d,g],d},useReducer:function(d,g,E){var N=ku();return g=E!==void 0?E(g):g,N.memoizedState=N.baseState=g,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:g},N.queue=d,d=d.dispatch=ot.bind(null,Fo,d),[N.memoizedState,d]},useRef:function(d){var g=ku();return d={current:d},g.memoizedState=d},useState:Pd,useDebugValue:U,useDeferredValue:function(d){return ku().memoizedState=d},useTransition:function(){var d=Pd(!1),g=d[0];return d=nt.bind(null,d[1]),ku().memoizedState=d,[g,d]},useMutableSource:function(){},useSyncExternalStore:function(d,g,E){var N=Fo,X=ku();if(v){if(E===void 0)throw Error(t(407));E=E()}else{if(E=g(),Yl===null)throw Error(t(349));(vs&30)!==0||Cd(N,g,E)}X.memoizedState=E;var le={value:E,getSnapshot:g};return X.queue=le,Oc(Of.bind(null,N,le,d),[d]),N.flags|=2048,fc(9,Ld.bind(null,N,le,E,g),void 0,null),E},useId:function(){var d=ku(),g=Yl.identifierPrefix;if(v){var E=ft,N=Qt;E=(N&~(1<<32-ss(N)-1)).toString(32)+E,g=":"+g+"R"+E,E=hc++,0<E&&(g+="H"+E.toString(32)),g+=":"}else E=ad++,g=":"+g+"r"+E.toString(32)+":";return d.memoizedState=g},unstable_isNewReconciler:!1},rn={readContext:un,useCallback:ge,useContext:un,useEffect:mc,useImperativeHandle:rg,useInsertionEffect:th,useLayoutEffect:Nu,useMemo:Pe,useReducer:cd,useRef:Fc,useState:function(){return cd(mu)},useDebugValue:U,useDeferredValue:function(d){var g=dc();return Xe(g,xs.memoizedState,d)},useTransition:function(){var d=cd(mu)[0],g=dc().memoizedState;return[d,g]},useMutableSource:ud,useSyncExternalStore:Ru,useId:tt,unstable_isNewReconciler:!1},Zt={readContext:un,useCallback:ge,useContext:un,useEffect:mc,useImperativeHandle:rg,useInsertionEffect:th,useLayoutEffect:Nu,useMemo:Pe,useReducer:Mu,useRef:Fc,useState:function(){return Mu(mu)},useDebugValue:U,useDeferredValue:function(d){var g=dc();return xs===null?g.memoizedState=d:Xe(g,xs.memoizedState,d)},useTransition:function(){var d=Mu(mu)[0],g=dc().memoizedState;return[d,g]},useMutableSource:ud,useSyncExternalStore:Ru,useId:tt,unstable_isNewReconciler:!1};function En(d,g){if(d&&d.defaultProps){g=Qe({},g),d=d.defaultProps;for(var E in d)g[E]===void 0&&(g[E]=d[E]);return g}return g}function Br(d,g,E,N){g=d.memoizedState,E=E(N,g),E=E==null?g:Qe({},g,E),d.memoizedState=E,d.lanes===0&&(d.updateQueue.baseState=E)}var zr={isMounted:function(d){return(d=d._reactInternals)?Ji(d)===d:!1},enqueueSetState:function(d,g,E){d=d._reactInternals;var N=Bu(),X=gd(d),le=cr(N,X);le.payload=g,E!=null&&(le.callback=E),g=kr(d,le,X),g!==null&&(Zh(g,d,X,N),er(g,d,X))},enqueueReplaceState:function(d,g,E){d=d._reactInternals;var N=Bu(),X=gd(d),le=cr(N,X);le.tag=1,le.payload=g,E!=null&&(le.callback=E),g=kr(d,le,X),g!==null&&(Zh(g,d,X,N),er(g,d,X))},enqueueForceUpdate:function(d,g){d=d._reactInternals;var E=Bu(),N=gd(d),X=cr(E,N);X.tag=2,g!=null&&(X.callback=g),g=kr(d,X,N),g!==null&&(Zh(g,d,N,E),er(g,d,N))}};function Gn(d,g,E,N,X,le,ze){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(N,le,ze):g.prototype&&g.prototype.isPureReactComponent?!Ts(E,N)||!Ts(X,le):!0}function vr(d,g,E){var N=!1,X=Ll,le=g.contextType;return typeof le=="object"&&le!==null?le=un(le):(X=Pl(g)?Xl:va.current,N=g.contextTypes,le=(N=N!=null)?$a(d,X):Ll),g=new g(E,le),d.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=zr,d.stateNode=g,g._reactInternals=d,N&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=X,d.__reactInternalMemoizedMaskedChildContext=le),g}function Ei(d,g,E,N){d=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(E,N),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(E,N),g.state!==d&&zr.enqueueReplaceState(g,g.state,null)}function ni(d,g,E,N){var X=d.stateNode;X.props=E,X.state=d.memoizedState,X.refs={},_n(d);var le=g.contextType;typeof le=="object"&&le!==null?X.context=un(le):(le=Pl(g)?Xl:va.current,X.context=$a(d,le)),X.state=d.memoizedState,le=g.getDerivedStateFromProps,typeof le=="function"&&(Br(d,g,le,E),X.state=d.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof X.getSnapshotBeforeUpdate=="function"||typeof X.UNSAFE_componentWillMount!="function"&&typeof X.componentWillMount!="function"||(g=X.state,typeof X.componentWillMount=="function"&&X.componentWillMount(),typeof X.UNSAFE_componentWillMount=="function"&&X.UNSAFE_componentWillMount(),g!==X.state&&zr.enqueueReplaceState(X,X.state,null),Wr(d,E,X,N),X.state=d.memoizedState),typeof X.componentDidMount=="function"&&(d.flags|=4194308)}function Hr(d,g){try{var E="",N=g;do E+=Ze(N),N=N.return;while(N);var X=E}catch(le){X=`
Error generating stack: `+le.message+`
`+le.stack}return{value:d,source:g,stack:X,digest:null}}function qi(d,g,E){return{value:d,source:null,stack:E??null,digest:g??null}}function Mr(d,g){try{console.error(g.value)}catch(E){setTimeout(function(){throw E})}}var Gr=typeof WeakMap=="function"?WeakMap:Map;function Ri(d,g,E){E=cr(-1,E),E.tag=3,E.payload={element:null};var N=g.value;return E.callback=function(){cm||(cm=!0,k0=N),Mr(d,g)},E}function jr(d,g,E){E=cr(-1,E),E.tag=3;var N=d.type.getDerivedStateFromError;if(typeof N=="function"){var X=g.value;E.payload=function(){return N(X)},E.callback=function(){Mr(d,g)}}var le=d.stateNode;return le!==null&&typeof le.componentDidCatch=="function"&&(E.callback=function(){Mr(d,g),typeof N!="function"&&(vu===null?vu=new Set([this]):vu.add(this));var ze=g.stack;this.componentDidCatch(g.value,{componentStack:ze!==null?ze:""})}),E}function Vr(d,g,E){var N=d.pingCache;if(N===null){N=d.pingCache=new Gr;var X=new Set;N.set(g,X)}else X=N.get(g),X===void 0&&(X=new Set,N.set(g,X));X.has(E)||(X.add(E),d=B0.bind(null,d,g,E),g.then(d,d))}function Ci(d){do{var g;if((g=d.tag===13)&&(g=d.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return d;d=d.return}while(d!==null);return null}function zn(d,g,E,N,X){return(d.mode&1)===0?(d===g?d.flags|=65536:(d.flags|=128,E.flags|=131072,E.flags&=-52805,E.tag===1&&(E.alternate===null?E.tag=17:(g=cr(-1,1),g.tag=2,kr(E,g,1))),E.lanes|=1),d):(d.flags|=65536,d.lanes=X,d)}var an=he.ReactCurrentOwner,hn=!1;function Rn(d,g,E,N){g.child=d===null?st(g,null,E,N):rt(g,d.child,E,N)}function gr(d,g,E,N,X){E=E.render;var le=g.ref;return Ut(g,X),N=ld(d,g,E,N,le,X),E=Pu(),d!==null&&!hn?(g.updateQueue=d.updateQueue,g.flags&=-2053,d.lanes&=~X,Du(d,g,X)):(v&&E&&Sn(g),g.flags|=1,Rn(d,g,N,X),g.child)}function Xr(d,g,E,N,X){if(d===null){var le=E.type;return typeof le=="function"&&!Gf(le)&&le.defaultProps===void 0&&E.compare===null&&E.defaultProps===void 0?(g.tag=15,g.type=le,Ni(d,g,le,N,X)):(d=dg(E.type,null,N,g,g.mode,X),d.ref=g.ref,d.return=g,g.child=d)}if(le=d.child,(d.lanes&X)===0){var ze=le.memoizedProps;if(E=E.compare,E=E!==null?E:Ts,E(ze,N)&&d.ref===g.ref)return Du(d,g,X)}return g.flags|=1,d=cf(le,N),d.ref=g.ref,d.return=g,g.child=d}function Ni(d,g,E,N,X){if(d!==null){var le=d.memoizedProps;if(Ts(le,N)&&d.ref===g.ref)if(hn=!1,g.pendingProps=N=le,(d.lanes&X)!==0)(d.flags&131072)!==0&&(hn=!0);else return g.lanes=d.lanes,Du(d,g,X)}return cs(d,g,E,N,X)}function sl(d,g,E){var N=g.pendingProps,X=N.children,le=d!==null?d.memoizedState:null;if(N.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Xi(zc,al),al|=E;else{if((E&1073741824)===0)return d=le!==null?le.baseLanes|E:E,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:d,cachePool:null,transitions:null},g.updateQueue=null,Xi(zc,al),al|=d,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},N=le!==null?le.baseLanes:E,Xi(zc,al),al|=N}else le!==null?(N=le.baseLanes|E,g.memoizedState=null):N=E,Xi(zc,al),al|=N;return Rn(d,g,X,E),g.child}function ti(d,g){var E=g.ref;(d===null&&E!==null||d!==null&&d.ref!==E)&&(g.flags|=512,g.flags|=2097152)}function cs(d,g,E,N,X){var le=Pl(E)?Xl:va.current;return le=$a(g,le),Ut(g,X),E=ld(d,g,E,N,le,X),N=Pu(),d!==null&&!hn?(g.updateQueue=d.updateQueue,g.flags&=-2053,d.lanes&=~X,Du(d,g,X)):(v&&N&&Sn(g),g.flags|=1,Rn(d,g,E,X),g.child)}function uo(d,g,E,N,X){if(Pl(E)){var le=!0;Ia(g)}else le=!1;if(Ut(g,X),g.stateNode===null)nh(d,g),vr(g,E,N),ni(g,E,N,X),N=!0;else if(d===null){var ze=g.stateNode,Et=g.memoizedProps;ze.props=Et;var Ft=ze.context,yn=E.contextType;typeof yn=="object"&&yn!==null?yn=un(yn):(yn=Pl(E)?Xl:va.current,yn=$a(g,yn));var Jn=E.getDerivedStateFromProps,rr=typeof Jn=="function"||typeof ze.getSnapshotBeforeUpdate=="function";rr||typeof ze.UNSAFE_componentWillReceiveProps!="function"&&typeof ze.componentWillReceiveProps!="function"||(Et!==N||Ft!==yn)&&Ei(g,ze,N,yn),Cn=!1;var Vn=g.memoizedState;ze.state=Vn,Wr(g,N,ze,X),Ft=g.memoizedState,Et!==N||Vn!==Ft||Is.current||Cn?(typeof Jn=="function"&&(Br(g,E,Jn,N),Ft=g.memoizedState),(Et=Cn||Gn(g,E,Et,N,Vn,Ft,yn))?(rr||typeof ze.UNSAFE_componentWillMount!="function"&&typeof ze.componentWillMount!="function"||(typeof ze.componentWillMount=="function"&&ze.componentWillMount(),typeof ze.UNSAFE_componentWillMount=="function"&&ze.UNSAFE_componentWillMount()),typeof ze.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ze.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=N,g.memoizedState=Ft),ze.props=N,ze.state=Ft,ze.context=yn,N=Et):(typeof ze.componentDidMount=="function"&&(g.flags|=4194308),N=!1)}else{ze=g.stateNode,Mn(d,g),Et=g.memoizedProps,yn=g.type===g.elementType?Et:En(g.type,Et),ze.props=yn,rr=g.pendingProps,Vn=ze.context,Ft=E.contextType,typeof Ft=="object"&&Ft!==null?Ft=un(Ft):(Ft=Pl(E)?Xl:va.current,Ft=$a(g,Ft));var Zr=E.getDerivedStateFromProps;(Jn=typeof Zr=="function"||typeof ze.getSnapshotBeforeUpdate=="function")||typeof ze.UNSAFE_componentWillReceiveProps!="function"&&typeof ze.componentWillReceiveProps!="function"||(Et!==rr||Vn!==Ft)&&Ei(g,ze,N,Ft),Cn=!1,Vn=g.memoizedState,ze.state=Vn,Wr(g,N,ze,X);var li=g.memoizedState;Et!==rr||Vn!==li||Is.current||Cn?(typeof Zr=="function"&&(Br(g,E,Zr,N),li=g.memoizedState),(yn=Cn||Gn(g,E,yn,N,Vn,li,Ft)||!1)?(Jn||typeof ze.UNSAFE_componentWillUpdate!="function"&&typeof ze.componentWillUpdate!="function"||(typeof ze.componentWillUpdate=="function"&&ze.componentWillUpdate(N,li,Ft),typeof ze.UNSAFE_componentWillUpdate=="function"&&ze.UNSAFE_componentWillUpdate(N,li,Ft)),typeof ze.componentDidUpdate=="function"&&(g.flags|=4),typeof ze.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ze.componentDidUpdate!="function"||Et===d.memoizedProps&&Vn===d.memoizedState||(g.flags|=4),typeof ze.getSnapshotBeforeUpdate!="function"||Et===d.memoizedProps&&Vn===d.memoizedState||(g.flags|=1024),g.memoizedProps=N,g.memoizedState=li),ze.props=N,ze.state=li,ze.context=Ft,N=yn):(typeof ze.componentDidUpdate!="function"||Et===d.memoizedProps&&Vn===d.memoizedState||(g.flags|=4),typeof ze.getSnapshotBeforeUpdate!="function"||Et===d.memoizedProps&&Vn===d.memoizedState||(g.flags|=1024),N=!1)}return bs(d,g,E,N,le,X)}function bs(d,g,E,N,X,le){ti(d,g);var ze=(g.flags&128)!==0;if(!N&&!ze)return X&&bh(g,E,!1),Du(d,g,le);N=g.stateNode,an.current=g;var Et=ze&&typeof E.getDerivedStateFromError!="function"?null:N.render();return g.flags|=1,d!==null&&ze?(g.child=rt(g,d.child,null,le),g.child=rt(g,null,Et,le)):Rn(d,g,Et,le),g.memoizedState=N.state,X&&bh(g,E,!0),g.child}function Oa(d){var g=d.stateNode;g.pendingContext?Ga(d,g.pendingContext,g.pendingContext!==g.context):g.context&&Ga(d,g.context,!1),Js(d,g.containerInfo)}function gc(d,g,E,N,X){return Ae(),Te(X),g.flags|=256,Rn(d,g,E,N),g.child}var Do={dehydrated:null,treeContext:null,retryLane:0};function Zn(d){return{baseLanes:d,cachePool:null,transitions:null}}function _l(d,g,E){var N=g.pendingProps,X=Si.current,le=!1,ze=(g.flags&128)!==0,Et;if((Et=ze)||(Et=d!==null&&d.memoizedState===null?!1:(X&2)!==0),Et?(le=!0,g.flags&=-129):(d===null||d.memoizedState!==null)&&(X|=1),Xi(Si,X&1),d===null)return G(g),d=g.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((g.mode&1)===0?g.lanes=1:d.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ze=N.children,d=N.fallback,le?(N=g.mode,le=g.child,ze={mode:"hidden",children:ze},(N&1)===0&&le!==null?(le.childLanes=0,le.pendingProps=ze):le=fg(ze,N,0,null),d=Wf(d,N,E,null),le.return=g,d.return=g,le.sibling=d,g.child=le,g.child.memoizedState=Zn(E),g.memoizedState=Do,d):Sh(g,ze));if(X=d.memoizedState,X!==null&&(Et=X.dehydrated,Et!==null))return yc(d,g,ze,N,Et,X,E);if(le){le=N.fallback,ze=g.mode,X=d.child,Et=X.sibling;var Ft={mode:"hidden",children:N.children};return(ze&1)===0&&g.child!==X?(N=g.child,N.childLanes=0,N.pendingProps=Ft,g.deletions=null):(N=cf(X,Ft),N.subtreeFlags=X.subtreeFlags&14680064),Et!==null?le=cf(Et,le):(le=Wf(le,ze,E,null),le.flags|=2),le.return=g,N.return=g,N.sibling=le,g.child=N,N=le,le=g.child,ze=d.child.memoizedState,ze=ze===null?Zn(E):{baseLanes:ze.baseLanes|E,cachePool:null,transitions:ze.transitions},le.memoizedState=ze,le.childLanes=d.childLanes&~E,g.memoizedState=Do,N}return le=d.child,d=le.sibling,N=cf(le,{mode:"visible",children:N.children}),(g.mode&1)===0&&(N.lanes=E),N.return=g,N.sibling=null,d!==null&&(E=g.deletions,E===null?(g.deletions=[d],g.flags|=16):E.push(d)),g.child=N,g.memoizedState=null,N}function Sh(d,g){return g=fg({mode:"visible",children:g},d.mode,0,null),g.return=d,d.child=g}function Rh(d,g,E,N){return N!==null&&Te(N),rt(g,d.child,null,E),d=Sh(g,g.pendingProps.children),d.flags|=2,g.memoizedState=null,d}function yc(d,g,E,N,X,le,ze){if(E)return g.flags&256?(g.flags&=-257,N=qi(Error(t(422))),Rh(d,g,ze,N)):g.memoizedState!==null?(g.child=d.child,g.flags|=128,null):(le=N.fallback,X=g.mode,N=fg({mode:"visible",children:N.children},X,0,null),le=Wf(le,X,ze,null),le.flags|=2,N.return=g,le.return=g,N.sibling=le,g.child=N,(g.mode&1)!==0&&rt(g,d.child,null,ze),g.child.memoizedState=Zn(ze),g.memoizedState=Do,le);if((g.mode&1)===0)return Rh(d,g,ze,null);if(X.data==="$!"){if(N=X.nextSibling&&X.nextSibling.dataset,N)var Et=N.dgst;return N=Et,le=Error(t(419)),N=qi(le,N,void 0),Rh(d,g,ze,N)}if(Et=(ze&d.childLanes)!==0,hn||Et){if(N=Yl,N!==null){switch(ze&-ze){case 4:X=2;break;case 16:X=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:X=32;break;case 536870912:X=268435456;break;default:X=0}X=(X&(N.suspendedLanes|ze))!==0?0:X,X!==0&&X!==le.retryLane&&(le.retryLane=X,sn(d,X),Zh(N,d,X,-1))}return N0(),N=qi(Error(t(421))),Rh(d,g,ze,N)}return X.data==="$?"?(g.flags|=128,g.child=d.child,g=hx.bind(null,d),X._reactRetry=g,null):(d=le.treeContext,f=Ta(X.nextSibling),a=g,v=!0,S=null,d!==null&&(Je[dt++]=Qt,Je[dt++]=ft,Je[dt++]=Dt,Qt=d.id,ft=d.overflow,Dt=g),g=Sh(g,N.children),g.flags|=4096,g)}function hd(d,g,E){d.lanes|=g;var N=d.alternate;N!==null&&(N.lanes|=g),gn(d.return,g,E)}function gu(d,g,E,N,X){var le=d.memoizedState;le===null?d.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:N,tail:E,tailMode:X}:(le.isBackwards=g,le.rendering=null,le.renderingStartTime=0,le.last=N,le.tail=E,le.tailMode=X)}function kd(d,g,E){var N=g.pendingProps,X=N.revealOrder,le=N.tail;if(Rn(d,g,N.children,E),N=Si.current,(N&2)!==0)N=N&1|2,g.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=g.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&hd(d,E,g);else if(d.tag===19)hd(d,E,g);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===g)break e;for(;d.sibling===null;){if(d.return===null||d.return===g)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}N&=1}if(Xi(Si,N),(g.mode&1)===0)g.memoizedState=null;else switch(X){case"forwards":for(E=g.child,X=null;E!==null;)d=E.alternate,d!==null&&Ki(d)===null&&(X=E),E=E.sibling;E=X,E===null?(X=g.child,g.child=null):(X=E.sibling,E.sibling=null),gu(g,!1,X,E,le);break;case"backwards":for(E=null,X=g.child,g.child=null;X!==null;){if(d=X.alternate,d!==null&&Ki(d)===null){g.child=X;break}d=X.sibling,X.sibling=E,E=X,X=d}gu(g,!0,E,null,le);break;case"together":gu(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function nh(d,g){(g.mode&1)===0&&d!==null&&(d.alternate=null,g.alternate=null,g.flags|=2)}function Du(d,g,E){if(d!==null&&(g.dependencies=d.dependencies),Ha|=g.lanes,(E&g.childLanes)===0)return null;if(d!==null&&g.child!==d.child)throw Error(t(153));if(g.child!==null){for(d=g.child,E=cf(d,d.pendingProps),g.child=E,E.return=g;d.sibling!==null;)d=d.sibling,E=E.sibling=cf(d,d.pendingProps),E.return=g;E.sibling=null}return g.child}function dd(d,g,E){switch(g.tag){case 3:Oa(g),Ae();break;case 5:il(g);break;case 1:Pl(g.type)&&Ia(g);break;case 4:Js(g,g.stateNode.containerInfo);break;case 10:var N=g.type._context,X=g.memoizedProps.value;Xi(bt,N._currentValue),N._currentValue=X;break;case 13:if(N=g.memoizedState,N!==null)return N.dehydrated!==null?(Xi(Si,Si.current&1),g.flags|=128,null):(E&g.child.childLanes)!==0?_l(d,g,E):(Xi(Si,Si.current&1),d=Du(d,g,E),d!==null?d.sibling:null);Xi(Si,Si.current&1);break;case 19:if(N=(E&g.childLanes)!==0,(d.flags&128)!==0){if(N)return kd(d,g,E);g.flags|=128}if(X=g.memoizedState,X!==null&&(X.rendering=null,X.tail=null,X.lastEffect=null),Xi(Si,Si.current),N)break;return null;case 22:case 23:return g.lanes=0,sl(d,g,E)}return Du(d,g,E)}var Md,rh,mi,io;Md=function(d,g){for(var E=g.child;E!==null;){if(E.tag===5||E.tag===6)d.appendChild(E.stateNode);else if(E.tag!==4&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===g)break;for(;E.sibling===null;){if(E.return===null||E.return===g)return;E=E.return}E.sibling.return=E.return,E=E.sibling}},rh=function(){},mi=function(d,g,E,N){var X=d.memoizedProps;if(X!==N){d=g.stateNode,co(Ti.current);var le=null;switch(E){case"input":X=zt(d,X),N=zt(d,N),le=[];break;case"select":X=Qe({},X,{value:void 0}),N=Qe({},N,{value:void 0}),le=[];break;case"textarea":X=hr(d,X),N=hr(d,N),le=[];break;default:typeof X.onClick!="function"&&typeof N.onClick=="function"&&(d.onclick=Yu)}Kr(E,N);var ze;E=null;for(yn in X)if(!N.hasOwnProperty(yn)&&X.hasOwnProperty(yn)&&X[yn]!=null)if(yn==="style"){var Et=X[yn];for(ze in Et)Et.hasOwnProperty(ze)&&(E||(E={}),E[ze]="")}else yn!=="dangerouslySetInnerHTML"&&yn!=="children"&&yn!=="suppressContentEditableWarning"&&yn!=="suppressHydrationWarning"&&yn!=="autoFocus"&&(c.hasOwnProperty(yn)?le||(le=[]):(le=le||[]).push(yn,null));for(yn in N){var Ft=N[yn];if(Et=X?.[yn],N.hasOwnProperty(yn)&&Ft!==Et&&(Ft!=null||Et!=null))if(yn==="style")if(Et){for(ze in Et)!Et.hasOwnProperty(ze)||Ft&&Ft.hasOwnProperty(ze)||(E||(E={}),E[ze]="");for(ze in Ft)Ft.hasOwnProperty(ze)&&Et[ze]!==Ft[ze]&&(E||(E={}),E[ze]=Ft[ze])}else E||(le||(le=[]),le.push(yn,E)),E=Ft;else yn==="dangerouslySetInnerHTML"?(Ft=Ft?Ft.__html:void 0,Et=Et?Et.__html:void 0,Ft!=null&&Et!==Ft&&(le=le||[]).push(yn,Ft)):yn==="children"?typeof Ft!="string"&&typeof Ft!="number"||(le=le||[]).push(yn,""+Ft):yn!=="suppressContentEditableWarning"&&yn!=="suppressHydrationWarning"&&(c.hasOwnProperty(yn)?(Ft!=null&&yn==="onScroll"&&Co("scroll",d),le||Et===Ft||(le=[])):(le=le||[]).push(yn,Ft))}E&&(le=le||[]).push("style",E);var yn=le;(g.updateQueue=yn)&&(g.flags|=4)}},io=function(d,g,E,N){E!==N&&(g.flags|=4)};function Ls(d,g){if(!v)switch(d.tailMode){case"hidden":g=d.tail;for(var E=null;g!==null;)g.alternate!==null&&(E=g),g=g.sibling;E===null?d.tail=null:E.sibling=null;break;case"collapsed":E=d.tail;for(var N=null;E!==null;)E.alternate!==null&&(N=E),E=E.sibling;N===null?g||d.tail===null?d.tail=null:d.tail.sibling=null:N.sibling=null}}function ha(d){var g=d.alternate!==null&&d.alternate.child===d.child,E=0,N=0;if(g)for(var X=d.child;X!==null;)E|=X.lanes|X.childLanes,N|=X.subtreeFlags&14680064,N|=X.flags&14680064,X.return=d,X=X.sibling;else for(X=d.child;X!==null;)E|=X.lanes|X.childLanes,N|=X.subtreeFlags,N|=X.flags,X.return=d,X=X.sibling;return d.subtreeFlags|=N,d.childLanes=E,g}function Ns(d,g,E){var N=g.pendingProps;switch(y(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ha(g),null;case 1:return Pl(g.type)&&sd(),ha(g),null;case 3:return N=g.stateNode,ps(),Lo(Is),Lo(va),Qs(),N.pendingContext&&(N.context=N.pendingContext,N.pendingContext=null),(d===null||d.child===null)&&(ee(g)?g.flags|=4:d===null||d.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,S!==null&&(Nd(S),S=null))),rh(d,g),ha(g),null;case 5:Wa(g);var X=co(yo.current);if(E=g.type,d!==null&&g.stateNode!=null)mi(d,g,E,N,X),d.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!N){if(g.stateNode===null)throw Error(t(166));return ha(g),null}if(d=co(Ti.current),ee(g)){N=g.stateNode,E=g.type;var le=g.memoizedProps;switch(N[yl]=g,N[uc]=le,d=(g.mode&1)!==0,E){case"dialog":Co("cancel",N),Co("close",N);break;case"iframe":case"object":case"embed":Co("load",N);break;case"video":case"audio":for(X=0;X<rs.length;X++)Co(rs[X],N);break;case"source":Co("error",N);break;case"img":case"image":case"link":Co("error",N),Co("load",N);break;case"details":Co("toggle",N);break;case"input":it(N,le),Co("invalid",N);break;case"select":N._wrapperState={wasMultiple:!!le.multiple},Co("invalid",N);break;case"textarea":Wt(N,le),Co("invalid",N)}Kr(E,le),X=null;for(var ze in le)if(le.hasOwnProperty(ze)){var Et=le[ze];ze==="children"?typeof Et=="string"?N.textContent!==Et&&(le.suppressHydrationWarning!==!0&&Mc(N.textContent,Et,d),X=["children",Et]):typeof Et=="number"&&N.textContent!==""+Et&&(le.suppressHydrationWarning!==!0&&Mc(N.textContent,Et,d),X=["children",""+Et]):c.hasOwnProperty(ze)&&Et!=null&&ze==="onScroll"&&Co("scroll",N)}switch(E){case"input":tn(N),Tr(N,le,!0);break;case"textarea":tn(N),tr(N);break;case"select":case"option":break;default:typeof le.onClick=="function"&&(N.onclick=Yu)}N=X,g.updateQueue=N,N!==null&&(g.flags|=4)}else{ze=X.nodeType===9?X:X.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=Hn(E)),d==="http://www.w3.org/1999/xhtml"?E==="script"?(d=ze.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof N.is=="string"?d=ze.createElement(E,{is:N.is}):(d=ze.createElement(E),E==="select"&&(ze=d,N.multiple?ze.multiple=!0:N.size&&(ze.size=N.size))):d=ze.createElementNS(d,E),d[yl]=g,d[uc]=N,Md(d,g,!1,!1),g.stateNode=d;e:{switch(ze=Sr(E,N),E){case"dialog":Co("cancel",d),Co("close",d),X=N;break;case"iframe":case"object":case"embed":Co("load",d),X=N;break;case"video":case"audio":for(X=0;X<rs.length;X++)Co(rs[X],d);X=N;break;case"source":Co("error",d),X=N;break;case"img":case"image":case"link":Co("error",d),Co("load",d),X=N;break;case"details":Co("toggle",d),X=N;break;case"input":it(d,N),X=zt(d,N),Co("invalid",d);break;case"option":X=N;break;case"select":d._wrapperState={wasMultiple:!!N.multiple},X=Qe({},N,{value:void 0}),Co("invalid",d);break;case"textarea":Wt(d,N),X=hr(d,N),Co("invalid",d);break;default:X=N}Kr(E,X),Et=X;for(le in Et)if(Et.hasOwnProperty(le)){var Ft=Et[le];le==="style"?pr(d,Ft):le==="dangerouslySetInnerHTML"?(Ft=Ft?Ft.__html:void 0,Ft!=null&&wr(d,Ft)):le==="children"?typeof Ft=="string"?(E!=="textarea"||Ft!=="")&&br(d,Ft):typeof Ft=="number"&&br(d,""+Ft):le!=="suppressContentEditableWarning"&&le!=="suppressHydrationWarning"&&le!=="autoFocus"&&(c.hasOwnProperty(le)?Ft!=null&&le==="onScroll"&&Co("scroll",d):Ft!=null&&ye(d,le,Ft,ze))}switch(E){case"input":tn(d),Tr(d,N,!1);break;case"textarea":tn(d),tr(d);break;case"option":N.value!=null&&d.setAttribute("value",""+ht(N.value));break;case"select":d.multiple=!!N.multiple,le=N.value,le!=null?$n(d,!!N.multiple,le,!1):N.defaultValue!=null&&$n(d,!!N.multiple,N.defaultValue,!0);break;default:typeof X.onClick=="function"&&(d.onclick=Yu)}switch(E){case"button":case"input":case"select":case"textarea":N=!!N.autoFocus;break e;case"img":N=!0;break e;default:N=!1}}N&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return ha(g),null;case 6:if(d&&g.stateNode!=null)io(d,g,d.memoizedProps,N);else{if(typeof N!="string"&&g.stateNode===null)throw Error(t(166));if(E=co(yo.current),co(Ti.current),ee(g)){if(N=g.stateNode,E=g.memoizedProps,N[yl]=g,(le=N.nodeValue!==E)&&(d=a,d!==null))switch(d.tag){case 3:Mc(N.nodeValue,E,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&Mc(N.nodeValue,E,(d.mode&1)!==0)}le&&(g.flags|=4)}else N=(E.nodeType===9?E:E.ownerDocument).createTextNode(N),N[yl]=g,g.stateNode=N}return ha(g),null;case 13:if(Lo(Si),N=g.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(v&&f!==null&&(g.mode&1)!==0&&(g.flags&128)===0)me(),Ae(),g.flags|=98560,le=!1;else if(le=ee(g),N!==null&&N.dehydrated!==null){if(d===null){if(!le)throw Error(t(318));if(le=g.memoizedState,le=le!==null?le.dehydrated:null,!le)throw Error(t(317));le[yl]=g}else Ae(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;ha(g),le=!1}else S!==null&&(Nd(S),S=null),le=!0;if(!le)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=E,g):(N=N!==null,N!==(d!==null&&d.memoizedState!==null)&&N&&(g.child.flags|=8192,(g.mode&1)!==0&&(d===null||(Si.current&1)!==0?Ho===0&&(Ho=3):N0())),g.updateQueue!==null&&(g.flags|=4),ha(g),null);case 4:return ps(),rh(d,g),d===null&&Vi(g.stateNode.containerInfo),ha(g),null;case 10:return Vt(g.type._context),ha(g),null;case 17:return Pl(g.type)&&sd(),ha(g),null;case 19:if(Lo(Si),le=g.memoizedState,le===null)return ha(g),null;if(N=(g.flags&128)!==0,ze=le.rendering,ze===null)if(N)Ls(le,!1);else{if(Ho!==0||d!==null&&(d.flags&128)!==0)for(d=g.child;d!==null;){if(ze=Ki(d),ze!==null){for(g.flags|=128,Ls(le,!1),N=ze.updateQueue,N!==null&&(g.updateQueue=N,g.flags|=4),g.subtreeFlags=0,N=E,E=g.child;E!==null;)le=E,d=N,le.flags&=14680066,ze=le.alternate,ze===null?(le.childLanes=0,le.lanes=d,le.child=null,le.subtreeFlags=0,le.memoizedProps=null,le.memoizedState=null,le.updateQueue=null,le.dependencies=null,le.stateNode=null):(le.childLanes=ze.childLanes,le.lanes=ze.lanes,le.child=ze.child,le.subtreeFlags=0,le.deletions=null,le.memoizedProps=ze.memoizedProps,le.memoizedState=ze.memoizedState,le.updateQueue=ze.updateQueue,le.type=ze.type,d=ze.dependencies,le.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),E=E.sibling;return Xi(Si,Si.current&1|2),g.child}d=d.sibling}le.tail!==null&&Oi()>wp&&(g.flags|=128,N=!0,Ls(le,!1),g.lanes=4194304)}else{if(!N)if(d=Ki(ze),d!==null){if(g.flags|=128,N=!0,E=d.updateQueue,E!==null&&(g.updateQueue=E,g.flags|=4),Ls(le,!0),le.tail===null&&le.tailMode==="hidden"&&!ze.alternate&&!v)return ha(g),null}else 2*Oi()-le.renderingStartTime>wp&&E!==1073741824&&(g.flags|=128,N=!0,Ls(le,!1),g.lanes=4194304);le.isBackwards?(ze.sibling=g.child,g.child=ze):(E=le.last,E!==null?E.sibling=ze:g.child=ze,le.last=ze)}return le.tail!==null?(g=le.tail,le.rendering=g,le.tail=g.sibling,le.renderingStartTime=Oi(),g.sibling=null,E=Si.current,Xi(Si,N?E&1|2:E&1),g):(ha(g),null);case 22:case 23:return ug(),N=g.memoizedState!==null,d!==null&&d.memoizedState!==null!==N&&(g.flags|=8192),N&&(g.mode&1)!==0?(al&1073741824)!==0&&(ha(g),g.subtreeFlags&6&&(g.flags|=8192)):ha(g),null;case 24:return null;case 25:return null}throw Error(t(156,g.tag))}function fd(d,g){switch(y(g),g.tag){case 1:return Pl(g.type)&&sd(),d=g.flags,d&65536?(g.flags=d&-65537|128,g):null;case 3:return ps(),Lo(Is),Lo(va),Qs(),d=g.flags,(d&65536)!==0&&(d&128)===0?(g.flags=d&-65537|128,g):null;case 5:return Wa(g),null;case 13:if(Lo(Si),d=g.memoizedState,d!==null&&d.dehydrated!==null){if(g.alternate===null)throw Error(t(340));Ae()}return d=g.flags,d&65536?(g.flags=d&-65537|128,g):null;case 19:return Lo(Si),null;case 4:return ps(),null;case 10:return Vt(g.type._context),null;case 22:case 23:return ug(),null;case 24:return null;default:return null}}var ru=!1,Ds=!1,Bc=typeof WeakSet=="function"?WeakSet:Set,Er=null;function pd(d,g){var E=d.ref;if(E!==null)if(typeof E=="function")try{E(null)}catch(N){xl(d,g,N)}else E.current=null}function tf(d,g,E){try{E()}catch(N){xl(d,g,N)}}var rm=!1;function Bf(d,g){if(tu=Tc,d=la(),oc(d)){if("selectionStart"in d)var E={start:d.selectionStart,end:d.selectionEnd};else e:{E=(E=d.ownerDocument)&&E.defaultView||window;var N=E.getSelection&&E.getSelection();if(N&&N.rangeCount!==0){E=N.anchorNode;var X=N.anchorOffset,le=N.focusNode;N=N.focusOffset;try{E.nodeType,le.nodeType}catch{E=null;break e}var ze=0,Et=-1,Ft=-1,yn=0,Jn=0,rr=d,Vn=null;t:for(;;){for(var Zr;rr!==E||X!==0&&rr.nodeType!==3||(Et=ze+X),rr!==le||N!==0&&rr.nodeType!==3||(Ft=ze+N),rr.nodeType===3&&(ze+=rr.nodeValue.length),(Zr=rr.firstChild)!==null;)Vn=rr,rr=Zr;for(;;){if(rr===d)break t;if(Vn===E&&++yn===X&&(Et=ze),Vn===le&&++Jn===N&&(Ft=ze),(Zr=rr.nextSibling)!==null)break;rr=Vn,Vn=rr.parentNode}rr=Zr}E=Et===-1||Ft===-1?null:{start:Et,end:Ft}}else E=null}E=E||{start:0,end:0}}else E=null;for(gl={focusedElem:d,selectionRange:E},Tc=!1,Er=g;Er!==null;)if(g=Er,d=g.child,(g.subtreeFlags&1028)!==0&&d!==null)d.return=g,Er=d;else for(;Er!==null;){g=Er;try{var li=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(li!==null){var di=li.memoizedProps,bl=li.memoizedState,cn=g.stateNode,Gt=cn.getSnapshotBeforeUpdate(g.elementType===g.type?di:En(g.type,di),bl);cn.__reactInternalSnapshotBeforeUpdate=Gt}break;case 3:var mn=g.stateNode.containerInfo;mn.nodeType===1?mn.textContent="":mn.nodeType===9&&mn.documentElement&&mn.removeChild(mn.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(fr){xl(g,g.return,fr)}if(d=g.sibling,d!==null){d.return=g.return,Er=d;break}Er=g.return}return li=rm,rm=!1,li}function Rd(d,g,E){var N=g.updateQueue;if(N=N!==null?N.lastEffect:null,N!==null){var X=N=N.next;do{if((X.tag&d)===d){var le=X.destroy;X.destroy=void 0,le!==void 0&&tf(g,E,le)}X=X.next}while(X!==N)}}function yu(d,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var E=g=g.next;do{if((E.tag&d)===d){var N=E.create;E.destroy=N()}E=E.next}while(E!==g)}}function Wh(d){var g=d.ref;if(g!==null){var E=d.stateNode;switch(d.tag){case 5:d=E;break;default:d=E}typeof g=="function"?g(d):g.current=d}}function im(d){var g=d.alternate;g!==null&&(d.alternate=null,im(g)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(g=d.stateNode,g!==null&&(delete g[yl],delete g[uc],delete g[qa],delete g[od],delete g[Id])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function om(d){return d.tag===5||d.tag===3||d.tag===4}function vp(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||om(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function nf(d,g,E){var N=d.tag;if(N===5||N===6)d=d.stateNode,g?E.nodeType===8?E.parentNode.insertBefore(d,g):E.insertBefore(d,g):(E.nodeType===8?(g=E.parentNode,g.insertBefore(d,E)):(g=E,g.appendChild(d)),E=E._reactRootContainer,E!=null||g.onclick!==null||(g.onclick=Yu));else if(N!==4&&(d=d.child,d!==null))for(nf(d,g,E),d=d.sibling;d!==null;)nf(d,g,E),d=d.sibling}function zf(d,g,E){var N=d.tag;if(N===5||N===6)d=d.stateNode,g?E.insertBefore(d,g):E.appendChild(d);else if(N!==4&&(d=d.child,d!==null))for(zf(d,g,E),d=d.sibling;d!==null;)zf(d,g,E),d=d.sibling}var vl=null,_u=!1;function Nh(d,g,E){for(E=E.child;E!==null;)sm(d,g,E),E=E.sibling}function sm(d,g,E){if(Ro&&typeof Ro.onCommitFiberUnmount=="function")try{Ro.onCommitFiberUnmount(Ea,E)}catch{}switch(E.tag){case 5:Ds||pd(E,g);case 6:var N=vl,X=_u;vl=null,Nh(d,g,E),vl=N,_u=X,vl!==null&&(_u?(d=vl,E=E.stateNode,d.nodeType===8?d.parentNode.removeChild(E):d.removeChild(E)):vl.removeChild(E.stateNode));break;case 18:vl!==null&&(_u?(d=vl,E=E.stateNode,d.nodeType===8?Lh(d.parentNode,E):d.nodeType===1&&Lh(d,E),Oo(d)):Lh(vl,E.stateNode));break;case 4:N=vl,X=_u,vl=E.stateNode.containerInfo,_u=!0,Nh(d,g,E),vl=N,_u=X;break;case 0:case 11:case 14:case 15:if(!Ds&&(N=E.updateQueue,N!==null&&(N=N.lastEffect,N!==null))){X=N=N.next;do{var le=X,ze=le.destroy;le=le.tag,ze!==void 0&&((le&2)!==0||(le&4)!==0)&&tf(E,g,ze),X=X.next}while(X!==N)}Nh(d,g,E);break;case 1:if(!Ds&&(pd(E,g),N=E.stateNode,typeof N.componentWillUnmount=="function"))try{N.props=E.memoizedProps,N.state=E.memoizedState,N.componentWillUnmount()}catch(Et){xl(E,g,Et)}Nh(d,g,E);break;case 21:Nh(d,g,E);break;case 22:E.mode&1?(Ds=(N=Ds)||E.memoizedState!==null,Nh(d,g,E),Ds=N):Nh(d,g,E);break;default:Nh(d,g,E)}}function C0(d){var g=d.updateQueue;if(g!==null){d.updateQueue=null;var E=d.stateNode;E===null&&(E=d.stateNode=new Bc),g.forEach(function(N){var X=dx.bind(null,d,N);E.has(N)||(E.add(N),N.then(X,X))})}}function Fu(d,g){var E=g.deletions;if(E!==null)for(var N=0;N<E.length;N++){var X=E[N];try{var le=d,ze=g,Et=ze;e:for(;Et!==null;){switch(Et.tag){case 5:vl=Et.stateNode,_u=!1;break e;case 3:vl=Et.stateNode.containerInfo,_u=!0;break e;case 4:vl=Et.stateNode.containerInfo,_u=!0;break e}Et=Et.return}if(vl===null)throw Error(t(160));sm(le,ze,X),vl=null,_u=!1;var Ft=X.alternate;Ft!==null&&(Ft.return=null),X.return=null}catch(yn){xl(X,g,yn)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)ig(g,d),g=g.sibling}function ig(d,g){var E=d.alternate,N=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(Fu(g,d),Hh(d),N&4){try{Rd(3,d,d.return),yu(3,d)}catch(di){xl(d,d.return,di)}try{Rd(5,d,d.return)}catch(di){xl(d,d.return,di)}}break;case 1:Fu(g,d),Hh(d),N&512&&E!==null&&pd(E,E.return);break;case 5:if(Fu(g,d),Hh(d),N&512&&E!==null&&pd(E,E.return),d.flags&32){var X=d.stateNode;try{br(X,"")}catch(di){xl(d,d.return,di)}}if(N&4&&(X=d.stateNode,X!=null)){var le=d.memoizedProps,ze=E!==null?E.memoizedProps:le,Et=d.type,Ft=d.updateQueue;if(d.updateQueue=null,Ft!==null)try{Et==="input"&&le.type==="radio"&&le.name!=null&&ur(X,le),Sr(Et,ze);var yn=Sr(Et,le);for(ze=0;ze<Ft.length;ze+=2){var Jn=Ft[ze],rr=Ft[ze+1];Jn==="style"?pr(X,rr):Jn==="dangerouslySetInnerHTML"?wr(X,rr):Jn==="children"?br(X,rr):ye(X,Jn,rr,yn)}switch(Et){case"input":xr(X,le);break;case"textarea":Nn(X,le);break;case"select":var Vn=X._wrapperState.wasMultiple;X._wrapperState.wasMultiple=!!le.multiple;var Zr=le.value;Zr!=null?$n(X,!!le.multiple,Zr,!1):Vn!==!!le.multiple&&(le.defaultValue!=null?$n(X,!!le.multiple,le.defaultValue,!0):$n(X,!!le.multiple,le.multiple?[]:"",!1))}X[uc]=le}catch(di){xl(d,d.return,di)}}break;case 6:if(Fu(g,d),Hh(d),N&4){if(d.stateNode===null)throw Error(t(162));X=d.stateNode,le=d.memoizedProps;try{X.nodeValue=le}catch(di){xl(d,d.return,di)}}break;case 3:if(Fu(g,d),Hh(d),N&4&&E!==null&&E.memoizedState.isDehydrated)try{Oo(g.containerInfo)}catch(di){xl(d,d.return,di)}break;case 4:Fu(g,d),Hh(d);break;case 13:Fu(g,d),Hh(d),X=d.child,X.flags&8192&&(le=X.memoizedState!==null,X.stateNode.isHidden=le,!le||X.alternate!==null&&X.alternate.memoizedState!==null||(lm=Oi())),N&4&&C0(d);break;case 22:if(Jn=E!==null&&E.memoizedState!==null,d.mode&1?(Ds=(yn=Ds)||Jn,Fu(g,d),Ds=yn):Fu(g,d),Hh(d),N&8192){if(yn=d.memoizedState!==null,(d.stateNode.isHidden=yn)&&!Jn&&(d.mode&1)!==0)for(Er=d,Jn=d.child;Jn!==null;){for(rr=Er=Jn;Er!==null;){switch(Vn=Er,Zr=Vn.child,Vn.tag){case 0:case 11:case 14:case 15:Rd(4,Vn,Vn.return);break;case 1:pd(Vn,Vn.return);var li=Vn.stateNode;if(typeof li.componentWillUnmount=="function"){N=Vn,E=Vn.return;try{g=N,li.props=g.memoizedProps,li.state=g.memoizedState,li.componentWillUnmount()}catch(di){xl(N,E,di)}}break;case 5:pd(Vn,Vn.return);break;case 22:if(Vn.memoizedState!==null){P0(rr);continue}}Zr!==null?(Zr.return=Vn,Er=Zr):P0(rr)}Jn=Jn.sibling}e:for(Jn=null,rr=d;;){if(rr.tag===5){if(Jn===null){Jn=rr;try{X=rr.stateNode,yn?(le=X.style,typeof le.setProperty=="function"?le.setProperty("display","none","important"):le.display="none"):(Et=rr.stateNode,Ft=rr.memoizedProps.style,ze=Ft!=null&&Ft.hasOwnProperty("display")?Ft.display:null,Et.style.display=Mi("display",ze))}catch(di){xl(d,d.return,di)}}}else if(rr.tag===6){if(Jn===null)try{rr.stateNode.nodeValue=yn?"":rr.memoizedProps}catch(di){xl(d,d.return,di)}}else if((rr.tag!==22&&rr.tag!==23||rr.memoizedState===null||rr===d)&&rr.child!==null){rr.child.return=rr,rr=rr.child;continue}if(rr===d)break e;for(;rr.sibling===null;){if(rr.return===null||rr.return===d)break e;Jn===rr&&(Jn=null),rr=rr.return}Jn===rr&&(Jn=null),rr.sibling.return=rr.return,rr=rr.sibling}}break;case 19:Fu(g,d),Hh(d),N&4&&C0(d);break;case 21:break;default:Fu(g,d),Hh(d)}}function Hh(d){var g=d.flags;if(g&2){try{e:{for(var E=d.return;E!==null;){if(om(E)){var N=E;break e}E=E.return}throw Error(t(160))}switch(N.tag){case 5:var X=N.stateNode;N.flags&32&&(br(X,""),N.flags&=-33);var le=vp(d);zf(d,le,X);break;case 3:case 4:var ze=N.stateNode.containerInfo,Et=vp(d);nf(d,Et,ze);break;default:throw Error(t(161))}}catch(Ft){xl(d,d.return,Ft)}d.flags&=-3}g&4096&&(d.flags&=-4097)}function xp(d,g,E){Er=d,L0(d)}function L0(d,g,E){for(var N=(d.mode&1)!==0;Er!==null;){var X=Er,le=X.child;if(X.tag===22&&N){var ze=X.memoizedState!==null||ru;if(!ze){var Et=X.alternate,Ft=Et!==null&&Et.memoizedState!==null||Ds;Et=ru;var yn=Ds;if(ru=ze,(Ds=Ft)&&!yn)for(Er=X;Er!==null;)ze=Er,Ft=ze.child,ze.tag===22&&ze.memoizedState!==null?E_(X):Ft!==null?(Ft.return=ze,Er=Ft):E_(X);for(;le!==null;)Er=le,L0(le),le=le.sibling;Er=X,ru=Et,Ds=yn}og(d)}else(X.subtreeFlags&8772)!==0&&le!==null?(le.return=X,Er=le):og(d)}}function og(d){for(;Er!==null;){var g=Er;if((g.flags&8772)!==0){var E=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:Ds||yu(5,g);break;case 1:var N=g.stateNode;if(g.flags&4&&!Ds)if(E===null)N.componentDidMount();else{var X=g.elementType===g.type?E.memoizedProps:En(g.type,E.memoizedProps);N.componentDidUpdate(X,E.memoizedState,N.__reactInternalSnapshotBeforeUpdate)}var le=g.updateQueue;le!==null&&hi(g,le,N);break;case 3:var ze=g.updateQueue;if(ze!==null){if(E=null,g.child!==null)switch(g.child.tag){case 5:E=g.child.stateNode;break;case 1:E=g.child.stateNode}hi(g,ze,E)}break;case 5:var Et=g.stateNode;if(E===null&&g.flags&4){E=Et;var Ft=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Ft.autoFocus&&E.focus();break;case"img":Ft.src&&(E.src=Ft.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var yn=g.alternate;if(yn!==null){var Jn=yn.memoizedState;if(Jn!==null){var rr=Jn.dehydrated;rr!==null&&Oo(rr)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Ds||g.flags&512&&Wh(g)}catch(Vn){xl(g,g.return,Vn)}}if(g===d){Er=null;break}if(E=g.sibling,E!==null){E.return=g.return,Er=E;break}Er=g.return}}function P0(d){for(;Er!==null;){var g=Er;if(g===d){Er=null;break}var E=g.sibling;if(E!==null){E.return=g.return,Er=E;break}Er=g.return}}function E_(d){for(;Er!==null;){var g=Er;try{switch(g.tag){case 0:case 11:case 15:var E=g.return;try{yu(4,g)}catch(Ft){xl(g,E,Ft)}break;case 1:var N=g.stateNode;if(typeof N.componentDidMount=="function"){var X=g.return;try{N.componentDidMount()}catch(Ft){xl(g,X,Ft)}}var le=g.return;try{Wh(g)}catch(Ft){xl(g,le,Ft)}break;case 5:var ze=g.return;try{Wh(g)}catch(Ft){xl(g,ze,Ft)}}}catch(Ft){xl(g,g.return,Ft)}if(g===d){Er=null;break}var Et=g.sibling;if(Et!==null){Et.return=g.return,Er=Et;break}Er=g.return}}var lx=Math.ceil,rf=he.ReactCurrentDispatcher,sg=he.ReactCurrentOwner,_c=he.ReactCurrentBatchConfig,ai=0,Yl=null,ta=null,Ca=0,al=0,zc=Nc(0),Ho=0,bp=null,Ha=0,am=0,of=0,jf=null,Ou=null,lm=0,wp=1/0,Xh=null,cm=!1,k0=null,vu=null,md=!1,Kh=null,Uf=0,Vf=0,ag=null,lg=-1,um=0;function Bu(){return(ai&6)!==0?Oi():lg!==-1?lg:lg=Oi()}function gd(d){return(d.mode&1)===0?1:(ai&2)!==0&&Ca!==0?Ca&-Ca:He.transition!==null?(um===0&&(um=aa()),um):(d=zi,d!==0||(d=window.event,d=d===void 0?16:qs(d.type)),d)}function Zh(d,g,E,N){if(50<Vf)throw Vf=0,ag=null,Error(t(185));vi(d,E,N),((ai&2)===0||d!==Yl)&&(d===Yl&&((ai&2)===0&&(am|=E),Ho===4&&sf(d,Ca)),xu(d,N),E===1&&ai===0&&(g.mode&1)===0&&(wp=Oi()+500,kh&&ie()))}function xu(d,g){var E=d.callbackNode;Fr(d,g);var N=Us(d,d===Yl?Ca:0);if(N===0)E!==null&&Fi(E),d.callbackNode=null,d.callbackPriority=0;else if(g=N&-N,d.callbackPriority!==g){if(E!=null&&Fi(E),g===1)d.tag===0?Y(qf.bind(null,d)):F(qf.bind(null,d)),Qd(function(){(ai&6)===0&&ie()}),E=null;else{switch(es(N)){case 1:E=Pa;break;case 4:E=Qo;break;case 16:E=Sa;break;case 536870912:E=hl;break;default:E=Sa}E=dm(E,M0.bind(null,d))}d.callbackPriority=g,d.callbackNode=E}}function M0(d,g){if(lg=-1,um=0,(ai&6)!==0)throw Error(t(327));var E=d.callbackNode;if(ih()&&d.callbackNode!==E)return null;var N=Us(d,d===Yl?Ca:0);if(N===0)return null;if((N&30)!==0||(N&d.expiredLanes)!==0||g)g=hm(d,N);else{g=N;var X=ai;ai|=2;var le=R0();(Yl!==d||Ca!==g)&&(Xh=null,wp=Oi()+500,$f(d,g));do try{ux();break}catch(Et){T_(d,Et)}while(!0);kt(),rf.current=le,ai=X,ta!==null?g=0:(Yl=null,Ca=0,g=Ho)}if(g!==0){if(g===2&&(X=ei(d),X!==0&&(N=X,g=cg(d,X))),g===1)throw E=bp,$f(d,0),sf(d,N),xu(d,Oi()),E;if(g===6)sf(d,N);else{if(X=d.current.alternate,(N&30)===0&&!A_(X)&&(g=hm(d,N),g===2&&(le=ei(d),le!==0&&(N=le,g=cg(d,le))),g===1))throw E=bp,$f(d,0),sf(d,N),xu(d,Oi()),E;switch(d.finishedWork=X,d.finishedLanes=N,g){case 0:case 1:throw Error(t(345));case 2:lf(d,Ou,Xh);break;case 3:if(sf(d,N),(N&130023424)===N&&(g=lm+500-Oi(),10<g)){if(Us(d,0)!==0)break;if(X=d.suspendedLanes,(X&N)!==N){Bu(),d.pingedLanes|=d.suspendedLanes&X;break}d.timeoutHandle=pu(lf.bind(null,d,Ou,Xh),g);break}lf(d,Ou,Xh);break;case 4:if(sf(d,N),(N&4194240)===N)break;for(g=d.eventTimes,X=-1;0<N;){var ze=31-ss(N);le=1<<ze,ze=g[ze],ze>X&&(X=ze),N&=~le}if(N=X,N=Oi()-N,N=(120>N?120:480>N?480:1080>N?1080:1920>N?1920:3e3>N?3e3:4320>N?4320:1960*lx(N/1960))-N,10<N){d.timeoutHandle=pu(lf.bind(null,d,Ou,Xh),N);break}lf(d,Ou,Xh);break;case 5:lf(d,Ou,Xh);break;default:throw Error(t(329))}}}return xu(d,Oi()),d.callbackNode===E?M0.bind(null,d):null}function cg(d,g){var E=jf;return d.current.memoizedState.isDehydrated&&($f(d,g).flags|=256),d=hm(d,g),d!==2&&(g=Ou,Ou=E,g!==null&&Nd(g)),d}function Nd(d){Ou===null?Ou=d:Ou.push.apply(Ou,d)}function A_(d){for(var g=d;;){if(g.flags&16384){var E=g.updateQueue;if(E!==null&&(E=E.stores,E!==null))for(var N=0;N<E.length;N++){var X=E[N],le=X.getSnapshot;X=X.value;try{if(!ns(le(),X))return!1}catch{return!1}}}if(E=g.child,g.subtreeFlags&16384&&E!==null)E.return=g,g=E;else{if(g===d)break;for(;g.sibling===null;){if(g.return===null||g.return===d)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function sf(d,g){for(g&=~of,g&=~am,d.suspendedLanes|=g,d.pingedLanes&=~g,d=d.expirationTimes;0<g;){var E=31-ss(g),N=1<<E;d[E]=-1,g&=~N}}function qf(d){if((ai&6)!==0)throw Error(t(327));ih();var g=Us(d,0);if((g&1)===0)return xu(d,Oi()),null;var E=hm(d,g);if(d.tag!==0&&E===2){var N=ei(d);N!==0&&(g=N,E=cg(d,N))}if(E===1)throw E=bp,$f(d,0),sf(d,g),xu(d,Oi()),E;if(E===6)throw Error(t(345));return d.finishedWork=d.current.alternate,d.finishedLanes=g,lf(d,Ou,Xh),xu(d,Oi()),null}function Sp(d,g){var E=ai;ai|=1;try{return d(g)}finally{ai=E,ai===0&&(wp=Oi()+500,kh&&ie())}}function af(d){Kh!==null&&Kh.tag===0&&(ai&6)===0&&ih();var g=ai;ai|=1;var E=_c.transition,N=zi;try{if(_c.transition=null,zi=1,d)return d()}finally{zi=N,_c.transition=E,ai=g,(ai&6)===0&&ie()}}function ug(){al=zc.current,Lo(zc)}function $f(d,g){d.finishedWork=null,d.finishedLanes=0;var E=d.timeoutHandle;if(E!==-1&&(d.timeoutHandle=-1,Ch(E)),ta!==null)for(E=ta.return;E!==null;){var N=E;switch(y(N),N.tag){case 1:N=N.type.childContextTypes,N!=null&&sd();break;case 3:ps(),Lo(Is),Lo(va),Qs();break;case 5:Wa(N);break;case 4:ps();break;case 13:Lo(Si);break;case 19:Lo(Si);break;case 10:Vt(N.type._context);break;case 22:case 23:ug()}E=E.return}if(Yl=d,ta=d=cf(d.current,null),Ca=al=g,Ho=0,bp=null,of=am=Ha=0,Ou=jf=null,$t!==null){for(g=0;g<$t.length;g++)if(E=$t[g],N=E.interleaved,N!==null){E.interleaved=null;var X=N.next,le=E.pending;if(le!==null){var ze=le.next;le.next=X,N.next=ze}E.pending=N}$t=null}return d}function T_(d,g){do{var E=ta;try{if(kt(),ua.current=Yt,Kl){for(var N=Fo.memoizedState;N!==null;){var X=N.queue;X!==null&&(X.pending=null),N=N.next}Kl=!1}if(vs=0,Cs=xs=Fo=null,ol=!1,hc=0,sg.current=null,E===null||E.return===null){Ho=1,bp=g,ta=null;break}e:{var le=d,ze=E.return,Et=E,Ft=g;if(g=Ca,Et.flags|=32768,Ft!==null&&typeof Ft=="object"&&typeof Ft.then=="function"){var yn=Ft,Jn=Et,rr=Jn.tag;if((Jn.mode&1)===0&&(rr===0||rr===11||rr===15)){var Vn=Jn.alternate;Vn?(Jn.updateQueue=Vn.updateQueue,Jn.memoizedState=Vn.memoizedState,Jn.lanes=Vn.lanes):(Jn.updateQueue=null,Jn.memoizedState=null)}var Zr=Ci(ze);if(Zr!==null){Zr.flags&=-257,zn(Zr,ze,Et,le,g),Zr.mode&1&&Vr(le,yn,g),g=Zr,Ft=yn;var li=g.updateQueue;if(li===null){var di=new Set;di.add(Ft),g.updateQueue=di}else li.add(Ft);break e}else{if((g&1)===0){Vr(le,yn,g),N0();break e}Ft=Error(t(426))}}else if(v&&Et.mode&1){var bl=Ci(ze);if(bl!==null){(bl.flags&65536)===0&&(bl.flags|=256),zn(bl,ze,Et,le,g),Te(Hr(Ft,Et));break e}}le=Ft=Hr(Ft,Et),Ho!==4&&(Ho=2),jf===null?jf=[le]:jf.push(le),le=ze;do{switch(le.tag){case 3:le.flags|=65536,g&=-g,le.lanes|=g;var cn=Ri(le,Ft,g);ar(le,cn);break e;case 1:Et=Ft;var Gt=le.type,mn=le.stateNode;if((le.flags&128)===0&&(typeof Gt.getDerivedStateFromError=="function"||mn!==null&&typeof mn.componentDidCatch=="function"&&(vu===null||!vu.has(mn)))){le.flags|=65536,g&=-g,le.lanes|=g;var fr=jr(le,Et,g);ar(le,fr);break e}}le=le.return}while(le!==null)}F0(E)}catch(fi){g=fi,ta===E&&E!==null&&(ta=E=E.return);continue}break}while(!0)}function R0(){var d=rf.current;return rf.current=Yt,d===null?Yt:d}function N0(){(Ho===0||Ho===3||Ho===2)&&(Ho=4),Yl===null||(Ha&268435455)===0&&(am&268435455)===0||sf(Yl,Ca)}function hm(d,g){var E=ai;ai|=2;var N=R0();(Yl!==d||Ca!==g)&&(Xh=null,$f(d,g));do try{cx();break}catch(X){T_(d,X)}while(!0);if(kt(),ai=E,rf.current=N,ta!==null)throw Error(t(261));return Yl=null,Ca=0,Ho}function cx(){for(;ta!==null;)D0(ta)}function ux(){for(;ta!==null&&!nc();)D0(ta)}function D0(d){var g=hg(d.alternate,d,al);d.memoizedProps=d.pendingProps,g===null?F0(d):ta=g,sg.current=null}function F0(d){var g=d;do{var E=g.alternate;if(d=g.return,(g.flags&32768)===0){if(E=Ns(E,g,al),E!==null){ta=E;return}}else{if(E=fd(E,g),E!==null){E.flags&=32767,ta=E;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{Ho=6,ta=null;return}}if(g=g.sibling,g!==null){ta=g;return}ta=g=d}while(g!==null);Ho===0&&(Ho=5)}function lf(d,g,E){var N=zi,X=_c.transition;try{_c.transition=null,zi=1,O0(d,g,E,N)}finally{_c.transition=X,zi=N}return null}function O0(d,g,E,N){do ih();while(Kh!==null);if((ai&6)!==0)throw Error(t(327));E=d.finishedWork;var X=d.finishedLanes;if(E===null)return null;if(d.finishedWork=null,d.finishedLanes=0,E===d.current)throw Error(t(177));d.callbackNode=null,d.callbackPriority=0;var le=E.lanes|E.childLanes;if(Lr(d,le),d===Yl&&(ta=Yl=null,Ca=0),(E.subtreeFlags&2064)===0&&(E.flags&2064)===0||md||(md=!0,dm(Sa,function(){return ih(),null})),le=(E.flags&15990)!==0,(E.subtreeFlags&15990)!==0||le){le=_c.transition,_c.transition=null;var ze=zi;zi=1;var Et=ai;ai|=4,sg.current=null,Bf(d,E),ig(E,d),sc(gl),Tc=!!tu,gl=tu=null,d.current=E,xp(E),Hc(),ai=Et,zi=ze,_c.transition=le}else d.current=E;if(md&&(md=!1,Kh=d,Uf=X),le=d.pendingLanes,le===0&&(vu=null),pn(E.stateNode),xu(d,Oi()),g!==null)for(N=d.onRecoverableError,E=0;E<g.length;E++)X=g[E],N(X.value,{componentStack:X.stack,digest:X.digest});if(cm)throw cm=!1,d=k0,k0=null,d;return(Uf&1)!==0&&d.tag!==0&&ih(),le=d.pendingLanes,(le&1)!==0?d===ag?Vf++:(Vf=0,ag=d):Vf=0,ie(),null}function ih(){if(Kh!==null){var d=es(Uf),g=_c.transition,E=zi;try{if(_c.transition=null,zi=16>d?16:d,Kh===null)var N=!1;else{if(d=Kh,Kh=null,Uf=0,(ai&6)!==0)throw Error(t(331));var X=ai;for(ai|=4,Er=d.current;Er!==null;){var le=Er,ze=le.child;if((Er.flags&16)!==0){var Et=le.deletions;if(Et!==null){for(var Ft=0;Ft<Et.length;Ft++){var yn=Et[Ft];for(Er=yn;Er!==null;){var Jn=Er;switch(Jn.tag){case 0:case 11:case 15:Rd(8,Jn,le)}var rr=Jn.child;if(rr!==null)rr.return=Jn,Er=rr;else for(;Er!==null;){Jn=Er;var Vn=Jn.sibling,Zr=Jn.return;if(im(Jn),Jn===yn){Er=null;break}if(Vn!==null){Vn.return=Zr,Er=Vn;break}Er=Zr}}}var li=le.alternate;if(li!==null){var di=li.child;if(di!==null){li.child=null;do{var bl=di.sibling;di.sibling=null,di=bl}while(di!==null)}}Er=le}}if((le.subtreeFlags&2064)!==0&&ze!==null)ze.return=le,Er=ze;else e:for(;Er!==null;){if(le=Er,(le.flags&2048)!==0)switch(le.tag){case 0:case 11:case 15:Rd(9,le,le.return)}var cn=le.sibling;if(cn!==null){cn.return=le.return,Er=cn;break e}Er=le.return}}var Gt=d.current;for(Er=Gt;Er!==null;){ze=Er;var mn=ze.child;if((ze.subtreeFlags&2064)!==0&&mn!==null)mn.return=ze,Er=mn;else e:for(ze=Gt;Er!==null;){if(Et=Er,(Et.flags&2048)!==0)try{switch(Et.tag){case 0:case 11:case 15:yu(9,Et)}}catch(fi){xl(Et,Et.return,fi)}if(Et===ze){Er=null;break e}var fr=Et.sibling;if(fr!==null){fr.return=Et.return,Er=fr;break e}Er=Et.return}}if(ai=X,ie(),Ro&&typeof Ro.onPostCommitFiberRoot=="function")try{Ro.onPostCommitFiberRoot(Ea,d)}catch{}N=!0}return N}finally{zi=E,_c.transition=g}}return!1}function zu(d,g,E){g=Hr(E,g),g=Ri(d,g,1),d=kr(d,g,1),g=Bu(),d!==null&&(vi(d,1,g),xu(d,g))}function xl(d,g,E){if(d.tag===3)zu(d,d,E);else for(;g!==null;){if(g.tag===3){zu(g,d,E);break}else if(g.tag===1){var N=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof N.componentDidCatch=="function"&&(vu===null||!vu.has(N))){d=Hr(E,d),d=jr(g,d,1),g=kr(g,d,1),d=Bu(),g!==null&&(vi(g,1,d),xu(g,d));break}}g=g.return}}function B0(d,g,E){var N=d.pingCache;N!==null&&N.delete(g),g=Bu(),d.pingedLanes|=d.suspendedLanes&E,Yl===d&&(Ca&E)===E&&(Ho===4||Ho===3&&(Ca&130023424)===Ca&&500>Oi()-lm?$f(d,0):of|=E),xu(d,g)}function I_(d,g){g===0&&((d.mode&1)===0?g=1:(g=Za,Za<<=1,(Za&130023424)===0&&(Za=4194304)));var E=Bu();d=sn(d,g),d!==null&&(vi(d,g,E),xu(d,E))}function hx(d){var g=d.memoizedState,E=0;g!==null&&(E=g.retryLane),I_(d,E)}function dx(d,g){var E=0;switch(d.tag){case 13:var N=d.stateNode,X=d.memoizedState;X!==null&&(E=X.retryLane);break;case 19:N=d.stateNode;break;default:throw Error(t(314))}N!==null&&N.delete(g),I_(d,E)}var hg;hg=function(d,g,E){if(d!==null)if(d.memoizedProps!==g.pendingProps||Is.current)hn=!0;else{if((d.lanes&E)===0&&(g.flags&128)===0)return hn=!1,dd(d,g,E);hn=(d.flags&131072)!==0}else hn=!1,v&&(g.flags&1048576)!==0&&Kt(g,Ke,g.index);switch(g.lanes=0,g.tag){case 2:var N=g.type;nh(d,g),d=g.pendingProps;var X=$a(g,va.current);Ut(g,E),X=ld(null,g,N,d,X,E);var le=Pu();return g.flags|=1,typeof X=="object"&&X!==null&&typeof X.render=="function"&&X.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Pl(N)?(le=!0,Ia(g)):le=!1,g.memoizedState=X.state!==null&&X.state!==void 0?X.state:null,_n(g),X.updater=zr,g.stateNode=X,X._reactInternals=g,ni(g,N,d,E),g=bs(null,g,N,!0,le,E)):(g.tag=0,v&&le&&Sn(g),Rn(null,g,X,E),g=g.child),g;case 16:N=g.elementType;e:{switch(nh(d,g),d=g.pendingProps,X=N._init,N=X(N._payload),g.type=N,X=g.tag=fx(N),d=En(N,d),X){case 0:g=cs(null,g,N,d,E);break e;case 1:g=uo(null,g,N,d,E);break e;case 11:g=gr(null,g,N,d,E);break e;case 14:g=Xr(null,g,N,En(N.type,d),E);break e}throw Error(t(306,N,""))}return g;case 0:return N=g.type,X=g.pendingProps,X=g.elementType===N?X:En(N,X),cs(d,g,N,X,E);case 1:return N=g.type,X=g.pendingProps,X=g.elementType===N?X:En(N,X),uo(d,g,N,X,E);case 3:e:{if(Oa(g),d===null)throw Error(t(387));N=g.pendingProps,le=g.memoizedState,X=le.element,Mn(d,g),Wr(g,N,null,E);var ze=g.memoizedState;if(N=ze.element,le.isDehydrated)if(le={element:N,isDehydrated:!1,cache:ze.cache,pendingSuspenseBoundaries:ze.pendingSuspenseBoundaries,transitions:ze.transitions},g.updateQueue.baseState=le,g.memoizedState=le,g.flags&256){X=Hr(Error(t(423)),g),g=gc(d,g,N,E,X);break e}else if(N!==X){X=Hr(Error(t(424)),g),g=gc(d,g,N,E,X);break e}else for(f=Ta(g.stateNode.containerInfo.firstChild),a=g,v=!0,S=null,E=st(g,null,N,E),g.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling;else{if(Ae(),N===X){g=Du(d,g,E);break e}Rn(d,g,N,E)}g=g.child}return g;case 5:return il(g),d===null&&G(g),N=g.type,X=g.pendingProps,le=d!==null?d.memoizedProps:null,ze=X.children,Ju(N,X)?ze=null:le!==null&&Ju(N,le)&&(g.flags|=32),ti(d,g),Rn(d,g,ze,E),g.child;case 6:return d===null&&G(g),null;case 13:return _l(d,g,E);case 4:return Js(g,g.stateNode.containerInfo),N=g.pendingProps,d===null?g.child=rt(g,null,N,E):Rn(d,g,N,E),g.child;case 11:return N=g.type,X=g.pendingProps,X=g.elementType===N?X:En(N,X),gr(d,g,N,X,E);case 7:return Rn(d,g,g.pendingProps,E),g.child;case 8:return Rn(d,g,g.pendingProps.children,E),g.child;case 12:return Rn(d,g,g.pendingProps.children,E),g.child;case 10:e:{if(N=g.type._context,X=g.pendingProps,le=g.memoizedProps,ze=X.value,Xi(bt,N._currentValue),N._currentValue=ze,le!==null)if(ns(le.value,ze)){if(le.children===X.children&&!Is.current){g=Du(d,g,E);break e}}else for(le=g.child,le!==null&&(le.return=g);le!==null;){var Et=le.dependencies;if(Et!==null){ze=le.child;for(var Ft=Et.firstContext;Ft!==null;){if(Ft.context===N){if(le.tag===1){Ft=cr(-1,E&-E),Ft.tag=2;var yn=le.updateQueue;if(yn!==null){yn=yn.shared;var Jn=yn.pending;Jn===null?Ft.next=Ft:(Ft.next=Jn.next,Jn.next=Ft),yn.pending=Ft}}le.lanes|=E,Ft=le.alternate,Ft!==null&&(Ft.lanes|=E),gn(le.return,E,g),Et.lanes|=E;break}Ft=Ft.next}}else if(le.tag===10)ze=le.type===g.type?null:le.child;else if(le.tag===18){if(ze=le.return,ze===null)throw Error(t(341));ze.lanes|=E,Et=ze.alternate,Et!==null&&(Et.lanes|=E),gn(ze,E,g),ze=le.sibling}else ze=le.child;if(ze!==null)ze.return=le;else for(ze=le;ze!==null;){if(ze===g){ze=null;break}if(le=ze.sibling,le!==null){le.return=ze.return,ze=le;break}ze=ze.return}le=ze}Rn(d,g,X.children,E),g=g.child}return g;case 9:return X=g.type,N=g.pendingProps.children,Ut(g,E),X=un(X),N=N(X),g.flags|=1,Rn(d,g,N,E),g.child;case 14:return N=g.type,X=En(N,g.pendingProps),X=En(N.type,X),Xr(d,g,N,X,E);case 15:return Ni(d,g,g.type,g.pendingProps,E);case 17:return N=g.type,X=g.pendingProps,X=g.elementType===N?X:En(N,X),nh(d,g),g.tag=1,Pl(N)?(d=!0,Ia(g)):d=!1,Ut(g,E),vr(g,N,X),ni(g,N,X,E),bs(null,g,N,!0,d,E);case 19:return kd(d,g,E);case 22:return sl(d,g,E)}throw Error(t(156,g.tag))};function dm(d,g){return jl(d,g)}function C_(d,g,E,N){this.tag=d,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=N,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function jc(d,g,E,N){return new C_(d,g,E,N)}function Gf(d){return d=d.prototype,!(!d||!d.isReactComponent)}function fx(d){if(typeof d=="function")return Gf(d)?1:0;if(d!=null){if(d=d.$$typeof,d===W)return 11;if(d===ke)return 14}return 2}function cf(d,g){var E=d.alternate;return E===null?(E=jc(d.tag,g,d.key,d.mode),E.elementType=d.elementType,E.type=d.type,E.stateNode=d.stateNode,E.alternate=d,d.alternate=E):(E.pendingProps=g,E.type=d.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=d.flags&14680064,E.childLanes=d.childLanes,E.lanes=d.lanes,E.child=d.child,E.memoizedProps=d.memoizedProps,E.memoizedState=d.memoizedState,E.updateQueue=d.updateQueue,g=d.dependencies,E.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},E.sibling=d.sibling,E.index=d.index,E.ref=d.ref,E}function dg(d,g,E,N,X,le){var ze=2;if(N=d,typeof d=="function")Gf(d)&&(ze=1);else if(typeof d=="string")ze=5;else e:switch(d){case de:return Wf(E.children,X,le,g);case j:ze=8,X|=8;break;case D:return d=jc(12,E,g,X|2),d.elementType=D,d.lanes=le,d;case Z:return d=jc(13,E,g,X),d.elementType=Z,d.lanes=le,d;case Ee:return d=jc(19,E,g,X),d.elementType=Ee,d.lanes=le,d;case Re:return fg(E,X,le,g);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case $:ze=10;break e;case z:ze=9;break e;case W:ze=11;break e;case ke:ze=14;break e;case Oe:ze=16,N=null;break e}throw Error(t(130,d==null?d:typeof d,""))}return g=jc(ze,E,g,X),g.elementType=d,g.type=N,g.lanes=le,g}function Wf(d,g,E,N){return d=jc(7,d,N,g),d.lanes=E,d}function fg(d,g,E,N){return d=jc(22,d,N,g),d.elementType=Re,d.lanes=E,d.stateNode={isHidden:!1},d}function z0(d,g,E){return d=jc(6,d,null,g),d.lanes=E,d}function j0(d,g,E){return g=jc(4,d.children!==null?d.children:[],d.key,g),g.lanes=E,g.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},g}function U0(d,g,E,N,X){this.tag=g,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=fa(0),this.expirationTimes=fa(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fa(0),this.identifierPrefix=N,this.onRecoverableError=X,this.mutableSourceEagerHydrationData=null}function V0(d,g,E,N,X,le,ze,Et,Ft){return d=new U0(d,g,E,Et,Ft),g===1?(g=1,le===!0&&(g|=8)):g=0,le=jc(3,null,null,g),d.current=le,le.stateNode=d,le.memoizedState={element:N,isDehydrated:E,cache:null,transitions:null,pendingSuspenseBoundaries:null},_n(le),d}function Ep(d,g,E){var N=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ve,key:N==null?null:""+N,children:d,containerInfo:g,implementation:E}}function L_(d){if(!d)return Ll;d=d._reactInternals;e:{if(Ji(d)!==d||d.tag!==1)throw Error(t(170));var g=d;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Pl(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(t(171))}if(d.tag===1){var E=d.type;if(Pl(E))return Dc(d,E,g)}return g}function Xa(d,g,E,N,X,le,ze,Et,Ft){return d=V0(E,N,!0,d,X,le,ze,Et,Ft),d.context=L_(null),E=d.current,N=Bu(),X=gd(E),le=cr(N,X),le.callback=g??null,kr(E,le,X),d.current.lanes=X,vi(d,X,N),xu(d,N),d}function Hf(d,g,E,N){var X=g.current,le=Bu(),ze=gd(X);return E=L_(E),g.context===null?g.context=E:g.pendingContext=E,g=cr(le,ze),g.payload={element:d},N=N===void 0?null:N,N!==null&&(g.callback=N),d=kr(X,g,ze),d!==null&&(Zh(d,X,ze,le),er(d,X,ze)),ze}function fm(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function pm(d,g){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var E=d.retryLane;d.retryLane=E!==0&&E<g?E:g}}function Ap(d,g){pm(d,g),(d=d.alternate)&&pm(d,g)}function mm(){return null}var q0=typeof reportError=="function"?reportError:function(d){console.error(d)};function pg(d){this._internalRoot=d}uf.prototype.render=pg.prototype.render=function(d){var g=this._internalRoot;if(g===null)throw Error(t(409));Hf(d,g,null,null)},uf.prototype.unmount=pg.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var g=d.containerInfo;af(function(){Hf(null,d,null,null)}),g[_a]=null}};function uf(d){this._internalRoot=d}uf.prototype.unstable_scheduleHydration=function(d){if(d){var g=Ac();d={blockedOn:null,target:d,priority:g};for(var E=0;E<No.length&&g!==0&&g<No[E].priority;E++);No.splice(E,0,d),E===0&&Ku(d)}};function gm(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function Tp(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function mg(){}function px(d,g,E,N,X){if(X){if(typeof N=="function"){var le=N;N=function(){var yn=fm(ze);le.call(yn)}}var ze=Xa(g,N,d,0,null,!1,!1,"",mg);return d._reactRootContainer=ze,d[_a]=ze.current,Vi(d.nodeType===8?d.parentNode:d),af(),ze}for(;X=d.lastChild;)d.removeChild(X);if(typeof N=="function"){var Et=N;N=function(){var yn=fm(Ft);Et.call(yn)}}var Ft=V0(d,0,!1,null,null,!1,!1,"",mg);return d._reactRootContainer=Ft,d[_a]=Ft.current,Vi(d.nodeType===8?d.parentNode:d),af(function(){Hf(g,Ft,E,N)}),Ft}function ym(d,g,E,N,X){var le=E._reactRootContainer;if(le){var ze=le;if(typeof X=="function"){var Et=X;X=function(){var Ft=fm(ze);Et.call(Ft)}}Hf(g,ze,d,X)}else ze=px(E,g,d,X,N);return fm(ze)}_o=function(d){switch(d.tag){case 3:var g=d.stateNode;if(g.current.memoizedState.isDehydrated){var E=ls(g.pendingLanes);E!==0&&(dl(g,E|1),xu(g,Oi()),(ai&6)===0&&(wp=Oi()+500,ie()))}break;case 13:af(function(){var N=sn(d,1);if(N!==null){var X=Bu();Zh(N,d,1,X)}}),Ap(d,1)}},Tu=function(d){if(d.tag===13){var g=sn(d,134217728);if(g!==null){var E=Bu();Zh(g,d,134217728,E)}Ap(d,134217728)}},Sl=function(d){if(d.tag===13){var g=gd(d),E=sn(d,g);if(E!==null){var N=Bu();Zh(E,d,g,N)}Ap(d,g)}},Ac=function(){return zi},rc=function(d,g){var E=zi;try{return zi=d,g()}finally{zi=E}},ut=function(d,g,E){switch(g){case"input":if(xr(d,E),g=E.name,E.type==="radio"&&g!=null){for(E=d;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<E.length;g++){var N=E[g];if(N!==d&&N.form===d.form){var X=Ph(N);if(!X)throw Error(t(90));fn(N),xr(N,X)}}}break;case"textarea":Nn(d,E);break;case"select":g=E.value,g!=null&&$n(d,!!E.multiple,g,!1)}},Rt=Sp,Bt=af;var _m={usingClientEntryPoint:!1,Events:[Rc,eh,Ph,ct,Ct,Sp]},vm={findFiberByHostInstance:Fa,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},$0={bundleType:vm.bundleType,version:vm.version,rendererPackageName:vm.rendererPackageName,rendererConfig:vm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:he.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=La(d),d===null?null:d.stateNode},findFiberByHostInstance:vm.findFiberByHostInstance||mm,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gg.isDisabled&&gg.supportsFiber)try{Ea=gg.inject($0),Ro=gg}catch{}}return Bh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_m,Bh.createPortal=function(d,g){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!gm(g))throw Error(t(200));return Ep(d,g,null,E)},Bh.createRoot=function(d,g){if(!gm(d))throw Error(t(299));var E=!1,N="",X=q0;return g!=null&&(g.unstable_strictMode===!0&&(E=!0),g.identifierPrefix!==void 0&&(N=g.identifierPrefix),g.onRecoverableError!==void 0&&(X=g.onRecoverableError)),g=V0(d,1,!1,null,null,E,!1,N,X),d[_a]=g.current,Vi(d.nodeType===8?d.parentNode:d),new pg(g)},Bh.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var g=d._reactInternals;if(g===void 0)throw typeof d.render=="function"?Error(t(188)):(d=Object.keys(d).join(","),Error(t(268,d)));return d=La(g),d=d===null?null:d.stateNode,d},Bh.flushSync=function(d){return af(d)},Bh.hydrate=function(d,g,E){if(!Tp(g))throw Error(t(200));return ym(null,d,g,!0,E)},Bh.hydrateRoot=function(d,g,E){if(!gm(d))throw Error(t(405));var N=E!=null&&E.hydratedSources||null,X=!1,le="",ze=q0;if(E!=null&&(E.unstable_strictMode===!0&&(X=!0),E.identifierPrefix!==void 0&&(le=E.identifierPrefix),E.onRecoverableError!==void 0&&(ze=E.onRecoverableError)),g=Xa(g,null,d,1,E??null,X,!1,le,ze),d[_a]=g.current,Vi(d),N)for(d=0;d<N.length;d++)E=N[d],X=E._getVersion,X=X(E._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[E,X]:g.mutableSourceEagerHydrationData.push(E,X);return new uf(g)},Bh.render=function(d,g,E){if(!Tp(g))throw Error(t(200));return ym(null,d,g,!1,E)},Bh.unmountComponentAtNode=function(d){if(!Tp(d))throw Error(t(40));return d._reactRootContainer?(af(function(){ym(null,null,d,!1,function(){d._reactRootContainer=null,d[_a]=null})}),!0):!1},Bh.unstable_batchedUpdates=Sp,Bh.unstable_renderSubtreeIntoContainer=function(d,g,E,N){if(!Tp(E))throw Error(t(200));if(d==null||d._reactInternals===void 0)throw Error(t(38));return ym(d,g,E,!1,N)},Bh.version="18.3.1-next-f1338f8080-20240426",Bh}var n2;function aL(){if(n2)return Hx.exports;n2=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Hx.exports=sL(),Hx.exports}var r2;function lL(){if(r2)return Z_;r2=1;var n=aL();return Z_.createRoot=n.createRoot,Z_.hydrateRoot=n.hydrateRoot,Z_}var cL=lL();const uL=Dv(cL);/**
 * react-router v7.8.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var i2="popstate";function hL(n={}){function e(i,c){let{pathname:u,search:m,hash:_}=i.location;return Zb("",{pathname:u,search:m,hash:_},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function t(i,c){return typeof c=="string"?c:$y(c)}return fL(e,t,null,n)}function Ol(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function kf(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function dL(){return Math.random().toString(36).substring(2,10)}function o2(n,e){return{usr:n.state,key:n.key,idx:e}}function Zb(n,e,t=null,i){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?_0(e):e,state:t,key:e&&e.key||i||dL()}}function $y({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function _0(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substring(i),n=n.substring(0,i)),n&&(e.pathname=n)}return e}function fL(n,e,t,i={}){let{window:c=document.defaultView,v5Compat:u=!1}=i,m=c.history,_="POP",o=null,w=I();w==null&&(w=0,m.replaceState({...m.state,idx:w},""));function I(){return(m.state||{idx:null}).idx}function O(){_="POP";let fe=I(),ne=fe==null?null:fe-w;w=fe,o&&o({action:_,location:ce.location,delta:ne})}function V(fe,ne){_="PUSH";let oe=Zb(ce.location,fe,ne);w=I()+1;let ye=o2(oe,w),he=ce.createHref(oe);try{m.pushState(ye,"",he)}catch(Ne){if(Ne instanceof DOMException&&Ne.name==="DataCloneError")throw Ne;c.location.assign(he)}u&&o&&o({action:_,location:ce.location,delta:1})}function M(fe,ne){_="REPLACE";let oe=Zb(ce.location,fe,ne);w=I();let ye=o2(oe,w),he=ce.createHref(oe);m.replaceState(ye,"",he),u&&o&&o({action:_,location:ce.location,delta:0})}function se(fe){return pL(fe)}let ce={get action(){return _},get location(){return n(c,m)},listen(fe){if(o)throw new Error("A history only accepts one active listener");return c.addEventListener(i2,O),o=fe,()=>{c.removeEventListener(i2,O),o=null}},createHref(fe){return e(c,fe)},createURL:se,encodeLocation(fe){let ne=se(fe);return{pathname:ne.pathname,search:ne.search,hash:ne.hash}},push:V,replace:M,go(fe){return m.go(fe)}};return ce}function pL(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Ol(t,"No window.location.(origin|href) available to create URL");let i=typeof n=="string"?n:$y(n);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=t+i),new URL(i,t)}function nT(n,e,t="/"){return mL(n,e,t,!1)}function mL(n,e,t,i){let c=typeof e=="string"?_0(e):e,u=dp(c.pathname||"/",t);if(u==null)return null;let m=rT(n);gL(m);let _=null;for(let o=0;_==null&&o<m.length;++o){let w=IL(u);_=AL(m[o],w,i)}return _}function rT(n,e=[],t=[],i="",c=!1){let u=(m,_,o=c,w)=>{let I={relativePath:w===void 0?m.path||"":w,caseSensitive:m.caseSensitive===!0,childrenIndex:_,route:m};if(I.relativePath.startsWith("/")){if(!I.relativePath.startsWith(i)&&o)return;Ol(I.relativePath.startsWith(i),`Absolute route path "${I.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),I.relativePath=I.relativePath.slice(i.length)}let O=cp([i,I.relativePath]),V=t.concat(I);m.children&&m.children.length>0&&(Ol(m.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${O}".`),rT(m.children,e,V,O,o)),!(m.path==null&&!m.index)&&e.push({path:O,score:SL(O,m.index),routesMeta:V})};return n.forEach((m,_)=>{if(m.path===""||!m.path?.includes("?"))u(m,_);else for(let o of iT(m.path))u(m,_,!0,o)}),e}function iT(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,c=t.endsWith("?"),u=t.replace(/\?$/,"");if(i.length===0)return c?[u,""]:[u];let m=iT(i.join("/")),_=[];return _.push(...m.map(o=>o===""?u:[u,o].join("/"))),c&&_.push(...m),_.map(o=>n.startsWith("/")&&o===""?"/":o)}function gL(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:EL(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var yL=/^:[\w-]+$/,_L=3,vL=2,xL=1,bL=10,wL=-2,s2=n=>n==="*";function SL(n,e){let t=n.split("/"),i=t.length;return t.some(s2)&&(i+=wL),e&&(i+=vL),t.filter(c=>!s2(c)).reduce((c,u)=>c+(yL.test(u)?_L:u===""?xL:bL),i)}function EL(n,e){return n.length===e.length&&n.slice(0,-1).every((i,c)=>i===e[c])?n[n.length-1]-e[e.length-1]:0}function AL(n,e,t=!1){let{routesMeta:i}=n,c={},u="/",m=[];for(let _=0;_<i.length;++_){let o=i[_],w=_===i.length-1,I=u==="/"?e:e.slice(u.length)||"/",O=Q1({path:o.relativePath,caseSensitive:o.caseSensitive,end:w},I),V=o.route;if(!O&&w&&t&&!i[i.length-1].route.index&&(O=Q1({path:o.relativePath,caseSensitive:o.caseSensitive,end:!1},I)),!O)return null;Object.assign(c,O.params),m.push({params:c,pathname:cp([u,O.pathname]),pathnameBase:kL(cp([u,O.pathnameBase])),route:V}),O.pathnameBase!=="/"&&(u=cp([u,O.pathnameBase]))}return m}function Q1(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=TL(n.path,n.caseSensitive,n.end),c=e.match(t);if(!c)return null;let u=c[0],m=u.replace(/(.)\/+$/,"$1"),_=c.slice(1);return{params:i.reduce((w,{paramName:I,isOptional:O},V)=>{if(I==="*"){let se=_[V]||"";m=u.slice(0,u.length-se.length).replace(/(.)\/+$/,"$1")}const M=_[V];return O&&!M?w[I]=void 0:w[I]=(M||"").replace(/%2F/g,"/"),w},{}),pathname:u,pathnameBase:m,pattern:n}}function TL(n,e=!1,t=!0){kf(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let i=[],c="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(m,_,o)=>(i.push({paramName:_,isOptional:o!=null}),o?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(i.push({paramName:"*"}),c+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?c+="\\/*$":n!==""&&n!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,e?void 0:"i"),i]}function IL(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return kf(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function dp(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}function CL(n,e="/"){let{pathname:t,search:i="",hash:c=""}=typeof n=="string"?_0(n):n;return{pathname:t?t.startsWith("/")?t:LL(t,e):e,search:ML(i),hash:RL(c)}}function LL(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(c=>{c===".."?t.length>1&&t.pop():c!=="."&&t.push(c)}),t.length>1?t.join("/"):"/"}function Zx(n,e,t,i){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function PL(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function oT(n){let e=PL(n);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function sT(n,e,t,i=!1){let c;typeof n=="string"?c=_0(n):(c={...n},Ol(!c.pathname||!c.pathname.includes("?"),Zx("?","pathname","search",c)),Ol(!c.pathname||!c.pathname.includes("#"),Zx("#","pathname","hash",c)),Ol(!c.search||!c.search.includes("#"),Zx("#","search","hash",c)));let u=n===""||c.pathname==="",m=u?"/":c.pathname,_;if(m==null)_=t;else{let O=e.length-1;if(!i&&m.startsWith("..")){let V=m.split("/");for(;V[0]==="..";)V.shift(),O-=1;c.pathname=V.join("/")}_=O>=0?e[O]:"/"}let o=CL(c,_),w=m&&m!=="/"&&m.endsWith("/"),I=(u||m===".")&&t.endsWith("/");return!o.pathname.endsWith("/")&&(w||I)&&(o.pathname+="/"),o}var cp=n=>n.join("/").replace(/\/\/+/g,"/"),kL=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),ML=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,RL=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function NL(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var aT=["POST","PUT","PATCH","DELETE"];new Set(aT);var DL=["GET",...aT];new Set(DL);var v0=Fn.createContext(null);v0.displayName="DataRouter";var Fv=Fn.createContext(null);Fv.displayName="DataRouterState";Fn.createContext(!1);var lT=Fn.createContext({isTransitioning:!1});lT.displayName="ViewTransition";var FL=Fn.createContext(new Map);FL.displayName="Fetchers";var OL=Fn.createContext(null);OL.displayName="Await";var Nf=Fn.createContext(null);Nf.displayName="Navigation";var o_=Fn.createContext(null);o_.displayName="Location";var Df=Fn.createContext({outlet:null,matches:[],isDataRoute:!1});Df.displayName="Route";var K5=Fn.createContext(null);K5.displayName="RouteError";function BL(n,{relative:e}={}){Ol(s_(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=Fn.useContext(Nf),{hash:c,pathname:u,search:m}=a_(n,{relative:e}),_=u;return t!=="/"&&(_=u==="/"?t:cp([t,u])),i.createHref({pathname:_,search:m,hash:c})}function s_(){return Fn.useContext(o_)!=null}function Zm(){return Ol(s_(),"useLocation() may be used only in the context of a <Router> component."),Fn.useContext(o_).location}var cT="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function uT(n){Fn.useContext(Nf).static||Fn.useLayoutEffect(n)}function zL(){let{isDataRoute:n}=Fn.useContext(Df);return n?QL():jL()}function jL(){Ol(s_(),"useNavigate() may be used only in the context of a <Router> component.");let n=Fn.useContext(v0),{basename:e,navigator:t}=Fn.useContext(Nf),{matches:i}=Fn.useContext(Df),{pathname:c}=Zm(),u=JSON.stringify(oT(i)),m=Fn.useRef(!1);return uT(()=>{m.current=!0}),Fn.useCallback((o,w={})=>{if(kf(m.current,cT),!m.current)return;if(typeof o=="number"){t.go(o);return}let I=sT(o,JSON.parse(u),c,w.relative==="path");n==null&&e!=="/"&&(I.pathname=I.pathname==="/"?e:cp([e,I.pathname])),(w.replace?t.replace:t.push)(I,w.state,w)},[e,t,u,c,n])}Fn.createContext(null);function UL(){let{matches:n}=Fn.useContext(Df),e=n[n.length-1];return e?e.params:{}}function a_(n,{relative:e}={}){let{matches:t}=Fn.useContext(Df),{pathname:i}=Zm(),c=JSON.stringify(oT(t));return Fn.useMemo(()=>sT(n,JSON.parse(c),i,e==="path"),[n,c,i,e])}function VL(n,e){return hT(n,e)}function hT(n,e,t,i){Ol(s_(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:c}=Fn.useContext(Nf),{matches:u}=Fn.useContext(Df),m=u[u.length-1],_=m?m.params:{},o=m?m.pathname:"/",w=m?m.pathnameBase:"/",I=m&&m.route;{let ne=I&&I.path||"";dT(o,!I||ne.endsWith("*")||ne.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${o}" (under <Route path="${ne}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ne}"> to <Route path="${ne==="/"?"*":`${ne}/*`}">.`)}let O=Zm(),V;if(e){let ne=typeof e=="string"?_0(e):e;Ol(w==="/"||ne.pathname?.startsWith(w),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${w}" but pathname "${ne.pathname}" was given in the \`location\` prop.`),V=ne}else V=O;let M=V.pathname||"/",se=M;if(w!=="/"){let ne=w.replace(/^\//,"").split("/");se="/"+M.replace(/^\//,"").split("/").slice(ne.length).join("/")}let ce=nT(n,{pathname:se});kf(I||ce!=null,`No routes matched location "${V.pathname}${V.search}${V.hash}" `),kf(ce==null||ce[ce.length-1].route.element!==void 0||ce[ce.length-1].route.Component!==void 0||ce[ce.length-1].route.lazy!==void 0,`Matched leaf route at location "${V.pathname}${V.search}${V.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let fe=HL(ce&&ce.map(ne=>Object.assign({},ne,{params:Object.assign({},_,ne.params),pathname:cp([w,c.encodeLocation?c.encodeLocation(ne.pathname).pathname:ne.pathname]),pathnameBase:ne.pathnameBase==="/"?w:cp([w,c.encodeLocation?c.encodeLocation(ne.pathnameBase).pathname:ne.pathnameBase])})),u,t,i);return e&&fe?Fn.createElement(o_.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...V},navigationType:"POP"}},fe):fe}function qL(){let n=JL(),e=NL(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i="rgba(200,200,200, 0.5)",c={padding:"0.5rem",backgroundColor:i},u={padding:"2px 4px",backgroundColor:i},m=null;return console.error("Error handled by React Router default ErrorBoundary:",n),m=Fn.createElement(Fn.Fragment,null,Fn.createElement("p",null," Hey developer "),Fn.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Fn.createElement("code",{style:u},"ErrorBoundary")," or"," ",Fn.createElement("code",{style:u},"errorElement")," prop on your route.")),Fn.createElement(Fn.Fragment,null,Fn.createElement("h2",null,"Unexpected Application Error!"),Fn.createElement("h3",{style:{fontStyle:"italic"}},e),t?Fn.createElement("pre",{style:c},t):null,m)}var $L=Fn.createElement(qL,null),GL=class extends Fn.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?Fn.createElement(Df.Provider,{value:this.props.routeContext},Fn.createElement(K5.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function WL({routeContext:n,match:e,children:t}){let i=Fn.useContext(v0);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),Fn.createElement(Df.Provider,{value:n},t)}function HL(n,e=[],t=null,i=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let c=n,u=t?.errors;if(u!=null){let o=c.findIndex(w=>w.route.id&&u?.[w.route.id]!==void 0);Ol(o>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(u).join(",")}`),c=c.slice(0,Math.min(c.length,o+1))}let m=!1,_=-1;if(t)for(let o=0;o<c.length;o++){let w=c[o];if((w.route.HydrateFallback||w.route.hydrateFallbackElement)&&(_=o),w.route.id){let{loaderData:I,errors:O}=t,V=w.route.loader&&!I.hasOwnProperty(w.route.id)&&(!O||O[w.route.id]===void 0);if(w.route.lazy||V){m=!0,_>=0?c=c.slice(0,_+1):c=[c[0]];break}}}return c.reduceRight((o,w,I)=>{let O,V=!1,M=null,se=null;t&&(O=u&&w.route.id?u[w.route.id]:void 0,M=w.route.errorElement||$L,m&&(_<0&&I===0?(dT("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),V=!0,se=null):_===I&&(V=!0,se=w.route.hydrateFallbackElement||null)));let ce=e.concat(c.slice(0,I+1)),fe=()=>{let ne;return O?ne=M:V?ne=se:w.route.Component?ne=Fn.createElement(w.route.Component,null):w.route.element?ne=w.route.element:ne=o,Fn.createElement(WL,{match:w,routeContext:{outlet:o,matches:ce,isDataRoute:t!=null},children:ne})};return t&&(w.route.ErrorBoundary||w.route.errorElement||I===0)?Fn.createElement(GL,{location:t.location,revalidation:t.revalidation,component:M,error:O,children:fe(),routeContext:{outlet:null,matches:ce,isDataRoute:!0}}):fe()},null)}function Z5(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function XL(n){let e=Fn.useContext(v0);return Ol(e,Z5(n)),e}function KL(n){let e=Fn.useContext(Fv);return Ol(e,Z5(n)),e}function ZL(n){let e=Fn.useContext(Df);return Ol(e,Z5(n)),e}function Y5(n){let e=ZL(n),t=e.matches[e.matches.length-1];return Ol(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function YL(){return Y5("useRouteId")}function JL(){let n=Fn.useContext(K5),e=KL("useRouteError"),t=Y5("useRouteError");return n!==void 0?n:e.errors?.[t]}function QL(){let{router:n}=XL("useNavigate"),e=Y5("useNavigate"),t=Fn.useRef(!1);return uT(()=>{t.current=!0}),Fn.useCallback(async(c,u={})=>{kf(t.current,cT),t.current&&(typeof c=="number"?n.navigate(c):await n.navigate(c,{fromRouteId:e,...u}))},[n,e])}var a2={};function dT(n,e,t){!e&&!a2[n]&&(a2[n]=!0,kf(!1,t))}Fn.memo(eP);function eP({routes:n,future:e,state:t}){return hT(n,void 0,t,e)}function Cm(n){Ol(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function tP({basename:n="/",children:e=null,location:t,navigationType:i="POP",navigator:c,static:u=!1}){Ol(!s_(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let m=n.replace(/^\/*/,"/"),_=Fn.useMemo(()=>({basename:m,navigator:c,static:u,future:{}}),[m,c,u]);typeof t=="string"&&(t=_0(t));let{pathname:o="/",search:w="",hash:I="",state:O=null,key:V="default"}=t,M=Fn.useMemo(()=>{let se=dp(o,m);return se==null?null:{location:{pathname:se,search:w,hash:I,state:O,key:V},navigationType:i}},[m,o,w,I,O,V,i]);return kf(M!=null,`<Router basename="${m}"> is not able to match the URL "${o}${w}${I}" because it does not start with the basename, so the <Router> won't render anything.`),M==null?null:Fn.createElement(Nf.Provider,{value:_},Fn.createElement(o_.Provider,{children:e,value:M}))}function nP({children:n,location:e}){return VL(Yb(n),e)}function Yb(n,e=[]){let t=[];return Fn.Children.forEach(n,(i,c)=>{if(!Fn.isValidElement(i))return;let u=[...e,c];if(i.type===Fn.Fragment){t.push.apply(t,Yb(i.props.children,u));return}Ol(i.type===Cm,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ol(!i.props.index||!i.props.children,"An index route cannot have child routes.");let m={id:i.props.id||u.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(m.children=Yb(i.props.children,u)),t.push(m)}),t}var E1="get",A1="application/x-www-form-urlencoded";function Ov(n){return n!=null&&typeof n.tagName=="string"}function rP(n){return Ov(n)&&n.tagName.toLowerCase()==="button"}function iP(n){return Ov(n)&&n.tagName.toLowerCase()==="form"}function oP(n){return Ov(n)&&n.tagName.toLowerCase()==="input"}function sP(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function aP(n,e){return n.button===0&&(!e||e==="_self")&&!sP(n)}var Y_=null;function lP(){if(Y_===null)try{new FormData(document.createElement("form"),0),Y_=!1}catch{Y_=!0}return Y_}var cP=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Yx(n){return n!=null&&!cP.has(n)?(kf(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${A1}"`),null):n}function uP(n,e){let t,i,c,u,m;if(iP(n)){let _=n.getAttribute("action");i=_?dp(_,e):null,t=n.getAttribute("method")||E1,c=Yx(n.getAttribute("enctype"))||A1,u=new FormData(n)}else if(rP(n)||oP(n)&&(n.type==="submit"||n.type==="image")){let _=n.form;if(_==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let o=n.getAttribute("formaction")||_.getAttribute("action");if(i=o?dp(o,e):null,t=n.getAttribute("formmethod")||_.getAttribute("method")||E1,c=Yx(n.getAttribute("formenctype"))||Yx(_.getAttribute("enctype"))||A1,u=new FormData(_,n),!lP()){let{name:w,type:I,value:O}=n;if(I==="image"){let V=w?`${w}.`:"";u.append(`${V}x`,"0"),u.append(`${V}y`,"0")}else w&&u.append(w,O)}}else{if(Ov(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=E1,i=null,c=A1,m=n}return u&&c==="text/plain"&&(m=u,u=void 0),{action:i,method:t.toLowerCase(),encType:c,formData:u,body:m}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function J5(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function hP(n,e,t){let i=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return i.pathname==="/"?i.pathname=`_root.${t}`:e&&dp(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${t}`,i}async function dP(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function fP(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function pP(n,e,t){let i=await Promise.all(n.map(async c=>{let u=e.routes[c.route.id];if(u){let m=await dP(u,t);return m.links?m.links():[]}return[]}));return _P(i.flat(1).filter(fP).filter(c=>c.rel==="stylesheet"||c.rel==="preload").map(c=>c.rel==="stylesheet"?{...c,rel:"prefetch",as:"style"}:{...c,rel:"prefetch"}))}function l2(n,e,t,i,c,u){let m=(o,w)=>t[w]?o.route.id!==t[w].route.id:!0,_=(o,w)=>t[w].pathname!==o.pathname||t[w].route.path?.endsWith("*")&&t[w].params["*"]!==o.params["*"];return u==="assets"?e.filter((o,w)=>m(o,w)||_(o,w)):u==="data"?e.filter((o,w)=>{let I=i.routes[o.route.id];if(!I||!I.hasLoader)return!1;if(m(o,w)||_(o,w))return!0;if(o.route.shouldRevalidate){let O=o.route.shouldRevalidate({currentUrl:new URL(c.pathname+c.search+c.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:o.params,defaultShouldRevalidate:!0});if(typeof O=="boolean")return O}return!0}):[]}function mP(n,e,{includeHydrateFallback:t}={}){return gP(n.map(i=>{let c=e.routes[i.route.id];if(!c)return[];let u=[c.module];return c.clientActionModule&&(u=u.concat(c.clientActionModule)),c.clientLoaderModule&&(u=u.concat(c.clientLoaderModule)),t&&c.hydrateFallbackModule&&(u=u.concat(c.hydrateFallbackModule)),c.imports&&(u=u.concat(c.imports)),u}).flat(1))}function gP(n){return[...new Set(n)]}function yP(n){let e={},t=Object.keys(n).sort();for(let i of t)e[i]=n[i];return e}function _P(n,e){let t=new Set;return new Set(e),n.reduce((i,c)=>{let u=JSON.stringify(yP(c));return t.has(u)||(t.add(u),i.push({key:u,link:c})),i},[])}function fT(){let n=Fn.useContext(v0);return J5(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function vP(){let n=Fn.useContext(Fv);return J5(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var Q5=Fn.createContext(void 0);Q5.displayName="FrameworkContext";function pT(){let n=Fn.useContext(Q5);return J5(n,"You must render this element inside a <HydratedRouter> element"),n}function xP(n,e){let t=Fn.useContext(Q5),[i,c]=Fn.useState(!1),[u,m]=Fn.useState(!1),{onFocus:_,onBlur:o,onMouseEnter:w,onMouseLeave:I,onTouchStart:O}=e,V=Fn.useRef(null);Fn.useEffect(()=>{if(n==="render"&&m(!0),n==="viewport"){let ce=ne=>{ne.forEach(oe=>{m(oe.isIntersecting)})},fe=new IntersectionObserver(ce,{threshold:.5});return V.current&&fe.observe(V.current),()=>{fe.disconnect()}}},[n]),Fn.useEffect(()=>{if(i){let ce=setTimeout(()=>{m(!0)},100);return()=>{clearTimeout(ce)}}},[i]);let M=()=>{c(!0)},se=()=>{c(!1),m(!1)};return t?n!=="intent"?[u,V,{}]:[u,V,{onFocus:cy(_,M),onBlur:cy(o,se),onMouseEnter:cy(w,M),onMouseLeave:cy(I,se),onTouchStart:cy(O,M)}]:[!1,V,{}]}function cy(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function bP({page:n,...e}){let{router:t}=fT(),i=Fn.useMemo(()=>nT(t.routes,n,t.basename),[t.routes,n,t.basename]);return i?Fn.createElement(SP,{page:n,matches:i,...e}):null}function wP(n){let{manifest:e,routeModules:t}=pT(),[i,c]=Fn.useState([]);return Fn.useEffect(()=>{let u=!1;return pP(n,e,t).then(m=>{u||c(m)}),()=>{u=!0}},[n,e,t]),i}function SP({page:n,matches:e,...t}){let i=Zm(),{manifest:c,routeModules:u}=pT(),{basename:m}=fT(),{loaderData:_,matches:o}=vP(),w=Fn.useMemo(()=>l2(n,e,o,c,i,"data"),[n,e,o,c,i]),I=Fn.useMemo(()=>l2(n,e,o,c,i,"assets"),[n,e,o,c,i]),O=Fn.useMemo(()=>{if(n===i.pathname+i.search+i.hash)return[];let se=new Set,ce=!1;if(e.forEach(ne=>{let oe=c.routes[ne.route.id];!oe||!oe.hasLoader||(!w.some(ye=>ye.route.id===ne.route.id)&&ne.route.id in _&&u[ne.route.id]?.shouldRevalidate||oe.hasClientLoader?ce=!0:se.add(ne.route.id))}),se.size===0)return[];let fe=hP(n,m,"data");return ce&&se.size>0&&fe.searchParams.set("_routes",e.filter(ne=>se.has(ne.route.id)).map(ne=>ne.route.id).join(",")),[fe.pathname+fe.search]},[m,_,i,c,w,e,n,u]),V=Fn.useMemo(()=>mP(I,c),[I,c]),M=wP(I);return Fn.createElement(Fn.Fragment,null,O.map(se=>Fn.createElement("link",{key:se,rel:"prefetch",as:"fetch",href:se,...t})),V.map(se=>Fn.createElement("link",{key:se,rel:"modulepreload",href:se,...t})),M.map(({key:se,link:ce})=>Fn.createElement("link",{key:se,nonce:t.nonce,...ce})))}function EP(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var mT=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{mT&&(window.__reactRouterVersion="7.8.1")}catch{}function AP({basename:n,children:e,window:t}){let i=Fn.useRef();i.current==null&&(i.current=hL({window:t,v5Compat:!0}));let c=i.current,[u,m]=Fn.useState({action:c.action,location:c.location}),_=Fn.useCallback(o=>{Fn.startTransition(()=>m(o))},[m]);return Fn.useLayoutEffect(()=>c.listen(_),[c,_]),Fn.createElement(tP,{basename:n,children:e,location:u.location,navigationType:u.action,navigator:c})}var gT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,yT=Fn.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:c,reloadDocument:u,replace:m,state:_,target:o,to:w,preventScrollReset:I,viewTransition:O,...V},M){let{basename:se}=Fn.useContext(Nf),ce=typeof w=="string"&&gT.test(w),fe,ne=!1;if(typeof w=="string"&&ce&&(fe=w,mT))try{let D=new URL(window.location.href),$=w.startsWith("//")?new URL(D.protocol+w):new URL(w),z=dp($.pathname,se);$.origin===D.origin&&z!=null?w=z+$.search+$.hash:ne=!0}catch{kf(!1,`<Link to="${w}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let oe=BL(w,{relative:c}),[ye,he,Ne]=xP(i,V),Ve=LP(w,{replace:m,state:_,target:o,preventScrollReset:I,relative:c,viewTransition:O});function de(D){e&&e(D),D.defaultPrevented||Ve(D)}let j=Fn.createElement("a",{...V,...Ne,href:fe||oe,onClick:ne||u?e:de,ref:EP(M,he),target:o,"data-discover":!ce&&t==="render"?"true":void 0});return ye&&!ce?Fn.createElement(Fn.Fragment,null,j,Fn.createElement(bP,{page:oe})):j});yT.displayName="Link";var TP=Fn.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:c=!1,style:u,to:m,viewTransition:_,children:o,...w},I){let O=a_(m,{relative:w.relative}),V=Zm(),M=Fn.useContext(Fv),{navigator:se,basename:ce}=Fn.useContext(Nf),fe=M!=null&&NP(O)&&_===!0,ne=se.encodeLocation?se.encodeLocation(O).pathname:O.pathname,oe=V.pathname,ye=M&&M.navigation&&M.navigation.location?M.navigation.location.pathname:null;t||(oe=oe.toLowerCase(),ye=ye?ye.toLowerCase():null,ne=ne.toLowerCase()),ye&&ce&&(ye=dp(ye,ce)||ye);const he=ne!=="/"&&ne.endsWith("/")?ne.length-1:ne.length;let Ne=oe===ne||!c&&oe.startsWith(ne)&&oe.charAt(he)==="/",Ve=ye!=null&&(ye===ne||!c&&ye.startsWith(ne)&&ye.charAt(ne.length)==="/"),de={isActive:Ne,isPending:Ve,isTransitioning:fe},j=Ne?e:void 0,D;typeof i=="function"?D=i(de):D=[i,Ne?"active":null,Ve?"pending":null,fe?"transitioning":null].filter(Boolean).join(" ");let $=typeof u=="function"?u(de):u;return Fn.createElement(yT,{...w,"aria-current":j,className:D,ref:I,style:$,to:m,viewTransition:_},typeof o=="function"?o(de):o)});TP.displayName="NavLink";var IP=Fn.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:c,state:u,method:m=E1,action:_,onSubmit:o,relative:w,preventScrollReset:I,viewTransition:O,...V},M)=>{let se=MP(),ce=RP(_,{relative:w}),fe=m.toLowerCase()==="get"?"get":"post",ne=typeof _=="string"&&gT.test(_),oe=ye=>{if(o&&o(ye),ye.defaultPrevented)return;ye.preventDefault();let he=ye.nativeEvent.submitter,Ne=he?.getAttribute("formmethod")||m;se(he||ye.currentTarget,{fetcherKey:e,method:Ne,navigate:t,replace:c,state:u,relative:w,preventScrollReset:I,viewTransition:O})};return Fn.createElement("form",{ref:M,method:fe,action:ce,onSubmit:i?o:oe,...V,"data-discover":!ne&&n==="render"?"true":void 0})});IP.displayName="Form";function CP(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function _T(n){let e=Fn.useContext(v0);return Ol(e,CP(n)),e}function LP(n,{target:e,replace:t,state:i,preventScrollReset:c,relative:u,viewTransition:m}={}){let _=zL(),o=Zm(),w=a_(n,{relative:u});return Fn.useCallback(I=>{if(aP(I,e)){I.preventDefault();let O=t!==void 0?t:$y(o)===$y(w);_(n,{replace:O,state:i,preventScrollReset:c,relative:u,viewTransition:m})}},[o,_,w,t,i,e,n,c,u,m])}var PP=0,kP=()=>`__${String(++PP)}__`;function MP(){let{router:n}=_T("useSubmit"),{basename:e}=Fn.useContext(Nf),t=YL();return Fn.useCallback(async(i,c={})=>{let{action:u,method:m,encType:_,formData:o,body:w}=uP(i,e);if(c.navigate===!1){let I=c.fetcherKey||kP();await n.fetch(I,t,c.action||u,{preventScrollReset:c.preventScrollReset,formData:o,body:w,formMethod:c.method||m,formEncType:c.encType||_,flushSync:c.flushSync})}else await n.navigate(c.action||u,{preventScrollReset:c.preventScrollReset,formData:o,body:w,formMethod:c.method||m,formEncType:c.encType||_,replace:c.replace,state:c.state,fromRouteId:t,flushSync:c.flushSync,viewTransition:c.viewTransition})},[n,e,t])}function RP(n,{relative:e}={}){let{basename:t}=Fn.useContext(Nf),i=Fn.useContext(Df);Ol(i,"useFormAction must be used inside a RouteContext");let[c]=i.matches.slice(-1),u={...a_(n||".",{relative:e})},m=Zm();if(n==null){u.search=m.search;let _=new URLSearchParams(u.search),o=_.getAll("index");if(o.some(I=>I==="")){_.delete("index"),o.filter(O=>O).forEach(O=>_.append("index",O));let I=_.toString();u.search=I?`?${I}`:""}}return(!n||n===".")&&c.route.index&&(u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(u.pathname=u.pathname==="/"?t:cp([t,u.pathname])),$y(u)}function NP(n,{relative:e}={}){let t=Fn.useContext(lT);Ol(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=_T("useViewTransitionState"),c=a_(n,{relative:e});if(!t.isTransitioning)return!1;let u=dp(t.currentLocation.pathname,i)||t.currentLocation.pathname,m=dp(t.nextLocation.pathname,i)||t.nextLocation.pathname;return Q1(c.pathname,m)!=null||Q1(c.pathname,u)!=null}var T1={exports:{}},DP=T1.exports,c2;function FP(){return c2||(c2=1,(function(n,e){var t={};(function(i,c){n.exports=c()})(DP,(function(){var i,c,u;function m(o,w){if(!i)i=w;else if(!c)c=w;else{var I="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",O={};i(O),u=w(O),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([I],{type:"text/javascript"})))}}m(["exports"],(function(o){var w=typeof self<"u"?self:{},I="2.15.0";let O;const V={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(O==null){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{O=t.API_URL_REGEX!=null?new RegExp(t.API_URL_REGEX):s}catch{O=s}}return O},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!V.API_URL)return null;try{const s=new URL(V.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},M={supported:!1,testSupport:function(s){!fe&&ce&&(ne?oe(s):se=s)}};let se,ce,fe=!1,ne=!1;function oe(s){const r=s.createTexture();s.bindTexture(s.TEXTURE_2D,r);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,ce),s.isContextLost())return;M.supported=!0}catch{}s.deleteTexture(r),fe=!0}w.document&&(ce=w.document.createElement("img"),ce.onload=function(){se&&oe(se),se=null,ne=!0},ce.onerror=function(){fe=!0,se=null},ce.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ye="01";function he(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Ne=Ve;function Ve(s,r,l,h){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=r,this.p2x=l,this.p2y=h}Ve.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,r){if(r===void 0&&(r=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,h=0;h<8;h++){var p=this.sampleCurveX(l)-s;if(Math.abs(p)<r)return l;var x=this.sampleCurveDerivativeX(l);if(Math.abs(x)<1e-6)break;l-=p/x}var b=0,A=1;for(l=s,h=0;h<20&&(p=this.sampleCurveX(l),!(Math.abs(p-s)<r));h++)s>p?b=l:A=l,l=.5*(A-b)+b;return l},solve:function(s,r){return this.sampleCurveY(this.solveCurveX(s,r))}};var de=he(Ne),j=D;function D(s,r){this.x=s,this.y=r}D.prototype={clone:function(){return new D(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,r){return this.clone()._rotateAround(s,r)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var r=s.x-this.x,l=s.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,r){return Math.atan2(this.x*r-this.y*s,this.x*s+this.y*r)},_matMult:function(s){var r=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=r,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var r=Math.cos(s),l=Math.sin(s),h=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=h,this},_rotateAround:function(s,r){var l=Math.cos(s),h=Math.sin(s),p=r.y+h*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-h*(this.y-r.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},D.convert=function(s){return s instanceof D?s:Array.isArray(s)?new D(s[0],s[1]):s};var $=he(j);const z=Math.PI/180,W=180/Math.PI;function Z(s){return s*z}function Ee(s){return s*W}const ke=[[0,0],[1,0],[1,1],[0,1]];function Oe(s){if(s<=0)return 0;if(s>=1)return 1;const r=s*s,l=r*s;return 4*(s<.5?l:3*(s-r)+l-.75)}function Re(s,r,l,h){const p=new de(s,r,l,h);return function(x){return p.solve(x)}}const be=Re(.25,.1,.25,1);function De(s,r,l){return Math.min(l,Math.max(r,s))}function Qe(s,r,l){return(l=De((l-s)/(r-s),0,1))*l*(3-2*l)}function xe(s,r,l){const h=l-r,p=((s-r)%h+h)%h+r;return p===r?l:p}function ae(s,r,l){if(!s.length)return l(null,[]);let h=s.length;const p=new Array(s.length);let x=null;s.forEach(((b,A)=>{r(b,((P,k)=>{P&&(x=P),p[A]=k,--h==0&&l(x,p)}))}))}function Me(s){const r=[];for(const l in s)r.push(s[l]);return r}function Fe(s,...r){for(const l of r)for(const h in l)s[h]=l[h];return s}let Ze=1;function et(){return Ze++}function mt(){return(function s(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)})()}function ht(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Nt(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function Jt(s,r){s.forEach((l=>{r[l]&&(r[l]=r[l].bind(r))}))}function tn(s,r){return s.indexOf(r,s.length-r.length)!==-1}function fn(s,r,l){const h={};for(const p in s)h[p]=r.call(this,s[p],p,s);return h}function An(s,r,l){const h={};for(const p in s)r.call(l||this,s[p],p,s)&&(h[p]=s[p]);return h}function zt(s){return Array.isArray(s)?s.map(zt):typeof s=="object"&&s?fn(s,zt):s}const it={};function ur(s){it[s]||(typeof console<"u"&&console.warn(s),it[s]=!0)}function xr(s,r,l){return(l.y-s.y)*(r.x-s.x)>(r.y-s.y)*(l.x-s.x)}function Tr(s){let r=0;for(let l,h,p=0,x=s.length,b=x-1;p<x;b=p++)l=s[p],h=s[b],r+=(h.x-l.x)*(l.y+h.y);return r}function Tn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Yn(s){const r={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((l,h,p,x)=>{const b=p||x;return r[h]=!b||b.toLowerCase(),""})),r["max-age"]){const l=parseInt(r["max-age"],10);isNaN(l)?delete r["max-age"]:r["max-age"]=l}return r}let $n=null;function hr(s){if($n==null){const r=s.navigator?s.navigator.userAgent:null;$n=!!s.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return $n}function Wt(s){try{const r=w[s];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}function Nn(s,r){return[s[4*r],s[4*r+1],s[4*r+2],s[4*r+3]]}const tr="mapbox-tiles";let Hn=500,Rr=50,lr,wr;function br(){try{return w.caches}catch{}}function Ir(){br()&&!lr&&(lr=w.caches.open(tr))}function Bi(s){const r=s.indexOf("?");if(r<0)return s;const l=(function(p){const x=p.indexOf("?");return x>0?p.slice(x+1).split("&"):[]})(s),h=l.filter((p=>{const x=p.split("=");return x[0]==="language"||x[0]==="worldview"}));return h.length?`${s.slice(0,r)}?${h.join("&")}`:s.slice(0,r)}let Mi=1/0;const pr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(pr);class Jr extends Error{constructor(r,l,h){l===401&&Rt(h)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=l,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Kr=Tn()?()=>self.worker&&self.worker.referrer:()=>(w.location.protocol==="blob:"?w.parent:w).location.href,Sr=function(s,r){if(!(/^file:/.test(l=s.url)||/^file:/.test(Kr())&&!/^\w+:/.test(l))){if(w.fetch&&w.Request&&w.AbortController&&w.Request.prototype.hasOwnProperty("signal"))return(function(h,p){const x=new w.AbortController,b=new w.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Kr(),referrerPolicy:h.referrerPolicy,signal:x.signal});let A=!1,P=!1;const k=(q=b.url).indexOf("sku=")>0&&Rt(q);var q;h.type==="json"&&b.headers.set("Accept","application/json");const K=(ue,pe,Se)=>{if(P)return;if(ue&&ue.message!=="SecurityError"&&ur(ue.toString()),pe&&Se)return te(pe);const Ge=Date.now();w.fetch(b).then((at=>{if(at.ok){const xt=k?at.clone():null;return te(at,xt,Ge)}return p(new Jr(at.statusText,at.status,h.url))})).catch((at=>{at.name!=="AbortError"&&p(new Error(`${at.message} ${h.url}`))}))},te=(ue,pe,Se)=>{(h.type==="arrayBuffer"?ue.arrayBuffer():h.type==="json"?ue.json():ue.text()).then((Ge=>{P||(pe&&Se&&(function(at,xt,lt){if(Ir(),!lr)return;const yt={status:xt.status,statusText:xt.statusText,headers:new w.Headers};xt.headers.forEach(((ln,en)=>yt.headers.set(en,ln)));const It=Yn(xt.headers.get("Cache-Control")||"");if(It["no-store"])return;It["max-age"]&&yt.headers.set("Expires",new Date(lt+1e3*It["max-age"]).toUTCString());const Tt=yt.headers.get("Expires");Tt&&(new Date(Tt).getTime()-lt<42e4||(function(ln,en){if(wr===void 0)try{new Response(new ReadableStream),wr=!0}catch{wr=!1}wr?en(ln.body):ln.blob().then(en)})(xt,(ln=>{const en=new w.Response(ln,yt);Ir(),lr&&lr.then((wn=>wn.put(Bi(at.url),en))).catch((wn=>ur(wn.message)))})))})(b,pe,Se),A=!0,p(null,Ge,ue.headers.get("Cache-Control"),ue.headers.get("Expires")))})).catch((Ge=>{P||p(new Error(Ge.message))}))};return k?(function(ue,pe){if(Ir(),!lr)return pe(null);const Se=Bi(ue.url);lr.then((Ge=>{Ge.match(Se).then((at=>{const xt=(function(lt){if(!lt)return!1;const yt=new Date(lt.headers.get("Expires")||0),It=Yn(lt.headers.get("Cache-Control")||"");return yt>Date.now()&&!It["no-cache"]})(at);Ge.delete(Se),xt&&Ge.put(Se,at.clone()),pe(null,at,xt)})).catch(pe)})).catch(pe)})(b,K):K(null,null),{cancel:()=>{P=!0,A||x.abort()}}})(s,r);if(Tn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,r,void 0,!0)}var l;return(function(h,p){const x=new w.XMLHttpRequest;x.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(x.responseType="arraybuffer");for(const b in h.headers)x.setRequestHeader(b,h.headers[b]);return h.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=h.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let b=x.response;if(h.type==="json")try{b=JSON.parse(x.response)}catch(A){return p(A)}p(null,b,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else p(new Jr(x.statusText,x.status,h.url))},x.send(h.body),{cancel:()=>x.abort()}})(s,r)},ui=function(s,r){return Sr(Fe(s,{type:"arrayBuffer"}),r)};function ii(s){const r=w.document.createElement("a");return r.href=s,r.protocol===w.document.location.protocol&&r.host===w.document.location.host}const ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let we,Ie;we=[],Ie=0;const Ye=function(s,r){if(M.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Ie>=V.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:s,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return we.push(x),x}Ie++;let l=!1;const h=()=>{if(!l)for(l=!0,Ie--;we.length&&Ie<V.MAX_PARALLEL_IMAGE_REQUESTS;){const x=we.shift(),{requestParameters:b,callback:A,cancelled:P}=x;P||(x.cancel=Ye(b,A).cancel)}},p=ui(s,((x,b,A,P)=>{h(),x?r(x):b&&(w.createImageBitmap?(function(k,q){const K=new w.Blob([new Uint8Array(k)],{type:"image/png"});w.createImageBitmap(K).then((te=>{q(null,te)})).catch((te=>{q(new Error(`Could not load image because of ${te.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(b,((k,q)=>r(k,q,A,P))):(function(k,q){const K=new w.Image,te=w.URL;K.onload=()=>{q(null,K),te.revokeObjectURL(K.src),K.onload=null,w.requestAnimationFrame((()=>{K.src=ut}))},K.onerror=()=>q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const ue=new w.Blob([new Uint8Array(k)],{type:"image/png"});K.src=k.byteLength?te.createObjectURL(ue):ut})(b,((k,q)=>r(k,q,A,P))))}));return{cancel:()=>{p.cancel(),h()}}},ct="NO_ACCESS_TOKEN";function Ct(s){return s.indexOf("mapbox:")===0}function Rt(s){return V.API_URL_REGEX.test(s)}function Bt(s){return V.API_CDN_URL_REGEX.test(s)}function St(s){return V.API_STYLE_REGEX.test(s)&&!Mt(s)}function Mt(s){return V.API_SPRITE_REGEX.test(s)}const vn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Bn(s){const r=s.match(vn);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Ln(s){const r=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${r}`}const qr="mapbox.eventData";function Cr(s){if(!s)return null;const r=s.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(decodeURIComponent(w.atob(r[1]).split("").map((l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch{return null}}class Ar{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const l=Cr(V.ACCESS_TOKEN);let h="";return h=l&&l.u?w.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,((p,x)=>String.fromCharCode(+("0x"+x))))):V.ACCESS_TOKEN||"",r?`${qr}.${r}:${h}`:`${qr}:${h}`}fetchEventData(){const r=Wt("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{const p=w.localStorage.getItem(l);p&&(this.eventData=JSON.parse(p));const x=w.localStorage.getItem(h);x&&(this.anonId=x)}catch{ur("Unable to read from LocalStorage")}}saveEventData(){const r=Wt("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{w.localStorage.setItem(h,this.anonId),Object.keys(this.eventData).length>=1&&w.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{ur("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,l,h,p){if(!V.EVENTS_URL)return;const x=Bn(V.EVENTS_URL);x.params.push(`access_token=${p||V.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(r).toISOString()},A=l?Fe(b,l):b,P={url:Ln(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=(function(k,q){return Sr(Fe(k,{method:"POST"}),q)})(P,(k=>{this.pendingRequest=null,h(k),this.saveEventData(),this.processRequests(p)}))}queueRequest(r,l){this.queue.push(r),this.processRequests(l)}}const Dr=new class extends Ar{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,r){V.EVENTS_URL&&V.ACCESS_TOKEN&&Array.isArray(s)&&s.some((l=>Ct(l)||Rt(l)))&&this.queueRequest(Date.now(),r)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Cr(V.ACCESS_TOKEN),l=r?r.u:V.ACCESS_TOKEN;let h=l!==this.eventData.tokenU;Nt(this.anonId)||(this.anonId=mt(),h=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),b=new Date(p),A=(p-this.eventData.lastSuccess)/864e5;h=h||A>=1||A<-1||x.getDate()!==b.getDate()}else h=!0;h?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:ye,"enabled.telemetry":!1,userId:this.anonId},(x=>{x||(this.eventData.lastSuccess=p,this.eventData.tokenU=l)}),s):this.processRequests()}},_i=Dr.postTurnstileEvent.bind(Dr),ko=new class extends Ar{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,r,l,h){this.skuToken=r,this.errorCb=h,V.EVENTS_URL&&(l||V.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},l):this.errorCb(new Error(ct)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Nt(this.anonId)||(this.anonId=mt()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:ye,skuToken:this.skuToken,userId:this.anonId},(h=>{h?this.errorCb(h):r&&(this.success[r]=!0)}),s))}},ro=ko.postMapLoadEvent.bind(ko),os=new class extends Ar{constructor(){super("gljs.performance")}postPerformanceEvent(s,r){V.EVENTS_URL&&(s||V.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},s)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:l}=this.queue.shift(),h=(function(p){const x=w.performance.getEntriesByType("resource"),b=w.performance.getEntriesByType("mark"),A=(function(te){const ue={};if(te){for(const pe in te)if(pe!=="other")for(const Se of te[pe]){const Ge=`${pe}ResolveRangeMin`,at=`${pe}ResolveRangeMax`,xt=`${pe}RequestCount`,lt=`${pe}RequestCachedCount`;ue[Ge]=Math.min(ue[Ge]||1/0,Se.startTime),ue[at]=Math.max(ue[at]||-1/0,Se.responseEnd);const yt=It=>{ue[It]===void 0&&(ue[It]=0),++ue[It]};Se.transferSize!==void 0&&Se.transferSize===0&&yt(lt),yt(xt)}}return ue})((function(te,ue){const pe={};if(te)for(const Se of te){const Ge=ue(Se);pe[Ge]===void 0&&(pe[Ge]=[]),pe[Ge].push(Se)}return pe})(x,jl)),P=w.devicePixelRatio,k=w.navigator.connection||w.navigator.mozConnection||w.navigator.webkitConnection,q={counters:[],metadata:[],attributes:[]},K=(te,ue,pe)=>{pe!=null&&te.push({name:ue,value:pe.toString()})};for(const te in A)K(q.counters,te,A[te]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(K(q.counters,"interactionRangeMin",p.interactionRange[0]),K(q.counters,"interactionRangeMax",p.interactionRange[1])),b)for(const te of Object.keys(La)){const ue=La[te],pe=b.find((Se=>Se.name===ue));pe&&K(q.counters,ue,pe.startTime)}return K(q.counters,"visibilityHidden",p.visibilityHidden),K(q.attributes,"style",(function(te){if(te)for(const ue of te){const pe=ue.name.split("?")[0];if(St(pe)){const Se=pe.split("/").slice(-2);if(Se.length===2)return`mapbox://styles/${Se[0]}/${Se[1]}`}}})(x)),K(q.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),K(q.attributes,"fogEnabled",p.fogEnabled?"true":"false"),K(q.attributes,"projection",p.projection),K(q.attributes,"zoom",p.zoom),K(q.metadata,"devicePixelRatio",P),K(q.metadata,"connectionEffectiveType",k?k.effectiveType:void 0),K(q.metadata,"navigatorUserAgent",w.navigator.userAgent),K(q.metadata,"screenWidth",w.screen.width),K(q.metadata,"screenHeight",w.screen.height),K(q.metadata,"windowWidth",w.innerWidth),K(q.metadata,"windowHeight",w.innerHeight),K(q.metadata,"mapWidth",p.width/P),K(q.metadata,"mapHeight",p.height/P),K(q.metadata,"webglRenderer",p.renderer),K(q.metadata,"webglVendor",p.vendor),K(q.metadata,"sdkVersion",I),K(q.metadata,"sdkIdentifier","mapbox-gl-js"),q})(l);for(const p of h.metadata);for(const p of h.counters);for(const p of h.attributes);this.postEvent(r,h,(()=>{}),s)}},Ji=os.postPerformanceEvent.bind(os),Yo=new class extends Ar{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,r,l,h){if(!V.API_URL||!V.SESSION_PATH)return;const p=Bn(V.API_URL+V.SESSION_PATH);p.params.push(`sku=${r||""}`),p.params.push(`access_token=${h||V.ACCESS_TOKEN||""}`);const x={url:Ln(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=(function(b,A){return Sr(Fe(b,{method:"GET"}),A)})(x,(b=>{this.pendingRequest=null,l(b),this.saveEventData(),this.processRequests(h)}))}getSessionAPI(s,r,l,h){this.skuToken=r,this.errorCb=h,V.SESSION_PATH&&V.API_URL&&(l||V.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},l):this.errorCb(new Error(ct)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||this.getSession(l,this.skuToken,(h=>{h?this.errorCb(h):r&&(this.success[r]=!0)}),s)}},oo=Yo.getSessionAPI.bind(Yo),Jo=new Set,La={create:"create",load:"load",fullLoad:"fullLoad"},zl={mark(s){w.performance.mark(s)},measure(s,r,l){w.performance.measure(s,r,l)}};function jl(s){const r=s.name.split("?")[0];return Bt(r)&&r.includes("mapbox-gl.js")?"javascript":Bt(r)&&r.includes("mapbox-gl.css")?"css":(function(l){return V.API_FONTS_REGEX.test(l)})(r)?"fontRange":Mt(r)?"sprite":St(r)?"style":(function(l){return V.API_TILEJSON_REGEX.test(l)})(r)?"tilejson":"other"}const Fi=w.performance;function nc(s){const r=s?s.url.toString():void 0;return Fi.getEntriesByName(r)}let Hc,Oi,Sc,Pa;const Qo={now:()=>Sc!==void 0?Sc:w.performance.now(),setNow(s){Sc=s},restoreNow(){Sc=void 0},frame(s){const r=w.requestAnimationFrame(s);return{cancel:()=>w.cancelAnimationFrame(r)}},getImageData(s,r=0){const{width:l,height:h}=s;Pa||(Pa=w.document.createElement("canvas"));const p=Pa.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(l>Pa.width||h>Pa.height)&&(Pa.width=l,Pa.height=h),p.clearRect(-r,-r,l+2*r,h+2*r),p.drawImage(s,0,0,l,h),p.getImageData(-r,-r,l+2*r,h+2*r)},resolveURL:s=>(Hc||(Hc=w.document.createElement("a")),Hc.href=s,Hc.href),get devicePixelRatio(){return w.devicePixelRatio},get prefersReducedMotion(){return!!w.matchMedia&&(Oi==null&&(Oi=w.matchMedia("(prefers-reduced-motion: reduce)")),Oi.matches)}};function Sa(s,r,l){l[s]&&l[s].indexOf(r)!==-1||(l[s]=l[s]||[],l[s].push(r))}function Ec(s,r,l){if(l&&l[s]){const h=l[s].indexOf(r);h!==-1&&l[s].splice(h,1)}}class hl{constructor(r,l={}){Fe(this,l),this.type=r}}class Ea extends hl{constructor(r,l={}){super("error",Fe({error:r},l))}}class Ro{on(r,l){return this._listeners=this._listeners||{},Sa(r,l,this._listeners),this}off(r,l){return Ec(r,l,this._listeners),Ec(r,l,this._oneTimeListeners),this}once(r,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Sa(r,l,this._oneTimeListeners),this):new Promise((h=>this.once(r,h)))}fire(r,l){typeof r=="string"&&(r=new hl(r,l||{}));const h=r.type;if(this.listens(h)){r.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const A of p)A.call(this,r);const x=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const A of x)Ec(h,A,this._oneTimeListeners),A.call(this,r);const b=this._eventedParent;b&&(Fe(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(r))}else r instanceof Ea&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,l){return this._eventedParent=r,this._eventedParentData=l,this}}var pn=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ss(s,...r){for(const l of r)for(const h in l)s[h]=l[h];return s}function as(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Qi(s){if(Array.isArray(s))return s.map(Qi);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const r={};for(const l in s)r[l]=Qi(s[l]);return r}return as(s)}class Au extends Error{constructor(r,l){super(l),this.message=l,this.key=r}}var ka=Au;class Za{constructor(r,l=[]){this.parent=r,this.bindings={};for(const[h,p]of l)this.bindings[h]=p}concat(r){return new Za(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}var ls=Za;const Us={kind:"null"},Qn={kind:"number"},Fr={kind:"string"},ei={kind:"boolean"},aa={kind:"color"},fa={kind:"object"},vi={kind:"value"},Lr={kind:"collator"},dl={kind:"formatted"},zi={kind:"resolvedImage"};function es(s,r){return{kind:"array",itemType:s,N:r}}function _o(s){if(s.kind==="array"){const r=_o(s.itemType);return typeof s.N=="number"?`array<${r}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${r}>`}return s.kind}const Tu=[Us,Qn,Fr,ei,aa,dl,fa,es(vi),zi];function Sl(s,r){if(r.kind==="error")return null;if(s.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!Sl(s.itemType,r.itemType))&&(typeof s.N!="number"||s.N===r.N))return null}else{if(s.kind===r.kind)return null;if(s.kind==="value"){for(const l of Tu)if(!Sl(l,r))return null}}return`Expected ${_o(s)} but found ${_o(r)} instead.`}function Ac(s,r){return r.some((l=>l.kind===s.kind))}function rc(s,r){return r.some((l=>l==="null"?s===null:l==="array"?Array.isArray(s):l==="object"?s&&!Array.isArray(s)&&typeof s=="object":l===typeof s))}var El,Mo={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ys(s){return(s=Math.round(s))<0?0:s>255?255:s}function Ps(s){return ys(s[s.length-1]==="%"?parseFloat(s)/100*255:parseInt(s))}function ja(s){return(r=s[s.length-1]==="%"?parseFloat(s)/100:parseFloat(s))<0?0:r>1?1:r;var r}function oi(s,r,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?s+(r-s)*l*6:2*l<1?r:3*l<2?s+(r-s)*(2/3-l)*6:s}try{El={}.parseCSSColor=function(s){var r,l=s.replace(/ /g,"").toLowerCase();if(l in Mo)return Mo[l].slice();if(l[0]==="#")return l.length===4?(r=parseInt(l.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:l.length===7&&(r=parseInt(l.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var h=l.indexOf("("),p=l.indexOf(")");if(h!==-1&&p+1===l.length){var x=l.substr(0,h),b=l.substr(h+1,p-(h+1)).split(","),A=1;switch(x){case"rgba":if(b.length!==4)return null;A=ja(b.pop());case"rgb":return b.length!==3?null:[Ps(b[0]),Ps(b[1]),Ps(b[2]),A];case"hsla":if(b.length!==4)return null;A=ja(b.pop());case"hsl":if(b.length!==3)return null;var P=(parseFloat(b[0])%360+360)%360/360,k=ja(b[1]),q=ja(b[2]),K=q<=.5?q*(k+1):q+k-q*k,te=2*q-K;return[ys(255*oi(te,K,P+1/3)),ys(255*oi(te,K,P)),ys(255*oi(te,K,P-1/3)),A];default:return null}}return null}}catch{}class ts{constructor(r,l,h,p=1){this.r=r,this.g=l,this.b=h,this.a=p}static parse(r){if(!r)return;if(r instanceof ts)return r;if(typeof r!="string")return;const l=El(r);return l?new ts(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[r,l,h,p]=this.toArray();return`rgba(${Math.round(r)},${Math.round(l)},${Math.round(h)},${p})`}toArray(){const{r,g:l,b:h,a:p}=this;return p===0?[0,0,0,0]:[255*r/p,255*l/p,255*h/p,p]}toArray01(){const{r,g:l,b:h,a:p}=this;return p===0?[0,0,0,0]:[r/p,l/p,h/p,p]}toArray01PremultipliedAlpha(){const{r,g:l,b:h,a:p}=this;return[r,l,h,p]}}ts.black=new ts(0,0,0,1),ts.white=new ts(1,1,1,1),ts.transparent=new ts(0,0,0,0),ts.red=new ts(1,0,0,1),ts.blue=new ts(0,0,1,1);var No=ts;class Xu{constructor(r,l,h){this.sensitivity=r?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,l){return this.collator.compare(r,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ul{constructor(r,l,h,p,x){this.text=r.normalize?r.normalize():r,this.image=l,this.scale=h,this.fontStack=p,this.textColor=x}}class Ao{constructor(r){this.sections=r}static fromString(r){return new Ao([new Ul(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((r=>r.text.length!==0||r.image&&r.image.name.length!==0))}static factory(r){return r instanceof Ao?r:Ao.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map((r=>r.text)).join("")}serialize(){const r=["format"];for(const l of this.sections){if(l.image){r.push(["image",l.image.name]);continue}r.push(l.text);const h={};l.fontStack&&(h["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(h["font-scale"]=l.scale),l.textColor&&(h["text-color"]=["rgba"].concat(l.textColor.toArray())),r.push(h)}return r}}class Vs{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Vs({name:r,available:!1}):null}serialize(){return["image",this.name]}}function Ku(s,r,l,h){return typeof s=="number"&&s>=0&&s<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof l=="number"&&l>=0&&l<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[s,r,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[s,r,l,h]:[s,r,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fl(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof No||s instanceof Xu||s instanceof Ao||s instanceof Vs)return!0;if(Array.isArray(s)){for(const r of s)if(!fl(r))return!1;return!0}if(typeof s=="object"){for(const r in s)if(!fl(s[r]))return!1;return!0}return!1}function To(s){if(s===null)return Us;if(typeof s=="string")return Fr;if(typeof s=="boolean")return ei;if(typeof s=="number")return Qn;if(s instanceof No)return aa;if(s instanceof Xu)return Lr;if(s instanceof Ao)return dl;if(s instanceof Vs)return zi;if(Array.isArray(s)){const r=s.length;let l;for(const h of s){const p=To(h);if(l){if(l===p)continue;l=vi;break}l=p}return es(l||vi,r)}return fa}function vo(s){const r=typeof s;return s===null?"":r==="string"||r==="number"||r==="boolean"?String(s):s instanceof No||s instanceof Ao||s instanceof Vs?s.toString():JSON.stringify(s)}class Ss{constructor(r,l){this.type=r,this.value=l}static parse(r,l){if(r.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!fl(r[1]))return l.error("invalid value");const h=r[1];let p=To(h);const x=l.expectedType;return p.kind!=="array"||p.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(p=x),new Ss(p,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof No?["rgba"].concat(this.value.toArray()):this.value instanceof Ao?this.value.serialize():this.value}}var Oo=Ss,Vo=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const Tc={string:Fr,number:Qn,boolean:ei,object:fa};class Bo{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");let h,p=1;const x=r[0];if(x==="array"){let A,P;if(r.length>2){const k=r[1];if(typeof k!="string"||!(k in Tc)||k==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);A=Tc[k],p++}else A=vi;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return l.error('The length argument to "array" must be a positive integer literal',2);P=r[2],p++}h=es(A,P)}else h=Tc[x];const b=[];for(;p<r.length;p++){const A=l.parse(r[p],p,vi);if(!A)return null;b.push(A)}return new Bo(h,b)}evaluate(r){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(r);if(!Sl(this.type,To(h)))return h;if(l===this.args.length-1)throw new Vo(`Expected value to be of type ${_o(this.type)}, but found ${_o(To(h))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){const r=this.type,l=[r.kind];if(r.kind==="array"){const h=r.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){l.push(h.kind);const p=r.N;(typeof p=="number"||this.args.length>1)&&l.push(p)}}return l.concat(this.args.map((h=>h.serialize())))}}var Al=Bo;class Ma{constructor(r){this.type=dl,this.sections=r}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const h=r[1];if(!Array.isArray(h)&&typeof h=="object")return l.error("First argument must be an image or text section.");const p=[];let x=!1;for(let b=1;b<=r.length-1;++b){const A=r[b];if(x&&typeof A=="object"&&!Array.isArray(A)){x=!1;let P=null;if(A["font-scale"]&&(P=l.parse(A["font-scale"],1,Qn),!P))return null;let k=null;if(A["text-font"]&&(k=l.parse(A["text-font"],1,es(Fr)),!k))return null;let q=null;if(A["text-color"]&&(q=l.parse(A["text-color"],1,aa),!q))return null;const K=p[p.length-1];K.scale=P,K.font=k,K.textColor=q}else{const P=l.parse(r[b],1,vi);if(!P)return null;const k=P.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,p.push({content:P,scale:null,font:null,textColor:null})}}return new Ma(p)}evaluate(r){return new Ao(this.sections.map((l=>{const h=l.content.evaluate(r);return To(h)===zi?new Ul("",h,null,null,null):new Ul(vo(h),null,l.scale?l.scale.evaluate(r):null,l.font?l.font.evaluate(r).join(","):null,l.textColor?l.textColor.evaluate(r):null)})))}eachChild(r){for(const l of this.sections)r(l.content),l.scale&&r(l.scale),l.font&&r(l.font),l.textColor&&r(l.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const l of this.sections){r.push(l.content.serialize());const h={};l.scale&&(h["font-scale"]=l.scale.serialize()),l.font&&(h["text-font"]=l.font.serialize()),l.textColor&&(h["text-color"]=l.textColor.serialize()),r.push(h)}return r}}class pl{constructor(r){this.type=zi,this.input=r}static parse(r,l){if(r.length!==2)return l.error("Expected two arguments.");const h=l.parse(r[1],1,Fr);return h?new pl(h):l.error("No image name provided.")}evaluate(r){const l=this.input.evaluate(r),h=Vs.fromString(l);return h&&r.availableImages&&(h.available=r.availableImages.indexOf(l)>-1),h}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ic={"to-boolean":ei,"to-color":aa,"to-number":Qn,"to-string":Fr};class qs{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const h=r[0];if((h==="to-boolean"||h==="to-string")&&r.length!==2)return l.error("Expected one argument.");const p=ic[h],x=[];for(let b=1;b<r.length;b++){const A=l.parse(r[b],b,vi);if(!A)return null;x.push(A)}return new qs(p,x)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let l,h;for(const p of this.args){if(l=p.evaluate(r),h=null,l instanceof No)return l;if(typeof l=="string"){const x=r.parseColor(l);if(x)return x}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Ku(l[0],l[1],l[2],l[3]),!h))return new No(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Vo(h||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(const h of this.args){if(l=h.evaluate(r),l===null)return 0;const p=Number(l);if(!isNaN(p))return p}throw new Vo(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?Ao.fromString(vo(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?Vs.fromString(vo(this.args[0].evaluate(r))):vo(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Ma([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new pl(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild((l=>{r.push(l.serialize())})),r}}var $s=qs;const si=["Unknown","Point","LineString","Polygon"];var Gs=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?si[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*r-s[0])+this.featureDistanceData.bearing[1]*(h*r-s[1])}return 0}parseColor(s){let r=this._parseColorCache[s];return r||(r=this._parseColorCache[s]=No.parse(s)),r}};class qo{constructor(r,l,h,p){this.name=r,this.type=l,this._evaluate=h,this.args=p}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((r=>r.serialize())))}static parse(r,l){const h=r[0],p=qo.definitions[h];if(!p)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,A=b.filter((([k])=>!Array.isArray(k)||k.length===r.length-1));let P=null;for(const[k,q]of A){P=new Ja(l.registry,l.path,null,l.scope);const K=[];let te=!1;for(let ue=1;ue<r.length;ue++){const pe=r[ue],Se=Array.isArray(k)?k[ue-1]:k.type,Ge=P.parse(pe,1+K.length,Se);if(!Ge){te=!0;break}K.push(Ge)}if(!te)if(Array.isArray(k)&&k.length!==K.length)P.error(`Expected ${k.length} arguments, but found ${K.length} instead.`);else{for(let ue=0;ue<K.length;ue++){const pe=Array.isArray(k)?k[ue]:k.type,Se=K[ue];P.concat(ue+1).checkSubtype(pe,Se.type)}if(P.errors.length===0)return new qo(h,x,q,K)}}if(A.length===1)l.errors.push(...P.errors);else{const k=(A.length?A:b).map((([K])=>{return te=K,Array.isArray(te)?`(${te.map(_o).join(", ")})`:`(${_o(te.type)}...)`;var te})).join(" | "),q=[];for(let K=1;K<r.length;K++){const te=l.parse(r[K],1+q.length);if(!te)return null;q.push(_o(te.type))}l.error(`Expected arguments of type ${k}, but found (${q.join(", ")}) instead.`)}return null}static register(r,l){qo.definitions=l;for(const h in l)r[h]=qo}}var Es=qo;class As{constructor(r,l,h){this.type=Lr,this.locale=h,this.caseSensitive=r,this.diacriticSensitive=l}static parse(r,l){if(r.length!==2)return l.error("Expected one argument.");const h=r[1];if(typeof h!="object"||Array.isArray(h))return l.error("Collator options argument must be an object.");const p=l.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,ei);if(!p)return null;const x=l.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,ei);if(!x)return null;let b=null;return h.locale&&(b=l.parse(h.locale,1,Fr),!b)?null:new As(p,x,b)}evaluate(r){return new Xu(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const Ya=8192;function ks(s,r){s[0]=Math.min(s[0],r[0]),s[1]=Math.min(s[1],r[1]),s[2]=Math.max(s[2],r[0]),s[3]=Math.max(s[3],r[1])}function Ws(s,r){return!(s[0]<=r[0]||s[2]>=r[2]||s[1]<=r[1]||s[3]>=r[3])}function Vl(s,r){const l=(180+s[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,p=Math.pow(2,r.z);return[Math.round(l*p*Ya),Math.round(h*p*Ya)]}function H(s,r,l){const h=s[0]-r[0],p=s[1]-r[1],x=s[0]-l[0],b=s[1]-l[1];return h*b-x*p==0&&h*x<=0&&p*b<=0}function Le(s,r){let l=!1;for(let b=0,A=r.length;b<A;b++){const P=r[b];for(let k=0,q=P.length;k<q-1;k++){if(H(s,P[k],P[k+1]))return!1;(p=P[k])[1]>(h=s)[1]!=(x=P[k+1])[1]>h[1]&&h[0]<(x[0]-p[0])*(h[1]-p[1])/(x[1]-p[1])+p[0]&&(l=!l)}}var h,p,x;return l}function pt(s,r){for(let l=0;l<r.length;l++)if(Le(s,r[l]))return!0;return!1}function Pt(s,r,l,h){const p=h[0]-l[0],x=h[1]-l[1],b=(s[0]-l[0])*x-p*(s[1]-l[1]),A=(r[0]-l[0])*x-p*(r[1]-l[1]);return b>0&&A<0||b<0&&A>0}function qt(s,r,l){for(const k of l)for(let q=0;q<k.length-1;++q)if((A=[(b=k[q+1])[0]-(x=k[q])[0],b[1]-x[1]])[0]*(P=[(p=r)[0]-(h=s)[0],p[1]-h[1]])[1]-A[1]*P[0]!=0&&Pt(h,p,x,b)&&Pt(x,b,h,p))return!0;var h,p,x,b,A,P;return!1}function on(s,r){for(let l=0;l<s.length;++l)if(!Le(s[l],r))return!1;for(let l=0;l<s.length-1;++l)if(qt(s[l],s[l+1],r))return!1;return!0}function Dn(s,r){for(let l=0;l<r.length;l++)if(on(s,r[l]))return!0;return!1}function Pr(s,r,l){const h=[];for(let p=0;p<s.length;p++){const x=[];for(let b=0;b<s[p].length;b++){const A=Vl(s[p][b],l);ks(r,A),x.push(A)}h.push(x)}return h}function $r(s,r,l){const h=[];for(let p=0;p<s.length;p++){const x=Pr(s[p],r,l);h.push(x)}return h}function gi(s,r,l,h){if(s[0]<l[0]||s[0]>l[2]){const p=.5*h;let x=s[0]-l[0]>p?-h:l[0]-s[0]>p?h:0;x===0&&(x=s[0]-l[2]>p?-h:l[2]-s[0]>p?h:0),s[0]+=x}ks(r,s)}function xi(s,r,l,h){const p=Math.pow(2,h.z)*Ya,x=[h.x*Ya,h.y*Ya],b=[];if(!s)return b;for(const A of s)for(const P of A){const k=[P.x+x[0],P.y+x[1]];gi(k,r,l,p),b.push(k)}return b}function so(s,r,l,h){const p=Math.pow(2,h.z)*Ya,x=[h.x*Ya,h.y*Ya],b=[];if(!s)return b;for(const P of s){const k=[];for(const q of P){const K=[q.x+x[0],q.y+x[1]];ks(r,K),k.push(K)}b.push(k)}if(r[2]-r[0]<=p/2){(A=r)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const P of b)for(const k of P)gi(k,r,l,p)}var A;return b}class lo{constructor(r,l){this.type=ei,this.geojson=r,this.geometries=l}static parse(r,l){if(r.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(fl(r[1])){const h=r[1];if(h.type==="FeatureCollection")for(let p=0;p<h.features.length;++p){const x=h.features[p].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new lo(h,h.features[p].geometry)}else if(h.type==="Feature"){const p=h.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new lo(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new lo(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return(function(l,h){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if(h.type==="Polygon"){const A=Pr(h.coordinates,x,b),P=xi(l.geometry(),p,x,b);if(!Ws(p,x))return!1;for(const k of P)if(!Le(k,A))return!1}if(h.type==="MultiPolygon"){const A=$r(h.coordinates,x,b),P=xi(l.geometry(),p,x,b);if(!Ws(p,x))return!1;for(const k of P)if(!pt(k,A))return!1}return!0})(r,this.geometries);if(r.geometryType()==="LineString")return(function(l,h){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if(h.type==="Polygon"){const A=Pr(h.coordinates,x,b),P=so(l.geometry(),p,x,b);if(!Ws(p,x))return!1;for(const k of P)if(!on(k,A))return!1}if(h.type==="MultiPolygon"){const A=$r(h.coordinates,x,b),P=so(l.geometry(),p,x,b);if(!Ws(p,x))return!1;for(const k of P)if(!Dn(k,A))return!1}return!0})(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var _s=lo;function eo(s){if(s instanceof Es&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof _s)return!1;let r=!0;return s.eachChild((l=>{r&&!eo(l)&&(r=!1)})),r}function $o(s){if(s instanceof Es&&s.name==="feature-state")return!1;let r=!0;return s.eachChild((l=>{r&&!$o(l)&&(r=!1)})),r}function Go(s,r){if(s instanceof Es&&r.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild((h=>{l&&!Go(h,r)&&(l=!1)})),l}class ds{constructor(r,l){this.type=l.type,this.name=r,this.boundExpression=l}static parse(r,l){if(r.length!==2||typeof r[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const h=r[1];return l.scope.has(h)?new ds(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var zo=ds;class Ms{constructor(r,l=[],h,p=new ls,x=[]){this.registry=r,this.path=l,this.key=l.map((b=>`[${b}]`)).join(""),this.scope=p,this.errors=x,this.expectedType=h}parse(r,l,h,p,x={}){return l?this.concat(l,h,p)._parse(r,x):this._parse(r,x)}_parse(r,l){function h(p,x,b){return b==="assert"?new Al(x,[p]):b==="coerce"?new $s(x,[p]):p}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=r[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[p];if(x){let b=x.parse(r,this);if(!b)return null;if(this.expectedType){const A=this.expectedType,P=b.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||P.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(A,P))return null}else b=h(b,A,l.typeAnnotation||"coerce");else b=h(b,A,l.typeAnnotation||"assert")}if(!(b instanceof Oo)&&b.type.kind!=="resolvedImage"&&Hs(b)){const A=new Gs;try{b=new Oo(b.type,b.evaluate(A))}catch(P){return this.error(P.message),null}}return b}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,l,h){const p=typeof r=="number"?this.path.concat(r):this.path,x=h?this.scope.concat(h):this.scope;return new Ms(this.registry,p,l||null,x,this.errors)}error(r,...l){const h=`${this.key}${l.map((p=>`[${p}]`)).join("")}`;this.errors.push(new ka(h,r))}checkSubtype(r,l){const h=Sl(r,l);return h&&this.error(h),h}}var Ja=Ms;function Hs(s){if(s instanceof zo)return Hs(s.boundExpression);if(s instanceof Es&&s.name==="error"||s instanceof As||s instanceof _s)return!1;const r=s instanceof $s||s instanceof Al;let l=!0;return s.eachChild((h=>{l=r?l&&Hs(h):l&&h instanceof Oo})),!!l&&eo(s)&&Go(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function L(s,r){const l=s.length-1;let h,p,x=0,b=l,A=0;for(;x<=b;)if(A=Math.floor((x+b)/2),h=s[A],p=s[A+1],h<=r){if(A===l||r<p)return A;x=A+1}else{if(!(h>r))throw new Vo("Input is not a number.");b=A-1}return 0}class re{constructor(r,l,h){this.type=r,this.input=l,this.labels=[],this.outputs=[];for(const[p,x]of h)this.labels.push(p),this.outputs.push(x)}static parse(r,l){if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(r[1],1,Qn);if(!h)return null;const p=[];let x=null;l.expectedType&&l.expectedType.kind!=="value"&&(x=l.expectedType);for(let b=1;b<r.length;b+=2){const A=b===1?-1/0:r[b],P=r[b+1],k=b,q=b+1;if(typeof A!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(p.length&&p[p.length-1][0]>=A)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const K=l.parse(P,q,x);if(!K)return null;x=x||K.type,p.push([A,K])}return new re(x,h,p)}evaluate(r){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(r);const p=this.input.evaluate(r);if(p<=l[0])return h[0].evaluate(r);const x=l.length;return p>=l[x-1]?h[x-1].evaluate(r):h[L(l,p)].evaluate(r)}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}serialize(){const r=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&r.push(this.labels[l]),r.push(this.outputs[l].serialize());return r}}var _e=re;function $e(s,r,l){return s*(1-l)+r*l}var Xt=Object.freeze({__proto__:null,array:function(s,r,l){return s.map(((h,p)=>$e(h,r[p],l)))},color:function(s,r,l){return new No($e(s.r,r.r,l),$e(s.g,r.g,l),$e(s.b,r.b,l),$e(s.a,r.a,l))},number:$e});const nn=.95047,Un=1.08883,mo=4/29,jo=6/29,Hi=3*jo*jo,Qr=jo*jo*jo,xo=Math.PI/180,fs=180/Math.PI;function pa(s){return s>Qr?Math.pow(s,1/3):s/Hi+mo}function Rs(s){return s>jo?s*s*s:Hi*(s-mo)}function Tl(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Ua(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Xc(s){const r=Ua(s.r),l=Ua(s.g),h=Ua(s.b),p=pa((.4124564*r+.3575761*l+.1804375*h)/nn),x=pa((.2126729*r+.7151522*l+.072175*h)/1);return{l:116*x-16,a:500*(p-x),b:200*(x-pa((.0193339*r+.119192*l+.9503041*h)/Un)),alpha:s.a}}function ml(s){let r=(s.l+16)/116,l=isNaN(s.a)?r:r+s.a/500,h=isNaN(s.b)?r:r-s.b/200;return r=1*Rs(r),l=nn*Rs(l),h=Un*Rs(h),new No(Tl(3.2404542*l-1.5371385*r-.4985314*h),Tl(-.969266*l+1.8760108*r+.041556*h),Tl(.0556434*l-.2040259*r+1.0572252*h),s.alpha)}function Qa(s,r,l){const h=r-s;return s+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const ma={forward:Xc,reverse:ml,interpolate:function(s,r,l){return{l:$e(s.l,r.l,l),a:$e(s.a,r.a,l),b:$e(s.b,r.b,l),alpha:$e(s.alpha,r.alpha,l)}}},Xs={forward:function(s){const{l:r,a:l,b:h}=Xc(s),p=Math.atan2(h,l)*fs;return{h:p<0?p+360:p,c:Math.sqrt(l*l+h*h),l:r,alpha:s.a}},reverse:function(s){const r=s.h*xo,l=s.c;return ml({l:s.l,a:Math.cos(r)*l,b:Math.sin(r)*l,alpha:s.alpha})},interpolate:function(s,r,l){return{h:Qa(s.h,r.h,l),c:$e(s.c,r.c,l),l:$e(s.l,r.l,l),alpha:$e(s.alpha,r.alpha,l)}}};var Kc=Object.freeze({__proto__:null,hcl:Xs,lab:ma});class Uo{constructor(r,l,h,p,x){this.type=r,this.operator=l,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(const[b,A]of x)this.labels.push(b),this.outputs.push(A)}static interpolationFactor(r,l,h,p){let x=0;if(r.name==="exponential")x=au(l,r.base,h,p);else if(r.name==="linear")x=au(l,1,h,p);else if(r.name==="cubic-bezier"){const b=r.controlPoints;x=new de(b[0],b[1],b[2],b[3]).solve(au(l,1,h,p))}return x}static parse(r,l){let[h,p,x,...b]=r;if(!Array.isArray(p)||p.length===0)return l.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const k=p[1];if(typeof k!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:k}}else{if(p[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const k=p.slice(1);if(k.length!==4||k.some((q=>typeof q!="number"||q<0||q>1)))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:k}}}if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(x=l.parse(x,2,Qn),!x)return null;const A=[];let P=null;h==="interpolate-hcl"||h==="interpolate-lab"?P=aa:l.expectedType&&l.expectedType.kind!=="value"&&(P=l.expectedType);for(let k=0;k<b.length;k+=2){const q=b[k],K=b[k+1],te=k+3,ue=k+4;if(typeof q!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',te);if(A.length&&A[A.length-1][0]>=q)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',te);const pe=l.parse(K,ue,P);if(!pe)return null;P=P||pe.type,A.push([q,pe])}return P.kind==="number"||P.kind==="color"||P.kind==="array"&&P.itemType.kind==="number"&&typeof P.N=="number"?new Uo(P,h,p,x,A):l.error(`Type ${_o(P)} is not interpolatable.`)}evaluate(r){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(r);const p=this.input.evaluate(r);if(p<=l[0])return h[0].evaluate(r);const x=l.length;if(p>=l[x-1])return h[x-1].evaluate(r);const b=L(l,p),A=Uo.interpolationFactor(this.interpolation,p,l[b],l[b+1]),P=h[b].evaluate(r),k=h[b+1].evaluate(r);return this.operator==="interpolate"?Xt[this.type.kind.toLowerCase()](P,k,A):this.operator==="interpolate-hcl"?Xs.reverse(Xs.interpolate(Xs.forward(P),Xs.forward(k),A)):ma.reverse(ma.interpolate(ma.forward(P),ma.forward(k),A))}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,r,this.input.serialize()];for(let h=0;h<this.labels.length;h++)l.push(this.labels[h],this.outputs[h].serialize());return l}}function au(s,r,l,h){const p=h-l,x=s-l;return p===0?0:r===1?x/p:(Math.pow(r,x)-1)/(Math.pow(r,p)-1)}var el=Uo;class tl{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expectected at least one argument.");let h=null;const p=l.expectedType;p&&p.kind!=="value"&&(h=p);const x=[];for(const A of r.slice(1)){const P=l.parse(A,1+x.length,h,void 0,{typeAnnotation:"omit"});if(!P)return null;h=h||P.type,x.push(P)}const b=p&&x.some((A=>Sl(p,A.type)));return new tl(b?vi:h,x)}evaluate(r){let l,h=null,p=0;for(const x of this.args){if(p++,h=x.evaluate(r),h&&h instanceof Vs&&!h.available&&(l||(l=h),h=null,p===this.args.length))return l;if(h!==null)break}return h}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){const r=["coalesce"];return this.eachChild((l=>{r.push(l.serialize())})),r}}var Ks=tl;class Ic{constructor(r,l){this.type=l.type,this.bindings=[].concat(r),this.result=l}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const l of this.bindings)r(l[1]);r(this.result)}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const h=[];for(let x=1;x<r.length-1;x+=2){const b=r[x];if(typeof b!="string")return l.error(`Expected string, but found ${typeof b} instead.`,x);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",x);const A=l.parse(r[x+1],x+1);if(!A)return null;h.push([b,A])}const p=l.parse(r[r.length-1],r.length-1,l.expectedType,h);return p?new Ic(h,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[l,h]of this.bindings)r.push(l,h.serialize());return r.push(this.result.serialize()),r}}var Cc=Ic;class ql{constructor(r,l,h){this.type=r,this.index=l,this.input=h}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,Qn),p=l.parse(r[2],2,es(l.expectedType||vi));return h&&p?new ql(p.type.itemType,h,p):null}evaluate(r){const l=this.index.evaluate(r),h=this.input.evaluate(r);if(l<0)throw new Vo(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new Vo(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new Vo(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Zc=ql;class lu{constructor(r,l){this.type=ei,this.needle=r,this.haystack=l}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,vi),p=l.parse(r[2],2,vi);return h&&p?Ac(h.type,[ei,Fr,Qn,Us,vi])?new lu(h,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${_o(h.type)} instead`):null}evaluate(r){const l=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(h==null)return!1;if(!rc(l,["boolean","string","number","null"]))throw new Vo(`Expected first argument to be of type boolean, string, number or null, but found ${_o(To(l))} instead.`);if(!rc(h,["string","array"]))throw new Vo(`Expected second argument to be of type array or string, but found ${_o(To(h))} instead.`);return h.indexOf(l)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Yc=lu;class cu{constructor(r,l,h){this.type=Qn,this.needle=r,this.haystack=l,this.fromIndex=h}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,vi),p=l.parse(r[2],2,vi);if(!h||!p)return null;if(!Ac(h.type,[ei,Fr,Qn,Us,vi]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${_o(h.type)} instead`);if(r.length===4){const x=l.parse(r[3],3,Qn);return x?new cu(h,p,x):null}return new cu(h,p)}evaluate(r){const l=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!rc(l,["boolean","string","number","null"]))throw new Vo(`Expected first argument to be of type boolean, string, number or null, but found ${_o(To(l))} instead.`);if(!rc(h,["string","array"]))throw new Vo(`Expected second argument to be of type array or string, but found ${_o(To(h))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(r);return h.indexOf(l,p)}return h.indexOf(l)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Lc=cu;class Jc{constructor(r,l,h,p,x,b){this.inputType=r,this.type=l,this.input=h,this.cases=p,this.outputs=x,this.otherwise=b}static parse(r,l){if(r.length<5)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return l.error("Expected an even number of arguments.");let h,p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);const x={},b=[];for(let k=2;k<r.length-1;k+=2){let q=r[k];const K=r[k+1];Array.isArray(q)||(q=[q]);const te=l.concat(k);if(q.length===0)return te.error("Expected at least one branch label.");for(const pe of q){if(typeof pe!="number"&&typeof pe!="string")return te.error("Branch labels must be numbers or strings.");if(typeof pe=="number"&&Math.abs(pe)>Number.MAX_SAFE_INTEGER)return te.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof pe=="number"&&Math.floor(pe)!==pe)return te.error("Numeric branch labels must be integer values.");if(h){if(te.checkSubtype(h,To(pe)))return null}else h=To(pe);if(x[String(pe)]!==void 0)return te.error("Branch labels must be unique.");x[String(pe)]=b.length}const ue=l.parse(K,k,p);if(!ue)return null;p=p||ue.type,b.push(ue)}const A=l.parse(r[1],1,vi);if(!A)return null;const P=l.parse(r[r.length-1],r.length-1,p);return P?A.type.kind!=="value"&&l.concat(1).checkSubtype(h,A.type)?null:new Jc(h,p,A,x,b,P):null}evaluate(r){const l=this.input.evaluate(r);return(To(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),h=[],p={};for(const b of l){const A=p[this.cases[b]];A===void 0?(p[this.cases[b]]=h.length,h.push([this.cases[b],[b]])):h[A][1].push(b)}const x=b=>this.inputType.kind==="number"?Number(b):b;for(const[b,A]of h)r.push(A.length===1?x(A[0]):A.map(x)),r.push(this.outputs[b].serialize());return r.push(this.otherwise.serialize()),r}}var uu=Jc;class Qc{constructor(r,l,h){this.type=r,this.branches=l,this.otherwise=h}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&l.expectedType.kind!=="value"&&(h=l.expectedType);const p=[];for(let b=1;b<r.length-1;b+=2){const A=l.parse(r[b],b,ei);if(!A)return null;const P=l.parse(r[b+1],b+1,h);if(!P)return null;p.push([A,P]),h=h||P.type}const x=l.parse(r[r.length-1],r.length-1,h);return x?new Qc(h,p,x):null}evaluate(r){for(const[l,h]of this.branches)if(l.evaluate(r))return h.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[l,h]of this.branches)r(l),r(h);r(this.otherwise)}outputDefined(){return this.branches.every((([r,l])=>l.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild((l=>{r.push(l.serialize())})),r}}var $l=Qc;class Gl{constructor(r,l,h,p){this.type=r,this.input=l,this.beginIndex=h,this.endIndex=p}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,vi),p=l.parse(r[2],2,Qn);if(!h||!p)return null;if(!Ac(h.type,[es(vi),Fr,vi]))return l.error(`Expected first argument to be of type array or string, but found ${_o(h.type)} instead`);if(r.length===4){const x=l.parse(r[3],3,Qn);return x?new Gl(h.type,h,p,x):null}return new Gl(h.type,h,p)}evaluate(r){const l=this.input.evaluate(r),h=this.beginIndex.evaluate(r);if(!rc(l,["string","array"]))throw new Vo(`Expected first argument to be of type array or string, but found ${_o(To(l))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(r);return l.slice(h,p)}return l.slice(h)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ns=Gl;function Ts(s,r){return s==="=="||s==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Li(s,r,l,h){return h.compare(r,l)===0}function Io(s,r,l){const h=s!=="=="&&s!=="!=";return class vT{constructor(x,b,A){this.type=ei,this.lhs=x,this.rhs=b,this.collator=A,this.hasUntypedArgument=x.type.kind==="value"||b.type.kind==="value"}static parse(x,b){if(x.length!==3&&x.length!==4)return b.error("Expected two or three arguments.");const A=x[0];let P=b.parse(x[1],1,vi);if(!P)return null;if(!Ts(A,P.type))return b.concat(1).error(`"${A}" comparisons are not supported for type '${_o(P.type)}'.`);let k=b.parse(x[2],2,vi);if(!k)return null;if(!Ts(A,k.type))return b.concat(2).error(`"${A}" comparisons are not supported for type '${_o(k.type)}'.`);if(P.type.kind!==k.type.kind&&P.type.kind!=="value"&&k.type.kind!=="value")return b.error(`Cannot compare types '${_o(P.type)}' and '${_o(k.type)}'.`);h&&(P.type.kind==="value"&&k.type.kind!=="value"?P=new Al(k.type,[P]):P.type.kind!=="value"&&k.type.kind==="value"&&(k=new Al(P.type,[k])));let q=null;if(x.length===4){if(P.type.kind!=="string"&&k.type.kind!=="string"&&P.type.kind!=="value"&&k.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(q=b.parse(x[3],3,Lr),!q)return null}return new vT(P,k,q)}evaluate(x){const b=this.lhs.evaluate(x),A=this.rhs.evaluate(x);if(h&&this.hasUntypedArgument){const P=To(b),k=To(A);if(P.kind!==k.kind||P.kind!=="string"&&P.kind!=="number")throw new Vo(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${P.kind}, ${k.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const P=To(b),k=To(A);if(P.kind!=="string"||k.kind!=="string")return r(x,b,A)}return this.collator?l(x,b,A,this.collator.evaluate(x)):r(x,b,A)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}serialize(){const x=[s];return this.eachChild((b=>{x.push(b.serialize())})),x}}}const yr=Io("==",(function(s,r,l){return r===l}),Li),la=Io("!=",(function(s,r,l){return r!==l}),(function(s,r,l,h){return!Li(0,r,l,h)})),oc=Io("<",(function(s,r,l){return r<l}),(function(s,r,l,h){return h.compare(r,l)<0})),sc=Io(">",(function(s,r,l){return r>l}),(function(s,r,l,h){return h.compare(r,l)>0})),Il=Io("<=",(function(s,r,l){return r<=l}),(function(s,r,l,h){return h.compare(r,l)<=0})),hu=Io(">=",(function(s,r,l){return r>=l}),(function(s,r,l,h){return h.compare(r,l)>=0}));class ac{constructor(r,l,h,p,x,b){this.type=Fr,this.number=r,this.locale=l,this.currency=h,this.unit=p,this.minFractionDigits=x,this.maxFractionDigits=b}static parse(r,l){if(r.length!==3)return l.error("Expected two arguments.");const h=l.parse(r[1],1,Qn);if(!h)return null;const p=r[2];if(typeof p!="object"||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let x=null;if(p.locale&&(x=l.parse(p.locale,1,Fr),!x))return null;let b=null;if(p.currency&&(b=l.parse(p.currency,1,Fr),!b))return null;let A=null;if(p.unit&&(A=l.parse(p.unit,1,Fr),!A))return null;let P=null;if(p["min-fraction-digits"]&&(P=l.parse(p["min-fraction-digits"],1,Qn),!P))return null;let k=null;return p["max-fraction-digits"]&&(k=l.parse(p["max-fraction-digits"],1,Qn),!k)?null:new ac(h,x,b,A,P,k)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class nl{constructor(r){this.type=Qn,this.input=r}static parse(r,l){if(r.length!==2)return l.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=l.parse(r[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${_o(h.type)} instead.`):new nl(h):null}evaluate(r){const l=this.input.evaluate(r);if(typeof l=="string"||Array.isArray(l))return l.length;throw new Vo(`Expected value to be of type string or array, but found ${_o(To(l))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild((l=>{r.push(l.serialize())})),r}}const Ur={"==":yr,"!=":la,">":sc,"<":oc,">=":hu,"<=":Il,array:Al,at:Zc,boolean:Al,case:$l,coalesce:Ks,collator:As,format:Ma,image:pl,in:Yc,"index-of":Lc,interpolate:el,"interpolate-hcl":el,"interpolate-lab":el,length:nl,let:Cc,literal:Oo,match:uu,number:Al,"number-format":ac,object:Al,slice:ns,step:_e,string:Al,"to-boolean":$s,"to-color":$s,"to-number":$s,"to-string":$s,var:zo,within:_s};function Wl(s,[r,l,h,p]){r=r.evaluate(s),l=l.evaluate(s),h=h.evaluate(s);const x=p?p.evaluate(s):1,b=Ku(r,l,h,x);if(b)throw new Vo(b);return new No(r/255*x,l/255*x,h/255*x,x)}function Zs(s,r){return s in r}function eu(s,r){const l=r[s];return l===void 0?null:l}function ga(s){return{type:s}}Es.register(Ur,{error:[{kind:"error"},[Fr],(s,[r])=>{throw new Vo(r.evaluate(s))}],typeof:[Fr,[vi],(s,[r])=>_o(To(r.evaluate(s)))],"to-rgba":[es(Qn,4),[aa],(s,[r])=>r.evaluate(s).toArray()],rgb:[aa,[Qn,Qn,Qn],Wl],rgba:[aa,[Qn,Qn,Qn,Qn],Wl],has:{type:ei,overloads:[[[Fr],(s,[r])=>Zs(r.evaluate(s),s.properties())],[[Fr,fa],(s,[r,l])=>Zs(r.evaluate(s),l.evaluate(s))]]},get:{type:vi,overloads:[[[Fr],(s,[r])=>eu(r.evaluate(s),s.properties())],[[Fr,fa],(s,[r,l])=>eu(r.evaluate(s),l.evaluate(s))]]},"feature-state":[vi,[Fr],(s,[r])=>eu(r.evaluate(s),s.featureState||{})],properties:[fa,[],s=>s.properties()],"geometry-type":[Fr,[],s=>s.geometryType()],id:[vi,[],s=>s.id()],zoom:[Qn,[],s=>s.globals.zoom],pitch:[Qn,[],s=>s.globals.pitch||0],"distance-from-center":[Qn,[],s=>s.distanceFromCenter()],"heatmap-density":[Qn,[],s=>s.globals.heatmapDensity||0],"line-progress":[Qn,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[Qn,[],s=>s.globals.skyRadialProgress||0],accumulated:[vi,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[Qn,ga(Qn),(s,r)=>{let l=0;for(const h of r)l+=h.evaluate(s);return l}],"*":[Qn,ga(Qn),(s,r)=>{let l=1;for(const h of r)l*=h.evaluate(s);return l}],"-":{type:Qn,overloads:[[[Qn,Qn],(s,[r,l])=>r.evaluate(s)-l.evaluate(s)],[[Qn],(s,[r])=>-r.evaluate(s)]]},"/":[Qn,[Qn,Qn],(s,[r,l])=>r.evaluate(s)/l.evaluate(s)],"%":[Qn,[Qn,Qn],(s,[r,l])=>r.evaluate(s)%l.evaluate(s)],ln2:[Qn,[],()=>Math.LN2],pi:[Qn,[],()=>Math.PI],e:[Qn,[],()=>Math.E],"^":[Qn,[Qn,Qn],(s,[r,l])=>Math.pow(r.evaluate(s),l.evaluate(s))],sqrt:[Qn,[Qn],(s,[r])=>Math.sqrt(r.evaluate(s))],log10:[Qn,[Qn],(s,[r])=>Math.log(r.evaluate(s))/Math.LN10],ln:[Qn,[Qn],(s,[r])=>Math.log(r.evaluate(s))],log2:[Qn,[Qn],(s,[r])=>Math.log(r.evaluate(s))/Math.LN2],sin:[Qn,[Qn],(s,[r])=>Math.sin(r.evaluate(s))],cos:[Qn,[Qn],(s,[r])=>Math.cos(r.evaluate(s))],tan:[Qn,[Qn],(s,[r])=>Math.tan(r.evaluate(s))],asin:[Qn,[Qn],(s,[r])=>Math.asin(r.evaluate(s))],acos:[Qn,[Qn],(s,[r])=>Math.acos(r.evaluate(s))],atan:[Qn,[Qn],(s,[r])=>Math.atan(r.evaluate(s))],min:[Qn,ga(Qn),(s,r)=>Math.min(...r.map((l=>l.evaluate(s))))],max:[Qn,ga(Qn),(s,r)=>Math.max(...r.map((l=>l.evaluate(s))))],abs:[Qn,[Qn],(s,[r])=>Math.abs(r.evaluate(s))],round:[Qn,[Qn],(s,[r])=>{const l=r.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[Qn,[Qn],(s,[r])=>Math.floor(r.evaluate(s))],ceil:[Qn,[Qn],(s,[r])=>Math.ceil(r.evaluate(s))],"filter-==":[ei,[Fr,vi],(s,[r,l])=>s.properties()[r.value]===l.value],"filter-id-==":[ei,[vi],(s,[r])=>s.id()===r.value],"filter-type-==":[ei,[Fr],(s,[r])=>s.geometryType()===r.value],"filter-<":[ei,[Fr,vi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h<p}],"filter-id-<":[ei,[vi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l<h}],"filter->":[ei,[Fr,vi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h>p}],"filter-id->":[ei,[vi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l>h}],"filter-<=":[ei,[Fr,vi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h<=p}],"filter-id-<=":[ei,[vi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l<=h}],"filter->=":[ei,[Fr,vi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h>=p}],"filter-id->=":[ei,[vi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l>=h}],"filter-has":[ei,[vi],(s,[r])=>r.value in s.properties()],"filter-has-id":[ei,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[ei,[es(Fr)],(s,[r])=>r.value.indexOf(s.geometryType())>=0],"filter-id-in":[ei,[es(vi)],(s,[r])=>r.value.indexOf(s.id())>=0],"filter-in-small":[ei,[Fr,es(vi)],(s,[r,l])=>l.value.indexOf(s.properties()[r.value])>=0],"filter-in-large":[ei,[Fr,es(vi)],(s,[r,l])=>(function(h,p,x,b){for(;x<=b;){const A=x+b>>1;if(p[A]===h)return!0;p[A]>h?b=A-1:x=A+1}return!1})(s.properties()[r.value],l.value,0,l.value.length-1)],all:{type:ei,overloads:[[[ei,ei],(s,[r,l])=>r.evaluate(s)&&l.evaluate(s)],[ga(ei),(s,r)=>{for(const l of r)if(!l.evaluate(s))return!1;return!0}]]},any:{type:ei,overloads:[[[ei,ei],(s,[r,l])=>r.evaluate(s)||l.evaluate(s)],[ga(ei),(s,r)=>{for(const l of r)if(l.evaluate(s))return!0;return!1}]]},"!":[ei,[ei],(s,[r])=>!r.evaluate(s)],"is-supported-script":[ei,[Fr],(s,[r])=>{const l=s.globals&&s.globals.isSupportedScript;return!l||l(r.evaluate(s))}],upcase:[Fr,[Fr],(s,[r])=>r.evaluate(s).toUpperCase()],downcase:[Fr,[Fr],(s,[r])=>r.evaluate(s).toLowerCase()],concat:[Fr,ga(vi),(s,r)=>r.map((l=>vo(l.evaluate(s)))).join("")],"resolved-locale":[Fr,[Lr],(s,[r])=>r.evaluate(s).resolvedLocale()]});var du=Ur;function Iu(s){return{result:"success",value:s}}function Ai(s){return{result:"error",value:s}}function Ra(s){return s["property-type"]==="data-driven"}function Hl(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function ca(s){return!!s.expression&&s.expression.interpolated}function Or(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function Ys(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function fu(s){return s}function Zu(s,r){const l=r.type==="color",h=s.stops&&typeof s.stops[0][0]=="object",p=h||!(h||s.property!==void 0),x=s.type||(ca(r)?"exponential":"interval");if(l&&((s=ss({},s)).stops&&(s.stops=s.stops.map((k=>[k[0],No.parse(k[1])]))),s.default=No.parse(s.default?s.default:r.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!Kc[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let b,A,P;if(x==="exponential")b=rs;else if(x==="interval")b=vh;else if(x==="categorical"){b=Cl,A=Object.create(null);for(const k of s.stops)A[k[0]]=k[1];P=typeof s.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);b=rl}if(h){const k={},q=[];for(let ue=0;ue<s.stops.length;ue++){const pe=s.stops[ue],Se=pe[0].zoom;k[Se]===void 0&&(k[Se]={zoom:Se,type:s.type,property:s.property,default:s.default,stops:[]},q.push(Se)),k[Se].stops.push([pe[0].value,pe[1]])}const K=[];for(const ue of q)K.push([k[ue].zoom,Zu(k[ue],r)]);const te={name:"linear"};return{kind:"composite",interpolationType:te,interpolationFactor:el.interpolationFactor.bind(void 0,te),zoomStops:K.map((ue=>ue[0])),evaluate:({zoom:ue},pe)=>rs({stops:K,base:s.base},r,ue).evaluate(ue,pe)}}if(p){const k=x==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:el.interpolationFactor.bind(void 0,k),zoomStops:s.stops.map((q=>q[0])),evaluate:({zoom:q})=>b(s,r,q,A,P)}}return{kind:"source",evaluate(k,q){const K=q&&q.properties?q.properties[s.property]:void 0;return K===void 0?Ui(s.default,r.default):b(s,r,K,A,P)}}}function Ui(s,r,l){return s!==void 0?s:r!==void 0?r:l!==void 0?l:void 0}function Cl(s,r,l,h,p){return Ui(typeof l===p?h[l]:void 0,s.default,r.default)}function vh(s,r,l){if(Or(l)!=="number")return Ui(s.default,r.default);const h=s.stops.length;if(h===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[h-1][0])return s.stops[h-1][1];const p=L(s.stops.map((x=>x[0])),l);return s.stops[p][1]}function rs(s,r,l){const h=s.base!==void 0?s.base:1;if(Or(l)!=="number")return Ui(s.default,r.default);const p=s.stops.length;if(p===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[p-1][0])return s.stops[p-1][1];const x=L(s.stops.map((q=>q[0])),l),b=(function(q,K,te,ue){const pe=ue-te,Se=q-te;return pe===0?0:K===1?Se/pe:(Math.pow(K,Se)-1)/(Math.pow(K,pe)-1)})(l,h,s.stops[x][0],s.stops[x+1][0]),A=s.stops[x][1],P=s.stops[x+1][1];let k=Xt[r.type]||fu;if(s.colorSpace&&s.colorSpace!=="rgb"){const q=Kc[s.colorSpace];k=(K,te)=>q.reverse(q.interpolate(q.forward(K),q.forward(te),b))}return typeof A.evaluate=="function"?{evaluate(...q){const K=A.evaluate.apply(void 0,q),te=P.evaluate.apply(void 0,q);if(K!==void 0&&te!==void 0)return k(K,te,b)}}:k(A,P,b)}function rl(s,r,l){return r.type==="color"?l=No.parse(l):r.type==="formatted"?l=Ao.fromString(l.toString()):r.type==="resolvedImage"?l=Vs.fromString(l.toString()):Or(l)===r.type||r.type==="enum"&&r.values[l]||(l=void 0),Ui(l,s.default,r.default)}class Pc{constructor(r,l){this.expression=r,this._warningHistory={},this._evaluator=new Gs,this._defaultValue=l?(function(h){return h.type==="color"&&(Ys(h.default)||Array.isArray(h.default))?new No(0,0,0,0):h.type==="color"?No.parse(h.default)||null:h.default===void 0?null:h.default})(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(r,l,h,p,x,b,A,P){return this._evaluator.globals=r,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=p||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=P||null,this.expression.evaluate(this._evaluator)}evaluate(r,l,h,p,x,b,A,P){this._evaluator.globals=r,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b||null,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=P||null;try{const k=this.expression.evaluate(this._evaluator);if(k==null||typeof k=="number"&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new Vo(`Expected value to be one of ${Object.keys(this._enumValues).map((q=>JSON.stringify(q))).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(k.message)),this._defaultValue}}}function Aa(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in du}function Co(s,r){const l=new Ja(du,[],r?(function(p){const x={color:aa,string:Fr,number:Qn,enum:Fr,boolean:ei,formatted:dl,resolvedImage:zi};return p.type==="array"?es(x[p.value]||vi,p.length):x[p.type]})(r):void 0),h=l.parse(s,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Iu(new Pc(h,r)):Ai(l.errors)}class Vh{constructor(r,l){this.kind=r,this._styleExpression=l,this.isStateDependent=r!=="constant"&&!$o(l.expression)}evaluateWithoutErrorHandling(r,l,h,p,x,b){return this._styleExpression.evaluateWithoutErrorHandling(r,l,h,p,x,b)}evaluate(r,l,h,p,x,b){return this._styleExpression.evaluate(r,l,h,p,x,b)}}class kc{constructor(r,l,h,p){this.kind=r,this.zoomStops=h,this._styleExpression=l,this.isStateDependent=r!=="camera"&&!$o(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(r,l,h,p,x,b){return this._styleExpression.evaluateWithoutErrorHandling(r,l,h,p,x,b)}evaluate(r,l,h,p,x,b){return this._styleExpression.evaluate(r,l,h,p,x,b)}interpolationFactor(r,l,h){return this.interpolationType?el.interpolationFactor(this.interpolationType,r,l,h):0}}function Vi(s,r){if((s=Co(s,r)).result==="error")return s;const l=s.value.expression,h=eo(l);if(!h&&!Ra(r))return Ai([new ka("","data expressions not supported")]);const p=Go(l,["zoom","pitch","distance-from-center"]);if(!p&&!Hl(r))return Ai([new ka("","zoom expressions not supported")]);const x=cc(l);return x||p?x instanceof ka?Ai([x]):x instanceof el&&!ca(r)?Ai([new ka("",'"interpolate" expressions cannot be used with this property')]):Iu(x?new kc(h?"camera":"composite",s.value,x.labels,x instanceof el?x.interpolation:void 0):new Vh(h?"constant":"source",s.value)):Ai([new ka("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class lc{constructor(r,l){this._parameters=r,this._specification=l,ss(this,Zu(this._parameters,this._specification))}static deserialize(r){return new lc(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function cc(s){let r=null;if(s instanceof Cc)r=cc(s.result);else if(s instanceof Ks){for(const l of s.args)if(r=cc(l),r)break}else(s instanceof _e||s instanceof el)&&s.input instanceof Es&&s.input.name==="zoom"&&(r=s);return r instanceof ka||s.eachChild((l=>{const h=cc(l);h instanceof ka?r=h:!r&&h?r=new ka("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&h&&r!==h&&(r=new ka("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),r}class or{constructor(r,l,h,p){this.message=(r?`${r}: `:"")+h,p&&(this.identifier=p),l!=null&&l.__line__&&(this.line=l.__line__)}}function go(s){const r=s.key,l=s.value,h=s.valueSpec||{},p=s.objectElementValidators||{},x=s.style,b=s.styleSpec;let A=[];const P=Or(l);if(P!=="object")return[new or(r,l,`object expected, ${P} found`)];for(const k in l){const q=k.split(".")[0];let K;p[q]?K=p[q]:h[q]?K=Xi:p["*"]?K=p["*"]:h["*"]&&(K=Xi),K?A=A.concat(K({key:(r&&`${r}.`)+k,value:l[k],valueSpec:h[q]||h["*"],style:x,styleSpec:b,object:l,objectKey:k},l)):A.push(new or(r,l[k],`unknown property "${k}"`))}for(const k in h)p[k]||h[k].required&&h[k].default===void 0&&l[k]===void 0&&A.push(new or(r,l,`missing required property "${k}"`));return A}function Cu(s){const r=s.value,l=s.valueSpec,h=s.style,p=s.styleSpec,x=s.key,b=s.arrayElementValidator||Xi;if(Or(r)!=="array")return[new or(x,r,`array expected, ${Or(r)} found`)];if(l.length&&r.length!==l.length)return[new or(x,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new or(x,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let A={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};p.$version<7&&(A.function=l.function),Or(l.value)==="object"&&(A=l.value);let P=[];for(let k=0;k<r.length;k++)P=P.concat(b({array:r,arrayIndex:k,value:r[k],valueSpec:A,style:h,styleSpec:p,key:`${x}[${k}]`}));return P}function Lu(s){const r=s.key,l=s.value,h=s.valueSpec;let p=Or(l);if(p==="number"&&l!=l&&(p="NaN"),p!=="number")return[new or(r,l,`number expected, ${p} found`)];if("minimum"in h){let x=h.minimum;if(Or(h.minimum)==="array"&&(x=h.minimum[s.arrayIndex]),l<x)return[new or(r,l,`${l} is less than the minimum value ${x}`)]}if("maximum"in h){let x=h.maximum;if(Or(h.maximum)==="array"&&(x=h.maximum[s.arrayIndex]),l>x)return[new or(r,l,`${l} is greater than the maximum value ${x}`)]}return[]}function qh(s){const r=s.valueSpec,l=as(s.value.type);let h,p,x,b={};const A=l!=="categorical"&&s.value.property===void 0,P=!A,k=Or(s.value.stops)==="array"&&Or(s.value.stops[0])==="array"&&Or(s.value.stops[0][0])==="object",q=go({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(ue){if(l==="identity")return[new or(ue.key,ue.value,'identity function may not have a "stops" property')];let pe=[];const Se=ue.value;return pe=pe.concat(Cu({key:ue.key,value:Se,valueSpec:ue.valueSpec,style:ue.style,styleSpec:ue.styleSpec,arrayElementValidator:K})),Or(Se)==="array"&&Se.length===0&&pe.push(new or(ue.key,Se,"array must have at least one stop")),pe},default:function(ue){return Xi({key:ue.key,value:ue.value,valueSpec:r,style:ue.style,styleSpec:ue.styleSpec})}}});return l==="identity"&&A&&q.push(new or(s.key,s.value,'missing required property "property"')),l==="identity"||s.value.stops||q.push(new or(s.key,s.value,'missing required property "stops"')),l==="exponential"&&s.valueSpec.expression&&!ca(s.valueSpec)&&q.push(new or(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(P&&!Ra(s.valueSpec)?q.push(new or(s.key,s.value,"property functions not supported")):A&&!Hl(s.valueSpec)&&q.push(new or(s.key,s.value,"zoom functions not supported"))),l!=="categorical"&&!k||s.value.property!==void 0||q.push(new or(s.key,s.value,'"property" property is required')),q;function K(ue){let pe=[];const Se=ue.value,Ge=ue.key;if(Or(Se)!=="array")return[new or(Ge,Se,`array expected, ${Or(Se)} found`)];if(Se.length!==2)return[new or(Ge,Se,`array length 2 expected, length ${Se.length} found`)];if(k){if(Or(Se[0])!=="object")return[new or(Ge,Se,`object expected, ${Or(Se[0])} found`)];if(Se[0].zoom===void 0)return[new or(Ge,Se,"object stop key must have zoom")];if(Se[0].value===void 0)return[new or(Ge,Se,"object stop key must have value")];const at=as(Se[0].zoom);if(typeof at!="number")return[new or(Ge,Se[0].zoom,"stop zoom values must be numbers")];if(x&&x>at)return[new or(Ge,Se[0].zoom,"stop zoom values must appear in ascending order")];at!==x&&(x=at,p=void 0,b={}),pe=pe.concat(go({key:`${Ge}[0]`,value:Se[0],valueSpec:{zoom:{}},style:ue.style,styleSpec:ue.styleSpec,objectElementValidators:{zoom:Lu,value:te}}))}else pe=pe.concat(te({key:`${Ge}[0]`,value:Se[0],style:ue.style,styleSpec:ue.styleSpec},Se));return Aa(Qi(Se[1]))?pe.concat([new or(`${Ge}[1]`,Se[1],"expressions are not allowed in function stops.")]):pe.concat(Xi({key:`${Ge}[1]`,value:Se[1],valueSpec:r,style:ue.style,styleSpec:ue.styleSpec}))}function te(ue,pe){const Se=Or(ue.value),Ge=as(ue.value),at=ue.value!==null?ue.value:pe;if(h){if(Se!==h)return[new or(ue.key,at,`${Se} stop domain type must match previous stop domain type ${h}`)]}else h=Se;if(Se!=="number"&&Se!=="string"&&Se!=="boolean"&&typeof Ge!="number"&&typeof Ge!="string"&&typeof Ge!="boolean")return[new or(ue.key,at,"stop domain value must be a number, string, or boolean")];if(Se!=="number"&&l!=="categorical"){let xt=`number expected, ${Se} found`;return Ra(r)&&l===void 0&&(xt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new or(ue.key,at,xt)]}return l!=="categorical"||Se!=="number"||typeof Ge=="number"&&isFinite(Ge)&&Math.floor(Ge)===Ge?l!=="categorical"&&Se==="number"&&typeof Ge=="number"&&typeof p=="number"&&p!==void 0&&Ge<p?[new or(ue.key,at,"stop domain values must appear in ascending order")]:(p=Ge,l==="categorical"&&Ge in b?[new or(ue.key,at,"stop domain values must be unique")]:(b[Ge]=!0,[])):[new or(ue.key,at,`integer expected, found ${String(Ge)}`)]}}function ya(s){const r=(s.expressionContext==="property"?Vi:Co)(Qi(s.value),s.valueSpec);if(r.result==="error")return r.value.map((h=>new or(`${s.key}${h.key}`,s.value,h.message)));const l=r.value.expression||r.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!l.outputDefined())return[new or(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!$o(l))return[new or(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter")return Na(l,s);if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Go(l,["zoom","feature-state"]))return[new or(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!eo(l))return[new or(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Na(s,r){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const p of r.valueSpec.expression.parameters)l.delete(p);if(l.size===0)return[];const h=[];return s instanceof Es&&l.has(s.name)?[new or(r.key,r.value,`["${s.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(s.eachChild((p=>{h.push(...Na(p,r))})),h)}function Mc(s){const r=s.key,l=s.value,h=s.valueSpec,p=[];return Array.isArray(h.values)?h.values.indexOf(as(l))===-1&&p.push(new or(r,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(h.values).indexOf(as(l))===-1&&p.push(new or(r,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),p}function Yu(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const r of s.slice(1))if(!Yu(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function tu(s,r="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Yu(s)||(s=xh(s));const l=s;let h=!0;try{h=(function(k){if(!pu(k))return k;let q=Qi(k);return Ju(q),q=gl(q),q})(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(l,null,2)}
        `)}const p=pn[`filter_${r}`],x=Co(h,p);let b=null;if(x.result==="error")throw new Error(x.value.map((k=>`${k.key}: ${k.message}`)).join(", "));b=(k,q,K)=>x.value.evaluate(k,q,{},K);let A=null,P=null;if(h!==l){const k=Co(l,p);if(k.result==="error")throw new Error(k.value.map((q=>`${q.key}: ${q.message}`)).join(", "));A=(q,K,te,ue,pe)=>k.value.evaluate(q,K,{},te,void 0,void 0,ue,pe),P=!eo(k.value.expression)}return{filter:b,dynamicFilter:A||void 0,needGeometry:Qd(h),needFeature:!!P}}function gl(s){if(!Array.isArray(s))return s;const r=(function(l){if(Ch.has(l[0])){for(let h=1;h<l.length;h++)if(pu(l[h]))return!0}return l})(s);return r===!0?r:r.map((l=>gl(l)))}function Ju(s){let r=!1;const l=[];if(s[0]==="case"){for(let h=1;h<s.length-1;h+=2)r=r||pu(s[h]),l.push(s[h+1]);l.push(s[s.length-1])}else if(s[0]==="match"){r=r||pu(s[1]);for(let h=2;h<s.length-1;h+=2)l.push(s[h+1]);l.push(s[s.length-1])}else if(s[0]==="step"){r=r||pu(s[1]);for(let h=1;h<s.length-1;h+=2)l.push(s[h+1])}r&&(s.length=0,s.push("any",...l));for(let h=1;h<s.length;h++)Ju(s[h])}function pu(s){if(!Array.isArray(s))return!1;if((r=s[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let l=1;l<s.length;l++)if(pu(s[l]))return!0;return!1}const Ch=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Qu(s,r){return s<r?-1:s>r?1:0}function Qd(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let r=1;r<s.length;r++)if(Qd(s[r]))return!0;return!1}function xh(s){if(!s)return!0;const r=s[0];return s.length<=1?r!=="any":r==="=="?Lh(s[1],s[2],"=="):r==="!="?Va(Lh(s[1],s[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Lh(s[1],s[2],r):r==="any"?(l=s.slice(1),["any"].concat(l.map(xh))):r==="all"?["all"].concat(s.slice(1).map(xh)):r==="none"?["all"].concat(s.slice(1).map(xh).map(Va)):r==="in"?Ta(s[1],s.slice(2)):r==="!in"?Va(Ta(s[1],s.slice(2))):r==="has"?Da(s[1]):r==="!has"?Va(Da(s[1])):r!=="within"||s;var l}function Lh(s,r,l){switch(s){case"$type":return[`filter-type-${l}`,r];case"$id":return[`filter-id-${l}`,r];default:return[`filter-${l}`,s,r]}}function Ta(s,r){if(r.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some((l=>typeof l!=typeof r[0]))?["filter-in-large",s,["literal",r.sort(Qu)]]:["filter-in-small",s,["literal",r]]}}function Da(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Va(s){return["!",s]}function yl(s){return Yu(Qi(s.value))?ya(ss({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):uc(s)}function uc(s){const r=s.value,l=s.key;if(Or(r)!=="array")return[new or(l,r,`array expected, ${Or(r)} found`)];const h=s.styleSpec;let p,x=[];if(r.length<1)return[new or(l,r,"filter array must have at least 1 element")];switch(x=x.concat(Mc({key:`${l}[0]`,value:r[0],valueSpec:h.filter_operator,style:s.style,styleSpec:s.styleSpec})),as(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&as(r[1])==="$type"&&x.push(new or(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&x.push(new or(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(p=Or(r[1]),p!=="string"&&x.push(new or(`${l}[1]`,r[1],`string expected, ${p} found`)));for(let b=2;b<r.length;b++)p=Or(r[b]),as(r[1])==="$type"?x=x.concat(Mc({key:`${l}[${b}]`,value:r[b],valueSpec:h.geometry_type,style:s.style,styleSpec:s.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&x.push(new or(`${l}[${b}]`,r[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<r.length;b++)x=x.concat(uc({key:`${l}[${b}]`,value:r[b],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":p=Or(r[1]),r.length!==2?x.push(new or(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="string"&&x.push(new or(`${l}[1]`,r[1],`string expected, ${p} found`));break;case"within":p=Or(r[1]),r.length!==2?x.push(new or(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="object"&&x.push(new or(`${l}[1]`,r[1],`object expected, ${p} found`))}return x}function _a(s,r){const l=s.key,h=s.style,p=s.styleSpec,x=s.value,b=s.objectKey,A=p[`${r}_${s.layerType}`];if(!A)return[];const P=b.match(/^(.*)-transition$/);if(r==="paint"&&P&&A[P[1]]&&A[P[1]].transition)return Xi({key:l,value:x,valueSpec:p.transition,style:h,styleSpec:p});const k=s.valueSpec||A[b];if(!k)return[new or(l,x,`unknown property "${b}"`)];let q;if(Or(x)==="string"&&Ra(k)&&!k.tokens&&(q=/^{([^}]+)}$/.exec(x))){const te=`\`{ "type": "identity", "property": ${q?JSON.stringify(q[1]):'"_"'} }\``;return[new or(l,x,`"${b}" does not support interpolation syntax
Use an identity property function instead: ${te}.`)]}const K=[];return s.layerType==="symbol"&&(b==="text-field"&&h&&!h.glyphs&&K.push(new or(l,x,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&Ys(Qi(x))&&as(x.type)==="identity"&&K.push(new or(l,x,'"text-font" does not support identity functions'))),K.concat(Xi({key:s.key,value:x,valueSpec:k,style:h,styleSpec:p,expressionContext:"property",propertyType:r,propertyKey:b}))}function qa(s){return _a(s,"paint")}function od(s){return _a(s,"layout")}function Id(s){let r=[];const l=s.value,h=s.key,p=s.style,x=s.styleSpec;l.type||l.ref||r.push(new or(h,l,'either "type" or "ref" is required'));let b=as(l.type);const A=as(l.ref);if(l.id){const P=as(l.id);for(let k=0;k<s.arrayIndex;k++){const q=p.layers[k];as(q.id)===P&&r.push(new or(h,l.id,`duplicate layer id "${l.id}", previously used at line ${q.id.__line__}`))}}if("ref"in l){let P;["type","source","source-layer","filter","layout"].forEach((k=>{k in l&&r.push(new or(h,l[k],`"${k}" is prohibited for ref layers`))})),p.layers.forEach((k=>{as(k.id)===A&&(P=k)})),P?P.ref?r.push(new or(h,l.ref,"ref cannot reference another ref layer")):b=as(P.type):typeof A=="string"&&r.push(new or(h,l.ref,`ref layer "${A}" not found`))}else if(b!=="background"&&b!=="sky")if(l.source){const P=p.sources&&p.sources[l.source],k=P&&as(P.type);P?k==="vector"&&b==="raster"?r.push(new or(h,l.source,`layer "${l.id}" requires a raster source`)):k==="raster"&&b!=="raster"?r.push(new or(h,l.source,`layer "${l.id}" requires a vector source`)):k!=="vector"||l["source-layer"]?k==="raster-dem"&&b!=="hillshade"?r.push(new or(h,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||k==="geojson"&&P.lineMetrics||r.push(new or(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new or(h,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new or(h,l.source,`source "${l.source}" not found`))}else r.push(new or(h,l,'missing required property "source"'));return r=r.concat(go({key:h,value:l,valueSpec:x.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Xi({key:`${h}.type`,value:l.type,valueSpec:x.layer.type,style:s.style,styleSpec:s.styleSpec,object:l,objectKey:"type"}),filter:P=>yl(ss({layerType:b},P)),layout:P=>go({layer:l,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":k=>od(ss({layerType:b},k))}}),paint:P=>go({layer:l,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":k=>qa(ss({layerType:b},k))}})}})),r}function Fa(s){const r=s.value,l=s.key,h=Or(r);return h!=="string"?[new or(l,r,`string expected, ${h} found`)]:[]}const Rc={promoteId:function({key:s,value:r}){if(Or(r)==="string")return Fa({key:s,value:r});{const l=[];for(const h in r)l.push(...Fa({key:`${s}.${h}`,value:r[h]}));return l}}};function eh(s){const r=s.value,l=s.key,h=s.styleSpec,p=s.style;if(!r.type)return[new or(l,r,'"type" is required')];const x=as(r.type);let b;switch(x){case"vector":case"raster":case"raster-dem":return b=go({key:l,value:r,valueSpec:h[`source_${x.replace("-","_")}`],style:s.style,styleSpec:h,objectElementValidators:Rc}),b;case"geojson":if(b=go({key:l,value:r,valueSpec:h.source_geojson,style:p,styleSpec:h,objectElementValidators:Rc}),r.cluster)for(const A in r.clusterProperties){const[P,k]=r.clusterProperties[A],q=typeof P=="string"?[P,["accumulated"],["get",A]]:P;b.push(...ya({key:`${l}.${A}.map`,value:k,expressionContext:"cluster-map"})),b.push(...ya({key:`${l}.${A}.reduce`,value:q,expressionContext:"cluster-reduce"}))}return b;case"video":return go({key:l,value:r,valueSpec:h.source_video,style:p,styleSpec:h});case"image":return go({key:l,value:r,valueSpec:h.source_image,style:p,styleSpec:h});case"canvas":return[new or(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Mc({key:`${l}.type`,value:r.type,valueSpec:{values:Ph(h)}})}}function Ph(s){return s.source.reduce(((r,l)=>{const h=s[l];return h.type.type==="enum"&&(r=r.concat(Object.keys(h.type.values))),r}),[])}function $h(s){const r=s.value,l=s.styleSpec,h=l.light,p=s.style;let x=[];const b=Or(r);if(r===void 0)return x;if(b!=="object")return x=x.concat([new or("light",r,`object expected, ${b} found`)]),x;for(const A in r){const P=A.match(/^(.*)-transition$/);x=x.concat(P&&h[P[1]]&&h[P[1]].transition?Xi({key:A,value:r[A],valueSpec:l.transition,style:p,styleSpec:l}):h[A]?Xi({key:A,value:r[A],valueSpec:h[A],style:p,styleSpec:l}):[new or(A,r[A],`unknown property "${A}"`)])}return x}function nu(s){const r=s.value,l=s.key,h=s.style,p=s.styleSpec,x=p.terrain;let b=[];const A=Or(r);if(r===void 0)return b;if(A!=="object")return b=b.concat([new or("terrain",r,`object expected, ${A} found`)]),b;for(const P in r){const k=P.match(/^(.*)-transition$/);b=b.concat(k&&x[k[1]]&&x[k[1]].transition?Xi({key:P,value:r[P],valueSpec:p.transition,style:h,styleSpec:p}):x[P]?Xi({key:P,value:r[P],valueSpec:x[P],style:h,styleSpec:p}):[new or(P,r[P],`unknown property "${P}"`)])}if(r.source){const P=h.sources&&h.sources[r.source],k=P&&as(P.type);P?k!=="raster-dem"&&b.push(new or(l,r.source,`terrain cannot be used with a source of type ${String(k)}, it only be used with a "raster-dem" source type`)):b.push(new or(l,r.source,`source "${r.source}" not found`))}else b.push(new or(l,r,'terrain is missing required property "source"'));return b}function Nc(s){const r=s.value,l=s.style,h=s.styleSpec,p=h.fog;let x=[];const b=Or(r);if(r===void 0)return x;if(b!=="object")return x=x.concat([new or("fog",r,`object expected, ${b} found`)]),x;for(const A in r){const P=A.match(/^(.*)-transition$/);x=x.concat(P&&p[P[1]]&&p[P[1]].transition?Xi({key:A,value:r[A],valueSpec:h.transition,style:l,styleSpec:h}):p[A]?Xi({key:A,value:r[A],valueSpec:p[A],style:l,styleSpec:h}):[new or(A,r[A],`unknown property "${A}"`)])}return x}const Lo={"*":()=>[],array:Cu,boolean:function(s){const r=s.value,l=s.key,h=Or(r);return h!=="boolean"?[new or(l,r,`boolean expected, ${h} found`)]:[]},number:Lu,color:function(s){const r=s.key,l=s.value,h=Or(l);return h!=="string"?[new or(r,l,`color expected, ${h} found`)]:El(l)===null?[new or(r,l,`color expected, "${l}" found`)]:[]},enum:Mc,filter:yl,function:qh,layer:Id,object:go,source:eh,light:$h,terrain:nu,fog:Nc,string:Fa,formatted:function(s){return Fa(s).length===0?[]:ya(s)},resolvedImage:function(s){return Fa(s).length===0?[]:ya(s)},projection:function(s){const r=s.value,l=s.styleSpec,h=l.projection,p=s.style;let x=[];const b=Or(r);if(b==="object")for(const A in r)x=x.concat(Xi({key:A,value:r[A],valueSpec:h[A],style:p,styleSpec:l}));else b!=="string"&&(x=x.concat([new or("projection",r,`object or string expected, ${b} found`)]));return x}};function Xi(s){const r=s.value,l=s.valueSpec,h=s.styleSpec;return l.expression&&Ys(as(r))?qh(s):l.expression&&Aa(Qi(r))?ya(s):l.type&&Lo[l.type]?Lo[l.type](s):go(ss({},s,{valueSpec:l.type?h[l.type]:l}))}function Ll(s){const r=s.value,l=s.key,h=Fa(s);return h.length||(r.indexOf("{fontstack}")===-1&&h.push(new or(l,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&h.push(new or(l,r,'"glyphs" url must include a "{range}" token'))),h}function va(s,r=pn){return $a(Xi({key:"",value:s,valueSpec:r.$root,styleSpec:r,style:s,objectElementValidators:{glyphs:Ll,"*":()=>[]}}))}const Is=s=>$a(qa(s)),Xl=s=>$a(od(s));function $a(s){return s.slice().sort(((r,l)=>r.line&&l.line?r.line-l.line:0))}function Pl(s,r){let l=!1;if(r&&r.length)for(const h of r)s.fire(new Ea(new Error(h.message))),l=!0;return l}var sd=Dc,Ga=3;function Dc(s,r,l){var h=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var p=new Int32Array(this.arrayBuffer);s=p[0],this.d=(r=p[1])+2*(l=p[2]);for(var x=0;x<this.d*this.d;x++){var b=p[Ga+x],A=p[Ga+x+1];h.push(b===A?null:p.subarray(b,A))}var P=p[Ga+h.length+1];this.keys=p.subarray(p[Ga+h.length],P),this.bboxes=p.subarray(P),this.insert=this._insertReadonly}else{this.d=r+2*l;for(var k=0;k<this.d*this.d;k++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=s,this.padding=l,this.scale=r/s,this.uid=0;var q=l/r*s;this.min=-q,this.max=s+q}Dc.prototype.insert=function(s,r,l,h,p){this._forEachCell(r,l,h,p,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(p)},Dc.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Dc.prototype._insertCell=function(s,r,l,h,p,x){this.cells[p].push(x)},Dc.prototype.query=function(s,r,l,h,p){var x=this.min,b=this.max;if(s<=x&&r<=x&&b<=l&&b<=h&&!p)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(s,r,l,h,this._queryCell,A,{},p),A},Dc.prototype._queryCell=function(s,r,l,h,p,x,b,A){var P=this.cells[p];if(P!==null)for(var k=this.keys,q=this.bboxes,K=0;K<P.length;K++){var te=P[K];if(b[te]===void 0){var ue=4*te;(A?A(q[ue+0],q[ue+1],q[ue+2],q[ue+3]):s<=q[ue+2]&&r<=q[ue+3]&&l>=q[ue+0]&&h>=q[ue+1])?(b[te]=!0,x.push(k[te])):b[te]=!1}}},Dc.prototype._forEachCell=function(s,r,l,h,p,x,b,A){for(var P=this._convertToCellCoord(s),k=this._convertToCellCoord(r),q=this._convertToCellCoord(l),K=this._convertToCellCoord(h),te=P;te<=q;te++)for(var ue=k;ue<=K;ue++){var pe=this.d*ue+te;if((!A||A(this._convertFromCellCoord(te),this._convertFromCellCoord(ue),this._convertFromCellCoord(te+1),this._convertFromCellCoord(ue+1)))&&p.call(this,s,r,l,h,pe,x,b,A))return}},Dc.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},Dc.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},Dc.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,r=Ga+this.cells.length+1+1,l=0,h=0;h<this.cells.length;h++)l+=this.cells[h].length;var p=new Int32Array(r+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var x=r,b=0;b<s.length;b++){var A=s[b];p[Ga+b]=x,p.set(A,x),x+=A.length}return p[Ga+s.length]=x,p.set(this.keys,x),p[Ga+s.length+1]=x+=this.keys.length,p.set(this.bboxes,x),x+=this.bboxes.length,p.buffer};var Ia=he(sd);const bh={};function sr(s,r,l={}){Object.defineProperty(s,"_classRegistryKey",{value:r,writeable:!1}),bh[r]={klass:s,omit:l.omit||[]}}sr(Object,"Object"),Ia.serialize=function(s,r){const l=s.toArrayBuffer();return r&&r.push(l),{buffer:l}},Ia.deserialize=function(s){return new Ia(s.buffer)},Object.defineProperty(Ia,"name",{value:"Grid"}),sr(Ia,"Grid"),sr(No,"Color"),sr(Error,"Error"),sr(Jr,"AJAXError"),sr(Vs,"ResolvedImage"),sr(lc,"StylePropertyFunction"),sr(Pc,"StyleExpression",{omit:["_evaluator"]}),sr(kc,"ZoomDependentExpression"),sr(Vh,"ZoomConstantExpression"),sr(Es,"CompoundExpression",{omit:["_evaluate"]});for(const s in du)bh[du[s]._classRegistryKey]||sr(du[s],`Expression${s}`);function kh(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function C(s){return w.ImageBitmap&&s instanceof w.ImageBitmap}function F(s,r){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(kh(s)||C(s))return r&&r.push(s),s;if(ArrayBuffer.isView(s)){const l=s;return r&&r.push(l.buffer),l}if(s instanceof w.ImageData)return r&&r.push(s.data.buffer),s;if(Array.isArray(s)){const l=[];for(const h of s)l.push(F(h,r));return l}if(typeof s=="object"){const l=s.constructor,h=l._classRegistryKey;if(!h)throw new Error(`can't serialize object of unregistered class ${h}`);const p=l.serialize?l.serialize(s,r):{};if(!l.serialize){for(const x in s)s.hasOwnProperty(x)&&(bh[h].omit.indexOf(x)>=0||(p[x]=F(s[x],r)));s instanceof Error&&(p.message=s.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(p.$name=h),p}throw new Error("can't serialize object of type "+typeof s)}function Y(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||kh(s)||C(s)||ArrayBuffer.isView(s)||s instanceof w.ImageData)return s;if(Array.isArray(s))return s.map(Y);if(typeof s=="object"){const r=s.$name||"Object",{klass:l}=bh[r];if(!l)throw new Error(`can't deserialize unregistered class ${r}`);if(l.deserialize)return l.deserialize(s);const h=Object.create(l.prototype);for(const p of Object.keys(s))p!=="$name"&&(h[p]=Y(s[p]));return h}throw new Error("can't deserialize object of type "+typeof s)}const ie={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Ce(s){for(const r of s)if(Ke(r.charCodeAt(0)))return!0;return!1}function Be(s){for(const r of s)if(!qe(r.charCodeAt(0)))return!1;return!0}function qe(s){return!(ie.Arabic(s)||ie["Arabic Supplement"](s)||ie["Arabic Extended-A"](s)||ie["Arabic Presentation Forms-A"](s)||ie["Arabic Presentation Forms-B"](s))}function Ke(s){return!(s!==746&&s!==747&&(s<4352||!(ie["Bopomofo Extended"](s)||ie.Bopomofo(s)||ie["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||ie["CJK Compatibility Ideographs"](s)||ie["CJK Compatibility"](s)||ie["CJK Radicals Supplement"](s)||ie["CJK Strokes"](s)||!(!ie["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||ie["CJK Unified Ideographs Extension A"](s)||ie["CJK Unified Ideographs"](s)||ie["Enclosed CJK Letters and Months"](s)||ie["Hangul Compatibility Jamo"](s)||ie["Hangul Jamo Extended-A"](s)||ie["Hangul Jamo Extended-B"](s)||ie["Hangul Jamo"](s)||ie["Hangul Syllables"](s)||ie.Hiragana(s)||ie["Ideographic Description Characters"](s)||ie.Kanbun(s)||ie["Kangxi Radicals"](s)||ie["Katakana Phonetic Extensions"](s)||ie.Katakana(s)&&s!==12540||!(!ie["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!ie["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||ie["Unified Canadian Aboriginal Syllabics"](s)||ie["Unified Canadian Aboriginal Syllabics Extended"](s)||ie["Vertical Forms"](s)||ie["Yijing Hexagram Symbols"](s)||ie["Yi Syllables"](s)||ie["Yi Radicals"](s))))}function Je(s){return!(Ke(s)||(function(r){return!!(ie["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||ie["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||ie["Letterlike Symbols"](r)||ie["Number Forms"](r)||ie["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||ie["Control Pictures"](r)&&r!==9251||ie["Optical Character Recognition"](r)||ie["Enclosed Alphanumerics"](r)||ie["Geometric Shapes"](r)||ie["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||ie["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||ie["CJK Symbols and Punctuation"](r)||ie.Katakana(r)||ie["Private Use Area"](r)||ie["CJK Compatibility Forms"](r)||ie["Small Form Variants"](r)||ie["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)})(s))}function dt(s){return s>=1424&&s<=2303||ie["Arabic Presentation Forms-A"](s)||ie["Arabic Presentation Forms-B"](s)}function Dt(s,r){return!(!r&&dt(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||ie.Khmer(s))}function Qt(s){for(const r of s)if(dt(r.charCodeAt(0)))return!0;return!1}const ft="deferred",Ot="loading",Kt="loaded";let Sn=null,y="unavailable",a=null;const f=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(y="error"),Sn&&Sn(s)};function v(){S.fire(new hl("pluginStateChange",{pluginStatus:y,pluginURL:a}))}const S=new Ro,T=function(){return y},R=function(){if(y!==ft||!a)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");y=Ot,v(),a&&ui({url:a},(s=>{s?f(s):(y=Kt,v())}))},B={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>y===Kt||B.applyArabicShaping!=null,isLoading:()=>y===Ot,setState(s){y=s.pluginStatus,a=s.pluginURL},isParsed:()=>B.applyArabicShaping!=null&&B.processBidirectionalText!=null&&B.processStyledBidirectionalText!=null,getPluginURL:()=>a};class G{constructor(r,l){this.zoom=r,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(r){return(function(l,h){for(const p of l)if(!Dt(p.charCodeAt(0),h))return!1;return!0})(r,B.isLoaded())}}class J{constructor(r,l){this.property=r,this.value=l,this.expression=(function(h,p){if(Ys(h))return new lc(h,p);if(Aa(h)){const x=Vi(h,p);if(x.result==="error")throw new Error(x.value.map((b=>`${b.key}: ${b.message}`)).join(", "));return x.value}{let x=h;return typeof h=="string"&&p.type==="color"&&(x=No.parse(h)),{kind:"constant",evaluate:()=>x}}})(l===void 0?r.specification.default:l,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,l,h){return this.property.possiblyEvaluate(this,r,l,h)}}class ee{constructor(r){this.property=r,this.value=new J(r,void 0)}transitioned(r,l){return new Ae(this.property,this.value,l,Fe({},r.transition,this.transition),r.now)}untransitioned(){return new Ae(this.property,this.value,null,{},0)}}class me{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return zt(this._values[r].value.value)}setValue(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new ee(this._values[r].property)),this._values[r].value=new J(this._values[r].property,l===null?void 0:zt(l))}getTransition(r){return zt(this._values[r].transition)}setTransition(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new ee(this._values[r].property)),this._values[r].transition=zt(l)||void 0}serialize(){const r={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(r[l]=h);const p=this.getTransition(l);p!==void 0&&(r[`${l}-transition`]=p)}return r}transitioned(r,l){const h=new Te(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].transitioned(r,l._values[p]);return h}untransitioned(){const r=new Te(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].untransitioned();return r}}class Ae{constructor(r,l,h,p,x){const b=p.delay||0,A=p.duration||0;x=x||0,this.property=r,this.value=l,this.begin=x+b,this.end=this.begin+A,r.specification.transition&&(p.delay||p.duration)&&(this.prior=h)}possiblyEvaluate(r,l,h){const p=r.now||0,x=this.value.possiblyEvaluate(r,l,h),b=this.prior;if(b){if(p>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(p<this.begin)return b.possiblyEvaluate(r,l,h);{const A=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(r,l,h),x,Oe(A))}}return x}}class Te{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,l,h){const p=new We(this._properties);for(const x of Object.keys(this._values))p._values[x]=this._values[x].possiblyEvaluate(r,l,h);return p}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class He{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return zt(this._values[r].value)}setValue(r,l){this._values[r]=new J(this._values[r].property,l===null?void 0:zt(l))}serialize(){const r={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(r[l]=h)}return r}possiblyEvaluate(r,l,h){const p=new We(this._properties);for(const x of Object.keys(this._values))p._values[x]=this._values[x].possiblyEvaluate(r,l,h);return p}}class je{constructor(r,l,h){this.property=r,this.value=l,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,l,h,p){return this.property.evaluate(this.value,this.parameters,r,l,h,p)}}class We{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class ve{constructor(r){this.specification=r}possiblyEvaluate(r,l){return r.expression.evaluate(l)}interpolate(r,l,h){const p=Xt[this.specification.type];return p?p(r,l,h):r}}class Ue{constructor(r,l){this.specification=r,this.overrides=l}possiblyEvaluate(r,l,h,p){return new je(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(l,null,{},h,p)}:r.expression,l)}interpolate(r,l,h){if(r.value.kind!=="constant"||l.value.kind!=="constant")return r;if(r.value.value===void 0||l.value.value===void 0)return new je(this,{kind:"constant",value:void 0},r.parameters);const p=Xt[this.specification.type];return p?new je(this,{kind:"constant",value:p(r.value.value,l.value.value,h)},r.parameters):r}evaluate(r,l,h,p,x,b){return r.kind==="constant"?r.value:r.evaluate(l,h,p,x,b)}}class rt{constructor(r){this.specification=r}possiblyEvaluate(r,l,h,p){return!!r.expression.evaluate(l,null,{},h,p)}interpolate(){return!1}}class st{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new G(0,{});for(const h in r){const p=r[h];p.specification.overridable&&this.overridableProperties.push(h);const x=this.defaultPropertyValues[h]=new J(p,void 0),b=this.defaultTransitionablePropertyValues[h]=new ee(p);this.defaultTransitioningPropertyValues[h]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=x.possiblyEvaluate(l)}}}function bt(s,r){return 256*(s=De(Math.floor(s),0,255))+De(Math.floor(r),0,255)}sr(Ue,"DataDrivenProperty"),sr(ve,"DataConstantProperty"),sr(rt,"ColorRampProperty");const wt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class vt{constructor(r,l){this._structArray=r,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class At{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,l){return r._trim(),l&&(r.isTransferred=!0,l.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const l=Object.create(this.prototype);return l.arrayBuffer=r.arrayBuffer,l.length=r.length,l.capacity=r.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function kt(s,r=1){let l=0,h=0;return{members:s.map((p=>{const x=wt[p.type].BYTES_PER_ELEMENT,b=l=Vt(l,Math.max(r,x)),A=p.components||1;return h=Math.max(h,x),l+=x*A,{name:p.name,type:p.type,components:A,offset:b}})),size:Vt(l,Math.max(h,r)),alignment:r}}function Vt(s,r){return Math.ceil(s/r)*r}class gn extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const p=2*r;return this.int16[p+0]=l,this.int16[p+1]=h,r}}gn.prototype.bytesPerElement=4,sr(gn,"StructArrayLayout2i4");class Ut extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,h)}emplace(r,l,h,p){const x=3*r;return this.int16[x+0]=l,this.int16[x+1]=h,this.int16[x+2]=p,r}}Ut.prototype.bytesPerElement=6,sr(Ut,"StructArrayLayout3i6");class un extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const b=4*r;return this.int16[b+0]=l,this.int16[b+1]=h,this.int16[b+2]=p,this.int16[b+3]=x,r}}un.prototype.bytesPerElement=8,sr(un,"StructArrayLayout4i8");class $t extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,l,h,p,x,b,A)}emplace(r,l,h,p,x,b,A,P){const k=6*r,q=12*r,K=3*r;return this.int16[k+0]=l,this.int16[k+1]=h,this.uint8[q+4]=p,this.uint8[q+5]=x,this.uint8[q+6]=b,this.uint8[q+7]=A,this.float32[K+2]=P,r}}$t.prototype.bytesPerElement=12,sr($t,"StructArrayLayout2i4ub1f12");class In extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const b=4*r;return this.float32[b+0]=l,this.float32[b+1]=h,this.float32[b+2]=p,this.float32[b+3]=x,r}}In.prototype.bytesPerElement=16,sr(In,"StructArrayLayout4f16");class jt extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x){const b=this.length;return this.resize(b+1),this.emplace(b,r,l,h,p,x)}emplace(r,l,h,p,x,b){const A=6*r,P=3*r;return this.uint16[A+0]=l,this.uint16[A+1]=h,this.uint16[A+2]=p,this.uint16[A+3]=x,this.float32[P+2]=b,r}}jt.prototype.bytesPerElement=12,sr(jt,"StructArrayLayout4ui1f12");class sn extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const b=4*r;return this.uint16[b+0]=l,this.uint16[b+1]=h,this.uint16[b+2]=p,this.uint16[b+3]=x,r}}sn.prototype.bytesPerElement=8,sr(sn,"StructArrayLayout4ui8");class Cn extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b){const A=this.length;return this.resize(A+1),this.emplace(A,r,l,h,p,x,b)}emplace(r,l,h,p,x,b,A){const P=6*r;return this.int16[P+0]=l,this.int16[P+1]=h,this.int16[P+2]=p,this.int16[P+3]=x,this.int16[P+4]=b,this.int16[P+5]=A,r}}Cn.prototype.bytesPerElement=12,sr(Cn,"StructArrayLayout6i12");class _n extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b,A,P,k,q,K,te){const ue=this.length;return this.resize(ue+1),this.emplace(ue,r,l,h,p,x,b,A,P,k,q,K,te)}emplace(r,l,h,p,x,b,A,P,k,q,K,te,ue){const pe=12*r;return this.int16[pe+0]=l,this.int16[pe+1]=h,this.int16[pe+2]=p,this.int16[pe+3]=x,this.uint16[pe+4]=b,this.uint16[pe+5]=A,this.uint16[pe+6]=P,this.uint16[pe+7]=k,this.int16[pe+8]=q,this.int16[pe+9]=K,this.int16[pe+10]=te,this.int16[pe+11]=ue,r}}_n.prototype.bytesPerElement=24,sr(_n,"StructArrayLayout4i4ui4i24");class Mn extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b){const A=this.length;return this.resize(A+1),this.emplace(A,r,l,h,p,x,b)}emplace(r,l,h,p,x,b,A){const P=10*r,k=5*r;return this.int16[P+0]=l,this.int16[P+1]=h,this.int16[P+2]=p,this.float32[k+2]=x,this.float32[k+3]=b,this.float32[k+4]=A,r}}Mn.prototype.bytesPerElement=20,sr(Mn,"StructArrayLayout3i3f20");class cr extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint32[1*r+0]=l,r}}cr.prototype.bytesPerElement=4,sr(cr,"StructArrayLayout1ul4");class kr extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b,A,P,k,q,K,te,ue){const pe=this.length;return this.resize(pe+1),this.emplace(pe,r,l,h,p,x,b,A,P,k,q,K,te,ue)}emplace(r,l,h,p,x,b,A,P,k,q,K,te,ue,pe){const Se=20*r,Ge=10*r;return this.int16[Se+0]=l,this.int16[Se+1]=h,this.int16[Se+2]=p,this.int16[Se+3]=x,this.int16[Se+4]=b,this.float32[Ge+3]=A,this.float32[Ge+4]=P,this.float32[Ge+5]=k,this.float32[Ge+6]=q,this.int16[Se+14]=K,this.uint32[Ge+8]=te,this.uint16[Se+18]=ue,this.uint16[Se+19]=pe,r}}kr.prototype.bytesPerElement=40,sr(kr,"StructArrayLayout5i4f1i1ul2ui40");class er extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,l,h,p,x,b,A)}emplace(r,l,h,p,x,b,A,P){const k=8*r;return this.int16[k+0]=l,this.int16[k+1]=h,this.int16[k+2]=p,this.int16[k+4]=x,this.int16[k+5]=b,this.int16[k+6]=A,this.int16[k+7]=P,r}}er.prototype.bytesPerElement=16,sr(er,"StructArrayLayout3i2i2i16");class ar extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x){const b=this.length;return this.resize(b+1),this.emplace(b,r,l,h,p,x)}emplace(r,l,h,p,x,b){const A=4*r,P=8*r;return this.float32[A+0]=l,this.float32[A+1]=h,this.float32[A+2]=p,this.int16[P+6]=x,this.int16[P+7]=b,r}}ar.prototype.bytesPerElement=16,sr(ar,"StructArrayLayout2f1f2i16");class Wr extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const b=12*r,A=3*r;return this.uint8[b+0]=l,this.uint8[b+1]=h,this.float32[A+1]=p,this.float32[A+2]=x,r}}Wr.prototype.bytesPerElement=12,sr(Wr,"StructArrayLayout2ub2f12");class hi extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,h)}emplace(r,l,h,p){const x=3*r;return this.float32[x+0]=l,this.float32[x+1]=h,this.float32[x+2]=p,r}}hi.prototype.bytesPerElement=12,sr(hi,"StructArrayLayout3f12");class _r extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,h)}emplace(r,l,h,p){const x=3*r;return this.uint16[x+0]=l,this.uint16[x+1]=h,this.uint16[x+2]=p,r}}_r.prototype.bytesPerElement=6,sr(_r,"StructArrayLayout3ui6");class Ti extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b,A,P,k,q,K,te,ue,pe,Se,Ge,at,xt,lt,yt,It){const Tt=this.length;return this.resize(Tt+1),this.emplace(Tt,r,l,h,p,x,b,A,P,k,q,K,te,ue,pe,Se,Ge,at,xt,lt,yt,It)}emplace(r,l,h,p,x,b,A,P,k,q,K,te,ue,pe,Se,Ge,at,xt,lt,yt,It,Tt){const ln=30*r,en=15*r,wn=60*r;return this.int16[ln+0]=l,this.int16[ln+1]=h,this.int16[ln+2]=p,this.float32[en+2]=x,this.float32[en+3]=b,this.uint16[ln+8]=A,this.uint16[ln+9]=P,this.uint32[en+5]=k,this.uint32[en+6]=q,this.uint32[en+7]=K,this.uint16[ln+16]=te,this.uint16[ln+17]=ue,this.uint16[ln+18]=pe,this.float32[en+10]=Se,this.float32[en+11]=Ge,this.uint8[wn+48]=at,this.uint8[wn+49]=xt,this.uint8[wn+50]=lt,this.uint32[en+13]=yt,this.int16[ln+28]=It,this.uint8[wn+58]=Tt,r}}Ti.prototype.bytesPerElement=60,sr(Ti,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ii extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b,A,P,k,q,K,te,ue,pe,Se,Ge,at,xt,lt,yt,It,Tt,ln,en,wn,jn,dn,Pn,kn,On){const Wn=this.length;return this.resize(Wn+1),this.emplace(Wn,r,l,h,p,x,b,A,P,k,q,K,te,ue,pe,Se,Ge,at,xt,lt,yt,It,Tt,ln,en,wn,jn,dn,Pn,kn,On)}emplace(r,l,h,p,x,b,A,P,k,q,K,te,ue,pe,Se,Ge,at,xt,lt,yt,It,Tt,ln,en,wn,jn,dn,Pn,kn,On,Wn){const xn=38*r,dr=19*r;return this.int16[xn+0]=l,this.int16[xn+1]=h,this.int16[xn+2]=p,this.float32[dr+2]=x,this.float32[dr+3]=b,this.int16[xn+8]=A,this.int16[xn+9]=P,this.int16[xn+10]=k,this.int16[xn+11]=q,this.int16[xn+12]=K,this.int16[xn+13]=te,this.uint16[xn+14]=ue,this.uint16[xn+15]=pe,this.uint16[xn+16]=Se,this.uint16[xn+17]=Ge,this.uint16[xn+18]=at,this.uint16[xn+19]=xt,this.uint16[xn+20]=lt,this.uint16[xn+21]=yt,this.uint16[xn+22]=It,this.uint16[xn+23]=Tt,this.uint16[xn+24]=ln,this.uint16[xn+25]=en,this.uint16[xn+26]=wn,this.uint16[xn+27]=jn,this.uint16[xn+28]=dn,this.uint32[dr+15]=Pn,this.float32[dr+16]=kn,this.float32[dr+17]=On,this.float32[dr+18]=Wn,r}}Ii.prototype.bytesPerElement=76,sr(Ii,"StructArrayLayout3i2f6i15ui1ul3f76");class yo extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.float32[1*r+0]=l,r}}yo.prototype.bytesPerElement=4,sr(yo,"StructArrayLayout1f4");class co extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x){const b=this.length;return this.resize(b+1),this.emplace(b,r,l,h,p,x)}emplace(r,l,h,p,x,b){const A=5*r;return this.float32[A+0]=l,this.float32[A+1]=h,this.float32[A+2]=p,this.float32[A+3]=x,this.float32[A+4]=b,r}}co.prototype.bytesPerElement=20,sr(co,"StructArrayLayout5f20");class Js extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const b=6*r;return this.uint32[3*r+0]=l,this.uint16[b+2]=h,this.uint16[b+3]=p,this.uint16[b+4]=x,r}}Js.prototype.bytesPerElement=12,sr(Js,"StructArrayLayout1ul3ui12");class ps extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const p=2*r;return this.uint16[p+0]=l,this.uint16[p+1]=h,r}}ps.prototype.bytesPerElement=4,sr(ps,"StructArrayLayout2ui4");class il extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint16[1*r+0]=l,r}}il.prototype.bytesPerElement=2,sr(il,"StructArrayLayout1ui2");class Wa extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const p=2*r;return this.float32[p+0]=l,this.float32[p+1]=h,r}}Wa.prototype.bytesPerElement=8,sr(Wa,"StructArrayLayout2f8");class Si extends vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Si.prototype.size=40;class Ki extends kr{get(r){return new Si(this,r)}}sr(Ki,"CollisionBoxArray");class to extends vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}to.prototype.size=60;class Qs extends Ti{get(r){return new to(this,r)}}sr(Qs,"PlacedSymbolArray");class ua extends vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ua.prototype.size=76;class Wo extends Ii{get(r){return new ua(this,r)}}sr(Wo,"SymbolInstanceArray");class vs extends yo{getoffsetX(r){return this.float32[1*r+0]}}sr(vs,"GlyphOffsetArray");class Fo extends gn{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}sr(Fo,"SymbolLineVertexArray");class xs extends vt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}xs.prototype.size=12;class Cs extends Js{get(r){return new xs(this,r)}}sr(Cs,"FeatureIndexArray");class Kl extends ps{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}sr(Kl,"FillExtrusionCentroidArray");const ol=kt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),hc=kt([{name:"a_dash",components:4,type:"Uint16"}]);var ad={exports:{}},ea={exports:{}};ea.exports=function(s,r){var l,h,p,x,b,A,P,k;for(h=s.length-(l=3&s.length),p=r,b=3432918353,A=461845907,k=0;k<h;)P=255&s.charCodeAt(k)|(255&s.charCodeAt(++k))<<8|(255&s.charCodeAt(++k))<<16|(255&s.charCodeAt(++k))<<24,++k,p=27492+(65535&(x=5*(65535&(p=(p^=P=(65535&(P=(P=(65535&P)*b+(((P>>>16)*b&65535)<<16)&4294967295)<<15|P>>>17))*A+(((P>>>16)*A&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(P=0,l){case 3:P^=(255&s.charCodeAt(k+2))<<16;case 2:P^=(255&s.charCodeAt(k+1))<<8;case 1:p^=P=(65535&(P=(P=(65535&(P^=255&s.charCodeAt(k)))*b+(((P>>>16)*b&65535)<<16)&4294967295)<<15|P>>>17))*A+(((P>>>16)*A&65535)<<16)&4294967295}return p^=s.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var wh=ea.exports,ld={exports:{}};ld.exports=function(s,r){for(var l,h=s.length,p=r^h,x=0;h>=4;)l=1540483477*(65535&(l=255&s.charCodeAt(x)|(255&s.charCodeAt(++x))<<8|(255&s.charCodeAt(++x))<<16|(255&s.charCodeAt(++x))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++x;switch(h){case 3:p^=(255&s.charCodeAt(x+2))<<16;case 2:p^=(255&s.charCodeAt(x+1))<<8;case 1:p=1540483477*(65535&(p^=255&s.charCodeAt(x)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var Pu=wh,ku=ld.exports;ad.exports=Pu,ad.exports.murmur3=Pu,ad.exports.murmur2=ku;var dc=he(ad.exports);class mu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,l,h,p){this.ids.push(cd(r)),this.positions.push(l,h,p)}getPositions(r){const l=cd(r);let h=0,p=this.ids.length-1;for(;h<p;){const b=h+p>>1;this.ids[b]>=l?p=b:h=b+1}const x=[];for(;this.ids[h]===l;)x.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return x}static serialize(r,l){const h=new Float64Array(r.ids),p=new Uint32Array(r.positions);return Mu(h,p,0,h.length-1),l&&l.push(h.buffer,p.buffer),{ids:h,positions:p}}static deserialize(r){const l=new mu;return l.ids=r.ids,l.positions=r.positions,l.indexed=!0,l}}function cd(s){const r=+s;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:dc(String(s))}function Mu(s,r,l,h){for(;l<h;){const p=s[l+h>>1];let x=l-1,b=h+1;for(;;){do x++;while(s[x]<p);do b--;while(s[b]>p);if(x>=b)break;ud(s,x,b),ud(r,3*x,3*b),ud(r,3*x+1,3*b+1),ud(r,3*x+2,3*b+2)}b-l<h-b?(Mu(s,r,l,b),l=b+1):(Mu(s,r,b+1,h),h=b)}}function ud(s,r,l){const h=s[r];s[r]=s[l],s[l]=h}sr(mu,"FeaturePositionMap");class Ru{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,l),this.initialized=!0),!!this.location}}class Cd extends Ru{constructor(r){super(r),this.current=0}set(r,l,h){this.fetchUniformLocation(r,l)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class Ld extends Ru{constructor(r){super(r),this.current=[0,0,0,0]}set(r,l,h){this.fetchUniformLocation(r,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class Of extends Ru{constructor(r){super(r),this.current=No.transparent}set(r,l,h){this.fetchUniformLocation(r,l)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const Gh=new Float32Array(16),Mh=new Float32Array(9),Pd=new Float32Array(4);function fc(s){return[bt(255*s.r,255*s.g),bt(255*s.b,255*s.a)]}class Fc{constructor(r,l,h){this.value=r,this.uniformNames=l.map((p=>`u_${p}`)),this.type=h}setUniform(r,l,h,p,x){l.set(r,x,p.constantOr(this.value))}getBinding(r,l){return this.type==="color"?new Of(r):new Cd(r)}}class Zl{constructor(r,l){this.uniformNames=l.map((h=>`u_${h}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,l,h,p,x){const b=x==="u_pattern"||x==="u_dash"?this.pattern:x==="u_pixel_ratio"?this.pixelRatio:null;b&&l.set(r,x,b)}getBinding(r,l){return l==="u_pattern"||l==="u_dash"?new Ld(r):new Cd(r)}}class pc{constructor(r,l,h,p){this.expression=r,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map((x=>({name:`a_${x}`,type:"Float32",components:h==="color"?2:1,offset:0}))),this.paintVertexArray=new p}populatePaintArray(r,l,h,p,x,b){const A=this.paintVertexArray.length,P=this.expression.evaluate(new G(0),l,{},x,p,b);this.paintVertexArray.resize(r),this._setPaintValue(A,r,P)}updatePaintArray(r,l,h,p,x){const b=this.expression.evaluate({zoom:0},h,p,void 0,x);this._setPaintValue(r,l,b)}_setPaintValue(r,l,h){if(this.type==="color"){const p=fc(h);for(let x=r;x<l;x++)this.paintVertexArray.emplace(x,p[0],p[1])}else{for(let p=r;p<l;p++)this.paintVertexArray.emplace(p,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Oc{constructor(r,l,h,p,x,b){this.expression=r,this.uniformNames=l.map((A=>`u_${A}_t`)),this.type=h,this.useIntegerZoom=p,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=l.map((A=>({name:`a_${A}`,type:"Float32",components:h==="color"?4:2,offset:0}))),this.paintVertexArray=new b}populatePaintArray(r,l,h,p,x,b){const A=this.expression.evaluate(new G(this.zoom),l,{},x,p,b),P=this.expression.evaluate(new G(this.zoom+1),l,{},x,p,b),k=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(k,r,A,P)}updatePaintArray(r,l,h,p,x){const b=this.expression.evaluate({zoom:this.zoom},h,p,void 0,x),A=this.expression.evaluate({zoom:this.zoom+1},h,p,void 0,x);this._setPaintValue(r,l,b,A)}_setPaintValue(r,l,h,p){if(this.type==="color"){const x=fc(h),b=fc(p);for(let A=r;A<l;A++)this.paintVertexArray.emplace(A,x[0],x[1],b[0],b[1])}else{for(let x=r;x<l;x++)this.paintVertexArray.emplace(x,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,l,h,p,x){const b=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,A=De(this.expression.interpolationFactor(b,this.zoom,this.zoom+1),0,1);l.set(r,x,A)}getBinding(r,l){return new Cd(r)}}class mc{constructor(r,l,h,p,x){this.expression=r,this.layerId=x,this.paintVertexAttributes=(h==="array"?hc:ol).members;for(let b=0;b<l.length;++b);this.paintVertexArray=new p}populatePaintArray(r,l,h){const p=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(p,r,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(r,l,h,p,x,b){this._setPaintValues(r,l,h.patterns&&h.patterns[this.layerId],b)}_setPaintValues(r,l,h,p){if(!p||!h)return;const x=p[h];if(!x)return;const{tl:b,br:A,pixelRatio:P}=x;for(let k=r;k<l;k++)this.paintVertexArray.emplace(k,b[0],b[1],A[0],A[1],P)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class th{constructor(r,l,h=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const x in r.paint._values){if(!h(x))continue;const b=r.paint.get(x);if(!(b instanceof je&&Ra(b.property.specification)))continue;const A=rg(x,r.type),P=b.value,k=b.property.specification.type,q=!!b.property.useIntegerZoom,K=x==="line-dasharray"||x.endsWith("pattern"),te=x==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant";if(P.kind!=="constant"||te)if(P.kind==="source"||te||K){const ue=Pe(x,k,"source");this.binders[x]=K?new mc(P,A,k,ue,r.id):new pc(P,A,k,ue),p.push(`/a_${x}`)}else{const ue=Pe(x,k,"composite");this.binders[x]=new Oc(P,A,k,q,l,ue),p.push(`/z_${x}`)}else this.binders[x]=K?new Zl(P.value,A):new Fc(P.value,A,k),p.push(`/u_${x}`)}this.cacheKey=p.sort().join("")}getMaxValue(r){const l=this.binders[r];return l instanceof pc||l instanceof Oc?l.maxValue:0}populatePaintArrays(r,l,h,p,x,b){for(const A in this.binders){const P=this.binders[A];(P instanceof pc||P instanceof Oc||P instanceof mc)&&P.populatePaintArray(r,l,h,p,x,b)}}setConstantPatternPositions(r){for(const l in this.binders){const h=this.binders[l];h instanceof Zl&&h.setConstantPatternPositions(r)}}updatePaintArrays(r,l,h,p,x,b){let A=!1;for(const P in r){const k=l.getPositions(P);for(const q of k){const K=h.feature(q.index);for(const te in this.binders){const ue=this.binders[te];if((ue instanceof pc||ue instanceof Oc||ue instanceof mc)&&ue.expression.isStateDependent===!0){const pe=p.paint.get(te);ue.expression=pe.value,ue.updatePaintArray(q.start,q.end,K,r[P],x,b),A=!0}}}}return A}defines(){const r=[];for(const l in this.binders){const h=this.binders[l];(h instanceof Fc||h instanceof Zl)&&r.push(...h.uniformNames.map((p=>`#define HAS_UNIFORM_${p}`)))}return r}getBinderAttributes(){const r=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof pc||h instanceof Oc||h instanceof mc)for(let p=0;p<h.paintVertexAttributes.length;p++)r.push(h.paintVertexAttributes[p].name)}return r}getBinderUniforms(){const r=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Fc||h instanceof Zl||h instanceof Oc)for(const p of h.uniformNames)r.push(p)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const l=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof Fc||p instanceof Zl||p instanceof Oc)for(const x of p.uniformNames)l.push({name:x,property:h,binding:p.getBinding(r,x)})}return l}setUniforms(r,l,h,p,x){for(const{name:b,property:A,binding:P}of h)this.binders[A].setUniform(r,P,x,p.get(A),b)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const l=this.binders[r];(l instanceof pc||l instanceof Oc||l instanceof mc)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(r){for(const l in this.binders){const h=this.binders[l];(h instanceof pc||h instanceof Oc||h instanceof mc)&&h.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const l=this.binders[r];(l instanceof pc||l instanceof Oc||l instanceof mc)&&l.destroy()}}}class Nu{constructor(r,l,h=(()=>!0)){this.programConfigurations={};for(const p of r)this.programConfigurations[p.id]=new th(p,l,h);this.needsUpload=!1,this._featureMap=new mu,this._bufferOffset=0}populatePaintArrays(r,l,h,p,x,b,A){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(r,l,p,x,b,A);l.id!==void 0&&this._featureMap.add(l.id,h,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,l,h,p,x){for(const b of h)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(r,this._featureMap,l,b,p,x)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const ef={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function rg(s,r){return ef[s]||[s.replace(`${r}-`,"").replace(/-/g,"_")]}const U={"line-pattern":{source:jt,composite:jt},"fill-pattern":{source:jt,composite:jt},"fill-extrusion-pattern":{source:jt,composite:jt},"line-dasharray":{source:sn,composite:sn}},ge={color:{source:Wa,composite:In},number:{source:yo,composite:Wa}};function Pe(s,r,l){const h=U[s];return h&&h[l]||ge[r][l]}sr(Fc,"ConstantBinder"),sr(Zl,"PatternConstantBinder"),sr(pc,"SourceExpressionBinder"),sr(mc,"PatternCompositeBinder"),sr(Oc,"CompositeExpressionBinder"),sr(th,"ProgramConfiguration",{omit:["_buffers"]}),sr(Nu,"ProgramConfigurationSet");const Xe="-transition";class nt extends Ro{constructor(r,l){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&r.type!=="sky"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),l.layout&&(this._unevaluatedLayout=new He(l.layout)),l.paint)){this._transitionablePaint=new me(l.paint);for(const h in r.paint)this.setPaintProperty(h,r.paint[h],{validate:!1});for(const h in r.layout)this.setLayoutProperty(h,r.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new We(l.paint)}}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,l,h={}){l!=null&&this._validate(Xl,`layers.${this.id}.layout.${r}`,r,l,h)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,l):this.visibility=l)}getPaintProperty(r){return tn(r,Xe)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,l,h={}){if(l!=null&&this._validate(Is,`layers.${this.id}.paint.${r}`,r,l,h))return!1;if(tn(r,Xe))return this._transitionablePaint.setTransition(r.slice(0,-11),l||void 0),!1;{const p=this._transitionablePaint._values[r],x=p.value.isDataDriven(),b=p.value;this._transitionablePaint.setValue(r,l),this._handleSpecialPaintPropertyUpdate(r);const A=this._transitionablePaint._values[r].value,P=A.isDataDriven(),k=tn(r,"pattern")||r==="line-dasharray";return P||x||k||this._handleOverridablePaintPropertyUpdate(r,b,A)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,l,h){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,l)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),An(r,((l,h)=>!(l===void 0||h==="layout"&&!Object.keys(l).length||h==="paint"&&!Object.keys(l).length)))}_validate(r,l,h,p,x={}){return(!x||x.validate!==!1)&&Pl(this,r.call(va,{key:l,layerType:this.type,objectKey:h,value:p,styleSpec:pn,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const l=this.paint.get(r);if(l instanceof je&&Ra(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=tu(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const tt=kt([{name:"a_pos",components:2,type:"Int16"}],4),ot=kt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Lt{constructor(r=[]){this.segments=r}prepareSegment(r,l,h,p){let x=this.segments[this.segments.length-1];return r>Lt.MAX_VERTEX_ARRAY_LENGTH&&ur(`Max vertices per segment is ${Lt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!x||x.vertexLength+r>Lt.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==p)&&(x={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},p!==void 0&&(x.sortKey=p),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const r of this.segments)for(const l in r.vaos)r.vaos[l].destroy()}static simpleSegment(r,l,h,p){return new Lt([{vertexOffset:r,primitiveOffset:l,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])}}Lt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,sr(Lt,"SegmentVector");var _t=8192;class gt{constructor(r,l){r&&(l?this.setSouthWest(r).setNorthEast(l):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof ai?new ai(r.lng,r.lat):ai.convert(r),this}setSouthWest(r){return this._sw=r instanceof ai?new ai(r.lng,r.lat):ai.convert(r),this}extend(r){const l=this._sw,h=this._ne;let p,x;if(r instanceof ai)p=r,x=r;else{if(!(r instanceof gt))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(gt.convert(r)):this.extend(ai.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(ai.convert(r)):this;if(p=r._sw,x=r._ne,!p||!x)return this}return l||h?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),h.lng=Math.max(x.lng,h.lng),h.lat=Math.max(x.lat,h.lat)):(this._sw=new ai(p.lng,p.lat),this._ne=new ai(x.lng,x.lat)),this}getCenter(){return new ai((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ai(this.getWest(),this.getNorth())}getSouthEast(){return new ai(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:h}=ai.convert(r);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(r){return!r||r instanceof gt?r:new gt(r)}}var Ht=1e-6,Yt=typeof Float32Array<"u"?Float32Array:Array;function bn(){var s=new Yt(9);return Yt!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function rn(s,r,l){var h=r[0],p=r[1],x=r[2],b=r[3],A=r[4],P=r[5],k=r[6],q=r[7],K=r[8],te=l[0],ue=l[1],pe=l[2],Se=l[3],Ge=l[4],at=l[5],xt=l[6],lt=l[7],yt=l[8];return s[0]=te*h+ue*b+pe*k,s[1]=te*p+ue*A+pe*q,s[2]=te*x+ue*P+pe*K,s[3]=Se*h+Ge*b+at*k,s[4]=Se*p+Ge*A+at*q,s[5]=Se*x+Ge*P+at*K,s[6]=xt*h+lt*b+yt*k,s[7]=xt*p+lt*A+yt*q,s[8]=xt*x+lt*P+yt*K,s}function Zt(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function En(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],b=r[4],A=r[5],P=r[6],k=r[7],q=r[8],K=r[9],te=r[10],ue=r[11],pe=r[12],Se=r[13],Ge=r[14],at=r[15],xt=l*A-h*b,lt=l*P-p*b,yt=l*k-x*b,It=h*P-p*A,Tt=h*k-x*A,ln=p*k-x*P,en=q*Se-K*pe,wn=q*Ge-te*pe,jn=q*at-ue*pe,dn=K*Ge-te*Se,Pn=K*at-ue*Se,kn=te*at-ue*Ge,On=xt*kn-lt*Pn+yt*dn+It*jn-Tt*wn+ln*en;return On?(s[0]=(A*kn-P*Pn+k*dn)*(On=1/On),s[1]=(p*Pn-h*kn-x*dn)*On,s[2]=(Se*ln-Ge*Tt+at*It)*On,s[3]=(te*Tt-K*ln-ue*It)*On,s[4]=(P*jn-b*kn-k*wn)*On,s[5]=(l*kn-p*jn+x*wn)*On,s[6]=(Ge*yt-pe*ln-at*lt)*On,s[7]=(q*ln-te*yt+ue*lt)*On,s[8]=(b*Pn-A*jn+k*en)*On,s[9]=(h*jn-l*Pn-x*en)*On,s[10]=(pe*Tt-Se*yt+at*xt)*On,s[11]=(K*yt-q*Tt-ue*xt)*On,s[12]=(A*wn-b*dn-P*en)*On,s[13]=(l*dn-h*wn+p*en)*On,s[14]=(Se*lt-pe*It-Ge*xt)*On,s[15]=(q*It-K*lt+te*xt)*On,s):null}function Br(s,r,l){var h=r[0],p=r[1],x=r[2],b=r[3],A=r[4],P=r[5],k=r[6],q=r[7],K=r[8],te=r[9],ue=r[10],pe=r[11],Se=r[12],Ge=r[13],at=r[14],xt=r[15],lt=l[0],yt=l[1],It=l[2],Tt=l[3];return s[0]=lt*h+yt*A+It*K+Tt*Se,s[1]=lt*p+yt*P+It*te+Tt*Ge,s[2]=lt*x+yt*k+It*ue+Tt*at,s[3]=lt*b+yt*q+It*pe+Tt*xt,s[4]=(lt=l[4])*h+(yt=l[5])*A+(It=l[6])*K+(Tt=l[7])*Se,s[5]=lt*p+yt*P+It*te+Tt*Ge,s[6]=lt*x+yt*k+It*ue+Tt*at,s[7]=lt*b+yt*q+It*pe+Tt*xt,s[8]=(lt=l[8])*h+(yt=l[9])*A+(It=l[10])*K+(Tt=l[11])*Se,s[9]=lt*p+yt*P+It*te+Tt*Ge,s[10]=lt*x+yt*k+It*ue+Tt*at,s[11]=lt*b+yt*q+It*pe+Tt*xt,s[12]=(lt=l[12])*h+(yt=l[13])*A+(It=l[14])*K+(Tt=l[15])*Se,s[13]=lt*p+yt*P+It*te+Tt*Ge,s[14]=lt*x+yt*k+It*ue+Tt*at,s[15]=lt*b+yt*q+It*pe+Tt*xt,s}function zr(s,r,l){var h,p,x,b,A,P,k,q,K,te,ue,pe,Se=l[0],Ge=l[1],at=l[2];return r===s?(s[12]=r[0]*Se+r[4]*Ge+r[8]*at+r[12],s[13]=r[1]*Se+r[5]*Ge+r[9]*at+r[13],s[14]=r[2]*Se+r[6]*Ge+r[10]*at+r[14],s[15]=r[3]*Se+r[7]*Ge+r[11]*at+r[15]):(p=r[1],x=r[2],b=r[3],A=r[4],P=r[5],k=r[6],q=r[7],K=r[8],te=r[9],ue=r[10],pe=r[11],s[0]=h=r[0],s[1]=p,s[2]=x,s[3]=b,s[4]=A,s[5]=P,s[6]=k,s[7]=q,s[8]=K,s[9]=te,s[10]=ue,s[11]=pe,s[12]=h*Se+A*Ge+K*at+r[12],s[13]=p*Se+P*Ge+te*at+r[13],s[14]=x*Se+k*Ge+ue*at+r[14],s[15]=b*Se+q*Ge+pe*at+r[15]),s}function Gn(s,r,l){var h=l[0],p=l[1],x=l[2];return s[0]=r[0]*h,s[1]=r[1]*h,s[2]=r[2]*h,s[3]=r[3]*h,s[4]=r[4]*p,s[5]=r[5]*p,s[6]=r[6]*p,s[7]=r[7]*p,s[8]=r[8]*x,s[9]=r[9]*x,s[10]=r[10]*x,s[11]=r[11]*x,s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s}function vr(s,r,l){var h=Math.sin(l),p=Math.cos(l),x=r[4],b=r[5],A=r[6],P=r[7],k=r[8],q=r[9],K=r[10],te=r[11];return r!==s&&(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[4]=x*p+k*h,s[5]=b*p+q*h,s[6]=A*p+K*h,s[7]=P*p+te*h,s[8]=k*p-x*h,s[9]=q*p-b*h,s[10]=K*p-A*h,s[11]=te*p-P*h,s}function Ei(s,r,l){var h=Math.sin(l),p=Math.cos(l),x=r[0],b=r[1],A=r[2],P=r[3],k=r[8],q=r[9],K=r[10],te=r[11];return r!==s&&(s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=x*p-k*h,s[1]=b*p-q*h,s[2]=A*p-K*h,s[3]=P*p-te*h,s[8]=x*h+k*p,s[9]=b*h+q*p,s[10]=A*h+K*p,s[11]=P*h+te*p,s}function ni(s,r){return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Hr(s,r,l){var h,p,x,b=l[0],A=l[1],P=l[2],k=Math.hypot(b,A,P);return k<Ht?null:(b*=k=1/k,A*=k,P*=k,h=Math.sin(r),p=Math.cos(r),s[0]=b*b*(x=1-p)+p,s[1]=A*b*x+P*h,s[2]=P*b*x-A*h,s[3]=0,s[4]=b*A*x-P*h,s[5]=A*A*x+p,s[6]=P*A*x+b*h,s[7]=0,s[8]=b*P*x+A*h,s[9]=A*P*x-b*h,s[10]=P*P*x+p,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,r=arguments.length;r--;)s+=arguments[r]*arguments[r];return Math.sqrt(s)});var qi=Br;function Mr(){var s=new Yt(3);return Yt!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Gr(s){var r=new Yt(3);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r}function Ri(s){return Math.hypot(s[0],s[1],s[2])}function jr(s,r,l){var h=new Yt(3);return h[0]=s,h[1]=r,h[2]=l,h}function Vr(s,r,l){return s[0]=r[0]+l[0],s[1]=r[1]+l[1],s[2]=r[2]+l[2],s}function Ci(s,r,l){return s[0]=r[0]-l[0],s[1]=r[1]-l[1],s[2]=r[2]-l[2],s}function zn(s,r,l){return s[0]=r[0]*l[0],s[1]=r[1]*l[1],s[2]=r[2]*l[2],s}function an(s,r,l){return s[0]=Math.min(r[0],l[0]),s[1]=Math.min(r[1],l[1]),s[2]=Math.min(r[2],l[2]),s}function hn(s,r,l){return s[0]=Math.max(r[0],l[0]),s[1]=Math.max(r[1],l[1]),s[2]=Math.max(r[2],l[2]),s}function Rn(s,r,l){return s[0]=r[0]*l,s[1]=r[1]*l,s[2]=r[2]*l,s}function gr(s,r,l,h){return s[0]=r[0]+l[0]*h,s[1]=r[1]+l[1]*h,s[2]=r[2]+l[2]*h,s}function Xr(s,r){var l=r[0],h=r[1],p=r[2],x=l*l+h*h+p*p;return x>0&&(x=1/Math.sqrt(x)),s[0]=r[0]*x,s[1]=r[1]*x,s[2]=r[2]*x,s}function Ni(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]}function sl(s,r,l){var h=r[0],p=r[1],x=r[2],b=l[0],A=l[1],P=l[2];return s[0]=p*P-x*A,s[1]=x*b-h*P,s[2]=h*A-p*b,s}function ti(s,r,l){var h=r[0],p=r[1],x=r[2],b=l[3]*h+l[7]*p+l[11]*x+l[15];return s[0]=(l[0]*h+l[4]*p+l[8]*x+l[12])/(b=b||1),s[1]=(l[1]*h+l[5]*p+l[9]*x+l[13])/b,s[2]=(l[2]*h+l[6]*p+l[10]*x+l[14])/b,s}function cs(s,r,l){var h=l[0],p=l[1],x=l[2],b=r[0],A=r[1],P=r[2],k=p*P-x*A,q=x*b-h*P,K=h*A-p*b,te=p*K-x*q,ue=x*k-h*K,pe=h*q-p*k,Se=2*l[3];return q*=Se,K*=Se,ue*=2,pe*=2,s[0]=b+(k*=Se)+(te*=2),s[1]=A+q+ue,s[2]=P+K+pe,s}var uo,bs=Ci,Oa=zn,gc=Ri;function Do(s,r,l){return s[0]=r[0]*l,s[1]=r[1]*l,s[2]=r[2]*l,s[3]=r[3]*l,s}function Zn(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],b=l*l+h*h+p*p+x*x;return b>0&&(b=1/Math.sqrt(b)),s[0]=l*b,s[1]=h*b,s[2]=p*b,s[3]=x*b,s}function _l(s,r,l){var h=r[0],p=r[1],x=r[2],b=r[3];return s[0]=l[0]*h+l[4]*p+l[8]*x+l[12]*b,s[1]=l[1]*h+l[5]*p+l[9]*x+l[13]*b,s[2]=l[2]*h+l[6]*p+l[10]*x+l[14]*b,s[3]=l[3]*h+l[7]*p+l[11]*x+l[15]*b,s}function Sh(){var s=new Yt(4);return Yt!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function Rh(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function yc(s,r,l){l*=.5;var h=r[0],p=r[1],x=r[2],b=r[3],A=Math.sin(l),P=Math.cos(l);return s[0]=h*P+b*A,s[1]=p*P+x*A,s[2]=x*P-p*A,s[3]=b*P-h*A,s}function hd(s,r,l){l*=.5;var h=r[0],p=r[1],x=r[2],b=r[3],A=Math.sin(l),P=Math.cos(l);return s[0]=h*P-x*A,s[1]=p*P+b*A,s[2]=x*P+h*A,s[3]=b*P-p*A,s}Mr(),uo=new Yt(4),Yt!=Float32Array&&(uo[0]=0,uo[1]=0,uo[2]=0,uo[3]=0);var gu=Zn;Mr(),jr(1,0,0),jr(0,1,0),Sh(),Sh(),bn();const kd=kt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:nh}=kd,Du=kt([{name:"a_pos_3",components:3,type:"Int16"}]);var dd=kt([{name:"a_pos",type:"Int16",components:2}]);class Md{constructor(r,l){this.pos=r,this.dir=l}intersectsPlane(r,l,h){const p=Ni(l,this.dir);if(Math.abs(p)<1e-6)return!1;const x=((r[0]-this.pos[0])*l[0]+(r[1]-this.pos[1])*l[1]+(r[2]-this.pos[2])*l[2])/p;return h[0]=this.pos[0]+this.dir[0]*x,h[1]=this.pos[1]+this.dir[1]*x,h[2]=this.pos[2]+this.dir[2]*x,!0}closestPointOnSphere(r,l,h){if((function(ue,pe){var Se=ue[0],Ge=ue[1],at=ue[2],xt=pe[0],lt=pe[1],yt=pe[2];return Math.abs(Se-xt)<=Ht*Math.max(1,Math.abs(Se),Math.abs(xt))&&Math.abs(Ge-lt)<=Ht*Math.max(1,Math.abs(Ge),Math.abs(lt))&&Math.abs(at-yt)<=Ht*Math.max(1,Math.abs(at),Math.abs(yt))})(this.pos,r)||l===0)return h[0]=h[1]=h[2]=0,!1;const[p,x,b]=this.dir,A=this.pos[0]-r[0],P=this.pos[1]-r[1],k=this.pos[2]-r[2],q=p*p+x*x+b*b,K=2*(A*p+P*x+k*b),te=K*K-4*q*(A*A+P*P+k*k-l*l);if(te<0){const ue=Math.max(-K/2,0),pe=A+p*ue,Se=P+x*ue,Ge=k+b*ue,at=Math.hypot(pe,Se,Ge);return h[0]=pe*l/at,h[1]=Se*l/at,h[2]=Ge*l/at,!1}{const ue=(-K-Math.sqrt(te))/(2*q);if(ue<0){const pe=Math.hypot(A,P,k);return h[0]=A*l/pe,h[1]=P*l/pe,h[2]=k*l/pe,!1}return h[0]=A+p*ue,h[1]=P+x*ue,h[2]=k+b*ue,!0}}}class rh{constructor(r,l,h,p,x){this.TL=r,this.TR=l,this.BR=h,this.BL=p,this.horizon=x}static fromInvProjectionMatrix(r,l,h){const p=[-1,1,1],x=[1,1,1],b=[1,-1,1],A=[-1,-1,1],P=ti(p,p,r),k=ti(x,x,r),q=ti(b,b,r),K=ti(A,A,r);return new rh(P,k,q,K,l/h)}}class mi{constructor(r,l){this.points=r,this.planes=l}static fromInvProjectionMatrix(r,l,h,p){const x=Math.pow(2,h),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((P=>{const k=_l([],P,r),q=1/k[3]/l*x;return(function(K,te,ue){return K[0]=te[0]*ue[0],K[1]=te[1]*ue[1],K[2]=te[2]*ue[2],K[3]=te[3]*ue[3],K})(k,k,[q,q,p?1/k[3]:q,q])})),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((P=>{const k=Xr([],sl([],bs([],b[P[0]],b[P[1]]),bs([],b[P[2]],b[P[1]]))),q=-Ni(k,b[P[1]]);return k.concat(q)}));return new mi(b,A)}}class io{static fromPoints(r){const l=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const p of r)an(l,l,p),hn(h,h,p);return new io(l,h)}static applyTransform(r,l){const h=r.getCorners();for(let p=0;p<h.length;++p)ti(h[p],h[p],l);return io.fromPoints(h)}constructor(r,l){this.min=r,this.max=l,this.center=Rn([],Vr([],this.min,this.max),.5)}quadrant(r){const l=[r%2==0,r<2],h=Gr(this.min),p=Gr(this.max);for(let x=0;x<l.length;x++)h[x]=l[x]?this.min[x]:this.center[x],p[x]=l[x]?this.center[x]:this.max[x];return p[2]=this.max[2],new io(h,p)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,l=this.max;return[[r[0],r[1],r[2]],[l[0],r[1],r[2]],[l[0],l[1],r[2]],[r[0],l[1],r[2]],[r[0],r[1],l[2]],[l[0],r[1],l[2]],[l[0],l[1],l[2]],[r[0],l[1],l[2]]]}intersects(r){const l=this.getCorners();let h=!0;for(let p=0;p<r.planes.length;p++){const x=r.planes[p];let b=0;for(let A=0;A<l.length;A++)b+=Ni(x,l[A])+x[3]>=0;if(b===0)return 0;b!==l.length&&(h=!1)}if(h)return 2;for(let p=0;p<3;p++){let x=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let A=0;A<r.points.length;A++){const P=r.points[A][p]-this.min[p];x=Math.min(x,P),b=Math.max(b,P)}if(b<0||x>this.max[p]-this.min[p])return 0}return 1}}const Ls=5,ha=6,Ns=_t/Math.PI/2,fd=16383,ru=64,Ds=[ru,32,16],Bc=-Ns,Er=Ns,pd=[new io([Bc,Bc,Bc],[Er,Er,Er]),new io([Bc,Bc,Bc],[0,0,Er]),new io([0,Bc,Bc],[Er,0,Er]),new io([Bc,0,Bc],[0,Er,Er]),new io([0,0,Bc],[Er,Er,Er])];function tf(s){return s*Ns/rf}function rm(s,r,l,h=!0){const p=Rn([],s._camera.position,s.worldSize),x=[r,l,1,1];_l(x,x,s.pixelMatrixInverse),Do(x,x,1/x[3]);const b=Xr([],bs([],x,p)),A=s.globeMatrix,P=[A[12],A[13],A[14]],k=bs([],P,p),q=Ri(k),K=Xr([],k),te=s.worldSize/(2*Math.PI),ue=Ni(K,b),pe=Math.asin(te/q);if(pe<Math.acos(ue)){if(!h)return null;const jn=[],dn=[];Rn(jn,b,q/ue),Xr(dn,bs(dn,jn,k)),Xr(b,Vr(b,k,Rn(b,dn,Math.tan(pe)*q)))}const Se=[];new Md(p,b).closestPointOnSphere(P,te,Se);const Ge=Xr([],Nn(A,0)),at=Xr([],Nn(A,1)),xt=Xr([],Nn(A,2)),lt=Ni(Ge,Se),yt=Ni(at,Se),It=Ni(xt,Se),Tt=Ee(Math.asin(-yt/te));let ln=Ee(Math.atan2(lt,It));ln=s.center.lng+(function(jn,dn){const Pn=(dn-jn+180)%360-180;return Pn<-180?Pn+360:Pn})(s.center.lng,ln);const en=ta(ln),wn=De(Ca(Tt),0,1);return new of(en,wn)}class Bf{constructor(r,l,h){this.a=bs([],r,h),this.b=bs([],l,h),this.center=h;const p=Xr([],this.a),x=Xr([],this.b);this.angle=Math.acos(Ni(p,x))}}function Rd(s,r){if(s.angle===0)return null;let l;return l=s.a[r]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[r]/s.a[r]/Math.sin(s.angle)-1/Math.tan(s.angle)),l<0||l>1?null:(function(h,p,x,b){const A=Math.sin(x);return h*(Math.sin((1-b)*x)/A)+p*(Math.sin(b*x)/A)})(s.a[r],s.b[r],s.angle,De(l,0,1))+s.center[r]}function yu(s){if(s.z<=1)return pd[s.z+2*s.y+s.x];const r=zf(nf(s));return io.fromPoints(r)}function Wh(s,r,l){return Rn(s,s,1-l),gr(s,s,r,l)}function im(s,r){const l=xp(r.zoom);if(l===0)return yu(s);const h=nf(s),p=zf(h),x=ta(h.getWest())*r.worldSize,b=ta(h.getEast())*r.worldSize,A=Ca(h.getNorth())*r.worldSize,P=Ca(h.getSouth())*r.worldSize,k=[x,A,0],q=[b,A,0],K=[x,P,0],te=[b,P,0],ue=En([],r.globeMatrix);return ti(k,k,ue),ti(q,q,ue),ti(K,K,ue),ti(te,te,ue),p[0]=Wh(p[0],K,l),p[1]=Wh(p[1],te,l),p[2]=Wh(p[2],q,l),p[3]=Wh(p[3],k,l),io.fromPoints(p)}function om(s,r,l){for(const h of s)ti(h,h,r),Rn(h,h,l)}function vp(s,r,l){const h=r/s.worldSize,p=s.globeMatrix;if(l.z<=1){const en=yu(l).getCorners();return om(en,p,h),io.fromPoints(en)}const x=nf(l),b=zf(x);om(b,p,h);const A=Number.MAX_VALUE,P=[-A,-A,-A],k=[A,A,A];if(x.contains(s.center)){for(const jn of b)an(k,k,jn),hn(P,P,jn);P[2]=0;const en=s.point,wn=[en.x*h,en.y*h,0];return an(k,k,wn),hn(P,P,wn),new io(k,P)}const q=[p[12]*h,p[13]*h,p[14]*h],K=x.getCenter(),te=De(s.center.lat,-Ha,Ha),ue=De(K.lat,-Ha,Ha),pe=ta(s.center.lng),Se=Ca(te);let Ge=pe-ta(K.lng);const at=Se-Ca(ue);Ge>.5?Ge-=1:Ge<-.5&&(Ge+=1);let xt=0;Math.abs(Ge)>Math.abs(at)?xt=Ge>=0?1:3:(xt=at>=0?0:2,gr(q,q,[p[4]*h,p[5]*h,p[6]*h],-Math.sin(Z(at>=0?x.getSouth():x.getNorth()))*Ns));const lt=b[xt],yt=b[(xt+1)%4],It=new Bf(lt,yt,q),Tt=[Rd(It,0)||lt[0],Rd(It,1)||lt[1],Rd(It,2)||lt[2]],ln=xp(s.zoom);if(ln>0){const en=(function({x:jn,y:dn,z:Pn},kn,On,Wn,xn){const dr=1/(1<<Pn);let Nr=jn*dr,mr=Nr+dr,$i=dn*dr,Xn=$i+dr,ri=0;const Gi=(Nr+mr)/2-Wn;return Gi>.5?ri=-1:Gi<-.5&&(ri=1),Nr=((Nr+ri)*kn-(Wn*=kn))*On+Wn,mr=((mr+ri)*kn-Wn)*On+Wn,$i=($i*kn-(xn*=kn))*On+xn,Xn=(Xn*kn-xn)*On+xn,[[Nr,Xn,0],[mr,Xn,0],[mr,$i,0],[Nr,$i,0]]})(l,r,s._pixelsPerMercatorPixel,pe,Se);for(let jn=0;jn<b.length;jn++)Wh(b[jn],en[jn],ln);const wn=Vr([],en[xt],en[(xt+1)%4]);Rn(wn,wn,.5),Wh(Tt,wn,ln)}for(const en of b)an(k,k,en),hn(P,P,en);return k[2]=Math.min(lt[2],yt[2]),an(k,k,Tt),hn(P,P,Tt),new io(k,P)}function nf({x:s,y:r,z:l}){const h=1/(1<<l),p=new ai(zc(s*h),Ho((r+1)*h)),x=new ai(zc((s+1)*h),Ho(r*h));return new gt(p,x)}function zf(s){const r=Z(s.getNorth()),l=Z(s.getSouth()),h=Math.cos(r),p=Math.cos(l),x=Math.sin(r),b=Math.sin(l),A=s.getWest(),P=s.getEast();return[vl(p,b,A),vl(p,b,P),vl(h,x,P),vl(h,x,A)]}function vl(s,r,l,h=Ns){return l=Z(l),[s*Math.sin(l)*h,-r*h,s*Math.cos(l)*h]}function _u(s,r,l){return vl(Math.cos(Z(s)),Math.sin(Z(s)),r,l)}function Nh(s,r,l,h){const p=1<<l.z,x=(s/_t+l.x)/p;return _u(Ho((r/_t+l.y)/p),zc(x),h)}function sm({min:s,max:r}){return fd/Math.max(r[0]-s[0],r[1]-s[1],r[2]-s[2])}const C0=new Float64Array(16);function Fu(s){const r=sm(s),l=ni(C0,[r,r,r]);return zr(l,l,((h=[])[0]=-(p=s.min)[0],h[1]=-p[1],h[2]=-p[2],h));var h,p}function ig(s){const r=(h=s.min,(l=C0)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=h[0],l[13]=h[1],l[14]=h[2],l[15]=1,l);var l,h;const p=1/sm(s);return Gn(r,r,[p,p,p])}function Hh(s,r,l,h,p){const x=(function(P){const k=_t/(2*Math.PI);return P/(2*Math.PI)/k})(l),b=[s,r,-l/(2*Math.PI)],A=Zt(new Float64Array(16));return zr(A,A,b),Gn(A,A,[x,x,x]),vr(A,A,Z(-p)),Ei(A,A,Z(-h)),A}function xp(s){return Qe(Ls,ha,s)}function L0(s,r){const l=_u(r.lat,r.lng),h=(function(pe){const Se=_u(pe._center.lat,pe._center.lng);let Ge=sl([],jr(0,1,0),Se);const at=Hr([],-pe.angle,Se);Ge=ti(Ge,Ge,at),Hr(at,-pe._pitch,Ge);const xt=Xr([],Se);return Rn(xt,xt,tf(pe.cameraToCenterDistance/pe.pixelsPerMeter)),ti(xt,xt,at),Vr([],Se,xt)})(s);return b=(p=Ci([],h,l))[0],A=p[1],P=p[2],k=(x=l)[0],q=x[1],K=x[2],ue=(te=Math.sqrt(b*b+A*A+P*P)*Math.sqrt(k*k+q*q+K*K))&&Ni(p,x)/te,Math.acos(Math.min(Math.max(ue,-1),1));var p,x,b,A,P,k,q,K,te,ue}function og(s,r){return L0(s,r)>Math.PI/2*1.01}const P0=Z(85),E_=Math.cos(P0),lx=Math.sin(P0),rf=63710088e-1,sg=2*Math.PI*rf;class _c{constructor(r,l){if(isNaN(r)||isNaN(l))throw new Error(`Invalid LngLat object: (${r}, ${l})`);if(this.lng=+r,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _c(xe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const l=Math.PI/180,h=this.lat*l,p=r.lat*l,x=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((r.lng-this.lng)*l);return rf*Math.acos(Math.min(x,1))}toBounds(r=0){const l=360*r/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new gt(new _c(this.lng-h,this.lat-l),new _c(this.lng+h,this.lat+l))}toEcef(r){const l=tf(r);return _u(this.lat,this.lng,Ns+l)}static convert(r){if(r instanceof _c)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new _c(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new _c(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var ai=_c;function Yl(s){return sg*Math.cos(s*Math.PI/180)}function ta(s){return(180+s)/360}function Ca(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function al(s,r){return s/Yl(r)}function zc(s){return 360*s-180}function Ho(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function bp(s,r){return s*Yl(Ho(r))}const Ha=85.051129;function am(s){return 1/Math.cos(s*Math.PI/180)}class of{constructor(r,l,h=0){this.x=+r,this.y=+l,this.z=+h}static fromLngLat(r,l=0){const h=ai.convert(r);return new of(ta(h.lng),Ca(h.lat),al(l,h.lat))}toLngLat(){return new ai(zc(this.x),Ho(this.y))}toAltitude(){return bp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/sg*am(Ho(this.y))}}function jf(s,r,l,h,p,x,b,A,P){const k=(r+h)/2,q=(l+p)/2,K=new $(k,q);A(K),(function(te,ue,pe,Se,Ge,at){const xt=pe-Ge,lt=Se-at;return Math.abs((Se-ue)*xt-(pe-te)*lt)/Math.hypot(xt,lt)})(K.x,K.y,x.x,x.y,b.x,b.y)>=P?(jf(s,r,l,k,q,x,K,A,P),jf(s,k,q,h,p,K,b,A,P)):s.push(b)}function Ou(s,r,l){let h=s[0],p=h.x,x=h.y;r(h);const b=[h];for(let A=1;A<s.length;A++){const P=s[A],{x:k,y:q}=P;r(P),jf(b,p,x,k,q,h,P,r,l),p=k,x=q,h=P}return b}function lm(s,r,l,h){if(h(r,l)){const p=r.add(l)._mult(.5);lm(s,r,p,h),lm(s,p,l,h)}else s.push(l)}function wp(s,r){let l=s[0];const h=[l];for(let p=1;p<s.length;p++){const x=s[p];lm(h,l,x,r),l=x}return h}const Xh=Math.pow(2,14)-1,cm=-Xh-1;function k0(s,r){const l=Math.round(s.x*r),h=Math.round(s.y*r);return s.x=De(l,cm,Xh),s.y=De(h,cm,Xh),(l<s.x||l>s.x+1||h<s.y||h>s.y+1)&&ur("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function vu(s,r,l){const h=s.loadGeometry(),p=s.extent,x=_t/p;if(r&&l&&l.projection.isReprojectedInTileSpace){const b=1<<r.z,{scale:A,x:P,y:k,projection:q}=l,K=te=>{const ue=zc((r.x+te.x/p)/b),pe=Ho((r.y+te.y/p)/b),Se=q.project(ue,pe);te.x=(Se.x*A-P)*p,te.y=(Se.y*A-k)*p};for(let te=0;te<h.length;te++)if(s.type!==1)h[te]=Ou(h[te],K,1);else{const ue=[];for(const pe of h[te])pe.x<0||pe.x>=p||pe.y<0||pe.y>=p||(K(pe),ue.push(pe));h[te]=ue}}for(const b of h)for(const A of b)k0(A,x);return h}function md(s,r){return{type:s.type,id:s.id,properties:s.properties,geometry:r?vu(s):[]}}function Kh(s,r,l,h,p){s.emplaceBack(2*r+(h+1)/2,2*l+(p+1)/2)}function Uf(s,r,l){s.emplaceBack(r.x,r.y,r.z,l[0]*16384,l[1]*16384,l[2]*16384)}class Vf{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new gn,this.indexArray=new _r,this.segments=new Lt,this.programConfigurations=new Nu(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(r,l,h,p){const x=this.layers[0],b=[];let A=null;x.type==="circle"&&(A=x.layout.get("circle-sort-key"));for(const{feature:k,id:q,index:K,sourceLayerIndex:te}of r){const ue=this.layers[0]._featureFilter.needGeometry,pe=md(k,ue);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),pe,h))continue;const Se=A?A.evaluate(pe,{},h):void 0,Ge={id:q,properties:k.properties,type:k.type,sourceLayerIndex:te,index:K,geometry:ue?pe.geometry:vu(k,h,p),patterns:{},sortKey:Se};b.push(Ge)}A&&b.sort(((k,q)=>k.sortKey-q.sortKey));let P=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new Cn,P=p.projection);for(const k of b){const{geometry:q,index:K,sourceLayerIndex:te}=k,ue=r[K].feature;this.addFeature(k,q,K,l.availableImages,h,P),l.featureIndex.insert(ue,q,K,te,this.index)}}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,tt.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,ot.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,l,h,p,x,b){for(const A of l)for(const P of A){const k=P.x,q=P.y;if(k<0||k>=_t||q<0||q>=_t)continue;if(b){const ue=b.projectTilePoint(k,q,x),pe=b.upVector(x,k,q),Se=this.globeExtVertexArray;Uf(Se,ue,pe),Uf(Se,ue,pe),Uf(Se,ue,pe),Uf(Se,ue,pe)}const K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),te=K.vertexLength;Kh(this.layoutVertexArray,k,q,-1,-1),Kh(this.layoutVertexArray,k,q,1,-1),Kh(this.layoutVertexArray,k,q,1,1),Kh(this.layoutVertexArray,k,q,-1,1),this.indexArray.emplaceBack(te,te+1,te+2),this.indexArray.emplaceBack(te,te+2,te+3),K.vertexLength+=4,K.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{},p,x)}}function ag(s,r){for(let l=0;l<s.length;l++)if(Nd(r,s[l]))return!0;for(let l=0;l<r.length;l++)if(Nd(s,r[l]))return!0;return!!gd(s,r)}function lg(s,r,l){return!!Nd(s,r)||!!xu(r,s,l)}function um(s,r){if(s.length===1)return cg(r,s[0]);for(let l=0;l<r.length;l++){const h=r[l];for(let p=0;p<h.length;p++)if(Nd(s,h[p]))return!0}for(let l=0;l<s.length;l++)if(cg(r,s[l]))return!0;for(let l=0;l<r.length;l++)if(gd(s,r[l]))return!0;return!1}function Bu(s,r,l){if(s.length>1){if(gd(s,r))return!0;for(let h=0;h<r.length;h++)if(xu(r[h],s,l))return!0}for(let h=0;h<s.length;h++)if(xu(s[h],r,l))return!0;return!1}function gd(s,r){if(s.length===0||r.length===0)return!1;for(let l=0;l<s.length-1;l++){const h=s[l],p=s[l+1];for(let x=0;x<r.length-1;x++)if(Zh(h,p,r[x],r[x+1]))return!0}return!1}function Zh(s,r,l,h){return xr(s,l,h)!==xr(r,l,h)&&xr(s,r,l)!==xr(s,r,h)}function xu(s,r,l){const h=l*l;if(r.length===1)return s.distSqr(r[0])<h;for(let p=1;p<r.length;p++)if(M0(s,r[p-1],r[p])<h)return!0;return!1}function M0(s,r,l){const h=r.distSqr(l);if(h===0)return s.distSqr(r);const p=((s.x-r.x)*(l.x-r.x)+(s.y-r.y)*(l.y-r.y))/h;return s.distSqr(p<0?r:p>1?l:l.sub(r)._mult(p)._add(r))}function cg(s,r){let l,h,p,x=!1;for(let b=0;b<s.length;b++){l=s[b];for(let A=0,P=l.length-1;A<l.length;P=A++)h=l[A],p=l[P],h.y>r.y!=p.y>r.y&&r.x<(p.x-h.x)*(r.y-h.y)/(p.y-h.y)+h.x&&(x=!x)}return x}function Nd(s,r){let l=!1;for(let h=0,p=s.length-1;h<s.length;p=h++){const x=s[h],b=s[p];x.y>r.y!=b.y>r.y&&r.x<(b.x-x.x)*(r.y-x.y)/(b.y-x.y)+x.x&&(l=!l)}return l}function A_(s,r,l,h,p){for(const b of s)if(r<=b.x&&l<=b.y&&h>=b.x&&p>=b.y)return!0;const x=[new $(r,l),new $(r,p),new $(h,p),new $(h,l)];if(s.length>2){for(const b of x)if(Nd(s,b))return!0}for(let b=0;b<s.length-1;b++)if(sf(s[b],s[b+1],x))return!0;return!1}function sf(s,r,l){const h=l[0],p=l[2];if(s.x<h.x&&r.x<h.x||s.x>p.x&&r.x>p.x||s.y<h.y&&r.y<h.y||s.y>p.y&&r.y>p.y)return!1;const x=xr(s,r,l[0]);return x!==xr(s,r,l[1])||x!==xr(s,r,l[2])||x!==xr(s,r,l[3])}function qf(s,r,l){const h=r.paint.get(s).value;return h.kind==="constant"?h.value:l.programConfigurations.get(r.id).getMaxValue(s)}function Sp(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function af(s,r,l,h,p){if(!r[0]&&!r[1])return s;const x=$.convert(r)._mult(p);l==="viewport"&&x._rotate(-h);const b=[];for(let A=0;A<s.length;A++)b.push(s[A].sub(x));return b}function ug(s,r,l,h){const p=$.convert(s)._mult(h);return r==="viewport"&&p._rotate(-l),p}sr(Vf,"CircleBucket",{omit:["layers"]});const $f=new st({"circle-sort-key":new Ue(pn.layout_circle["circle-sort-key"])});var T_={paint:new st({"circle-radius":new Ue(pn.paint_circle["circle-radius"]),"circle-color":new Ue(pn.paint_circle["circle-color"]),"circle-blur":new Ue(pn.paint_circle["circle-blur"]),"circle-opacity":new Ue(pn.paint_circle["circle-opacity"]),"circle-translate":new ve(pn.paint_circle["circle-translate"]),"circle-translate-anchor":new ve(pn.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ve(pn.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ve(pn.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ue(pn.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ue(pn.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ue(pn.paint_circle["circle-stroke-opacity"])}),layout:$f};function R0(s,r,l,h,p,x,b,A,P){if(x&&s.queryGeometry.isAboveHorizon)return!1;x&&(P*=s.pixelToTileUnitsFactor);const k=s.tileID.canonical,q=l.projection.upVectorScale(k,l.center.lat,l.worldSize).metersToTile;for(const K of r)for(const te of K){const ue=te.add(A),pe=p&&l.elevation?l.elevation.exaggeration()*p.getElevationAt(ue.x,ue.y,!0):0,Se=l.projection.projectTilePoint(ue.x,ue.y,k);if(pe>0){const lt=l.projection.upVector(k,ue.x,ue.y);Se.x+=lt[0]*q*pe,Se.y+=lt[1]*q*pe,Se.z+=lt[2]*q*pe}const Ge=x?ue:N0(Se.x,Se.y,Se.z,h),at=x?s.tilespaceRays.map((lt=>ux(lt,pe))):s.queryGeometry.screenGeometry,xt=_l([],[Se.x,Se.y,Se.z,1],h);if(!b&&x?P*=xt[3]/l.cameraToCenterDistance:b&&!x&&(P*=l.cameraToCenterDistance/xt[3]),x){const lt=Ho((te.y/_t+k.y)/(1<<k.z));P/=l.projection.pixelsPerMeter(lt,1)/al(1,lt)}if(lg(at,Ge,P))return!0}return!1}function N0(s,r,l,h){const p=_l([],[s,r,l,1],h);return new $(p[0]/p[3],p[1]/p[3])}const hm=jr(0,0,0),cx=jr(0,0,1);function ux(s,r){const l=Mr();return hm[2]=r,s.intersectsPlane(hm,cx,l),new $(l[0],l[1])}class D0 extends Vf{}function F0(s,{width:r,height:l},h,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==r*l*h)throw new RangeError("mismatched image size")}else p=new Uint8Array(r*l*h);return s.width=r,s.height=l,s.data=p,s}function lf(s,r,l){const{width:h,height:p}=r;h===s.width&&p===s.height||(O0(s,r,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,h),height:Math.min(s.height,p)},l),s.width=h,s.height=p,s.data=r.data)}function O0(s,r,l,h,p,x){if(p.width===0||p.height===0)return r;if(p.width>s.width||p.height>s.height||l.x>s.width-p.width||l.y>s.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>r.width||p.height>r.height||h.x>r.width-p.width||h.y>r.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const b=s.data,A=r.data;for(let P=0;P<p.height;P++){const k=((l.y+P)*s.width+l.x)*x,q=((h.y+P)*r.width+h.x)*x;for(let K=0;K<p.width*x;K++)A[q+K]=b[k+K]}return r}sr(D0,"HeatmapBucket",{omit:["layers"]});class ih{constructor(r,l){F0(this,r,1,l)}resize(r){lf(this,new ih(r),1)}clone(){return new ih({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,h,p,x){O0(r,l,h,p,x,1)}}class zu{constructor(r,l){F0(this,r,4,l)}resize(r){lf(this,new zu(r),4)}replace(r,l){l?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new zu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,h,p,x){O0(r,l,h,p,x,4)}}sr(ih,"AlphaImage"),sr(zu,"RGBAImage");var xl={paint:new st({"heatmap-radius":new Ue(pn.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ue(pn.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ve(pn.paint_heatmap["heatmap-intensity"]),"heatmap-color":new rt(pn.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ve(pn.paint_heatmap["heatmap-opacity"])})};function B0(s){const r={},l=s.resolution||256,h=s.clips?s.clips.length:1,p=s.image||new zu({width:l,height:h}),x=(b,A,P)=>{r[s.evaluationKey]=P;const k=s.expression.evaluate(r);p.data[b+A+0]=Math.floor(255*k.r/k.a),p.data[b+A+1]=Math.floor(255*k.g/k.a),p.data[b+A+2]=Math.floor(255*k.b/k.a),p.data[b+A+3]=Math.floor(255*k.a)};if(s.clips)for(let b=0,A=0;b<h;++b,A+=4*l)for(let P=0,k=0;P<l;P++,k+=4){const q=P/(l-1),{start:K,end:te}=s.clips[b];x(A,k,K*(1-q)+te*q)}else for(let b=0,A=0;b<l;b++,A+=4)x(0,A,b/(l-1));return p}var I_={paint:new st({"hillshade-illumination-direction":new ve(pn.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ve(pn.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ve(pn.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ve(pn.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ve(pn.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ve(pn.paint_hillshade["hillshade-accent-color"])})};const hx=kt([{name:"a_pos",components:2,type:"Int16"}],4),{members:dx}=hx;var hg={exports:{}};function dm(s,r,l){l=l||2;var h,p,x,b,A,P,k,q=r&&r.length,K=q?r[0]*l:s.length,te=C_(s,0,K,l,!0),ue=[];if(!te||te.next===te.prev)return ue;if(q&&(te=(function(Se,Ge,at,xt){var lt,yt,It,Tt=[];for(lt=0,yt=Ge.length;lt<yt;lt++)(It=C_(Se,Ge[lt]*xt,lt<yt-1?Ge[lt+1]*xt:Se.length,xt,!1))===It.next&&(It.steiner=!0),Tt.push(V0(It));for(Tt.sort(fg),lt=0;lt<Tt.length;lt++)at=z0(Tt[lt],at);return at})(s,r,te,l)),s.length>80*l){h=x=s[0],p=b=s[1];for(var pe=l;pe<K;pe+=l)(A=s[pe])<h&&(h=A),(P=s[pe+1])<p&&(p=P),A>x&&(x=A),P>b&&(b=P);k=(k=Math.max(x-h,b-p))!==0?32767/k:0}return Gf(te,ue,l,h,p,k,0),ue}function C_(s,r,l,h,p){var x,b;if(p===Tp(s,r,l,h)>0)for(x=r;x<l;x+=h)b=pg(x,s[x],s[x+1],b);else for(x=l-h;x>=r;x-=h)b=pg(x,s[x],s[x+1],b);return b&&Hf(b,b.next)&&(uf(b),b=b.next),b}function jc(s,r){if(!s)return s;r||(r=s);var l,h=s;do if(l=!1,h.steiner||!Hf(h,h.next)&&Xa(h.prev,h,h.next)!==0)h=h.next;else{if(uf(h),(h=r=h.prev)===h.next)break;l=!0}while(l||h!==r);return r}function Gf(s,r,l,h,p,x,b){if(s){!b&&x&&(function(q,K,te,ue){var pe=q;do pe.z===0&&(pe.z=U0(pe.x,pe.y,K,te,ue)),pe.prevZ=pe.prev,pe.nextZ=pe.next,pe=pe.next;while(pe!==q);pe.prevZ.nextZ=null,pe.prevZ=null,(function(Se){var Ge,at,xt,lt,yt,It,Tt,ln,en=1;do{for(at=Se,Se=null,yt=null,It=0;at;){for(It++,xt=at,Tt=0,Ge=0;Ge<en&&(Tt++,xt=xt.nextZ);Ge++);for(ln=en;Tt>0||ln>0&&xt;)Tt!==0&&(ln===0||!xt||at.z<=xt.z)?(lt=at,at=at.nextZ,Tt--):(lt=xt,xt=xt.nextZ,ln--),yt?yt.nextZ=lt:Se=lt,lt.prevZ=yt,yt=lt;at=xt}yt.nextZ=null,en*=2}while(It>1)})(pe)})(s,h,p,x);for(var A,P,k=s;s.prev!==s.next;)if(A=s.prev,P=s.next,x?cf(s,h,p,x):fx(s))r.push(A.i/l|0),r.push(s.i/l|0),r.push(P.i/l|0),uf(s),s=P.next,k=P.next;else if((s=P)===k){b?b===1?Gf(s=dg(jc(s),r,l),r,l,h,p,x,2):b===2&&Wf(s,r,l,h,p,x):Gf(jc(s),r,l,h,p,x,1);break}}}function fx(s){var r=s.prev,l=s,h=s.next;if(Xa(r,l,h)>=0)return!1;for(var p=r.x,x=l.x,b=h.x,A=r.y,P=l.y,k=h.y,q=p<x?p<b?p:b:x<b?x:b,K=A<P?A<k?A:k:P<k?P:k,te=p>x?p>b?p:b:x>b?x:b,ue=A>P?A>k?A:k:P>k?P:k,pe=h.next;pe!==r;){if(pe.x>=q&&pe.x<=te&&pe.y>=K&&pe.y<=ue&&Ep(p,A,x,P,b,k,pe.x,pe.y)&&Xa(pe.prev,pe,pe.next)>=0)return!1;pe=pe.next}return!0}function cf(s,r,l,h){var p=s.prev,x=s,b=s.next;if(Xa(p,x,b)>=0)return!1;for(var A=p.x,P=x.x,k=b.x,q=p.y,K=x.y,te=b.y,ue=A<P?A<k?A:k:P<k?P:k,pe=q<K?q<te?q:te:K<te?K:te,Se=A>P?A>k?A:k:P>k?P:k,Ge=q>K?q>te?q:te:K>te?K:te,at=U0(ue,pe,r,l,h),xt=U0(Se,Ge,r,l,h),lt=s.prevZ,yt=s.nextZ;lt&&lt.z>=at&&yt&&yt.z<=xt;){if(lt.x>=ue&&lt.x<=Se&&lt.y>=pe&&lt.y<=Ge&&lt!==p&&lt!==b&&Ep(A,q,P,K,k,te,lt.x,lt.y)&&Xa(lt.prev,lt,lt.next)>=0||(lt=lt.prevZ,yt.x>=ue&&yt.x<=Se&&yt.y>=pe&&yt.y<=Ge&&yt!==p&&yt!==b&&Ep(A,q,P,K,k,te,yt.x,yt.y)&&Xa(yt.prev,yt,yt.next)>=0))return!1;yt=yt.nextZ}for(;lt&&lt.z>=at;){if(lt.x>=ue&&lt.x<=Se&&lt.y>=pe&&lt.y<=Ge&&lt!==p&&lt!==b&&Ep(A,q,P,K,k,te,lt.x,lt.y)&&Xa(lt.prev,lt,lt.next)>=0)return!1;lt=lt.prevZ}for(;yt&&yt.z<=xt;){if(yt.x>=ue&&yt.x<=Se&&yt.y>=pe&&yt.y<=Ge&&yt!==p&&yt!==b&&Ep(A,q,P,K,k,te,yt.x,yt.y)&&Xa(yt.prev,yt,yt.next)>=0)return!1;yt=yt.nextZ}return!0}function dg(s,r,l){var h=s;do{var p=h.prev,x=h.next.next;!Hf(p,x)&&fm(p,h,h.next,x)&&mm(p,x)&&mm(x,p)&&(r.push(p.i/l|0),r.push(h.i/l|0),r.push(x.i/l|0),uf(h),uf(h.next),h=s=x),h=h.next}while(h!==s);return jc(h)}function Wf(s,r,l,h,p,x){var b=s;do{for(var A=b.next.next;A!==b.prev;){if(b.i!==A.i&&L_(b,A)){var P=q0(b,A);return b=jc(b,b.next),P=jc(P,P.next),Gf(b,r,l,h,p,x,0),void Gf(P,r,l,h,p,x,0)}A=A.next}b=b.next}while(b!==s)}function fg(s,r){return s.x-r.x}function z0(s,r){var l=(function(p,x){var b,A=x,P=p.x,k=p.y,q=-1/0;do{if(k<=A.y&&k>=A.next.y&&A.next.y!==A.y){var K=A.x+(k-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(K<=P&&K>q&&(q=K,b=A.x<A.next.x?A:A.next,K===P))return b}A=A.next}while(A!==x);if(!b)return null;var te,ue=b,pe=b.x,Se=b.y,Ge=1/0;A=b;do P>=A.x&&A.x>=pe&&P!==A.x&&Ep(k<Se?P:q,k,pe,Se,k<Se?q:P,k,A.x,A.y)&&(te=Math.abs(k-A.y)/(P-A.x),mm(A,p)&&(te<Ge||te===Ge&&(A.x>b.x||A.x===b.x&&j0(b,A)))&&(b=A,Ge=te)),A=A.next;while(A!==ue);return b})(s,r);if(!l)return r;var h=q0(l,s);return jc(h,h.next),jc(l,l.next)}function j0(s,r){return Xa(s.prev,s,r.prev)<0&&Xa(r.next,s,s.next)<0}function U0(s,r,l,h,p){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-l)*p|0)|s<<8))|s<<4))|s<<2))|s<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-h)*p|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function V0(s){var r=s,l=s;do(r.x<l.x||r.x===l.x&&r.y<l.y)&&(l=r),r=r.next;while(r!==s);return l}function Ep(s,r,l,h,p,x,b,A){return(p-b)*(r-A)>=(s-b)*(x-A)&&(s-b)*(h-A)>=(l-b)*(r-A)&&(l-b)*(x-A)>=(p-b)*(h-A)}function L_(s,r){return s.next.i!==r.i&&s.prev.i!==r.i&&!(function(l,h){var p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==h.i&&p.next.i!==h.i&&fm(p,p.next,l,h))return!0;p=p.next}while(p!==l);return!1})(s,r)&&(mm(s,r)&&mm(r,s)&&(function(l,h){var p=l,x=!1,b=(l.x+h.x)/2,A=(l.y+h.y)/2;do p.y>A!=p.next.y>A&&p.next.y!==p.y&&b<(p.next.x-p.x)*(A-p.y)/(p.next.y-p.y)+p.x&&(x=!x),p=p.next;while(p!==l);return x})(s,r)&&(Xa(s.prev,s,r.prev)||Xa(s,r.prev,r))||Hf(s,r)&&Xa(s.prev,s,s.next)>0&&Xa(r.prev,r,r.next)>0)}function Xa(s,r,l){return(r.y-s.y)*(l.x-r.x)-(r.x-s.x)*(l.y-r.y)}function Hf(s,r){return s.x===r.x&&s.y===r.y}function fm(s,r,l,h){var p=Ap(Xa(s,r,l)),x=Ap(Xa(s,r,h)),b=Ap(Xa(l,h,s)),A=Ap(Xa(l,h,r));return p!==x&&b!==A||!(p!==0||!pm(s,l,r))||!(x!==0||!pm(s,h,r))||!(b!==0||!pm(l,s,h))||!(A!==0||!pm(l,r,h))}function pm(s,r,l){return r.x<=Math.max(s.x,l.x)&&r.x>=Math.min(s.x,l.x)&&r.y<=Math.max(s.y,l.y)&&r.y>=Math.min(s.y,l.y)}function Ap(s){return s>0?1:s<0?-1:0}function mm(s,r){return Xa(s.prev,s,s.next)<0?Xa(s,r,s.next)>=0&&Xa(s,s.prev,r)>=0:Xa(s,r,s.prev)<0||Xa(s,s.next,r)<0}function q0(s,r){var l=new gm(s.i,s.x,s.y),h=new gm(r.i,r.x,r.y),p=s.next,x=r.prev;return s.next=r,r.prev=s,l.next=p,p.prev=l,h.next=l,l.prev=h,x.next=h,h.prev=x,h}function pg(s,r,l,h){var p=new gm(s,r,l);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function uf(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function gm(s,r,l){this.i=s,this.x=r,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Tp(s,r,l,h){for(var p=0,x=r,b=l-h;x<l;x+=h)p+=(s[b]-s[x])*(s[x+1]+s[b+1]),b=x;return p}hg.exports=dm,hg.exports.default=dm,dm.deviation=function(s,r,l,h){var p=r&&r.length,x=Math.abs(Tp(s,0,p?r[0]*l:s.length,l));if(p)for(var b=0,A=r.length;b<A;b++)x-=Math.abs(Tp(s,r[b]*l,b<A-1?r[b+1]*l:s.length,l));var P=0;for(b=0;b<h.length;b+=3){var k=h[b]*l,q=h[b+1]*l,K=h[b+2]*l;P+=Math.abs((s[k]-s[K])*(s[q+1]-s[k+1])-(s[k]-s[q])*(s[K+1]-s[k+1]))}return x===0&&P===0?0:Math.abs((P-x)/x)},dm.flatten=function(s){for(var r=s[0][0].length,l={vertices:[],holes:[],dimensions:r},h=0,p=0;p<s.length;p++){for(var x=0;x<s[p].length;x++)for(var b=0;b<r;b++)l.vertices.push(s[p][x][b]);p>0&&l.holes.push(h+=s[p-1].length)}return l};var mg=he(hg.exports);function px(s,r,l,h,p){ym(s,r,l,h||s.length-1,p||vm)}function ym(s,r,l,h,p){for(;h>l;){if(h-l>600){var x=h-l+1,b=r-l+1,A=Math.log(x),P=.5*Math.exp(2*A/3),k=.5*Math.sqrt(A*P*(x-P)/x)*(b-x/2<0?-1:1);ym(s,r,Math.max(l,Math.floor(r-b*P/x+k)),Math.min(h,Math.floor(r+(x-b)*P/x+k)),p)}var q=s[r],K=l,te=h;for(_m(s,l,r),p(s[h],q)>0&&_m(s,l,h);K<te;){for(_m(s,K,te),K++,te--;p(s[K],q)<0;)K++;for(;p(s[te],q)>0;)te--}p(s[l],q)===0?_m(s,l,te):_m(s,++te,h),te<=r&&(l=te+1),r<=te&&(h=te-1)}}function _m(s,r,l){var h=s[r];s[r]=s[l],s[l]=h}function vm(s,r){return s<r?-1:s>r?1:0}function $0(s,r){const l=s.length;if(l<=1)return[s];const h=[];let p,x;for(let b=0;b<l;b++){const A=Tr(s[b]);A!==0&&(s[b].area=Math.abs(A),x===void 0&&(x=A<0),x===A<0?(p&&h.push(p),p=[s[b]]):p.push(s[b]))}if(p&&h.push(p),r>1)for(let b=0;b<h.length;b++)h[b].length<=r||(px(h[b],r,1,h[b].length-1,gg),h[b]=h[b].slice(0,r));return h}function gg(s,r){return r.area-s.area}function d(s,r,l){const h=l.patternDependencies;let p=!1;for(const x of r){const b=x.paint.get(`${s}-pattern`);b.isConstant()||(p=!0);const A=b.constantOr(null);A&&(p=!0,h[A]=!0)}return p}function g(s,r,l,h,p){const x=p.patternDependencies;for(const b of r){const A=b.paint.get(`${s}-pattern`).value;if(A.kind!=="constant"){let P=A.evaluate({zoom:h},l,{},p.availableImages);P=P&&P.name?P.name:P,x[P]=!0,l.patterns[b.id]=P}}return l}class E{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new gn,this.indexArray=new _r,this.indexArray2=new ps,this.programConfigurations=new Nu(r.layers,r.zoom),this.segments=new Lt,this.segments2=new Lt,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id)),this.projection=r.projection}populate(r,l,h,p){this.hasPattern=d("fill",this.layers,l);const x=this.layers[0].layout.get("fill-sort-key"),b=[];for(const{feature:A,id:P,index:k,sourceLayerIndex:q}of r){const K=this.layers[0]._featureFilter.needGeometry,te=md(A,K);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),te,h))continue;const ue=x?x.evaluate(te,{},h,l.availableImages):void 0,pe={id:P,properties:A.properties,type:A.type,sourceLayerIndex:q,index:k,geometry:K?te.geometry:vu(A,h,p),patterns:{},sortKey:ue};b.push(pe)}x&&b.sort(((A,P)=>A.sortKey-P.sortKey));for(const A of b){const{geometry:P,index:k,sourceLayerIndex:q}=A;if(this.hasPattern){const K=g("fill",this.layers,A,this.zoom,l);this.patternFeatures.push(K)}else this.addFeature(A,P,k,h,{},l.availableImages);l.featureIndex.insert(r[k].feature,P,k,q,this.index)}}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}addFeatures(r,l,h,p,x){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,dx),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,l,h,p,x,b=[]){for(const A of $0(l,500)){let P=0;for(const pe of A)P+=pe.length;const k=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),q=k.vertexLength,K=[],te=[];for(const pe of A){if(pe.length===0)continue;pe!==A[0]&&te.push(K.length/2);const Se=this.segments2.prepareSegment(pe.length,this.layoutVertexArray,this.indexArray2),Ge=Se.vertexLength;this.layoutVertexArray.emplaceBack(pe[0].x,pe[0].y),this.indexArray2.emplaceBack(Ge+pe.length-1,Ge),K.push(pe[0].x),K.push(pe[0].y);for(let at=1;at<pe.length;at++)this.layoutVertexArray.emplaceBack(pe[at].x,pe[at].y),this.indexArray2.emplaceBack(Ge+at-1,Ge+at),K.push(pe[at].x),K.push(pe[at].y);Se.vertexLength+=pe.length,Se.primitiveLength+=pe.length}const ue=mg(K,te);for(let pe=0;pe<ue.length;pe+=3)this.indexArray.emplaceBack(q+ue[pe],q+ue[pe+1],q+ue[pe+2]);k.vertexLength+=P,k.primitiveLength+=ue.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,x,b,p)}}sr(E,"FillBucket",{omit:["layers","patternFeatures"]});const N=new st({"fill-sort-key":new Ue(pn.layout_fill["fill-sort-key"])});var X={paint:new st({"fill-antialias":new ve(pn.paint_fill["fill-antialias"]),"fill-opacity":new Ue(pn.paint_fill["fill-opacity"]),"fill-color":new Ue(pn.paint_fill["fill-color"]),"fill-outline-color":new Ue(pn.paint_fill["fill-outline-color"]),"fill-translate":new ve(pn.paint_fill["fill-translate"]),"fill-translate-anchor":new ve(pn.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ue(pn.paint_fill["fill-pattern"])}),layout:N};const le=kt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ze=kt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Et=kt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ft}=le;var yn={},Jn=j,rr=Vn;function Vn(s,r,l,h,p){this.properties={},this.extent=l,this.type=0,this._pbf=s,this._geometry=-1,this._keys=h,this._values=p,s.readFields(Zr,this,r)}function Zr(s,r,l){s==1?r.id=l.readVarint():s==2?(function(h,p){for(var x=h.readVarint()+h.pos;h.pos<x;){var b=p._keys[h.readVarint()],A=p._values[h.readVarint()];p.properties[b]=A}})(l,r):s==3?r.type=l.readVarint():s==4&&(r._geometry=l.pos)}function li(s){for(var r,l,h=0,p=0,x=s.length,b=x-1;p<x;b=p++)h+=((l=s[b]).x-(r=s[p]).x)*(r.y+l.y);return h}Vn.types=["Unknown","Point","LineString","Polygon"],Vn.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var r,l=s.readVarint()+s.pos,h=1,p=0,x=0,b=0,A=[];s.pos<l;){if(p<=0){var P=s.readVarint();h=7&P,p=P>>3}if(p--,h===1||h===2)x+=s.readSVarint(),b+=s.readSVarint(),h===1&&(r&&A.push(r),r=[]),r.push(new Jn(x,b));else{if(h!==7)throw new Error("unknown command "+h);r&&r.push(r[0].clone())}}return r&&A.push(r),A},Vn.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var r=s.readVarint()+s.pos,l=1,h=0,p=0,x=0,b=1/0,A=-1/0,P=1/0,k=-1/0;s.pos<r;){if(h<=0){var q=s.readVarint();l=7&q,h=q>>3}if(h--,l===1||l===2)(p+=s.readSVarint())<b&&(b=p),p>A&&(A=p),(x+=s.readSVarint())<P&&(P=x),x>k&&(k=x);else if(l!==7)throw new Error("unknown command "+l)}return[b,P,A,k]},Vn.prototype.toGeoJSON=function(s,r,l){var h,p,x=this.extent*Math.pow(2,l),b=this.extent*s,A=this.extent*r,P=this.loadGeometry(),k=Vn.types[this.type];function q(ue){for(var pe=0;pe<ue.length;pe++){var Se=ue[pe];ue[pe]=[360*(Se.x+b)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(Se.y+A)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(h=0;h<P.length;h++)K[h]=P[h][0];q(P=K);break;case 2:for(h=0;h<P.length;h++)q(P[h]);break;case 3:for(P=(function(ue){var pe=ue.length;if(pe<=1)return[ue];for(var Se,Ge,at=[],xt=0;xt<pe;xt++){var lt=li(ue[xt]);lt!==0&&(Ge===void 0&&(Ge=lt<0),Ge===lt<0?(Se&&at.push(Se),Se=[ue[xt]]):Se.push(ue[xt]))}return Se&&at.push(Se),at})(P),h=0;h<P.length;h++)for(p=0;p<P[h].length;p++)q(P[h][p])}P.length===1?P=P[0]:k="Multi"+k;var te={type:"Feature",geometry:{type:k,coordinates:P},properties:this.properties};return"id"in this&&(te.id=this.id),te};var di=rr,bl=cn;function cn(s,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Gt,this,r),this.length=this._features.length}function Gt(s,r,l){s===15?r.version=l.readVarint():s===1?r.name=l.readString():s===5?r.extent=l.readVarint():s===2?r._features.push(l.pos):s===3?r._keys.push(l.readString()):s===4&&r._values.push((function(h){for(var p=null,x=h.readVarint()+h.pos;h.pos<x;){var b=h.readVarint()>>3;p=b===1?h.readString():b===2?h.readFloat():b===3?h.readDouble():b===4?h.readVarint64():b===5?h.readVarint():b===6?h.readSVarint():b===7?h.readBoolean():null}return p})(l))}cn.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var r=this._pbf.readVarint()+this._pbf.pos;return new di(this._pbf,r,this.extent,this._keys,this._values)};var mn=bl;function fr(s,r,l){if(s===3){var h=new mn(l,l.readVarint()+l.pos);h.length&&(r[h.name]=h)}}var fi=yn.VectorTile=function(s,r){this.layers=s.readFields(fr,{},r)},Pi=yn.VectorTileFeature=rr;function ki(s,r,l,h){const p=[],x=h===0?(b,A,P,k,q,K)=>{b.push(new $(K,P+(K-A)/(k-A)*(q-P)))}:(b,A,P,k,q,K)=>{b.push(new $(A+(K-P)/(q-P)*(k-A),K))};for(const b of s){const A=[];for(const P of b){if(P.length<=2)continue;const k=[];for(let te=0;te<P.length-1;te++){const ue=P[te].x,pe=P[te].y,Se=P[te+1].x,Ge=P[te+1].y,at=h===0?ue:pe,xt=h===0?Se:Ge;at<r?xt>r&&x(k,ue,pe,Se,Ge,r):at>l?xt<l&&x(k,ue,pe,Se,Ge,l):k.push(P[te]),xt<r&&at>=r&&x(k,ue,pe,Se,Ge,r),xt>l&&at<=l&&x(k,ue,pe,Se,Ge,l)}let q=P[P.length-1];const K=h===0?q.x:q.y;K>=r&&K<=l&&k.push(q),k.length&&(q=k[k.length-1],k[0].x===q.x&&k[0].y===q.y||k.push(k[0]),A.push(k))}A.length&&p.push(A)}return p}yn.VectorTileLayer=bl;const no=Pi.types,Uc=Math.pow(2,13);function Xo(s,r,l,h,p,x,b,A){s.emplaceBack((r<<1)+b,(l<<1)+x,(Math.floor(h*Uc)<<1)+p,Math.round(A))}function Dh(s,r,l){s.emplaceBack(r.x,r.y,r.z,l[0]*16384,l[1]*16384,l[2]*16384)}class P_{constructor(){this.acc=new $(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new $(r.x,r.y),this.max=new $(r.x,r.y))}append(r,l){this.currentPolyCount.edges++,this.acc._add(r);const h=this.min,p=this.max;r.x<h.x?h.x=r.x:r.x>p.x&&(p.x=r.x),r.y<h.y?h.y=r.y:r.y>p.y&&(p.y=r.y),((r.x===0||r.x===_t)&&r.x===l.x)!=((r.y===0||r.y===_t)&&r.y===l.y)&&this.processBorderOverlap(r,l),l.x<0!=r.x<0&&this.addBorderIntersection(0,$e(l.y,r.y,(0-l.x)/(r.x-l.x))),l.x>_t!=r.x>_t&&this.addBorderIntersection(1,$e(l.y,r.y,(_t-l.x)/(r.x-l.x))),l.y<0!=r.y<0&&this.addBorderIntersection(2,$e(l.x,r.x,(0-l.y)/(r.y-l.y))),l.y>_t!=r.y>_t&&this.addBorderIntersection(3,$e(l.x,r.x,(_t-l.y)/(r.y-l.y)))}addBorderIntersection(r,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[r];l<h[0]&&(h[0]=l),l>h[1]&&(h[1]=l)}processBorderOverlap(r,l){if(r.x===l.x){if(r.y===l.y)return;const h=r.x===0?0:1;this.addBorderIntersection(h,l.y),this.addBorderIntersection(h,r.y)}else{const h=r.y===0?2:3;this.addBorderIntersection(h,l.x),this.addBorderIntersection(h,r.x)}}centroid(){const r=this.polyCount.reduce(((l,h)=>l+h.edges),0);return r!==0?this.acc.div(r)._round():new $(0,0)}span(){return new $(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((r,l)=>r+ +(l[0]!==Number.MAX_VALUE)),0)}}class G0{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.layoutVertexArray=new un,this.centroidVertexArray=new Kl,this.indexArray=new _r,this.programConfigurations=new Nu(r.layers,r.zoom),this.segments=new Lt,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id)),this.enableTerrain=r.enableTerrain}populate(r,l,h,p){this.features=[],this.hasPattern=d("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=(function(x){const b=Math.exp(Math.PI*(1-x.y/(1<<x.z)*2));return 80150034*b/(b*b+1)/_t/(1<<x.z)})(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:x,id:b,index:A,sourceLayerIndex:P}of r){const k=this.layers[0]._featureFilter.needGeometry,q=md(x,k);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),q,h))continue;const K={id:b,sourceLayerIndex:P,index:A,geometry:k?q.geometry:vu(x,h,p),properties:x.properties,type:x.type,patterns:{}},te=this.layoutVertexArray.length;this.hasPattern?this.features.push(g("fill-extrusion",this.layers,K,this.zoom,l)):this.addFeature(K,K.geometry,A,h,{},l.availableImages,p),l.featureIndex.insert(x,K.geometry,A,P,this.index,te)}this.sortBorders()}addFeatures(r,l,h,p,x){for(const b of this.features){const{geometry:A}=b;this.addFeature(b,A,b.index,l,h,p,x)}this.sortBorders()}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ft),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,Et.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,ze.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,h,p,x,b,A){const P=[new $(0,0),new $(_t,_t)],k=A.projection,q=k.name==="globe",K=this.enableTerrain&&!q?new P_:null,te=no[r.type]==="Polygon";q&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Cn);const ue=$0(l,500);for(let at=ue.length-1;at>=0;at--){const xt=ue[at];(xt.length===0||(pe=xt[0]).every((lt=>lt.x<=0))||pe.every((lt=>lt.x>=_t))||pe.every((lt=>lt.y<=0))||pe.every((lt=>lt.y>=_t)))&&ue.splice(at,1)}var pe;let Se;if(q)Se=I3(ue,P,p);else{Se=[];for(const at of ue)Se.push({polygon:at,bounds:P})}const Ge=te?this.edgeRadius:0;for(const{polygon:at,bounds:xt}of Se){let lt=0,yt=0;for(const Tt of at)te&&!Tt[0].equals(Tt[Tt.length-1])&&Tt.push(Tt[0]),yt+=te?Tt.length-1:Tt.length;const It=this.segments.prepareSegment((te?5:4)*yt,this.layoutVertexArray,this.indexArray);if(te){const Tt=[],ln=[];lt=It.vertexLength;for(const wn of at){let jn,dn;wn.length&&wn!==at[0]&&ln.push(Tt.length/2),jn=wn[1].sub(wn[0])._perp()._unit();for(let Pn=1;Pn<wn.length;Pn++){const kn=wn[Pn],On=wn[Pn===wn.length-1?1:Pn+1];let{x:Wn,y:xn}=kn;if(Ge){dn=On.sub(kn)._perp()._unit();const dr=jn.add(dn)._unit(),Nr=Ge*Math.min(4,1/(jn.x*dr.x+jn.y*dr.y));Wn+=Nr*dr.x,xn+=Nr*dr.y,jn=dn}Xo(this.layoutVertexArray,Wn,xn,0,0,1,1,0),It.vertexLength++,Tt.push(kn.x,kn.y),q&&Dh(this.layoutVertexExtArray,k.projectTilePoint(Wn,xn,p),k.upVector(p,Wn,xn))}}const en=mg(Tt,ln);for(let wn=0;wn<en.length;wn+=3)this.indexArray.emplaceBack(lt+en[wn],lt+en[wn+2],lt+en[wn+1]),It.primitiveLength++}for(const Tt of at){K&&Tt.length&&K.startRing(Tt[0]);let ln,en,wn,jn=Tt.length>4&&E3(Tt[Tt.length-2],Tt[0],Tt[1]),dn=Ge?M8(Tt[Tt.length-2],Tt[0],Tt[1],Ge):0;en=Tt[1].sub(Tt[0])._perp()._unit();let Pn=!0;for(let kn=1,On=0;kn<Tt.length;kn++){let Wn=Tt[kn-1],xn=Tt[kn];const dr=Tt[kn===Tt.length-1?1:kn+1];if(K&&te&&K.currentPolyCount.top++,S3(xn,Wn,xt)){Ge&&(en=dr.sub(xn)._perp()._unit(),Pn=!Pn);continue}K&&K.append(xn,Wn);const Nr=xn.sub(Wn)._perp(),mr=Nr.x/(Math.abs(Nr.x)+Math.abs(Nr.y)),$i=Nr.y>0?1:0,Xn=Wn.dist(xn);if(On+Xn>32768&&(On=0),Ge){wn=dr.sub(xn)._perp()._unit();let Wi=w3(Wn,xn,dr,b3(en,wn),Ge);isNaN(Wi)&&(Wi=0);const bi=xn.sub(Wn)._unit();Wn=Wn.add(bi.mult(dn))._round(),xn=xn.add(bi.mult(-Wi))._round(),dn=Wi,en=wn}const ri=It.vertexLength,Gi=Tt.length>4&&E3(Wn,xn,dr);let Ko=A3(On,jn,Pn);if(Xo(this.layoutVertexArray,Wn.x,Wn.y,mr,$i,0,0,Ko),Xo(this.layoutVertexArray,Wn.x,Wn.y,mr,$i,0,1,Ko),On+=Xn,Ko=A3(On,Gi,!Pn),jn=Gi,Xo(this.layoutVertexArray,xn.x,xn.y,mr,$i,0,0,Ko),Xo(this.layoutVertexArray,xn.x,xn.y,mr,$i,0,1,Ko),It.vertexLength+=4,this.indexArray.emplaceBack(ri+0,ri+1,ri+2),this.indexArray.emplaceBack(ri+1,ri+3,ri+2),It.primitiveLength+=2,Ge){const Wi=lt+(kn===1?Tt.length-2:kn-2),bi=kn===1?lt:Wi+1;if(this.indexArray.emplaceBack(ri+1,Wi,ri+3),this.indexArray.emplaceBack(Wi,bi,ri+3),It.primitiveLength+=2,ln===void 0&&(ln=ri),!S3(dr,Tt[kn],xt)){const da=kn===Tt.length-1?ln:It.vertexLength;this.indexArray.emplaceBack(ri+2,ri+3,da),this.indexArray.emplaceBack(ri+3,da+1,da),this.indexArray.emplaceBack(ri+3,bi,da+1),It.primitiveLength+=3}Pn=!Pn}if(q){const Wi=this.layoutVertexExtArray,bi=k.projectTilePoint(Wn.x,Wn.y,p),da=k.projectTilePoint(xn.x,xn.y,p),Zi=k.upVector(p,Wn.x,Wn.y),Yi=k.upVector(p,xn.x,xn.y);Dh(Wi,bi,Zi),Dh(Wi,bi,Zi),Dh(Wi,da,Yi),Dh(Wi,da,Yi)}}te&&(lt+=Tt.length-1)}}if(K&&K.polyCount.length>0){if(K.borders){K.vertexArrayOffset=this.centroidVertexArray.length;const at=K.borders,xt=this.featuresOnBorder.push(K)-1;for(let lt=0;lt<4;lt++)at[lt][0]!==Number.MAX_VALUE&&this.borders[lt].push(xt)}this.encodeCentroid(K.borders?void 0:K.centroid(),K)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,x,b,p)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort(((l,h)=>this.featuresOnBorder[l].borders[r][0]-this.featuresOnBorder[h].borders[r][0]))}encodeCentroid(r,l,h=!0){let p,x;if(r)if(r.y!==0){const A=l.span()._mult(this.tileToMeter);p=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(A.x/10)),x=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(A.y/10))}else p=Math.ceil(7*(r.x+450)),x=0;else p=0,x=+h;let b=h?this.centroidVertexArray.length:l.vertexArrayOffset;for(const A of l.polyCount){h&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*A.edges+A.top);for(let P=0;P<A.top;P++)this.centroidVertexArray.emplace(b++,p,x);for(let P=0;P<2*A.edges;P++)this.centroidVertexArray.emplace(b++,0,x),this.centroidVertexArray.emplace(b++,p,x)}}}function b3(s,r){const l=s.add(r)._unit();return s.x*l.x+s.y*l.y}function M8(s,r,l,h){const p=r.sub(s)._perp()._unit(),x=l.sub(r)._perp()._unit();return w3(s,r,l,b3(p,x),h)}function w3(s,r,l,h,p){const x=Math.sqrt(1-h*h);return Math.min(s.dist(r)/3,r.dist(l)/3,p*x/h)}function S3(s,r,l){return s.x<l[0].x&&r.x<l[0].x||s.x>l[1].x&&r.x>l[1].x||s.y<l[0].y&&r.y<l[0].y||s.y>l[1].y&&r.y>l[1].y}function E3(s,r,l){if(s.x<0||s.x>=_t||r.x<0||r.x>=_t||l.x<0||l.x>=_t)return!1;const h=l.sub(r),p=h.perp(),x=s.sub(r);return(h.x*x.x+h.y*x.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(x.x*x.x+x.y*x.y))>-.866&&p.x*x.x+p.y*x.y<0}function A3(s,r,l){const h=r?2|s:-3&s;return l?1|h:-2&h}function T3(){const s=Math.PI/32,r=Math.tan(s),l=rf;return l*Math.sqrt(1+2*r*r)-l}function I3(s,r,l){const h=1<<l.z,p=zc(l.x/h),x=zc((l.x+1)/h),b=Ho(l.y/h),A=Ho((l.y+1)/h);return(function(P,k,q,K,te=0,ue){const pe=[];if(!P.length||!q||!K)return pe;const Se=(Tt,ln)=>{for(const en of Tt)pe.push({polygon:en,bounds:ln})},Ge=Math.ceil(Math.log2(q)),at=Math.ceil(Math.log2(K)),xt=Ge-at,lt=[];for(let Tt=0;Tt<Math.abs(xt);Tt++)lt.push(xt>0?0:1);for(let Tt=0;Tt<Math.min(Ge,at);Tt++)lt.push(0),lt.push(1);let yt=P;if(yt=ki(yt,k[0].y-te,k[1].y+te,1),yt=ki(yt,k[0].x-te,k[1].x+te,0),!yt.length)return pe;const It=[];for(lt.length?It.push({polygons:yt,bounds:k,depth:0}):Se(yt,k);It.length;){const Tt=It.pop(),ln=Tt.depth,en=lt[ln],wn=Tt.bounds[0],jn=Tt.bounds[1],dn=en===0?wn.x:wn.y,Pn=en===0?jn.x:jn.y,kn=ue?ue(en,dn,Pn):.5*(dn+Pn),On=ki(Tt.polygons,dn-te,kn+te,en),Wn=ki(Tt.polygons,kn-te,Pn+te,en);if(On.length){const xn=[wn,new $(en===0?kn:jn.x,en===1?kn:jn.y)];lt.length>ln+1?It.push({polygons:On,bounds:xn,depth:ln+1}):Se(On,xn)}if(Wn.length){const xn=[new $(en===0?kn:wn.x,en===1?kn:wn.y),jn];lt.length>ln+1?It.push({polygons:Wn,bounds:xn,depth:ln+1}):Se(Wn,xn)}}return pe})(s,r,Math.ceil((x-p)/11.25),Math.ceil((b-A)/11.25),1,((P,k,q)=>{if(P===0)return .5*(k+q);{const K=Ho((l.y+k/_t)/h);return(Ca(.5*(Ho((l.y+q/_t)/h)+K))*h-l.y)*_t}}))}sr(G0,"FillExtrusionBucket",{omit:["layers","features"]}),sr(P_,"PartMetadata");const R8=new st({"fill-extrusion-edge-radius":new ve(pn["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var N8={paint:new st({"fill-extrusion-opacity":new ve(pn["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ue(pn["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ve(pn["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ve(pn["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ue(pn["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ue(pn["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ue(pn["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ve(pn["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ve(pn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ve(pn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new ve(pn["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:R8};function C3(s,r,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[s*h-2*Math.PI*6378137/2,r*h-2*Math.PI*6378137/2]}class k_{constructor(r,l,h){this.z=r,this.x=l,this.y=h,this.key=W0(0,r,r,l,h)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,l){const h=(function(x,b,A){var P=C3(256*x,256*(b=Math.pow(2,A)-b-1),A),k=C3(256*(x+1),256*(b+1),A);return P[0]+","+P[1]+","+k[0]+","+k[1]})(this.x,this.y,this.z),p=(function(x,b,A){let P,k="";for(let q=x;q>0;q--)P=1<<q-1,k+=(b&P?1:0)+(A&P?2:0);return k})(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class L3{constructor(r,l){this.wrap=r,this.canonical=l,this.key=W0(r,l.z,l.z,l.x,l.y)}}class oh{constructor(r,l,h,p,x){this.overscaledZ=r,this.wrap=l,this.canonical=new k_(h,+p,+x),this.key=l===0&&r===h?this.canonical.key:W0(l,r,h,p,x)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const l=this.canonical.z-r;return r>this.canonical.z?new oh(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new oh(r,this.wrap,r,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(r,l=!0){if(this.overscaledZ===r&&l)return this.key;if(r>this.canonical.z)return W0(this.wrap*+l,r,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-r;return W0(this.wrap*+l,r,r,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const l=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>l&&r.canonical.y===this.canonical.y>>l}children(r){if(this.overscaledZ>=r)return[new oh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,p=2*this.canonical.y;return[new oh(l,this.wrap,l,h,p),new oh(l,this.wrap,l,h+1,p),new oh(l,this.wrap,l,h,p+1),new oh(l,this.wrap,l,h+1,p+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new oh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new oh(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new L3(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function W0(s,r,l,h,p){const x=1<<Math.min(l,22);let b=x*(p%x)+h%x;return s&&l<22&&(b+=x*x*((s<0?-2*s-1:2*s)%(1<<2*(22-l)))),16*(32*b+l)+(r-l)}sr(k_,"CanonicalTileID"),sr(oh,"OverscaledTileID",{omit:["projMatrix"]});class yg extends ${constructor(r,l,h){super(r,l),this.z=h}}function H0(s,r){return s.x*r.x+s.y*r.y}function P3(s,r){if(s.length===1){let l=0;const h=r[l++];let p;for(;!p||h.equals(p);)if(p=r[l++],!p)return 1/0;for(;l<r.length;l++){const x=r[l],b=s[0],A=p.sub(h),P=x.sub(h),k=b.sub(h),q=H0(A,A),K=H0(A,P),te=H0(P,P),ue=H0(k,A),pe=H0(k,P),Se=q*te-K*K,Ge=(te*ue-K*pe)/Se,at=(q*pe-K*ue)/Se,xt=h.z*(1-Ge-at)+p.z*Ge+x.z*at;if(isFinite(xt))return xt}return 1/0}{let l=1/0;for(const h of r)l=Math.min(l,h.z);return l}}function k3(s,r,l,h,p,x,b,A){const P=b*p.getElevationAt(s,r,!0,!0),k=x[0]!==0,q=k?x[1]===0?b*(x[0]/7-450):b*(function(K,te,ue){const pe=Math.floor(te[0]/8),Se=Math.floor(te[1]/8),Ge=10*(te[0]-8*pe),at=10*(te[1]-8*Se),xt=K.getElevationAt(pe,Se,!0,!0),lt=K.getMeterToDEM(ue),yt=Math.floor(.5*(Ge*lt-1)),It=Math.floor(.5*(at*lt-1)),Tt=K.tileCoordToPixel(pe,Se),ln=2*yt+1,en=2*It+1,wn=(function(Wn,xn,dr,Nr,mr){return[Wn.getElevationAtPixel(xn,dr,!0),Wn.getElevationAtPixel(xn+mr,dr,!0),Wn.getElevationAtPixel(xn,dr+mr,!0),Wn.getElevationAtPixel(xn+Nr,dr+mr,!0)]})(K,Tt.x-yt,Tt.y-It,ln,en),jn=Math.abs(wn[0]-wn[1]),dn=Math.abs(wn[2]-wn[3]),Pn=Math.abs(wn[0]-wn[2])+Math.abs(wn[1]-wn[3]),kn=Math.min(.25,.5*lt*(jn+dn)/ln),On=Math.min(.25,.5*lt*Pn/en);return xt+Math.max(kn*Ge,On*at)})(p,x,A):P;return{base:P+(l===0)?-1:l,top:k?Math.max(q+h,P+l+2):P+h}}const D8=kt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:F8}=D8,O8=kt([{name:"a_packed",components:4,type:"Float32"}]),{members:B8}=O8,z8=Pi.types,j8=Math.cos(Math.PI/180*37.5);class M_{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((l=>{this.gradients[l.id]={}})),this.layoutVertexArray=new $t,this.layoutVertexArray2=new In,this.indexArray=new _r,this.programConfigurations=new Nu(r.layers,r.zoom),this.segments=new Lt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(r,l,h,p){this.hasPattern=d("line",this.layers,l);const x=this.layers[0].layout.get("line-sort-key"),b=[];for(const{feature:q,id:K,index:te,sourceLayerIndex:ue}of r){const pe=this.layers[0]._featureFilter.needGeometry,Se=md(q,pe);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),Se,h))continue;const Ge=x?x.evaluate(Se,{},h):void 0,at={id:K,properties:q.properties,type:q.type,sourceLayerIndex:ue,index:te,geometry:pe?Se.geometry:vu(q,h,p),patterns:{},sortKey:Ge};b.push(at)}x&&b.sort(((q,K)=>q.sortKey-K.sortKey));const{lineAtlas:A,featureIndex:P}=l,k=this.addConstantDashes(A);for(const q of b){const{geometry:K,index:te,sourceLayerIndex:ue}=q;if(k&&this.addFeatureDashes(q,A),this.hasPattern){const pe=g("line",this.layers,q,this.zoom,l);this.patternFeatures.push(pe)}else this.addFeature(q,K,te,h,A.positions,l.availableImages);P.insert(r[te].feature,K,te,ue,this.index)}}addConstantDashes(r){let l=!1;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,x=h.layout.get("line-cap").value;if(p.kind!=="constant"||x.kind!=="constant")l=!0;else{const b=x.value,A=p.value;if(!A)continue;r.addDash(A,b)}}return l}addFeatureDashes(r,l){const h=this.zoom;for(const p of this.layers){const x=p.paint.get("line-dasharray").value,b=p.layout.get("line-cap").value;if(x.kind==="constant"&&b.kind==="constant")continue;let A,P;if(x.kind==="constant"){if(A=x.value,!A)continue}else A=x.evaluate({zoom:h},r);P=b.kind==="constant"?b.value:b.evaluate({zoom:h},r),l.addDash(A,P),r.patterns[p.id]=l.getKey(A,P)}}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}addFeatures(r,l,h,p,x){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,B8)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,F8),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,l,h,p,x,b){const A=this.layers[0].layout,P=A.get("line-join").evaluate(r,{}),k=A.get("line-cap").evaluate(r,{}),q=A.get("line-miter-limit"),K=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const te of l)this.addLine(te,r,P,k,q,K);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,x,b,p)}addLine(r,l,h,p,x,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let at=0;at<r.length-1;at++)this.totalDistance+=r[at].dist(r[at+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=z8[l.type]==="Polygon";let P=r.length;for(;P>=2&&r[P-1].equals(r[P-2]);)P--;let k=0;for(;k<P-1&&r[k].equals(r[k+1]);)k++;if(P<(A?3:2))return;h==="bevel"&&(x=1.05);const q=this.overscaling<=16?15*_t/(512*this.overscaling):0,K=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let te,ue,pe,Se,Ge;this.e1=this.e2=-1,A&&(te=r[P-2],Ge=r[k].sub(te)._unit()._perp());for(let at=k;at<P;at++){if(pe=at===P-1?A?r[k+1]:void 0:r[at+1],pe&&r[at].equals(pe))continue;Ge&&(Se=Ge),te&&(ue=te),te=r[at],Ge=pe?pe.sub(te)._unit()._perp():Se,Se=Se||Ge;let xt=Se.add(Ge);xt.x===0&&xt.y===0||xt._unit();const lt=Se.x*Ge.x+Se.y*Ge.y,yt=xt.x*Ge.x+xt.y*Ge.y,It=yt!==0?1/yt:1/0,Tt=2*Math.sqrt(2-2*yt),ln=yt<j8&&ue&&pe,en=Se.x*Ge.y-Se.y*Ge.x>0;if(ln&&at>k){const dn=te.dist(ue);if(dn>2*q){const Pn=te.sub(te.sub(ue)._mult(q/dn)._round());this.updateDistance(ue,Pn),this.addCurrentVertex(Pn,Se,0,0,K),ue=Pn}}const wn=ue&&pe;let jn=wn?h:A?"butt":p;if(wn&&jn==="round"&&(It<b?jn="miter":It<=2&&(jn="fakeround")),jn==="miter"&&It>x&&(jn="bevel"),jn==="bevel"&&(It>2&&(jn="flipbevel"),It<x&&(jn="miter")),ue&&this.updateDistance(ue,te),jn==="miter")xt._mult(It),this.addCurrentVertex(te,xt,0,0,K);else if(jn==="flipbevel"){if(It>100)xt=Ge.mult(-1);else{const dn=It*Se.add(Ge).mag()/Se.sub(Ge).mag();xt._perp()._mult(dn*(en?-1:1))}this.addCurrentVertex(te,xt,0,0,K),this.addCurrentVertex(te,xt.mult(-1),0,0,K)}else if(jn==="bevel"||jn==="fakeround"){const dn=-Math.sqrt(It*It-1),Pn=en?dn:0,kn=en?0:dn;if(ue&&this.addCurrentVertex(te,Se,Pn,kn,K),jn==="fakeround"){const On=Math.round(180*Tt/Math.PI/20);for(let Wn=1;Wn<On;Wn++){let xn=Wn/On;if(xn!==.5){const Nr=xn-.5;xn+=xn*Nr*(xn-1)*((1.0904+lt*(lt*(3.55645-1.43519*lt)-3.2452))*Nr*Nr+(.848013+lt*(.215638*lt-1.06021)))}const dr=Ge.sub(Se)._mult(xn)._add(Se)._unit()._mult(en?-1:1);this.addHalfVertex(te,dr.x,dr.y,!1,en,0,K)}}pe&&this.addCurrentVertex(te,Ge,-Pn,-kn,K)}else if(jn==="butt")this.addCurrentVertex(te,xt,0,0,K);else if(jn==="square"){const dn=ue?1:-1;ue||this.addCurrentVertex(te,xt,dn,dn,K),this.addCurrentVertex(te,xt,0,0,K),ue&&this.addCurrentVertex(te,xt,dn,dn,K)}else jn==="round"&&(ue&&(this.addCurrentVertex(te,Se,0,0,K),this.addCurrentVertex(te,Se,1,1,K,!0)),pe&&(this.addCurrentVertex(te,Ge,-1,-1,K,!0),this.addCurrentVertex(te,Ge,0,0,K)));if(ln&&at<P-1){const dn=te.dist(pe);if(dn>2*q){const Pn=te.add(pe.sub(te)._mult(q/dn)._round());this.updateDistance(te,Pn),this.addCurrentVertex(Pn,Ge,0,0,K),te=Pn}}}}addCurrentVertex(r,l,h,p,x,b=!1){const A=l.y*p-l.x,P=-l.y-l.x*p;this.addHalfVertex(r,l.x+l.y*h,l.y-l.x*h,b,!1,h,x),this.addHalfVertex(r,A,P,b,!0,-p,x)}addHalfVertex({x:r,y:l},h,p,x,b,A,P){this.layoutVertexArray.emplaceBack((r<<1)+(x?1:0),(l<<1)+(b?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(A===0?0:A<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const k=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),P.primitiveLength++),b?this.e2=k:this.e1=k}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,l){this.distance+=r.dist(l),this.updateScaledDistance()}}sr(M_,"LineBucket",{omit:["layers","patternFeatures"]});const U8=new st({"line-cap":new Ue(pn.layout_line["line-cap"]),"line-join":new Ue(pn.layout_line["line-join"]),"line-miter-limit":new ve(pn.layout_line["line-miter-limit"]),"line-round-limit":new ve(pn.layout_line["line-round-limit"]),"line-sort-key":new Ue(pn.layout_line["line-sort-key"])});var M3={paint:new st({"line-opacity":new Ue(pn.paint_line["line-opacity"]),"line-color":new Ue(pn.paint_line["line-color"]),"line-translate":new ve(pn.paint_line["line-translate"]),"line-translate-anchor":new ve(pn.paint_line["line-translate-anchor"]),"line-width":new Ue(pn.paint_line["line-width"]),"line-gap-width":new Ue(pn.paint_line["line-gap-width"]),"line-offset":new Ue(pn.paint_line["line-offset"]),"line-blur":new Ue(pn.paint_line["line-blur"]),"line-dasharray":new Ue(pn.paint_line["line-dasharray"]),"line-pattern":new Ue(pn.paint_line["line-pattern"]),"line-gradient":new rt(pn.paint_line["line-gradient"]),"line-trim-offset":new ve(pn.paint_line["line-trim-offset"])}),layout:U8};const R3=new class extends Ue{possiblyEvaluate(s,r){return r=new G(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(s,r)}evaluate(s,r,l,h){return r=Fe({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(s,r,l,h)}}(M3.paint.properties["line-width"].specification);function N3(s,r){return r>0?r+2*s:s}R3.useIntegerZoom=!0;const V8=kt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),q8=kt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),$8=kt([{name:"a_projected_pos",components:4,type:"Float32"}],4);kt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const G8=kt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),W8=kt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);kt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const D3=kt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),H8=kt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);kt([{name:"triangle",components:3,type:"Uint16"}]),kt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),kt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),kt([{type:"Float32",name:"offsetX"}]),kt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var iu=24;const Dd=128;function mx(s,r){const{expression:l}=r;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new G(s+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:p}=l;let x=0;for(;x<h.length&&h[x]<=s;)x++;x=Math.max(0,x-1);let b=x;for(;b<h.length&&h[b]<s+1;)b++;b=Math.min(h.length-1,b);const A=h[x],P=h[b];return l.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:P,interpolationType:p}:{kind:"camera",minZoom:A,maxZoom:P,minSize:l.evaluate(new G(A)),maxSize:l.evaluate(new G(P)),interpolationType:p}}}function R_(s,{uSize:r,uSizeT:l},{lowerSize:h,upperSize:p}){return s.kind==="source"?h/Dd:s.kind==="composite"?$e(h/Dd,p/Dd,l):r}function _g(s,r){let l=0,h=0;if(s.kind==="constant")h=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:p,minZoom:x,maxZoom:b}=s,A=p?De(el.interpolationFactor(p,r,x,b),0,1):0;s.kind==="camera"?h=$e(s.minSize,s.maxSize,A):l=A}return{uSizeT:l,uSize:h}}var X8=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Dd,evaluateSizeForFeature:R_,evaluateSizeForZoom:_g,getSizeData:mx});function K8(s,r,l){return s.sections.forEach((h=>{h.text=(function(p,x,b){const A=x.layout.get("text-transform").evaluate(b,{});return A==="uppercase"?p=p.toLocaleUpperCase():A==="lowercase"&&(p=p.toLocaleLowerCase()),B.applyArabicShaping&&(p=B.applyArabicShaping(p)),p})(h.text,r,l)})),s}const X0={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Z8(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function Y8(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}var F3=na,O3=function(s,r,l,h,p){var x,b,A=8*p-h-1,P=(1<<A)-1,k=P>>1,q=-7,K=p-1,te=-1,ue=s[r+K];for(K+=te,x=ue&(1<<-q)-1,ue>>=-q,q+=A;q>0;x=256*x+s[r+K],K+=te,q-=8);for(b=x&(1<<-q)-1,x>>=-q,q+=h;q>0;b=256*b+s[r+K],K+=te,q-=8);if(x===0)x=1-k;else{if(x===P)return b?NaN:1/0*(ue?-1:1);b+=Math.pow(2,h),x-=k}return(ue?-1:1)*b*Math.pow(2,x-h)},B3=function(s,r,l,h,p,x){var b,A,P,k=8*x-p-1,q=(1<<k)-1,K=q>>1,te=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,ue=0,pe=1,Se=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(A=isNaN(r)?1:0,b=q):(b=Math.floor(Math.log(r)/Math.LN2),r*(P=Math.pow(2,-b))<1&&(b--,P*=2),(r+=b+K>=1?te/P:te*Math.pow(2,1-K))*P>=2&&(b++,P/=2),b+K>=q?(A=0,b=q):b+K>=1?(A=(r*P-1)*Math.pow(2,p),b+=K):(A=r*Math.pow(2,K-1)*Math.pow(2,p),b=0));p>=8;s[l+ue]=255&A,ue+=pe,A/=256,p-=8);for(b=b<<p|A,k+=p;k>0;s[l+ue]=255&b,ue+=pe,b/=256,k-=8);s[l+ue-pe]|=128*Se};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function na(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}na.Varint=0,na.Fixed64=1,na.Bytes=2,na.Fixed32=5;var gx=4294967296,z3=1/gx,j3=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Xf(s){return s.type===na.Bytes?s.readVarint()+s.pos:s.pos+1}function vg(s,r,l){return l?4294967296*r+(s>>>0):4294967296*(r>>>0)+(s>>>0)}function U3(s,r,l){var h=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));l.realloc(h);for(var p=l.pos-1;p>=s;p--)l.buf[p+h]=l.buf[p]}function J8(s,r){for(var l=0;l<s.length;l++)r.writeVarint(s[l])}function Q8(s,r){for(var l=0;l<s.length;l++)r.writeSVarint(s[l])}function eC(s,r){for(var l=0;l<s.length;l++)r.writeFloat(s[l])}function tC(s,r){for(var l=0;l<s.length;l++)r.writeDouble(s[l])}function nC(s,r){for(var l=0;l<s.length;l++)r.writeBoolean(s[l])}function rC(s,r){for(var l=0;l<s.length;l++)r.writeFixed32(s[l])}function iC(s,r){for(var l=0;l<s.length;l++)r.writeSFixed32(s[l])}function oC(s,r){for(var l=0;l<s.length;l++)r.writeFixed64(s[l])}function sC(s,r){for(var l=0;l<s.length;l++)r.writeSFixed64(s[l])}function N_(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+16777216*s[r+3]}function xg(s,r,l){s[l]=r,s[l+1]=r>>>8,s[l+2]=r>>>16,s[l+3]=r>>>24}function V3(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+(s[r+3]<<24)}na.prototype={destroy:function(){this.buf=null},readFields:function(s,r,l){for(l=l||this.length;this.pos<l;){var h=this.readVarint(),p=h>>3,x=this.pos;this.type=7&h,s(p,r,this),this.pos===x&&this.skip(h)}return r},readMessage:function(s,r){return this.readFields(s,r,this.readVarint()+this.pos)},readFixed32:function(){var s=N_(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=V3(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=N_(this.buf,this.pos)+N_(this.buf,this.pos+4)*gx;return this.pos+=8,s},readSFixed64:function(){var s=N_(this.buf,this.pos)+V3(this.buf,this.pos+4)*gx;return this.pos+=8,s},readFloat:function(){var s=O3(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=O3(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var r,l,h=this.buf;return r=127&(l=h[this.pos++]),l<128?r:(r|=(127&(l=h[this.pos++]))<<7,l<128?r:(r|=(127&(l=h[this.pos++]))<<14,l<128?r:(r|=(127&(l=h[this.pos++]))<<21,l<128?r:(function(p,x,b){var A,P,k=b.buf;if(A=(112&(P=k[b.pos++]))>>4,P<128||(A|=(127&(P=k[b.pos++]))<<3,P<128)||(A|=(127&(P=k[b.pos++]))<<10,P<128)||(A|=(127&(P=k[b.pos++]))<<17,P<128)||(A|=(127&(P=k[b.pos++]))<<24,P<128)||(A|=(1&(P=k[b.pos++]))<<31,P<128))return vg(p,A,x);throw new Error("Expected varint not more than 10 bytes")})(r|=(15&(l=h[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,r=this.pos;return this.pos=s,s-r>=12&&j3?(function(l,h,p){return j3.decode(l.subarray(h,p))})(this.buf,r,s):(function(l,h,p){for(var x="",b=h;b<p;){var A,P,k,q=l[b],K=null,te=q>239?4:q>223?3:q>191?2:1;if(b+te>p)break;te===1?q<128&&(K=q):te===2?(192&(A=l[b+1]))==128&&(K=(31&q)<<6|63&A)<=127&&(K=null):te===3?(P=l[b+2],(192&(A=l[b+1]))==128&&(192&P)==128&&((K=(15&q)<<12|(63&A)<<6|63&P)<=2047||K>=55296&&K<=57343)&&(K=null)):te===4&&(P=l[b+2],k=l[b+3],(192&(A=l[b+1]))==128&&(192&P)==128&&(192&k)==128&&((K=(15&q)<<18|(63&A)<<12|(63&P)<<6|63&k)<=65535||K>=1114112)&&(K=null)),K===null?(K=65533,te=1):K>65535&&(K-=65536,x+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),x+=String.fromCharCode(K),b+=te}return x})(this.buf,r,s)},readBytes:function(){var s=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,s);return this.pos=s,r},readPackedVarint:function(s,r){if(this.type!==na.Bytes)return s.push(this.readVarint(r));var l=Xf(this);for(s=s||[];this.pos<l;)s.push(this.readVarint(r));return s},readPackedSVarint:function(s){if(this.type!==na.Bytes)return s.push(this.readSVarint());var r=Xf(this);for(s=s||[];this.pos<r;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==na.Bytes)return s.push(this.readBoolean());var r=Xf(this);for(s=s||[];this.pos<r;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==na.Bytes)return s.push(this.readFloat());var r=Xf(this);for(s=s||[];this.pos<r;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==na.Bytes)return s.push(this.readDouble());var r=Xf(this);for(s=s||[];this.pos<r;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==na.Bytes)return s.push(this.readFixed32());var r=Xf(this);for(s=s||[];this.pos<r;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==na.Bytes)return s.push(this.readSFixed32());var r=Xf(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==na.Bytes)return s.push(this.readFixed64());var r=Xf(this);for(s=s||[];this.pos<r;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==na.Bytes)return s.push(this.readSFixed64());var r=Xf(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed64());return s},skip:function(s){var r=7&s;if(r===na.Varint)for(;this.buf[this.pos++]>127;);else if(r===na.Bytes)this.pos=this.readVarint()+this.pos;else if(r===na.Fixed32)this.pos+=4;else{if(r!==na.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(s,r){this.writeVarint(s<<3|r)},realloc:function(s){for(var r=this.length||16;r<this.pos+s;)r*=2;if(r!==this.length){var l=new Uint8Array(r);l.set(this.buf),this.buf=l,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),xg(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),xg(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),xg(this.buf,-1&s,this.pos),xg(this.buf,Math.floor(s*z3),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),xg(this.buf,-1&s,this.pos),xg(this.buf,Math.floor(s*z3),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?(function(r,l){var h,p;if(r>=0?(h=r%4294967296|0,p=r/4294967296|0):(p=~(-r/4294967296),4294967295^(h=~(-r%4294967296))?h=h+1|0:(h=0,p=p+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),(function(x,b,A){A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,A.buf[A.pos]=127&(x>>>=7)})(h,0,l),(function(x,b){var A=(7&x)<<4;b.buf[b.pos++]|=A|((x>>>=3)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x)))))})(p,l)})(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var r=this.pos;this.pos=(function(h,p,x){for(var b,A,P=0;P<p.length;P++){if((b=p.charCodeAt(P))>55295&&b<57344){if(!A){b>56319||P+1===p.length?(h[x++]=239,h[x++]=191,h[x++]=189):A=b;continue}if(b<56320){h[x++]=239,h[x++]=191,h[x++]=189,A=b;continue}b=A-55296<<10|b-56320|65536,A=null}else A&&(h[x++]=239,h[x++]=191,h[x++]=189,A=null);b<128?h[x++]=b:(b<2048?h[x++]=b>>6|192:(b<65536?h[x++]=b>>12|224:(h[x++]=b>>18|240,h[x++]=b>>12&63|128),h[x++]=b>>6&63|128),h[x++]=63&b|128)}return x})(this.buf,s,this.pos);var l=this.pos-r;l>=128&&U3(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeFloat:function(s){this.realloc(4),B3(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),B3(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var r=s.length;this.writeVarint(r),this.realloc(r);for(var l=0;l<r;l++)this.buf[this.pos++]=s[l]},writeRawMessage:function(s,r){this.pos++;var l=this.pos;s(r,this);var h=this.pos-l;h>=128&&U3(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeMessage:function(s,r,l){this.writeTag(s,na.Bytes),this.writeRawMessage(r,l)},writePackedVarint:function(s,r){r.length&&this.writeMessage(s,J8,r)},writePackedSVarint:function(s,r){r.length&&this.writeMessage(s,Q8,r)},writePackedBoolean:function(s,r){r.length&&this.writeMessage(s,nC,r)},writePackedFloat:function(s,r){r.length&&this.writeMessage(s,eC,r)},writePackedDouble:function(s,r){r.length&&this.writeMessage(s,tC,r)},writePackedFixed32:function(s,r){r.length&&this.writeMessage(s,rC,r)},writePackedSFixed32:function(s,r){r.length&&this.writeMessage(s,iC,r)},writePackedFixed64:function(s,r){r.length&&this.writeMessage(s,oC,r)},writePackedSFixed64:function(s,r){r.length&&this.writeMessage(s,sC,r)},writeBytesField:function(s,r){this.writeTag(s,na.Bytes),this.writeBytes(r)},writeFixed32Field:function(s,r){this.writeTag(s,na.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(s,r){this.writeTag(s,na.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(s,r){this.writeTag(s,na.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(s,r){this.writeTag(s,na.Fixed64),this.writeSFixed64(r)},writeVarintField:function(s,r){this.writeTag(s,na.Varint),this.writeVarint(r)},writeSVarintField:function(s,r){this.writeTag(s,na.Varint),this.writeSVarint(r)},writeStringField:function(s,r){this.writeTag(s,na.Bytes),this.writeString(r)},writeFloatField:function(s,r){this.writeTag(s,na.Fixed32),this.writeFloat(r)},writeDoubleField:function(s,r){this.writeTag(s,na.Fixed64),this.writeDouble(r)},writeBooleanField:function(s,r){this.writeVarintField(s,!!r)}};var D_=he(F3);const yx=3;function aC(s,r,l){r.glyphs=[],s===1&&l.readMessage(lC,r)}function lC(s,r,l){if(s===3){const{id:h,bitmap:p,width:x,height:b,left:A,top:P,advance:k}=l.readMessage(cC,{});r.glyphs.push({id:h,bitmap:new ih({width:x+2*yx,height:b+2*yx},p),metrics:{width:x,height:b,left:A,top:P,advance:k}})}else s===4?r.ascender=l.readSVarint():s===5&&(r.descender=l.readSVarint())}function cC(s,r,l){s===1?r.id=l.readVarint():s===2?r.bitmap=l.readBytes():s===3?r.width=l.readVarint():s===4?r.height=l.readVarint():s===5?r.left=l.readSVarint():s===6?r.top=l.readSVarint():s===7&&(r.advance=l.readVarint())}const q3=yx;function _x(s){let r=0,l=0;for(const b of s)r+=b.w*b.h,l=Math.max(l,b.w);s.sort(((b,A)=>A.h-b.h));const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),l),h:1/0}];let p=0,x=0;for(const b of s)for(let A=h.length-1;A>=0;A--){const P=h[A];if(!(b.w>P.w||b.h>P.h)){if(b.x=P.x,b.y=P.y,x=Math.max(x,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===P.w&&b.h===P.h){const k=h.pop();A<h.length&&(h[A]=k)}else b.h===P.h?(P.x+=b.w,P.w-=b.w):b.w===P.w?(P.y+=b.h,P.h-=b.h):(h.push({x:P.x+b.w,y:P.y,w:P.w-b.w,h:b.h}),P.y+=b.h,P.h-=b.h);break}}return{w:p,h:x,fill:r/(p*x)||0}}const Eh=1;class vx{constructor(r,{pixelRatio:l,version:h,stretchX:p,stretchY:x,content:b}){this.paddedRect=r,this.pixelRatio=l,this.stretchX=p,this.stretchY=x,this.content=b,this.version=h}get tl(){return[this.paddedRect.x+Eh,this.paddedRect.y+Eh]}get br(){return[this.paddedRect.x+this.paddedRect.w-Eh,this.paddedRect.y+this.paddedRect.h-Eh]}get displaySize(){return[(this.paddedRect.w-2*Eh)/this.pixelRatio,(this.paddedRect.h-2*Eh)/this.pixelRatio]}}class $3{constructor(r,l){const h={},p={};this.haveRenderCallbacks=[];const x=[];this.addImages(r,h,x),this.addImages(l,p,x);const{w:b,h:A}=_x(x),P=new zu({width:b||1,height:A||1});for(const k in r){const q=r[k],K=h[k].paddedRect;zu.copy(q.data,P,{x:0,y:0},{x:K.x+Eh,y:K.y+Eh},q.data)}for(const k in l){const q=l[k],K=p[k].paddedRect,te=K.x+Eh,ue=K.y+Eh,pe=q.data.width,Se=q.data.height;zu.copy(q.data,P,{x:0,y:0},{x:te,y:ue},q.data),zu.copy(q.data,P,{x:0,y:Se-1},{x:te,y:ue-1},{width:pe,height:1}),zu.copy(q.data,P,{x:0,y:0},{x:te,y:ue+Se},{width:pe,height:1}),zu.copy(q.data,P,{x:pe-1,y:0},{x:te-1,y:ue},{width:1,height:Se}),zu.copy(q.data,P,{x:0,y:0},{x:te+pe,y:ue},{width:1,height:Se})}this.image=P,this.iconPositions=h,this.patternPositions=p}addImages(r,l,h){for(const p in r){const x=r[p],b={x:0,y:0,w:x.data.width+2*Eh,h:x.data.height+2*Eh};h.push(b),l[p]=new vx(b,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(r,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((h=>r.hasImage(h))),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in r.updatedImages)this.patchUpdatedImage(this.iconPositions[h],r.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],r.getImage(h),l)}patchUpdatedImage(r,l,h){if(!r||!l||r.version===l.version)return;r.version=l.version;const[p,x]=r.tl;h.update(l.data,void 0,{x:p,y:x})}}sr(vx,"ImagePosition"),sr($3,"ImageAtlas");const Yh={horizontal:1,vertical:2,horizontalOnly:3},G3=-17;class K0{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,l){const h=new K0;return h.scale=r||1,h.fontStack=l,h}static forImage(r){const l=new K0;return l.imageName=r,l}}class bg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,l){const h=new bg;for(let p=0;p<r.sections.length;p++){const x=r.sections[p];x.image?h.addImageSection(x):h.addTextSection(x,l)}return h}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=(function(l,h){let p="";for(let x=0;x<l.length;x++){const b=l.charCodeAt(x+1)||null,A=l.charCodeAt(x-1)||null;p+=!h&&(b&&Je(b)&&!X0[l[x+1]]||A&&Je(A)&&!X0[l[x-1]])||!X0[l[x]]?l[x]:X0[l[x]]}return p})(this.text,r)}trim(){let r=0;for(let h=0;h<this.text.length&&F_[this.text.charCodeAt(h)];h++)r++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=r&&F_[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(r,l),this.sectionIndex=this.sectionIndex.slice(r,l)}substring(r,l){const h=new bg;return h.text=this.text.substring(r,l),h.sectionIndex=this.sectionIndex.slice(r,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((r,l)=>Math.max(r,this.sections[l].scale)),0)}addTextSection(r,l){this.text+=r.text,this.sections.push(K0.forText(r.scale,r.fontStack||l));const h=this.sections.length-1;for(let p=0;p<r.text.length;++p)this.sectionIndex.push(h)}addImageSection(r){const l=r.image?r.image.name:"";if(l.length===0)return void ur("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(K0.forImage(l)),this.sectionIndex.push(this.sections.length-1)):ur("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function xx(s,r,l,h,p,x,b,A,P,k,q,K,te,ue,pe){const Se=bg.fromFeature(s,p);K===Yh.vertical&&Se.verticalizePunctuation(te);let Ge=[];const at=(function(Tt,ln,en,wn,jn,dn){if(!Tt)return[];const Pn=[],kn=(function(dr,Nr,mr,$i,Xn,ri){let Gi=0;for(let Ko=0;Ko<dr.length();Ko++){const Wi=dr.getSection(Ko);Gi+=W3(dr.getCharCode(Ko),Wi,$i,Xn,Nr,ri)}return Gi/Math.max(1,Math.ceil(Gi/mr))})(Tt,ln,en,wn,jn,dn),On=Tt.text.indexOf("")>=0;let Wn=0;for(let dr=0;dr<Tt.length();dr++){const Nr=Tt.getSection(dr),mr=Tt.getCharCode(dr);if(F_[mr]||(Wn+=W3(mr,Nr,wn,jn,ln,dn)),dr<Tt.length()-1){const $i=!((xn=mr)<11904||!(ie["Bopomofo Extended"](xn)||ie.Bopomofo(xn)||ie["CJK Compatibility Forms"](xn)||ie["CJK Compatibility Ideographs"](xn)||ie["CJK Compatibility"](xn)||ie["CJK Radicals Supplement"](xn)||ie["CJK Strokes"](xn)||ie["CJK Symbols and Punctuation"](xn)||ie["CJK Unified Ideographs Extension A"](xn)||ie["CJK Unified Ideographs"](xn)||ie["Enclosed CJK Letters and Months"](xn)||ie["Halfwidth and Fullwidth Forms"](xn)||ie.Hiragana(xn)||ie["Ideographic Description Characters"](xn)||ie["Kangxi Radicals"](xn)||ie["Katakana Phonetic Extensions"](xn)||ie.Katakana(xn)||ie["Vertical Forms"](xn)||ie["Yi Radicals"](xn)||ie["Yi Syllables"](xn)));(uC[mr]||$i||Nr.imageName)&&Pn.push(X3(dr+1,Wn,kn,Pn,hC(mr,Tt.getCharCode(dr+1),$i&&On),!1))}}var xn;return K3(X3(Tt.length(),Wn,kn,Pn,0,!0))})(Se,k,x,r,h,ue),{processBidirectionalText:xt,processStyledBidirectionalText:lt}=B;if(xt&&Se.sections.length===1){const Tt=xt(Se.toString(),at);for(const ln of Tt){const en=new bg;en.text=ln,en.sections=Se.sections;for(let wn=0;wn<ln.length;wn++)en.sectionIndex.push(0);Ge.push(en)}}else if(lt){const Tt=lt(Se.text,Se.sectionIndex,at);for(const ln of Tt){const en=new bg;en.text=ln[0],en.sectionIndex=ln[1],en.sections=Se.sections,Ge.push(en)}}else Ge=(function(Tt,ln){const en=[],wn=Tt.text;let jn=0;for(const dn of ln)en.push(Tt.substring(jn,dn)),jn=dn;return jn<wn.length&&en.push(Tt.substring(jn,wn.length)),en})(Se,at);const yt=[],It={positionedLines:yt,text:Se.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:K,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return(function(Tt,ln,en,wn,jn,dn,Pn,kn,On,Wn,xn,dr){let Nr=0,mr=0,$i=0;const Xn=kn==="right"?1:kn==="left"?0:.5;let ri=!1;for(const Zi of jn){const Yi=Zi.getSections();for(const Fs of Yi){if(Fs.imageName)continue;const ra=ln[Fs.fontStack];if(ra&&(ri=ra.ascender!==void 0&&ra.descender!==void 0,!ri))break}if(!ri)break}let Gi=0;for(const Zi of jn){Zi.trim();const Yi=Zi.getMaxScale(),Fs=(Yi-1)*iu,ra={positionedGlyphs:[],lineOffset:0};Tt.positionedLines[Gi]=ra;const ia=ra.positionedGlyphs;let Os=0;if(!Zi.length()){mr+=dn,++Gi;continue}let Ba=0,ll=0;for(let Bs=0;Bs<Zi.length();Bs++){const Jl=Zi.getSection(Bs),Ml=Zi.getSectionIndex(Bs),Ka=Zi.getCharCode(Bs);let is=Jl.scale,Rl=null,oa=null,sh=null,Nl=iu,ou=0;const Vc=!(On===Yh.horizontal||!xn&&!Ke(Ka)||xn&&(F_[Ka]||(Ko=Ka,ie.Arabic(Ko)||ie["Arabic Supplement"](Ko)||ie["Arabic Extended-A"](Ko)||ie["Arabic Presentation Forms-A"](Ko)||ie["Arabic Presentation Forms-B"](Ko))));if(Jl.imageName){const ah=wn[Jl.imageName];if(!ah)continue;sh=Jl.imageName,Tt.iconsInText=Tt.iconsInText||!0,oa=ah.paddedRect;const qc=ah.displaySize;is=is*iu/dr,Rl={width:qc[0],height:qc[1],left:Eh,top:-q3,advance:Vc?qc[1]:qc[0],localGlyph:!1},ou=ri?-Rl.height*is:G3+Yi*iu-qc[1]*is,Nl=Rl.advance;const Bd=(Vc?qc[0]:qc[1])*is-iu*Yi;Bd>0&&Bd>Os&&(Os=Bd)}else{const ah=en[Jl.fontStack];if(!ah)continue;ah[Ka]&&(oa=ah[Ka]);const qc=ln[Jl.fontStack];if(!qc)continue;const Bd=qc.glyphs[Ka];if(!Bd)continue;if(Rl=Bd.metrics,Nl=Ka!==8203?iu:0,ri){const Cg=qc.ascender!==void 0?Math.abs(qc.ascender):0,oy=qc.descender!==void 0?Math.abs(qc.descender):0,sy=(Cg+oy)*is;Ba<sy&&(Ba=sy,ll=(Cg-oy)/2*is),ou=-Cg*is}else ou=G3+(Yi-is)*iu}Vc?(Tt.verticalizable=!0,ia.push({glyph:Ka,imageName:sh,x:Nr,y:mr+ou,vertical:Vc,scale:is,localGlyph:Rl.localGlyph,fontStack:Jl.fontStack,sectionIndex:Ml,metrics:Rl,rect:oa}),Nr+=Nl*is+Wn):(ia.push({glyph:Ka,imageName:sh,x:Nr,y:mr+ou,vertical:Vc,scale:is,localGlyph:Rl.localGlyph,fontStack:Jl.fontStack,sectionIndex:Ml,metrics:Rl,rect:oa}),Nr+=Rl.advance*is+Wn)}ia.length!==0&&($i=Math.max(Nr-Wn,$i),ri?Z3(ia,Xn,Os,ll,dn*Yi/2):Z3(ia,Xn,Os,0,dn/2)),Nr=0;const kl=dn*Yi+Os;ra.lineOffset=Math.max(Os,Fs),mr+=kl,++Gi}var Ko;const Wi=mr,{horizontalAlign:bi,verticalAlign:da}=bx(Pn);(function(Zi,Yi,Fs,ra,ia,Os){const Ba=(Yi-Fs)*ia,ll=-Os*ra;for(const kl of Zi)for(const Bs of kl.positionedGlyphs)Bs.x+=Ba,Bs.y+=ll})(Tt.positionedLines,Xn,bi,da,$i,Wi),Tt.top+=-da*Wi,Tt.bottom=Tt.top+Wi,Tt.left+=-bi*$i,Tt.right=Tt.left+$i,Tt.hasBaseline=ri})(It,r,l,h,Ge,b,A,P,K,k,te,pe),!(function(Tt){for(const ln of Tt)if(ln.positionedGlyphs.length!==0)return!1;return!0})(yt)&&It}const F_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},uC={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function W3(s,r,l,h,p,x){if(r.imageName){const b=h[r.imageName];return b?b.displaySize[0]*r.scale*iu/x+p:0}{const b=l[r.fontStack],A=b&&b.glyphs[s];return A?A.metrics.advance*r.scale+p:0}}function H3(s,r,l,h){const p=Math.pow(s-r,2);return h?s<r?p/2:2*p:p+Math.abs(l)*l}function hC(s,r,l){let h=0;return s===10&&(h-=1e4),l&&(h+=150),s!==40&&s!==65288||(h+=50),r!==41&&r!==65289||(h+=50),h}function X3(s,r,l,h,p,x){let b=null,A=H3(r,l,p,x);for(const P of h){const k=H3(r-P.x,l,p,x)+P.badness;k<=A&&(b=P,A=k)}return{index:s,x:r,priorBreak:b,badness:A}}function K3(s){return s?K3(s.priorBreak).concat(s.index):[]}function bx(s){let r=.5,l=.5;switch(s){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:r,verticalAlign:l}}function Z3(s,r,l,h,p){if(!(r||l||h||p))return;const x=s.length-1,b=s[x],A=(b.x+b.metrics.advance*b.scale)*r;for(let P=0;P<=x;P++)s[P].x-=A,s[P].y+=l+h+p}function dC(s,r,l){const{horizontalAlign:h,verticalAlign:p}=bx(l),x=r[0]-s.displaySize[0]*h,b=r[1]-s.displaySize[1]*p;return{image:s,top:b,bottom:b+s.displaySize[1],left:x,right:x+s.displaySize[0]}}function Y3(s,r,l,h,p,x){const b=s.image;let A;if(b.content){const Ge=b.content,at=b.pixelRatio||1;A=[Ge[0]/at,Ge[1]/at,b.displaySize[0]-Ge[2]/at,b.displaySize[1]-Ge[3]/at]}const P=r.left*x,k=r.right*x;let q,K,te,ue;l==="width"||l==="both"?(ue=p[0]+P-h[3],K=p[0]+k+h[1]):(ue=p[0]+(P+k-b.displaySize[0])/2,K=ue+b.displaySize[0]);const pe=r.top*x,Se=r.bottom*x;return l==="height"||l==="both"?(q=p[1]+pe-h[0],te=p[1]+Se+h[2]):(q=p[1]+(pe+Se-b.displaySize[1])/2,te=q+b.displaySize[1]),{image:b,top:q,right:K,bottom:te,left:ue,collisionPadding:A}}class Kf extends ${constructor(r,l,h,p,x){super(r,l),this.angle=p,this.z=h,x!==void 0&&(this.segment=x)}clone(){return new Kf(this.x,this.y,this.z,this.angle,this.segment)}}function J3(s,r,l,h,p){if(r.segment===void 0)return!0;let x=r,b=r.segment+1,A=0;for(;A>-l/2;){if(b--,b<0)return!1;A-=s[b].dist(x),x=s[b]}A+=s[b].dist(s[b+1]),b++;const P=[];let k=0;for(;A<l/2;){const q=s[b],K=s[b+1];if(!K)return!1;let te=s[b-1].angleTo(q)-q.angleTo(K);for(te=Math.abs((te+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:A,angleDelta:te}),k+=te;A-P[0].distance>h;)k-=P.shift().angleDelta;if(k>p)return!1;b++,A+=q.dist(K)}return!0}function Q3(s){let r=0;for(let l=0;l<s.length-1;l++)r+=s[l].dist(s[l+1]);return r}function e4(s,r,l){return s?.6*r*l:0}function t4(s,r){return Math.max(s?s.right-s.left:0,r?r.right-r.left:0)}function fC(s,r,l,h,p,x){const b=e4(l,p,x),A=t4(l,h)*x;let P=0;const k=Q3(s)/2;for(let q=0;q<s.length-1;q++){const K=s[q],te=s[q+1],ue=K.dist(te);if(P+ue>k){const pe=(k-P)/ue,Se=$e(K.x,te.x,pe),Ge=$e(K.y,te.y,pe),at=new Kf(Se,Ge,0,te.angleTo(K),q);return!b||J3(s,at,A,b,r)?at:void 0}P+=ue}}function pC(s,r,l,h,p,x,b,A,P){const k=e4(h,x,b),q=t4(h,p),K=q*b,te=s[0].x===0||s[0].x===P||s[0].y===0||s[0].y===P;return r-K<r/4&&(r=K+r/4),n4(s,te?r/2*A%r:(q/2+2*x)*b*A%r,r,k,l,K,te,!1,P)}function n4(s,r,l,h,p,x,b,A,P){const k=x/2,q=Q3(s);let K=0,te=r-l,ue=[];for(let pe=0;pe<s.length-1;pe++){const Se=s[pe],Ge=s[pe+1],at=Se.dist(Ge),xt=Ge.angleTo(Se);for(;te+l<K+at;){te+=l;const lt=(te-K)/at,yt=$e(Se.x,Ge.x,lt),It=$e(Se.y,Ge.y,lt);if(yt>=0&&yt<P&&It>=0&&It<P&&te-k>=0&&te+k<=q){const Tt=new Kf(yt,It,0,xt,pe);Tt._round(),h&&!J3(s,Tt,x,h,p)||ue.push(Tt)}}K+=at}return A||ue.length||b||(ue=n4(s,K/2,l,h,p,x,b,!0,P)),ue}function r4(s,r,l,h,p){const x=[];for(let b=0;b<s.length;b++){const A=s[b];let P;for(let k=0;k<A.length-1;k++){let q=A[k],K=A[k+1];q.x<r&&K.x<r||(q.x<r?q=new $(r,q.y+(r-q.x)/(K.x-q.x)*(K.y-q.y))._round():K.x<r&&(K=new $(r,q.y+(r-q.x)/(K.x-q.x)*(K.y-q.y))._round()),q.y<l&&K.y<l||(q.y<l?q=new $(q.x+(l-q.y)/(K.y-q.y)*(K.x-q.x),l)._round():K.y<l&&(K=new $(q.x+(l-q.y)/(K.y-q.y)*(K.x-q.x),l)._round()),q.x>=h&&K.x>=h||(q.x>=h?q=new $(h,q.y+(h-q.x)/(K.x-q.x)*(K.y-q.y))._round():K.x>=h&&(K=new $(h,q.y+(h-q.x)/(K.x-q.x)*(K.y-q.y))._round()),q.y>=p&&K.y>=p||(q.y>=p?q=new $(q.x+(p-q.y)/(K.y-q.y)*(K.x-q.x),p)._round():K.y>=p&&(K=new $(q.x+(p-q.y)/(K.y-q.y)*(K.x-q.x),p)._round()),P&&q.equals(P[P.length-1])||(P=[q],x.push(P)),P.push(K)))))}}return x}sr(Kf,"Anchor");const Z0=1e20;function i4(s,r,l,h,p,x,b,A,P){for(let k=r;k<r+h;k++)o4(s,l*x+k,x,p,b,A,P);for(let k=l;k<l+p;k++)o4(s,k*x+r,1,h,b,A,P)}function o4(s,r,l,h,p,x,b){x[0]=0,b[0]=-Z0,b[1]=Z0,p[0]=s[r];for(let A=1,P=0,k=0;A<h;A++){p[A]=s[r+A*l];const q=A*A;do{const K=x[P];k=(p[A]-p[K]+q-K*K)/(A-K)/2}while(k<=b[P]&&--P>-1);P++,x[P]=A,b[P]=k,b[P+1]=Z0}for(let A=0,P=0;A<h;A++){for(;b[P+1]<A;)P++;const k=x[P],q=A-k;s[r+A*l]=p[k]+q*q}}const Fd=2,wx={none:0,ideographs:1,all:2};class wg{constructor(r,l,h){this.requestManager=r,this.localGlyphMode=l,this.localFontFamily=h,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,l){const h=[];for(const p in r)for(const x of r[p])h.push({stack:p,id:x});ae(h,(({stack:p,id:x},b)=>{let A=this.entries[p];A||(A=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let P=A.glyphs[x];if(P!==void 0)return void b(null,{stack:p,id:x,glyph:P});if(P=this._tinySDF(A,p,x),P)return A.glyphs[x]=P,void b(null,{stack:p,id:x,glyph:P});const k=Math.floor(x/256);if(256*k>65535)return void b(new Error("glyphs > 65535 not supported"));if(A.ranges[k])return void b(null,{stack:p,id:x,glyph:P});let q=A.requests[k];q||(q=A.requests[k]=[],wg.loadGlyphRange(p,k,this.url,this.requestManager,((K,te)=>{if(te){A.ascender=te.ascender,A.descender=te.descender;for(const ue in te.glyphs)this._doesCharSupportLocalGlyph(+ue)||(A.glyphs[+ue]=te.glyphs[+ue]);A.ranges[k]=!0}for(const ue of q)ue(K,te);delete A.requests[k]}))),q.push(((K,te)=>{K?b(K):te&&b(null,{stack:p,id:x,glyph:te.glyphs[x]||null})}))}),((p,x)=>{if(p)l(p);else if(x){const b={};for(const{stack:A,id:P,glyph:k}of x)b[A]===void 0&&(b[A]={}),b[A].glyphs===void 0&&(b[A].glyphs={}),b[A].glyphs[P]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics},b[A].ascender=this.entries[A].ascender,b[A].descender=this.entries[A].descender;l(null,b)}}))}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==wx.none&&(this.localGlyphMode===wx.all?!!this.localFontFamily:!!this.localFontFamily&&(ie["CJK Unified Ideographs"](r)||ie["Hangul Syllables"](r)||ie.Hiragana(r)||ie.Katakana(r)||ie["CJK Symbols and Punctuation"](r)))}_tinySDF(r,l,h){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(h))return;let x=r.tinySDF;if(!x){let Se="400";/bold/i.test(l)?Se="900":/medium/i.test(l)?Se="500":/light/i.test(l)&&(Se="200"),x=r.tinySDF=new wg.TinySDF({fontFamily:p,fontWeight:Se,fontSize:24*Fd,buffer:3*Fd,radius:8*Fd}),x.fontWeight=Se}if(this.localGlyphs[x.fontWeight][h])return this.localGlyphs[x.fontWeight][h];const b=String.fromCharCode(h),{data:A,width:P,height:k,glyphWidth:q,glyphHeight:K,glyphLeft:te,glyphTop:ue,glyphAdvance:pe}=x.draw(b);return this.localGlyphs[x.fontWeight][h]={id:h,bitmap:new ih({width:P,height:k},A),metrics:{width:q/Fd,height:K/Fd,left:te/Fd,top:ue/Fd-27,advance:pe/Fd,localGlyph:!0}}}}wg.loadGlyphRange=function(s,r,l,h,p){const x=256*r,b=x+255,A=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",s).replace("{range}",`${x}-${b}`),pr.Glyphs);ui(A,((P,k)=>{if(P)p(P);else if(k){const q={},K=(function(te){return new D_(te).readFields(aC,{})})(k);for(const te of K.glyphs)q[te.id]=te;p(null,{glyphs:q,ascender:K.ascender,descender:K.descender})}}))},wg.TinySDF=class{constructor({fontSize:s=24,buffer:r=3,radius:l=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:x="normal",fontStyle:b="normal"}={}){this.buffer=r,this.cutoff=h,this.radius=l;const A=this.size=s+4*r,P=this._createCanvas(A),k=this.ctx=P.getContext("2d",{willReadFrequently:!0});k.font=`${b} ${x} ${s}px ${p}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(s){const r=document.createElement("canvas");return r.width=r.height=s,r}draw(s){const{width:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:x}=this.ctx.measureText(s),b=Math.ceil(l),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-p))),P=Math.min(this.size-this.buffer,b+Math.ceil(h)),k=A+2*this.buffer,q=P+2*this.buffer,K=Math.max(k*q,0),te=new Uint8ClampedArray(K),ue={data:te,width:k,height:q,glyphWidth:A,glyphHeight:P,glyphTop:b,glyphLeft:0,glyphAdvance:r};if(A===0||P===0)return ue;const{ctx:pe,buffer:Se,gridInner:Ge,gridOuter:at}=this;pe.clearRect(Se,Se,A,P),pe.fillText(s,Se,Se+b);const xt=pe.getImageData(Se,Se,A,P);at.fill(Z0,0,K),Ge.fill(0,0,K);for(let lt=0;lt<P;lt++)for(let yt=0;yt<A;yt++){const It=xt.data[4*(lt*A+yt)+3]/255;if(It===0)continue;const Tt=(lt+Se)*k+yt+Se;if(It===1)at[Tt]=0,Ge[Tt]=Z0;else{const ln=.5-It;at[Tt]=ln>0?ln*ln:0,Ge[Tt]=ln<0?ln*ln:0}}i4(at,0,0,k,q,k,this.f,this.v,this.z),i4(Ge,Se,Se,A,P,k,this.f,this.v,this.z);for(let lt=0;lt<K;lt++){const yt=Math.sqrt(at[lt])-Math.sqrt(Ge[lt]);te[lt]=Math.round(255-255*(yt/this.radius+this.cutoff))}return ue}};const Sg=Eh;function s4(s,r,l,h){const p=[],x=s.image,b=x.pixelRatio,A=x.paddedRect.w-2*Sg,P=x.paddedRect.h-2*Sg,k=s.right-s.left,q=s.bottom-s.top,K=x.stretchX||[[0,A]],te=x.stretchY||[[0,P]],ue=(dn,Pn)=>dn+Pn[1]-Pn[0],pe=K.reduce(ue,0),Se=te.reduce(ue,0),Ge=A-pe,at=P-Se;let xt=0,lt=pe,yt=0,It=Se,Tt=0,ln=Ge,en=0,wn=at;if(x.content&&h){const dn=x.content;xt=O_(K,0,dn[0]),yt=O_(te,0,dn[1]),lt=O_(K,dn[0],dn[2]),It=O_(te,dn[1],dn[3]),Tt=dn[0]-xt,en=dn[1]-yt,ln=dn[2]-dn[0]-lt,wn=dn[3]-dn[1]-It}const jn=(dn,Pn,kn,On)=>{const Wn=B_(dn.stretch-xt,lt,k,s.left),xn=z_(dn.fixed-Tt,ln,dn.stretch,pe),dr=B_(Pn.stretch-yt,It,q,s.top),Nr=z_(Pn.fixed-en,wn,Pn.stretch,Se),mr=B_(kn.stretch-xt,lt,k,s.left),$i=z_(kn.fixed-Tt,ln,kn.stretch,pe),Xn=B_(On.stretch-yt,It,q,s.top),ri=z_(On.fixed-en,wn,On.stretch,Se),Gi=new $(Wn,dr),Ko=new $(mr,dr),Wi=new $(mr,Xn),bi=new $(Wn,Xn),da=new $(xn/b,Nr/b),Zi=new $($i/b,ri/b),Yi=r*Math.PI/180;if(Yi){const ia=Math.sin(Yi),Os=Math.cos(Yi),Ba=[Os,-ia,ia,Os];Gi._matMult(Ba),Ko._matMult(Ba),bi._matMult(Ba),Wi._matMult(Ba)}const Fs=dn.stretch+dn.fixed,ra=Pn.stretch+Pn.fixed;return{tl:Gi,tr:Ko,bl:bi,br:Wi,tex:{x:x.paddedRect.x+Sg+Fs,y:x.paddedRect.y+Sg+ra,w:kn.stretch+kn.fixed-Fs,h:On.stretch+On.fixed-ra},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:da,pixelOffsetBR:Zi,minFontScaleX:ln/b/k,minFontScaleY:wn/b/q,isSDF:l}};if(h&&(x.stretchX||x.stretchY)){const dn=a4(K,Ge,pe),Pn=a4(te,at,Se);for(let kn=0;kn<dn.length-1;kn++){const On=dn[kn],Wn=dn[kn+1];for(let xn=0;xn<Pn.length-1;xn++)p.push(jn(On,Pn[xn],Wn,Pn[xn+1]))}}else p.push(jn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:P+1}));return p}function O_(s,r,l){let h=0;for(const p of s)h+=Math.max(r,Math.min(l,p[1]))-Math.max(r,Math.min(l,p[0]));return h}function a4(s,r,l){const h=[{fixed:-Sg,stretch:0}];for(const[p,x]of s){const b=h[h.length-1];h.push({fixed:p-b.stretch,stretch:b.stretch}),h.push({fixed:p-b.stretch,stretch:b.stretch+(x-p)})}return h.push({fixed:r+Sg,stretch:l}),h}function B_(s,r,l,h){return s/r*l+h}function z_(s,r,l,h){return s-r*l/h}function mC(s,r,l,h){const p=r+s.positionedLines[h].lineOffset;return h===0?l+p/2:l+(p+(r+s.positionedLines[h-1].lineOffset))/2}class gC{constructor(r=[],l=yC){if(this.data=r,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:l,compare:h}=this,p=l[r];for(;r>0;){const x=r-1>>1,b=l[x];if(h(p,b)>=0)break;l[r]=b,r=x}l[r]=p}_down(r){const{data:l,compare:h}=this,p=this.length>>1,x=l[r];for(;r<p;){let b=1+(r<<1),A=l[b];const P=b+1;if(P<this.length&&h(l[P],A)<0&&(b=P,A=l[P]),h(A,x)>=0)break;l[r]=A,r=b}l[r]=x}}function yC(s,r){return s<r?-1:s>r?1:0}function _C(s,r=1,l=!1){let h=1/0,p=1/0,x=-1/0,b=-1/0;const A=s[0];for(let ue=0;ue<A.length;ue++){const pe=A[ue];(!ue||pe.x<h)&&(h=pe.x),(!ue||pe.y<p)&&(p=pe.y),(!ue||pe.x>x)&&(x=pe.x),(!ue||pe.y>b)&&(b=pe.y)}const P=Math.min(x-h,b-p);let k=P/2;const q=new gC([],vC);if(P===0)return new $(h,p);for(let ue=h;ue<x;ue+=P)for(let pe=p;pe<b;pe+=P)q.push(new Eg(ue+k,pe+k,k,s));let K=(function(ue){let pe=0,Se=0,Ge=0;const at=ue[0];for(let xt=0,lt=at.length,yt=lt-1;xt<lt;yt=xt++){const It=at[xt],Tt=at[yt],ln=It.x*Tt.y-Tt.x*It.y;Se+=(It.x+Tt.x)*ln,Ge+=(It.y+Tt.y)*ln,pe+=3*ln}return new Eg(Se/pe,Ge/pe,0,ue)})(s),te=q.length;for(;q.length;){const ue=q.pop();(ue.d>K.d||!K.d)&&(K=ue,l&&console.log("found best %d after %d probes",Math.round(1e4*ue.d)/1e4,te)),ue.max-K.d<=r||(k=ue.h/2,q.push(new Eg(ue.p.x-k,ue.p.y-k,k,s)),q.push(new Eg(ue.p.x+k,ue.p.y-k,k,s)),q.push(new Eg(ue.p.x-k,ue.p.y+k,k,s)),q.push(new Eg(ue.p.x+k,ue.p.y+k,k,s)),te+=4)}return l&&(console.log(`num probes: ${te}`),console.log(`best distance: ${K.d}`)),K.p}function vC(s,r){return r.max-s.max}class Eg{constructor(r,l,h,p){this.p=new $(r,l),this.h=h,this.d=(function(x,b){let A=!1,P=1/0;for(let k=0;k<b.length;k++){const q=b[k];for(let K=0,te=q.length,ue=te-1;K<te;ue=K++){const pe=q[K],Se=q[ue];pe.y>x.y!=Se.y>x.y&&x.x<(Se.x-pe.x)*(x.y-pe.y)/(Se.y-pe.y)+pe.x&&(A=!A),P=Math.min(P,M0(x,pe,Se))}}return(A?1:-1)*Math.sqrt(P)})(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const Ag=7,Sx=Number.POSITIVE_INFINITY,xC=Math.sqrt(2);function l4(s,[r,l]){let h=0,p=0;if(l===Sx){r<0&&(r=0);const x=r/xC;switch(s){case"top-right":case"top-left":p=x-Ag;break;case"bottom-right":case"bottom-left":p=-x+Ag;break;case"bottom":p=-r+Ag;break;case"top":p=r-Ag}switch(s){case"top-right":case"bottom-right":h=-x;break;case"top-left":case"bottom-left":h=x;break;case"left":h=r;break;case"right":h=-r}}else{switch(r=Math.abs(r),l=Math.abs(l),s){case"top-right":case"top-left":case"top":p=l-Ag;break;case"bottom-right":case"bottom-left":case"bottom":p=-l+Ag}switch(s){case"top-right":case"bottom-right":case"right":h=-r;break;case"top-left":case"bottom-left":case"left":h=r}}return[h,p]}function bC(s,r,l,h,p,x,b,A,P,k){s.createArrays(),s.tilePixelRatio=_t/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const q=s.layers[0].layout,K=s.layers[0]._unevaluatedLayout._values,te={};if(s.textSizeData.kind==="composite"){const{minZoom:Se,maxZoom:Ge}=s.textSizeData;te.compositeTextSizes=[K["text-size"].possiblyEvaluate(new G(Se),A),K["text-size"].possiblyEvaluate(new G(Ge),A)]}if(s.iconSizeData.kind==="composite"){const{minZoom:Se,maxZoom:Ge}=s.iconSizeData;te.compositeIconSizes=[K["icon-size"].possiblyEvaluate(new G(Se),A),K["icon-size"].possiblyEvaluate(new G(Ge),A)]}te.layoutTextSize=K["text-size"].possiblyEvaluate(new G(P+1),A),te.layoutIconSize=K["icon-size"].possiblyEvaluate(new G(P+1),A),te.textMaxSize=K["text-size"].possiblyEvaluate(new G(18),A);const ue=q.get("text-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",pe=q.get("text-size");for(const Se of s.features){const Ge=q.get("text-font").evaluate(Se,{},A).join(","),at=pe.evaluate(Se,{},A),xt=te.layoutTextSize.evaluate(Se,{},A),lt=(te.layoutIconSize.evaluate(Se,{},A),{horizontal:{},vertical:void 0}),yt=Se.text;let It,Tt=[0,0];if(yt){const wn=yt.toString(),jn=q.get("text-letter-spacing").evaluate(Se,{},A)*iu,dn=q.get("text-line-height").evaluate(Se,{},A)*iu,Pn=Be(wn)?jn:0,kn=q.get("text-anchor").evaluate(Se,{},A),On=q.get("text-variable-anchor");if(!On){const mr=q.get("text-radial-offset").evaluate(Se,{},A);Tt=mr?l4(kn,[mr*iu,Sx]):q.get("text-offset").evaluate(Se,{},A).map(($i=>$i*iu))}let Wn=ue?"center":q.get("text-justify").evaluate(Se,{},A);const xn=q.get("symbol-placement")==="point",dr=xn?q.get("text-max-width").evaluate(Se,{},A)*iu:1/0,Nr=mr=>{s.allowVerticalPlacement&&Ce(wn)&&(lt.vertical=xx(yt,r,l,p,Ge,dr,dn,kn,mr,Pn,Tt,Yh.vertical,!0,xt,at))};if(!ue&&On){const mr=Wn==="auto"?On.map((Xn=>Ex(Xn))):[Wn];let $i=!1;for(let Xn=0;Xn<mr.length;Xn++){const ri=mr[Xn];if(!lt.horizontal[ri])if($i)lt.horizontal[ri]=lt.horizontal[0];else{const Gi=xx(yt,r,l,p,Ge,dr,dn,"center",ri,Pn,Tt,Yh.horizontal,!1,xt,at);Gi&&(lt.horizontal[ri]=Gi,$i=Gi.positionedLines.length===1)}}Nr("left")}else{if(Wn==="auto"&&(Wn=Ex(kn)),xn||q.get("text-writing-mode").indexOf("horizontal")>=0||!Ce(wn)){const mr=xx(yt,r,l,p,Ge,dr,dn,kn,Wn,Pn,Tt,Yh.horizontal,!1,xt,at);mr&&(lt.horizontal[Wn]=mr)}Nr(xn?"left":Wn)}}let ln=!1;if(Se.icon&&Se.icon.name){const wn=h[Se.icon.name];wn&&(It=dC(p[Se.icon.name],q.get("icon-offset").evaluate(Se,{},A),q.get("icon-anchor").evaluate(Se,{},A)),ln=wn.sdf,s.sdfIcons===void 0?s.sdfIcons=wn.sdf:s.sdfIcons!==wn.sdf&&ur("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(wn.pixelRatio!==s.pixelRatio||q.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const en=u4(lt.horizontal)||lt.vertical;s.iconsInText||(s.iconsInText=!!en&&en.iconsInText),(en||It)&&wC(s,Se,lt,It,h,te,xt,0,Tt,ln,b,A,k)}x&&s.generateCollisionDebugBuffers(P,s.collisionBoxArray)}function Ex(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wC(s,r,l,h,p,x,b,A,P,k,q,K,te){let ue=x.textMaxSize.evaluate(r,{},K);ue===void 0&&(ue=b);const pe=s.layers[0].layout,Se=pe.get("icon-offset").evaluate(r,{},K),Ge=u4(l.horizontal)||l.vertical,at=te.name==="globe",xt=iu,lt=b/xt,yt=s.tilePixelRatio*ue/xt,It=(kn=s.overscaling,s.zoom>18&&kn>2&&(kn>>=1),Math.max(_t/(512*kn),1)*pe.get("symbol-spacing")),Tt=pe.get("text-padding")*s.tilePixelRatio,ln=pe.get("icon-padding")*s.tilePixelRatio,en=Z(pe.get("text-max-angle")),wn=pe.get("text-rotation-alignment")==="map"&&pe.get("symbol-placement")!=="point",jn=pe.get("icon-rotation-alignment")==="map"&&pe.get("symbol-placement")!=="point",dn=pe.get("symbol-placement"),Pn=It/2;var kn;const On=pe.get("icon-text-fit");let Wn;h&&On!=="none"&&(s.allowVerticalPlacement&&l.vertical&&(Wn=Y3(h,l.vertical,On,pe.get("icon-text-fit-padding"),Se,lt)),Ge&&(h=Y3(h,Ge,On,pe.get("icon-text-fit-padding"),Se,lt)));const xn=(dr,Nr,mr)=>{if(Nr.x<0||Nr.x>=_t||Nr.y<0||Nr.y>=_t)return;let $i=null;if(at){const{x:Xn,y:ri,z:Gi}=te.projectTilePoint(Nr.x,Nr.y,mr);$i={anchor:new Kf(Xn,ri,Gi,0,void 0),up:te.upVector(mr,Nr.x,Nr.y)}}(function(Xn,ri,Gi,Ko,Wi,bi,da,Zi,Yi,Fs,ra,ia,Os,Ba,ll,kl,Bs,Jl,Ml,Ka,is,Rl,oa,sh,Nl){const ou=Xn.addToLineVertexArray(ri,Ko);let Vc,ah,qc,Bd,Cg,oy,sy,q4=0,$4=0,G4=0,W4=0,zx=-1,jx=-1;const pf={};let H4=dc("");const wm=Gi?Gi.anchor:ri;let Ux=0,Vx=0;if(Yi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Ux,Vx]=Yi.layout.get("text-offset").evaluate(is,{},Nl).map((Fh=>Fh*iu)):(Ux=Yi.layout.get("text-radial-offset").evaluate(is,{},Nl)*iu,Vx=Sx),Xn.allowVerticalPlacement&&Wi.vertical){const Fh=Wi.vertical;if(ll)oy=Ax(Fh),Zi&&(sy=Ax(Zi));else{const Oh=Yi.layout.get("text-rotate").evaluate(is,{},Nl)+90;qc=j_(Fs,wm,ri,ra,ia,Os,Fh,Ba,Oh,kl),Zi&&(Bd=j_(Fs,wm,ri,ra,ia,Os,Zi,Jl,Oh))}}if(bi){const Fh=Yi.layout.get("icon-rotate").evaluate(is,{},Nl),Oh=Yi.layout.get("icon-text-fit")!=="none",ay=s4(bi,Fh,oa,Oh),$x=Zi?s4(Zi,Fh,oa,Oh):void 0;ah=j_(Fs,wm,ri,ra,ia,Os,bi,Jl,Fh),q4=4*ay.length;const X4=Xn.iconSizeData;let Sm=null;X4.kind==="source"?(Sm=[Dd*Yi.layout.get("icon-size").evaluate(is,{},Nl)],Sm[0]>Ip&&ur(`${Xn.layerIds[0]}: Value for "icon-size" is >= ${Y0}. Reduce your "icon-size".`)):X4.kind==="composite"&&(Sm=[Dd*Rl.compositeIconSizes[0].evaluate(is,{},Nl),Dd*Rl.compositeIconSizes[1].evaluate(is,{},Nl)],(Sm[0]>Ip||Sm[1]>Ip)&&ur(`${Xn.layerIds[0]}: Value for "icon-size" is >= ${Y0}. Reduce your "icon-size".`)),Xn.addSymbols(Xn.icon,ay,Sm,Ka,Ml,is,!1,Gi,ri,ou.lineStartIndex,ou.lineLength,-1,sh,Nl),zx=Xn.icon.placedSymbolArray.length-1,$x&&($4=4*$x.length,Xn.addSymbols(Xn.icon,$x,Sm,Ka,Ml,is,Yh.vertical,Gi,ri,ou.lineStartIndex,ou.lineLength,-1,sh,Nl),jx=Xn.icon.placedSymbolArray.length-1)}for(const Fh in Wi.horizontal){const Oh=Wi.horizontal[Fh];Vc||(H4=dc(Oh.text),ll?Cg=Ax(Oh):Vc=j_(Fs,wm,ri,ra,ia,Os,Oh,Ba,Yi.layout.get("text-rotate").evaluate(is,{},Nl),kl));const ay=Oh.positionedLines.length===1;if(G4+=c4(Xn,Gi,ri,Oh,da,Yi,ll,is,kl,ou,Wi.vertical?Yh.horizontal:Yh.horizontalOnly,ay?Object.keys(Wi.horizontal):[Fh],pf,zx,Rl,sh,Nl),ay)break}Wi.vertical&&(W4+=c4(Xn,Gi,ri,Wi.vertical,da,Yi,ll,is,kl,ou,Yh.vertical,["vertical"],pf,jx,Rl,sh,Nl));let Rp=-1;const qx=(Fh,Oh)=>Fh?Math.max(Fh,Oh):Oh;Rp=qx(Cg,Rp),Rp=qx(oy,Rp),Rp=qx(sy,Rp);const ZC=Rp>-1?1:0;Xn.glyphOffsetArray.length>=Lp.MAX_GLYPHS&&ur("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),is.sortKey!==void 0&&Xn.addToSortKeyRanges(Xn.symbolInstances.length,is.sortKey),Xn.symbolInstances.emplaceBack(wm.x,wm.y,wm.z,ri.x,ri.y,pf.right>=0?pf.right:-1,pf.center>=0?pf.center:-1,pf.left>=0?pf.left:-1,pf.vertical>=0?pf.vertical:-1,zx,jx,H4,Vc!==void 0?Vc:Xn.collisionBoxArray.length,Vc!==void 0?Vc+1:Xn.collisionBoxArray.length,qc!==void 0?qc:Xn.collisionBoxArray.length,qc!==void 0?qc+1:Xn.collisionBoxArray.length,ah!==void 0?ah:Xn.collisionBoxArray.length,ah!==void 0?ah+1:Xn.collisionBoxArray.length,Bd||Xn.collisionBoxArray.length,Bd?Bd+1:Xn.collisionBoxArray.length,ra,G4,W4,q4,$4,ZC,0,Ux,Vx,Rp)})(s,Nr,$i,dr,l,h,p,Wn,s.layers[0],s.collisionBoxArray,r.index,r.sourceLayerIndex,s.index,Tt,wn,P,0,ln,jn,Se,r,x,k,q,K)};if(dn==="line")for(const dr of r4(r.geometry,0,0,_t,_t)){const Nr=pC(dr,It,en,l.vertical||Ge,h,xt,yt,s.overscaling,_t);for(const mr of Nr)Ge&&SC(s,Ge.text,Pn,mr)||xn(dr,mr,K)}else if(dn==="line-center"){for(const dr of r.geometry)if(dr.length>1){const Nr=fC(dr,en,l.vertical||Ge,h,xt,yt);Nr&&xn(dr,Nr,K)}}else if(r.type==="Polygon")for(const dr of $0(r.geometry,0)){const Nr=_C(dr,16);xn(dr[0],new Kf(Nr.x,Nr.y,0,0,void 0),K)}else if(r.type==="LineString")for(const dr of r.geometry)xn(dr,new Kf(dr[0].x,dr[0].y,0,0,void 0),K);else if(r.type==="Point")for(const dr of r.geometry)for(const Nr of dr)xn([Nr],new Kf(Nr.x,Nr.y,0,0,void 0),K)}const Y0=255,Ip=Y0*Dd;function c4(s,r,l,h,p,x,b,A,P,k,q,K,te,ue,pe,Se,Ge){const at=(function(yt,It,Tt,ln,en,wn,jn,dn){const Pn=[];if(It.positionedLines.length===0)return Pn;const kn=ln.layout.get("text-rotate").evaluate(wn,{})*Math.PI/180,On=(function(mr){const $i=mr[0],Xn=mr[1],ri=$i*Xn;return ri>0?[$i,-Xn]:ri<0?[-$i,Xn]:$i===0?[Xn,$i]:[Xn,-$i]})(Tt);let Wn=Math.abs(It.top-It.bottom);for(const mr of It.positionedLines)Wn-=mr.lineOffset;const xn=It.positionedLines.length,dr=Wn/xn;let Nr=It.top-Tt[1];for(let mr=0;mr<xn;++mr){const $i=It.positionedLines[mr];Nr=mC(It,dr,Nr,mr);for(const Xn of $i.positionedGlyphs){if(!Xn.rect)continue;const ri=Xn.rect||{};let Gi=q3+1,Ko=!0,Wi=1,bi=0;if(Xn.imageName){const oa=jn[Xn.imageName];if(!oa)continue;if(oa.sdf){ur("SDF images are not supported in formatted text and will be ignored.");continue}Ko=!1,Wi=oa.pixelRatio,Gi=Eh/Wi}const da=(en||dn)&&Xn.vertical,Zi=Xn.metrics.advance*Xn.scale/2,Yi=Xn.metrics,Fs=Xn.rect;if(Fs===null)continue;dn&&It.verticalizable&&(bi=Xn.imageName?Zi-Xn.metrics.width*Xn.scale/2:0);const ra=en?[Xn.x+Zi,Xn.y]:[0,0];let ia=[0,0],Os=[0,0],Ba=!1;en||(da?(Os=[Xn.x+Zi+On[0],Xn.y+On[1]-bi],Ba=!0):ia=[Xn.x+Zi+Tt[0],Xn.y+Tt[1]-bi]);const ll=Fs.w*Xn.scale/(Wi*(Xn.localGlyph?Fd:1)),kl=Fs.h*Xn.scale/(Wi*(Xn.localGlyph?Fd:1));let Bs,Jl,Ml,Ka;if(da){const oa=Xn.y-Nr,sh=new $(-Zi,Zi-oa),Nl=-Math.PI/2,ou=new $(...Os);Bs=new $(-Zi+ia[0],ia[1]),Bs._rotateAround(Nl,sh)._add(ou),Bs.x+=-oa+Zi,Bs.y-=(Yi.left-Gi)*Xn.scale;const Vc=Xn.imageName?Yi.advance*Xn.scale:iu*Xn.scale,ah=String.fromCharCode(Xn.glyph);Z8(ah)?Bs.x+=(1-Gi)*Xn.scale:Y8(ah)?Bs.x+=Vc-Yi.height*Xn.scale+(-Gi-1)*Xn.scale:Bs.x+=Xn.imageName||Yi.width+2*Gi===Fs.w&&Yi.height+2*Gi===Fs.h?(Vc-kl)/2:(Vc-(Yi.height+2*Gi)*Xn.scale)/2,Jl=new $(Bs.x,Bs.y-ll),Ml=new $(Bs.x+kl,Bs.y),Ka=new $(Bs.x+kl,Bs.y-ll)}else{const oa=(Yi.left-Gi)*Xn.scale-Zi+ia[0],sh=(-Yi.top-Gi)*Xn.scale+ia[1],Nl=oa+ll,ou=sh+kl;Bs=new $(oa,sh),Jl=new $(Nl,sh),Ml=new $(oa,ou),Ka=new $(Nl,ou)}if(kn){let oa;oa=en?new $(0,0):Ba?new $(On[0],On[1]):new $(Tt[0],Tt[1]),Bs._rotateAround(kn,oa),Jl._rotateAround(kn,oa),Ml._rotateAround(kn,oa),Ka._rotateAround(kn,oa)}const is=new $(0,0),Rl=new $(0,0);Pn.push({tl:Bs,tr:Jl,bl:Ml,br:Ka,tex:ri,writingMode:It.writingMode,glyphOffset:ra,sectionIndex:Xn.sectionIndex,isSDF:Ko,pixelOffsetTL:is,pixelOffsetBR:Rl,minFontScaleX:0,minFontScaleY:0})}}return Pn})(0,h,P,x,b,A,p,s.allowVerticalPlacement),xt=s.textSizeData;let lt=null;xt.kind==="source"?(lt=[Dd*x.layout.get("text-size").evaluate(A,{},Ge)],lt[0]>Ip&&ur(`${s.layerIds[0]}: Value for "text-size" is >= ${Y0}. Reduce your "text-size".`)):xt.kind==="composite"&&(lt=[Dd*pe.compositeTextSizes[0].evaluate(A,{},Ge),Dd*pe.compositeTextSizes[1].evaluate(A,{},Ge)],(lt[0]>Ip||lt[1]>Ip)&&ur(`${s.layerIds[0]}: Value for "text-size" is >= ${Y0}. Reduce your "text-size".`)),s.addSymbols(s.text,at,lt,P,b,A,q,r,l,k.lineStartIndex,k.lineLength,ue,Se,Ge);for(const yt of K)te[yt]=s.text.placedSymbolArray.length-1;return 4*at.length}function u4(s){for(const r in s)return s[r];return null}function j_(s,r,l,h,p,x,b,A,P,k){let q=b.top,K=b.bottom,te=b.left,ue=b.right;const pe=b.collisionPadding;if(pe&&(te-=pe[0],q-=pe[1],ue+=pe[2],K+=pe[3]),P){const Se=new $(te,q),Ge=new $(ue,q),at=new $(te,K),xt=new $(ue,K),lt=Z(P);let yt=new $(0,0);k&&(yt=new $(k[0],k[1])),Se._rotateAround(lt,yt),Ge._rotateAround(lt,yt),at._rotateAround(lt,yt),xt._rotateAround(lt,yt),te=Math.min(Se.x,Ge.x,at.x,xt.x),ue=Math.max(Se.x,Ge.x,at.x,xt.x),q=Math.min(Se.y,Ge.y,at.y,xt.y),K=Math.max(Se.y,Ge.y,at.y,xt.y)}return s.emplaceBack(r.x,r.y,r.z,l.x,l.y,te,q,ue,K,A,h,p,x),s.length-1}function Ax(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const r=s.bottom-s.top;return r>0?Math.max(10,r):null}function SC(s,r,l,h){const p=s.compareText;if(r in p){const x=p[r];for(let b=x.length-1;b>=0;b--)if(h.dist(x[b])<l)return!0}else p[r]=[];return p[r].push(h),!1}function h4(s,r){const l=s.fovAboveCenter,h=s.elevation?s.elevation.getMinElevationBelowMSL()*r:0,p=(s._camera.position[2]*s.worldSize-h)/Math.cos(s._pitch),x=Math.sin(l)*p/Math.sin(Math.max(Math.PI/2-s._pitch-l,.01)),b=Math.sin(s._pitch)*x+p;return Math.min(1.01*b,p*(1/s._horizonShift))}function xm(s,r){if(!r.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:r};const l=Math.pow(2,-s.z),h=s.x*l,p=(s.x+1)*l,x=s.y*l,b=(s.y+1)*l,A=zc(h),P=zc(p),k=Ho(x),q=Ho(b),K=r.project(A,k),te=r.project(P,k),ue=r.project(P,q),pe=r.project(A,q);let Se=Math.min(K.x,te.x,ue.x,pe.x),Ge=Math.min(K.y,te.y,ue.y,pe.y),at=Math.max(K.x,te.x,ue.x,pe.x),xt=Math.max(K.y,te.y,ue.y,pe.y);const lt=l/16;function yt(Tt,ln,en,wn,jn,dn){const Pn=(en+jn)/2,kn=(wn+dn)/2,On=r.project(zc(Pn),Ho(kn)),Wn=Math.max(0,Se-On.x,Ge-On.y,On.x-at,On.y-xt);Se=Math.min(Se,On.x),at=Math.max(at,On.x),Ge=Math.min(Ge,On.y),xt=Math.max(xt,On.y),Wn>lt&&(yt(Tt,On,en,wn,Pn,kn),yt(On,ln,Pn,kn,jn,dn))}yt(K,te,h,x,p,x),yt(te,ue,p,x,p,b),yt(ue,pe,p,b,h,b),yt(pe,K,h,b,h,x),Se-=lt,Ge-=lt,at+=lt,xt+=lt;const It=1/Math.max(at-Se,xt-Ge);return{scale:It,x:Se*It,y:Ge*It,x2:at*It,y2:xt*It,projection:r}}const EC=Zt(new Float32Array(16));class Cp{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,l){return{x:0,y:0,z:0}}unproject(r,l){return new ai(0,0)}projectTilePoint(r,l,h){return{x:r,y:l,z:0}}locationPoint(r,l,h=!0){return r._coordinatePoint(r.locationCoordinate(l),h)}pixelsPerMeter(r,l){return al(1,r)*l}pixelSpaceConversion(r,l,h){return 1}farthestPixelDistance(r){return h4(r,r.pixelsPerMeter)}pointCoordinate(r,l,h,p){const x=r.horizonLineFromTop(!1),b=new $(l,Math.max(x,h));return r.rayIntersectionCoordinate(r.pointRayIntersection(b,p))}pointCoordinate3D(r,l,h){const p=new $(l,h);if(r.elevation)return r.elevation.pointCoordinate(p);{const x=this.pointCoordinate(r,p.x,p.y,0);return[x.x,x.y,x.z]}}isPointAboveHorizon(r,l){if(r.elevation)return!this.pointCoordinate3D(r,l.x,l.y);const h=r.horizonLineFromTop();return l.y<h}createInversionMatrix(r,l){return EC}createTileMatrix(r,l,h){let p,x,b;const A=h.canonical,P=Zt(new Float64Array(16));if(this.isReprojectedInTileSpace){const k=xm(A,this);p=1,x=k.x+h.wrap*k.scale,b=k.y,Gn(P,P,[p/k.scale,p/k.scale,r.pixelsPerMeter/l])}else p=l/r.zoomScale(A.z),x=(A.x+Math.pow(2,A.z)*h.wrap)*p,b=A.y*p;return zr(P,P,[x,b,0]),Gn(P,P,[p/_t,p/_t,1]),P}upVector(r,l,h){return[0,0,1]}upVectorScale(r,l,h){return{metersToTile:1}}}class AC extends Cp{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[l,h]=this.parallels=r.parallels||[29.5,45.5],p=Math.sin(Z(l));this.n=(p+Math.sin(Z(h)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(r,l){const{n:h,c:p,r0:x}=this,b=Z(r-this.center[0]),A=Z(l),P=Math.sqrt(p-2*h*Math.sin(A))/h;return{x:P*Math.sin(b*h),y:P*Math.cos(b*h)-x,z:0}}unproject(r,l){const{n:h,c:p,r0:x}=this,b=x+l;let A=Math.atan2(r,Math.abs(b))*Math.sign(b);b*h<0&&(A-=Math.PI*Math.sign(r)*Math.sign(b));const P=Z(this.center[0])*h;A=xe(A,-Math.PI-P,Math.PI-P);const k=De(Ee(A/h)+this.center[0],-180,180),q=Math.asin(De((p-(r*r+b*b)*h*h)/(2*h),-1,1)),K=De(Ee(q),-Ha,Ha);return new ai(k,K)}}const J0=1.340264,Q0=-.081106,ey=893e-6,ty=.003796,U_=Math.sqrt(3)/2;class TC extends Cp{project(r,l){l=l/180*Math.PI,r=r/180*Math.PI;const h=Math.asin(U_*Math.sin(l)),p=h*h,x=p*p*p;return{x:.5*(r*Math.cos(h)/(U_*(J0+3*Q0*p+x*(7*ey+9*ty*p)))/Math.PI+.5),y:1-.5*(h*(J0+Q0*p+x*(ey+ty*p))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,p=h*h,x=p*p*p;for(let q,K,te,ue=0;ue<12&&(K=h*(J0+Q0*p+x*(ey+ty*p))-l,te=J0+3*Q0*p+x*(7*ey+9*ty*p),q=K/te,h=De(h-q,-Math.PI/3,Math.PI/3),p=h*h,x=p*p*p,!(Math.abs(q)<1e-12));++ue);const b=U_*r*(J0+3*Q0*p+x*(7*ey+9*ty*p))/Math.cos(h),A=Math.asin(Math.sin(h)/U_),P=De(180*b/Math.PI,-180,180),k=De(180*A/Math.PI,-Ha,Ha);return new ai(P,k)}}class IC extends Cp{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){return{x:.5+r/360,y:.5-l/360,z:0}}unproject(r,l){const h=360*(r-.5),p=De(360*(.5-l),-Ha,Ha);return new ai(h,p)}}const Tg=Math.PI/2;function V_(s){return Math.tan((Tg+s)/2)}class CC extends Cp{constructor(r){super(r),this.center=r.center||[0,30];const[l,h]=this.parallels=r.parallels||[30,30];let p=Z(l),x=Z(h);this.southernCenter=p+x<0,this.southernCenter&&(p=-p,x=-x);const b=Math.cos(p),A=V_(p);this.n=p===x?Math.sin(p):Math.log(b/Math.cos(x))/Math.log(V_(x)/A),this.f=b*Math.pow(V_(p),this.n)/this.n}project(r,l){l=Z(l),this.southernCenter&&(l=-l),r=Z(r-this.center[0]);const h=1e-6,{n:p,f:x}=this;x>0?l<-Tg+h&&(l=-Tg+h):l>Tg-h&&(l=Tg-h);const b=x/Math.pow(V_(l),p);let A=b*Math.sin(p*r),P=x-b*Math.cos(p*r);return A=.5*(A/Math.PI+.5),P=.5*(P/Math.PI+.5),{x:A,y:this.southernCenter?P:1-P,z:0}}unproject(r,l){r=(2*r-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:h,f:p}=this,x=p-l,b=Math.sign(x),A=Math.sign(h)*Math.sqrt(r*r+x*x);let P=Math.atan2(r,Math.abs(x))*b;x*h<0&&(P-=Math.PI*Math.sign(r)*b);const k=De(Ee(P/h)+this.center[0],-180,180),q=De(Ee(2*Math.atan(Math.pow(p/A,1/h))-Tg),-Ha,Ha);return new ai(k,this.southernCenter?-q:q)}}class d4 extends Cp{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,l){return{x:ta(r),y:Ca(l),z:0}}unproject(r,l){const h=zc(r),p=Ho(l);return new ai(h,p)}}const f4=Z(Ha);class LC extends Cp{project(r,l){const h=(l=Z(l))*l,p=h*h;return{x:.5*((r=Z(r))*(.8707-.131979*h+p*(p*(.003971*h-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+h*(.015085+p*(.028874*h-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,p=25,x=0,b=h*h;do{b=h*h;const k=b*b;x=(h*(1.007226+b*(.015085+k*(.028874*b-.044475-.005916*k)))-l)/(1.007226+b*(.045255+k*(.259866*b-.311325-.005916*11*k))),h=De(h-x,-f4,f4)}while(Math.abs(x)>1e-6&&--p>0);b=h*h;const A=De(Ee(r/(.8707+b*(b*(b*b*b*(.003971-.001529*b)-.013791)-.131979))),-180,180),P=Ee(h);return new ai(A,P)}}const p4=Z(Ha);class PC extends Cp{project(r,l){l=Z(l),r=Z(r);const h=Math.cos(l),p=2/Math.PI,x=Math.acos(h*Math.cos(r/2)),b=Math.sin(x)/x,A=.5*(r*p+2*h*Math.sin(r/2)/b)||0,P=.5*(l+Math.sin(l)/b)||0;return{x:.5*(A/Math.PI+.5),y:1-.5*(P/Math.PI+1),z:0}}unproject(r,l){let h=r=(2*r-.5)*Math.PI,p=l=(2*(1-l)-1)*Math.PI,x=25;const b=1e-6;let A=0,P=0;do{const k=Math.cos(p),q=Math.sin(p),K=2*q*k,te=q*q,ue=k*k,pe=Math.cos(h/2),Se=Math.sin(h/2),Ge=2*pe*Se,at=Se*Se,xt=1-ue*pe*pe,lt=xt?1/xt:0,yt=xt?Math.acos(k*pe)*Math.sqrt(1/xt):0,It=.5*(2*yt*k*Se+2*h/Math.PI)-r,Tt=.5*(yt*q+p)-l,ln=.5*lt*(ue*at+yt*k*pe*te)+1/Math.PI,en=lt*(Ge*K/4-yt*q*Se),wn=.125*lt*(K*Se-yt*q*ue*Ge),jn=.5*lt*(te*pe+yt*at*k)+.5,dn=en*wn-jn*ln;A=(Tt*en-It*jn)/dn,P=(It*wn-Tt*ln)/dn,h=De(h-A,-Math.PI,Math.PI),p=De(p-P,-p4,p4)}while((Math.abs(A)>b||Math.abs(P)>b)&&--x>0);return new ai(Ee(h),Ee(p))}}class m4 extends Cp{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Z(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){const{scale:h,cosPhi:p}=this;return{x:Z(r)*p*h+.5,y:-Math.sin(Z(l))/p*h+.5,z:0}}unproject(r,l){const{scale:h,cosPhi:p}=this,x=-(l-.5)/h,b=De(Ee((r-.5)/h)/p,-180,180),A=Math.asin(De(x*p,-1,1)),P=De(Ee(A),-Ha,Ha);return new ai(b,P)}}class kC extends d4{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,l,h){const p=Nh(r,l,h);return ti(p,p,Fu(yu(h))),{x:p[0],y:p[1],z:p[2]}}locationPoint(r,l){const h=_u(l.lat,l.lng),p=Xr([],h),x=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(l),r._centerAltitude):r._centerAltitude;gr(h,h,p,al(1,0)*_t*x);const b=Zt(new Float64Array(16));return Br(b,r.pixelMatrix,r.globeMatrix),ti(h,h,b),new $(h[0],h[1])}pixelsPerMeter(r,l){return al(1,0)*l}pixelSpaceConversion(r,l,h){const p=al(1,r)*l,x=$e(al(1,45)*l,p,h);return this.pixelsPerMeter(r,l)/x}createTileMatrix(r,l,h){const p=ig(yu(h.canonical));return Br(new Float64Array(16),r.globeMatrix,p)}createInversionMatrix(r,l){const{center:h}=r,p=Fu(yu(l));return Ei(p,p,Z(h.lng)),vr(p,p,Z(h.lat)),Gn(p,p,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(r,l,h,p){return rm(r,l,h,!0)||new of(0,0)}pointCoordinate3D(r,l,h){const p=this.pointCoordinate(r,l,h,0);return[p.x,p.y,p.z]}isPointAboveHorizon(r,l){return!rm(r,l.x,l.y,!1)}farthestPixelDistance(r){const l=(function(p,x){const b=p.cameraToCenterDistance,A=p._centerAltitude*x,P=p._camera,k=p._camera.forward(),q=Vr([],Rn([],k,-b),[0,0,A]),K=p.worldSize/(2*Math.PI),te=[0,0,-K],ue=p.width/p.height,pe=Math.tan(p.fovAboveCenter),Se=Rn([],P.up(),pe),Ge=Rn([],P.right(),pe*ue),at=Xr([],Vr([],Vr([],k,Se),Ge)),xt=[];let lt;if(new Md(q,at).closestPointOnSphere(te,K,xt)){const yt=Vr([],xt,te),It=bs([],yt,q);lt=Math.cos(p.fovAboveCenter)*Ri(It)}else{const yt=bs([],q,te),It=bs([],te,q);Xr(It,It);const Tt=Ri(yt)-K;lt=Math.sqrt(Tt*(Tt+2*K));const ln=Math.acos(lt/(K+Tt))-Math.acos(Ni(k,It));lt*=Math.cos(ln)}return 1.01*lt})(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),h=xp(r.zoom);if(h>0){const p=h4(r,al(1,r.center.lat)*r.worldSize),x=r.worldSize/(2*Math.PI),b=Math.max(r.width,r.height)/r.worldSize*Math.PI;return $e(l,p+x*(1-Math.cos(b)),Math.pow(h,10))}return l}upVector(r,l,h){return Nh(l,h,r,1)}upVectorScale(r){return{metersToTile:tf(sm(yu(r)))}}}function g4(s){const r=s.parallels,l=!!r&&Math.abs(r[0]+r[1])<.01;switch(s.name){case"mercator":return new d4(s);case"equirectangular":return new IC(s);case"naturalEarth":return new LC(s);case"equalEarth":return new TC(s);case"winkelTripel":return new PC(s);case"albers":return l?new m4(s):new AC(s);case"lambertConformalConic":return l?new m4(s):new CC(s);case"globe":return new kC(s)}throw new Error(`Invalid projection name: ${s.name}`)}const MC=Pi.types,RC=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function q_(s,r,l,h,p,x,b,A,P,k,q,K,te){const ue=A?Math.min(Ip,Math.round(A[0])):0,pe=A?Math.min(Ip,Math.round(A[1])):0;s.emplaceBack(r,l,Math.round(32*h),Math.round(32*p),x,b,(ue<<1)+(P?1:0),pe,16*k,16*q,256*K,256*te)}function $_(s,r,l,h,p,x,b){s.emplaceBack(r,l,h,p,x,b)}function G_(s,r,l,h,p){s.emplaceBack(r,l,h,p),s.emplaceBack(r,l,h,p),s.emplaceBack(r,l,h,p),s.emplaceBack(r,l,h,p)}function NC(s){for(const r of s.sections)if(Qt(r.text))return!0;return!1}class Tx{constructor(r){this.layoutVertexArray=new _n,this.indexArray=new _r,this.programConfigurations=r,this.segments=new Lt,this.dynamicLayoutVertexArray=new In,this.opacityVertexArray=new cr,this.placedSymbolArray=new Qs,this.globeExtVertexArray=new Mn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,l,h,p){this.isEmpty()||(h&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,V8.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,$8.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,RC,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,q8.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}sr(Tx,"SymbolBuffers");class Ix{constructor(r,l,h){this.layoutVertexArray=new r,this.layoutAttributes=l,this.indexArray=new h,this.segments=new Lt,this.collisionVertexArray=new Wr,this.collisionVertexArrayExt=new hi}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,G8.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,W8.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}sr(Ix,"CollisionBuffers");class Lp{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((b=>b.id)),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Zt([]),this.placementViewportMatrix=Zt([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=mx(this.zoom,l["text-size"]),this.iconSizeData=mx(this.zoom,l["icon-size"]);const h=this.layers[0].layout,p=h.get("symbol-sort-key"),x=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map((b=>Yh[b])),this.stateDependentLayerIds=this.layers.filter((b=>b.isStateDependent())).map((b=>b.id)),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new Tx(new Nu(this.layers,this.zoom,(r=>/^text/.test(r)))),this.icon=new Tx(new Nu(this.layers,this.zoom,(r=>/^icon/.test(r)))),this.glyphOffsetArray=new vs,this.lineVertexArray=new Fo,this.symbolInstances=new Wo}calculateGlyphDependencies(r,l,h,p,x){for(let b=0;b<r.length;b++)if(l[r.charCodeAt(b)]=!0,p&&x){const A=X0[r.charAt(b)];A&&(l[A.charCodeAt(0)]=!0)}}populate(r,l,h,p){const x=this.layers[0],b=x.layout,A=this.projection.name==="globe",P=b.get("text-font"),k=b.get("text-field"),q=b.get("icon-image"),K=(k.value.kind!=="constant"||k.value.value instanceof Ao&&!k.value.value.isEmpty()||k.value.value.toString().length>0)&&(P.value.kind!=="constant"||P.value.value.length>0),te=q.value.kind!=="constant"||!!q.value.value||Object.keys(q.parameters).length>0,ue=b.get("symbol-sort-key");if(this.features=[],!K&&!te)return;const pe=l.iconDependencies,Se=l.glyphDependencies,Ge=l.availableImages,at=new G(this.zoom);for(const{feature:xt,id:lt,index:yt,sourceLayerIndex:It}of r){const Tt=x._featureFilter.needGeometry,ln=md(xt,Tt);if(!x._featureFilter.filter(at,ln,h))continue;if(Tt||(ln.geometry=vu(xt,h,p)),A&&xt.type!==1&&h.z<=5){const dn=ln.geometry,Pn=.98078528056,kn=(On,Wn)=>Ni(Nh(On.x,On.y,h,1),Nh(Wn.x,Wn.y,h,1))<Pn;for(let On=0;On<dn.length;On++)dn[On]=wp(dn[On],kn)}let en,wn;if(K){const dn=x.getValueAndResolveTokens("text-field",ln,h,Ge),Pn=Ao.factory(dn);NC(Pn)&&(this.hasRTLText=!0),(!this.hasRTLText||T()==="unavailable"||this.hasRTLText&&B.isParsed())&&(en=K8(Pn,x,ln))}if(te){const dn=x.getValueAndResolveTokens("icon-image",ln,h,Ge);wn=dn instanceof Vs?dn:Vs.fromString(dn)}if(!en&&!wn)continue;const jn=this.sortFeaturesByKey?ue.evaluate(ln,{},h):void 0;if(this.features.push({id:lt,text:en,icon:wn,index:yt,sourceLayerIndex:It,geometry:ln.geometry,properties:xt.properties,type:MC[xt.type],sortKey:jn}),wn&&(pe[wn.name]=!0),en){const dn=P.evaluate(ln,{},h).join(","),Pn=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Yh.vertical)>=0;for(const kn of en.sections)if(kn.image)pe[kn.image.name]=!0;else{const On=Ce(en.toString()),Wn=kn.fontStack||dn,xn=Se[Wn]=Se[Wn]||{};this.calculateGlyphDependencies(kn.text,xn,Pn,this.allowVerticalPlacement,On)}}}b.get("symbol-placement")==="line"&&(this.features=(function(xt){const lt={},yt={},It=[];let Tt=0;function ln(dn){It.push(xt[dn]),Tt++}function en(dn,Pn,kn){const On=yt[dn];return delete yt[dn],yt[Pn]=On,It[On].geometry[0].pop(),It[On].geometry[0]=It[On].geometry[0].concat(kn[0]),On}function wn(dn,Pn,kn){const On=lt[Pn];return delete lt[Pn],lt[dn]=On,It[On].geometry[0].shift(),It[On].geometry[0]=kn[0].concat(It[On].geometry[0]),On}function jn(dn,Pn,kn){const On=kn?Pn[0][Pn[0].length-1]:Pn[0][0];return`${dn}:${On.x}:${On.y}`}for(let dn=0;dn<xt.length;dn++){const Pn=xt[dn],kn=Pn.geometry,On=Pn.text?Pn.text.toString():null;if(!On){ln(dn);continue}const Wn=jn(On,kn),xn=jn(On,kn,!0);if(Wn in yt&&xn in lt&&yt[Wn]!==lt[xn]){const dr=wn(Wn,xn,kn),Nr=en(Wn,xn,It[dr].geometry);delete lt[Wn],delete yt[xn],yt[jn(On,It[Nr].geometry,!0)]=Nr,It[dr].geometry=null}else Wn in yt?en(Wn,xn,kn):xn in lt?wn(Wn,xn,kn):(ln(dn),lt[Wn]=Tt-1,yt[xn]=Tt-1)}return It.filter((dn=>dn.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((xt,lt)=>xt.sortKey-lt.sortKey))}update(r,l,h,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,l,this.layers,h,p),this.icon.programConfigurations.updatePaintArrays(r,l,this.layers,h,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=g4(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,l){const h=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:p,y:x}of l)this.lineVertexArray.emplaceBack(p,x);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(r,l,h,p,x,b,A,P,k,q,K,te,ue,pe){const Se=r.indexArray,Ge=r.layoutVertexArray,at=r.globeExtVertexArray,xt=r.segments.prepareSegment(4*l.length,Ge,Se,this.canOverlap?b.sortKey:void 0),lt=this.glyphOffsetArray.length,yt=xt.vertexLength,It=this.allowVerticalPlacement&&A===Yh.vertical?Math.PI/2:0,Tt=b.text&&b.text.sections;for(let en=0;en<l.length;en++){const{tl:wn,tr:jn,bl:dn,br:Pn,tex:kn,pixelOffsetTL:On,pixelOffsetBR:Wn,minFontScaleX:xn,minFontScaleY:dr,glyphOffset:Nr,isSDF:mr,sectionIndex:$i}=l[en],Xn=xt.vertexLength,ri=Nr[1];if(q_(Ge,k.x,k.y,wn.x,ri+wn.y,kn.x,kn.y,h,mr,On.x,On.y,xn,dr),q_(Ge,k.x,k.y,jn.x,ri+jn.y,kn.x+kn.w,kn.y,h,mr,Wn.x,On.y,xn,dr),q_(Ge,k.x,k.y,dn.x,ri+dn.y,kn.x,kn.y+kn.h,h,mr,On.x,Wn.y,xn,dr),q_(Ge,k.x,k.y,Pn.x,ri+Pn.y,kn.x+kn.w,kn.y+kn.h,h,mr,Wn.x,Wn.y,xn,dr),P){const{x:Gi,y:Ko,z:Wi}=P.anchor,[bi,da,Zi]=P.up;$_(at,Gi,Ko,Wi,bi,da,Zi),$_(at,Gi,Ko,Wi,bi,da,Zi),$_(at,Gi,Ko,Wi,bi,da,Zi),$_(at,Gi,Ko,Wi,bi,da,Zi),G_(r.dynamicLayoutVertexArray,Gi,Ko,Wi,It)}else G_(r.dynamicLayoutVertexArray,k.x,k.y,k.z,It);Se.emplaceBack(Xn,Xn+1,Xn+2),Se.emplaceBack(Xn+1,Xn+2,Xn+3),xt.vertexLength+=4,xt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Nr[0]),en!==l.length-1&&$i===l[en+1].sectionIndex||r.programConfigurations.populatePaintArrays(Ge.length,b,b.index,{},ue,pe,Tt&&Tt[$i])}const ln=P?P.anchor:k;r.placedSymbolArray.emplaceBack(ln.x,ln.y,ln.z,k.x,k.y,lt,this.glyphOffsetArray.length-lt,yt,q,K,k.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],A,0,!1,0,te,0)}_commitLayoutVertex(r,l,h,p,x,b,A){r.emplaceBack(l,h,p,x,b,Math.round(A.x),Math.round(A.y))}_addCollisionDebugVertices(r,l,h,p,x,b,A){const P=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),k=P.vertexLength,q=A.tileAnchorX,K=A.tileAnchorY;for(let ue=0;ue<4;ue++)h.collisionVertexArray.emplaceBack(0,0,0,0);h.collisionVertexArrayExt.emplaceBack(l,-r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(l,r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(l,r.padding,r.padding),h.collisionVertexArrayExt.emplaceBack(l,-r.padding,r.padding),this._commitLayoutVertex(h.layoutVertexArray,p,x,b,q,K,new $(r.x1,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,x,b,q,K,new $(r.x2,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,x,b,q,K,new $(r.x2,r.y2)),this._commitLayoutVertex(h.layoutVertexArray,p,x,b,q,K,new $(r.x1,r.y2)),P.vertexLength+=4;const te=h.indexArray;te.emplaceBack(k,k+1),te.emplaceBack(k+1,k+2),te.emplaceBack(k+2,k+3),te.emplaceBack(k+3,k),P.primitiveLength+=4}_addTextDebugCollisionBoxes(r,l,h,p,x,b){for(let A=p;A<x;A++){const P=h.get(A),k=this.getSymbolInstanceTextSize(r,b,l,A);this._addCollisionDebugVertices(P,k,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(r,l,h,p,x,b){for(let A=p;A<x;A++){const P=h.get(A),k=this.getSymbolInstanceIconSize(r,l,b.placedIconSymbolIndex);this._addCollisionDebugVertices(P,k,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,b)}}generateCollisionDebugBuffers(r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ix(er,D3.members,ps),this.iconCollisionBox=new Ix(er,D3.members,ps);const h=_g(this.iconSizeData,r),p=_g(this.textSizeData,r);for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(p,r,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(p,r,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,r,l,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,r,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(r,l,h,p){const x=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:p),b=R_(this.textSizeData,r,x)/iu;return this.tilePixelRatio*b}getSymbolInstanceIconSize(r,l,h){const p=this.icon.placedSymbolArray.get(h),x=R_(this.iconSizeData,r,p);return this.tilePixelRatio*x}_commitDebugCollisionVertexUpdate(r,l,h){r.emplaceBack(l,-h,-h),r.emplaceBack(l,h,-h),r.emplaceBack(l,h,h),r.emplaceBack(l,-h,h)}_updateTextDebugCollisionBoxes(r,l,h,p,x,b){for(let A=p;A<x;A++){const P=h.get(A),k=this.getSymbolInstanceTextSize(r,b,l,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,k,P.padding)}}_updateIconDebugCollisionBoxes(r,l,h,p,x,b){for(let A=p;A<x;A++){const P=h.get(A),k=this.getSymbolInstanceIconSize(r,l,b);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,k,P.padding)}}updateCollisionDebugBuffers(r,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=_g(this.iconSizeData,r),p=_g(this.textSizeData,r);for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(p,r,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._updateTextDebugCollisionBoxes(p,r,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._updateIconDebugCollisionBoxes(h,r,l,b.iconBoxStartIndex,b.iconBoxEndIndex,b.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(h,r,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,l,h,p,x,b,A,P,k){const q={};if(l<h){const{x1:K,y1:te,x2:ue,y2:pe,padding:Se,projectedAnchorX:Ge,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:yt,featureIndex:It}=r.get(l);q.textBox={x1:K,y1:te,x2:ue,y2:pe,padding:Se,projectedAnchorX:Ge,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:yt},q.textFeatureIndex=It}if(p<x){const{x1:K,y1:te,x2:ue,y2:pe,padding:Se,projectedAnchorX:Ge,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:yt,featureIndex:It}=r.get(p);q.verticalTextBox={x1:K,y1:te,x2:ue,y2:pe,padding:Se,projectedAnchorX:Ge,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:yt},q.verticalTextFeatureIndex=It}if(b<A){const{x1:K,y1:te,x2:ue,y2:pe,padding:Se,projectedAnchorX:Ge,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:yt,featureIndex:It}=r.get(b);q.iconBox={x1:K,y1:te,x2:ue,y2:pe,padding:Se,projectedAnchorX:Ge,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:yt},q.iconFeatureIndex=It}if(P<k){const{x1:K,y1:te,x2:ue,y2:pe,padding:Se,projectedAnchorX:Ge,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:yt,featureIndex:It}=r.get(P);q.verticalIconBox={x1:K,y1:te,x2:ue,y2:pe,padding:Se,projectedAnchorX:Ge,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:yt},q.verticalIconFeatureIndex=It}return q}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,l){const h=r.placedSymbolArray.get(l),p=h.vertexStartIndex+4*h.numGlyphs;for(let x=h.vertexStartIndex;x<p;x+=4)r.indexArray.emplaceBack(x,x+1,x+2),r.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(r),h=Math.cos(r),p=[],x=[],b=[];for(let A=0;A<this.symbolInstances.length;++A){b.push(A);const P=this.symbolInstances.get(A);p.push(0|Math.round(l*P.tileAnchorX+h*P.tileAnchorY)),x.push(P.featureIndex)}return b.sort(((A,P)=>p[A]-p[P]||x[P]-x[A])),b}addToSortKeyRanges(r,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:x,leftJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:A,placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:k}=h;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),x>=0&&x!==p&&this.addIndicesForPlacedSymbol(this.text,x),b>=0&&b!==x&&b!==p&&this.addIndicesForPlacedSymbol(this.text,b),A>=0&&this.addIndicesForPlacedSymbol(this.text,A),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P),k>=0&&this.addIndicesForPlacedSymbol(this.icon,k)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}sr(Lp,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Lp.MAX_GLYPHS=65535,Lp.addDynamicAttributes=G_;const DC=new st({"symbol-placement":new ve(pn.layout_symbol["symbol-placement"]),"symbol-spacing":new ve(pn.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ve(pn.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ue(pn.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ve(pn.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ve(pn.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ve(pn.layout_symbol["icon-ignore-placement"]),"icon-optional":new ve(pn.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ve(pn.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ue(pn.layout_symbol["icon-size"]),"icon-text-fit":new ve(pn.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ve(pn.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ue(pn.layout_symbol["icon-image"]),"icon-rotate":new Ue(pn.layout_symbol["icon-rotate"]),"icon-padding":new ve(pn.layout_symbol["icon-padding"]),"icon-keep-upright":new ve(pn.layout_symbol["icon-keep-upright"]),"icon-offset":new Ue(pn.layout_symbol["icon-offset"]),"icon-anchor":new Ue(pn.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ve(pn.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ve(pn.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ve(pn.layout_symbol["text-rotation-alignment"]),"text-field":new Ue(pn.layout_symbol["text-field"]),"text-font":new Ue(pn.layout_symbol["text-font"]),"text-size":new Ue(pn.layout_symbol["text-size"]),"text-max-width":new Ue(pn.layout_symbol["text-max-width"]),"text-line-height":new Ue(pn.layout_symbol["text-line-height"]),"text-letter-spacing":new Ue(pn.layout_symbol["text-letter-spacing"]),"text-justify":new Ue(pn.layout_symbol["text-justify"]),"text-radial-offset":new Ue(pn.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ve(pn.layout_symbol["text-variable-anchor"]),"text-anchor":new Ue(pn.layout_symbol["text-anchor"]),"text-max-angle":new ve(pn.layout_symbol["text-max-angle"]),"text-writing-mode":new ve(pn.layout_symbol["text-writing-mode"]),"text-rotate":new Ue(pn.layout_symbol["text-rotate"]),"text-padding":new ve(pn.layout_symbol["text-padding"]),"text-keep-upright":new ve(pn.layout_symbol["text-keep-upright"]),"text-transform":new Ue(pn.layout_symbol["text-transform"]),"text-offset":new Ue(pn.layout_symbol["text-offset"]),"text-allow-overlap":new ve(pn.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ve(pn.layout_symbol["text-ignore-placement"]),"text-optional":new ve(pn.layout_symbol["text-optional"])});var Cx={paint:new st({"icon-opacity":new Ue(pn.paint_symbol["icon-opacity"]),"icon-color":new Ue(pn.paint_symbol["icon-color"]),"icon-halo-color":new Ue(pn.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ue(pn.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ue(pn.paint_symbol["icon-halo-blur"]),"icon-translate":new ve(pn.paint_symbol["icon-translate"]),"icon-translate-anchor":new ve(pn.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ue(pn.paint_symbol["text-opacity"]),"text-color":new Ue(pn.paint_symbol["text-color"],{runtimeType:aa,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Ue(pn.paint_symbol["text-halo-color"]),"text-halo-width":new Ue(pn.paint_symbol["text-halo-width"]),"text-halo-blur":new Ue(pn.paint_symbol["text-halo-blur"]),"text-translate":new ve(pn.paint_symbol["text-translate"]),"text-translate-anchor":new ve(pn.paint_symbol["text-translate-anchor"])}),layout:DC};class y4{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Us,this.defaultValue=r}evaluate(r){if(r.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(r.formattedSection))return l.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}sr(y4,"FormatSectionOverride",{omit:["defaultValue"]});class W_ extends nt{constructor(r){super(r,Cx)}recalculate(r,l){super.recalculate(r,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const p=[];for(const x of h)p.indexOf(x)<0&&p.push(x);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,l,h,p){const x=this.layout.get(r).evaluate(l,{},h,p),b=this._unevaluatedLayout._values[r];return b.isDataDriven()||Aa(b.value)||!x?x:(function(A,P){return P.replace(/{([^{}]+)}/g,((k,q)=>q in A?String(A[q]):""))})(l.properties,x)}createBucket(r){return new Lp(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of Cx.paint.overridableProperties){if(!W_.hasPaintOverride(this.layout,r))continue;const l=this.paint.get(r),h=new y4(l),p=new Pc(h,l.property.specification);let x=null;x=l.value.kind==="constant"||l.value.kind==="source"?new Vh("source",p):new kc("composite",p,l.value.zoomStops,l.value._interpolationType),this.paint._values[r]=new je(l.property,x,l.parameters)}}_handleOverridablePaintPropertyUpdate(r,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&W_.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,l){const h=r.get("text-field"),p=Cx.paint.properties[l];let x=!1;const b=A=>{for(const P of A)if(p.overrides&&p.overrides.hasOverride(P))return void(x=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Ao)b(h.value.value.sections);else if(h.value.kind==="source"){const A=k=>{x||(k instanceof Oo&&To(k.value)===dl?b(k.value.sections):k instanceof Ma?b(k.sections):k.eachChild(A))},P=h.value;P._styleExpression&&A(P._styleExpression.expression)}return x}getProgramConfiguration(r){return new th(this,r)}}var FC={paint:new st({"background-color":new ve(pn.paint_background["background-color"]),"background-pattern":new ve(pn.paint_background["background-pattern"]),"background-opacity":new ve(pn.paint_background["background-opacity"])})},OC={paint:new st({"raster-opacity":new ve(pn.paint_raster["raster-opacity"]),"raster-hue-rotate":new ve(pn.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ve(pn.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ve(pn.paint_raster["raster-brightness-max"]),"raster-saturation":new ve(pn.paint_raster["raster-saturation"]),"raster-contrast":new ve(pn.paint_raster["raster-contrast"]),"raster-resampling":new ve(pn.paint_raster["raster-resampling"]),"raster-fade-duration":new ve(pn.paint_raster["raster-fade-duration"])})};class BC extends nt{constructor(r){super(r,{}),this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var zC={paint:new st({"sky-type":new ve(pn.paint_sky["sky-type"]),"sky-atmosphere-sun":new ve(pn.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ve(pn.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ve(pn.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ve(pn.paint_sky["sky-gradient-radius"]),"sky-gradient":new rt(pn.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ve(pn.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ve(pn.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ve(pn.paint_sky["sky-opacity"])})};function Lx(s,r,l){const h=[0,0,1],p=Rh([]);return hd(p,p,l?-Z(s)+Math.PI:Z(s)),yc(p,p,-Z(r)),cs(h,h,p),Xr(h,h)}const jC={circle:class extends nt{constructor(s){super(s,T_)}createBucket(s){return new Vf(s)}queryRadius(s){const r=s;return qf("circle-radius",this,r)+qf("circle-stroke-width",this,r)+Sp(this.paint.get("circle-translate"))}queryIntersectsFeature(s,r,l,h,p,x,b,A){const P=ug(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),k=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l);return R0(s,h,x,b,A,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",P,k)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new th(this,s)}},heatmap:class extends nt{createBucket(s){return new D0(s)}constructor(s){super(s,xl),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=B0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return qf("heatmap-radius",this,s)}queryIntersectsFeature(s,r,l,h,p,x,b,A){const P=this.paint.get("heatmap-radius").evaluate(r,l);return R0(s,h,x,b,A,!0,!0,new $(0,0),P)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new th(this,s)}},hillshade:class extends nt{constructor(s){super(s,I_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends nt{constructor(s){super(s,X)}getProgramIds(){const s=this.paint.get("fill-pattern"),r=s&&s.constantOr(1),l=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(s){return new th(this,s)}recalculate(s,r){super.recalculate(s,r);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new E(s)}queryRadius(){return Sp(this.paint.get("fill-translate"))}queryIntersectsFeature(s,r,l,h,p,x){return!s.queryGeometry.isAboveHorizon&&um(af(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}},"fill-extrusion":class extends nt{constructor(s){super(s,N8)}createBucket(s){return new G0(s)}queryRadius(){return Sp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new th(this,s)}queryIntersectsFeature(s,r,l,h,p,x,b,A,P){const k=ug(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),q=this.paint.get("fill-extrusion-height").evaluate(r,l),K=this.paint.get("fill-extrusion-base").evaluate(r,l),te=[0,0],ue=A&&x.elevation,pe=x.elevation?x.elevation.exaggeration():1,Se=s.tile.getBucket(this);if(ue&&Se instanceof G0){const yt=Se.centroidVertexArray,It=P+1;It<yt.length&&(te[0]=yt.geta_centroid_pos0(It),te[1]=yt.geta_centroid_pos1(It))}if(te[0]===0&&te[1]===1)return!1;x.projection.name==="globe"&&(h=I3([h],[new $(0,0),new $(_t,_t)],s.tileID.canonical).map((yt=>yt.polygon)).flat());const Ge=ue?A:null,[at,xt]=(function(yt,It,Tt,ln,en,wn,jn,dn,Pn,kn,On){return yt.projection.name==="globe"?(function(Wn,xn,dr,Nr,mr,$i,Xn,ri,Gi,Ko,Wi){const bi=[],da=[],Zi=Wn.projection.upVectorScale(Wi,Wn.center.lat,Wn.worldSize).metersToTile,Yi=[0,0,0,1],Fs=[0,0,0,1],ra=(Os,Ba,ll,kl)=>{Os[0]=Ba,Os[1]=ll,Os[2]=kl,Os[3]=1},ia=T3();dr>0&&(dr+=ia),Nr+=ia;for(const Os of xn){const Ba=[],ll=[];for(const kl of Os){const Bs=kl.x+mr.x,Jl=kl.y+mr.y,Ml=Wn.projection.projectTilePoint(Bs,Jl,Wi),Ka=Wn.projection.upVector(Wi,kl.x,kl.y);let is=dr,Rl=Nr;if(Xn){const oa=k3(Bs,Jl,dr,Nr,Xn,ri,Gi,Ko);is+=oa.base,Rl+=oa.top}dr!==0?ra(Yi,Ml.x+Ka[0]*Zi*is,Ml.y+Ka[1]*Zi*is,Ml.z+Ka[2]*Zi*is):ra(Yi,Ml.x,Ml.y,Ml.z),ra(Fs,Ml.x+Ka[0]*Zi*Rl,Ml.y+Ka[1]*Zi*Rl,Ml.z+Ka[2]*Zi*Rl),ti(Yi,Yi,$i),ti(Fs,Fs,$i),Ba.push(new yg(Yi[0],Yi[1],Yi[2])),ll.push(new yg(Fs[0],Fs[1],Fs[2]))}bi.push(Ba),da.push(ll)}return[bi,da]})(yt,It,Tt,ln,en,wn,jn,dn,Pn,kn,On):jn?(function(Wn,xn,dr,Nr,mr,$i,Xn,ri,Gi){const Ko=[],Wi=[],bi=[0,0,0,1];for(const da of Wn){const Zi=[],Yi=[];for(const Fs of da){const ra=Fs.x+Nr.x,ia=Fs.y+Nr.y,Os=k3(ra,ia,xn,dr,$i,Xn,ri,Gi);bi[0]=ra,bi[1]=ia,bi[2]=Os.base,bi[3]=1,_l(bi,bi,mr),bi[3]=Math.max(bi[3],1e-5);const Ba=new yg(bi[0]/bi[3],bi[1]/bi[3],bi[2]/bi[3]);bi[0]=ra,bi[1]=ia,bi[2]=Os.top,bi[3]=1,_l(bi,bi,mr),bi[3]=Math.max(bi[3],1e-5);const ll=new yg(bi[0]/bi[3],bi[1]/bi[3],bi[2]/bi[3]);Zi.push(Ba),Yi.push(ll)}Ko.push(Zi),Wi.push(Yi)}return[Ko,Wi]})(It,Tt,ln,en,wn,jn,dn,Pn,kn):(function(Wn,xn,dr,Nr,mr){const $i=[],Xn=[],ri=mr[8]*xn,Gi=mr[9]*xn,Ko=mr[10]*xn,Wi=mr[11]*xn,bi=mr[8]*dr,da=mr[9]*dr,Zi=mr[10]*dr,Yi=mr[11]*dr;for(const Fs of Wn){const ra=[],ia=[];for(const Os of Fs){const Ba=Os.x+Nr.x,ll=Os.y+Nr.y,kl=mr[0]*Ba+mr[4]*ll+mr[12],Bs=mr[1]*Ba+mr[5]*ll+mr[13],Jl=mr[2]*Ba+mr[6]*ll+mr[14],Ml=mr[3]*Ba+mr[7]*ll+mr[15],Ka=kl+ri,is=Bs+Gi,Rl=Jl+Ko,oa=Math.max(Ml+Wi,1e-5),sh=kl+bi,Nl=Bs+da,ou=Jl+Zi,Vc=Math.max(Ml+Yi,1e-5);ra.push(new yg(Ka/oa,is/oa,Rl/oa)),ia.push(new yg(sh/Vc,Nl/Vc,ou/Vc))}$i.push(ra),Xn.push(ia)}return[$i,Xn]})(It,Tt,ln,en,wn)})(x,h,K,q,k,b,Ge,te,pe,x.center.lat,s.tileID.canonical),lt=s.queryGeometry;return(function(yt,It,Tt){let ln=1/0;um(Tt,It)&&(ln=P3(Tt,It[0]));for(let en=0;en<It.length;en++){const wn=It[en],jn=yt[en];for(let dn=0;dn<wn.length-1;dn++){const Pn=wn[dn],kn=[Pn,wn[dn+1],jn[dn+1],jn[dn],Pn];ag(Tt,kn)&&(ln=Math.min(ln,P3(Tt,kn)))}}return ln!==1/0&&ln})(at,xt,lt.isPointQuery()?lt.screenBounds:lt.screenGeometry)}},line:class extends nt{constructor(s){super(s,M3),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof _e,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,r){super.recalculate(s,r),this.paint._values["line-floorwidth"]=R3.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new M_(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new th(this,s)}queryRadius(s){const r=s,l=N3(qf("line-width",this,r),qf("line-gap-width",this,r)),h=qf("line-offset",this,r);return l/2+Math.abs(h)+Sp(this.paint.get("line-translate"))}queryIntersectsFeature(s,r,l,h,p,x){if(s.queryGeometry.isAboveHorizon)return!1;const b=af(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),A=s.pixelToTileUnitsFactor/2*N3(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),P=this.paint.get("line-offset").evaluate(r,l);return P&&(h=(function(k,q){const K=[],te=new $(0,0);for(let ue=0;ue<k.length;ue++){const pe=k[ue],Se=[];for(let Ge=0;Ge<pe.length;Ge++){const at=pe[Ge],xt=pe[Ge+1],lt=Ge===0?te:at.sub(pe[Ge-1])._unit()._perp(),yt=Ge===pe.length-1?te:xt.sub(at)._unit()._perp(),It=lt._add(yt)._unit();It._mult(1/(It.x*yt.x+It.y*yt.y)),Se.push(It._mult(q)._add(at))}K.push(Se)}return K})(h,P*s.pixelToTileUnitsFactor)),(function(k,q,K){for(let te=0;te<q.length;te++){const ue=q[te];if(k.length>=3){for(let pe=0;pe<ue.length;pe++)if(Nd(k,ue[pe]))return!0}if(Bu(k,ue,K))return!0}return!1})(b,h,A)}isTileClipped(){return!0}},symbol:W_,background:class extends nt{constructor(s){super(s,FC)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends nt{constructor(s){super(s,OC)}getProgramIds(){return["raster"]}},sky:class extends nt{constructor(s){super(s,zC),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=B0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(s,r){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),p=!h,x=s.style.light,b=x.properties.get("position");return p&&x.properties.get("anchor")==="viewport"&&ur("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?Lx(b.azimuthal,90-b.polar,r):Lx(h[0],90-h[1],r)}const l=this.paint.get("sky-gradient-center");return Lx(l[0],90-l[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}}};class ny{constructor(r,l,h,p){this.context=r,this.format=h,this.texture=r.gl.createTexture(),this.update(l,p)}update(r,l,h){const{width:p,height:x}=r,{context:b}=this,{gl:A}=b,{HTMLImageElement:P,HTMLCanvasElement:k,HTMLVideoElement:q,ImageData:K,ImageBitmap:te}=w;if(A.bindTexture(A.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!l||l.premultiply!==!1)),h||this.size&&this.size[0]===p&&this.size[1]===x){const{x:ue,y:pe}=h||{x:0,y:0};r instanceof P||r instanceof k||r instanceof q||r instanceof K||te&&r instanceof te?A.texSubImage2D(A.TEXTURE_2D,0,ue,pe,A.RGBA,A.UNSIGNED_BYTE,r):A.texSubImage2D(A.TEXTURE_2D,0,ue,pe,p,x,A.RGBA,A.UNSIGNED_BYTE,r.data)}else this.size=[p,x],r instanceof P||r instanceof k||r instanceof q||r instanceof K||te&&r instanceof te?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,r):A.texImage2D(A.TEXTURE_2D,0,this.format,p,x,0,this.format,A.UNSIGNED_BYTE,r.data);this.useMipmap=!!(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&A.generateMipmap(A.TEXTURE_2D)}bind(r,l){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),r!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?r===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:r),this.filter=r),l!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,l),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class UC{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class VC{constructor(){this.tasks={},this.taskQueue=[],Jt(["process"],this),this.invoker=new UC(this.process),this.nextId=0}add(r,l){const h=this.nextId++,p=(function({type:x,isSymbolTile:b,zoom:A}){return A=A||0,x==="message"?0:x!=="maybePrepare"||b?x!=="parseTile"||b?x==="parseTile"&&b?300-A:x==="maybePrepare"&&b?400-A:500:200-A:100-A})(l);if(p===0){Tn();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[h]={fn:r,metadata:l,priority:p,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){Tn();try{if(this.taskQueue=this.taskQueue.filter((h=>!!this.tasks[h])),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const l=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let r=null,l=1/0;for(let p=0;p<this.taskQueue.length;p++){const x=this.tasks[this.taskQueue[p]];x.priority<l&&(l=x.priority,r=p)}if(r===null)return null;const h=this.taskQueue[r];return this.taskQueue.splice(r,1),h}remove(){this.invoker.remove()}}class _4{constructor(r){this._stringToNumber={},this._numberToString=[];for(let l=0;l<r.length;l++){const h=r[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const qC=["tile","layer","source","sourceLayer","state"];class v4{constructor(r,l,h,p,x){this.type="Feature",this._vectorTileFeature=r,this._z=l,this._x=h,this._y=p,this.properties=r.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(r.id=this.id);for(const l of qC)this[l]!==void 0&&(r[l]=this[l]);return r}}const yd=32,hf=33,Pp=new Uint16Array(8184);for(let s=0;s<2046;s++){let r=s+2,l=0,h=0,p=0,x=0,b=0,A=0;for(1&r?p=x=b=yd:l=h=A=yd;(r>>=1)>1;){const k=l+p>>1,q=h+x>>1;1&r?(p=l,x=h,l=b,h=A):(l=p,h=x,p=b,x=A),b=k,A=q}const P=4*s;Pp[P+0]=l,Pp[P+1]=h,Pp[P+2]=p,Pp[P+3]=x}const df=new Uint16Array(2178),kp=new Uint8Array(1089),H_=new Uint16Array(1089);function x4(s){return s===0?-.03125:s===32?.03125:0}var b4=kt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const w4={type:2,extent:_t,loadGeometry:()=>[[new $(0,0),new $(_t+1,0),new $(_t+1,_t+1),new $(0,_t+1),new $(0,0)]]};class Px{constructor(r,l,h,p,x){this.tileID=r,this.uid=et(),this.uses=0,this.tileSize=l,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(r){const l=r+this.timeAdded;l<Qo.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=xm(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,l,h){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=(function(p,x){const b={};if(!x)return b;for(const A of p){const P=A.layerIds.map((k=>x.getLayer(k))).filter(Boolean);if(P.length!==0){A.layers=P,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map((k=>P.filter((q=>q.id===k))[0])));for(const k of P)b[k.id]=A}}return b})(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const x=this.buckets[p];if(x instanceof Lp){if(this.hasSymbolBuckets=!0,!h)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const x=this.buckets[p];if(x instanceof Lp&&x.hasRTLText){this.hasRTLText=!0,B.isLoading()||B.isLoaded()||T()!=="deferred"||R();break}}this.queryPadding=0;for(const p in this.buckets){const x=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(p).queryRadius(x))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new Ki}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(r)}const l=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ny(r,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ny(r,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ny(r,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,l,h,p,x,b,A,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:A,transform:b,params:x,tileTransform:this.tileTransform},r,l,h):{}}querySourceFeatures(r,l){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const p=h.loadVTLayers(),x=l?l.sourceLayer:"",b=p._geojsonTileLayer||p[x];if(!b)return;const A=tu(l&&l.filter),{z:P,x:k,y:q}=this.tileID.canonical,K={z:P,x:k,y:q};for(let te=0;te<b.length;te++){const ue=b.feature(te);if(A.needGeometry){const Ge=md(ue,!0);if(!A.filter(new G(this.tileID.overscaledZ),Ge,this.tileID.canonical))continue}else if(!A.filter(new G(this.tileID.overscaledZ),ue))continue;const pe=h.getId(ue,x),Se=new v4(ue,P,k,q,pe);Se.tile=K,r.push(Se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const h=Yn(r.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const h=Date.now();let p=!1;if(this.expirationTime>h)p=!1;else if(l)if(this.expirationTime<l)p=!0;else{const x=this.expirationTime-l;x?this.expirationTime=h+Math.max(x,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0||!l)return;const h=this.latestFeatureIndex.loadVTLayers(),p=l.style.listImages();for(const x in this.buckets){if(!l.style.hasLayer(x))continue;const b=this.buckets[x],A=b.layers[0].sourceLayer||"_geojsonTileLayer",P=h[A],k=r[A];if(!P||!k||Object.keys(k).length===0)continue;if(b.update(k,P,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),b instanceof M_||b instanceof E){const K=l.style._getSourceCache(b.layers[0].source);l._terrain&&l._terrain.enabled&&K&&b.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(K.id,this.tileID)}const q=l&&l.style&&l.style.getLayer(x);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Qo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=Qo.now()+r}setTexture(r,l){const h=l.context,p=h.gl;this.texture=this.texture||l.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new ny(h,r,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(r,l){const h={};for(const p of l)h[p]=!0;this.dependencies[r]=h}hasDependency(r,l){for(const h of r){const p=this.dependencies[h];if(p){for(const x of l)if(p[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const h=vu(w4,this.tileID.canonical,this.tileTransform)[0],p=new gn,x=new il;for(let b=0;b<h.length;b++){const{x:A,y:P}=h[b];p.emplaceBack(A,P),x.emplaceBack(b)}x.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(x),this._tileDebugBuffer=r.createVertexBuffer(p,dd.members),this._tileDebugSegments=Lt.simpleSegment(0,0,p.length,x.length)}_makeTileBoundsBuffers(r,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const h=vu(w4,this.tileID.canonical,this.tileTransform)[0];let p,x;if(this.isRaster){const b=(function(A,P){const k=xm(A,P),q=Math.pow(2,A.z);for(let Ge=0;Ge<hf;Ge++)for(let at=0;at<hf;at++){const xt=zc((A.x+(at+x4(at))/yd)/q),lt=Ho((A.y+(Ge+x4(Ge))/yd)/q),yt=P.project(xt,lt),It=Ge*hf+at;df[2*It+0]=Math.round((yt.x*k.scale-k.x)*_t),df[2*It+1]=Math.round((yt.y*k.scale-k.y)*_t)}kp.fill(0),H_.fill(0);for(let Ge=2045;Ge>=0;Ge--){const at=4*Ge,xt=Pp[at+0],lt=Pp[at+1],yt=Pp[at+2],It=Pp[at+3],Tt=xt+yt>>1,ln=lt+It>>1,en=Tt+ln-lt,wn=ln+xt-Tt,jn=lt*hf+xt,dn=It*hf+yt,Pn=ln*hf+Tt,kn=Math.hypot((df[2*jn+0]+df[2*dn+0])/2-df[2*Pn+0],(df[2*jn+1]+df[2*dn+1])/2-df[2*Pn+1])>=16;kp[Pn]=kp[Pn]||(kn?1:0),Ge<1022&&(kp[Pn]=kp[Pn]||kp[(lt+wn>>1)*hf+(xt+en>>1)]||kp[(It+wn>>1)*hf+(yt+en>>1)])}const K=new un,te=new _r;let ue=0;function pe(Ge,at){const xt=at*hf+Ge;return H_[xt]===0&&(K.emplaceBack(df[2*xt+0],df[2*xt+1],Ge*_t/yd,at*_t/yd),H_[xt]=++ue),H_[xt]-1}function Se(Ge,at,xt,lt,yt,It){const Tt=Ge+xt>>1,ln=at+lt>>1;if(Math.abs(Ge-yt)+Math.abs(at-It)>1&&kp[ln*hf+Tt])Se(yt,It,Ge,at,Tt,ln),Se(xt,lt,yt,It,Tt,ln);else{const en=pe(Ge,at),wn=pe(xt,lt),jn=pe(yt,It);te.emplaceBack(en,wn,jn)}}return Se(0,0,yd,yd,yd,0),Se(yd,yd,0,0,0,yd),{vertices:K,indices:te}})(this.tileID.canonical,l);p=b.vertices,x=b.indices}else{p=new un,x=new _r;for(const{x:A,y:P}of h)p.emplaceBack(A,P,0,0);const b=mg(p.int16,void 0,4);for(let A=0;A<b.length;A+=3)x.emplaceBack(b[A],b[A+1],b[A+2])}this._tileBoundsBuffer=r.createVertexBuffer(p,b4.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(x),this._tileBoundsSegments=Lt.simpleSegment(0,0,p.length,x.length)}_makeGlobeTileDebugBuffers(r,l){const h=l.projection;if(!h||h.name!=="globe"||l.freezeTileCoverage)return;const p=this.tileID.canonical,x=Fu(im(p,l)),b=xp(l.zoom);let A;b>0&&(A=En(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,p,l,x,A,b),this._makeGlobeTileDebugTextBuffer(r,p,l,x,A,b)}_globePoint(r,l,h,p,x,b,A){let P=Nh(r,l,h);if(b){const k=1<<h.z,q=ta(p.center.lng),K=Ca(p.center.lat),te=(h.x+.5)/k-q;let ue=0;te>.5?ue=-1:te<-.5&&(ue=1);let pe=(r/_t+h.x)/k+ue,Se=(l/_t+h.y)/k;pe=(pe-q)*p._pixelsPerMercatorPixel+q,Se=(Se-K)*p._pixelsPerMercatorPixel+K;const Ge=[pe*p.worldSize,Se*p.worldSize,0];ti(Ge,Ge,b),P=Wh(P,Ge,A)}return ti(P,P,x)}_makeGlobeTileDebugBorderBuffer(r,l,h,p,x,b){const A=new gn,P=new il,k=new Ut,q=(te,ue,pe,Se,Ge)=>{const at=(pe-te)/(Ge-1),xt=(Se-ue)/(Ge-1),lt=A.length;for(let yt=0;yt<Ge;yt++){const It=te+yt*at,Tt=ue+yt*xt;A.emplaceBack(It,Tt);const ln=this._globePoint(It,Tt,l,h,p,x,b);k.emplaceBack(ln[0],ln[1],ln[2]),P.emplaceBack(lt+yt)}},K=_t;q(0,0,K,0,16),q(K,0,K,K,16),q(K,K,0,K,16),q(0,K,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(P),this._tileDebugBuffer=r.createVertexBuffer(A,dd.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(k,Du.members),this._tileDebugSegments=Lt.simpleSegment(0,0,A.length,P.length)}_makeGlobeTileDebugTextBuffer(r,l,h,p,x,b){const A=_t/4,P=new gn,k=new _r,q=new Ut,K=25;k.reserve(32),P.reserve(K),q.reserve(K);const te=(ue,pe)=>K*ue+pe;for(let ue=0;ue<K;ue++){const pe=ue*A;for(let Se=0;Se<K;Se++){const Ge=Se*A;P.emplaceBack(Ge,pe);const at=this._globePoint(Ge,pe,l,h,p,x,b);q.emplaceBack(at[0],at[1],at[2])}}for(let ue=0;ue<4;ue++)for(let pe=0;pe<4;pe++){const Se=te(ue,pe),Ge=te(ue,pe+1),at=te(ue+1,pe),xt=te(ue+1,pe+1);k.emplaceBack(Se,Ge,at),k.emplaceBack(at,Ge,xt)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(k),this._tileDebugTextBuffer=r.createVertexBuffer(P,dd.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(q,Du.members),this._tileDebugTextSegments=Lt.simpleSegment(0,0,K,32)}}class $C{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,h){const p=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][p]=this.stateChanges[r][p]||{},Fe(this.stateChanges[r][p],h),this.deletedStates[r]===null){this.deletedStates[r]={};for(const x in this.state[r])x!==p&&(this.deletedStates[r][x]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][p]===null){this.deletedStates[r][p]={};for(const x in this.state[r][p])h[x]||(this.deletedStates[r][p][x]=null)}else for(const x in h)this.deletedStates[r]&&this.deletedStates[r][p]&&this.deletedStates[r][p][x]===null&&delete this.deletedStates[r][p][x]}removeFeatureState(r,l,h){if(this.deletedStates[r]===null)return;const p=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},h&&l!==void 0)this.deletedStates[r][p]!==null&&(this.deletedStates[r][p]=this.deletedStates[r][p]||{},this.deletedStates[r][p][h]=null);else if(l!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][p])for(h in this.deletedStates[r][p]={},this.stateChanges[r][p])this.deletedStates[r][p][h]=null;else this.deletedStates[r][p]=null;else this.deletedStates[r]=null}getState(r,l){const h=String(l),p=Fe({},(this.state[r]||{})[h],(this.stateChanges[r]||{})[h]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const x=this.deletedStates[r][l];if(x===null)return{};for(const b in x)delete p[b]}return p}initializeTileState(r,l){r.setFeatureState(this.state,l)}coalesceChanges(r,l){const h={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const x={};for(const b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),Fe(this.state[p][b],this.stateChanges[p][b]),x[b]=this.state[p][b];h[p]=x}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const x={};if(this.deletedStates[p]===null)for(const b in this.state[p])x[b]={},this.state[p][b]={};else for(const b in this.deletedStates[p]){if(this.deletedStates[p][b]===null)this.state[p][b]={};else if(this.state[p][b])for(const A of Object.keys(this.deletedStates[p][b]))delete this.state[p][b][A];x[b]=this.state[p][b]}h[p]=h[p]||{},Fe(h[p],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const p in r)r[p].setFeatureState(h,l)}}class S4{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,l){const h=this.toIdx(r,l);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(r,l){return this.leaves[this.toIdx(r,l)]}toIdx(r,l){return l*this.size+r}}function E4(s,r,l,h){let p=0,x=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(h[b])<1e-15){if(l[b]<s[b]||l[b]>r[b])return null}else{const A=1/h[b];let P=(s[b]-l[b])*A,k=(r[b]-l[b])*A;if(P>k){const q=P;P=k,k=q}if(P>p&&(p=P),k<x&&(x=k),p>x)return null}return p}function A4(s,r,l,h,p,x,b,A,P,k,q){const K=h-s,te=p-r,ue=x-l,pe=b-s,Se=A-r,Ge=P-l,at=q[1]*Ge-q[2]*Se,xt=q[2]*pe-q[0]*Ge,lt=q[0]*Se-q[1]*pe,yt=K*at+te*xt+ue*lt;if(Math.abs(yt)<1e-15)return null;const It=1/yt,Tt=k[0]-s,ln=k[1]-r,en=k[2]-l,wn=(Tt*at+ln*xt+en*lt)*It;if(wn<0||wn>1)return null;const jn=ln*ue-en*te,dn=en*K-Tt*ue,Pn=Tt*te-ln*K,kn=(q[0]*jn+q[1]*dn+q[2]*Pn)*It;return kn<0||wn+kn>1?null:(pe*jn+Se*dn+Ge*Pn)*It}function T4(s,r,l){return(s-r)/(l-r)}function I4(s,r,l,h,p,x,b,A,P){const k=1<<l,q=x-h,K=b-p,te=(s+1)/k*q+h,ue=(r+0)/k*K+p,pe=(r+1)/k*K+p;A[0]=(s+0)/k*q+h,A[1]=ue,P[0]=te,P[1]=pe}class C4{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=(function(x){const b=Math.ceil(Math.log2(x.dim/8)),A=[];let P=Math.ceil(Math.pow(2,b));const k=1/P,q=(ue,pe,Se,Ge,at)=>{const xt=Ge?1:0,lt=(ue+1)*Se-xt,yt=pe*Se,It=(pe+1)*Se-xt;at[0]=ue*Se,at[1]=yt,at[2]=lt,at[3]=It};let K=new S4(P);const te=[];for(let ue=0;ue<P*P;ue++){q(ue%P,Math.floor(ue/P),k,!1,te);const pe=Mp(te[0],te[1],x),Se=Mp(te[2],te[1],x),Ge=Mp(te[2],te[3],x),at=Mp(te[0],te[3],x);K.minimums.push(Math.min(pe,Se,Ge,at)),K.maximums.push(Math.max(pe,Se,Ge,at)),K.leaves.push(1)}for(A.push(K),P/=2;P>=1;P/=2){const ue=A[A.length-1];K=new S4(P);for(let pe=0;pe<P*P;pe++){q(pe%P,Math.floor(pe/P),2,!0,te);const Se=ue.getElevation(te[0],te[1]),Ge=ue.getElevation(te[2],te[1]),at=ue.getElevation(te[2],te[3]),xt=ue.getElevation(te[0],te[3]),lt=ue.isLeaf(te[0],te[1]),yt=ue.isLeaf(te[2],te[1]),It=ue.isLeaf(te[2],te[3]),Tt=ue.isLeaf(te[0],te[3]),ln=Math.min(Se.min,Ge.min,at.min,xt.min),en=Math.max(Se.max,Ge.max,at.max,xt.max),wn=lt&&yt&&It&&Tt;K.maximums.push(en),K.minimums.push(ln),K.leaves.push(en-ln<=5&&wn?1:0)}A.push(K)}return A})(this.dem),h=l.length-1,p=l[h];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(l,0,0,h,0)}raycastRoot(r,l,h,p,x,b,A=1){return E4([r,l,-100],[h,p,this.maximums[0]*A],x,b)}raycast(r,l,h,p,x,b,A=1){if(!this.nodeCount)return null;const P=this.raycastRoot(r,l,h,p,x,b,A);if(P==null)return null;const k=[],q=[],K=[],te=[],ue=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;ue.length>0;){const{idx:pe,t:Se,nodex:Ge,nodey:at,depth:xt}=ue.pop();if(this.leaves[pe]){I4(Ge,at,xt,r,l,h,p,K,te);const yt=1<<xt,It=(Ge+0)/yt,Tt=(Ge+1)/yt,ln=(at+0)/yt,en=(at+1)/yt,wn=Mp(It,ln,this.dem)*A,jn=Mp(Tt,ln,this.dem)*A,dn=Mp(Tt,en,this.dem)*A,Pn=Mp(It,en,this.dem)*A,kn=A4(K[0],K[1],wn,te[0],K[1],jn,te[0],te[1],dn,x,b),On=A4(te[0],te[1],dn,K[0],te[1],Pn,K[0],K[1],wn,x,b),Wn=Math.min(kn!==null?kn:Number.MAX_VALUE,On!==null?On:Number.MAX_VALUE);if(Wn!==Number.MAX_VALUE)return Wn;{const xn=gr([],x,b,Se);if(L4(wn,jn,Pn,dn,T4(xn[0],K[0],te[0]),T4(xn[1],K[1],te[1]))>=xn[2])return Se}continue}let lt=0;for(let yt=0;yt<this._siblingOffset.length;yt++){I4((Ge<<1)+this._siblingOffset[yt][0],(at<<1)+this._siblingOffset[yt][1],xt+1,r,l,h,p,K,te),K[2]=-100,te[2]=this.maximums[this.childOffsets[pe]+yt]*A;const It=E4(K,te,x,b);if(It!=null){const Tt=It;k[yt]=Tt;let ln=!1;for(let en=0;en<lt&&!ln;en++)Tt>=k[q[en]]&&(q.splice(en,0,yt),ln=!0);ln||(q[lt]=yt),lt++}}for(let yt=0;yt<lt;yt++){const It=q[yt];ue.push({idx:this.childOffsets[pe]+It,t:k[It],nodex:(Ge<<1)+this._siblingOffset[It][0],nodey:(at<<1)+this._siblingOffset[It][1],depth:xt+1})}}return null}_addNode(r,l,h){return this.minimums.push(r),this.maximums.push(l),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(r,l,h,p,x){if(r[p].isLeaf(l,h)===1)return;this.childOffsets[x]||(this.childOffsets[x]=this.nodeCount);const b=p-1,A=r[b];let P=0,k=0;for(let q=0;q<this._siblingOffset.length;q++){const K=2*l+this._siblingOffset[q][0],te=2*h+this._siblingOffset[q][1],ue=A.getElevation(K,te),pe=A.isLeaf(K,te),Se=this._addNode(ue.min,ue.max,pe);pe&&(P|=1<<q),k||(k=Se)}for(let q=0;q<this._siblingOffset.length;q++)P&1<<q||this._construct(r,2*l+this._siblingOffset[q][0],2*h+this._siblingOffset[q][1],b,k+q)}}function L4(s,r,l,h,p,x){return $e($e(s,l,x),$e(r,h,x),p)}function Mp(s,r,l){const h=l.dim,p=De(s*h-.5,0,h-1),x=De(r*h-.5,0,h-1),b=Math.floor(p),A=Math.floor(x),P=Math.min(b+1,h-1),k=Math.min(A+1,h-1);return L4(l.get(b,A),l.get(P,A),l.get(b,k),l.get(P,k),p-b,x-A)}const P4={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function GC(s,r,l){return(256*s*256+256*r+l)/10-1e4}function WC(s,r,l){return 256*s+r+l/256-32768}class X_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,l,h,p=!1,x=!1){if(this.uid=r,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return ur(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const b=this.dim=l.height-2,A=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=h||"mapbox",this.borderReady=p,!p){for(let P=0;P<b;P++)A[this._idx(-1,P)]=A[this._idx(0,P)],A[this._idx(b,P)]=A[this._idx(b-1,P)],A[this._idx(P,-1)]=A[this._idx(P,0)],A[this._idx(P,b)]=A[this._idx(P,b-1)];A[this._idx(-1,-1)]=A[this._idx(0,0)],A[this._idx(b,-1)]=A[this._idx(b-1,0)],A[this._idx(-1,b)]=A[this._idx(0,b-1)],A[this._idx(b,b)]=A[this._idx(b-1,b-1)],x&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new C4(this)}get(r,l,h=!1){h&&(r=De(r,-1,this.dim),l=De(l,-1,this.dim));const p=4*this._idx(r,l);return(this.encoding==="terrarium"?WC:GC)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(r){return P4[r]}get unpackVector(){return P4[this.encoding]}_idx(r,l){if(r<-1||r>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(r+1)}static pack(r,l){const h=[0,0,0,0],p=X_.getUnpackVector(l);let x=Math.floor((r+p[3])/p[2]);return h[2]=x%256,x=Math.floor(x/256),h[1]=x%256,x=Math.floor(x/256),h[0]=x,h}getPixels(){return new zu({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,l,h){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,x=l*this.dim+this.dim,b=h*this.dim,A=h*this.dim+this.dim;switch(l){case-1:p=x-1;break;case 1:x=p+1}switch(h){case-1:b=A-1;break;case 1:A=b+1}const P=-l*this.dim,k=-h*this.dim;for(let q=b;q<A;q++)for(let K=p;K<x;K++){const te=4*this._idx(K,q),ue=4*this._idx(K+P,q+k);this.pixels[te+0]=r.pixels[ue+0],this.pixels[te+1]=r.pixels[ue+1],this.pixels[te+2]=r.pixels[ue+2],this.pixels[te+3]=r.pixels[ue+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}sr(X_,"DEMData"),sr(C4,"DemMinMaxQuadTree",{omit:["dem"]});class HC{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,h){const p=r.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const x={value:l,timeout:void 0};if(h!==void 0&&(x.timeout=setTimeout((()=>{this.remove(r,x)}),h)),this.data[p].push(x),this.order.push(p),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const h=r.wrapped().key,p=l===void 0?0:this.data[h].indexOf(l),x=this.data[h][p];return this.data[h].splice(p,1),x.timeout&&clearTimeout(x.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(x.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const h in this.data)for(const p of this.data[h])r(p.value)||l.push(p);for(const h of l)this.remove(h.value.tileID,h)}}class Ig{constructor(r,l,h){this.func=r,this.mask=l,this.range=h}}Ig.ReadOnly=!1,Ig.ReadWrite=!0,Ig.disabled=new Ig(519,Ig.ReadOnly,[0,1]);const kx=7680;class Mx{constructor(r,l,h,p,x,b){this.test=r,this.ref=l,this.mask=h,this.fail=p,this.depthFail=x,this.pass=b}}Mx.disabled=new Mx({func:519,mask:0},0,0,kx,kx,kx);class ff{constructor(r,l,h){this.blendFunction=r,this.blendColor=l,this.mask=h}}ff.Replace=[1,0],ff.disabled=new ff(ff.Replace,No.transparent,[!1,!1,!1,!1]),ff.unblended=new ff(ff.Replace,No.transparent,[!0,!0,!0,!0]),ff.alphaBlended=new ff([1,771],No.transparent,[!0,!0,!0,!0]);const Rx=1029,Nx=2305;class Od{constructor(r,l,h){this.enable=r,this.mode=l,this.frontFace=h}}Od.disabled=new Od(!1,Rx,Nx),Od.backCCW=new Od(!0,Rx,Nx),Od.backCW=new Od(!0,Rx,2304),Od.frontCW=new Od(!0,1028,2304),Od.frontCCW=new Od(!0,1028,Nx);class bm extends Ro{constructor(r,l,h){super(),this.id=r,this._onlySymbols=h,l.on("data",(p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),l.on("error",(()=>{this._sourceErrored=!0})),this._source=l,this._tiles={},this._cache=new HC(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new $C,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const l=this._tiles[r];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,l){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,(()=>{}))}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,(()=>{}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const h=this._tiles[l];h.upload(r),h.prepare(this.map.style.imageManager)}}getIds(){return Me(this._tiles).map((r=>r.tileID)).sort(k4).map((r=>r.key))}getRenderableIds(r){const l=[];for(const h in this._tiles)this._isIdRenderable(+h,r)&&l.push(this._tiles[h]);return r?l.sort(((h,p)=>{const x=h.tileID,b=p.tileID,A=new $(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),P=new $(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-b.overscaledZ||P.y-A.y||P.x-A.x})).map((h=>h.tileID.key)):l.map((h=>h.tileID)).sort(k4).map((h=>h.key))}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,l){const h=this._tiles[r];h&&(h.state!=="loading"&&(h.state=l),this._loadTile(h,this._tileLoaded.bind(this,h,r,l)))}_tileLoaded(r,l,h,p){if(p)if(r.state="errored",p.status!==404)this._source.fire(new Ea(p,{tile:r}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=Qo.now(),h==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new hl("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const l=this.getRenderableIds();for(let p=0;p<l.length;p++){const x=l[p];if(r.neighboringTiles&&r.neighboringTiles[x]){const b=this.getTileByID(x);h(r,b),h(b,r)}}function h(p,x){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let b=x.tileID.canonical.x-p.tileID.canonical.x;const A=x.tileID.canonical.y-p.tileID.canonical.y,P=Math.pow(2,p.tileID.canonical.z),k=x.tileID.key;b===0&&A===0||Math.abs(A)>1||(Math.abs(b)>1&&(Math.abs(b+P)===1?b+=P:Math.abs(b-P)===1&&(b-=P)),x.dem&&p.dem&&(p.dem.backfillBorder(x.dem,b,A),p.neighboringTiles&&p.neighboringTiles[k]&&(p.neighboringTiles[k].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,h,p){for(const x in this._tiles){let b=this._tiles[x];if(p[x]||!b.hasData()||b.tileID.overscaledZ<=l||b.tileID.overscaledZ>h)continue;let A=b.tileID;for(;b&&b.tileID.overscaledZ>l+1;){const k=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[k.key],b&&b.hasData()&&(A=k)}let P=A;for(;P.overscaledZ>l;)if(P=P.scaledTo(P.overscaledZ-1),r[P.key]){p[A.key]=A;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const h=this._loadedParentTiles[r.key];return h&&h.tileID.overscaledZ>=l?h:null}for(let h=r.overscaledZ-1;h>=l;h--){const p=r.scaledTo(h),x=this._getLoadedTile(p);if(x)return x}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,l){l=l||this._source.tileSize;const h=Math.ceil(r.width/l)+1,p=Math.ceil(r.height/l)+1,x=Math.floor(h*p*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(A)}handleWrapJump(r){const l=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,l){const h={};for(const p in this._tiles){const x=this._tiles[p];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+l),h[x.tileID.key]=x}this._tiles=h;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(r,l,h){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let p;this.updateCacheSize(r,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=r.getVisibleUnwrappedCoordinates(this._source.tileID).map((A=>new oh(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y))):(p=r.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter((A=>this._source.hasTile(A))))):p=[];const x=this._updateRetainedTiles(p);if(M4(this._source.type)&&p.length!==0){const A={},P={},k=Object.keys(x);for(const K of k){const te=x[K],ue=this._tiles[K];if(!ue||ue.fadeEndTime&&ue.fadeEndTime<=Qo.now())continue;const pe=this.findLoadedParent(te,Math.max(te.overscaledZ-bm.maxOverzooming,this._source.minzoom));pe&&(this._addTile(pe.tileID),A[pe.tileID.key]=pe.tileID),P[K]=te}const q=p[p.length-1].overscaledZ;for(const K in this._tiles){const te=this._tiles[K];if(x[K]||!te.hasData())continue;let ue=te.tileID;for(;ue.overscaledZ>q;){ue=ue.scaledTo(ue.overscaledZ-1);const pe=this._tiles[ue.key];if(pe&&pe.hasData()&&P[ue.key]){x[K]=te.tileID;break}}}for(const K in A)x[K]||(this._coveredTiles[K]=!0,x[K]=A[K])}for(const A in x)this._tiles[A].clearFadeHold();const b=(function(A,P){const k=[];for(const q in A)q in P||k.push(q);return k})(this._tiles,x);for(const A of b){const P=this._tiles[A];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(+A)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const l={};if(r.length===0)return l;const h={},p=r.reduce(((k,q)=>Math.min(k,q.overscaledZ)),1/0),x=r[0].overscaledZ,b=Math.max(x-bm.maxOverzooming,this._source.minzoom),A=Math.max(x+bm.maxUnderzooming,this._source.minzoom),P={};for(const k of r){const q=this._addTile(k);l[k.key]=k,q.hasData()||p<this._source.maxzoom&&(P[k.key]=k)}this._retainLoadedChildren(P,p,A,l);for(const k of r){let q=this._tiles[k.key];if(q.hasData())continue;if(k.canonical.z>=this._source.maxzoom){const te=k.children(this._source.maxzoom)[0],ue=this.getTile(te);if(ue&&ue.hasData()){l[te.key]=te;continue}}else{const te=k.children(this._source.maxzoom);if(l[te[0].key]&&l[te[1].key]&&l[te[2].key]&&l[te[3].key])continue}let K=q.wasRequested();for(let te=k.overscaledZ-1;te>=b;--te){const ue=k.scaledTo(te);if(h[ue.key]||(h[ue.key]=!0,q=this.getTile(ue),!q&&K&&(q=this._addTile(ue)),q&&(l[ue.key]=ue,K=q.wasRequested(),q.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let h,p=this._tiles[r].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){h=this._loadedParentTiles[p.key];break}l.push(p.key);const x=p.scaledTo(p.overscaledZ-1);if(h=this._getLoadedTile(x),h)break;p=x}for(const x of l)this._loadedParentTiles[x]=h}}_addTile(r){let l=this._tiles[r.key];if(l)return l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const h=!!l;if(!h){const p=this.map?this.map.painter:null;l=new Px(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))}return l?(l.uses++,this._tiles[r.key]=l,h||this._source.fire(new hl("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const h=l.getExpiryTimeout();h&&(this._timers[r]=setTimeout((()=>{this._reloadTile(r,"expired"),delete this._timers[r]}),h))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,l,h){const p=[],x=this.transform;if(!x)return p;const b=x.projection.name==="globe",A=ta(x.center.lng);for(const P in this._tiles){const k=this._tiles[P];if(h&&k.clearQueryDebugViz(),k.holdingForFade())continue;let q;if(b){const K=k.tileID.canonical;if(K.z===0){const te=[Math.abs(De(A,...ry(K,-1))-A),Math.abs(De(A,...ry(K,1))-A)];q=[0,2*te.indexOf(Math.min(...te))-1]}else{const te=[Math.abs(De(A,...ry(K,-1))-A),Math.abs(De(A,...ry(K,0))-A),Math.abs(De(A,...ry(K,1))-A)];q=[te.indexOf(Math.min(...te))-1]}}else q=[0];for(const K of q){const te=r.containsTile(k,x,l,K);te&&p.push(te)}}return p}getVisibleCoordinates(r){const l=this.getRenderableIds(r).map((h=>this._tiles[h].tileID));for(const h of l)h.projMatrix=this.transform.calculateProjMatrix(h.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(M4(this._source.type))for(const r in this._tiles){const l=this._tiles[r];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=Qo.now())return!0}return!1}setFeatureState(r,l,h){this._state.updateState(r=r||"_geojsonTileLayer",l,h)}removeFeatureState(r,l,h){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,h)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,h){const p=this._tiles[r];p&&p.setDependencies(l,h)}reloadTilesForDependencies(r,l){for(const h in this._tiles)this._tiles[h].hasDependency(r,l)&&this._reloadTile(+h,"reloading");this._cache.filter((h=>!h.hasDependency(r,l)))}_preloadTiles(r,l){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(r,l))};return void this._source.on("data",A)}const h=new Map,p=Array.isArray(r)?r:[r],x=this.map.painter.terrain,b=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const A of p){const P=A.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const k of P)h.set(k.key,k);this.usedForTerrain&&A.updateElevation(!1)}ae(Array.from(h.values()),((A,P)=>{const k=new Px(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(k,(q=>{this._source.type==="raster-dem"&&k.dem&&this._backfillDEM(k),P(q,k)}))}),l)}}function k4(s,r){const l=Math.abs(2*s.wrap)-+(s.wrap<0),h=Math.abs(2*r.wrap)-+(r.wrap<0);return s.overscaledZ-r.overscaledZ||h-l||r.canonical.y-s.canonical.y||r.canonical.x-s.canonical.x}function M4(s){return s==="raster"||s==="image"||s==="video"||s==="custom"}function ry(s,r){const l=1<<s.z;return[s.x/l+r,(s.x+1)/l+r]}bm.maxOverzooming=10,bm.maxUnderzooming=3;class K_{constructor(r,l,h){this._demTile=r,this._dem=this._demTile.dem,this._scale=l,this._offset=h}static create(r,l,h){const p=h||r.findDEMTileFor(l);if(!p||!p.dem)return;const x=p.dem,b=p.tileID,A=1<<l.canonical.z-b.canonical.z;return new K_(p,p.tileSize/_t/A,[(l.canonical.x/A-b.canonical.x)*x.dim,(l.canonical.y/A-b.canonical.y)*x.dim])}tileCoordToPixel(r,l){const h=l*this._scale+this._offset[1],p=Math.floor(r*this._scale+this._offset[0]),x=Math.floor(h);return new $(p,x)}getElevationAt(r,l,h,p){const x=r*this._scale+this._offset[0],b=l*this._scale+this._offset[1],A=Math.floor(x),P=Math.floor(b),k=this._dem;return p=!!p,h?$e($e(k.get(A,P,p),k.get(A,P+1,p),b-P),$e(k.get(A+1,P,p),k.get(A+1,P+1,p),b-P),x-A):k.get(A,P,p)}getElevationAtPixel(r,l,h){return this._dem.get(r,l,!!h)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*al(1,r)*this._dem.stride}}class R4{constructor(r,l){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Ia(_t,16,0),this.featureIndexArray=new Cs,this.promoteId=l}insert(r,l,h,p,x,b=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,x,b);const P=this.grid;for(let k=0;k<l.length;k++){const q=l[k],K=[1/0,1/0,-1/0,-1/0];for(let te=0;te<q.length;te++){const ue=q[te];K[0]=Math.min(K[0],ue.x),K[1]=Math.min(K[1],ue.y),K[2]=Math.max(K[2],ue.x),K[3]=Math.max(K[3],ue.y)}K[0]<_t&&K[1]<_t&&K[2]>=0&&K[3]>=0&&P.insert(A,K[0],K[1],K[2],K[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new fi(new D_(this.rawTileData)).layers,this.sourceLayerCoder=new _4(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,l,h,p){this.loadVTLayers();const x=r.params||{},b=tu(x.filter),A=r.tileResult,P=r.transform,k=A.bufferedTilespaceBounds,q=this.grid.query(k.min.x,k.min.y,k.max.x,k.max.y,((pe,Se,Ge,at)=>A_(A.bufferedTilespaceGeometry,pe,Se,Ge,at)));q.sort(XC);let K=null;P.elevation&&q.length>0&&(K=K_.create(P.elevation,this.tileID));const te={};let ue;for(let pe=0;pe<q.length;pe++){const Se=q[pe];if(Se===ue)continue;ue=Se;const Ge=this.featureIndexArray.get(Se);let at=null;this.loadMatchingFeature(te,Ge,b,x.layers,x.availableImages,l,h,p,((xt,lt,yt,It=0)=>(at||(at=vu(xt,this.tileID.canonical,r.tileTransform)),lt.queryIntersectsFeature(A,xt,yt,at,this.z,r.transform,r.pixelPosMatrix,K,It))))}return te}loadMatchingFeature(r,l,h,p,x,b,A,P,k){const{featureIndex:q,bucketIndex:K,sourceLayerIndex:te,layoutVertexArrayOffset:ue}=l,pe=this.bucketLayerIDs[K];if(p&&!(function(xt,lt){for(let yt=0;yt<xt.length;yt++)if(lt.indexOf(xt[yt])>=0)return!0;return!1})(p,pe))return;const Se=this.sourceLayerCoder.decode(te),Ge=this.vtLayers[Se].feature(q);if(h.needGeometry){const xt=md(Ge,!0);if(!h.filter(new G(this.tileID.overscaledZ),xt,this.tileID.canonical))return}else if(!h.filter(new G(this.tileID.overscaledZ),Ge))return;const at=this.getId(Ge,Se);for(let xt=0;xt<pe.length;xt++){const lt=pe[xt];if(p&&p.indexOf(lt)<0)continue;const yt=b[lt];if(!yt)continue;let It={};at!==void 0&&P&&(It=P.getState(yt.sourceLayer||"_geojsonTileLayer",at));const Tt=Fe({},A[lt]);Tt.paint=N4(Tt.paint,yt.paint,Ge,It,x),Tt.layout=N4(Tt.layout,yt.layout,Ge,It,x);const ln=!k||k(Ge,yt,It,ue);if(!ln)continue;const en=new v4(Ge,this.z,this.x,this.y,at);en.layer=Tt;let wn=r[lt];wn===void 0&&(wn=r[lt]=[]),wn.push({featureIndex:q,feature:en,intersectionZ:ln})}}lookupSymbolFeatures(r,l,h,p,x,b,A,P){const k={};this.loadVTLayers();const q=tu(x);for(const K of r)this.loadMatchingFeature(k,{bucketIndex:h,sourceLayerIndex:p,featureIndex:K,layoutVertexArrayOffset:0},q,b,A,P,l);return k}loadFeature(r){const{featureIndex:l,sourceLayerIndex:h}=r;this.loadVTLayers();const p=this.sourceLayerCoder.decode(h),x=this.vtFeatures[p];if(x[l])return x[l];const b=this.vtLayers[p].feature(l);return x[l]=b,b}hasLayer(r){for(const l of this.bucketLayerIDs)for(const h of l)if(r===h)return!0;return!1}getId(r,l){let h=r.id;if(this.promoteId){const p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[l];p!=null&&(h=r.properties[p]),typeof h=="boolean"&&(h=Number(h))}return h}}function N4(s,r,l,h,p){return fn(s,((x,b)=>{const A=r instanceof We?r.get(b):null;return A&&A.evaluate?A.evaluate(l,h,p):A}))}function XC(s,r){return r-s}sr(R4,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class D4{constructor(r,l){this.width=r,this.height=l,this.nextRow=0,this.image=new ih({width:r,height:l}),this.positions={},this.uploaded=!1}getDash(r,l){const h=this.getKey(r,l);return this.positions[h]}trim(){const r=this.width,l=this.height=ht(this.nextRow);this.image.resize({width:r,height:l})}getKey(r,l){return r.join(",")+l}getDashRanges(r,l,h){const p=[];let x=r.length%2==1?-r[r.length-1]*h:0,b=r[0]*h,A=!0;p.push({left:x,right:b,isDash:A,zeroLength:r[0]===0});let P=r[0];for(let k=1;k<r.length;k++){A=!A;const q=r[k];x=P*h,P+=q,b=P*h,p.push({left:x,right:b,isDash:A,zeroLength:q===0})}return p}addRoundDash(r,l,h){const p=l/2;for(let x=-h;x<=h;x++){const b=this.width*(this.nextRow+h+x);let A=0,P=r[A];for(let k=0;k<this.width;k++){k/P.right>1&&(P=r[++A]);const q=Math.abs(k-P.left),K=Math.abs(k-P.right),te=Math.min(q,K);let ue;const pe=x/h*(p+1);if(P.isDash){const Se=p-Math.abs(pe);ue=Math.sqrt(te*te+Se*Se)}else ue=p-Math.sqrt(te*te+pe*pe);this.image.data[b+k]=Math.max(0,Math.min(255,ue+128))}}}addRegularDash(r,l){for(let P=r.length-1;P>=0;--P){const k=r[P],q=r[P+1];k.zeroLength?r.splice(P,1):q&&q.isDash===k.isDash&&(q.left=k.left,r.splice(P,1))}const h=r[0],p=r[r.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const x=this.width*this.nextRow;let b=0,A=r[b];for(let P=0;P<this.width;P++){P/A.right>1&&(A=r[++b]);const k=Math.abs(P-A.left),q=Math.abs(P-A.right),K=Math.min(k,q);this.image.data[x+P]=Math.max(0,Math.min(255,(A.isDash?K:-K)+l+128))}}addDash(r,l){const h=this.getKey(r,l);if(this.positions[h])return this.positions[h];const p=l==="round",x=p?7:0,b=2*x+1;if(this.nextRow+b>this.height)return ur("LineAtlas out of space"),null;r.length===0&&r.push(1);let A=0;for(let q=0;q<r.length;q++)r[q]<0&&(ur("Negative value is found in line dasharray, replacing values with 0"),r[q]=0),A+=r[q];if(A!==0){const q=this.width/A,K=this.getDashRanges(r,this.width,q);p?this.addRoundDash(K,q,x):this.addRegularDash(K,l==="square"?.5*q:0)}const P=this.nextRow+x;this.nextRow+=b;const k={tl:[P,x],br:[A,0]};return this.positions[h]=k,k}}sr(D4,"LineAtlas");const F4=1*Fd;class O4{constructor(r){const l={},h=[];for(const A in r){const P=r[A],k=l[A]={};for(const q in P.glyphs){const K=P.glyphs[+q];if(!K||K.bitmap.width===0||K.bitmap.height===0)continue;const te=K.metrics.localGlyph?F4:1,ue={x:0,y:0,w:K.bitmap.width+2*te,h:K.bitmap.height+2*te};h.push(ue),k[q]=ue}}const{w:p,h:x}=_x(h),b=new ih({width:p||1,height:x||1});for(const A in r){const P=r[A];for(const k in P.glyphs){const q=P.glyphs[+k];if(!q||q.bitmap.width===0||q.bitmap.height===0)continue;const K=l[A][k],te=q.metrics.localGlyph?F4:1;ih.copy(q.bitmap,b,{x:0,y:0},{x:K.x+te,y:K.y+te},q.bitmap)}}this.image=b,this.positions=l}}sr(O4,"GlyphAtlas");class KC{constructor(r){this.tileID=new oh(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=xm(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,l,h,p,x){this.status="parsing",this.data=r,this.collisionBoxArray=new Ki;const b=new _4(Object.keys(r.layers).sort()),A=new R4(this.tileID,this.promoteId);A.bucketLayerIDs=[];const P={},k=new D4(256,256),q={featureIndex:A,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:k,availableImages:h},K=l.familiesBySource[this.source];for(const It in K){const Tt=r.layers[It];if(!Tt)continue;let ln=!1,en=!1;for(const dn of K[It])dn[0].type==="symbol"?ln=!0:en=!0;if(this.isSymbolTile===!0&&!ln||this.isSymbolTile===!1&&!en)continue;Tt.version===1&&ur(`Vector tile source "${this.source}" layer "${It}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const wn=b.encode(It),jn=[];for(let dn=0;dn<Tt.length;dn++){const Pn=Tt.feature(dn),kn=A.getId(Pn,It);jn.push({feature:Pn,id:kn,index:dn,sourceLayerIndex:wn})}for(const dn of K[It]){const Pn=dn[0];this.isSymbolTile!==void 0&&Pn.type==="symbol"!==this.isSymbolTile||Pn.minzoom&&this.zoom<Math.floor(Pn.minzoom)||Pn.maxzoom&&this.zoom>=Pn.maxzoom||Pn.visibility!=="none"&&(Dx(dn,this.zoom,h),(P[Pn.id]=Pn.createBucket({index:A.bucketLayerIDs.length,layers:dn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wn,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:h})).populate(jn,q,this.tileID.canonical,this.tileTransform),A.bucketLayerIDs.push(dn.map((kn=>kn.id))))}}let te,ue,pe,Se;k.trim();const Ge={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},at=()=>{if(te)return x(te);if(ue&&pe&&Se){const It=new O4(ue),Tt=new $3(pe,Se);for(const ln in P){const en=P[ln];en instanceof Lp?(Dx(en.layers,this.zoom,h),bC(en,ue,It.positions,pe,Tt.iconPositions,this.showCollisionBoxes,h,this.tileID.canonical,this.tileZoom,this.projection)):en.hasPattern&&(en instanceof M_||en instanceof E||en instanceof G0)&&(Dx(en.layers,this.zoom,h),en.addFeatures(q,this.tileID.canonical,Tt.patternPositions,h,this.tileTransform))}this.status="done",x(null,{buckets:Me(P).filter((ln=>!ln.isEmpty())),featureIndex:A,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:It.image,lineAtlas:k,imageAtlas:Tt,glyphMap:this.returnDependencies?ue:null,iconMap:this.returnDependencies?pe:null,glyphPositions:this.returnDependencies?It.positions:null})}},xt=fn(q.glyphDependencies,(It=>Object.keys(It).map(Number)));Object.keys(xt).length?p.send("getGlyphs",{uid:this.uid,stacks:xt},((It,Tt)=>{te||(te=It,ue=Tt,at())}),void 0,!1,Ge):ue={};const lt=Object.keys(q.iconDependencies);lt.length?p.send("getImages",{icons:lt,source:this.source,tileID:this.tileID,type:"icons"},((It,Tt)=>{te||(te=It,pe=Tt,at())}),void 0,!1,Ge):pe={};const yt=Object.keys(q.patternDependencies);yt.length?p.send("getImages",{icons:yt,source:this.source,tileID:this.tileID,type:"patterns"},((It,Tt)=>{te||(te=It,Se=Tt,at())}),void 0,!1,Ge):Se={},at()}}function Dx(s,r,l){const h=new G(r);for(const p of s)p.recalculate(h,l)}class B4{constructor(r){this.entries={},this.scheduler=r}request(r,l,h,p){const x=this.entries[r]=this.entries[r]||{callbacks:[]};if(x.result){const[b,A]=x.result;return this.scheduler?this.scheduler.add((()=>{p(b,A)}),l):p(b,A),()=>{}}return x.callbacks.push(p),x.cancel||(x.cancel=h(((b,A)=>{x.result=[b,A];for(const P of x.callbacks)this.scheduler?this.scheduler.add((()=>{P(b,A)}),l):P(b,A);setTimeout((()=>delete this.entries[r]),3e3)}))),()=>{x.result||(x.callbacks=x.callbacks.filter((b=>b!==p)),x.callbacks.length||(x.cancel(),delete this.entries[r]))}}}function z4(s,r,l){const h=JSON.stringify(s.request);return s.data&&(this.deduped.entries[h]={result:[null,s.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},(p=>{const x=ui(s.request,((b,A,P,k)=>{b?p(b):A&&p(null,{vectorTile:l?void 0:new fi(new D_(A)),rawData:A,cacheControl:P,expires:k})}));return()=>{x.cancel(),p()}}),r)}const j4=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Fx{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,h]=new Uint8Array(r,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=h>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const x=j4[15&h];if(!x)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(r,2,1),[A]=new Uint32Array(r,4,1);return new Fx(A,b,x,r)}constructor(r,l=64,h=Float64Array,p){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=h,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const x=j4.indexOf(this.ArrayType),b=2*r*this.ArrayType.BYTES_PER_ELEMENT,A=r*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-A%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${h}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+A+P,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+b+A+P),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+A+P,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=r)}add(r,l){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=r,this.coords[this._pos++]=l,h}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return Ox(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,l,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:b,nodeSize:A}=this,P=[0,x.length-1,0],k=[];for(;P.length;){const q=P.pop()||0,K=P.pop()||0,te=P.pop()||0;if(K-te<=A){for(let Ge=te;Ge<=K;Ge++){const at=b[2*Ge],xt=b[2*Ge+1];at>=r&&at<=h&&xt>=l&&xt<=p&&k.push(x[Ge])}continue}const ue=te+K>>1,pe=b[2*ue],Se=b[2*ue+1];pe>=r&&pe<=h&&Se>=l&&Se<=p&&k.push(x[ue]),(q===0?r<=pe:l<=Se)&&(P.push(te),P.push(ue-1),P.push(1-q)),(q===0?h>=pe:p>=Se)&&(P.push(ue+1),P.push(K),P.push(1-q))}return k}within(r,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:x,nodeSize:b}=this,A=[0,p.length-1,0],P=[],k=h*h;for(;A.length;){const q=A.pop()||0,K=A.pop()||0,te=A.pop()||0;if(K-te<=b){for(let Ge=te;Ge<=K;Ge++)V4(x[2*Ge],x[2*Ge+1],r,l)<=k&&P.push(p[Ge]);continue}const ue=te+K>>1,pe=x[2*ue],Se=x[2*ue+1];V4(pe,Se,r,l)<=k&&P.push(p[ue]),(q===0?r-h<=pe:l-h<=Se)&&(A.push(te),A.push(ue-1),A.push(1-q)),(q===0?r+h>=pe:l+h>=Se)&&(A.push(ue+1),A.push(K),A.push(1-q))}return P}}function Ox(s,r,l,h,p,x){if(p-h<=l)return;const b=h+p>>1;U4(s,r,b,h,p,x),Ox(s,r,l,h,b-1,1-x),Ox(s,r,l,b+1,p,1-x)}function U4(s,r,l,h,p,x){for(;p>h;){if(p-h>600){const k=p-h+1,q=l-h+1,K=Math.log(k),te=.5*Math.exp(2*K/3),ue=.5*Math.sqrt(K*te*(k-te)/k)*(q-k/2<0?-1:1);U4(s,r,l,Math.max(h,Math.floor(l-q*te/k+ue)),Math.min(p,Math.floor(l+(k-q)*te/k+ue)),x)}const b=r[2*l+x];let A=h,P=p;for(iy(s,r,h,l),r[2*p+x]>b&&iy(s,r,h,p);A<P;){for(iy(s,r,A,P),A++,P--;r[2*A+x]<b;)A++;for(;r[2*P+x]>b;)P--}r[2*h+x]===b?iy(s,r,h,P):(P++,iy(s,r,P,p)),P<=l&&(h=P+1),l<=P&&(p=P-1)}}function iy(s,r,l,h){Bx(s,l,h),Bx(r,2*l,2*h),Bx(r,2*l+1,2*h+1)}function Bx(s,r,l){const h=s[r];s[r]=s[l],s[l]=h}function V4(s,r,l,h){const p=s-l,x=r-h;return p*p+x*x}o.ARRAY_TYPE=Yt,o.AUTH_ERR_MSG=ct,o.Aabb=io,o.Actor=class{constructor(s,r,l){this.target=s,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Jt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Tn()?s:w,this.scheduler=new VC}send(s,r,l,h,p=!1,x){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=x,this.callbacks[b]=l);const A=hr(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:s,hasCallback:!!l,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:F(r,A)},A),{cancel:()=>{l&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(s){const r=s.data,l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h.cancel()}else if(r.mustQueue||Tn()){const h=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add((()=>this.processTask(l,r)),h&&h.metadata||{type:"message"})}else this.processTask(l,r)}processTask(s,r){if(r.type==="<response>"){const l=this.callbacks[s];delete this.callbacks[s],l&&(r.error?l(Y(r.error)):l(null,Y(r.data)))}else{const l=hr(this.globalScope)?void 0:[],h=r.hasCallback?(x,b)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:x?F(x):null,data:F(b,l)},l)}:x=>{},p=Y(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,p,h);else if(this.parent.getWorkerSource){const x=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,x[0],p.source)[x[1]](p,h)}else h(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=k_,o.Color=No,o.ColorMode=ff,o.CullFaceMode=Od,o.DEMData=X_,o.DataConstantProperty=ve,o.DedupedRequest=B4,o.DepthMode=Ig,o.EXTENT=_t,o.Elevation=class{isDataAvailableAtPoint(s){const r=this._source();if(this.isUsingMockSource()||!r||s.y<0||s.y>1)return!1;const l=r.getSource().maxzoom,h=1<<l,p=Math.floor(s.x),x=Math.floor((s.x-p)*h),b=Math.floor(s.y*h),A=this.findDEMTileFor(new oh(l,p,l,x,b));return!(!A||!A.dem)}getAtPointOrZero(s,r=0){return this.getAtPoint(s,r)||0}getAtPoint(s,r,l=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const h=this._source();if(!h||s.y<0||s.y>1)return r;const p=h.getSource().maxzoom,x=1<<p,b=Math.floor(s.x),A=s.x-b,P=new oh(p,b,p,Math.floor(A*x),Math.floor(s.y*x)),k=this.findDEMTileFor(P);if(!k||!k.dem)return r;const q=k.dem,K=1<<k.tileID.canonical.z,te=(A*K-k.tileID.canonical.x)*q.dim,ue=(s.y*K-k.tileID.canonical.y)*q.dim,pe=Math.floor(te),Se=Math.floor(ue);return(l?this.exaggeration():1)*$e($e(q.get(pe,Se),q.get(pe,Se+1),ue-Se),$e(q.get(pe+1,Se),q.get(pe+1,Se+1),ue-Se),te-pe)}getAtTileOffset(s,r,l){const h=1<<s.canonical.z;return this.getAtPointOrZero(new of(s.wrap+(s.canonical.x+r/_t)/h,(s.canonical.y+l/_t)/h))}getAtTileOffsetFunc(s,r,l,h){return p=>{const x=this.getAtTileOffset(s,p.x,p.y),b=h.upVector(s.canonical,p.x,p.y);return Rn(b,b,x*h.upVectorScale(s.canonical,r,l).metersToTile),b}}getForTilePoints(s,r,l,h){if(this.isUsingMockSource())return!1;const p=K_.create(this,s,h);return!!p&&(r.forEach((x=>{x[2]=this.exaggeration()*p.getElevationAt(x[0],x[1],l)})),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(s);if(!r||!r.dem)return null;const l=r.dem.tree,h=r.tileID,p=1<<s.canonical.z-h.canonical.z;let x=s.canonical.x/p-h.canonical.x,b=s.canonical.y/p-h.canonical.y,A=0;for(let P=0;P<s.canonical.z-h.canonical.z&&!l.leaves[A];P++){x*=2,b*=2;const k=2*Math.floor(b)+Math.floor(x);A=l.childOffsets[A]+k,x%=1,b%=1}return{min:this.exaggeration()*l.minimums[A],max:this.exaggeration()*l.maximums[A]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,r,l){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Ea,o.EvaluationParameters=G,o.Event=hl,o.Evented=Ro,o.FillExtrusionBucket=G0,o.Frustum=mi,o.FrustumCorners=rh,o.GLOBE_RADIUS=Ns,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=ha,o.GLOBE_ZOOM_THRESHOLD_MIN=Ls,o.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_fillGridMeshWithLods(s,r){const l=new gn,h=new _r,p=[],x=s+1+2,b=r[0]+1,A=r[0]+1+(1+r.length),P=(k,q,K)=>{let te=k===x-1?k-2:k===0?k:k-1;return te+=K?24575:0,[te,q]};for(let k=0;k<x;++k)l.emplaceBack(...P(k,0,!0));for(let k=0;k<b;++k)for(let q=0;q<x;++q)l.emplaceBack(...P(q,k,(q===0||q===x-1)&&!0));for(let k=0;k<r.length;++k){const q=r[k];for(let K=0;K<x;++K)l.emplaceBack(...P(K,q,!0))}for(let k=0;k<r.length;++k){const q=h.length,K=r[k]+1+2,te=new _r;for(let Se=0;Se<K-1;Se++){const Ge=Se===K-2,at=Ge?x*(A-r.length+k-Se):x;for(let xt=0;xt<x-1;xt++){const lt=Se*x+xt;Se===0||Ge||xt===0||xt===x-2?(te.emplaceBack(lt+1,lt,lt+at),te.emplaceBack(lt+at,lt+at+1,lt+1)):(h.emplaceBack(lt+1,lt,lt+at),h.emplaceBack(lt+at,lt+at+1,lt+1))}}const ue=Lt.simpleSegment(0,q,l.length,h.length-q);for(let Se=0;Se<te.uint16.length;Se+=3)h.emplaceBack(te.uint16[Se],te.uint16[Se+1],te.uint16[Se+2]);const pe=Lt.simpleSegment(0,q,l.length,h.length-q);p.push({withoutSkirts:ue,withSkirts:pe})}return{vertices:l,indices:h,segments:p}}_createGrid(s){const r=this._fillGridMeshWithLods(ru,Ds);this._gridSegments=r.segments,this._gridBuffer=s.createVertexBuffer(r.vertices,dd.members),this._gridIndexBuffer=s.createIndexBuffer(r.indices,!0)}_createPoles(s){const r=new _r;for(let p=0;p<=ru;p++)r.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=s.createIndexBuffer(r,!0);const l=new co,h=new co;this._poleSegments=[];for(let p=0,x=0;p<Ls;p++){const b=360/(1<<p);l.emplaceBack(0,-Ns,0,.5,0),h.emplaceBack(0,-Ns,0,.5,1);for(let A=0;A<=ru;A++){const P=A/ru,k=$e(0,b,P),[q,K,te]=vl(E_,lx,k,Ns);l.emplaceBack(q,K,te,P,0),h.emplaceBack(q,K,te,P,1)}this._poleSegments.push(Lt.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(l,nh,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(h,nh,!1)}getGridBuffers(s,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,r){if(!this._wireframeSegments){const l=new ps,h=ru,p=h+1+2,x=1;this._wireframeSegments=[];for(let b=0,A=0;b<Ds.length;b++){const P=Ds[b];for(let q=x;q<P+x;q++)for(let K=x;K<h+x;K++){const te=q*p+K;l.emplaceBack(te,te+1),l.emplaceBack(te,te+p),l.emplaceBack(te,te+p+1)}const k=P*h*3;this._wireframeSegments.push(Lt.simpleSegment(0,A,(P+1)*p,k)),A+=k}this._wireframeIndexBuffer=s.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},o.GlyphManager=wg,o.ImagePosition=vx,o.KDBush=Fx,o.LivePerformanceUtils=zl,o.LngLat=ai,o.LngLatBounds=gt,o.LocalGlyphMode=wx,o.MAX_MERCATOR_LATITUDE=Ha,o.MercatorCoordinate=of,o.ONE_EM=iu,o.OverscaledTileID=oh,o.PerformanceMarkers=La,o.Point=$,o.Properties=st,o.RGBAImage=zu,o.Ray=Md,o.RequestManager=class{constructor(s,r,l){this._transformRequestFn=s,this._customAccessToken=r,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const s=(function(){let r="";for(let l=0;l<10;l++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ye,r].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,r){return this._transformRequestFn&&this._transformRequestFn(s,r)||{url:s}}normalizeStyleURL(s,r){if(!Ct(s))return s;const l=Bn(s);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeGlyphsURL(s,r){if(!Ct(s))return s;const l=Bn(s);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeSourceURL(s,r,l,h){if(!Ct(s))return s;const p=Bn(s);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),l&&p.params.push(`language=${l}`),h&&p.params.push(`worldview=${h}`),this._makeAPIURL(p,this._customAccessToken||r)}normalizeSpriteURL(s,r,l,h){const p=Bn(s);return Ct(s)?(p.path=`/styles/v1${p.path}/sprite${r}${l}`,this._makeAPIURL(p,this._customAccessToken||h)):(p.path+=`${r}${l}`,Ln(p))}normalizeTileURL(s,r,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Ct(s))return s;const h=Bn(s);h.path=h.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||l&&h.authority!=="raster"&&l===512?"@2x":""}${M.supported?".webp":"$1"}`),h.authority==="raster"?h.path=`/${V.RASTER_URL_PREFIX}${h.path}`:(h.path=h.path.replace(/^.+\/v4\//,"/"),h.path=`/${V.TILE_URL_VERSION}${h.path}`);const p=this._customAccessToken||(function(x){for(const b of x){const A=b.match(/^access_token=(.*)$/);if(A)return A[1]}return null})(h.params)||V.ACCESS_TOKEN;return V.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&h.params.push(`sku=${this._skuToken}`),this._makeAPIURL(h,p)}canonicalizeTileURL(s,r){const l=Bn(s);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return s;let h="mapbox://";l.path.match(/^\/raster\/v1\//)?h+=`raster/${l.path.replace(`/${V.RASTER_URL_PREFIX}/`,"")}`:h+=`tiles/${l.path.replace(`/${V.TILE_URL_VERSION}/`,"")}`;let p=l.params;return r&&(p=p.filter((x=>!x.match(/^access_token=/)))),p.length&&(h+=`?${p.join("&")}`),h}canonicalizeTileset(s,r){const l=!!r&&Ct(r),h=[];for(const p of s.tiles||[])Rt(p)?h.push(this.canonicalizeTileURL(p,l)):h.push(p);return h}_makeAPIURL(s,r){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",h=Bn(V.API_URL);if(s.protocol=h.protocol,s.authority=h.authority,s.protocol==="http"){const p=s.params.indexOf("secure");p>=0&&s.params.splice(p,1)}if(h.path!=="/"&&(s.path=`${h.path}${s.path}`),!V.REQUIRE_ACCESS_TOKEN)return Ln(s);if(r=r||V.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return s.params=s.params.filter((p=>p.indexOf("access_token")===-1)),s.params.push(`access_token=${r||""}`),Ln(s)}},o.ResourceType=pr,o.SegmentVector=Lt,o.SourceCache=bm,o.StencilMode=Mx,o.StructArrayLayout1ui2=il,o.StructArrayLayout2f1f2i16=ar,o.StructArrayLayout2i4=gn,o.StructArrayLayout2ui4=ps,o.StructArrayLayout3f12=hi,o.StructArrayLayout3ui6=_r,o.StructArrayLayout4i8=un,o.StructArrayLayout5f20=co,o.Texture=ny,o.Tile=Px,o.Transitionable=me,o.Uniform1f=Cd,o.Uniform1i=class extends Ru{constructor(s){super(s),this.current=0}set(s,r,l){this.fetchUniformLocation(s,r)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},o.Uniform2f=class extends Ru{constructor(s){super(s),this.current=[0,0]}set(s,r,l){this.fetchUniformLocation(s,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},o.Uniform3f=class extends Ru{constructor(s){super(s),this.current=[0,0,0]}set(s,r,l){this.fetchUniformLocation(s,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},o.Uniform4f=Ld,o.UniformColor=Of,o.UniformMatrix2f=class extends Ru{constructor(s){super(s),this.current=Pd}set(s,r,l){if(this.fetchUniformLocation(s,r)){for(let h=0;h<4;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}},o.UniformMatrix3f=class extends Ru{constructor(s){super(s),this.current=Mh}set(s,r,l){if(this.fetchUniformLocation(s,r)){for(let h=0;h<9;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},o.UniformMatrix4f=class extends Ru{constructor(s){super(s),this.current=Gh}set(s,r,l){if(this.fetchUniformLocation(s,r)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let h=1;h<16;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},o.UnwrappedTileID=L3,o.ValidationError=or,o.VectorTileFeature=Pi,o.VectorTileWorkerSource=class extends Ro{constructor(s,r,l,h,p){super(),this.actor=s,this.layerIndex=r,this.availableImages=l,this.loadVectorData=p||z4,this.loading={},this.loaded={},this.deduped=new B4(s.scheduler),this.isSpriteLoaded=h,this.scheduler=s.scheduler}loadTile(s,r){const l=s.uid,h=s&&s.request,p=h&&h.collectResourceTiming,x=this.loading[l]=new KC(s);x.abort=this.loadVectorData(s,((b,A)=>{const P=!this.loading[l];if(delete this.loading[l],P||b||!A)return x.status="done",P||(this.loaded[l]=x),r(b);const k=A.rawData,q={};A.expires&&(q.expires=A.expires),A.cacheControl&&(q.cacheControl=A.cacheControl),x.vectorTile=A.vectorTile||new fi(new D_(k));const K=()=>{x.parse(x.vectorTile,this.layerIndex,this.availableImages,this.actor,((te,ue)=>{if(te||!ue)return r(te);const pe={};if(p){const Se=nc(h);Se.length>0&&(pe.resourceTiming=JSON.parse(JSON.stringify(Se)))}r(null,Fe({rawTileData:k.slice(0)},ue,q,pe))}))};this.isSpriteLoaded?K():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(K,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):K()})),this.loaded=this.loaded||{},this.loaded[l]=x}))}reloadTile(s,r){const l=this.loaded,h=s.uid,p=this;if(l&&l[h]){const x=l[h];x.showCollisionBoxes=s.showCollisionBoxes,x.enableTerrain=!!s.enableTerrain,x.projection=s.projection,x.tileTransform=xm(s.tileID.canonical,s.projection);const b=(A,P)=>{const k=x.reloadCallback;k&&(delete x.reloadCallback,x.parse(x.vectorTile,p.layerIndex,this.availableImages,p.actor,k)),r(A,P)};x.status==="parsing"?x.reloadCallback=b:x.status==="done"&&(x.vectorTile?x.parse(x.vectorTile,this.layerIndex,this.availableImages,this.actor,b):b())}}abortTile(s,r){const l=s.uid,h=this.loading[l];h&&(h.abort&&h.abort(),delete this.loading[l]),r()}removeTile(s,r){const l=this.loaded,h=s.uid;l&&l[h]&&delete l[h],r()}},o.WritingMode=Yh,o.ZoomDependentExpression=kc,o.add=Vr,o.addDynamicAttributes=G_,o.adjoint=function(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],b=r[4],A=r[5],P=r[6],k=r[7],q=r[8];return s[0]=b*q-A*k,s[1]=p*k-h*q,s[2]=h*A-p*b,s[3]=A*P-x*q,s[4]=l*q-p*P,s[5]=p*x-l*A,s[6]=x*k-b*P,s[7]=h*P-l*k,s[8]=l*b-h*x,s},o.asyncAll=ae,o.bezier=Re,o.bindAll=Jt,o.boundsAttributes=b4,o.bufferConvexPolygon=function(s,r){const l=[];for(let h=0;h<s.length;h++){const p=xe(h-1,-1,s.length-1),x=xe(h+1,-1,s.length-1),b=s[h],A=s[x],P=s[p].sub(b).unit(),k=A.sub(b).unit(),q=k.angleWithSep(P.x,P.y),K=P.add(k).unit().mult(-1*r/Math.sin(q/2));l.push(b.add(K))}return l},o.cacheEntryPossiblyAdded=function(s){Mi++,Mi>Rr&&(s.getActor().send("enforceCacheSizeLimit",Hn),Mi=0)},o.calculateGlobeLabelMatrix=function(s,r){const{x:l,y:h}=s.point,p=Hh(l,h,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Br(p,p,ig(yu(r)))},o.calculateGlobeMatrix=function(s){const{x:r,y:l}=s.point,{lng:h,lat:p}=s._center;return Hh(r,l,s.worldSize,h,p)},o.calculateGlobeMercatorMatrix=function(s){const r=s.pixelsPerMeter,l=r/al(1,s.center.lat),h=Zt(new Float64Array(16));return zr(h,h,[s.point.x,s.point.y,0]),Gn(h,h,[l,l,r]),Float32Array.from(h)},o.circumferenceAtLatitude=Yl,o.clamp=De,o.clearTileCache=function(s){if(!br())return;const r=w.caches.delete(tr);s&&r.catch(s).then((()=>s()))},o.clipLine=r4,o.clone=function(s){var r=new Yt(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r},o.clone$1=zt,o.collisionCircleLayout=H8,o.config=V,o.conjugate=function(s,r){return s[0]=-r[0],s[1]=-r[1],s[2]=-r[2],s[3]=r[3],s},o.create=function(){var s=new Yt(16);return Yt!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},o.create$1=bn,o.createExpression=Co,o.createLayout=kt,o.createStyleLayer=function(s){return s.type==="custom"?new BC(s):new jC[s.type](s)},o.cross=sl,o.degToRad=Z,o.distance=function(s,r){return Math.hypot(r[0]-s[0],r[1]-s[1],r[2]-s[2])},o.div=function(s,r,l){return s[0]=r[0]/l[0],s[1]=r[1]/l[1],s[2]=r[2]/l[2],s},o.dot=Ni,o.earthRadius=rf,o.ease=be,o.easeCubicInOut=Oe,o.ecefToLatLng=function([s,r,l]){const h=Math.hypot(s,r,l),p=Math.atan2(s,l),x=.5*Math.PI-Math.acos(-r/h);return new ai(Ee(p),Ee(x))},o.emitValidationErrors=Pl,o.endsWith=tn,o.enforceCacheSizeLimit=function(s){Ir(),lr&&lr.then((r=>{r.keys().then((l=>{for(let h=0;h<l.length-s;h++)r.delete(l[h])}))}))},o.evaluateSizeForFeature=R_,o.evaluateSizeForZoom=_g,o.evaluateVariableOffset=l4,o.evented=S,o.exactEquals=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]&&s[3]===r[3]},o.exactEquals$1=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]},o.exported=Qo,o.exported$1=M,o.extend=Fe,o.extend$1=ss,o.fillExtrusionHeightLift=T3,o.filterObject=An,o.fromMat4=function(s,r){return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[4],s[4]=r[5],s[5]=r[6],s[6]=r[8],s[7]=r[9],s[8]=r[10],s},o.fromQuat=function(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],b=l+l,A=h+h,P=p+p,k=l*b,q=h*b,K=h*A,te=p*b,ue=p*A,pe=p*P,Se=x*b,Ge=x*A,at=x*P;return s[0]=1-K-pe,s[1]=q+at,s[2]=te-Ge,s[3]=0,s[4]=q-at,s[5]=1-k-pe,s[6]=ue+Se,s[7]=0,s[8]=te+Ge,s[9]=ue-Se,s[10]=1-k-K,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},o.fromRotation=function(s,r){var l=Math.sin(r),h=Math.cos(r);return s[0]=h,s[1]=l,s[2]=0,s[3]=-l,s[4]=h,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},o.fromScaling=ni,o.furthestTileCorner=function(s){const r=Math.round((s+45+360)%360/90)%4;return ke[r]},o.getAABBPointSquareDist=function(s,r,l){let h=0;for(let p=0;p<2;++p){const x=l?l[p]:0;s[p]>x&&(h+=(s[p]-x)*(s[p]-x)),r[p]<x&&(h+=(x-r[p])*(x-r[p]))}return h},o.getAnchorAlignment=bx,o.getAnchorJustification=Ex,o.getBounds=function(s){let r=1/0,l=1/0,h=-1/0,p=-1/0;for(const x of s)r=Math.min(r,x.x),l=Math.min(l,x.y),h=Math.max(h,x.x),p=Math.max(p,x.y);return{min:new $(r,l),max:new $(h,p)}},o.getColumn=Nn,o.getDefaultExportFromCjs=he,o.getGridMatrix=function(s,r,l,h){const p=r.getNorth(),x=r.getSouth(),b=r.getWest(),A=r.getEast(),P=1<<s.z,k=A-b,q=p-x,K=k/ru,te=-q/Ds[l],ue=[0,K,0,te,0,0,p,b,0];if(s.z>0){const pe=180/h;rn(ue,ue,[pe/k+1,0,0,0,pe/q+1,0,-.5*pe/K,.5*pe/te,1])}return ue[2]=P,ue[5]=s.x,ue[8]=s.y,ue},o.getImage=Ye,o.getJSON=function(s,r){return Sr(Fe(s,{type:"json"}),r)},o.getLatitudinalLod=function(s){const r=Ha-5;s=De(s,-r,r)/r*90;const l=Math.pow(Math.abs(Math.sin(Z(s))),3);return Math.round(l*(Ds.length-1))},o.getMapSessionAPI=oo,o.getPerformanceMeasurement=nc,o.getProjection=g4,o.getRTLTextPluginStatus=T,o.getReferrer=Kr,o.getTilePoint=function(s,{x:r,y:l},h=0){return new $(((r-h)*s.scale-s.x)*_t,(l*s.scale-s.y)*_t)},o.getTileVec3=function(s,r,l=0){return jr(((r.x-l)*s.scale-s.x)*_t,(r.y*s.scale-s.y)*_t,bp(r.z,r.y))},o.getVideo=function(s,r){const l=w.document.createElement("video");l.muted=!0,l.onloadstart=function(){r(null,l)};for(let h=0;h<s.length;h++){const p=w.document.createElement("source");ii(s[h])||(l.crossOrigin="Anonymous"),p.src=s[h],l.appendChild(p)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(s){const r=[0,0,0],l=Zt(new Float64Array(16));return Br(l,s.pixelMatrix,s.globeMatrix),ti(r,r,l),new $(r[0],r[1])},o.globeDenormalizeECEF=ig,o.globeECEFOrigin=function(s,r){const l=[0,0,0];return ti(l,l,Fu(yu(r.canonical))),ti(l,l,s),l},o.globeMetersToEcef=tf,o.globeNormalizeECEF=Fu,o.globePixelsToTileUnits=function(s,r){return _t/(512*Math.pow(2,s))*sm(yu(r))},o.globePoleMatrixForTile=function(s,r,l){const h=Zt(new Float64Array(16)),p=(r/(1<<s)-.5)*Math.PI*2;return Ei(h,l.globeMatrix,p),Float32Array.from(h)},o.globeTileBounds=yu,o.globeTiltAtLngLat=L0,o.globeToMercatorTransition=xp,o.globeUseCustomAntiAliasing=function(s,r,l){const h=xp(l.zoom),p=s.style.map._antialias,x=!!r.extStandardDerivatives,b=r.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return h===0&&!p&&!b&&x},o.identity=Zt,o.identity$1=Rh,o.invert=En,o.isFullscreen=function(){return!!w.document.fullscreenElement||!!w.document.webkitFullscreenElement},o.isLngLatBehindGlobe=og,o.isMapAuthenticated=function(s){return Jo.has(s)},o.isMapboxURL=Ct,o.isSafariWithAntialiasingBug=function(s){const r=s.navigator?s.navigator.userAgent:null;return!!hr(s)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Ho,o.latLngToECEF=_u,o.len=gc,o.length=Ri,o.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},o.lngFromMercatorX=zc,o.loadVectorTile=z4,o.makeRequest=Sr,o.mapValue=function(s,r,l,h,p){return De((s-r)/(l-r)*(p-h)+h,h,p)},o.mercatorScale=am,o.mercatorXfromLng=ta,o.mercatorYfromLat=Ca,o.mercatorZfromAltitude=al,o.mul=qi,o.mul$1=Oa,o.multiply=Br,o.multiply$1=rn,o.multiply$2=zn,o.nextPowerOfTwo=ht,o.normalize=Xr,o.normalize$1=gu,o.normalize$2=Zn,o.number=$e,o.ortho=function(s,r,l,h,p,x,b){var A=1/(r-l),P=1/(h-p),k=1/(x-b);return s[0]=-2*A,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*P,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*k,s[11]=0,s[12]=(r+l)*A,s[13]=(p+h)*P,s[14]=(b+x)*k,s[15]=1,s},o.pbf=F3,o.perspective=function(s,r,l,h,p){var x,b=1/Math.tan(r/2);return s[0]=b/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=b,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,p!=null&&p!==1/0?(s[10]=(p+h)*(x=1/(h-p)),s[14]=2*p*h*x):(s[10]=-1,s[14]=-2*h),s},o.pick=function(s,r){const l={};for(let h=0;h<r.length;h++){const p=r[h];p in s&&(l[p]=s[p])}return l},o.plugin=B,o.pointGeometry=j,o.polesInViewport=function(s){const r=Zt(new Float64Array(16));Br(r,s.pixelMatrix,s.globeMatrix);const l=[0,Bc,0],h=[0,Er,0];return ti(l,l,r),ti(h,h,r),[l[0]>0&&l[0]<=s.width&&l[1]>0&&l[1]<=s.height&&!og(s,new ai(s.center.lat,90)),h[0]>0&&h[0]<=s.width&&h[1]>0&&h[1]<=s.height&&!og(s,new ai(s.center.lat,-90))]},o.polygonContainsPoint=Nd,o.polygonIntersectsBox=A_,o.polygonIntersectsPolygon=ag,o.polygonizeBounds=function(s,r,l=0,h=!0){const p=new $(l,l),x=s.sub(p),b=r.add(p),A=[x,new $(b.x,x.y),b,new $(x.x,b.y)];return h&&A.push(x.clone()),A},o.posAttributes=dd,o.postMapLoadEvent=ro,o.postPerformanceEvent=Ji,o.postTurnstileEvent=_i,o.potpack=_x,o.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},o.radToDeg=Ee,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(s){return s({pluginStatus:y,pluginURL:a}),S.on("pluginStateChange",s),s},o.removeAuthState=function(s){Jo.delete(s)},o.renderColorRamp=B0,o.resample=Ou,o.rotateX=vr,o.rotateX$1=yc,o.rotateY=Ei,o.rotateY$1=hd,o.rotateZ=function(s,r,l){var h=Math.sin(l),p=Math.cos(l),x=r[0],b=r[1],A=r[2],P=r[3],k=r[4],q=r[5],K=r[6],te=r[7];return r!==s&&(s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=x*p+k*h,s[1]=b*p+q*h,s[2]=A*p+K*h,s[3]=P*p+te*h,s[4]=k*p-x*h,s[5]=q*p-b*h,s[6]=K*p-A*h,s[7]=te*p-P*h,s},o.rotateZ$1=function(s,r,l){l*=.5;var h=r[0],p=r[1],x=r[2],b=r[3],A=Math.sin(l),P=Math.cos(l);return s[0]=h*P+p*A,s[1]=p*P-h*A,s[2]=x*P+b*A,s[3]=b*P-x*A,s},o.scale=Gn,o.scale$1=Do,o.scale$2=Rn,o.scaleAndAdd=gr,o.set=function(s,r,l,h){return s[0]=r,s[1]=l,s[2]=h,s},o.setCacheLimits=function(s,r){Hn=s,Rr=r},o.setColumn=function(s,r,l){s[4*r+0]=l[0],s[4*r+1]=l[1],s[4*r+2]=l[2],s[4*r+3]=l[3]},o.setRTLTextPlugin=function(s,r,l=!1){if(y===ft||y===Ot||y===Kt)throw new Error("setRTLTextPlugin cannot be called multiple times.");a=Qo.resolveURL(s),y=ft,Sn=r,v(),l||R()},o.smoothstep=Qe,o.spec=pn,o.squaredLength=function(s){var r=s[0],l=s[1],h=s[2];return r*r+l*l+h*h},o.storeAuthState=function(s,r){r?Jo.add(s):Jo.delete(s)},o.sub=bs,o.subtract=Ci,o.symbolSize=X8,o.tileAABB=function(s,r,l,h,p,x,b,A,P){if(P.name==="globe")return vp(s,r,new k_(l,h,p));const k=xm({z:l,x:h,y:p},P);return new io([(x+k.x/k.scale)*r,r*(k.y/k.scale),b],[(x+k.x2/k.scale)*r,r*(k.y2/k.scale),A])},o.tileCornersToBounds=nf,o.tileTransform=xm,o.transformMat3=function(s,r,l){var h=r[0],p=r[1],x=r[2];return s[0]=h*l[0]+p*l[3]+x*l[6],s[1]=h*l[1]+p*l[4]+x*l[7],s[2]=h*l[2]+p*l[5]+x*l[8],s},o.transformMat4=ti,o.transformMat4$1=_l,o.transformQuat=cs,o.transitionTileAABBinECEF=im,o.translate=zr,o.transpose=function(s,r){if(s===r){var l=r[1],h=r[2],p=r[5];s[1]=r[3],s[2]=r[6],s[3]=l,s[5]=r[7],s[6]=h,s[7]=p}else s[0]=r[0],s[1]=r[3],s[2]=r[6],s[3]=r[1],s[4]=r[4],s[5]=r[7],s[6]=r[2],s[7]=r[5],s[8]=r[8];return s},o.triggerPluginCompletionEvent=f,o.uniqueId=et,o.updateGlobeVertexNormal=function(s,r,l,h,p){const x=5*r+2;s.float32[x+0]=l,s.float32[x+1]=h,s.float32[x+2]=p},o.validateCustomStyleLayer=function(s){const r=[],l=s.id;return l===void 0&&r.push({message:`layers.${l}: missing required property "id"`}),s.render===void 0&&r.push({message:`layers.${l}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&r.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),r},o.validateFilter=s=>$a(yl(s)),o.validateFog=s=>$a(Nc(s)),o.validateLayer=s=>$a(Id(s)),o.validateLight=s=>$a($h(s)),o.validateSource=s=>$a(eh(s)),o.validateStyle=va,o.validateTerrain=s=>$a(nu(s)),o.values=Me,o.vectorTile=yn,o.version=I,o.warnOnce=ur,o.window=w,o.wrap=xe})),m(["./shared"],(function(o){function w(ut){if(typeof ut=="number"||typeof ut=="boolean"||typeof ut=="string"||ut==null)return JSON.stringify(ut);if(Array.isArray(ut)){let Ie="[";for(const Ye of ut)Ie+=`${w(Ye)},`;return`${Ie}]`}let we="{";for(const Ie of Object.keys(ut).sort())we+=`${Ie}:${w(ut[Ie])},`;return`${we}}`}function I(ut){let we="";for(const Ie of o.refProperties)we+=`/${w(ut[Ie])}`;return we}class O{constructor(we){this.keyCache={},we&&this.replace(we)}replace(we){this._layerConfigs={},this._layers={},this.update(we,[])}update(we,Ie){for(const ct of we)this._layerConfigs[ct.id]=ct,(this._layers[ct.id]=o.createStyleLayer(ct)).compileFilter(),this.keyCache[ct.id]&&delete this.keyCache[ct.id];for(const ct of Ie)delete this.keyCache[ct],delete this._layerConfigs[ct],delete this._layers[ct];this.familiesBySource={};const Ye=(function(ct,Ct){const Rt={};for(let St=0;St<ct.length;St++){const Mt=Ct&&Ct[ct[St].id]||I(ct[St]);Ct&&(Ct[ct[St].id]=Mt);let vn=Rt[Mt];vn||(vn=Rt[Mt]=[]),vn.push(ct[St])}const Bt=[];for(const St in Rt)Bt.push(Rt[St]);return Bt})(o.values(this._layerConfigs),this.keyCache);for(const ct of Ye){const Ct=ct.map((Bn=>this._layers[Bn.id])),Rt=Ct[0];if(Rt.visibility==="none")continue;const Bt=Rt.source||"";let St=this.familiesBySource[Bt];St||(St=this.familiesBySource[Bt]={});const Mt=Rt.sourceLayer||"_geojsonTileLayer";let vn=St[Mt];vn||(vn=St[Mt]=[]),vn.push(Ct)}}}class V{loadTile(we,Ie){const{uid:Ye,encoding:ct,rawImageData:Ct,padding:Rt,buildQuadTree:Bt}=we,St=o.window.ImageBitmap&&Ct instanceof o.window.ImageBitmap?this.getImageData(Ct,Rt):Ct;Ie(null,new o.DEMData(Ye,St,ct,Rt<1,Bt))}getImageData(we,Ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(we.width,we.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=we.width,this.offscreenCanvas.height=we.height,this.offscreenCanvasContext.drawImage(we,0,0,we.width,we.height);const Ye=this.offscreenCanvasContext.getImageData(-Ie,-Ie,we.width+2*Ie,we.height+2*Ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ye}}function M(ut,we){if(ut.length!==0){se(ut[0],we);for(var Ie=1;Ie<ut.length;Ie++)se(ut[Ie],!we)}}function se(ut,we){for(var Ie=0,Ye=0,ct=0,Ct=ut.length,Rt=Ct-1;ct<Ct;Rt=ct++){var Bt=(ut[ct][0]-ut[Rt][0])*(ut[Rt][1]+ut[ct][1]),St=Ie+Bt;Ye+=Math.abs(Ie)>=Math.abs(Bt)?Ie-St+Bt:Bt-St+Ie,Ie=St}Ie+Ye>=0!=!!we&&ut.reverse()}var ce=o.getDefaultExportFromCjs((function ut(we,Ie){var Ye,ct=we&&we.type;if(ct==="FeatureCollection")for(Ye=0;Ye<we.features.length;Ye++)ut(we.features[Ye],Ie);else if(ct==="GeometryCollection")for(Ye=0;Ye<we.geometries.length;Ye++)ut(we.geometries[Ye],Ie);else if(ct==="Feature")ut(we.geometry,Ie);else if(ct==="Polygon")M(we.coordinates,Ie);else if(ct==="MultiPolygon")for(Ye=0;Ye<we.coordinates.length;Ye++)M(we.coordinates[Ye],Ie);return we}));const fe=o.VectorTileFeature.prototype.toGeoJSON;var ne={exports:{}},oe=o.pointGeometry,ye=o.vectorTile.VectorTileFeature,he=Ne;function Ne(ut,we){this.options=we||{},this.features=ut,this.length=ut.length}function Ve(ut,we){this.id=typeof ut.id=="number"?ut.id:void 0,this.type=ut.type,this.rawGeometry=ut.type===1?[ut.geometry]:ut.geometry,this.properties=ut.tags,this.extent=we||4096}Ne.prototype.feature=function(ut){return new Ve(this.features[ut],this.options.extent)},Ve.prototype.loadGeometry=function(){var ut=this.rawGeometry;this.geometry=[];for(var we=0;we<ut.length;we++){for(var Ie=ut[we],Ye=[],ct=0;ct<Ie.length;ct++)Ye.push(new oe(Ie[ct][0],Ie[ct][1]));this.geometry.push(Ye)}return this.geometry},Ve.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ut=this.geometry,we=1/0,Ie=-1/0,Ye=1/0,ct=-1/0,Ct=0;Ct<ut.length;Ct++)for(var Rt=ut[Ct],Bt=0;Bt<Rt.length;Bt++){var St=Rt[Bt];we=Math.min(we,St.x),Ie=Math.max(Ie,St.x),Ye=Math.min(Ye,St.y),ct=Math.max(ct,St.y)}return[we,Ye,Ie,ct]},Ve.prototype.toGeoJSON=ye.prototype.toGeoJSON;var de=o.pbf,j=he;function D(ut){var we=new de;return(function(Ie,Ye){for(var ct in Ie.layers)Ye.writeMessage(3,$,Ie.layers[ct])})(ut,we),we.finish()}function $(ut,we){var Ie;we.writeVarintField(15,ut.version||1),we.writeStringField(1,ut.name||""),we.writeVarintField(5,ut.extent||4096);var Ye={keys:[],values:[],keycache:{},valuecache:{}};for(Ie=0;Ie<ut.length;Ie++)Ye.feature=ut.feature(Ie),we.writeMessage(2,z,Ye);var ct=Ye.keys;for(Ie=0;Ie<ct.length;Ie++)we.writeStringField(3,ct[Ie]);var Ct=Ye.values;for(Ie=0;Ie<Ct.length;Ie++)we.writeMessage(4,Oe,Ct[Ie])}function z(ut,we){var Ie=ut.feature;Ie.id!==void 0&&we.writeVarintField(1,Ie.id),we.writeMessage(2,W,ut),we.writeVarintField(3,Ie.type),we.writeMessage(4,ke,Ie)}function W(ut,we){var Ie=ut.feature,Ye=ut.keys,ct=ut.values,Ct=ut.keycache,Rt=ut.valuecache;for(var Bt in Ie.properties){var St=Ie.properties[Bt],Mt=Ct[Bt];if(St!==null){Mt===void 0&&(Ye.push(Bt),Ct[Bt]=Mt=Ye.length-1),we.writeVarint(Mt);var vn=typeof St;vn!=="string"&&vn!=="boolean"&&vn!=="number"&&(St=JSON.stringify(St));var Bn=vn+":"+St,Ln=Rt[Bn];Ln===void 0&&(ct.push(St),Rt[Bn]=Ln=ct.length-1),we.writeVarint(Ln)}}}function Z(ut,we){return(we<<3)+(7&ut)}function Ee(ut){return ut<<1^ut>>31}function ke(ut,we){for(var Ie=ut.loadGeometry(),Ye=ut.type,ct=0,Ct=0,Rt=Ie.length,Bt=0;Bt<Rt;Bt++){var St=Ie[Bt],Mt=1;Ye===1&&(Mt=St.length),we.writeVarint(Z(1,Mt));for(var vn=Ye===3?St.length-1:St.length,Bn=0;Bn<vn;Bn++){Bn===1&&Ye!==1&&we.writeVarint(Z(2,vn-1));var Ln=St[Bn].x-ct,qr=St[Bn].y-Ct;we.writeVarint(Ee(Ln)),we.writeVarint(Ee(qr)),ct+=Ln,Ct+=qr}Ye===3&&we.writeVarint(Z(7,1))}}function Oe(ut,we){var Ie=typeof ut;Ie==="string"?we.writeStringField(1,ut):Ie==="boolean"?we.writeBooleanField(7,ut):Ie==="number"&&(ut%1!=0?we.writeDoubleField(3,ut):ut<0?we.writeSVarintField(6,ut):we.writeVarintField(5,ut))}ne.exports=D,ne.exports.fromVectorTileJs=D,ne.exports.fromGeojsonVt=function(ut,we){we=we||{};var Ie={};for(var Ye in ut)Ie[Ye]=new j(ut[Ye].features,we),Ie[Ye].name=Ye,Ie[Ye].version=we.version,Ie[Ye].extent=we.extent;return D({layers:Ie})},ne.exports.GeoJSONWrapper=j;var Re=o.getDefaultExportFromCjs(ne.exports);const be={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ut=>ut},De=Math.fround||(Qe=new Float32Array(1),ut=>(Qe[0]=+ut,Qe[0]));var Qe;const xe=3,ae=5,Me=6;class Fe{constructor(we){this.options=Object.assign(Object.create(be),we),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(we){const{log:Ie,minZoom:Ye,maxZoom:ct}=this.options;Ie&&console.time("total time");const Ct=`prepare ${we.length} points`;Ie&&console.time(Ct),this.points=we;const Rt=[];for(let St=0;St<we.length;St++){const Mt=we[St];if(!Mt.geometry)continue;const[vn,Bn]=Mt.geometry.coordinates,Ln=De(mt(vn)),qr=De(ht(Bn));Rt.push(Ln,qr,1/0,St,-1,1),this.options.reduce&&Rt.push(0)}let Bt=this.trees[ct+1]=this._createTree(Rt);Ie&&console.timeEnd(Ct);for(let St=ct;St>=Ye;St--){const Mt=+Date.now();Bt=this.trees[St]=this._createTree(this._cluster(Bt,St)),Ie&&console.log("z%d: %d clusters in %dms",St,Bt.numItems,+Date.now()-Mt)}return Ie&&console.timeEnd("total time"),this}getClusters(we,Ie){let Ye=((we[0]+180)%360+360)%360-180;const ct=Math.max(-90,Math.min(90,we[1]));let Ct=we[2]===180?180:((we[2]+180)%360+360)%360-180;const Rt=Math.max(-90,Math.min(90,we[3]));if(we[2]-we[0]>=360)Ye=-180,Ct=180;else if(Ye>Ct){const Bn=this.getClusters([Ye,ct,180,Rt],Ie),Ln=this.getClusters([-180,ct,Ct,Rt],Ie);return Bn.concat(Ln)}const Bt=this.trees[this._limitZoom(Ie)],St=Bt.range(mt(Ye),ht(Rt),mt(Ct),ht(ct)),Mt=Bt.data,vn=[];for(const Bn of St){const Ln=this.stride*Bn;vn.push(Mt[Ln+ae]>1?Ze(Mt,Ln,this.clusterProps):this.points[Mt[Ln+xe]])}return vn}getChildren(we){const Ie=this._getOriginId(we),Ye=this._getOriginZoom(we),ct="No cluster with the specified id.",Ct=this.trees[Ye];if(!Ct)throw new Error(ct);const Rt=Ct.data;if(Ie*this.stride>=Rt.length)throw new Error(ct);const Bt=this.options.radius/(this.options.extent*Math.pow(2,Ye-1)),St=Ct.within(Rt[Ie*this.stride],Rt[Ie*this.stride+1],Bt),Mt=[];for(const vn of St){const Bn=vn*this.stride;Rt[Bn+4]===we&&Mt.push(Rt[Bn+ae]>1?Ze(Rt,Bn,this.clusterProps):this.points[Rt[Bn+xe]])}if(Mt.length===0)throw new Error(ct);return Mt}getLeaves(we,Ie,Ye){const ct=[];return this._appendLeaves(ct,we,Ie=Ie||10,Ye=Ye||0,0),ct}getTile(we,Ie,Ye){const ct=this.trees[this._limitZoom(we)],Ct=Math.pow(2,we),{extent:Rt,radius:Bt}=this.options,St=Bt/Rt,Mt=(Ye-St)/Ct,vn=(Ye+1+St)/Ct,Bn={features:[]};return this._addTileFeatures(ct.range((Ie-St)/Ct,Mt,(Ie+1+St)/Ct,vn),ct.data,Ie,Ye,Ct,Bn),Ie===0&&this._addTileFeatures(ct.range(1-St/Ct,Mt,1,vn),ct.data,Ct,Ye,Ct,Bn),Ie===Ct-1&&this._addTileFeatures(ct.range(0,Mt,St/Ct,vn),ct.data,-1,Ye,Ct,Bn),Bn.features.length?Bn:null}getClusterExpansionZoom(we){let Ie=this._getOriginZoom(we)-1;for(;Ie<=this.options.maxZoom;){const Ye=this.getChildren(we);if(Ie++,Ye.length!==1)break;we=Ye[0].properties.cluster_id}return Ie}_appendLeaves(we,Ie,Ye,ct,Ct){const Rt=this.getChildren(Ie);for(const Bt of Rt){const St=Bt.properties;if(St&&St.cluster?Ct+St.point_count<=ct?Ct+=St.point_count:Ct=this._appendLeaves(we,St.cluster_id,Ye,ct,Ct):Ct<ct?Ct++:we.push(Bt),we.length===Ye)break}return Ct}_createTree(we){const Ie=new o.KDBush(we.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ye=0;Ye<we.length;Ye+=this.stride)Ie.add(we[Ye],we[Ye+1]);return Ie.finish(),Ie.data=we,Ie}_addTileFeatures(we,Ie,Ye,ct,Ct,Rt){for(const Bt of we){const St=Bt*this.stride,Mt=Ie[St+ae]>1;let vn,Bn,Ln;if(Mt)vn=et(Ie,St,this.clusterProps),Bn=Ie[St],Ln=Ie[St+1];else{const Ar=this.points[Ie[St+xe]];vn=Ar.properties;const[Dr,_i]=Ar.geometry.coordinates;Bn=mt(Dr),Ln=ht(_i)}const qr={type:1,geometry:[[Math.round(this.options.extent*(Bn*Ct-Ye)),Math.round(this.options.extent*(Ln*Ct-ct))]],tags:vn};let Cr;Cr=Mt||this.options.generateId?Ie[St+xe]:this.points[Ie[St+xe]].id,Cr!==void 0&&(qr.id=Cr),Rt.features.push(qr)}}_limitZoom(we){return Math.max(this.options.minZoom,Math.min(Math.floor(+we),this.options.maxZoom+1))}_cluster(we,Ie){const{radius:Ye,extent:ct,reduce:Ct,minPoints:Rt}=this.options,Bt=Ye/(ct*Math.pow(2,Ie)),St=we.data,Mt=[],vn=this.stride;for(let Bn=0;Bn<St.length;Bn+=vn){if(St[Bn+2]<=Ie)continue;St[Bn+2]=Ie;const Ln=St[Bn],qr=St[Bn+1],Cr=we.within(St[Bn],St[Bn+1],Bt),Ar=St[Bn+ae];let Dr=Ar;for(const _i of Cr){const ko=_i*vn;St[ko+2]>Ie&&(Dr+=St[ko+ae])}if(Dr>Ar&&Dr>=Rt){let _i,ko=Ln*Ar,ro=qr*Ar,os=-1;const Ji=((Bn/vn|0)<<5)+(Ie+1)+this.points.length;for(const Yo of Cr){const oo=Yo*vn;if(St[oo+2]<=Ie)continue;St[oo+2]=Ie;const Jo=St[oo+ae];ko+=St[oo]*Jo,ro+=St[oo+1]*Jo,St[oo+4]=Ji,Ct&&(_i||(_i=this._map(St,Bn,!0),os=this.clusterProps.length,this.clusterProps.push(_i)),Ct(_i,this._map(St,oo)))}St[Bn+4]=Ji,Mt.push(ko/Dr,ro/Dr,1/0,Ji,-1,Dr),Ct&&Mt.push(os)}else{for(let _i=0;_i<vn;_i++)Mt.push(St[Bn+_i]);if(Dr>1)for(const _i of Cr){const ko=_i*vn;if(!(St[ko+2]<=Ie)){St[ko+2]=Ie;for(let ro=0;ro<vn;ro++)Mt.push(St[ko+ro])}}}}return Mt}_getOriginId(we){return we-this.points.length>>5}_getOriginZoom(we){return(we-this.points.length)%32}_map(we,Ie,Ye){if(we[Ie+ae]>1){const Rt=this.clusterProps[we[Ie+Me]];return Ye?Object.assign({},Rt):Rt}const ct=this.points[we[Ie+xe]].properties,Ct=this.options.map(ct);return Ye&&Ct===ct?Object.assign({},Ct):Ct}}function Ze(ut,we,Ie){return{type:"Feature",id:ut[we+xe],properties:et(ut,we,Ie),geometry:{type:"Point",coordinates:[(Ye=ut[we],360*(Ye-.5)),Nt(ut[we+1])]}};var Ye}function et(ut,we,Ie){const Ye=ut[we+ae],ct=Ye>=1e4?`${Math.round(Ye/1e3)}k`:Ye>=1e3?Math.round(Ye/100)/10+"k":Ye,Ct=ut[we+Me],Rt=Ct===-1?{}:Object.assign({},Ie[Ct]);return Object.assign(Rt,{cluster:!0,cluster_id:ut[we+xe],point_count:Ye,point_count_abbreviated:ct})}function mt(ut){return ut/360+.5}function ht(ut){const we=Math.sin(ut*Math.PI/180),Ie=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return Ie<0?0:Ie>1?1:Ie}function Nt(ut){const we=(180-360*ut)*Math.PI/180;return 360*Math.atan(Math.exp(we))/Math.PI-90}function Jt(ut,we,Ie,Ye){for(var ct,Ct=Ye,Rt=Ie-we>>1,Bt=Ie-we,St=ut[we],Mt=ut[we+1],vn=ut[Ie],Bn=ut[Ie+1],Ln=we+3;Ln<Ie;Ln+=3){var qr=tn(ut[Ln],ut[Ln+1],St,Mt,vn,Bn);if(qr>Ct)ct=Ln,Ct=qr;else if(qr===Ct){var Cr=Math.abs(Ln-Rt);Cr<Bt&&(ct=Ln,Bt=Cr)}}Ct>Ye&&(ct-we>3&&Jt(ut,we,ct,Ye),ut[ct+2]=Ct,Ie-ct>3&&Jt(ut,ct,Ie,Ye))}function tn(ut,we,Ie,Ye,ct,Ct){var Rt=ct-Ie,Bt=Ct-Ye;if(Rt!==0||Bt!==0){var St=((ut-Ie)*Rt+(we-Ye)*Bt)/(Rt*Rt+Bt*Bt);St>1?(Ie=ct,Ye=Ct):St>0&&(Ie+=Rt*St,Ye+=Bt*St)}return(Rt=ut-Ie)*Rt+(Bt=we-Ye)*Bt}function fn(ut,we,Ie,Ye){var ct={id:ut===void 0?null:ut,type:we,geometry:Ie,tags:Ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return(function(Ct){var Rt=Ct.geometry,Bt=Ct.type;if(Bt==="Point"||Bt==="MultiPoint"||Bt==="LineString")An(Ct,Rt);else if(Bt==="Polygon"||Bt==="MultiLineString")for(var St=0;St<Rt.length;St++)An(Ct,Rt[St]);else if(Bt==="MultiPolygon")for(St=0;St<Rt.length;St++)for(var Mt=0;Mt<Rt[St].length;Mt++)An(Ct,Rt[St][Mt])})(ct),ct}function An(ut,we){for(var Ie=0;Ie<we.length;Ie+=3)ut.minX=Math.min(ut.minX,we[Ie]),ut.minY=Math.min(ut.minY,we[Ie+1]),ut.maxX=Math.max(ut.maxX,we[Ie]),ut.maxY=Math.max(ut.maxY,we[Ie+1])}function zt(ut,we,Ie,Ye){if(we.geometry){var ct=we.geometry.coordinates,Ct=we.geometry.type,Rt=Math.pow(Ie.tolerance/((1<<Ie.maxZoom)*Ie.extent),2),Bt=[],St=we.id;if(Ie.promoteId?St=we.properties[Ie.promoteId]:Ie.generateId&&(St=Ye||0),Ct==="Point")it(ct,Bt);else if(Ct==="MultiPoint")for(var Mt=0;Mt<ct.length;Mt++)it(ct[Mt],Bt);else if(Ct==="LineString")ur(ct,Bt,Rt,!1);else if(Ct==="MultiLineString"){if(Ie.lineMetrics){for(Mt=0;Mt<ct.length;Mt++)ur(ct[Mt],Bt=[],Rt,!1),ut.push(fn(St,"LineString",Bt,we.properties));return}xr(ct,Bt,Rt,!1)}else if(Ct==="Polygon")xr(ct,Bt,Rt,!0);else{if(Ct!=="MultiPolygon"){if(Ct==="GeometryCollection"){for(Mt=0;Mt<we.geometry.geometries.length;Mt++)zt(ut,{id:St,geometry:we.geometry.geometries[Mt],properties:we.properties},Ie,Ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Mt=0;Mt<ct.length;Mt++){var vn=[];xr(ct[Mt],vn,Rt,!0),Bt.push(vn)}}ut.push(fn(St,Ct,Bt,we.properties))}}function it(ut,we){we.push(Tr(ut[0])),we.push(Tn(ut[1])),we.push(0)}function ur(ut,we,Ie,Ye){for(var ct,Ct,Rt=0,Bt=0;Bt<ut.length;Bt++){var St=Tr(ut[Bt][0]),Mt=Tn(ut[Bt][1]);we.push(St),we.push(Mt),we.push(0),Bt>0&&(Rt+=Ye?(ct*Mt-St*Ct)/2:Math.sqrt(Math.pow(St-ct,2)+Math.pow(Mt-Ct,2))),ct=St,Ct=Mt}var vn=we.length-3;we[2]=1,Jt(we,0,vn,Ie),we[vn+2]=1,we.size=Math.abs(Rt),we.start=0,we.end=we.size}function xr(ut,we,Ie,Ye){for(var ct=0;ct<ut.length;ct++){var Ct=[];ur(ut[ct],Ct,Ie,Ye),we.push(Ct)}}function Tr(ut){return ut/360+.5}function Tn(ut){var we=Math.sin(ut*Math.PI/180),Ie=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return Ie<0?0:Ie>1?1:Ie}function Yn(ut,we,Ie,Ye,ct,Ct,Rt,Bt){if(Ye/=we,Ct>=(Ie/=we)&&Rt<Ye)return ut;if(Rt<Ie||Ct>=Ye)return null;for(var St=[],Mt=0;Mt<ut.length;Mt++){var vn=ut[Mt],Bn=vn.geometry,Ln=vn.type,qr=ct===0?vn.minX:vn.minY,Cr=ct===0?vn.maxX:vn.maxY;if(qr>=Ie&&Cr<Ye)St.push(vn);else if(!(Cr<Ie||qr>=Ye)){var Ar=[];if(Ln==="Point"||Ln==="MultiPoint")$n(Bn,Ar,Ie,Ye,ct);else if(Ln==="LineString")hr(Bn,Ar,Ie,Ye,ct,!1,Bt.lineMetrics);else if(Ln==="MultiLineString")Nn(Bn,Ar,Ie,Ye,ct,!1);else if(Ln==="Polygon")Nn(Bn,Ar,Ie,Ye,ct,!0);else if(Ln==="MultiPolygon")for(var Dr=0;Dr<Bn.length;Dr++){var _i=[];Nn(Bn[Dr],_i,Ie,Ye,ct,!0),_i.length&&Ar.push(_i)}if(Ar.length){if(Bt.lineMetrics&&Ln==="LineString"){for(Dr=0;Dr<Ar.length;Dr++)St.push(fn(vn.id,Ln,Ar[Dr],vn.tags));continue}Ln!=="LineString"&&Ln!=="MultiLineString"||(Ar.length===1?(Ln="LineString",Ar=Ar[0]):Ln="MultiLineString"),Ln!=="Point"&&Ln!=="MultiPoint"||(Ln=Ar.length===3?"Point":"MultiPoint"),St.push(fn(vn.id,Ln,Ar,vn.tags))}}}return St.length?St:null}function $n(ut,we,Ie,Ye,ct){for(var Ct=0;Ct<ut.length;Ct+=3){var Rt=ut[Ct+ct];Rt>=Ie&&Rt<=Ye&&(we.push(ut[Ct]),we.push(ut[Ct+1]),we.push(ut[Ct+2]))}}function hr(ut,we,Ie,Ye,ct,Ct,Rt){for(var Bt,St,Mt=Wt(ut),vn=ct===0?Hn:Rr,Bn=ut.start,Ln=0;Ln<ut.length-3;Ln+=3){var qr=ut[Ln],Cr=ut[Ln+1],Ar=ut[Ln+2],Dr=ut[Ln+3],_i=ut[Ln+4],ko=ct===0?qr:Cr,ro=ct===0?Dr:_i,os=!1;Rt&&(Bt=Math.sqrt(Math.pow(qr-Dr,2)+Math.pow(Cr-_i,2))),ko<Ie?ro>Ie&&(St=vn(Mt,qr,Cr,Dr,_i,Ie),Rt&&(Mt.start=Bn+Bt*St)):ko>Ye?ro<Ye&&(St=vn(Mt,qr,Cr,Dr,_i,Ye),Rt&&(Mt.start=Bn+Bt*St)):tr(Mt,qr,Cr,Ar),ro<Ie&&ko>=Ie&&(St=vn(Mt,qr,Cr,Dr,_i,Ie),os=!0),ro>Ye&&ko<=Ye&&(St=vn(Mt,qr,Cr,Dr,_i,Ye),os=!0),!Ct&&os&&(Rt&&(Mt.end=Bn+Bt*St),we.push(Mt),Mt=Wt(ut)),Rt&&(Bn+=Bt)}var Ji=ut.length-3;qr=ut[Ji],Cr=ut[Ji+1],Ar=ut[Ji+2],(ko=ct===0?qr:Cr)>=Ie&&ko<=Ye&&tr(Mt,qr,Cr,Ar),Ji=Mt.length-3,Ct&&Ji>=3&&(Mt[Ji]!==Mt[0]||Mt[Ji+1]!==Mt[1])&&tr(Mt,Mt[0],Mt[1],Mt[2]),Mt.length&&we.push(Mt)}function Wt(ut){var we=[];return we.size=ut.size,we.start=ut.start,we.end=ut.end,we}function Nn(ut,we,Ie,Ye,ct,Ct){for(var Rt=0;Rt<ut.length;Rt++)hr(ut[Rt],we,Ie,Ye,ct,Ct,!1)}function tr(ut,we,Ie,Ye){ut.push(we),ut.push(Ie),ut.push(Ye)}function Hn(ut,we,Ie,Ye,ct,Ct){var Rt=(Ct-we)/(Ye-we);return ut.push(Ct),ut.push(Ie+(ct-Ie)*Rt),ut.push(1),Rt}function Rr(ut,we,Ie,Ye,ct,Ct){var Rt=(Ct-Ie)/(ct-Ie);return ut.push(we+(Ye-we)*Rt),ut.push(Ct),ut.push(1),Rt}function lr(ut,we){for(var Ie=[],Ye=0;Ye<ut.length;Ye++){var ct,Ct=ut[Ye],Rt=Ct.type;if(Rt==="Point"||Rt==="MultiPoint"||Rt==="LineString")ct=wr(Ct.geometry,we);else if(Rt==="MultiLineString"||Rt==="Polygon"){ct=[];for(var Bt=0;Bt<Ct.geometry.length;Bt++)ct.push(wr(Ct.geometry[Bt],we))}else if(Rt==="MultiPolygon")for(ct=[],Bt=0;Bt<Ct.geometry.length;Bt++){for(var St=[],Mt=0;Mt<Ct.geometry[Bt].length;Mt++)St.push(wr(Ct.geometry[Bt][Mt],we));ct.push(St)}Ie.push(fn(Ct.id,Rt,ct,Ct.tags))}return Ie}function wr(ut,we){var Ie=[];Ie.size=ut.size,ut.start!==void 0&&(Ie.start=ut.start,Ie.end=ut.end);for(var Ye=0;Ye<ut.length;Ye+=3)Ie.push(ut[Ye]+we,ut[Ye+1],ut[Ye+2]);return Ie}function br(ut,we){if(ut.transformed)return ut;var Ie,Ye,ct,Ct=1<<ut.z,Rt=ut.x,Bt=ut.y;for(Ie=0;Ie<ut.features.length;Ie++){var St=ut.features[Ie],Mt=St.geometry,vn=St.type;if(St.geometry=[],vn===1)for(Ye=0;Ye<Mt.length;Ye+=2)St.geometry.push(Ir(Mt[Ye],Mt[Ye+1],we,Ct,Rt,Bt));else for(Ye=0;Ye<Mt.length;Ye++){var Bn=[];for(ct=0;ct<Mt[Ye].length;ct+=2)Bn.push(Ir(Mt[Ye][ct],Mt[Ye][ct+1],we,Ct,Rt,Bt));St.geometry.push(Bn)}}return ut.transformed=!0,ut}function Ir(ut,we,Ie,Ye,ct,Ct){return[Math.round(Ie*(ut*Ye-ct)),Math.round(Ie*(we*Ye-Ct))]}function Bi(ut,we,Ie,Ye,ct){for(var Ct=we===ct.maxZoom?0:ct.tolerance/((1<<we)*ct.extent),Rt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ie,y:Ye,z:we,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Bt=0;Bt<ut.length;Bt++){Rt.numFeatures++,Mi(Rt,ut[Bt],Ct,ct);var St=ut[Bt].minX,Mt=ut[Bt].minY,vn=ut[Bt].maxX,Bn=ut[Bt].maxY;St<Rt.minX&&(Rt.minX=St),Mt<Rt.minY&&(Rt.minY=Mt),vn>Rt.maxX&&(Rt.maxX=vn),Bn>Rt.maxY&&(Rt.maxY=Bn)}return Rt}function Mi(ut,we,Ie,Ye){var ct=we.geometry,Ct=we.type,Rt=[];if(Ct==="Point"||Ct==="MultiPoint")for(var Bt=0;Bt<ct.length;Bt+=3)Rt.push(ct[Bt]),Rt.push(ct[Bt+1]),ut.numPoints++,ut.numSimplified++;else if(Ct==="LineString")pr(Rt,ct,ut,Ie,!1,!1);else if(Ct==="MultiLineString"||Ct==="Polygon")for(Bt=0;Bt<ct.length;Bt++)pr(Rt,ct[Bt],ut,Ie,Ct==="Polygon",Bt===0);else if(Ct==="MultiPolygon")for(var St=0;St<ct.length;St++){var Mt=ct[St];for(Bt=0;Bt<Mt.length;Bt++)pr(Rt,Mt[Bt],ut,Ie,!0,Bt===0)}if(Rt.length){var vn=we.tags||null;if(Ct==="LineString"&&Ye.lineMetrics){for(var Bn in vn={},we.tags)vn[Bn]=we.tags[Bn];vn.mapbox_clip_start=ct.start/ct.size,vn.mapbox_clip_end=ct.end/ct.size}var Ln={geometry:Rt,type:Ct==="Polygon"||Ct==="MultiPolygon"?3:Ct==="LineString"||Ct==="MultiLineString"?2:1,tags:vn};we.id!==null&&(Ln.id=we.id),ut.features.push(Ln)}}function pr(ut,we,Ie,Ye,ct,Ct){var Rt=Ye*Ye;if(Ye>0&&we.size<(ct?Rt:Ye))Ie.numPoints+=we.length/3;else{for(var Bt=[],St=0;St<we.length;St+=3)(Ye===0||we[St+2]>Rt)&&(Ie.numSimplified++,Bt.push(we[St]),Bt.push(we[St+1])),Ie.numPoints++;ct&&(function(Mt,vn){for(var Bn=0,Ln=0,qr=Mt.length,Cr=qr-2;Ln<qr;Cr=Ln,Ln+=2)Bn+=(Mt[Ln]-Mt[Cr])*(Mt[Ln+1]+Mt[Cr+1]);if(Bn>0===vn)for(Ln=0,qr=Mt.length;Ln<qr/2;Ln+=2){var Ar=Mt[Ln],Dr=Mt[Ln+1];Mt[Ln]=Mt[qr-2-Ln],Mt[Ln+1]=Mt[qr-1-Ln],Mt[qr-2-Ln]=Ar,Mt[qr-1-Ln]=Dr}})(Bt,Ct),ut.push(Bt)}}function Jr(ut,we){var Ie=(we=this.options=(function(ct,Ct){for(var Rt in Ct)ct[Rt]=Ct[Rt];return ct})(Object.create(this.options),we)).debug;if(Ie&&console.time("preprocess data"),we.maxZoom<0||we.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(we.promoteId&&we.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ye=(function(ct,Ct){var Rt=[];if(ct.type==="FeatureCollection")for(var Bt=0;Bt<ct.features.length;Bt++)zt(Rt,ct.features[Bt],Ct,Bt);else zt(Rt,ct.type==="Feature"?ct:{geometry:ct},Ct);return Rt})(ut,we);this.tiles={},this.tileCoords=[],Ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",we.indexMaxZoom,we.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ye=(function(ct,Ct){var Rt=Ct.buffer/Ct.extent,Bt=ct,St=Yn(ct,1,-1-Rt,Rt,0,-1,2,Ct),Mt=Yn(ct,1,1-Rt,2+Rt,0,-1,2,Ct);return(St||Mt)&&(Bt=Yn(ct,1,-Rt,1+Rt,0,-1,2,Ct)||[],St&&(Bt=lr(St,1).concat(Bt)),Mt&&(Bt=Bt.concat(lr(Mt,-1)))),Bt})(Ye,we),Ye.length&&this.splitTile(Ye,0,0,0),Ie&&(Ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Kr(ut,we,Ie){return 32*((1<<ut)*Ie+we)+ut}function Sr(ut,we){const Ie=ut.tileID.canonical;if(!this._geoJSONIndex)return we(null,null);const Ye=this._geoJSONIndex.getTile(Ie.z,Ie.x,Ie.y);if(!Ye)return we(null,null);const ct=new class{constructor(Rt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=Rt.length,this._features=Rt}feature(Rt){return new class{constructor(Bt){this._feature=Bt,this.extent=o.EXTENT,this.type=Bt.type,this.properties=Bt.tags,"id"in Bt&&!isNaN(Bt.id)&&(this.id=parseInt(Bt.id,10))}loadGeometry(){if(this._feature.type===1){const Bt=[];for(const St of this._feature.geometry)Bt.push([new o.Point(St[0],St[1])]);return Bt}{const Bt=[];for(const St of this._feature.geometry){const Mt=[];for(const vn of St)Mt.push(new o.Point(vn[0],vn[1]));Bt.push(Mt)}return Bt}}toGeoJSON(Bt,St,Mt){return fe.call(this,Bt,St,Mt)}}(this._features[Rt])}}(Ye.features);let Ct=Re(ct);Ct.byteOffset===0&&Ct.byteLength===Ct.buffer.byteLength||(Ct=new Uint8Array(Ct)),we(null,{vectorTile:ct,rawData:Ct.buffer})}Jr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Jr.prototype.splitTile=function(ut,we,Ie,Ye,ct,Ct,Rt){for(var Bt=[ut,we,Ie,Ye],St=this.options,Mt=St.debug;Bt.length;){Ye=Bt.pop(),Ie=Bt.pop(),we=Bt.pop(),ut=Bt.pop();var vn=1<<we,Bn=Kr(we,Ie,Ye),Ln=this.tiles[Bn];if(!Ln&&(Mt>1&&console.time("creation"),Ln=this.tiles[Bn]=Bi(ut,we,Ie,Ye,St),this.tileCoords.push({z:we,x:Ie,y:Ye}),Mt)){Mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",we,Ie,Ye,Ln.numFeatures,Ln.numPoints,Ln.numSimplified),console.timeEnd("creation"));var qr="z"+we;this.stats[qr]=(this.stats[qr]||0)+1,this.total++}if(Ln.source=ut,ct){if(we===St.maxZoom||we===ct)continue;var Cr=1<<ct-we;if(Ie!==Math.floor(Ct/Cr)||Ye!==Math.floor(Rt/Cr))continue}else if(we===St.indexMaxZoom||Ln.numPoints<=St.indexMaxPoints)continue;if(Ln.source=null,ut.length!==0){Mt>1&&console.time("clipping");var Ar,Dr,_i,ko,ro,os,Ji=.5*St.buffer/St.extent,Yo=.5-Ji,oo=.5+Ji,Jo=1+Ji;Ar=Dr=_i=ko=null,ro=Yn(ut,vn,Ie-Ji,Ie+oo,0,Ln.minX,Ln.maxX,St),os=Yn(ut,vn,Ie+Yo,Ie+Jo,0,Ln.minX,Ln.maxX,St),ut=null,ro&&(Ar=Yn(ro,vn,Ye-Ji,Ye+oo,1,Ln.minY,Ln.maxY,St),Dr=Yn(ro,vn,Ye+Yo,Ye+Jo,1,Ln.minY,Ln.maxY,St),ro=null),os&&(_i=Yn(os,vn,Ye-Ji,Ye+oo,1,Ln.minY,Ln.maxY,St),ko=Yn(os,vn,Ye+Yo,Ye+Jo,1,Ln.minY,Ln.maxY,St),os=null),Mt>1&&console.timeEnd("clipping"),Bt.push(Ar||[],we+1,2*Ie,2*Ye),Bt.push(Dr||[],we+1,2*Ie,2*Ye+1),Bt.push(_i||[],we+1,2*Ie+1,2*Ye),Bt.push(ko||[],we+1,2*Ie+1,2*Ye+1)}}},Jr.prototype.getTile=function(ut,we,Ie){var Ye=this.options,ct=Ye.extent,Ct=Ye.debug;if(ut<0||ut>24)return null;var Rt=1<<ut,Bt=Kr(ut,we=(we%Rt+Rt)%Rt,Ie);if(this.tiles[Bt])return br(this.tiles[Bt],ct);Ct>1&&console.log("drilling down to z%d-%d-%d",ut,we,Ie);for(var St,Mt=ut,vn=we,Bn=Ie;!St&&Mt>0;)Mt--,vn=Math.floor(vn/2),Bn=Math.floor(Bn/2),St=this.tiles[Kr(Mt,vn,Bn)];return St&&St.source?(Ct>1&&console.log("found parent tile z%d-%d-%d",Mt,vn,Bn),Ct>1&&console.time("drilling down"),this.splitTile(St.source,Mt,vn,Bn,ut,we,Ie),Ct>1&&console.timeEnd("drilling down"),this.tiles[Bt]?br(this.tiles[Bt],ct):null):null};class ui extends o.VectorTileWorkerSource{constructor(we,Ie,Ye,ct,Ct){super(we,Ie,Ye,ct,Sr),Ct&&(this.loadGeoJSON=Ct)}loadData(we,Ie){const Ye=we&&we.request,ct=Ye&&Ye.collectResourceTiming;this.loadGeoJSON(we,((Ct,Rt)=>{if(Ct||!Rt)return Ie(Ct);if(typeof Rt!="object")return Ie(new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`));{ce(Rt,!0);try{if(we.filter){const St=o.createExpression(we.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(St.result==="error")throw new Error(St.value.map((vn=>`${vn.key}: ${vn.message}`)).join(", "));Rt={type:"FeatureCollection",features:Rt.features.filter((vn=>St.value.evaluate({zoom:0},vn)))}}this._geoJSONIndex=we.cluster?new Fe((function({superclusterOptions:St,clusterProperties:Mt}){if(!Mt||!St)return St;const vn={},Bn={},Ln={accumulated:null,zoom:0},qr={properties:null},Cr=Object.keys(Mt);for(const Ar of Cr){const[Dr,_i]=Mt[Ar],ko=o.createExpression(_i),ro=o.createExpression(typeof Dr=="string"?[Dr,["accumulated"],["get",Ar]]:Dr);vn[Ar]=ko.value,Bn[Ar]=ro.value}return St.map=Ar=>{qr.properties=Ar;const Dr={};for(const _i of Cr)Dr[_i]=vn[_i].evaluate(Ln,qr);return Dr},St.reduce=(Ar,Dr)=>{qr.properties=Dr;for(const _i of Cr)Ln.accumulated=Ar[_i],Ar[_i]=Bn[_i].evaluate(Ln,qr)},St})(we)).load(Rt.features):(function(St,Mt){return new Jr(St,Mt)})(Rt,we.geojsonVtOptions)}catch(St){return Ie(St)}this.loaded={};const Bt={};if(ct){const St=o.getPerformanceMeasurement(Ye);St&&(Bt.resourceTiming={},Bt.resourceTiming[we.source]=JSON.parse(JSON.stringify(St)))}Ie(null,Bt)}}))}reloadTile(we,Ie){const Ye=this.loaded;return Ye&&Ye[we.uid]?super.reloadTile(we,Ie):this.loadTile(we,Ie)}loadGeoJSON(we,Ie){if(we.request)o.getJSON(we.request,Ie);else{if(typeof we.data!="string")return Ie(new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`));try{return Ie(null,JSON.parse(we.data))}catch{return Ie(new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(we,Ie){try{Ie(null,this._geoJSONIndex.getClusterExpansionZoom(we.clusterId))}catch(Ye){Ie(Ye)}}getClusterChildren(we,Ie){try{Ie(null,this._geoJSONIndex.getChildren(we.clusterId))}catch(Ye){Ie(Ye)}}getClusterLeaves(we,Ie){try{Ie(null,this._geoJSONIndex.getLeaves(we.clusterId,we.limit,we.offset))}catch(Ye){Ie(Ye)}}}class ii{constructor(we){this.self=we,this.actor=new o.Actor(we,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:ui},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Ie,Ye)=>{if(this.workerSourceTypes[Ie])throw new Error(`Worker source with name "${Ie}" already registered.`);this.workerSourceTypes[Ie]=Ye},this.self.registerRTLTextPlugin=Ie=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=Ie.applyArabicShaping,o.plugin.processBidirectionalText=Ie.processBidirectionalText,o.plugin.processStyledBidirectionalText=Ie.processStyledBidirectionalText}}clearCaches(we,Ie,Ye){delete this.layerIndexes[we],delete this.availableImages[we],delete this.workerSources[we],delete this.demWorkerSources[we],Ye()}checkIfReady(we,Ie,Ye){Ye()}setReferrer(we,Ie){this.referrer=Ie}spriteLoaded(we,Ie){this.isSpriteLoaded[we]=Ie;for(const Ye in this.workerSources[we]){const ct=this.workerSources[we][Ye];for(const Ct in ct)ct[Ct]instanceof o.VectorTileWorkerSource&&(ct[Ct].isSpriteLoaded=Ie,ct[Ct].fire(new o.Event("isSpriteLoaded")))}}setImages(we,Ie,Ye){this.availableImages[we]=Ie;for(const ct in this.workerSources[we]){const Ct=this.workerSources[we][ct];for(const Rt in Ct)Ct[Rt].availableImages=Ie}Ye()}enableTerrain(we,Ie,Ye){this.terrain=Ie,Ye()}setProjection(we,Ie){this.projections[we]=o.getProjection(Ie)}setLayers(we,Ie,Ye){this.getLayerIndex(we).replace(Ie),Ye()}updateLayers(we,Ie,Ye){this.getLayerIndex(we).update(Ie.layers,Ie.removedIds),Ye()}loadTile(we,Ie,Ye){const ct=this.enableTerrain?o.extend({enableTerrain:this.terrain},Ie):Ie;ct.projection=this.projections[we]||this.defaultProjection,this.getWorkerSource(we,Ie.type,Ie.source).loadTile(ct,Ye)}loadDEMTile(we,Ie,Ye){const ct=this.enableTerrain?o.extend({buildQuadTree:this.terrain},Ie):Ie;this.getDEMWorkerSource(we,Ie.source).loadTile(ct,Ye)}reloadTile(we,Ie,Ye){const ct=this.enableTerrain?o.extend({enableTerrain:this.terrain},Ie):Ie;ct.projection=this.projections[we]||this.defaultProjection,this.getWorkerSource(we,Ie.type,Ie.source).reloadTile(ct,Ye)}abortTile(we,Ie,Ye){this.getWorkerSource(we,Ie.type,Ie.source).abortTile(Ie,Ye)}removeTile(we,Ie,Ye){this.getWorkerSource(we,Ie.type,Ie.source).removeTile(Ie,Ye)}removeSource(we,Ie,Ye){if(!this.workerSources[we]||!this.workerSources[we][Ie.type]||!this.workerSources[we][Ie.type][Ie.source])return;const ct=this.workerSources[we][Ie.type][Ie.source];delete this.workerSources[we][Ie.type][Ie.source],ct.removeSource!==void 0?ct.removeSource(Ie,Ye):Ye()}loadWorkerSource(we,Ie,Ye){try{this.self.importScripts(Ie.url),Ye()}catch(ct){Ye(ct.toString())}}syncRTLPluginState(we,Ie,Ye){try{o.plugin.setState(Ie);const ct=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ct!=null){this.self.importScripts(ct);const Ct=o.plugin.isParsed();Ye(Ct?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ct}`),Ct)}}catch(ct){Ye(ct.toString())}}getAvailableImages(we){let Ie=this.availableImages[we];return Ie||(Ie=[]),Ie}getLayerIndex(we){let Ie=this.layerIndexes[we];return Ie||(Ie=this.layerIndexes[we]=new O),Ie}getWorkerSource(we,Ie,Ye){if(this.workerSources[we]||(this.workerSources[we]={}),this.workerSources[we][Ie]||(this.workerSources[we][Ie]={}),!this.workerSources[we][Ie][Ye]){const ct={send:(Ct,Rt,Bt,St,Mt,vn)=>{this.actor.send(Ct,Rt,Bt,we,Mt,vn)},scheduler:this.actor.scheduler};this.workerSources[we][Ie][Ye]=new this.workerSourceTypes[Ie](ct,this.getLayerIndex(we),this.getAvailableImages(we),this.isSpriteLoaded[we])}return this.workerSources[we][Ie][Ye]}getDEMWorkerSource(we,Ie){return this.demWorkerSources[we]||(this.demWorkerSources[we]={}),this.demWorkerSources[we][Ie]||(this.demWorkerSources[we][Ie]=new V),this.demWorkerSources[we][Ie]}enforceCacheSizeLimit(we,Ie){o.enforceCacheSizeLimit(Ie)}getWorkerPerformanceMetrics(we,Ie,Ye){Ye(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ii(self)),ii})),m(["./shared"],(function(o){function w(y,a){if(Array.isArray(y)){if(!Array.isArray(a)||y.length!==a.length)return!1;for(let f=0;f<y.length;f++)if(!w(y[f],a[f]))return!1;return!0}if(typeof y=="object"&&y!==null&&a!==null){if(typeof a!="object"||Object.keys(y).length!==Object.keys(a).length)return!1;for(const f in y)if(!w(y[f],a[f]))return!1;return!0}return y===a}var I=O;function O(y){return!(function(a){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,S,T=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(T);try{S=new Worker(R),v=!0}catch{v=!1}return S&&S.terminate(),URL.revokeObjectURL(R),v})()?"Uint8ClampedArray"in window?ArrayBuffer.isView?(function(){var v=document.createElement("canvas");v.width=v.height=1;var S=v.getContext("2d");if(!S)return!1;var T=S.getImageData(0,0,1,1);return T&&T.width===v.width})()?(V[f=a&&a.failIfMajorPerformanceCaveat]===void 0&&(V[f]=(function(v){var S,T=(function(R){var B=document.createElement("canvas"),G=Object.create(O.webGLContextAttributes);return G.failIfMajorPerformanceCaveat=R,B.getContext("webgl",G)||B.getContext("experimental-webgl",G)})(v);if(!T)return!1;try{S=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!S||T.isContextLost())&&(T.shaderSource(S,"void main() {}"),T.compileShader(S),T.getShaderParameter(S,T.COMPILE_STATUS)===!0)})(f)),V[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var f})(y)}var V={};function M(y,a,f){const v=o.window.document.createElement(y);return a!==void 0&&(v.className=a),f&&f.appendChild(v),v}function se(y,a,f){const v=o.window.document.createElementNS("http://www.w3.org/2000/svg",y);for(const S of Object.keys(a))v.setAttributeNS(null,S,a[S]);return f&&f.appendChild(v),v}O.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ce=o.window.document&&o.window.document.documentElement.style,fe=ce&&ce.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ne;function oe(){ce&&fe&&(ne=ce[fe],ce[fe]="none")}function ye(){ce&&fe&&(ce[fe]=ne)}function he(y){y.preventDefault(),y.stopPropagation(),o.window.removeEventListener("click",he,!0)}function Ne(){o.window.addEventListener("click",he,!0),o.window.setTimeout((()=>{o.window.removeEventListener("click",he,!0)}),0)}function Ve(y,a){const f=y.getBoundingClientRect();return D(y,f,a)}function de(y,a){const f=y.getBoundingClientRect(),v=[];for(let S=0;S<a.length;S++)v.push(D(y,f,a[S]));return v}function j(y){return o.window.InstallTrigger!==void 0&&y.button===2&&y.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:y.button}function D(y,a,f){const v=y.offsetWidth===a.width?1:y.offsetWidth/a.width;return new o.Point((f.clientX-a.left)*v,(f.clientY-a.top)*v)}function $(y,a){var f=a[0],v=a[1],S=a[2],T=a[3],R=f*T-S*v;return R?(y[0]=T*(R=1/R),y[1]=-v*R,y[2]=-S*R,y[3]=f*R,y):null}function z(y){const{userImage:a}=y;return!!(a&&a.render&&a.render())&&(y.data.replace(new Uint8Array(a.data.buffer)),!0)}class W extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:f,callback:v}of this.requestors)this._notify(f,v);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,f){this._validate(a,f)&&(this.images[a]=f)}_validate(a,f){let v=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),v=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),v=!1),this._validateContent(f.content,f)||(this.fire(new o.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),v=!1),v}_validateStretch(a,f){if(!a)return!0;let v=0;for(const S of a){if(S[0]<v||S[1]<S[0]||f<S[1])return!1;v=S[1]}return!0}_validateContent(a,f){return!(a&&(a.length!==4||a[0]<0||f.data.width<a[0]||a[1]<0||f.data.height<a[1]||a[2]<0||f.data.width<a[2]||a[3]<0||f.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,f){f.version=this.images[a].version+1,this.images[a]=f,this.updatedImages[a]=!0}removeImage(a){const f=this.images[a];delete this.images[a],delete this.patterns[a],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,f){let v=!0;if(!this.isLoaded())for(const S of a)this.images[S]||(v=!1);this.isLoaded()||v?this._notify(a,f):this.requestors.push({ids:a,callback:f})}_notify(a,f){const v={};for(const S of a){this.images[S]||this.fire(new o.Event("styleimagemissing",{id:S}));const T=this.images[S];T?v[S]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:o.warnOnce(`Image "${S}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,v)}getPixelSize(){const{width:a,height:f}=this.atlasImage;return{width:a,height:f}}getPattern(a){const f=this.patterns[a],v=this.getImage(a);if(!v)return null;if(f&&f.position.version===v.version)return f.position;if(f)f.position.version=v.version;else{const S={w:v.data.width+2,h:v.data.height+2,x:0,y:0},T=new o.ImagePosition(S,v);this.patterns[a]={bin:S,position:T}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const f=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(a,this.atlasImage,f.RGBA),this.atlasTexture&&this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const T in this.patterns)a.push(this.patterns[T].bin);const{w:f,h:v}=o.potpack(a),S=this.atlasImage;S.resize({width:f||1,height:v||1});for(const T in this.patterns){const{bin:R}=this.patterns[T],B=R.x+1,G=R.y+1,J=this.images[T].data,ee=J.width,me=J.height;o.RGBAImage.copy(J,S,{x:0,y:0},{x:B,y:G},{width:ee,height:me}),o.RGBAImage.copy(J,S,{x:0,y:me-1},{x:B,y:G-1},{width:ee,height:1}),o.RGBAImage.copy(J,S,{x:0,y:0},{x:B,y:G+me},{width:ee,height:1}),o.RGBAImage.copy(J,S,{x:ee-1,y:0},{x:B-1,y:G},{width:1,height:me}),o.RGBAImage.copy(J,S,{x:0,y:0},{x:B+ee,y:G},{width:1,height:me})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const f of a){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const v=this.images[f];z(v)&&this.updateImage(f,v)}}}const Z=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(y,a){return(function([f,v,S]){const T=o.degToRad(v+90),R=o.degToRad(S);return{x:f*Math.cos(T)*Math.sin(R),y:f*Math.sin(T)*Math.sin(R),z:f*Math.cos(R),azimuthal:v,polar:S}})(y.expression.evaluate(a))}interpolate(y,a,f){return{x:o.number(y.x,a.x,f),y:o.number(y.y,a.y,f),z:o.number(y.z,a.z,f),azimuthal:o.number(y.azimuthal,a.azimuthal,f),polar:o.number(y.polar,a.polar,f)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)});class Ee extends o.Evented{constructor(a){super(),this._transitionable=new o.Transitionable(Z),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,f={}){if(!this._validate(o.validateLight,a,f))for(const v in a){const S=a[v];o.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),S):this._transitionable.setValue(v,S)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,v){return(!v||v.validate!==!1)&&o.emitValidationErrors(this,a.call(o.validateStyle,o.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const ke=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)});let Oe=class extends o.Evented{constructor(y,a){super(),this._transitionable=new o.Transitionable(ke),this.set(y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(y){for(const a in y){const f=y[a];o.endsWith(a,"-transition")?this._transitionable.setTransition(a.slice(0,-11),f):this._transitionable.setValue(a,f)}}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}};function Re(y,a,f,v){const S=o.smoothstep(45,65,f),[T,R]=be(y,v),B=o.length(a);let G=1-Math.min(1,Math.exp((B-T)/(R-T)*-6));return G*=G*G,G=Math.min(1,1.00747*G),G*S*y.alpha}function be(y,a){const f=.5/Math.tan(.5*a);return[y.range[0]+f,y.range[1]+f]}const De=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])});class Qe extends o.Evented{constructor(a,f){super(),this._transitionable=new o.Transitionable(De),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=f}get state(){const a=this._transform,f=a.projection.name==="globe",v=o.globeToMercatorTransition(a.zoom),S=this.properties.get("range"),T=[.5,3];return{range:f?[o.number(T[0],S[0],v),o.number(T[1],S[1],v)]:S,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,f={}){if(!this._validate(o.validateFog,a,f)){for(const v of Object.keys(o.spec.fog))a&&a[v]===void 0&&(a[v]=o.spec.fog[v].default);for(const v in a){const S=a[v];o.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),S):this._transitionable.setValue(v,S)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,a))*f.a}getOpacityAtLatLng(a,f){return this._transform.projection.supportsFog?(function(v,S,T){const R=o.MercatorCoordinate.fromLngLat(S),B=T.elevation?T.elevation.getAtPointOrZero(R):0,G=[R.x,R.y,B];return o.transformMat4(G,G,T.mercatorFogMatrix),Re(v,G,T.pitch,T._fov)})(this.state,a,f):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?be(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,v){return(!v||v.validate!==!1)&&o.emitValidationErrors(this,a.call(o.validateStyle,o.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class xe{constructor(a,f){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const v=this.workerPool.acquire(this.id);for(let S=0;S<v.length;S++){const T=new xe.Actor(v[S],f,this.id);T.name=`Worker ${S}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(a,f,v){o.asyncAll(this.actors,((S,T)=>{S.send(a,f,T)}),v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((a=>{a.remove()})),this.actors=[],this.workerPool.release(this.id)}}function ae(y,a,f){return a*(o.EXTENT/(y.tileSize*Math.pow(2,f-y.tileID.overscaledZ)))}xe.Actor=o.Actor;class Me{constructor(a,f,v,S){this.screenBounds=a,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,S)}static createFromScreenPoints(a,f){let v,S;if(a instanceof o.Point||typeof a[0]=="number"){const T=o.Point.convert(a);v=[T],S=f.isPointAboveHorizon(T)}else{const T=o.Point.convert(a[0]),R=o.Point.convert(a[1]);v=[T,R],S=o.polygonizeBounds(T,R).every((B=>f.isPointAboveHorizon(B)))}return new Me(v,f.getCameraPoint(),S,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const f=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],S=o.polygonizeBounds(f,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<v.x?S.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?S[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(S[3]=this.cameraPoint)),o.bufferConvexPolygon(S,a)}bufferedCameraGeometryGlobe(a){const f=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],S=o.polygonizeBounds(f,v,a),T=this.cameraPoint.clone();switch(3*((T.y>f.y)+(T.y>v.y))+((T.x>f.x)+(T.x>v.x))){case 0:S[0]=T,S[4]=T.clone();break;case 1:S.splice(1,0,T);break;case 2:S[1]=T;break;case 3:S.splice(4,0,T);break;case 5:S.splice(2,0,T);break;case 6:S[3]=T;break;case 7:S.splice(3,0,T);break;case 8:S[2]=T}return S}containsTile(a,f,v,S=0){const T=a.queryPadding/f._pixelsPerMercatorPixel+1,R=v?this._bufferedCameraMercator(T,f):this._bufferedScreenMercator(T,f);let B=a.tileID.wrap+(R.unwrapped?S:0);const G=R.polygon.map((We=>o.getTilePoint(a.tileTransform,We,B)));if(!o.polygonIntersectsBox(G,0,0,o.EXTENT,o.EXTENT))return;B=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?S:0);const J=this.screenGeometryMercator.polygon.map((We=>o.getTileVec3(a.tileTransform,We,B))),ee=J.map((We=>new o.Point(We[0],We[1]))),me=f.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),Ae=o.getTileVec3(a.tileTransform,me,B),Te=J.map((We=>{const ve=o.sub(We,We,Ae);return o.normalize(ve,ve),new o.Ray(Ae,ve)})),He=ae(a,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:ee,tilespaceRays:Te,bufferedTilespaceGeometry:G,bufferedTilespaceBounds:(je=o.getBounds(G),je.min.x=o.clamp(je.min.x,0,o.EXTENT),je.min.y=o.clamp(je.min.y,0,o.EXTENT),je.max.x=o.clamp(je.max.x,0,o.EXTENT),je.max.y=o.clamp(je.max.y,0,o.EXTENT),je),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:He};var je}_bufferedScreenMercator(a,f){const v=et(a);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let S;return S=f.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),f):{polygon:this.bufferedScreenGeometry(a).map((T=>f.pointCoordinate3D(T))),unwrapped:!0},this._screenRaycastCache[v]=S,S}}_bufferedCameraMercator(a,f){const v=et(a);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let S;return S=f.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),f):{polygon:this.bufferedCameraGeometry(a).map((T=>f.pointCoordinate3D(T))),unwrapped:!0},this._cameraRaycastCache[v]=S,S}}_projectAndResample(a,f){const v=(function(T,R){const B=o.multiply([],R.pixelMatrix,R.globeMatrix),G=[0,-o.GLOBE_RADIUS,0,1],J=[0,o.GLOBE_RADIUS,0,1],ee=[0,0,0,1];o.transformMat4$1(G,G,B),o.transformMat4$1(J,J,B),o.transformMat4$1(ee,ee,B);const me=new o.Point(G[0]/G[3],G[1]/G[3]),Ae=new o.Point(J[0]/J[3],J[1]/J[3]),Te=o.polygonContainsPoint(T,me)&&G[3]<ee[3],He=o.polygonContainsPoint(T,Ae)&&J[3]<ee[3];if(!Te&&!He)return null;const je=(function(vt,At,kt){for(let Vt=1;Vt<vt.length;Vt++){const gn=Ze(At.pointCoordinate3D(vt[Vt-1]).x),Ut=Ze(At.pointCoordinate3D(vt[Vt]).x);if(kt<0){if(gn<Ut)return{idx:Vt,t:-gn/(Ut-1-gn)}}else if(Ut<gn)return{idx:Vt,t:(1-gn)/(Ut+1-gn)}}return null})(T,R,Te?-1:1);if(!je)return null;const{idx:We,t:ve}=je;let Ue=We>1?Fe(T.slice(0,We),R):[],rt=We<T.length?Fe(T.slice(We),R):[];Ue=Ue.map((vt=>new o.Point(Ze(vt.x),vt.y))),rt=rt.map((vt=>new o.Point(Ze(vt.x),vt.y)));const st=[...Ue];st.length===0&&st.push(rt[rt.length-1]);const bt=o.number(st[st.length-1].y,(rt.length===0?Ue[0]:rt[0]).y,ve);let wt;return wt=Te?[new o.Point(0,bt),new o.Point(0,0),new o.Point(1,0),new o.Point(1,bt)]:[new o.Point(1,bt),new o.Point(1,1),new o.Point(0,1),new o.Point(0,bt)],st.push(...wt),rt.length===0?st.push(Ue[0]):st.push(...rt),{polygon:st.map((vt=>new o.MercatorCoordinate(vt.x,vt.y))),unwrapped:!1}})(a,f);if(v)return v;const S=(function(T,R){let B=!1,G=-1/0,J=0;for(let me=0;me<T.length-1;me++)T[me].x>G&&(G=T[me].x,J=me);for(let me=0;me<T.length-1;me++){const Ae=(J+me)%(T.length-1),Te=T[Ae],He=T[Ae+1];Math.abs(Te.x-He.x)>.5&&(Te.x<He.x?(Te.x+=1,Ae===0&&(T[T.length-1].x+=1)):(He.x+=1,Ae+1===T.length-1&&(T[0].x+=1)),B=!0)}const ee=o.mercatorXfromLng(R.center.lng);return B&&ee<Math.abs(ee-1)&&T.forEach((me=>{me.x-=1})),{polygon:T,unwrapped:B}})(Fe(a,f).map((T=>new o.Point(Ze(T.x),T.y))),f);return{polygon:S.polygon.map((T=>new o.MercatorCoordinate(T.x,T.y))),unwrapped:S.unwrapped}}}function Fe(y,a){return o.resample(y,(f=>{const v=a.pointCoordinate3D(f);f.x=v.x,f.y=v.y}),1/256)}function Ze(y){return y<0?1+y%1:y%1}function et(y){return 100*y|0}function mt(y,a,f,v,S){const T=function(R,B){if(R)return S(R);if(B){y.url&&B.tiles&&y.tiles&&delete y.tiles;const G=o.pick(o.extend(B,y),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);B.vector_layers&&(G.vectorLayers=B.vector_layers,G.vectorLayerIds=G.vectorLayers.map((J=>J.id))),G.tiles=a.canonicalizeTileset(G,y.url),S(null,G)}};return y.url?o.getJSON(a.transformRequest(a.normalizeSourceURL(y.url,null,f,v),o.ResourceType.Source),T):o.exported.frame((()=>T(null,y)))}class ht{constructor(a,f,v){this.bounds=o.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=f||0,this.maxzoom=v||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const f=Math.pow(2,a.z),v=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*f),S=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*f),T=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*f),R=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*f);return a.x>=v&&a.x<T&&a.y>=S&&a.y<R}}class Nt{constructor(a,f,v){this.context=a;const S=a.gl;this.buffer=S.createBuffer(),this.dynamicDraw=!!v,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Jt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class tn{constructor(a,f,v,S){this.length=f.length,this.attributes=v,this.itemSize=f.bytesPerElement,this.dynamicDraw=S,this.context=a;const T=a.gl;this.buffer=T.createBuffer(),a.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,f){for(let v=0;v<this.attributes.length;v++){const S=f.attributes[this.attributes[v].name];S!==void 0&&a.enableVertexAttribArray(S)}}setVertexAttribPointers(a,f,v){for(let S=0;S<this.attributes.length;S++){const T=this.attributes[S],R=f.attributes[T.name];R!==void 0&&a.vertexAttribPointer(R,T.components,a[Jt[T.type]],!1,this.itemSize,T.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class fn{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class An extends fn{getDefault(){return o.Color.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class zt extends fn{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class it extends fn{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class ur extends fn{getDefault(){return[!0,!0,!0,!0]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class xr extends fn{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Tr extends fn{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Tn extends fn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const f=this.current;(a.func!==f.func||a.ref!==f.ref||a.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Yn extends fn{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class $n extends fn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=a,this.dirty=!1}}class hr extends fn{getDefault(){return[0,1]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class Wt extends fn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=a,this.dirty=!1}}class Nn extends fn{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class tr extends fn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.BLEND):f.disable(f.BLEND),this.current=a,this.dirty=!1}}class Hn extends fn{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Rr extends fn{getDefault(){return o.Color.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class lr extends fn{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class wr extends fn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=a,this.dirty=!1}}class br extends fn{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Ir extends fn{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let Bi,Mi=class extends fn{getDefault(){return null}set(y){(y!==this.current||this.dirty)&&(this.gl.useProgram(y),this.current=y,this.dirty=!1)}};class pr extends fn{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class Jr extends fn{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Kr extends fn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Sr extends fn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class ui extends fn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class ii extends fn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class ut extends fn{getDefault(){return null}set(a){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class we extends fn{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class Ie extends fn{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class Ye extends fn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class ct extends fn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Ct extends fn{constructor(a,f){super(a),this.context=a,this.parent=f}getDefault(){return null}}class Rt extends Ct{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Bt extends Ct{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class St extends Bt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Mt{constructor(a,f,v,S){this.context=a,this.width=f,this.height=v;const T=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new Rt(a,T),S&&(this.depthAttachment=new Bt(a,T))}destroy(){const a=this.context.gl,f=this.colorAttachment.get();if(f&&a.deleteTexture(f),this.depthAttachment){const v=this.depthAttachment.get();v&&a.deleteRenderbuffer(v)}a.deleteFramebuffer(this.framebuffer)}}class vn{constructor(a,f=!1){if(this.gl=a,this.isWebGL2=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),f){const v=a;this.extVertexArrayObject={createVertexArrayOES:v.createVertexArray.bind(a),deleteVertexArrayOES:v.deleteVertexArray.bind(a),bindVertexArrayOES:v.bindVertexArray.bind(a)}}this.clearColor=new An(this),this.clearDepth=new zt(this),this.clearStencil=new it(this),this.colorMask=new ur(this),this.depthMask=new xr(this),this.stencilMask=new Tr(this),this.stencilFunc=new Tn(this),this.stencilOp=new Yn(this),this.stencilTest=new $n(this),this.depthRange=new hr(this),this.depthTest=new Wt(this),this.depthFunc=new Nn(this),this.blend=new tr(this),this.blendFunc=new Hn(this),this.blendColor=new Rr(this),this.blendEquation=new lr(this),this.cullFace=new wr(this),this.cullFaceSide=new br(this),this.frontFace=new Ir(this),this.program=new Mi(this),this.activeTexture=new pr(this),this.viewport=new Jr(this),this.bindFramebuffer=new Kr(this),this.bindRenderbuffer=new Sr(this),this.bindTexture=new ui(this),this.bindVertexBuffer=new ii(this),this.bindElementBuffer=new ut(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new we(this),this.pixelStoreUnpack=new Ie(this),this.pixelStoreUnpackPremultiplyAlpha=new Ye(this),this.pixelStoreUnpackFlipY=new ct(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),f||(this.extTextureHalfFloat=a.getExtension("OES_texture_half_float")),(f||this.extTextureHalfFloat&&a.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=f||a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,f){return new Nt(this,a,f)}createVertexBuffer(a,f,v){return new tn(this,a,f,v)}createRenderbuffer(a,f,v){const S=this.gl,T=S.createRenderbuffer();return this.bindRenderbuffer.set(T),S.renderbufferStorage(S.RENDERBUFFER,a,f,v),this.bindRenderbuffer.set(null),T}createFramebuffer(a,f,v){return new Mt(this,a,f,v)}clear({color:a,depth:f,stencil:v}){const S=this.gl;let T=0;a&&(T|=S.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(T|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),v!==void 0&&(T|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),S.clear(T)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){w(a.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Bn extends o.Evented{constructor(a,f,v,S){if(super(),this.id=a,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(f,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(a){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=mt(this._options,this.map._requestManager,f,v,((S,T)=>{this._tileJSONRequest=null,this._loaded=!0,S?(f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),v&&v.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new o.ErrorEvent(S))):T&&(o.extend(this,T),T.bounds&&(this.tileBounds=new ht(T.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(T.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(S)}))}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(a,f){const v=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),S={request:this.map._requestManager.transformRequest(v,o.ResourceType.Tile),data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile};if(S.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=f:a.request=a.actor.send("reloadTile",S,T.bind(this));else if(a.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",S,T.bind(this),void 0,!0);else{const R=o.loadVectorTile.call({deduped:this._deduped},S,((B,G)=>{B||!G?T.call(this,B):(S.data={cacheControl:G.cacheControl,expires:G.expires,rawData:G.rawData.slice(0)},a.actor&&a.actor.send("loadTile",S,T.bind(this),void 0,!0))}),!0);a.request={cancel:R}}function T(R,B){return delete a.request,a.aborted?f(null):R&&R.status!==404?f(R):(B&&B.resourceTiming&&(a.resourceTiming=B.resourceTiming),this.map._refreshExpiredTiles&&B&&a.setExpiryData(B),a.loadVectorData(B,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),f(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id})}unloadTile(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ln extends o.Evented{constructor(a,f,v,S){super(),this.id=a,this.dispatcher=v,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},f),o.extend(this,o.pick(f,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=mt(this._options,this.map._requestManager,null,null,((f,v)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new o.ErrorEvent(f)):v&&(o.extend(this,v),v.bounds&&(this.tileBounds=new ht(v.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(v.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(f)}))}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,f){const v=o.exported.devicePixelRatio>=2,S=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);a.request=o.getImage(this.map._requestManager.transformRequest(S,o.ResourceType.Tile),((T,R,B,G)=>(delete a.request,a.aborted?(a.state="unloaded",f(null)):T?(a.state="errored",f(T)):R?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:B,expires:G}),a.setTexture(R,this.map.painter),a.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void f(null)):f(null))))}static loadTileData(a,f,v){a.setTexture(f,v)}static unloadTileData(a,f){a.texture&&f.saveTileTexture(a.texture)}abortTile(a,f){a.request&&(a.request.cancel(),delete a.request),f()}unloadTile(a,f){a.texture&&this.map.painter.saveTileTexture(a.texture),f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function qr(y,a,f,v,S,T,R,B){const G=[y,f,S,a,v,T,1,1,1],J=[R,B,1],ee=o.adjoint([],G),[me,Ae,Te]=o.transformMat3(J,J,o.transpose(ee,ee));return o.multiply$1(G,[me,0,0,0,Ae,0,0,0,Te],G)}class Cr extends o.Evented{constructor(a,f,v,S){super(),this.id=a,this.dispatcher=v,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=f,this._dirty=!1}load(a,f){this._loaded=f||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),((v,S)=>{if(this._imageRequest=null,this._loaded=!0,v)this.fire(new o.ErrorEvent(v));else if(S){const{HTMLImageElement:T}=o.window;this.image=S instanceof T?o.exported.getImageData(S):S,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const f=a.map(o.MercatorCoordinate.fromLngLat);return this.tileID=(function(v){let S=1/0,T=1/0,R=-1/0,B=-1/0;for(const me of v)S=Math.min(S,me.x),T=Math.min(T,me.y),R=Math.max(R,me.x),B=Math.max(B,me.y);const G=Math.max(R-S,B-T),J=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),ee=Math.pow(2,J);return new o.CanonicalTileID(J,Math.floor((S+R)/2*ee),Math.floor((T+B)/2*ee))})(f),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const G in this.tiles){const J=this.tiles[G];J.state!=="loaded"&&(J.state="loaded",J.texture=this.texture)}if(this._boundsArray)return;const f=o.tileTransform(this.tileID,this.map.transform.projection),[v,S,T,R]=this.coordinates.map((G=>{const J=f.projection.project(G[0],G[1]);return o.getTilePoint(f,J)._round()}));this.perspectiveTransform=(function(G,J,ee,me,Ae,Te,He,je,We,ve){const Ue=qr(0,0,G,0,0,J,G,J),rt=qr(ee,me,Ae,Te,He,je,We,ve);return o.multiply$1(rt,o.adjoint(Ue,Ue),rt),[rt[6]/rt[8]*G/o.EXTENT,rt[7]/rt[8]*J/o.EXTENT]})(this.width,this.height,v.x,v.y,S.x,S.y,R.x,R.y,T.x,T.y);const B=this._boundsArray=new o.StructArrayLayout4i8;B.emplaceBack(v.x,v.y,0,0),B.emplaceBack(S.x,S.y,o.EXTENT,0),B.emplaceBack(R.x,R.y,0,o.EXTENT),B.emplaceBack(T.x,T.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(B,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,f=a.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(a,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(a)}loadTile(a,f){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},f(null)):(a.state="errored",f(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ar={vector:Bn,raster:Ln,"raster-dem":class extends Ln{constructor(y,a,f,v){super(y,a,f,v),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(y,a){const f=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(S,T){S&&(y.state="errored",a(S)),T&&(y.dem=T,y.dem.onDeserialize(),y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0,y.state="loaded",a(null))}y.request=o.getImage(this.map._requestManager.transformRequest(f,o.ResourceType.Tile),(function(S,T,R,B){if(delete y.request,y.aborted)y.state="unloaded",a(null);else if(S)y.state="errored",a(S);else if(T){this.map._refreshExpiredTiles&&y.setExpiryData({cacheControl:R,expires:B});const G=o.window.ImageBitmap&&T instanceof o.window.ImageBitmap&&(Bi==null&&(Bi=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),Bi),J=1-(T.width-o.prevPowerOfTwo(T.width))/2;J<1||y.neighboringTiles||(y.neighboringTiles=this._getNeighboringTiles(y.tileID));const ee=G?T:o.exported.getImageData(T,J),me={uid:y.uid,coord:y.tileID,source:this.id,rawImageData:ee,encoding:this.encoding,padding:J};y.actor&&y.state!=="expired"||(y.actor=this.dispatcher.getActor(),y.actor.send("loadDEMTile",me,v.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(y){const a=y.canonical,f=Math.pow(2,a.z),v=(a.x-1+f)%f,S=a.x===0?y.wrap-1:y.wrap,T=(a.x+1+f)%f,R=a.x+1===f?y.wrap+1:y.wrap,B={};return B[new o.OverscaledTileID(y.overscaledZ,S,a.z,v,a.y).key]={backfilled:!1},B[new o.OverscaledTileID(y.overscaledZ,R,a.z,T,a.y).key]={backfilled:!1},a.y>0&&(B[new o.OverscaledTileID(y.overscaledZ,S,a.z,v,a.y-1).key]={backfilled:!1},B[new o.OverscaledTileID(y.overscaledZ,y.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},B[new o.OverscaledTileID(y.overscaledZ,R,a.z,T,a.y-1).key]={backfilled:!1}),a.y+1<f&&(B[new o.OverscaledTileID(y.overscaledZ,S,a.z,v,a.y+1).key]={backfilled:!1},B[new o.OverscaledTileID(y.overscaledZ,y.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},B[new o.OverscaledTileID(y.overscaledZ,R,a.z,T,a.y+1).key]={backfilled:!1}),B}unloadTile(y){y.demTexture&&this.map.painter.saveTileTexture(y.demTexture),y.fbo&&(y.fbo.destroy(),delete y.fbo),y.dem&&delete y.dem,delete y.neighboringTiles,y.state="unloaded"}},geojson:class extends o.Evented{constructor(y,a,f,v){super(),this.id=y,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(v),this._data=a.data,this._options=o.extend({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const S=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*S,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*S,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:o.EXTENT,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*S,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(y){this.map=y,this.setData(this._data)}setData(y){return this._data=y,this._updateWorkerData(),this}getClusterExpansionZoom(y,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:y,source:this.id},a),this}getClusterChildren(y,a){return this.actor.send("geojson.getClusterChildren",{clusterId:y,source:this.id},a),this}getClusterLeaves(y,a,f,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:y,limit:a,offset:f},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const y=o.extend({},this.workerOptions),a=this._data;typeof a=="string"?(y.request=this.map._requestManager.transformRequest(o.exported.resolveURL(a),o.ResourceType.Source),y.request.collectResourceTiming=this._collectResourceTiming):y.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,y,((f,v)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new o.ErrorEvent(f));else{const S={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(S.resourceTiming=v.resourceTiming[this.id]),this.fire(new o.Event("data",S)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(y,a){const f=y.actor?"reloadTile":"loadTile";y.actor=this.actor,y.request=this.actor.send(f,{type:this.type,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((v,S)=>(delete y.request,y.unloadVectorData(),y.aborted?a(null):v?a(v):(y.loadVectorData(S,this.map.painter,f==="reloadTile"),a(null)))),void 0,f==="loadTile")}abortTile(y){y.request&&(y.request.cancel(),delete y.request),y.aborted=!0}unloadTile(y){y.unloadVectorData(),this.actor.send("removeTile",{uid:y.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Cr{constructor(y,a,f,v){super(y,a,f,v),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const y=this.options;this.urls=[];for(const a of y.urls)this.urls.push(this.map._requestManager.transformRequest(a,o.ResourceType.Source).url);o.getVideo(this.urls,((a,f)=>{this._loaded=!0,a?this.fire(new o.ErrorEvent(a)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(y){if(this.video){const a=this.video.seekable;y<a.start(0)||y>a.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=y}}getVideo(){return this.video}onAdd(y){this.map||(this.map=y,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,a=y.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(y,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(y)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Cr,canvas:class extends Cr{constructor(y,a,f,v){super(y,a,f,v),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((S=>!Array.isArray(S)||S.length!==2||S.some((T=>typeof T!="number"))))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(y){this.map=y,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context;this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const y of[this.canvas.width,this.canvas.height])if(isNaN(y)||y<=0)return!0;return!1}},custom:class extends o.Evented{constructor(y,a,f,v){super(),this.id=y,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=a,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ht(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(y){this._map=y,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(y),this.load()}onRemove(y){this._implementation.onRemove&&this._implementation.onRemove(y)}hasTile(y){if(this._implementation.hasTile){const{x:a,y:f,z:v}=y.canonical;return this._implementation.hasTile({x:a,y:f,z:v})}return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y,a){const{x:f,y:v,z:S}=y.tileID.canonical,T=new o.window.AbortController;y.request=Promise.resolve(this._implementation.loadTile({x:f,y:v,z:S},{signal:T.signal})).then((function(R){return delete y.request,y.aborted?(y.state="unloaded",a(null)):R===void 0?(y.state="errored",a(null)):R===null?(this.loadTileData(y,{width:this.tileSize,height:this.tileSize,data:null}),y.state="loaded",a(null)):(function(B){return B instanceof o.window.ImageData||B instanceof o.window.HTMLCanvasElement||B instanceof o.window.ImageBitmap||B instanceof o.window.HTMLImageElement})(R)?(this.loadTileData(y,R),y.state="loaded",void a(null)):(y.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((R=>{R.code!==20&&(y.state="errored",a(R))})),y.request.cancel=()=>T.abort()}loadTileData(y,a){Ln.loadTileData(y,a,this._map.painter)}unloadTileData(y){Ln.unloadTileData(y,this._map.painter)}unloadTile(y,a){if(this.unloadTileData(y),this._implementation.unloadTile){const{x:f,y:v,z:S}=y.tileID.canonical;this._implementation.unloadTile({x:f,y:v,z:S})}a()}abortTile(y,a){y.request&&y.request.cancel&&(y.request.cancel(),delete y.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((y=>({x:y.canonical.x,y:y.canonical.y,z:y.canonical.z})))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Dr=function(y,a,f,v){const S=new Ar[a.type](y,a,f,v);if(S.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${S.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],S),S};function _i(y,a){const f=o.identity([]);return o.scale(f,f,[.5*y.width,.5*-y.height,1]),o.translate(f,f,[1,-1,0]),o.multiply(f,f,y.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(f)}function ko(y,a,f,v,S,T,R,B=!1){const G=y.tilesIn(v,R,B);G.sort(os);const J=[];for(const me of G)J.push({wrappedTileID:me.tile.tileID.wrapped().key,queryResults:me.tile.queryRenderedFeatures(a,f,y._state,me,S,T,_i(y.transform,me.tile.tileID),B)});const ee=(function(me){const Ae={},Te={};for(const He of me){const je=He.queryResults,We=He.wrappedTileID,ve=Te[We]=Te[We]||{};for(const Ue in je){const rt=je[Ue],st=ve[Ue]=ve[Ue]||{},bt=Ae[Ue]=Ae[Ue]||[];for(const wt of rt)st[wt.featureIndex]||(st[wt.featureIndex]=!0,bt.push(wt))}}return Ae})(J);for(const me in ee)ee[me].forEach((Ae=>{const Te=Ae.feature,He=Te.layer;He&&He.type!=="background"&&He.type!=="sky"&&(Te.source=He.source,He["source-layer"]&&(Te.sourceLayer=He["source-layer"]),Te.state=Te.id!==void 0?y.getFeatureState(He["source-layer"],Te.id):{})}));return ee}function ro(y,a){const f=y.getRenderableIds().map((T=>y.getTileByID(T))),v=[],S={};for(let T=0;T<f.length;T++){const R=f[T],B=R.tileID.canonical.key;S[B]||(S[B]=!0,R.querySourceFeatures(v,a))}return v}function os(y,a){const f=y.tileID,v=a.tileID;return f.overscaledZ-v.overscaledZ||f.canonical.y-v.canonical.y||f.wrap-v.wrap||f.canonical.x-v.canonical.x}function Ji(){return Sn.workerClass!=null?new Sn.workerClass:new o.window.Worker(Sn.workerUrl)}const Yo="mapboxgl_preloaded_worker_pool";class oo{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<oo.workerCount;)this.workers.push(new Ji);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach((f=>{f.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Yo]}numActive(){return Object.keys(this.active).length}}let Jo;function La(){return Jo||(Jo=new oo),Jo}function zl(y,a){const f={};for(const v in y)v!=="ref"&&(f[v]=y[v]);return o.refProperties.forEach((v=>{v in a&&(f[v]=a[v])})),f}function jl(y){y=y.slice();const a=Object.create(null);for(let f=0;f<y.length;f++)a[y[f].id]=y[f];for(let f=0;f<y.length;f++)"ref"in y[f]&&(y[f]=zl(y[f],a[y[f].ref]));return y}oo.workerCount=2;const Fi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function nc(y,a,f){f.push({command:Fi.addSource,args:[y,a[y]]})}function Hc(y,a,f){a.push({command:Fi.removeSource,args:[y]}),f[y]=!0}function Oi(y,a,f,v){Hc(y,f,v),nc(y,a,f)}function Sc(y,a,f){let v;for(v in y[f])if(y[f].hasOwnProperty(v)&&v!=="data"&&!w(y[f][v],a[f][v]))return!1;for(v in a[f])if(a[f].hasOwnProperty(v)&&v!=="data"&&!w(y[f][v],a[f][v]))return!1;return!0}function Pa(y,a,f,v,S,T){let R;for(R in a=a||{},y=y||{})y.hasOwnProperty(R)&&(w(y[R],a[R])||f.push({command:T,args:[v,R,a[R],S]}));for(R in a)a.hasOwnProperty(R)&&!y.hasOwnProperty(R)&&(w(y[R],a[R])||f.push({command:T,args:[v,R,a[R],S]}))}function Qo(y){return y.id}function Sa(y,a){return y[a.id]=a,y}class Ec{constructor(a,f){this.reset(a,f)}reset(a,f){this.points=a||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=o.clamp(a,0,1);let f=1,v=this._distances[f];const S=a*this.paddedLength+this.padding;for(;v<S&&f<this._distances.length;)v=this._distances[++f];const T=f-1,R=this._distances[T],B=v-R,G=B>0?(S-R)/B:0;return this.points[T].mult(1-G).add(this.points[f].mult(G))}}class hl{constructor(a,f,v){const S=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(a/v),this.yCellCount=Math.ceil(f/v);for(let R=0;R<this.xCellCount*this.yCellCount;R++)S.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=f,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,f,v,S,T){this._forEachCell(f,v,S,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(S),this.bboxes.push(T)}insertCircle(a,f,v,S){this._forEachCell(f-S,v-S,f+S,v+S,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(f),this.circles.push(v),this.circles.push(S)}_insertBoxCell(a,f,v,S,T,R){this.boxCells[T].push(R)}_insertCircleCell(a,f,v,S,T,R){this.circleCells[T].push(R)}_query(a,f,v,S,T,R){if(v<0||a>this.width||S<0||f>this.height)return!T&&[];const B=[];if(a<=0&&f<=0&&this.width<=v&&this.height<=S){if(T)return!0;for(let G=0;G<this.boxKeys.length;G++)B.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){const J=this.circles[3*G],ee=this.circles[3*G+1],me=this.circles[3*G+2];B.push({key:this.circleKeys[G],x1:J-me,y1:ee-me,x2:J+me,y2:ee+me})}return R?B.filter(R):B}return this._forEachCell(a,f,v,S,this._queryCell,B,{hitTest:T,seenUids:{box:{},circle:{}}},R),T?B.length>0:B}_queryCircle(a,f,v,S,T){const R=a-v,B=a+v,G=f-v,J=f+v;if(B<0||R>this.width||J<0||G>this.height)return!S&&[];const ee=[];return this._forEachCell(R,G,B,J,this._queryCellCircle,ee,{hitTest:S,circle:{x:a,y:f,radius:v},seenUids:{box:{},circle:{}}},T),S?ee.length>0:ee}query(a,f,v,S,T){return this._query(a,f,v,S,!1,T)}hitTest(a,f,v,S,T){return this._query(a,f,v,S,!0,T)}hitTestCircle(a,f,v,S){return this._queryCircle(a,f,v,!0,S)}_queryCell(a,f,v,S,T,R,B,G){const J=B.seenUids,ee=this.boxCells[T];if(ee!==null){const Ae=this.bboxes;for(const Te of ee)if(!J.box[Te]){J.box[Te]=!0;const He=4*Te;if(a<=Ae[He+2]&&f<=Ae[He+3]&&v>=Ae[He+0]&&S>=Ae[He+1]&&(!G||G(this.boxKeys[Te]))){if(B.hitTest)return R.push(!0),!0;R.push({key:this.boxKeys[Te],x1:Ae[He],y1:Ae[He+1],x2:Ae[He+2],y2:Ae[He+3]})}}}const me=this.circleCells[T];if(me!==null){const Ae=this.circles;for(const Te of me)if(!J.circle[Te]){J.circle[Te]=!0;const He=3*Te;if(this._circleAndRectCollide(Ae[He],Ae[He+1],Ae[He+2],a,f,v,S)&&(!G||G(this.circleKeys[Te]))){if(B.hitTest)return R.push(!0),!0;{const je=Ae[He],We=Ae[He+1],ve=Ae[He+2];R.push({key:this.circleKeys[Te],x1:je-ve,y1:We-ve,x2:je+ve,y2:We+ve})}}}}}_queryCellCircle(a,f,v,S,T,R,B,G){const J=B.circle,ee=B.seenUids,me=this.boxCells[T];if(me!==null){const Te=this.bboxes;for(const He of me)if(!ee.box[He]){ee.box[He]=!0;const je=4*He;if(this._circleAndRectCollide(J.x,J.y,J.radius,Te[je+0],Te[je+1],Te[je+2],Te[je+3])&&(!G||G(this.boxKeys[He])))return R.push(!0),!0}}const Ae=this.circleCells[T];if(Ae!==null){const Te=this.circles;for(const He of Ae)if(!ee.circle[He]){ee.circle[He]=!0;const je=3*He;if(this._circlesCollide(Te[je],Te[je+1],Te[je+2],J.x,J.y,J.radius)&&(!G||G(this.circleKeys[He])))return R.push(!0),!0}}}_forEachCell(a,f,v,S,T,R,B,G){const J=this._convertToXCellCoord(a),ee=this._convertToYCellCoord(f),me=this._convertToXCellCoord(v),Ae=this._convertToYCellCoord(S);for(let Te=J;Te<=me;Te++)for(let He=ee;He<=Ae;He++)if(T.call(this,a,f,v,S,this.xCellCount*He+Te,R,B,G))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,f,v,S,T,R){const B=S-a,G=T-f,J=v+R;return J*J>B*B+G*G}_circleAndRectCollide(a,f,v,S,T,R,B){const G=(R-S)/2,J=Math.abs(a-(S+G));if(J>G+v)return!1;const ee=(B-T)/2,me=Math.abs(f-(T+ee));if(me>ee+v)return!1;if(J<=G||me<=ee)return!0;const Ae=J-G,Te=me-ee;return Ae*Ae+Te*Te<=v*v}}const Ea={unknown:0,flipRequired:1,flipNotRequired:2},Ro=Math.tan(85*Math.PI/180);function pn(y,a,f,v,S,T,R){const B=o.create();if(f)if(T.name==="globe"){const G=o.calculateGlobeLabelMatrix(S,a);o.multiply(B,B,G)}else{const G=$([],R);B[0]=G[0],B[1]=G[1],B[4]=G[2],B[5]=G[3],v||o.rotateZ(B,B,S.angle)}else o.multiply(B,S.labelPlaneMatrix,y);return B}function ss(y,a,f,v,S,T,R){const B=pn(y,a,f,v,S,T,R);return T.name==="globe"&&f||(B[2]=B[6]=B[10]=B[14]=0),B}function as(y,a,f,v,S,T,R){if(f){if(T.name==="globe"){const B=pn(y,a,f,v,S,T,R);return o.invert(B,B),o.multiply(B,y,B),B}{const B=o.clone(y),G=o.identity([]);return G[0]=R[0],G[1]=R[1],G[4]=R[2],G[5]=R[3],o.multiply(B,B,G),v||o.rotateZ(B,B,-S.angle),B}}return S.glCoordMatrix}function Qi(y,a,f,v){const S=[y,a,f,1];f?o.transformMat4$1(S,S,v):vi(S,S,v);const T=S[3];return S[0]/=T,S[1]/=T,S[2]/=T,S}function Au(y,a){return Math.min(.5+y/a*.5,1.5)}function ka(y,a){const f=y[0]/y[3],v=y[1]/y[3];return f>=-a[0]&&f<=a[0]&&v>=-a[1]&&v<=a[1]}function Za(y,a,f,v,S,T,R,B,G,J){const ee=f.transform,me=v?y.textSizeData:y.iconSizeData,Ae=o.evaluateSizeForZoom(me,f.transform.zoom),Te=ee.projection.name==="globe",He=[256/f.width*2+1,256/f.height*2+1],je=v?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;je.clear();let We=null;Te&&(We=v?y.text.globeExtVertexArray:y.icon.globeExtVertexArray);const ve=y.lineVertexArray,Ue=v?y.text.placedSymbolArray:y.icon.placedSymbolArray,rt=f.transform.width/f.transform.height;let st,bt=!1;for(let wt=0;wt<Ue.length;wt++){const vt=Ue.get(wt),{numGlyphs:At,writingMode:kt}=vt;if(kt!==o.WritingMode.vertical||bt||st===o.WritingMode.horizontal||(bt=!0),st=kt,(vt.hidden||kt===o.WritingMode.vertical)&&!bt){fa(At,je);continue}bt=!1;const Vt=new o.Point(vt.tileAnchorX,vt.tileAnchorY);let{x:gn,y:Ut,z:un}=ee.projection.projectTilePoint(Vt.x,Vt.y,J.canonical);if(G){const[kr,er,ar]=G(Vt);gn+=kr,Ut+=er,un+=ar}const $t=[gn,Ut,un,1];if(o.transformMat4$1($t,$t,a),!ka($t,He)){fa(At,je);continue}const In=Au(f.transform.cameraToCenterDistance,$t[3]),jt=o.evaluateSizeForFeature(me,Ae,vt),sn=R?jt/In:jt*In,Cn=Qi(gn,Ut,un,S);if(Cn[3]<=0){fa(At,je);continue}let _n={};const Mn=R?null:G,cr=Qn(vt,sn,!1,B,a,S,T,y.glyphOffsetArray,ve,je,We,Cn,Vt,_n,rt,Mn,ee.projection,J,R);bt=cr.useVertical,Mn&&cr.needsFlipping&&(_n={}),(cr.notEnoughRoom||bt||cr.needsFlipping&&Qn(vt,sn,!0,B,a,S,T,y.glyphOffsetArray,ve,je,We,Cn,Vt,_n,rt,Mn,ee.projection,J,R).notEnoughRoom)&&fa(At,je)}v?(y.text.dynamicLayoutVertexBuffer.updateData(je),We&&y.text.globeExtVertexBuffer.updateData(We)):(y.icon.dynamicLayoutVertexBuffer.updateData(je),We&&y.icon.globeExtVertexBuffer.updateData(We))}function ls(y,a,f,v,S,T,R,B,G,J,ee,me,Ae,Te,He,je){const{lineStartIndex:We,glyphStartIndex:ve,segment:Ue}=B,rt=ve+B.numGlyphs,st=We+B.lineLength,bt=a.getoffsetX(ve),wt=a.getoffsetX(rt-1),vt=aa(y*bt,f,v,S,T,R,Ue,We,st,G,J,ee,me,Ae,!0,Te,He,je);if(!vt)return null;const At=aa(y*wt,f,v,S,T,R,Ue,We,st,G,J,ee,me,Ae,!0,Te,He,je);return At?{first:vt,last:At}:null}function Us(y,a,f,v){return y===o.WritingMode.horizontal&&Math.abs(v)>Math.abs(f)?{useVertical:!0}:y===o.WritingMode.vertical?v>0?{needsFlipping:!0}:null:a!==Ea.unknown&&(function(S,T){return S===0||Math.abs(T/S)>Ro})(f,v)?a===Ea.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null}function Qn(y,a,f,v,S,T,R,B,G,J,ee,me,Ae,Te,He,je,We,ve,Ue){const rt=a/24,st=y.lineOffsetX*rt,bt=y.lineOffsetY*rt,{lineStartIndex:wt,glyphStartIndex:vt,numGlyphs:At,segment:kt,writingMode:Vt,flipState:gn}=y,Ut=wt+y.lineLength,un=$t=>{if(ee){const[Cn,_n,Mn]=$t.up,cr=J.length;o.updateGlobeVertexNormal(ee,cr+0,Cn,_n,Mn),o.updateGlobeVertexNormal(ee,cr+1,Cn,_n,Mn),o.updateGlobeVertexNormal(ee,cr+2,Cn,_n,Mn),o.updateGlobeVertexNormal(ee,cr+3,Cn,_n,Mn)}const[In,jt,sn]=$t.point;o.addDynamicAttributes(J,In,jt,sn,$t.angle)};if(At>1){const $t=ls(rt,B,st,bt,f,me,Ae,y,G,T,Te,je,!1,We,ve,Ue);if(!$t)return{notEnoughRoom:!0};if(v&&!f){let[In,jt,sn]=$t.first.point,[Cn,_n,Mn]=$t.last.point;[In,jt]=Qi(In,jt,sn,R),[Cn,_n]=Qi(Cn,_n,Mn,R);const cr=Us(Vt,gn,(Cn-In)*He,_n-jt);if(y.flipState=cr&&cr.needsFlipping?Ea.flipRequired:Ea.flipNotRequired,cr)return cr}un($t.first);for(let In=vt+1;In<vt+At-1;In++){const jt=aa(rt*B.getoffsetX(In),st,bt,f,me,Ae,kt,wt,Ut,G,T,Te,je,!1,!1,We,ve,Ue);if(!jt)return J.length-=4*(In-vt),{notEnoughRoom:!0};un(jt)}un($t.last)}else{if(v&&!f){const In=Qi(Ae.x,Ae.y,0,S),jt=wt+kt+1,sn=new o.Point(G.getx(jt),G.gety(jt)),Cn=Qi(sn.x,sn.y,0,S),_n=Cn[3]>0?Cn:ei(Ae,sn,In,1,S,void 0,We,ve.canonical),Mn=Us(Vt,gn,(_n[0]-In[0])*He,_n[1]-In[1]);if(y.flipState=Mn&&Mn.needsFlipping?Ea.flipRequired:Ea.flipNotRequired,Mn)return Mn}const $t=aa(rt*B.getoffsetX(vt),st,bt,f,me,Ae,kt,wt,Ut,G,T,Te,je,!1,!1,We,ve,Ue);if(!$t)return{notEnoughRoom:!0};un($t)}return{}}function Fr(y,a,f,v,S){const{x:T,y:R,z:B}=v.projectTilePoint(y.x,y.y,a);if(!S)return Qi(T,R,B,f);const[G,J,ee]=S(y);return Qi(T+G,R+J,B+ee,f)}function ei(y,a,f,v,S,T,R,B){const G=Fr(y.sub(a)._unit()._add(y),B,S,R,T);return o.sub(G,f,G),o.normalize(G,G),o.scaleAndAdd(G,f,G,v)}function aa(y,a,f,v,S,T,R,B,G,J,ee,me,Ae,Te,He,je,We,ve){const Ue=v?y-a:y+a;let rt=Ue>0?1:-1,st=0;v&&(rt*=-1,st=Math.PI),rt<0&&(st+=Math.PI);let bt=B+R+(rt>0?0:1)|0,wt=S,vt=S,At=0,kt=0;const Vt=Math.abs(Ue),gn=[],Ut=[];let un=T,$t=un;const In=()=>ei($t,un,vt,Vt-At+1,ee,Ae,je,We.canonical);for(;At+kt<=Vt;){if(bt+=rt,bt<B||bt>=G)return null;if(vt=wt,$t=un,gn.push(vt),Te&&Ut.push($t),un=new o.Point(J.getx(bt),J.gety(bt)),wt=me[bt],!wt){const ar=Fr(un,We.canonical,ee,je,Ae);wt=ar[3]>0?me[bt]=ar:In()}At+=kt,kt=o.distance(vt,wt)}He&&Ae&&(me[bt]&&(wt=In(),kt=o.distance(vt,wt)),me[bt]=wt);const jt=(Vt-At)/kt,sn=un.sub($t)._mult(jt)._add($t),Cn=o.sub([],wt,vt),_n=o.scaleAndAdd([],vt,Cn,jt);let Mn=[0,0,1],cr=Cn[0],kr=Cn[1];if(ve&&(Mn=je.upVector(We.canonical,sn.x,sn.y),Mn[0]!==0||Mn[1]!==0||Mn[2]!==1)){const ar=[Mn[2],0,-Mn[0]],Wr=o.cross([],Mn,ar);o.normalize(ar,ar),o.normalize(Wr,Wr),cr=o.dot(Cn,ar),kr=o.dot(Cn,Wr)}if(f){const ar=o.cross([],Mn,Cn);o.normalize(ar,ar),o.scaleAndAdd(_n,_n,ar,f*rt)}const er=st+Math.atan2(kr,cr);return gn.push(_n),Te&&Ut.push(sn),{point:_n,angle:er,path:gn,tilePath:Ut,up:Mn}}function fa(y,a){const f=a.length,v=f+4*y;a.resize(v),a.float32.fill(-1/0,4*f,4*v)}function vi(y,a,f){const v=a[0],S=a[1];return y[0]=f[0]*v+f[4]*S+f[12],y[1]=f[1]*v+f[5]*S+f[13],y[3]=f[3]*v+f[7]*S+f[15],y}const Lr=100;class dl{constructor(a,f,v=new hl(a.width+200,a.height+200,25),S=new hl(a.width+200,a.height+200,25)){this.transform=a,this.grid=v,this.ignoredGrid=S,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Lr,this.screenBottomBoundary=a.height+Lr,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=f}placeCollisionBox(a,f,v,S,T,R,B,G){let J=v.projectedAnchorX,ee=v.projectedAnchorY,me=v.projectedAnchorZ;const Ae=v.elevation,Te=v.tileID,He=a.getProjection();if(Ae&&Te){const[wt,vt,At]=He.upVector(Te.canonical,v.tileAnchorX,v.tileAnchorY),kt=He.upVectorScale(Te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;J+=wt*Ae*kt,ee+=vt*Ae*kt,me+=At*Ae*kt}const je=this.projectAndGetPerspectiveRatio(B,J,ee,me,v.tileID,He.name==="globe"||!!Ae||this.transform.pitch>0,He),We=R*je.perspectiveRatio,ve=(v.x1*f+S.x-v.padding)*We+je.point.x,Ue=(v.y1*f+S.y-v.padding)*We+je.point.y,rt=(v.x2*f+S.x+v.padding)*We+je.point.x,st=(v.y2*f+S.y+v.padding)*We+je.point.y,bt=je.perspectiveRatio<=.55||je.occluded;return!this.isInsideGrid(ve,Ue,rt,st)||!T&&this.grid.hitTest(ve,Ue,rt,st,G)||bt?{box:[],offscreen:!1,occluded:je.occluded}:{box:[ve,Ue,rt,st],offscreen:this.isOffscreen(ve,Ue,rt,st),occluded:!1}}placeCollisionCircles(a,f,v,S,T,R,B,G,J,ee,me,Ae,Te,He,je){const We=[],ve=this.transform.elevation,Ue=a.getProjection(),rt=ve?ve.getAtTileOffsetFunc(je,this.transform.center.lat,this.transform.worldSize,Ue):null,st=new o.Point(v.tileAnchorX,v.tileAnchorY);let{x:bt,y:wt,z:vt}=Ue.projectTilePoint(st.x,st.y,je.canonical);if(rt){const[sn,Cn,_n]=rt(st);bt+=sn,wt+=Cn,vt+=_n}const At=Ue.name==="globe",kt=this.projectAndGetPerspectiveRatio(B,bt,wt,vt,je,At||!!ve||this.transform.pitch>0,Ue),{perspectiveRatio:Vt}=kt,gn=(me?R/Vt:R*Vt)/o.ONE_EM,Ut=Qi(bt,wt,vt,G),un=kt.signedDistanceFromCamera>0?ls(gn,T,v.lineOffsetX*gn,v.lineOffsetY*gn,!1,Ut,st,v,S,G,{},ve&&!me?rt:null,me&&!!ve,Ue,je,me):null;let $t=!1,In=!1,jt=!0;if(un&&!kt.occluded){const sn=.5*Te*Vt+He,Cn=new o.Point(-100,-100),_n=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),Mn=new Ec,{first:cr,last:kr}=un,er=cr.path.length;let ar=[];for(let _r=er-1;_r>=1;_r--)ar.push(cr.path[_r]);for(let _r=1;_r<kr.path.length;_r++)ar.push(kr.path[_r]);const Wr=2.5*sn;J&&(ar=ar.map((([_r,Ti,Ii],yo)=>(rt&&!At&&(Ii=rt(yo<er-1?cr.tilePath[er-1-yo]:kr.tilePath[yo-er+2])[2]),Qi(_r,Ti,Ii,J)))),ar.some((_r=>_r[3]<=0))&&(ar=[]));let hi=[];if(ar.length>0){let _r=1/0,Ti=-1/0,Ii=1/0,yo=-1/0;for(const co of ar)_r=Math.min(_r,co[0]),Ii=Math.min(Ii,co[1]),Ti=Math.max(Ti,co[0]),yo=Math.max(yo,co[1]);Ti>=Cn.x&&_r<=_n.x&&yo>=Cn.y&&Ii<=_n.y&&(hi=[ar.map((co=>new o.Point(co[0],co[1])))],(_r<Cn.x||Ti>_n.x||Ii<Cn.y||yo>_n.y)&&(hi=o.clipLine(hi,Cn.x,Cn.y,_n.x,_n.y)))}for(const _r of hi){Mn.reset(_r,.25*sn);let Ti=0;Ti=Mn.length<=.5*sn?1:Math.ceil(Mn.paddedLength/Wr)+1;for(let Ii=0;Ii<Ti;Ii++){const yo=Ii/Math.max(Ti-1,1),co=Mn.lerp(yo),Js=co.x+Lr,ps=co.y+Lr;We.push(Js,ps,sn,0);const il=Js-sn,Wa=ps-sn,Si=Js+sn,Ki=ps+sn;if(jt=jt&&this.isOffscreen(il,Wa,Si,Ki),In=In||this.isInsideGrid(il,Wa,Si,Ki),!f&&this.grid.hitTestCircle(Js,ps,sn,Ae)&&($t=!0,!ee))return{circles:[],offscreen:!1,collisionDetected:$t,occluded:!1}}}}return{circles:!ee&&$t||!In?[]:We,offscreen:jt,collisionDetected:$t,occluded:kt.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let v=1/0,S=1/0,T=-1/0,R=-1/0;for(const ee of a){const me=new o.Point(ee.x+Lr,ee.y+Lr);v=Math.min(v,me.x),S=Math.min(S,me.y),T=Math.max(T,me.x),R=Math.max(R,me.y),f.push(me)}const B=this.grid.query(v,S,T,R).concat(this.ignoredGrid.query(v,S,T,R)),G={},J={};for(const ee of B){const me=ee.key;if(G[me.bucketInstanceId]===void 0&&(G[me.bucketInstanceId]={}),G[me.bucketInstanceId][me.featureIndex])continue;const Ae=[new o.Point(ee.x1,ee.y1),new o.Point(ee.x2,ee.y1),new o.Point(ee.x2,ee.y2),new o.Point(ee.x1,ee.y2)];o.polygonIntersectsPolygon(f,Ae)&&(G[me.bucketInstanceId][me.featureIndex]=!0,J[me.bucketInstanceId]===void 0&&(J[me.bucketInstanceId]=[]),J[me.bucketInstanceId].push(me.featureIndex))}return J}insertCollisionBox(a,f,v,S,T){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:S,collisionGroupID:T},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,f,v,S,T){const R=f?this.ignoredGrid:this.grid,B={bucketInstanceId:v,featureIndex:S,collisionGroupID:T};for(let G=0;G<a.length;G+=4)R.insertCircle(B,a[G],a[G+1],a[G+2])}projectAndGetPerspectiveRatio(a,f,v,S,T,R,B){const G=[f,v,S,1];let J=!1;S||this.transform.pitch>0?(o.transformMat4$1(G,G,a),this.fogState&&T&&B.name!=="globe"&&(J=(function(Ae,Te,He,je,We,ve){const Ue=ve.calculateFogTileMatrix(We),rt=[Te,He,je];return o.transformMat4(rt,rt,Ue),Re(Ae,rt,ve.pitch,ve._fov)})(this.fogState,f,v,S,T.toUnwrapped(),this.transform)>.9)):vi(G,G,a);const ee=G[3];return{point:new o.Point((G[0]/ee+1)/2*this.transform.width+Lr,(-G[1]/ee+1)/2*this.transform.height+Lr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(B)/ee*.5,1.5),signedDistanceFromCamera:ee,occluded:R&&G[2]>ee||J}}isOffscreen(a,f,v,S){return v<Lr||a>=this.screenRightBoundary||S<Lr||f>this.screenBottomBoundary}isInsideGrid(a,f,v,S){return v>=0&&a<this.gridRightBoundary&&S>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const a=o.identity([]);return o.translate(a,a,[-100,-100,0]),a}}function zi(y,a,f){const v=a.createTileMatrix(y,y.worldSize,f.toUnwrapped());return o.multiply(new Float32Array(16),y.projMatrix,v)}function es(y,a,f){if(a.projection.name===f.projection.name)return y.projMatrix;const v=f.clone();return v.setProjection(a.projection),zi(v,a.getProjection(),y)}function _o(y,a,f){return a.name===f.projection.name?y.projMatrix:zi(f,a,y)}class Tu{constructor(a,f,v,S){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?f:-f))):S&&v?1:0,this.placed=v}isHidden(){return this.opacity===0&&!this.placed}}class Sl{constructor(a,f,v,S,T,R=!1){this.text=new Tu(a?a.text:null,f,v,T),this.icon=new Tu(a?a.icon:null,f,S,T),this.clipped=R}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ac{constructor(a,f,v,S=!1){this.text=a,this.icon=f,this.skipFade=v,this.clipped=S}}class rc{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class El{constructor(a,f,v,S,T){this.bucketInstanceId=a,this.featureIndex=f,this.sourceLayerIndex=v,this.bucketIndex=S,this.tileID=T}}class Mo{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const f=++this.maxGroupID;this.collisionGroups[a]={ID:f,predicate:v=>v.collisionGroupID===f}}return this.collisionGroups[a]}}function ys(y,a,f,v,S){const{horizontalAlign:T,verticalAlign:R}=o.getAnchorAlignment(y),B=-(T-.5)*a,G=-(R-.5)*f,J=o.evaluateVariableOffset(y,v);return new o.Point(B+J[0]*S,G+J[1]*S)}function Ps(y,a,f,v,S){const T=new o.Point(y,a);return f&&T._rotate(v?S:-S),T}class ja{constructor(a,f,v,S,T){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new dl(this.transform,T),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Mo(v),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,f,v,S){const T=v.getBucket(f),R=v.latestFeatureIndex;if(!T||!R||f.id!==T.layerIds[0])return;const B=T.layers[0].layout,G=v.collisionBoxArray,J=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),ee=v.tileSize/o.EXTENT,me=v.tileID.toUnwrapped();this.transform.setProjection(T.projection);const Ae=(Te=v.tileID,He=T.getProjection(),je=this.transform,He.name===this.projection?je.calculateProjMatrix(Te.toUnwrapped()):zi(je,He,Te));var Te,He,je;const We=B.get("text-pitch-alignment")==="map",ve=B.get("text-rotation-alignment")==="map";f.compileFilter();const Ue=f.dynamicFilter(),rt=f.dynamicFilterNeedsFeature(),st=this.transform.calculatePixelsToTileUnitsMatrix(v),bt=ss(Ae,v.tileID.canonical,We,ve,this.transform,T.getProjection(),st);let wt=null;if(We){const kt=as(Ae,v.tileID.canonical,We,ve,this.transform,T.getProjection(),st);wt=o.multiply([],this.transform.labelPlaneMatrix,kt)}let vt=null;Ue&&v.latestFeatureIndex&&(vt={unwrappedTileID:me,dynamicFilter:Ue,dynamicFilterNeedsFeature:rt,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new El(T.bucketInstanceId,R,T.sourceLayerIndex,T.index,v.tileID);const At={bucket:T,layout:B,posMatrix:Ae,textLabelPlaneMatrix:bt,labelToScreenMatrix:wt,clippingData:vt,scale:J,textPixelRatio:ee,holdingForFade:v.holdingForFade(),collisionBoxArray:G,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(S)for(const kt of T.sortKeyRanges){const{sortKey:Vt,symbolInstanceStart:gn,symbolInstanceEnd:Ut}=kt;a.push({sortKey:Vt,symbolInstanceStart:gn,symbolInstanceEnd:Ut,parameters:At})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:At})}attemptAnchorPlacement(a,f,v,S,T,R,B,G,J,ee,me,Ae,Te,He,je,We,ve,Ue){const{textOffset0:rt,textOffset1:st,crossTileID:bt}=Ae,wt=[rt,st],vt=ys(a,v,S,wt,T),At=this.collisionIndex.placeCollisionBox(He,T,f,Ps(vt.x,vt.y,R,B,this.transform.angle),me,G,J,ee.predicate);if(We){const kt=He.getSymbolInstanceIconSize(Ue,this.transform.zoom,Ae.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(He,kt,We,Ps(vt.x,vt.y,R,B,this.transform.angle),me,G,J,ee.predicate).box.length===0)return}if(At.box.length>0){let kt;return this.prevPlacement&&this.prevPlacement.variableOffsets[bt]&&this.prevPlacement.placements[bt]&&this.prevPlacement.placements[bt].text&&(kt=this.prevPlacement.variableOffsets[bt].anchor),this.variableOffsets[bt]={textOffset:wt,width:v,height:S,anchor:a,textScale:T,prevAnchor:kt},this.markUsedJustification(He,a,Ae,je),He.allowVerticalPlacement&&(this.markUsedOrientation(He,je,Ae),this.placedOrientations[bt]=je),{shift:vt,placedGlyphBoxes:At}}}placeLayerBucketPart(a,f,v,S){const{bucket:T,layout:R,posMatrix:B,textLabelPlaneMatrix:G,labelToScreenMatrix:J,clippingData:ee,textPixelRatio:me,holdingForFade:Ae,collisionBoxArray:Te,partiallyEvaluatedTextSize:He,partiallyEvaluatedIconSize:je,collisionGroup:We}=a.parameters,ve=R.get("text-optional"),Ue=R.get("icon-optional"),rt=R.get("text-allow-overlap"),st=R.get("icon-allow-overlap"),bt=R.get("text-rotation-alignment")==="map",wt=R.get("text-pitch-alignment")==="map",vt=R.get("icon-text-fit")!=="none",At=R.get("symbol-z-order")==="viewport-y";this.transform.setProjection(T.projection);let kt=rt&&(st||!T.hasIconData()||Ue),Vt=st&&(rt||!T.hasTextData()||ve);!T.collisionArrays&&Te&&T.deserializeCollisionBoxes(Te),v&&S&&T.updateCollisionDebugBuffers(this.transform.zoom,Te);const gn=(Ut,un,$t)=>{const{crossTileID:In,numVerticalGlyphVertices:jt}=Ut;if(ee){const Si={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ki=null;if(ee.dynamicFilterNeedsFeature){const to=this.retainedQueryData[T.bucketInstanceId];Ki=ee.featureIndex.loadFeature({featureIndex:Ut.featureIndex,bucketIndex:to.bucketIndex,sourceLayerIndex:to.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,ee.dynamicFilter)(Si,Ki,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new o.Point(Ut.tileAnchorX,Ut.tileAnchorY),this.transform.calculateDistanceTileData(ee.unwrappedTileID)))return this.placements[In]=new Ac(!1,!1,!1,!0),void f.add(In)}if(f.has(In))return;if(Ae)return void(this.placements[In]=new Ac(!1,!1,!1));let sn=!1,Cn=!1,_n=!0,Mn=!1,cr=!1,kr=null,er={box:null,offscreen:null,occluded:null},ar={box:null},Wr=null,hi=null,_r=null,Ti=0,Ii=0,yo=0;$t.textFeatureIndex?Ti=$t.textFeatureIndex:Ut.useRuntimeCollisionCircles&&(Ti=Ut.featureIndex),$t.verticalTextFeatureIndex&&(Ii=$t.verticalTextFeatureIndex);const co=Si=>{Si.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Ki=this.transform.elevation;(Ki||Si.elevation)&&(Si.elevation=Ki?Ki.getAtTileOffset(Si.tileID,Si.tileAnchorX,Si.tileAnchorY):0)},Js=$t.textBox;if(Js){co(Js);const Si=to=>{let Qs=o.WritingMode.horizontal;if(T.allowVerticalPlacement&&!to&&this.prevPlacement){const ua=this.prevPlacement.placedOrientations[In];ua&&(this.placedOrientations[In]=ua,Qs=ua,this.markUsedOrientation(T,Qs,Ut))}return Qs},Ki=(to,Qs)=>{if(T.allowVerticalPlacement&&jt>0&&$t.verticalTextBox){for(const ua of T.writingModes)if(ua===o.WritingMode.vertical?(er=Qs(),ar=er):er=to(),er&&er.box&&er.box.length)break}else er=to()};if(R.get("text-variable-anchor")){let to=R.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[In]){const Wo=this.prevPlacement.variableOffsets[In];to.indexOf(Wo.anchor)>0&&(to=to.filter((vs=>vs!==Wo.anchor)),to.unshift(Wo.anchor))}const Qs=(Wo,vs,Fo)=>{const xs=T.getSymbolInstanceTextSize(He,Ut,this.transform.zoom,un),Cs=(Wo.x2-Wo.x1)*xs+2*Wo.padding,Kl=(Wo.y2-Wo.y1)*xs+2*Wo.padding,ol=vt&&!st?vs:null;ol&&co(ol);let hc={box:[],offscreen:!1,occluded:!1};const ad=rt?2*to.length:to.length;for(let ea=0;ea<ad;++ea){const wh=this.attemptAnchorPlacement(to[ea%to.length],Wo,Cs,Kl,xs,bt,wt,me,B,We,ea>=to.length,Ut,un,T,Fo,ol,He,je);if(wh&&(hc=wh.placedGlyphBoxes,hc&&hc.box&&hc.box.length)){sn=!0,kr=wh.shift;break}}return hc};Ki((()=>Qs(Js,$t.iconBox,o.WritingMode.horizontal)),(()=>{const Wo=$t.verticalTextBox;return Wo&&co(Wo),T.allowVerticalPlacement&&!(er&&er.box&&er.box.length)&&jt>0&&Wo?Qs(Wo,$t.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),er&&(sn=er.box,_n=er.offscreen,Mn=er.occluded);const ua=Si(!(!er||!er.box));if(!sn&&this.prevPlacement){const Wo=this.prevPlacement.variableOffsets[In];Wo&&(this.variableOffsets[In]=Wo,this.markUsedJustification(T,Wo.anchor,Ut,ua))}}else{const to=(Qs,ua)=>{const Wo=T.getSymbolInstanceTextSize(He,Ut,this.transform.zoom,un),vs=this.collisionIndex.placeCollisionBox(T,Wo,Qs,new o.Point(0,0),rt,me,B,We.predicate);return vs&&vs.box&&vs.box.length&&(this.markUsedOrientation(T,ua,Ut),this.placedOrientations[In]=ua),vs};Ki((()=>to(Js,o.WritingMode.horizontal)),(()=>{const Qs=$t.verticalTextBox;return T.allowVerticalPlacement&&jt>0&&Qs?(co(Qs),to(Qs,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),Si(!!(er&&er.box&&er.box.length))}}if(Wr=er,sn=Wr&&Wr.box&&Wr.box.length>0,_n=Wr&&Wr.offscreen,Mn=Wr&&Wr.occluded,Ut.useRuntimeCollisionCircles){const Si=T.text.placedSymbolArray.get(Ut.centerJustifiedTextSymbolIndex>=0?Ut.centerJustifiedTextSymbolIndex:Ut.verticalPlacedTextSymbolIndex),Ki=o.evaluateSizeForFeature(T.textSizeData,He,Si),to=R.get("text-padding");hi=this.collisionIndex.placeCollisionCircles(T,rt,Si,T.lineVertexArray,T.glyphOffsetArray,Ki,B,G,J,v,wt,We.predicate,Ut.collisionCircleDiameter*Ki/o.ONE_EM,to,this.retainedQueryData[T.bucketInstanceId].tileID),sn=rt||hi.circles.length>0&&!hi.collisionDetected,_n=_n&&hi.offscreen,Mn=hi.occluded}if($t.iconFeatureIndex&&(yo=$t.iconFeatureIndex),$t.iconBox){const Si=Ki=>{co(Ki);const to=vt&&kr?Ps(kr.x,kr.y,bt,wt,this.transform.angle):new o.Point(0,0),Qs=T.getSymbolInstanceIconSize(je,this.transform.zoom,Ut.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Qs,Ki,to,st,me,B,We.predicate)};ar&&ar.box&&ar.box.length&&$t.verticalIconBox?(_r=Si($t.verticalIconBox),Cn=_r.box.length>0):(_r=Si($t.iconBox),Cn=_r.box.length>0),_n=_n&&_r.offscreen,cr=_r.occluded}const ps=ve||Ut.numHorizontalGlyphVertices===0&&jt===0,il=Ue||Ut.numIconVertices===0;if(ps||il?il?ps||(Cn=Cn&&sn):sn=Cn&&sn:Cn=sn=Cn&&sn,sn&&Wr&&Wr.box&&this.collisionIndex.insertCollisionBox(Wr.box,R.get("text-ignore-placement"),T.bucketInstanceId,ar&&ar.box&&Ii?Ii:Ti,We.ID),Cn&&_r&&this.collisionIndex.insertCollisionBox(_r.box,R.get("icon-ignore-placement"),T.bucketInstanceId,yo,We.ID),hi&&(sn&&this.collisionIndex.insertCollisionCircles(hi.circles,R.get("text-ignore-placement"),T.bucketInstanceId,Ti,We.ID),v)){const Si=T.bucketInstanceId;let Ki=this.collisionCircleArrays[Si];Ki===void 0&&(Ki=this.collisionCircleArrays[Si]=new rc);for(let to=0;to<hi.circles.length;to+=4)Ki.circles.push(hi.circles[to+0]),Ki.circles.push(hi.circles[to+1]),Ki.circles.push(hi.circles[to+2]),Ki.circles.push(hi.collisionDetected?1:0)}const Wa=T.projection.name!=="globe";kt=kt&&(Wa||!Mn),Vt=Vt&&(Wa||!cr),this.placements[In]=new Ac(sn||kt,Cn||Vt,_n||T.justReloaded),f.add(In)};if(At){const Ut=T.getSortedSymbolIndexes(this.transform.angle);for(let un=Ut.length-1;un>=0;--un){const $t=Ut[un];gn(T.symbolInstances.get($t),$t,T.collisionArrays[$t])}}else for(let Ut=a.symbolInstanceStart;Ut<a.symbolInstanceEnd;Ut++)gn(T.symbolInstances.get(Ut),Ut,T.collisionArrays[Ut]);if(v&&T.bucketInstanceId in this.collisionCircleArrays){const Ut=this.collisionCircleArrays[T.bucketInstanceId];o.invert(Ut.invProjMatrix,B),Ut.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(a,f,v,S){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:R,rightJustifiedTextSymbolIndex:B,verticalPlacedTextSymbolIndex:G,crossTileID:J}=v,ee=o.getAnchorJustification(f),me=S===o.WritingMode.vertical?G:ee==="left"?T:ee==="center"?R:ee==="right"?B:-1;T>=0&&(a.text.placedSymbolArray.get(T).crossTileID=me>=0&&T!==me?0:J),R>=0&&(a.text.placedSymbolArray.get(R).crossTileID=me>=0&&R!==me?0:J),B>=0&&(a.text.placedSymbolArray.get(B).crossTileID=me>=0&&B!==me?0:J),G>=0&&(a.text.placedSymbolArray.get(G).crossTileID=me>=0&&G!==me?0:J)}markUsedOrientation(a,f,v){const S=f===o.WritingMode.horizontal||f===o.WritingMode.horizontalOnly?f:0,T=f===o.WritingMode.vertical?f:0,{leftJustifiedTextSymbolIndex:R,centerJustifiedTextSymbolIndex:B,rightJustifiedTextSymbolIndex:G,verticalPlacedTextSymbolIndex:J}=v,ee=a.text.placedSymbolArray;R>=0&&(ee.get(R).placedOrientation=S),B>=0&&(ee.get(B).placedOrientation=S),G>=0&&(ee.get(G).placedOrientation=S),J>=0&&(ee.get(J).placedOrientation=T)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let v=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const S=f?f.symbolFadeChange(a):1,T=f?f.opacities:{},R=f?f.variableOffsets:{},B=f?f.placedOrientations:{};for(const G in this.placements){const J=this.placements[G],ee=T[G];ee?(this.opacities[G]=new Sl(ee,S,J.text,J.icon,null,J.clipped),v=v||J.text!==ee.text.placed||J.icon!==ee.icon.placed):(this.opacities[G]=new Sl(null,S,J.text,J.icon,J.skipFade,J.clipped),v=v||J.text||J.icon)}for(const G in T){const J=T[G];if(!this.opacities[G]){const ee=new Sl(J,S,!1,!1);ee.isHidden()||(this.opacities[G]=ee,v=v||J.text.placed||J.icon.placed)}}for(const G in R)this.variableOffsets[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.variableOffsets[G]=R[G]);for(const G in B)this.placedOrientations[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.placedOrientations[G]=B[G]);v?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:a)}updateLayerOpacities(a,f){const v=new Set;for(const S of f){const T=S.getBucket(a);T&&S.latestFeatureIndex&&a.id===T.layerIds[0]&&this.updateBucketOpacities(T,v,S.collisionBoxArray)}}updateBucketOpacities(a,f,v){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const S=a.layers[0].layout,T=!!a.layers[0].dynamicFilter(),R=new Sl(null,0,!1,!1,!0),B=S.get("text-allow-overlap"),G=S.get("icon-allow-overlap"),J=S.get("text-variable-anchor"),ee=S.get("text-rotation-alignment")==="map",me=S.get("text-pitch-alignment")==="map",Ae=S.get("icon-text-fit")!=="none",Te=new Sl(null,0,B&&(G||!a.hasIconData()||S.get("icon-optional")),G&&(B||!a.hasTextData()||S.get("text-optional")),!0);!a.collisionArrays&&v&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(v);const He=(We,ve,Ue)=>{for(let rt=0;rt<ve/4;rt++)We.opacityVertexArray.emplaceBack(Ue)};let je=0;for(let We=0;We<a.symbolInstances.length;We++){const ve=a.symbolInstances.get(We),{numHorizontalGlyphVertices:Ue,numVerticalGlyphVertices:rt,crossTileID:st,numIconVertices:bt}=ve,wt=f.has(st);let vt=this.opacities[st];wt?vt=R:vt||(vt=Te,this.opacities[st]=vt),f.add(st);const At=Ue>0||rt>0,kt=bt>0,Vt=this.placedOrientations[st],gn=Vt===o.WritingMode.vertical,Ut=Vt===o.WritingMode.horizontal||Vt===o.WritingMode.horizontalOnly;if(!At&&!kt||vt.isHidden()||je++,At){const un=fl(vt.text);He(a.text,Ue,gn?To:un),He(a.text,rt,Ut?To:un);const $t=vt.text.isHidden(),{leftJustifiedTextSymbolIndex:In,centerJustifiedTextSymbolIndex:jt,rightJustifiedTextSymbolIndex:sn,verticalPlacedTextSymbolIndex:Cn}=ve,_n=a.text.placedSymbolArray,Mn=$t||gn?1:0;In>=0&&(_n.get(In).hidden=Mn),jt>=0&&(_n.get(jt).hidden=Mn),sn>=0&&(_n.get(sn).hidden=Mn),Cn>=0&&(_n.get(Cn).hidden=$t||Ut?1:0);const cr=this.variableOffsets[st];cr&&this.markUsedJustification(a,cr.anchor,ve,Vt);const kr=this.placedOrientations[st];kr&&(this.markUsedJustification(a,"left",ve,kr),this.markUsedOrientation(a,kr,ve))}if(kt){const un=fl(vt.icon),{placedIconSymbolIndex:$t,verticalPlacedIconSymbolIndex:In}=ve,jt=a.icon.placedSymbolArray,sn=vt.icon.isHidden()?1:0;$t>=0&&(He(a.icon,bt,gn?To:un),jt.get($t).hidden=sn),In>=0&&(He(a.icon,ve.numVerticalIconVertices,Ut?To:un),jt.get(In).hidden=sn)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const un=a.collisionArrays[We];if(un){let $t=new o.Point(0,0),In=!0;if(un.textBox||un.verticalTextBox){if(J){const sn=this.variableOffsets[st];sn?($t=ys(sn.anchor,sn.width,sn.height,sn.textOffset,sn.textScale),ee&&$t._rotate(me?this.transform.angle:-this.transform.angle)):In=!1}T&&(In=!vt.clipped),un.textBox&&oi(a.textCollisionBox.collisionVertexArray,vt.text.placed,!In||gn,$t.x,$t.y),un.verticalTextBox&&oi(a.textCollisionBox.collisionVertexArray,vt.text.placed,!In||Ut,$t.x,$t.y)}const jt=In&&!!(!Ut&&un.verticalIconBox);un.iconBox&&oi(a.iconCollisionBox.collisionVertexArray,vt.icon.placed,jt,Ae?$t.x:0,Ae?$t.y:0),un.verticalIconBox&&oi(a.iconCollisionBox.collisionVertexArray,vt.icon.placed,!jt,Ae?$t.x:0,Ae?$t.y:0)}}}if(a.fullyClipped=je===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const We=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=We.invProjMatrix,a.placementViewportMatrix=We.viewportMatrix,a.collisionCircleArray=We.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,f){const v=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*v>a}setStale(){this.stale=!0}}function oi(y,a,f,v,S){y.emplaceBack(a?1:0,f?1:0,v||0,S||0),y.emplaceBack(a?1:0,f?1:0,v||0,S||0),y.emplaceBack(a?1:0,f?1:0,v||0,S||0),y.emplaceBack(a?1:0,f?1:0,v||0,S||0)}const ts=Math.pow(2,25),No=Math.pow(2,24),Xu=Math.pow(2,17),Ul=Math.pow(2,16),Ao=Math.pow(2,9),Vs=Math.pow(2,8),Ku=Math.pow(2,1);function fl(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const a=y.placed?1:0,f=Math.floor(127*y.opacity);return f*ts+a*No+f*Xu+a*Ul+f*Ao+a*Vs+f*Ku+a}const To=0;class vo{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,f,v,S,T){const R=this._bucketParts;for(;this._currentTileIndex<a.length;)if(f.getBucketParts(R,S,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort(((B,G)=>B.sortKey-G.sortKey)));this._currentPartIndex<R.length;){const B=R[this._currentPartIndex];if(f.placeLayerBucketPart(B,this._seenCrossTileIDs,v,B.symbolInstanceStart===0),this._currentPartIndex++,T())return!0}return!1}}class Ss{constructor(a,f,v,S,T,R,B,G){this.placement=new ja(a,T,R,B,G),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(a,f,v){const S=o.exported.now(),T=()=>{const R=o.exported.now()-S;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){const R=f[a[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=B)&&(!R.maxzoom||R.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new vo(R)),this._inProgressLayer.continuePlacement(v[R.source],this.placement,this._showCollisionBoxes,R,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Oo=512/o.EXTENT/2;class Vo{constructor(a,f,v){this.tileID=a,this.bucketInstanceId=v,this.index=new o.KDBush(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const S=a.canonical.x*o.EXTENT,T=a.canonical.y*o.EXTENT;for(let R=0;R<f.length;R++){const{key:B,crossTileID:G,tileAnchorX:J,tileAnchorY:ee}=f.get(R),me=Math.floor((S+J)*Oo),Ae=Math.floor((T+ee)*Oo);this.index.add(me,Ae),this.keys.push(B),this.crossTileIDs.push(G)}this.index.finish()}findMatches(a,f,v){const S=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),T=Oo/Math.pow(2,f.canonical.z-this.tileID.canonical.z),R=f.canonical.x*o.EXTENT,B=f.canonical.y*o.EXTENT;for(let G=0;G<a.length;G++){const J=a.get(G);if(J.crossTileID)continue;const{key:ee,tileAnchorX:me,tileAnchorY:Ae}=J,Te=Math.floor((R+me)*T),He=Math.floor((B+Ae)*T),je=this.index.range(Te-S,He-S,Te+S,He+S);for(const We of je){const ve=this.crossTileIDs[We];if(this.keys[We]===ee&&!v.has(ve)){v.add(ve),J.crossTileID=ve;break}}}}}class Tc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Bo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const f=Math.round((a-this.lng)/360);if(f!==0)for(const v in this.indexes){const S=this.indexes[v],T={};for(const R in S){const B=S[R];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+f),T[B.tileID.key]=B}this.indexes[v]=T}this.lng=a}addBucket(a,f,v){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let T=0;T<f.symbolInstances.length;T++)f.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const S=this.usedCrossTileIDs[a.overscaledZ];for(const T in this.indexes){const R=this.indexes[T];if(Number(T)>a.overscaledZ)for(const B in R){const G=R[B];G.tileID.isChildOf(a)&&G.findMatches(f.symbolInstances,a,S)}else{const B=R[a.scaledTo(Number(T)).key];B&&B.findMatches(f.symbolInstances,a,S)}}for(let T=0;T<f.symbolInstances.length;T++){const R=f.symbolInstances.get(T);R.crossTileID||(R.crossTileID=v.generate(),S.add(R.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Vo(a,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(a,f){for(const v of f.crossTileIDs)this.usedCrossTileIDs[a].delete(v)}removeStaleBuckets(a){let f=!1;for(const v in this.indexes){const S=this.indexes[v];for(const T in S)a[S[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,S[T]),delete S[T],f=!0)}return f}}class Al{constructor(){this.layerIndexes={},this.crossTileIDs=new Tc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,f,v,S){let T=this.layerIndexes[a.id];T===void 0&&(T=this.layerIndexes[a.id]=new Bo);let R=!1;const B={};S.name!=="globe"&&T.handleWrapJump(v);for(const G of f){const J=G.getBucket(a);J&&a.id===J.layerIds[0]&&(J.bucketInstanceId||(J.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(G.tileID,J,this.crossTileIDs)&&(R=!0),B[J.bucketInstanceId]=!0)}return T.removeStaleBuckets(B)&&(R=!0),R}pruneUnusedLayers(a){const f={};a.forEach((v=>{f[v]=!0}));for(const v in this.layerIndexes)f[v]||delete this.layerIndexes[v]}}const Ma=(y,a)=>o.emitValidationErrors(y,a&&a.filter((f=>f.identifier!=="source.canvas"))),pl=o.pick(Fi,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ic=o.pick(Fi,["setCenter","setZoom","setBearing","setPitch"]),qs={version:8,layers:[],sources:{}},$s={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class si extends o.Evented{constructor(a,f={}){super(),this.map=a,this.dispatcher=new xe(La(),this),this.imageManager=new W,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(a._requestManager,f.localFontFamily?o.LocalGlyphMode.all:f.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,f.localFontFamily||f.localIdeographFontFamily),this.crossTileSymbolIndex=new Al,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const v=this;this._rtlTextPluginCallback=si.registerForPluginStateChange((S=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:S.pluginStatus,pluginURL:S.pluginURL},((T,R)=>{if(o.triggerPluginCompletionEvent(T),R&&R.every((B=>B)))for(const B in v._sourceCaches){const G=v._sourceCaches[B],J=G.getSource().type;J!=="vector"&&J!=="geojson"||G.reload()}}))})),this.on("data",(S=>{if(S.dataType!=="source"||S.sourceDataType!=="metadata")return;const T=this.getSource(S.sourceId);if(T&&T.vectorLayerIds)for(const R in this._layers){const B=this._layers[R];B.source===T.id&&this._validateLayer(B)}}))}loadURL(a,f={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const v=typeof f.validate=="boolean"?f.validate:!o.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,f.accessToken);const S=this.map._requestManager.transformRequest(a,o.ResourceType.Style);this._request=o.getJSON(S,((T,R)=>{this._request=null,T?this.fire(new o.ErrorEvent(T)):R&&this._load(R,v)}))}loadJSON(a,f={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame((()=>{this._request=null,this._load(a,f.validate!==!1)}))}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(qs,!1)}_updateLayerCount(a,f){const v=f?1:-1;a.is3D()&&(this._num3DLayers+=v),a.type==="circle"&&(this._numCircleLayers+=v),a.type==="symbol"&&(this._numSymbolLayers+=v)}_load(a,f){if(f&&Ma(this,o.validateStyle(a)))return;this._loaded=!0,this.stylesheet=o.clone$1(a),this._updateMapProjection();for(const S in a.sources)this.addSource(S,a.sources[S],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const v=jl(this.stylesheet.layers);this._order=v.map((S=>S.id)),this._layers={},this._serializedLayers={};for(const S of v){const T=o.createStyleLayer(S);T.setEventedParent(this,{layer:{id:T.id}}),this._layers[T.id]=T,this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ee(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(a){this._spriteRequest=(function(f,v,S){let T,R,B;const G=o.exported.devicePixelRatio>1?"@2x":"";let J=o.getJSON(v.transformRequest(v.normalizeSpriteURL(f,G,".json"),o.ResourceType.SpriteJSON),((Ae,Te)=>{J=null,B||(B=Ae,T=Te,me())})),ee=o.getImage(v.transformRequest(v.normalizeSpriteURL(f,G,".png"),o.ResourceType.SpriteImage),((Ae,Te)=>{ee=null,B||(B=Ae,R=Te,me())}));function me(){if(B)S(B);else if(T&&R){const Ae=o.exported.getImageData(R),Te={};for(const He in T){const{width:je,height:We,x:ve,y:Ue,sdf:rt,pixelRatio:st,stretchX:bt,stretchY:wt,content:vt}=T[He],At=new o.RGBAImage({width:je,height:We});o.RGBAImage.copy(Ae,At,{x:ve,y:Ue},{x:0,y:0},{width:je,height:We}),Te[He]={data:At,pixelRatio:st,sdf:rt,stretchX:bt,stretchY:wt,content:vt}}S(null,Te)}}return{cancel(){J&&(J.cancel(),J=null),ee&&(ee.cancel(),ee=null)}}})(a,this.map._requestManager,((f,v)=>{if(this._spriteRequest=null,f)this.fire(new o.ErrorEvent(f));else if(v)for(const S in v)this.imageManager.addImage(S,v[S]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))}))}_validateLayer(a){const f=this.getSource(a.source);if(!f)return;const v=a.sourceLayer;v&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(v)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${v}" does not exist on source "${f.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const f=[];for(const v of a){const S=this._layers[v];S.type!=="custom"&&f.push(S.serialize())}return f}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&(typeof a.isLayerDraped=="function"?a.isLayerDraped():$s[a.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const f=this._changed;if(this._changed){const S=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(S.length||T.length)&&this._updateWorkerLayers(S,T);for(const R in this._updatedSources){const B=this._updatedSources[R];B==="reload"?this._reloadSource(R):B==="clear"&&this._clearSource(R)}this._updateTilesForChangedImages();for(const R in this._updatedPaintProps)this._layers[R].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const v={};for(const S in this._sourceCaches){const T=this._sourceCaches[S];v[S]=T.used,T.used=!1}for(const S of this._order){const T=this._layers[S];if(T.recalculate(a,this._availableImages),!T.isHidden(a.zoom)){const B=this._getLayerSourceCache(T);B&&(B.used=!0)}const R=this.map.painter;if(R){const B=T.getProgramIds();if(!B)continue;const G=T.getProgramConfiguration(a.zoom);for(const J of B)R.useProgram(J,G)}}for(const S in v){const T=this._sourceCaches[S];v[S]!==T.used&&T.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),Ma(this,o.validateStyle(a)))return!1;(a=o.clone$1(a)).layers=jl(a.layers);const f=(function(S,T){if(!S)return[{command:Fi.setStyle,args:[T]}];let R=[];try{if(!w(S.version,T.version))return[{command:Fi.setStyle,args:[T]}];w(S.center,T.center)||R.push({command:Fi.setCenter,args:[T.center]}),w(S.zoom,T.zoom)||R.push({command:Fi.setZoom,args:[T.zoom]}),w(S.bearing,T.bearing)||R.push({command:Fi.setBearing,args:[T.bearing]}),w(S.pitch,T.pitch)||R.push({command:Fi.setPitch,args:[T.pitch]}),w(S.sprite,T.sprite)||R.push({command:Fi.setSprite,args:[T.sprite]}),w(S.glyphs,T.glyphs)||R.push({command:Fi.setGlyphs,args:[T.glyphs]}),w(S.transition,T.transition)||R.push({command:Fi.setTransition,args:[T.transition]}),w(S.light,T.light)||R.push({command:Fi.setLight,args:[T.light]}),w(S.fog,T.fog)||R.push({command:Fi.setFog,args:[T.fog]}),w(S.projection,T.projection)||R.push({command:Fi.setProjection,args:[T.projection]});const B={},G=[];(function(me,Ae,Te,He){let je;for(je in Ae=Ae||{},me=me||{})me.hasOwnProperty(je)&&(Ae.hasOwnProperty(je)||Hc(je,Te,He));for(je in Ae){if(!Ae.hasOwnProperty(je))continue;const We=Ae[je];me.hasOwnProperty(je)?w(me[je],We)||(me[je].type==="geojson"&&We.type==="geojson"&&Sc(me,Ae,je)?Te.push({command:Fi.setGeoJSONSourceData,args:[je,We.data]}):Oi(je,Ae,Te,He)):nc(je,Ae,Te)}})(S.sources,T.sources,G,B);const J=[];S.layers&&S.layers.forEach((me=>{me.source&&B[me.source]?R.push({command:Fi.removeLayer,args:[me.id]}):J.push(me)}));let ee=S.terrain;ee&&B[ee.source]&&(R.push({command:Fi.setTerrain,args:[void 0]}),ee=void 0),R=R.concat(G),w(ee,T.terrain)||R.push({command:Fi.setTerrain,args:[T.terrain]}),(function(me,Ae,Te){Ae=Ae||[];const He=(me=me||[]).map(Qo),je=Ae.map(Qo),We=me.reduce(Sa,{}),ve=Ae.reduce(Sa,{}),Ue=He.slice(),rt=Object.create(null);let st,bt,wt,vt,At,kt,Vt;for(st=0,bt=0;st<He.length;st++)wt=He[st],ve.hasOwnProperty(wt)?bt++:(Te.push({command:Fi.removeLayer,args:[wt]}),Ue.splice(Ue.indexOf(wt,bt),1));for(st=0,bt=0;st<je.length;st++)wt=je[je.length-1-st],Ue[Ue.length-1-st]!==wt&&(We.hasOwnProperty(wt)?(Te.push({command:Fi.removeLayer,args:[wt]}),Ue.splice(Ue.lastIndexOf(wt,Ue.length-bt),1)):bt++,kt=Ue[Ue.length-st],Te.push({command:Fi.addLayer,args:[ve[wt],kt]}),Ue.splice(Ue.length-st,0,wt),rt[wt]=!0);for(st=0;st<je.length;st++)if(wt=je[st],vt=We[wt],At=ve[wt],!rt[wt]&&!w(vt,At))if(w(vt.source,At.source)&&w(vt["source-layer"],At["source-layer"])&&w(vt.type,At.type)){for(Vt in Pa(vt.layout,At.layout,Te,wt,null,Fi.setLayoutProperty),Pa(vt.paint,At.paint,Te,wt,null,Fi.setPaintProperty),w(vt.filter,At.filter)||Te.push({command:Fi.setFilter,args:[wt,At.filter]}),w(vt.minzoom,At.minzoom)&&w(vt.maxzoom,At.maxzoom)||Te.push({command:Fi.setLayerZoomRange,args:[wt,At.minzoom,At.maxzoom]}),vt)vt.hasOwnProperty(Vt)&&Vt!=="layout"&&Vt!=="paint"&&Vt!=="filter"&&Vt!=="metadata"&&Vt!=="minzoom"&&Vt!=="maxzoom"&&(Vt.indexOf("paint.")===0?Pa(vt[Vt],At[Vt],Te,wt,Vt.slice(6),Fi.setPaintProperty):w(vt[Vt],At[Vt])||Te.push({command:Fi.setLayerProperty,args:[wt,Vt,At[Vt]]}));for(Vt in At)At.hasOwnProperty(Vt)&&!vt.hasOwnProperty(Vt)&&Vt!=="layout"&&Vt!=="paint"&&Vt!=="filter"&&Vt!=="metadata"&&Vt!=="minzoom"&&Vt!=="maxzoom"&&(Vt.indexOf("paint.")===0?Pa(vt[Vt],At[Vt],Te,wt,Vt.slice(6),Fi.setPaintProperty):w(vt[Vt],At[Vt])||Te.push({command:Fi.setLayerProperty,args:[wt,Vt,At[Vt]]}))}else Te.push({command:Fi.removeLayer,args:[wt]}),kt=Ue[Ue.lastIndexOf(wt)+1],Te.push({command:Fi.addLayer,args:[At,kt]})})(J,T.layers,R)}catch(B){console.warn("Unable to compute style diff:",B),R=[{command:Fi.setStyle,args:[T]}]}return R})(this.serialize(),a).filter((S=>!(S.command in ic)));if(f.length===0)return!1;const v=f.filter((S=>!(S.command in pl)));if(v.length>0)throw new Error(`Unimplemented: ${v.map((S=>S.command)).join(", ")}.`);return f.forEach((S=>{S.command!=="setTransition"&&S.command!=="setProjection"&&this[S.command].apply(this,S.args)})),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,f){return this.getImage(a)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,f),this._afterImageUpdated(a),this)}updateImage(a,f){this.imageManager.updateImage(a,f)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,f,v={}){if(this._checkLoaded(),this.getSource(a)!==void 0)throw new Error("There is already a source with this ID");if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(o.validateSource,`sources.${a}`,f,null,v))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const S=Dr(a,f,this.dispatcher,this);S.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:S.serialize(),sourceId:a})));const T=R=>{const B=(R?"symbol:":"other:")+a,G=this._sourceCaches[B]=new o.SourceCache(B,S,R);(R?this._symbolSourceCaches:this._otherSourceCaches)[a]=G,G.style=this,G.onAdd(this.map)};T(!1),f.type!=="vector"&&f.type!=="geojson"||T(!0),S.onAdd&&S.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const f=this.getSource(a);if(!f)throw new Error("There is no source with this ID");for(const S in this._layers)if(this._layers[S].source===a)return this.fire(new o.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${S}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new o.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const v=this._getSourceCaches(a);for(const S of v)delete this._sourceCaches[S.id],delete this._updatedSources[S.id],S.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:S.getSource().id})),S.setEventedParent(null),S.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,f){this._checkLoaded(),this.getSource(a).setData(f),this._changed=!0}getSource(a){const f=this._getSourceCache(a);return f&&f.getSource()}_getSources(){const a=[];for(const f in this._otherSourceCaches){const v=this._getSourceCache(f);v&&a.push(v.getSource())}return a}addLayer(a,f,v={}){this._checkLoaded();const S=a.id;if(this.getLayer(S))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${S}" already exists on this map`)));let T;if(a.type==="custom"){if(Ma(this,o.validateCustomStyleLayer(a)))return;T=o.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(S,a.source),a=o.clone$1(a),a=o.extend(a,{source:S})),this._validate(o.validateLayer,`layers.${S}`,a,{arrayIndex:-1},v))return;T=o.createStyleLayer(a),this._validateLayer(T),T.setEventedParent(this,{layer:{id:S}}),this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}const R=f?this._order.indexOf(f):this._order.length;if(f&&R===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`)));this._order.splice(R,0,S),this._layerOrderChanged=!0,this._layers[S]=T;const B=this._getLayerSourceCache(T);if(this._removedLayers[S]&&T.source&&B&&T.type!=="custom"){const G=this._removedLayers[S];delete this._removedLayers[S],G.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",B.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,f){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===f)return;const v=this._order.indexOf(a);this._order.splice(v,1);const S=f?this._order.indexOf(f):this._order.length;f&&S===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`))):(this._order.splice(S,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const f=this._layers[a];if(!f)return void this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));f.setEventedParent(null),this._updateLayerCount(f,!1);const v=this._order.indexOf(a);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=f,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],f.onRemove&&f.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const f in this._layers)if(this._layers[f].type===a)return!0;return!1}setLayerZoomRange(a,f,v){this._checkLoaded();const S=this.getLayer(a);S?S.minzoom===f&&S.maxzoom===v||(f!=null&&(S.minzoom=f),v!=null&&(S.maxzoom=v),this._updateLayer(S)):this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,f,v={}){this._checkLoaded();const S=this.getLayer(a);if(S){if(!w(S.filter,f))return f==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(o.validateFilter,`layers.${S.id}.filter`,f,{layerType:S.type},v)||(S.filter=o.clone$1(f),this._updateLayer(S)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const f=this.getLayer(a);return f&&o.clone$1(f.filter)}setLayoutProperty(a,f,v,S={}){this._checkLoaded();const T=this.getLayer(a);T?w(T.getLayoutProperty(f),v)||(T.setLayoutProperty(f,v,S),this._updateLayer(T)):this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,f){const v=this.getLayer(a);if(v)return v.getLayoutProperty(f);this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,f,v,S={}){this._checkLoaded();const T=this.getLayer(a);T?w(T.getPaintProperty(f),v)||(T.setPaintProperty(f,v,S)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,f){const v=this.getLayer(a);return v&&v.getPaintProperty(f)}setFeatureState(a,f){this._checkLoaded();const v=a.source,S=a.sourceLayer,T=this.getSource(v);if(!T)return void this.fire(new o.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const R=T.type;if(R==="geojson"&&S)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(R==="vector"&&!S)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const B=this._getSourceCaches(v);for(const G of B)G.setFeatureState(S,a.id,f)}removeFeatureState(a,f){this._checkLoaded();const v=a.source,S=this.getSource(v);if(!S)return void this.fire(new o.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const T=S.type,R=T==="vector"?a.sourceLayer:void 0;if(T==="vector"&&!R)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const B=this._getSourceCaches(v);for(const G of B)G.removeFeatureState(R,a.id,f)}getFeatureState(a){this._checkLoaded();const f=a.source,v=a.sourceLayer,S=this.getSource(f);if(S){if(S.type!=="vector"||v)return a.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(f)[0].getFeatureState(v,a.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const f in this._sourceCaches){const v=this._sourceCaches[f].getSource();a[v.id]||(a[v.id]=v.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},(f=>f!==void 0))}_updateLayer(a){this._updatedLayers[a.id]=!0;const f=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&f&&f.getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",f.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const f=R=>this._layers[R].type==="fill-extrusion",v={},S=[];for(let R=this._order.length-1;R>=0;R--){const B=this._order[R];if(f(B)){v[B]=R;for(const G of a){const J=G[B];if(J)for(const ee of J)S.push(ee)}}}S.sort(((R,B)=>B.intersectionZ-R.intersectionZ));const T=[];for(let R=this._order.length-1;R>=0;R--){const B=this._order[R];if(f(B))for(let G=S.length-1;G>=0;G--){const J=S[G].feature;if(v[J.layer.id]<R)break;T.push(J),S.pop()}else for(const G of a){const J=G[B];if(J)for(const ee of J)T.push(ee.feature)}}return T}queryRenderedFeatures(a,f,v){f&&f.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",f.filter,null,f);const S={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const G of f.layers){const J=this._layers[G];if(!J)return this.fire(new o.ErrorEvent(new Error(`The layer '${G}' does not exist in the map's style and cannot be queried for features.`))),[];S[J.source]=!0}}const T=[];f.availableImages=this._availableImages;const R=f&&f.layers?f.layers.some((G=>{const J=this.getLayer(G);return J&&J.is3D()})):this.has3DLayers(),B=Me.createFromScreenPoints(a,v);for(const G in this._sourceCaches){const J=this._sourceCaches[G].getSource().id;f.layers&&!S[J]||T.push(ko(this._sourceCaches[G],this._layers,this._serializedLayers,B,f,v,R,!!this.map._showQueryGeometry))}return this.placement&&T.push((function(G,J,ee,me,Ae,Te,He){const je={},We=Te.queryRenderedSymbols(me),ve=[];for(const Ue of Object.keys(We).map(Number))ve.push(He[Ue]);ve.sort(os);for(const Ue of ve){const rt=Ue.featureIndex.lookupSymbolFeatures(We[Ue.bucketInstanceId],J,Ue.bucketIndex,Ue.sourceLayerIndex,Ae.filter,Ae.layers,Ae.availableImages,G);for(const st in rt){const bt=je[st]=je[st]||[],wt=rt[st];wt.sort(((vt,At)=>{const kt=Ue.featureSortOrder;if(kt){const Vt=kt.indexOf(vt.featureIndex);return kt.indexOf(At.featureIndex)-Vt}return At.featureIndex-vt.featureIndex}));for(const vt of wt)bt.push(vt)}}for(const Ue in je)je[Ue].forEach((rt=>{const st=rt.feature,bt=ee(G[Ue]);if(!bt)return;const wt=bt.getFeatureState(st.layer["source-layer"],st.id);st.source=st.layer.source,st.layer["source-layer"]&&(st.sourceLayer=st.layer["source-layer"]),st.state=wt}));return je})(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),B.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(a,f){f&&f.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",f.filter,null,f);const v=this._getSourceCaches(a);let S=[];for(const T of v)S=S.concat(ro(T,f));return S}addSourceType(a,f,v){return si.getSourceType(a)?v(new Error(`A source type called "${a}" already exists.`)):(si.setSourceType(a,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:f.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(a,f={}){this._checkLoaded();const v=this.light.getLight();let S=!1;for(const R in a)if(!w(a[R],v[R])){S=!0;break}if(!S)return;const T=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,f),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,f=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let v=a;if(f===1){if(typeof v.source=="object"){const S="terrain-dem-src";this.addSource(S,v.source),v=o.clone$1(v),v=o.extend(v,{source:S})}if(this._validate(o.validateTerrain,"terrain",v))return}if(!this.terrain||this.terrain&&f!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,f)}else{const S=this.terrain,T=S.get();for(const R of Object.keys(o.spec.terrain))!v.hasOwnProperty(R)&&o.spec.terrain[R].default&&(v[R]=o.spec.terrain[R].default);for(const R in v)if(!w(v[R],T[R])){S.set(v),this.stylesheet.terrain=v;const B=this._setTransitionParameters({duration:0});S.updateTransitions(B);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const f=this.fog=new Qe(a,this.map.transform);this.stylesheet.fog=a;const v=this._setTransitionParameters({duration:0});f.updateTransitions(v)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const a of this.map._markers)a._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog,v=f.get();Object.keys(a).length===0&&f.set(a);for(const S in a)if(!w(a[S],v[S])){f.set(a),this.stylesheet.fog=a;const T=this._setTransitionParameters({duration:0});f.updateTransitions(T);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:o.exported.now(),transition:o.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter((v=>this.isLayerDraped(this._layers[v]))),f=this._order.filter((v=>!this.isLayerDraped(this._layers[v])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...f)}_createTerrain(a,f){const v=this.terrain=new Oe(a,f);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const S=this._setTransitionParameters({duration:0});v.updateTransitions(S)}_force3DLayerUpdate(){for(const a in this._layers){const f=this._layers[a];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const f=this._layers[a];f.type==="symbol"&&this._updateLayer(f)}}_validate(a,f,v,S,T={}){return(!T||T.validate!==!1)&&Ma(this,a.call(o.validateStyle,o.extend({key:f,style:this.serialize(),value:v,styleSpec:o.spec},S)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const f=this._getSourceCaches(a);for(const v of f)v.clearTiles()}_reloadSource(a){const f=this._getSourceCaches(a);for(const v of f)v.resume(),v.reload()}_reloadSources(){for(const a of this._getSources())a.reload&&a.reload()}_updateSources(a){for(const f in this._sourceCaches)this._sourceCaches[f].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const f=this._sourceCaches[a];f.resume(),f.reload()}}_updatePlacement(a,f,v,S,T=!1){let R=!1,B=!1;const G={};for(const J of this._order){const ee=this._layers[J];if(ee.type!=="symbol")continue;if(!G[ee.source]){const Ae=this._getLayerSourceCache(ee);if(!Ae)continue;G[ee.source]=Ae.getRenderableIds(!0).map((Te=>Ae.getTileByID(Te))).sort(((Te,He)=>He.tileID.overscaledZ-Te.tileID.overscaledZ||(Te.tileID.isLessThan(He.tileID)?-1:1)))}const me=this.crossTileSymbolIndex.addLayer(ee,G[ee.source],a.center.lng,a.projection);R=R||me}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),T=T||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(T||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),a.zoom))&&(this.pauseablePlacement=new Ss(a,this._order,T,f,v,S,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,G),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),B=!0),R&&this.pauseablePlacement.placement.setStale()),B||R)for(const J of this._order){const ee=this._layers[J];ee.type==="symbol"&&this.placement.updateLayerOpacities(ee,G[ee.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,f,v){this.imageManager.getImages(f.icons,v),this._updateTilesForChangedImages();const S=T=>{T&&T.setDependencies(f.tileID.key,f.type,f.icons)};S(this._otherSourceCaches[f.source]),S(this._symbolSourceCaches[f.source])}getGlyphs(a,f,v){this.glyphManager.getGlyphs(f.stacks,v)}getResource(a,f,v){return o.makeRequest(f,v)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const f=[];return this._otherSourceCaches[a]&&f.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&f.push(this._symbolSourceCaches[a]),f}_isSourceCacheLoaded(a){const f=this._getSourceCaches(a);return f.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):f.every((v=>v.loaded()))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}si.getSourceType=function(y){return Ar[y]},si.setSourceType=function(y,a){Ar[y]=a},si.registerForPluginStateChange=o.registerForPluginStateChange;var Gs=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,qo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Es=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,As=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ya=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let ks={},Ws={};const Vl=[];qt(Gs,Vl),qt(Es,Vl),qt(As,Vl),qt(Ya,Vl),ks=on("",Es),Ws=on(Ya,As);const H=on(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Le=Gs,pt=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Pt={background:on(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:on(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:on(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:on("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:on(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:on(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:on("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:on("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:on("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:on(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:on(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:on(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:on(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:on(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:on(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:on(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:on(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:on(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:on(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:on(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:on(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:on(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:on(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:on(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:on(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:on(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,qo),skyboxGradient:on(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,qo),skyboxCapture:on(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:on(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:on(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function qt(y,a){const f=y.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let v of f)if(v=v.trim(),v[0]==="#"&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const S=v.split(" ");for(const T of S)a.includes(T)||a.push(T)}}function on(y,a){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),S={},T=[...Vl];return qt(y,T),qt(a,T),{fragmentSource:y=y.replace(f,((R,B,G,J,ee)=>(S[ee]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
varying ${G} ${J} ${ee};
#else
uniform ${G} ${J} u_${ee};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ee}
    ${G} ${J} ${ee} = u_${ee};
#endif
`))),vertexSource:a=a.replace(f,((R,B,G,J,ee)=>{const me=J==="float"?"vec2":"vec4",Ae=ee.match(/color/)?"color":me;return S[ee]?B==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
uniform lowp float u_${ee}_t;
attribute ${G} ${me} a_${ee};
varying ${G} ${J} ${ee};
#else
uniform ${G} ${J} u_${ee};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${ee}
    ${ee} = a_${ee};
#else
    ${G} ${J} ${ee} = u_${ee};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ee}
    ${ee} = unpack_mix_${Ae}(a_${ee}, u_${ee}_t);
#else
    ${G} ${J} ${ee} = u_${ee};
#endif
`:B==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
uniform lowp float u_${ee}_t;
attribute ${G} ${me} a_${ee};
#else
uniform ${G} ${J} u_${ee};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${ee}
    ${G} ${J} ${ee} = a_${ee};
#else
    ${G} ${J} ${ee} = u_${ee};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ee}
    ${G} ${J} ${ee} = unpack_mix_${Ae}(a_${ee}, u_${ee}_t);
#else
    ${G} ${J} ${ee} = u_${ee};
#endif
`})),staticAttributes:v,usedDefines:T}}class Dn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,f,v,S,T,R,B){this.context=a;let G=this.boundPaintVertexBuffers.length!==S.length;for(let ee=0;!G&&ee<S.length;ee++)this.boundPaintVertexBuffers[ee]!==S[ee]&&(G=!0);let J=this.boundDynamicVertexBuffers.length!==B.length;for(let ee=0;!J&&ee<B.length;ee++)this.boundDynamicVertexBuffers[ee]!==B[ee]&&(J=!0);if(!a.extVertexArrayObject||!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==v||G||J||this.boundIndexBuffer!==T||this.boundVertexOffset!==R)this.freshBind(f,v,S,T,R,B);else{a.bindVertexArrayOES.set(this.vao);for(const ee of B)ee&&ee.bind();T&&T.dynamicDraw&&T.bind()}}freshBind(a,f,v,S,T,R){let B;const G=a.numAttributes,J=this.context,ee=J.gl;if(J.extVertexArrayObject)this.vao&&this.destroy(),this.vao=J.extVertexArrayObject.createVertexArrayOES(),J.bindVertexArrayOES.set(this.vao),B=0,this.boundProgram=a,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=S,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=R;else{B=J.currentNumAttributes||0;for(let me=G;me<B;me++)ee.disableVertexAttribArray(me)}f.enableAttributes(ee,a),f.bind(),f.setVertexAttribPointers(ee,a,T);for(const me of v)me.enableAttributes(ee,a),me.bind(),me.setVertexAttribPointers(ee,a,T);for(const me of R)me&&(me.enableAttributes(ee,a),me.bind(),me.setVertexAttribPointers(ee,a,T));S&&S.bind(),J.currentNumAttributes=G}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Pr(y,a){const f=Math.pow(2,a.canonical.z),v=a.canonical.y;return[new o.MercatorCoordinate(0,v/f).toLngLat().lat,new o.MercatorCoordinate(0,(v+1)/f).toLngLat().lat]}function $r(y,a,f,v,S,T,R){const B=y.context,G=B.gl,J=f.fbo;if(!J)return;y.prepareDrawTile();const ee=y.useProgram("hillshade");B.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,J.colorAttachment.get());const me=((je,We,ve,Ue)=>{const rt=ve.paint.get("hillshade-shadow-color"),st=ve.paint.get("hillshade-highlight-color"),bt=ve.paint.get("hillshade-accent-color");let wt=ve.paint.get("hillshade-illumination-direction")*(Math.PI/180);ve.paint.get("hillshade-illumination-anchor")==="viewport"&&(wt-=je.transform.angle);const vt=!je.options.moving;return{u_matrix:Ue||je.transform.calculateProjMatrix(We.tileID.toUnwrapped(),vt),u_image:0,u_latrange:Pr(0,We.tileID),u_light:[ve.paint.get("hillshade-exaggeration"),wt],u_shadow:rt,u_highlight:st,u_accent:bt}})(y,f,v,y.terrain?a.projMatrix:null);y.prepareDrawProgram(B,ee,a.toUnwrapped());const{tileBoundsBuffer:Ae,tileBoundsIndexBuffer:Te,tileBoundsSegments:He}=y.getTileBoundsBuffers(f);ee.draw(B,G.TRIANGLES,S,T,R,o.CullFaceMode.disabled,me,v.id,Ae,Te,He)}function gi(y,a,f){if(!a.needsDEMTextureUpload)return;const v=y.context,S=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||y.getTileTexture(f.stride);const T=f.getPixels();a.demTexture?a.demTexture.update(T,{premultiply:!1}):a.demTexture=new o.Texture(v,T,S.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function xi(y,a,f,v,S,T){const R=y.context,B=R.gl;if(!a.dem)return;const G=a.dem;if(R.activeTexture.set(B.TEXTURE1),gi(y,a,G),!a.demTexture)return;a.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);const J=G.dim;R.activeTexture.set(B.TEXTURE0);let ee=a.fbo;if(!ee){const He=new o.Texture(R,{width:J,height:J,data:null},B.RGBA);He.bind(B.LINEAR,B.CLAMP_TO_EDGE),ee=a.fbo=R.createFramebuffer(J,J,!0),ee.colorAttachment.set(He.texture)}R.bindFramebuffer.set(ee.framebuffer),R.viewport.set([0,0,J,J]);const{tileBoundsBuffer:me,tileBoundsIndexBuffer:Ae,tileBoundsSegments:Te}=y.getMercatorTileBoundsBuffers();y.useProgram("hillshadePrepare").draw(R,B.TRIANGLES,v,S,T,o.CullFaceMode.disabled,((He,je)=>{const We=je.stride,ve=o.create();return o.ortho(ve,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(ve,ve,[0,-o.EXTENT,0]),{u_matrix:ve,u_image:1,u_dimension:[We,We],u_zoom:He.overscaledZ,u_unpack:je.unpackVector}})(a.tileID,G),f.id,me,Ae,Te),a.needsHillshadePrepare=!1}const so=y=>({u_matrix:new o.UniformMatrix4f(y),u_image0:new o.Uniform1i(y),u_skirt_height:new o.Uniform1f(y)}),lo=(y,a)=>({u_matrix:y,u_image0:0,u_skirt_height:a}),_s=(y,a,f,v,S,T,R,B,G,J,ee,me,Ae,Te,He)=>({u_proj_matrix:Float32Array.from(y),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:f,u_zoom_transition:S,u_merc_center:T,u_image0:0,u_frustum_tl:R,u_frustum_tr:B,u_frustum_br:G,u_frustum_bl:J,u_globe_pos:ee,u_globe_radius:me,u_viewport:Ae,u_grid_matrix:He?Float32Array.from(He):new Float32Array(9),u_skirt_height:Te});function eo(y,a){return y!=null&&a!=null&&!(!y.hasData()||!a.hasData())&&y.demTexture!=null&&a.demTexture!=null&&y.tileID.key!==a.tileID.key}const $o=new class{constructor(){this.operations={}}newMorphing(y,a,f,v,S){if(y in this.operations){const T=this.operations[y];T.to.tileID.key!==f.tileID.key&&(T.queued=f)}else this.operations[y]={startTime:v,phase:0,duration:S,from:a,to:f,queued:null}}getMorphValuesForProxy(y){if(!(y in this.operations))return null;const a=this.operations[y];return{from:a.from,to:a.to,phase:a.phase}}update(y){for(const a in this.operations){const f=this.operations[a];for(f.phase=(y-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,y)){delete this.operations[a];break}}}_nextOp(y,a){return!!y.queued&&(y.from=y.to,y.to=y.queued,y.queued=null,y.phase=0,y.startTime=a,!0)}_validOp(y){return y.from.hasData()&&y.to.hasData()}},Go={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ds(y){return 6*Math.pow(1.5,22-y)}function zo(y,a){const f=1<<y.z;return!a&&(y.x===0||y.x===f-1)||y.y===0||y.y===f-1}const Ms=y=>({u_matrix:y});function Ja(y,a,f,v,S){if(S>0){const T=o.exported.now(),R=(T-y.timeAdded)/S,B=a?(T-a.timeAdded)/S:-1,G=f.getSource(),J=v.coveringZoomLevel({tileSize:G.tileSize,roundZoom:G.roundZoom}),ee=!a||Math.abs(a.tileID.overscaledZ-J)>Math.abs(y.tileID.overscaledZ-J),me=ee&&y.refreshedUponExpiration?1:o.clamp(ee?R:1-B,0,1);return y.refreshedUponExpiration&&R>=1&&(y.refreshedUponExpiration=!1),a?{opacity:1,mix:1-me}:{opacity:me,mix:0}}return{opacity:1,mix:0}}class Hs extends o.SourceCache{constructor(a){const f={type:"raster-dem",maxzoom:a.transform.maxZoom},v=new xe(La(),null),S=Dr("mock-dem",f,v,a.style);super("mock-dem",S,!1),S.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,f){a.state="loaded",f(null)}}class L extends o.SourceCache{constructor(a){const f=Dr("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new xe(La(),null),a.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,f,v){if(a.freezeTileCoverage)return;this.transform=a;const S=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((T,R)=>{if(T[R.key]="",!this._tiles[R.key]){const B=new o.Tile(R,this._source.tileSize*R.overscaleFactor(),a.tileZoom);B.state="loaded",this._tiles[R.key]=B}return T}),{});for(const T in this._tiles)T in S||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(a){const f=this.proxyCachedFBO[a];if(f!==void 0){const v=Object.values(f);this.renderCachePool.push(...v),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach((a=>a.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class re extends o.OverscaledTileID{constructor(a,f,v){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=f,this.projMatrix=v}}class _e extends o.Elevation{constructor(a,f){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,S,T]=(function(G){const J=new o.StructArrayLayout2i4,ee=new o.StructArrayLayout3ui6,me=131;J.reserve(17161),ee.reserve(33800);const Ae=o.EXTENT/128,Te=o.EXTENT+Ae/2,He=Te+Ae;for(let We=-Ae;We<He;We+=Ae)for(let ve=-Ae;ve<He;ve+=Ae){const Ue=ve<0||ve>Te||We<0||We>Te?24575:0,rt=o.clamp(Math.round(ve),0,o.EXTENT),st=o.clamp(Math.round(We),0,o.EXTENT);J.emplaceBack(rt+Ue,st)}const je=(We,ve)=>{const Ue=ve*me+We;ee.emplaceBack(Ue+1,Ue,Ue+me),ee.emplaceBack(Ue+me,Ue+me+1,Ue+1)};for(let We=1;We<129;We++)for(let ve=1;ve<129;ve++)je(ve,We);return[0,129].forEach((We=>{for(let ve=0;ve<130;ve++)je(ve,We),je(We,ve)})),[J,ee,32768]})(),R=a.context;this.gridBuffer=R.createVertexBuffer(v,o.posAttributes.members),this.gridIndexBuffer=R.createIndexBuffer(S),this.gridSegments=o.SegmentVector.simpleSegment(0,0,v.length,S.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,v.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new L(f.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const B=R.gl;this._overlapStencilMode=new o.StencilMode({func:B.GEQUAL,mask:255},0,255,B.KEEP,B.KEEP,B.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Hs(f.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(a,f,v){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const S=a.terrain.properties;this.sourceCache=a.terrain.drapeRenderMode===0?this._mockSourceCache:a._getSourceCache(S.get("source")),this._exaggeration=S.get("exaggeration");const T=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const R=this.getScaledDemTileSize();this.sourceCache.update(f,R,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,T(),this._initializing=!0),T(),f.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||a.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((a=>a.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=v._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(v.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const S=this.proxyCoords=f.getIds().map((G=>{const J=f.getTileByID(G).tileID;return J.projMatrix=v.calculateProjMatrix(J.toUnwrapped()),J}));(function(G,J){const ee=J.transform.pointCoordinate(J.transform.getCameraPoint()),me=new o.Point(ee.x,ee.y);G.sort(((Ae,Te)=>{if(Te.overscaledZ-Ae.overscaledZ)return Te.overscaledZ-Ae.overscaledZ;const He=new o.Point(Ae.canonical.x+(1<<Ae.canonical.z)*Ae.wrap,Ae.canonical.y),je=new o.Point(Te.canonical.x+(1<<Te.canonical.z)*Te.wrap,Te.canonical.y),We=me.mult(1<<Ae.canonical.z);return We.x-=.5,We.y-=.5,We.distSqr(He)-We.distSqr(je)}))})(S,this.painter),this._previousZoom=v.zoom;const T=this.proxyToSource||{};this.proxyToSource={},S.forEach((G=>{this.proxyToSource[G.key]={}})),this.terrainTileForTile={};const R=this._style._sourceCaches;for(const G in R){const J=R[G];if(!J.used||(J!==this.sourceCache&&this.resetTileLookupCache(J.id),this._setupProxiedCoordsForOrtho(J,a[G],T),J.usedForTerrain))continue;const ee=a[G];J.getSource().reparseOverscaled&&this._assignTerrainTiles(ee)}this.proxiedCoords[f.id]=S.map((G=>new re(G,G.key,this.orthoMatrix))),this._assignTerrainTiles(S),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const B={};this._visibleDemTiles=[];for(const G of this.proxyCoords){const J=this.terrainTileForTile[G.key];if(!J)continue;const ee=J.tileID.key;ee in B||(this._visibleDemTiles.push(J),B[ee]=ee)}}_assignTerrainTiles(a){this._initializing||a.forEach((f=>{if(this.terrainTileForTile[f.key])return;const v=this._findTileCoveringTileID(f,this.sourceCache);v&&(this.terrainTileForTile[f.key]=v)}))}_prepareDEMTextures(){const a=this.painter.context,f=a.gl;for(const v in this.terrainTileForTile){const S=this.terrainTileForTile[v],T=S.dem;!T||S.demTexture&&!S.needsDEMTextureUpload||(a.activeTexture.set(f.TEXTURE1),gi(this.painter,S,T))}}_prepareDemTileUniforms(a,f,v,S){if(!f||f.demTexture==null)return!1;const T=a.tileID.canonical,R=Math.pow(2,f.tileID.canonical.z-T.z),B=S||"";return v[`u_dem_tl${B}`]=[T.x*R%1,T.y*R%1],v[`u_dem_scale${B}`]=R,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,f=a.gl;if(!this._emptyDepthBufferTexture){const v=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(a,v,f.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const f=this._visibleDemTiles.reduce(((v,S)=>{if(!S.dem)return v;const T=S.dem.tree.minimums[0];return T>0&&a++,v+T}),0);return a?f/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,f=a.gl;a.activeTexture.set(f.TEXTURE2);const v=this._getLoadedAreaMinimum(),S=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(v,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(S,{premultiply:!1}):T=this._emptyDEMTexture=new o.Texture(a,S,f.RGBA,{premultiply:!1}),T}setupElevationDraw(a,f,v){const S=this.painter.context,T=S.gl,R=(B=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(B),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var B;R.u_dem_size=this.sourceCache.getSource().tileSize,R.u_exaggeration=this.exaggeration();let G=null,J=null,ee=1;if(v&&v.morphing&&this._useVertexMorphing){const me=v.morphing.srcDemTile,Ae=v.morphing.dstDemTile;ee=v.morphing.phase,me&&Ae&&(this._prepareDemTileUniforms(a,me,R,"_prev")&&(J=me),this._prepareDemTileUniforms(a,Ae,R)&&(G=Ae))}if(J&&G?(S.activeTexture.set(T.TEXTURE2),G.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),S.activeTexture.set(T.TEXTURE4),J.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),R.u_dem_lerp=ee):(G=this.terrainTileForTile[a.tileID.key],S.activeTexture.set(T.TEXTURE2),(this._prepareDemTileUniforms(a,G,R)?G.demTexture:this.emptyDEMTexture).bind(T.NEAREST,T.CLAMP_TO_EDGE)),S.activeTexture.set(T.TEXTURE3),v&&v.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),this._depthFBO&&(R.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),R.u_depth_size_inv=[1,1]),v&&v.useMeterToDem&&G){const me=(1<<G.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;R.u_meter_to_dem=me}if(v&&v.labelPlaneMatrixInv&&(R.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),f.setTerrainUniformValues(S,R),this.painter.transform.projection.name==="globe"){const me=this.globeUniformValues(this.painter.transform,a.tileID.canonical,v&&v.useDenormalizedUpVectorScale);f.setGlobeUniformValues(S,me)}}globeUniformValues(a,f,v){const S=a.projection;return{u_tile_tl_up:S.upVector(f,0,0),u_tile_tr_up:S.upVector(f,o.EXTENT,0),u_tile_br_up:S.upVector(f,o.EXTENT,o.EXTENT),u_tile_bl_up:S.upVector(f,0,o.EXTENT),u_tile_up_scale:v?o.globeMetersToEcef(1):S.upVectorScale(f,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const f=this.painter,v=this.painter.context;a.length!==0&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(S,T,R,B,G){if(S.transform.projection.name==="globe")(function(J,ee,me,Ae,Te){const He=J.context,je=He.gl;let We,ve;const Ue=J.options.showTerrainWireframe?2:0,rt=J.transform,st=o.globeUseCustomAntiAliasing(J,He,rt),bt=(In,jt)=>{if(ve===In)return;const sn=[Go[In],"PROJECTION_GLOBE_VIEW"];st&&sn.push("CUSTOM_ANTIALIASING"),jt&&sn.push(Go[Ue]),We=J.useProgram("globeRaster",null,sn),ve=In},wt=J.colorModeForRenderPass(),vt=new o.DepthMode(je.LEQUAL,o.DepthMode.ReadWrite,J.depthRangeFor3D);$o.update(Te);const At=o.calculateGlobeMercatorMatrix(rt),kt=[o.mercatorXfromLng(rt.center.lng),o.mercatorYfromLat(rt.center.lat)],Vt=Ue?[!1,!0]:[!1],gn=J.globeSharedBuffers,Ut=[rt.width*o.exported.devicePixelRatio,rt.height*o.exported.devicePixelRatio],un=Float32Array.from(rt.globeMatrix),$t={useDenormalizedUpVectorScale:!0};if(Vt.forEach((In=>{const jt=J.transform,sn=ds(jt.zoom)*ee.exaggeration();ve=-1;const Cn=In?je.LINES:je.TRIANGLES;for(const _n of Ae){const Mn=me.getTile(_n),cr=o.StencilMode.disabled,kr=ee.prevTerrainTileForTile[_n.key],er=ee.terrainTileForTile[_n.key];eo(kr,er)&&$o.newMorphing(_n.key,kr,er,Te,250),He.activeTexture.set(je.TEXTURE0),Mn.texture.bind(je.LINEAR,je.CLAMP_TO_EDGE);const ar=$o.getMorphValuesForProxy(_n.key),Wr=ar?1:0;ar&&o.extend$1($t,{morphing:{srcDemTile:ar.from,dstDemTile:ar.to,phase:o.easeCubicInOut(ar.phase)}});const hi=o.tileCornersToBounds(_n.canonical),_r=o.getLatitudinalLod(hi.getCenter().lat),Ti=o.getGridMatrix(_n.canonical,hi,_r,jt.worldSize/jt._pixelsPerMercatorPixel),Ii=o.globeNormalizeECEF(o.globeTileBounds(_n.canonical)),yo=_s(jt.projMatrix,un,At,Ii,o.globeToMercatorTransition(jt.zoom),kt,jt.frustumCorners.TL,jt.frustumCorners.TR,jt.frustumCorners.BR,jt.frustumCorners.BL,jt.globeCenterInViewSpace,jt.globeRadius,Ut,sn,Ti);if(bt(Wr,In),ee.setupElevationDraw(Mn,We,$t),J.prepareDrawProgram(He,We,_n.toUnwrapped()),gn){const[co,Js,ps]=In?gn.getWirefameBuffers(J.context,_r):gn.getGridBuffers(_r,sn!==0);We.draw(He,Cn,vt,cr,wt,o.CullFaceMode.backCCW,yo,"globe_raster",co,Js,ps)}}})),gn){const In=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];st&&In.push("CUSTOM_ANTIALIASING"),We=J.useProgram("globeRaster",null,In);for(const jt of Ae){const{x:sn,y:Cn,z:_n}=jt.canonical,Mn=Cn===0,cr=Cn===(1<<_n)-1,[kr,er,ar,Wr]=gn.getPoleBuffers(_n);if(Wr&&(Mn||cr)){const hi=me.getTile(jt);He.activeTexture.set(je.TEXTURE0),hi.texture.bind(je.LINEAR,je.CLAMP_TO_EDGE);let _r=o.globePoleMatrixForTile(_n,sn,rt);const Ti=o.globeNormalizeECEF(o.globeTileBounds(jt.canonical)),Ii=(yo,co)=>yo.draw(He,je.TRIANGLES,vt,o.StencilMode.disabled,wt,o.CullFaceMode.disabled,_s(rt.projMatrix,_r,_r,Ti,0,kt,rt.frustumCorners.TL,rt.frustumCorners.TR,rt.frustumCorners.BR,rt.frustumCorners.BL,rt.globeCenterInViewSpace,rt.globeRadius,Ut,0),"globe_pole_raster",co,ar,Wr);ee.setupElevationDraw(hi,We,$t),J.prepareDrawProgram(He,We,jt.toUnwrapped()),Mn&&Ii(We,kr),cr&&(_r=o.scale(o.create(),_r,[1,-1,1]),Ii(We,er))}}}})(S,T,R,B,G);else{const J=S.context,ee=J.gl;let me,Ae;const Te=S.options.showTerrainWireframe?2:0,He=(rt,st)=>{if(Ae===rt)return;const bt=[Go[rt]];st&&bt.push(Go[Te]),me=S.useProgram("terrainRaster",null,bt),Ae=rt},je=S.colorModeForRenderPass(),We=new o.DepthMode(ee.LEQUAL,o.DepthMode.ReadWrite,S.depthRangeFor3D);$o.update(G);const ve=S.transform,Ue=ds(ve.zoom)*T.exaggeration();(Te?[!1,!0]:[!1]).forEach((rt=>{Ae=-1;const st=rt?ee.LINES:ee.TRIANGLES,[bt,wt]=rt?T.getWirefameBuffer():[T.gridIndexBuffer,T.gridSegments];for(const vt of B){const At=R.getTile(vt),kt=o.StencilMode.disabled,Vt=T.prevTerrainTileForTile[vt.key],gn=T.terrainTileForTile[vt.key];eo(Vt,gn)&&$o.newMorphing(vt.key,Vt,gn,G,250),J.activeTexture.set(ee.TEXTURE0),At.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST);const Ut=$o.getMorphValuesForProxy(vt.key),un=Ut?1:0;let $t;Ut&&($t={morphing:{srcDemTile:Ut.from,dstDemTile:Ut.to,phase:o.easeCubicInOut(Ut.phase)}});const In=lo(vt.projMatrix,zo(vt.canonical,ve.renderWorldCopies)?Ue/10:Ue);He(un,rt),T.setupElevationDraw(At,me,$t),S.prepareDrawProgram(J,me,vt.toUnwrapped()),me.draw(J,st,We,kt,je,o.CullFaceMode.backCCW,In,"terrain_raster",T.gridBuffer,bt,wt)}}))}})(f,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;const f=this.painter,v=this.painter.context,S=this.proxySourceCache,T=this.proxiedCoords[S.id],R=this._drapedRenderBatches.shift(),B=[],G=f.style.order;let J=0;for(const ee of T){const me=S.getTileByID(ee.proxyTileKey),Ae=S.proxyCachedFBO[ee.key]?S.proxyCachedFBO[ee.key][a]:void 0,Te=Ae!==void 0?S.renderCache[Ae]:this.pool[J++],He=Ae!==void 0;if(me.texture=Te.tex,He&&!Te.dirty){B.push(me.tileID);continue}let je;v.bindFramebuffer.set(Te.fb.framebuffer),this.renderedToTile=!1,Te.dirty&&(v.clear({color:o.Color.transparent,stencil:0}),Te.dirty=!1);for(let We=R.start;We<=R.end;++We){const ve=f.style._layers[G[We]];if(ve.isHidden(f.transform.zoom))continue;const Ue=f.style._getLayerSourceCache(ve),rt=Ue?this.proxyToSource[ee.key][Ue.id]:[ee];if(!rt)continue;const st=rt;v.viewport.set([0,0,Te.fb.width,Te.fb.height]),je!==(Ue?Ue.id:null)&&(this._setupStencil(Te,rt,ve,Ue),je=Ue?Ue.id:null),f.renderLayer(f,Ue,ve,st)}this.renderedToTile?(Te.dirty=!0,B.push(me.tileID)):He||--J,J===5&&(J=0,this.renderToBackBuffer(B))}return this.renderToBackBuffer(B),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),R.end+1}postRender(){}renderCacheEfficiency(a){const f=a.order.length;if(f===0)return{efficiency:100};let v,S=0,T=0,R=!1;for(let B=0;B<f;++B){const G=a._layers[a.order[B]];this._style.isLayerDraped(G)?(R&&++S,++T):R||(R=!0,v=G.id)}return T===0?{efficiency:100}:{efficiency:100*(1-S/T),firstUndrapedLayer:v}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter((f=>f.dem)).forEach((f=>{a=Math.min(a,f.dem.tree.minimums[0])})),a===0?a:(a-30)*this._exaggeration}raycast(a,f,v){if(!this._visibleDemTiles)return null;const S=this._visibleDemTiles.filter((T=>T.dem)).map((T=>{const R=T.tileID,B=1<<R.overscaledZ,{x:G,y:J}=R.canonical,ee=G/B,me=(G+1)/B,Ae=J/B,Te=(J+1)/B;return{minx:ee,miny:Ae,maxx:me,maxy:Te,t:T.dem.tree.raycastRoot(ee,Ae,me,Te,a,f,v),tile:T}}));S.sort(((T,R)=>(T.t!==null?T.t:Number.MAX_VALUE)-(R.t!==null?R.t:Number.MAX_VALUE)));for(const T of S){if(T.t==null)return null;const R=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,a,f,v);if(R!=null)return R}return null}_createFBO(){const a=this.painter.context,f=a.gl,v=this.drapeBufferSize;a.activeTexture.set(f.TEXTURE0);const S=new o.Texture(a,{width:v[0],height:v[1],data:null},f.RGBA);S.bind(f.LINEAR,f.CLAMP_TO_EDGE);const T=a.createFramebuffer(v[0],v[1],!1);return T.colorAttachment.set(S.texture),T.depthAttachment=new St(a,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&f.texParameterf(f.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:T,tex:S,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some((a=>{const f=this._style._layers[a],v=f.isHidden(this.painter.transform.zoom);return f.type==="custom"?!v&&f.shouldRedrape():!v&&f.hasTransition()}))}_clearLineLayersFromRenderCache(){let a=!1;for(const v of this._style._getSources())if(v instanceof Bn){a=!0;break}if(!a)return;const f={};for(let v=0;v<this._style.order.length;++v){const S=this._style._layers[this._style.order[v]],T=this._style._getLayerSourceCache(S);if(T&&!f[T.id]&&!S.isHidden(this.painter.transform.zoom)&&S.type==="line"&&S.widthExpression()instanceof o.ZoomDependentExpression){f[T.id]=!0;for(const R of this.proxyCoords){const B=this.proxyToSource[R.key][T.id];if(B)for(const G of B)this._clearRenderCacheForTile(T.id,G)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const v in this._style._sourceCaches)if(this._style._sourceCaches[v]._source instanceof Ln){a=!0;break}if(!a)return;const f={};for(let v=0;v<this._style.order.length;++v){const S=this._style._layers[this._style.order[v]],T=this._style._getLayerSourceCache(S);if(!T||f[T.id]||S.isHidden(this.painter.transform.zoom)||S.type!=="raster")continue;const R=S.paint.get("raster-fade-duration");for(const B of this.proxyCoords){const G=this.proxyToSource[B.key][T.id];if(G)for(const J of G){const ee=Ja(T.getTile(J),T.findLoadedParent(J,0),T,this.painter.transform,R);(ee.opacity!==1||ee.mix!==0)&&this._clearRenderCacheForTile(T.id,J)}}}}_setupDrapedRenderBatches(){const a=this._style.order,f=a.length;if(f===0)return;const v=[];let S,T=0,R=this._style._layers[a[T]];for(;!this._style.isLayerDraped(R)&&R.isHidden(this.painter.transform.zoom)&&++T<f;)R=this._style._layers[a[T]];for(;T<f;++T){const B=this._style._layers[a[T]];B.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(B)?S===void 0&&(S=T):S!==void 0&&(v.push({start:S,end:T-1}),S=void 0))}S!==void 0&&v.push({start:S,end:T-1}),this._drapedRenderBatches=v}_setupRenderCache(a){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const R=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let B=0;B<R.length;++B){const G=Object.values(R[B]);f.renderCachePool.push(...G)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,S=this._tilesDirty;for(let R=v.length-1;R>=0;R--){const B=v[R];if(f.getTileByID(B.key),f.proxyCachedFBO[B.key]!==void 0){const G=a[B.key],J=this.proxyToSource[B.key];let ee=0;for(const me in J){const Ae=J[me],Te=G[me];if(!Te||Te.length!==Ae.length||Ae.some(((He,je)=>He!==Te[je]||S[me]&&S[me].hasOwnProperty(He.key)))){ee=-1;break}++ee}for(const me in f.proxyCachedFBO[B.key])f.renderCache[f.proxyCachedFBO[B.key][me]].dirty=ee<0||ee!==Object.values(G).length}}const T=[...this._drapedRenderBatches];T.sort(((R,B)=>B.end-B.start-(R.end-R.start)));for(const R of T)for(const B of v){if(f.proxyCachedFBO[B.key])continue;let G=f.renderCachePool.pop();G===void 0&&f.renderCache.length<50&&(G=f.renderCache.length,f.renderCache.push(this._createFBO())),G!==void 0&&(f.proxyCachedFBO[B.key]={},f.proxyCachedFBO[B.key][R.start]=G,f.renderCache[G].dirty=!0)}this._tilesDirty={}}_setupStencil(a,f,v,S){if(!S||!this._sourceTilesOverlap[S.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,R=T.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let B;if(v.isTileClipped())B=f.length,this._overlapStencilMode.test={func:R.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);B=1,this._overlapStencilMode.test={func:R.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+B>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=B,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(a,f){const v=this.painter,S=this.painter.context,T=S.gl;v._tileClippingMaskIDs={},S.setColorMode(o.ColorMode.disabled),S.setDepthMode(o.DepthMode.disabled);const R=v.useProgram("clippingMask");for(const B of a){const G=v._tileClippingMaskIDs[B.key]=--f;R.draw(S,T.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:T.ALWAYS,mask:0},G,255,T.KEEP,T.KEEP,T.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Ms(B.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(a){const f=this.painter.transform;if(a.x<0||a.x>f.width||a.y<0||a.y>f.height)return null;const v=[a.x,a.y,1,1];o.transformMat4$1(v,v,f.pixelMatrixInverse),o.scale$1(v,v,1/v[3]),v[0]/=f.worldSize,v[1]/=f.worldSize;const S=f._camera.position,T=o.mercatorZfromAltitude(1,f.center.lat),R=[S[0],S[1],S[2]/T,0],B=o.subtract([],v.slice(0,3),R);o.normalize(B,B);const G=this.raycast(R,B,this._exaggeration);return G!==null&&G?(o.scaleAndAdd(R,R,B,G),R[3]=R[2],R[2]*=T,R):null}drawDepth(){const a=this.painter,f=a.context,v=this.proxySourceCache,S=Math.ceil(a.width),T=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===S&&this._depthFBO.height===T||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const R=f.gl,B=f.createFramebuffer(S,T,!0);f.activeTexture.set(R.TEXTURE0);const G=new o.Texture(f,{width:S,height:T,data:null},R.RGBA);G.bind(R.NEAREST,R.CLAMP_TO_EDGE),B.colorAttachment.set(G.texture);const J=f.createRenderbuffer(f.gl.DEPTH_COMPONENT16,S,T);B.depthAttachment.set(J),this._depthFBO=B,this._depthTexture=G}f.bindFramebuffer.set(this._depthFBO.framebuffer),f.viewport.set([0,0,S,T]),(function(R,B,G,J){if(R.transform.projection.name==="globe")return;const ee=R.context,me=ee.gl;ee.clear({depth:1});const Ae=R.useProgram("terrainDepth"),Te=new o.DepthMode(me.LESS,o.DepthMode.ReadWrite,R.depthRangeFor3D);for(const He of J){const je=G.getTile(He),We=lo(He.projMatrix,0);B.setupElevationDraw(je,Ae),Ae.draw(ee,me.TRIANGLES,Te,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,We,"terrain_depth",B.gridBuffer,B.gridIndexBuffer,B.gridNoSkirtSegments)}})(a,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,f,v){if(a.getSource()instanceof Cr)return this._setupProxiedCoordsForImageSource(a,f,v);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const S=this.proxiedCoords[a.id]=[],T=this.proxyCoords;for(let B=0;B<T.length;B++){const G=T[B],J=this._findTileCoveringTileID(G,a);if(J){const ee=this._createProxiedId(G,J,v[G.key]&&v[G.key][a.id]);S.push(ee),this.proxyToSource[G.key][a.id]=[ee]}}let R=!1;for(let B=0;B<f.length;B++){const G=a.getTile(f[B]);if(!G||!G.hasData())continue;const J=this._findTileCoveringTileID(G.tileID,this.proxySourceCache);if(J&&J.tileID.canonical.z!==G.tileID.canonical.z){const ee=this.proxyToSource[J.tileID.key][a.id],me=this._createProxiedId(J.tileID,G,v[J.tileID.key]&&v[J.tileID.key][a.id]);ee?ee.splice(ee.length-1,0,me):this.proxyToSource[J.tileID.key][a.id]=[me],S.push(me),R=!0}}this._sourceTilesOverlap[a.id]=R}_setupProxiedCoordsForImageSource(a,f,v){if(!a.getSource().loaded())return;const S=this.proxiedCoords[a.id]=[],T=this.proxyCoords,R=a.getSource(),B=new o.Point(R.tileID.x,R.tileID.y)._div(1<<R.tileID.z),G=R.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce(((ee,me)=>(ee.min.x=Math.min(ee.min.x,me.x-B.x),ee.min.y=Math.min(ee.min.y,me.y-B.y),ee.max.x=Math.max(ee.max.x,me.x-B.x),ee.max.y=Math.max(ee.max.y,me.y-B.y),ee)),{min:new o.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),J=(ee,me)=>{const Ae=ee.wrap+ee.canonical.x/(1<<ee.canonical.z),Te=ee.canonical.y/(1<<ee.canonical.z),He=o.EXTENT/(1<<ee.canonical.z),je=me.wrap+me.canonical.x/(1<<me.canonical.z),We=me.canonical.y/(1<<me.canonical.z);return Ae+He<je+G.min.x||Ae>je+G.max.x||Te+He<We+G.min.y||Te>We+G.max.y};for(let ee=0;ee<T.length;ee++){const me=T[ee];for(let Ae=0;Ae<f.length;Ae++){const Te=a.getTile(f[Ae]);if(!Te||!Te.hasData()||J(me,Te.tileID))continue;const He=this._createProxiedId(me,Te,v[me.key]&&v[me.key][a.id]),je=this.proxyToSource[me.key][a.id];je?je.push(He):this.proxyToSource[me.key][a.id]=[He],S.push(He)}}}_createProxiedId(a,f,v){let S=this.orthoMatrix;if(v){const T=v.find((R=>R.key===f.tileID.key));if(T)return T}if(f.tileID.key!==a.key){const T=a.canonical.z-f.tileID.canonical.z;let R,B,G;S=o.create();const J=f.tileID.wrap-a.wrap<<a.overscaledZ;T>0?(R=o.EXTENT>>T,B=R*((f.tileID.canonical.x<<T)-a.canonical.x+J),G=R*((f.tileID.canonical.y<<T)-a.canonical.y)):(R=o.EXTENT<<-T,B=o.EXTENT*(f.tileID.canonical.x-(a.canonical.x+J<<-T)),G=o.EXTENT*(f.tileID.canonical.y-(a.canonical.y<<-T))),o.ortho(S,0,R,0,R,0,1),o.translate(S,S,[B,G,0])}return new re(f.tileID,a.key,S)}_findTileCoveringTileID(a,f){let v=f.getTile(a);if(v&&v.hasData())return v;const S=this._findCoveringTileCache[f.id],T=S[a.key];if(v=T?f.getTileByID(T):null,v&&v.hasData()||T===null)return v;let R=v?v.tileID:a,B=R.overscaledZ;const G=f.getSource().minzoom,J=[];if(!T){const me=f.getSource().maxzoom;if(a.canonical.z>=me){const Ae=a.canonical.z-me;f.getSource().reparseOverscaled?(B=Math.max(a.canonical.z+2,f.transform.tileZoom),R=new o.OverscaledTileID(B,a.wrap,me,a.canonical.x>>Ae,a.canonical.y>>Ae)):Ae!==0&&(B=me,R=new o.OverscaledTileID(B,a.wrap,me,a.canonical.x>>Ae,a.canonical.y>>Ae))}R.key!==a.key&&(J.push(R.key),v=f.getTile(R))}const ee=me=>{J.forEach((Ae=>{S[Ae]=me})),J.length=0};for(B-=1;B>=G&&(!v||!v.hasData());B--){v&&ee(v.tileID.key);const me=R.calculateScaledKey(B);if(v=f.getTileByID(me),v&&v.hasData())break;const Ae=S[me];if(Ae===null)break;Ae===void 0?J.push(me):v=f.getTileByID(Ae)}return ee(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,f){let v=this._tilesDirty[a];v||(v=this._tilesDirty[a]={}),v[f.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=(function(f){let v=0;const S=new o.StructArrayLayout2ui4,T=131;for(let R=1;R<129;R++){for(let B=1;B<129;B++)v=R*T+B,S.emplaceBack(v,v+1),S.emplaceBack(v,v+T),S.emplaceBack(v+1,v+T),R===128&&S.emplaceBack(v+T,v+T+1);S.emplaceBack(v+1,v+1+T)}return S})();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class $e{static cacheKey(a,f,v,S){let T=`${f}${S?S.cacheKey:""}`;for(const R of v)a.usedDefines.includes(R)&&(T+=`/${R}`);return T}constructor(a,f,v,S,T,R){const B=a.gl;this.program=B.createProgram();const G=(function(ve){const Ue=[];for(let rt=0;rt<ve.length;rt++){if(ve[rt]===null)continue;const st=ve[rt].split(" ");Ue.push(st.pop())}return Ue})(v.staticAttributes),J=S?S.getBinderAttributes():[],ee=G.concat(J);let me=S?S.defines():[];me=me.concat(R.map((ve=>`#define ${ve}`)));const Ae=a.isWebGL2?`#version 300 es
`:"",Te=Ae+me.concat(a.extStandardDerivatives&&Ae.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(pt):pt,pt,Le,H.fragmentSource,Ws.fragmentSource,v.fragmentSource).join(`
`),He=Ae+me.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Le,H.vertexSource,Ws.vertexSource,ks.vertexSource,v.vertexSource).join(`
`),je=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);B.shaderSource(je,Te),B.compileShader(je),B.attachShader(this.program,je);const We=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())this.failedToCreate=!0;else{B.shaderSource(We,He),B.compileShader(We),B.attachShader(this.program,We),this.attributes={},this.numAttributes=ee.length;for(let ve=0;ve<this.numAttributes;ve++)ee[ve]&&(B.bindAttribLocation(this.program,ve,ee[ve]),this.attributes[ee[ve]]=ve);B.linkProgram(this.program),B.deleteShader(We),B.deleteShader(je),this.fixedUniforms=T(a),this.binderUniforms=S?S.getUniforms(a):[],R.includes("TERRAIN")&&(this.terrainUniforms=(ve=>({u_dem:new o.Uniform1i(ve),u_dem_prev:new o.Uniform1i(ve),u_dem_unpack:new o.Uniform4f(ve),u_dem_tl:new o.Uniform2f(ve),u_dem_scale:new o.Uniform1f(ve),u_dem_tl_prev:new o.Uniform2f(ve),u_dem_scale_prev:new o.Uniform1f(ve),u_dem_size:new o.Uniform1f(ve),u_dem_lerp:new o.Uniform1f(ve),u_exaggeration:new o.Uniform1f(ve),u_depth:new o.Uniform1i(ve),u_depth_size_inv:new o.Uniform2f(ve),u_meter_to_dem:new o.Uniform1f(ve),u_label_plane_matrix_inv:new o.UniformMatrix4f(ve)}))(a)),R.includes("GLOBE")&&(this.globeUniforms=(ve=>({u_tile_tl_up:new o.Uniform3f(ve),u_tile_tr_up:new o.Uniform3f(ve),u_tile_br_up:new o.Uniform3f(ve),u_tile_bl_up:new o.Uniform3f(ve),u_tile_up_scale:new o.Uniform1f(ve)}))(a)),R.includes("FOG")&&(this.fogUniforms=(ve=>({u_fog_matrix:new o.UniformMatrix4f(ve),u_fog_range:new o.Uniform2f(ve),u_fog_color:new o.Uniform4f(ve),u_fog_horizon_blend:new o.Uniform1f(ve),u_fog_temporal_offset:new o.Uniform1f(ve),u_frustum_tl:new o.Uniform3f(ve),u_frustum_tr:new o.Uniform3f(ve),u_frustum_br:new o.Uniform3f(ve),u_frustum_bl:new o.Uniform3f(ve),u_globe_pos:new o.Uniform3f(ve),u_globe_radius:new o.Uniform1f(ve),u_globe_transition:new o.Uniform1f(ve),u_is_globe:new o.Uniform1i(ve),u_viewport:new o.Uniform2f(ve)}))(a))}}setTerrainUniformValues(a,f){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const S in f)v[S]&&v[S].set(this.program,S,f[S])}}setGlobeUniformValues(a,f){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const S in f)v[S]&&v[S].set(this.program,S,f[S])}}setFogUniformValues(a,f){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const S in f)v[S].set(this.program,S,f[S])}}draw(a,f,v,S,T,R,B,G,J,ee,me,Ae,Te,He,je){const We=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(v),a.setStencilMode(S),a.setColorMode(T),a.setCullFace(R);for(const Ue of Object.keys(this.fixedUniforms))this.fixedUniforms[Ue].set(this.program,Ue,B[Ue]);He&&He.setUniforms(this.program,a,this.binderUniforms,Ae,{zoom:Te});const ve={[We.LINES]:2,[We.TRIANGLES]:3,[We.LINE_STRIP]:1}[f];for(const Ue of me.get()){const rt=Ue.vaos||(Ue.vaos={});(rt[G]||(rt[G]=new Dn)).bind(a,this,J,He?He.getPaintVertexBuffers():[],ee,Ue.vertexOffset,je||[]),We.drawElements(f,Ue.primitiveLength*ve,We.UNSIGNED_SHORT,Ue.primitiveOffset*ve*2)}}}function Xt(y,a){const f=Math.pow(2,a.tileID.overscaledZ),v=a.tileSize*Math.pow(2,y.transform.tileZoom)/f,S=v*(a.tileID.canonical.x+a.tileID.wrap*f),T=v*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_tile_units_to_pixels:1/ae(a,1,y.transform.tileZoom),u_pixel_coord_upper:[S>>16,T>>16],u_pixel_coord_lower:[65535&S,65535&T]}}const nn=o.create(),Un=(y,a,f,v,S,T,R,B,G,J,ee)=>{const me=a.style.light,Ae=me.properties.get("position"),Te=[Ae.x,Ae.y,Ae.z],He=o.create$1();me.properties.get("anchor")==="viewport"&&(o.fromRotation(He,-a.transform.angle),o.transformMat3(Te,Te,He));const je=me.properties.get("color"),We=a.transform,ve={u_matrix:y,u_lightpos:Te,u_lightintensity:me.properties.get("intensity"),u_lightcolor:[je.r,je.g,je.b],u_vertical_gradient:+f,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:nn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:S,u_edge_radius:T};return We.projection.name==="globe"&&(ve.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],ve.u_zoom_transition=G,ve.u_inv_rot_matrix=ee,ve.u_merc_center=J,ve.u_up_dir=We.projection.upVector(new o.CanonicalTileID(0,0,0),J[0]*o.EXTENT,J[1]*o.EXTENT),ve.u_height_lift=B),ve},mo=(y,a,f,v,S,T,R,B,G,J,ee,me)=>{const Ae=Un(y,a,f,v,S,T,R,G,J,ee,me),Te={u_height_factor:-Math.pow(2,R.overscaledZ)/B.tileSize/8};return o.extend(Ae,Xt(a,B),Te)},jo=y=>({u_matrix:y}),Hi=(y,a,f)=>o.extend(jo(y),Xt(a,f)),Qr=(y,a)=>({u_matrix:y,u_world:a}),xo=(y,a,f,v)=>o.extend(Hi(y,a,f),{u_world:v}),fs=o.create(),pa=(y,a,f,v,S,T)=>{const R=y.transform,B=R.projection.name==="globe";let G;if(T.paint.get("circle-pitch-alignment")==="map")if(B){const ee=o.globePixelsToTileUnits(R.zoom,a.canonical)*R._pixelsPerMercatorPixel;G=Float32Array.from([ee,0,0,ee])}else G=R.calculatePixelsToTileUnitsMatrix(f);else G=new Float32Array([R.pixelsToGLUnits[0],0,0,R.pixelsToGLUnits[1]]);const J={u_camera_to_center_distance:R.cameraToCenterDistance,u_matrix:y.translatePosMatrix(a.projMatrix,f,T.paint.get("circle-translate"),T.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:G,u_inv_rot_matrix:fs,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(B){J.u_inv_rot_matrix=v,J.u_merc_center=S,J.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],J.u_zoom_transition=o.globeToMercatorTransition(R.zoom);const ee=S[0]*o.EXTENT,me=S[1]*o.EXTENT;J.u_up_dir=R.projection.upVector(new o.CanonicalTileID(0,0,0),ee,me)}return J},Rs=y=>{const a=[];return y.paint.get("circle-pitch-alignment")==="map"&&a.push("PITCH_WITH_MAP"),y.paint.get("circle-pitch-scale")==="map"&&a.push("SCALE_WITH_MAP"),a},Tl=(y,a,f,v)=>{const S=o.EXTENT/f.tileSize;return{u_matrix:y,u_camera_to_center_distance:a.getCameraToCenterDistance(v),u_extrude_scale:[a.pixelsToGLUnits[0]/S,a.pixelsToGLUnits[1]/S]}},Ua=(y,a,f=1)=>({u_matrix:y,u_color:a,u_overlay:0,u_overlay_scale:f}),Xc=o.create(),ml=(y,a,f,v,S,T,R)=>{const B=y.transform,G=B.projection.name==="globe",J=G?o.globePixelsToTileUnits(B.zoom,a.canonical)*B._pixelsPerMercatorPixel:ae(f,1,T),ee={u_matrix:a.projMatrix,u_extrude_scale:J,u_intensity:R,u_inv_rot_matrix:Xc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(G){ee.u_inv_rot_matrix=v,ee.u_merc_center=S,ee.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],ee.u_zoom_transition=o.globeToMercatorTransition(B.zoom);const me=S[0]*o.EXTENT,Ae=S[1]*o.EXTENT;ee.u_up_dir=B.projection.upVector(new o.CanonicalTileID(0,0,0),me,Ae)}return ee},Qa=(y,a,f,v,S,T,R)=>{const B=y.transform,G=B.calculatePixelsToTileUnitsMatrix(a);return{u_matrix:Kc(y,a,f,v),u_pixels_to_tile_units:G,u_device_pixel_ratio:T,u_units_to_pixels:[1/B.pixelsToGLUnits[0],1/B.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:S,u_texsize:Uo(f)?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Xs(a,y.transform),u_alpha_discard_threshold:0,u_trim_offset:R}},ma=(y,a,f,v,S)=>{const T=y.transform;return{u_matrix:Kc(y,a,f,v),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:S,u_image:0,u_tile_units_to_pixels:Xs(a,T),u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Xs(y,a){return 1/ae(y,1,a.tileZoom)}function Kc(y,a,f,v){return y.translatePosMatrix(v||a.tileID.projMatrix,a,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}function Uo(y){const a=y.paint.get("line-dasharray").value;return a.value||a.kind!=="constant"}const au=(y,a,f,v,S,T)=>{return{u_matrix:y,u_tl_parent:a,u_scale_parent:f,u_fade_t:v.mix,u_opacity:v.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(B=S.paint.get("raster-saturation"),B>0?1-1/(1.001-B):-B),u_contrast_factor:(R=S.paint.get("raster-contrast"),R>0?1/(1-R):1+R),u_spin_weights:el(S.paint.get("raster-hue-rotate")),u_perspective_transform:T};var R,B};function el(y){y*=Math.PI/180;const a=Math.sin(y),f=Math.cos(y);return[(2*f+1)/3,(-Math.sqrt(3)*a-f+1)/3,(Math.sqrt(3)*a-f+1)/3]}const tl=o.create(),Ks=(y,a,f,v,S,T,R,B,G,J,ee,me,Ae,Te,He,je)=>{const We=S.transform,ve={u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:We.cameraToCenterDistance,u_rotate_symbol:+f,u_aspect_ratio:We.width/We.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:R,u_coord_matrix:B,u_is_text:+G,u_pitch_with_map:+v,u_texsize:J,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:tl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:tl,u_up_vector:[0,-1,0]};return je.name==="globe"&&(ve.u_tile_id=[ee.canonical.x,ee.canonical.y,1<<ee.canonical.z],ve.u_zoom_transition=me,ve.u_inv_rot_matrix=Te,ve.u_merc_center=Ae,ve.u_camera_forward=We._camera.forward(),ve.u_ecef_origin=o.globeECEFOrigin(We.globeMatrix,ee.toUnwrapped()),ve.u_tile_matrix=Float32Array.from(We.globeMatrix),ve.u_up_vector=He),ve},Ic=(y,a,f,v,S,T,R,B,G,J,ee,me,Ae,Te,He,je,We)=>o.extend(Ks(y,a,f,v,S,T,R,B,G,J,me,Ae,Te,He,je,We),{u_gamma_scale:v?S.transform.cameraToCenterDistance*Math.cos(S.terrain?0:S.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:1}),Cc=(y,a,f,v,S,T,R,B,G,J,ee,me,Ae,Te,He,je)=>o.extend(Ic(y,a,f,v,S,T,R,B,!0,G,!0,ee,me,Ae,Te,He,je),{u_texsize_icon:J,u_texture_icon:1}),ql=(y,a,f)=>({u_matrix:y,u_opacity:a,u_color:f}),Zc=(y,a,f,v,S)=>o.extend((function(T,R,B){const G=R.imageManager.getPattern(T.toString()),{width:J,height:ee}=R.imageManager.getPixelSize(),me=Math.pow(2,B.tileID.overscaledZ),Ae=B.tileSize*Math.pow(2,R.transform.tileZoom)/me,Te=Ae*(B.tileID.canonical.x+B.tileID.wrap*me),He=Ae*B.tileID.canonical.y;return{u_image:0,u_pattern_tl:G.tl,u_pattern_br:G.br,u_texsize:[J,ee],u_pattern_size:G.displaySize,u_tile_units_to_pixels:1/ae(B,1,R.transform.tileZoom),u_pixel_coord_upper:[Te>>16,He>>16],u_pixel_coord_lower:[65535&Te,65535&He]}})(v,f,S),{u_matrix:y,u_opacity:a}),lu={fillExtrusion:y=>({u_matrix:new o.UniformMatrix4f(y),u_lightpos:new o.Uniform3f(y),u_lightintensity:new o.Uniform1f(y),u_lightcolor:new o.Uniform3f(y),u_vertical_gradient:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y),u_edge_radius:new o.Uniform1f(y),u_ao:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_up_dir:new o.Uniform3f(y),u_height_lift:new o.Uniform1f(y)}),fillExtrusionPattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_lightpos:new o.Uniform3f(y),u_lightintensity:new o.Uniform1f(y),u_lightcolor:new o.Uniform3f(y),u_vertical_gradient:new o.Uniform1f(y),u_height_factor:new o.Uniform1f(y),u_edge_radius:new o.Uniform1f(y),u_ao:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_up_dir:new o.Uniform3f(y),u_height_lift:new o.Uniform1f(y),u_image:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y)}),fill:y=>({u_matrix:new o.UniformMatrix4f(y)}),fillPattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_image:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y)}),fillOutline:y=>({u_matrix:new o.UniformMatrix4f(y),u_world:new o.Uniform2f(y)}),fillOutlinePattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_world:new o.Uniform2f(y),u_image:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y)}),circle:y=>({u_camera_to_center_distance:new o.Uniform1f(y),u_extrude_scale:new o.UniformMatrix2f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_up_dir:new o.Uniform3f(y)}),collisionBox:y=>({u_matrix:new o.UniformMatrix4f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_extrude_scale:new o.Uniform2f(y)}),collisionCircle:y=>({u_matrix:new o.UniformMatrix4f(y),u_inv_matrix:new o.UniformMatrix4f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_viewport_size:new o.Uniform2f(y)}),debug:y=>({u_color:new o.UniformColor(y),u_matrix:new o.UniformMatrix4f(y),u_overlay:new o.Uniform1i(y),u_overlay_scale:new o.Uniform1f(y)}),clippingMask:y=>({u_matrix:new o.UniformMatrix4f(y)}),heatmap:y=>({u_extrude_scale:new o.Uniform1f(y),u_intensity:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_up_dir:new o.Uniform3f(y)}),heatmapTexture:y=>({u_image:new o.Uniform1i(y),u_color_ramp:new o.Uniform1i(y),u_opacity:new o.Uniform1f(y)}),hillshade:y=>({u_matrix:new o.UniformMatrix4f(y),u_image:new o.Uniform1i(y),u_latrange:new o.Uniform2f(y),u_light:new o.Uniform2f(y),u_shadow:new o.UniformColor(y),u_highlight:new o.UniformColor(y),u_accent:new o.UniformColor(y)}),hillshadePrepare:y=>({u_matrix:new o.UniformMatrix4f(y),u_image:new o.Uniform1i(y),u_dimension:new o.Uniform2f(y),u_zoom:new o.Uniform1f(y),u_unpack:new o.Uniform4f(y)}),line:y=>({u_matrix:new o.UniformMatrix4f(y),u_pixels_to_tile_units:new o.UniformMatrix2f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_units_to_pixels:new o.Uniform2f(y),u_dash_image:new o.Uniform1i(y),u_gradient_image:new o.Uniform1i(y),u_image_height:new o.Uniform1f(y),u_texsize:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y),u_alpha_discard_threshold:new o.Uniform1f(y),u_trim_offset:new o.Uniform2f(y)}),linePattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_texsize:new o.Uniform2f(y),u_pixels_to_tile_units:new o.UniformMatrix2f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_image:new o.Uniform1i(y),u_units_to_pixels:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y),u_alpha_discard_threshold:new o.Uniform1f(y)}),raster:y=>({u_matrix:new o.UniformMatrix4f(y),u_tl_parent:new o.Uniform2f(y),u_scale_parent:new o.Uniform1f(y),u_fade_t:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y),u_image0:new o.Uniform1i(y),u_image1:new o.Uniform1i(y),u_brightness_low:new o.Uniform1f(y),u_brightness_high:new o.Uniform1f(y),u_saturation_factor:new o.Uniform1f(y),u_contrast_factor:new o.Uniform1f(y),u_spin_weights:new o.Uniform3f(y),u_perspective_transform:new o.Uniform2f(y)}),symbolIcon:y=>({u_is_size_zoom_constant:new o.Uniform1i(y),u_is_size_feature_constant:new o.Uniform1i(y),u_size_t:new o.Uniform1f(y),u_size:new o.Uniform1f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_rotate_symbol:new o.Uniform1i(y),u_aspect_ratio:new o.Uniform1f(y),u_fade_change:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_label_plane_matrix:new o.UniformMatrix4f(y),u_coord_matrix:new o.UniformMatrix4f(y),u_is_text:new o.Uniform1i(y),u_pitch_with_map:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_camera_forward:new o.Uniform3f(y),u_tile_matrix:new o.UniformMatrix4f(y),u_up_vector:new o.Uniform3f(y),u_ecef_origin:new o.Uniform3f(y),u_texture:new o.Uniform1i(y)}),symbolSDF:y=>({u_is_size_zoom_constant:new o.Uniform1i(y),u_is_size_feature_constant:new o.Uniform1i(y),u_size_t:new o.Uniform1f(y),u_size:new o.Uniform1f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_rotate_symbol:new o.Uniform1i(y),u_aspect_ratio:new o.Uniform1f(y),u_fade_change:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_label_plane_matrix:new o.UniformMatrix4f(y),u_coord_matrix:new o.UniformMatrix4f(y),u_is_text:new o.Uniform1i(y),u_pitch_with_map:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_texture:new o.Uniform1i(y),u_gamma_scale:new o.Uniform1f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_camera_forward:new o.Uniform3f(y),u_tile_matrix:new o.UniformMatrix4f(y),u_up_vector:new o.Uniform3f(y),u_ecef_origin:new o.Uniform3f(y),u_is_halo:new o.Uniform1i(y)}),symbolTextAndIcon:y=>({u_is_size_zoom_constant:new o.Uniform1i(y),u_is_size_feature_constant:new o.Uniform1i(y),u_size_t:new o.Uniform1f(y),u_size:new o.Uniform1f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_rotate_symbol:new o.Uniform1i(y),u_aspect_ratio:new o.Uniform1f(y),u_fade_change:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_label_plane_matrix:new o.UniformMatrix4f(y),u_coord_matrix:new o.UniformMatrix4f(y),u_is_text:new o.Uniform1i(y),u_pitch_with_map:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_texsize_icon:new o.Uniform2f(y),u_texture:new o.Uniform1i(y),u_texture_icon:new o.Uniform1i(y),u_gamma_scale:new o.Uniform1f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_is_halo:new o.Uniform1i(y)}),background:y=>({u_matrix:new o.UniformMatrix4f(y),u_opacity:new o.Uniform1f(y),u_color:new o.UniformColor(y)}),backgroundPattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_opacity:new o.Uniform1f(y),u_image:new o.Uniform1i(y),u_pattern_tl:new o.Uniform2f(y),u_pattern_br:new o.Uniform2f(y),u_texsize:new o.Uniform2f(y),u_pattern_size:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y)}),terrainRaster:so,terrainDepth:so,skybox:y=>({u_matrix:new o.UniformMatrix4f(y),u_sun_direction:new o.Uniform3f(y),u_cubemap:new o.Uniform1i(y),u_opacity:new o.Uniform1f(y),u_temporal_offset:new o.Uniform1f(y)}),skyboxGradient:y=>({u_matrix:new o.UniformMatrix4f(y),u_color_ramp:new o.Uniform1i(y),u_center_direction:new o.Uniform3f(y),u_radius:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y),u_temporal_offset:new o.Uniform1f(y)}),skyboxCapture:y=>({u_matrix_3f:new o.UniformMatrix3f(y),u_sun_direction:new o.Uniform3f(y),u_sun_intensity:new o.Uniform1f(y),u_color_tint_r:new o.Uniform4f(y),u_color_tint_m:new o.Uniform4f(y),u_luminance:new o.Uniform1f(y)}),globeRaster:y=>({u_proj_matrix:new o.UniformMatrix4f(y),u_globe_matrix:new o.UniformMatrix4f(y),u_normalize_matrix:new o.UniformMatrix4f(y),u_merc_matrix:new o.UniformMatrix4f(y),u_zoom_transition:new o.Uniform1f(y),u_merc_center:new o.Uniform2f(y),u_image0:new o.Uniform1i(y),u_grid_matrix:new o.UniformMatrix3f(y),u_skirt_height:new o.Uniform1f(y),u_frustum_tl:new o.Uniform3f(y),u_frustum_tr:new o.Uniform3f(y),u_frustum_br:new o.Uniform3f(y),u_frustum_bl:new o.Uniform3f(y),u_globe_pos:new o.Uniform3f(y),u_globe_radius:new o.Uniform1f(y),u_viewport:new o.Uniform2f(y)}),globeAtmosphere:y=>({u_frustum_tl:new o.Uniform3f(y),u_frustum_tr:new o.Uniform3f(y),u_frustum_br:new o.Uniform3f(y),u_frustum_bl:new o.Uniform3f(y),u_horizon:new o.Uniform1f(y),u_transition:new o.Uniform1f(y),u_fadeout_range:new o.Uniform1f(y),u_color:new o.Uniform4f(y),u_high_color:new o.Uniform4f(y),u_space_color:new o.Uniform4f(y),u_star_intensity:new o.Uniform1f(y),u_star_density:new o.Uniform1f(y),u_star_size:new o.Uniform1f(y),u_temporal_offset:new o.Uniform1f(y),u_horizon_angle:new o.Uniform1f(y),u_rotation_matrix:new o.UniformMatrix4f(y)})};let Yc;function cu(y,a,f,v,S,T,R){const B=y.context,G=B.gl,J=y.transform,ee=y.useProgram("collisionBox"),me=[];let Ae=0,Te=0;for(let st=0;st<v.length;st++){const bt=v[st],wt=a.getTile(bt),vt=wt.getBucket(f);if(!vt)continue;const At=es(bt,vt,J);let kt=At;S[0]===0&&S[1]===0||(kt=y.translatePosMatrix(At,wt,S,T));const Vt=R?vt.textCollisionBox:vt.iconCollisionBox,gn=vt.collisionCircleArray;if(gn.length>0){const Ut=o.create(),un=kt;o.mul(Ut,vt.placementInvProjMatrix,J.glCoordMatrix),o.mul(Ut,Ut,vt.placementViewportMatrix),me.push({circleArray:gn,circleOffset:Te,transform:un,invTransform:Ut,projection:vt.getProjection()}),Ae+=gn.length/4,Te=Ae}Vt&&(y.terrain&&y.terrain.setupElevationDraw(wt,ee),ee.draw(B,G.LINES,o.DepthMode.disabled,o.StencilMode.disabled,y.colorModeForRenderPass(),o.CullFaceMode.disabled,Tl(kt,J,wt,vt.getProjection()),f.id,Vt.layoutVertexBuffer,Vt.indexBuffer,Vt.segments,null,J.zoom,null,[Vt.collisionVertexBuffer,Vt.collisionVertexBufferExt]))}if(!R||!me.length)return;const He=y.useProgram("collisionCircle"),je=new o.StructArrayLayout2f1f2i16;je.resize(4*Ae),je._trim();let We=0;for(const st of me)for(let bt=0;bt<st.circleArray.length/4;bt++){const wt=4*bt,vt=st.circleArray[wt+0],At=st.circleArray[wt+1],kt=st.circleArray[wt+2],Vt=st.circleArray[wt+3];je.emplace(We++,vt,At,kt,Vt,0),je.emplace(We++,vt,At,kt,Vt,1),je.emplace(We++,vt,At,kt,Vt,2),je.emplace(We++,vt,At,kt,Vt,3)}(!Yc||Yc.length<2*Ae)&&(Yc=(function(st){const bt=2*st,wt=new o.StructArrayLayout3ui6;wt.resize(bt),wt._trim();for(let vt=0;vt<bt;vt++){const At=6*vt;wt.uint16[At+0]=4*vt+0,wt.uint16[At+1]=4*vt+1,wt.uint16[At+2]=4*vt+2,wt.uint16[At+3]=4*vt+2,wt.uint16[At+4]=4*vt+3,wt.uint16[At+5]=4*vt+0}return wt})(Ae));const ve=B.createIndexBuffer(Yc,!0),Ue=B.createVertexBuffer(je,o.collisionCircleLayout.members,!0);for(const st of me){const bt={u_matrix:st.transform,u_inv_matrix:st.invTransform,u_camera_to_center_distance:(rt=J).getCameraToCenterDistance(st.projection),u_viewport_size:[rt.width,rt.height]};He.draw(B,G.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,y.colorModeForRenderPass(),o.CullFaceMode.disabled,bt,f.id,Ue,ve,o.SegmentVector.simpleSegment(0,2*st.circleOffset,st.circleArray.length,st.circleArray.length/2),null,J.zoom)}var rt;Ue.destroy(),ve.destroy()}const Lc=o.create();function Jc({width:y,height:a,anchor:f,textOffset:v,textScale:S},T){const{horizontalAlign:R,verticalAlign:B}=o.getAnchorAlignment(f),G=-(R-.5)*y,J=-(B-.5)*a,ee=o.evaluateVariableOffset(f,v);return new o.Point((G/S+ee[0])*T,(J/S+ee[1])*T)}function uu(y,a,f,v,S,T,R,B,G,J,ee){const me=y.text.placedSymbolArray,Ae=y.text.dynamicLayoutVertexArray,Te=y.icon.dynamicLayoutVertexArray,He={},je=y.getProjection(),We=_o(B,je,T),ve=T.elevation,Ue=je.upVectorScale(B.canonical,T.center.lat,T.worldSize).metersToTile;Ae.clear();for(let rt=0;rt<me.length;rt++){const st=me.get(rt),{tileAnchorX:bt,tileAnchorY:wt,numGlyphs:vt}=st,At=st.hidden||!st.crossTileID||y.allowVerticalPlacement&&!st.placedOrientation?null:v[st.crossTileID];if(At){let kt=0,Vt=0,gn=0;if(ve){const Mn=ve?ve.getAtTileOffset(B,bt,wt):0,[cr,kr,er]=je.upVector(B.canonical,bt,wt);kt=Mn*cr*Ue,Vt=Mn*kr*Ue,gn=Mn*er*Ue}let[Ut,un,$t,In]=Qi(st.projectedAnchorX+kt,st.projectedAnchorY+Vt,st.projectedAnchorZ+gn,f?We:R);const jt=Au(T.getCameraToCenterDistance(je),In);let sn=S.evaluateSizeForFeature(y.textSizeData,J,st)*jt/o.ONE_EM;f&&(sn*=y.tilePixelRatio/G);const Cn=Jc(At,sn);f?({x:Ut,y:un,z:$t}=je.projectTilePoint(bt+Cn.x,wt+Cn.y,B.canonical),[Ut,un,$t]=Qi(Ut+kt,un+Vt,$t+gn,R)):(a&&Cn._rotate(-T.angle),Ut+=Cn.x,un+=Cn.y,$t=0);const _n=y.allowVerticalPlacement&&st.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Mn=0;Mn<vt;Mn++)o.addDynamicAttributes(Ae,Ut,un,$t,_n);ee&&st.associatedIconIndex>=0&&(He[st.associatedIconIndex]={x:Ut,y:un,z:$t,angle:_n})}else fa(vt,Ae)}if(ee){Te.clear();const rt=y.icon.placedSymbolArray;for(let st=0;st<rt.length;st++){const bt=rt.get(st),{numGlyphs:wt}=bt,vt=He[st];if(bt.hidden||!vt)fa(wt,Te);else{const{x:At,y:kt,z:Vt,angle:gn}=vt;for(let Ut=0;Ut<wt;Ut++)o.addDynamicAttributes(Te,At,kt,Vt,gn)}}y.icon.dynamicLayoutVertexBuffer.updateData(Te)}y.text.dynamicLayoutVertexBuffer.updateData(Ae)}function Qc(y,a,f){return f.iconsInText&&a?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function $l(y,a,f,v,S,T,R,B,G,J,ee,me){const Ae=y.context,Te=Ae.gl,He=y.transform,je=B==="map",We=G==="map",ve=je&&f.layout.get("symbol-placement")!=="point",Ue=je&&!We&&!ve,rt=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let st=!1;const bt=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),wt=[o.mercatorXfromLng(He.center.lng),o.mercatorYfromLat(He.center.lat)],vt=f.layout.get("text-variable-anchor"),At=He.projection.name==="globe",kt=[],Vt=[0,-1,0];let gn=Vt;!At&&!He.mercatorFromTransition||je||(gn=(function(Ut){const un=Ut._camera.getWorldToCamera(Ut.worldSize,1),$t=o.multiply([],un,Ut.globeMatrix);o.invert($t,$t);const In=[0,0,0],jt=[0,1,0,0];return o.transformMat4$1(jt,jt,$t),In[0]=jt[0],In[1]=jt[1],In[2]=jt[2],o.normalize(In,In),In})(He));for(const Ut of v){const un=a.getTile(Ut),$t=un.getBucket(f);if(!$t||$t.projection.name==="mercator"&&At)continue;const In=S?$t.text:$t.icon;if(!In||$t.fullyClipped||!In.segments.get().length)continue;const jt=In.programConfigurations.get(f.id),sn=S||$t.sdfIcons,Cn=S?$t.textSizeData:$t.iconSizeData,_n=We||He.pitch!==0,Mn=o.evaluateSizeForZoom(Cn,He.zoom);let cr,kr,er,ar,Wr=[0,0],hi=null;if(S)kr=un.glyphAtlasTexture,er=Te.LINEAR,cr=un.glyphAtlasTexture.size,$t.iconsInText&&(Wr=un.imageAtlasTexture.size,hi=un.imageAtlasTexture,ar=_n||y.options.rotating||y.options.zooming||Cn.kind==="composite"||Cn.kind==="camera"?Te.LINEAR:Te.NEAREST);else{const Kl=f.layout.get("icon-size").constantOr(0)!==1||$t.iconsNeedLinear;kr=un.imageAtlasTexture,er=sn||y.options.rotating||y.options.zooming||Kl||_n?Te.LINEAR:Te.NEAREST,cr=un.imageAtlasTexture.size}const _r=$t.projection.name==="globe",Ti=_r?gn:Vt,Ii=_r?o.globeToMercatorTransition(He.zoom):0,yo=_o(Ut,$t.getProjection(),He),co=He.calculatePixelsToTileUnitsMatrix(un),Js=pn(yo,un.tileID.canonical,We,je,He,$t.getProjection(),co),ps=y.terrain&&We&&ve?o.invert(o.create(),Js):Lc,il=as(yo,un.tileID.canonical,We,je,He,$t.getProjection(),co),Wa=vt&&$t.hasTextData(),Si=f.layout.get("icon-text-fit")!=="none"&&Wa&&$t.hasIconData();if(ve){const Kl=He.elevation,ol=Kl?Kl.getAtTileOffsetFunc(Ut,He.center.lat,He.worldSize,$t.getProjection()):null,hc=ss(yo,un.tileID.canonical,We,je,He,$t.getProjection(),co);Za($t,yo,y,S,hc,il,We,J,ol,Ut)}const Ki=ve||S&&vt||Si,to=y.translatePosMatrix(yo,un,T,R),Qs=Ki?Lc:Js,ua=y.translatePosMatrix(il,un,T,R,!0),Wo=$t.getProjection().createInversionMatrix(He,Ut.canonical),vs=[];y.terrainRenderModeElevated()&&We&&vs.push("PITCH_WITH_MAP_TERRAIN"),_r&&vs.push("PROJECTION_GLOBE_VIEW"),Ki&&vs.push("PROJECTED_POS_ON_VIEWPORT");const Fo=sn&&f.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let xs;xs=sn?$t.iconsInText?Cc(Cn.kind,Mn,Ue,We,y,to,Qs,ua,cr,Wr,Ut,Ii,wt,Wo,Ti,$t.getProjection()):Ic(Cn.kind,Mn,Ue,We,y,to,Qs,ua,S,cr,!0,Ut,Ii,wt,Wo,Ti,$t.getProjection()):Ks(Cn.kind,Mn,Ue,We,y,to,Qs,ua,S,cr,Ut,Ii,wt,Wo,Ti,$t.getProjection());const Cs={program:y.useProgram(Qc(sn,S,$t),jt,vs),buffers:In,uniformValues:xs,atlasTexture:kr,atlasTextureIcon:hi,atlasInterpolation:er,atlasInterpolationIcon:ar,isSDF:sn,hasHalo:Fo,tile:un,labelPlaneMatrixInv:ps};if(rt&&$t.canOverlap){st=!0;const Kl=In.segments.get();for(const ol of Kl)kt.push({segments:new o.SegmentVector([ol]),sortKey:ol.sortKey,state:Cs})}else kt.push({segments:In.segments,sortKey:0,state:Cs})}st&&kt.sort(((Ut,un)=>Ut.sortKey-un.sortKey));for(const Ut of kt){const un=Ut.state;if(y.terrain&&y.terrain.setupElevationDraw(un.tile,un.program,{useDepthForOcclusion:!At,labelPlaneMatrixInv:un.labelPlaneMatrixInv}),Ae.activeTexture.set(Te.TEXTURE0),un.atlasTexture.bind(un.atlasInterpolation,Te.CLAMP_TO_EDGE),un.atlasTextureIcon&&(Ae.activeTexture.set(Te.TEXTURE1),un.atlasTextureIcon&&un.atlasTextureIcon.bind(un.atlasInterpolationIcon,Te.CLAMP_TO_EDGE)),un.isSDF){const $t=un.uniformValues;un.hasHalo&&($t.u_is_halo=1,Gl(un.buffers,Ut.segments,f,y,un.program,bt,ee,me,$t)),$t.u_is_halo=0}Gl(un.buffers,Ut.segments,f,y,un.program,bt,ee,me,un.uniformValues)}}function Gl(y,a,f,v,S,T,R,B,G){const J=v.context,ee=[y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer,y.globeExtVertexBuffer];S.draw(J,J.gl.TRIANGLES,T,R,B,o.CullFaceMode.disabled,G,f.id,y.layoutVertexBuffer,y.indexBuffer,a,f.paint,v.transform.zoom,y.programConfigurations.get(f.id),ee)}function ns(y,a,f,v,S,T,R){const B=y.context.gl,G=f.paint.get("fill-pattern"),J=G&&G.constantOr(1);let ee,me,Ae,Te,He;R?(me=J&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ee=B.LINES):(me=J?"fillPattern":"fill",ee=B.TRIANGLES);for(const je of v){const We=a.getTile(je);if(J&&!We.patternsLoaded())continue;const ve=We.getBucket(f);if(!ve)continue;y.prepareDrawTile();const Ue=ve.programConfigurations.get(f.id),rt=y.useProgram(me,Ue);J&&(y.context.activeTexture.set(B.TEXTURE0),We.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Ue.updatePaintBuffers());const st=G.constantOr(null);if(st&&We.imageAtlas){const wt=We.imageAtlas.patternPositions[st.toString()];wt&&Ue.setConstantPatternPositions(wt)}const bt=y.translatePosMatrix(je.projMatrix,We,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(R){Te=ve.indexBuffer2,He=ve.segments2;const wt=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[B.drawingBufferWidth,B.drawingBufferHeight];Ae=me==="fillOutlinePattern"&&J?xo(bt,y,We,wt):Qr(bt,wt)}else Te=ve.indexBuffer,He=ve.segments,Ae=J?Hi(bt,y,We):jo(bt);y.prepareDrawProgram(y.context,rt,je.toUnwrapped()),rt.draw(y.context,ee,S,y.stencilModeForClipping(je),T,o.CullFaceMode.disabled,Ae,f.id,ve.layoutVertexBuffer,Te,He,f.paint,y.transform.zoom,Ue)}}function Ts(y,a,f,v,S,T,R){const B=y.context,G=B.gl,J=y.transform,ee=f.paint.get("fill-extrusion-pattern"),me=ee.constantOr(1),Ae=f.paint.get("fill-extrusion-opacity"),Te=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),f.paint.get("fill-extrusion-ambient-occlusion-radius")],He=f.layout.get("fill-extrusion-edge-radius"),je=He>0&&!f.paint.get("fill-extrusion-rounded-roof"),We=je?0:He,ve=J.projection.name==="globe"?o.fillExtrusionHeightLift():0,Ue=J.projection.name==="globe",rt=Ue?o.globeToMercatorTransition(J.zoom):0,st=[o.mercatorXfromLng(J.center.lng),o.mercatorYfromLat(J.center.lat)],bt=[];Ue&&bt.push("PROJECTION_GLOBE_VIEW"),Te[0]>0&&bt.push("FAUX_AO"),je&&bt.push("ZERO_ROOF_RADIUS");for(const wt of v){const vt=a.getTile(wt),At=vt.getBucket(f);if(!At||At.projection.name!==J.projection.name)continue;const kt=At.programConfigurations.get(f.id),Vt=y.useProgram(me?"fillExtrusionPattern":"fillExtrusion",kt,bt);if(y.terrain){const sn=y.terrain;if(y.style.terrainSetForDrapingOnly())sn.setupElevationDraw(vt,Vt,{useMeterToDem:!0});else{if(!At.enableTerrain)continue;if(sn.setupElevationDraw(vt,Vt,{useMeterToDem:!0}),Li(B,a,wt,At,f,sn),!At.centroidVertexBuffer){const Cn=Vt.attributes.a_centroid_pos;Cn!==void 0&&G.vertexAttrib2f(Cn,0,0)}}}me&&(y.context.activeTexture.set(G.TEXTURE0),vt.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),kt.updatePaintBuffers());const gn=ee.constantOr(null);if(gn&&vt.imageAtlas){const sn=vt.imageAtlas.patternPositions[gn.toString()];sn&&kt.setConstantPatternPositions(sn)}const Ut=y.translatePosMatrix(wt.projMatrix,vt,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),un=J.projection.createInversionMatrix(J,wt.canonical),$t=f.paint.get("fill-extrusion-vertical-gradient"),In=me?mo(Ut,y,$t,Ae,Te,We,wt,vt,ve,rt,st,un):Un(Ut,y,$t,Ae,Te,We,wt,ve,rt,st,un);y.prepareDrawProgram(B,Vt,wt.toUnwrapped());const jt=[];y.terrain&&jt.push(At.centroidVertexBuffer),Ue&&jt.push(At.layoutVertexExtBuffer),Vt.draw(B,B.gl.TRIANGLES,S,T,R,o.CullFaceMode.backCCW,In,f.id,At.layoutVertexBuffer,At.indexBuffer,At.segments,f.paint,y.transform.zoom,kt,jt)}}function Li(y,a,f,v,S,T){const R=[ve=>{let Ue=ve.canonical.x-1,rt=ve.wrap;return Ue<0&&(Ue=(1<<ve.canonical.z)-1,rt--),new o.OverscaledTileID(ve.overscaledZ,rt,ve.canonical.z,Ue,ve.canonical.y)},ve=>{let Ue=ve.canonical.x+1,rt=ve.wrap;return Ue===1<<ve.canonical.z&&(Ue=0,rt++),new o.OverscaledTileID(ve.overscaledZ,rt,ve.canonical.z,Ue,ve.canonical.y)},ve=>new o.OverscaledTileID(ve.overscaledZ,ve.wrap,ve.canonical.z,ve.canonical.x,(ve.canonical.y===0?1<<ve.canonical.z:ve.canonical.y)-1),ve=>new o.OverscaledTileID(ve.overscaledZ,ve.wrap,ve.canonical.z,ve.canonical.x,ve.canonical.y===(1<<ve.canonical.z)-1?0:ve.canonical.y+1)],B=ve=>{const Ue=a.getSource().minzoom,rt=bt=>{const wt=a.getTileByID(bt);if(wt&&wt.hasData())return wt.getBucket(S)},st=[0,-1,1];for(const bt of st){if(ve.overscaledZ+bt<Ue)continue;const wt=rt(ve.calculateScaledKey(ve.overscaledZ+bt));if(wt)return wt}},G=[0,0,0],J=(ve,Ue)=>(G[0]=Math.min(ve.min.y,Ue.min.y),G[1]=Math.max(ve.max.y,Ue.max.y),G[2]=o.EXTENT-Ue.min.x>ve.max.x?Ue.min.x-o.EXTENT:ve.max.x,G),ee=(ve,Ue)=>(G[0]=Math.min(ve.min.x,Ue.min.x),G[1]=Math.max(ve.max.x,Ue.max.x),G[2]=o.EXTENT-Ue.min.y>ve.max.y?Ue.min.y-o.EXTENT:ve.max.y,G),me=[(ve,Ue)=>J(ve,Ue),(ve,Ue)=>J(Ue,ve),(ve,Ue)=>ee(ve,Ue),(ve,Ue)=>ee(Ue,ve)],Ae=new o.Point(0,0);let Te,He,je;const We=(ve,Ue,rt,st,bt)=>{const wt=[[st?rt:ve,st?ve:rt,0],[st?rt:Ue,st?Ue:rt,0]],vt=bt<0?o.EXTENT+bt:bt,At=[st?vt:(ve+Ue)/2,st?(ve+Ue)/2:vt,0];return rt===0&&bt<0||rt!==0&&bt>0?T.getForTilePoints(je,[At],!0,He):wt.push(At),T.getForTilePoints(f,wt,!0,Te),Math.max(wt[0][2],wt[1][2],At[2])/T.exaggeration()};for(let ve=0;ve<4;ve++){const Ue=(ve<2?1:5)-ve,rt=v.borders[ve];if(rt.length===0)continue;const st=je=R[ve](f),bt=B(st);if(!(bt&&bt instanceof o.FillExtrusionBucket&&bt.enableTerrain)||v.borderDoneWithNeighborZ[ve]===bt.canonical.z&&bt.borderDoneWithNeighborZ[Ue]===v.canonical.z||(He=T.findDEMTileFor(st),!He||!He.dem))continue;if(!Te){const kt=T.findDEMTileFor(f);if(!kt||!kt.dem)return;Te=kt}const wt=bt.borders[Ue];let vt=0;const At=bt.borderDoneWithNeighborZ[Ue]!==v.canonical.z;if(v.canonical.z===bt.canonical.z){for(let kt=0;kt<rt.length;kt++){const Vt=v.featuresOnBorder[rt[kt]],gn=Vt.borders[ve];let Ut;for(;vt<wt.length&&(Ut=bt.featuresOnBorder[wt[vt]],!(Ut.borders[Ue][1]>gn[0]+3));)At&&bt.encodeCentroid(void 0,Ut,!1),vt++;if(Ut&&vt<wt.length){const un=vt;let $t=0;for(;!(Ut.borders[Ue][0]>gn[1]-3)&&($t++,++vt!==wt.length);)Ut=bt.featuresOnBorder[wt[vt]];if(Ut=bt.featuresOnBorder[wt[un]],Vt.intersectsCount()>1||Ut.intersectsCount()>1||$t!==1){$t!==1&&(vt=un),v.encodeCentroid(void 0,Vt,!1),At&&bt.encodeCentroid(void 0,Ut,!1);continue}const In=me[ve](Vt,Ut),jt=ve%2?o.EXTENT-1:0;Ae.x=We(In[0],Math.min(o.EXTENT-1,In[1]),jt,ve<2,In[2]),Ae.y=0,v.encodeCentroid(Ae,Vt,!1),At&&bt.encodeCentroid(Ae,Ut,!1)}else v.encodeCentroid(void 0,Vt,!1)}v.borderDoneWithNeighborZ[ve]=bt.canonical.z,v.needsCentroidUpdate=!0,At&&(bt.borderDoneWithNeighborZ[Ue]=v.canonical.z,bt.needsCentroidUpdate=!0)}else{for(const kt of rt)v.encodeCentroid(void 0,v.featuresOnBorder[kt],!1);if(At){for(const kt of wt)bt.encodeCentroid(void 0,bt.featuresOnBorder[kt],!1);bt.borderDoneWithNeighborZ[Ue]=v.canonical.z,bt.needsCentroidUpdate=!0}v.borderDoneWithNeighborZ[ve]=bt.canonical.z,v.needsCentroidUpdate=!0}}(v.needsCentroidUpdate||!v.centroidVertexBuffer&&v.centroidVertexArray.length!==0)&&v.uploadCentroid(y)}const Io=new o.Color(1,0,0,1),yr=new o.Color(0,1,0,1),la=new o.Color(0,0,1,1),oc=new o.Color(1,0,1,1),sc=new o.Color(0,1,1,1);function Il(y,a,f){const v=y.context,S=y.transform,T=v.gl,R=S.projection.name==="globe",B=R?["PROJECTION_GLOBE_VIEW"]:null;let G=f.projMatrix;if(R&&o.globeToMercatorTransition(S.zoom)>0){const Vt=o.transitionTileAABBinECEF(f.canonical,S),gn=o.globeDenormalizeECEF(Vt);G=o.multiply(new Float32Array(16),S.globeMatrix,gn),o.multiply(G,S.projMatrix,G)}const J=y.useProgram("debug",null,B),ee=a.getTileByID(f.key);y.terrain&&y.terrain.setupElevationDraw(ee,J);const me=o.DepthMode.disabled,Ae=o.StencilMode.disabled,Te=y.colorModeForRenderPass(),He="$debug";v.activeTexture.set(T.TEXTURE0),y.emptyTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),R?ee._makeGlobeTileDebugBuffers(y.context,S):ee._makeDebugTileBoundsBuffers(y.context,S.projection);const je=ee._tileDebugBuffer||y.debugBuffer,We=ee._tileDebugIndexBuffer||y.debugIndexBuffer,ve=ee._tileDebugSegments||y.debugSegments;J.draw(v,T.LINE_STRIP,me,Ae,Te,o.CullFaceMode.disabled,Ua(G,o.Color.red),He,je,We,ve,null,null,null,[ee._globeTileDebugBorderBuffer]);const Ue=ee.latestRawTileData,rt=Math.floor((Ue&&Ue.byteLength||0)/1024),st=a.getTile(f).tileSize,bt=512/Math.min(st,512)*(f.overscaledZ/S.zoom)*.5;let wt=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(wt+=` => ${f.overscaledZ}`),wt+=` ${rt}kb`,(function(Vt,gn){Vt.initDebugOverlayCanvas();const Ut=Vt.debugOverlayCanvas,un=Vt.context.gl,$t=Vt.debugOverlayCanvas.getContext("2d");$t.clearRect(0,0,Ut.width,Ut.height),$t.shadowColor="white",$t.shadowBlur=2,$t.lineWidth=1.5,$t.strokeStyle="white",$t.textBaseline="top",$t.font="bold 36px Open Sans, sans-serif",$t.fillText(gn,5,5),$t.strokeText(gn,5,5),Vt.debugOverlayTexture.update(Ut),Vt.debugOverlayTexture.bind(un.LINEAR,un.CLAMP_TO_EDGE)})(y,wt);const vt=ee._tileDebugTextBuffer||y.debugBuffer,At=ee._tileDebugTextIndexBuffer||y.quadTriangleIndexBuffer,kt=ee._tileDebugTextSegments||y.debugSegments;J.draw(v,T.TRIANGLES,me,Ae,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,Ua(G,o.Color.transparent,bt),He,vt,At,kt,null,null,null,[ee._globeTileDebugTextBuffer])}function hu(y,a,f,v){nl(y,0,a+f/2,y.transform.width,f,v)}function ac(y,a,f,v){nl(y,a-f/2,0,f,y.transform.height,v)}function nl(y,a,f,v,S,T){const R=y.context,B=R.gl;B.enable(B.SCISSOR_TEST),B.scissor(a*o.exported.devicePixelRatio,f*o.exported.devicePixelRatio,v*o.exported.devicePixelRatio,S*o.exported.devicePixelRatio),R.clear({color:T}),B.disable(B.SCISSOR_TEST)}const Ur=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Wl}=Ur;function Zs(y,a,f,v){y.emplaceBack(a,f,v)}class eu{constructor(a){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Zs(this.vertexArray,-1,-1,1),Zs(this.vertexArray,1,-1,1),Zs(this.vertexArray,-1,1,1),Zs(this.vertexArray,1,1,1),Zs(this.vertexArray,-1,-1,-1),Zs(this.vertexArray,1,-1,-1),Zs(this.vertexArray,-1,1,-1),Zs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Wl),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function ga(y,a,f,v,S,T){const R=y.gl,B=a.paint.get("sky-atmosphere-color"),G=a.paint.get("sky-atmosphere-halo-color"),J=a.paint.get("sky-atmosphere-sun-intensity"),ee=((me,Ae,Te,He,je)=>({u_matrix_3f:me,u_sun_direction:Ae,u_sun_intensity:Te,u_color_tint_r:[He.r,He.g,He.b,He.a],u_color_tint_m:[je.r,je.g,je.b,je.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),v),S,J,B,G);R.framebufferTexture2D(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.TEXTURE_CUBE_MAP_POSITIVE_X+T,a.skyboxTexture,0),f.draw(y,R.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,ee,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const du=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Iu{constructor(a){const f=new o.StructArrayLayout5f20;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const v=new o.StructArrayLayout3ui6;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(f,du.members),this.indexBuffer=a.createIndexBuffer(v),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ai={symbol:function(y,a,f,v,S){if(y.renderPass!=="translucent")return;const T=o.StencilMode.disabled,R=y.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&(function(B,G,J,ee,me,Ae,Te){const He=G.transform,je=me==="map",We=Ae==="map";for(const ve of B){const Ue=ee.getTile(ve),rt=Ue.getBucket(J);if(!rt||!rt.text||!rt.text.segments.get().length)continue;const st=o.evaluateSizeForZoom(rt.textSizeData,He.zoom),bt=_o(ve,rt.getProjection(),He),wt=He.calculatePixelsToTileUnitsMatrix(Ue),vt=pn(bt,Ue.tileID.canonical,We,je,He,rt.getProjection(),wt),At=J.layout.get("icon-text-fit")!=="none"&&rt.hasIconData();if(st){const kt=Math.pow(2,He.zoom-Ue.tileID.overscaledZ);uu(rt,je,We,Te,o.symbolSize,He,vt,ve,kt,st,At)}}})(v,y,f,a,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),S),f.paint.get("icon-opacity").constantOr(1)!==0&&$l(y,a,f,v,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),T,R),f.paint.get("text-opacity").constantOr(1)!==0&&$l(y,a,f,v,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),T,R),a.map.showCollisionBoxes&&(cu(y,a,f,v,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),cu(y,a,f,v,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(y,a,f,v){if(y.renderPass!=="translucent")return;const S=f.paint.get("circle-opacity"),T=f.paint.get("circle-stroke-width"),R=f.paint.get("circle-stroke-opacity"),B=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)===0&&(T.constantOr(1)===0||R.constantOr(1)===0))return;const G=y.context,J=G.gl,ee=y.transform,me=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),Ae=o.StencilMode.disabled,Te=y.colorModeForRenderPass(),He=ee.projection.name==="globe",je=[o.mercatorXfromLng(ee.center.lng),o.mercatorYfromLat(ee.center.lat)],We=[];for(let Ue=0;Ue<v.length;Ue++){const rt=v[Ue],st=a.getTile(rt),bt=st.getBucket(f);if(!bt||bt.projection.name!==ee.projection.name)continue;const wt=bt.programConfigurations.get(f.id),vt=Rs(f);He&&vt.push("PROJECTION_GLOBE_VIEW");const At=y.useProgram("circle",wt,vt),kt=bt.layoutVertexBuffer,Vt=bt.globeExtVertexBuffer,gn=bt.indexBuffer,Ut=ee.projection.createInversionMatrix(ee,rt.canonical),un={programConfiguration:wt,program:At,layoutVertexBuffer:kt,globeExtVertexBuffer:Vt,indexBuffer:gn,uniformValues:pa(y,rt,st,Ut,je,f),tile:st};if(B){const $t=bt.segments.get();for(const In of $t)We.push({segments:new o.SegmentVector([In]),sortKey:In.sortKey,state:un})}else We.push({segments:bt.segments,sortKey:0,state:un})}B&&We.sort(((Ue,rt)=>Ue.sortKey-rt.sortKey));const ve={useDepthForOcclusion:!He};for(const Ue of We){const{programConfiguration:rt,program:st,layoutVertexBuffer:bt,globeExtVertexBuffer:wt,indexBuffer:vt,uniformValues:At,tile:kt}=Ue.state,Vt=Ue.segments;y.terrain&&y.terrain.setupElevationDraw(kt,st,ve),y.prepareDrawProgram(G,st,kt.tileID.toUnwrapped()),st.draw(G,J.TRIANGLES,me,Ae,Te,o.CullFaceMode.disabled,At,f.id,bt,vt,Vt,f.paint,ee.zoom,rt,[wt])}},heatmap:function(y,a,f,v){if(f.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const S=y.context,T=S.gl,R=o.StencilMode.disabled,B=new o.ColorMode([T.ONE,T.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(Te,He,je,We){const ve=Te.gl,Ue=He.width*We,rt=He.height*We;Te.activeTexture.set(ve.TEXTURE1),Te.viewport.set([0,0,Ue,rt]);let st=je.heatmapFbo;if(!st||st&&(st.width!==Ue||st.height!==rt)){st&&st.destroy();const bt=ve.createTexture();ve.bindTexture(ve.TEXTURE_2D,bt),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_WRAP_S,ve.CLAMP_TO_EDGE),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_WRAP_T,ve.CLAMP_TO_EDGE),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_MIN_FILTER,ve.LINEAR),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_MAG_FILTER,ve.LINEAR),st=je.heatmapFbo=Te.createFramebuffer(Ue,rt,!1),(function(wt,vt,At,kt,Vt,gn){const Ut=wt.gl;Ut.texImage2D(Ut.TEXTURE_2D,0,wt.isWebGL2&&wt.extRenderToTextureHalfFloat?Ut.RGBA16F:Ut.RGBA,Vt,gn,0,Ut.RGBA,wt.extRenderToTextureHalfFloat?wt.isWebGL2?Ut.HALF_FLOAT:wt.extTextureHalfFloat.HALF_FLOAT_OES:Ut.UNSIGNED_BYTE,null),kt.colorAttachment.set(At)})(Te,0,bt,st,Ue,rt)}else ve.bindTexture(ve.TEXTURE_2D,st.colorAttachment.get()),Te.bindFramebuffer.set(st.framebuffer)})(S,y,f,y.transform.projection.name==="globe"?.5:.25),S.clear({color:o.Color.transparent});const G=y.transform,J=G.projection.name==="globe",ee=J?["PROJECTION_GLOBE_VIEW"]:null,me=J?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,Ae=[o.mercatorXfromLng(G.center.lng),o.mercatorYfromLat(G.center.lat)];for(let Te=0;Te<v.length;Te++){const He=v[Te];if(a.hasRenderableParent(He))continue;const je=a.getTile(He),We=je.getBucket(f);if(!We||We.projection.name!==G.projection.name)continue;const ve=We.programConfigurations.get(f.id),Ue=y.useProgram("heatmap",ve,ee),{zoom:rt}=y.transform;y.terrain&&y.terrain.setupElevationDraw(je,Ue),y.prepareDrawProgram(S,Ue,He.toUnwrapped());const st=G.projection.createInversionMatrix(G,He.canonical);Ue.draw(S,T.TRIANGLES,o.DepthMode.disabled,R,B,me,ml(y,He,je,st,Ae,rt,f.paint.get("heatmap-intensity")),f.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,f.paint,y.transform.zoom,ve,J?[We.globeExtVertexBuffer]:null)}S.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),(function(S,T){const R=S.context,B=R.gl,G=T.heatmapFbo;if(!G)return;R.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,G.colorAttachment.get()),R.activeTexture.set(B.TEXTURE1);let J=T.colorRampTexture;J||(J=T.colorRampTexture=new o.Texture(R,T.colorRamp,B.RGBA)),J.bind(B.LINEAR,B.CLAMP_TO_EDGE),S.useProgram("heatmapTexture").draw(R,B.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,S.colorModeForRenderPass(),o.CullFaceMode.disabled,((ee,me,Ae,Te)=>({u_image:0,u_color_ramp:1,u_opacity:me.paint.get("heatmap-opacity")}))(0,T),T.id,S.viewportBuffer,S.quadTriangleIndexBuffer,S.viewportSegments,T.paint,S.transform.zoom)})(y,f))},line:function(y,a,f,v){if(y.renderPass!=="translucent")return;const S=f.paint.get("line-opacity"),T=f.paint.get("line-width");if(S.constantOr(1)===0||T.constantOr(1)===0)return;const R=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),B=y.colorModeForRenderPass(),G=y.terrain&&y.terrain.renderingToTexture?1:o.exported.devicePixelRatio,J=f.paint.get("line-dasharray"),ee=J.constantOr(1),me=f.layout.get("line-cap"),Ae=f.paint.get("line-pattern"),Te=Ae.constantOr(1),He=f.paint.get("line-gradient"),je=Te?"linePattern":"line",We=y.context,ve=We.gl,Ue=(st=>{const bt=[];Uo(st)&&bt.push("RENDER_LINE_DASH"),st.paint.get("line-gradient")&&bt.push("RENDER_LINE_GRADIENT");const wt=st.paint.get("line-trim-offset");wt[0]===0&&wt[1]===0||bt.push("RENDER_LINE_TRIM_OFFSET");const vt=st.paint.get("line-pattern").constantOr(1),At=st.paint.get("line-opacity").constantOr(1)!==1;return!vt&&At&&bt.push("RENDER_LINE_ALPHA_DISCARD"),bt})(f);let rt=Ue.includes("RENDER_LINE_ALPHA_DISCARD");y.terrain&&y.terrain.clipOrMaskOverlapStencilType()&&(rt=!1);for(const st of v){const bt=a.getTile(st);if(Te&&!bt.patternsLoaded())continue;const wt=bt.getBucket(f);if(!wt)continue;y.prepareDrawTile();const vt=wt.programConfigurations.get(f.id),At=y.useProgram(je,vt,Ue),kt=Ae.constantOr(null);if(kt&&bt.imageAtlas){const sn=bt.imageAtlas.patternPositions[kt.toString()];sn&&vt.setConstantPatternPositions(sn)}const Vt=J.constantOr(null),gn=me.constantOr(null);if(!Te&&Vt&&gn&&bt.lineAtlas){const sn=bt.lineAtlas.getDash(Vt,gn);sn&&vt.setConstantPatternPositions(sn)}let[Ut,un]=f.paint.get("line-trim-offset");(gn==="round"||gn==="square")&&Ut!==un&&(Ut===0&&(Ut-=1),un===1&&(un+=1));const $t=y.terrain?st.projMatrix:null,In=Te?ma(y,bt,f,$t,G):Qa(y,bt,f,$t,wt.lineClipsArray.length,G,[Ut,un]);if(He){const sn=wt.gradients[f.id];let Cn=sn.texture;if(f.gradientVersion!==sn.version){let _n=256;if(f.stepInterpolant){const Mn=a.getSource().maxzoom,cr=st.canonical.z===Mn?Math.ceil(1<<y.transform.maxZoom-st.canonical.z):1;_n=o.clamp(o.nextPowerOfTwo(wt.maxLineLength/o.EXTENT*1024*cr),256,We.maxTextureSize)}sn.gradient=o.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:_n,image:sn.gradient||void 0,clips:wt.lineClipsArray}),sn.texture?sn.texture.update(sn.gradient):sn.texture=new o.Texture(We,sn.gradient,ve.RGBA),sn.version=f.gradientVersion,Cn=sn.texture}We.activeTexture.set(ve.TEXTURE1),Cn.bind(f.stepInterpolant?ve.NEAREST:ve.LINEAR,ve.CLAMP_TO_EDGE)}ee&&(We.activeTexture.set(ve.TEXTURE0),bt.lineAtlasTexture.bind(ve.LINEAR,ve.REPEAT),vt.updatePaintBuffers()),Te&&(We.activeTexture.set(ve.TEXTURE0),bt.imageAtlasTexture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),vt.updatePaintBuffers()),y.prepareDrawProgram(We,At,st.toUnwrapped());const jt=sn=>{At.draw(We,ve.TRIANGLES,R,sn,B,o.CullFaceMode.disabled,In,f.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,f.paint,y.transform.zoom,vt,[wt.layoutVertexBuffer2])};if(rt){const sn=y.stencilModeForClipping(st).ref;sn===0&&y.terrain&&We.clear({stencil:0});const Cn={func:ve.EQUAL,mask:255};In.u_alpha_discard_threshold=.8,jt(new o.StencilMode(Cn,sn,255,ve.KEEP,ve.KEEP,ve.INVERT)),In.u_alpha_discard_threshold=0,jt(new o.StencilMode(Cn,sn,255,ve.KEEP,ve.KEEP,ve.KEEP))}else jt(y.stencilModeForClipping(st))}rt&&(y.resetStencilClippingMasks(),y.terrain&&We.clear({stencil:0}))},fill:function(y,a,f,v){const S=f.paint.get("fill-color"),T=f.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const R=y.colorModeForRenderPass(),B=f.paint.get("fill-pattern"),G=y.opaquePassEnabledForLayer()&&!B.constantOr(1)&&S.constantOr(o.Color.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===G){const J=y.depthModeForSublayer(1,y.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);ns(y,a,f,v,J,R,!1)}if(y.renderPass==="translucent"&&f.paint.get("fill-antialias")){const J=y.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);ns(y,a,f,v,J,R,!0)}},"fill-extrusion":function(y,a,f,v){const S=f.paint.get("fill-extrusion-opacity");if(S!==0&&y.renderPass==="translucent"){const T=new o.DepthMode(y.context.gl.LEQUAL,o.DepthMode.ReadWrite,y.depthRangeFor3D);if(S!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))Ts(y,a,f,v,T,o.StencilMode.disabled,o.ColorMode.disabled),Ts(y,a,f,v,T,y.stencilModeFor3D(),y.colorModeForRenderPass()),y.resetStencilClippingMasks();else{const R=y.colorModeForRenderPass();Ts(y,a,f,v,T,o.StencilMode.disabled,R)}}},hillshade:function(y,a,f,v){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const S=y.context,T=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),R=y.colorModeForRenderPass(),B=y.terrain&&y.terrain.renderingToTexture,[G,J]=y.renderPass!=="translucent"||B?[{},v]:y.stencilConfigForOverlap(v);for(const ee of J){const me=a.getTile(ee);if(me.needsHillshadePrepare&&y.renderPass==="offscreen")xi(y,me,f,T,o.StencilMode.disabled,R);else if(y.renderPass==="translucent"){const Ae=B&&y.terrain?y.terrain.stencilModeForRTTOverlap(ee):G[ee.overscaledZ];$r(y,ee,me,f,T,Ae,R)}}S.viewport.set([0,0,y.width,y.height]),y.resetStencilClippingMasks()},raster:function(y,a,f,v,S,T){if(y.renderPass!=="translucent"||f.paint.get("raster-opacity")===0||!v.length)return;const R=y.context,B=R.gl,G=a.getSource(),J=y.useProgram("raster"),ee=y.colorModeForRenderPass(),me=y.terrain&&y.terrain.renderingToTexture,[Ae,Te]=G instanceof Cr||me?[{},v]:y.stencilConfigForOverlap(v),He=Te[Te.length-1].overscaledZ,je=!y.options.moving;for(const We of Te){const ve=me?o.DepthMode.disabled:y.depthModeForSublayer(We.overscaledZ-He,f.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,B.LESS),Ue=We.toUnwrapped(),rt=a.getTile(We);if(me&&(!rt||!rt.hasData()))continue;const st=me?We.projMatrix:y.transform.calculateProjMatrix(Ue,je),bt=y.terrain&&me?y.terrain.stencilModeForRTTOverlap(We):Ae[We.overscaledZ],wt=T?0:f.paint.get("raster-fade-duration");rt.registerFadeDuration(wt);const vt=a.findLoadedParent(We,0),At=Ja(rt,vt,a,y.transform,wt);let kt,Vt;y.terrain&&y.terrain.prepareDrawTile();const gn=f.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;R.activeTexture.set(B.TEXTURE0),rt.texture.bind(gn,B.CLAMP_TO_EDGE),R.activeTexture.set(B.TEXTURE1),vt?(vt.texture.bind(gn,B.CLAMP_TO_EDGE),kt=Math.pow(2,vt.tileID.overscaledZ-rt.tileID.overscaledZ),Vt=[rt.tileID.canonical.x*kt%1,rt.tileID.canonical.y*kt%1]):rt.texture.bind(gn,B.CLAMP_TO_EDGE),rt.texture.useMipmap&&R.extTextureFilterAnisotropic&&y.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const Ut=au(st,Vt||[0,0],kt||1,At,f,G instanceof Cr?G.perspectiveTransform:[0,0]);if(y.prepareDrawProgram(R,J,Ue),G instanceof Cr)G.boundsBuffer&&G.boundsSegments&&J.draw(R,B.TRIANGLES,ve,o.StencilMode.disabled,ee,o.CullFaceMode.disabled,Ut,f.id,G.boundsBuffer,y.quadTriangleIndexBuffer,G.boundsSegments);else{const{tileBoundsBuffer:un,tileBoundsIndexBuffer:$t,tileBoundsSegments:In}=y.getTileBoundsBuffers(rt);J.draw(R,B.TRIANGLES,ve,bt,ee,o.CullFaceMode.disabled,Ut,f.id,un,$t,In)}}y.resetStencilClippingMasks()},background:function(y,a,f,v){const S=f.paint.get("background-color"),T=f.paint.get("background-opacity");if(T===0)return;const R=y.context,B=R.gl,G=y.transform,J=G.tileSize,ee=f.paint.get("background-pattern");if(y.isPatternMissing(ee))return;const me=!ee&&S.a===1&&T===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==me)return;const Ae=o.StencilMode.disabled,Te=y.depthModeForSublayer(0,me==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),He=y.colorModeForRenderPass(),je=y.useProgram(ee?"backgroundPattern":"background");let We,ve=v;ve||(We=y.getBackgroundTiles(),ve=Object.values(We).map((Ue=>Ue.tileID))),ee&&(R.activeTexture.set(B.TEXTURE0),y.imageManager.bind(y.context));for(const Ue of ve){const rt=Ue.toUnwrapped(),st=v?Ue.projMatrix:y.transform.calculateProjMatrix(rt);y.prepareDrawTile();const bt=a?a.getTile(Ue):We?We[Ue.key]:new o.Tile(Ue,J,G.zoom,y),wt=ee?Zc(st,T,y,ee,{tileID:Ue,tileSize:J}):ql(st,T,S);y.prepareDrawProgram(R,je,rt);const{tileBoundsBuffer:vt,tileBoundsIndexBuffer:At,tileBoundsSegments:kt}=y.getTileBoundsBuffers(bt);je.draw(R,B.TRIANGLES,Te,Ae,He,o.CullFaceMode.disabled,wt,f.id,vt,At,kt)}},sky:function(y,a,f){const v=y.transform,S=v.projection.name==="mercator"||v.projection.name==="globe"?1:o.smoothstep(7,8,v.zoom),T=f.paint.get("sky-opacity")*S;if(T===0)return;const R=y.context,B=f.paint.get("sky-type"),G=new o.DepthMode(R.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),J=y.frameCounter/1e3%1;B==="atmosphere"?y.renderPass==="offscreen"?f.needsSkyboxCapture(y)&&((function(ee,me,Ae,Te){const He=ee.context,je=He.gl;let We=me.skyboxFbo;if(!We){We=me.skyboxFbo=He.createFramebuffer(32,32,!1),me.skyboxGeometry=new eu(He),me.skyboxTexture=He.gl.createTexture(),je.bindTexture(je.TEXTURE_CUBE_MAP,me.skyboxTexture),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_WRAP_S,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_WRAP_T,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_MIN_FILTER,je.LINEAR),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_MAG_FILTER,je.LINEAR);for(let st=0;st<6;++st)je.texImage2D(je.TEXTURE_CUBE_MAP_POSITIVE_X+st,0,je.RGBA,32,32,0,je.RGBA,je.UNSIGNED_BYTE,null)}He.bindFramebuffer.set(We.framebuffer),He.viewport.set([0,0,32,32]);const ve=me.getCenter(ee,!0),Ue=ee.useProgram("skyboxCapture"),rt=new Float64Array(16);o.identity(rt),o.rotateY(rt,rt,.5*-Math.PI),ga(He,me,Ue,rt,ve,0),o.identity(rt),o.rotateY(rt,rt,.5*Math.PI),ga(He,me,Ue,rt,ve,1),o.identity(rt),o.rotateX(rt,rt,.5*-Math.PI),ga(He,me,Ue,rt,ve,2),o.identity(rt),o.rotateX(rt,rt,.5*Math.PI),ga(He,me,Ue,rt,ve,3),o.identity(rt),ga(He,me,Ue,rt,ve,4),o.identity(rt),o.rotateY(rt,rt,Math.PI),ga(He,me,Ue,rt,ve,5),He.viewport.set([0,0,ee.width,ee.height])})(y,f),f.markSkyboxValid(y)):y.renderPass==="sky"&&(function(ee,me,Ae,Te,He){const je=ee.context,We=je.gl,ve=ee.transform,Ue=ee.useProgram("skybox");je.activeTexture.set(We.TEXTURE0),We.bindTexture(We.TEXTURE_CUBE_MAP,me.skyboxTexture);const rt=((st,bt,wt,vt,At)=>({u_matrix:st,u_sun_direction:bt,u_cubemap:0,u_opacity:vt,u_temporal_offset:At}))(ve.skyboxMatrix,me.getCenter(ee,!1),0,Te,He);ee.prepareDrawProgram(je,Ue),Ue.draw(je,We.TRIANGLES,Ae,o.StencilMode.disabled,ee.colorModeForRenderPass(),o.CullFaceMode.backCW,rt,"skybox",me.skyboxGeometry.vertexBuffer,me.skyboxGeometry.indexBuffer,me.skyboxGeometry.segment)})(y,f,G,T,J):B==="gradient"&&y.renderPass==="sky"&&(function(ee,me,Ae,Te,He){const je=ee.context,We=je.gl,ve=ee.transform,Ue=ee.useProgram("skyboxGradient");me.skyboxGeometry||(me.skyboxGeometry=new eu(je)),je.activeTexture.set(We.TEXTURE0);let rt=me.colorRampTexture;rt||(rt=me.colorRampTexture=new o.Texture(je,me.colorRamp,We.RGBA)),rt.bind(We.LINEAR,We.CLAMP_TO_EDGE);const st=((bt,wt,vt,At,kt)=>({u_matrix:bt,u_color_ramp:0,u_center_direction:wt,u_radius:o.degToRad(vt),u_opacity:At,u_temporal_offset:kt}))(ve.skyboxMatrix,me.getCenter(ee,!1),me.paint.get("sky-gradient-radius"),Te,He);ee.prepareDrawProgram(je,Ue),Ue.draw(je,We.TRIANGLES,Ae,o.StencilMode.disabled,ee.colorModeForRenderPass(),o.CullFaceMode.backCW,st,"skyboxGradient",me.skyboxGeometry.vertexBuffer,me.skyboxGeometry.indexBuffer,me.skyboxGeometry.segment)})(y,f,G,T,J)},debug:function(y,a,f){for(let v=0;v<f.length;v++)Il(y,a,f[v])},custom:function(y,a,f,v){const S=y.context,T=f.implementation;if(!y.transform.projection.unsupportedLayers||!y.transform.projection.unsupportedLayers.includes("custom")||y.terrain&&(y.terrain.renderingToTexture||y.renderPass==="offscreen")&&f.isLayerDraped()){if(y.renderPass==="offscreen"){const R=T.prerender;if(R){if(y.setCustomLayerDefaults(),S.setColorMode(y.colorModeForRenderPass()),y.transform.projection.name==="globe"){const B=y.transform.pointMerc;R.call(T,S.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(y.transform.zoom),[B.x,B.y],y.transform.pixelsPerMeterRatio)}else R.call(T,S.gl,y.transform.customLayerMatrix());S.setDirty(),y.setBaseState()}}else if(y.renderPass==="translucent"){if(y.terrain&&y.terrain.renderingToTexture){const B=T.renderToTile;if(B){const G=v[0].canonical,J=new o.MercatorCoordinate(G.x+v[0].wrap*(1<<G.z),G.y,G.z);S.setDepthMode(o.DepthMode.disabled),S.setStencilMode(o.StencilMode.disabled),S.setColorMode(y.colorModeForRenderPass()),y.setCustomLayerDefaults(),B.call(T,S.gl,J),S.setDirty(),y.setBaseState()}return}y.setCustomLayerDefaults(),S.setColorMode(y.colorModeForRenderPass()),S.setStencilMode(o.StencilMode.disabled);const R=T.renderingMode==="3d"?new o.DepthMode(y.context.gl.LEQUAL,o.DepthMode.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,o.DepthMode.ReadOnly);if(S.setDepthMode(R),y.transform.projection.name==="globe"){const B=y.transform.pointMerc;T.render(S.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(y.transform.zoom),[B.x,B.y],y.transform.pixelsPerMeterRatio)}else T.render(S.gl,y.transform.customLayerMatrix());S.setDirty(),y.setBaseState(),S.bindFramebuffer.set(null)}}else o.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ra{constructor(a,f,v=!1){this.context=new vn(a,v),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,f){const v=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new _e(this,a));const S=this._terrain;this.transform.elevation=v?S:null,S.update(a,this.transform,f)}_updateFog(a){const f=a.fog;if(!f||this.transform.projection.name==="globe"||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,S]=f.getFovAdjustedRange(this.transform._fov);if(v>S)return void(this.transform.fogCullDistSq=null);const T=v+.78*(S-v);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,f){if(this.width=a*o.exported.devicePixelRatio,this.height=f*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._layers[v].resize()}setup(){const a=this.context,f=new o.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(o.EXTENT,0),f.emplaceBack(0,o.EXTENT),f.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(f,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const v=new o.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(o.EXTENT,0),v.emplaceBack(0,o.EXTENT),v.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=a.createVertexBuffer(v,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const S=new o.StructArrayLayout2i4;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(-1,1),S.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(S,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const T=new o.StructArrayLayout4i8;T.emplaceBack(0,0,0,0),T.emplaceBack(o.EXTENT,0,o.EXTENT,0),T.emplaceBack(0,o.EXTENT,0,o.EXTENT),T.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(T,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const R=new o.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(R);const B=new o.StructArrayLayout1ui2;for(const J of[0,1,3,2,0])B.emplaceBack(J);this.debugIndexBuffer=a.createIndexBuffer(B),this.emptyTexture=new o.Texture(a,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=o.create();const G=this.context.gl;this.stencilClearMode=new o.StencilMode({func:G.ALWAYS,mask:0},0,255,G.ZERO,G.ZERO,G.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Iu(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,f=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,f.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Ms(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,f,v){if(!f||this.currentStencilSource===f.id||!a.isTileClipped()||!v||v.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let B=!1;for(const G of v)if(this._tileClippingMaskIDs[G.key]===void 0){B=!0;break}if(!B)return}this.currentStencilSource=f.id;const S=this.context,T=S.gl;this.nextStencilID+v.length>256&&this.clearStencil(),S.setColorMode(o.ColorMode.disabled),S.setDepthMode(o.DepthMode.disabled);const R=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const B of v){const G=f.getTile(B),J=this._tileClippingMaskIDs[B.key]=this.nextStencilID++,{tileBoundsBuffer:ee,tileBoundsIndexBuffer:me,tileBoundsSegments:Ae}=this.getTileBoundsBuffers(G);R.draw(S,T.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:T.ALWAYS,mask:0},J,255,T.KEEP,T.KEEP,T.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Ms(B.projMatrix),"$clipping",ee,me,Ae)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,f=this.context.gl;return new o.StencilMode({func:f.NOTEQUAL,mask:255},a,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const f=this.context.gl;return new o.StencilMode({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(a){const f=this.context.gl,v=a.sort(((R,B)=>B.overscaledZ-R.overscaledZ)),S=v[v.length-1].overscaledZ,T=v[0].overscaledZ-S+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const R={};for(let B=0;B<T;B++)R[B+S]=new o.StencilMode({func:f.GEQUAL,mask:255},B+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=T,[R,v]}return[{[S]:o.StencilMode.disabled},v]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([a.CONSTANT_COLOR,a.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(a,f,v){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new o.DepthMode(v||this.context.gl.LEQUAL,f,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,f){this.style=a,this.options=f,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const v=this.style.order,S=this.style._sourceCaches;for(const J in S){const ee=S[J];ee.used&&ee.prepare(this.context)}const T={},R={},B={};for(const J in S){const ee=S[J];T[J]=ee.getVisibleCoordinates(),R[J]=T[J].slice().reverse(),B[J]=ee.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let J=0;J<v.length;J++)if(this.style._layers[v[J]].is3D()){this.opaquePassCutoff=J;break}if(this.terrain&&(this.terrain.updateTileBinding(B),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const J of v){const ee=this.style._layers[J],me=a._getLayerSourceCache(ee);if(!ee.hasOffscreenPass()||ee.isHidden(this.transform.zoom))continue;const Ae=me?R[me.id]:void 0;(ee.type==="custom"||ee.isSky()||Ae&&Ae.length)&&this.renderLayer(this,me,ee,Ae)}this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon];const G=this.terrain;if(G&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&G.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:f.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const J=this.style._layers[v[this.currentLayer]],ee=a._getLayerSourceCache(J);if(J.isSky())continue;const me=ee?R[ee.id]:void 0;this._renderTileClippingMasks(J,ee,me),this.renderLayer(this,ee,J,me)}if(this.style.fog&&this.transform.projection.supportsFog&&(function(J,ee){const me=J.context,Ae=me.gl,Te=J.transform,He=new o.DepthMode(Ae.LEQUAL,o.DepthMode.ReadOnly,[0,1]),je=J.useProgram("globeAtmosphere",null,Te.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),We=o.globeToMercatorTransition(Te.zoom),ve=ee.properties.get("color").toArray01(),Ue=ee.properties.get("high-color").toArray01(),rt=ee.properties.get("space-color").toArray01PremultipliedAlpha(),st=o.identity$1([]);o.rotateY$1(st,st,-o.degToRad(Te._center.lng)),o.rotateX$1(st,st,o.degToRad(Te._center.lat)),o.rotateZ$1(st,st,Te.angle),o.rotateX$1(st,st,-Te._pitch);const bt=o.fromQuat(new Float32Array(16),st),wt=o.mapValue(ee.properties.get("star-intensity"),0,1,0,.25),vt=5e-4,At=o.mapValue(ee.properties.get("horizon-blend"),0,1,vt,.25),kt=o.globeUseCustomAntiAliasing(J,me,Te)&&At===vt?Te.worldSize/(2*Math.PI*1.025)-1:Te.globeRadius,Vt=J.frameCounter/1e3%1,gn=o.length(Te.globeCenterInViewSpace),Ut=Math.sqrt(Math.pow(gn,2)-Math.pow(kt,2)),un=Math.acos(Ut/gn),$t=((jt,sn,Cn,_n,Mn,cr,kr,er,ar,Wr,hi,_r,Ti,Ii)=>({u_frustum_tl:jt,u_frustum_tr:sn,u_frustum_br:Cn,u_frustum_bl:_n,u_horizon:Mn,u_transition:cr,u_fadeout_range:kr,u_color:er,u_high_color:ar,u_space_color:Wr,u_star_intensity:hi,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:_r,u_horizon_angle:Ti,u_rotation_matrix:Ii}))(Te.frustumCorners.TL,Te.frustumCorners.TR,Te.frustumCorners.BR,Te.frustumCorners.BL,Te.frustumCorners.horizon,We,At,ve,Ue,rt,wt,Vt,un,bt);J.prepareDrawProgram(me,je);const In=J.atmosphereBuffer;In&&je.draw(me,Ae.TRIANGLES,He,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,$t,"skybox",In.vertexBuffer,In.indexBuffer,In.segments)})(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const J=this.style._layers[v[this.currentLayer]],ee=a._getLayerSourceCache(J);J.isSky()&&this.renderLayer(this,ee,J,ee?R[ee.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;){const J=this.style._layers[v[this.currentLayer]],ee=a._getLayerSourceCache(J);if(J.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(J)){if(J.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const me=ee?(J.type==="symbol"?B:R)[ee.id]:void 0;this._renderTileClippingMasks(J,ee,ee?T[ee.id]:void 0),this.renderLayer(this,ee,J,me),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let J=null;o.values(this.style._layers).forEach((ee=>{const me=a._getLayerSourceCache(ee);me&&!ee.isHidden(this.transform.zoom)&&(!J||J.getSource().maxzoom<me.getSource().maxzoom)&&(J=me)})),J&&this.options.showTileBoundaries&&Ai.debug(this,J,J.getVisibleCoordinates())}this.options.showPadding&&(function(J){const ee=J.transform.padding;hu(J,J.transform.height-(ee.top||0),3,Io),hu(J,ee.bottom||0,3,yr),ac(J,ee.left||0,3,la),ac(J,J.transform.width-(ee.right||0),3,oc);const me=J.transform.centerPoint;(function(Ae,Te,He,je){nl(Ae,Te-1,He-10,2,20,je),nl(Ae,Te-10,He-1,20,2,je)})(J,me.x,J.transform.height-me.y,sc)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(a,f,v,S){v.isHidden(this.transform.zoom)||(v.type==="background"||v.type==="sky"||v.type==="custom"||S&&S.length)&&(this.id=v.id,this.gpuTimingStart(v),(!a.transform.projection.unsupportedLayers||!a.transform.projection.unsupportedLayers.includes(v.type)||a.terrain&&v.type==="custom")&&Ai[v.type](a,f,v,S,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery;let v=this.gpuTimers[a.id];v||(v=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),v.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,f=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(f),a.beginQueryEXT(a.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const f={};for(const v in a){const S=a[v],T=this.context.extTimerQuery,R=T.getQueryObjectEXT(S.query,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(S.query),f[v]=R}return f}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.extTimerQuery;let v=0;for(const S of a)v+=f.getQueryObjectEXT(S,f.QUERY_RESULT_EXT)/1e6,f.deleteQueryEXT(S);return v}translatePosMatrix(a,f,v,S,T){if(!v[0]&&!v[1])return a;const R=T?S==="map"?this.transform.angle:0:S==="viewport"?-this.transform.angle:0;if(R){const J=Math.sin(R),ee=Math.cos(R);v=[v[0]*ee-v[1]*J,v[0]*J+v[1]*ee]}const B=[T?v[0]:ae(f,v[0],this.transform.zoom),T?v[1]:ae(f,v[1],this.transform.zoom),0],G=new Float32Array(16);return o.translate(G,a,B),G}saveTileTexture(a){const f=this._tileTextures[a.size[0]];f?f.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const f=this._tileTextures[a];return f&&f.length>0?f.pop():null}isPatternMissing(a){return a===null||a!==void 0&&!this.imageManager.getPattern(a.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,f=this.terrain&&this.terrain.exaggeration()===0,v=this.style&&this.style.fog,S=[];return this.terrainRenderModeElevated()&&S.push("TERRAIN"),this.transform.projection.name==="globe"&&S.push("GLOBE"),f&&S.push("ZERO_EXAGGERATION"),v&&!a&&v.getOpacity(this.transform.pitch)!==0&&S.push("FOG"),a&&S.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&S.push("OVERDRAW_INSPECTOR"),S}useProgram(a,f,v){this.cache=this.cache||{};const S=v||[],T=this.currentGlobalDefines().concat(S),R=$e.cacheKey(Pt[a],a,T,f);return this.cache[R]||(this.cache[R]=new $e(this.context,a,Pt[a],f,lu[a],T)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,f,v){if(this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const T=S.getOpacity(this.transform.pitch),R=((B,G,J,ee,me,Ae,Te,He,je,We,ve)=>{const Ue=B.transform,rt=G.properties.get("color").toArray01();rt[3]=ee;const st=B.frameCounter/1e3%1;return{u_fog_matrix:J?Ue.calculateFogTileMatrix(J):B.identityMat,u_fog_range:G.getFovAdjustedRange(Ue._fov),u_fog_color:rt,u_fog_horizon_blend:G.properties.get("horizon-blend"),u_fog_temporal_offset:st,u_frustum_tl:me,u_frustum_tr:Ae,u_frustum_br:Te,u_frustum_bl:He,u_globe_pos:je,u_globe_radius:We,u_viewport:ve,u_globe_transition:o.globeToMercatorTransition(Ue.zoom),u_is_globe:+(Ue.projection.name==="globe")}})(this,S,v,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);f.setFogUniformValues(a,R)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,f=a.createTexture();return a.bindTexture(a.TEXTURE_2D,f),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const a=this._backgroundTiles,f=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const S of v)f[S.key]=a[S.key]||new o.Tile(S,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}}class Hl{constructor(a=0,f=0,v=0,S=0){if(isNaN(a)||a<0||isNaN(f)||f<0||isNaN(v)||v<0||isNaN(S)||S<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=f,this.left=v,this.right=S}interpolate(a,f,v){return f.top!=null&&a.top!=null&&(this.top=o.number(a.top,f.top,v)),f.bottom!=null&&a.bottom!=null&&(this.bottom=o.number(a.bottom,f.bottom,v)),f.left!=null&&a.left!=null&&(this.left=o.number(a.left,f.left,v)),f.right!=null&&a.right!=null&&(this.right=o.number(a.right,f.right,v)),this}getCenter(a,f){const v=o.clamp((this.left+a-this.right)/2,0,a),S=o.clamp((this.top+f-this.bottom)/2,0,f);return new o.Point(v,S)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Hl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ca(y,a){const f=o.getColumn(y,3);o.fromQuat(y,a),o.setColumn(y,3,f)}function Or(y,a){const f=o.identity$1([]);return o.rotateZ$1(f,f,-a),o.rotateX$1(f,f,-y),f}function Ys(y,a){const f=[y[0],y[1],0],v=[a[0],a[1],0];if(o.length(f)>=1e-15){const R=o.normalize([],f);o.scale$2(v,R,o.dot(v,R)),a[0]=v[0],a[1]=v[1]}const S=o.cross([],a,y);if(o.len(S)<1e-15)return null;const T=Math.atan2(-S[1],S[0]);return Or(Math.atan2(Math.sqrt(y[0]*y[0]+y[1]*y[1]),-y[2]),T)}class fu{constructor(a,f){this.position=a,this.orientation=f}get position(){return this._position}set position(a){if(a){const f=a instanceof o.MercatorCoordinate?a:new o.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(f.x=o.wrap(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(a,f){if(this.orientation=null,!this.position)return;const v=this.position,S=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(a)):0,T=o.MercatorCoordinate.fromLngLat(a,S),R=[T.x-v.x,T.y-v.y,T.z-v.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=Ys(R,f)}setPitchBearing(a,f){this.orientation=Or(o.degToRad(a),o.degToRad(-f))}}class Zu{constructor(a,f){this._transform=o.identity([]),this.orientation=f,this.position=a}get mercatorPosition(){const a=this.position;return new o.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=o.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var f;a&&o.setColumn(this._transform,3,[(f=a)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||o.identity$1([]),a&&ca(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,f){this._orientation=Or(a,f),ca(this._transform,this._orientation)}forward(){const a=o.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=o.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=o.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,f){const v=new Float64Array(16);return o.invert(v,this.getWorldToCamera(a,f)),v}getWorldToCameraPosition(a,f,v){const S=this.position;o.scale$2(S,S,-a);const T=new Float64Array(16);return o.fromScaling(T,[v,v,v]),o.translate(T,T,S),T[10]*=f,T}getWorldToCamera(a,f){const v=new Float64Array(16),S=new Float64Array(4),T=this.position;return o.conjugate(S,this._orientation),o.scale$2(T,T,-a),o.fromQuat(v,S),o.translate(v,v,T),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=f,v[9]*=f,v[10]*=f,v[11]*=f,v}getCameraToClipPerspective(a,f,v,S){const T=new Float64Array(16);return o.perspective(T,a,f,v,S),T}getDistanceToElevation(a,f=!1){const v=a===0?0:o.mercatorZfromAltitude(a,f?o.latFromMercatorY(this.position[1]):this.position[1]),S=this.forward();return(v-this.position[2])/S[2]}clone(){return new Zu([...this.position],[...this.orientation])}}function Ui(y,a){const f=vh(y.projection,y.zoom,y.width,y.height),v=(function(T,R,B,G,J){const ee=new o.LngLat(B.lng-180*rs,B.lat),me=new o.LngLat(B.lng+180*rs,B.lat),Ae=T.project(ee.lng,ee.lat),Te=T.project(me.lng,me.lat),He=-Math.atan2(Te.y-Ae.y,Te.x-Ae.x),je=o.MercatorCoordinate.fromLngLat(B);je.y=o.clamp(je.y,-1+rs,1-rs);const We=je.toLngLat(),ve=T.project(We.lng,We.lat),Ue=o.MercatorCoordinate.fromLngLat(We);Ue.x+=rs;const rt=Ue.toLngLat(),st=T.project(rt.lng,rt.lat),bt=Pc(st.x-ve.x,st.y-ve.y,He),wt=o.MercatorCoordinate.fromLngLat(We);wt.y+=rs;const vt=wt.toLngLat(),At=T.project(vt.lng,vt.lat),kt=Pc(At.x-ve.x,At.y-ve.y,He),Vt=Math.abs(bt.x)/Math.abs(kt.y),gn=o.identity([]);o.rotateZ(gn,gn,-He*(1-(J?0:G)));const Ut=o.identity([]);return o.scale(Ut,Ut,[1,1-(1-Vt)*G,1]),Ut[4]=-kt.x/kt.y*G,o.rotateZ(Ut,Ut,He),o.multiply(Ut,gn,Ut),Ut})(y.projection,0,y.center,f,a),S=Cl(y);return o.scale(v,v,[S,S,1]),v}function Cl(y){const a=y.projection,f=vh(y.projection,y.zoom,y.width,y.height),v=rl(a,y.center),S=rl(a,o.LngLat.convert(a.center));return Math.pow(2,v*f+(1-f)*S)}function vh(y,a,f,v,S=1/0){const T=y.range;if(!T)return 0;const R=Math.min(S,Math.max(f,v)),B=Math.log(R/1024)/Math.LN2;return o.smoothstep(T[0]+B,T[1]+B,a)}const rs=1/4e4;function rl(y,a){const f=o.clamp(a.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),v=new o.LngLat(a.lng-180*rs,f),S=new o.LngLat(a.lng+180*rs,f),T=y.project(v.lng,f),R=y.project(S.lng,f),B=o.MercatorCoordinate.fromLngLat(v),G=o.MercatorCoordinate.fromLngLat(S),J=R.x-T.x,ee=R.y-T.y,me=G.x-B.x,Ae=G.y-B.y,Te=Math.sqrt((me*me+Ae*Ae)/(J*J+ee*ee));return Math.log(Te)/Math.LN2}function Pc(y,a,f){const v=Math.cos(f),S=Math.sin(f);return{x:y*v-a*S,y:y*S+a*v}}class Aa{constructor(a,f,v,S,T,R,B){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=a||0,this._maxZoom=f||22,this._minPitch=v??0,this._maxPitch=S??60,this.setProjection(R),this.setMaxBounds(B),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Hl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Zu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const a=new Aa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a,f=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||v)&&this._updateCameraOnTerrain(),(a||v)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const v=!w(f,this.getProjection());return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const f=a!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.Point(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const f=-a*Math.PI/180;var v;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=(v=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v),(function(S,T,R){var B=T[0],G=T[1],J=T[2],ee=T[3],me=Math.sin(R),Ae=Math.cos(R);S[0]=B*Ae+J*me,S[1]=G*Ae+ee*me,S[2]=B*-me+J*Ae,S[3]=G*-me+ee*Ae})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const f=o.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=o.degToRad(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const f=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let S=0,T=0;for(let R=0;R<f.length;R++){const B=new o.Point(f[R][0]*this.width,v+f[R][1]*(this.height-v)),G=a.pointCoordinate(B);if(!G)continue;const J=1/Math.hypot(G[0]-this._camera.position[0],G[1]-this._camera.position[1]);S+=G[3]*J,T+=J}return T===0?NaN:S/T}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const a=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*f,S=this._mercatorZfromZoom(a),T=this._mercatorZfromZoom(this._maxZoom),R=Math.max(S-v,T);this._setZoom(this._zoomFromMercatorZ(R))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let v;v=a.z<this._camera.position[2]?[f.x,f.y,f.z]:[a.x,a.y,a.z];const S=o.length(o.sub([],this._camera.position,v));return o.clamp(this._zoomFromMercatorZ(S),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let f=!1;if(a.orientation&&!o.exactEquals(a.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(a.orientation)),a.position){const v=[a.position.x,a.position.y,a.position.z];o.exactEquals$1(v,this._camera.position)||(this._setCameraPosition(v),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,f=new fu;return f.position=new o.MercatorCoordinate(a[0],a[1],a[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(a){if(!o.length$1(a))return!1;o.normalize$1(a,a);const f=o.transformQuat([],[0,0,-1],a),v=o.transformQuat([],[0,-1,0],a);if(v[2]<0)return!1;const S=Ys(f,v);return!!S&&(this._camera.orientation=S,!0)}_setCameraPosition(a){const f=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,S=this.cameraToCenterDistance;a[2]=o.clamp(a[2],S/v,S/f),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,f,v){this._unmodified=!1,this._edgeInsets.interpolate(a,f,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const f=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(a){const f=[new o.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const v=this.pointCoordinate(new o.Point(0,0)),S=this.pointCoordinate(new o.Point(this.width,0)),T=this.pointCoordinate(new o.Point(this.width,this.height)),R=this.pointCoordinate(new o.Point(0,this.height)),B=Math.floor(Math.min(v.x,S.x,T.x,R.x)),G=Math.floor(Math.max(v.x,S.x,T.x,R.x)),J=1;for(let ee=B-J;ee<=G+J;ee++)ee!==0&&f.push(new o.UnwrappedTileID(ee,a))}return f}coveringTiles(a){let f=this.coveringZoomLevel(a);const v=f,S=this.elevation&&!a.isTerrainDEM,T=this.projection.name==="mercator";if(a.minzoom!==void 0&&f<a.minzoom)return[];a.maxzoom!==void 0&&f>a.maxzoom&&(f=a.maxzoom);const R=this.locationCoordinate(this.center),B=this.center.lat,G=1<<f,J=[G*R.x,G*R.y,0],ee=this.projection.name==="globe",me=!ee,Ae=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,me),Te=ee?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),He=G*o.mercatorZfromAltitude(1,this.center.lat),je=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),We=[G*Te.x,G*Te.y,je*(me?1:He)],ve=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),Ue=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?f:0,rt=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,st=a.isTerrainDEM?-rt:this._elevation?this._elevation.getMinElevationBelowMSL():0,bt=this.projection.isReprojectedInTileSpace?Cl(this):1,wt=jt=>{const Cn=new o.MercatorCoordinate(jt.x+25e-6,jt.y,jt.z),_n=new o.MercatorCoordinate(jt.x,jt.y+25e-6,jt.z),Mn=jt.toLngLat(),cr=Cn.toLngLat(),kr=_n.toLngLat(),er=this.locationCoordinate(Mn),ar=this.locationCoordinate(cr),Wr=this.locationCoordinate(kr),hi=Math.hypot(ar.x-er.x,ar.y-er.y),_r=Math.hypot(Wr.x-er.x,Wr.y-er.y);return Math.sqrt(hi*_r)*bt/25e-6},vt=jt=>{const sn=rt,Cn=st;return{aabb:o.tileAABB(this,G,0,0,0,jt,Cn,sn,this.projection),zoom:0,x:0,y:0,minZ:Cn,maxZ:sn,wrap:jt,fullyVisible:!1}},At=[];let kt=[];const Vt=f,gn=a.reparseOverscaled?v:f,Ut=jt=>jt*jt,un=Ut((je-this._centerAltitude)*He),$t=jt=>{if(!this._elevation||!jt.tileID||!T)return;const sn=this._elevation.getMinMaxForTile(jt.tileID),Cn=jt.aabb;sn?(Cn.min[2]=sn.min,Cn.max[2]=sn.max,Cn.center[2]=(Cn.min[2]+Cn.max[2])/2):(jt.shouldSplit=In(jt),jt.shouldSplit||(Cn.min[2]=Cn.max[2]=Cn.center[2]=this._centerAltitude))},In=jt=>{if(jt.zoom<Ue)return!0;if(jt.zoom===Vt)return!1;if(jt.shouldSplit!=null)return jt.shouldSplit;const sn=jt.aabb.distanceX(We),Cn=jt.aabb.distanceY(We);let _n=un,Mn=1;if(ee){_n=Ut(jt.aabb.distanceZ(We));const er=Math.pow(2,jt.zoom),ar=o.latFromMercatorY((jt.y+1)/er),Wr=o.latFromMercatorY(jt.y/er),hi=Math.min(Math.max(B,ar),Wr),_r=o.circumferenceAtLatitude(hi)/o.circumferenceAtLatitude(B);if(Mn=hi===B?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,_r/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&jt.zoom===Vt-1&&_r>=.9)return!0}else if(S&&(_n=Ut(jt.aabb.distanceZ(We)*He)),this.projection.isReprojectedInTileSpace&&v<=5){const er=Math.pow(2,jt.zoom),ar=wt(new o.MercatorCoordinate((jt.x+.5)/er,(jt.y+.5)/er));Mn=ar>.85?1:ar}const cr=sn*sn+Cn*Cn+_n,kr=Ut((1<<Vt-jt.zoom)*ve*Mn*((er,ar)=>{if(ar*Ut(.707)<er)return 1;const Wr=Math.sqrt(ar/er);return Wr/(1.4144271570014144+(Math.pow(1.1,Wr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(_n,un),cr));return cr<kr};if(this.renderWorldCopies)for(let jt=1;jt<=3;jt++)At.push(vt(-jt)),At.push(vt(jt));for(At.push(vt(0));At.length>0;){const jt=At.pop(),sn=jt.x,Cn=jt.y;let _n=jt.fullyVisible;if(!_n){const Mn=jt.aabb.intersects(Ae);if(Mn===0)continue;_n=Mn===2}if(jt.zoom!==Vt&&In(jt))for(let Mn=0;Mn<4;Mn++){const cr=(sn<<1)+Mn%2,kr=(Cn<<1)+(Mn>>1),er={aabb:T?jt.aabb.quadrant(Mn):o.tileAABB(this,G,jt.zoom+1,cr,kr,jt.wrap,jt.minZ,jt.maxZ,this.projection),zoom:jt.zoom+1,x:cr,y:kr,wrap:jt.wrap,fullyVisible:_n,tileID:void 0,shouldSplit:void 0,minZ:jt.minZ,maxZ:jt.maxZ};S&&!ee&&(er.tileID=new o.OverscaledTileID(jt.zoom+1===Vt?gn:jt.zoom+1,jt.wrap,jt.zoom+1,cr,kr),$t(er)),At.push(er)}else{const Mn=jt.zoom===Vt?gn:jt.zoom;if(a.minzoom&&a.minzoom>Mn)continue;const cr=J[0]-(.5+sn+(jt.wrap<<jt.zoom))*(1<<f-jt.zoom),kr=J[1]-.5-Cn,er=jt.tileID?jt.tileID:new o.OverscaledTileID(Mn,jt.wrap,jt.zoom,sn,Cn);kt.push({tileID:er,distanceSq:cr*cr+kr*kr})}}if(this.fogCullDistSq){const jt=this.fogCullDistSq,sn=this.horizonLineFromTop();kt=kt.filter((Cn=>{const _n=[0,0,0,1],Mn=[o.EXTENT,o.EXTENT,0,1],cr=this.calculateFogTileMatrix(Cn.tileID.toUnwrapped());o.transformMat4$1(_n,_n,cr),o.transformMat4$1(Mn,Mn,cr);const kr=o.getAABBPointSquareDist(_n,Mn);if(kr===0)return!0;let er=!1;const ar=this._elevation;if(ar&&kr>jt&&sn!==0){const Wr=this.calculateProjMatrix(Cn.tileID.toUnwrapped());let hi;a.isTerrainDEM||(hi=ar.getMinMaxForTile(Cn.tileID)),hi||(hi={min:st,max:rt});const _r=o.furthestTileCorner(this.rotation),Ti=[_r[0]*o.EXTENT,_r[1]*o.EXTENT,hi.max];o.transformMat4(Ti,Ti,Wr),er=(1-Ti[1])*this.height*.5<sn}return kr<jt||er}))}return kt.sort(((jt,sn)=>jt.distanceSq-sn.distanceSq)).map((jt=>jt.tileID))}resize(a,f){this.width=a,this.height=f,this.pixelsToGLUnits=[2/a,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const f=o.clamp(a.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),v=this.projection.project(a.lng,f);return new o.Point(v.x*this.worldSize,v.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,f){let v,S;const T=this.centerPoint;if(this.projection.name==="globe"){const B=this.worldSize;v=(f.x-T.x)/B,S=(f.y-T.y)/B}else{const B=this.pointCoordinate(f),G=this.pointCoordinate(T);v=B.x-G.x,S=B.y-G.y}const R=this.locationCoordinate(a);this.setLocation(new o.MercatorCoordinate(R.x-v,R.y-S))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,f){const v=f?o.mercatorZfromAltitude(f,a.lat):void 0,S=this.projection.project(a.lng,a.lat);return new o.MercatorCoordinate(S.x,S.y,v)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,f){const v=f??this._centerAltitude,S=[a.x,a.y,0,1],T=[a.x,a.y,1,1];o.transformMat4$1(S,S,this.pixelMatrixInverse),o.transformMat4$1(T,T,this.pixelMatrixInverse);const R=T[3];o.scale$1(S,S,1/S[3]),o.scale$1(T,T,1/R);const B=S[2],G=T[2];return{p0:S,p1:T,t:B===G?0:(v-B)/(G-B)}}screenPointToMercatorRay(a){const f=[a.x,a.y,0,1],v=[a.x,a.y,1,1];return o.transformMat4$1(f,f,this.pixelMatrixInverse),o.transformMat4$1(v,v,this.pixelMatrixInverse),o.scale$1(f,f,1/f[3]),o.scale$1(v,v,1/v[3]),f[2]=o.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,v[2]=o.mercatorZfromAltitude(v[2],this._center.lat)*this.worldSize,o.scale$1(f,f,1/this.worldSize),o.scale$1(v,v,1/this.worldSize),new o.Ray([f[0],f[1],f[2]],o.normalize([],o.sub([],v,f)))}rayIntersectionCoordinate(a){const{p0:f,p1:v,t:S}=a,T=o.mercatorZfromAltitude(f[2],this._center.lat),R=o.mercatorZfromAltitude(v[2],this._center.lat);return new o.MercatorCoordinate(o.number(f[0],v[0],S)/this.worldSize,o.number(f[1],v[1],S)/this.worldSize,o.number(T,R,S))}pointCoordinate(a,f=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,f)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let f=this.projection.pointCoordinate3D(this,a.x,a.y);if(f)return new o.MercatorCoordinate(f[0],f[1],f[2]);let v=0,S=this.horizonLineFromTop();if(a.y>S)return this.pointCoordinate(a);const T=.02*S,R=a.clone();for(let B=0;B<10&&S-v>T;B++){R.y=o.number(v,S,.66);const G=this.projection.pointCoordinate3D(this,R.x,R.y);G?(S=R.y,f=G):v=R.y}return f?new o.MercatorCoordinate(f[0],f[1],f[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(a);const f=this.pointCoordinate(a);return f.y>=0&&f.y<=1}_coordinatePoint(a,f){const v=f&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,S=[a.x*this.worldSize,a.y*this.worldSize,v+a.toAltitude(),1];return o.transformMat4$1(S,S,this.pixelMatrix),S[3]>0?new o.Point(S[0]/S[3],S[1]/S[3]):new o.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:f}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,T=this.pointLocation3D(new o.Point(f,a)),R=this.pointLocation3D(new o.Point(S,a)),B=this.pointLocation3D(new o.Point(S,v)),G=this.pointLocation3D(new o.Point(f,v));let J=Math.min(T.lng,R.lng,B.lng,G.lng),ee=Math.max(T.lng,R.lng,B.lng,G.lng),me=Math.min(T.lat,R.lat,B.lat,G.lat),Ae=Math.max(T.lat,R.lat,B.lat,G.lat);const Te=Math.pow(2,-this.zoom)/16*270,He=this.projection.name==="globe"?1:4,je=(We,ve,Ue,rt,st)=>{const bt=(We+Ue)/2,wt=(ve+rt)/2,vt=new o.Point(bt,wt),{lng:At,lat:kt}=this.pointLocation3D(vt),Vt=Math.max(0,J-At,me-kt,At-ee,kt-Ae);J=Math.min(J,At),ee=Math.max(ee,At),me=Math.min(me,kt),Ae=Math.max(Ae,kt),(st<He||Vt>Te)&&(je(We,ve,bt,wt,st+1),je(bt,wt,Ue,rt,st+1))};if(je(f,a,S,a,1),je(S,a,S,v,1),je(S,v,f,v,1),je(f,v,f,a,1),this.projection.name==="globe"){const[We,ve]=o.polesInViewport(this);We?(Ae=90,ee=180,J=-180):ve&&(me=-90,ee=180,J=-180)}return new o.LngLatBounds(new o.LngLat(J,me),new o.LngLat(ee,Ae))}_getBoundsRectangular(a,f){const{top:v,left:S}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,R=this.width-this._edgeInsets.right,B=new o.Point(S,v),G=new o.Point(R,v),J=new o.Point(R,T),ee=new o.Point(S,T);let me=this.pointCoordinate(B,a),Ae=this.pointCoordinate(G,a);const Te=this.pointCoordinate(J,f),He=this.pointCoordinate(ee,f),je=(We,ve)=>(ve.y-We.y)/(ve.x-We.x);return me.y>1&&Ae.y>=0?me=new o.MercatorCoordinate((1-He.y)/je(He,me)+He.x,1):me.y<0&&Ae.y<=1&&(me=new o.MercatorCoordinate(-He.y/je(He,me)+He.x,0)),Ae.y>1&&me.y>=0?Ae=new o.MercatorCoordinate((1-Te.y)/je(Te,Ae)+Te.x,1):Ae.y<0&&me.y<=1&&(Ae=new o.MercatorCoordinate(-Te.y/je(Te,Ae)+Te.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(me)).extend(this.coordinateLocation(Ae)).extend(this.coordinateLocation(He)).extend(this.coordinateLocation(Te))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=a.visibleDemTiles.reduce(((v,S)=>{if(S.dem){const T=S.dem.tree;v.min=Math.min(v.min,T.minimums[0]),v.max=Math.max(v.max,T.maximums[0])}return v}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*a.exaggeration(),f.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,v=this.height/2-f*(1-this._horizonShift);return a?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,f){return this.projection.createTileMatrix(this,f,a)}calculateDistanceTileData(a){const f=a.key,v=this._distanceTileDataCache;if(v[f])return v[f];const S=a.canonical,T=1/this.height,R=this.cameraWorldSize,B=R/this.zoomScale(S.z),G=(S.x+Math.pow(2,S.z)*a.wrap)*B,J=S.y*B,ee=this.point;ee.x*=R/this.worldSize,ee.y*=R/this.worldSize;const me=this.angle,Ae=Math.sin(-me),Te=-Math.cos(-me);return v[f]={bearing:[Ae,Te],center:[(ee.x-G)*T,(ee.y-J)*T],scale:B/o.EXTENT*T},v[f]}calculateFogTileMatrix(a){const f=a.key,v=this._fogTileMatrixCache;if(v[f])return v[f];const S=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return o.multiply(S,this.worldToFogMatrix,S),v[f]=new Float32Array(S),v[f]}calculateProjMatrix(a,f=!1){const v=a.key,S=f?this._alignedProjMatrixCache:this._projMatrixCache;if(S[v])return S[v];const T=this.calculatePosMatrix(a,this.worldSize);return o.multiply(T,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.alignedProjMatrix:this.projMatrix,T),S[v]=new Float32Array(T),S[v]}calculatePixelsToTileUnitsMatrix(a){const f=a.tileID.key,v=this._pixelsToTileUnitsCache;if(v[f])return v[f];const S=(function(T,R){const{scale:B}=T.tileTransform,G=B*o.EXTENT/(T.tileSize*Math.pow(2,R.zoom-T.tileID.overscaledZ+T.tileID.canonical.z));return J=new Float32Array(4),Ae=(ee=R.inverseAdjustmentMatrix)[1],Te=ee[2],He=ee[3],We=(me=[G,G])[1],J[0]=ee[0]*(je=me[0]),J[1]=Ae*je,J[2]=Te*We,J[3]=He*We,J;var J,ee,me,Ae,Te,He,je,We})(a,this);return v[f]=S,v[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const a=1/this.worldSize,f=o.fromScaling([],[a,a,a]);return o.multiply(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const a=this._elevation;this._updateCameraState();const f=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(f),S=this._camera.forward(),T=o.mercatorZfromAltitude(1,this._center.lat);v[2]/=T,S[2]/=T,o.normalize(S,S);const R=a.raycast(v,S,a.exaggeration());if(R){const B=o.scaleAndAdd([],v,S,R),G=new o.MercatorCoordinate(B[0],B[1],o.mercatorZfromAltitude(B[2],o.latFromMercatorY(B[1]))),J=(G.z+o.length([G.x-v[0],G.y-v[1],G.z-v[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(J),this._centerAltitude=G.toAltitude(),this._center=this.coordinateLocation(G),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const f=this._elevation,v=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,S=this._computeCameraPosition(v),T=f.getAtPointOrZero(new o.MercatorCoordinate(...S)),R=this.pixelsPerMeter/this.worldSize*T,B=this._minimumHeightOverTerrain(),G=S[2]-R;if(G<=B)if(G<0||a){const J=this.locationCoordinate(this._center,this._centerAltitude),ee=[S[0],S[1],J.z-S[2]],me=o.length(ee);ee[2]-=(B-G)/this._pixelsPerMercatorPixel;const Ae=o.length(ee);if(Ae===0)return;o.scale$2(ee,ee,me/Ae*this._pixelsPerMercatorPixel),this._camera.position=[S[0],S[1],J.z*this._pixelsPerMercatorPixel-ee[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const Ae=this.center;return Ae.lat=o.clamp(Ae.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(Ae.lng=o.clamp(Ae.lng,this.minLng,this.maxLng)),this.center=Ae,void(this._constraining=!1)}const f=this._unmodified,{x:v,y:S}=this.point;let T=0,R=v,B=S;const G=this.width/2,J=this.height/2,ee=this.worldMinY*this.scale,me=this.worldMaxY*this.scale;if(S-J<ee&&(B=ee+J),S+J>me&&(B=me-J),me-ee<this.height&&(T=Math.max(T,this.height/(me-ee)),B=(me+ee)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Ae=this.worldMinX*this.scale,Te=this.worldMaxX*this.scale,He=this.worldSize/2-(Ae+Te)/2;R=(v+He+this.worldSize)%this.worldSize-He,R-G<Ae&&(R=Ae+G),R+G>Te&&(R=Te-G),Te-Ae<this.width&&(T=Math.max(T,this.width/(Te-Ae)),R=(Te+Ae)/2)}R===v&&B===S||(this.center=this.unproject(new o.Point(R,B))),T&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const v=vh(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S=this.projection.zAxisUnit==="meters"?f:1,T=this._camera.getWorldToCamera(this.worldSize,S),R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);R[8]=2*-a.x/this.width,R[9]=2*a.y/this.height;let B=o.mul([],R,T);if(this.projection.isReprojectedInTileSpace){const wt=this.locationCoordinate(this.center),vt=o.identity([]);o.translate(vt,vt,[wt.x*this.worldSize,wt.y*this.worldSize,0]),o.multiply(vt,vt,Ui(this)),o.translate(vt,vt,[-wt.x*this.worldSize,-wt.y*this.worldSize,0]),o.multiply(B,B,vt),this.inverseAdjustmentMatrix=(function(At){const kt=Ui(At,!0);return $([],[kt[0],kt[1],kt[4],kt[5]])})(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],B,[this.worldSize,this.worldSize,this.worldSize/S,1]),this.projMatrix=B,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const G=o.invert([],R);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(G,this.horizonLineFromTop(),this.height);const J=new Float32Array(16);o.identity(J),o.scale(J,J,[1,-1,1]),o.rotateX(J,J,this._pitch),o.rotateZ(J,J,this.angle);const ee=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),me=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ee[8]=2*-a.x/this.width,ee[9]=2*(a.y+me)/this.height,this.skyboxMatrix=o.multiply(J,ee,J);const Ae=this.point,Te=Ae.x,He=Ae.y,je=this.width%2/2,We=this.height%2/2,ve=Math.cos(this.angle),Ue=Math.sin(this.angle),rt=Te-Math.round(Te)+ve*je+Ue*We,st=He-Math.round(He)+ve*We+Ue*je,bt=new Float64Array(B);if(o.translate(bt,bt,[rt>.5?rt-1:rt,st>.5?st-1:st,0]),this.alignedProjMatrix=bt,B=o.create(),o.scale(B,B,[this.width/2,-this.height/2,1]),o.translate(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=o.create(),o.scale(B,B,[1,-1,1]),o.translate(B,B,[-1,-1,0]),o.scale(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},B=o.invert(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=B,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const wt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(wt,wt,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=B;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,v=this._camera.position,S=1/this.height/this._pixelsPerMercatorPixel,T=[a,a,f];o.scale$2(T,T,S),o.scale$2(v,v,-1),o.multiply$2(v,v,T);const R=o.create();o.translate(R,R,v),o.scale(R,R,T),this.mercatorFogMatrix=R,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,f,S)}_computeCameraPosition(a){const f=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),S=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-a/this.worldSize*this._centerAltitude;return[S.x/this.worldSize-v[0]*T,S.y/this.worldSize-v[1]*T,a/this.worldSize*this._centerAltitude-v[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],S=a[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),S>0&&(T=Math.min((f-v)/S,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,a,T),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,f=this._camera.forward(),{pitch:v,bearing:S}=this._camera.getPitchBearing(),T=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,R=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),B=Math.max((a[2]-T)/Math.cos(v),R),G=this._zoomFromMercatorZ(B);o.scaleAndAdd(a,a,f,B),this._pitch=o.clamp(v,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(S,-Math.PI,Math.PI),this._setZoom(o.clamp(G,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let f=0,v=o.GLOBE_ZOOM_THRESHOLD_MAX,S=0,T=1/0;for(;v-f>1e-6&&v>f;){const R=f+.5*(v-f),B=this.tileSize*Math.pow(2,R),G=this.getCameraToCenterDistance(this.projection,R,B),J=this.scaleZoom(G/(a*this.tileSize)),ee=Math.abs(R-J);ee<T&&(T=ee,S=R),R<J?f=R:v=R}return S}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,f){const v=Math.min(a.x,f.x),S=Math.max(a.x,f.x),T=Math.min(a.y,f.y),R=Math.max(a.y,f.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const B=[new o.Point(v,T),new o.Point(S,R),new o.Point(v,R),new o.Point(S,T)],G=this.renderWorldCopies?-3:0,J=this.renderWorldCopies?4:1;for(const ee of B){const me=this.pointRayIntersection(ee);if(me.t<0)return!0;const Ae=this.rayIntersectionCoordinate(me);if(Ae.x<G||Ae.y<0||Ae.x>J||Ae.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.Point(0,0),new o.Point(this.width,this.height))}zoomDeltaToMovement(a,f){const v=o.length(o.sub([],this._camera.position,a)),S=this._zoomFromMercatorZ(v)+f;return v-this._mercatorZfromZoom(S)}getCameraPoint(){if(this.projection.name==="globe"){const a=(function([f,v,S],T){const R=[f,v,S,1];o.transformMat4$1(R,R,T);const B=R[3]=Math.max(R[3],1e-6);return R[0]/=B,R[1]/=B,R[2]/=B,R})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.Point(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,a))}}getCameraToCenterDistance(a,f=this.zoom,v=this.worldSize){const S=vh(a,f,this.width,this.height,1024),T=a.pixelSpaceConversion(this.center.lat,v,S);return .5/Math.tan(.5*this._fov)*this.height*T}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(a,a,this.globeMatrix),a}}function Co(y,a){let f=!1,v=null;const S=()=>{v=null,f&&(y(),v=setTimeout(S,a),f=!1)};return()=>(f=!0,v||S(),v)}class Vh{constructor(a){this._hashName=a&&encodeURIComponent(a),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Co(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,o.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const f=kc(a);if(this._hashName){const v=this._hashName;let S=!1;const T=o.window.location.hash.slice(1).split("&").map((R=>{const B=R.split("=")[0];return B===v?(S=!0,`${B}=${f}`):R})).filter((R=>R));return S||T.push(`${v}=${f}`),`#${T.join("&")}`}return`#${f}`}_getCurrentHash(){const a=o.window.location.hash.replace("#","");if(this._hashName){let f;return a.split("&").map((v=>v.split("="))).forEach((v=>{v[0]===this._hashName&&(f=v)})),(f&&f[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some((v=>isNaN(v)))){const v=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(f[3]||0):a.getBearing();return a.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:v,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,a)}}function kc(y,a){const f=y.getCenter(),v=Math.round(100*y.getZoom())/100,S=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,S),R=Math.round(f.lng*T)/T,B=Math.round(f.lat*T)/T,G=y.getBearing(),J=y.getPitch();let ee=a?`/${R}/${B}/${v}`:`${v}/${B}/${R}`;return(G||J)&&(ee+="/"+Math.round(10*G)/10),J&&(ee+=`/${Math.round(J)}`),ee}const Vi={linearity:.3,easing:o.bezier(0,0,.3,1)},lc=o.extend({deceleration:2500,maxSpeed:1400},Vi),cc=o.extend({deceleration:20,maxSpeed:1400},Vi),or=o.extend({deceleration:1e3,maxSpeed:360},Vi),go=o.extend({deceleration:1e3,maxSpeed:90},Vi);class Cu{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,f=o.exported.now();for(;a.length>0&&f-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)f.zoom+=T.zoomDelta||0,f.bearing+=T.bearingDelta||0,f.pitch+=T.pitchDelta||0,T.panDelta&&f.pan._add(T.panDelta),T.around&&(f.around=T.around),T.pinchAround&&(f.pinchAround=T.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(f.pan.mag()){const T=qh(f.pan.mag(),v,o.extend({},lc,a||{}));S.offset=f.pan.mult(T.amount/f.pan.mag()),S.center=this._map.transform.center,Lu(S,T)}if(f.zoom){const T=qh(f.zoom,v,cc);S.zoom=this._map.transform.zoom+T.amount,Lu(S,T)}if(f.bearing){const T=qh(f.bearing,v,or);S.bearing=this._map.transform.bearing+o.clamp(T.amount,-179,179),Lu(S,T)}if(f.pitch){const T=qh(f.pitch,v,go);S.pitch=this._map.transform.pitch+T.amount,Lu(S,T)}if(S.zoom||S.bearing){const T=f.pinchAround===void 0?f.around:f.pinchAround;S.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),S.noMoveStart=!0,S}}function Lu(y,a){(!y.duration||y.duration<a.duration)&&(y.duration=a.duration,y.easing=a.easing)}function qh(y,a,f){const{maxSpeed:v,linearity:S,deceleration:T}=f,R=o.clamp(y*S/(a/1e3),-v,v),B=Math.abs(R)/(T*S);return{easing:f.easing,duration:1e3*B,amount:R*(B/2)}}class ya extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,v,S={}){const T=Ve(f.getCanvasContainer(),v),R=f.unproject(T);super(a,o.extend({point:T,lngLat:R,originalEvent:v},S)),this._defaultPrevented=!1,this.target=f}}class Na extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,v){const S=a==="touchend"?v.changedTouches:v.touches,T=de(f.getCanvasContainer(),S),R=T.map((G=>f.unproject(G))),B=T.reduce(((G,J,ee,me)=>G.add(J.div(me.length))),new o.Point(0,0));super(a,{points:T,point:B,lngLats:R,lngLat:f.unproject(B),originalEvent:v}),this._defaultPrevented=!1}}class Mc extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,v){super(a,{originalEvent:v}),this._defaultPrevented=!1}}class Yu{constructor(a,f){this._map=a,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new Mc(a.type,this._map,a))}mousedown(a,f){return this._mousedownPos=f,this._firePreventable(new ya(a.type,this._map,a))}mouseup(a){this._map.fire(new ya(a.type,this._map,a))}preclick(a){const f=o.extend({},a);f.type="preclick",this._map.fire(new ya(f.type,this._map,f))}click(a,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(a),this._map.fire(new ya(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new ya(a.type,this._map,a))}mouseover(a){this._map.fire(new ya(a.type,this._map,a))}mouseout(a){this._map.fire(new ya(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Na(a.type,this._map,a))}touchmove(a){this._map.fire(new Na(a.type,this._map,a))}touchend(a){this._map.fire(new Na(a.type,this._map,a))}touchcancel(a){this._map.fire(new Na(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tu{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new ya(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ya("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new ya(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gl{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,f){this.isEnabled()&&a.shiftKey&&a.button===0&&(oe(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(a,f){if(!this._active)return;const v=f,S=this._startPos,T=this._lastPos;if(!S||!T||T.equals(v)||!this._box&&v.dist(S)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=M("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const R=Math.min(S.x,v.x),B=Math.max(S.x,v.x),G=Math.min(S.y,v.y),J=Math.max(S.y,v.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${R}px,${G}px)`,this._box.style.width=B-R+"px",this._box.style.height=J-G+"px")}))}mouseupWindow(a,f){if(!this._active)return;const v=this._startPos,S=f;if(v&&a.button===0){if(this.reset(),Ne(),v.x!==S.x||v.y!==S.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:T=>T.fitScreenCoordinates(v,S,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ye(),delete this._startPos,delete this._lastPos}_fireEvent(a,f){return this._map.fire(new o.Event(a,{originalEvent:f}))}}function Ju(y,a){const f={};for(let v=0;v<y.length;v++)f[y[v].identifier]=a[v];return f}class pu{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,f,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),v.length===this.numTouches&&(this.centroid=(function(S){const T=new o.Point(0,0);for(const R of S)T._add(R);return T.div(S.length)})(f),this.touches=Ju(v,f)))}touchmove(a,f,v){if(this.aborted||!this.centroid)return;const S=Ju(v,f);for(const T in this.touches){const R=S[T];(!R||R.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(a,f,v){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),v.length===0){const S=!this.aborted&&this.centroid;if(this.reset(),S)return S}}}class Ch{constructor(a){this.singleTap=new pu(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,f,v){this.singleTap.touchstart(a,f,v)}touchmove(a,f,v){this.singleTap.touchmove(a,f,v)}touchend(a,f,v){const S=this.singleTap.touchend(a,f,v);if(S){const T=a.timeStamp-this.lastTime<500,R=!this.lastTap||this.lastTap.dist(S)<30;if(T&&R||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=S,this.count===this.numTaps)return this.reset(),S}}}class Qu{constructor(){this._zoomIn=new Ch({numTouches:1,numTaps:2}),this._zoomOut=new Ch({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,f,v){this._zoomIn.touchstart(a,f,v),this._zoomOut.touchstart(a,f,v)}touchmove(a,f,v){this._zoomIn.touchmove(a,f,v),this._zoomOut.touchmove(a,f,v)}touchend(a,f,v){const S=this._zoomIn.touchend(a,f,v),T=this._zoomOut.touchend(a,f,v);return S?(this._active=!0,a.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(S)},{originalEvent:a})}):T?(this._active=!0,a.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(T)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Qd={0:1,2:2};class xh{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,f){return!1}_move(a,f){return{}}mousedown(a,f){if(this._lastPoint)return;const v=j(a);this._correctButton(a,v)&&(this._lastPoint=f,this._eventButton=v)}mousemoveWindow(a,f){const v=this._lastPoint;if(v){if(a.preventDefault(),this._eventButton!=null&&(function(S,T){const R=Qd[T];return S.buttons===void 0||(S.buttons&R)!==R})(a,this._eventButton))this.reset();else if(this._moved||!(f.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(v,f)}}mouseupWindow(a){this._lastPoint&&j(a)===this._eventButton&&(this._moved&&Ne(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lh extends xh{mousedown(a,f){super.mousedown(a,f),this._lastPoint&&(this._active=!0)}_correctButton(a,f){return f===0&&!a.ctrlKey}_move(a,f){return{around:f,panDelta:f.sub(a)}}}class Ta extends xh{_correctButton(a,f){return f===0&&a.ctrlKey||f===2}_move(a,f){const v=.8*(f.x-a.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(a){a.preventDefault()}}class Da extends xh{_correctButton(a,f){return f===0&&a.ctrlKey||f===2}_move(a,f){const v=-.5*(f.y-a.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(a){a.preventDefault()}}class Va{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)}touchstart(a,f,v){return this._calculateTransform(a,f,v)}touchmove(a,f,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(v.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,f,v)}}touchend(a,f,v){this._calculateTransform(a,f,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,f,v){v.length>0&&(this._active=!0);const S=Ju(v,f),T=new o.Point(0,0),R=new o.Point(0,0);let B=0;for(const J in S){const ee=S[J],me=this._touches[J];me&&(T._add(ee),R._add(ee.sub(me)),B++,S[J]=ee)}if(this._touches=S,B<this._minTouches||!R.mag())return;const G=R.div(B);return this._sum._add(G),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(B),panDelta:G}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=M("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")}),500)}}class yl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,f,v){return{}}touchstart(a,f,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([f[0],f[1]]))}touchmove(a,f,v){const S=this._firstTwoTouches;if(!S)return;a.preventDefault();const[T,R]=S,B=uc(v,f,T),G=uc(v,f,R);if(!B||!G)return;const J=this._aroundCenter?null:B.add(G).div(2);return this._move([B,G],J,a)}touchend(a,f,v){if(!this._firstTwoTouches)return;const[S,T]=this._firstTwoTouches,R=uc(v,f,S),B=uc(v,f,T);R&&B||(this._active&&Ne(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function uc(y,a,f){for(let v=0;v<y.length;v++)if(y[v].identifier===f)return a[v]}function _a(y,a){return Math.log(y/a)/Math.LN2}class qa extends yl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,f){const v=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(_a(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_a(this._distance,v),pinchAround:f}}}function od(y,a){return 180*y.angleWith(a)/Math.PI}class Id extends yl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,f){const v=this._vector;if(this._vector=a[0].sub(a[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:od(this._vector,v),pinchAround:f}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const f=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const S=od(a,v);return Math.abs(S)<f}}function Fa(y){return Math.abs(y.y)>Math.abs(y.x)}class Rc extends yl{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,Fa(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,f,v){const S=this._lastPoints;if(!S)return;const T=a[0].sub(S[0]),R=a[1].sub(S[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(T,R,v.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(T.y+R.y)/2*-.5})}gestureBeginsVertically(a,f,v){if(this._valid!==void 0)return this._valid;const S=a.mag()>=2,T=f.mag()>=2;if(!S&&!T)return;if(!S||!T)return this._firstMove==null&&(this._firstMove=v),v-this._firstMove<100&&void 0;const R=a.y>0==f.y>0;return Fa(a)&&Fa(f)&&R}}const eh={panStep:100,bearingStep:15,pitchStep:10};class Ph{constructor(){const a=eh;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let f=0,v=0,S=0,T=0,R=0;switch(a.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:a.shiftKey?v=-1:(a.preventDefault(),T=-1);break;case 39:a.shiftKey?v=1:(a.preventDefault(),T=1);break;case 38:a.shiftKey?S=1:(a.preventDefault(),R=-1);break;case 40:a.shiftKey?S=-1:(a.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(v=0,S=0),{cameraAnimation:B=>{const G=B.getZoom();B.easeTo({duration:300,easeId:"keyboardHandler",easing:$h,zoom:f?Math.round(G)+f*(a.shiftKey?2:1):G,bearing:B.getBearing()+v*this._bearingStep,pitch:B.getPitch()+S*this._pitchStep,offset:[-T*this._panStep,-R*this._panStep],center:B.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $h(y){return y*(2-y)}const nu=4.000244140625;class Nc{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=a.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const v=o.exported.now(),S=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,f!==0&&f%nu==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":S>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(S*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),a.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=a,this._delta-=f,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=Ve(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){const G=this._type==="wheel"&&Math.abs(this._delta)>nu?this._wheelZoomRate:this._defaultZoomRate;let J=2/(1+Math.exp(-Math.abs(this._delta*G)));this._delta<0&&J!==0&&(J=1/J);const ee=f(),me=Math.pow(2,ee),Ae=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):me;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(Ae*J))),this._type==="wheel"&&(this._startZoom=ee,this._easing=this._smoothOutEasing(200)),this._delta=0}const v=typeof this._targetZoom=="number"?this._targetZoom:f(),S=this._startZoom,T=this._easing;let R,B=!1;if(this._type==="wheel"&&S&&T){const G=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),J=T(G);R=o.number(S,v,J),G<1?this._frameId||(this._frameId=!0):B=!0}else R=v,B=!0;return this._active=!0,B&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!B,zoomDelta:R-f(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let f=o.ease;if(this._prevEase){const v=this._prevEase,S=(o.exported.now()-v.start)/v.duration,T=v.easing(S+.01)-v.easing(S),R=.27/Math.sqrt(T*T+1e-4)*.01,B=Math.sqrt(.0729-R*R);f=o.bezier(R,B,.25,1)}return this._prevEase={start:o.exported.now(),duration:a,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=M("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")}),200)}}class Lo{constructor(a,f){this._clickZoom=a,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Xi{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,f){return a.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(a.shiftKey?-1:1),around:v.unproject(f)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ll{constructor(){this._tap=new Ch({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,f,v){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=f[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(a,f,v))}touchmove(a,f,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const S=f[0],T=S.y-this._swipePoint.y;return this._swipePoint=S,a.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(a,f,v)}touchend(a,f,v){this._tapTime?this._swipePoint&&v.length===0&&this.reset():this._tap.touchend(a,f,v)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class va{constructor(a,f,v){this._el=a,this._mousePan=f,this._touchPan=v}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Is{constructor(a,f,v){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=f,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xl{constructor(a,f,v,S){this._el=a,this._touchZoom=f,this._touchRotate=v,this._tapDragZoom=S,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const $a=y=>y.zoom||y.drag||y.pitch||y.rotate;class Pl extends o.Event{}class sd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,f){const v=o.sub([],f,a);this.radius=o.length(v[2]<0?o.div([],v,this.constants):[v[0],v[1],0])}projectRay(a){o.div(a,a,this.constants),o.normalize(a,a),o.mul$1(a,a,this.constants);const f=o.scale$2([],a,this.radius);if(f[2]>0){const v=o.scale$2([],[0,0,1],o.dot(f,[0,0,1])),S=o.scale$2([],o.normalize([],[f[0],f[1],0]),this.radius),T=o.add([],f,o.scale$2([],o.sub([],o.add([],S,v),f),2));f[0]=T[0],f[1]=T[1]}return f}}function Ga(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Dc{constructor(a,f){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Cu(a),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new sd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),o.bindAll(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[S,T,R]of this._listeners)S.addEventListener(T,S===o.window.document?this.handleWindowEvent:this.handleEvent,R)}destroy(){for(const[a,f,v]of this._listeners)a.removeEventListener(f,a===o.window.document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(a){const f=this._map,v=f.getCanvasContainer();this._add("mapEvent",new Yu(f,a));const S=f.boxZoom=new gl(f,a);this._add("boxZoom",S);const T=new Qu,R=new Xi;f.doubleClickZoom=new Lo(R,T),this._add("tapZoom",T),this._add("clickZoom",R);const B=new Ll;this._add("tapDragZoom",B);const G=f.touchPitch=new Rc(f);this._add("touchPitch",G);const J=new Ta(a),ee=new Da(a);f.dragRotate=new Is(a,J,ee),this._add("mouseRotate",J,["mousePitch"]),this._add("mousePitch",ee,["mouseRotate"]);const me=new Lh(a),Ae=new Va(f,a);f.dragPan=new va(v,me,Ae),this._add("mousePan",me),this._add("touchPan",Ae,["touchZoom","touchRotate"]);const Te=new Id,He=new qa;f.touchZoomRotate=new Xl(v,He,Te,B),this._add("touchRotate",Te,["touchPan","touchZoom"]),this._add("touchZoom",He,["touchPan","touchRotate"]),this._add("blockableMapEvent",new tu(f));const je=f.scrollZoom=new Nc(f,this);this._add("scrollZoom",je,["mousePan"]);const We=f.keyboard=new Ph;this._add("keyboard",We);for(const ve of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[ve]&&f[ve].enable(a[ve])}_add(a,f,v){this._handlers.push({handlerName:a,handler:f,allowed:v}),this._handlersById[a]=f}stop(a){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$a(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,f,v){for(const S in a)if(S!==v&&(!f||f.indexOf(S)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const f=[];for(const v of a)this._el.contains(v.target)&&f.push(v);return f}handleEvent(a,f){this._updatingCamera=!0;const v=a.type==="renderFrame",S=v?void 0:a,T={needsRenderFrame:!1},R={},B={},G=a.touches?this._getMapTouches(a.touches):void 0,J=G?de(this._el,G):v?void 0:Ve(this._el,a);for(const{handlerName:Ae,handler:Te,allowed:He}of this._handlers){if(!Te.isEnabled())continue;let je;this._blockedByActive(B,He,Ae)?Te.reset():Te[f||a.type]&&(je=Te[f||a.type](a,J,G),this.mergeHandlerResult(T,R,je,Ae,S),je&&je.needsRenderFrame&&this._triggerRenderFrame()),(je||Te.isActive())&&(B[Ae]=Te)}const ee={};for(const Ae in this._previousActiveHandlers)B[Ae]||(ee[Ae]=S);this._previousActiveHandlers=B,(Object.keys(ee).length||Ga(T))&&(this._changes.push([T,R,ee]),this._triggerRenderFrame()),(Object.keys(B).length||Ga(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:me}=T;me&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],me(this._map))}mergeHandlerResult(a,f,v,S,T){if(!v)return;o.extend(a,v);const R={handlerName:S,originalEvent:v.originalEvent||T};v.zoomDelta!==void 0&&(f.zoom=R),v.panDelta!==void 0&&(f.drag=R),v.pitchDelta!==void 0&&(f.pitch=R),v.bearingDelta!==void 0&&(f.rotate=R)}_applyChanges(){const a={},f={},v={};for(const[S,T,R]of this._changes)S.panDelta&&(a.panDelta=(a.panDelta||new o.Point(0,0))._add(S.panDelta)),S.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(a.around=S.around),S.aroundCoord!==void 0&&(a.aroundCoord=S.aroundCoord),S.pinchAround!==void 0&&(a.pinchAround=S.pinchAround),S.noInertia&&(a.noInertia=S.noInertia),o.extend(f,T),o.extend(v,R);this._updateMapTransform(a,f,v),this._changes=[]}_updateMapTransform(a,f,v){const S=this._map,T=S.transform,R=Ue=>[Ue.x,Ue.y,Ue.z];if((Ue=>{const rt=this._eventsInProgress.drag;return rt&&!this._handlersById[rt.handlerName].isActive()})()&&!Ga(a)){const Ue=T.zoom;T.cameraElevationReference="sea",T.recenterOnTerrain(),T.cameraElevationReference="ground",Ue!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&S._stop(!0),!Ga(a))return void this._fireEvents(f,v,!0);let{panDelta:B,zoomDelta:G,bearingDelta:J,pitchDelta:ee,around:me,aroundCoord:Ae,pinchAround:Te}=a;T._isCameraConstrained&&(G>0&&(G=0),T._isCameraConstrained=!1),Te!==void 0&&(me=Te),(G||(Ue=>f[Ue]&&!this._eventsInProgress[Ue])("drag"))&&me&&(this._dragOrigin=R(T.pointCoordinate3D(me)),this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",S._stop(!0),me=me||S.transform.centerPoint,J&&(T.bearing+=J),ee&&(T.pitch+=ee),T._updateCameraState();const He=[0,0,0];if(B)if(T.projection.name==="mercator"){const Ue=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(me).dir),rt=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(me.sub(B)).dir);He[0]=rt[0]-Ue[0],He[1]=rt[1]-Ue[1]}else{const Ue=T.pointCoordinate(me);if(T.projection.name==="globe"){B=B.rotate(-T.angle);const rt=T._pixelsPerMercatorPixel/T.worldSize;He[0]=-B.x*o.mercatorScale(o.latFromMercatorY(Ue.y))*rt,He[1]=-B.y*o.mercatorScale(T.center.lat)*rt}else{const rt=T.pointCoordinate(me.sub(B));Ue&&rt&&(He[0]=rt.x-Ue.x,He[1]=rt.y-Ue.y)}}const je=T.zoom,We=[0,0,0];if(G){const Ue=R(Ae||T.pointCoordinate3D(me)),rt={dir:o.normalize([],o.sub([],Ue,T._camera.position))};if(rt.dir[2]<0){const st=T.zoomDeltaToMovement(Ue,G);o.scale$2(We,rt.dir,st)}}const ve=o.add(He,He,We);T._translateCameraConstrained(ve),G&&Math.abs(T.zoom-je)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(f,v,!0)}_fireEvents(a,f,v){const S=$a(this._eventsInProgress),T=$a(a),R={};for(const ee in a){const{originalEvent:me}=a[ee];this._eventsInProgress[ee]||(R[`${ee}start`]=me),this._eventsInProgress[ee]=a[ee]}!S&&T&&this._fireEvent("movestart",T.originalEvent);for(const ee in R)this._fireEvent(ee,R[ee]);T&&this._fireEvent("move",T.originalEvent);for(const ee in a){const{originalEvent:me}=a[ee];this._fireEvent(ee,me)}const B={};let G;for(const ee in this._eventsInProgress){const{handlerName:me,originalEvent:Ae}=this._eventsInProgress[ee];this._handlersById[me].isActive()||(delete this._eventsInProgress[ee],G=f[me]||Ae,B[`${ee}end`]=G)}for(const ee in B)this._fireEvent(ee,B[ee]);const J=$a(this._eventsInProgress);if(v&&(S||T)&&!J){this._updatingCamera=!0;const ee=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),me=Ae=>Ae!==0&&-this._bearingSnap<Ae&&Ae<this._bearingSnap;ee?(me(ee.bearing||this._map.getBearing())&&(ee.bearing=0),this._map.easeTo(ee,{originalEvent:G})):(this._map.fire(new o.Event("moveend",{originalEvent:G})),me(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,f){this._map.fire(new o.Event(a,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((a=>{this._frameId=void 0,this.handleEvent(new Pl("renderFrame",{timeStamp:a})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ia="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class bh extends o.Evented{constructor(a,f){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=f.respectPrefersReducedMotion!==!1,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,f){return this.jumpTo({center:a},f)}panBy(a,f,v){return a=o.Point.convert(a).mult(-1),this.panTo(this.transform.center,o.extend({offset:a},f),v)}panTo(a,f,v){return this.easeTo(o.extend({center:a},f),v)}getZoom(){return this.transform.zoom}setZoom(a,f){return this.jumpTo({zoom:a},f),this}zoomTo(a,f,v){return this.easeTo(o.extend({zoom:a},f),v)}zoomIn(a,f){return this.zoomTo(this.getZoom()+1,a,f),this}zoomOut(a,f){return this.zoomTo(this.getZoom()-1,a,f),this}getBearing(){return this.transform.bearing}setBearing(a,f){return this.jumpTo({bearing:a},f),this}getPadding(){return this.transform.padding}setPadding(a,f){return this.jumpTo({padding:a},f),this}rotateTo(a,f,v){return this.easeTo(o.extend({bearing:a},f),v)}resetNorth(a,f){return this.rotateTo(0,o.extend({duration:1e3},a),f),this}resetNorthPitch(a,f){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},a),f),this}snapToNorth(a,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,f):this}getPitch(){return this.transform.pitch}setPitch(a,f){return this.jumpTo({pitch:a},f),this}cameraForBounds(a,f){a=o.LngLatBounds.convert(a);const v=f&&f.bearing||0,S=f&&f.pitch||0,T=a.getNorthWest(),R=a.getSouthEast();return this._cameraForBounds(this.transform,T,R,v,S,f)}_extendCameraOptions(a){const f={top:0,bottom:0,right:0,left:0};if(typeof(a=o.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=="number"){const v=a.padding;a.padding={top:v,bottom:v,right:v,left:v}}return a.padding=o.extend(f,a.padding),a}_minimumAABBFrustumDistance(a,f){const v=f.max[0]-f.min[0],S=f.max[1]-f.min[1];return v/S>a.aspect?v/(2*Math.tan(.5*a.fovX)*a.aspect):S/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,f,v,S,T,R){const B=a.clone(),G=this._extendCameraOptions(R);B.bearing=S,B.pitch=T;const J=o.LngLat.convert(f),ee=o.LngLat.convert(v),me=.5*(J.lat+ee.lat),Ae=.5*(J.lng+ee.lng),Te=o.latLngToECEF(me,Ae),He=o.normalize([],Te),je=o.normalize([],o.cross([],He,[0,1,0])),We=o.cross([],je,He),ve=[je[0],je[1],je[2],0,We[0],We[1],We[2],0,He[0],He[1],He[2],0,0,0,0,1],Ue=[Te,o.latLngToECEF(J.lat,J.lng),o.latLngToECEF(ee.lat,J.lng),o.latLngToECEF(ee.lat,ee.lng),o.latLngToECEF(J.lat,ee.lng),o.latLngToECEF(me,J.lng),o.latLngToECEF(me,ee.lng),o.latLngToECEF(J.lat,Ae),o.latLngToECEF(ee.lat,Ae)];let rt=o.Aabb.fromPoints(Ue.map((_n=>[o.dot(je,_n),o.dot(We,_n),o.dot(He,_n)])));const st=o.transformMat4([],rt.center,ve);o.squaredLength(st)===0&&o.set(st,0,0,1),o.normalize(st,st),o.scale$2(st,st,o.GLOBE_RADIUS),B.center=o.ecefToLatLng(st);const bt=B.getWorldToCameraMatrix(),wt=o.invert(new Float64Array(16),bt);rt=o.Aabb.applyTransform(rt,o.multiply([],bt,ve)),o.transformMat4(st,st,bt);const vt=.5*(rt.max[2]-rt.min[2]),At=this._minimumAABBFrustumDistance(B,rt),kt=o.scale$2([],[0,0,1],vt),Vt=o.add(kt,st,kt),gn=At+(B.pitch===0?0:o.distance(st,Vt)),Ut=B.globeCenterInViewSpace,un=o.sub([],st,[Ut[0],Ut[1],Ut[2]]);o.normalize(un,un),o.scale$2(un,un,gn);const $t=o.add([],st,un);o.transformMat4($t,$t,wt);const In=o.earthRadius/o.GLOBE_RADIUS,jt=o.length($t),sn=o.mercatorZfromAltitude(Math.max(jt*In-o.earthRadius,Number.EPSILON),0),Cn=Math.min(B.zoomFromMercatorZAdjusted(sn),G.maxZoom);return Cn>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(B.setProjection({name:"mercator"}),B.zoom=Cn,this._cameraForBounds(B,f,v,S,T,R)):{center:B.center,zoom:Cn,bearing:S,pitch:T}}queryTerrainElevation(a,f){const v=this.transform.elevation;return v?(f=o.extend({},{exaggerated:!0},f),v.getAtPoint(o.MercatorCoordinate.fromLngLat(a),null,f.exaggerated)):null}_cameraForBounds(a,f,v,S,T,R){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,f,v,S,T,R);const B=a.clone(),G=this._extendCameraOptions(R),J=B.padding;B.bearing=S,B.pitch=T;const ee=o.LngLat.convert(f),me=o.LngLat.convert(v),Ae=new o.LngLat(ee.lng,me.lat),Te=new o.LngLat(me.lng,ee.lat),He=B.project(ee),je=B.project(me),We=this.queryTerrainElevation(ee),ve=this.queryTerrainElevation(me),Ue=this.queryTerrainElevation(Ae),rt=this.queryTerrainElevation(Te),st=[[He.x,He.y,Math.min(We||0,ve||0,Ue||0,rt||0)],[je.x,je.y,Math.max(We||0,ve||0,Ue||0,rt||0)]];let bt=o.Aabb.fromPoints(st);const wt=B.getWorldToCameraMatrix(),vt=o.invert(new Float64Array(16),wt);bt=o.Aabb.applyTransform(bt,wt);const At=o.sub([],bt.max,bt.min),kt=J.left||0,Vt=J.right||0,gn=J.bottom||0,Ut=J.top||0,{left:un,right:$t,top:In,bottom:jt}=G.padding,sn=.5*(kt+Vt),Cn=.5*(Ut+gn),_n=Math.min(B.scaleZoom(B.scale*Math.min((B.width-(kt+Vt+un+$t))/At[0],(B.height-(gn+Ut+jt+In))/At[1])),G.maxZoom),Mn=B.scale/B.zoomScale(_n);bt=new o.Aabb([bt.min[0]-(un+sn)*Mn,bt.min[1]-(jt+Cn)*Mn,bt.min[2]],[bt.max[0]+($t+sn)*Mn,bt.max[1]+(In+Cn)*Mn,bt.max[2]]);const cr=.5*At[2],kr=this._minimumAABBFrustumDistance(B,bt),er=[0,0,1,0];o.transformMat4$1(er,er,wt),o.normalize$2(er,er);const ar=o.scale$2([],er,kr+cr),Wr=o.add([],bt.center,ar),hi=(typeof G.offset.x=="number"&&typeof G.offset.y=="number"?new o.Point(G.offset.x,G.offset.y):o.Point.convert(G.offset)).rotate(-o.degToRad(S));bt.center[0]-=hi.x*Mn,bt.center[1]+=hi.y*Mn,o.transformMat4(bt.center,bt.center,vt),o.transformMat4(Wr,Wr,vt);const _r=[bt.center[0],bt.center[1],Wr[2]*B.pixelsPerMeter];o.scale$2(_r,_r,1/B.worldSize);const Ti=o.lngFromMercatorX(_r[0]),Ii=o.latFromMercatorY(_r[1]),yo=Math.min(B._zoomFromMercatorZ(_r[2]),G.maxZoom),co=new o.LngLat(Ti,Ii);return B.mercatorFromTransition&&yo<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(B.setProjection({name:"globe"}),B.zoom=yo,this._cameraForBounds(B,f,v,S,T,R)):{center:co,zoom:yo,bearing:S,pitch:T}}fitBounds(a,f,v){const S=this.cameraForBounds(a,f);return this._fitInternal(S,f,v)}fitScreenCoordinates(a,f,v,S,T){const R=o.Point.convert(a),B=o.Point.convert(f),G=new o.Point(Math.min(R.x,B.x),Math.min(R.y,B.y)),J=new o.Point(Math.max(R.x,B.x),Math.max(R.y,B.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(R,B))return this;const ee=this.transform.pointLocation3D(G),me=this.transform.pointLocation3D(J),Ae=this.transform.pointLocation3D(new o.Point(G.x,J.y)),Te=this.transform.pointLocation3D(new o.Point(J.x,G.y)),He=[Math.min(ee.lng,me.lng,Ae.lng,Te.lng),Math.min(ee.lat,me.lat,Ae.lat,Te.lat)],je=[Math.max(ee.lng,me.lng,Ae.lng,Te.lng),Math.max(ee.lat,me.lat,Ae.lat,Te.lat)],We=S&&S.pitch?S.pitch:this.getPitch(),ve=this._cameraForBounds(this.transform,He,je,v,We,S);return this._fitInternal(ve,S,T)}_fitInternal(a,f,v){return a?(delete(f=o.extend(a,f)).padding,f.linear?this.easeTo(f,v):this.flyTo(f,v)):this}jumpTo(a,f){this.stop();const v=a.preloadOnly?this.transform.clone():this.transform;let S=!1,T=!1,R=!1;return"zoom"in a&&v.zoom!==+a.zoom&&(S=!0,v.zoom=+a.zoom),a.center!==void 0&&(v.center=o.LngLat.convert(a.center)),"bearing"in a&&v.bearing!==+a.bearing&&(T=!0,v.bearing=+a.bearing),"pitch"in a&&v.pitch!==+a.pitch&&(R=!0,v.pitch=+a.pitch),a.padding==null||v.isPaddingEqual(a.padding)||(v.padding=a.padding),a.preloadOnly?(this._preloadTiles(v),this):(this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f)),S&&this.fire(new o.Event("zoomstart",f)).fire(new o.Event("zoom",f)).fire(new o.Event("zoomend",f)),T&&this.fire(new o.Event("rotatestart",f)).fire(new o.Event("rotate",f)).fire(new o.Event("rotateend",f)),R&&this.fire(new o.Event("pitchstart",f)).fire(new o.Event("pitch",f)).fire(new o.Event("pitchend",f)),this.fire(new o.Event("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(Ia),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,f){const v=this.transform;if(!v.projection.supportsFreeCamera)return o.warnOnce(Ia),this;this.stop();const S=v.zoom,T=v.pitch,R=v.bearing;v.setFreeCameraOptions(a);const B=S!==v.zoom,G=T!==v.pitch,J=R!==v.bearing;return this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f)),B&&this.fire(new o.Event("zoomstart",f)).fire(new o.Event("zoom",f)).fire(new o.Event("zoomend",f)),J&&this.fire(new o.Event("rotatestart",f)).fire(new o.Event("rotate",f)).fire(new o.Event("rotateend",f)),G&&this.fire(new o.Event("pitchstart",f)).fire(new o.Event("pitch",f)).fire(new o.Event("pitchend",f)),this.fire(new o.Event("moveend",f)),this}easeTo(a,f){this._stop(!1,a.easeId),((a=o.extend({offset:[0,0],duration:500,easing:o.ease},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);const v=this.transform,S=this.getZoom(),T=this.getBearing(),R=this.getPitch(),B=this.getPadding(),G="zoom"in a?+a.zoom:S,J="bearing"in a?this._normalizeBearing(a.bearing,T):T,ee="pitch"in a?+a.pitch:R,me="padding"in a?a.padding:v.padding,Ae=o.Point.convert(a.offset);let Te,He,je;if(v.projection.name==="globe"){const kt=o.MercatorCoordinate.fromLngLat(v.center),Vt=Ae.rotate(-v.angle);kt.x+=Vt.x/v.worldSize,kt.y+=Vt.y/v.worldSize;const gn=kt.toLngLat(),Ut=o.LngLat.convert(a.center||gn);this._normalizeCenter(Ut),Te=v.centerPoint.add(Vt),He=new o.Point(kt.x,kt.y).mult(v.worldSize),je=new o.Point(o.mercatorXfromLng(Ut.lng),o.mercatorYfromLat(Ut.lat)).mult(v.worldSize).sub(He)}else{Te=v.centerPoint.add(Ae);const kt=v.pointLocation(Te),Vt=o.LngLat.convert(a.center||kt);this._normalizeCenter(Vt),He=v.project(kt),je=v.project(Vt).sub(He)}const We=v.zoomScale(G-S);let ve,Ue;a.around&&(ve=o.LngLat.convert(a.around),Ue=v.locationPoint(ve));const rt=this._zooming||G!==S,st=this._rotating||T!==J,bt=this._pitching||ee!==R,wt=!v.isPaddingEqual(me),vt=kt=>Vt=>{if(rt&&(kt.zoom=o.number(S,G,Vt)),st&&(kt.bearing=o.number(T,J,Vt)),bt&&(kt.pitch=o.number(R,ee,Vt)),wt&&(kt.interpolatePadding(B,me,Vt),Te=kt.centerPoint.add(Ae)),ve)kt.setLocationAtPoint(ve,Ue);else{const gn=kt.zoomScale(kt.zoom-S),Ut=G>S?Math.min(2,We):Math.max(.5,We),un=Math.pow(Ut,1-Vt),$t=kt.unproject(He.add(je.mult(Vt*un)).mult(gn));kt.setLocationAtPoint(kt.renderWorldCopies?$t.wrap():$t,Te)}return a.preloadOnly||this._fireMoveEvents(f),kt};if(a.preloadOnly){const kt=this._emulate(vt,a.duration,v);return this._preloadTiles(kt),this}const At={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=rt,this._rotating=st,this._pitching=bt,this._padding=wt,this._easeId=a.easeId,this._prepareEase(f,a.noMoveStart,At),this._ease(vt(v),(kt=>{v.recenterOnTerrain(),this._afterEase(f,kt)}),a),this}_prepareEase(a,f,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",f||v.moving||this.fire(new o.Event("movestart",a)),this._zooming&&!v.zooming&&this.fire(new o.Event("zoomstart",a)),this._rotating&&!v.rotating&&this.fire(new o.Event("rotatestart",a)),this._pitching&&!v.pitching&&this.fire(new o.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new o.Event("move",a)),this._zooming&&this.fire(new o.Event("zoom",a)),this._rotating&&this.fire(new o.Event("rotate",a)),this._pitching&&this.fire(new o.Event("pitch",a))}_afterEase(a,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,S=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new o.Event("zoomend",a)),S&&this.fire(new o.Event("rotateend",a)),T&&this.fire(new o.Event("pitchend",a)),this.fire(new o.Event("moveend",a))}flyTo(a,f){if(this._prefersReducedMotion(a)){const _n=o.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(_n,f)}this.stop(),a=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},a);const v=this.transform,S=this.getZoom(),T=this.getBearing(),R=this.getPitch(),B=this.getPadding(),G="zoom"in a?o.clamp(+a.zoom,v.minZoom,v.maxZoom):S,J="bearing"in a?this._normalizeBearing(a.bearing,T):T,ee="pitch"in a?+a.pitch:R,me="padding"in a?a.padding:v.padding,Ae=v.zoomScale(G-S),Te=o.Point.convert(a.offset);let He=v.centerPoint.add(Te);const je=v.pointLocation(He),We=o.LngLat.convert(a.center||je);this._normalizeCenter(We);const ve=v.project(je),Ue=v.project(We).sub(ve);let rt=a.curve;const st=Math.max(v.width,v.height),bt=st/Ae,wt=Ue.mag();if("minZoom"in a){const _n=o.clamp(Math.min(a.minZoom,S,G),v.minZoom,v.maxZoom),Mn=st/v.zoomScale(_n-S);rt=Math.sqrt(Mn/wt*2)}const vt=rt*rt;function At(_n){const Mn=(bt*bt-st*st+(_n?-1:1)*vt*vt*wt*wt)/(2*(_n?bt:st)*vt*wt);return Math.log(Math.sqrt(Mn*Mn+1)-Mn)}function kt(_n){return(Math.exp(_n)-Math.exp(-_n))/2}function Vt(_n){return(Math.exp(_n)+Math.exp(-_n))/2}const gn=At(0);let Ut=function(_n){return Vt(gn)/Vt(gn+rt*_n)},un=function(_n){return st*((Vt(gn)*(kt(Mn=gn+rt*_n)/Vt(Mn))-kt(gn))/vt)/wt;var Mn},$t=(At(1)-gn)/rt;if(Math.abs(wt)<1e-6||!isFinite($t)){if(Math.abs(st-bt)<1e-6)return this.easeTo(a,f);const _n=bt<st?-1:1;$t=Math.abs(Math.log(bt/st))/rt,un=function(){return 0},Ut=function(Mn){return Math.exp(_n*rt*Mn)}}a.duration="duration"in a?+a.duration:1e3*$t/("screenSpeed"in a?+a.screenSpeed/rt:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const In=T!==J,jt=ee!==R,sn=!v.isPaddingEqual(me),Cn=_n=>Mn=>{const cr=Mn*$t,kr=1/Ut(cr);_n.zoom=Mn===1?G:S+_n.scaleZoom(kr),In&&(_n.bearing=o.number(T,J,Mn)),jt&&(_n.pitch=o.number(R,ee,Mn)),sn&&(_n.interpolatePadding(B,me,Mn),He=_n.centerPoint.add(Te));const er=Mn===1?We:_n.unproject(ve.add(Ue.mult(un(cr))).mult(kr));return _n.setLocationAtPoint(_n.renderWorldCopies?er.wrap():er,He),_n._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(f),_n};if(a.preloadOnly){const _n=this._emulate(Cn,a.duration,v);return this._preloadTiles(_n),this}return this._zooming=!0,this._rotating=In,this._pitching=jt,this._padding=sn,this._prepareEase(f,!1),this._ease(Cn(v),(()=>this._afterEase(f)),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,f)}if(!a){const v=this.handlers;v&&v.stop(!1)}return this}_ease(a,f,v){v.animate===!1||v.duration===0?(a(1),f()):(this._easeStart=o.exported.now(),this._easeOptions=v,this._onEaseFrame=a,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,f){a=o.wrap(a,-180,180);const v=Math.abs(a-f);return Math.abs(a-360-f)<v&&(a-=360),Math.abs(a+360-f)<v&&(a+=360),a}_normalizeCenter(a){const f=this.transform;if(!f.renderWorldCopies||f.maxBounds)return;const v=a.lng-f.center.lng;a.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&o.exported.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,f,v){const S=Math.ceil(15*f/1e3),T=[],R=a(v.clone());for(let B=0;B<=S;B++){const G=R(B/S);T.push(G.clone())}return T}}class sr{constructor(a={}){this.options=a,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const f=this.options&&this.options.compact;return this._map=a,this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=M("button","mapboxgl-ctrl-attrib-button",this._container),M("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=M("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,f){const v=this._map._getUIString(`AttributionControl.${f}`);a.setAttribute("aria-label",v),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(a){const v=f.reduce(((S,T,R)=>(T.value&&(S+=`${T.key}=${T.value}${R<f.length-1?"&":""}`),S)),"?");a.href=`${o.config.FEEDBACK_URL}/${v}#${kc(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const S=this._map.style.stylesheet;this.styleOwner=S.owner,this.styleId=S.id}const f=this._map.style._sourceCaches;for(const S in f){const T=f[S];if(T.used){const R=T.getSource();R.attribution&&a.indexOf(R.attribution)<0&&a.push(R.attribution)}}a.sort(((S,T)=>S.length-T.length)),a=a.filter(((S,T)=>{for(let R=T+1;R<a.length;R++)if(a[R].indexOf(S)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const v=a.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,a.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class kh{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=M("div","mapboxgl-ctrl");const f=M("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(const f in a){const v=a[f].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const f=a[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class C{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const f=++this._id;return this._queue.push({callback:a,id:f,cancelled:!1}),f}remove(a){const f=this._currentlyRunning,v=f?this._queue.concat(f):this._queue;for(const S of v)if(S.id===a)return void(S.cancelled=!0)}run(a=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const v of f)if(!v.cancelled&&(v.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function F(y,a,f){if(y=new o.LngLat(y.lng,y.lat),a){const v=new o.LngLat(y.lng-360,y.lat),S=new o.LngLat(y.lng+360,y.lat),T=360*Math.ceil(Math.abs(y.lng-f.center.lng)/360),R=f.locationPoint(y).distSqr(a),B=a.x<0||a.y<0||a.x>f.width||a.y>f.height;f.locationPoint(v).distSqr(a)<R&&(B||Math.abs(v.lng-f.center.lng)<T)?y=v:f.locationPoint(S).distSqr(a)<R&&(B||Math.abs(S.lng-f.center.lng)<T)&&(y=S)}for(;Math.abs(y.lng-f.center.lng)>180;){const v=f.locationPoint(y);if(v.x>=0&&v.y>=0&&v.x<=f.width&&v.y<=f.height)break;y.lng>f.center.lng?y.lng-=360:y.lng+=360}return y}const Y={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ie extends o.Evented{constructor(a,f){if(super(),(a instanceof o.window.HTMLElement||f)&&(a=o.extend({element:a},f)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=o.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=M("div");const S=41,T=27,R=se("svg",{display:"block",height:S*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${S}`},this._element),B=se("radialGradient",{id:"shadowGradient"},se("defs",{},R));se("stop",{offset:"10%","stop-opacity":.4},B),se("stop",{offset:"100%","stop-opacity":.05},B),se("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},R),se("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},R),se("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},R),se("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},R),this._offset=o.Point.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(S=>{S.preventDefault()})),this._element.addEventListener("mousedown",(S=>{S.preventDefault()}));const v=this._element.classList;for(const S in Y)v.remove(`mapboxgl-marker-anchor-${S}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=o.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const S=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[S,-1*(38.1-13.5+S)],"bottom-right":[-S,-1*(38.1-13.5+S)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const f=a.code,v=a.charCode||a.keyCode;f!=="Space"&&f!=="Enter"&&v!==32&&v!==13||this.togglePopup()}_onMapClick(a){const f=a.originalEvent.target,v=this._element;this._popup&&(f===v||v.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,f=this._pos;if(!a||!f)return!1;const v=a.unproject(f),S=a.getFreeCameraOptions();if(!S.position)return!1;const T=S.position.toLngLat();return T.distanceTo(v)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const f=this._pos;if(!f||f.x<0||f.x>a.transform.width||f.y<0||f.y>a.transform.height)return void this._clearFadeTimer();const v=a.unproject(f);let S;a._showingGlobe()&&o.isLngLatBehindGlobe(a.transform,this._lngLat)?S=0:(S=1-a._queryFogOpacity(v),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(S*=this._occludedOpacity)),this._element.style.opacity=`${S}`,this._element.style.pointerEvents=S>0?"auto":"none",this._popup&&this._popup._setOpacity(S),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${Y[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${f.x}px,${f.y}px)
        `}_calculateXYTransform(){const a=this._pos,f=this._map,v=this.getPitchAlignment();if(!f||!a||v!=="map")return"";if(!f._showingGlobe()){const G=f.getPitch();return G?`rotateX(${G}deg)`:""}const S=o.radToDeg(o.globeTiltAtLngLat(f.transform,this._lngLat)),T=a.sub(o.globeCenterToScreenPoint(f.transform)),R=Math.abs(T.x)+Math.abs(T.y);if(R===0)return"";const B=S/R;return`rotateX(${-T.y*B}deg) rotateY(${T.x*B}deg)`}_calculateZTransform(){const a=this._pos,f=this._map;if(!f||!a)return"";let v=0;const S=this.getRotationAlignment();if(S==="map")if(f._showingGlobe()){const T=f.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),R=f.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(T);v=o.radToDeg(Math.atan2(R.y,R.x))-90}else v=-f.getBearing();else if(S==="horizon"){const T=o.smoothstep(4,6,f.getZoom()),R=o.globeCenterToScreenPoint(f.transform);R.y+=T*f.transform.height;const B=a.sub(R),G=o.radToDeg(Math.atan2(B.y,B.x));v=(G>90?G-270:G+90)*(1-T)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(a){o.window.cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=F(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),a===!0?this._updateFrameId=o.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),f._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(a){return this._offset=o.Point.convert(a),this._update(),this}_onMove(a){const f=this._map;if(!f)return;const v=this._pointerdownPos,S=this._positionDelta;if(v&&S){if(!this._isDragging){const T=this._clickTolerance||f._clickTolerance;if(a.point.dist(v)<T)return;this._isDragging=!0}this._pos=a.point.sub(S),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(a){const f=this._map,v=this._pos;f&&v&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(v),this._pointerdownPos=a.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const f=this._map;return f&&(a?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ce={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Be=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function qe(y=new o.Point(0,0),a="bottom"){if(typeof y=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(y,2)));switch(a){case"top":return new o.Point(0,y);case"top-left":return new o.Point(f,f);case"top-right":return new o.Point(-f,f);case"bottom":return new o.Point(0,-y);case"bottom-left":return new o.Point(f,-f);case"bottom-right":return new o.Point(-f,-f);case"left":return new o.Point(y,0);case"right":return new o.Point(-y,0)}return new o.Point(0,0)}return y instanceof o.Point||Array.isArray(y)?o.Point.convert(y):o.Point.convert(y[a]||[0,0])}class Ke{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const f=o.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,f,v){this._start=this.getValue(f),this._end=a,this._startTime=f,this._endTime=f+v}}const Je={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},dt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Dt={showCompass:!0,showZoom:!0,visualizePitch:!1};class Qt{constructor(a,f,v=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new Ta({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,v&&(this.mousePitch=new Da({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(a,f){this.mouseRotate.mousedown(a,f),this.mousePitch&&this.mousePitch.mousedown(a,f),oe()}move(a,f){const v=this.map,S=this.mouseRotate.mousemoveWindow(a,f),T=S&&S.bearingDelta;if(T&&v.setBearing(v.getBearing()+T),this.mousePitch){const R=this.mousePitch.mousemoveWindow(a,f),B=R&&R.pitchDelta;B&&v.setPitch(v.getPitch()+B)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ye(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(o.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),Ve(this.element,a)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,Ve(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=de(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=de(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ft={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ot={maxWidth:100,unit:"metric"},Kt={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Sn={version:o.version,supported:I,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends bh{constructor(y){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(y=o.extend({},dt,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(y.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(y.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Aa(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),y),this._interactive=y.interactive,this._minTileCacheSize=y.minTileCacheSize,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._useWebGL2=y.useWebGL2,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=y.crossSourceCollisions,this._collectResourceTiming=y.collectResourceTiming,this._optimizeForTerrain=y.optimizeForTerrain,this._language=this._parseLanguage(y.language),this._worldview=y.worldview,this._renderTaskQueue=new C,this._domRenderTaskQueue=new C,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Je,y.locale),this._clickTolerance=y.clickTolerance,this._cooperativeGestures=y.cooperativeGestures,this._performanceMetricsCollection=y.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ke(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(y.transformRequest,y.accessToken,y.testMode),this._silenceAuthErrors=!!y.testMode,typeof y.container=="string"){if(this._container=o.window.document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),y.maxBounds&&this.setMaxBounds(y.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Dc(this,y),this._localFontFamily=y.localFontFamily,this._localIdeographFontFamily=y.localIdeographFontFamily,y.style&&this.setStyle(y.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),y.projection&&this.setProjection(y.projection),this._hash=y.hash&&new Vh(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,o.extend({},y.fitBoundsOptions,{duration:0})))),this.resize(),y.attributionControl&&this.addControl(new sr({customAttribution:y.customAttribution})),this._logoControl=new kh,this.addControl(this._logoControl,y.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(a=>{this._update(a.dataType==="style"),this.fire(new o.Event(`${a.dataType}data`,a))})),this.on("dataloading",(a=>{this.fire(new o.Event(`${a.dataType}dataloading`,a))}))}_getMapId(){return this._mapId}addControl(y,a){if(a===void 0&&(a=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=y.onAdd(this);this._controls.push(y);const v=this._controlPositions[a];return a.indexOf("bottom")!==-1?v.insertBefore(f,v.firstChild):v.appendChild(f),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(y);return a>-1&&this._controls.splice(a,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(y){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new o.Event("movestart",y)).fire(new o.Event("move",y)),this.fire(new o.Event("resize",y)),a&&this.fire(new o.Event("moveend",y)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(y){return this.transform.setMaxBounds(o.LngLatBounds.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y?this.setZoom(y):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y?this.setZoom(y):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y?this.setPitch(y):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y?this.setPitch(y):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(y){return y==="auto"?o.window.navigator.language:Array.isArray(y)?y.length===0?void 0:y.map((a=>a==="auto"?o.window.navigator.language:a)):y}setLanguage(y){const a=this._parseLanguage(y);if(!this.style||a===this._language)return this;this._language=a,this.style._reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(y){return this.style&&y!==this._worldview?(this._worldview=y,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(y){return this._lazyInitEmptyStyle(),y?typeof y=="string"&&(y={name:y}):y=null,this._useExplicitProjection=!!y,this._prioritizeAndUpdateProjection(y,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const y=this.transform,a=y.projection.name;let f;a==="globe"&&y.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(y.setMercatorFromTransition(),f=!0):a==="mercator"&&y.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(y.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(y,a){return this._updateProjection(y||a||{name:"mercator"})}_updateProjection(y){let a;if(a=y.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(y),this.style.applyProjectionUpdate(),a){this.painter.clearBackgroundTiles();for(const f in this.style._sourceCaches)this.style._sourceCaches[f].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(y){return this.transform.locationPoint3D(o.LngLat.convert(y))}unproject(y){return this.transform.pointLocation3D(o.Point.convert(y))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(y,a,f){if(y==="mouseenter"||y==="mouseover"){let v=!1;const S=R=>{const B=a.filter((J=>this.getLayer(J))),G=B.length?this.queryRenderedFeatures(R.point,{layers:B}):[];G.length?v||(v=!0,f.call(this,new ya(y,this,R.originalEvent,{features:G}))):v=!1},T=()=>{v=!1};return{layers:new Set(a),listener:f,delegates:{mousemove:S,mouseout:T}}}if(y==="mouseleave"||y==="mouseout"){let v=!1;const S=R=>{const B=a.filter((G=>this.getLayer(G)));(B.length?this.queryRenderedFeatures(R.point,{layers:B}):[]).length?v=!0:v&&(v=!1,f.call(this,new ya(y,this,R.originalEvent)))},T=R=>{v&&(v=!1,f.call(this,new ya(y,this,R.originalEvent)))};return{layers:new Set(a),listener:f,delegates:{mousemove:S,mouseout:T}}}{const v=S=>{const T=a.filter((B=>this.getLayer(B))),R=T.length?this.queryRenderedFeatures(S.point,{layers:T}):[];R.length&&(S.features=R,f.call(this,S),delete S.features)};return{layers:new Set(a),listener:f,delegates:{[y]:v}}}}on(y,a,f){if(f===void 0)return super.on(y,a);Array.isArray(a)||(a=[a]);const v=this._createDelegatedListener(y,a,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(v);for(const S in v.delegates)this.on(S,v.delegates[S]);return this}once(y,a,f){if(f===void 0)return super.once(y,a);Array.isArray(a)||(a=[a]);const v=this._createDelegatedListener(y,a,f);for(const S in v.delegates)this.once(S,v.delegates[S]);return this}off(y,a,f){if(f===void 0)return super.off(y,a);a=new Set(Array.isArray(a)?a:[a]);const v=(T,R)=>{if(T.size!==R.size)return!1;for(const B of T)if(!R.has(B))return!1;return!0},S=this._delegatedListeners?this._delegatedListeners[y]:void 0;return S&&(T=>{for(let R=0;R<T.length;R++){const B=T[R];if(B.listener===f&&v(B.layers,a)){for(const G in B.delegates)this.off(G,B.delegates[G]);return T.splice(R,1),this}}})(S),this}queryRenderedFeatures(y,a){return this.style?(a!==void 0||y===void 0||y instanceof o.Point||Array.isArray(y)||(a=y,y=void 0),this.style.queryRenderedFeatures(y=y||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(y,a){return this.style.querySourceFeatures(y,a)}isPointOnSurface(y){const{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&o.warnOnce(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.Point.convert(y))}setStyle(y,a){return(a=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&y?(this._diffStyle(y,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(y,a))}_getUIString(y){const a=this._locale[y];if(a==null)throw new Error(`Missing UI string '${y}'`);return a}_updateStyle(y,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),y&&(this.style=new si(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y):this.style.loadJSON(y)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new si(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,a){if(typeof y=="string"){const f=this._requestManager.normalizeStyleURL(y),v=this._requestManager.transformRequest(f,o.ResourceType.Style);o.getJSON(v,((S,T)=>{S?this.fire(new o.ErrorEvent(S)):T&&this._updateDiff(T,a)}))}else typeof y=="object"&&this._updateDiff(y,a)}_updateDiff(y,a){try{this.style.setState(y)&&this._update(!0)}catch(f){o.warnOnce(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(y,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(y,a){return this._lazyInitEmptyStyle(),this.style.addSource(y,a),this._update(!0)}isSourceLoaded(y){return!!this.style&&this.style._isSourceCacheLoaded(y)}areTilesLoaded(){const y=this.style&&this.style._sourceCaches;for(const a in y){const f=y[a]._tiles;for(const v in f){const S=f[v];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}addSourceType(y,a,f){this._lazyInitEmptyStyle(),this.style.addSourceType(y,a,f)}removeSource(y){return this.style.removeSource(y),this._updateTerrain(),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,a,{pixelRatio:f=1,sdf:v=!1,stretchX:S,stretchY:T,content:R}={}){if(this._lazyInitEmptyStyle(),a instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&a instanceof o.window.ImageBitmap){const{width:B,height:G,data:J}=o.exported.getImageData(a);this.style.addImage(y,{data:new o.RGBAImage({width:B,height:G},J),pixelRatio:f,stretchX:S,stretchY:T,content:R,sdf:v,version:0})}else if(a.width===void 0||a.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:B,height:G}=a,J=a;this.style.addImage(y,{data:new o.RGBAImage({width:B,height:G},new Uint8Array(J.data)),pixelRatio:f,stretchX:S,stretchY:T,content:R,sdf:v,version:0,userImage:J}),J.onAdd&&J.onAdd(this,y)}}updateImage(y,a){const f=this.style.getImage(y);if(!f)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=a instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&a instanceof o.window.ImageBitmap?o.exported.getImageData(a):a,{width:S,height:T}=v;S!==void 0&&T!==void 0?S===f.data.width&&T===f.data.height?(f.data.replace(v.data,!(a instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&a instanceof o.window.ImageBitmap)),this.style.updateImage(y,f)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${S}, ${T})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,a){o.getImage(this._requestManager.transformRequest(y,o.ResourceType.Image),((f,v)=>{a(f,v instanceof o.window.HTMLImageElement?o.exported.getImageData(v):v)}))}listImages(){return this.style.listImages()}addLayer(y,a){return this._lazyInitEmptyStyle(),this.style.addLayer(y,a),this._update(!0)}moveLayer(y,a){return this.style.moveLayer(y,a),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}setLayerZoomRange(y,a,f){return this.style.setLayerZoomRange(y,a,f),this._update(!0)}setFilter(y,a,f={}){return this.style.setFilter(y,a,f),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,a,f,v={}){return this.style.setPaintProperty(y,a,f,v),this._update(!0)}getPaintProperty(y,a){return this.style.getPaintProperty(y,a)}setLayoutProperty(y,a,f,v={}){return this.style.setLayoutProperty(y,a,f,v),this._update(!0)}getLayoutProperty(y,a){return this.style.getLayoutProperty(y,a)}setLight(y,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(y){return this._lazyInitEmptyStyle(),!y&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(y),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(y){return this._lazyInitEmptyStyle(),this.style.setFog(y),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(y){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(y),this.transform):0}setFeatureState(y,a){return this.style.setFeatureState(y,a),this._update()}removeFeatureState(y,a){return this.style.removeFeatureState(y,a),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}_updateContainerDimensions(){if(!this._container)return;const y=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let f,v,S,T=this._container;for(;T&&(!v||!S);){const R=o.window.getComputedStyle(T).transform;R&&R!=="none"&&(f=R.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(v=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(S=f[3])),T=T.parentElement}this._containerWidth=v?Math.abs(y/v):y,this._containerHeight=S?Math.abs(a/S):a}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=M("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=M("div","mapboxgl-canvas-container",y);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=M("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=M("div","mapboxgl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((S=>{v[S]=M("div",`mapboxgl-ctrl-${S}`,f)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,a){const f=o.exported.devicePixelRatio||1;this._canvas.width=f*Math.ceil(y),this._canvas.height=f*Math.ceil(a),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${a}px`}_addMarker(y){this._markers.push(y)}_removeMarker(y){const a=this._markers.indexOf(y);a!==-1&&this._markers.splice(a,1)}_addPopup(y){this._popups.push(y)}_removePopup(y){const a=this._popups.indexOf(y);a!==-1&&this._popups.splice(a,1)}_setupPainter(){const y=o.extend({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._useWebGL2&&this._canvas.getContext("webgl2",y),f=a||this._canvas.getContext("webgl",y)||this._canvas.getContext("experimental-webgl",y);f?(this._useWebGL2&&!a&&o.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),o.storeAuthState(f,!0),this.painter=new Ra(f,this.transform,!!a),this.on("data",(v=>{v.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),o.exported$1.testSupport(f)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:y}))}_contextRestored(y){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:y}))}_onMapScroll(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_requestDomTask(y){!this.loaded()||this.loaded()&&!this.isMoving()?y():this._domRenderTaskQueue.add(y)}_render(y){let a;const f=this.painter.context.extTimerQuery,v=o.exported.now();if(this.listens("gpu-timing-frame")&&(a=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(y),this._domRenderTaskQueue.run(y),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,G=this.transform.pitch,J=o.exported.now(),ee=new o.EvaluationParameters(B,{now:J,fadeDuration:S,pitch:G,transition:this.style.getTransition()});this.style.update(ee)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(v),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(v),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const B=o.exported.now()-v;f.endQueryEXT(f.TIME_ELAPSED_EXT,a),setTimeout((()=>{const G=f.getQueryObjectEXT(a,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(a),this.fire(new o.Event("gpu-timing-frame",{cpuTime:B,gpuTime:G})),o.window.performance.mark("frame-gpu",{startTime:v,detail:{gpuTime:G}})}),50)}if(this.listens("gpu-timing-layer")){const B=this.painter.collectGpuTimers();setTimeout((()=>{const G=this.painter.queryGpuTimers(B);this.fire(new o.Event("gpu-timing-layer",{layerTimes:G}))}),50)}if(this.listens("gpu-timing-deferred-render")){const B=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const G=this.painter.queryGpuTimeDeferredRender(B);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:G}))}),50)}const R=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(R||this._repaint)this.triggerRepaint();else{const B=!this.isMoving()&&this.loaded();if(B&&(T=this._updateAverageElevation(v,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),B&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const G=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:G})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(y){for(const a of this._markers)y&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!y||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(y,a=!1){const f=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);if((a||y-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(y)){const v=this.transform.averageElevation;let S=this.transform.sampleAverageElevation(),T=!1;this.transform.elevation&&(T=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=y;const R=Math.abs(v-S);if(R>1){if(this._isInitialLoad||T)return this._averageElevation.jumpTo(S),f(S);this._averageElevation.easeTo(S,y,300)}else if(R>1e-4)return this._averageElevation.jumpTo(S),f(S)}return!!this._averageElevation.isEasing(y)&&f(this._averageElevation.getValue(y))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(y=>{if(y&&(y.message===o.AUTH_ERR_MSG||y.status===401)){const a=this.painter.context.gl;o.storeAuthState(a,!1),this._logoControl instanceof kh&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const y=this._isDragging();this.painter.updateTerrain(this.style,y)}_calculateSpeedIndex(){const y=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const f=this.painter.context.gl,v=f.createFramebuffer();function S(T){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,T,0);const R=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,R),R}return f.bindFramebuffer(f.FRAMEBUFFER,v),this._canvasPixelComparison(S(y),a.canvasCopies.map(S),a.timeStamps)}_canvasPixelComparison(y,a,f){let v=f[1]-f[0];const S=y.length/4;for(let T=0;T<a.length;T++){const R=a[T];let B=0;for(let G=0;G<R.length;G+=4)R[G]===y[G]&&R[G+1]===y[G+1]&&R[G+2]===y[G+2]&&R[G+3]===y[G+3]&&(B+=1);v+=(f[T+2]-f[T+1])*(1-B/S)}return v}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const y=this.painter.context.gl.getExtension("WEBGL_lose_context");y&&y.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(y){this._renderNextFrame=this._renderNextFrame||y,this.style&&!this._frame&&(this._frame=o.exported.frame((a=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(a)})))}_preloadTiles(y){const a=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(a,((f,v)=>f._preloadTiles(y,v)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(y){this._trackResize&&this.resize({originalEvent:y})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(y){this._showTerrainWireframe!==y&&(this._showTerrainWireframe=y,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(y){this._speedIndexTiming!==y&&(this._speedIndexTiming=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(y){this._showTileAABBs!==y&&(this._showTileAABBs=y,y&&this._update())}_setCacheLimits(y,a){o.setCacheLimits(y,a)}get version(){return o.version}},NavigationControl:class{constructor(y){this.options=o.extend({},Dt,y),this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(a=>a.preventDefault())),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(a=>{this._map&&this._map.zoomIn({},{originalEvent:a})})),M("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(a=>{this._map&&this._map.zoomOut({},{originalEvent:a})})),M("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(a=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:a}):f.resetNorth({},{originalEvent:a}))})),this._compassIcon=M("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const y=this._map;if(!y)return;const a=y.getZoom(),f=a===y.getMaxZoom(),v=a===y.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const y=this._map;if(!y)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(y.transform.pitch*(Math.PI/180)),.5)}) rotateX(${y.transform.pitch}deg) rotateZ(${y.transform.angle*(180/Math.PI)}deg)`:`rotate(${y.transform.angle*(180/Math.PI)}deg)`;y._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=a)}))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),y.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&y.on("pitch",this._rotateCompassArrow),y.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qt(y,this._compass,this.options.visualizePitch)),this._container}onRemove(){const y=this._map;y&&(this._container.remove(),this.options.showZoom&&y.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&y.off("pitch",this._rotateCompassArrow),y.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(y,a){const f=M("button",y,this._container);return f.type="button",f.addEventListener("click",a),f}_setButtonTitle(y,a){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${a}`);y.setAttribute("aria-label",f),y.firstElementChild&&y.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends o.Evented{constructor(y){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},ft,y),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Co(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(y){return this._map=y,this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(y){const a=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,y(f)};this._supportsGeolocation!==void 0?y(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then((f=>a(f.state!=="denied"))).catch((()=>a())):a()}_isOutOfMapMaxBounds(y){const a=this._map.getMaxBounds(),f=y.coords;return!!a&&(f.longitude<a.getWest()||f.longitude>a.getEast()||f.latitude<a.getSouth()||f.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(y){if(this._map){if(this._isOutOfMapMaxBounds(y))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",y)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=y,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(y),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(y),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",y)),this._finish()}}_updateCamera(y){const a=new o.LngLat(y.coords.longitude,y.coords.latitude),f=y.coords.accuracy,v=this._map.getBearing(),S=o.extend({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(f),S,{geolocateSource:!0})}_updateMarker(y){if(y){const a=new o.LngLat(y.coords.longitude,y.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=y.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const y=this._map.transform,a=o.mercatorZfromAltitude(1,y._center.lat)*y.worldSize,f=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(y){if(this._map){if(this.options.trackUserLocation)if(y.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(y.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",y)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(y){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(a=>a.preventDefault())),this._geolocateButton=M("button","mapboxgl-ctrl-geolocate",this._container),M("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",y===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=M("div","mapboxgl-user-location"),this._dotElement.appendChild(M("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(M("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ie({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=M("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ie({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))}))}}_onDeviceOrientation(y){this._userLocationDotMarker&&(y.webkitCompassHeading?this._heading=y.webkitCompassHeading:y.absolute===!0&&(this._heading=-1*y.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(y={maximumAge:6e5,timeout:0},this._noTimeout=!0):(y=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,y),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const y=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((a=>{a==="granted"&&y()})).catch(console.error):y()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:sr,ScaleControl:class{constructor(y){this.options=o.extend({},Ot,y),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const y=this.options.maxWidth||100,a=this._map,f=a._containerHeight/2,v=a._containerWidth/2-y/2,S=a.unproject([v,f]),T=a.unproject([v+y,f]),R=S.distanceTo(T);if(this.options.unit==="imperial"){const B=3.2808*R;B>5280?this._setScale(y,B/5280,"mile"):this._setScale(y,B,"foot")}else this.options.unit==="nautical"?this._setScale(y,R/1852,"nautical-mile"):R>=1e3?this._setScale(y,R/1e3,"kilometer"):this._setScale(y,R,"meter")}_setScale(y,a,f){this._map._requestDomTask((()=>{const v=(function(T){const R=Math.pow(10,`${Math.floor(T)}`.length-1);let B=T/R;return B=B>=10?10:B>=5?5:B>=3?3:B>=2?2:B>=1?1:(function(G){const J=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*J)/J})(B),R*B})(a),S=v/a;this._container.innerHTML=this._isNumberFormatSupported&&f!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(v):`${v}&nbsp;${Kt[f]}`,this._container.style.width=y*S+"px"}))}onAdd(y){return this._map=y,this._language=y.getLanguage(),this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-scale",y.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(y){this._language=y,this._update()}setUnit(y){this.options.unit=y,this._update()}},FullscreenControl:class{constructor(y){this._fullscreen=!1,y&&y.container&&(y.container instanceof o.window.HTMLElement?this._container=y.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=M("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const y=this._fullscreenButton=M("button","mapboxgl-ctrl-fullscreen",this._controlContainer);M("span","mapboxgl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",y)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(y){super(),this.options=o.extend(Object.create(Ce),y),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(y&&y.className?y.className.trim().split(/\s+/):[])}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&y.on("preclick",this._onClose),this.options.closeOnMove&&y.on("move",this._onClose),y.on("remove",this.remove),this._update(),y._addPopup(this),this._focusFirstElement(),this._trackPointer?(y.on("mousemove",this._onMouseEvent),y.on("mouseup",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")):y.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const y=this._map;return y&&(y.off("move",this._update),y.off("move",this._onClose),y.off("preclick",this._onClose),y.off("click",this._onClose),y.off("remove",this.remove),y.off("mousemove",this._onMouseEvent),y.off("mouseup",this._onMouseEvent),y.off("drag",this._onMouseEvent),y._canvasContainer&&y._canvasContainer.classList.remove("mapboxgl-track-pointer"),y._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(y){this._lngLat=o.LngLat.convert(y),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const y=this._map;return y&&(y.off("move",this._update),y.on("mousemove",this._onMouseEvent),y.on("drag",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(o.window.document.createTextNode(y))}setHTML(y){const a=o.window.document.createDocumentFragment(),f=o.window.document.createElement("body");let v;for(f.innerHTML=y;v=f.firstChild,v;)a.appendChild(v);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=M("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(y),this.options.closeButton){const f=this._closeButton=M("button","mapboxgl-popup-close-button",a);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(y){return this._classList.add(y),this._updateClassList(),this}removeClassName(y){return this._classList.delete(y),this._updateClassList(),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){let a;return this._classList.delete(y)?a=!1:(this._classList.add(y),a=!0),this._updateClassList(),a}_onMouseEvent(y){this._update(y.point)}_getAnchor(y){if(this.options.anchor)return this.options.anchor;const a=this._map,f=this._container,v=this._pos;if(!a||!f||!v)return"bottom";const S=f.offsetWidth,T=f.offsetHeight,R=v.x<S/2,B=v.x>a.transform.width-S/2;if(v.y+y<T)return R?"top-left":B?"top-right":"top";if(v.y>a.transform.height-T){if(R)return"bottom-left";if(B)return"bottom-right"}return R?"left":B?"right":"bottom"}_updateClassList(){const y=this._container;if(!y)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),y.className=a.join(" ")}_update(y){const a=this._map,f=this._content;if(!a||!this._lngLat&&!this._trackPointer||!f)return;let v=this._container;if(v||(v=this._container=M("div","mapboxgl-popup",a.getContainer()),this._tip=M("div","mapboxgl-popup-tip",v),v.appendChild(f)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=F(this._lngLat,this._pos,a.transform)),!this._trackPointer||y){const S=this._pos=this._trackPointer&&y?y:a.project(this._lngLat),T=qe(this.options.offset),R=this._anchor=this._getAnchor(T.y),B=qe(this.options.offset,R),G=S.add(B).round();a._requestDomTask((()=>{this._container&&R&&(this._container.style.transform=`${Y[R]} translate(${G.x}px,${G.y}px)`)}))}if(!this._marker&&a._showingGlobe()){const S=o.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(S)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Be);y&&y.focus()}_onClose(){this.remove()}_setOpacity(y){this._container&&(this._container.style.opacity=`${y}`),this._content&&(this._content.style.pointerEvents=y?"auto":"none")}},Marker:ie,Style:si,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:fu,Evented:o.Evented,config:o.config,prewarm:function(){La().acquire(Yo)},clearPrewarmedResources:function(){const y=Jo;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Yo),Jo=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(y){o.config.ACCESS_TOKEN=y},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(y){o.config.API_URL=y},get workerCount(){return oo.workerCount},set workerCount(y){oo.workerCount=y},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(y){o.config.MAX_PARALLEL_IMAGE_REQUESTS=y},clearStorage(y){o.clearTileCache(y)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Sn}));var _=u;return _}))})(T1)),T1.exports}var OP=FP();const Vd=Dv(OP),BP="modulepreload",zP=function(n){return"/StakeholderMap/"+n},u2={},Jx=function(e,t,i){let c=Promise.resolve();if(t&&t.length>0){let o=function(w){return Promise.all(w.map(I=>Promise.resolve(I).then(O=>({status:"fulfilled",value:O}),O=>({status:"rejected",reason:O}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),_=m?.nonce||m?.getAttribute("nonce");c=o(t.map(w=>{if(w=zP(w),w in u2)return;u2[w]=!0;const I=w.endsWith(".css"),O=I?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${w}"]${O}`))return;const V=document.createElement("link");if(V.rel=I?"stylesheet":BP,I||(V.as="script"),V.crossOrigin="",V.href=w,_&&V.setAttribute("nonce",_),document.head.appendChild(V),I)return new Promise((M,se)=>{V.addEventListener("load",M),V.addEventListener("error",()=>se(new Error(`Unable to preload CSS for ${w}`)))})}))}function u(m){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=m,window.dispatchEvent(_),!_.defaultPrevented)throw m}return c.then(m=>{for(const _ of m||[])_.status==="rejected"&&u(_.reason);return e().catch(u)})};function ba(n){"@babel/helpers - typeof";return ba=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ba(n)}var Kd=Uint8Array,rd=Uint16Array,ew=Int32Array,tw=new Kd([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),nw=new Kd([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),h2=new Kd([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),xT=function(n,e){for(var t=new rd(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var c=new ew(t[30]),i=1;i<30;++i)for(var u=t[i];u<t[i+1];++u)c[u]=u-t[i]<<5|i;return{b:t,r:c}},bT=xT(tw,2),jP=bT.b,Jb=bT.r;jP[28]=258,Jb[258]=28;var UP=xT(nw,0),d2=UP.r,Qb=new rd(32768);for(var ul=0;ul<32768;++ul){var Np=(ul&43690)>>1|(ul&21845)<<1;Np=(Np&52428)>>2|(Np&13107)<<2,Np=(Np&61680)>>4|(Np&3855)<<4,Qb[ul]=((Np&65280)>>8|(Np&255)<<8)>>1}var Ly=(function(n,e,t){for(var i=n.length,c=0,u=new rd(e);c<i;++c)n[c]&&++u[n[c]-1];var m=new rd(e);for(c=1;c<e;++c)m[c]=m[c-1]+u[c-1]<<1;var _;if(t){_=new rd(1<<e);var o=15-e;for(c=0;c<i;++c)if(n[c])for(var w=c<<4|n[c],I=e-n[c],O=m[n[c]-1]++<<I,V=O|(1<<I)-1;O<=V;++O)_[Qb[O]>>o]=w}else for(_=new rd(i),c=0;c<i;++c)n[c]&&(_[c]=Qb[m[n[c]-1]++]>>15-n[c]);return _}),jm=new Kd(288);for(var ul=0;ul<144;++ul)jm[ul]=8;for(var ul=144;ul<256;++ul)jm[ul]=9;for(var ul=256;ul<280;++ul)jm[ul]=7;for(var ul=280;ul<288;++ul)jm[ul]=8;var ev=new Kd(32);for(var ul=0;ul<32;++ul)ev[ul]=5;var VP=Ly(jm,9,0),qP=Ly(ev,5,0),wT=function(n){return(n+7)/8|0},$P=function(n,e,t){return(t==null||t>n.length)&&(t=n.length),new Kd(n.subarray(e,t))},Zf=function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>8},uy=function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>8,n[i+2]|=t>>16},Qx=function(n,e){for(var t=[],i=0;i<n.length;++i)n[i]&&t.push({s:i,f:n[i]});var c=t.length,u=t.slice();if(!c)return{t:ET,l:0};if(c==1){var m=new Kd(t[0].s+1);return m[t[0].s]=1,{t:m,l:1}}t.sort(function(Ne,Ve){return Ne.f-Ve.f}),t.push({s:-1,f:25001});var _=t[0],o=t[1],w=0,I=1,O=2;for(t[0]={s:-1,f:_.f+o.f,l:_,r:o};I!=c-1;)_=t[t[w].f<t[O].f?w++:O++],o=t[w!=I&&t[w].f<t[O].f?w++:O++],t[I++]={s:-1,f:_.f+o.f,l:_,r:o};for(var V=u[0].s,i=1;i<c;++i)u[i].s>V&&(V=u[i].s);var M=new rd(V+1),se=e5(t[I-1],M,0);if(se>e){var i=0,ce=0,fe=se-e,ne=1<<fe;for(u.sort(function(Ve,de){return M[de.s]-M[Ve.s]||Ve.f-de.f});i<c;++i){var oe=u[i].s;if(M[oe]>e)ce+=ne-(1<<se-M[oe]),M[oe]=e;else break}for(ce>>=fe;ce>0;){var ye=u[i].s;M[ye]<e?ce-=1<<e-M[ye]++-1:++i}for(;i>=0&&ce;--i){var he=u[i].s;M[he]==e&&(--M[he],++ce)}se=e}return{t:new Kd(M),l:se}},e5=function(n,e,t){return n.s==-1?Math.max(e5(n.l,e,t+1),e5(n.r,e,t+1)):e[n.s]=t},f2=function(n){for(var e=n.length;e&&!n[--e];);for(var t=new rd(++e),i=0,c=n[0],u=1,m=function(o){t[i++]=o},_=1;_<=e;++_)if(n[_]==c&&_!=e)++u;else{if(!c&&u>2){for(;u>138;u-=138)m(32754);u>2&&(m(u>10?u-11<<5|28690:u-3<<5|12305),u=0)}else if(u>3){for(m(c),--u;u>6;u-=6)m(8304);u>2&&(m(u-3<<5|8208),u=0)}for(;u--;)m(c);u=1,c=n[_]}return{c:t.subarray(0,i),n:e}},hy=function(n,e){for(var t=0,i=0;i<e.length;++i)t+=n[i]*e[i];return t},ST=function(n,e,t){var i=t.length,c=wT(e+2);n[c]=i&255,n[c+1]=i>>8,n[c+2]=n[c]^255,n[c+3]=n[c+1]^255;for(var u=0;u<i;++u)n[c+u+4]=t[u];return(c+4+i)*8},p2=function(n,e,t,i,c,u,m,_,o,w,I){Zf(e,I++,t),++c[256];for(var O=Qx(c,15),V=O.t,M=O.l,se=Qx(u,15),ce=se.t,fe=se.l,ne=f2(V),oe=ne.c,ye=ne.n,he=f2(ce),Ne=he.c,Ve=he.n,de=new rd(19),j=0;j<oe.length;++j)++de[oe[j]&31];for(var j=0;j<Ne.length;++j)++de[Ne[j]&31];for(var D=Qx(de,7),$=D.t,z=D.l,W=19;W>4&&!$[h2[W-1]];--W);var Z=w+5<<3,Ee=hy(c,jm)+hy(u,ev)+m,ke=hy(c,V)+hy(u,ce)+m+14+3*W+hy(de,$)+2*de[16]+3*de[17]+7*de[18];if(o>=0&&Z<=Ee&&Z<=ke)return ST(e,I,n.subarray(o,o+w));var Oe,Re,be,De;if(Zf(e,I,1+(ke<Ee)),I+=2,ke<Ee){Oe=Ly(V,M,0),Re=V,be=Ly(ce,fe,0),De=ce;var Qe=Ly($,z,0);Zf(e,I,ye-257),Zf(e,I+5,Ve-1),Zf(e,I+10,W-4),I+=14;for(var j=0;j<W;++j)Zf(e,I+3*j,$[h2[j]]);I+=3*W;for(var xe=[oe,Ne],ae=0;ae<2;++ae)for(var Me=xe[ae],j=0;j<Me.length;++j){var Fe=Me[j]&31;Zf(e,I,Qe[Fe]),I+=$[Fe],Fe>15&&(Zf(e,I,Me[j]>>5&127),I+=Me[j]>>12)}}else Oe=VP,Re=jm,be=qP,De=ev;for(var j=0;j<_;++j){var Ze=i[j];if(Ze>255){var Fe=Ze>>18&31;uy(e,I,Oe[Fe+257]),I+=Re[Fe+257],Fe>7&&(Zf(e,I,Ze>>23&31),I+=tw[Fe]);var et=Ze&31;uy(e,I,be[et]),I+=De[et],et>3&&(uy(e,I,Ze>>5&8191),I+=nw[et])}else uy(e,I,Oe[Ze]),I+=Re[Ze]}return uy(e,I,Oe[256]),I+Re[256]},GP=new ew([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ET=new Kd(0),WP=function(n,e,t,i,c,u){var m=u.z||n.length,_=new Kd(i+m+5*(1+Math.ceil(m/7e3))+c),o=_.subarray(i,_.length-c),w=u.l,I=(u.r||0)&7;if(e){I&&(o[0]=u.r>>3);for(var O=GP[e-1],V=O>>13,M=O&8191,se=(1<<t)-1,ce=u.p||new rd(32768),fe=u.h||new rd(se+1),ne=Math.ceil(t/3),oe=2*ne,ye=function(zt){return(n[zt]^n[zt+1]<<ne^n[zt+2]<<oe)&se},he=new ew(25e3),Ne=new rd(288),Ve=new rd(32),de=0,j=0,D=u.i||0,$=0,z=u.w||0,W=0;D+2<m;++D){var Z=ye(D),Ee=D&32767,ke=fe[Z];if(ce[Ee]=ke,fe[Z]=Ee,z<=D){var Oe=m-D;if((de>7e3||$>24576)&&(Oe>423||!w)){I=p2(n,o,0,he,Ne,Ve,j,$,W,D-W,I),$=de=j=0,W=D;for(var Re=0;Re<286;++Re)Ne[Re]=0;for(var Re=0;Re<30;++Re)Ve[Re]=0}var be=2,De=0,Qe=M,xe=Ee-ke&32767;if(Oe>2&&Z==ye(D-xe))for(var ae=Math.min(V,Oe)-1,Me=Math.min(32767,D),Fe=Math.min(258,Oe);xe<=Me&&--Qe&&Ee!=ke;){if(n[D+be]==n[D+be-xe]){for(var Ze=0;Ze<Fe&&n[D+Ze]==n[D+Ze-xe];++Ze);if(Ze>be){if(be=Ze,De=xe,Ze>ae)break;for(var et=Math.min(xe,Ze-2),mt=0,Re=0;Re<et;++Re){var ht=D-xe+Re&32767,Nt=ce[ht],Jt=ht-Nt&32767;Jt>mt&&(mt=Jt,ke=ht)}}}Ee=ke,ke=ce[Ee],xe+=Ee-ke&32767}if(De){he[$++]=268435456|Jb[be]<<18|d2[De];var tn=Jb[be]&31,fn=d2[De]&31;j+=tw[tn]+nw[fn],++Ne[257+tn],++Ve[fn],z=D+be,++de}else he[$++]=n[D],++Ne[n[D]]}}for(D=Math.max(D,z);D<m;++D)he[$++]=n[D],++Ne[n[D]];I=p2(n,o,w,he,Ne,Ve,j,$,W,D-W,I),w||(u.r=I&7|o[I/8|0]<<3,I-=7,u.h=fe,u.p=ce,u.i=D,u.w=z)}else{for(var D=u.w||0;D<m+w;D+=65535){var An=D+65535;An>=m&&(o[I/8|0]=w,An=m),I=ST(o,I+1,n.subarray(D,An))}u.i=m}return $P(_,0,i+wT(I)+c)},AT=function(){var n=1,e=0;return{p:function(t){for(var i=n,c=e,u=t.length|0,m=0;m!=u;){for(var _=Math.min(m+2655,u);m<_;++m)c+=i+=t[m];i=(i&65535)+15*(i>>16),c=(c&65535)+15*(c>>16)}n=i,e=c},d:function(){return n%=65521,e%=65521,(n&255)<<24|(n&65280)<<8|(e&255)<<8|e>>8}}},HP=function(n,e,t,i,c){if(!c&&(c={l:1},e.dictionary)){var u=e.dictionary.subarray(-32768),m=new Kd(u.length+n.length);m.set(u),m.set(n,u.length),n=m,c.w=u.length}return WP(n,e.level==null?6:e.level,e.mem==null?c.l?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):20:12+e.mem,t,i,c)},TT=function(n,e,t){for(;t;++e)n[e]=t,t>>>=8},XP=function(n,e){var t=e.level,i=t==0?0:t<6?1:t==9?3:2;if(n[0]=120,n[1]=i<<6|(e.dictionary&&32),n[1]|=31-(n[0]<<8|n[1])%31,e.dictionary){var c=AT();c.p(e.dictionary),TT(n,2,c.d())}};function t5(n,e){e||(e={});var t=AT();t.p(n);var i=HP(n,e,e.dictionary?6:2,4);return XP(i,e),TT(i,i.length-4,t.d()),i}var KP=typeof TextDecoder<"u"&&new TextDecoder,ZP=0;try{KP.decode(ET,{stream:!0}),ZP=1}catch{}function YP(n){if(Array.isArray(n))return n}function JP(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,c,u,m,_=[],o=!0,w=!1;try{if(u=(t=t.call(n)).next,e!==0)for(;!(o=(i=u.call(t)).done)&&(_.push(i.value),_.length!==e);o=!0);}catch(I){w=!0,c=I}finally{try{if(!o&&t.return!=null&&(m=t.return(),Object(m)!==m))return}finally{if(w)throw c}}return _}}function m2(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function QP(n,e){if(n){if(typeof n=="string")return m2(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?m2(n,e):void 0}}function e7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function g2(n,e){return YP(n)||JP(n,e)||QP(n,e)||e7()}function y2(n,e="utf8"){return new TextDecoder(e).decode(n)}const t7=new TextEncoder;function n7(n){return t7.encode(n)}const r7=1024*8,i7=(()=>{const n=new Uint8Array(4),e=new Uint32Array(n.buffer);return!((e[0]=1)&n[0])})(),eb={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class rw{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(e=r7,t={}){let i=!1;typeof e=="number"?e=new ArrayBuffer(e):(i=!0,this.lastWrittenByte=e.byteLength);const c=t.offset?t.offset>>>0:0,u=e.byteLength-c;let m=c;(ArrayBuffer.isView(e)||e instanceof rw)&&(e.byteLength!==e.buffer.byteLength&&(m=e.byteOffset+c),e=e.buffer),i?this.lastWrittenByte=u:this.lastWrittenByte=0,this.buffer=e,this.length=u,this.byteLength=u,this.byteOffset=m,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,m,u),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const i=(this.offset+e)*2,c=new Uint8Array(i);c.set(new Uint8Array(this.buffer)),this.buffer=c.buffer,this.length=i,this.byteLength=i,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const i=eb[t].BYTES_PER_ELEMENT*e,c=this.byteOffset+this.offset,u=this.buffer.slice(c,c+i);if(this.littleEndian===i7&&t!=="uint8"&&t!=="int8"){const _=new Uint8Array(this.buffer.slice(c,c+i));_.reverse();const o=new eb[t](_.buffer);return this.offset+=i,o.reverse(),o}const m=new eb[t](u);return this.offset+=i,m}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let i=0;i<e;i++)t+=this.readChar();return t}readUtf8(e=1){return y2(this.readBytes(e))}decodeText(e=1,t="utf8"){return y2(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(n7(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function x0(n){let e=n.length;for(;--e>=0;)n[e]=0}const o7=3,s7=258,IT=29,a7=256,l7=a7+1+IT,CT=30,c7=512,u7=new Array((l7+2)*2);x0(u7);const h7=new Array(CT*2);x0(h7);const d7=new Array(c7);x0(d7);const f7=new Array(s7-o7+1);x0(f7);const p7=new Array(IT);x0(p7);const m7=new Array(CT);x0(m7);const g7=(n,e,t,i)=>{let c=n&65535|0,u=n>>>16&65535|0,m=0;for(;t!==0;){m=t>2e3?2e3:t,t-=m;do c=c+e[i++]|0,u=u+c|0;while(--m);c%=65521,u%=65521}return c|u<<16|0};var n5=g7;const y7=()=>{let n,e=[];for(var t=0;t<256;t++){n=t;for(var i=0;i<8;i++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e},_7=new Uint32Array(y7()),v7=(n,e,t,i)=>{const c=_7,u=i+t;n^=-1;for(let m=i;m<u;m++)n=n>>>8^c[(n^e[m])&255];return n^-1};var mf=v7,r5={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},LT={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const x7=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var b7=function(n){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const i in t)x7(t,i)&&(n[i]=t[i])}}return n},w7=n=>{let e=0;for(let i=0,c=n.length;i<c;i++)e+=n[i].length;const t=new Uint8Array(e);for(let i=0,c=0,u=n.length;i<u;i++){let m=n[i];t.set(m,c),c+=m.length}return t},PT={assign:b7,flattenChunks:w7};let kT=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{kT=!1}const Gy=new Uint8Array(256);for(let n=0;n<256;n++)Gy[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;Gy[254]=Gy[254]=1;var S7=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let e,t,i,c,u,m=n.length,_=0;for(c=0;c<m;c++)t=n.charCodeAt(c),(t&64512)===55296&&c+1<m&&(i=n.charCodeAt(c+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),c++)),_+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(_),u=0,c=0;u<_;c++)t=n.charCodeAt(c),(t&64512)===55296&&c+1<m&&(i=n.charCodeAt(c+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),c++)),t<128?e[u++]=t:t<2048?(e[u++]=192|t>>>6,e[u++]=128|t&63):t<65536?(e[u++]=224|t>>>12,e[u++]=128|t>>>6&63,e[u++]=128|t&63):(e[u++]=240|t>>>18,e[u++]=128|t>>>12&63,e[u++]=128|t>>>6&63,e[u++]=128|t&63);return e};const E7=(n,e)=>{if(e<65534&&n.subarray&&kT)return String.fromCharCode.apply(null,n.length===e?n:n.subarray(0,e));let t="";for(let i=0;i<e;i++)t+=String.fromCharCode(n[i]);return t};var A7=(n,e)=>{const t=e||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,e));let i,c;const u=new Array(t*2);for(c=0,i=0;i<t;){let m=n[i++];if(m<128){u[c++]=m;continue}let _=Gy[m];if(_>4){u[c++]=65533,i+=_-1;continue}for(m&=_===2?31:_===3?15:7;_>1&&i<t;)m=m<<6|n[i++]&63,_--;if(_>1){u[c++]=65533;continue}m<65536?u[c++]=m:(m-=65536,u[c++]=55296|m>>10&1023,u[c++]=56320|m&1023)}return E7(u,c)},T7=(n,e)=>{e=e||n.length,e>n.length&&(e=n.length);let t=e-1;for(;t>=0&&(n[t]&192)===128;)t--;return t<0||t===0?e:t+Gy[n[t]]>e?t:e},i5={string2buf:S7,buf2string:A7,utf8border:T7};function I7(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var C7=I7;const J_=16209,L7=16191;var P7=function(e,t){let i,c,u,m,_,o,w,I,O,V,M,se,ce,fe,ne,oe,ye,he,Ne,Ve,de,j,D,$;const z=e.state;i=e.next_in,D=e.input,c=i+(e.avail_in-5),u=e.next_out,$=e.output,m=u-(t-e.avail_out),_=u+(e.avail_out-257),o=z.dmax,w=z.wsize,I=z.whave,O=z.wnext,V=z.window,M=z.hold,se=z.bits,ce=z.lencode,fe=z.distcode,ne=(1<<z.lenbits)-1,oe=(1<<z.distbits)-1;e:do{se<15&&(M+=D[i++]<<se,se+=8,M+=D[i++]<<se,se+=8),ye=ce[M&ne];t:for(;;){if(he=ye>>>24,M>>>=he,se-=he,he=ye>>>16&255,he===0)$[u++]=ye&65535;else if(he&16){Ne=ye&65535,he&=15,he&&(se<he&&(M+=D[i++]<<se,se+=8),Ne+=M&(1<<he)-1,M>>>=he,se-=he),se<15&&(M+=D[i++]<<se,se+=8,M+=D[i++]<<se,se+=8),ye=fe[M&oe];n:for(;;){if(he=ye>>>24,M>>>=he,se-=he,he=ye>>>16&255,he&16){if(Ve=ye&65535,he&=15,se<he&&(M+=D[i++]<<se,se+=8,se<he&&(M+=D[i++]<<se,se+=8)),Ve+=M&(1<<he)-1,Ve>o){e.msg="invalid distance too far back",z.mode=J_;break e}if(M>>>=he,se-=he,he=u-m,Ve>he){if(he=Ve-he,he>I&&z.sane){e.msg="invalid distance too far back",z.mode=J_;break e}if(de=0,j=V,O===0){if(de+=w-he,he<Ne){Ne-=he;do $[u++]=V[de++];while(--he);de=u-Ve,j=$}}else if(O<he){if(de+=w+O-he,he-=O,he<Ne){Ne-=he;do $[u++]=V[de++];while(--he);if(de=0,O<Ne){he=O,Ne-=he;do $[u++]=V[de++];while(--he);de=u-Ve,j=$}}}else if(de+=O-he,he<Ne){Ne-=he;do $[u++]=V[de++];while(--he);de=u-Ve,j=$}for(;Ne>2;)$[u++]=j[de++],$[u++]=j[de++],$[u++]=j[de++],Ne-=3;Ne&&($[u++]=j[de++],Ne>1&&($[u++]=j[de++]))}else{de=u-Ve;do $[u++]=$[de++],$[u++]=$[de++],$[u++]=$[de++],Ne-=3;while(Ne>2);Ne&&($[u++]=$[de++],Ne>1&&($[u++]=$[de++]))}}else if((he&64)===0){ye=fe[(ye&65535)+(M&(1<<he)-1)];continue n}else{e.msg="invalid distance code",z.mode=J_;break e}break}}else if((he&64)===0){ye=ce[(ye&65535)+(M&(1<<he)-1)];continue t}else if(he&32){z.mode=L7;break e}else{e.msg="invalid literal/length code",z.mode=J_;break e}break}}while(i<c&&u<_);Ne=se>>3,i-=Ne,se-=Ne<<3,M&=(1<<se)-1,e.next_in=i,e.next_out=u,e.avail_in=i<c?5+(c-i):5-(i-c),e.avail_out=u<_?257+(_-u):257-(u-_),z.hold=M,z.bits=se};const Lg=15,_2=852,v2=592,x2=0,tb=1,b2=2,k7=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),M7=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),R7=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),N7=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),D7=(n,e,t,i,c,u,m,_)=>{const o=_.bits;let w=0,I=0,O=0,V=0,M=0,se=0,ce=0,fe=0,ne=0,oe=0,ye,he,Ne,Ve,de,j=null,D;const $=new Uint16Array(Lg+1),z=new Uint16Array(Lg+1);let W=null,Z,Ee,ke;for(w=0;w<=Lg;w++)$[w]=0;for(I=0;I<i;I++)$[e[t+I]]++;for(M=o,V=Lg;V>=1&&$[V]===0;V--);if(M>V&&(M=V),V===0)return c[u++]=1<<24|64<<16|0,c[u++]=1<<24|64<<16|0,_.bits=1,0;for(O=1;O<V&&$[O]===0;O++);for(M<O&&(M=O),fe=1,w=1;w<=Lg;w++)if(fe<<=1,fe-=$[w],fe<0)return-1;if(fe>0&&(n===x2||V!==1))return-1;for(z[1]=0,w=1;w<Lg;w++)z[w+1]=z[w]+$[w];for(I=0;I<i;I++)e[t+I]!==0&&(m[z[e[t+I]]++]=I);if(n===x2?(j=W=m,D=20):n===tb?(j=k7,W=M7,D=257):(j=R7,W=N7,D=0),oe=0,I=0,w=O,de=u,se=M,ce=0,Ne=-1,ne=1<<M,Ve=ne-1,n===tb&&ne>_2||n===b2&&ne>v2)return 1;for(;;){Z=w-ce,m[I]+1<D?(Ee=0,ke=m[I]):m[I]>=D?(Ee=W[m[I]-D],ke=j[m[I]-D]):(Ee=96,ke=0),ye=1<<w-ce,he=1<<se,O=he;do he-=ye,c[de+(oe>>ce)+he]=Z<<24|Ee<<16|ke|0;while(he!==0);for(ye=1<<w-1;oe&ye;)ye>>=1;if(ye!==0?(oe&=ye-1,oe+=ye):oe=0,I++,--$[w]===0){if(w===V)break;w=e[t+m[I]]}if(w>M&&(oe&Ve)!==Ne){for(ce===0&&(ce=M),de+=O,se=w-ce,fe=1<<se;se+ce<V&&(fe-=$[se+ce],!(fe<=0));)se++,fe<<=1;if(ne+=1<<se,n===tb&&ne>_2||n===b2&&ne>v2)return 1;Ne=oe&Ve,c[Ne]=M<<24|se<<16|de-u|0}}return oe!==0&&(c[de+oe]=w-ce<<24|64<<16|0),_.bits=M,0};var Py=D7;const F7=0,MT=1,RT=2,{Z_FINISH:w2,Z_BLOCK:O7,Z_TREES:Q_,Z_OK:Um,Z_STREAM_END:B7,Z_NEED_DICT:z7,Z_STREAM_ERROR:Td,Z_DATA_ERROR:NT,Z_MEM_ERROR:DT,Z_BUF_ERROR:j7,Z_DEFLATED:S2}=LT,Bv=16180,E2=16181,A2=16182,T2=16183,I2=16184,C2=16185,L2=16186,P2=16187,k2=16188,M2=16189,tv=16190,Yf=16191,nb=16192,R2=16193,rb=16194,N2=16195,D2=16196,F2=16197,O2=16198,e1=16199,t1=16200,B2=16201,z2=16202,j2=16203,U2=16204,V2=16205,ib=16206,q2=16207,$2=16208,wl=16209,FT=16210,OT=16211,U7=852,V7=592,q7=15,$7=q7,G2=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function G7(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ym=n=>{if(!n)return 1;const e=n.state;return!e||e.strm!==n||e.mode<Bv||e.mode>OT?1:0},BT=n=>{if(Ym(n))return Td;const e=n.state;return n.total_in=n.total_out=e.total=0,n.msg="",e.wrap&&(n.adler=e.wrap&1),e.mode=Bv,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(U7),e.distcode=e.distdyn=new Int32Array(V7),e.sane=1,e.back=-1,Um},zT=n=>{if(Ym(n))return Td;const e=n.state;return e.wsize=0,e.whave=0,e.wnext=0,BT(n)},jT=(n,e)=>{let t;if(Ym(n))return Td;const i=n.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?Td:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,zT(n))},UT=(n,e)=>{if(!n)return Td;const t=new G7;n.state=t,t.strm=n,t.window=null,t.mode=Bv;const i=jT(n,e);return i!==Um&&(n.state=null),i},W7=n=>UT(n,$7);let W2=!0,ob,sb;const H7=n=>{if(W2){ob=new Int32Array(512),sb=new Int32Array(32);let e=0;for(;e<144;)n.lens[e++]=8;for(;e<256;)n.lens[e++]=9;for(;e<280;)n.lens[e++]=7;for(;e<288;)n.lens[e++]=8;for(Py(MT,n.lens,0,288,ob,0,n.work,{bits:9}),e=0;e<32;)n.lens[e++]=5;Py(RT,n.lens,0,32,sb,0,n.work,{bits:5}),W2=!1}n.lencode=ob,n.lenbits=9,n.distcode=sb,n.distbits=5},VT=(n,e,t,i)=>{let c;const u=n.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),i>=u.wsize?(u.window.set(e.subarray(t-u.wsize,t),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>i&&(c=i),u.window.set(e.subarray(t-i,t-i+c),u.wnext),i-=c,i?(u.window.set(e.subarray(t-i,t),0),u.wnext=i,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0},X7=(n,e)=>{let t,i,c,u,m,_,o,w,I,O,V,M,se,ce,fe=0,ne,oe,ye,he,Ne,Ve,de,j;const D=new Uint8Array(4);let $,z;const W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ym(n)||!n.output||!n.input&&n.avail_in!==0)return Td;t=n.state,t.mode===Yf&&(t.mode=nb),m=n.next_out,c=n.output,o=n.avail_out,u=n.next_in,i=n.input,_=n.avail_in,w=t.hold,I=t.bits,O=_,V=o,j=Um;e:for(;;)switch(t.mode){case Bv:if(t.wrap===0){t.mode=nb;break}for(;I<16;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(t.wrap&2&&w===35615){t.wbits===0&&(t.wbits=15),t.check=0,D[0]=w&255,D[1]=w>>>8&255,t.check=mf(t.check,D,2,0),w=0,I=0,t.mode=E2;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((w&255)<<8)+(w>>8))%31){n.msg="incorrect header check",t.mode=wl;break}if((w&15)!==S2){n.msg="unknown compression method",t.mode=wl;break}if(w>>>=4,I-=4,de=(w&15)+8,t.wbits===0&&(t.wbits=de),de>15||de>t.wbits){n.msg="invalid window size",t.mode=wl;break}t.dmax=1<<t.wbits,t.flags=0,n.adler=t.check=1,t.mode=w&512?M2:Yf,w=0,I=0;break;case E2:for(;I<16;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(t.flags=w,(t.flags&255)!==S2){n.msg="unknown compression method",t.mode=wl;break}if(t.flags&57344){n.msg="unknown header flags set",t.mode=wl;break}t.head&&(t.head.text=w>>8&1),t.flags&512&&t.wrap&4&&(D[0]=w&255,D[1]=w>>>8&255,t.check=mf(t.check,D,2,0)),w=0,I=0,t.mode=A2;case A2:for(;I<32;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}t.head&&(t.head.time=w),t.flags&512&&t.wrap&4&&(D[0]=w&255,D[1]=w>>>8&255,D[2]=w>>>16&255,D[3]=w>>>24&255,t.check=mf(t.check,D,4,0)),w=0,I=0,t.mode=T2;case T2:for(;I<16;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}t.head&&(t.head.xflags=w&255,t.head.os=w>>8),t.flags&512&&t.wrap&4&&(D[0]=w&255,D[1]=w>>>8&255,t.check=mf(t.check,D,2,0)),w=0,I=0,t.mode=I2;case I2:if(t.flags&1024){for(;I<16;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}t.length=w,t.head&&(t.head.extra_len=w),t.flags&512&&t.wrap&4&&(D[0]=w&255,D[1]=w>>>8&255,t.check=mf(t.check,D,2,0)),w=0,I=0}else t.head&&(t.head.extra=null);t.mode=C2;case C2:if(t.flags&1024&&(M=t.length,M>_&&(M=_),M&&(t.head&&(de=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(u,u+M),de)),t.flags&512&&t.wrap&4&&(t.check=mf(t.check,i,M,u)),_-=M,u+=M,t.length-=M),t.length))break e;t.length=0,t.mode=L2;case L2:if(t.flags&2048){if(_===0)break e;M=0;do de=i[u+M++],t.head&&de&&t.length<65536&&(t.head.name+=String.fromCharCode(de));while(de&&M<_);if(t.flags&512&&t.wrap&4&&(t.check=mf(t.check,i,M,u)),_-=M,u+=M,de)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=P2;case P2:if(t.flags&4096){if(_===0)break e;M=0;do de=i[u+M++],t.head&&de&&t.length<65536&&(t.head.comment+=String.fromCharCode(de));while(de&&M<_);if(t.flags&512&&t.wrap&4&&(t.check=mf(t.check,i,M,u)),_-=M,u+=M,de)break e}else t.head&&(t.head.comment=null);t.mode=k2;case k2:if(t.flags&512){for(;I<16;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(t.wrap&4&&w!==(t.check&65535)){n.msg="header crc mismatch",t.mode=wl;break}w=0,I=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),n.adler=t.check=0,t.mode=Yf;break;case M2:for(;I<32;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}n.adler=t.check=G2(w),w=0,I=0,t.mode=tv;case tv:if(t.havedict===0)return n.next_out=m,n.avail_out=o,n.next_in=u,n.avail_in=_,t.hold=w,t.bits=I,z7;n.adler=t.check=1,t.mode=Yf;case Yf:if(e===O7||e===Q_)break e;case nb:if(t.last){w>>>=I&7,I-=I&7,t.mode=ib;break}for(;I<3;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}switch(t.last=w&1,w>>>=1,I-=1,w&3){case 0:t.mode=R2;break;case 1:if(H7(t),t.mode=e1,e===Q_){w>>>=2,I-=2;break e}break;case 2:t.mode=D2;break;case 3:n.msg="invalid block type",t.mode=wl}w>>>=2,I-=2;break;case R2:for(w>>>=I&7,I-=I&7;I<32;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if((w&65535)!==(w>>>16^65535)){n.msg="invalid stored block lengths",t.mode=wl;break}if(t.length=w&65535,w=0,I=0,t.mode=rb,e===Q_)break e;case rb:t.mode=N2;case N2:if(M=t.length,M){if(M>_&&(M=_),M>o&&(M=o),M===0)break e;c.set(i.subarray(u,u+M),m),_-=M,u+=M,o-=M,m+=M,t.length-=M;break}t.mode=Yf;break;case D2:for(;I<14;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(t.nlen=(w&31)+257,w>>>=5,I-=5,t.ndist=(w&31)+1,w>>>=5,I-=5,t.ncode=(w&15)+4,w>>>=4,I-=4,t.nlen>286||t.ndist>30){n.msg="too many length or distance symbols",t.mode=wl;break}t.have=0,t.mode=F2;case F2:for(;t.have<t.ncode;){for(;I<3;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}t.lens[W[t.have++]]=w&7,w>>>=3,I-=3}for(;t.have<19;)t.lens[W[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,$={bits:t.lenbits},j=Py(F7,t.lens,0,19,t.lencode,0,t.work,$),t.lenbits=$.bits,j){n.msg="invalid code lengths set",t.mode=wl;break}t.have=0,t.mode=O2;case O2:for(;t.have<t.nlen+t.ndist;){for(;fe=t.lencode[w&(1<<t.lenbits)-1],ne=fe>>>24,oe=fe>>>16&255,ye=fe&65535,!(ne<=I);){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(ye<16)w>>>=ne,I-=ne,t.lens[t.have++]=ye;else{if(ye===16){for(z=ne+2;I<z;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(w>>>=ne,I-=ne,t.have===0){n.msg="invalid bit length repeat",t.mode=wl;break}de=t.lens[t.have-1],M=3+(w&3),w>>>=2,I-=2}else if(ye===17){for(z=ne+3;I<z;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}w>>>=ne,I-=ne,de=0,M=3+(w&7),w>>>=3,I-=3}else{for(z=ne+7;I<z;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}w>>>=ne,I-=ne,de=0,M=11+(w&127),w>>>=7,I-=7}if(t.have+M>t.nlen+t.ndist){n.msg="invalid bit length repeat",t.mode=wl;break}for(;M--;)t.lens[t.have++]=de}}if(t.mode===wl)break;if(t.lens[256]===0){n.msg="invalid code -- missing end-of-block",t.mode=wl;break}if(t.lenbits=9,$={bits:t.lenbits},j=Py(MT,t.lens,0,t.nlen,t.lencode,0,t.work,$),t.lenbits=$.bits,j){n.msg="invalid literal/lengths set",t.mode=wl;break}if(t.distbits=6,t.distcode=t.distdyn,$={bits:t.distbits},j=Py(RT,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,$),t.distbits=$.bits,j){n.msg="invalid distances set",t.mode=wl;break}if(t.mode=e1,e===Q_)break e;case e1:t.mode=t1;case t1:if(_>=6&&o>=258){n.next_out=m,n.avail_out=o,n.next_in=u,n.avail_in=_,t.hold=w,t.bits=I,P7(n,V),m=n.next_out,c=n.output,o=n.avail_out,u=n.next_in,i=n.input,_=n.avail_in,w=t.hold,I=t.bits,t.mode===Yf&&(t.back=-1);break}for(t.back=0;fe=t.lencode[w&(1<<t.lenbits)-1],ne=fe>>>24,oe=fe>>>16&255,ye=fe&65535,!(ne<=I);){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(oe&&(oe&240)===0){for(he=ne,Ne=oe,Ve=ye;fe=t.lencode[Ve+((w&(1<<he+Ne)-1)>>he)],ne=fe>>>24,oe=fe>>>16&255,ye=fe&65535,!(he+ne<=I);){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}w>>>=he,I-=he,t.back+=he}if(w>>>=ne,I-=ne,t.back+=ne,t.length=ye,oe===0){t.mode=V2;break}if(oe&32){t.back=-1,t.mode=Yf;break}if(oe&64){n.msg="invalid literal/length code",t.mode=wl;break}t.extra=oe&15,t.mode=B2;case B2:if(t.extra){for(z=t.extra;I<z;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}t.length+=w&(1<<t.extra)-1,w>>>=t.extra,I-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=z2;case z2:for(;fe=t.distcode[w&(1<<t.distbits)-1],ne=fe>>>24,oe=fe>>>16&255,ye=fe&65535,!(ne<=I);){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if((oe&240)===0){for(he=ne,Ne=oe,Ve=ye;fe=t.distcode[Ve+((w&(1<<he+Ne)-1)>>he)],ne=fe>>>24,oe=fe>>>16&255,ye=fe&65535,!(he+ne<=I);){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}w>>>=he,I-=he,t.back+=he}if(w>>>=ne,I-=ne,t.back+=ne,oe&64){n.msg="invalid distance code",t.mode=wl;break}t.offset=ye,t.extra=oe&15,t.mode=j2;case j2:if(t.extra){for(z=t.extra;I<z;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}t.offset+=w&(1<<t.extra)-1,w>>>=t.extra,I-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){n.msg="invalid distance too far back",t.mode=wl;break}t.mode=U2;case U2:if(o===0)break e;if(M=V-o,t.offset>M){if(M=t.offset-M,M>t.whave&&t.sane){n.msg="invalid distance too far back",t.mode=wl;break}M>t.wnext?(M-=t.wnext,se=t.wsize-M):se=t.wnext-M,M>t.length&&(M=t.length),ce=t.window}else ce=c,se=m-t.offset,M=t.length;M>o&&(M=o),o-=M,t.length-=M;do c[m++]=ce[se++];while(--M);t.length===0&&(t.mode=t1);break;case V2:if(o===0)break e;c[m++]=t.length,o--,t.mode=t1;break;case ib:if(t.wrap){for(;I<32;){if(_===0)break e;_--,w|=i[u++]<<I,I+=8}if(V-=o,n.total_out+=V,t.total+=V,t.wrap&4&&V&&(n.adler=t.check=t.flags?mf(t.check,c,V,m-V):n5(t.check,c,V,m-V)),V=o,t.wrap&4&&(t.flags?w:G2(w))!==t.check){n.msg="incorrect data check",t.mode=wl;break}w=0,I=0}t.mode=q2;case q2:if(t.wrap&&t.flags){for(;I<32;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(t.wrap&4&&w!==(t.total&4294967295)){n.msg="incorrect length check",t.mode=wl;break}w=0,I=0}t.mode=$2;case $2:j=B7;break e;case wl:j=NT;break e;case FT:return DT;case OT:default:return Td}return n.next_out=m,n.avail_out=o,n.next_in=u,n.avail_in=_,t.hold=w,t.bits=I,(t.wsize||V!==n.avail_out&&t.mode<wl&&(t.mode<ib||e!==w2))&&VT(n,n.output,n.next_out,V-n.avail_out),O-=n.avail_in,V-=n.avail_out,n.total_in+=O,n.total_out+=V,t.total+=V,t.wrap&4&&V&&(n.adler=t.check=t.flags?mf(t.check,c,V,n.next_out-V):n5(t.check,c,V,n.next_out-V)),n.data_type=t.bits+(t.last?64:0)+(t.mode===Yf?128:0)+(t.mode===e1||t.mode===rb?256:0),(O===0&&V===0||e===w2)&&j===Um&&(j=j7),j},K7=n=>{if(Ym(n))return Td;let e=n.state;return e.window&&(e.window=null),n.state=null,Um},Z7=(n,e)=>{if(Ym(n))return Td;const t=n.state;return(t.wrap&2)===0?Td:(t.head=e,e.done=!1,Um)},Y7=(n,e)=>{const t=e.length;let i,c,u;return Ym(n)||(i=n.state,i.wrap!==0&&i.mode!==tv)?Td:i.mode===tv&&(c=1,c=n5(c,e,t,0),c!==i.check)?NT:(u=VT(n,e,t,t),u?(i.mode=FT,DT):(i.havedict=1,Um))};var J7=zT,Q7=jT,ek=BT,tk=W7,nk=UT,rk=X7,ik=K7,ok=Z7,sk=Y7,ak="pako inflate (from Nodeca project)",ip={inflateReset:J7,inflateReset2:Q7,inflateResetKeep:ek,inflateInit:tk,inflateInit2:nk,inflate:rk,inflateEnd:ik,inflateGetHeader:ok,inflateSetDictionary:sk,inflateInfo:ak};function lk(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var ck=lk;const qT=Object.prototype.toString,{Z_NO_FLUSH:uk,Z_FINISH:hk,Z_OK:Wy,Z_STREAM_END:ab,Z_NEED_DICT:lb,Z_STREAM_ERROR:dk,Z_DATA_ERROR:H2,Z_MEM_ERROR:fk}=LT;function l_(n){this.options=PT.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(n&&n.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new C7,this.strm.avail_out=0;let t=ip.inflateInit2(this.strm,e.windowBits);if(t!==Wy)throw new Error(r5[t]);if(this.header=new ck,ip.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=i5.string2buf(e.dictionary):qT.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=ip.inflateSetDictionary(this.strm,e.dictionary),t!==Wy)))throw new Error(r5[t])}l_.prototype.push=function(n,e){const t=this.strm,i=this.options.chunkSize,c=this.options.dictionary;let u,m,_;if(this.ended)return!1;for(e===~~e?m=e:m=e===!0?hk:uk,qT.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),u=ip.inflate(t,m),u===lb&&c&&(u=ip.inflateSetDictionary(t,c),u===Wy?u=ip.inflate(t,m):u===H2&&(u=lb));t.avail_in>0&&u===ab&&t.state.wrap>0&&n[t.next_in]!==0;)ip.inflateReset(t),u=ip.inflate(t,m);switch(u){case dk:case H2:case lb:case fk:return this.onEnd(u),this.ended=!0,!1}if(_=t.avail_out,t.next_out&&(t.avail_out===0||u===ab))if(this.options.to==="string"){let o=i5.utf8border(t.output,t.next_out),w=t.next_out-o,I=i5.buf2string(t.output,o);t.next_out=w,t.avail_out=i-w,w&&t.output.set(t.output.subarray(o,o+w),0),this.onData(I)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(u===Wy&&_===0)){if(u===ab)return u=ip.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};l_.prototype.onData=function(n){this.chunks.push(n)};l_.prototype.onEnd=function(n){n===Wy&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=PT.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function pk(n,e){const t=new l_(e);if(t.push(n),t.err)throw t.msg||r5[t.err];return t.result}var mk=l_,gk=pk,yk={Inflate:mk,inflate:gk};const{Inflate:_k,inflate:vk}=yk;var X2=_k,xk=vk;const $T=[];for(let n=0;n<256;n++){let e=n;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e=e>>>1;$T[n]=e}const K2=4294967295;function bk(n,e,t){let i=n;for(let c=0;c<t;c++)i=$T[(i^e[c])&255]^i>>>8;return i}function wk(n,e){return(bk(K2,n,e)^K2)>>>0}function Z2(n,e,t){const i=n.readUint32(),c=wk(new Uint8Array(n.buffer,n.byteOffset+n.offset-e-4,e),e);if(c!==i)throw new Error(`CRC mismatch for chunk ${t}. Expected ${i}, found ${c}`)}function GT(n,e,t){for(let i=0;i<t;i++)e[i]=n[i]}function WT(n,e,t,i){let c=0;for(;c<i;c++)e[c]=n[c];for(;c<t;c++)e[c]=n[c]+e[c-i]&255}function HT(n,e,t,i){let c=0;if(t.length===0)for(;c<i;c++)e[c]=n[c];else for(;c<i;c++)e[c]=n[c]+t[c]&255}function XT(n,e,t,i,c){let u=0;if(t.length===0){for(;u<c;u++)e[u]=n[u];for(;u<i;u++)e[u]=n[u]+(e[u-c]>>1)&255}else{for(;u<c;u++)e[u]=n[u]+(t[u]>>1)&255;for(;u<i;u++)e[u]=n[u]+(e[u-c]+t[u]>>1)&255}}function KT(n,e,t,i,c){let u=0;if(t.length===0){for(;u<c;u++)e[u]=n[u];for(;u<i;u++)e[u]=n[u]+e[u-c]&255}else{for(;u<c;u++)e[u]=n[u]+t[u]&255;for(;u<i;u++)e[u]=n[u]+Sk(e[u-c],t[u],t[u-c])&255}}function Sk(n,e,t){const i=n+e-t,c=Math.abs(i-n),u=Math.abs(i-e),m=Math.abs(i-t);return c<=u&&c<=m?n:u<=m?e:t}function Ek(n,e,t,i,c,u){switch(n){case 0:GT(e,t,c);break;case 1:WT(e,t,c,u);break;case 2:HT(e,t,i,c);break;case 3:XT(e,t,i,c,u);break;case 4:KT(e,t,i,c,u);break;default:throw new Error(`Unsupported filter: ${n}`)}}const Ak=new Uint16Array([255]),Tk=new Uint8Array(Ak.buffer),Ik=Tk[0]===255;function Ck(n){const{data:e,width:t,height:i,channels:c,depth:u}=n,m=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],_=Math.ceil(u/8)*c,o=new Uint8Array(i*t*_);let w=0;for(let I=0;I<7;I++){const O=m[I],V=Math.ceil((t-O.x)/O.xStep),M=Math.ceil((i-O.y)/O.yStep);if(V<=0||M<=0)continue;const se=V*_,ce=new Uint8Array(se);for(let fe=0;fe<M;fe++){const ne=e[w++],oe=e.subarray(w,w+se);w+=se;const ye=new Uint8Array(se);Ek(ne,oe,ye,ce,se,_),ce.set(ye);for(let he=0;he<V;he++){const Ne=O.x+he*O.xStep,Ve=O.y+fe*O.yStep;if(!(Ne>=t||Ve>=i))for(let de=0;de<_;de++)o[(Ve*t+Ne)*_+de]=ye[he*_+de]}}}if(u===16){const I=new Uint16Array(o.buffer);if(Ik)for(let O=0;O<I.length;O++)I[O]=Lk(I[O]);return I}else return o}function Lk(n){return(n&255)<<8|n>>8&255}const Pk=new Uint16Array([255]),kk=new Uint8Array(Pk.buffer),Mk=kk[0]===255,Rk=new Uint8Array(0);function Y2(n){const{data:e,width:t,height:i,channels:c,depth:u}=n,m=Math.ceil(u/8)*c,_=Math.ceil(u/8*c*t),o=new Uint8Array(i*_);let w=Rk,I=0,O,V;for(let M=0;M<i;M++){switch(O=e.subarray(I+1,I+1+_),V=o.subarray(M*_,(M+1)*_),e[I]){case 0:GT(O,V,_);break;case 1:WT(O,V,_,m);break;case 2:HT(O,V,w,_);break;case 3:XT(O,V,w,_,m);break;case 4:KT(O,V,w,_,m);break;default:throw new Error(`Unsupported filter: ${e[I]}`)}w=V,I+=_+1}if(u===16){const M=new Uint16Array(o.buffer);if(Mk)for(let se=0;se<M.length;se++)M[se]=Nk(M[se]);return M}else return o}function Nk(n){return(n&255)<<8|n>>8&255}const I1=Uint8Array.of(137,80,78,71,13,10,26,10);function J2(n){if(!Dk(n.readBytes(I1.length)))throw new Error("wrong PNG signature")}function Dk(n){if(n.length<I1.length)return!1;for(let e=0;e<I1.length;e++)if(n[e]!==I1[e])return!1;return!0}const Fk="tEXt",Ok=0,ZT=new TextDecoder("latin1");function Bk(n){if(jk(n),n.length===0||n.length>79)throw new Error("keyword length must be between 1 and 79")}const zk=/^[\u0000-\u00FF]*$/;function jk(n){if(!zk.test(n))throw new Error("invalid latin1 text")}function Uk(n,e,t){const i=YT(e);n[i]=Vk(e,t-i.length-1)}function YT(n){for(n.mark();n.readByte()!==Ok;);const e=n.offset;n.reset();const t=ZT.decode(n.readBytes(e-n.offset-1));return n.skip(1),Bk(t),t}function Vk(n,e){return ZT.decode(n.readBytes(e))}const Jh={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},cb={UNKNOWN:-1,DEFLATE:0},Q2={UNKNOWN:-1,ADAPTIVE:0},ub={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},n1={NONE:0,BACKGROUND:1,PREVIOUS:2},hb={SOURCE:0,OVER:1};class qk extends rw{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(e,t={}){super(e);const{checkCrc:i=!1}=t;this._checkCrc=i,this._inflator=new X2,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=cb.UNKNOWN,this._filterMethod=Q2.UNKNOWN,this._interlaceMethod=ub.UNKNOWN,this._colorType=Jh.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(J2(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(J2(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){const i=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case Fk:Uk(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?Z2(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){const i=this.offset;switch(t!=="fdAT"&&t!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=i+e;break}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?Z2(this,e+4,t):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=$k(this.readUint8());const t=this.readUint8();this._colorType=t;let i;switch(t){case Jh.GREYSCALE:i=1;break;case Jh.TRUECOLOUR:i=3;break;case Jh.INDEXED_COLOUR:i=1;break;case Jh.GREYSCALE_ALPHA:i=2;break;case Jh.TRUECOLOUR_ALPHA:i=4;break;case Jh.UNKNOWN:default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=i,this._compressionMethod=this.readUint8(),this._compressionMethod!==cb.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const i=[];this._palette=i;for(let c=0;c<t;c++)i.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const t=e,i=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,i,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,i=this.offset+this.byteOffset;if(i+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,i,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodetRNS(e){switch(this._colorType){case Jh.GREYSCALE:case Jh.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break}case Jh.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const i=this.readByte();this._palette[t].push(i)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}case Jh.UNKNOWN:case Jh.GREYSCALE_ALPHA:case Jh.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){const t=YT(this),i=this.readUint8();if(i!==cb.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${i}`);const c=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:xk(c)}}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),i=this.readByte();this._png.resolution={x:e,y:t,unit:i}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},i=this._frames.at(e);if(i){if(i.data=Y2({data:i.data,width:i.width,height:i.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),e===0||i.xOffset===0&&i.yOffset===0&&i.width===this._png.width&&i.height===this._png.height)t.data=i.data;else{const c=this._apng.frames.at(e-1);this.disposeFrame(i,c,t),this.addFrameDataToCanvas(t,i)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,i){switch(e.disposeOp){case n1.NONE:break;case n1.BACKGROUND:for(let c=0;c<this._png.height;c++)for(let u=0;u<this._png.width;u++){const m=(c*e.width+u)*this._png.channels;for(let _=0;_<this._png.channels;_++)i.data[m+_]=0}break;case n1.PREVIOUS:i.data.set(t.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){const i=1<<this._png.depth,c=(u,m)=>{const _=((u+t.yOffset)*this._png.width+t.xOffset+m)*this._png.channels,o=(u*t.width+m)*this._png.channels;return{index:_,frameIndex:o}};switch(t.blendOp){case hb.SOURCE:for(let u=0;u<t.height;u++)for(let m=0;m<t.width;m++){const{index:_,frameIndex:o}=c(u,m);for(let w=0;w<this._png.channels;w++)e.data[_+w]=t.data[o+w]}break;case hb.OVER:for(let u=0;u<t.height;u++)for(let m=0;m<t.width;m++){const{index:_,frameIndex:o}=c(u,m);for(let w=0;w<this._png.channels;w++){const I=t.data[o+this._png.channels-1]/i,O=w%(this._png.channels-1)===0?1:t.data[o+w],V=Math.floor(I*O+(1-I)*e.data[_+w]);e.data[_+w]+=V}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==Q2.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===ub.NO_INTERLACE)this._png.data=Y2({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===ub.ADAM7)this._png.data=Ck({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:n1.NONE,blendOp:hb.SOURCE,data:e}),this._inflator=new X2,this._writingDataChunks=!1}}function $k(n){if(n!==1&&n!==2&&n!==4&&n!==8&&n!==16)throw new Error(`invalid bit depth: ${n}`);return n}var eS;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.METRE=1]="METRE"})(eS||(eS={}));function Gk(n,e){return new qk(n,e).decode()}var ao=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function db(){ao.console&&typeof ao.console.log=="function"&&ao.console.log.apply(ao.console,arguments)}var za={log:db,warn:function(n){ao.console&&(typeof ao.console.warn=="function"?ao.console.warn.apply(ao.console,arguments):db.call(null,arguments))},error:function(n){ao.console&&(typeof ao.console.error=="function"?ao.console.error.apply(ao.console,arguments):db(n))}};function fb(n,e,t){var i=new XMLHttpRequest;i.open("GET",n),i.responseType="blob",i.onload=function(){Lm(i.response,e,t)},i.onerror=function(){za.error("could not download file")},i.send()}function tS(n){var e=new XMLHttpRequest;e.open("HEAD",n,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function r1(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(e)}}var Lm=ao.saveAs||((typeof window>"u"?"undefined":ba(window))!=="object"||window!==ao?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(n,e,t){var i=ao.URL||ao.webkitURL,c=document.createElement("a");e=e||n.name||"download",c.download=e,c.rel="noopener",typeof n=="string"?(c.href=n,c.origin!==location.origin?tS(c.href)?fb(n,e,t):r1(c,c.target="_blank"):r1(c)):(c.href=i.createObjectURL(n),setTimeout(function(){i.revokeObjectURL(c.href)},4e4),setTimeout(function(){r1(c)},0))}:"msSaveOrOpenBlob"in navigator?function(n,e,t){if(e=e||n.name||"download",typeof n=="string")if(tS(n))fb(n,e,t);else{var i=document.createElement("a");i.href=n,i.target="_blank",setTimeout(function(){r1(i)})}else navigator.msSaveOrOpenBlob((function(c,u){return u===void 0?u={autoBom:!1}:ba(u)!=="object"&&(za.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(c.type)?new Blob(["\uFEFF",c],{type:c.type}):c})(n,t),e)}:function(n,e,t,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),typeof n=="string")return fb(n,e,t);var c=n.type==="application/octet-stream",u=/constructor/i.test(ao.HTMLElement)||ao.safari,m=/CriOS\/[\d]+/.test(navigator.userAgent);if((m||c&&u)&&(typeof FileReader>"u"?"undefined":ba(FileReader))==="object"){var _=new FileReader;_.onloadend=function(){var I=_.result;I=m?I:I.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=I:location=I,i=null},_.readAsDataURL(n)}else{var o=ao.URL||ao.webkitURL,w=o.createObjectURL(n);i?i.location=w:location.href=w,i=null,setTimeout(function(){o.revokeObjectURL(w)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function JT(n){var e;n=n||"",this.ok=!1,n.charAt(0)=="#"&&(n=n.substr(1,6)),n={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[n=(n=n.replace(/ /g,"")).toLowerCase()]||n;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(_){return[parseInt(_[1]),parseInt(_[2]),parseInt(_[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(_){return[parseInt(_[1],16),parseInt(_[2],16),parseInt(_[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(_){return[parseInt(_[1]+_[1],16),parseInt(_[2]+_[2],16),parseInt(_[3]+_[3],16)]}}],i=0;i<t.length;i++){var c=t[i].re,u=t[i].process,m=c.exec(n);m&&(e=u(m),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var _=this.r.toString(16),o=this.g.toString(16),w=this.b.toString(16);return _.length==1&&(_="0"+_),o.length==1&&(o="0"+o),w.length==1&&(w="0"+w),"#"+_+o+w}}var C1=ao.atob.bind(ao),nS=ao.btoa.bind(ao);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function pb(n,e){var t=n[0],i=n[1],c=n[2],u=n[3];t=lh(t,i,c,u,e[0],7,-680876936),u=lh(u,t,i,c,e[1],12,-389564586),c=lh(c,u,t,i,e[2],17,606105819),i=lh(i,c,u,t,e[3],22,-1044525330),t=lh(t,i,c,u,e[4],7,-176418897),u=lh(u,t,i,c,e[5],12,1200080426),c=lh(c,u,t,i,e[6],17,-1473231341),i=lh(i,c,u,t,e[7],22,-45705983),t=lh(t,i,c,u,e[8],7,1770035416),u=lh(u,t,i,c,e[9],12,-1958414417),c=lh(c,u,t,i,e[10],17,-42063),i=lh(i,c,u,t,e[11],22,-1990404162),t=lh(t,i,c,u,e[12],7,1804603682),u=lh(u,t,i,c,e[13],12,-40341101),c=lh(c,u,t,i,e[14],17,-1502002290),t=ch(t,i=lh(i,c,u,t,e[15],22,1236535329),c,u,e[1],5,-165796510),u=ch(u,t,i,c,e[6],9,-1069501632),c=ch(c,u,t,i,e[11],14,643717713),i=ch(i,c,u,t,e[0],20,-373897302),t=ch(t,i,c,u,e[5],5,-701558691),u=ch(u,t,i,c,e[10],9,38016083),c=ch(c,u,t,i,e[15],14,-660478335),i=ch(i,c,u,t,e[4],20,-405537848),t=ch(t,i,c,u,e[9],5,568446438),u=ch(u,t,i,c,e[14],9,-1019803690),c=ch(c,u,t,i,e[3],14,-187363961),i=ch(i,c,u,t,e[8],20,1163531501),t=ch(t,i,c,u,e[13],5,-1444681467),u=ch(u,t,i,c,e[2],9,-51403784),c=ch(c,u,t,i,e[7],14,1735328473),t=uh(t,i=ch(i,c,u,t,e[12],20,-1926607734),c,u,e[5],4,-378558),u=uh(u,t,i,c,e[8],11,-2022574463),c=uh(c,u,t,i,e[11],16,1839030562),i=uh(i,c,u,t,e[14],23,-35309556),t=uh(t,i,c,u,e[1],4,-1530992060),u=uh(u,t,i,c,e[4],11,1272893353),c=uh(c,u,t,i,e[7],16,-155497632),i=uh(i,c,u,t,e[10],23,-1094730640),t=uh(t,i,c,u,e[13],4,681279174),u=uh(u,t,i,c,e[0],11,-358537222),c=uh(c,u,t,i,e[3],16,-722521979),i=uh(i,c,u,t,e[6],23,76029189),t=uh(t,i,c,u,e[9],4,-640364487),u=uh(u,t,i,c,e[12],11,-421815835),c=uh(c,u,t,i,e[15],16,530742520),t=hh(t,i=uh(i,c,u,t,e[2],23,-995338651),c,u,e[0],6,-198630844),u=hh(u,t,i,c,e[7],10,1126891415),c=hh(c,u,t,i,e[14],15,-1416354905),i=hh(i,c,u,t,e[5],21,-57434055),t=hh(t,i,c,u,e[12],6,1700485571),u=hh(u,t,i,c,e[3],10,-1894986606),c=hh(c,u,t,i,e[10],15,-1051523),i=hh(i,c,u,t,e[1],21,-2054922799),t=hh(t,i,c,u,e[8],6,1873313359),u=hh(u,t,i,c,e[15],10,-30611744),c=hh(c,u,t,i,e[6],15,-1560198380),i=hh(i,c,u,t,e[13],21,1309151649),t=hh(t,i,c,u,e[4],6,-145523070),u=hh(u,t,i,c,e[11],10,-1120210379),c=hh(c,u,t,i,e[2],15,718787259),i=hh(i,c,u,t,e[9],21,-343485551),n[0]=$p(t,n[0]),n[1]=$p(i,n[1]),n[2]=$p(c,n[2]),n[3]=$p(u,n[3])}function zv(n,e,t,i,c,u){return e=$p($p(e,n),$p(i,u)),$p(e<<c|e>>>32-c,t)}function lh(n,e,t,i,c,u,m){return zv(e&t|~e&i,n,e,c,u,m)}function ch(n,e,t,i,c,u,m){return zv(e&i|t&~i,n,e,c,u,m)}function uh(n,e,t,i,c,u,m){return zv(e^t^i,n,e,c,u,m)}function hh(n,e,t,i,c,u,m){return zv(t^(e|~i),n,e,c,u,m)}function QT(n){var e,t=n.length,i=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=n.length;e+=64)pb(i,Wk(n.substring(e-64,e)));n=n.substring(e-64);var c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<n.length;e++)c[e>>2]|=n.charCodeAt(e)<<(e%4<<3);if(c[e>>2]|=128<<(e%4<<3),e>55)for(pb(i,c),e=0;e<16;e++)c[e]=0;return c[14]=8*t,pb(i,c),i}function Wk(n){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=n.charCodeAt(e)+(n.charCodeAt(e+1)<<8)+(n.charCodeAt(e+2)<<16)+(n.charCodeAt(e+3)<<24);return t}var rS="0123456789abcdef".split("");function Hk(n){for(var e="",t=0;t<4;t++)e+=rS[n>>8*t+4&15]+rS[n>>8*t&15];return e}function Xk(n){return String.fromCharCode(255&n,(65280&n)>>8,(16711680&n)>>16,(4278190080&n)>>24)}function o5(n){return QT(n).map(Xk).join("")}var Kk=(function(n){for(var e=0;e<n.length;e++)n[e]=Hk(n[e]);return n.join("")})(QT("hello"))!="5d41402abc4b2a76b9719d911017c592";function $p(n,e){if(Kk){var t=(65535&n)+(65535&e);return(n>>16)+(e>>16)+(t>>16)<<16|65535&t}return n+e&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function s5(n,e){var t,i,c,u;if(n!==t){for(var m=(c=n,u=1+(256/n.length|0),new Array(u+1).join(c)),_=[],o=0;o<256;o++)_[o]=o;var w=0;for(o=0;o<256;o++){var I=_[o];w=(w+I+m.charCodeAt(o))%256,_[o]=_[w],_[w]=I}t=n,i=_}else _=i;var O=e.length,V=0,M=0,se="";for(o=0;o<O;o++)M=(M+(I=_[V=(V+1)%256]))%256,_[V]=_[M],_[M]=I,m=_[(_[V]+_[M])%256],se+=String.fromCharCode(e.charCodeAt(o)^m);return se}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var iS={print:4,modify:8,copy:16,"annot-forms":32};function Og(n,e,t,i){this.v=1,this.r=2;var c=192;n.forEach(function(_){if(iS.perm!==void 0)throw new Error("Invalid permission: "+_);c+=iS[_]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var u=(e+this.padding).substr(0,32),m=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(u,m),this.P=-(1+(255^c)),this.encryptionKey=o5(u+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(i)).substr(0,5),this.U=s5(this.encryptionKey,this.padding)}function Bg(n){if(/[^\u0000-\u00ff]/.test(n))throw new Error("Invalid PDF Name Object: "+n+", Only accept ASCII characters.");for(var e="",t=n.length,i=0;i<t;i++){var c=n.charCodeAt(i);e+=c<33||c===35||c===37||c===40||c===41||c===47||c===60||c===62||c===91||c===93||c===123||c===125||c>126?"#"+("0"+c.toString(16)).slice(-2):n[i]}return e}function oS(n){if(ba(n)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,i,c){if(c=c||!1,typeof t!="string"||typeof i!="function"||typeof c!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var u=Math.random().toString(35);return e[t][u]=[i,!!c],u},this.unsubscribe=function(t){for(var i in e)if(e[i][t])return delete e[i][t],Object.keys(e[i]).length===0&&delete e[i],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var i=Array.prototype.slice.call(arguments,1),c=[];for(var u in e[t]){var m=e[t][u];try{m[0].apply(n,i)}catch(_){ao.console&&za.error("jsPDF PubSub Error",_.message,_)}m[1]&&c.push(u)}c.length&&c.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function nv(n){if(!(this instanceof nv))return new nv(n);var e="opacity,stroke-opacity".split(",");for(var t in n)n.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=n[t]);this.id="",this.objectNumber=-1}function e6(n,e){this.gState=n,this.matrix=e,this.id="",this.objectNumber=-1}function Rm(n,e,t,i,c){if(!(this instanceof Rm))return new Rm(n,e,t,i,c);this.type=n==="axial"?2:3,this.coords=e,this.colors=t,e6.call(this,i,c)}function $g(n,e,t,i,c){if(!(this instanceof $g))return new $g(n,e,t,i,c);this.boundingBox=n,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,e6.call(this,i,c)}function wi(n){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",i=arguments[1],c=arguments[2],u=arguments[3],m=[],_=1,o=16,w="S",I=null;ba(n=n||{})==="object"&&(t=n.orientation,i=n.unit||i,c=n.format||c,u=n.compress||n.compressPdf||u,(I=n.encryption||null)!==null&&(I.userPassword=I.userPassword||"",I.ownerPassword=I.ownerPassword||"",I.userPermissions=I.userPermissions||[]),_=typeof n.userUnit=="number"?Math.abs(n.userUnit):1,n.precision!==void 0&&(e=n.precision),n.floatPrecision!==void 0&&(o=n.floatPrecision),w=n.defaultPathOperation||"S"),m=n.filters||(u===!0?["FlateEncode"]:m),i=i||"mm",t=(""+(t||"P")).toLowerCase();var O=n.putOnlyUsedFonts||!1,V={},M={internal:{},__private__:{}};M.__private__.PubSub=oS;var se="1.3",ce=M.__private__.getPdfVersion=function(){return se};M.__private__.setPdfVersion=function(H){se=H};var fe={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};M.__private__.getPageFormats=function(){return fe};var ne=M.__private__.getPageFormat=function(H){return fe[H]};c=c||"a4";var oe="compat",ye="advanced",he=oe;function Ne(){this.saveGraphicsState(),it(new Mt(br,0,0,-br,0,Ws()*br).toString()+" cm"),this.setFontSize(this.getFontSize()/br),w="n",he=ye}function Ve(){this.restoreGraphicsState(),w="S",he=oe}var de=M.__private__.combineFontStyleAndFontWeight=function(H,Le){if(H=="bold"&&Le=="normal"||H=="bold"&&Le==400||H=="normal"&&Le=="italic"||H=="bold"&&Le=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Le&&(H=Le==400||Le==="normal"?H==="italic"?"italic":"normal":Le!=700&&Le!=="bold"||H!=="normal"?(Le==700?"bold":Le)+""+H:"bold"),H};M.advancedAPI=function(H){var Le=he===oe;return Le&&Ne.call(this),typeof H!="function"||(H(this),Le&&Ve.call(this)),this},M.compatAPI=function(H){var Le=he===ye;return Le&&Ve.call(this),typeof H!="function"||(H(this),Le&&Ne.call(this)),this},M.isAdvancedAPI=function(){return he===ye};var j,D=function(H){if(he!==ye)throw new Error(H+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},$=M.roundToPrecision=M.__private__.roundToPrecision=function(H,Le){var pt=e||Le;if(isNaN(H)||isNaN(pt))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return H.toFixed(pt).replace(/0+$/,"")};j=M.hpf=M.__private__.hpf=typeof o=="number"?function(H){if(isNaN(H))throw new Error("Invalid argument passed to jsPDF.hpf");return $(H,o)}:o==="smart"?function(H){if(isNaN(H))throw new Error("Invalid argument passed to jsPDF.hpf");return $(H,H>-1&&H<1?16:5)}:function(H){if(isNaN(H))throw new Error("Invalid argument passed to jsPDF.hpf");return $(H,16)};var z=M.f2=M.__private__.f2=function(H){if(isNaN(H))throw new Error("Invalid argument passed to jsPDF.f2");return $(H,2)},W=M.__private__.f3=function(H){if(isNaN(H))throw new Error("Invalid argument passed to jsPDF.f3");return $(H,3)},Z=M.scale=M.__private__.scale=function(H){if(isNaN(H))throw new Error("Invalid argument passed to jsPDF.scale");return he===oe?H*br:he===ye?H:void 0},Ee=function(H){return Z((function(Le){return he===oe?Ws()-Le:he===ye?Le:void 0})(H))};M.__private__.setPrecision=M.setPrecision=function(H){typeof parseInt(H,10)=="number"&&(e=parseInt(H,10))};var ke,Oe="00000000000000000000000000000000",Re=M.__private__.getFileId=function(){return Oe},be=M.__private__.setFileId=function(H){return Oe=H!==void 0&&/^[a-fA-F0-9]{32}$/.test(H)?H.toUpperCase():Oe.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),I!==null&&(Fr=new Og(I.userPermissions,I.userPassword,I.ownerPassword,Oe)),Oe};M.setFileId=function(H){return be(H),this},M.getFileId=function(){return Re()};var De=M.__private__.convertDateToPDFDate=function(H){var Le=H.getTimezoneOffset(),pt=Le<0?"+":"-",Pt=Math.floor(Math.abs(Le/60)),qt=Math.abs(Le%60),on=[pt,Fe(Pt),"'",Fe(qt),"'"].join("");return["D:",H.getFullYear(),Fe(H.getMonth()+1),Fe(H.getDate()),Fe(H.getHours()),Fe(H.getMinutes()),Fe(H.getSeconds()),on].join("")},Qe=M.__private__.convertPDFDateToDate=function(H){var Le=parseInt(H.substr(2,4),10),pt=parseInt(H.substr(6,2),10)-1,Pt=parseInt(H.substr(8,2),10),qt=parseInt(H.substr(10,2),10),on=parseInt(H.substr(12,2),10),Dn=parseInt(H.substr(14,2),10);return new Date(Le,pt,Pt,qt,on,Dn,0)},xe=M.__private__.setCreationDate=function(H){var Le;if(H===void 0&&(H=new Date),H instanceof Date)Le=De(H);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(H))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Le=H}return ke=Le},ae=M.__private__.getCreationDate=function(H){var Le=ke;return H==="jsDate"&&(Le=Qe(ke)),Le};M.setCreationDate=function(H){return xe(H),this},M.getCreationDate=function(H){return ae(H)};var Me,Fe=M.__private__.padd2=function(H){return("0"+parseInt(H)).slice(-2)},Ze=M.__private__.padd2Hex=function(H){return("00"+(H=H.toString())).substr(H.length)},et=0,mt=[],ht=[],Nt=0,Jt=[],tn=[],fn=!1,An=ht;M.__private__.setCustomOutputDestination=function(H){fn=!0,An=H};var zt=function(H){fn||(An=H)};M.__private__.resetCustomOutputDestination=function(){fn=!1,An=ht};var it=M.__private__.out=function(H){return H=H.toString(),Nt+=H.length+1,An.push(H),An},ur=M.__private__.write=function(H){return it(arguments.length===1?H.toString():Array.prototype.join.call(arguments," "))},xr=M.__private__.getArrayBuffer=function(H){for(var Le=H.length,pt=new ArrayBuffer(Le),Pt=new Uint8Array(pt);Le--;)Pt[Le]=H.charCodeAt(Le);return pt},Tr=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];M.__private__.getStandardFonts=function(){return Tr};var Tn=n.fontSize||16;M.__private__.setFontSize=M.setFontSize=function(H){return Tn=he===ye?H/br:H,this};var Yn,$n=M.__private__.getFontSize=M.getFontSize=function(){return he===oe?Tn:Tn*br},hr=n.R2L||!1;M.__private__.setR2L=M.setR2L=function(H){return hr=H,this},M.__private__.getR2L=M.getR2L=function(){return hr};var Wt,Nn=M.__private__.setZoomMode=function(H){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(H))Yn=H;else if(isNaN(H)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(H)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+H+'" is not recognized.');Yn=H}else Yn=parseInt(H,10)};M.__private__.getZoomMode=function(){return Yn};var tr,Hn=M.__private__.setPageMode=function(H){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(H)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+H+'" is not recognized.');Wt=H};M.__private__.getPageMode=function(){return Wt};var Rr=M.__private__.setLayoutMode=function(H){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(H)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+H+'" is not recognized.');tr=H};M.__private__.getLayoutMode=function(){return tr},M.__private__.setDisplayMode=M.setDisplayMode=function(H,Le,pt){return Nn(H),Rr(Le),Hn(pt),this};var lr={title:"",subject:"",author:"",keywords:"",creator:""};M.__private__.getDocumentProperty=function(H){if(Object.keys(lr).indexOf(H)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return lr[H]},M.__private__.getDocumentProperties=function(){return lr},M.__private__.setDocumentProperties=M.setProperties=M.setDocumentProperties=function(H){for(var Le in lr)lr.hasOwnProperty(Le)&&H[Le]&&(lr[Le]=H[Le]);return this},M.__private__.setDocumentProperty=function(H,Le){if(Object.keys(lr).indexOf(H)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return lr[H]=Le};var wr,br,Ir,Bi,Mi,pr={},Jr={},Kr=[],Sr={},ui={},ii={},ut={},we=null,Ie=0,Ye=[],ct=new oS(M),Ct=n.hotfixes||[],Rt={},Bt={},St=[],Mt=function H(Le,pt,Pt,qt,on,Dn){if(!(this instanceof H))return new H(Le,pt,Pt,qt,on,Dn);isNaN(Le)&&(Le=1),isNaN(pt)&&(pt=0),isNaN(Pt)&&(Pt=0),isNaN(qt)&&(qt=1),isNaN(on)&&(on=0),isNaN(Dn)&&(Dn=0),this._matrix=[Le,pt,Pt,qt,on,Dn]};Object.defineProperty(Mt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(H){this._matrix[0]=H}}),Object.defineProperty(Mt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(H){this._matrix[1]=H}}),Object.defineProperty(Mt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(H){this._matrix[2]=H}}),Object.defineProperty(Mt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(H){this._matrix[3]=H}}),Object.defineProperty(Mt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(H){this._matrix[4]=H}}),Object.defineProperty(Mt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(H){this._matrix[5]=H}}),Object.defineProperty(Mt.prototype,"a",{get:function(){return this._matrix[0]},set:function(H){this._matrix[0]=H}}),Object.defineProperty(Mt.prototype,"b",{get:function(){return this._matrix[1]},set:function(H){this._matrix[1]=H}}),Object.defineProperty(Mt.prototype,"c",{get:function(){return this._matrix[2]},set:function(H){this._matrix[2]=H}}),Object.defineProperty(Mt.prototype,"d",{get:function(){return this._matrix[3]},set:function(H){this._matrix[3]=H}}),Object.defineProperty(Mt.prototype,"e",{get:function(){return this._matrix[4]},set:function(H){this._matrix[4]=H}}),Object.defineProperty(Mt.prototype,"f",{get:function(){return this._matrix[5]},set:function(H){this._matrix[5]=H}}),Object.defineProperty(Mt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Mt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Mt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Mt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Mt.prototype.join=function(H){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(j).join(H)},Mt.prototype.multiply=function(H){var Le=H.sx*this.sx+H.shy*this.shx,pt=H.sx*this.shy+H.shy*this.sy,Pt=H.shx*this.sx+H.sy*this.shx,qt=H.shx*this.shy+H.sy*this.sy,on=H.tx*this.sx+H.ty*this.shx+this.tx,Dn=H.tx*this.shy+H.ty*this.sy+this.ty;return new Mt(Le,pt,Pt,qt,on,Dn)},Mt.prototype.decompose=function(){var H=this.sx,Le=this.shy,pt=this.shx,Pt=this.sy,qt=this.tx,on=this.ty,Dn=Math.sqrt(H*H+Le*Le),Pr=(H/=Dn)*pt+(Le/=Dn)*Pt;pt-=H*Pr,Pt-=Le*Pr;var $r=Math.sqrt(pt*pt+Pt*Pt);return Pr/=$r,H*(Pt/=$r)<Le*(pt/=$r)&&(H=-H,Le=-Le,Pr=-Pr,Dn=-Dn),{scale:new Mt(Dn,0,0,$r,0,0),translate:new Mt(1,0,0,1,qt,on),rotate:new Mt(H,Le,-Le,H,0,0),skew:new Mt(1,0,Pr,1,0,0)}},Mt.prototype.toString=function(H){return this.join(" ")},Mt.prototype.inversed=function(){var H=this.sx,Le=this.shy,pt=this.shx,Pt=this.sy,qt=this.tx,on=this.ty,Dn=1/(H*Pt-Le*pt),Pr=Pt*Dn,$r=-Le*Dn,gi=-pt*Dn,xi=H*Dn;return new Mt(Pr,$r,gi,xi,-Pr*qt-gi*on,-$r*qt-xi*on)},Mt.prototype.applyToPoint=function(H){var Le=H.x*this.sx+H.y*this.shx+this.tx,pt=H.x*this.shy+H.y*this.sy+this.ty;return new pl(Le,pt)},Mt.prototype.applyToRectangle=function(H){var Le=this.applyToPoint(H),pt=this.applyToPoint(new pl(H.x+H.w,H.y+H.h));return new ic(Le.x,Le.y,pt.x-Le.x,pt.y-Le.y)},Mt.prototype.clone=function(){var H=this.sx,Le=this.shy,pt=this.shx,Pt=this.sy,qt=this.tx,on=this.ty;return new Mt(H,Le,pt,Pt,qt,on)},M.Matrix=Mt;var vn=M.matrixMult=function(H,Le){return Le.multiply(H)},Bn=new Mt(1,0,0,1,0,0);M.unitMatrix=M.identityMatrix=Bn;var Ln=function(H,Le){if(!ui[H]){var pt=(Le instanceof Rm?"Sh":"P")+(Object.keys(Sr).length+1).toString(10);Le.id=pt,ui[H]=pt,Sr[pt]=Le,ct.publish("addPattern",Le)}};M.ShadingPattern=Rm,M.TilingPattern=$g,M.addShadingPattern=function(H,Le){return D("addShadingPattern()"),Ln(H,Le),this},M.beginTilingPattern=function(H){D("beginTilingPattern()"),$s(H.boundingBox[0],H.boundingBox[1],H.boundingBox[2]-H.boundingBox[0],H.boundingBox[3]-H.boundingBox[1],H.matrix)},M.endTilingPattern=function(H,Le){D("endTilingPattern()"),Le.stream=tn[Me].join(`
`),Ln(H,Le),ct.publish("endTilingPattern",Le),St.pop().restore()};var qr,Cr=M.__private__.newObject=function(){var H=Ar();return Dr(H,!0),H},Ar=M.__private__.newObjectDeferred=function(){return et++,mt[et]=function(){return Nt},et},Dr=function(H,Le){return Le=typeof Le=="boolean"&&Le,mt[H]=Nt,Le&&it(H+" 0 obj"),H},_i=M.__private__.newAdditionalObject=function(){var H={objId:Ar(),content:""};return Jt.push(H),H},ko=Ar(),ro=Ar(),os=M.__private__.decodeColorString=function(H){var Le=H.split(" ");if(Le.length!==2||Le[1]!=="g"&&Le[1]!=="G")Le.length!==5||Le[4]!=="k"&&Le[4]!=="K"||(Le=[(1-Le[0])*(1-Le[3]),(1-Le[1])*(1-Le[3]),(1-Le[2])*(1-Le[3]),"r"]);else{var pt=parseFloat(Le[0]);Le=[pt,pt,pt,"r"]}for(var Pt="#",qt=0;qt<3;qt++)Pt+=("0"+Math.floor(255*parseFloat(Le[qt])).toString(16)).slice(-2);return Pt},Ji=M.__private__.encodeColorString=function(H){var Le;typeof H=="string"&&(H={ch1:H});var pt=H.ch1,Pt=H.ch2,qt=H.ch3,on=H.ch4,Dn=H.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof pt=="string"&&pt.charAt(0)!=="#"){var Pr=new JT(pt);if(Pr.ok)pt=Pr.toHex();else if(!/^\d*\.?\d*$/.test(pt))throw new Error('Invalid color "'+pt+'" passed to jsPDF.encodeColorString.')}if(typeof pt=="string"&&/^#[0-9A-Fa-f]{3}$/.test(pt)&&(pt="#"+pt[1]+pt[1]+pt[2]+pt[2]+pt[3]+pt[3]),typeof pt=="string"&&/^#[0-9A-Fa-f]{6}$/.test(pt)){var $r=parseInt(pt.substr(1),16);pt=$r>>16&255,Pt=$r>>8&255,qt=255&$r}if(Pt===void 0||on===void 0&&pt===Pt&&Pt===qt)Le=typeof pt=="string"?pt+" "+Dn[0]:H.precision===2?z(pt/255)+" "+Dn[0]:W(pt/255)+" "+Dn[0];else if(on===void 0||ba(on)==="object"){if(on&&!isNaN(on.a)&&on.a===0)return["1.","1.","1.",Dn[1]].join(" ");Le=typeof pt=="string"?[pt,Pt,qt,Dn[1]].join(" "):H.precision===2?[z(pt/255),z(Pt/255),z(qt/255),Dn[1]].join(" "):[W(pt/255),W(Pt/255),W(qt/255),Dn[1]].join(" ")}else Le=typeof pt=="string"?[pt,Pt,qt,on,Dn[2]].join(" "):H.precision===2?[z(pt),z(Pt),z(qt),z(on),Dn[2]].join(" "):[W(pt),W(Pt),W(qt),W(on),Dn[2]].join(" ");return Le},Yo=M.__private__.getFilters=function(){return m},oo=M.__private__.putStream=function(H){var Le=(H=H||{}).data||"",pt=H.filters||Yo(),Pt=H.alreadyAppliedFilters||[],qt=H.addLength1||!1,on=Le.length,Dn=H.objectId,Pr=function($o){return $o};if(I!==null&&Dn===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");I!==null&&(Pr=Fr.encryptor(Dn,0));var $r={};pt===!0&&(pt=["FlateEncode"]);var gi=H.additionalKeyValues||[],xi=($r=wi.API.processDataByFilters!==void 0?wi.API.processDataByFilters(Le,pt):{data:Le,reverseChain:[]}).reverseChain+(Array.isArray(Pt)?Pt.join(" "):Pt.toString());if($r.data.length!==0&&(gi.push({key:"Length",value:$r.data.length}),qt===!0&&gi.push({key:"Length1",value:on})),xi.length!=0)if(xi.split("/").length-1==1)gi.push({key:"Filter",value:xi});else{gi.push({key:"Filter",value:"["+xi+"]"});for(var so=0;so<gi.length;so+=1)if(gi[so].key==="DecodeParms"){for(var lo=[],_s=0;_s<$r.reverseChain.split("/").length-1;_s+=1)lo.push("null");lo.push(gi[so].value),gi[so].value="["+lo.join(" ")+"]"}}it("<<");for(var eo=0;eo<gi.length;eo++)it("/"+gi[eo].key+" "+gi[eo].value);it(">>"),$r.data.length!==0&&(it("stream"),it(Pr($r.data)),it("endstream"))},Jo=M.__private__.putPage=function(H){var Le=H.number,pt=H.data,Pt=H.objId,qt=H.contentsObjId;Dr(Pt,!0),it("<</Type /Page"),it("/Parent "+H.rootDictionaryObjId+" 0 R"),it("/Resources "+H.resourceDictionaryObjId+" 0 R"),it("/MediaBox ["+parseFloat(j(H.mediaBox.bottomLeftX))+" "+parseFloat(j(H.mediaBox.bottomLeftY))+" "+j(H.mediaBox.topRightX)+" "+j(H.mediaBox.topRightY)+"]"),H.cropBox!==null&&it("/CropBox ["+j(H.cropBox.bottomLeftX)+" "+j(H.cropBox.bottomLeftY)+" "+j(H.cropBox.topRightX)+" "+j(H.cropBox.topRightY)+"]"),H.bleedBox!==null&&it("/BleedBox ["+j(H.bleedBox.bottomLeftX)+" "+j(H.bleedBox.bottomLeftY)+" "+j(H.bleedBox.topRightX)+" "+j(H.bleedBox.topRightY)+"]"),H.trimBox!==null&&it("/TrimBox ["+j(H.trimBox.bottomLeftX)+" "+j(H.trimBox.bottomLeftY)+" "+j(H.trimBox.topRightX)+" "+j(H.trimBox.topRightY)+"]"),H.artBox!==null&&it("/ArtBox ["+j(H.artBox.bottomLeftX)+" "+j(H.artBox.bottomLeftY)+" "+j(H.artBox.topRightX)+" "+j(H.artBox.topRightY)+"]"),typeof H.userUnit=="number"&&H.userUnit!==1&&it("/UserUnit "+H.userUnit),ct.publish("putPage",{objId:Pt,pageContext:Ye[Le],pageNumber:Le,page:pt}),it("/Contents "+qt+" 0 R"),it(">>"),it("endobj");var on=pt.join(`
`);return he===ye&&(on+=`
Q`),Dr(qt,!0),oo({data:on,filters:Yo(),objectId:qt}),it("endobj"),Pt},La=M.__private__.putPages=function(){var H,Le,pt=[];for(H=1;H<=Ie;H++)Ye[H].objId=Ar(),Ye[H].contentsObjId=Ar();for(H=1;H<=Ie;H++)pt.push(Jo({number:H,data:tn[H],objId:Ye[H].objId,contentsObjId:Ye[H].contentsObjId,mediaBox:Ye[H].mediaBox,cropBox:Ye[H].cropBox,bleedBox:Ye[H].bleedBox,trimBox:Ye[H].trimBox,artBox:Ye[H].artBox,userUnit:Ye[H].userUnit,rootDictionaryObjId:ko,resourceDictionaryObjId:ro}));Dr(ko,!0),it("<</Type /Pages");var Pt="/Kids [";for(Le=0;Le<Ie;Le++)Pt+=pt[Le]+" 0 R ";it(Pt+"]"),it("/Count "+Ie),it(">>"),it("endobj"),ct.publish("postPutPages")},zl=function(H){ct.publish("putFont",{font:H,out:it,newObject:Cr,putStream:oo}),H.isAlreadyPutted!==!0&&(H.objectNumber=Cr(),it("<<"),it("/Type /Font"),it("/BaseFont /"+Bg(H.postScriptName)),it("/Subtype /Type1"),typeof H.encoding=="string"&&it("/Encoding /"+H.encoding),it("/FirstChar 32"),it("/LastChar 255"),it(">>"),it("endobj"))},jl=function(H){H.objectNumber=Cr();var Le=[];Le.push({key:"Type",value:"/XObject"}),Le.push({key:"Subtype",value:"/Form"}),Le.push({key:"BBox",value:"["+[j(H.x),j(H.y),j(H.x+H.width),j(H.y+H.height)].join(" ")+"]"}),Le.push({key:"Matrix",value:"["+H.matrix.toString()+"]"});var pt=H.pages[1].join(`
`);oo({data:pt,additionalKeyValues:Le,objectId:H.objectNumber}),it("endobj")},Fi=function(H,Le){Le||(Le=21);var pt=Cr(),Pt=(function(Dn,Pr){var $r,gi=[],xi=1/(Pr-1);for($r=0;$r<1;$r+=xi)gi.push($r);if(gi.push(1),Dn[0].offset!=0){var so={offset:0,color:Dn[0].color};Dn.unshift(so)}if(Dn[Dn.length-1].offset!=1){var lo={offset:1,color:Dn[Dn.length-1].color};Dn.push(lo)}for(var _s="",eo=0,$o=0;$o<gi.length;$o++){for($r=gi[$o];$r>Dn[eo+1].offset;)eo++;var Go=Dn[eo].offset,ds=($r-Go)/(Dn[eo+1].offset-Go),zo=Dn[eo].color,Ms=Dn[eo+1].color;_s+=Ze(Math.round((1-ds)*zo[0]+ds*Ms[0]).toString(16))+Ze(Math.round((1-ds)*zo[1]+ds*Ms[1]).toString(16))+Ze(Math.round((1-ds)*zo[2]+ds*Ms[2]).toString(16))}return _s.trim()})(H.colors,Le),qt=[];qt.push({key:"FunctionType",value:"0"}),qt.push({key:"Domain",value:"[0.0 1.0]"}),qt.push({key:"Size",value:"["+Le+"]"}),qt.push({key:"BitsPerSample",value:"8"}),qt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),qt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),oo({data:Pt,additionalKeyValues:qt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:pt}),it("endobj"),H.objectNumber=Cr(),it("<< /ShadingType "+H.type),it("/ColorSpace /DeviceRGB");var on="/Coords ["+j(parseFloat(H.coords[0]))+" "+j(parseFloat(H.coords[1]))+" ";H.type===2?on+=j(parseFloat(H.coords[2]))+" "+j(parseFloat(H.coords[3])):on+=j(parseFloat(H.coords[2]))+" "+j(parseFloat(H.coords[3]))+" "+j(parseFloat(H.coords[4]))+" "+j(parseFloat(H.coords[5])),it(on+="]"),H.matrix&&it("/Matrix ["+H.matrix.toString()+"]"),it("/Function "+pt+" 0 R"),it("/Extend [true true]"),it(">>"),it("endobj")},nc=function(H,Le){var pt=Ar(),Pt=Cr();Le.push({resourcesOid:pt,objectOid:Pt}),H.objectNumber=Pt;var qt=[];qt.push({key:"Type",value:"/Pattern"}),qt.push({key:"PatternType",value:"1"}),qt.push({key:"PaintType",value:"1"}),qt.push({key:"TilingType",value:"1"}),qt.push({key:"BBox",value:"["+H.boundingBox.map(j).join(" ")+"]"}),qt.push({key:"XStep",value:j(H.xStep)}),qt.push({key:"YStep",value:j(H.yStep)}),qt.push({key:"Resources",value:pt+" 0 R"}),H.matrix&&qt.push({key:"Matrix",value:"["+H.matrix.toString()+"]"}),oo({data:H.stream,additionalKeyValues:qt,objectId:H.objectNumber}),it("endobj")},Hc=function(H){for(var Le in H.objectNumber=Cr(),it("<<"),H)switch(Le){case"opacity":it("/ca "+z(H[Le]));break;case"stroke-opacity":it("/CA "+z(H[Le]))}it(">>"),it("endobj")},Oi=function(H){Dr(H.resourcesOid,!0),it("<<"),it("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var Le in it("/Font <<"),pr)pr.hasOwnProperty(Le)&&(O===!1||O===!0&&V.hasOwnProperty(Le))&&it("/"+Le+" "+pr[Le].objectNumber+" 0 R");it(">>")})(),(function(){if(Object.keys(Sr).length>0){for(var Le in it("/Shading <<"),Sr)Sr.hasOwnProperty(Le)&&Sr[Le]instanceof Rm&&Sr[Le].objectNumber>=0&&it("/"+Le+" "+Sr[Le].objectNumber+" 0 R");ct.publish("putShadingPatternDict"),it(">>")}})(),(function(Le){if(Object.keys(Sr).length>0){for(var pt in it("/Pattern <<"),Sr)Sr.hasOwnProperty(pt)&&Sr[pt]instanceof M.TilingPattern&&Sr[pt].objectNumber>=0&&Sr[pt].objectNumber<Le&&it("/"+pt+" "+Sr[pt].objectNumber+" 0 R");ct.publish("putTilingPatternDict"),it(">>")}})(H.objectOid),(function(){if(Object.keys(ii).length>0){var Le;for(Le in it("/ExtGState <<"),ii)ii.hasOwnProperty(Le)&&ii[Le].objectNumber>=0&&it("/"+Le+" "+ii[Le].objectNumber+" 0 R");ct.publish("putGStateDict"),it(">>")}})(),(function(){for(var Le in it("/XObject <<"),Rt)Rt.hasOwnProperty(Le)&&Rt[Le].objectNumber>=0&&it("/"+Le+" "+Rt[Le].objectNumber+" 0 R");ct.publish("putXobjectDict"),it(">>")})(),it(">>"),it("endobj")},Sc=function(H){Jr[H.fontName]=Jr[H.fontName]||{},Jr[H.fontName][H.fontStyle]=H.id},Pa=function(H,Le,pt,Pt,qt){var on={id:"F"+(Object.keys(pr).length+1).toString(10),postScriptName:H,fontName:Le,fontStyle:pt,encoding:Pt,isStandardFont:qt||!1,metadata:{}};return ct.publish("addFont",{font:on,instance:this}),pr[on.id]=on,Sc(on),on.id},Qo=M.__private__.pdfEscape=M.pdfEscape=function(H,Le){return(function(pt,Pt){var qt,on,Dn,Pr,$r,gi,xi,so,lo;if(Dn=(Pt=Pt||{}).sourceEncoding||"Unicode",$r=Pt.outputEncoding,(Pt.autoencode||$r)&&pr[wr].metadata&&pr[wr].metadata[Dn]&&pr[wr].metadata[Dn].encoding&&(Pr=pr[wr].metadata[Dn].encoding,!$r&&pr[wr].encoding&&($r=pr[wr].encoding),!$r&&Pr.codePages&&($r=Pr.codePages[0]),typeof $r=="string"&&($r=Pr[$r]),$r)){for(xi=!1,gi=[],qt=0,on=pt.length;qt<on;qt++)(so=$r[pt.charCodeAt(qt)])?gi.push(String.fromCharCode(so)):gi.push(pt[qt]),gi[qt].charCodeAt(0)>>8&&(xi=!0);pt=gi.join("")}for(qt=pt.length;xi===void 0&&qt!==0;)pt.charCodeAt(qt-1)>>8&&(xi=!0),qt--;if(!xi)return pt;for(gi=Pt.noBOM?[]:[254,255],qt=0,on=pt.length;qt<on;qt++){if((lo=(so=pt.charCodeAt(qt))>>8)>>8)throw new Error("Character at position "+qt+" of string '"+pt+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");gi.push(lo),gi.push(so-(lo<<8))}return String.fromCharCode.apply(void 0,gi)})(H,Le).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Sa=M.__private__.beginPage=function(H){tn[++Ie]=[],Ye[Ie]={objId:0,contentsObjId:0,userUnit:Number(_),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(H[0]),topRightY:Number(H[1])}},Ea(Ie),zt(tn[Me])},Ec=function(H,Le){var pt,Pt,qt;switch(t=Le||t,typeof H=="string"&&(pt=ne(H.toLowerCase()),Array.isArray(pt)&&(Pt=pt[0],qt=pt[1])),Array.isArray(H)&&(Pt=H[0]*br,qt=H[1]*br),isNaN(Pt)&&(Pt=c[0],qt=c[1]),(Pt>14400||qt>14400)&&(za.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Pt=Math.min(14400,Pt),qt=Math.min(14400,qt)),c=[Pt,qt],t.substr(0,1)){case"l":qt>Pt&&(c=[qt,Pt]);break;case"p":Pt>qt&&(c=[qt,Pt])}Sa(c),ts(ja),it(To),Bo!==0&&it(Bo+" J"),Al!==0&&it(Al+" j"),ct.publish("addPage",{pageNumber:Ie})},hl=function(H){H>0&&H<=Ie&&(tn.splice(H,1),Ye.splice(H,1),Ie--,Me>Ie&&(Me=Ie),this.setPage(Me))},Ea=function(H){H>0&&H<=Ie&&(Me=H)},Ro=M.__private__.getNumberOfPages=M.getNumberOfPages=function(){return tn.length-1},pn=function(H,Le,pt){var Pt,qt=void 0;return pt=pt||{},H=H!==void 0?H:pr[wr].fontName,Le=Le!==void 0?Le:pr[wr].fontStyle,Pt=H.toLowerCase(),Jr[Pt]!==void 0&&Jr[Pt][Le]!==void 0?qt=Jr[Pt][Le]:Jr[H]!==void 0&&Jr[H][Le]!==void 0?qt=Jr[H][Le]:pt.disableWarning===!1&&za.warn("Unable to look up font label for font '"+H+"', '"+Le+"'. Refer to getFontList() for available fonts."),qt||pt.noFallback||(qt=Jr.times[Le])==null&&(qt=Jr.times.normal),qt},ss=M.__private__.putInfo=function(){var H=Cr(),Le=function(Pt){return Pt};for(var pt in I!==null&&(Le=Fr.encryptor(H,0)),it("<<"),it("/Producer ("+Qo(Le("jsPDF "+wi.version))+")"),lr)lr.hasOwnProperty(pt)&&lr[pt]&&it("/"+pt.substr(0,1).toUpperCase()+pt.substr(1)+" ("+Qo(Le(lr[pt]))+")");it("/CreationDate ("+Qo(Le(ke))+")"),it(">>"),it("endobj")},as=M.__private__.putCatalog=function(H){var Le=(H=H||{}).rootDictionaryObjId||ko;switch(Cr(),it("<<"),it("/Type /Catalog"),it("/Pages "+Le+" 0 R"),Yn||(Yn="fullwidth"),Yn){case"fullwidth":it("/OpenAction [3 0 R /FitH null]");break;case"fullheight":it("/OpenAction [3 0 R /FitV null]");break;case"fullpage":it("/OpenAction [3 0 R /Fit]");break;case"original":it("/OpenAction [3 0 R /XYZ null null 1]");break;default:var pt=""+Yn;pt.substr(pt.length-1)==="%"&&(Yn=parseInt(Yn)/100),typeof Yn=="number"&&it("/OpenAction [3 0 R /XYZ null null "+z(Yn)+"]")}switch(tr||(tr="continuous"),tr){case"continuous":it("/PageLayout /OneColumn");break;case"single":it("/PageLayout /SinglePage");break;case"two":case"twoleft":it("/PageLayout /TwoColumnLeft");break;case"tworight":it("/PageLayout /TwoColumnRight")}Wt&&it("/PageMode /"+Wt),ct.publish("putCatalog"),it(">>"),it("endobj")},Qi=M.__private__.putTrailer=function(){it("trailer"),it("<<"),it("/Size "+(et+1)),it("/Root "+et+" 0 R"),it("/Info "+(et-1)+" 0 R"),I!==null&&it("/Encrypt "+Fr.oid+" 0 R"),it("/ID [ <"+Oe+"> <"+Oe+"> ]"),it(">>")},Au=M.__private__.putHeader=function(){it("%PDF-"+se),it("%")},ka=M.__private__.putXRef=function(){var H="0000000000";it("xref"),it("0 "+(et+1)),it("0000000000 65535 f ");for(var Le=1;Le<=et;Le++)typeof mt[Le]=="function"?it((H+mt[Le]()).slice(-10)+" 00000 n "):mt[Le]!==void 0?it((H+mt[Le]).slice(-10)+" 00000 n "):it("0000000000 00000 n ")},Za=M.__private__.buildDocument=function(){var H;et=0,Nt=0,ht=[],mt=[],Jt=[],ko=Ar(),ro=Ar(),zt(ht),ct.publish("buildDocument"),Au(),La(),(function(){ct.publish("putAdditionalObjects");for(var pt=0;pt<Jt.length;pt++){var Pt=Jt[pt];Dr(Pt.objId,!0),it(Pt.content),it("endobj")}ct.publish("postPutAdditionalObjects")})(),H=[],(function(){for(var pt in pr)pr.hasOwnProperty(pt)&&(O===!1||O===!0&&V.hasOwnProperty(pt))&&zl(pr[pt])})(),(function(){var pt;for(pt in ii)ii.hasOwnProperty(pt)&&Hc(ii[pt])})(),(function(){for(var pt in Rt)Rt.hasOwnProperty(pt)&&jl(Rt[pt])})(),(function(pt){var Pt;for(Pt in Sr)Sr.hasOwnProperty(Pt)&&(Sr[Pt]instanceof Rm?Fi(Sr[Pt]):Sr[Pt]instanceof $g&&nc(Sr[Pt],pt))})(H),ct.publish("putResources"),H.forEach(Oi),Oi({resourcesOid:ro,objectOid:Number.MAX_SAFE_INTEGER}),ct.publish("postPutResources"),I!==null&&(Fr.oid=Cr(),it("<<"),it("/Filter /Standard"),it("/V "+Fr.v),it("/R "+Fr.r),it("/U <"+Fr.toHexString(Fr.U)+">"),it("/O <"+Fr.toHexString(Fr.O)+">"),it("/P "+Fr.P),it(">>"),it("endobj")),ss(),as();var Le=Nt;return ka(),Qi(),it("startxref"),it(""+Le),it("%%EOF"),zt(tn[Me]),ht.join(`
`)},ls=M.__private__.getBlob=function(H){return new Blob([xr(H)],{type:"application/pdf"})},Us=M.output=M.__private__.output=(qr=function(H,Le){switch(typeof(Le=Le||{})=="string"?Le={filename:Le}:Le.filename=Le.filename||"generated.pdf",H){case void 0:return Za();case"save":M.save(Le.filename);break;case"arraybuffer":return xr(Za());case"blob":return ls(Za());case"bloburi":case"bloburl":if(ao.URL!==void 0&&typeof ao.URL.createObjectURL=="function")return ao.URL&&ao.URL.createObjectURL(ls(Za()))||void 0;za.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var pt="",Pt=Za();try{pt=nS(Pt)}catch{pt=nS(unescape(encodeURIComponent(Pt)))}return"data:application/pdf;filename="+Le.filename+";base64,"+pt;case"pdfobjectnewwindow":if(Object.prototype.toString.call(ao)==="[object Window]"){var qt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",on=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Le.pdfObjectUrl&&(qt=Le.pdfObjectUrl,on="");var Dn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+qt+'"'+on+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Le)+");<\/script></body></html>",Pr=ao.open();return Pr!==null&&Pr.document.write(Dn),Pr}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(ao)==="[object Window]"){var $r='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Le.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Le.filename+'" width="500px" height="400px" /></body></html>',gi=ao.open();if(gi!==null){gi.document.write($r);var xi=this;gi.document.documentElement.querySelector("#pdfViewer").onload=function(){gi.document.title=Le.filename,gi.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(xi.output("bloburl"))}}return gi}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(ao)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var so='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Le)+'"></iframe></body></html>',lo=ao.open();if(lo!==null&&(lo.document.write(so),lo.document.title=Le.filename),lo||typeof safari>"u")return lo;break;case"datauri":case"dataurl":return ao.document.location.href=this.output("datauristring",Le);default:return null}},qr.foo=function(){try{return qr.apply(this,arguments)}catch(pt){var H=pt.stack||"";~H.indexOf(" at ")&&(H=H.split(" at ")[1]);var Le="Error in function "+H.split(`
`)[0].split("<")[0]+": "+pt.message;if(!ao.console)throw new Error(Le);ao.console.error(Le,pt),ao.alert&&alert(Le)}},qr.foo.bar=qr,qr.foo),Qn=function(H){return Array.isArray(Ct)===!0&&Ct.indexOf(H)>-1};switch(i){case"pt":br=1;break;case"mm":br=72/25.4;break;case"cm":br=72/2.54;break;case"in":br=72;break;case"px":br=Qn("px_scaling")==1?.75:96/72;break;case"pc":case"em":br=12;break;case"ex":br=6;break;default:if(typeof i!="number")throw new Error("Invalid unit: "+i);br=i}var Fr=null;xe(),be();var ei=M.__private__.getPageInfo=M.getPageInfo=function(H){if(isNaN(H)||H%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Ye[H].objId,pageNumber:H,pageContext:Ye[H]}},aa=M.__private__.getPageInfoByObjId=function(H){if(isNaN(H)||H%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Le in Ye)if(Ye[Le].objId===H)break;return ei(Le)},fa=M.__private__.getCurrentPageInfo=M.getCurrentPageInfo=function(){return{objId:Ye[Me].objId,pageNumber:Me,pageContext:Ye[Me]}};M.addPage=function(){return Ec.apply(this,arguments),this},M.setPage=function(){return Ea.apply(this,arguments),zt.call(this,tn[Me]),this},M.insertPage=function(H){return this.addPage(),this.movePage(Me,H),this},M.movePage=function(H,Le){var pt,Pt;if(H>Le){pt=tn[H],Pt=Ye[H];for(var qt=H;qt>Le;qt--)tn[qt]=tn[qt-1],Ye[qt]=Ye[qt-1];tn[Le]=pt,Ye[Le]=Pt,this.setPage(Le)}else if(H<Le){pt=tn[H],Pt=Ye[H];for(var on=H;on<Le;on++)tn[on]=tn[on+1],Ye[on]=Ye[on+1];tn[Le]=pt,Ye[Le]=Pt,this.setPage(Le)}return this},M.deletePage=function(){return hl.apply(this,arguments),this},M.__private__.text=M.text=function(H,Le,pt,Pt,qt){var on,Dn,Pr,$r,gi,xi,so,lo,_s,eo=(Pt=Pt||{}).scope||this;if(typeof H=="number"&&typeof Le=="number"&&(typeof pt=="string"||Array.isArray(pt))){var $o=pt;pt=Le,Le=H,H=$o}if(arguments[3]instanceof Mt==0?(Pr=arguments[4],$r=arguments[5],ba(so=arguments[3])==="object"&&so!==null||(typeof Pr=="string"&&($r=Pr,Pr=null),typeof so=="string"&&($r=so,so=null),typeof so=="number"&&(Pr=so,so=null),Pt={flags:so,angle:Pr,align:$r})):(D("The transform parameter of text() with a Matrix value"),_s=qt),isNaN(Le)||isNaN(pt)||H==null)throw new Error("Invalid arguments passed to jsPDF.text");if(H.length===0)return eo;var Go,ds="",zo=typeof Pt.lineHeightFactor=="number"?Pt.lineHeightFactor:Ps,Ms=eo.internal.scaleFactor;function Ja(Li){return Li=Li.split("	").join(Array(Pt.TabLen||9).join(" ")),Qo(Li,so)}function Hs(Li){for(var Io,yr=Li.concat(),la=[],oc=yr.length;oc--;)typeof(Io=yr.shift())=="string"?la.push(Io):Array.isArray(Li)&&(Io.length===1||Io[1]===void 0&&Io[2]===void 0)?la.push(Io[0]):la.push([Io[0],Io[1],Io[2]]);return la}function L(Li,Io){var yr;if(typeof Li=="string")yr=Io(Li)[0];else if(Array.isArray(Li)){for(var la,oc,sc=Li.concat(),Il=[],hu=sc.length;hu--;)typeof(la=sc.shift())=="string"?Il.push(Io(la)[0]):Array.isArray(la)&&typeof la[0]=="string"&&(oc=Io(la[0],la[1],la[2]),Il.push([oc[0],oc[1],oc[2]]));yr=Il}return yr}var re=!1,_e=!0;if(typeof H=="string")re=!0;else if(Array.isArray(H)){var $e=H.concat();Dn=[];for(var Xt,nn=$e.length;nn--;)(typeof(Xt=$e.shift())!="string"||Array.isArray(Xt)&&typeof Xt[0]!="string")&&(_e=!1);re=_e}if(re===!1)throw new Error('Type of text must be string or Array. "'+H+'" is not recognized.');typeof H=="string"&&(H=H.match(/[\r?\n]/)?H.split(/\r\n|\r|\n/g):[H]);var Un=Tn/eo.internal.scaleFactor,mo=Un*(zo-1);switch(Pt.baseline){case"bottom":pt-=mo;break;case"top":pt+=Un-mo;break;case"hanging":pt+=Un-2*mo;break;case"middle":pt+=Un/2-mo}if((xi=Pt.maxWidth||0)>0&&(typeof H=="string"?H=eo.splitTextToSize(H,xi):Object.prototype.toString.call(H)==="[object Array]"&&(H=H.reduce(function(Li,Io){return Li.concat(eo.splitTextToSize(Io,xi))},[]))),on={text:H,x:Le,y:pt,options:Pt,mutex:{pdfEscape:Qo,activeFontKey:wr,fonts:pr,activeFontSize:Tn}},ct.publish("preProcessText",on),H=on.text,Pr=(Pt=on.options).angle,_s instanceof Mt==0&&Pr&&typeof Pr=="number"){Pr*=Math.PI/180,Pt.rotationDirection===0&&(Pr=-Pr),he===ye&&(Pr=-Pr);var jo=Math.cos(Pr),Hi=Math.sin(Pr);_s=new Mt(jo,Hi,-Hi,jo,0,0)}else Pr&&Pr instanceof Mt&&(_s=Pr);he!==ye||_s||(_s=Bn),(gi=Pt.charSpace||Vo)!==void 0&&(ds+=j(Z(gi))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(lo=Pt.horizontalScale)!==void 0&&(ds+=j(100*lo)+` Tz
`),Pt.lang;var Qr=-1,xo=Pt.renderingMode!==void 0?Pt.renderingMode:Pt.stroke,fs=eo.internal.getCurrentPageInfo().pageContext;switch(xo){case 0:case!1:case"fill":Qr=0;break;case 1:case!0:case"stroke":Qr=1;break;case 2:case"fillThenStroke":Qr=2;break;case 3:case"invisible":Qr=3;break;case 4:case"fillAndAddForClipping":Qr=4;break;case 5:case"strokeAndAddPathForClipping":Qr=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Qr=6;break;case 7:case"addToPathForClipping":Qr=7}var pa=fs.usedRenderingMode!==void 0?fs.usedRenderingMode:-1;Qr!==-1?ds+=Qr+` Tr
`:pa!==-1&&(ds+=`0 Tr
`),Qr!==-1&&(fs.usedRenderingMode=Qr),$r=Pt.align||"left";var Rs,Tl=Tn*zo,Ua=eo.internal.pageSize.getWidth(),Xc=pr[wr];gi=Pt.charSpace||Vo,xi=Pt.maxWidth||0,so=Object.assign({autoencode:!0,noBOM:!0},Pt.flags);var ml=[],Qa=function(Li){return eo.getStringUnitWidth(Li,{font:Xc,charSpace:gi,fontSize:Tn,doKerning:!1})*Tn/Ms};if(Object.prototype.toString.call(H)==="[object Array]"){var ma;Dn=Hs(H),$r!=="left"&&(Rs=Dn.map(Qa));var Xs,Kc=0;if($r==="right"){Le-=Rs[0],H=[],nn=Dn.length;for(var Uo=0;Uo<nn;Uo++)Uo===0?(Xs=Ao(Le),ma=Vs(pt)):(Xs=Z(Kc-Rs[Uo]),ma=-Tl),H.push([Dn[Uo],Xs,ma]),Kc=Rs[Uo]}else if($r==="center"){Le-=Rs[0]/2,H=[],nn=Dn.length;for(var au=0;au<nn;au++)au===0?(Xs=Ao(Le),ma=Vs(pt)):(Xs=Z((Kc-Rs[au])/2),ma=-Tl),H.push([Dn[au],Xs,ma]),Kc=Rs[au]}else if($r==="left"){H=[],nn=Dn.length;for(var el=0;el<nn;el++)H.push(Dn[el])}else if($r==="justify"&&Xc.encoding==="Identity-H"){H=[],nn=Dn.length,xi=xi!==0?xi:Ua;for(var tl=0,Ks=0;Ks<nn;Ks++)if(ma=Ks===0?Vs(pt):-Tl,Xs=Ks===0?Ao(Le):tl,Ks<nn-1){var Ic=Z((xi-Rs[Ks])/(Dn[Ks].split(" ").length-1)),Cc=Dn[Ks].split(" ");H.push([Cc[0]+" ",Xs,ma]),tl=0;for(var ql=1;ql<Cc.length;ql++){var Zc=(Qa(Cc[ql-1]+" "+Cc[ql])-Qa(Cc[ql]))*Ms+Ic;ql==Cc.length-1?H.push([Cc[ql],Zc,0]):H.push([Cc[ql]+" ",Zc,0]),tl-=Zc}}else H.push([Dn[Ks],Xs,ma]);H.push(["",tl,0])}else{if($r!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(H=[],nn=Dn.length,xi=xi!==0?xi:Ua,Ks=0;Ks<nn;Ks++){ma=Ks===0?Vs(pt):-Tl,Xs=Ks===0?Ao(Le):0;var lu=Dn[Ks].split(" ").length-1,Yc=lu>0?(xi-Rs[Ks])/lu:0;Ks<nn-1?ml.push(j(Z(Yc))):ml.push(0),H.push([Dn[Ks],Xs,ma])}}}(typeof Pt.R2L=="boolean"?Pt.R2L:hr)===!0&&(H=L(H,function(Li,Io,yr){return[Li.split("").reverse().join(""),Io,yr]})),on={text:H,x:Le,y:pt,options:Pt,mutex:{pdfEscape:Qo,activeFontKey:wr,fonts:pr,activeFontSize:Tn}},ct.publish("postProcessText",on),H=on.text,Go=on.mutex.isHex||!1;var cu=pr[wr].encoding;cu!=="WinAnsiEncoding"&&cu!=="StandardEncoding"||(H=L(H,function(Li,Io,yr){return[Ja(Li),Io,yr]})),Dn=Hs(H),H=[];for(var Lc,Jc,uu,Qc=Array.isArray(Dn[0])?1:0,$l="",Gl=function(Li,Io,yr){var la="";return yr instanceof Mt?(yr=typeof Pt.angle=="number"?vn(yr,new Mt(1,0,0,1,Li,Io)):vn(new Mt(1,0,0,1,Li,Io),yr),he===ye&&(yr=vn(new Mt(1,0,0,-1,0,0),yr)),la=yr.join(" ")+` Tm
`):la=j(Li)+" "+j(Io)+` Td
`,la},ns=0;ns<Dn.length;ns++){switch($l="",Qc){case 1:uu=(Go?"<":"(")+Dn[ns][0]+(Go?">":")"),Lc=parseFloat(Dn[ns][1]),Jc=parseFloat(Dn[ns][2]);break;case 0:uu=(Go?"<":"(")+Dn[ns]+(Go?">":")"),Lc=Ao(Le),Jc=Vs(pt)}ml!==void 0&&ml[ns]!==void 0&&($l=ml[ns]+` Tw
`),ns===0?H.push($l+Gl(Lc,Jc,_s)+uu):Qc===0?H.push($l+uu):Qc===1&&H.push($l+Gl(Lc,Jc,_s)+uu)}H=Qc===0?H.join(` Tj
T* `):H.join(` Tj
`),H+=` Tj
`;var Ts=`BT
/`;return Ts+=wr+" "+Tn+` Tf
`,Ts+=j(Tn*zo)+` TL
`,Ts+=Ss+`
`,Ts+=ds,Ts+=H,it(Ts+="ET"),V[wr]=!0,eo};var vi=M.__private__.clip=M.clip=function(H){return it(H==="evenodd"?"W*":"W"),this};M.clipEvenOdd=function(){return vi("evenodd")},M.__private__.discardPath=M.discardPath=function(){return it("n"),this};var Lr=M.__private__.isValidStyle=function(H){var Le=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(H)!==-1&&(Le=!0),Le};M.__private__.setDefaultPathOperation=M.setDefaultPathOperation=function(H){return Lr(H)&&(w=H),this};var dl=M.__private__.getStyle=M.getStyle=function(H){var Le=w;switch(H){case"D":case"S":Le="S";break;case"F":Le="f";break;case"FD":case"DF":Le="B";break;case"f":case"f*":case"B":case"B*":Le=H}return Le},zi=M.close=function(){return it("h"),this};M.stroke=function(){return it("S"),this},M.fill=function(H){return es("f",H),this},M.fillEvenOdd=function(H){return es("f*",H),this},M.fillStroke=function(H){return es("B",H),this},M.fillStrokeEvenOdd=function(H){return es("B*",H),this};var es=function(H,Le){ba(Le)==="object"?Sl(Le,H):it(H)},_o=function(H){H===null||he===ye&&H===void 0||(H=dl(H),it(H))};function Tu(H,Le,pt,Pt,qt){var on=new $g(Le||this.boundingBox,pt||this.xStep,Pt||this.yStep,this.gState,qt||this.matrix);on.stream=this.stream;var Dn=H+"$$"+this.cloneIndex+++"$$";return Ln(Dn,on),on}var Sl=function(H,Le){var pt=ui[H.key],Pt=Sr[pt];if(Pt instanceof Rm)it("q"),it(Ac(Le)),Pt.gState&&M.setGState(Pt.gState),it(H.matrix.toString()+" cm"),it("/"+pt+" sh"),it("Q");else if(Pt instanceof $g){var qt=new Mt(1,0,0,-1,0,Ws());H.matrix&&(qt=qt.multiply(H.matrix||Bn),pt=Tu.call(Pt,H.key,H.boundingBox,H.xStep,H.yStep,qt).id),it("q"),it("/Pattern cs"),it("/"+pt+" scn"),Pt.gState&&M.setGState(Pt.gState),it(Le),it("Q")}},Ac=function(H){switch(H){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},rc=M.moveTo=function(H,Le){return it(j(Z(H))+" "+j(Ee(Le))+" m"),this},El=M.lineTo=function(H,Le){return it(j(Z(H))+" "+j(Ee(Le))+" l"),this},Mo=M.curveTo=function(H,Le,pt,Pt,qt,on){return it([j(Z(H)),j(Ee(Le)),j(Z(pt)),j(Ee(Pt)),j(Z(qt)),j(Ee(on)),"c"].join(" ")),this};M.__private__.line=M.line=function(H,Le,pt,Pt,qt){if(isNaN(H)||isNaN(Le)||isNaN(pt)||isNaN(Pt)||!Lr(qt))throw new Error("Invalid arguments passed to jsPDF.line");return he===oe?this.lines([[pt-H,Pt-Le]],H,Le,[1,1],qt||"S"):this.lines([[pt-H,Pt-Le]],H,Le,[1,1]).stroke()},M.__private__.lines=M.lines=function(H,Le,pt,Pt,qt,on){var Dn,Pr,$r,gi,xi,so,lo,_s,eo,$o,Go,ds;if(typeof H=="number"&&(ds=pt,pt=Le,Le=H,H=ds),Pt=Pt||[1,1],on=on||!1,isNaN(Le)||isNaN(pt)||!Array.isArray(H)||!Array.isArray(Pt)||!Lr(qt)||typeof on!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(rc(Le,pt),Dn=Pt[0],Pr=Pt[1],gi=H.length,$o=Le,Go=pt,$r=0;$r<gi;$r++)(xi=H[$r]).length===2?($o=xi[0]*Dn+$o,Go=xi[1]*Pr+Go,El($o,Go)):(so=xi[0]*Dn+$o,lo=xi[1]*Pr+Go,_s=xi[2]*Dn+$o,eo=xi[3]*Pr+Go,$o=xi[4]*Dn+$o,Go=xi[5]*Pr+Go,Mo(so,lo,_s,eo,$o,Go));return on&&zi(),_o(qt),this},M.path=function(H){for(var Le=0;Le<H.length;Le++){var pt=H[Le],Pt=pt.c;switch(pt.op){case"m":rc(Pt[0],Pt[1]);break;case"l":El(Pt[0],Pt[1]);break;case"c":Mo.apply(this,Pt);break;case"h":zi()}}return this},M.__private__.rect=M.rect=function(H,Le,pt,Pt,qt){if(isNaN(H)||isNaN(Le)||isNaN(pt)||isNaN(Pt)||!Lr(qt))throw new Error("Invalid arguments passed to jsPDF.rect");return he===oe&&(Pt=-Pt),it([j(Z(H)),j(Ee(Le)),j(Z(pt)),j(Z(Pt)),"re"].join(" ")),_o(qt),this},M.__private__.triangle=M.triangle=function(H,Le,pt,Pt,qt,on,Dn){if(isNaN(H)||isNaN(Le)||isNaN(pt)||isNaN(Pt)||isNaN(qt)||isNaN(on)||!Lr(Dn))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[pt-H,Pt-Le],[qt-pt,on-Pt],[H-qt,Le-on]],H,Le,[1,1],Dn,!0),this},M.__private__.roundedRect=M.roundedRect=function(H,Le,pt,Pt,qt,on,Dn){if(isNaN(H)||isNaN(Le)||isNaN(pt)||isNaN(Pt)||isNaN(qt)||isNaN(on)||!Lr(Dn))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Pr=4/3*(Math.SQRT2-1);return qt=Math.min(qt,.5*pt),on=Math.min(on,.5*Pt),this.lines([[pt-2*qt,0],[qt*Pr,0,qt,on-on*Pr,qt,on],[0,Pt-2*on],[0,on*Pr,-qt*Pr,on,-qt,on],[2*qt-pt,0],[-qt*Pr,0,-qt,-on*Pr,-qt,-on],[0,2*on-Pt],[0,-on*Pr,qt*Pr,-on,qt,-on]],H+qt,Le,[1,1],Dn,!0),this},M.__private__.ellipse=M.ellipse=function(H,Le,pt,Pt,qt){if(isNaN(H)||isNaN(Le)||isNaN(pt)||isNaN(Pt)||!Lr(qt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var on=4/3*(Math.SQRT2-1)*pt,Dn=4/3*(Math.SQRT2-1)*Pt;return rc(H+pt,Le),Mo(H+pt,Le-Dn,H+on,Le-Pt,H,Le-Pt),Mo(H-on,Le-Pt,H-pt,Le-Dn,H-pt,Le),Mo(H-pt,Le+Dn,H-on,Le+Pt,H,Le+Pt),Mo(H+on,Le+Pt,H+pt,Le+Dn,H+pt,Le),_o(qt),this},M.__private__.circle=M.circle=function(H,Le,pt,Pt){if(isNaN(H)||isNaN(Le)||isNaN(pt)||!Lr(Pt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(H,Le,pt,pt,Pt)},M.setFont=function(H,Le,pt){return pt&&(Le=de(Le,pt)),wr=pn(H,Le,{disableWarning:!1}),this};var ys=M.__private__.getFont=M.getFont=function(){return pr[pn.apply(M,arguments)]};M.__private__.getFontList=M.getFontList=function(){var H,Le,pt={};for(H in Jr)if(Jr.hasOwnProperty(H))for(Le in pt[H]=[],Jr[H])Jr[H].hasOwnProperty(Le)&&pt[H].push(Le);return pt},M.addFont=function(H,Le,pt,Pt,qt){var on=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&on.indexOf(arguments[3])!==-1?qt=arguments[3]:arguments[3]&&on.indexOf(arguments[3])==-1&&(pt=de(pt,Pt)),Pa.call(this,H,Le,pt,qt=qt||"Identity-H")};var Ps,ja=n.lineWidth||.200025,oi=M.__private__.getLineWidth=M.getLineWidth=function(){return ja},ts=M.__private__.setLineWidth=M.setLineWidth=function(H){return ja=H,it(j(Z(H))+" w"),this};M.__private__.setLineDash=wi.API.setLineDash=wi.API.setLineDashPattern=function(H,Le){if(H=H||[],Le=Le||0,isNaN(Le)||!Array.isArray(H))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return H=H.map(function(pt){return j(Z(pt))}).join(" "),Le=j(Z(Le)),it("["+H+"] "+Le+" d"),this};var No=M.__private__.getLineHeight=M.getLineHeight=function(){return Tn*Ps};M.__private__.getLineHeight=M.getLineHeight=function(){return Tn*Ps};var Xu=M.__private__.setLineHeightFactor=M.setLineHeightFactor=function(H){return typeof(H=H||1.15)=="number"&&(Ps=H),this},Ul=M.__private__.getLineHeightFactor=M.getLineHeightFactor=function(){return Ps};Xu(n.lineHeight);var Ao=M.__private__.getHorizontalCoordinate=function(H){return Z(H)},Vs=M.__private__.getVerticalCoordinate=function(H){return he===ye?H:Ye[Me].mediaBox.topRightY-Ye[Me].mediaBox.bottomLeftY-Z(H)},Ku=M.__private__.getHorizontalCoordinateString=M.getHorizontalCoordinateString=function(H){return j(Ao(H))},fl=M.__private__.getVerticalCoordinateString=M.getVerticalCoordinateString=function(H){return j(Vs(H))},To=n.strokeColor||"0 G";M.__private__.getStrokeColor=M.getDrawColor=function(){return os(To)},M.__private__.setStrokeColor=M.setDrawColor=function(H,Le,pt,Pt){return To=Ji({ch1:H,ch2:Le,ch3:pt,ch4:Pt,pdfColorType:"draw",precision:2}),it(To),this};var vo=n.fillColor||"0 g";M.__private__.getFillColor=M.getFillColor=function(){return os(vo)},M.__private__.setFillColor=M.setFillColor=function(H,Le,pt,Pt){return vo=Ji({ch1:H,ch2:Le,ch3:pt,ch4:Pt,pdfColorType:"fill",precision:2}),it(vo),this};var Ss=n.textColor||"0 g",Oo=M.__private__.getTextColor=M.getTextColor=function(){return os(Ss)};M.__private__.setTextColor=M.setTextColor=function(H,Le,pt,Pt){return Ss=Ji({ch1:H,ch2:Le,ch3:pt,ch4:Pt,pdfColorType:"text",precision:3}),this};var Vo=n.charSpace,Tc=M.__private__.getCharSpace=M.getCharSpace=function(){return parseFloat(Vo||0)};M.__private__.setCharSpace=M.setCharSpace=function(H){if(isNaN(H))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Vo=H,this};var Bo=0;M.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},M.__private__.setLineCap=M.setLineCap=function(H){var Le=M.CapJoinStyles[H];if(Le===void 0)throw new Error("Line cap style of '"+H+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Bo=Le,it(Le+" J"),this};var Al=0;M.__private__.setLineJoin=M.setLineJoin=function(H){var Le=M.CapJoinStyles[H];if(Le===void 0)throw new Error("Line join style of '"+H+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Al=Le,it(Le+" j"),this},M.__private__.setLineMiterLimit=M.__private__.setMiterLimit=M.setLineMiterLimit=M.setMiterLimit=function(H){if(H=H||0,isNaN(H))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return it(j(Z(H))+" M"),this},M.GState=nv,M.setGState=function(H){(H=typeof H=="string"?ii[ut[H]]:Ma(null,H)).equals(we)||(it("/"+H.id+" gs"),we=H)};var Ma=function(H,Le){if(!H||!ut[H]){var pt=!1;for(var Pt in ii)if(ii.hasOwnProperty(Pt)&&ii[Pt].equals(Le)){pt=!0;break}if(pt)Le=ii[Pt];else{var qt="GS"+(Object.keys(ii).length+1).toString(10);ii[qt]=Le,Le.id=qt}return H&&(ut[H]=Le.id),ct.publish("addGState",Le),Le}};M.addGState=function(H,Le){return Ma(H,Le),this},M.saveGraphicsState=function(){return it("q"),Kr.push({key:wr,size:Tn,color:Ss}),this},M.restoreGraphicsState=function(){it("Q");var H=Kr.pop();return wr=H.key,Tn=H.size,Ss=H.color,we=null,this},M.setCurrentTransformationMatrix=function(H){return it(H.toString()+" cm"),this},M.comment=function(H){return it("#"+H),this};var pl=function(H,Le){var pt=H||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return pt},set:function(on){isNaN(on)||(pt=parseFloat(on))}});var Pt=Le||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Pt},set:function(on){isNaN(on)||(Pt=parseFloat(on))}});var qt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return qt},set:function(on){qt=on.toString()}}),this},ic=function(H,Le,pt,Pt){pl.call(this,H,Le),this.type="rect";var qt=pt||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return qt},set:function(Dn){isNaN(Dn)||(qt=parseFloat(Dn))}});var on=Pt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return on},set:function(Dn){isNaN(Dn)||(on=parseFloat(Dn))}}),this},qs=function(){this.page=Ie,this.currentPage=Me,this.pages=tn.slice(0),this.pagesContext=Ye.slice(0),this.x=Ir,this.y=Bi,this.matrix=Mi,this.width=Gs(Me),this.height=Es(Me),this.outputDestination=An,this.id="",this.objectNumber=-1};qs.prototype.restore=function(){Ie=this.page,Me=this.currentPage,Ye=this.pagesContext,tn=this.pages,Ir=this.x,Bi=this.y,Mi=this.matrix,qo(Me,this.width),As(Me,this.height),An=this.outputDestination};var $s=function(H,Le,pt,Pt,qt){St.push(new qs),Ie=Me=0,tn=[],Ir=H,Bi=Le,Mi=qt,Sa([pt,Pt])};for(var si in M.beginFormObject=function(H,Le,pt,Pt,qt){return $s(H,Le,pt,Pt,qt),this},M.endFormObject=function(H){return(function(Le){if(Bt[Le])St.pop().restore();else{var pt=new qs,Pt="Xo"+(Object.keys(Rt).length+1).toString(10);pt.id=Pt,Bt[Le]=Pt,Rt[Pt]=pt,ct.publish("addFormObject",pt),St.pop().restore()}})(H),this},M.doFormObject=function(H,Le){var pt=Rt[Bt[H]];return it("q"),it(Le.toString()+" cm"),it("/"+pt.id+" Do"),it("Q"),this},M.getFormObject=function(H){var Le=Rt[Bt[H]];return{x:Le.x,y:Le.y,width:Le.width,height:Le.height,matrix:Le.matrix}},M.save=function(H,Le){return H=H||"generated.pdf",(Le=Le||{}).returnPromise=Le.returnPromise||!1,Le.returnPromise===!1?(Lm(ls(Za()),H),typeof Lm.unload=="function"&&ao.setTimeout&&setTimeout(Lm.unload,911),this):new Promise(function(pt,Pt){try{var qt=Lm(ls(Za()),H);typeof Lm.unload=="function"&&ao.setTimeout&&setTimeout(Lm.unload,911),pt(qt)}catch(on){Pt(on.message)}})},wi.API)wi.API.hasOwnProperty(si)&&(si==="events"&&wi.API.events.length?(function(H,Le){var pt,Pt,qt;for(qt=Le.length-1;qt!==-1;qt--)pt=Le[qt][0],Pt=Le[qt][1],H.subscribe.apply(H,[pt].concat(typeof Pt=="function"?[Pt]:Pt))})(ct,wi.API.events):M[si]=wi.API[si]);function Gs(H){return Ye[H].mediaBox.topRightX-Ye[H].mediaBox.bottomLeftX}function qo(H,Le){Ye[H].mediaBox.topRightX=Le+Ye[H].mediaBox.bottomLeftX}function Es(H){return Ye[H].mediaBox.topRightY-Ye[H].mediaBox.bottomLeftY}function As(H,Le){Ye[H].mediaBox.topRightY=Le+Ye[H].mediaBox.bottomLeftY}var Ya=M.getPageWidth=function(H){return Gs(H=H||Me)/br},ks=M.setPageWidth=function(H,Le){qo(H,Le*br)},Ws=M.getPageHeight=function(H){return Es(H=H||Me)/br},Vl=M.setPageHeight=function(H,Le){As(H,Le*br)};return M.internal={pdfEscape:Qo,getStyle:dl,getFont:ys,getFontSize:$n,getCharSpace:Tc,getTextColor:Oo,getLineHeight:No,getLineHeightFactor:Ul,getLineWidth:oi,write:ur,getHorizontalCoordinate:Ao,getVerticalCoordinate:Vs,getCoordinateString:Ku,getVerticalCoordinateString:fl,collections:{},newObject:Cr,newAdditionalObject:_i,newObjectDeferred:Ar,newObjectDeferredBegin:Dr,getFilters:Yo,putStream:oo,events:ct,scaleFactor:br,pageSize:{getWidth:function(){return Ya(Me)},setWidth:function(H){ks(Me,H)},getHeight:function(){return Ws(Me)},setHeight:function(H){Vl(Me,H)}},encryptionOptions:I,encryption:Fr,getEncryptor:function(H){return I!==null?Fr.encryptor(H,0):function(Le){return Le}},output:Us,getNumberOfPages:Ro,pages:tn,out:it,f2:z,f3:W,getPageInfo:ei,getPageInfoByObjId:aa,getCurrentPageInfo:fa,getPDFVersion:ce,Point:pl,Rectangle:ic,Matrix:Mt,hasHotfix:Qn},Object.defineProperty(M.internal.pageSize,"width",{get:function(){return Ya(Me)},set:function(H){ks(Me,H)},enumerable:!0,configurable:!0}),Object.defineProperty(M.internal.pageSize,"height",{get:function(){return Ws(Me)},set:function(H){Vl(Me,H)},enumerable:!0,configurable:!0}),(function(H){for(var Le=0,pt=Tr.length;Le<pt;Le++){var Pt=Pa.call(this,H[Le][0],H[Le][1],H[Le][2],Tr[Le][3],!0);O===!1&&(V[Pt]=!0);var qt=H[Le][0].split("-");Sc({id:Pt,fontName:qt[0],fontStyle:qt[1]||""})}ct.publish("addFonts",{fonts:pr,dictionary:Jr})}).call(M,Tr),wr="F1",Ec(c,t),ct.publish("initialized"),M}Og.prototype.lsbFirstWord=function(n){return String.fromCharCode(255&n,n>>8&255,n>>16&255,n>>24&255)},Og.prototype.toHexString=function(n){return n.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Og.prototype.hexToBytes=function(n){for(var e=[],t=0;t<n.length;t+=2)e.push(String.fromCharCode(parseInt(n.substr(t,2),16)));return e.join("")},Og.prototype.processOwnerPassword=function(n,e){return s5(o5(e).substr(0,5),n)},Og.prototype.encryptor=function(n,e){var t=o5(this.encryptionKey+String.fromCharCode(255&n,n>>8&255,n>>16&255,255&e,e>>8&255)).substr(0,10);return function(i){return s5(t,i)}},nv.prototype.equals=function(n){var e,t="id,objectNumber,equals";if(!n||ba(n)!==ba(this))return!1;var i=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!n.hasOwnProperty(e)||this[e]!==n[e])return!1;i++}for(e in n)n.hasOwnProperty(e)&&t.indexOf(e)<0&&i--;return i===0},wi.API={events:[]},wi.version="3.0.3";var Ql=wi.API,iw=1,Jm=function(n){return n.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Pg=function(n){return n.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},wo=function(n){return n.toFixed(2)},Dp=function(n){return n.toFixed(5)};Ql.__acroform__={};var Uh=function(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n},sS=function(n){return n*iw},gf=function(n){var e=new n6,t=pi.internal.getHeight(n)||0,i=pi.internal.getWidth(n)||0;return e.BBox=[0,0,Number(wo(i)),Number(wo(t))],e},Zk=Ql.__acroform__.setBit=function(n,e){if(n=n||0,e=e||0,isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return n|1<<e},Yk=Ql.__acroform__.clearBit=function(n,e){if(n=n||0,e=e||0,isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return n&~(1<<e)},Jk=Ql.__acroform__.getBit=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return n&1<<e?1:0},xc=Ql.__acroform__.getBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Jk(n,e-1)},bc=Ql.__acroform__.setBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Zk(n,e-1)},wc=Ql.__acroform__.clearBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Yk(n,e-1)},Qk=Ql.__acroform__.calculateCoordinates=function(n,e){var t=e.internal.getHorizontalCoordinate,i=e.internal.getVerticalCoordinate,c=n[0],u=n[1],m=n[2],_=n[3],o={};return o.lowerLeft_X=t(c)||0,o.lowerLeft_Y=i(u+_)||0,o.upperRight_X=t(c+m)||0,o.upperRight_Y=i(u)||0,[Number(wo(o.lowerLeft_X)),Number(wo(o.lowerLeft_Y)),Number(wo(o.upperRight_X)),Number(wo(o.upperRight_Y))]},eM=function(n){if(n.appearanceStreamContent)return n.appearanceStreamContent;if(n.V||n.DV){var e=[],t=n._V||n.DV,i=a5(n,t),c=n.scope.internal.getFont(n.fontName,n.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(n.scope.__private__.encodeColorString(n.color)),e.push("/"+c+" "+wo(i.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(i.text),e.push("ET"),e.push("Q"),e.push("EMC");var u=gf(n);return u.scope=n.scope,u.stream=e.join(`
`),u}},a5=function(n,e){var t=n.fontSize===0?n.maxFontSize:n.fontSize,i={text:"",fontSize:""},c=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");c=n.multiline?c.map(function(z){return z.split(`
`)}):c.map(function(z){return[z]});var u=t,m=pi.internal.getHeight(n)||0;m=m<0?-m:m;var _=pi.internal.getWidth(n)||0;_=_<0?-_:_;var o=function(z,W,Z){if(z+1<c.length){var Ee=W+" "+c[z+1][0];return i1(Ee,n,Z).width<=_-4}return!1};u++;e:for(;u>0;){e="",u--;var w,I,O=i1("3",n,u).height,V=n.multiline?m-u:(m-O)/2,M=V+=2,se=0,ce=0,fe=0;if(u<=0){e=`(...) Tj
`,e+="% Width of Text: "+i1(e,n,u=12).width+", FieldWidth:"+_+`
`;break}for(var ne="",oe=0,ye=0;ye<c.length;ye++)if(c.hasOwnProperty(ye)){var he=!1;if(c[ye].length!==1&&fe!==c[ye].length-1){if((O+2)*(oe+2)+2>m)continue e;ne+=c[ye][fe],he=!0,ce=ye,ye--}else{ne=(ne+=c[ye][fe]+" ").substr(ne.length-1)==" "?ne.substr(0,ne.length-1):ne;var Ne=parseInt(ye),Ve=o(Ne,ne,u),de=ye>=c.length-1;if(Ve&&!de){ne+=" ",fe=0;continue}if(Ve||de){if(de)ce=Ne;else if(n.multiline&&(O+2)*(oe+2)+2>m)continue e}else{if(!n.multiline||(O+2)*(oe+2)+2>m)continue e;ce=Ne}}for(var j="",D=se;D<=ce;D++){var $=c[D];if(n.multiline){if(D===ce){j+=$[fe]+" ",fe=(fe+1)%$.length;continue}if(D===se){j+=$[$.length-1]+" ";continue}}j+=$[0]+" "}switch(j=j.substr(j.length-1)==" "?j.substr(0,j.length-1):j,I=i1(j,n,u).width,n.textAlign){case"right":w=_-I-2;break;case"center":w=(_-I)/2;break;default:w=2}e+=wo(w)+" "+wo(M)+` Td
`,e+="("+Jm(j)+`) Tj
`,e+=-wo(w)+` 0 Td
`,M=-(u+2),I=0,se=he?ce:ce+1,oe++,ne=""}break}return i.text=e,i.fontSize=u,i},i1=function(n,e,t){var i=e.scope.internal.getFont(e.fontName,e.fontStyle),c=e.scope.getStringUnitWidth(n,{font:i,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:i,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:c}},tM={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},nM=function(n,e){var t={type:"reference",object:n};e.internal.getPageInfo(n.page).pageContext.annotations.find(function(i){return i.type===t.type&&i.object===t.object})===void 0&&e.internal.getPageInfo(n.page).pageContext.annotations.push(t)},rM=function(n,e){if(e.scope=n,n.internal!==void 0&&(n.internal.acroformPlugin===void 0||n.internal.acroformPlugin.isInitialized===!1)){if(Yd.FieldNum=0,n.internal.acroformPlugin=JSON.parse(JSON.stringify(tM)),n.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");iw=n.internal.scaleFactor,n.internal.acroformPlugin.acroFormDictionaryRoot=new r6,n.internal.acroformPlugin.acroFormDictionaryRoot.scope=n,n.internal.acroformPlugin.acroFormDictionaryRoot._eventID=n.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(n)}),n.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var i=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var c in i)if(i.hasOwnProperty(c)){var u=i[c];u.objId=void 0,u.hasAnnotation&&nM(u,t)}})(n)}),n.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(n)}),n.internal.events.subscribe("postPutPages",function(t){(function(i,c){var u=!i;for(var m in i||(c.internal.newObjectDeferredBegin(c.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),c.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),i=i||c.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(i.hasOwnProperty(m)){var _=i[m],o=[],w=_.Rect;if(_.Rect&&(_.Rect=Qk(_.Rect,c)),c.internal.newObjectDeferredBegin(_.objId,!0),_.DA=pi.createDefaultAppearanceStream(_),ba(_)==="object"&&typeof _.getKeyValueListForStream=="function"&&(o=_.getKeyValueListForStream()),_.Rect=w,_.hasAppearanceStream&&!_.appearanceStreamContent){var I=eM(_);o.push({key:"AP",value:"<</N "+I+">>"}),c.internal.acroformPlugin.xForms.push(I)}if(_.appearanceStreamContent){var O="";for(var V in _.appearanceStreamContent)if(_.appearanceStreamContent.hasOwnProperty(V)){var M=_.appearanceStreamContent[V];if(O+="/"+V+" ",O+="<<",Object.keys(M).length>=1||Array.isArray(M)){for(var m in M)if(M.hasOwnProperty(m)){var se=M[m];typeof se=="function"&&(se=se.call(c,_)),O+="/"+m+" "+se+" ",c.internal.acroformPlugin.xForms.indexOf(se)>=0||c.internal.acroformPlugin.xForms.push(se)}}else typeof(se=M)=="function"&&(se=se.call(c,_)),O+="/"+m+" "+se,c.internal.acroformPlugin.xForms.indexOf(se)>=0||c.internal.acroformPlugin.xForms.push(se);O+=">>"}o.push({key:"AP",value:`<<
`+O+">>"})}c.internal.putStream({additionalKeyValues:o,objectId:_.objId}),c.internal.out("endobj")}u&&(function(ce,fe){for(var ne in ce)if(ce.hasOwnProperty(ne)){var oe=ne,ye=ce[ne];fe.internal.newObjectDeferredBegin(ye.objId,!0),ba(ye)==="object"&&typeof ye.putStream=="function"&&ye.putStream(),delete ce[oe]}})(c.internal.acroformPlugin.xForms,c)})(t,n)}),n.internal.acroformPlugin.isInitialized=!0}},t6=Ql.__acroform__.arrayToPdfArray=function(n,e,t){var i=function(m){return m};if(Array.isArray(n)){for(var c="[",u=0;u<n.length;u++)switch(u!==0&&(c+=" "),ba(n[u])){case"boolean":case"number":case"object":c+=n[u].toString();break;case"string":n[u].substr(0,1)!=="/"?(e!==void 0&&t&&(i=t.internal.getEncryptor(e)),c+="("+Jm(i(n[u].toString()))+")"):c+=n[u].toString()}return c+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},mb=function(n,e,t){var i=function(c){return c};return e!==void 0&&t&&(i=t.internal.getEncryptor(e)),(n=n||"").toString(),"("+Jm(i(n))+")"},bf=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(n){this._objId=n}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};bf.prototype.toString=function(){return this.objId+" 0 R"},bf.prototype.putStream=function(){var n=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:n,objectId:this.objId}),this.scope.internal.out("endobj")},bf.prototype.getKeyValueListForStream=function(){var n=[],e=Object.getOwnPropertyNames(this).filter(function(u){return u!="content"&&u!="appearanceStreamContent"&&u!="scope"&&u!="objId"&&u.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var i=e[t],c=this[i];c&&(Array.isArray(c)?n.push({key:i,value:t6(c,this.objId,this.scope)}):c instanceof bf?(c.scope=this.scope,n.push({key:i,value:c.objId+" 0 R"})):typeof c!="function"&&n.push({key:i,value:c}))}return n};var n6=function(){bf.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var n,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){n=t.trim()},get:function(){return n||null}})};Uh(n6,bf);var r6=function(){bf.call(this);var n,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(n){var t=function(i){return i};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+Jm(t(n))+")"}},set:function(t){n=t}})};Uh(r6,bf);var Yd=function n(){bf.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(ne){if(isNaN(ne))throw new Error('Invalid value "'+ne+'" for attribute F supplied.');e=ne}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!xc(e,3)},set:function(ne){ne?this.F=bc(e,3):this.F=wc(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(ne){if(isNaN(ne))throw new Error('Invalid value "'+ne+'" for attribute Ff supplied.');t=ne}});var i=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(i.length!==0)return i},set:function(ne){i=ne!==void 0?ne:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[0])?0:i[0]},set:function(ne){i[0]=ne}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[1])?0:i[1]},set:function(ne){i[1]=ne}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[2])?0:i[2]},set:function(ne){i[2]=ne}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[3])?0:i[3]},set:function(ne){i[3]=ne}});var c="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return c},set:function(ne){switch(ne){case"/Btn":case"/Tx":case"/Ch":case"/Sig":c=ne;break;default:throw new Error('Invalid value "'+ne+'" for attribute FT supplied.')}}});var u=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!u||u.length<1){if(this instanceof rv)return;u="FieldObject"+n.FieldNum++}var ne=function(oe){return oe};return this.scope&&(ne=this.scope.internal.getEncryptor(this.objId)),"("+Jm(ne(u))+")"},set:function(ne){u=ne.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return u},set:function(ne){u=ne}});var m="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return m},set:function(ne){m=ne}});var _="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return _},set:function(ne){_=ne}});var o=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return o},set:function(ne){o=ne}});var w=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return w===void 0?50/iw:w},set:function(ne){w=ne}});var I="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return I},set:function(ne){I=ne}});var O="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!O||this instanceof rv||this instanceof Bm))return mb(O,this.objId,this.scope)},set:function(ne){ne=ne.toString(),O=ne}});var V=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(V)return this instanceof Su==0?mb(V,this.objId,this.scope):V},set:function(ne){ne=ne.toString(),V=this instanceof Su==0?ne.substr(0,1)==="("?Pg(ne.substr(1,ne.length-2)):Pg(ne):ne}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Su==1?Pg(V.substr(1,V.length-1)):V},set:function(ne){ne=ne.toString(),V=this instanceof Su==1?"/"+ne:ne}});var M=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(M)return M},set:function(ne){this.V=ne}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(M)return this instanceof Su==0?mb(M,this.objId,this.scope):M},set:function(ne){ne=ne.toString(),M=this instanceof Su==0?ne.substr(0,1)==="("?Pg(ne.substr(1,ne.length-2)):Pg(ne):ne}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Su==1?Pg(M.substr(1,M.length-1)):M},set:function(ne){ne=ne.toString(),M=this instanceof Su==1?"/"+ne:ne}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var se,ce=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return ce},set:function(ne){ne=!!ne,ce=ne}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(se)return se},set:function(ne){se=ne}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,1)},set:function(ne){ne?this.Ff=bc(this.Ff,1):this.Ff=wc(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,2)},set:function(ne){ne?this.Ff=bc(this.Ff,2):this.Ff=wc(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,3)},set:function(ne){ne?this.Ff=bc(this.Ff,3):this.Ff=wc(this.Ff,3)}});var fe=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(fe!==null)return fe},set:function(ne){if([0,1,2].indexOf(ne)===-1)throw new Error('Invalid value "'+ne+'" for attribute Q supplied.');fe=ne}}),Object.defineProperty(this,"textAlign",{get:function(){var ne;switch(fe){case 0:default:ne="left";break;case 1:ne="center";break;case 2:ne="right"}return ne},configurable:!0,enumerable:!0,set:function(ne){switch(ne){case"right":case 2:fe=2;break;case"center":case 1:fe=1;break;default:fe=0}}})};Uh(Yd,bf);var Yg=function(){Yd.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var n=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return n},set:function(t){n=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return t6(e,this.objId,this.scope)},set:function(t){var i,c;c=[],typeof(i=t)=="string"&&(c=(function(u,m,_){_||(_=1);for(var o,w=[];o=m.exec(u);)w.push(o[_]);return w})(i,/\((.*?)\)/g)),e=c}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,i){for(i=i||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),i!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,18)},set:function(t){t?this.Ff=bc(this.Ff,18):this.Ff=wc(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=bc(this.Ff,19):this.Ff=wc(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,20)},set:function(t){t?(this.Ff=bc(this.Ff,20),e.sort()):this.Ff=wc(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,22)},set:function(t){t?this.Ff=bc(this.Ff,22):this.Ff=wc(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,23)},set:function(t){t?this.Ff=bc(this.Ff,23):this.Ff=wc(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,27)},set:function(t){t?this.Ff=bc(this.Ff,27):this.Ff=wc(this.Ff,27)}}),this.hasAppearanceStream=!1};Uh(Yg,Yd);var Jg=function(){Yg.call(this),this.fontName="helvetica",this.combo=!1};Uh(Jg,Yg);var Qg=function(){Jg.call(this),this.combo=!0};Uh(Qg,Jg);var L1=function(){Qg.call(this),this.edit=!0};Uh(L1,Qg);var Su=function(){Yd.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,15)},set:function(t){t?this.Ff=bc(this.Ff,15):this.Ff=wc(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,16)},set:function(t){t?this.Ff=bc(this.Ff,16):this.Ff=wc(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,17)},set:function(t){t?this.Ff=bc(this.Ff,17):this.Ff=wc(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,26)},set:function(t){t?this.Ff=bc(this.Ff,26):this.Ff=wc(this.Ff,26)}});var n,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(u){return u};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var i,c=[];for(i in c.push("<<"),e)c.push("/"+i+" ("+Jm(t(e[i]))+")");return c.push(">>"),c.join(`
`)}},set:function(t){ba(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(t){n="/"+t}})};Uh(Su,Yd);var P1=function(){Su.call(this),this.pushButton=!0};Uh(P1,Su);var e0=function(){Su.call(this),this.radio=!0,this.pushButton=!1;var n=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e!==void 0?e:[]}})};Uh(e0,Su);var rv=function(){var n,e;Yd.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return n},set:function(c){n=c}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(c){e=c}});var t,i={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var c=function(_){return _};this.scope&&(c=this.scope.internal.getEncryptor(this.objId));var u,m=[];for(u in m.push("<<"),i)m.push("/"+u+" ("+Jm(c(i[u]))+")");return m.push(">>"),m.join(`
`)},set:function(c){ba(c)==="object"&&(i=c)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return i.CA||""},set:function(c){typeof c=="string"&&(i.CA=c)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(c){t=c}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(c){t="/"+c}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=pi.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Uh(rv,Yd),e0.prototype.setAppearance=function(n){if(!("createAppearanceStream"in n)||!("getCA"in n))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=n.createAppearanceStream(t.optionName),t.caption=n.getCA()}},e0.prototype.createOption=function(n){var e=new rv;return e.Parent=this,e.optionName=n,this.Kids.push(e),iM.call(this.scope,e),e};var k1=function(){Su.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=pi.CheckBox.createAppearanceStream()};Uh(k1,Su);var Bm=function(){Yd.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,13)},set:function(e){e?this.Ff=bc(this.Ff,13):this.Ff=wc(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,21)},set:function(e){e?this.Ff=bc(this.Ff,21):this.Ff=wc(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,23)},set:function(e){e?this.Ff=bc(this.Ff,23):this.Ff=wc(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,24)},set:function(e){e?this.Ff=bc(this.Ff,24):this.Ff=wc(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,25)},set:function(e){e?this.Ff=bc(this.Ff,25):this.Ff=wc(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,26)},set:function(e){e?this.Ff=bc(this.Ff,26):this.Ff=wc(this.Ff,26)}});var n=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return n},set:function(e){Number.isInteger(e)&&(n=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Uh(Bm,Yd);var M1=function(){Bm.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!xc(this.Ff,14)},set:function(n){n?this.Ff=bc(this.Ff,14):this.Ff=wc(this.Ff,14)}}),this.password=!0};Uh(M1,Bm);var pi={CheckBox:{createAppearanceStream:function(){return{N:{On:pi.CheckBox.YesNormal},D:{On:pi.CheckBox.YesPushDown,Off:pi.CheckBox.OffPushDown}}},YesPushDown:function(n){var e=gf(n);e.scope=n.scope;var t=[],i=n.scope.internal.getFont(n.fontName,n.fontStyle).id,c=n.scope.__private__.encodeColorString(n.color),u=a5(n,n.caption);return t.push("0.749023 g"),t.push("0 0 "+wo(pi.internal.getWidth(n))+" "+wo(pi.internal.getHeight(n))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+i+" "+wo(u.fontSize)+" Tf "+c),t.push("BT"),t.push(u.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(n){var e=gf(n);e.scope=n.scope;var t=n.scope.internal.getFont(n.fontName,n.fontStyle).id,i=n.scope.__private__.encodeColorString(n.color),c=[],u=pi.internal.getHeight(n),m=pi.internal.getWidth(n),_=a5(n,n.caption);return c.push("1 g"),c.push("0 0 "+wo(m)+" "+wo(u)+" re"),c.push("f"),c.push("q"),c.push("0 0 1 rg"),c.push("0 0 "+wo(m-1)+" "+wo(u-1)+" re"),c.push("W"),c.push("n"),c.push("0 g"),c.push("BT"),c.push("/"+t+" "+wo(_.fontSize)+" Tf "+i),c.push(_.text),c.push("ET"),c.push("Q"),e.stream=c.join(`
`),e},OffPushDown:function(n){var e=gf(n);e.scope=n.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+wo(pi.internal.getWidth(n))+" "+wo(pi.internal.getHeight(n))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(n){var e={D:{Off:pi.RadioButton.Circle.OffPushDown},N:{}};return e.N[n]=pi.RadioButton.Circle.YesNormal,e.D[n]=pi.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(n){var e=gf(n);e.scope=n.scope;var t=[],i=pi.internal.getWidth(n)<=pi.internal.getHeight(n)?pi.internal.getWidth(n)/4:pi.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var c=pi.internal.Bezier_C,u=Number((i*c).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+Dp(pi.internal.getWidth(n)/2)+" "+Dp(pi.internal.getHeight(n)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+u+" "+u+" "+i+" 0 "+i+" c"),t.push("-"+u+" "+i+" -"+i+" "+u+" -"+i+" 0 c"),t.push("-"+i+" -"+u+" -"+u+" -"+i+" 0 -"+i+" c"),t.push(u+" -"+i+" "+i+" -"+u+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(n){var e=gf(n);e.scope=n.scope;var t=[],i=pi.internal.getWidth(n)<=pi.internal.getHeight(n)?pi.internal.getWidth(n)/4:pi.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var c=Number((2*i).toFixed(5)),u=Number((c*pi.internal.Bezier_C).toFixed(5)),m=Number((i*pi.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Dp(pi.internal.getWidth(n)/2)+" "+Dp(pi.internal.getHeight(n)/2)+" cm"),t.push(c+" 0 m"),t.push(c+" "+u+" "+u+" "+c+" 0 "+c+" c"),t.push("-"+u+" "+c+" -"+c+" "+u+" -"+c+" 0 c"),t.push("-"+c+" -"+u+" -"+u+" -"+c+" 0 -"+c+" c"),t.push(u+" -"+c+" "+c+" -"+u+" "+c+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+Dp(pi.internal.getWidth(n)/2)+" "+Dp(pi.internal.getHeight(n)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+m+" "+m+" "+i+" 0 "+i+" c"),t.push("-"+m+" "+i+" -"+i+" "+m+" -"+i+" 0 c"),t.push("-"+i+" -"+m+" -"+m+" -"+i+" 0 -"+i+" c"),t.push(m+" -"+i+" "+i+" -"+m+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(n){var e=gf(n);e.scope=n.scope;var t=[],i=pi.internal.getWidth(n)<=pi.internal.getHeight(n)?pi.internal.getWidth(n)/4:pi.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var c=Number((2*i).toFixed(5)),u=Number((c*pi.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Dp(pi.internal.getWidth(n)/2)+" "+Dp(pi.internal.getHeight(n)/2)+" cm"),t.push(c+" 0 m"),t.push(c+" "+u+" "+u+" "+c+" 0 "+c+" c"),t.push("-"+u+" "+c+" -"+c+" "+u+" -"+c+" 0 c"),t.push("-"+c+" -"+u+" -"+u+" -"+c+" 0 -"+c+" c"),t.push(u+" -"+c+" "+c+" -"+u+" "+c+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(n){var e={D:{Off:pi.RadioButton.Cross.OffPushDown},N:{}};return e.N[n]=pi.RadioButton.Cross.YesNormal,e.D[n]=pi.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(n){var e=gf(n);e.scope=n.scope;var t=[],i=pi.internal.calculateCross(n);return t.push("q"),t.push("1 1 "+wo(pi.internal.getWidth(n)-2)+" "+wo(pi.internal.getHeight(n)-2)+" re"),t.push("W"),t.push("n"),t.push(wo(i.x1.x)+" "+wo(i.x1.y)+" m"),t.push(wo(i.x2.x)+" "+wo(i.x2.y)+" l"),t.push(wo(i.x4.x)+" "+wo(i.x4.y)+" m"),t.push(wo(i.x3.x)+" "+wo(i.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(n){var e=gf(n);e.scope=n.scope;var t=pi.internal.calculateCross(n),i=[];return i.push("0.749023 g"),i.push("0 0 "+wo(pi.internal.getWidth(n))+" "+wo(pi.internal.getHeight(n))+" re"),i.push("f"),i.push("q"),i.push("1 1 "+wo(pi.internal.getWidth(n)-2)+" "+wo(pi.internal.getHeight(n)-2)+" re"),i.push("W"),i.push("n"),i.push(wo(t.x1.x)+" "+wo(t.x1.y)+" m"),i.push(wo(t.x2.x)+" "+wo(t.x2.y)+" l"),i.push(wo(t.x4.x)+" "+wo(t.x4.y)+" m"),i.push(wo(t.x3.x)+" "+wo(t.x3.y)+" l"),i.push("s"),i.push("Q"),e.stream=i.join(`
`),e},OffPushDown:function(n){var e=gf(n);e.scope=n.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+wo(pi.internal.getWidth(n))+" "+wo(pi.internal.getHeight(n))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(n){var e=n.scope.internal.getFont(n.fontName,n.fontStyle).id,t=n.scope.__private__.encodeColorString(n.color);return"/"+e+" "+n.fontSize+" Tf "+t}};pi.internal={Bezier_C:.551915024494,calculateCross:function(n){var e=pi.internal.getWidth(n),t=pi.internal.getHeight(n),i=Math.min(e,t);return{x1:{x:(e-i)/2,y:(t-i)/2+i},x2:{x:(e-i)/2+i,y:(t-i)/2},x3:{x:(e-i)/2,y:(t-i)/2},x4:{x:(e-i)/2+i,y:(t-i)/2+i}}}},pi.internal.getWidth=function(n){var e=0;return ba(n)==="object"&&(e=sS(n.Rect[2])),e},pi.internal.getHeight=function(n){var e=0;return ba(n)==="object"&&(e=sS(n.Rect[3])),e};var iM=Ql.addField=function(n){if(rM(this,n),!(n instanceof Yd))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=n).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),n.page=n.scope.internal.getCurrentPageInfo().pageNumber,this};Ql.AcroFormChoiceField=Yg,Ql.AcroFormListBox=Jg,Ql.AcroFormComboBox=Qg,Ql.AcroFormEditBox=L1,Ql.AcroFormButton=Su,Ql.AcroFormPushButton=P1,Ql.AcroFormRadioButton=e0,Ql.AcroFormCheckBox=k1,Ql.AcroFormTextField=Bm,Ql.AcroFormPasswordField=M1,Ql.AcroFormAppearance=pi,Ql.AcroForm={ChoiceField:Yg,ListBox:Jg,ComboBox:Qg,EditBox:L1,Button:Su,PushButton:P1,RadioButton:e0,CheckBox:k1,TextField:Bm,PasswordField:M1,Appearance:pi},wi.AcroForm={ChoiceField:Yg,ListBox:Jg,ComboBox:Qg,EditBox:L1,Button:Su,PushButton:P1,RadioButton:e0,CheckBox:k1,TextField:Bm,PasswordField:M1,Appearance:pi};wi.AcroForm;function i6(n){return n.reduce(function(e,t,i){return e[t]=i,e},{})}(function(n){var e="addImage_";n.__addimage__={};var t="UNKNOWN",i={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},c=n.__addimage__.getImageFileTypeByImageData=function(z,W){var Z,Ee,ke,Oe,Re,be=t;if((W=W||t)==="RGBA"||z.data!==void 0&&z.data instanceof Uint8ClampedArray&&"height"in z&&"width"in z)return"RGBA";if(Ve(z))for(Re in i)for(ke=i[Re],Z=0;Z<ke.length;Z+=1){for(Oe=!0,Ee=0;Ee<ke[Z].length;Ee+=1)if(ke[Z][Ee]!==void 0&&ke[Z][Ee]!==z[Ee]){Oe=!1;break}if(Oe===!0){be=Re;break}}else for(Re in i)for(ke=i[Re],Z=0;Z<ke.length;Z+=1){for(Oe=!0,Ee=0;Ee<ke[Z].length;Ee+=1)if(ke[Z][Ee]!==void 0&&ke[Z][Ee]!==z.charCodeAt(Ee)){Oe=!1;break}if(Oe===!0){be=Re;break}}return be===t&&W!==t&&(be=W),be},u=function z(W){for(var Z=this.internal.write,Ee=this.internal.putStream,ke=(0,this.internal.getFilters)();ke.indexOf("FlateEncode")!==-1;)ke.splice(ke.indexOf("FlateEncode"),1);W.objectId=this.internal.newObject();var Oe=[];if(Oe.push({key:"Type",value:"/XObject"}),Oe.push({key:"Subtype",value:"/Image"}),Oe.push({key:"Width",value:W.width}),Oe.push({key:"Height",value:W.height}),W.colorSpace===ne.INDEXED?Oe.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(W.palette.length/3-1)+" "+("sMask"in W&&W.sMask!==void 0?W.objectId+2:W.objectId+1)+" 0 R]"}):(Oe.push({key:"ColorSpace",value:"/"+W.colorSpace}),W.colorSpace===ne.DEVICE_CMYK&&Oe.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Oe.push({key:"BitsPerComponent",value:W.bitsPerComponent}),"decodeParameters"in W&&W.decodeParameters!==void 0&&Oe.push({key:"DecodeParms",value:"<<"+W.decodeParameters+">>"}),"transparency"in W&&Array.isArray(W.transparency)&&W.transparency.length>0){for(var Re="",be=0,De=W.transparency.length;be<De;be++)Re+=W.transparency[be]+" "+W.transparency[be]+" ";Oe.push({key:"Mask",value:"["+Re+"]"})}W.sMask!==void 0&&Oe.push({key:"SMask",value:W.objectId+1+" 0 R"});var Qe=W.filter!==void 0?["/"+W.filter]:void 0;if(Ee({data:W.data,additionalKeyValues:Oe,alreadyAppliedFilters:Qe,objectId:W.objectId}),Z("endobj"),"sMask"in W&&W.sMask!==void 0){var xe,ae=(xe=W.sMaskBitsPerComponent)!==null&&xe!==void 0?xe:W.bitsPerComponent,Me={width:W.width,height:W.height,colorSpace:"DeviceGray",bitsPerComponent:ae,data:W.sMask};"filter"in W&&(Me.decodeParameters="/Predictor ".concat(W.predictor," /Colors 1 /BitsPerComponent ").concat(ae," /Columns ").concat(W.width),Me.filter=W.filter),z.call(this,Me)}if(W.colorSpace===ne.INDEXED){var Fe=this.internal.newObject();Ee({data:j(new Uint8Array(W.palette)),objectId:Fe}),Z("endobj")}},m=function(){var z=this.internal.collections[e+"images"];for(var W in z)u.call(this,z[W])},_=function(){var z,W=this.internal.collections[e+"images"],Z=this.internal.write;for(var Ee in W)Z("/I"+(z=W[Ee]).index,z.objectId,"0","R")},o=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",m),this.internal.events.subscribe("putXobjectDict",_))},w=function(){var z=this.internal.collections[e+"images"];return o.call(this),z},I=function(){return Object.keys(this.internal.collections[e+"images"]).length},O=function(z){return typeof n["process"+z.toUpperCase()]=="function"},V=function(z){return ba(z)==="object"&&z.nodeType===1},M=function(z,W){if(z.nodeName==="IMG"&&z.hasAttribute("src")){var Z=""+z.getAttribute("src");if(Z.indexOf("data:image/")===0)return C1(unescape(Z).split("base64,").pop());var Ee=n.loadFile(Z,!0);if(Ee!==void 0)return Ee}if(z.nodeName==="CANVAS"){if(z.width===0||z.height===0)throw new Error("Given canvas must have data. Canvas width: "+z.width+", height: "+z.height);var ke;switch(W){case"PNG":ke="image/png";break;case"WEBP":ke="image/webp";break;default:ke="image/jpeg"}return C1(z.toDataURL(ke,1).split("base64,").pop())}},se=function(z){var W=this.internal.collections[e+"images"];if(W){for(var Z in W)if(z===W[Z].alias)return W[Z]}},ce=function(z,W,Z){return z||W||(z=-96,W=-96),z<0&&(z=-1*Z.width*72/z/this.internal.scaleFactor),W<0&&(W=-1*Z.height*72/W/this.internal.scaleFactor),z===0&&(z=W*Z.width/Z.height),W===0&&(W=z*Z.height/Z.width),[z,W]},fe=function(z,W,Z,Ee,ke,Oe){var Re=ce.call(this,Z,Ee,ke),be=this.internal.getCoordinateString,De=this.internal.getVerticalCoordinateString,Qe=w.call(this);if(Z=Re[0],Ee=Re[1],Qe[ke.index]=ke,Oe){Oe*=Math.PI/180;var xe=Math.cos(Oe),ae=Math.sin(Oe),Me=function(Ze){return Ze.toFixed(4)},Fe=[Me(xe),Me(ae),Me(-1*ae),Me(xe),0,0,"cm"]}this.internal.write("q"),Oe?(this.internal.write([1,"0","0",1,be(z),De(W+Ee),"cm"].join(" ")),this.internal.write(Fe.join(" ")),this.internal.write([be(Z),"0","0",be(Ee),"0","0","cm"].join(" "))):this.internal.write([be(Z),"0","0",be(Ee),be(z),De(W+Ee),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+ke.index+" Do"),this.internal.write("Q")},ne=n.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};n.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var oe=n.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},ye=n.__addimage__.sHashCode=function(z){var W,Z,Ee=0;if(typeof z=="string")for(Z=z.length,W=0;W<Z;W++)Ee=(Ee<<5)-Ee+z.charCodeAt(W),Ee|=0;else if(Ve(z))for(Z=z.byteLength/2,W=0;W<Z;W++)Ee=(Ee<<5)-Ee+z[W],Ee|=0;return Ee},he=n.__addimage__.validateStringAsBase64=function(z){(z=z||"").toString().trim();var W=!0;return z.length===0&&(W=!1),z.length%4!=0&&(W=!1),/^[A-Za-z0-9+/]+$/.test(z.substr(0,z.length-2))===!1&&(W=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(z.substr(-2))===!1&&(W=!1),W},Ne=n.__addimage__.extractImageFromDataUrl=function(z){if(z==null||!(z=z.trim()).startsWith("data:"))return null;var W=z.indexOf(",");return W<0?null:z.substring(0,W).trim().endsWith("base64")?z.substring(W+1):null};n.__addimage__.isArrayBuffer=function(z){return z instanceof ArrayBuffer};var Ve=n.__addimage__.isArrayBufferView=function(z){return z instanceof Int8Array||z instanceof Uint8Array||z instanceof Uint8ClampedArray||z instanceof Int16Array||z instanceof Uint16Array||z instanceof Int32Array||z instanceof Uint32Array||z instanceof Float32Array||z instanceof Float64Array},de=n.__addimage__.binaryStringToUint8Array=function(z){for(var W=z.length,Z=new Uint8Array(W),Ee=0;Ee<W;Ee++)Z[Ee]=z.charCodeAt(Ee);return Z},j=n.__addimage__.arrayBufferToBinaryString=function(z){for(var W="",Z=Ve(z)?z:new Uint8Array(z),Ee=0;Ee<Z.length;Ee+=8192)W+=String.fromCharCode.apply(null,Z.subarray(Ee,Ee+8192));return W};n.addImage=function(){var z,W,Z,Ee,ke,Oe,Re,be,De;if(typeof arguments[1]=="number"?(W=t,Z=arguments[1],Ee=arguments[2],ke=arguments[3],Oe=arguments[4],Re=arguments[5],be=arguments[6],De=arguments[7]):(W=arguments[1],Z=arguments[2],Ee=arguments[3],ke=arguments[4],Oe=arguments[5],Re=arguments[6],be=arguments[7],De=arguments[8]),ba(z=arguments[0])==="object"&&!V(z)&&"imageData"in z){var Qe=z;z=Qe.imageData,W=Qe.format||W||t,Z=Qe.x||Z||0,Ee=Qe.y||Ee||0,ke=Qe.w||Qe.width||ke,Oe=Qe.h||Qe.height||Oe,Re=Qe.alias||Re,be=Qe.compression||be,De=Qe.rotation||Qe.angle||De}var xe=this.internal.getFilters();if(be===void 0&&xe.indexOf("FlateEncode")!==-1&&(be="SLOW"),isNaN(Z)||isNaN(Ee))throw new Error("Invalid coordinates passed to jsPDF.addImage");o.call(this);var ae=D.call(this,z,W,Re,be);return fe.call(this,Z,Ee,ke,Oe,ae,De),this};var D=function(z,W,Z,Ee){var ke,Oe,Re;if(typeof z=="string"&&c(z)===t){z=unescape(z);var be=$(z,!1);(be!==""||(be=n.loadFile(z,!0))!==void 0)&&(z=be)}if(V(z)&&(z=M(z,W)),W=c(z,W),!O(W))throw new Error("addImage does not support files of type '"+W+"', please ensure that a plugin for '"+W+"' support is added.");if(((Re=Z)==null||Re.length===0)&&(Z=(function(De){return typeof De=="string"||Ve(De)?ye(De):Ve(De.data)?ye(De.data):null})(z)),(ke=se.call(this,Z))||(z instanceof Uint8Array||W==="RGBA"||(Oe=z,z=de(z)),ke=this["process"+W.toUpperCase()](z,I.call(this),Z,(function(De){return De&&typeof De=="string"&&(De=De.toUpperCase()),De in n.image_compression?De:oe.NONE})(Ee),Oe)),!ke)throw new Error("An unknown error occurred whilst processing the image.");return ke},$=n.__addimage__.convertBase64ToBinaryString=function(z,W){W=typeof W!="boolean"||W;var Z,Ee="";if(typeof z=="string"){var ke;Z=(ke=Ne(z))!==null&&ke!==void 0?ke:z;try{Ee=C1(Z)}catch(Oe){if(W)throw he(Z)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Oe.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Ee};n.getImageProperties=function(z){var W,Z,Ee="";if(V(z)&&(z=M(z)),typeof z=="string"&&c(z)===t&&((Ee=$(z,!1))===""&&(Ee=n.loadFile(z)||""),z=Ee),Z=c(z),!O(Z))throw new Error("addImage does not support files of type '"+Z+"', please ensure that a plugin for '"+Z+"' support is added.");if(z instanceof Uint8Array||(z=de(z)),!(W=this["process"+Z.toUpperCase()](z)))throw new Error("An unknown error occurred whilst processing the image");return W.fileType=Z,W}})(wi.API),(function(n){var e=function(t){if(t!==void 0&&t!="")return!0};wi.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),n.events.push(["putPage",function(t){for(var i,c,u,m=this.internal.getCoordinateString,_=this.internal.getVerticalCoordinateString,o=this.internal.getPageInfoByObjId(t.objId),w=t.pageContext.annotations,I=!1,O=0;O<w.length&&!I;O++)switch((i=w[O]).type){case"link":(e(i.options.url)||e(i.options.pageNumber))&&(I=!0);break;case"reference":case"text":case"freetext":I=!0}if(I!=0){this.internal.write("/Annots [");for(var V=0;V<w.length;V++){i=w[V];var M=this.internal.pdfEscape,se=this.internal.getEncryptor(t.objId);switch(i.type){case"reference":this.internal.write(" "+i.object.objId+" 0 R ");break;case"text":var ce=this.internal.newAdditionalObject(),fe=this.internal.newAdditionalObject(),ne=this.internal.getEncryptor(ce.objId),oe=i.title||"Note";u="<</Type /Annot /Subtype /Text "+(c="/Rect ["+m(i.bounds.x)+" "+_(i.bounds.y+i.bounds.h)+" "+m(i.bounds.x+i.bounds.w)+" "+_(i.bounds.y)+"] ")+"/Contents ("+M(ne(i.contents))+")",u+=" /Popup "+fe.objId+" 0 R",u+=" /P "+o.objId+" 0 R",u+=" /T ("+M(ne(oe))+") >>",ce.content=u;var ye=ce.objId+" 0 R";u="<</Type /Annot /Subtype /Popup "+(c="/Rect ["+m(i.bounds.x+30)+" "+_(i.bounds.y+i.bounds.h)+" "+m(i.bounds.x+i.bounds.w+30)+" "+_(i.bounds.y)+"] ")+" /Parent "+ye,i.open&&(u+=" /Open true"),u+=" >>",fe.content=u,this.internal.write(ce.objId,"0 R",fe.objId,"0 R");break;case"freetext":c="/Rect ["+m(i.bounds.x)+" "+_(i.bounds.y)+" "+m(i.bounds.x+i.bounds.w)+" "+_(i.bounds.y+i.bounds.h)+"] ";var he=i.color||"#000000";u="<</Type /Annot /Subtype /FreeText "+c+"/Contents ("+M(se(i.contents))+")",u+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+he+")",u+=" /Border [0 0 0]",u+=" >>",this.internal.write(u);break;case"link":if(i.options.name){var Ne=this.annotations._nameMap[i.options.name];i.options.pageNumber=Ne.page,i.options.top=Ne.y}else i.options.top||(i.options.top=0);if(c="/Rect ["+i.finalBounds.x+" "+i.finalBounds.y+" "+i.finalBounds.w+" "+i.finalBounds.h+"] ",u="",i.options.url)u="<</Type /Annot /Subtype /Link "+c+"/Border [0 0 0] /A <</S /URI /URI ("+M(se(i.options.url))+") >>";else if(i.options.pageNumber)switch(u="<</Type /Annot /Subtype /Link "+c+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(i.options.pageNumber).objId+" 0 R",i.options.magFactor=i.options.magFactor||"XYZ",i.options.magFactor){case"Fit":u+=" /Fit]";break;case"FitH":u+=" /FitH "+i.options.top+"]";break;case"FitV":i.options.left=i.options.left||0,u+=" /FitV "+i.options.left+"]";break;default:var Ve=_(i.options.top);i.options.left=i.options.left||0,i.options.zoom===void 0&&(i.options.zoom=0),u+=" /XYZ "+i.options.left+" "+Ve+" "+i.options.zoom+"]"}u!=""&&(u+=" >>",this.internal.write(u))}}this.internal.write("]")}}]),n.createAnnotation=function(t){var i=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":i.pageContext.annotations.push(t)}},n.link=function(t,i,c,u,m){var _=this.internal.getCurrentPageInfo(),o=this.internal.getCoordinateString,w=this.internal.getVerticalCoordinateString;_.pageContext.annotations.push({finalBounds:{x:o(t),y:w(i),w:o(t+c),h:w(i+u)},options:m,type:"link"})},n.textWithLink=function(t,i,c,u){var m,_,o=this.getTextWidth(t),w=this.internal.getLineHeight()/this.internal.scaleFactor;if(u.maxWidth!==void 0){_=u.maxWidth;var I=this.splitTextToSize(t,_).length;m=Math.ceil(w*I)}else _=o,m=w;return this.text(t,i,c,u),c+=.2*w,u.align==="center"&&(i-=o/2),u.align==="right"&&(i-=o),this.link(i,c-w,_,m,u),o},n.getTextWidth=function(t){var i=this.internal.getFontSize();return this.getStringUnitWidth(t)*i/this.internal.scaleFactor}})(wi.API),(function(n){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},i={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},c=[1570,1571,1573,1575];n.__arabicParser__={};var u=n.__arabicParser__.isInArabicSubstitutionA=function(ce){return e[ce.charCodeAt(0)]!==void 0},m=n.__arabicParser__.isArabicLetter=function(ce){return typeof ce=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(ce)},_=n.__arabicParser__.isArabicEndLetter=function(ce){return m(ce)&&u(ce)&&e[ce.charCodeAt(0)].length<=2},o=n.__arabicParser__.isArabicAlfLetter=function(ce){return m(ce)&&c.indexOf(ce.charCodeAt(0))>=0};n.__arabicParser__.arabicLetterHasIsolatedForm=function(ce){return m(ce)&&u(ce)&&e[ce.charCodeAt(0)].length>=1};var w=n.__arabicParser__.arabicLetterHasFinalForm=function(ce){return m(ce)&&u(ce)&&e[ce.charCodeAt(0)].length>=2};n.__arabicParser__.arabicLetterHasInitialForm=function(ce){return m(ce)&&u(ce)&&e[ce.charCodeAt(0)].length>=3};var I=n.__arabicParser__.arabicLetterHasMedialForm=function(ce){return m(ce)&&u(ce)&&e[ce.charCodeAt(0)].length==4},O=n.__arabicParser__.resolveLigatures=function(ce){var fe=0,ne=t,oe="",ye=0;for(fe=0;fe<ce.length;fe+=1)ne[ce.charCodeAt(fe)]!==void 0?(ye++,typeof(ne=ne[ce.charCodeAt(fe)])=="number"&&(oe+=String.fromCharCode(ne),ne=t,ye=0),fe===ce.length-1&&(ne=t,oe+=ce.charAt(fe-(ye-1)),fe-=ye-1,ye=0)):(ne=t,oe+=ce.charAt(fe-ye),fe-=ye,ye=0);return oe};n.__arabicParser__.isArabicDiacritic=function(ce){return ce!==void 0&&i[ce.charCodeAt(0)]!==void 0};var V=n.__arabicParser__.getCorrectForm=function(ce,fe,ne){return m(ce)?u(ce)===!1?-1:!w(ce)||!m(fe)&&!m(ne)||!m(ne)&&_(fe)||_(ce)&&!m(fe)||_(ce)&&o(fe)||_(ce)&&_(fe)?0:I(ce)&&m(fe)&&!_(fe)&&m(ne)&&w(ne)?3:_(ce)||!m(ne)?1:2:-1},M=function(ce){var fe=0,ne=0,oe=0,ye="",he="",Ne="",Ve=(ce=ce||"").split("\\s+"),de=[];for(fe=0;fe<Ve.length;fe+=1){for(de.push(""),ne=0;ne<Ve[fe].length;ne+=1)ye=Ve[fe][ne],he=Ve[fe][ne-1],Ne=Ve[fe][ne+1],m(ye)?(oe=V(ye,he,Ne),de[fe]+=oe!==-1?String.fromCharCode(e[ye.charCodeAt(0)][oe]):ye):de[fe]+=ye;de[fe]=O(de[fe])}return de.join(" ")},se=n.__arabicParser__.processArabic=n.processArabic=function(){var ce,fe=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,ne=[];if(Array.isArray(fe)){var oe=0;for(ne=[],oe=0;oe<fe.length;oe+=1)Array.isArray(fe[oe])?ne.push([M(fe[oe][0]),fe[oe][1],fe[oe][2]]):ne.push([M(fe[oe])]);ce=ne}else ce=M(fe);return typeof arguments[0]=="string"?ce:(arguments[0].text=ce,arguments[0])};n.events.push(["preProcessText",se])})(wi.API),wi.API.autoPrint=function(n){var e;return(n=n||{}).variant=n.variant||"non-conform",n.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this},(function(n){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(_){t=_}});var i=150;Object.defineProperty(this,"width",{get:function(){return i},set:function(_){i=isNaN(_)||Number.isInteger(_)===!1||_<0?150:_,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=i+1)}});var c=300;Object.defineProperty(this,"height",{get:function(){return c},set:function(_){c=isNaN(_)||Number.isInteger(_)===!1||_<0?300:_,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=c+1)}});var u=[];Object.defineProperty(this,"childNodes",{get:function(){return u},set:function(_){u=_}});var m={};Object.defineProperty(this,"style",{get:function(){return m},set:function(_){m=_}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,i){var c;if((t=t||"2d")!=="2d")return null;for(c in i)this.pdf.context2d.hasOwnProperty(c)&&(this.pdf.context2d[c]=i[c]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},n.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])})(wi.API),(function(n){var e={left:0,top:0,bottom:0,right:0},t=!1,i=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),c.call(this))},c=function(){this.internal.__cell__.lastCell=new u,this.internal.__cell__.pages=1},u=function(){var o=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return o},set:function(ce){o=ce}});var w=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return w},set:function(ce){w=ce}});var I=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return I},set:function(ce){I=ce}});var O=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return O},set:function(ce){O=ce}});var V=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return V},set:function(ce){V=ce}});var M=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return M},set:function(ce){M=ce}});var se=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return se},set:function(ce){se=ce}}),this};u.prototype.clone=function(){return new u(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},u.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},n.setHeaderFunction=function(o){return i.call(this),this.internal.__cell__.headerFunction=typeof o=="function"?o:void 0,this},n.getTextDimensions=function(o,w){i.call(this);var I=(w=w||{}).fontSize||this.getFontSize(),O=w.font||this.getFont(),V=w.scaleFactor||this.internal.scaleFactor,M=0,se=0,ce=0,fe=this;if(!Array.isArray(o)&&typeof o!="string"){if(typeof o!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");o=String(o)}var ne=w.maxWidth;ne>0?typeof o=="string"?o=this.splitTextToSize(o,ne):Object.prototype.toString.call(o)==="[object Array]"&&(o=o.reduce(function(ye,he){return ye.concat(fe.splitTextToSize(he,ne))},[])):o=Array.isArray(o)?o:[o];for(var oe=0;oe<o.length;oe++)M<(ce=this.getStringUnitWidth(o[oe],{font:O})*I)&&(M=ce);return M!==0&&(se=o.length),{w:M/=V,h:Math.max((se*I*this.getLineHeightFactor()-I*(this.getLineHeightFactor()-1))/V,0)}},n.cellAddPage=function(){i.call(this),this.addPage();var o=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new u(o.left,o.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var m=n.cell=function(){var o;o=arguments[0]instanceof u?arguments[0]:new u(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),i.call(this);var w=this.internal.__cell__.lastCell,I=this.internal.__cell__.padding,O=this.internal.__cell__.margins||e,V=this.internal.__cell__.tableHeaderRow,M=this.internal.__cell__.printHeaders;return w.lineNumber!==void 0&&(w.lineNumber===o.lineNumber?(o.x=(w.x||0)+(w.width||0),o.y=w.y||0):w.y+w.height+o.height+O.bottom>this.getPageHeight()?(this.cellAddPage(),o.y=O.top,M&&V&&(this.printHeaderRow(o.lineNumber,!0),o.y+=V[0].height)):o.y=w.y+w.height||o.y),o.text[0]!==void 0&&(this.rect(o.x,o.y,o.width,o.height,t===!0?"FD":void 0),o.align==="right"?this.text(o.text,o.x+o.width-I,o.y+I,{align:"right",baseline:"top"}):o.align==="center"?this.text(o.text,o.x+o.width/2,o.y+I,{align:"center",baseline:"top",maxWidth:o.width-I-I}):this.text(o.text,o.x+I,o.y+I,{align:"left",baseline:"top",maxWidth:o.width-I-I})),this.internal.__cell__.lastCell=o,this};n.table=function(o,w,I,O,V){if(i.call(this),!I)throw new Error("No data for PDF table.");var M,se,ce,fe,ne=[],oe=[],ye=[],he={},Ne={},Ve=[],de=[],j=(V=V||{}).autoSize||!1,D=V.printHeaders!==!1,$=V.css&&V.css["font-size"]!==void 0?16*V.css["font-size"]:V.fontSize||12,z=V.margins||Object.assign({width:this.getPageWidth()},e),W=typeof V.padding=="number"?V.padding:3,Z=V.headerBackgroundColor||"#c8c8c8",Ee=V.headerTextColor||"#000";if(c.call(this),this.internal.__cell__.printHeaders=D,this.internal.__cell__.margins=z,this.internal.__cell__.table_font_size=$,this.internal.__cell__.padding=W,this.internal.__cell__.headerBackgroundColor=Z,this.internal.__cell__.headerTextColor=Ee,this.setFontSize($),O==null)oe=ne=Object.keys(I[0]),ye=ne.map(function(){return"left"});else if(Array.isArray(O)&&ba(O[0])==="object")for(ne=O.map(function(Qe){return Qe.name}),oe=O.map(function(Qe){return Qe.prompt||Qe.name||""}),ye=O.map(function(Qe){return Qe.align||"left"}),M=0;M<O.length;M+=1)Ne[O[M].name]=.7499990551181103*O[M].width;else Array.isArray(O)&&typeof O[0]=="string"&&(oe=ne=O,ye=ne.map(function(){return"left"}));if(j||Array.isArray(O)&&typeof O[0]=="string")for(M=0;M<ne.length;M+=1){for(he[fe=ne[M]]=I.map(function(Qe){return Qe[fe]}),this.setFont(void 0,"bold"),Ve.push(this.getTextDimensions(oe[M],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),se=he[fe],this.setFont(void 0,"normal"),ce=0;ce<se.length;ce+=1)Ve.push(this.getTextDimensions(se[ce],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);Ne[fe]=Math.max.apply(null,Ve)+W+W,Ve=[]}if(D){var ke={};for(M=0;M<ne.length;M+=1)ke[ne[M]]={},ke[ne[M]].text=oe[M],ke[ne[M]].align=ye[M];var Oe=_.call(this,ke,Ne);de=ne.map(function(Qe){return new u(o,w,Ne[Qe],Oe,ke[Qe].text,void 0,ke[Qe].align)}),this.setTableHeaderRow(de),this.printHeaderRow(1,!1)}var Re=O.reduce(function(Qe,xe){return Qe[xe.name]=xe.align,Qe},{});for(M=0;M<I.length;M+=1){"rowStart"in V&&V.rowStart instanceof Function&&V.rowStart({row:M,data:I[M]},this);var be=_.call(this,I[M],Ne);for(ce=0;ce<ne.length;ce+=1){var De=I[M][ne[ce]];"cellStart"in V&&V.cellStart instanceof Function&&V.cellStart({row:M,col:ce,data:De},this),m.call(this,new u(o,w,Ne[ne[ce]],be,De,M+2,Re[ne[ce]]))}}return this.internal.__cell__.table_x=o,this.internal.__cell__.table_y=w,this};var _=function(o,w){var I=this.internal.__cell__.padding,O=this.internal.__cell__.table_font_size,V=this.internal.scaleFactor;return Object.keys(o).map(function(M){var se=o[M];return this.splitTextToSize(se.hasOwnProperty("text")?se.text:se,w[M]-I-I)},this).map(function(M){return this.getLineHeightFactor()*M.length*O/V+I+I},this).reduce(function(M,se){return Math.max(M,se)},0)};n.setTableHeaderRow=function(o){i.call(this),this.internal.__cell__.tableHeaderRow=o},n.printHeaderRow=function(o,w){if(i.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var I;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var O=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new u(O[0],O[1],O[2],O[3],void 0,-1)}this.setFont(void 0,"bold");for(var V=[],M=0;M<this.internal.__cell__.tableHeaderRow.length;M+=1){I=this.internal.__cell__.tableHeaderRow[M].clone(),w&&(I.y=this.internal.__cell__.margins.top||0,V.push(I)),I.lineNumber=o;var se=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),m.call(this,I),this.setTextColor(se)}V.length>0&&this.setTableHeaderRow(V),this.setFont(void 0,"normal"),t=!1}})(wi.API);var o6={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},s6=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],l5=i6(s6),a6=[100,200,300,400,500,600,700,800,900],oM=i6(a6);function gb(n){var e=n.family.replace(/"|'/g,"").toLowerCase(),t=(function(u){return o6[u=u||"normal"]?u:"normal"})(n.style),i=(function(u){return u?typeof u=="number"?u>=100&&u<=900&&u%100==0?u:400:/^\d00$/.test(u)?parseInt(u):u==="bold"?700:400:400})(n.weight),c=(function(u){return typeof l5[u=u||"normal"]=="number"?u:"normal"})(n.stretch);return{family:e,style:t,weight:i,stretch:c,src:n.src||[],ref:n.ref||{name:e,style:[c,t,i].join(" ")}}}function aS(n,e,t,i){var c;for(c=t;c>=0&&c<e.length;c+=i)if(n[e[c]])return n[e[c]];for(c=t;c>=0&&c<e.length;c-=i)if(n[e[c]])return n[e[c]]}var sM={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},lS={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function cS(n){return[n.stretch,n.style,n.weight,n.family].join(" ")}function uS(n){return n.trimLeft()}function aM(n,e){for(var t=0;t<n.length;){if(n.charAt(t)===e)return[n.substring(0,t),n.substring(t+1)];t+=1}return null}function lM(n){var e=n.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],n.substring(e[0].length)]}var o1,hS,dS,kg,s1,fS,pS,mS,yb=["times"];function gS(n,e,t,i,c){var u=4,m=_S;switch(c){case wi.API.image_compression.FAST:u=1,m=yS;break;case wi.API.image_compression.MEDIUM:u=6,m=vS;break;case wi.API.image_compression.SLOW:u=9,m=xS}n=(function(o,w,I,O){for(var V,M=o.length/w,se=new Uint8Array(o.length+M),ce=[cM,yS,_S,vS,xS],fe=0;fe<M;fe+=1){var ne=fe*w,oe=o.subarray(ne,ne+w);if(O)se.set(O(oe,I,V),ne+fe);else{for(var ye=ce.length,he=[],Ne=0;Ne<ye;Ne+=1)he[Ne]=ce[Ne](oe,I,V);var Ve=hM(he.concat());se.set(he[Ve],ne+fe)}V=oe}return se})(n,e,Math.ceil(t*i/8),m);var _=t5(n,{level:u});return wi.API.__addimage__.arrayBufferToBinaryString(_)}function cM(n){var e=Array.apply([],n);return e.unshift(0),e}function yS(n,e){var t=n.length,i=[];i[0]=1;for(var c=0;c<t;c+=1){var u=n[c-e]||0;i[c+1]=n[c]-u+256&255}return i}function _S(n,e,t){var i=n.length,c=[];c[0]=2;for(var u=0;u<i;u+=1){var m=t&&t[u]||0;c[u+1]=n[u]-m+256&255}return c}function vS(n,e,t){var i=n.length,c=[];c[0]=3;for(var u=0;u<i;u+=1){var m=n[u-e]||0,_=t&&t[u]||0;c[u+1]=n[u]+256-(m+_>>>1)&255}return c}function xS(n,e,t){var i=n.length,c=[];c[0]=4;for(var u=0;u<i;u+=1){var m=uM(n[u-e]||0,t&&t[u]||0,t&&t[u-e]||0);c[u+1]=n[u]-m+256&255}return c}function uM(n,e,t){if(n===e&&e===t)return n;var i=Math.abs(e-t),c=Math.abs(n-t),u=Math.abs(n+e-t-t);return i<=c&&i<=u?n:c<=u?e:t}function hM(n){var e=n.map(function(t){return t.reduce(function(i,c){return i+Math.abs(c)},0)});return e.indexOf(Math.min.apply(null,e))}function _b(n,e,t){var i=e*t,c=Math.floor(i/8),u=16-(i-8*c+t),m=(1<<t)-1;return l6(n,c)>>u&m}function bS(n,e,t,i){var c=t*i,u=Math.floor(c/8),m=16-(c-8*u+i),_=(1<<i)-1,o=(e&_)<<m;(function(w,I,O){if(I+1<w.byteLength)w.setUint16(I,O,!1);else{var V=O>>8&255;w.setUint8(I,V)}})(n,u,l6(n,u)&~(_<<m)&65535|o)}function l6(n,e){return e+1<n.byteLength?n.getUint16(e,!1):n.getUint8(e)<<8}function dM(n){var e=0;if(n[e++]!==71||n[e++]!==73||n[e++]!==70||n[e++]!==56||(n[e++]+1&253)!=56||n[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=n[e++]|n[e++]<<8,i=n[e++]|n[e++]<<8,c=n[e++],u=c>>7,m=1<<1+(7&c);n[e++],n[e++];var _=null,o=null;u&&(_=e,o=m,e+=3*m);var w=!0,I=[],O=0,V=null,M=0,se=null;for(this.width=t,this.height=i;w&&e<n.length;)switch(n[e++]){case 33:switch(n[e++]){case 255:if(n[e]!==11||n[e+1]==78&&n[e+2]==69&&n[e+3]==84&&n[e+4]==83&&n[e+5]==67&&n[e+6]==65&&n[e+7]==80&&n[e+8]==69&&n[e+9]==50&&n[e+10]==46&&n[e+11]==48&&n[e+12]==3&&n[e+13]==1&&n[e+16]==0)e+=14,se=n[e++]|n[e++]<<8,e++;else for(e+=12;;){if(!((z=n[e++])>=0))throw Error("Invalid block size");if(z===0)break;e+=z}break;case 249:if(n[e++]!==4||n[e+4]!==0)throw new Error("Invalid graphics extension block.");var ce=n[e++];O=n[e++]|n[e++]<<8,V=n[e++],1&ce||(V=null),M=ce>>2&7,e++;break;case 254:for(;;){if(!((z=n[e++])>=0))throw Error("Invalid block size");if(z===0)break;e+=z}break;default:throw new Error("Unknown graphic control label: 0x"+n[e-1].toString(16))}break;case 44:var fe=n[e++]|n[e++]<<8,ne=n[e++]|n[e++]<<8,oe=n[e++]|n[e++]<<8,ye=n[e++]|n[e++]<<8,he=n[e++],Ne=he>>6&1,Ve=1<<1+(7&he),de=_,j=o,D=!1;he>>7&&(D=!0,de=e,j=Ve,e+=3*Ve);var $=e;for(e++;;){var z;if(!((z=n[e++])>=0))throw Error("Invalid block size");if(z===0)break;e+=z}I.push({x:fe,y:ne,width:oe,height:ye,has_local_palette:D,palette_offset:de,palette_size:j,data_offset:$,data_length:e-$,transparent_index:V,interlaced:!!Ne,delay:O,disposal:M});break;case 59:w=!1;break;default:throw new Error("Unknown gif block: 0x"+n[e-1].toString(16))}this.numFrames=function(){return I.length},this.loopCount=function(){return se},this.frameInfo=function(W){if(W<0||W>=I.length)throw new Error("Frame index out of range.");return I[W]},this.decodeAndBlitFrameBGRA=function(W,Z){var Ee=this.frameInfo(W),ke=Ee.width*Ee.height,Oe=new Uint8Array(ke);wS(n,Ee.data_offset,Oe,ke);var Re=Ee.palette_offset,be=Ee.transparent_index;be===null&&(be=256);var De=Ee.width,Qe=t-De,xe=De,ae=4*(Ee.y*t+Ee.x),Me=4*((Ee.y+Ee.height)*t+Ee.x),Fe=ae,Ze=4*Qe;Ee.interlaced===!0&&(Ze+=4*t*7);for(var et=8,mt=0,ht=Oe.length;mt<ht;++mt){var Nt=Oe[mt];if(xe===0&&(xe=De,(Fe+=Ze)>=Me&&(Ze=4*Qe+4*t*(et-1),Fe=ae+(De+Qe)*(et<<1),et>>=1)),Nt===be)Fe+=4;else{var Jt=n[Re+3*Nt],tn=n[Re+3*Nt+1],fn=n[Re+3*Nt+2];Z[Fe++]=fn,Z[Fe++]=tn,Z[Fe++]=Jt,Z[Fe++]=255}--xe}},this.decodeAndBlitFrameRGBA=function(W,Z){var Ee=this.frameInfo(W),ke=Ee.width*Ee.height,Oe=new Uint8Array(ke);wS(n,Ee.data_offset,Oe,ke);var Re=Ee.palette_offset,be=Ee.transparent_index;be===null&&(be=256);var De=Ee.width,Qe=t-De,xe=De,ae=4*(Ee.y*t+Ee.x),Me=4*((Ee.y+Ee.height)*t+Ee.x),Fe=ae,Ze=4*Qe;Ee.interlaced===!0&&(Ze+=4*t*7);for(var et=8,mt=0,ht=Oe.length;mt<ht;++mt){var Nt=Oe[mt];if(xe===0&&(xe=De,(Fe+=Ze)>=Me&&(Ze=4*Qe+4*t*(et-1),Fe=ae+(De+Qe)*(et<<1),et>>=1)),Nt===be)Fe+=4;else{var Jt=n[Re+3*Nt],tn=n[Re+3*Nt+1],fn=n[Re+3*Nt+2];Z[Fe++]=Jt,Z[Fe++]=tn,Z[Fe++]=fn,Z[Fe++]=255}--xe}}}function wS(n,e,t,i){for(var c=n[e++],u=1<<c,m=u+1,_=m+1,o=c+1,w=(1<<o)-1,I=0,O=0,V=0,M=n[e++],se=new Int32Array(4096),ce=null;;){for(;I<16&&M!==0;)O|=n[e++]<<I,I+=8,M===1?M=n[e++]:--M;if(I<o)break;var fe=O&w;if(O>>=o,I-=o,fe!==u){if(fe===m)break;for(var ne=fe<_?fe:ce,oe=0,ye=ne;ye>u;)ye=se[ye]>>8,++oe;var he=ye;if(V+oe+(ne!==fe?1:0)>i)return void za.log("Warning, gif stream longer than expected.");t[V++]=he;var Ne=V+=oe;for(ne!==fe&&(t[V++]=he),ye=ne;oe--;)ye=se[ye],t[--Ne]=255&ye,ye>>=8;ce!==null&&_<4096&&(se[_++]=ce<<8|he,_>=w+1&&o<12&&(++o,w=w<<1|1)),ce=fe}else _=m+1,w=(1<<(o=c+1))-1,ce=null}return V!==i&&za.log("Warning, gif stream shorter than expected."),t}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function vb(n){var e,t,i,c,u,m=Math.floor,_=new Array(64),o=new Array(64),w=new Array(64),I=new Array(64),O=new Array(65535),V=new Array(65535),M=new Array(64),se=new Array(64),ce=[],fe=0,ne=7,oe=new Array(64),ye=new Array(64),he=new Array(64),Ne=new Array(256),Ve=new Array(2048),de=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],j=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],D=[0,1,2,3,4,5,6,7,8,9,10,11],$=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],z=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],W=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Z=[0,1,2,3,4,5,6,7,8,9,10,11],Ee=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],ke=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Oe(ae,Me){for(var Fe=0,Ze=0,et=new Array,mt=1;mt<=16;mt++){for(var ht=1;ht<=ae[mt];ht++)et[Me[Ze]]=[],et[Me[Ze]][0]=Fe,et[Me[Ze]][1]=mt,Ze++,Fe++;Fe*=2}return et}function Re(ae){for(var Me=ae[0],Fe=ae[1]-1;Fe>=0;)Me&1<<Fe&&(fe|=1<<ne),Fe--,--ne<0&&(fe==255?(be(255),be(0)):be(fe),ne=7,fe=0)}function be(ae){ce.push(ae)}function De(ae){be(ae>>8&255),be(255&ae)}function Qe(ae,Me,Fe,Ze,et){for(var mt,ht=et[0],Nt=et[240],Jt=(function(Tn,Yn){var $n,hr,Wt,Nn,tr,Hn,Rr,lr,wr,br,Ir=0;for(wr=0;wr<8;++wr){$n=Tn[Ir],hr=Tn[Ir+1],Wt=Tn[Ir+2],Nn=Tn[Ir+3],tr=Tn[Ir+4],Hn=Tn[Ir+5],Rr=Tn[Ir+6];var Bi=$n+(lr=Tn[Ir+7]),Mi=$n-lr,pr=hr+Rr,Jr=hr-Rr,Kr=Wt+Hn,Sr=Wt-Hn,ui=Nn+tr,ii=Nn-tr,ut=Bi+ui,we=Bi-ui,Ie=pr+Kr,Ye=pr-Kr;Tn[Ir]=ut+Ie,Tn[Ir+4]=ut-Ie;var ct=.707106781*(Ye+we);Tn[Ir+2]=we+ct,Tn[Ir+6]=we-ct;var Ct=.382683433*((ut=ii+Sr)-(Ye=Jr+Mi)),Rt=.5411961*ut+Ct,Bt=1.306562965*Ye+Ct,St=.707106781*(Ie=Sr+Jr),Mt=Mi+St,vn=Mi-St;Tn[Ir+5]=vn+Rt,Tn[Ir+3]=vn-Rt,Tn[Ir+1]=Mt+Bt,Tn[Ir+7]=Mt-Bt,Ir+=8}for(Ir=0,wr=0;wr<8;++wr){$n=Tn[Ir],hr=Tn[Ir+8],Wt=Tn[Ir+16],Nn=Tn[Ir+24],tr=Tn[Ir+32],Hn=Tn[Ir+40],Rr=Tn[Ir+48];var Bn=$n+(lr=Tn[Ir+56]),Ln=$n-lr,qr=hr+Rr,Cr=hr-Rr,Ar=Wt+Hn,Dr=Wt-Hn,_i=Nn+tr,ko=Nn-tr,ro=Bn+_i,os=Bn-_i,Ji=qr+Ar,Yo=qr-Ar;Tn[Ir]=ro+Ji,Tn[Ir+32]=ro-Ji;var oo=.707106781*(Yo+os);Tn[Ir+16]=os+oo,Tn[Ir+48]=os-oo;var Jo=.382683433*((ro=ko+Dr)-(Yo=Cr+Ln)),La=.5411961*ro+Jo,zl=1.306562965*Yo+Jo,jl=.707106781*(Ji=Dr+Cr),Fi=Ln+jl,nc=Ln-jl;Tn[Ir+40]=nc+La,Tn[Ir+24]=nc-La,Tn[Ir+8]=Fi+zl,Tn[Ir+56]=Fi-zl,Ir++}for(wr=0;wr<64;++wr)br=Tn[wr]*Yn[wr],M[wr]=br>0?br+.5|0:br-.5|0;return M})(ae,Me),tn=0;tn<64;++tn)se[de[tn]]=Jt[tn];var fn=se[0]-Fe;Fe=se[0],fn==0?Re(Ze[0]):(Re(Ze[V[mt=32767+fn]]),Re(O[mt]));for(var An=63;An>0&&se[An]==0;)An--;if(An==0)return Re(ht),Fe;for(var zt,it=1;it<=An;){for(var ur=it;se[it]==0&&it<=An;)++it;var xr=it-ur;if(xr>=16){zt=xr>>4;for(var Tr=1;Tr<=zt;++Tr)Re(Nt);xr&=15}mt=32767+se[it],Re(et[(xr<<4)+V[mt]]),Re(O[mt]),it++}return An!=63&&Re(ht),Fe}function xe(ae){ae=Math.min(Math.max(ae,1),100),u!=ae&&((function(Me){for(var Fe=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Ze=0;Ze<64;Ze++){var et=m((Fe[Ze]*Me+50)/100);et=Math.min(Math.max(et,1),255),_[de[Ze]]=et}for(var mt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ht=0;ht<64;ht++){var Nt=m((mt[ht]*Me+50)/100);Nt=Math.min(Math.max(Nt,1),255),o[de[ht]]=Nt}for(var Jt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],tn=0,fn=0;fn<8;fn++)for(var An=0;An<8;An++)w[tn]=1/(_[de[tn]]*Jt[fn]*Jt[An]*8),I[tn]=1/(o[de[tn]]*Jt[fn]*Jt[An]*8),tn++})(ae<50?Math.floor(5e3/ae):Math.floor(200-2*ae)),u=ae)}this.encode=function(ae,Me){Me&&xe(Me),ce=new Array,fe=0,ne=7,De(65496),De(65504),De(16),be(74),be(70),be(73),be(70),be(0),be(1),be(1),be(0),De(1),De(1),be(0),be(0),(function(){De(65499),De(132),be(0);for(var hr=0;hr<64;hr++)be(_[hr]);be(1);for(var Wt=0;Wt<64;Wt++)be(o[Wt])})(),(function(hr,Wt){De(65472),De(17),be(8),De(Wt),De(hr),be(3),be(1),be(17),be(0),be(2),be(17),be(1),be(3),be(17),be(1)})(ae.width,ae.height),(function(){De(65476),De(418),be(0);for(var hr=0;hr<16;hr++)be(j[hr+1]);for(var Wt=0;Wt<=11;Wt++)be(D[Wt]);be(16);for(var Nn=0;Nn<16;Nn++)be($[Nn+1]);for(var tr=0;tr<=161;tr++)be(z[tr]);be(1);for(var Hn=0;Hn<16;Hn++)be(W[Hn+1]);for(var Rr=0;Rr<=11;Rr++)be(Z[Rr]);be(17);for(var lr=0;lr<16;lr++)be(Ee[lr+1]);for(var wr=0;wr<=161;wr++)be(ke[wr])})(),De(65498),De(12),be(3),be(1),be(0),be(2),be(17),be(3),be(17),be(0),be(63),be(0);var Fe=0,Ze=0,et=0;fe=0,ne=7,this.encode.displayName="_encode_";for(var mt,ht,Nt,Jt,tn,fn,An,zt,it,ur=ae.data,xr=ae.width,Tr=ae.height,Tn=4*xr,Yn=0;Yn<Tr;){for(mt=0;mt<Tn;){for(tn=Tn*Yn+mt,An=-1,zt=0,it=0;it<64;it++)fn=tn+(zt=it>>3)*Tn+(An=4*(7&it)),Yn+zt>=Tr&&(fn-=Tn*(Yn+1+zt-Tr)),mt+An>=Tn&&(fn-=mt+An-Tn+4),ht=ur[fn++],Nt=ur[fn++],Jt=ur[fn++],oe[it]=(Ve[ht]+Ve[Nt+256|0]+Ve[Jt+512|0]>>16)-128,ye[it]=(Ve[ht+768|0]+Ve[Nt+1024|0]+Ve[Jt+1280|0]>>16)-128,he[it]=(Ve[ht+1280|0]+Ve[Nt+1536|0]+Ve[Jt+1792|0]>>16)-128;Fe=Qe(oe,w,Fe,e,i),Ze=Qe(ye,I,Ze,t,c),et=Qe(he,I,et,t,c),mt+=32}Yn+=8}if(ne>=0){var $n=[];$n[1]=ne+1,$n[0]=(1<<ne+1)-1,Re($n)}return De(65497),new Uint8Array(ce)},n=n||50,(function(){for(var ae=String.fromCharCode,Me=0;Me<256;Me++)Ne[Me]=ae(Me)})(),e=Oe(j,D),t=Oe(W,Z),i=Oe($,z),c=Oe(Ee,ke),(function(){for(var ae=1,Me=2,Fe=1;Fe<=15;Fe++){for(var Ze=ae;Ze<Me;Ze++)V[32767+Ze]=Fe,O[32767+Ze]=[],O[32767+Ze][1]=Fe,O[32767+Ze][0]=Ze;for(var et=-(Me-1);et<=-ae;et++)V[32767+et]=Fe,O[32767+et]=[],O[32767+et][1]=Fe,O[32767+et][0]=Me-1+et;ae<<=1,Me<<=1}})(),(function(){for(var ae=0;ae<256;ae++)Ve[ae]=19595*ae,Ve[ae+256|0]=38470*ae,Ve[ae+512|0]=7471*ae+32768,Ve[ae+768|0]=-11059*ae,Ve[ae+1024|0]=-21709*ae,Ve[ae+1280|0]=32768*ae+8421375,Ve[ae+1536|0]=-27439*ae,Ve[ae+1792|0]=-5329*ae})(),xe(n)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function zd(n,e){if(this.pos=0,this.buffer=n,this.datav=new DataView(n.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function SS(n){function e(D){if(!D)throw Error("assert :P")}function t(D,$,z){for(var W=0;4>W;W++)if(D[$+W]!=z.charCodeAt(W))return!0;return!1}function i(D,$,z,W,Z){for(var Ee=0;Ee<Z;Ee++)D[$+Ee]=z[W+Ee]}function c(D,$,z,W){for(var Z=0;Z<W;Z++)D[$+Z]=z}function u(D){return new Int32Array(D)}function m(D,$){for(var z=[],W=0;W<D;W++)z.push(new $);return z}function _(D,$){var z=[];return(function W(Z,Ee,ke){for(var Oe=ke[Ee],Re=0;Re<Oe&&(Z.push(ke.length>Ee+1?[]:new $),!(ke.length<Ee+1));Re++)W(Z[Re],Ee+1,ke)})(z,0,D),z}var o=function(){var D=this;function $(C,F){for(var Y=1<<F-1>>>0;C&Y;)Y>>>=1;return Y?(C&Y-1)+Y:C}function z(C,F,Y,ie,Ce){e(!(ie%Y));do C[F+(ie-=Y)]=Ce;while(0<ie)}function W(C,F,Y,ie,Ce){if(e(2328>=Ce),512>=Ce)var Be=u(512);else if((Be=u(Ce))==null)return 0;return(function(qe,Ke,Je,dt,Dt,Qt){var ft,Ot,Kt=Ke,Sn=1<<Je,y=u(16),a=u(16);for(e(Dt!=0),e(dt!=null),e(qe!=null),e(0<Je),Ot=0;Ot<Dt;++Ot){if(15<dt[Ot])return 0;++y[dt[Ot]]}if(y[0]==Dt)return 0;for(a[1]=0,ft=1;15>ft;++ft){if(y[ft]>1<<ft)return 0;a[ft+1]=a[ft]+y[ft]}for(Ot=0;Ot<Dt;++Ot)ft=dt[Ot],0<dt[Ot]&&(Qt[a[ft]++]=Ot);if(a[15]==1)return(dt=new Z).g=0,dt.value=Qt[0],z(qe,Kt,1,Sn,dt),Sn;var f,v=-1,S=Sn-1,T=0,R=1,B=1,G=1<<Je;for(Ot=0,ft=1,Dt=2;ft<=Je;++ft,Dt<<=1){if(R+=B<<=1,0>(B-=y[ft]))return 0;for(;0<y[ft];--y[ft])(dt=new Z).g=ft,dt.value=Qt[Ot++],z(qe,Kt+T,Dt,G,dt),T=$(T,ft)}for(ft=Je+1,Dt=2;15>=ft;++ft,Dt<<=1){if(R+=B<<=1,0>(B-=y[ft]))return 0;for(;0<y[ft];--y[ft]){if(dt=new Z,(T&S)!=v){for(Kt+=G,f=1<<(v=ft)-Je;15>v&&!(0>=(f-=y[v]));)++v,f<<=1;Sn+=G=1<<(f=v-Je),qe[Ke+(v=T&S)].g=f+Je,qe[Ke+v].value=Kt-Ke-v}dt.g=ft-Je,dt.value=Qt[Ot++],z(qe,Kt+(T>>Je),Dt,G,dt),T=$(T,ft)}}return R!=2*a[15]-1?0:Sn})(C,F,Y,ie,Ce,Be)}function Z(){this.value=this.g=0}function Ee(){this.value=this.g=0}function ke(){this.G=m(5,Z),this.H=u(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=m(Qa,Ee)}function Oe(C,F,Y,ie){e(C!=null),e(F!=null),e(2147483648>ie),C.Ca=254,C.I=0,C.b=-8,C.Ka=0,C.oa=F,C.pa=Y,C.Jd=F,C.Yc=Y+ie,C.Zc=4<=ie?Y+ie-4+1:Y,ht(C)}function Re(C,F){for(var Y=0;0<F--;)Y|=Jt(C,128)<<F;return Y}function be(C,F){var Y=Re(C,F);return Nt(C)?-Y:Y}function De(C,F,Y,ie){var Ce,Be=0;for(e(C!=null),e(F!=null),e(4294967288>ie),C.Sb=ie,C.Ra=0,C.u=0,C.h=0,4<ie&&(ie=4),Ce=0;Ce<ie;++Ce)Be+=F[Y+Ce]<<8*Ce;C.Ra=Be,C.bb=ie,C.oa=F,C.pa=Y}function Qe(C){for(;8<=C.u&&C.bb<C.Sb;)C.Ra>>>=8,C.Ra+=C.oa[C.pa+C.bb]<<Kc-8>>>0,++C.bb,C.u-=8;Ze(C)&&(C.h=1,C.u=0)}function xe(C,F){if(e(0<=F),!C.h&&F<=Xs){var Y=Fe(C)&ma[F];return C.u+=F,Qe(C),Y}return C.h=1,C.u=0}function ae(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Me(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Fe(C){return C.Ra>>>(C.u&Kc-1)>>>0}function Ze(C){return e(C.bb<=C.Sb),C.h||C.bb==C.Sb&&C.u>Kc}function et(C,F){C.u=F,C.h=Ze(C)}function mt(C){C.u>=Uo&&(e(C.u>=Uo),Qe(C))}function ht(C){e(C!=null&&C.oa!=null),C.pa<C.Zc?(C.I=(C.oa[C.pa++]|C.I<<8)>>>0,C.b+=8):(e(C!=null&&C.oa!=null),C.pa<C.Yc?(C.b+=8,C.I=C.oa[C.pa++]|C.I<<8):C.Ka?C.b=0:(C.I<<=8,C.b+=8,C.Ka=1))}function Nt(C){return Re(C,1)}function Jt(C,F){var Y=C.Ca;0>C.b&&ht(C);var ie=C.b,Ce=Y*F>>>8,Be=(C.I>>>ie>Ce)+0;for(Be?(Y-=Ce,C.I-=Ce+1<<ie>>>0):Y=Ce+1,ie=Y,Ce=0;256<=ie;)Ce+=8,ie>>=8;return ie=7^Ce+au[ie],C.b-=ie,C.Ca=(Y<<ie)-1,Be}function tn(C,F,Y){C[F+0]=Y>>24&255,C[F+1]=Y>>16&255,C[F+2]=Y>>8&255,C[F+3]=255&Y}function fn(C,F){return C[F+0]|C[F+1]<<8}function An(C,F){return fn(C,F)|C[F+2]<<16}function zt(C,F){return fn(C,F)|fn(C,F+2)<<16}function it(C,F){var Y=1<<F;return e(C!=null),e(0<F),C.X=u(Y),C.X==null?0:(C.Mb=32-F,C.Xa=F,1)}function ur(C,F){e(C!=null),e(F!=null),e(C.Xa==F.Xa),i(F.X,0,C.X,0,1<<F.Xa)}function xr(){this.X=[],this.Xa=this.Mb=0}function Tr(C,F,Y,ie){e(Y!=null),e(ie!=null);var Ce=Y[0],Be=ie[0];return Ce==0&&(Ce=(C*Be+F/2)/F),Be==0&&(Be=(F*Ce+C/2)/C),0>=Ce||0>=Be?0:(Y[0]=Ce,ie[0]=Be,1)}function Tn(C,F){return C+(1<<F)-1>>>F}function Yn(C,F){return((4278255360&C)+(4278255360&F)>>>0&4278255360)+((16711935&C)+(16711935&F)>>>0&16711935)>>>0}function $n(C,F){D[F]=function(Y,ie,Ce,Be,qe,Ke,Je){var dt;for(dt=0;dt<qe;++dt){var Dt=D[C](Ke[Je+dt-1],Ce,Be+dt);Ke[Je+dt]=Yn(Y[ie+dt],Dt)}}}function hr(){this.ud=this.hd=this.jd=0}function Wt(C,F){return((4278124286&(C^F))>>>1)+(C&F)>>>0}function Nn(C){return 0<=C&&256>C?C:0>C?0:255<C?255:void 0}function tr(C,F){return Nn(C+(C-F+.5>>1))}function Hn(C,F,Y){return Math.abs(F-Y)-Math.abs(C-Y)}function Rr(C,F,Y,ie,Ce,Be,qe){for(ie=Be[qe-1],Y=0;Y<Ce;++Y)Be[qe+Y]=ie=Yn(C[F+Y],ie)}function lr(C,F,Y,ie,Ce){var Be;for(Be=0;Be<Y;++Be){var qe=C[F+Be],Ke=qe>>8&255,Je=16711935&(Je=(Je=16711935&qe)+((Ke<<16)+Ke));ie[Ce+Be]=(4278255360&qe)+Je>>>0}}function wr(C,F){F.jd=255&C,F.hd=C>>8&255,F.ud=C>>16&255}function br(C,F,Y,ie,Ce,Be){var qe;for(qe=0;qe<ie;++qe){var Ke=F[Y+qe],Je=Ke>>>8,dt=Ke,Dt=255&(Dt=(Dt=Ke>>>16)+((C.jd<<24>>24)*(Je<<24>>24)>>>5));dt=255&(dt=(dt+=(C.hd<<24>>24)*(Je<<24>>24)>>>5)+((C.ud<<24>>24)*(Dt<<24>>24)>>>5)),Ce[Be+qe]=(4278255360&Ke)+(Dt<<16)+dt}}function Ir(C,F,Y,ie,Ce){D[F]=function(Be,qe,Ke,Je,dt,Dt,Qt,ft,Ot){for(Je=Qt;Je<ft;++Je)for(Qt=0;Qt<Ot;++Qt)dt[Dt++]=Ce(Ke[ie(Be[qe++])])},D[C]=function(Be,qe,Ke,Je,dt,Dt,Qt){var ft=8>>Be.b,Ot=Be.Ea,Kt=Be.K[0],Sn=Be.w;if(8>ft)for(Be=(1<<Be.b)-1,Sn=(1<<ft)-1;qe<Ke;++qe){var y,a=0;for(y=0;y<Ot;++y)y&Be||(a=ie(Je[dt++])),Dt[Qt++]=Ce(Kt[a&Sn]),a>>=ft}else D["VP8LMapColor"+Y](Je,dt,Kt,Sn,Dt,Qt,qe,Ke,Ot)}}function Bi(C,F,Y,ie,Ce){for(Y=F+Y;F<Y;){var Be=C[F++];ie[Ce++]=Be>>16&255,ie[Ce++]=Be>>8&255,ie[Ce++]=255&Be}}function Mi(C,F,Y,ie,Ce){for(Y=F+Y;F<Y;){var Be=C[F++];ie[Ce++]=Be>>16&255,ie[Ce++]=Be>>8&255,ie[Ce++]=255&Be,ie[Ce++]=Be>>24&255}}function pr(C,F,Y,ie,Ce){for(Y=F+Y;F<Y;){var Be=(qe=C[F++])>>16&240|qe>>12&15,qe=240&qe|qe>>28&15;ie[Ce++]=Be,ie[Ce++]=qe}}function Jr(C,F,Y,ie,Ce){for(Y=F+Y;F<Y;){var Be=(qe=C[F++])>>16&248|qe>>13&7,qe=qe>>5&224|qe>>3&31;ie[Ce++]=Be,ie[Ce++]=qe}}function Kr(C,F,Y,ie,Ce){for(Y=F+Y;F<Y;){var Be=C[F++];ie[Ce++]=255&Be,ie[Ce++]=Be>>8&255,ie[Ce++]=Be>>16&255}}function Sr(C,F,Y,ie,Ce,Be){if(Be==0)for(Y=F+Y;F<Y;)tn(ie,((Be=C[F++])[0]>>24|Be[1]>>8&65280|Be[2]<<8&16711680|Be[3]<<24)>>>0),Ce+=32;else i(ie,Ce,C,F,Y)}function ui(C,F){D[F][0]=D[C+"0"],D[F][1]=D[C+"1"],D[F][2]=D[C+"2"],D[F][3]=D[C+"3"],D[F][4]=D[C+"4"],D[F][5]=D[C+"5"],D[F][6]=D[C+"6"],D[F][7]=D[C+"7"],D[F][8]=D[C+"8"],D[F][9]=D[C+"9"],D[F][10]=D[C+"10"],D[F][11]=D[C+"11"],D[F][12]=D[C+"12"],D[F][13]=D[C+"13"],D[F][14]=D[C+"0"],D[F][15]=D[C+"0"]}function ii(C){return C==kc||C==Vi||C==lc||C==cc}function ut(){this.eb=[],this.size=this.A=this.fb=0}function we(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Ie(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new ut,this.f.kb=new we,this.sd=null}function Ye(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function ct(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Ct(C){return alert("todo:WebPSamplerProcessPlane"),C.T}function Rt(C,F){var Y=C.T,ie=F.ba.f.RGBA,Ce=ie.eb,Be=ie.fb+C.ka*ie.A,qe=qa[F.ba.S],Ke=C.y,Je=C.O,dt=C.f,Dt=C.N,Qt=C.ea,ft=C.W,Ot=F.cc,Kt=F.dc,Sn=F.Mc,y=F.Nc,a=C.ka,f=C.ka+C.T,v=C.U,S=v+1>>1;for(a==0?qe(Ke,Je,null,null,dt,Dt,Qt,ft,dt,Dt,Qt,ft,Ce,Be,null,null,v):(qe(F.ec,F.fc,Ke,Je,Ot,Kt,Sn,y,dt,Dt,Qt,ft,Ce,Be-ie.A,Ce,Be,v),++Y);a+2<f;a+=2)Ot=dt,Kt=Dt,Sn=Qt,y=ft,Dt+=C.Rc,ft+=C.Rc,Be+=2*ie.A,qe(Ke,(Je+=2*C.fa)-C.fa,Ke,Je,Ot,Kt,Sn,y,dt,Dt,Qt,ft,Ce,Be-ie.A,Ce,Be,v);return Je+=C.fa,C.j+f<C.o?(i(F.ec,F.fc,Ke,Je,v),i(F.cc,F.dc,dt,Dt,S),i(F.Mc,F.Nc,Qt,ft,S),Y--):1&f||qe(Ke,Je,null,null,dt,Dt,Qt,ft,dt,Dt,Qt,ft,Ce,Be+ie.A,null,null,v),Y}function Bt(C,F,Y){var ie=C.F,Ce=[C.J];if(ie!=null){var Be=C.U,qe=F.ba.S,Ke=qe==Aa||qe==lc;F=F.ba.f.RGBA;var Je=[0],dt=C.ka;Je[0]=C.T,C.Kb&&(dt==0?--Je[0]:(--dt,Ce[0]-=C.width),C.j+C.ka+C.T==C.o&&(Je[0]=C.o-C.j-dt));var Dt=F.eb;dt=F.fb+dt*F.A,C=Iu(ie,Ce[0],C.width,Be,Je,Dt,dt+(Ke?0:3),F.A),e(Y==Je),C&&ii(qe)&&ga(Dt,dt,Ke,Be,Je,F.A)}return 0}function St(C){var F=C.ma,Y=F.ba.S,ie=11>Y,Ce=Y==rs||Y==Pc||Y==Aa||Y==Co||Y==12||ii(Y);if(F.memory=null,F.Ib=null,F.Jb=null,F.Nd=null,!Ua(F.Oa,C,Ce?11:12))return 0;if(Ce&&ii(Y)&&Ja(),C.da)alert("todo:use_scaling");else{if(ie){if(F.Ib=Ct,C.Kb){if(Y=C.U+1>>1,F.memory=u(C.U+2*Y),F.memory==null)return 0;F.ec=F.memory,F.fc=0,F.cc=F.ec,F.dc=F.fc+C.U,F.Mc=F.cc,F.Nc=F.dc+Y,F.Ib=Rt,Ja()}}else alert("todo:EmitYUV");Ce&&(F.Jb=Bt,ie&&zo())}if(ie&&!va){for(C=0;256>C;++C)Is[C]=89858*(C-128)+Nc>>nu,Pl[C]=-22014*(C-128)+Nc,$a[C]=-45773*(C-128),Xl[C]=113618*(C-128)+Nc>>nu;for(C=Lo;C<Xi;++C)F=76283*(C-16)+Nc>>nu,sd[C-Lo]=Qr(F,255),Ga[C-Lo]=Qr(F+8>>4,15);va=1}return 1}function Mt(C){var F=C.ma,Y=C.U,ie=C.T;return e(!(1&C.ka)),0>=Y||0>=ie?0:(Y=F.Ib(C,F),F.Jb!=null&&F.Jb(C,F,Y),F.Dc+=Y,1)}function vn(C){C.ma.memory=null}function Bn(C,F,Y,ie){return xe(C,8)!=47?0:(F[0]=xe(C,14)+1,Y[0]=xe(C,14)+1,ie[0]=xe(C,1),xe(C,3)!=0?0:!C.h)}function Ln(C,F){if(4>C)return C+1;var Y=C-2>>1;return(2+(1&C)<<Y)+xe(F,Y)+1}function qr(C,F){return 120<F?F-120:1<=(Y=((Y=ya[F-1])>>4)*C+(8-(15&Y)))?Y:1;var Y}function Cr(C,F,Y){var ie=Fe(Y),Ce=C[F+=255&ie].g-8;return 0<Ce&&(et(Y,Y.u+8),ie=Fe(Y),F+=C[F].value,F+=ie&(1<<Ce)-1),et(Y,Y.u+C[F].g),C[F].value}function Ar(C,F,Y){return Y.g+=C.g,Y.value+=C.value<<F>>>0,e(8>=Y.g),C.g}function Dr(C,F,Y){var ie=C.xc;return e((F=ie==0?0:C.vc[C.md*(Y>>ie)+(F>>ie)])<C.Wb),C.Ya[F]}function _i(C,F,Y,ie){var Ce=C.ab,Be=C.c*F,qe=C.C;F=qe+F;var Ke=Y,Je=ie;for(ie=C.Ta,Y=C.Ua;0<Ce--;){var dt=C.gc[Ce],Dt=qe,Qt=F,ft=Ke,Ot=Je,Kt=(Je=ie,Ke=Y,dt.Ea);switch(e(Dt<Qt),e(Qt<=dt.nc),dt.hc){case 2:Ks(ft,Ot,(Qt-Dt)*Kt,Je,Ke);break;case 0:var Sn=Dt,y=Qt,a=Je,f=Ke,v=(G=dt).Ea;Sn==0&&(el(ft,Ot,null,null,1,a,f),Rr(ft,Ot+1,0,0,v-1,a,f+1),Ot+=v,f+=v,++Sn);for(var S=1<<G.b,T=S-1,R=Tn(v,G.b),B=G.K,G=G.w+(Sn>>G.b)*R;Sn<y;){var J=B,ee=G,me=1;for(tl(ft,Ot,a,f-v,1,a,f);me<v;){var Ae=(me&~T)+S;Ae>v&&(Ae=v),(0,lu[J[ee++]>>8&15])(ft,Ot+ +me,a,f+me-v,Ae-me,a,f+me),me=Ae}Ot+=v,f+=v,++Sn&T||(G+=R)}Qt!=dt.nc&&i(Je,Ke-Kt,Je,Ke+(Qt-Dt-1)*Kt,Kt);break;case 1:for(Kt=ft,y=Ot,v=(ft=dt.Ea)-(f=ft&~(a=(Ot=1<<dt.b)-1)),Sn=Tn(ft,dt.b),S=dt.K,dt=dt.w+(Dt>>dt.b)*Sn;Dt<Qt;){for(T=S,R=dt,B=new hr,G=y+f,J=y+ft;y<G;)wr(T[R++],B),Yc(B,Kt,y,Ot,Je,Ke),y+=Ot,Ke+=Ot;y<J&&(wr(T[R++],B),Yc(B,Kt,y,v,Je,Ke),y+=v,Ke+=v),++Dt&a||(dt+=Sn)}break;case 3:if(ft==Je&&Ot==Ke&&0<dt.b){for(y=Je,ft=Kt=Ke+(Qt-Dt)*Kt-(f=(Qt-Dt)*Tn(dt.Ea,dt.b)),Ot=Je,a=Ke,Sn=[],f=(v=f)-1;0<=f;--f)Sn[f]=Ot[a+f];for(f=v-1;0<=f;--f)y[ft+f]=Sn[f];Ic(dt,Dt,Qt,Je,Kt,Je,Ke)}else Ic(dt,Dt,Qt,ft,Ot,Je,Ke)}Ke=ie,Je=Y}Je!=Y&&i(ie,Y,Ke,Je,Be)}function ko(C,F){var Y=C.V,ie=C.Ba+C.c*C.C,Ce=F-C.C;if(e(F<=C.l.o),e(16>=Ce),0<Ce){var Be=C.l,qe=C.Ta,Ke=C.Ua,Je=Be.width;if(_i(C,Ce,Y,ie),Ce=Ke=[Ke],e((Y=C.C)<(ie=F)),e(Be.v<Be.va),ie>Be.o&&(ie=Be.o),Y<Be.j){var dt=Be.j-Y;Y=Be.j,Ce[0]+=dt*Je}if(Y>=ie?Y=0:(Ce[0]+=4*Be.v,Be.ka=Y-Be.j,Be.U=Be.va-Be.v,Be.T=ie-Y,Y=1),Y){if(Ke=Ke[0],11>(Y=C.ca).S){var Dt=Y.f.RGBA,Qt=(ie=Y.S,Ce=Be.U,Be=Be.T,dt=Dt.eb,Dt.A),ft=Be;for(Dt=Dt.fb+C.Ma*Dt.A;0<ft--;){var Ot=qe,Kt=Ke,Sn=Ce,y=dt,a=Dt;switch(ie){case vh:cu(Ot,Kt,Sn,y,a);break;case rs:Lc(Ot,Kt,Sn,y,a);break;case kc:Lc(Ot,Kt,Sn,y,a),ga(y,a,0,Sn,1,0);break;case rl:Qc(Ot,Kt,Sn,y,a);break;case Pc:Sr(Ot,Kt,Sn,y,a,1);break;case Vi:Sr(Ot,Kt,Sn,y,a,1),ga(y,a,0,Sn,1,0);break;case Aa:Sr(Ot,Kt,Sn,y,a,0);break;case lc:Sr(Ot,Kt,Sn,y,a,0),ga(y,a,1,Sn,1,0);break;case Co:Jc(Ot,Kt,Sn,y,a);break;case cc:Jc(Ot,Kt,Sn,y,a),du(y,a,Sn,1,0);break;case Vh:uu(Ot,Kt,Sn,y,a);break;default:e(0)}Ke+=Je,Dt+=Qt}C.Ma+=Be}else alert("todo:EmitRescaledRowsYUVA");e(C.Ma<=Y.height)}}C.C=F,e(C.C<=C.i)}function ro(C){var F;if(0<C.ua)return 0;for(F=0;F<C.Wb;++F){var Y=C.Ya[F].G,ie=C.Ya[F].H;if(0<Y[1][ie[1]+0].g||0<Y[2][ie[2]+0].g||0<Y[3][ie[3]+0].g)return 0}return 1}function os(C,F,Y,ie,Ce,Be){if(C.Z!=0){var qe=C.qd,Ke=C.rd;for(e(_a[C.Z]!=null);F<Y;++F)_a[C.Z](qe,Ke,ie,Ce,ie,Ce,Be),qe=ie,Ke=Ce,Ce+=Be;C.qd=qe,C.rd=Ke}}function Ji(C,F){var Y=C.l.ma,ie=Y.Z==0||Y.Z==1?C.l.j:C.C;if(ie=C.C<ie?ie:C.C,e(F<=C.l.o),F>ie){var Ce=C.l.width,Be=Y.ca,qe=Y.tb+Ce*ie,Ke=C.V,Je=C.Ba+C.c*ie,dt=C.gc;e(C.ab==1),e(dt[0].hc==3),ql(dt[0],ie,F,Ke,Je,Be,qe),os(Y,ie,F,Be,qe,Ce)}C.C=C.Ma=F}function Yo(C,F,Y,ie,Ce,Be,qe){var Ke=C.$/ie,Je=C.$%ie,dt=C.m,Dt=C.s,Qt=Y+C.$,ft=Qt;Ce=Y+ie*Ce;var Ot=Y+ie*Be,Kt=280+Dt.ua,Sn=C.Pb?Ke:16777216,y=0<Dt.ua?Dt.Wa:null,a=Dt.wc,f=Qt<Ot?Dr(Dt,Je,Ke):null;e(C.C<Be),e(Ot<=Ce);var v=!1;e:for(;;){for(;v||Qt<Ot;){var S=0;if(Ke>=Sn){var T=Qt-Y;e((Sn=C).Pb),Sn.wd=Sn.m,Sn.xd=T,0<Sn.s.ua&&ur(Sn.s.Wa,Sn.s.vb),Sn=Ke+Mc}if(Je&a||(f=Dr(Dt,Je,Ke)),e(f!=null),f.Qb&&(F[Qt]=f.qb,v=!0),!v)if(mt(dt),f.jc){S=dt,T=F;var R=Qt,B=f.pd[Fe(S)&Qa-1];e(f.jc),256>B.g?(et(S,S.u+B.g),T[R]=B.value,S=0):(et(S,S.u+B.g-256),e(256<=B.value),S=B.value),S==0&&(v=!0)}else S=Cr(f.G[0],f.H[0],dt);if(dt.h)break;if(v||256>S){if(!v)if(f.nd)F[Qt]=(f.qb|S<<8)>>>0;else{if(mt(dt),v=Cr(f.G[1],f.H[1],dt),mt(dt),T=Cr(f.G[2],f.H[2],dt),R=Cr(f.G[3],f.H[3],dt),dt.h)break;F[Qt]=(R<<24|v<<16|S<<8|T)>>>0}if(v=!1,++Qt,++Je>=ie&&(Je=0,++Ke,qe!=null&&Ke<=Be&&!(Ke%16)&&qe(C,Ke),y!=null))for(;ft<Qt;)S=F[ft++],y.X[(506832829*S&4294967295)>>>y.Mb]=S}else if(280>S){if(S=Ln(S-256,dt),T=Cr(f.G[4],f.H[4],dt),mt(dt),T=qr(ie,T=Ln(T,dt)),dt.h)break;if(Qt-Y<T||Ce-Qt<S)break e;for(R=0;R<S;++R)F[Qt+R]=F[Qt+R-T];for(Qt+=S,Je+=S;Je>=ie;)Je-=ie,++Ke,qe!=null&&Ke<=Be&&!(Ke%16)&&qe(C,Ke);if(e(Qt<=Ce),Je&a&&(f=Dr(Dt,Je,Ke)),y!=null)for(;ft<Qt;)S=F[ft++],y.X[(506832829*S&4294967295)>>>y.Mb]=S}else{if(!(S<Kt))break e;for(v=S-280,e(y!=null);ft<Qt;)S=F[ft++],y.X[(506832829*S&4294967295)>>>y.Mb]=S;S=Qt,e(!(v>>>(T=y).Xa)),F[S]=T.X[v],v=!0}v||e(dt.h==Ze(dt))}if(C.Pb&&dt.h&&Qt<Ce)e(C.m.h),C.a=5,C.m=C.wd,C.$=C.xd,0<C.s.ua&&ur(C.s.vb,C.s.Wa);else{if(dt.h)break e;qe?.(C,Ke>Be?Be:Ke),C.a=0,C.$=Qt-Y}return 1}return C.a=3,0}function oo(C){e(C!=null),C.vc=null,C.yc=null,C.Ya=null;var F=C.Wa;F!=null&&(F.X=null),C.vb=null,e(C!=null)}function Jo(){var C=new $r;return C==null?null:(C.a=0,C.xb=uc,ui("Predictor","VP8LPredictors"),ui("Predictor","VP8LPredictors_C"),ui("PredictorAdd","VP8LPredictorsAdd"),ui("PredictorAdd","VP8LPredictorsAdd_C"),Ks=lr,Yc=br,cu=Bi,Lc=Mi,Jc=pr,uu=Jr,Qc=Kr,D.VP8LMapColor32b=Cc,D.VP8LMapColor8b=Zc,C)}function La(C,F,Y,ie,Ce){var Be=1,qe=[C],Ke=[F],Je=ie.m,dt=ie.s,Dt=null,Qt=0;e:for(;;){if(Y)for(;Be&&xe(Je,1);){var ft=qe,Ot=Ke,Kt=ie,Sn=1,y=Kt.m,a=Kt.gc[Kt.ab],f=xe(y,2);if(Kt.Oc&1<<f)Be=0;else{switch(Kt.Oc|=1<<f,a.hc=f,a.Ea=ft[0],a.nc=Ot[0],a.K=[null],++Kt.ab,e(4>=Kt.ab),f){case 0:case 1:a.b=xe(y,3)+2,Sn=La(Tn(a.Ea,a.b),Tn(a.nc,a.b),0,Kt,a.K),a.K=a.K[0];break;case 3:var v,S=xe(y,8)+1,T=16<S?0:4<S?1:2<S?2:3;if(ft[0]=Tn(a.Ea,T),a.b=T,v=Sn=La(S,1,0,Kt,a.K)){var R,B=S,G=a,J=1<<(8>>G.b),ee=u(J);if(ee==null)v=0;else{var me=G.K[0],Ae=G.w;for(ee[0]=G.K[0][0],R=1;R<1*B;++R)ee[R]=Yn(me[Ae+R],ee[R-1]);for(;R<4*J;++R)ee[R]=0;G.K[0]=null,G.K[0]=ee,v=1}}Sn=v;break;case 2:break;default:e(0)}Be=Sn}}if(qe=qe[0],Ke=Ke[0],Be&&xe(Je,1)&&!(Be=1<=(Qt=xe(Je,4))&&11>=Qt)){ie.a=3;break e}var Te;if(Te=Be)t:{var He,je,We,ve=ie,Ue=qe,rt=Ke,st=Qt,bt=Y,wt=ve.m,vt=ve.s,At=[null],kt=1,Vt=0,gn=Na[st];n:for(;;){if(bt&&xe(wt,1)){var Ut=xe(wt,3)+2,un=Tn(Ue,Ut),$t=Tn(rt,Ut),In=un*$t;if(!La(un,$t,0,ve,At))break n;for(At=At[0],vt.xc=Ut,He=0;He<In;++He){var jt=At[He]>>8&65535;At[He]=jt,jt>=kt&&(kt=jt+1)}}if(wt.h)break n;for(je=0;5>je;++je){var sn=Cu[je];!je&&0<st&&(sn+=1<<st),Vt<sn&&(Vt=sn)}var Cn=m(kt*gn,Z),_n=kt,Mn=m(_n,ke);if(Mn==null)var cr=null;else e(65536>=_n),cr=Mn;var kr=u(Vt);if(cr==null||kr==null||Cn==null){ve.a=1;break n}var er=Cn;for(He=We=0;He<kt;++He){var ar=cr[He],Wr=ar.G,hi=ar.H,_r=0,Ti=1,Ii=0;for(je=0;5>je;++je){sn=Cu[je],Wr[je]=er,hi[je]=We,!je&&0<st&&(sn+=1<<st);i:{var yo,co=sn,Js=ve,ps=kr,il=er,Wa=We,Si=0,Ki=Js.m,to=xe(Ki,1);if(c(ps,0,0,co),to){var Qs=xe(Ki,1)+1,ua=xe(Ki,1),Wo=xe(Ki,ua==0?1:8);ps[Wo]=1,Qs==2&&(ps[Wo=xe(Ki,8)]=1);var vs=1}else{var Fo=u(19),xs=xe(Ki,4)+4;if(19<xs){Js.a=3;var Cs=0;break i}for(yo=0;yo<xs;++yo)Fo[qh[yo]]=xe(Ki,3);var Kl=void 0,ol=void 0,hc=Js,ad=Fo,ea=co,wh=ps,ld=0,Pu=hc.m,ku=8,dc=m(128,Z);r:for(;W(dc,0,7,ad,19);){if(xe(Pu,1)){var mu=2+2*xe(Pu,3);if((Kl=2+xe(Pu,mu))>ea)break r}else Kl=ea;for(ol=0;ol<ea&&Kl--;){mt(Pu);var cd=dc[0+(127&Fe(Pu))];et(Pu,Pu.u+cd.g);var Mu=cd.value;if(16>Mu)wh[ol++]=Mu,Mu!=0&&(ku=Mu);else{var ud=Mu==16,Ru=Mu-16,Cd=go[Ru],Ld=xe(Pu,or[Ru])+Cd;if(ol+Ld>ea)break r;for(var Of=ud?ku:0;0<Ld--;)wh[ol++]=Of}}ld=1;break r}ld||(hc.a=3),vs=ld}(vs=vs&&!Ki.h)&&(Si=W(il,Wa,8,ps,co)),vs&&Si!=0?Cs=Si:(Js.a=3,Cs=0)}if(Cs==0)break n;if(Ti&&Lu[je]==1&&(Ti=er[We].g==0),_r+=er[We].g,We+=Cs,3>=je){var Gh,Mh=kr[0];for(Gh=1;Gh<sn;++Gh)kr[Gh]>Mh&&(Mh=kr[Gh]);Ii+=Mh}}if(ar.nd=Ti,ar.Qb=0,Ti&&(ar.qb=(Wr[3][hi[3]+0].value<<24|Wr[1][hi[1]+0].value<<16|Wr[2][hi[2]+0].value)>>>0,_r==0&&256>Wr[0][hi[0]+0].value&&(ar.Qb=1,ar.qb+=Wr[0][hi[0]+0].value<<8)),ar.jc=!ar.Qb&&6>Ii,ar.jc){var Pd,fc=ar;for(Pd=0;Pd<Qa;++Pd){var Fc=Pd,Zl=fc.pd[Fc],pc=fc.G[0][fc.H[0]+Fc];256<=pc.value?(Zl.g=pc.g+256,Zl.value=pc.value):(Zl.g=0,Zl.value=0,Fc>>=Ar(pc,8,Zl),Fc>>=Ar(fc.G[1][fc.H[1]+Fc],16,Zl),Fc>>=Ar(fc.G[2][fc.H[2]+Fc],0,Zl),Ar(fc.G[3][fc.H[3]+Fc],24,Zl))}}}vt.vc=At,vt.Wb=kt,vt.Ya=cr,vt.yc=Cn,Te=1;break t}Te=0}if(!(Be=Te)){ie.a=3;break e}if(0<Qt){if(dt.ua=1<<Qt,!it(dt.Wa,Qt)){ie.a=1,Be=0;break e}}else dt.ua=0;var Oc=ie,mc=qe,th=Ke,Nu=Oc.s,ef=Nu.xc;if(Oc.c=mc,Oc.i=th,Nu.md=Tn(mc,ef),Nu.wc=ef==0?-1:(1<<ef)-1,Y){ie.xb=yl;break e}if((Dt=u(qe*Ke))==null){ie.a=1,Be=0;break e}Be=(Be=Yo(ie,Dt,0,qe,Ke,Ke,null))&&!Je.h;break e}return Be?(Ce!=null?Ce[0]=Dt:(e(Dt==null),e(Y)),ie.$=0,Y||oo(dt)):oo(dt),Be}function zl(C,F){var Y=C.c*C.i,ie=Y+F+16*F;return e(C.c<=F),C.V=u(ie),C.V==null?(C.Ta=null,C.Ua=0,C.a=1,0):(C.Ta=C.V,C.Ua=C.Ba+Y+F,1)}function jl(C,F){var Y=C.C,ie=F-Y,Ce=C.V,Be=C.Ba+C.c*Y;for(e(F<=C.l.o);0<ie;){var qe=16<ie?16:ie,Ke=C.l.ma,Je=C.l.width,dt=Je*qe,Dt=Ke.ca,Qt=Ke.tb+Je*Y,ft=C.Ta,Ot=C.Ua;_i(C,qe,Ce,Be),Ai(ft,Ot,Dt,Qt,dt),os(Ke,Y,Y+qe,Dt,Qt,Je),ie-=qe,Ce+=qe*C.c,Y+=qe}e(Y==F),C.C=C.Ma=F}function Fi(){this.ub=this.yd=this.td=this.Rb=0}function nc(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Hc(){this.Fb=this.Bb=this.Cb=0,this.Zb=u(4),this.Lb=u(4)}function Oi(){this.Yb=(function(){var C=[];return(function F(Y,ie,Ce){for(var Be=Ce[ie],qe=0;qe<Be&&(Y.push(Ce.length>ie+1?[]:0),!(Ce.length<ie+1));qe++)F(Y[qe],ie+1,Ce)})(C,0,[3,11]),C})()}function Sc(){this.jb=u(3),this.Wc=_([4,8],Oi),this.Xc=_([4,17],Oi)}function Pa(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new u(4),this.od=new u(4)}function Qo(){this.ld=this.La=this.dd=this.tc=0}function Sa(){this.Na=this.la=0}function Ec(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function hl(){this.ad=u(384),this.Za=0,this.Ob=u(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Ea(){this.uc=this.M=this.Nb=0,this.wa=Array(new Qo),this.Y=0,this.ya=Array(new hl),this.aa=0,this.l=new ss}function Ro(){this.y=u(16),this.f=u(8),this.ea=u(8)}function pn(){this.cb=this.a=0,this.sc="",this.m=new ae,this.Od=new Fi,this.Kc=new nc,this.ed=new Pa,this.Qa=new Hc,this.Ic=this.$c=this.Aa=0,this.D=new Ea,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=m(8,ae),this.ia=0,this.pb=m(4,Ec),this.Pa=new Sc,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Ro),this.Hd=0,this.rb=Array(new Sa),this.sb=0,this.wa=Array(new Qo),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new hl),this.L=this.aa=0,this.gd=_([4,2],Qo),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function ss(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function as(){var C=new pn;return C!=null&&(C.a=0,C.sc="OK",C.cb=0,C.Xb=0,gl||(gl=Za)),C}function Qi(C,F,Y){return C.a==0&&(C.a=F,C.sc=Y,C.cb=0),0}function Au(C,F,Y){return 3<=Y&&C[F+0]==157&&C[F+1]==1&&C[F+2]==42}function ka(C,F){if(C==null)return 0;if(C.a=0,C.sc="OK",F==null)return Qi(C,2,"null VP8Io passed to VP8GetHeaders()");var Y=F.data,ie=F.w,Ce=F.ha;if(4>Ce)return Qi(C,7,"Truncated header.");var Be=Y[ie+0]|Y[ie+1]<<8|Y[ie+2]<<16,qe=C.Od;if(qe.Rb=!(1&Be),qe.td=Be>>1&7,qe.yd=Be>>4&1,qe.ub=Be>>5,3<qe.td)return Qi(C,3,"Incorrect keyframe parameters.");if(!qe.yd)return Qi(C,4,"Frame not displayable.");ie+=3,Ce-=3;var Ke=C.Kc;if(qe.Rb){if(7>Ce)return Qi(C,7,"cannot parse picture header");if(!Au(Y,ie,Ce))return Qi(C,3,"Bad code word");Ke.c=16383&(Y[ie+4]<<8|Y[ie+3]),Ke.Td=Y[ie+4]>>6,Ke.i=16383&(Y[ie+6]<<8|Y[ie+5]),Ke.Ud=Y[ie+6]>>6,ie+=7,Ce-=7,C.za=Ke.c+15>>4,C.Ub=Ke.i+15>>4,F.width=Ke.c,F.height=Ke.i,F.Da=0,F.j=0,F.v=0,F.va=F.width,F.o=F.height,F.da=0,F.ib=F.width,F.hb=F.height,F.U=F.width,F.T=F.height,c((Be=C.Pa).jb,0,255,Be.jb.length),e((Be=C.Qa)!=null),Be.Cb=0,Be.Bb=0,Be.Fb=1,c(Be.Zb,0,0,Be.Zb.length),c(Be.Lb,0,0,Be.Lb)}if(qe.ub>Ce)return Qi(C,7,"bad partition length");Oe(Be=C.m,Y,ie,qe.ub),ie+=qe.ub,Ce-=qe.ub,qe.Rb&&(Ke.Ld=Nt(Be),Ke.Kd=Nt(Be)),Ke=C.Qa;var Je,dt=C.Pa;if(e(Be!=null),e(Ke!=null),Ke.Cb=Nt(Be),Ke.Cb){if(Ke.Bb=Nt(Be),Nt(Be)){for(Ke.Fb=Nt(Be),Je=0;4>Je;++Je)Ke.Zb[Je]=Nt(Be)?be(Be,7):0;for(Je=0;4>Je;++Je)Ke.Lb[Je]=Nt(Be)?be(Be,6):0}if(Ke.Bb)for(Je=0;3>Je;++Je)dt.jb[Je]=Nt(Be)?Re(Be,8):255}else Ke.Bb=0;if(Be.Ka)return Qi(C,3,"cannot parse segment header");if((Ke=C.ed).zd=Nt(Be),Ke.Tb=Re(Be,6),Ke.wb=Re(Be,3),Ke.Pc=Nt(Be),Ke.Pc&&Nt(Be)){for(dt=0;4>dt;++dt)Nt(Be)&&(Ke.vd[dt]=be(Be,6));for(dt=0;4>dt;++dt)Nt(Be)&&(Ke.od[dt]=be(Be,6))}if(C.L=Ke.Tb==0?0:Ke.zd?1:2,Be.Ka)return Qi(C,3,"cannot parse filter header");var Dt=Ce;if(Ce=Je=ie,ie=Je+Dt,Ke=Dt,C.Xb=(1<<Re(C.m,2))-1,Dt<3*(dt=C.Xb))Y=7;else{for(Je+=3*dt,Ke-=3*dt,Dt=0;Dt<dt;++Dt){var Qt=Y[Ce+0]|Y[Ce+1]<<8|Y[Ce+2]<<16;Qt>Ke&&(Qt=Ke),Oe(C.Jc[+Dt],Y,Je,Qt),Je+=Qt,Ke-=Qt,Ce+=3}Oe(C.Jc[+dt],Y,Je,Ke),Y=Je<ie?0:5}if(Y!=0)return Qi(C,Y,"cannot parse partitions");for(Y=Re(Je=C.m,7),Ce=Nt(Je)?be(Je,4):0,ie=Nt(Je)?be(Je,4):0,Ke=Nt(Je)?be(Je,4):0,dt=Nt(Je)?be(Je,4):0,Je=Nt(Je)?be(Je,4):0,Dt=C.Qa,Qt=0;4>Qt;++Qt){if(Dt.Cb){var ft=Dt.Zb[Qt];Dt.Fb||(ft+=Y)}else{if(0<Qt){C.pb[Qt]=C.pb[0];continue}ft=Y}var Ot=C.pb[Qt];Ot.Sc[0]=Yu[Qr(ft+Ce,127)],Ot.Sc[1]=tu[Qr(ft+0,127)],Ot.Eb[0]=2*Yu[Qr(ft+ie,127)],Ot.Eb[1]=101581*tu[Qr(ft+Ke,127)]>>16,8>Ot.Eb[1]&&(Ot.Eb[1]=8),Ot.Qc[0]=Yu[Qr(ft+dt,117)],Ot.Qc[1]=tu[Qr(ft+Je,127)],Ot.lc=ft+Je}if(!qe.Rb)return Qi(C,4,"Not a key frame.");for(Nt(Be),qe=C.Pa,Y=0;4>Y;++Y){for(Ce=0;8>Ce;++Ce)for(ie=0;3>ie;++ie)for(Ke=0;11>Ke;++Ke)dt=Jt(Be,xh[Y][Ce][ie][Ke])?Re(Be,8):Qu[Y][Ce][ie][Ke],qe.Wc[Y][Ce].Yb[ie][Ke]=dt;for(Ce=0;17>Ce;++Ce)qe.Xc[Y][Ce]=qe.Wc[Y][Lh[Ce]]}return C.kc=Nt(Be),C.kc&&(C.Bd=Re(Be,8)),C.cb=1}function Za(C,F,Y,ie,Ce,Be,qe){var Ke=F[Ce].Yb[Y];for(Y=0;16>Ce;++Ce){if(!Jt(C,Ke[Y+0]))return Ce;for(;!Jt(C,Ke[Y+1]);)if(Ke=F[++Ce].Yb[0],Y=0,Ce==16)return 16;var Je=F[Ce+1].Yb;if(Jt(C,Ke[Y+2])){var dt=C,Dt=0;if(Jt(dt,(ft=Ke)[(Qt=Y)+3]))if(Jt(dt,ft[Qt+6])){for(Ke=0,Qt=2*(Dt=Jt(dt,ft[Qt+8]))+(ft=Jt(dt,ft[Qt+9+Dt])),Dt=0,ft=Ju[Qt];ft[Ke];++Ke)Dt+=Dt+Jt(dt,ft[Ke]);Dt+=3+(8<<Qt)}else Jt(dt,ft[Qt+7])?(Dt=7+2*Jt(dt,165),Dt+=Jt(dt,145)):Dt=5+Jt(dt,159);else Dt=Jt(dt,ft[Qt+4])?3+Jt(dt,ft[Qt+5]):2;Ke=Je[2]}else Dt=1,Ke=Je[1];Je=qe+pu[Ce],0>(dt=C).b&&ht(dt);var Qt,ft=dt.b,Ot=(Qt=dt.Ca>>1)-(dt.I>>ft)>>31;--dt.b,dt.Ca+=Ot,dt.Ca|=1,dt.I-=(Qt+1&Ot)<<ft,Be[Je]=((Dt^Ot)-Ot)*ie[(0<Ce)+0]}return 16}function ls(C){var F=C.rb[C.sb-1];F.la=0,F.Na=0,c(C.zc,0,0,C.zc.length),C.ja=0}function Us(C,F,Y,ie,Ce){Ce=C[F+Y+32*ie]+(Ce>>3),C[F+Y+32*ie]=-256&Ce?0>Ce?0:255:Ce}function Qn(C,F,Y,ie,Ce,Be){Us(C,F,0,Y,ie+Ce),Us(C,F,1,Y,ie+Be),Us(C,F,2,Y,ie-Be),Us(C,F,3,Y,ie-Ce)}function Fr(C){return(20091*C>>16)+C}function ei(C,F,Y,ie){var Ce,Be=0,qe=u(16);for(Ce=0;4>Ce;++Ce){var Ke=C[F+0]+C[F+8],Je=C[F+0]-C[F+8],dt=(35468*C[F+4]>>16)-Fr(C[F+12]),Dt=Fr(C[F+4])+(35468*C[F+12]>>16);qe[Be+0]=Ke+Dt,qe[Be+1]=Je+dt,qe[Be+2]=Je-dt,qe[Be+3]=Ke-Dt,Be+=4,F++}for(Ce=Be=0;4>Ce;++Ce)Ke=(C=qe[Be+0]+4)+qe[Be+8],Je=C-qe[Be+8],dt=(35468*qe[Be+4]>>16)-Fr(qe[Be+12]),Us(Y,ie,0,0,Ke+(Dt=Fr(qe[Be+4])+(35468*qe[Be+12]>>16))),Us(Y,ie,1,0,Je+dt),Us(Y,ie,2,0,Je-dt),Us(Y,ie,3,0,Ke-Dt),Be++,ie+=32}function aa(C,F,Y,ie){var Ce=C[F+0]+4,Be=35468*C[F+4]>>16,qe=Fr(C[F+4]),Ke=35468*C[F+1]>>16;Qn(Y,ie,0,Ce+qe,C=Fr(C[F+1]),Ke),Qn(Y,ie,1,Ce+Be,C,Ke),Qn(Y,ie,2,Ce-Be,C,Ke),Qn(Y,ie,3,Ce-qe,C,Ke)}function fa(C,F,Y,ie,Ce){ei(C,F,Y,ie),Ce&&ei(C,F+16,Y,ie+4)}function vi(C,F,Y,ie){Gl(C,F+0,Y,ie,1),Gl(C,F+32,Y,ie+128,1)}function Lr(C,F,Y,ie){var Ce;for(C=C[F+0]+4,Ce=0;4>Ce;++Ce)for(F=0;4>F;++F)Us(Y,ie,F,Ce,C)}function dl(C,F,Y,ie){C[F+0]&&Li(C,F+0,Y,ie),C[F+16]&&Li(C,F+16,Y,ie+4),C[F+32]&&Li(C,F+32,Y,ie+128),C[F+48]&&Li(C,F+48,Y,ie+128+4)}function zi(C,F,Y,ie){var Ce,Be=u(16);for(Ce=0;4>Ce;++Ce){var qe=C[F+0+Ce]+C[F+12+Ce],Ke=C[F+4+Ce]+C[F+8+Ce],Je=C[F+4+Ce]-C[F+8+Ce],dt=C[F+0+Ce]-C[F+12+Ce];Be[0+Ce]=qe+Ke,Be[8+Ce]=qe-Ke,Be[4+Ce]=dt+Je,Be[12+Ce]=dt-Je}for(Ce=0;4>Ce;++Ce)qe=(C=Be[0+4*Ce]+3)+Be[3+4*Ce],Ke=Be[1+4*Ce]+Be[2+4*Ce],Je=Be[1+4*Ce]-Be[2+4*Ce],dt=C-Be[3+4*Ce],Y[ie+0]=qe+Ke>>3,Y[ie+16]=dt+Je>>3,Y[ie+32]=qe-Ke>>3,Y[ie+48]=dt-Je>>3,ie+=64}function es(C,F,Y){var ie,Ce=F-32,Be=Ui,qe=255-C[Ce-1];for(ie=0;ie<Y;++ie){var Ke,Je=Be,dt=qe+C[F-1];for(Ke=0;Ke<Y;++Ke)C[F+Ke]=Je[dt+C[Ce+Ke]];F+=32}}function _o(C,F){es(C,F,4)}function Tu(C,F){es(C,F,8)}function Sl(C,F){es(C,F,16)}function Ac(C,F){var Y;for(Y=0;16>Y;++Y)i(C,F+32*Y,C,F-32,16)}function rc(C,F){var Y;for(Y=16;0<Y;--Y)c(C,F,C[F-1],16),F+=32}function El(C,F,Y){var ie;for(ie=0;16>ie;++ie)c(F,Y+32*ie,C,16)}function Mo(C,F){var Y,ie=16;for(Y=0;16>Y;++Y)ie+=C[F-1+32*Y]+C[F+Y-32];El(ie>>5,C,F)}function ys(C,F){var Y,ie=8;for(Y=0;16>Y;++Y)ie+=C[F-1+32*Y];El(ie>>4,C,F)}function Ps(C,F){var Y,ie=8;for(Y=0;16>Y;++Y)ie+=C[F+Y-32];El(ie>>4,C,F)}function ja(C,F){El(128,C,F)}function oi(C,F,Y){return C+2*F+Y+2>>2}function ts(C,F){var Y,ie=F-32;for(ie=new Uint8Array([oi(C[ie-1],C[ie+0],C[ie+1]),oi(C[ie+0],C[ie+1],C[ie+2]),oi(C[ie+1],C[ie+2],C[ie+3]),oi(C[ie+2],C[ie+3],C[ie+4])]),Y=0;4>Y;++Y)i(C,F+32*Y,ie,0,ie.length)}function No(C,F){var Y=C[F-1],ie=C[F-1+32],Ce=C[F-1+64],Be=C[F-1+96];tn(C,F+0,16843009*oi(C[F-1-32],Y,ie)),tn(C,F+32,16843009*oi(Y,ie,Ce)),tn(C,F+64,16843009*oi(ie,Ce,Be)),tn(C,F+96,16843009*oi(Ce,Be,Be))}function Xu(C,F){var Y,ie=4;for(Y=0;4>Y;++Y)ie+=C[F+Y-32]+C[F-1+32*Y];for(ie>>=3,Y=0;4>Y;++Y)c(C,F+32*Y,ie,4)}function Ul(C,F){var Y=C[F-1+0],ie=C[F-1+32],Ce=C[F-1+64],Be=C[F-1-32],qe=C[F+0-32],Ke=C[F+1-32],Je=C[F+2-32],dt=C[F+3-32];C[F+0+96]=oi(ie,Ce,C[F-1+96]),C[F+1+96]=C[F+0+64]=oi(Y,ie,Ce),C[F+2+96]=C[F+1+64]=C[F+0+32]=oi(Be,Y,ie),C[F+3+96]=C[F+2+64]=C[F+1+32]=C[F+0+0]=oi(qe,Be,Y),C[F+3+64]=C[F+2+32]=C[F+1+0]=oi(Ke,qe,Be),C[F+3+32]=C[F+2+0]=oi(Je,Ke,qe),C[F+3+0]=oi(dt,Je,Ke)}function Ao(C,F){var Y=C[F+1-32],ie=C[F+2-32],Ce=C[F+3-32],Be=C[F+4-32],qe=C[F+5-32],Ke=C[F+6-32],Je=C[F+7-32];C[F+0+0]=oi(C[F+0-32],Y,ie),C[F+1+0]=C[F+0+32]=oi(Y,ie,Ce),C[F+2+0]=C[F+1+32]=C[F+0+64]=oi(ie,Ce,Be),C[F+3+0]=C[F+2+32]=C[F+1+64]=C[F+0+96]=oi(Ce,Be,qe),C[F+3+32]=C[F+2+64]=C[F+1+96]=oi(Be,qe,Ke),C[F+3+64]=C[F+2+96]=oi(qe,Ke,Je),C[F+3+96]=oi(Ke,Je,Je)}function Vs(C,F){var Y=C[F-1+0],ie=C[F-1+32],Ce=C[F-1+64],Be=C[F-1-32],qe=C[F+0-32],Ke=C[F+1-32],Je=C[F+2-32],dt=C[F+3-32];C[F+0+0]=C[F+1+64]=Be+qe+1>>1,C[F+1+0]=C[F+2+64]=qe+Ke+1>>1,C[F+2+0]=C[F+3+64]=Ke+Je+1>>1,C[F+3+0]=Je+dt+1>>1,C[F+0+96]=oi(Ce,ie,Y),C[F+0+64]=oi(ie,Y,Be),C[F+0+32]=C[F+1+96]=oi(Y,Be,qe),C[F+1+32]=C[F+2+96]=oi(Be,qe,Ke),C[F+2+32]=C[F+3+96]=oi(qe,Ke,Je),C[F+3+32]=oi(Ke,Je,dt)}function Ku(C,F){var Y=C[F+0-32],ie=C[F+1-32],Ce=C[F+2-32],Be=C[F+3-32],qe=C[F+4-32],Ke=C[F+5-32],Je=C[F+6-32],dt=C[F+7-32];C[F+0+0]=Y+ie+1>>1,C[F+1+0]=C[F+0+64]=ie+Ce+1>>1,C[F+2+0]=C[F+1+64]=Ce+Be+1>>1,C[F+3+0]=C[F+2+64]=Be+qe+1>>1,C[F+0+32]=oi(Y,ie,Ce),C[F+1+32]=C[F+0+96]=oi(ie,Ce,Be),C[F+2+32]=C[F+1+96]=oi(Ce,Be,qe),C[F+3+32]=C[F+2+96]=oi(Be,qe,Ke),C[F+3+64]=oi(qe,Ke,Je),C[F+3+96]=oi(Ke,Je,dt)}function fl(C,F){var Y=C[F-1+0],ie=C[F-1+32],Ce=C[F-1+64],Be=C[F-1+96];C[F+0+0]=Y+ie+1>>1,C[F+2+0]=C[F+0+32]=ie+Ce+1>>1,C[F+2+32]=C[F+0+64]=Ce+Be+1>>1,C[F+1+0]=oi(Y,ie,Ce),C[F+3+0]=C[F+1+32]=oi(ie,Ce,Be),C[F+3+32]=C[F+1+64]=oi(Ce,Be,Be),C[F+3+64]=C[F+2+64]=C[F+0+96]=C[F+1+96]=C[F+2+96]=C[F+3+96]=Be}function To(C,F){var Y=C[F-1+0],ie=C[F-1+32],Ce=C[F-1+64],Be=C[F-1+96],qe=C[F-1-32],Ke=C[F+0-32],Je=C[F+1-32],dt=C[F+2-32];C[F+0+0]=C[F+2+32]=Y+qe+1>>1,C[F+0+32]=C[F+2+64]=ie+Y+1>>1,C[F+0+64]=C[F+2+96]=Ce+ie+1>>1,C[F+0+96]=Be+Ce+1>>1,C[F+3+0]=oi(Ke,Je,dt),C[F+2+0]=oi(qe,Ke,Je),C[F+1+0]=C[F+3+32]=oi(Y,qe,Ke),C[F+1+32]=C[F+3+64]=oi(ie,Y,qe),C[F+1+64]=C[F+3+96]=oi(Ce,ie,Y),C[F+1+96]=oi(Be,Ce,ie)}function vo(C,F){var Y;for(Y=0;8>Y;++Y)i(C,F+32*Y,C,F-32,8)}function Ss(C,F){var Y;for(Y=0;8>Y;++Y)c(C,F,C[F-1],8),F+=32}function Oo(C,F,Y){var ie;for(ie=0;8>ie;++ie)c(F,Y+32*ie,C,8)}function Vo(C,F){var Y,ie=8;for(Y=0;8>Y;++Y)ie+=C[F+Y-32]+C[F-1+32*Y];Oo(ie>>4,C,F)}function Tc(C,F){var Y,ie=4;for(Y=0;8>Y;++Y)ie+=C[F+Y-32];Oo(ie>>3,C,F)}function Bo(C,F){var Y,ie=4;for(Y=0;8>Y;++Y)ie+=C[F-1+32*Y];Oo(ie>>3,C,F)}function Al(C,F){Oo(128,C,F)}function Ma(C,F,Y){var ie=C[F-Y],Ce=C[F+0],Be=3*(Ce-ie)+fu[1020+C[F-2*Y]-C[F+Y]],qe=Zu[112+(Be+4>>3)];C[F-Y]=Ui[255+ie+Zu[112+(Be+3>>3)]],C[F+0]=Ui[255+Ce-qe]}function pl(C,F,Y,ie){var Ce=C[F+0],Be=C[F+Y];return Cl[255+C[F-2*Y]-C[F-Y]]>ie||Cl[255+Be-Ce]>ie}function ic(C,F,Y,ie){return 4*Cl[255+C[F-Y]-C[F+0]]+Cl[255+C[F-2*Y]-C[F+Y]]<=ie}function qs(C,F,Y,ie,Ce){var Be=C[F-3*Y],qe=C[F-2*Y],Ke=C[F-Y],Je=C[F+0],dt=C[F+Y],Dt=C[F+2*Y],Qt=C[F+3*Y];return 4*Cl[255+Ke-Je]+Cl[255+qe-dt]>ie?0:Cl[255+C[F-4*Y]-Be]<=Ce&&Cl[255+Be-qe]<=Ce&&Cl[255+qe-Ke]<=Ce&&Cl[255+Qt-Dt]<=Ce&&Cl[255+Dt-dt]<=Ce&&Cl[255+dt-Je]<=Ce}function $s(C,F,Y,ie){var Ce=2*ie+1;for(ie=0;16>ie;++ie)ic(C,F+ie,Y,Ce)&&Ma(C,F+ie,Y)}function si(C,F,Y,ie){var Ce=2*ie+1;for(ie=0;16>ie;++ie)ic(C,F+ie*Y,1,Ce)&&Ma(C,F+ie*Y,1)}function Gs(C,F,Y,ie){var Ce;for(Ce=3;0<Ce;--Ce)$s(C,F+=4*Y,Y,ie)}function qo(C,F,Y,ie){var Ce;for(Ce=3;0<Ce;--Ce)si(C,F+=4,Y,ie)}function Es(C,F,Y,ie,Ce,Be,qe,Ke){for(Be=2*Be+1;0<Ce--;){if(qs(C,F,Y,Be,qe))if(pl(C,F,Y,Ke))Ma(C,F,Y);else{var Je=C,dt=F,Dt=Y,Qt=Je[dt-2*Dt],ft=Je[dt-Dt],Ot=Je[dt+0],Kt=Je[dt+Dt],Sn=Je[dt+2*Dt],y=27*(f=fu[1020+3*(Ot-ft)+fu[1020+Qt-Kt]])+63>>7,a=18*f+63>>7,f=9*f+63>>7;Je[dt-3*Dt]=Ui[255+Je[dt-3*Dt]+f],Je[dt-2*Dt]=Ui[255+Qt+a],Je[dt-Dt]=Ui[255+ft+y],Je[dt+0]=Ui[255+Ot-y],Je[dt+Dt]=Ui[255+Kt-a],Je[dt+2*Dt]=Ui[255+Sn-f]}F+=ie}}function As(C,F,Y,ie,Ce,Be,qe,Ke){for(Be=2*Be+1;0<Ce--;){if(qs(C,F,Y,Be,qe))if(pl(C,F,Y,Ke))Ma(C,F,Y);else{var Je=C,dt=F,Dt=Y,Qt=Je[dt-Dt],ft=Je[dt+0],Ot=Je[dt+Dt],Kt=Zu[112+(4+(Sn=3*(ft-Qt))>>3)],Sn=Zu[112+(Sn+3>>3)],y=Kt+1>>1;Je[dt-2*Dt]=Ui[255+Je[dt-2*Dt]+y],Je[dt-Dt]=Ui[255+Qt+Sn],Je[dt+0]=Ui[255+ft-Kt],Je[dt+Dt]=Ui[255+Ot-y]}F+=ie}}function Ya(C,F,Y,ie,Ce,Be){Es(C,F,Y,1,16,ie,Ce,Be)}function ks(C,F,Y,ie,Ce,Be){Es(C,F,1,Y,16,ie,Ce,Be)}function Ws(C,F,Y,ie,Ce,Be){var qe;for(qe=3;0<qe;--qe)As(C,F+=4*Y,Y,1,16,ie,Ce,Be)}function Vl(C,F,Y,ie,Ce,Be){var qe;for(qe=3;0<qe;--qe)As(C,F+=4,1,Y,16,ie,Ce,Be)}function H(C,F,Y,ie,Ce,Be,qe,Ke){Es(C,F,Ce,1,8,Be,qe,Ke),Es(Y,ie,Ce,1,8,Be,qe,Ke)}function Le(C,F,Y,ie,Ce,Be,qe,Ke){Es(C,F,1,Ce,8,Be,qe,Ke),Es(Y,ie,1,Ce,8,Be,qe,Ke)}function pt(C,F,Y,ie,Ce,Be,qe,Ke){As(C,F+4*Ce,Ce,1,8,Be,qe,Ke),As(Y,ie+4*Ce,Ce,1,8,Be,qe,Ke)}function Pt(C,F,Y,ie,Ce,Be,qe,Ke){As(C,F+4,1,Ce,8,Be,qe,Ke),As(Y,ie+4,1,Ce,8,Be,qe,Ke)}function qt(){this.ba=new Ie,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new ct,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function on(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Dn(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Pr(){this.ua=0,this.Wa=new xr,this.vb=new xr,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new ke,this.yc=new Z}function $r(){this.xb=this.a=0,this.l=new ss,this.ca=new Ie,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Me,this.Pb=0,this.wd=new Me,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Pr,this.ab=0,this.gc=m(4,Dn),this.Oc=0}function gi(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new ss,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function xi(C,F,Y,ie,Ce,Be,qe){for(C=C==null?0:C[F+0],F=0;F<qe;++F)Ce[Be+F]=C+Y[ie+F]&255,C=Ce[Be+F]}function so(C,F,Y,ie,Ce,Be,qe){var Ke;if(C==null)xi(null,null,Y,ie,Ce,Be,qe);else for(Ke=0;Ke<qe;++Ke)Ce[Be+Ke]=C[F+Ke]+Y[ie+Ke]&255}function lo(C,F,Y,ie,Ce,Be,qe){if(C==null)xi(null,null,Y,ie,Ce,Be,qe);else{var Ke,Je=C[F+0],dt=Je,Dt=Je;for(Ke=0;Ke<qe;++Ke)dt=Dt+(Je=C[F+Ke])-dt,Dt=Y[ie+Ke]+(-256&dt?0>dt?0:255:dt)&255,dt=Je,Ce[Be+Ke]=Dt}}function _s(C,F,Y,ie){var Ce=F.width,Be=F.o;if(e(C!=null&&F!=null),0>Y||0>=ie||Y+ie>Be)return null;if(!C.Cc){if(C.ga==null){var qe;if(C.ga=new gi,(qe=C.ga==null)||(qe=F.width*F.o,e(C.Gb.length==0),C.Gb=u(qe),C.Uc=0,C.Gb==null?qe=0:(C.mb=C.Gb,C.nb=C.Uc,C.rc=null,qe=1),qe=!qe),!qe){qe=C.ga;var Ke=C.Fa,Je=C.P,dt=C.qc,Dt=C.mb,Qt=C.nb,ft=Je+1,Ot=dt-1,Kt=qe.l;if(e(Ke!=null&&Dt!=null&&F!=null),_a[0]=null,_a[1]=xi,_a[2]=so,_a[3]=lo,qe.ca=Dt,qe.tb=Qt,qe.c=F.width,qe.i=F.height,e(0<qe.c&&0<qe.i),1>=dt)F=0;else if(qe.$a=3&Ke[Je+0],qe.Z=Ke[Je+0]>>2&3,qe.Lc=Ke[Je+0]>>4&3,Je=Ke[Je+0]>>6&3,0>qe.$a||1<qe.$a||4<=qe.Z||1<qe.Lc||Je)F=0;else if(Kt.put=Mt,Kt.ac=St,Kt.bc=vn,Kt.ma=qe,Kt.width=F.width,Kt.height=F.height,Kt.Da=F.Da,Kt.v=F.v,Kt.va=F.va,Kt.j=F.j,Kt.o=F.o,qe.$a)e:{e(qe.$a==1),F=Jo();t:for(;;){if(F==null){F=0;break e}if(e(qe!=null),qe.mc=F,F.c=qe.c,F.i=qe.i,F.l=qe.l,F.l.ma=qe,F.l.width=qe.c,F.l.height=qe.i,F.a=0,De(F.m,Ke,ft,Ot),!La(qe.c,qe.i,1,F,null)||(F.ab==1&&F.gc[0].hc==3&&ro(F.s)?(qe.ic=1,Ke=F.c*F.i,F.Ta=null,F.Ua=0,F.V=u(Ke),F.Ba=0,F.V==null?(F.a=1,F=0):F=1):(qe.ic=0,F=zl(F,qe.c)),!F))break t;F=1;break e}qe.mc=null,F=0}else F=Ot>=qe.c*qe.i;qe=!F}if(qe)return null;C.ga.Lc!=1?C.Ga=0:ie=Be-Y}e(C.ga!=null),e(Y+ie<=Be);e:{if(F=(Ke=C.ga).c,Be=Ke.l.o,Ke.$a==0){if(ft=C.rc,Ot=C.Vc,Kt=C.Fa,Je=C.P+1+Y*F,dt=C.mb,Dt=C.nb+Y*F,e(Je<=C.P+C.qc),Ke.Z!=0)for(e(_a[Ke.Z]!=null),qe=0;qe<ie;++qe)_a[Ke.Z](ft,Ot,Kt,Je,dt,Dt,F),ft=dt,Ot=Dt,Dt+=F,Je+=F;else for(qe=0;qe<ie;++qe)i(dt,Dt,Kt,Je,F),ft=dt,Ot=Dt,Dt+=F,Je+=F;C.rc=ft,C.Vc=Ot}else{if(e(Ke.mc!=null),F=Y+ie,e((qe=Ke.mc)!=null),e(F<=qe.i),qe.C>=F)F=1;else if(Ke.ic||zo(),Ke.ic){Ke=qe.V,ft=qe.Ba,Ot=qe.c;var Sn=qe.i,y=(Kt=1,Je=qe.$/Ot,dt=qe.$%Ot,Dt=qe.m,Qt=qe.s,qe.$),a=Ot*Sn,f=Ot*F,v=Qt.wc,S=y<f?Dr(Qt,dt,Je):null;e(y<=a),e(F<=Sn),e(ro(Qt));t:for(;;){for(;!Dt.h&&y<f;){if(dt&v||(S=Dr(Qt,dt,Je)),e(S!=null),mt(Dt),256>(Sn=Cr(S.G[0],S.H[0],Dt)))Ke[ft+y]=Sn,++y,++dt>=Ot&&(dt=0,++Je<=F&&!(Je%16)&&Ji(qe,Je));else{if(!(280>Sn)){Kt=0;break t}Sn=Ln(Sn-256,Dt);var T,R=Cr(S.G[4],S.H[4],Dt);if(mt(Dt),!(y>=(R=qr(Ot,R=Ln(R,Dt)))&&a-y>=Sn)){Kt=0;break t}for(T=0;T<Sn;++T)Ke[ft+y+T]=Ke[ft+y+T-R];for(y+=Sn,dt+=Sn;dt>=Ot;)dt-=Ot,++Je<=F&&!(Je%16)&&Ji(qe,Je);y<f&&dt&v&&(S=Dr(Qt,dt,Je))}e(Dt.h==Ze(Dt))}Ji(qe,Je>F?F:Je);break t}!Kt||Dt.h&&y<a?(Kt=0,qe.a=Dt.h?5:3):qe.$=y,F=Kt}else F=Yo(qe,qe.V,qe.Ba,qe.c,qe.i,F,jl);if(!F){ie=0;break e}}Y+ie>=Be&&(C.Cc=1),ie=1}if(!ie)return null;if(C.Cc&&((ie=C.ga)!=null&&(ie.mc=null),C.ga=null,0<C.Ga))return alert("todo:WebPDequantizeLevels"),null}return C.nb+Y*Ce}function eo(C,F,Y,ie,Ce,Be){for(;0<Ce--;){var qe,Ke=C,Je=F+(Y?1:0),dt=C,Dt=F+(Y?0:3);for(qe=0;qe<ie;++qe){var Qt=dt[Dt+4*qe];Qt!=255&&(Qt*=32897,Ke[Je+4*qe+0]=Ke[Je+4*qe+0]*Qt>>23,Ke[Je+4*qe+1]=Ke[Je+4*qe+1]*Qt>>23,Ke[Je+4*qe+2]=Ke[Je+4*qe+2]*Qt>>23)}F+=Be}}function $o(C,F,Y,ie,Ce){for(;0<ie--;){var Be;for(Be=0;Be<Y;++Be){var qe=C[F+2*Be+0],Ke=15&(dt=C[F+2*Be+1]),Je=4369*Ke,dt=(240&dt|dt>>4)*Je>>16;C[F+2*Be+0]=(240&qe|qe>>4)*Je>>16&240|(15&qe|qe<<4)*Je>>16>>4&15,C[F+2*Be+1]=240&dt|Ke}F+=Ce}}function Go(C,F,Y,ie,Ce,Be,qe,Ke){var Je,dt,Dt=255;for(dt=0;dt<Ce;++dt){for(Je=0;Je<ie;++Je){var Qt=C[F+Je];Be[qe+4*Je]=Qt,Dt&=Qt}F+=Y,qe+=Ke}return Dt!=255}function ds(C,F,Y,ie,Ce){var Be;for(Be=0;Be<Ce;++Be)Y[ie+Be]=C[F+Be]>>8}function zo(){ga=eo,du=$o,Iu=Go,Ai=ds}function Ms(C,F,Y){D[C]=function(ie,Ce,Be,qe,Ke,Je,dt,Dt,Qt,ft,Ot,Kt,Sn,y,a,f,v){var S,T=v-1>>1,R=Ke[Je+0]|dt[Dt+0]<<16,B=Qt[ft+0]|Ot[Kt+0]<<16;e(ie!=null);var G=3*R+B+131074>>2;for(F(ie[Ce+0],255&G,G>>16,Sn,y),Be!=null&&(G=3*B+R+131074>>2,F(Be[qe+0],255&G,G>>16,a,f)),S=1;S<=T;++S){var J=Ke[Je+S]|dt[Dt+S]<<16,ee=Qt[ft+S]|Ot[Kt+S]<<16,me=R+J+B+ee+524296,Ae=me+2*(J+B)>>3;G=Ae+R>>1,R=(me=me+2*(R+ee)>>3)+J>>1,F(ie[Ce+2*S-1],255&G,G>>16,Sn,y+(2*S-1)*Y),F(ie[Ce+2*S-0],255&R,R>>16,Sn,y+(2*S-0)*Y),Be!=null&&(G=me+B>>1,R=Ae+ee>>1,F(Be[qe+2*S-1],255&G,G>>16,a,f+(2*S-1)*Y),F(Be[qe+2*S+0],255&R,R>>16,a,f+(2*S+0)*Y)),R=J,B=ee}1&v||(G=3*R+B+131074>>2,F(ie[Ce+v-1],255&G,G>>16,Sn,y+(v-1)*Y),Be!=null&&(G=3*B+R+131074>>2,F(Be[qe+v-1],255&G,G>>16,a,f+(v-1)*Y)))}}function Ja(){qa[vh]=od,qa[rs]=Fa,qa[rl]=Id,qa[Pc]=Rc,qa[Aa]=eh,qa[Co]=Ph,qa[Vh]=$h,qa[kc]=Fa,qa[Vi]=Rc,qa[lc]=eh,qa[cc]=Ph}function Hs(C){return C&-16384?0>C?0:255:C>>Ll}function L(C,F){return Hs((19077*C>>8)+(26149*F>>8)-14234)}function re(C,F,Y){return Hs((19077*C>>8)-(6419*F>>8)-(13320*Y>>8)+8708)}function _e(C,F){return Hs((19077*C>>8)+(33050*F>>8)-17685)}function $e(C,F,Y,ie,Ce){ie[Ce+0]=L(C,Y),ie[Ce+1]=re(C,F,Y),ie[Ce+2]=_e(C,F)}function Xt(C,F,Y,ie,Ce){ie[Ce+0]=_e(C,F),ie[Ce+1]=re(C,F,Y),ie[Ce+2]=L(C,Y)}function nn(C,F,Y,ie,Ce){var Be=re(C,F,Y);F=Be<<3&224|_e(C,F)>>3,ie[Ce+0]=248&L(C,Y)|Be>>5,ie[Ce+1]=F}function Un(C,F,Y,ie,Ce){var Be=240&_e(C,F)|15;ie[Ce+0]=240&L(C,Y)|re(C,F,Y)>>4,ie[Ce+1]=Be}function mo(C,F,Y,ie,Ce){ie[Ce+0]=255,$e(C,F,Y,ie,Ce+1)}function jo(C,F,Y,ie,Ce){Xt(C,F,Y,ie,Ce),ie[Ce+3]=255}function Hi(C,F,Y,ie,Ce){$e(C,F,Y,ie,Ce),ie[Ce+3]=255}function Qr(C,F){return 0>C?0:C>F?F:C}function xo(C,F,Y){D[C]=function(ie,Ce,Be,qe,Ke,Je,dt,Dt,Qt){for(var ft=Dt+(-2&Qt)*Y;Dt!=ft;)F(ie[Ce+0],Be[qe+0],Ke[Je+0],dt,Dt),F(ie[Ce+1],Be[qe+0],Ke[Je+0],dt,Dt+Y),Ce+=2,++qe,++Je,Dt+=2*Y;1&Qt&&F(ie[Ce+0],Be[qe+0],Ke[Je+0],dt,Dt)}}function fs(C,F,Y){return Y==0?C==0?F==0?6:5:F==0?4:0:Y}function pa(C,F,Y,ie,Ce){switch(C>>>30){case 3:Gl(F,Y,ie,Ce,0);break;case 2:ns(F,Y,ie,Ce);break;case 1:Li(F,Y,ie,Ce)}}function Rs(C,F){var Y,ie,Ce=F.M,Be=F.Nb,qe=C.oc,Ke=C.pc+40,Je=C.oc,dt=C.pc+584,Dt=C.oc,Qt=C.pc+600;for(Y=0;16>Y;++Y)qe[Ke+32*Y-1]=129;for(Y=0;8>Y;++Y)Je[dt+32*Y-1]=129,Dt[Qt+32*Y-1]=129;for(0<Ce?qe[Ke-1-32]=Je[dt-1-32]=Dt[Qt-1-32]=129:(c(qe,Ke-32-1,127,21),c(Je,dt-32-1,127,9),c(Dt,Qt-32-1,127,9)),ie=0;ie<C.za;++ie){var ft=F.ya[F.aa+ie];if(0<ie){for(Y=-1;16>Y;++Y)i(qe,Ke+32*Y-4,qe,Ke+32*Y+12,4);for(Y=-1;8>Y;++Y)i(Je,dt+32*Y-4,Je,dt+32*Y+4,4),i(Dt,Qt+32*Y-4,Dt,Qt+32*Y+4,4)}var Ot=C.Gd,Kt=C.Hd+ie,Sn=ft.ad,y=ft.Hc;if(0<Ce&&(i(qe,Ke-32,Ot[Kt].y,0,16),i(Je,dt-32,Ot[Kt].f,0,8),i(Dt,Qt-32,Ot[Kt].ea,0,8)),ft.Za){var a=qe,f=Ke-32+16;for(0<Ce&&(ie>=C.za-1?c(a,f,Ot[Kt].y[15],4):i(a,f,Ot[Kt+1].y,0,4)),Y=0;4>Y;Y++)a[f+128+Y]=a[f+256+Y]=a[f+384+Y]=a[f+0+Y];for(Y=0;16>Y;++Y,y<<=2)a=qe,f=Ke+Dc[Y],Da[ft.Ob[Y]](a,f),pa(y,Sn,16*+Y,a,f)}else if(a=fs(ie,Ce,ft.Ob[0]),Ta[a](qe,Ke),y!=0)for(Y=0;16>Y;++Y,y<<=2)pa(y,Sn,16*+Y,qe,Ke+Dc[Y]);for(Y=ft.Gc,a=fs(ie,Ce,ft.Dd),Va[a](Je,dt),Va[a](Dt,Qt),y=Sn,a=Je,f=dt,255&(ft=0|Y)&&(170&ft?Ts(y,256,a,f):Io(y,256,a,f)),ft=Dt,y=Qt,255&(Y>>=8)&&(170&Y?Ts(Sn,320,ft,y):Io(Sn,320,ft,y)),Ce<C.Ub-1&&(i(Ot[Kt].y,0,qe,Ke+480,16),i(Ot[Kt].f,0,Je,dt+224,8),i(Ot[Kt].ea,0,Dt,Qt+224,8)),Y=8*Be*C.B,Ot=C.sa,Kt=C.ta+16*ie+16*Be*C.R,Sn=C.qa,ft=C.ra+8*ie+Y,y=C.Ha,a=C.Ia+8*ie+Y,Y=0;16>Y;++Y)i(Ot,Kt+Y*C.R,qe,Ke+32*Y,16);for(Y=0;8>Y;++Y)i(Sn,ft+Y*C.B,Je,dt+32*Y,8),i(y,a+Y*C.B,Dt,Qt+32*Y,8)}}function Tl(C,F,Y,ie,Ce,Be,qe,Ke,Je){var dt=[0],Dt=[0],Qt=0,ft=Je!=null?Je.kd:0,Ot=Je??new on;if(C==null||12>Y)return 7;Ot.data=C,Ot.w=F,Ot.ha=Y,F=[F],Y=[Y],Ot.gb=[Ot.gb];e:{var Kt=F,Sn=Y,y=Ot.gb;if(e(C!=null),e(Sn!=null),e(y!=null),y[0]=0,12<=Sn[0]&&!t(C,Kt[0],"RIFF")){if(t(C,Kt[0]+8,"WEBP")){y=3;break e}var a=zt(C,Kt[0]+4);if(12>a||4294967286<a){y=3;break e}if(ft&&a>Sn[0]-8){y=7;break e}y[0]=a,Kt[0]+=12,Sn[0]-=12}y=0}if(y!=0)return y;for(a=0<Ot.gb[0],Y=Y[0];;){e:{var f=C;Sn=F,y=Y;var v=dt,S=Dt,T=Kt=[0];if((G=Qt=[Qt])[0]=0,8>y[0])y=7;else{if(!t(f,Sn[0],"VP8X")){if(zt(f,Sn[0]+4)!=10){y=3;break e}if(18>y[0]){y=7;break e}var R=zt(f,Sn[0]+8),B=1+An(f,Sn[0]+12);if(2147483648<=B*(f=1+An(f,Sn[0]+15))){y=3;break e}T!=null&&(T[0]=R),v!=null&&(v[0]=B),S!=null&&(S[0]=f),Sn[0]+=18,y[0]-=18,G[0]=1}y=0}}if(Qt=Qt[0],Kt=Kt[0],y!=0)return y;if(Sn=!!(2&Kt),!a&&Qt)return 3;if(Be!=null&&(Be[0]=!!(16&Kt)),qe!=null&&(qe[0]=Sn),Ke!=null&&(Ke[0]=0),qe=dt[0],Kt=Dt[0],Qt&&Sn&&Je==null){y=0;break}if(4>Y){y=7;break}if(a&&Qt||!a&&!Qt&&!t(C,F[0],"ALPH")){Y=[Y],Ot.na=[Ot.na],Ot.P=[Ot.P],Ot.Sa=[Ot.Sa];e:{R=C,y=F,a=Y;var G=Ot.gb;v=Ot.na,S=Ot.P,T=Ot.Sa,B=22,e(R!=null),e(a!=null),f=y[0];var J=a[0];for(e(v!=null),e(T!=null),v[0]=null,S[0]=null,T[0]=0;;){if(y[0]=f,a[0]=J,8>J){y=7;break e}var ee=zt(R,f+4);if(4294967286<ee){y=3;break e}var me=8+ee+1&-2;if(B+=me,0<G&&B>G){y=3;break e}if(!t(R,f,"VP8 ")||!t(R,f,"VP8L")){y=0;break e}if(J[0]<me){y=7;break e}t(R,f,"ALPH")||(v[0]=R,S[0]=f+8,T[0]=ee),f+=me,J-=me}}if(Y=Y[0],Ot.na=Ot.na[0],Ot.P=Ot.P[0],Ot.Sa=Ot.Sa[0],y!=0)break}Y=[Y],Ot.Ja=[Ot.Ja],Ot.xa=[Ot.xa];e:if(G=C,y=F,a=Y,v=Ot.gb[0],S=Ot.Ja,T=Ot.xa,R=y[0],f=!t(G,R,"VP8 "),B=!t(G,R,"VP8L"),e(G!=null),e(a!=null),e(S!=null),e(T!=null),8>a[0])y=7;else{if(f||B){if(G=zt(G,R+4),12<=v&&G>v-12){y=3;break e}if(ft&&G>a[0]-8){y=7;break e}S[0]=G,y[0]+=8,a[0]-=8,T[0]=B}else T[0]=5<=a[0]&&G[R+0]==47&&!(G[R+4]>>5),S[0]=a[0];y=0}if(Y=Y[0],Ot.Ja=Ot.Ja[0],Ot.xa=Ot.xa[0],F=F[0],y!=0)break;if(4294967286<Ot.Ja)return 3;if(Ke==null||Sn||(Ke[0]=Ot.xa?2:1),qe=[qe],Kt=[Kt],Ot.xa){if(5>Y){y=7;break}Ke=qe,ft=Kt,Sn=Be,C==null||5>Y?C=0:5<=Y&&C[F+0]==47&&!(C[F+4]>>5)?(a=[0],G=[0],v=[0],De(S=new Me,C,F,Y),Bn(S,a,G,v)?(Ke!=null&&(Ke[0]=a[0]),ft!=null&&(ft[0]=G[0]),Sn!=null&&(Sn[0]=v[0]),C=1):C=0):C=0}else{if(10>Y){y=7;break}Ke=Kt,C==null||10>Y||!Au(C,F+3,Y-3)?C=0:(ft=C[F+0]|C[F+1]<<8|C[F+2]<<16,Sn=16383&(C[F+7]<<8|C[F+6]),C=16383&(C[F+9]<<8|C[F+8]),1&ft||3<(ft>>1&7)||!(ft>>4&1)||ft>>5>=Ot.Ja||!Sn||!C?C=0:(qe&&(qe[0]=Sn),Ke&&(Ke[0]=C),C=1))}if(!C||(qe=qe[0],Kt=Kt[0],Qt&&(dt[0]!=qe||Dt[0]!=Kt)))return 3;Je!=null&&(Je[0]=Ot,Je.offset=F-Je.w,e(4294967286>F-Je.w),e(Je.offset==Je.ha-Y));break}return y==0||y==7&&Qt&&Je==null?(Be!=null&&(Be[0]|=Ot.na!=null&&0<Ot.na.length),ie!=null&&(ie[0]=qe),Ce!=null&&(Ce[0]=Kt),0):y}function Ua(C,F,Y){var ie=F.width,Ce=F.height,Be=0,qe=0,Ke=ie,Je=Ce;if(F.Da=C!=null&&0<C.Da,F.Da&&(Ke=C.cd,Je=C.bd,Be=C.v,qe=C.j,11>Y||(Be&=-2,qe&=-2),0>Be||0>qe||0>=Ke||0>=Je||Be+Ke>ie||qe+Je>Ce))return 0;if(F.v=Be,F.j=qe,F.va=Be+Ke,F.o=qe+Je,F.U=Ke,F.T=Je,F.da=C!=null&&0<C.da,F.da){if(!Tr(Ke,Je,Y=[C.ib],Be=[C.hb]))return 0;F.ib=Y[0],F.hb=Be[0]}return F.ob=C!=null&&C.ob,F.Kb=C==null||!C.Sd,F.da&&(F.ob=F.ib<3*ie/4&&F.hb<3*Ce/4,F.Kb=0),1}function Xc(C){if(C==null)return 2;if(11>C.S){var F=C.f.RGBA;F.fb+=(C.height-1)*F.A,F.A=-F.A}else F=C.f.kb,C=C.height,F.O+=(C-1)*F.fa,F.fa=-F.fa,F.N+=(C-1>>1)*F.Ab,F.Ab=-F.Ab,F.W+=(C-1>>1)*F.Db,F.Db=-F.Db,F.F!=null&&(F.J+=(C-1)*F.lb,F.lb=-F.lb);return 0}function ml(C,F,Y,ie){if(ie==null||0>=C||0>=F)return 2;if(Y!=null){if(Y.Da){var Ce=Y.cd,Be=Y.bd,qe=-2&Y.v,Ke=-2&Y.j;if(0>qe||0>Ke||0>=Ce||0>=Be||qe+Ce>C||Ke+Be>F)return 2;C=Ce,F=Be}if(Y.da){if(!Tr(C,F,Ce=[Y.ib],Be=[Y.hb]))return 2;C=Ce[0],F=Be[0]}}ie.width=C,ie.height=F;e:{var Je=ie.width,dt=ie.height;if(C=ie.S,0>=Je||0>=dt||!(C>=vh&&13>C))C=2;else{if(0>=ie.Rd&&ie.sd==null){qe=Be=Ce=F=0;var Dt=(Ke=Je*kh[C])*dt;if(11>C||(Be=(dt+1)/2*(F=(Je+1)/2),C==12&&(qe=(Ce=Je)*dt)),(dt=u(Dt+2*Be+qe))==null){C=1;break e}ie.sd=dt,11>C?((Je=ie.f.RGBA).eb=dt,Je.fb=0,Je.A=Ke,Je.size=Dt):((Je=ie.f.kb).y=dt,Je.O=0,Je.fa=Ke,Je.Fd=Dt,Je.f=dt,Je.N=0+Dt,Je.Ab=F,Je.Cd=Be,Je.ea=dt,Je.W=0+Dt+Be,Je.Db=F,Je.Ed=Be,C==12&&(Je.F=dt,Je.J=0+Dt+2*Be),Je.Tc=qe,Je.lb=Ce)}if(F=1,Ce=ie.S,Be=ie.width,qe=ie.height,Ce>=vh&&13>Ce)if(11>Ce)C=ie.f.RGBA,F&=(Ke=Math.abs(C.A))*(qe-1)+Be<=C.size,F&=Ke>=Be*kh[Ce],F&=C.eb!=null;else{C=ie.f.kb,Ke=(Be+1)/2,Dt=(qe+1)/2,Je=Math.abs(C.fa),dt=Math.abs(C.Ab);var Qt=Math.abs(C.Db),ft=Math.abs(C.lb),Ot=ft*(qe-1)+Be;F&=Je*(qe-1)+Be<=C.Fd,F&=dt*(Dt-1)+Ke<=C.Cd,F=(F&=Qt*(Dt-1)+Ke<=C.Ed)&Je>=Be&dt>=Ke&Qt>=Ke,F&=C.y!=null,F&=C.f!=null,F&=C.ea!=null,Ce==12&&(F&=ft>=Be,F&=Ot<=C.Tc,F&=C.F!=null)}else F=0;C=F?0:2}}return C!=0||Y!=null&&Y.fd&&(C=Xc(ie)),C}var Qa=64,ma=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Xs=24,Kc=32,Uo=8,au=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];$n("Predictor0","PredictorAdd0"),D.Predictor0=function(){return 4278190080},D.Predictor1=function(C){return C},D.Predictor2=function(C,F,Y){return F[Y+0]},D.Predictor3=function(C,F,Y){return F[Y+1]},D.Predictor4=function(C,F,Y){return F[Y-1]},D.Predictor5=function(C,F,Y){return Wt(Wt(C,F[Y+1]),F[Y+0])},D.Predictor6=function(C,F,Y){return Wt(C,F[Y-1])},D.Predictor7=function(C,F,Y){return Wt(C,F[Y+0])},D.Predictor8=function(C,F,Y){return Wt(F[Y-1],F[Y+0])},D.Predictor9=function(C,F,Y){return Wt(F[Y+0],F[Y+1])},D.Predictor10=function(C,F,Y){return Wt(Wt(C,F[Y-1]),Wt(F[Y+0],F[Y+1]))},D.Predictor11=function(C,F,Y){var ie=F[Y+0];return 0>=Hn(ie>>24&255,C>>24&255,(F=F[Y-1])>>24&255)+Hn(ie>>16&255,C>>16&255,F>>16&255)+Hn(ie>>8&255,C>>8&255,F>>8&255)+Hn(255&ie,255&C,255&F)?ie:C},D.Predictor12=function(C,F,Y){var ie=F[Y+0];return(Nn((C>>24&255)+(ie>>24&255)-((F=F[Y-1])>>24&255))<<24|Nn((C>>16&255)+(ie>>16&255)-(F>>16&255))<<16|Nn((C>>8&255)+(ie>>8&255)-(F>>8&255))<<8|Nn((255&C)+(255&ie)-(255&F)))>>>0},D.Predictor13=function(C,F,Y){var ie=F[Y-1];return(tr((C=Wt(C,F[Y+0]))>>24&255,ie>>24&255)<<24|tr(C>>16&255,ie>>16&255)<<16|tr(C>>8&255,ie>>8&255)<<8|tr(255&C,255&ie))>>>0};var el=D.PredictorAdd0;D.PredictorAdd1=Rr,$n("Predictor2","PredictorAdd2"),$n("Predictor3","PredictorAdd3"),$n("Predictor4","PredictorAdd4"),$n("Predictor5","PredictorAdd5"),$n("Predictor6","PredictorAdd6"),$n("Predictor7","PredictorAdd7"),$n("Predictor8","PredictorAdd8"),$n("Predictor9","PredictorAdd9"),$n("Predictor10","PredictorAdd10"),$n("Predictor11","PredictorAdd11"),$n("Predictor12","PredictorAdd12"),$n("Predictor13","PredictorAdd13");var tl=D.PredictorAdd2;Ir("ColorIndexInverseTransform","MapARGB","32b",function(C){return C>>8&255},function(C){return C}),Ir("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(C){return C},function(C){return C>>8&255});var Ks,Ic=D.ColorIndexInverseTransform,Cc=D.MapARGB,ql=D.VP8LColorIndexInverseTransformAlpha,Zc=D.MapAlpha,lu=D.VP8LPredictorsAdd=[];lu.length=16,(D.VP8LPredictors=[]).length=16,(D.VP8LPredictorsAdd_C=[]).length=16,(D.VP8LPredictors_C=[]).length=16;var Yc,cu,Lc,Jc,uu,Qc,$l,Gl,ns,Ts,Li,Io,yr,la,oc,sc,Il,hu,ac,nl,Ur,Wl,Zs,eu,ga,du,Iu,Ai,Ra=u(511),Hl=u(2041),ca=u(225),Or=u(767),Ys=0,fu=Hl,Zu=ca,Ui=Or,Cl=Ra,vh=0,rs=1,rl=2,Pc=3,Aa=4,Co=5,Vh=6,kc=7,Vi=8,lc=9,cc=10,or=[2,3,7],go=[3,3,11],Cu=[280,256,256,256,40],Lu=[0,1,1,1,0],qh=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],ya=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Na=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Mc=8,Yu=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],tu=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],gl=null,Ju=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],pu=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Ch=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Qu=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Qd=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],xh=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Lh=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Ta=[],Da=[],Va=[],yl=1,uc=2,_a=[],qa=[];Ms("UpsampleRgbLinePair",$e,3),Ms("UpsampleBgrLinePair",Xt,3),Ms("UpsampleRgbaLinePair",Hi,4),Ms("UpsampleBgraLinePair",jo,4),Ms("UpsampleArgbLinePair",mo,4),Ms("UpsampleRgba4444LinePair",Un,2),Ms("UpsampleRgb565LinePair",nn,2);var od=D.UpsampleRgbLinePair,Id=D.UpsampleBgrLinePair,Fa=D.UpsampleRgbaLinePair,Rc=D.UpsampleBgraLinePair,eh=D.UpsampleArgbLinePair,Ph=D.UpsampleRgba4444LinePair,$h=D.UpsampleRgb565LinePair,nu=16,Nc=1<<nu-1,Lo=-227,Xi=482,Ll=6,va=0,Is=u(256),Xl=u(256),$a=u(256),Pl=u(256),sd=u(Xi-Lo),Ga=u(Xi-Lo);xo("YuvToRgbRow",$e,3),xo("YuvToBgrRow",Xt,3),xo("YuvToRgbaRow",Hi,4),xo("YuvToBgraRow",jo,4),xo("YuvToArgbRow",mo,4),xo("YuvToRgba4444Row",Un,2),xo("YuvToRgb565Row",nn,2);var Dc=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Ia=[0,2,8],bh=[8,7,6,4,4,2,2,2,1,1,1,1],sr=1;this.WebPDecodeRGBA=function(C,F,Y,ie,Ce){var Be=rs,qe=new qt,Ke=new Ie;qe.ba=Ke,Ke.S=Be,Ke.width=[Ke.width],Ke.height=[Ke.height];var Je=Ke.width,dt=Ke.height,Dt=new Ye;if(Dt==null||C==null)var Qt=2;else e(Dt!=null),Qt=Tl(C,F,Y,Dt.width,Dt.height,Dt.Pd,Dt.Qd,Dt.format,null);if(Qt!=0?Je=0:(Je!=null&&(Je[0]=Dt.width[0]),dt!=null&&(dt[0]=Dt.height[0]),Je=1),Je){Ke.width=Ke.width[0],Ke.height=Ke.height[0],ie!=null&&(ie[0]=Ke.width),Ce!=null&&(Ce[0]=Ke.height);e:{if(ie=new ss,(Ce=new on).data=C,Ce.w=F,Ce.ha=Y,Ce.kd=1,F=[0],e(Ce!=null),((C=Tl(Ce.data,Ce.w,Ce.ha,null,null,null,F,null,Ce))==0||C==7)&&F[0]&&(C=4),(F=C)==0){if(e(qe!=null),ie.data=Ce.data,ie.w=Ce.w+Ce.offset,ie.ha=Ce.ha-Ce.offset,ie.put=Mt,ie.ac=St,ie.bc=vn,ie.ma=qe,Ce.xa){if((C=Jo())==null){qe=1;break e}if((function(ft,Ot){var Kt=[0],Sn=[0],y=[0];t:for(;;){if(ft==null)return 0;if(Ot==null)return ft.a=2,0;if(ft.l=Ot,ft.a=0,De(ft.m,Ot.data,Ot.w,Ot.ha),!Bn(ft.m,Kt,Sn,y)){ft.a=3;break t}if(ft.xb=uc,Ot.width=Kt[0],Ot.height=Sn[0],!La(Kt[0],Sn[0],1,ft,null))break t;return 1}return e(ft.a!=0),0})(C,ie)){if(ie=(F=ml(ie.width,ie.height,qe.Oa,qe.ba))==0){t:{ie=C;n:for(;;){if(ie==null){ie=0;break t}if(e(ie.s.yc!=null),e(ie.s.Ya!=null),e(0<ie.s.Wb),e((Y=ie.l)!=null),e((Ce=Y.ma)!=null),ie.xb!=0){if(ie.ca=Ce.ba,ie.tb=Ce.tb,e(ie.ca!=null),!Ua(Ce.Oa,Y,Pc)){ie.a=2;break n}if(!zl(ie,Y.width)||Y.da)break n;if((Y.da||ii(ie.ca.S))&&zo(),11>ie.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),ie.ca.f.kb.F!=null&&zo()),ie.Pb&&0<ie.s.ua&&ie.s.vb.X==null&&!it(ie.s.vb,ie.s.Wa.Xa)){ie.a=1;break n}ie.xb=0}if(!Yo(ie,ie.V,ie.Ba,ie.c,ie.i,Y.o,ko))break n;Ce.Dc=ie.Ma,ie=1;break t}e(ie.a!=0),ie=0}ie=!ie}ie&&(F=C.a)}else F=C.a}else{if((C=new as)==null){qe=1;break e}if(C.Fa=Ce.na,C.P=Ce.P,C.qc=Ce.Sa,ka(C,ie)){if((F=ml(ie.width,ie.height,qe.Oa,qe.ba))==0){if(C.Aa=0,Y=qe.Oa,e((Ce=C)!=null),Y!=null){if(0<(Je=0>(Je=Y.Md)?0:100<Je?255:255*Je/100)){for(dt=Dt=0;4>dt;++dt)12>(Qt=Ce.pb[dt]).lc&&(Qt.ia=Je*bh[0>Qt.lc?0:Qt.lc]>>3),Dt|=Qt.ia;Dt&&(alert("todo:VP8InitRandom"),Ce.ia=1)}Ce.Ga=Y.Id,100<Ce.Ga?Ce.Ga=100:0>Ce.Ga&&(Ce.Ga=0)}(function(ft,Ot){if(ft==null)return 0;if(Ot==null)return Qi(ft,2,"NULL VP8Io parameter in VP8Decode().");if(!ft.cb&&!ka(ft,Ot))return 0;if(e(ft.cb),Ot.ac==null||Ot.ac(Ot)){Ot.ob&&(ft.L=0);var Kt=Ia[ft.L];if(ft.L==2?(ft.yb=0,ft.zb=0):(ft.yb=Ot.v-Kt>>4,ft.zb=Ot.j-Kt>>4,0>ft.yb&&(ft.yb=0),0>ft.zb&&(ft.zb=0)),ft.Va=Ot.o+15+Kt>>4,ft.Hb=Ot.va+15+Kt>>4,ft.Hb>ft.za&&(ft.Hb=ft.za),ft.Va>ft.Ub&&(ft.Va=ft.Ub),0<ft.L){var Sn=ft.ed;for(Kt=0;4>Kt;++Kt){var y;if(ft.Qa.Cb){var a=ft.Qa.Lb[Kt];ft.Qa.Fb||(a+=Sn.Tb)}else a=Sn.Tb;for(y=0;1>=y;++y){var f=ft.gd[Kt][y],v=a;if(Sn.Pc&&(v+=Sn.vd[0],y&&(v+=Sn.od[0])),0<(v=0>v?0:63<v?63:v)){var S=v;0<Sn.wb&&(S=4<Sn.wb?S>>2:S>>1)>9-Sn.wb&&(S=9-Sn.wb),1>S&&(S=1),f.dd=S,f.tc=2*v+S,f.ld=40<=v?2:15<=v?1:0}else f.tc=0;f.La=y}}}Kt=0}else Qi(ft,6,"Frame setup failed"),Kt=ft.a;if(Kt=Kt==0){if(Kt){ft.$c=0,0<ft.Aa||(ft.Ic=sr);t:{Kt=ft.Ic,Sn=4*(S=ft.za);var T=32*S,R=S+1,B=0<ft.L?S*(0<ft.Aa?2:1):0,G=(ft.Aa==2?2:1)*S;if((f=Sn+832+(y=3*(16*Kt+Ia[ft.L])/2*T)+(a=ft.Fa!=null&&0<ft.Fa.length?ft.Kc.c*ft.Kc.i:0))!=f)Kt=0;else{if(f>ft.Vb){if(ft.Vb=0,ft.Ec=u(f),ft.Fc=0,ft.Ec==null){Kt=Qi(ft,1,"no memory during frame initialization.");break t}ft.Vb=f}f=ft.Ec,v=ft.Fc,ft.Ac=f,ft.Bc=v,v+=Sn,ft.Gd=m(T,Ro),ft.Hd=0,ft.rb=m(R+1,Sa),ft.sb=1,ft.wa=B?m(B,Qo):null,ft.Y=0,ft.D.Nb=0,ft.D.wa=ft.wa,ft.D.Y=ft.Y,0<ft.Aa&&(ft.D.Y+=S),e(!0),ft.oc=f,ft.pc=v,v+=832,ft.ya=m(G,hl),ft.aa=0,ft.D.ya=ft.ya,ft.D.aa=ft.aa,ft.Aa==2&&(ft.D.aa+=S),ft.R=16*S,ft.B=8*S,S=(T=Ia[ft.L])*ft.R,T=T/2*ft.B,ft.sa=f,ft.ta=v+S,ft.qa=ft.sa,ft.ra=ft.ta+16*Kt*ft.R+T,ft.Ha=ft.qa,ft.Ia=ft.ra+8*Kt*ft.B+T,ft.$c=0,v+=y,ft.mb=a?f:null,ft.nb=a?v:null,e(v+a<=ft.Fc+ft.Vb),ls(ft),c(ft.Ac,ft.Bc,0,Sn),Kt=1}}if(Kt){if(Ot.ka=0,Ot.y=ft.sa,Ot.O=ft.ta,Ot.f=ft.qa,Ot.N=ft.ra,Ot.ea=ft.Ha,Ot.Vd=ft.Ia,Ot.fa=ft.R,Ot.Rc=ft.B,Ot.F=null,Ot.J=0,!Ys){for(Kt=-255;255>=Kt;++Kt)Ra[255+Kt]=0>Kt?-Kt:Kt;for(Kt=-1020;1020>=Kt;++Kt)Hl[1020+Kt]=-128>Kt?-128:127<Kt?127:Kt;for(Kt=-112;112>=Kt;++Kt)ca[112+Kt]=-16>Kt?-16:15<Kt?15:Kt;for(Kt=-255;510>=Kt;++Kt)Or[255+Kt]=0>Kt?0:255<Kt?255:Kt;Ys=1}$l=zi,Gl=fa,Ts=vi,Li=Lr,Io=dl,ns=aa,yr=Ya,la=ks,oc=H,sc=Le,Il=Ws,hu=Vl,ac=pt,nl=Pt,Ur=$s,Wl=si,Zs=Gs,eu=qo,Da[0]=Xu,Da[1]=_o,Da[2]=ts,Da[3]=No,Da[4]=Ul,Da[5]=Vs,Da[6]=Ao,Da[7]=Ku,Da[8]=To,Da[9]=fl,Ta[0]=Mo,Ta[1]=Sl,Ta[2]=Ac,Ta[3]=rc,Ta[4]=ys,Ta[5]=Ps,Ta[6]=ja,Va[0]=Vo,Va[1]=Tu,Va[2]=vo,Va[3]=Ss,Va[4]=Bo,Va[5]=Tc,Va[6]=Al,Kt=1}else Kt=0}Kt&&(Kt=(function(J,ee){for(J.M=0;J.M<J.Va;++J.M){var me,Ae=J.Jc[J.M&J.Xb],Te=J.m,He=J;for(me=0;me<He.za;++me){var je=Te,We=He,ve=We.Ac,Ue=We.Bc+4*me,rt=We.zc,st=We.ya[We.aa+me];if(We.Qa.Bb?st.$b=Jt(je,We.Pa.jb[0])?2+Jt(je,We.Pa.jb[2]):Jt(je,We.Pa.jb[1]):st.$b=0,We.kc&&(st.Ad=Jt(je,We.Bd)),st.Za=!Jt(je,145)+0,st.Za){var bt=st.Ob,wt=0;for(We=0;4>We;++We){var vt,At=rt[0+We];for(vt=0;4>vt;++vt){At=Qd[ve[Ue+vt]][At];for(var kt=Ch[Jt(je,At[0])];0<kt;)kt=Ch[2*kt+Jt(je,At[kt])];At=-kt,ve[Ue+vt]=At}i(bt,wt,ve,Ue,4),wt+=4,rt[0+We]=At}}else At=Jt(je,156)?Jt(je,128)?1:3:Jt(je,163)?2:0,st.Ob[0]=At,c(ve,Ue,At,4),c(rt,0,At,4);st.Dd=Jt(je,142)?Jt(je,114)?Jt(je,183)?1:3:2:0}if(He.m.Ka)return Qi(J,7,"Premature end-of-partition0 encountered.");for(;J.ja<J.za;++J.ja){if(He=Ae,je=(Te=J).rb[Te.sb-1],ve=Te.rb[Te.sb+Te.ja],me=Te.ya[Te.aa+Te.ja],Ue=Te.kc?me.Ad:0)je.la=ve.la=0,me.Za||(je.Na=ve.Na=0),me.Hc=0,me.Gc=0,me.ia=0;else{var Vt,gn;if(je=ve,ve=He,Ue=Te.Pa.Xc,rt=Te.ya[Te.aa+Te.ja],st=Te.pb[rt.$b],We=rt.ad,bt=0,wt=Te.rb[Te.sb-1],At=vt=0,c(We,bt,0,384),rt.Za)var Ut=0,un=Ue[3];else{kt=u(16);var $t=je.Na+wt.Na;if($t=gl(ve,Ue[1],$t,st.Eb,0,kt,0),je.Na=wt.Na=(0<$t)+0,1<$t)$l(kt,0,We,bt);else{var In=kt[0]+3>>3;for(kt=0;256>kt;kt+=16)We[bt+kt]=In}Ut=1,un=Ue[0]}var jt=15&je.la,sn=15&wt.la;for(kt=0;4>kt;++kt){var Cn=1&sn;for(In=gn=0;4>In;++In)jt=jt>>1|(Cn=($t=gl(ve,un,$t=Cn+(1&jt),st.Sc,Ut,We,bt))>Ut)<<7,gn=gn<<2|(3<$t?3:1<$t?2:We[bt+0]!=0),bt+=16;jt>>=4,sn=sn>>1|Cn<<7,vt=(vt<<8|gn)>>>0}for(un=jt,Ut=sn>>4,Vt=0;4>Vt;Vt+=2){for(gn=0,jt=je.la>>4+Vt,sn=wt.la>>4+Vt,kt=0;2>kt;++kt){for(Cn=1&sn,In=0;2>In;++In)$t=Cn+(1&jt),jt=jt>>1|(Cn=0<($t=gl(ve,Ue[2],$t,st.Qc,0,We,bt)))<<3,gn=gn<<2|(3<$t?3:1<$t?2:We[bt+0]!=0),bt+=16;jt>>=2,sn=sn>>1|Cn<<5}At|=gn<<4*Vt,un|=jt<<4<<Vt,Ut|=(240&sn)<<Vt}je.la=un,wt.la=Ut,rt.Hc=vt,rt.Gc=At,rt.ia=43690&At?0:st.ia,Ue=!(vt|At)}if(0<Te.L&&(Te.wa[Te.Y+Te.ja]=Te.gd[me.$b][me.Za],Te.wa[Te.Y+Te.ja].La|=!Ue),He.Ka)return Qi(J,7,"Premature end-of-file encountered.")}if(ls(J),Te=ee,He=1,me=(Ae=J).D,je=0<Ae.L&&Ae.M>=Ae.zb&&Ae.M<=Ae.Va,Ae.Aa==0)t:{if(me.M=Ae.M,me.uc=je,Rs(Ae,me),He=1,me=(gn=Ae.D).Nb,je=(At=Ia[Ae.L])*Ae.R,ve=At/2*Ae.B,kt=16*me*Ae.R,In=8*me*Ae.B,Ue=Ae.sa,rt=Ae.ta-je+kt,st=Ae.qa,We=Ae.ra-ve+In,bt=Ae.Ha,wt=Ae.Ia-ve+In,sn=(jt=gn.M)==0,vt=jt>=Ae.Va-1,Ae.Aa==2&&Rs(Ae,gn),gn.uc)for(Cn=($t=Ae).D.M,e($t.D.uc),gn=$t.yb;gn<$t.Hb;++gn){Ut=gn,un=Cn;var _n=(Mn=(Ii=$t).D).Nb;Vt=Ii.R;var Mn=Mn.wa[Mn.Y+Ut],cr=Ii.sa,kr=Ii.ta+16*_n*Vt+16*Ut,er=Mn.dd,ar=Mn.tc;if(ar!=0)if(e(3<=ar),Ii.L==1)0<Ut&&Wl(cr,kr,Vt,ar+4),Mn.La&&eu(cr,kr,Vt,ar),0<un&&Ur(cr,kr,Vt,ar+4),Mn.La&&Zs(cr,kr,Vt,ar);else{var Wr=Ii.B,hi=Ii.qa,_r=Ii.ra+8*_n*Wr+8*Ut,Ti=Ii.Ha,Ii=Ii.Ia+8*_n*Wr+8*Ut;_n=Mn.ld,0<Ut&&(la(cr,kr,Vt,ar+4,er,_n),sc(hi,_r,Ti,Ii,Wr,ar+4,er,_n)),Mn.La&&(hu(cr,kr,Vt,ar,er,_n),nl(hi,_r,Ti,Ii,Wr,ar,er,_n)),0<un&&(yr(cr,kr,Vt,ar+4,er,_n),oc(hi,_r,Ti,Ii,Wr,ar+4,er,_n)),Mn.La&&(Il(cr,kr,Vt,ar,er,_n),ac(hi,_r,Ti,Ii,Wr,ar,er,_n))}}if(Ae.ia&&alert("todo:DitherRow"),Te.put!=null){if(gn=16*jt,jt=16*(jt+1),sn?(Te.y=Ae.sa,Te.O=Ae.ta+kt,Te.f=Ae.qa,Te.N=Ae.ra+In,Te.ea=Ae.Ha,Te.W=Ae.Ia+In):(gn-=At,Te.y=Ue,Te.O=rt,Te.f=st,Te.N=We,Te.ea=bt,Te.W=wt),vt||(jt-=At),jt>Te.o&&(jt=Te.o),Te.F=null,Te.J=null,Ae.Fa!=null&&0<Ae.Fa.length&&gn<jt&&(Te.J=_s(Ae,Te,gn,jt-gn),Te.F=Ae.mb,Te.F==null&&Te.F.length==0)){He=Qi(Ae,3,"Could not decode alpha data.");break t}gn<Te.j&&(At=Te.j-gn,gn=Te.j,e(!(1&At)),Te.O+=Ae.R*At,Te.N+=Ae.B*(At>>1),Te.W+=Ae.B*(At>>1),Te.F!=null&&(Te.J+=Te.width*At)),gn<jt&&(Te.O+=Te.v,Te.N+=Te.v>>1,Te.W+=Te.v>>1,Te.F!=null&&(Te.J+=Te.v),Te.ka=gn-Te.j,Te.U=Te.va-Te.v,Te.T=jt-gn,He=Te.put(Te))}me+1!=Ae.Ic||vt||(i(Ae.sa,Ae.ta-je,Ue,rt+16*Ae.R,je),i(Ae.qa,Ae.ra-ve,st,We+8*Ae.B,ve),i(Ae.Ha,Ae.Ia-ve,bt,wt+8*Ae.B,ve))}if(!He)return Qi(J,6,"Output aborted.")}return 1})(ft,Ot)),Ot.bc!=null&&Ot.bc(Ot),Kt&=1}return Kt?(ft.cb=0,Kt):0})(C,ie)||(F=C.a)}}else F=C.a}F==0&&qe.Oa!=null&&qe.Oa.fd&&(F=Xc(qe.ba))}qe=F}Be=qe!=0?null:11>Be?Ke.f.RGBA.eb:Ke.f.kb.y}else Be=null;return Be};var kh=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function w(D,$){for(var z="",W=0;W<4;W++)z+=String.fromCharCode(D[$++]);return z}function I(D,$){return D[$+0]|D[$+1]<<8}function O(D,$){return(D[$+0]|D[$+1]<<8|D[$+2]<<16)>>>0}function V(D,$){return(D[$+0]|D[$+1]<<8|D[$+2]<<16|D[$+3]<<24)>>>0}new o;var M=[0],se=[0],ce=[],fe=new o,ne=n,oe=(function(D,$){var z={},W=0,Z=!1,Ee=0,ke=0;if(z.frames=[],!(function(ae,Me){for(var Fe=0;Fe<4;Fe++)if(ae[Me+Fe]!="RIFF".charCodeAt(Fe))return!0;return!1})(D,$)){for(V(D,$+=4),$+=8;$<D.length;){var Oe=w(D,$),Re=V(D,$+=4);$+=4;var be=Re+(1&Re);switch(Oe){case"VP8 ":case"VP8L":z.frames[W]===void 0&&(z.frames[W]={}),(xe=z.frames[W]).src_off=Z?ke:$-8,xe.src_size=Ee+Re+8,W++,Z&&(Z=!1,Ee=0,ke=0);break;case"VP8X":(xe=z.header={}).feature_flags=D[$];var De=$+4;xe.canvas_width=1+O(D,De),De+=3,xe.canvas_height=1+O(D,De),De+=3;break;case"ALPH":Z=!0,Ee=be+8,ke=$-8;break;case"ANIM":(xe=z.header).bgcolor=V(D,$),De=$+4,xe.loop_count=I(D,De),De+=2;break;case"ANMF":var Qe,xe;(xe=z.frames[W]={}).offset_x=2*O(D,$),$+=3,xe.offset_y=2*O(D,$),$+=3,xe.width=1+O(D,$),$+=3,xe.height=1+O(D,$),$+=3,xe.duration=O(D,$),$+=3,Qe=D[$++],xe.dispose=1&Qe,xe.blend=Qe>>1&1}Oe!="ANMF"&&($+=be)}return z}})(ne,0);oe.response=ne,oe.rgbaoutput=!0,oe.dataurl=!1;var ye=oe.header?oe.header:null,he=oe.frames?oe.frames:null;if(ye){ye.loop_counter=ye.loop_count,M=[ye.canvas_height],se=[ye.canvas_width];for(var Ne=0;Ne<he.length&&he[Ne].blend!=0;Ne++);}var Ve=he[0],de=fe.WebPDecodeRGBA(ne,Ve.src_off,Ve.src_size,se,M);Ve.rgba=de,Ve.imgwidth=se[0],Ve.imgheight=M[0];for(var j=0;j<se[0]*M[0]*4;j++)ce[j]=de[j];return this.width=se,this.height=M,this.data=ce,this}(function(n){var e,t,i,c,u,m,_,o,w,I=function(ae){return ae=ae||{},this.isStrokeTransparent=ae.isStrokeTransparent||!1,this.strokeOpacity=ae.strokeOpacity||1,this.strokeStyle=ae.strokeStyle||"#000000",this.fillStyle=ae.fillStyle||"#000000",this.isFillTransparent=ae.isFillTransparent||!1,this.fillOpacity=ae.fillOpacity||1,this.font=ae.font||"10px sans-serif",this.textBaseline=ae.textBaseline||"alphabetic",this.textAlign=ae.textAlign||"left",this.lineWidth=ae.lineWidth||1,this.lineJoin=ae.lineJoin||"miter",this.lineCap=ae.lineCap||"butt",this.path=ae.path||[],this.transform=ae.transform!==void 0?ae.transform.clone():new o,this.globalCompositeOperation=ae.globalCompositeOperation||"normal",this.globalAlpha=ae.globalAlpha||1,this.clip_path=ae.clip_path||[],this.currentPoint=ae.currentPoint||new m,this.miterLimit=ae.miterLimit||10,this.lastPoint=ae.lastPoint||new m,this.lineDashOffset=ae.lineDashOffset||0,this.lineDash=ae.lineDash||[],this.margin=ae.margin||[0,0,0,0],this.prevPageLastElemOffset=ae.prevPageLastElemOffset||0,this.ignoreClearRect=typeof ae.ignoreClearRect!="boolean"||ae.ignoreClearRect,this};n.events.push(["initialized",function(){this.context2d=new O(this),e=this.internal.f2,t=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,c=this.internal.getHorizontalCoordinate,u=this.internal.getVerticalCoordinate,m=this.internal.Point,_=this.internal.Rectangle,o=this.internal.Matrix,w=new I}]);var O=function(ae){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Me=ae;Object.defineProperty(this,"pdf",{get:function(){return Me}});var Fe=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Fe},set:function(zt){Fe=!!zt}});var Ze=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Ze},set:function(zt){Ze=!!zt}});var et=0;Object.defineProperty(this,"posX",{get:function(){return et},set:function(zt){isNaN(zt)||(et=zt)}});var mt=0;Object.defineProperty(this,"posY",{get:function(){return mt},set:function(zt){isNaN(zt)||(mt=zt)}}),Object.defineProperty(this,"margin",{get:function(){return w.margin},set:function(zt){var it;typeof zt=="number"?it=[zt,zt,zt,zt]:((it=new Array(4))[0]=zt[0],it[1]=zt.length>=2?zt[1]:it[0],it[2]=zt.length>=3?zt[2]:it[0],it[3]=zt.length>=4?zt[3]:it[1]),w.margin=it}});var ht=!1;Object.defineProperty(this,"autoPaging",{get:function(){return ht},set:function(zt){ht=zt}});var Nt=0;Object.defineProperty(this,"lastBreak",{get:function(){return Nt},set:function(zt){Nt=zt}});var Jt=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Jt},set:function(zt){Jt=zt}}),Object.defineProperty(this,"ctx",{get:function(){return w},set:function(zt){zt instanceof I&&(w=zt)}}),Object.defineProperty(this,"path",{get:function(){return w.path},set:function(zt){w.path=zt}});var tn=[];Object.defineProperty(this,"ctxStack",{get:function(){return tn},set:function(zt){tn=zt}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(zt){var it;it=V(zt),this.ctx.fillStyle=it.style,this.ctx.isFillTransparent=it.a===0,this.ctx.fillOpacity=it.a,this.pdf.setFillColor(it.r,it.g,it.b,{a:it.a}),this.pdf.setTextColor(it.r,it.g,it.b,{a:it.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(zt){var it=V(zt);this.ctx.strokeStyle=it.style,this.ctx.isStrokeTransparent=it.a===0,this.ctx.strokeOpacity=it.a,it.a===0?this.pdf.setDrawColor(255,255,255):(it.a,this.pdf.setDrawColor(it.r,it.g,it.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(zt){["butt","round","square"].indexOf(zt)!==-1&&(this.ctx.lineCap=zt,this.pdf.setLineCap(zt))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(zt){isNaN(zt)||(this.ctx.lineWidth=zt,this.pdf.setLineWidth(zt))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(zt){["bevel","round","miter"].indexOf(zt)!==-1&&(this.ctx.lineJoin=zt,this.pdf.setLineJoin(zt))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(zt){isNaN(zt)||(this.ctx.miterLimit=zt,this.pdf.setMiterLimit(zt))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(zt){this.ctx.textBaseline=zt}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(zt){["right","end","center","left","start"].indexOf(zt)!==-1&&(this.ctx.textAlign=zt)}});var fn=null,An=null;Object.defineProperty(this,"fontFaces",{get:function(){return An},set:function(zt){fn=null,An=zt}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(zt){var it;if(this.ctx.font=zt,(it=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(zt))!==null){var ur=it[1];it[2];var xr=it[3],Tr=it[4];it[5];var Tn=it[6],Yn=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Tr)[2];Tr=Math.floor(Yn==="px"?parseFloat(Tr)*this.pdf.internal.scaleFactor:Yn==="em"?parseFloat(Tr)*this.pdf.getFontSize():parseFloat(Tr)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Tr);var $n=(function(br){var Ir,Bi,Mi=[],pr=br.trim();if(pr==="")return yb;if(pr in lS)return[lS[pr]];for(;pr!=="";){switch(Bi=null,Ir=(pr=uS(pr)).charAt(0)){case'"':case"'":Bi=aM(pr.substring(1),Ir);break;default:Bi=lM(pr)}if(Bi===null||(Mi.push(Bi[0]),(pr=uS(Bi[1]))!==""&&pr.charAt(0)!==","))return yb;pr=pr.replace(/^,/,"")}return Mi})(Tn);if(this.fontFaces){var hr=(function(br,Ir){if(fn===null){var Bi=(function(Mi){var pr=[];return Object.keys(Mi).forEach(function(Jr){Mi[Jr].forEach(function(Kr){var Sr=null;switch(Kr){case"bold":Sr={family:Jr,weight:"bold"};break;case"italic":Sr={family:Jr,style:"italic"};break;case"bolditalic":Sr={family:Jr,weight:"bold",style:"italic"};break;case"":case"normal":Sr={family:Jr}}Sr!==null&&(Sr.ref={name:Jr,style:Kr},pr.push(Sr))})}),pr})(br.getFontList());fn=(function(Mi){for(var pr={},Jr=0;Jr<Mi.length;++Jr){var Kr=gb(Mi[Jr]),Sr=Kr.family,ui=Kr.stretch,ii=Kr.style,ut=Kr.weight;pr[Sr]=pr[Sr]||{},pr[Sr][ui]=pr[Sr][ui]||{},pr[Sr][ui][ii]=pr[Sr][ui][ii]||{},pr[Sr][ui][ii][ut]=Kr}return pr})(Bi.concat(Ir))}return fn})(this.pdf,this.fontFaces),Wt=$n.map(function(br){return{family:br,stretch:"normal",weight:xr,style:ur}}),Nn=(function(br,Ir,Bi){for(var Mi=(Bi=Bi||{}).defaultFontFamily||"times",pr=Object.assign({},sM,Bi.genericFontFamilies||{}),Jr=null,Kr=null,Sr=0;Sr<Ir.length;++Sr)if(pr[(Jr=gb(Ir[Sr])).family]&&(Jr.family=pr[Jr.family]),br.hasOwnProperty(Jr.family)){Kr=br[Jr.family];break}if(!(Kr=Kr||br[Mi]))throw new Error("Could not find a font-family for the rule '"+cS(Jr)+"' and default family '"+Mi+"'.");if(Kr=(function(ui,ii){if(ii[ui])return ii[ui];var ut=l5[ui],we=ut<=l5.normal?-1:1,Ie=aS(ii,s6,ut,we);if(!Ie)throw new Error("Could not find a matching font-stretch value for "+ui);return Ie})(Jr.stretch,Kr),Kr=(function(ui,ii){if(ii[ui])return ii[ui];for(var ut=o6[ui],we=0;we<ut.length;++we)if(ii[ut[we]])return ii[ut[we]];throw new Error("Could not find a matching font-style for "+ui)})(Jr.style,Kr),!(Kr=(function(ui,ii){if(ii[ui])return ii[ui];if(ui===400&&ii[500])return ii[500];if(ui===500&&ii[400])return ii[400];var ut=oM[ui],we=aS(ii,a6,ut,ui<400?-1:1);if(!we)throw new Error("Could not find a matching font-weight for value "+ui);return we})(Jr.weight,Kr)))throw new Error("Failed to resolve a font for the rule '"+cS(Jr)+"'.");return Kr})(hr,Wt);this.pdf.setFont(Nn.ref.name,Nn.ref.style)}else{var tr="";(xr==="bold"||parseInt(xr,10)>=700||ur==="bold")&&(tr="bold"),ur==="italic"&&(tr+="italic"),tr.length===0&&(tr="normal");for(var Hn="",Rr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},lr=0;lr<$n.length;lr++){if(this.pdf.internal.getFont($n[lr],tr,{noFallback:!0,disableWarning:!0})!==void 0){Hn=$n[lr];break}if(tr==="bolditalic"&&this.pdf.internal.getFont($n[lr],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Hn=$n[lr],tr="bold";else if(this.pdf.internal.getFont($n[lr],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Hn=$n[lr],tr="normal";break}}if(Hn===""){for(var wr=0;wr<$n.length;wr++)if(Rr[$n[wr]]){Hn=Rr[$n[wr]];break}}Hn=Hn===""?"Times":Hn,this.pdf.setFont(Hn,tr)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(zt){this.ctx.globalCompositeOperation=zt}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(zt){this.ctx.globalAlpha=zt}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(zt){this.ctx.lineDashOffset=zt,xe.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(zt){this.ctx.lineDash=zt,xe.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(zt){this.ctx.ignoreClearRect=!!zt}})};O.prototype.setLineDash=function(ae){this.lineDash=ae},O.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},O.prototype.fill=function(){he.call(this,"fill",!1)},O.prototype.stroke=function(){he.call(this,"stroke",!1)},O.prototype.beginPath=function(){this.path=[{type:"begin"}]},O.prototype.moveTo=function(ae,Me){if(isNaN(ae)||isNaN(Me))throw za.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Fe=this.ctx.transform.applyToPoint(new m(ae,Me));this.path.push({type:"mt",x:Fe.x,y:Fe.y}),this.ctx.lastPoint=new m(ae,Me)},O.prototype.closePath=function(){var ae=new m(0,0),Me=0;for(Me=this.path.length-1;Me!==-1;Me--)if(this.path[Me].type==="begin"&&ba(this.path[Me+1])==="object"&&typeof this.path[Me+1].x=="number"){ae=new m(this.path[Me+1].x,this.path[Me+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new m(ae.x,ae.y)},O.prototype.lineTo=function(ae,Me){if(isNaN(ae)||isNaN(Me))throw za.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Fe=this.ctx.transform.applyToPoint(new m(ae,Me));this.path.push({type:"lt",x:Fe.x,y:Fe.y}),this.ctx.lastPoint=new m(Fe.x,Fe.y)},O.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),he.call(this,null,!0)},O.prototype.quadraticCurveTo=function(ae,Me,Fe,Ze){if(isNaN(Fe)||isNaN(Ze)||isNaN(ae)||isNaN(Me))throw za.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var et=this.ctx.transform.applyToPoint(new m(Fe,Ze)),mt=this.ctx.transform.applyToPoint(new m(ae,Me));this.path.push({type:"qct",x1:mt.x,y1:mt.y,x:et.x,y:et.y}),this.ctx.lastPoint=new m(et.x,et.y)},O.prototype.bezierCurveTo=function(ae,Me,Fe,Ze,et,mt){if(isNaN(et)||isNaN(mt)||isNaN(ae)||isNaN(Me)||isNaN(Fe)||isNaN(Ze))throw za.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var ht=this.ctx.transform.applyToPoint(new m(et,mt)),Nt=this.ctx.transform.applyToPoint(new m(ae,Me)),Jt=this.ctx.transform.applyToPoint(new m(Fe,Ze));this.path.push({type:"bct",x1:Nt.x,y1:Nt.y,x2:Jt.x,y2:Jt.y,x:ht.x,y:ht.y}),this.ctx.lastPoint=new m(ht.x,ht.y)},O.prototype.arc=function(ae,Me,Fe,Ze,et,mt){if(isNaN(ae)||isNaN(Me)||isNaN(Fe)||isNaN(Ze)||isNaN(et))throw za.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(mt=!!mt,!this.ctx.transform.isIdentity){var ht=this.ctx.transform.applyToPoint(new m(ae,Me));ae=ht.x,Me=ht.y;var Nt=this.ctx.transform.applyToPoint(new m(0,Fe)),Jt=this.ctx.transform.applyToPoint(new m(0,0));Fe=Math.sqrt(Math.pow(Nt.x-Jt.x,2)+Math.pow(Nt.y-Jt.y,2))}Math.abs(et-Ze)>=2*Math.PI&&(Ze=0,et=2*Math.PI),this.path.push({type:"arc",x:ae,y:Me,radius:Fe,startAngle:Ze,endAngle:et,counterclockwise:mt})},O.prototype.arcTo=function(ae,Me,Fe,Ze,et){throw new Error("arcTo not implemented.")},O.prototype.rect=function(ae,Me,Fe,Ze){if(isNaN(ae)||isNaN(Me)||isNaN(Fe)||isNaN(Ze))throw za.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(ae,Me),this.lineTo(ae+Fe,Me),this.lineTo(ae+Fe,Me+Ze),this.lineTo(ae,Me+Ze),this.lineTo(ae,Me),this.lineTo(ae+Fe,Me),this.lineTo(ae,Me)},O.prototype.fillRect=function(ae,Me,Fe,Ze){if(isNaN(ae)||isNaN(Me)||isNaN(Fe)||isNaN(Ze))throw za.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!M.call(this)){var et={};this.lineCap!=="butt"&&(et.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(et.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(ae,Me,Fe,Ze),this.fill(),et.hasOwnProperty("lineCap")&&(this.lineCap=et.lineCap),et.hasOwnProperty("lineJoin")&&(this.lineJoin=et.lineJoin)}},O.prototype.strokeRect=function(ae,Me,Fe,Ze){if(isNaN(ae)||isNaN(Me)||isNaN(Fe)||isNaN(Ze))throw za.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");se.call(this)||(this.beginPath(),this.rect(ae,Me,Fe,Ze),this.stroke())},O.prototype.clearRect=function(ae,Me,Fe,Ze){if(isNaN(ae)||isNaN(Me)||isNaN(Fe)||isNaN(Ze))throw za.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(ae,Me,Fe,Ze))},O.prototype.save=function(ae){ae=typeof ae!="boolean"||ae;for(var Me=this.pdf.internal.getCurrentPageInfo().pageNumber,Fe=0;Fe<this.pdf.internal.getNumberOfPages();Fe++)this.pdf.setPage(Fe+1),this.pdf.internal.out("q");if(this.pdf.setPage(Me),ae){this.ctx.fontSize=this.pdf.internal.getFontSize();var Ze=new I(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Ze}},O.prototype.restore=function(ae){ae=typeof ae!="boolean"||ae;for(var Me=this.pdf.internal.getCurrentPageInfo().pageNumber,Fe=0;Fe<this.pdf.internal.getNumberOfPages();Fe++)this.pdf.setPage(Fe+1),this.pdf.internal.out("Q");this.pdf.setPage(Me),ae&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},O.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var V=function(ae){var Me,Fe,Ze,et;if(ae.isCanvasGradient===!0&&(ae=ae.getColor()),!ae)return{r:0,g:0,b:0,a:0,style:ae};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(ae))Me=0,Fe=0,Ze=0,et=0;else{var mt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(ae);if(mt!==null)Me=parseInt(mt[1]),Fe=parseInt(mt[2]),Ze=parseInt(mt[3]),et=1;else if((mt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(ae))!==null)Me=parseInt(mt[1]),Fe=parseInt(mt[2]),Ze=parseInt(mt[3]),et=parseFloat(mt[4]);else{if(et=1,typeof ae=="string"&&ae.charAt(0)!=="#"){var ht=new JT(ae);ae=ht.ok?ht.toHex():"#000000"}ae.length===4?(Me=ae.substring(1,2),Me+=Me,Fe=ae.substring(2,3),Fe+=Fe,Ze=ae.substring(3,4),Ze+=Ze):(Me=ae.substring(1,3),Fe=ae.substring(3,5),Ze=ae.substring(5,7)),Me=parseInt(Me,16),Fe=parseInt(Fe,16),Ze=parseInt(Ze,16)}}return{r:Me,g:Fe,b:Ze,a:et,style:ae}},M=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},se=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};O.prototype.fillText=function(ae,Me,Fe,Ze){if(isNaN(Me)||isNaN(Fe)||typeof ae!="string")throw za.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Ze=isNaN(Ze)?void 0:Ze,!M.call(this)){var et=be(this.ctx.transform.rotation),mt=this.ctx.transform.scaleX;W.call(this,{text:ae,x:Me,y:Fe,scale:mt,angle:et,align:this.textAlign,maxWidth:Ze})}},O.prototype.strokeText=function(ae,Me,Fe,Ze){if(isNaN(Me)||isNaN(Fe)||typeof ae!="string")throw za.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!se.call(this)){Ze=isNaN(Ze)?void 0:Ze;var et=be(this.ctx.transform.rotation),mt=this.ctx.transform.scaleX;W.call(this,{text:ae,x:Me,y:Fe,scale:mt,renderingMode:"stroke",angle:et,align:this.textAlign,maxWidth:Ze})}},O.prototype.measureText=function(ae){if(typeof ae!="string")throw za.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Me=this.pdf,Fe=this.pdf.internal.scaleFactor,Ze=Me.internal.getFontSize(),et=Me.getStringUnitWidth(ae)*Ze/Me.internal.scaleFactor;return new function(mt){var ht=(mt=mt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return ht}}),this}({width:et*=Math.round(96*Fe/72*1e4)/1e4})},O.prototype.scale=function(ae,Me){if(isNaN(ae)||isNaN(Me))throw za.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Fe=new o(ae,0,0,Me,0,0);this.ctx.transform=this.ctx.transform.multiply(Fe)},O.prototype.rotate=function(ae){if(isNaN(ae))throw za.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Me=new o(Math.cos(ae),Math.sin(ae),-Math.sin(ae),Math.cos(ae),0,0);this.ctx.transform=this.ctx.transform.multiply(Me)},O.prototype.translate=function(ae,Me){if(isNaN(ae)||isNaN(Me))throw za.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Fe=new o(1,0,0,1,ae,Me);this.ctx.transform=this.ctx.transform.multiply(Fe)},O.prototype.transform=function(ae,Me,Fe,Ze,et,mt){if(isNaN(ae)||isNaN(Me)||isNaN(Fe)||isNaN(Ze)||isNaN(et)||isNaN(mt))throw za.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var ht=new o(ae,Me,Fe,Ze,et,mt);this.ctx.transform=this.ctx.transform.multiply(ht)},O.prototype.setTransform=function(ae,Me,Fe,Ze,et,mt){ae=isNaN(ae)?1:ae,Me=isNaN(Me)?0:Me,Fe=isNaN(Fe)?0:Fe,Ze=isNaN(Ze)?1:Ze,et=isNaN(et)?0:et,mt=isNaN(mt)?0:mt,this.ctx.transform=new o(ae,Me,Fe,Ze,et,mt)};var ce=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};O.prototype.drawImage=function(ae,Me,Fe,Ze,et,mt,ht,Nt,Jt){var tn=this.pdf.getImageProperties(ae),fn=1,An=1,zt=1,it=1;Ze!==void 0&&Nt!==void 0&&(zt=Nt/Ze,it=Jt/et,fn=tn.width/Ze*Nt/Ze,An=tn.height/et*Jt/et),mt===void 0&&(mt=Me,ht=Fe,Me=0,Fe=0),Ze!==void 0&&Nt===void 0&&(Nt=Ze,Jt=et),Ze===void 0&&Nt===void 0&&(Nt=tn.width,Jt=tn.height);for(var ur,xr=this.ctx.transform.decompose(),Tr=be(xr.rotate.shx),Tn=new o,Yn=(Tn=(Tn=(Tn=Tn.multiply(xr.translate)).multiply(xr.skew)).multiply(xr.scale)).applyToRectangle(new _(mt-Me*zt,ht-Fe*it,Ze*fn,et*An)),$n=fe.call(this,Yn),hr=[],Wt=0;Wt<$n.length;Wt+=1)hr.indexOf($n[Wt])===-1&&hr.push($n[Wt]);if(ye(hr),this.autoPaging)for(var Nn=hr[0],tr=hr[hr.length-1],Hn=Nn;Hn<tr+1;Hn++){this.pdf.setPage(Hn);var Rr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],lr=Hn===1?this.posY+this.margin[0]:this.margin[0],wr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],br=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Ir=Hn===1?0:wr+(Hn-2)*br;if(this.ctx.clip_path.length!==0){var Bi=this.path;ur=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=oe(ur,this.posX+this.margin[3],-Ir+lr+this.ctx.prevPageLastElemOffset),Ne.call(this,"fill",!0),this.path=Bi}var Mi=JSON.parse(JSON.stringify(Yn));Mi=oe([Mi],this.posX+this.margin[3],-Ir+lr+this.ctx.prevPageLastElemOffset)[0];var pr=(Hn>Nn||Hn<tr)&&ce.call(this);pr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Rr,br,null).clip().discardPath()),this.pdf.addImage(ae,"JPEG",Mi.x,Mi.y,Mi.w,Mi.h,null,null,Tr),pr&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(ae,"JPEG",Yn.x,Yn.y,Yn.w,Yn.h,null,null,Tr)};var fe=function(ae,Me,Fe){var Ze=[];Me=Me||this.pdf.internal.pageSize.width,Fe=Fe||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var et=this.posY+this.ctx.prevPageLastElemOffset;switch(ae.type){default:case"mt":case"lt":Ze.push(Math.floor((ae.y+et)/Fe)+1);break;case"arc":Ze.push(Math.floor((ae.y+et-ae.radius)/Fe)+1),Ze.push(Math.floor((ae.y+et+ae.radius)/Fe)+1);break;case"qct":var mt=De(this.ctx.lastPoint.x,this.ctx.lastPoint.y,ae.x1,ae.y1,ae.x,ae.y);Ze.push(Math.floor((mt.y+et)/Fe)+1),Ze.push(Math.floor((mt.y+mt.h+et)/Fe)+1);break;case"bct":var ht=Qe(this.ctx.lastPoint.x,this.ctx.lastPoint.y,ae.x1,ae.y1,ae.x2,ae.y2,ae.x,ae.y);Ze.push(Math.floor((ht.y+et)/Fe)+1),Ze.push(Math.floor((ht.y+ht.h+et)/Fe)+1);break;case"rect":Ze.push(Math.floor((ae.y+et)/Fe)+1),Ze.push(Math.floor((ae.y+ae.h+et)/Fe)+1)}for(var Nt=0;Nt<Ze.length;Nt+=1)for(;this.pdf.internal.getNumberOfPages()<Ze[Nt];)ne.call(this);return Ze},ne=function(){var ae=this.fillStyle,Me=this.strokeStyle,Fe=this.font,Ze=this.lineCap,et=this.lineWidth,mt=this.lineJoin;this.pdf.addPage(),this.fillStyle=ae,this.strokeStyle=Me,this.font=Fe,this.lineCap=Ze,this.lineWidth=et,this.lineJoin=mt},oe=function(ae,Me,Fe){for(var Ze=0;Ze<ae.length;Ze++)switch(ae[Ze].type){case"bct":ae[Ze].x2+=Me,ae[Ze].y2+=Fe;case"qct":ae[Ze].x1+=Me,ae[Ze].y1+=Fe;default:ae[Ze].x+=Me,ae[Ze].y+=Fe}return ae},ye=function(ae){return ae.sort(function(Me,Fe){return Me-Fe})},he=function(ae,Me){for(var Fe,Ze,et=this.fillStyle,mt=this.strokeStyle,ht=this.lineCap,Nt=this.lineWidth,Jt=Math.abs(Nt*this.ctx.transform.scaleX),tn=this.lineJoin,fn=JSON.parse(JSON.stringify(this.path)),An=JSON.parse(JSON.stringify(this.path)),zt=[],it=0;it<An.length;it++)if(An[it].x!==void 0)for(var ur=fe.call(this,An[it]),xr=0;xr<ur.length;xr+=1)zt.indexOf(ur[xr])===-1&&zt.push(ur[xr]);for(var Tr=0;Tr<zt.length;Tr++)for(;this.pdf.internal.getNumberOfPages()<zt[Tr];)ne.call(this);if(ye(zt),this.autoPaging)for(var Tn=zt[0],Yn=zt[zt.length-1],$n=Tn;$n<Yn+1;$n++){this.pdf.setPage($n),this.fillStyle=et,this.strokeStyle=mt,this.lineCap=ht,this.lineWidth=Jt,this.lineJoin=tn;var hr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Wt=$n===1?this.posY+this.margin[0]:this.margin[0],Nn=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],tr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Hn=$n===1?0:Nn+($n-2)*tr;if(this.ctx.clip_path.length!==0){var Rr=this.path;Fe=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=oe(Fe,this.posX+this.margin[3],-Hn+Wt+this.ctx.prevPageLastElemOffset),Ne.call(this,ae,!0),this.path=Rr}if(Ze=JSON.parse(JSON.stringify(fn)),this.path=oe(Ze,this.posX+this.margin[3],-Hn+Wt+this.ctx.prevPageLastElemOffset),Me===!1||$n===0){var lr=($n>Tn||$n<Yn)&&ce.call(this);lr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],hr,tr,null).clip().discardPath()),Ne.call(this,ae,Me),lr&&this.pdf.restoreGraphicsState()}this.lineWidth=Nt}else this.lineWidth=Jt,Ne.call(this,ae,Me),this.lineWidth=Nt;this.path=fn},Ne=function(ae,Me){if((ae!=="stroke"||Me||!se.call(this))&&(ae==="stroke"||Me||!M.call(this))){for(var Fe,Ze,et=[],mt=this.path,ht=0;ht<mt.length;ht++){var Nt=mt[ht];switch(Nt.type){case"begin":et.push({begin:!0});break;case"close":et.push({close:!0});break;case"mt":et.push({start:Nt,deltas:[],abs:[]});break;case"lt":var Jt=et.length;if(mt[ht-1]&&!isNaN(mt[ht-1].x)&&(Fe=[Nt.x-mt[ht-1].x,Nt.y-mt[ht-1].y],Jt>0)){for(;Jt>=0;Jt--)if(et[Jt-1].close!==!0&&et[Jt-1].begin!==!0){et[Jt-1].deltas.push(Fe),et[Jt-1].abs.push(Nt);break}}break;case"bct":Fe=[Nt.x1-mt[ht-1].x,Nt.y1-mt[ht-1].y,Nt.x2-mt[ht-1].x,Nt.y2-mt[ht-1].y,Nt.x-mt[ht-1].x,Nt.y-mt[ht-1].y],et[et.length-1].deltas.push(Fe);break;case"qct":var tn=mt[ht-1].x+2/3*(Nt.x1-mt[ht-1].x),fn=mt[ht-1].y+2/3*(Nt.y1-mt[ht-1].y),An=Nt.x+2/3*(Nt.x1-Nt.x),zt=Nt.y+2/3*(Nt.y1-Nt.y),it=Nt.x,ur=Nt.y;Fe=[tn-mt[ht-1].x,fn-mt[ht-1].y,An-mt[ht-1].x,zt-mt[ht-1].y,it-mt[ht-1].x,ur-mt[ht-1].y],et[et.length-1].deltas.push(Fe);break;case"arc":et.push({deltas:[],abs:[],arc:!0}),Array.isArray(et[et.length-1].abs)&&et[et.length-1].abs.push(Nt)}}Ze=Me?null:ae==="stroke"?"stroke":"fill";for(var xr=!1,Tr=0;Tr<et.length;Tr++)if(et[Tr].arc)for(var Tn=et[Tr].abs,Yn=0;Yn<Tn.length;Yn++){var $n=Tn[Yn];$n.type==="arc"?j.call(this,$n.x,$n.y,$n.radius,$n.startAngle,$n.endAngle,$n.counterclockwise,void 0,Me,!xr):Z.call(this,$n.x,$n.y),xr=!0}else if(et[Tr].close===!0)this.pdf.internal.out("h"),xr=!1;else if(et[Tr].begin!==!0){var hr=et[Tr].start.x,Wt=et[Tr].start.y;Ee.call(this,et[Tr].deltas,hr,Wt),xr=!0}Ze&&D.call(this,Ze),Me&&$.call(this)}},Ve=function(ae){var Me=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Fe=Me*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return ae-Fe;case"top":return ae+Me-Fe;case"hanging":return ae+Me-2*Fe;case"middle":return ae+Me/2-Fe;default:return ae}},de=function(ae){return ae+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};O.prototype.createLinearGradient=function(){var ae=function(){};return ae.colorStops=[],ae.addColorStop=function(Me,Fe){this.colorStops.push([Me,Fe])},ae.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},ae.isCanvasGradient=!0,ae},O.prototype.createPattern=function(){return this.createLinearGradient()},O.prototype.createRadialGradient=function(){return this.createLinearGradient()};var j=function(ae,Me,Fe,Ze,et,mt,ht,Nt,Jt){for(var tn=Oe.call(this,Fe,Ze,et,mt),fn=0;fn<tn.length;fn++){var An=tn[fn];fn===0&&(Jt?z.call(this,An.x1+ae,An.y1+Me):Z.call(this,An.x1+ae,An.y1+Me)),ke.call(this,ae,Me,An.x2,An.y2,An.x3,An.y3,An.x4,An.y4)}Nt?$.call(this):D.call(this,ht)},D=function(ae){switch(ae){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},$=function(){this.pdf.clip(),this.pdf.discardPath()},z=function(ae,Me){this.pdf.internal.out(t(ae)+" "+i(Me)+" m")},W=function(ae){var Me;switch(ae.align){case"right":case"end":Me="right";break;case"center":Me="center";break;default:Me="left"}var Fe=this.pdf.getTextDimensions(ae.text),Ze=Ve.call(this,ae.y),et=de.call(this,Ze)-Fe.h,mt=this.ctx.transform.applyToPoint(new m(ae.x,Ze)),ht=this.ctx.transform.decompose(),Nt=new o;Nt=(Nt=(Nt=Nt.multiply(ht.translate)).multiply(ht.skew)).multiply(ht.scale);for(var Jt,tn,fn,An=this.ctx.transform.applyToRectangle(new _(ae.x,Ze,Fe.w,Fe.h)),zt=Nt.applyToRectangle(new _(ae.x,et,Fe.w,Fe.h)),it=fe.call(this,zt),ur=[],xr=0;xr<it.length;xr+=1)ur.indexOf(it[xr])===-1&&ur.push(it[xr]);if(ye(ur),this.autoPaging)for(var Tr=ur[0],Tn=ur[ur.length-1],Yn=Tr;Yn<Tn+1;Yn++){this.pdf.setPage(Yn);var $n=Yn===1?this.posY+this.margin[0]:this.margin[0],hr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Wt=this.pdf.internal.pageSize.height-this.margin[2],Nn=Wt-this.margin[0],tr=this.pdf.internal.pageSize.width-this.margin[1],Hn=tr-this.margin[3],Rr=Yn===1?0:hr+(Yn-2)*Nn;if(this.ctx.clip_path.length!==0){var lr=this.path;Jt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=oe(Jt,this.posX+this.margin[3],-1*Rr+$n),Ne.call(this,"fill",!0),this.path=lr}var wr=oe([JSON.parse(JSON.stringify(zt))],this.posX+this.margin[3],-Rr+$n+this.ctx.prevPageLastElemOffset)[0];ae.scale>=.01&&(tn=this.pdf.internal.getFontSize(),this.pdf.setFontSize(tn*ae.scale),fn=this.lineWidth,this.lineWidth=fn*ae.scale);var br=this.autoPaging!=="text";if(br||wr.y+wr.h<=Wt){if(br||wr.y>=$n&&wr.x<=tr){var Ir=br?ae.text:this.pdf.splitTextToSize(ae.text,ae.maxWidth||tr-wr.x)[0],Bi=oe([JSON.parse(JSON.stringify(An))],this.posX+this.margin[3],-Rr+$n+this.ctx.prevPageLastElemOffset)[0],Mi=br&&(Yn>Tr||Yn<Tn)&&ce.call(this);Mi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Hn,Nn,null).clip().discardPath()),this.pdf.text(Ir,Bi.x,Bi.y,{angle:ae.angle,align:Me,renderingMode:ae.renderingMode}),Mi&&this.pdf.restoreGraphicsState()}}else wr.y<Wt&&(this.ctx.prevPageLastElemOffset+=Wt-wr.y);ae.scale>=.01&&(this.pdf.setFontSize(tn),this.lineWidth=fn)}else ae.scale>=.01&&(tn=this.pdf.internal.getFontSize(),this.pdf.setFontSize(tn*ae.scale),fn=this.lineWidth,this.lineWidth=fn*ae.scale),this.pdf.text(ae.text,mt.x+this.posX,mt.y+this.posY,{angle:ae.angle,align:Me,renderingMode:ae.renderingMode,maxWidth:ae.maxWidth}),ae.scale>=.01&&(this.pdf.setFontSize(tn),this.lineWidth=fn)},Z=function(ae,Me,Fe,Ze){Fe=Fe||0,Ze=Ze||0,this.pdf.internal.out(t(ae+Fe)+" "+i(Me+Ze)+" l")},Ee=function(ae,Me,Fe){return this.pdf.lines(ae,Me,Fe,null,null)},ke=function(ae,Me,Fe,Ze,et,mt,ht,Nt){this.pdf.internal.out([e(c(Fe+ae)),e(u(Ze+Me)),e(c(et+ae)),e(u(mt+Me)),e(c(ht+ae)),e(u(Nt+Me)),"c"].join(" "))},Oe=function(ae,Me,Fe,Ze){for(var et=2*Math.PI,mt=Math.PI/2;Me>Fe;)Me-=et;var ht=Math.abs(Fe-Me);ht<et&&Ze&&(ht=et-ht);for(var Nt=[],Jt=Ze?-1:1,tn=Me;ht>1e-5;){var fn=tn+Jt*Math.min(ht,mt);Nt.push(Re.call(this,ae,tn,fn)),ht-=Math.abs(fn-tn),tn=fn}return Nt},Re=function(ae,Me,Fe){var Ze=(Fe-Me)/2,et=ae*Math.cos(Ze),mt=ae*Math.sin(Ze),ht=et,Nt=-mt,Jt=ht*ht+Nt*Nt,tn=Jt+ht*et+Nt*mt,fn=4/3*(Math.sqrt(2*Jt*tn)-tn)/(ht*mt-Nt*et),An=ht-fn*Nt,zt=Nt+fn*ht,it=An,ur=-zt,xr=Ze+Me,Tr=Math.cos(xr),Tn=Math.sin(xr);return{x1:ae*Math.cos(Me),y1:ae*Math.sin(Me),x2:An*Tr-zt*Tn,y2:An*Tn+zt*Tr,x3:it*Tr-ur*Tn,y3:it*Tn+ur*Tr,x4:ae*Math.cos(Fe),y4:ae*Math.sin(Fe)}},be=function(ae){return 180*ae/Math.PI},De=function(ae,Me,Fe,Ze,et,mt){var ht=ae+.5*(Fe-ae),Nt=Me+.5*(Ze-Me),Jt=et+.5*(Fe-et),tn=mt+.5*(Ze-mt),fn=Math.min(ae,et,ht,Jt),An=Math.max(ae,et,ht,Jt),zt=Math.min(Me,mt,Nt,tn),it=Math.max(Me,mt,Nt,tn);return new _(fn,zt,An-fn,it-zt)},Qe=function(ae,Me,Fe,Ze,et,mt,ht,Nt){var Jt,tn,fn,An,zt,it,ur,xr,Tr,Tn,Yn,$n,hr,Wt,Nn=Fe-ae,tr=Ze-Me,Hn=et-Fe,Rr=mt-Ze,lr=ht-et,wr=Nt-mt;for(tn=0;tn<41;tn++)Tr=(ur=(fn=ae+(Jt=tn/40)*Nn)+Jt*((zt=Fe+Jt*Hn)-fn))+Jt*(zt+Jt*(et+Jt*lr-zt)-ur),Tn=(xr=(An=Me+Jt*tr)+Jt*((it=Ze+Jt*Rr)-An))+Jt*(it+Jt*(mt+Jt*wr-it)-xr),tn==0?(Yn=Tr,$n=Tn,hr=Tr,Wt=Tn):(Yn=Math.min(Yn,Tr),$n=Math.min($n,Tn),hr=Math.max(hr,Tr),Wt=Math.max(Wt,Tn));return new _(Math.round(Yn),Math.round($n),Math.round(hr-Yn),Math.round(Wt-$n))},xe=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var ae,Me,Fe=(ae=this.ctx.lineDash,Me=this.ctx.lineDashOffset,JSON.stringify({lineDash:ae,lineDashOffset:Me}));this.prevLineDash!==Fe&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Fe)}}})(wi.API),(function(n){var e=function(m){var _,o,w,I,O,V,M,se,ce,fe;for(o=[],w=0,I=(m+=_="\0\0\0\0".slice(m.length%4||4)).length;I>w;w+=4)(O=(m.charCodeAt(w)<<24)+(m.charCodeAt(w+1)<<16)+(m.charCodeAt(w+2)<<8)+m.charCodeAt(w+3))!==0?(V=(O=((O=((O=((O=(O-(fe=O%85))/85)-(ce=O%85))/85)-(se=O%85))/85)-(M=O%85))/85)%85,o.push(V+33,M+33,se+33,ce+33,fe+33)):o.push(122);return(function(ne,oe){for(var ye=oe;ye>0;ye--)ne.pop()})(o,_.length),String.fromCharCode.apply(String,o)+"~>"},t=function(m){var _,o,w,I,O,V=String,M="length",se=255,ce="charCodeAt",fe="slice",ne="replace";for(m[fe](-2),m=m[fe](0,-2)[ne](/\s/g,"")[ne]("z","!!!!!"),w=[],I=0,O=(m+=_="uuuuu"[fe](m[M]%5||5))[M];O>I;I+=5)o=52200625*(m[ce](I)-33)+614125*(m[ce](I+1)-33)+7225*(m[ce](I+2)-33)+85*(m[ce](I+3)-33)+(m[ce](I+4)-33),w.push(se&o>>24,se&o>>16,se&o>>8,se&o);return(function(oe,ye){for(var he=ye;he>0;he--)oe.pop()})(w,_[M]),V.fromCharCode.apply(V,w)},i=function(m){return m.split("").map(function(_){return("0"+_.charCodeAt().toString(16)).slice(-2)}).join("")+">"},c=function(m){var _=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((m=m.replace(/\s/g,"")).indexOf(">")!==-1&&(m=m.substr(0,m.indexOf(">"))),m.length%2&&(m+="0"),_.test(m)===!1)return"";for(var o="",w=0;w<m.length;w+=2)o+=String.fromCharCode("0x"+(m[w]+m[w+1]));return o},u=function(m){for(var _=new Uint8Array(m.length),o=m.length;o--;)_[o]=m.charCodeAt(o);return(_=t5(_)).reduce(function(w,I){return w+String.fromCharCode(I)},"")};n.processDataByFilters=function(m,_){var o=0,w=m||"",I=[];for(typeof(_=_||[])=="string"&&(_=[_]),o=0;o<_.length;o+=1)switch(_[o]){case"ASCII85Decode":case"/ASCII85Decode":w=t(w),I.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":w=e(w),I.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":w=c(w),I.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":w=i(w),I.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":w=u(w),I.push("/FlateDecode");break;default:throw new Error('The filter: "'+_[o]+'" is not implemented')}return{data:w,reverseChain:I.reverse().join(" ")}}})(wi.API),(function(n){n.loadFile=function(e,t,i){return(function(c,u,m){u=u!==!1,m=typeof m=="function"?m:function(){};var _=void 0;try{_=(function(o,w,I){var O=new XMLHttpRequest,V=0,M=function(se){var ce=se.length,fe=[],ne=String.fromCharCode;for(V=0;V<ce;V+=1)fe.push(ne(255&se.charCodeAt(V)));return fe.join("")};if(O.open("GET",o,!w),O.overrideMimeType("text/plain; charset=x-user-defined"),w===!1&&(O.onload=function(){O.status===200?I(M(this.responseText)):I(void 0)}),O.send(null),w&&O.status===200)return M(O.responseText)})(c,u,m)}catch{}return _})(e,t,i)},n.loadImageFile=n.loadFile})(wi.API),(function(n){function e(){return(ao.html2canvas?Promise.resolve(ao.html2canvas):Jx(()=>import("./html2canvas.esm-B0tyYwQk.js"),[])).catch(function(_){return Promise.reject(new Error("Could not load html2canvas: "+_))}).then(function(_){return _.default?_.default:_})}function t(){return(ao.DOMPurify?Promise.resolve(ao.DOMPurify):Jx(()=>import("./purify.es-B6FQ9oRL.js"),[])).catch(function(_){return Promise.reject(new Error("Could not load dompurify: "+_))}).then(function(_){return _.default?_.default:_})}var i=function(_){var o=ba(_);return o==="undefined"?"undefined":o==="string"||_ instanceof String?"string":o==="number"||_ instanceof Number?"number":o==="function"||_ instanceof Function?"function":_&&_.constructor===Array?"array":_&&_.nodeType===1?"element":o==="object"?"object":"unknown"},c=function(_,o){var w=document.createElement(_);for(var I in o.className&&(w.className=o.className),o.innerHTML&&o.dompurify&&(w.innerHTML=o.dompurify.sanitize(o.innerHTML)),o.style)w.style[I]=o.style[I];return w},u=function _(o,w){for(var I=o.nodeType===3?document.createTextNode(o.nodeValue):o.cloneNode(!1),O=o.firstChild;O;O=O.nextSibling)w!==!0&&O.nodeType===1&&O.nodeName==="SCRIPT"||I.appendChild(_(O,w));return o.nodeType===1&&(o.nodeName==="CANVAS"?(I.width=o.width,I.height=o.height,I.getContext("2d").drawImage(o,0,0)):o.nodeName!=="TEXTAREA"&&o.nodeName!=="SELECT"||(I.value=o.value),I.addEventListener("load",function(){I.scrollTop=o.scrollTop,I.scrollLeft=o.scrollLeft},!0)),I},m=function _(o){var w=Object.assign(_.convert(Promise.resolve()),JSON.parse(JSON.stringify(_.template))),I=_.convert(Promise.resolve(),w);return(I=I.setProgress(1,_,1,[_])).set(o)};(m.prototype=Object.create(Promise.prototype)).constructor=m,m.convert=function(_,o){return _.__proto__=o||m.prototype,_},m.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},m.prototype.from=function(_,o){return this.then(function(){switch(o=o||(function(w){switch(i(w)){case"string":return"string";case"element":return w.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(_),o){case"string":return this.then(t).then(function(w){return this.set({src:c("div",{innerHTML:_,dompurify:w})})});case"element":return this.set({src:_});case"canvas":return this.set({canvas:_});case"img":return this.set({img:_});default:return this.error("Unknown source type.")}})},m.prototype.to=function(_){switch(_){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},m.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var _={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},o=u(this.prop.src,this.opt.html2canvas.javascriptEnabled);o.tagName==="BODY"&&(_.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=c("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=c("div",{className:"html2pdf__container",style:_}),this.prop.container.appendChild(o),this.prop.container.firstChild.appendChild(c("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},m.prototype.toCanvas=function(){var _=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(_).then(e).then(function(o){var w=Object.assign({},this.opt.html2canvas);return delete w.onrendered,o(this.prop.container,w)}).then(function(o){(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},m.prototype.toContext2d=function(){var _=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(_).then(e).then(function(o){var w=this.opt.jsPDF,I=this.opt.fontFaces,O=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,V=Object.assign({async:!0,allowTaint:!0,scale:O,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete V.onrendered,w.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,w.context2d.posX=this.opt.x,w.context2d.posY=this.opt.y,w.context2d.margin=this.opt.margin,w.context2d.fontFaces=I,I)for(var M=0;M<I.length;++M){var se=I[M],ce=se.src.find(function(fe){return fe.format==="truetype"});ce&&w.addFont(ce.url,se.ref.name,se.ref.style)}return V.windowHeight=V.windowHeight||0,V.windowHeight=V.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):V.windowHeight,w.context2d.save(!0),o(this.prop.container,V)}).then(function(o){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},m.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var _=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=_})},m.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},m.prototype.output=function(_,o,w){return(w=w||"pdf").toLowerCase()==="img"||w.toLowerCase()==="image"?this.outputImg(_,o):this.outputPdf(_,o)},m.prototype.outputPdf=function(_,o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(_,o)})},m.prototype.outputImg=function(_){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(_){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+_+'" is not supported.'}})},m.prototype.save=function(_){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(_?{filename:_}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},m.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},m.prototype.set=function(_){if(i(_)!=="object")return this;var o=Object.keys(_||{}).map(function(w){if(w in m.template.prop)return function(){this.prop[w]=_[w]};switch(w){case"margin":return this.setMargin.bind(this,_.margin);case"jsPDF":return function(){return this.opt.jsPDF=_.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,_.pageSize);default:return function(){this.opt[w]=_[w]}}},this);return this.then(function(){return this.thenList(o)})},m.prototype.get=function(_,o){return this.then(function(){var w=_ in m.template.prop?this.prop[_]:this.opt[_];return o?o(w):w})},m.prototype.setMargin=function(_){return this.then(function(){switch(i(_)){case"number":_=[_,_,_,_];case"array":if(_.length===2&&(_=[_[0],_[1],_[0],_[1]]),_.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=_}).then(this.setPageSize)},m.prototype.setPageSize=function(_){function o(w,I){return Math.floor(w*I/72*96)}return this.then(function(){(_=_||wi.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(_.inner={width:_.width-this.opt.margin[1]-this.opt.margin[3],height:_.height-this.opt.margin[0]-this.opt.margin[2]},_.inner.px={width:o(_.inner.width,_.k),height:o(_.inner.height,_.k)},_.inner.ratio=_.inner.height/_.inner.width),this.prop.pageSize=_})},m.prototype.setProgress=function(_,o,w,I){return _!=null&&(this.progress.val=_),o!=null&&(this.progress.state=o),w!=null&&(this.progress.n=w),I!=null&&(this.progress.stack=I),this.progress.ratio=this.progress.val/this.progress.state,this},m.prototype.updateProgress=function(_,o,w,I){return this.setProgress(_?this.progress.val+_:null,o||null,w?this.progress.n+w:null,I?this.progress.stack.concat(I):null)},m.prototype.then=function(_,o){var w=this;return this.thenCore(_,o,function(I,O){return w.updateProgress(null,null,1,[I]),Promise.prototype.then.call(this,function(V){return w.updateProgress(null,I),V}).then(I,O).then(function(V){return w.updateProgress(1),V})})},m.prototype.thenCore=function(_,o,w){w=w||Promise.prototype.then;var I=this;_&&(_=_.bind(I)),o&&(o=o.bind(I));var O=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?I:m.convert(Object.assign({},I),Promise.prototype),V=w.call(O,_,o);return m.convert(V,I.__proto__)},m.prototype.thenExternal=function(_,o){return Promise.prototype.then.call(this,_,o)},m.prototype.thenList=function(_){var o=this;return _.forEach(function(w){o=o.thenCore(w)}),o},m.prototype.catch=function(_){_&&(_=_.bind(this));var o=Promise.prototype.catch.call(this,_);return m.convert(o,this)},m.prototype.catchExternal=function(_){return Promise.prototype.catch.call(this,_)},m.prototype.error=function(_){return this.then(function(){throw new Error(_)})},m.prototype.using=m.prototype.set,m.prototype.saveAs=m.prototype.save,m.prototype.export=m.prototype.output,m.prototype.run=m.prototype.then,wi.getPageSize=function(_,o,w){if(ba(_)==="object"){var I=_;_=I.orientation,o=I.unit||o,w=I.format||w}o=o||"mm",w=w||"a4",_=(""+(_||"P")).toLowerCase();var O,V=(""+w).toLowerCase(),M={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(o){case"pt":O=1;break;case"mm":O=72/25.4;break;case"cm":O=72/2.54;break;case"in":O=72;break;case"px":O=.75;break;case"pc":case"em":O=12;break;case"ex":O=6;break;default:throw"Invalid unit: "+o}var se,ce=0,fe=0;if(M.hasOwnProperty(V))ce=M[V][1]/O,fe=M[V][0]/O;else try{ce=w[1],fe=w[0]}catch{throw new Error("Invalid format: "+w)}if(_==="p"||_==="portrait")_="p",fe>ce&&(se=fe,fe=ce,ce=se);else{if(_!=="l"&&_!=="landscape")throw"Invalid orientation: "+_;_="l",ce>fe&&(se=fe,fe=ce,ce=se)}return{width:fe,height:ce,unit:o,k:O,orientation:_}},n.html=function(_,o){(o=o||{}).callback=o.callback||function(){},o.html2canvas=o.html2canvas||{},o.html2canvas.canvas=o.html2canvas.canvas||this.canvas,o.jsPDF=o.jsPDF||this,o.fontFaces=o.fontFaces?o.fontFaces.map(gb):null;var w=new m(o);return o.worker?w:w.from(_).doCallback()}})(wi.API),wi.API.addJS=function(n){return dS=n,this.internal.events.subscribe("postPutResources",function(){o1=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(o1+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),hS=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+dS+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){o1!==void 0&&hS!==void 0&&this.internal.out("/Names <</JavaScript "+o1+" 0 R>>")}),this},(function(n){var e;n.events.push(["postPutResources",function(){var t=this,i=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var c=t.outline.render().split(/\r\n/),u=0;u<c.length;u++){var m=c[u],_=i.exec(m);if(_!=null){var o=_[1];t.internal.newObjectDeferredBegin(o,!1)}t.internal.write(m)}if(this.outline.createNamedDestinations){var w=this.internal.pages.length,I=[];for(u=0;u<w;u++){var O=t.internal.newObject();I.push(O);var V=t.internal.getPageInfo(u+1);t.internal.write("<< /D["+V.objId+" 0 R /XYZ null null null]>> endobj")}var M=t.internal.newObject();for(t.internal.write("<< /Names [ "),u=0;u<I.length;u++)t.internal.write("(page_"+(u+1)+")"+I[u]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+M+" 0 R"),t.internal.write(">>","endobj")}}]),n.events.push(["putCatalog",function(){var t=this;t.outline.root.children.length>0&&(t.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&t.internal.write("/Names "+e+" 0 R"))}]),n.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(i,c,u){var m={title:c,options:u,children:[]};return i==null&&(i=this.root),i.children.push(m),m},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(i){i.id=t.internal.newObjectDeferred();for(var c=0;c<i.children.length;c++)this.genIds_r(i.children[c])},t.outline.renderRoot=function(i){this.objStart(i),this.line("/Type /Outlines"),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1]))),this.line("/Count "+this.count_r({count:0},i)),this.objEnd()},t.outline.renderItems=function(i){for(var c=this.ctx.pdf.internal.getVerticalCoordinateString,u=0;u<i.children.length;u++){var m=i.children[u];this.objStart(m),this.line("/Title "+this.makeString(m.title)),this.line("/Parent "+this.makeRef(i)),u>0&&this.line("/Prev "+this.makeRef(i.children[u-1])),u<i.children.length-1&&this.line("/Next "+this.makeRef(i.children[u+1])),m.children.length>0&&(this.line("/First "+this.makeRef(m.children[0])),this.line("/Last "+this.makeRef(m.children[m.children.length-1])));var _=this.count=this.count_r({count:0},m);if(_>0&&this.line("/Count "+_),m.options&&m.options.pageNumber){var o=t.internal.getPageInfo(m.options.pageNumber);this.line("/Dest ["+o.objId+" 0 R /XYZ 0 "+c(0)+" 0]")}this.objEnd()}for(var w=0;w<i.children.length;w++)this.renderItems(i.children[w])},t.outline.line=function(i){this.ctx.val+=i+`\r
`},t.outline.makeRef=function(i){return i.id+" 0 R"},t.outline.makeString=function(i){return"("+t.internal.pdfEscape(i)+")"},t.outline.objStart=function(i){this.ctx.val+=`\r
`+i.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(i,c){for(var u=0;u<c.children.length;u++)i.count++,this.count_r(i,c.children[u]);return i.count}}])})(wi.API),(function(n){var e=[192,193,194,195,196,197,198,199];n.processJPEG=function(t,i,c,u,m,_){var o,w=this.decode.DCT_DECODE,I=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=m||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,o=(function(O){for(var V,M=256*O.charCodeAt(4)+O.charCodeAt(5),se=O.length,ce={width:0,height:0,numcomponents:1},fe=4;fe<se;fe+=2){if(fe+=M,e.indexOf(O.charCodeAt(fe+1))!==-1){V=256*O.charCodeAt(fe+5)+O.charCodeAt(fe+6),ce={width:256*O.charCodeAt(fe+7)+O.charCodeAt(fe+8),height:V,numcomponents:O.charCodeAt(fe+9)};break}M=256*O.charCodeAt(fe+2)+O.charCodeAt(fe+3)}return ce})(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t),o.numcomponents){case 1:_=this.color_spaces.DEVICE_GRAY;break;case 4:_=this.color_spaces.DEVICE_CMYK;break;case 3:_=this.color_spaces.DEVICE_RGB}I={data:t,width:o.width,height:o.height,colorSpace:_,bitsPerComponent:8,filter:w,index:i,alias:c}}return I}})(wi.API),wi.API.processPNG=function(n,e,t,i){if(this.__addimage__.isArrayBuffer(n)&&(n=new Uint8Array(n)),this.__addimage__.isArrayBufferView(n)){var c,u=Gk(n,{checkCrc:!0}),m=u.width,_=u.height,o=u.channels,w=u.palette,I=u.depth;c=w&&o===1?(function(j){for(var D=j.width,$=j.height,z=j.data,W=j.palette,Z=j.depth,Ee=!1,ke=[],Oe=[],Re=void 0,be=!1,De=0,Qe=0;Qe<W.length;Qe++){var xe=g2(W[Qe],4),ae=xe[0],Me=xe[1],Fe=xe[2],Ze=xe[3];ke.push(ae,Me,Fe),Ze!=null&&(Ze===0?(De++,Oe.length<1&&Oe.push(Qe)):Ze<255&&(be=!0))}if(be||De>1){Ee=!0,Oe=void 0;var et=D*$;Re=new Uint8Array(et);for(var mt=new DataView(z.buffer),ht=0;ht<et;ht++){var Nt=_b(mt,ht,Z),Jt=g2(W[Nt],4)[3];Re[ht]=Jt}}else De===0&&(Oe=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:Ee?8:void 0,colorBytes:z,alphaBytes:Re,needSMask:Ee,palette:ke,mask:Oe}})(u):o===2||o===4?(function(j){for(var D=j.data,$=j.width,z=j.height,W=j.channels,Z=j.depth,Ee=W===2?"DeviceGray":"DeviceRGB",ke=W-1,Oe=$*z,Re=ke,be=Oe*Re,De=1*Oe,Qe=Math.ceil(be*Z/8),xe=Math.ceil(De*Z/8),ae=new Uint8Array(Qe),Me=new Uint8Array(xe),Fe=new DataView(D.buffer),Ze=new DataView(ae.buffer),et=new DataView(Me.buffer),mt=!1,ht=0;ht<Oe;ht++){for(var Nt=ht*W,Jt=0;Jt<Re;Jt++)bS(Ze,_b(Fe,Nt+Jt,Z),ht*Re+Jt,Z);var tn=_b(Fe,Nt+Re,Z);tn<(1<<Z)-1&&(mt=!0),bS(et,tn,1*ht,Z)}return{colorSpace:Ee,colorsPerPixel:ke,sMaskBitsPerComponent:mt?Z:void 0,colorBytes:ae,alphaBytes:Me,needSMask:mt}})(u):(function(j){var D=j.data,$=j.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:$,colorsPerPixel:$==="DeviceGray"?1:3,colorBytes:D instanceof Uint16Array?(function(z){for(var W=z.length,Z=new Uint8Array(2*W),Ee=new DataView(Z.buffer,Z.byteOffset,Z.byteLength),ke=0;ke<W;ke++)Ee.setUint16(2*ke,z[ke],!1);return Z})(D):D,needSMask:!1}})(u);var O,V,M,se=c,ce=se.colorSpace,fe=se.colorsPerPixel,ne=se.sMaskBitsPerComponent,oe=se.colorBytes,ye=se.alphaBytes,he=se.needSMask,Ne=se.palette,Ve=se.mask,de=null;return i!==wi.API.image_compression.NONE&&typeof t5=="function"?(de=(function(j){var D;switch(j){case wi.API.image_compression.FAST:D=11;break;case wi.API.image_compression.MEDIUM:D=13;break;case wi.API.image_compression.SLOW:D=14;break;default:D=12}return D})(i),O=this.decode.FLATE_DECODE,V="/Predictor ".concat(de," /Colors ").concat(fe," /BitsPerComponent ").concat(I," /Columns ").concat(m),n=gS(oe,Math.ceil(m*fe*I/8),fe,I,i),he&&(M=gS(ye,Math.ceil(m*ne/8),1,ne,i))):(O=void 0,V=void 0,n=oe,he&&(M=ye)),(this.__addimage__.isArrayBuffer(n)||this.__addimage__.isArrayBufferView(n))&&(n=this.__addimage__.arrayBufferToBinaryString(n)),(M&&this.__addimage__.isArrayBuffer(M)||this.__addimage__.isArrayBufferView(M))&&(M=this.__addimage__.arrayBufferToBinaryString(M)),{alias:t,data:n,index:e,filter:O,decodeParameters:V,transparency:Ve,palette:Ne,sMask:M,predictor:de,width:m,height:_,bitsPerComponent:I,sMaskBitsPerComponent:ne,colorSpace:ce}}},(function(n){n.processGIF89A=function(e,t,i,c){var u=new dM(e),m=u.width,_=u.height,o=[];u.decodeAndBlitFrameRGBA(0,o);var w={data:o,width:m,height:_},I=new vb(100).encode(w,100);return n.processJPEG.call(this,I,t,i,c)},n.processGIF87A=n.processGIF89A})(wi.API),zd.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var n=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(n);for(var e=0;e<n;e++){var t=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),u=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:c,green:i,blue:t,quad:u}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},zd.prototype.parseBGR=function(){this.pos=this.offset;try{var n="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[n]()}catch(t){za.log("bit decode error:"+t)}},zd.prototype.bit1=function(){var n,e=Math.ceil(this.width/8),t=e%4;for(n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,c=0;c<e;c++)for(var u=this.datav.getUint8(this.pos++,!0),m=i*this.width*4+8*c*4,_=0;_<8&&8*c+_<this.width;_++){var o=this.palette[u>>7-_&1];this.data[m+4*_]=o.blue,this.data[m+4*_+1]=o.green,this.data[m+4*_+2]=o.red,this.data[m+4*_+3]=255}t!==0&&(this.pos+=4-t)}},zd.prototype.bit4=function(){for(var n=Math.ceil(this.width/2),e=n%4,t=this.height-1;t>=0;t--){for(var i=this.bottom_up?t:this.height-1-t,c=0;c<n;c++){var u=this.datav.getUint8(this.pos++,!0),m=i*this.width*4+2*c*4,_=u>>4,o=15&u,w=this.palette[_];if(this.data[m]=w.blue,this.data[m+1]=w.green,this.data[m+2]=w.red,this.data[m+3]=255,2*c+1>=this.width)break;w=this.palette[o],this.data[m+4]=w.blue,this.data[m+4+1]=w.green,this.data[m+4+2]=w.red,this.data[m+4+3]=255}e!==0&&(this.pos+=4-e)}},zd.prototype.bit8=function(){for(var n=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,i=0;i<this.width;i++){var c=this.datav.getUint8(this.pos++,!0),u=t*this.width*4+4*i;if(c<this.palette.length){var m=this.palette[c];this.data[u]=m.red,this.data[u+1]=m.green,this.data[u+2]=m.blue,this.data[u+3]=255}else this.data[u]=255,this.data[u+1]=255,this.data[u+2]=255,this.data[u+3]=255}n!==0&&(this.pos+=4-n)}},zd.prototype.bit15=function(){for(var n=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var i=this.bottom_up?t:this.height-1-t,c=0;c<this.width;c++){var u=this.datav.getUint16(this.pos,!0);this.pos+=2;var m=(u&e)/e*255|0,_=(u>>5&e)/e*255|0,o=(u>>10&e)/e*255|0,w=u>>15?255:0,I=i*this.width*4+4*c;this.data[I]=o,this.data[I+1]=_,this.data[I+2]=m,this.data[I+3]=w}this.pos+=n}},zd.prototype.bit16=function(){for(var n=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),i=this.height-1;i>=0;i--){for(var c=this.bottom_up?i:this.height-1-i,u=0;u<this.width;u++){var m=this.datav.getUint16(this.pos,!0);this.pos+=2;var _=(m&e)/e*255|0,o=(m>>5&t)/t*255|0,w=(m>>11)/e*255|0,I=c*this.width*4+4*u;this.data[I]=w,this.data[I+1]=o,this.data[I+2]=_,this.data[I+3]=255}this.pos+=n}},zd.prototype.bit24=function(){for(var n=this.height-1;n>=0;n--){for(var e=this.bottom_up?n:this.height-1-n,t=0;t<this.width;t++){var i=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),u=this.datav.getUint8(this.pos++,!0),m=e*this.width*4+4*t;this.data[m]=u,this.data[m+1]=c,this.data[m+2]=i,this.data[m+3]=255}this.pos+=this.width%4}},zd.prototype.bit32=function(){for(var n=this.height-1;n>=0;n--)for(var e=this.bottom_up?n:this.height-1-n,t=0;t<this.width;t++){var i=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),u=this.datav.getUint8(this.pos++,!0),m=this.datav.getUint8(this.pos++,!0),_=e*this.width*4+4*t;this.data[_]=u,this.data[_+1]=c,this.data[_+2]=i,this.data[_+3]=m}},zd.prototype.getData=function(){return this.data},(function(n){n.processBMP=function(e,t,i,c){var u=new zd(e,!1),m=u.width,_=u.height,o={data:u.getData(),width:m,height:_},w=new vb(100).encode(o,100);return n.processJPEG.call(this,w,t,i,c)}})(wi.API),SS.prototype.getData=function(){return this.data},(function(n){n.processWEBP=function(e,t,i,c){var u=new SS(e),m=u.width,_=u.height,o={data:u.getData(),width:m,height:_},w=new vb(100).encode(o,100);return n.processJPEG.call(this,w,t,i,c)}})(wi.API),wi.API.processRGBA=function(n,e,t){for(var i=n.data,c=i.length,u=new Uint8Array(c/4*3),m=new Uint8Array(c/4),_=0,o=0,w=0;w<c;w+=4){var I=i[w],O=i[w+1],V=i[w+2],M=i[w+3];u[_++]=I,u[_++]=O,u[_++]=V,m[o++]=M}var se=this.__addimage__.arrayBufferToBinaryString(u);return{alpha:this.__addimage__.arrayBufferToBinaryString(m),data:se,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:n.width,height:n.height}},wi.API.setLanguage=function(n){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[n]!==void 0&&(this.internal.languageSettings.languageCode=n,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},kg=wi.API,s1=kg.getCharWidthsArray=function(n,e){var t,i,c=(e=e||{}).font||this.internal.getFont(),u=e.fontSize||this.internal.getFontSize(),m=e.charSpace||this.internal.getCharSpace(),_=e.widths?e.widths:c.metadata.Unicode.widths,o=_.fof?_.fof:1,w=e.kerning?e.kerning:c.metadata.Unicode.kerning,I=w.fof?w.fof:1,O=e.doKerning!==!1,V=0,M=n.length,se=0,ce=_[0]||o,fe=[];for(t=0;t<M;t++)i=n.charCodeAt(t),typeof c.metadata.widthOfString=="function"?fe.push((c.metadata.widthOfGlyph(c.metadata.characterToGlyph(i))+m*(1e3/u)||0)/1e3):(V=O&&ba(w[i])==="object"&&!isNaN(parseInt(w[i][se],10))?w[i][se]/I:0,fe.push((_[i]||ce)/o+V)),se=i;return fe},fS=kg.getStringUnitWidth=function(n,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),i=e.font||this.internal.getFont(),c=e.charSpace||this.internal.getCharSpace();return kg.processArabic&&(n=kg.processArabic(n)),typeof i.metadata.widthOfString=="function"?i.metadata.widthOfString(n,t,c)/t:s1.apply(this,arguments).reduce(function(u,m){return u+m},0)},pS=function(n,e,t,i){for(var c=[],u=0,m=n.length,_=0;u!==m&&_+e[u]<t;)_+=e[u],u++;c.push(n.slice(0,u));var o=u;for(_=0;u!==m;)_+e[u]>i&&(c.push(n.slice(o,u)),_=0,o=u),_+=e[u],u++;return o!==u&&c.push(n.slice(o,u)),c},mS=function(n,e,t){t||(t={});var i,c,u,m,_,o,w,I=[],O=[I],V=t.textIndent||0,M=0,se=0,ce=n.split(" "),fe=s1.apply(this,[" ",t])[0];if(o=t.lineIndent===-1?ce[0].length+2:t.lineIndent||0){var ne=Array(o).join(" "),oe=[];ce.map(function(he){(he=he.split(/\s*\n/)).length>1?oe=oe.concat(he.map(function(Ne,Ve){return(Ve&&Ne.length?`
`:"")+Ne})):oe.push(he[0])}),ce=oe,o=fS.apply(this,[ne,t])}for(u=0,m=ce.length;u<m;u++){var ye=0;if(i=ce[u],o&&i[0]==`
`&&(i=i.substr(1),ye=1),V+M+(se=(c=s1.apply(this,[i,t])).reduce(function(he,Ne){return he+Ne},0))>e||ye){if(se>e){for(_=pS.apply(this,[i,c,e-(V+M),e]),I.push(_.shift()),I=[_.pop()];_.length;)O.push([_.shift()]);se=c.slice(i.length-(I[0]?I[0].length:0)).reduce(function(he,Ne){return he+Ne},0)}else I=[i];O.push(I),V=se+o,M=fe}else I.push(i),V+=M+se,M=fe}return w=o?function(he,Ne){return(Ne?ne:"")+he.join(" ")}:function(he){return he.join(" ")},O.map(w)},kg.splitTextToSize=function(n,e,t){var i,c=(t=t||{}).fontSize||this.internal.getFontSize(),u=(function(I){if(I.widths&&I.kerning)return{widths:I.widths,kerning:I.kerning};var O=this.internal.getFont(I.fontName,I.fontStyle),V="Unicode";return O.metadata[V]?{widths:O.metadata[V].widths||{0:1},kerning:O.metadata[V].kerning||{}}:{font:O.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);i=Array.isArray(n)?n:String(n).split(/\r?\n/);var m=1*this.internal.scaleFactor*e/c;u.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/c:0,u.lineIndent=t.lineIndent;var _,o,w=[];for(_=0,o=i.length;_<o;_++)w=w.concat(mS.apply(this,[i[_],m,u]));return w},(function(n){n.__fontmetrics__=n.__fontmetrics__||{};for(var e="0123456789abcdef",t="klmnopqrstuvwxyz",i={},c={},u=0;u<16;u++)i[t[u]]=e[u],c[e[u]]=t[u];var m=function(V){return"0x"+parseInt(V,10).toString(16)},_=n.__fontmetrics__.compress=function(V){var M,se,ce,fe,ne=["{"];for(var oe in V){if(M=V[oe],isNaN(parseInt(oe,10))?se="'"+oe+"'":(oe=parseInt(oe,10),se=(se=m(oe).slice(2)).slice(0,-1)+c[se.slice(-1)]),typeof M=="number")M<0?(ce=m(M).slice(3),fe="-"):(ce=m(M).slice(2),fe=""),ce=fe+ce.slice(0,-1)+c[ce.slice(-1)];else{if(ba(M)!=="object")throw new Error("Don't know what to do with value type "+ba(M)+".");ce=_(M)}ne.push(se+ce)}return ne.push("}"),ne.join("")},o=n.__fontmetrics__.uncompress=function(V){if(typeof V!="string")throw new Error("Invalid argument passed to uncompress.");for(var M,se,ce,fe,ne={},oe=1,ye=ne,he=[],Ne="",Ve="",de=V.length-1,j=1;j<de;j+=1)(fe=V[j])=="'"?M?(ce=M.join(""),M=void 0):M=[]:M?M.push(fe):fe=="{"?(he.push([ye,ce]),ye={},ce=void 0):fe=="}"?((se=he.pop())[0][se[1]]=ye,ce=void 0,ye=se[0]):fe=="-"?oe=-1:ce===void 0?i.hasOwnProperty(fe)?(Ne+=i[fe],ce=parseInt(Ne,16)*oe,oe=1,Ne=""):Ne+=fe:i.hasOwnProperty(fe)?(Ve+=i[fe],ye[ce]=parseInt(Ve,16)*oe,oe=1,ce=void 0,Ve=""):Ve+=fe;return ne},w={codePages:["WinAnsiEncoding"],WinAnsiEncoding:o("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},I={Unicode:{Courier:w,"Courier-Bold":w,"Courier-BoldOblique":w,"Courier-Oblique":w,Helvetica:w,"Helvetica-Bold":w,"Helvetica-BoldOblique":w,"Helvetica-Oblique":w,"Times-Roman":w,"Times-Bold":w,"Times-BoldItalic":w,"Times-Italic":w}},O={Unicode:{"Courier-Oblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":o("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":o("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:o("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:o("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":o("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":o("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};n.events.push(["addFont",function(V){var M=V.font,se=O.Unicode[M.postScriptName];se&&(M.metadata.Unicode={},M.metadata.Unicode.widths=se.widths,M.metadata.Unicode.kerning=se.kerning);var ce=I.Unicode[M.postScriptName];ce&&(M.metadata.Unicode.encoding=ce,M.encoding=ce.codePages[0])}])})(wi.API),(function(n){var e=function(t){for(var i=t.length,c=new Uint8Array(i),u=0;u<i;u++)c[u]=t.charCodeAt(u);return c};n.API.events.push(["addFont",function(t){var i=void 0,c=t.font,u=t.instance;if(!c.isStandardFont){if(u===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+c.postScriptName+"').");if(typeof(i=u.existsFileInVFS(c.postScriptName)===!1?u.loadFile(c.postScriptName):u.getFileFromVFS(c.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+c.postScriptName+"').");(function(m,_){_=/^\x00\x01\x00\x00/.test(_)?e(_):e(C1(_)),m.metadata=n.API.TTFFont.open(_),m.metadata.Unicode=m.metadata.Unicode||{encoding:{},kerning:{},widths:[]},m.metadata.glyIdsUsed=[0]})(c,i)}}])})(wi),wi.API.addSvgAsImage=function(n,e,t,i,c,u,m,_){if(isNaN(e)||isNaN(t))throw za.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(i)||isNaN(c))throw za.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var o=document.createElement("canvas");o.width=i,o.height=c;var w=o.getContext("2d");w.fillStyle="#fff",w.fillRect(0,0,o.width,o.height);var I={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},O=this;return(ao.canvg?Promise.resolve(ao.canvg):Jx(()=>import("./index.es-Bp_v2GLy.js"),[])).catch(function(V){return Promise.reject(new Error("Could not load canvg: "+V))}).then(function(V){return V.default?V.default:V}).then(function(V){return V.fromString(w,n,I)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(V){return V.render(I)}).then(function(){O.addImage(o.toDataURL("image/jpeg",1),e,t,i,c,m,_)})},wi.API.putTotalPages=function(n){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(n,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(n,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var i=1;i<=this.internal.getNumberOfPages();i++)for(var c=0;c<this.internal.pages[i].length;c++)this.internal.pages[i][c]=this.internal.pages[i][c].replace(e,t);return this},wi.API.viewerPreferences=function(n,e){var t;n=n||{},e=e||!1;var i,c,u,m={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},_=Object.keys(m),o=[],w=0,I=0,O=0;function V(se,ce){var fe,ne=!1;for(fe=0;fe<se.length;fe+=1)se[fe]===ce&&(ne=!0);return ne}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(m)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,n==="reset"||e===!0){var M=_.length;for(O=0;O<M;O+=1)t[_[O]].value=t[_[O]].defaultValue,t[_[O]].explicitSet=!1}if(ba(n)==="object"){for(c in n)if(u=n[c],V(_,c)&&u!==void 0){if(t[c].type==="boolean"&&typeof u=="boolean")t[c].value=u;else if(t[c].type==="name"&&V(t[c].valueSet,u))t[c].value=u;else if(t[c].type==="integer"&&Number.isInteger(u))t[c].value=u;else if(t[c].type==="array"){for(w=0;w<u.length;w+=1)if(i=!0,u[w].length===1&&typeof u[w][0]=="number")o.push(String(u[w]-1));else if(u[w].length>1){for(I=0;I<u[w].length;I+=1)typeof u[w][I]!="number"&&(i=!1);i===!0&&o.push([u[w][0]-1,u[w][1]-1].join(" "))}t[c].value="["+o.join(" ")+"]"}else t[c].value=t[c].defaultValue;t[c].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var se,ce=[];for(se in t)t[se].explicitSet===!0&&(t[se].type==="name"?ce.push("/"+se+" /"+t[se].value):ce.push("/"+se+" "+t[se].value));ce.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+ce.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},(function(n){var e=function(){var i='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',c=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),u=unescape(encodeURIComponent(i)),m=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),_=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),o=unescape(encodeURIComponent("</x:xmpmeta>")),w=u.length+m.length+_.length+c.length+o.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+w+" >>"),this.internal.write("stream"),this.internal.write(c+u+m+_+o),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};n.addMetadata=function(i,c){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:i,namespaceuri:c||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}})(wi.API),(function(n){var e=n.API,t=e.pdfEscape16=function(u,m){for(var _,o=m.metadata.Unicode.widths,w=["","0","00","000","0000"],I=[""],O=0,V=u.length;O<V;++O){if(_=m.metadata.characterToGlyph(u.charCodeAt(O)),m.metadata.glyIdsUsed.push(_),m.metadata.toUnicode[_]=u.charCodeAt(O),o.indexOf(_)==-1&&(o.push(_),o.push([parseInt(m.metadata.widthOfGlyph(_),10)])),_=="0")return I.join("");_=_.toString(16),I.push(w[4-_.length],_)}return I.join("")},i=function(u){var m,_,o,w,I,O,V;for(I=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,o=[],O=0,V=(_=Object.keys(u).sort(function(M,se){return M-se})).length;O<V;O++)m=_[O],o.length>=100&&(I+=`
`+o.length+` beginbfchar
`+o.join(`
`)+`
endbfchar`,o=[]),u[m]!==void 0&&u[m]!==null&&typeof u[m].toString=="function"&&(w=("0000"+u[m].toString(16)).slice(-4),m=("0000"+(+m).toString(16)).slice(-4),o.push("<"+m+"><"+w+">"));return o.length&&(I+=`
`+o.length+` beginbfchar
`+o.join(`
`)+`
endbfchar
`),I+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(u){(function(m){var _=m.font,o=m.out,w=m.newObject,I=m.putStream;if(_.metadata instanceof n.API.TTFFont&&_.encoding==="Identity-H"){for(var O=_.metadata.Unicode.widths,V=_.metadata.subset.encode(_.metadata.glyIdsUsed,1),M="",se=0;se<V.length;se++)M+=String.fromCharCode(V[se]);var ce=w();I({data:M,addLength1:!0,objectId:ce}),o("endobj");var fe=w();I({data:i(_.metadata.toUnicode),addLength1:!0,objectId:fe}),o("endobj");var ne=w();o("<<"),o("/Type /FontDescriptor"),o("/FontName /"+Bg(_.fontName)),o("/FontFile2 "+ce+" 0 R"),o("/FontBBox "+n.API.PDFObject.convert(_.metadata.bbox)),o("/Flags "+_.metadata.flags),o("/StemV "+_.metadata.stemV),o("/ItalicAngle "+_.metadata.italicAngle),o("/Ascent "+_.metadata.ascender),o("/Descent "+_.metadata.decender),o("/CapHeight "+_.metadata.capHeight),o(">>"),o("endobj");var oe=w();o("<<"),o("/Type /Font"),o("/BaseFont /"+Bg(_.fontName)),o("/FontDescriptor "+ne+" 0 R"),o("/W "+n.API.PDFObject.convert(O)),o("/CIDToGIDMap /Identity"),o("/DW 1000"),o("/Subtype /CIDFontType2"),o("/CIDSystemInfo"),o("<<"),o("/Supplement 0"),o("/Registry (Adobe)"),o("/Ordering ("+_.encoding+")"),o(">>"),o(">>"),o("endobj"),_.objectNumber=w(),o("<<"),o("/Type /Font"),o("/Subtype /Type0"),o("/ToUnicode "+fe+" 0 R"),o("/BaseFont /"+Bg(_.fontName)),o("/Encoding /"+_.encoding),o("/DescendantFonts ["+oe+" 0 R]"),o(">>"),o("endobj"),_.isAlreadyPutted=!0}})(u)}]),e.events.push(["putFont",function(u){(function(m){var _=m.font,o=m.out,w=m.newObject,I=m.putStream;if(_.metadata instanceof n.API.TTFFont&&_.encoding==="WinAnsiEncoding"){for(var O=_.metadata.rawData,V="",M=0;M<O.length;M++)V+=String.fromCharCode(O[M]);var se=w();I({data:V,addLength1:!0,objectId:se}),o("endobj");var ce=w();I({data:i(_.metadata.toUnicode),addLength1:!0,objectId:ce}),o("endobj");var fe=w();o("<<"),o("/Descent "+_.metadata.decender),o("/CapHeight "+_.metadata.capHeight),o("/StemV "+_.metadata.stemV),o("/Type /FontDescriptor"),o("/FontFile2 "+se+" 0 R"),o("/Flags 96"),o("/FontBBox "+n.API.PDFObject.convert(_.metadata.bbox)),o("/FontName /"+Bg(_.fontName)),o("/ItalicAngle "+_.metadata.italicAngle),o("/Ascent "+_.metadata.ascender),o(">>"),o("endobj"),_.objectNumber=w();for(var ne=0;ne<_.metadata.hmtx.widths.length;ne++)_.metadata.hmtx.widths[ne]=parseInt(_.metadata.hmtx.widths[ne]*(1e3/_.metadata.head.unitsPerEm));o("<</Subtype/TrueType/Type/Font/ToUnicode "+ce+" 0 R/BaseFont/"+Bg(_.fontName)+"/FontDescriptor "+fe+" 0 R/Encoding/"+_.encoding+" /FirstChar 29 /LastChar 255 /Widths "+n.API.PDFObject.convert(_.metadata.hmtx.widths)+">>"),o("endobj"),_.isAlreadyPutted=!0}})(u)}]);var c=function(u){var m,_=u.text||"",o=u.x,w=u.y,I=u.options||{},O=u.mutex||{},V=O.pdfEscape,M=O.activeFontKey,se=O.fonts,ce=M,fe="",ne=0,oe="",ye=se[ce].encoding;if(se[ce].encoding!=="Identity-H")return{text:_,x:o,y:w,options:I,mutex:O};for(oe=_,ce=M,Array.isArray(_)&&(oe=_[0]),ne=0;ne<oe.length;ne+=1)se[ce].metadata.hasOwnProperty("cmap")&&(m=se[ce].metadata.cmap.unicode.codeMap[oe[ne].charCodeAt(0)]),m||oe[ne].charCodeAt(0)<256&&se[ce].metadata.hasOwnProperty("Unicode")?fe+=oe[ne]:fe+="";var he="";return parseInt(ce.slice(1))<14||ye==="WinAnsiEncoding"?he=V(fe,ce).split("").map(function(Ne){return Ne.charCodeAt(0).toString(16)}).join(""):ye==="Identity-H"&&(he=t(fe,se[ce])),O.isHex=!0,{text:he,x:o,y:w,options:I,mutex:O}};e.events.push(["postProcessText",function(u){var m=u.text||"",_=[],o={text:m,x:u.x,y:u.y,options:u.options,mutex:u.mutex};if(Array.isArray(m)){var w=0;for(w=0;w<m.length;w+=1)Array.isArray(m[w])&&m[w].length===3?_.push([c(Object.assign({},o,{text:m[w][0]})).text,m[w][1],m[w][2]]):_.push(c(Object.assign({},o,{text:m[w]})).text);u.text=_}else u.text=c(Object.assign({},o,{text:m})).text}])})(wi),(function(n){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};n.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},n.addFileToVFS=function(t,i){return e.call(this),this.internal.vFS[t]=i,this},n.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}})(wi.API),(function(n){n.__bidiEngine__=n.prototype.__bidiEngine__=function(i){var c,u,m,_,o,w,I,O=e,V=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],M=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],se={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},ce={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},fe=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],ne=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),oe=!1,ye=0;this.__bidiEngine__={};var he=function(z){var W=z.charCodeAt(),Z=W>>8,Ee=ce[Z];return Ee!==void 0?O[256*Ee+(255&W)]:Z===252||Z===253?"AL":ne.test(Z)?"L":Z===8?"R":"N"},Ne=function(z){for(var W,Z=0;Z<z.length;Z++){if((W=he(z.charAt(Z)))==="L")return!1;if(W==="R")return!0}return!1},Ve=function(z,W,Z,Ee){var ke,Oe,Re,be,De=W[Ee];switch(De){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":oe=!1;break;case"N":case"AN":break;case"EN":oe&&(De="AN");break;case"AL":oe=!0,De="R";break;case"WS":case"BN":De="N";break;case"CS":Ee<1||Ee+1>=W.length||(ke=Z[Ee-1])!=="EN"&&ke!=="AN"||(Oe=W[Ee+1])!=="EN"&&Oe!=="AN"?De="N":oe&&(Oe="AN"),De=Oe===ke?Oe:"N";break;case"ES":De=(ke=Ee>0?Z[Ee-1]:"B")==="EN"&&Ee+1<W.length&&W[Ee+1]==="EN"?"EN":"N";break;case"ET":if(Ee>0&&Z[Ee-1]==="EN"){De="EN";break}if(oe){De="N";break}for(Re=Ee+1,be=W.length;Re<be&&W[Re]==="ET";)Re++;De=Re<be&&W[Re]==="EN"?"EN":"N";break;case"NSM":if(m&&!_){for(be=W.length,Re=Ee+1;Re<be&&W[Re]==="NSM";)Re++;if(Re<be){var Qe=z[Ee],xe=Qe>=1425&&Qe<=2303||Qe===64286;if(ke=W[Re],xe&&(ke==="R"||ke==="AL")){De="R";break}}}De=Ee<1||(ke=W[Ee-1])==="B"?"N":Z[Ee-1];break;case"B":oe=!1,c=!0,De=ye;break;case"S":u=!0,De="N"}return De},de=function(z,W,Z){var Ee=z.split("");return Z&&j(Ee,Z,{hiLevel:ye}),Ee.reverse(),W&&W.reverse(),Ee.join("")},j=function(z,W,Z){var Ee,ke,Oe,Re,be,De=-1,Qe=z.length,xe=0,ae=[],Me=ye?M:V,Fe=[];for(oe=!1,c=!1,u=!1,ke=0;ke<Qe;ke++)Fe[ke]=he(z[ke]);for(Oe=0;Oe<Qe;Oe++){if(be=xe,ae[Oe]=Ve(z,Fe,ae,Oe),Ee=240&(xe=Me[be][se[ae[Oe]]]),xe&=15,W[Oe]=Re=Me[xe][5],Ee>0)if(Ee===16){for(ke=De;ke<Oe;ke++)W[ke]=1;De=-1}else De=-1;if(Me[xe][6])De===-1&&(De=Oe);else if(De>-1){for(ke=De;ke<Oe;ke++)W[ke]=Re;De=-1}Fe[Oe]==="B"&&(W[Oe]=0),Z.hiLevel|=Re}u&&(function(Ze,et,mt){for(var ht=0;ht<mt;ht++)if(Ze[ht]==="S"){et[ht]=ye;for(var Nt=ht-1;Nt>=0&&Ze[Nt]==="WS";Nt--)et[Nt]=ye}})(Fe,W,Qe)},D=function(z,W,Z,Ee,ke){if(!(ke.hiLevel<z)){if(z===1&&ye===1&&!c)return W.reverse(),void(Z&&Z.reverse());for(var Oe,Re,be,De,Qe=W.length,xe=0;xe<Qe;){if(Ee[xe]>=z){for(be=xe+1;be<Qe&&Ee[be]>=z;)be++;for(De=xe,Re=be-1;De<Re;De++,Re--)Oe=W[De],W[De]=W[Re],W[Re]=Oe,Z&&(Oe=Z[De],Z[De]=Z[Re],Z[Re]=Oe);xe=be}xe++}}},$=function(z,W,Z){var Ee=z.split(""),ke={hiLevel:ye};return Z||(Z=[]),j(Ee,Z,ke),(function(Oe,Re,be){if(be.hiLevel!==0&&I)for(var De,Qe=0;Qe<Oe.length;Qe++)Re[Qe]===1&&(De=fe.indexOf(Oe[Qe]))>=0&&(Oe[Qe]=fe[De+1])})(Ee,Z,ke),D(2,Ee,W,Z,ke),D(1,Ee,W,Z,ke),Ee.join("")};return this.__bidiEngine__.doBidiReorder=function(z,W,Z){if((function(ke,Oe){if(Oe)for(var Re=0;Re<ke.length;Re++)Oe[Re]=Re;_===void 0&&(_=Ne(ke)),w===void 0&&(w=Ne(ke))})(z,W),m||!o||w)if(m&&o&&_^w)ye=_?1:0,z=de(z,W,Z);else if(!m&&o&&w)ye=_?1:0,z=$(z,W,Z),z=de(z,W);else if(!m||_||o||w){if(m&&!o&&_^w)z=de(z,W),_?(ye=0,z=$(z,W,Z)):(ye=1,z=$(z,W,Z),z=de(z,W));else if(m&&_&&!o&&w)ye=1,z=$(z,W,Z),z=de(z,W);else if(!m&&!o&&_^w){var Ee=I;_?(ye=1,z=$(z,W,Z),ye=0,I=!1,z=$(z,W,Z),I=Ee):(ye=0,z=$(z,W,Z),z=de(z,W),ye=1,I=!1,z=$(z,W,Z),I=Ee,z=de(z,W))}}else ye=0,z=$(z,W,Z);else ye=_?1:0,z=$(z,W,Z);return z},this.__bidiEngine__.setOptions=function(z){z&&(m=z.isInputVisual,o=z.isOutputVisual,_=z.isInputRtl,w=z.isOutputRtl,I=z.isSymmetricSwapping)},this.__bidiEngine__.setOptions(i),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new n.__bidiEngine__({isInputVisual:!0});n.API.events.push(["postProcessText",function(i){var c=i.text;i.x,i.y;var u=i.options||{};i.mutex,u.lang;var m=[];if(u.isInputVisual=typeof u.isInputVisual!="boolean"||u.isInputVisual,t.setOptions(u),Object.prototype.toString.call(c)==="[object Array]"){var _=0;for(m=[],_=0;_<c.length;_+=1)Object.prototype.toString.call(c[_])==="[object Array]"?m.push([t.doBidiReorder(c[_][0]),c[_][1],c[_][2]]):m.push([t.doBidiReorder(c[_])]);i.text=m}else i.text=t.doBidiReorder(c);t.setOptions({isInputVisual:!0})}])})(wi),wi.API.TTFFont=(function(){function n(e){var t;if(this.rawData=e,t=this.contents=new Qp(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new IM(this),this.registerTTF()}return n.open=function(e){return new n(e)},n.prototype.parse=function(){return this.directory=new fM(this.contents),this.head=new mM(this),this.name=new xM(this),this.cmap=new c6(this),this.toUnicode={},this.hhea=new gM(this),this.maxp=new bM(this),this.hmtx=new wM(this),this.post=new _M(this),this.os2=new yM(this),this.loca=new TM(this),this.glyf=new SM(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},n.prototype.registerTTF=function(){var e,t,i,c,u;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var m,_,o,w;for(w=[],m=0,_=(o=this.bbox).length;m<_;m++)e=o[m],w.push(Math.round(e*this.scaleFactor));return w}).call(this),this.stemV=0,this.post.exists?(i=255&(c=this.post.italic_angle),32768&(t=c>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+i)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(u=this.familyClass)===1||u===2||u===3||u===4||u===5||u===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},n.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},n.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},n.prototype.widthOfString=function(e,t,i){var c,u,m,_;for(m=0,u=0,_=(e=""+e).length;0<=_?u<_:u>_;u=0<=_?++u:--u)c=e.charCodeAt(u),m+=this.widthOfGlyph(this.characterToGlyph(c))+i*(1e3/t)||0;return m*(t/1e3)},n.prototype.lineHeight=function(e,t){var i;return t==null&&(t=!1),i=t?this.lineGap:0,(this.ascender+i-this.decender)/1e3*e},n})();var Jd,Qp=(function(){function n(e){this.data=e??[],this.pos=0,this.length=this.data.length}return n.prototype.readByte=function(){return this.data[this.pos++]},n.prototype.writeByte=function(e){return this.data[this.pos++]=e},n.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},n.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},n.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},n.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},n.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},n.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},n.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},n.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},n.prototype.readString=function(e){var t,i;for(i=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)i[t]=String.fromCharCode(this.readByte());return i.join("")},n.prototype.writeString=function(e){var t,i,c;for(c=[],t=0,i=e.length;0<=i?t<i:t>i;t=0<=i?++t:--t)c.push(this.writeByte(e.charCodeAt(t)));return c},n.prototype.readShort=function(){return this.readInt16()},n.prototype.writeShort=function(e){return this.writeInt16(e)},n.prototype.readLongLong=function(){var e,t,i,c,u,m,_,o;return e=this.readByte(),t=this.readByte(),i=this.readByte(),c=this.readByte(),u=this.readByte(),m=this.readByte(),_=this.readByte(),o=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^i)+4294967296*(255^c)+16777216*(255^u)+65536*(255^m)+256*(255^_)+(255^o)+1):72057594037927940*e+281474976710656*t+1099511627776*i+4294967296*c+16777216*u+65536*m+256*_+o},n.prototype.writeLongLong=function(e){var t,i;return t=Math.floor(e/4294967296),i=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(i>>24&255),this.writeByte(i>>16&255),this.writeByte(i>>8&255),this.writeByte(255&i)},n.prototype.readInt=function(){return this.readInt32()},n.prototype.writeInt=function(e){return this.writeInt32(e)},n.prototype.read=function(e){var t,i;for(t=[],i=0;0<=e?i<e:i>e;i=0<=e?++i:--i)t.push(this.readByte());return t},n.prototype.write=function(e){var t,i,c,u;for(u=[],i=0,c=e.length;i<c;i++)t=e[i],u.push(this.writeByte(t));return u},n})(),fM=(function(){var n;function e(t){var i,c,u;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},c=0,u=this.tableCount;0<=u?c<u:c>u;c=0<=u?++c:--c)i={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[i.tag]=i}return e.prototype.encode=function(t){var i,c,u,m,_,o,w,I,O,V,M,se,ce;for(ce in M=Object.keys(t).length,o=Math.log(2),O=16*Math.floor(Math.log(M)/o),m=Math.floor(O/o),I=16*M-O,(c=new Qp).writeInt(this.scalarType),c.writeShort(M),c.writeShort(O),c.writeShort(m),c.writeShort(I),u=16*M,w=c.pos+u,_=null,se=[],t)for(V=t[ce],c.writeString(ce),c.writeInt(n(V)),c.writeInt(w),c.writeInt(V.length),se=se.concat(V),ce==="head"&&(_=w),w+=V.length;w%4;)se.push(0),w++;return c.write(se),i=2981146554-n(c.data),c.pos=_+8,c.writeUInt32(i),c.data},n=function(t){var i,c,u,m;for(t=u6.call(t);t.length%4;)t.push(0);for(u=new Qp(t),c=0,i=0,m=t.length;i<m;i=i+=4)c+=u.readUInt32();return 4294967295&c},e})(),pM={}.hasOwnProperty,Ff=function(n,e){for(var t in e)pM.call(e,t)&&(n[t]=e[t]);function i(){this.constructor=n}return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n};Jd=(function(){function n(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return n.prototype.parse=function(){},n.prototype.encode=function(){},n.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},n})();var mM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Ff(n,Jd),n.prototype.tag="head",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},n.prototype.encode=function(e){var t;return(t=new Qp).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},n})(),ES=(function(){function n(e,t){var i,c,u,m,_,o,w,I,O,V,M,se,ce,fe,ne,oe,ye;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),O=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(o=0;o<256;++o)this.codeMap[o]=e.readByte();break;case 4:for(M=e.readUInt16(),V=M/2,e.pos+=6,u=(function(){var he,Ne;for(Ne=[],o=he=0;0<=V?he<V:he>V;o=0<=V?++he:--he)Ne.push(e.readUInt16());return Ne})(),e.pos+=2,ce=(function(){var he,Ne;for(Ne=[],o=he=0;0<=V?he<V:he>V;o=0<=V?++he:--he)Ne.push(e.readUInt16());return Ne})(),w=(function(){var he,Ne;for(Ne=[],o=he=0;0<=V?he<V:he>V;o=0<=V?++he:--he)Ne.push(e.readUInt16());return Ne})(),I=(function(){var he,Ne;for(Ne=[],o=he=0;0<=V?he<V:he>V;o=0<=V?++he:--he)Ne.push(e.readUInt16());return Ne})(),c=(this.length-e.pos+this.offset)/2,_=(function(){var he,Ne;for(Ne=[],o=he=0;0<=c?he<c:he>c;o=0<=c?++he:--he)Ne.push(e.readUInt16());return Ne})(),o=ne=0,ye=u.length;ne<ye;o=++ne)for(fe=u[o],i=oe=se=ce[o];se<=fe?oe<=fe:oe>=fe;i=se<=fe?++oe:--oe)I[o]===0?m=i+w[o]:(m=_[I[o]/2+(i-se)-(V-o)]||0)!==0&&(m+=w[o]),this.codeMap[i]=65535&m}e.pos=O}return n.encode=function(e,t){var i,c,u,m,_,o,w,I,O,V,M,se,ce,fe,ne,oe,ye,he,Ne,Ve,de,j,D,$,z,W,Z,Ee,ke,Oe,Re,be,De,Qe,xe,ae,Me,Fe,Ze,et,mt,ht,Nt,Jt,tn,fn;switch(Ee=new Qp,m=Object.keys(e).sort(function(An,zt){return An-zt}),t){case"macroman":for(ce=0,fe=(function(){var An=[];for(se=0;se<256;++se)An.push(0);return An})(),oe={0:0},u={},ke=0,De=m.length;ke<De;ke++)oe[Nt=e[c=m[ke]]]==null&&(oe[Nt]=++ce),u[c]={old:e[c],new:oe[e[c]]},fe[c]=oe[e[c]];return Ee.writeUInt16(1),Ee.writeUInt16(0),Ee.writeUInt32(12),Ee.writeUInt16(0),Ee.writeUInt16(262),Ee.writeUInt16(0),Ee.write(fe),{charMap:u,subtable:Ee.data,maxGlyphID:ce+1};case"unicode":for(W=[],O=[],ye=0,oe={},i={},ne=w=null,Oe=0,Qe=m.length;Oe<Qe;Oe++)oe[Ne=e[c=m[Oe]]]==null&&(oe[Ne]=++ye),i[c]={old:Ne,new:oe[Ne]},_=oe[Ne]-c,ne!=null&&_===w||(ne&&O.push(ne),W.push(c),w=_),ne=c;for(ne&&O.push(ne),O.push(65535),W.push(65535),$=2*(D=W.length),j=2*Math.pow(Math.log(D)/Math.LN2,2),V=Math.log(j/2)/Math.LN2,de=2*D-j,o=[],Ve=[],M=[],se=Re=0,xe=W.length;Re<xe;se=++Re){if(z=W[se],I=O[se],z===65535){o.push(0),Ve.push(0);break}if(z-(Z=i[z].new)>=32768)for(o.push(0),Ve.push(2*(M.length+D-se)),c=be=z;z<=I?be<=I:be>=I;c=z<=I?++be:--be)M.push(i[c].new);else o.push(Z-z),Ve.push(0)}for(Ee.writeUInt16(3),Ee.writeUInt16(1),Ee.writeUInt32(12),Ee.writeUInt16(4),Ee.writeUInt16(16+8*D+2*M.length),Ee.writeUInt16(0),Ee.writeUInt16($),Ee.writeUInt16(j),Ee.writeUInt16(V),Ee.writeUInt16(de),mt=0,ae=O.length;mt<ae;mt++)c=O[mt],Ee.writeUInt16(c);for(Ee.writeUInt16(0),ht=0,Me=W.length;ht<Me;ht++)c=W[ht],Ee.writeUInt16(c);for(Jt=0,Fe=o.length;Jt<Fe;Jt++)_=o[Jt],Ee.writeUInt16(_);for(tn=0,Ze=Ve.length;tn<Ze;tn++)he=Ve[tn],Ee.writeUInt16(he);for(fn=0,et=M.length;fn<et;fn++)ce=M[fn],Ee.writeUInt16(ce);return{charMap:i,subtable:Ee.data,maxGlyphID:ye+1}}},n})(),c6=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Ff(n,Jd),n.prototype.tag="cmap",n.prototype.parse=function(e){var t,i,c;for(e.pos=this.offset,this.version=e.readUInt16(),c=e.readUInt16(),this.tables=[],this.unicode=null,i=0;0<=c?i<c:i>c;i=0<=c?++i:--i)t=new ES(e,this.offset),this.tables.push(t),t.isUnicode&&this.unicode==null&&(this.unicode=t);return!0},n.encode=function(e,t){var i,c;return t==null&&(t="macroman"),i=ES.encode(e,t),(c=new Qp).writeUInt16(0),c.writeUInt16(1),i.table=c.data.concat(i.subtable),i},n})(),gM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Ff(n,Jd),n.prototype.tag="hhea",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},n})(),yM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Ff(n,Jd),n.prototype.tag="OS/2",n.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=(function(){var t,i;for(i=[],t=0;t<10;++t)i.push(e.readByte());return i})(),this.charRange=(function(){var t,i;for(i=[],t=0;t<4;++t)i.push(e.readInt());return i})(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=(function(){var t,i;for(i=[],t=0;t<2;t=++t)i.push(e.readInt());return i})(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},n})(),_M=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Ff(n,Jd),n.prototype.tag="post",n.prototype.parse=function(e){var t,i,c;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var u;for(i=e.readUInt16(),this.glyphNameIndex=[],u=0;0<=i?u<i:u>i;u=0<=i?++u:--u)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],c=[];e.pos<this.offset+this.length;)t=e.readByte(),c.push(this.names.push(e.readString(t)));return c;case 151552:return i=e.readUInt16(),this.offsets=e.read(i);case 262144:return this.map=(function(){var m,_,o;for(o=[],u=m=0,_=this.file.maxp.numGlyphs;0<=_?m<_:m>_;u=0<=_?++m:--m)o.push(e.readUInt32());return o}).call(this)}},n})(),vM=function(n,e){this.raw=n,this.length=n.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},xM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Ff(n,Jd),n.prototype.tag="name",n.prototype.parse=function(e){var t,i,c,u,m,_,o,w,I,O,V;for(e.pos=this.offset,e.readShort(),t=e.readShort(),_=e.readShort(),i=[],u=0;0<=t?u<t:u>t;u=0<=t?++u:--u)i.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+_+e.readShort()});for(o={},u=I=0,O=i.length;I<O;u=++I)c=i[u],e.pos=c.offset,w=e.readString(c.length),m=new vM(w,c),o[V=c.nameID]==null&&(o[V]=[]),o[c.nameID].push(m);this.strings=o,this.copyright=o[0],this.fontFamily=o[1],this.fontSubfamily=o[2],this.uniqueSubfamily=o[3],this.fontName=o[4],this.version=o[5];try{this.postscriptName=o[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=o[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=o[7],this.manufacturer=o[8],this.designer=o[9],this.description=o[10],this.vendorUrl=o[11],this.designerUrl=o[12],this.license=o[13],this.licenseUrl=o[14],this.preferredFamily=o[15],this.preferredSubfamily=o[17],this.compatibleFull=o[18],this.sampleText=o[19]},n})(),bM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Ff(n,Jd),n.prototype.tag="maxp",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},n})(),wM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Ff(n,Jd),n.prototype.tag="hmtx",n.prototype.parse=function(e){var t,i,c,u,m,_,o;for(e.pos=this.offset,this.metrics=[],t=0,_=this.file.hhea.numberOfMetrics;0<=_?t<_:t>_;t=0<=_?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(c=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var w,I;for(I=[],t=w=0;0<=c?w<c:w>c;t=0<=c?++w:--w)I.push(e.readInt16());return I})(),this.widths=(function(){var w,I,O,V;for(V=[],w=0,I=(O=this.metrics).length;w<I;w++)u=O[w],V.push(u.advance);return V}).call(this),i=this.widths[this.widths.length-1],o=[],t=m=0;0<=c?m<c:m>c;t=0<=c?++m:--m)o.push(this.widths.push(i));return o},n.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},n})(),u6=[].slice,SM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Ff(n,Jd),n.prototype.tag="glyf",n.prototype.parse=function(){return this.cache={}},n.prototype.glyphFor=function(e){var t,i,c,u,m,_,o,w,I,O;return e in this.cache?this.cache[e]:(u=this.file.loca,t=this.file.contents,i=u.indexOf(e),(c=u.lengthOf(e))===0?this.cache[e]=null:(t.pos=this.offset+i,m=(_=new Qp(t.read(c))).readShort(),w=_.readShort(),O=_.readShort(),o=_.readShort(),I=_.readShort(),this.cache[e]=m===-1?new AM(_,w,O,o,I):new EM(_,m,w,O,o,I),this.cache[e]))},n.prototype.encode=function(e,t,i){var c,u,m,_,o;for(m=[],u=[],_=0,o=t.length;_<o;_++)c=e[t[_]],u.push(m.length),c&&(m=m.concat(c.encode(i)));return u.push(m.length),{table:m,offsets:u}},n})(),EM=(function(){function n(e,t,i,c,u,m){this.raw=e,this.numberOfContours=t,this.xMin=i,this.yMin=c,this.xMax=u,this.yMax=m,this.compound=!1}return n.prototype.encode=function(){return this.raw.data},n})(),AM=(function(){function n(e,t,i,c,u){var m,_;for(this.raw=e,this.xMin=t,this.yMin=i,this.xMax=c,this.yMax=u,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],m=this.raw;_=m.readShort(),this.glyphOffsets.push(m.pos),this.glyphIDs.push(m.readUInt16()),32&_;)m.pos+=1&_?4:2,128&_?m.pos+=8:64&_?m.pos+=4:8&_&&(m.pos+=2)}return n.prototype.encode=function(){var e,t,i;for(t=new Qp(u6.call(this.raw.data)),e=0,i=this.glyphIDs.length;e<i;++e)t.pos=this.glyphOffsets[e];return t.data},n})(),TM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Ff(n,Jd),n.prototype.tag="loca",n.prototype.parse=function(e){var t,i;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=t===0?(function(){var c,u;for(u=[],i=0,c=this.length;i<c;i+=2)u.push(2*e.readUInt16());return u}).call(this):(function(){var c,u;for(u=[],i=0,c=this.length;i<c;i+=4)u.push(e.readUInt32());return u}).call(this)},n.prototype.indexOf=function(e){return this.offsets[e]},n.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},n.prototype.encode=function(e,t){for(var i=new Uint32Array(this.offsets.length),c=0,u=0,m=0;m<i.length;++m)if(i[m]=c,u<t.length&&t[u]==m){++u,i[m]=c;var _=this.offsets[m],o=this.offsets[m+1]-_;o>0&&(c+=o)}for(var w=new Array(4*i.length),I=0;I<i.length;++I)w[4*I+3]=255&i[I],w[4*I+2]=(65280&i[I])>>8,w[4*I+1]=(16711680&i[I])>>16,w[4*I]=(4278190080&i[I])>>24;return w},n})(),IM=(function(){function n(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return n.prototype.generateCmap=function(){var e,t,i,c,u;for(t in c=this.font.cmap.tables[0].codeMap,e={},u=this.subset)i=u[t],e[t]=c[i];return e},n.prototype.glyphsFor=function(e){var t,i,c,u,m,_,o;for(c={},m=0,_=e.length;m<_;m++)c[u=e[m]]=this.font.glyf.glyphFor(u);for(u in t=[],c)(i=c[u])!=null&&i.compound&&t.push.apply(t,i.glyphIDs);if(t.length>0)for(u in o=this.glyphsFor(t))i=o[u],c[u]=i;return c},n.prototype.encode=function(e,t){var i,c,u,m,_,o,w,I,O,V,M,se,ce,fe,ne;for(c in i=c6.encode(this.generateCmap(),"unicode"),m=this.glyphsFor(e),M={0:0},ne=i.charMap)M[(o=ne[c]).old]=o.new;for(se in V=i.maxGlyphID,m)se in M||(M[se]=V++);return I=(function(oe){var ye,he;for(ye in he={},oe)he[oe[ye]]=ye;return he})(M),O=Object.keys(I).sort(function(oe,ye){return oe-ye}),ce=(function(){var oe,ye,he;for(he=[],oe=0,ye=O.length;oe<ye;oe++)_=O[oe],he.push(I[_]);return he})(),u=this.font.glyf.encode(m,ce,M),w=this.font.loca.encode(u.offsets,ce),fe={cmap:this.font.cmap.raw(),glyf:u.table,loca:w,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(fe["OS/2"]=this.font.os2.raw()),this.font.directory.encode(fe)},n})();wi.API.PDFObject=(function(){var n;function e(){}return n=function(t,i){return(Array(i+1).join("0")+t).slice(-i)},e.convert=function(t){var i,c,u,m;if(Array.isArray(t))return"["+(function(){var _,o,w;for(w=[],_=0,o=t.length;_<o;_++)i=t[_],w.push(e.convert(i));return w})().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t?.isString)return"("+t+")";if(t instanceof Date)return"(D:"+n(t.getUTCFullYear(),4)+n(t.getUTCMonth(),2)+n(t.getUTCDate(),2)+n(t.getUTCHours(),2)+n(t.getUTCMinutes(),2)+n(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(c in u=["<<"],t)m=t[c],u.push("/"+c+" "+e.convert(m));return u.push(">>"),u.join(`
`)}return""+t},e})();var AS={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h6=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let c=n.charCodeAt(i);c<128?e[t++]=c:c<2048?(e[t++]=c>>6|192,e[t++]=c&63|128):(c&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(c=65536+((c&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=c>>18|240,e[t++]=c>>12&63|128,e[t++]=c>>6&63|128,e[t++]=c&63|128):(e[t++]=c>>12|224,e[t++]=c>>6&63|128,e[t++]=c&63|128)}return e},CM=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const c=n[t++];if(c<128)e[i++]=String.fromCharCode(c);else if(c>191&&c<224){const u=n[t++];e[i++]=String.fromCharCode((c&31)<<6|u&63)}else if(c>239&&c<365){const u=n[t++],m=n[t++],_=n[t++],o=((c&7)<<18|(u&63)<<12|(m&63)<<6|_&63)-65536;e[i++]=String.fromCharCode(55296+(o>>10)),e[i++]=String.fromCharCode(56320+(o&1023))}else{const u=n[t++],m=n[t++];e[i++]=String.fromCharCode((c&15)<<12|(u&63)<<6|m&63)}}return e.join("")},d6={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let c=0;c<n.length;c+=3){const u=n[c],m=c+1<n.length,_=m?n[c+1]:0,o=c+2<n.length,w=o?n[c+2]:0,I=u>>2,O=(u&3)<<4|_>>4;let V=(_&15)<<2|w>>6,M=w&63;o||(M=64,m||(V=64)),i.push(t[I],t[O],t[V],t[M])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(h6(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):CM(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let c=0;c<n.length;){const u=t[n.charAt(c++)],_=c<n.length?t[n.charAt(c)]:0;++c;const w=c<n.length?t[n.charAt(c)]:64;++c;const O=c<n.length?t[n.charAt(c)]:64;if(++c,u==null||_==null||w==null||O==null)throw new LM;const V=u<<2|_>>4;if(i.push(V),w!==64){const M=_<<4&240|w>>2;if(i.push(M),O!==64){const se=w<<6&192|O;i.push(se)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class LM extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const PM=function(n){const e=h6(n);return d6.encodeByteArray(e,!0)},iv=function(n){return PM(n).replace(/\./g,"")},f6=function(n){try{return d6.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kM(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MM=()=>kM().__FIREBASE_DEFAULTS__,RM=()=>{if(typeof process>"u"||typeof AS>"u")return;const n=AS.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},NM=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&f6(n[1]);return e&&JSON.parse(e)},jv=()=>{try{return MM()||RM()||NM()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},p6=n=>{var e,t;return(t=(e=jv())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},DM=n=>{const e=p6(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},m6=()=>{var n;return(n=jv())===null||n===void 0?void 0:n.config},g6=n=>{var e;return(e=jv())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FM{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OM(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",c=n.iat||0,u=n.sub||n.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const m=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:c,exp:c+3600,auth_time:c,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}}},n);return[iv(JSON.stringify(t)),iv(JSON.stringify(m)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _h(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function BM(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_h())}function zM(){var n;const e=(n=jv())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function jM(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function UM(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function VM(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function qM(){const n=_h();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function $M(){return!zM()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function GM(){try{return typeof indexedDB=="object"}catch{return!1}}function WM(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(i);c.onsuccess=()=>{c.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},c.onupgradeneeded=()=>{t=!1},c.onerror=()=>{var u;e(((u=c.error)===null||u===void 0?void 0:u.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HM="FirebaseError";class _p extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=HM,Object.setPrototypeOf(this,_p.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,c_.prototype.create)}}class c_{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},c=`${this.service}/${e}`,u=this.errors[e],m=u?XM(u,i):"Error",_=`${this.serviceName}: ${m} (${c}).`;return new _p(c,_,i)}}function XM(n,e){return n.replace(KM,(t,i)=>{const c=e[i];return c!=null?String(c):`<${i}?>`})}const KM=/\{\$([^}]+)}/g;function ZM(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ov(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const c of t){if(!i.includes(c))return!1;const u=n[c],m=e[c];if(TS(u)&&TS(m)){if(!ov(u,m))return!1}else if(u!==m)return!1}for(const c of i)if(!t.includes(c))return!1;return!0}function TS(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u_(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(c=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(c))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function YM(n,e){const t=new JM(n,e);return t.subscribe.bind(t)}class JM{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let c;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");QM(e,["next","error","complete"])?c=e:c={next:e,error:t,complete:i},c.next===void 0&&(c.next=xb),c.error===void 0&&(c.error=xb),c.complete===void 0&&(c.complete=xb);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch{}}),this.observers.push(c),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function QM(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function xb(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ih(n){return n&&n._delegate?n._delegate:n}class Vm{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pm="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eR{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new FM;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:t});c&&i.resolve(c)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e?.identifier),c=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(u){if(c)return null;throw u}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(nR(e))try{this.getOrInitializeService({instanceIdentifier:Pm})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(t);try{const u=this.getOrInitializeService({instanceIdentifier:c});i.resolve(u)}catch{}}}}clearInstance(e=Pm){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Pm){return this.instances.has(e)}getOptions(e=Pm){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[u,m]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(u);i===_&&m.resolve(c)}return c}onInit(e,t){var i;const c=this.normalizeInstanceIdentifier(t),u=(i=this.onInitCallbacks.get(c))!==null&&i!==void 0?i:new Set;u.add(e),this.onInitCallbacks.set(c,u);const m=this.instances.get(c);return m&&e(m,c),()=>{u.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const c of i)try{c(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:tR(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Pm){return this.component?this.component.multipleInstances?e:Pm:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function tR(n){return n===Pm?void 0:n}function nR(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new eR(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gs;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(gs||(gs={}));const iR={debug:gs.DEBUG,verbose:gs.VERBOSE,info:gs.INFO,warn:gs.WARN,error:gs.ERROR,silent:gs.SILENT},oR=gs.INFO,sR={[gs.DEBUG]:"log",[gs.VERBOSE]:"log",[gs.INFO]:"info",[gs.WARN]:"warn",[gs.ERROR]:"error"},aR=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),c=sR[e];if(c)console[c](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ow{constructor(e){this.name=e,this._logLevel=oR,this._logHandler=aR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in gs))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?iR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,gs.DEBUG,...e),this._logHandler(this,gs.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,gs.VERBOSE,...e),this._logHandler(this,gs.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,gs.INFO,...e),this._logHandler(this,gs.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,gs.WARN,...e),this._logHandler(this,gs.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,gs.ERROR,...e),this._logHandler(this,gs.ERROR,...e)}}const lR=(n,e)=>e.some(t=>n instanceof t);let IS,CS;function cR(){return IS||(IS=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function uR(){return CS||(CS=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const y6=new WeakMap,c5=new WeakMap,_6=new WeakMap,bb=new WeakMap,sw=new WeakMap;function hR(n){const e=new Promise((t,i)=>{const c=()=>{n.removeEventListener("success",u),n.removeEventListener("error",m)},u=()=>{t(Hp(n.result)),c()},m=()=>{i(n.error),c()};n.addEventListener("success",u),n.addEventListener("error",m)});return e.then(t=>{t instanceof IDBCursor&&y6.set(t,n)}).catch(()=>{}),sw.set(e,n),e}function dR(n){if(c5.has(n))return;const e=new Promise((t,i)=>{const c=()=>{n.removeEventListener("complete",u),n.removeEventListener("error",m),n.removeEventListener("abort",m)},u=()=>{t(),c()},m=()=>{i(n.error||new DOMException("AbortError","AbortError")),c()};n.addEventListener("complete",u),n.addEventListener("error",m),n.addEventListener("abort",m)});c5.set(n,e)}let u5={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return c5.get(n);if(e==="objectStoreNames")return n.objectStoreNames||_6.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Hp(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function fR(n){u5=n(u5)}function pR(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(wb(this),e,...t);return _6.set(i,e.sort?e.sort():[e]),Hp(i)}:uR().includes(n)?function(...e){return n.apply(wb(this),e),Hp(y6.get(this))}:function(...e){return Hp(n.apply(wb(this),e))}}function mR(n){return typeof n=="function"?pR(n):(n instanceof IDBTransaction&&dR(n),lR(n,cR())?new Proxy(n,u5):n)}function Hp(n){if(n instanceof IDBRequest)return hR(n);if(bb.has(n))return bb.get(n);const e=mR(n);return e!==n&&(bb.set(n,e),sw.set(e,n)),e}const wb=n=>sw.get(n);function gR(n,e,{blocked:t,upgrade:i,blocking:c,terminated:u}={}){const m=indexedDB.open(n,e),_=Hp(m);return i&&m.addEventListener("upgradeneeded",o=>{i(Hp(m.result),o.oldVersion,o.newVersion,Hp(m.transaction),o)}),t&&m.addEventListener("blocked",o=>t(o.oldVersion,o.newVersion,o)),_.then(o=>{u&&o.addEventListener("close",()=>u()),c&&o.addEventListener("versionchange",w=>c(w.oldVersion,w.newVersion,w))}).catch(()=>{}),_}const yR=["get","getKey","getAll","getAllKeys","count"],_R=["put","add","delete","clear"],Sb=new Map;function LS(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Sb.get(e))return Sb.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,c=_R.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(c||yR.includes(t)))return;const u=async function(m,..._){const o=this.transaction(m,c?"readwrite":"readonly");let w=o.store;return i&&(w=w.index(_.shift())),(await Promise.all([w[t](..._),c&&o.done]))[0]};return Sb.set(e,u),u}fR(n=>({...n,get:(e,t,i)=>LS(e,t)||n.get(e,t,i),has:(e,t)=>!!LS(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(xR(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function xR(n){const e=n.getComponent();return e?.type==="VERSION"}const h5="@firebase/app",PS="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fp=new ow("@firebase/app"),bR="@firebase/app-compat",wR="@firebase/analytics-compat",SR="@firebase/analytics",ER="@firebase/app-check-compat",AR="@firebase/app-check",TR="@firebase/auth",IR="@firebase/auth-compat",CR="@firebase/database",LR="@firebase/data-connect",PR="@firebase/database-compat",kR="@firebase/functions",MR="@firebase/functions-compat",RR="@firebase/installations",NR="@firebase/installations-compat",DR="@firebase/messaging",FR="@firebase/messaging-compat",OR="@firebase/performance",BR="@firebase/performance-compat",zR="@firebase/remote-config",jR="@firebase/remote-config-compat",UR="@firebase/storage",VR="@firebase/storage-compat",qR="@firebase/firestore",$R="@firebase/vertexai-preview",GR="@firebase/firestore-compat",WR="firebase",HR="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d5="[DEFAULT]",XR={[h5]:"fire-core",[bR]:"fire-core-compat",[SR]:"fire-analytics",[wR]:"fire-analytics-compat",[AR]:"fire-app-check",[ER]:"fire-app-check-compat",[TR]:"fire-auth",[IR]:"fire-auth-compat",[CR]:"fire-rtdb",[LR]:"fire-data-connect",[PR]:"fire-rtdb-compat",[kR]:"fire-fn",[MR]:"fire-fn-compat",[RR]:"fire-iid",[NR]:"fire-iid-compat",[DR]:"fire-fcm",[FR]:"fire-fcm-compat",[OR]:"fire-perf",[BR]:"fire-perf-compat",[zR]:"fire-rc",[jR]:"fire-rc-compat",[UR]:"fire-gcs",[VR]:"fire-gcs-compat",[qR]:"fire-fst",[GR]:"fire-fst-compat",[$R]:"fire-vertex","fire-js":"fire-js",[WR]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sv=new Map,KR=new Map,f5=new Map;function kS(n,e){try{n.container.addComponent(e)}catch(t){fp.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function o0(n){const e=n.name;if(f5.has(e))return fp.debug(`There were multiple attempts to register component ${e}.`),!1;f5.set(e,n);for(const t of sv.values())kS(t,n);for(const t of KR.values())kS(t,n);return!0}function aw(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function wf(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZR={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Xp=new c_("app","Firebase",ZR);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YR{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Vm("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Xp.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b0=HR;function v6(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i=Object.assign({name:d5,automaticDataCollectionEnabled:!1},e),c=i.name;if(typeof c!="string"||!c)throw Xp.create("bad-app-name",{appName:String(c)});if(t||(t=m6()),!t)throw Xp.create("no-options");const u=sv.get(c);if(u){if(ov(t,u.options)&&ov(i,u.config))return u;throw Xp.create("duplicate-app",{appName:c})}const m=new rR(c);for(const o of f5.values())m.addComponent(o);const _=new YR(t,i,m);return sv.set(c,_),_}function x6(n=d5){const e=sv.get(n);if(!e&&n===d5&&m6())return v6();if(!e)throw Xp.create("no-app",{appName:n});return e}function Kp(n,e,t){var i;let c=(i=XR[n])!==null&&i!==void 0?i:n;t&&(c+=`-${t}`);const u=c.match(/\s|\//),m=e.match(/\s|\//);if(u||m){const _=[`Unable to register library "${c}" with version "${e}":`];u&&_.push(`library name "${c}" contains illegal characters (whitespace or "/")`),u&&m&&_.push("and"),m&&_.push(`version name "${e}" contains illegal characters (whitespace or "/")`),fp.warn(_.join(" "));return}o0(new Vm(`${c}-version`,()=>({library:c,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JR="firebase-heartbeat-database",QR=1,Hy="firebase-heartbeat-store";let Eb=null;function b6(){return Eb||(Eb=gR(JR,QR,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Hy)}catch(t){console.warn(t)}}}}).catch(n=>{throw Xp.create("idb-open",{originalErrorMessage:n.message})})),Eb}async function eN(n){try{const t=(await b6()).transaction(Hy),i=await t.objectStore(Hy).get(w6(n));return await t.done,i}catch(e){if(e instanceof _p)fp.warn(e.message);else{const t=Xp.create("idb-get",{originalErrorMessage:e?.message});fp.warn(t.message)}}}async function MS(n,e){try{const i=(await b6()).transaction(Hy,"readwrite");await i.objectStore(Hy).put(e,w6(n)),await i.done}catch(t){if(t instanceof _p)fp.warn(t.message);else{const i=Xp.create("idb-set",{originalErrorMessage:t?.message});fp.warn(i.message)}}}function w6(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tN=1024,nN=720*60*60*1e3;class rN{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new oN(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const c=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),u=RS();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===u||this._heartbeatsCache.heartbeats.some(m=>m.date===u)?void 0:(this._heartbeatsCache.heartbeats.push({date:u,agent:c}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(m=>{const _=new Date(m.date).valueOf();return Date.now()-_<=nN}),this._storage.overwrite(this._heartbeatsCache))}catch(i){fp.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=RS(),{heartbeatsToSend:i,unsentEntries:c}=iN(this._heartbeatsCache.heartbeats),u=iv(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}catch(t){return fp.warn(t),""}}}function RS(){return new Date().toISOString().substring(0,10)}function iN(n,e=tN){const t=[];let i=n.slice();for(const c of n){const u=t.find(m=>m.agent===c.agent);if(u){if(u.dates.push(c.date),NS(t)>e){u.dates.pop();break}}else if(t.push({agent:c.agent,dates:[c.date]}),NS(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class oN{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return GM()?WM().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await eN(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const c=await this.read();return MS(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:c.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const c=await this.read();return MS(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...e.heartbeats]})}else return}}function NS(n){return iv(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sN(n){o0(new Vm("platform-logger",e=>new vR(e),"PRIVATE")),o0(new Vm("heartbeat",e=>new rN(e),"PRIVATE")),Kp(h5,PS,n),Kp(h5,PS,"esm2017"),Kp("fire-js","")}sN("");var aN="firebase",lN="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Kp(aN,lN,"app");var DS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var zm,S6;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(de,j){function D(){}D.prototype=j.prototype,de.D=j.prototype,de.prototype=new D,de.prototype.constructor=de,de.C=function($,z,W){for(var Z=Array(arguments.length-2),Ee=2;Ee<arguments.length;Ee++)Z[Ee-2]=arguments[Ee];return j.prototype[z].apply($,Z)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function c(de,j,D){D||(D=0);var $=Array(16);if(typeof j=="string")for(var z=0;16>z;++z)$[z]=j.charCodeAt(D++)|j.charCodeAt(D++)<<8|j.charCodeAt(D++)<<16|j.charCodeAt(D++)<<24;else for(z=0;16>z;++z)$[z]=j[D++]|j[D++]<<8|j[D++]<<16|j[D++]<<24;j=de.g[0],D=de.g[1],z=de.g[2];var W=de.g[3],Z=j+(W^D&(z^W))+$[0]+3614090360&4294967295;j=D+(Z<<7&4294967295|Z>>>25),Z=W+(z^j&(D^z))+$[1]+3905402710&4294967295,W=j+(Z<<12&4294967295|Z>>>20),Z=z+(D^W&(j^D))+$[2]+606105819&4294967295,z=W+(Z<<17&4294967295|Z>>>15),Z=D+(j^z&(W^j))+$[3]+3250441966&4294967295,D=z+(Z<<22&4294967295|Z>>>10),Z=j+(W^D&(z^W))+$[4]+4118548399&4294967295,j=D+(Z<<7&4294967295|Z>>>25),Z=W+(z^j&(D^z))+$[5]+1200080426&4294967295,W=j+(Z<<12&4294967295|Z>>>20),Z=z+(D^W&(j^D))+$[6]+2821735955&4294967295,z=W+(Z<<17&4294967295|Z>>>15),Z=D+(j^z&(W^j))+$[7]+4249261313&4294967295,D=z+(Z<<22&4294967295|Z>>>10),Z=j+(W^D&(z^W))+$[8]+1770035416&4294967295,j=D+(Z<<7&4294967295|Z>>>25),Z=W+(z^j&(D^z))+$[9]+2336552879&4294967295,W=j+(Z<<12&4294967295|Z>>>20),Z=z+(D^W&(j^D))+$[10]+4294925233&4294967295,z=W+(Z<<17&4294967295|Z>>>15),Z=D+(j^z&(W^j))+$[11]+2304563134&4294967295,D=z+(Z<<22&4294967295|Z>>>10),Z=j+(W^D&(z^W))+$[12]+1804603682&4294967295,j=D+(Z<<7&4294967295|Z>>>25),Z=W+(z^j&(D^z))+$[13]+4254626195&4294967295,W=j+(Z<<12&4294967295|Z>>>20),Z=z+(D^W&(j^D))+$[14]+2792965006&4294967295,z=W+(Z<<17&4294967295|Z>>>15),Z=D+(j^z&(W^j))+$[15]+1236535329&4294967295,D=z+(Z<<22&4294967295|Z>>>10),Z=j+(z^W&(D^z))+$[1]+4129170786&4294967295,j=D+(Z<<5&4294967295|Z>>>27),Z=W+(D^z&(j^D))+$[6]+3225465664&4294967295,W=j+(Z<<9&4294967295|Z>>>23),Z=z+(j^D&(W^j))+$[11]+643717713&4294967295,z=W+(Z<<14&4294967295|Z>>>18),Z=D+(W^j&(z^W))+$[0]+3921069994&4294967295,D=z+(Z<<20&4294967295|Z>>>12),Z=j+(z^W&(D^z))+$[5]+3593408605&4294967295,j=D+(Z<<5&4294967295|Z>>>27),Z=W+(D^z&(j^D))+$[10]+38016083&4294967295,W=j+(Z<<9&4294967295|Z>>>23),Z=z+(j^D&(W^j))+$[15]+3634488961&4294967295,z=W+(Z<<14&4294967295|Z>>>18),Z=D+(W^j&(z^W))+$[4]+3889429448&4294967295,D=z+(Z<<20&4294967295|Z>>>12),Z=j+(z^W&(D^z))+$[9]+568446438&4294967295,j=D+(Z<<5&4294967295|Z>>>27),Z=W+(D^z&(j^D))+$[14]+3275163606&4294967295,W=j+(Z<<9&4294967295|Z>>>23),Z=z+(j^D&(W^j))+$[3]+4107603335&4294967295,z=W+(Z<<14&4294967295|Z>>>18),Z=D+(W^j&(z^W))+$[8]+1163531501&4294967295,D=z+(Z<<20&4294967295|Z>>>12),Z=j+(z^W&(D^z))+$[13]+2850285829&4294967295,j=D+(Z<<5&4294967295|Z>>>27),Z=W+(D^z&(j^D))+$[2]+4243563512&4294967295,W=j+(Z<<9&4294967295|Z>>>23),Z=z+(j^D&(W^j))+$[7]+1735328473&4294967295,z=W+(Z<<14&4294967295|Z>>>18),Z=D+(W^j&(z^W))+$[12]+2368359562&4294967295,D=z+(Z<<20&4294967295|Z>>>12),Z=j+(D^z^W)+$[5]+4294588738&4294967295,j=D+(Z<<4&4294967295|Z>>>28),Z=W+(j^D^z)+$[8]+2272392833&4294967295,W=j+(Z<<11&4294967295|Z>>>21),Z=z+(W^j^D)+$[11]+1839030562&4294967295,z=W+(Z<<16&4294967295|Z>>>16),Z=D+(z^W^j)+$[14]+4259657740&4294967295,D=z+(Z<<23&4294967295|Z>>>9),Z=j+(D^z^W)+$[1]+2763975236&4294967295,j=D+(Z<<4&4294967295|Z>>>28),Z=W+(j^D^z)+$[4]+1272893353&4294967295,W=j+(Z<<11&4294967295|Z>>>21),Z=z+(W^j^D)+$[7]+4139469664&4294967295,z=W+(Z<<16&4294967295|Z>>>16),Z=D+(z^W^j)+$[10]+3200236656&4294967295,D=z+(Z<<23&4294967295|Z>>>9),Z=j+(D^z^W)+$[13]+681279174&4294967295,j=D+(Z<<4&4294967295|Z>>>28),Z=W+(j^D^z)+$[0]+3936430074&4294967295,W=j+(Z<<11&4294967295|Z>>>21),Z=z+(W^j^D)+$[3]+3572445317&4294967295,z=W+(Z<<16&4294967295|Z>>>16),Z=D+(z^W^j)+$[6]+76029189&4294967295,D=z+(Z<<23&4294967295|Z>>>9),Z=j+(D^z^W)+$[9]+3654602809&4294967295,j=D+(Z<<4&4294967295|Z>>>28),Z=W+(j^D^z)+$[12]+3873151461&4294967295,W=j+(Z<<11&4294967295|Z>>>21),Z=z+(W^j^D)+$[15]+530742520&4294967295,z=W+(Z<<16&4294967295|Z>>>16),Z=D+(z^W^j)+$[2]+3299628645&4294967295,D=z+(Z<<23&4294967295|Z>>>9),Z=j+(z^(D|~W))+$[0]+4096336452&4294967295,j=D+(Z<<6&4294967295|Z>>>26),Z=W+(D^(j|~z))+$[7]+1126891415&4294967295,W=j+(Z<<10&4294967295|Z>>>22),Z=z+(j^(W|~D))+$[14]+2878612391&4294967295,z=W+(Z<<15&4294967295|Z>>>17),Z=D+(W^(z|~j))+$[5]+4237533241&4294967295,D=z+(Z<<21&4294967295|Z>>>11),Z=j+(z^(D|~W))+$[12]+1700485571&4294967295,j=D+(Z<<6&4294967295|Z>>>26),Z=W+(D^(j|~z))+$[3]+2399980690&4294967295,W=j+(Z<<10&4294967295|Z>>>22),Z=z+(j^(W|~D))+$[10]+4293915773&4294967295,z=W+(Z<<15&4294967295|Z>>>17),Z=D+(W^(z|~j))+$[1]+2240044497&4294967295,D=z+(Z<<21&4294967295|Z>>>11),Z=j+(z^(D|~W))+$[8]+1873313359&4294967295,j=D+(Z<<6&4294967295|Z>>>26),Z=W+(D^(j|~z))+$[15]+4264355552&4294967295,W=j+(Z<<10&4294967295|Z>>>22),Z=z+(j^(W|~D))+$[6]+2734768916&4294967295,z=W+(Z<<15&4294967295|Z>>>17),Z=D+(W^(z|~j))+$[13]+1309151649&4294967295,D=z+(Z<<21&4294967295|Z>>>11),Z=j+(z^(D|~W))+$[4]+4149444226&4294967295,j=D+(Z<<6&4294967295|Z>>>26),Z=W+(D^(j|~z))+$[11]+3174756917&4294967295,W=j+(Z<<10&4294967295|Z>>>22),Z=z+(j^(W|~D))+$[2]+718787259&4294967295,z=W+(Z<<15&4294967295|Z>>>17),Z=D+(W^(z|~j))+$[9]+3951481745&4294967295,de.g[0]=de.g[0]+j&4294967295,de.g[1]=de.g[1]+(z+(Z<<21&4294967295|Z>>>11))&4294967295,de.g[2]=de.g[2]+z&4294967295,de.g[3]=de.g[3]+W&4294967295}i.prototype.u=function(de,j){j===void 0&&(j=de.length);for(var D=j-this.blockSize,$=this.B,z=this.h,W=0;W<j;){if(z==0)for(;W<=D;)c(this,de,W),W+=this.blockSize;if(typeof de=="string"){for(;W<j;)if($[z++]=de.charCodeAt(W++),z==this.blockSize){c(this,$),z=0;break}}else for(;W<j;)if($[z++]=de[W++],z==this.blockSize){c(this,$),z=0;break}}this.h=z,this.o+=j},i.prototype.v=function(){var de=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);de[0]=128;for(var j=1;j<de.length-8;++j)de[j]=0;var D=8*this.o;for(j=de.length-8;j<de.length;++j)de[j]=D&255,D/=256;for(this.u(de),de=Array(16),j=D=0;4>j;++j)for(var $=0;32>$;$+=8)de[D++]=this.g[j]>>>$&255;return de};function u(de,j){var D=_;return Object.prototype.hasOwnProperty.call(D,de)?D[de]:D[de]=j(de)}function m(de,j){this.h=j;for(var D=[],$=!0,z=de.length-1;0<=z;z--){var W=de[z]|0;$&&W==j||(D[z]=W,$=!1)}this.g=D}var _={};function o(de){return-128<=de&&128>de?u(de,function(j){return new m([j|0],0>j?-1:0)}):new m([de|0],0>de?-1:0)}function w(de){if(isNaN(de)||!isFinite(de))return O;if(0>de)return fe(w(-de));for(var j=[],D=1,$=0;de>=D;$++)j[$]=de/D|0,D*=4294967296;return new m(j,0)}function I(de,j){if(de.length==0)throw Error("number format error: empty string");if(j=j||10,2>j||36<j)throw Error("radix out of range: "+j);if(de.charAt(0)=="-")return fe(I(de.substring(1),j));if(0<=de.indexOf("-"))throw Error('number format error: interior "-" character');for(var D=w(Math.pow(j,8)),$=O,z=0;z<de.length;z+=8){var W=Math.min(8,de.length-z),Z=parseInt(de.substring(z,z+W),j);8>W?(W=w(Math.pow(j,W)),$=$.j(W).add(w(Z))):($=$.j(D),$=$.add(w(Z)))}return $}var O=o(0),V=o(1),M=o(16777216);n=m.prototype,n.m=function(){if(ce(this))return-fe(this).m();for(var de=0,j=1,D=0;D<this.g.length;D++){var $=this.i(D);de+=(0<=$?$:4294967296+$)*j,j*=4294967296}return de},n.toString=function(de){if(de=de||10,2>de||36<de)throw Error("radix out of range: "+de);if(se(this))return"0";if(ce(this))return"-"+fe(this).toString(de);for(var j=w(Math.pow(de,6)),D=this,$="";;){var z=he(D,j).g;D=ne(D,z.j(j));var W=((0<D.g.length?D.g[0]:D.h)>>>0).toString(de);if(D=z,se(D))return W+$;for(;6>W.length;)W="0"+W;$=W+$}},n.i=function(de){return 0>de?0:de<this.g.length?this.g[de]:this.h};function se(de){if(de.h!=0)return!1;for(var j=0;j<de.g.length;j++)if(de.g[j]!=0)return!1;return!0}function ce(de){return de.h==-1}n.l=function(de){return de=ne(this,de),ce(de)?-1:se(de)?0:1};function fe(de){for(var j=de.g.length,D=[],$=0;$<j;$++)D[$]=~de.g[$];return new m(D,~de.h).add(V)}n.abs=function(){return ce(this)?fe(this):this},n.add=function(de){for(var j=Math.max(this.g.length,de.g.length),D=[],$=0,z=0;z<=j;z++){var W=$+(this.i(z)&65535)+(de.i(z)&65535),Z=(W>>>16)+(this.i(z)>>>16)+(de.i(z)>>>16);$=Z>>>16,W&=65535,Z&=65535,D[z]=Z<<16|W}return new m(D,D[D.length-1]&-2147483648?-1:0)};function ne(de,j){return de.add(fe(j))}n.j=function(de){if(se(this)||se(de))return O;if(ce(this))return ce(de)?fe(this).j(fe(de)):fe(fe(this).j(de));if(ce(de))return fe(this.j(fe(de)));if(0>this.l(M)&&0>de.l(M))return w(this.m()*de.m());for(var j=this.g.length+de.g.length,D=[],$=0;$<2*j;$++)D[$]=0;for($=0;$<this.g.length;$++)for(var z=0;z<de.g.length;z++){var W=this.i($)>>>16,Z=this.i($)&65535,Ee=de.i(z)>>>16,ke=de.i(z)&65535;D[2*$+2*z]+=Z*ke,oe(D,2*$+2*z),D[2*$+2*z+1]+=W*ke,oe(D,2*$+2*z+1),D[2*$+2*z+1]+=Z*Ee,oe(D,2*$+2*z+1),D[2*$+2*z+2]+=W*Ee,oe(D,2*$+2*z+2)}for($=0;$<j;$++)D[$]=D[2*$+1]<<16|D[2*$];for($=j;$<2*j;$++)D[$]=0;return new m(D,0)};function oe(de,j){for(;(de[j]&65535)!=de[j];)de[j+1]+=de[j]>>>16,de[j]&=65535,j++}function ye(de,j){this.g=de,this.h=j}function he(de,j){if(se(j))throw Error("division by zero");if(se(de))return new ye(O,O);if(ce(de))return j=he(fe(de),j),new ye(fe(j.g),fe(j.h));if(ce(j))return j=he(de,fe(j)),new ye(fe(j.g),j.h);if(30<de.g.length){if(ce(de)||ce(j))throw Error("slowDivide_ only works with positive integers.");for(var D=V,$=j;0>=$.l(de);)D=Ne(D),$=Ne($);var z=Ve(D,1),W=Ve($,1);for($=Ve($,2),D=Ve(D,2);!se($);){var Z=W.add($);0>=Z.l(de)&&(z=z.add(D),W=Z),$=Ve($,1),D=Ve(D,1)}return j=ne(de,z.j(j)),new ye(z,j)}for(z=O;0<=de.l(j);){for(D=Math.max(1,Math.floor(de.m()/j.m())),$=Math.ceil(Math.log(D)/Math.LN2),$=48>=$?1:Math.pow(2,$-48),W=w(D),Z=W.j(j);ce(Z)||0<Z.l(de);)D-=$,W=w(D),Z=W.j(j);se(W)&&(W=V),z=z.add(W),de=ne(de,Z)}return new ye(z,de)}n.A=function(de){return he(this,de).h},n.and=function(de){for(var j=Math.max(this.g.length,de.g.length),D=[],$=0;$<j;$++)D[$]=this.i($)&de.i($);return new m(D,this.h&de.h)},n.or=function(de){for(var j=Math.max(this.g.length,de.g.length),D=[],$=0;$<j;$++)D[$]=this.i($)|de.i($);return new m(D,this.h|de.h)},n.xor=function(de){for(var j=Math.max(this.g.length,de.g.length),D=[],$=0;$<j;$++)D[$]=this.i($)^de.i($);return new m(D,this.h^de.h)};function Ne(de){for(var j=de.g.length+1,D=[],$=0;$<j;$++)D[$]=de.i($)<<1|de.i($-1)>>>31;return new m(D,de.h)}function Ve(de,j){var D=j>>5;j%=32;for(var $=de.g.length-D,z=[],W=0;W<$;W++)z[W]=0<j?de.i(W+D)>>>j|de.i(W+D+1)<<32-j:de.i(W+D);return new m(z,de.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,S6=i,m.prototype.add=m.prototype.add,m.prototype.multiply=m.prototype.j,m.prototype.modulo=m.prototype.A,m.prototype.compare=m.prototype.l,m.prototype.toNumber=m.prototype.m,m.prototype.toString=m.prototype.toString,m.prototype.getBits=m.prototype.i,m.fromNumber=w,m.fromString=I,zm=m}).apply(typeof DS<"u"?DS:typeof self<"u"?self:typeof window<"u"?window:{});var a1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var E6,_y,A6,R1,p5,T6,I6,C6;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(L,re,_e){return L==Array.prototype||L==Object.prototype||(L[re]=_e.value),L};function t(L){L=[typeof globalThis=="object"&&globalThis,L,typeof window=="object"&&window,typeof self=="object"&&self,typeof a1=="object"&&a1];for(var re=0;re<L.length;++re){var _e=L[re];if(_e&&_e.Math==Math)return _e}throw Error("Cannot find global object")}var i=t(this);function c(L,re){if(re)e:{var _e=i;L=L.split(".");for(var $e=0;$e<L.length-1;$e++){var Xt=L[$e];if(!(Xt in _e))break e;_e=_e[Xt]}L=L[L.length-1],$e=_e[L],re=re($e),re!=$e&&re!=null&&e(_e,L,{configurable:!0,writable:!0,value:re})}}function u(L,re){L instanceof String&&(L+="");var _e=0,$e=!1,Xt={next:function(){if(!$e&&_e<L.length){var nn=_e++;return{value:re(nn,L[nn]),done:!1}}return $e=!0,{done:!0,value:void 0}}};return Xt[Symbol.iterator]=function(){return Xt},Xt}c("Array.prototype.values",function(L){return L||function(){return u(this,function(re,_e){return _e})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var m=m||{},_=this||self;function o(L){var re=typeof L;return re=re!="object"?re:L?Array.isArray(L)?"array":re:"null",re=="array"||re=="object"&&typeof L.length=="number"}function w(L){var re=typeof L;return re=="object"&&L!=null||re=="function"}function I(L,re,_e){return L.call.apply(L.bind,arguments)}function O(L,re,_e){if(!L)throw Error();if(2<arguments.length){var $e=Array.prototype.slice.call(arguments,2);return function(){var Xt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Xt,$e),L.apply(re,Xt)}}return function(){return L.apply(re,arguments)}}function V(L,re,_e){return V=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?I:O,V.apply(null,arguments)}function M(L,re){var _e=Array.prototype.slice.call(arguments,1);return function(){var $e=_e.slice();return $e.push.apply($e,arguments),L.apply(this,$e)}}function se(L,re){function _e(){}_e.prototype=re.prototype,L.aa=re.prototype,L.prototype=new _e,L.prototype.constructor=L,L.Qb=function($e,Xt,nn){for(var Un=Array(arguments.length-2),mo=2;mo<arguments.length;mo++)Un[mo-2]=arguments[mo];return re.prototype[Xt].apply($e,Un)}}function ce(L){const re=L.length;if(0<re){const _e=Array(re);for(let $e=0;$e<re;$e++)_e[$e]=L[$e];return _e}return[]}function fe(L,re){for(let _e=1;_e<arguments.length;_e++){const $e=arguments[_e];if(o($e)){const Xt=L.length||0,nn=$e.length||0;L.length=Xt+nn;for(let Un=0;Un<nn;Un++)L[Xt+Un]=$e[Un]}else L.push($e)}}class ne{constructor(re,_e){this.i=re,this.j=_e,this.h=0,this.g=null}get(){let re;return 0<this.h?(this.h--,re=this.g,this.g=re.next,re.next=null):re=this.i(),re}}function oe(L){return/^[\s\xa0]*$/.test(L)}function ye(){var L=_.navigator;return L&&(L=L.userAgent)?L:""}function he(L){return he[" "](L),L}he[" "]=function(){};var Ne=ye().indexOf("Gecko")!=-1&&!(ye().toLowerCase().indexOf("webkit")!=-1&&ye().indexOf("Edge")==-1)&&!(ye().indexOf("Trident")!=-1||ye().indexOf("MSIE")!=-1)&&ye().indexOf("Edge")==-1;function Ve(L,re,_e){for(const $e in L)re.call(_e,L[$e],$e,L)}function de(L,re){for(const _e in L)re.call(void 0,L[_e],_e,L)}function j(L){const re={};for(const _e in L)re[_e]=L[_e];return re}const D="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $(L,re){let _e,$e;for(let Xt=1;Xt<arguments.length;Xt++){$e=arguments[Xt];for(_e in $e)L[_e]=$e[_e];for(let nn=0;nn<D.length;nn++)_e=D[nn],Object.prototype.hasOwnProperty.call($e,_e)&&(L[_e]=$e[_e])}}function z(L){var re=1;L=L.split(":");const _e=[];for(;0<re&&L.length;)_e.push(L.shift()),re--;return L.length&&_e.push(L.join(":")),_e}function W(L){_.setTimeout(()=>{throw L},0)}function Z(){var L=De;let re=null;return L.g&&(re=L.g,L.g=L.g.next,L.g||(L.h=null),re.next=null),re}class Ee{constructor(){this.h=this.g=null}add(re,_e){const $e=ke.get();$e.set(re,_e),this.h?this.h.next=$e:this.g=$e,this.h=$e}}var ke=new ne(()=>new Oe,L=>L.reset());class Oe{constructor(){this.next=this.g=this.h=null}set(re,_e){this.h=re,this.g=_e,this.next=null}reset(){this.next=this.g=this.h=null}}let Re,be=!1,De=new Ee,Qe=()=>{const L=_.Promise.resolve(void 0);Re=()=>{L.then(xe)}};var xe=()=>{for(var L;L=Z();){try{L.h.call(L.g)}catch(_e){W(_e)}var re=ke;re.j(L),100>re.h&&(re.h++,L.next=re.g,re.g=L)}be=!1};function ae(){this.s=this.s,this.C=this.C}ae.prototype.s=!1,ae.prototype.ma=function(){this.s||(this.s=!0,this.N())},ae.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Me(L,re){this.type=L,this.g=this.target=re,this.defaultPrevented=!1}Me.prototype.h=function(){this.defaultPrevented=!0};var Fe=(function(){if(!_.addEventListener||!Object.defineProperty)return!1;var L=!1,re=Object.defineProperty({},"passive",{get:function(){L=!0}});try{const _e=()=>{};_.addEventListener("test",_e,re),_.removeEventListener("test",_e,re)}catch{}return L})();function Ze(L,re){if(Me.call(this,L?L.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,L){var _e=this.type=L.type,$e=L.changedTouches&&L.changedTouches.length?L.changedTouches[0]:null;if(this.target=L.target||L.srcElement,this.g=re,re=L.relatedTarget){if(Ne){e:{try{he(re.nodeName);var Xt=!0;break e}catch{}Xt=!1}Xt||(re=null)}}else _e=="mouseover"?re=L.fromElement:_e=="mouseout"&&(re=L.toElement);this.relatedTarget=re,$e?(this.clientX=$e.clientX!==void 0?$e.clientX:$e.pageX,this.clientY=$e.clientY!==void 0?$e.clientY:$e.pageY,this.screenX=$e.screenX||0,this.screenY=$e.screenY||0):(this.clientX=L.clientX!==void 0?L.clientX:L.pageX,this.clientY=L.clientY!==void 0?L.clientY:L.pageY,this.screenX=L.screenX||0,this.screenY=L.screenY||0),this.button=L.button,this.key=L.key||"",this.ctrlKey=L.ctrlKey,this.altKey=L.altKey,this.shiftKey=L.shiftKey,this.metaKey=L.metaKey,this.pointerId=L.pointerId||0,this.pointerType=typeof L.pointerType=="string"?L.pointerType:et[L.pointerType]||"",this.state=L.state,this.i=L,L.defaultPrevented&&Ze.aa.h.call(this)}}se(Ze,Me);var et={2:"touch",3:"pen",4:"mouse"};Ze.prototype.h=function(){Ze.aa.h.call(this);var L=this.i;L.preventDefault?L.preventDefault():L.returnValue=!1};var mt="closure_listenable_"+(1e6*Math.random()|0),ht=0;function Nt(L,re,_e,$e,Xt){this.listener=L,this.proxy=null,this.src=re,this.type=_e,this.capture=!!$e,this.ha=Xt,this.key=++ht,this.da=this.fa=!1}function Jt(L){L.da=!0,L.listener=null,L.proxy=null,L.src=null,L.ha=null}function tn(L){this.src=L,this.g={},this.h=0}tn.prototype.add=function(L,re,_e,$e,Xt){var nn=L.toString();L=this.g[nn],L||(L=this.g[nn]=[],this.h++);var Un=An(L,re,$e,Xt);return-1<Un?(re=L[Un],_e||(re.fa=!1)):(re=new Nt(re,this.src,nn,!!$e,Xt),re.fa=_e,L.push(re)),re};function fn(L,re){var _e=re.type;if(_e in L.g){var $e=L.g[_e],Xt=Array.prototype.indexOf.call($e,re,void 0),nn;(nn=0<=Xt)&&Array.prototype.splice.call($e,Xt,1),nn&&(Jt(re),L.g[_e].length==0&&(delete L.g[_e],L.h--))}}function An(L,re,_e,$e){for(var Xt=0;Xt<L.length;++Xt){var nn=L[Xt];if(!nn.da&&nn.listener==re&&nn.capture==!!_e&&nn.ha==$e)return Xt}return-1}var zt="closure_lm_"+(1e6*Math.random()|0),it={};function ur(L,re,_e,$e,Xt){if(Array.isArray(re)){for(var nn=0;nn<re.length;nn++)ur(L,re[nn],_e,$e,Xt);return null}return _e=tr(_e),L&&L[mt]?L.K(re,_e,w($e)?!!$e.capture:!1,Xt):xr(L,re,_e,!1,$e,Xt)}function xr(L,re,_e,$e,Xt,nn){if(!re)throw Error("Invalid event type");var Un=w(Xt)?!!Xt.capture:!!Xt,mo=Wt(L);if(mo||(L[zt]=mo=new tn(L)),_e=mo.add(re,_e,$e,Un,nn),_e.proxy)return _e;if($e=Tr(),_e.proxy=$e,$e.src=L,$e.listener=_e,L.addEventListener)Fe||(Xt=Un),Xt===void 0&&(Xt=!1),L.addEventListener(re.toString(),$e,Xt);else if(L.attachEvent)L.attachEvent($n(re.toString()),$e);else if(L.addListener&&L.removeListener)L.addListener($e);else throw Error("addEventListener and attachEvent are unavailable.");return _e}function Tr(){function L(_e){return re.call(L.src,L.listener,_e)}const re=hr;return L}function Tn(L,re,_e,$e,Xt){if(Array.isArray(re))for(var nn=0;nn<re.length;nn++)Tn(L,re[nn],_e,$e,Xt);else $e=w($e)?!!$e.capture:!!$e,_e=tr(_e),L&&L[mt]?(L=L.i,re=String(re).toString(),re in L.g&&(nn=L.g[re],_e=An(nn,_e,$e,Xt),-1<_e&&(Jt(nn[_e]),Array.prototype.splice.call(nn,_e,1),nn.length==0&&(delete L.g[re],L.h--)))):L&&(L=Wt(L))&&(re=L.g[re.toString()],L=-1,re&&(L=An(re,_e,$e,Xt)),(_e=-1<L?re[L]:null)&&Yn(_e))}function Yn(L){if(typeof L!="number"&&L&&!L.da){var re=L.src;if(re&&re[mt])fn(re.i,L);else{var _e=L.type,$e=L.proxy;re.removeEventListener?re.removeEventListener(_e,$e,L.capture):re.detachEvent?re.detachEvent($n(_e),$e):re.addListener&&re.removeListener&&re.removeListener($e),(_e=Wt(re))?(fn(_e,L),_e.h==0&&(_e.src=null,re[zt]=null)):Jt(L)}}}function $n(L){return L in it?it[L]:it[L]="on"+L}function hr(L,re){if(L.da)L=!0;else{re=new Ze(re,this);var _e=L.listener,$e=L.ha||L.src;L.fa&&Yn(L),L=_e.call($e,re)}return L}function Wt(L){return L=L[zt],L instanceof tn?L:null}var Nn="__closure_events_fn_"+(1e9*Math.random()>>>0);function tr(L){return typeof L=="function"?L:(L[Nn]||(L[Nn]=function(re){return L.handleEvent(re)}),L[Nn])}function Hn(){ae.call(this),this.i=new tn(this),this.M=this,this.F=null}se(Hn,ae),Hn.prototype[mt]=!0,Hn.prototype.removeEventListener=function(L,re,_e,$e){Tn(this,L,re,_e,$e)};function Rr(L,re){var _e,$e=L.F;if($e)for(_e=[];$e;$e=$e.F)_e.push($e);if(L=L.M,$e=re.type||re,typeof re=="string")re=new Me(re,L);else if(re instanceof Me)re.target=re.target||L;else{var Xt=re;re=new Me($e,L),$(re,Xt)}if(Xt=!0,_e)for(var nn=_e.length-1;0<=nn;nn--){var Un=re.g=_e[nn];Xt=lr(Un,$e,!0,re)&&Xt}if(Un=re.g=L,Xt=lr(Un,$e,!0,re)&&Xt,Xt=lr(Un,$e,!1,re)&&Xt,_e)for(nn=0;nn<_e.length;nn++)Un=re.g=_e[nn],Xt=lr(Un,$e,!1,re)&&Xt}Hn.prototype.N=function(){if(Hn.aa.N.call(this),this.i){var L=this.i,re;for(re in L.g){for(var _e=L.g[re],$e=0;$e<_e.length;$e++)Jt(_e[$e]);delete L.g[re],L.h--}}this.F=null},Hn.prototype.K=function(L,re,_e,$e){return this.i.add(String(L),re,!1,_e,$e)},Hn.prototype.L=function(L,re,_e,$e){return this.i.add(String(L),re,!0,_e,$e)};function lr(L,re,_e,$e){if(re=L.i.g[String(re)],!re)return!0;re=re.concat();for(var Xt=!0,nn=0;nn<re.length;++nn){var Un=re[nn];if(Un&&!Un.da&&Un.capture==_e){var mo=Un.listener,jo=Un.ha||Un.src;Un.fa&&fn(L.i,Un),Xt=mo.call(jo,$e)!==!1&&Xt}}return Xt&&!$e.defaultPrevented}function wr(L,re,_e){if(typeof L=="function")_e&&(L=V(L,_e));else if(L&&typeof L.handleEvent=="function")L=V(L.handleEvent,L);else throw Error("Invalid listener argument");return 2147483647<Number(re)?-1:_.setTimeout(L,re||0)}function br(L){L.g=wr(()=>{L.g=null,L.i&&(L.i=!1,br(L))},L.l);const re=L.h;L.h=null,L.m.apply(null,re)}class Ir extends ae{constructor(re,_e){super(),this.m=re,this.l=_e,this.h=null,this.i=!1,this.g=null}j(re){this.h=arguments,this.g?this.i=!0:br(this)}N(){super.N(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Bi(L){ae.call(this),this.h=L,this.g={}}se(Bi,ae);var Mi=[];function pr(L){Ve(L.g,function(re,_e){this.g.hasOwnProperty(_e)&&Yn(re)},L),L.g={}}Bi.prototype.N=function(){Bi.aa.N.call(this),pr(this)},Bi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Jr=_.JSON.stringify,Kr=_.JSON.parse,Sr=class{stringify(L){return _.JSON.stringify(L,void 0)}parse(L){return _.JSON.parse(L,void 0)}};function ui(){}ui.prototype.h=null;function ii(L){return L.h||(L.h=L.i())}function ut(){}var we={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ie(){Me.call(this,"d")}se(Ie,Me);function Ye(){Me.call(this,"c")}se(Ye,Me);var ct={},Ct=null;function Rt(){return Ct=Ct||new Hn}ct.La="serverreachability";function Bt(L){Me.call(this,ct.La,L)}se(Bt,Me);function St(L){const re=Rt();Rr(re,new Bt(re))}ct.STAT_EVENT="statevent";function Mt(L,re){Me.call(this,ct.STAT_EVENT,L),this.stat=re}se(Mt,Me);function vn(L){const re=Rt();Rr(re,new Mt(re,L))}ct.Ma="timingevent";function Bn(L,re){Me.call(this,ct.Ma,L),this.size=re}se(Bn,Me);function Ln(L,re){if(typeof L!="function")throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){L()},re)}function qr(){this.g=!0}qr.prototype.xa=function(){this.g=!1};function Cr(L,re,_e,$e,Xt,nn){L.info(function(){if(L.g)if(nn)for(var Un="",mo=nn.split("&"),jo=0;jo<mo.length;jo++){var Hi=mo[jo].split("=");if(1<Hi.length){var Qr=Hi[0];Hi=Hi[1];var xo=Qr.split("_");Un=2<=xo.length&&xo[1]=="type"?Un+(Qr+"="+Hi+"&"):Un+(Qr+"=redacted&")}}else Un=null;else Un=nn;return"XMLHTTP REQ ("+$e+") [attempt "+Xt+"]: "+re+`
`+_e+`
`+Un})}function Ar(L,re,_e,$e,Xt,nn,Un){L.info(function(){return"XMLHTTP RESP ("+$e+") [ attempt "+Xt+"]: "+re+`
`+_e+`
`+nn+" "+Un})}function Dr(L,re,_e,$e){L.info(function(){return"XMLHTTP TEXT ("+re+"): "+ko(L,_e)+($e?" "+$e:"")})}function _i(L,re){L.info(function(){return"TIMEOUT: "+re})}qr.prototype.info=function(){};function ko(L,re){if(!L.g)return re;if(!re)return null;try{var _e=JSON.parse(re);if(_e){for(L=0;L<_e.length;L++)if(Array.isArray(_e[L])){var $e=_e[L];if(!(2>$e.length)){var Xt=$e[1];if(Array.isArray(Xt)&&!(1>Xt.length)){var nn=Xt[0];if(nn!="noop"&&nn!="stop"&&nn!="close")for(var Un=1;Un<Xt.length;Un++)Xt[Un]=""}}}}return Jr(_e)}catch{return re}}var ro={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},os={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ji;function Yo(){}se(Yo,ui),Yo.prototype.g=function(){return new XMLHttpRequest},Yo.prototype.i=function(){return{}},Ji=new Yo;function oo(L,re,_e,$e){this.j=L,this.i=re,this.l=_e,this.R=$e||1,this.U=new Bi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Jo}function Jo(){this.i=null,this.g="",this.h=!1}var La={},zl={};function jl(L,re,_e){L.L=1,L.v=dl(ei(re)),L.m=_e,L.P=!0,Fi(L,null)}function Fi(L,re){L.F=Date.now(),Oi(L),L.A=ei(L.v);var _e=L.A,$e=L.R;Array.isArray($e)||($e=[String($e)]),oi(_e.i,"t",$e),L.C=0,_e=L.j.J,L.h=new Jo,L.g=$o(L.j,_e?re:null,!L.m),0<L.O&&(L.M=new Ir(V(L.Y,L,L.g),L.O)),re=L.U,_e=L.g,$e=L.ca;var Xt="readystatechange";Array.isArray(Xt)||(Xt&&(Mi[0]=Xt.toString()),Xt=Mi);for(var nn=0;nn<Xt.length;nn++){var Un=ur(_e,Xt[nn],$e||re.handleEvent,!1,re.h||re);if(!Un)break;re.g[Un.key]=Un}re=L.H?j(L.H):{},L.m?(L.u||(L.u="POST"),re["Content-Type"]="application/x-www-form-urlencoded",L.g.ea(L.A,L.u,L.m,re)):(L.u="GET",L.g.ea(L.A,L.u,null,re)),St(),Cr(L.i,L.u,L.A,L.l,L.R,L.m)}oo.prototype.ca=function(L){L=L.target;const re=this.M;re&&Gs(L)==3?re.j():this.Y(L)},oo.prototype.Y=function(L){try{if(L==this.g)e:{const xo=Gs(this.g);var re=this.g.Ba();const fs=this.g.Z();if(!(3>xo)&&(xo!=3||this.g&&(this.h.h||this.g.oa()||qo(this.g)))){this.J||xo!=4||re==7||(re==8||0>=fs?St(3):St(2)),Pa(this);var _e=this.g.Z();this.X=_e;t:if(nc(this)){var $e=qo(this.g);L="";var Xt=$e.length,nn=Gs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Sa(this),Qo(this);var Un="";break t}this.h.i=new _.TextDecoder}for(re=0;re<Xt;re++)this.h.h=!0,L+=this.h.i.decode($e[re],{stream:!(nn&&re==Xt-1)});$e.length=0,this.h.g+=L,this.C=0,Un=this.h.g}else Un=this.g.oa();if(this.o=_e==200,Ar(this.i,this.u,this.A,this.l,this.R,xo,_e),this.o){if(this.T&&!this.K){t:{if(this.g){var mo,jo=this.g;if((mo=jo.g?jo.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!oe(mo)){var Hi=mo;break t}}Hi=null}if(_e=Hi)Dr(this.i,this.l,_e,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ec(this,_e);else{this.o=!1,this.s=3,vn(12),Sa(this),Qo(this);break e}}if(this.P){_e=!0;let pa;for(;!this.J&&this.C<Un.length;)if(pa=Hc(this,Un),pa==zl){xo==4&&(this.s=4,vn(14),_e=!1),Dr(this.i,this.l,null,"[Incomplete Response]");break}else if(pa==La){this.s=4,vn(15),Dr(this.i,this.l,Un,"[Invalid Chunk]"),_e=!1;break}else Dr(this.i,this.l,pa,null),Ec(this,pa);if(nc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),xo!=4||Un.length!=0||this.h.h||(this.s=1,vn(16),_e=!1),this.o=this.o&&_e,!_e)Dr(this.i,this.l,Un,"[Invalid Chunked Response]"),Sa(this),Qo(this);else if(0<Un.length&&!this.W){this.W=!0;var Qr=this.j;Qr.g==this&&Qr.ba&&!Qr.M&&(Qr.j.info("Great, no buffering proxy detected. Bytes received: "+Un.length),Pr(Qr),Qr.M=!0,vn(11))}}else Dr(this.i,this.l,Un,null),Ec(this,Un);xo==4&&Sa(this),this.o&&!this.J&&(xo==4?xi(this.j,this):(this.o=!1,Oi(this)))}else Es(this.g),_e==400&&0<Un.indexOf("Unknown SID")?(this.s=3,vn(12)):(this.s=0,vn(13)),Sa(this),Qo(this)}}}catch{}finally{}};function nc(L){return L.g?L.u=="GET"&&L.L!=2&&L.j.Ca:!1}function Hc(L,re){var _e=L.C,$e=re.indexOf(`
`,_e);return $e==-1?zl:(_e=Number(re.substring(_e,$e)),isNaN(_e)?La:($e+=1,$e+_e>re.length?zl:(re=re.slice($e,$e+_e),L.C=$e+_e,re)))}oo.prototype.cancel=function(){this.J=!0,Sa(this)};function Oi(L){L.S=Date.now()+L.I,Sc(L,L.I)}function Sc(L,re){if(L.B!=null)throw Error("WatchDog timer not null");L.B=Ln(V(L.ba,L),re)}function Pa(L){L.B&&(_.clearTimeout(L.B),L.B=null)}oo.prototype.ba=function(){this.B=null;const L=Date.now();0<=L-this.S?(_i(this.i,this.A),this.L!=2&&(St(),vn(17)),Sa(this),this.s=2,Qo(this)):Sc(this,this.S-L)};function Qo(L){L.j.G==0||L.J||xi(L.j,L)}function Sa(L){Pa(L);var re=L.M;re&&typeof re.ma=="function"&&re.ma(),L.M=null,pr(L.U),L.g&&(re=L.g,L.g=null,re.abort(),re.ma())}function Ec(L,re){try{var _e=L.j;if(_e.G!=0&&(_e.g==L||ss(_e.h,L))){if(!L.K&&ss(_e.h,L)&&_e.G==3){try{var $e=_e.Da.g.parse(re)}catch{$e=null}if(Array.isArray($e)&&$e.length==3){var Xt=$e;if(Xt[0]==0){e:if(!_e.u){if(_e.g)if(_e.g.F+3e3<L.F)gi(_e),Ws(_e);else break e;Dn(_e),vn(18)}}else _e.za=Xt[1],0<_e.za-_e.T&&37500>Xt[2]&&_e.F&&_e.v==0&&!_e.C&&(_e.C=Ln(V(_e.Za,_e),6e3));if(1>=pn(_e.h)&&_e.ca){try{_e.ca()}catch{}_e.ca=void 0}}else lo(_e,11)}else if((L.K||_e.g==L)&&gi(_e),!oe(re))for(Xt=_e.Da.g.parse(re),re=0;re<Xt.length;re++){let Hi=Xt[re];if(_e.T=Hi[0],Hi=Hi[1],_e.G==2)if(Hi[0]=="c"){_e.K=Hi[1],_e.ia=Hi[2];const Qr=Hi[3];Qr!=null&&(_e.la=Qr,_e.j.info("VER="+_e.la));const xo=Hi[4];xo!=null&&(_e.Aa=xo,_e.j.info("SVER="+_e.Aa));const fs=Hi[5];fs!=null&&typeof fs=="number"&&0<fs&&($e=1.5*fs,_e.L=$e,_e.j.info("backChannelRequestTimeoutMs_="+$e)),$e=_e;const pa=L.g;if(pa){const Rs=pa.g?pa.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Rs){var nn=$e.h;nn.g||Rs.indexOf("spdy")==-1&&Rs.indexOf("quic")==-1&&Rs.indexOf("h2")==-1||(nn.j=nn.l,nn.g=new Set,nn.h&&(as(nn,nn.h),nn.h=null))}if($e.D){const Tl=pa.g?pa.g.getResponseHeader("X-HTTP-Session-Id"):null;Tl&&($e.ya=Tl,Lr($e.I,$e.D,Tl))}}_e.G=3,_e.l&&_e.l.ua(),_e.ba&&(_e.R=Date.now()-L.F,_e.j.info("Handshake RTT: "+_e.R+"ms")),$e=_e;var Un=L;if($e.qa=eo($e,$e.J?$e.ia:null,$e.W),Un.K){Qi($e.h,Un);var mo=Un,jo=$e.L;jo&&(mo.I=jo),mo.B&&(Pa(mo),Oi(mo)),$e.g=Un}else on($e);0<_e.i.length&&H(_e)}else Hi[0]!="stop"&&Hi[0]!="close"||lo(_e,7);else _e.G==3&&(Hi[0]=="stop"||Hi[0]=="close"?Hi[0]=="stop"?lo(_e,7):ks(_e):Hi[0]!="noop"&&_e.l&&_e.l.ta(Hi),_e.v=0)}}St(4)}catch{}}var hl=class{constructor(L,re){this.g=L,this.map=re}};function Ea(L){this.l=L||10,_.PerformanceNavigationTiming?(L=_.performance.getEntriesByType("navigation"),L=0<L.length&&(L[0].nextHopProtocol=="hq"||L[0].nextHopProtocol=="h2")):L=!!(_.chrome&&_.chrome.loadTimes&&_.chrome.loadTimes()&&_.chrome.loadTimes().wasFetchedViaSpdy),this.j=L?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ro(L){return L.h?!0:L.g?L.g.size>=L.j:!1}function pn(L){return L.h?1:L.g?L.g.size:0}function ss(L,re){return L.h?L.h==re:L.g?L.g.has(re):!1}function as(L,re){L.g?L.g.add(re):L.h=re}function Qi(L,re){L.h&&L.h==re?L.h=null:L.g&&L.g.has(re)&&L.g.delete(re)}Ea.prototype.cancel=function(){if(this.i=Au(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const L of this.g.values())L.cancel();this.g.clear()}};function Au(L){if(L.h!=null)return L.i.concat(L.h.D);if(L.g!=null&&L.g.size!==0){let re=L.i;for(const _e of L.g.values())re=re.concat(_e.D);return re}return ce(L.i)}function ka(L){if(L.V&&typeof L.V=="function")return L.V();if(typeof Map<"u"&&L instanceof Map||typeof Set<"u"&&L instanceof Set)return Array.from(L.values());if(typeof L=="string")return L.split("");if(o(L)){for(var re=[],_e=L.length,$e=0;$e<_e;$e++)re.push(L[$e]);return re}re=[],_e=0;for($e in L)re[_e++]=L[$e];return re}function Za(L){if(L.na&&typeof L.na=="function")return L.na();if(!L.V||typeof L.V!="function"){if(typeof Map<"u"&&L instanceof Map)return Array.from(L.keys());if(!(typeof Set<"u"&&L instanceof Set)){if(o(L)||typeof L=="string"){var re=[];L=L.length;for(var _e=0;_e<L;_e++)re.push(_e);return re}re=[],_e=0;for(const $e in L)re[_e++]=$e;return re}}}function ls(L,re){if(L.forEach&&typeof L.forEach=="function")L.forEach(re,void 0);else if(o(L)||typeof L=="string")Array.prototype.forEach.call(L,re,void 0);else for(var _e=Za(L),$e=ka(L),Xt=$e.length,nn=0;nn<Xt;nn++)re.call(void 0,$e[nn],_e&&_e[nn],L)}var Us=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Qn(L,re){if(L){L=L.split("&");for(var _e=0;_e<L.length;_e++){var $e=L[_e].indexOf("="),Xt=null;if(0<=$e){var nn=L[_e].substring(0,$e);Xt=L[_e].substring($e+1)}else nn=L[_e];re(nn,Xt?decodeURIComponent(Xt.replace(/\+/g," ")):"")}}}function Fr(L){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,L instanceof Fr){this.h=L.h,aa(this,L.j),this.o=L.o,this.g=L.g,fa(this,L.s),this.l=L.l;var re=L.i,_e=new Mo;_e.i=re.i,re.g&&(_e.g=new Map(re.g),_e.h=re.h),vi(this,_e),this.m=L.m}else L&&(re=String(L).match(Us))?(this.h=!1,aa(this,re[1]||"",!0),this.o=zi(re[2]||""),this.g=zi(re[3]||"",!0),fa(this,re[4]),this.l=zi(re[5]||"",!0),vi(this,re[6]||"",!0),this.m=zi(re[7]||"")):(this.h=!1,this.i=new Mo(null,this.h))}Fr.prototype.toString=function(){var L=[],re=this.j;re&&L.push(es(re,Tu,!0),":");var _e=this.g;return(_e||re=="file")&&(L.push("//"),(re=this.o)&&L.push(es(re,Tu,!0),"@"),L.push(encodeURIComponent(String(_e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),_e=this.s,_e!=null&&L.push(":",String(_e))),(_e=this.l)&&(this.g&&_e.charAt(0)!="/"&&L.push("/"),L.push(es(_e,_e.charAt(0)=="/"?Ac:Sl,!0))),(_e=this.i.toString())&&L.push("?",_e),(_e=this.m)&&L.push("#",es(_e,El)),L.join("")};function ei(L){return new Fr(L)}function aa(L,re,_e){L.j=_e?zi(re,!0):re,L.j&&(L.j=L.j.replace(/:$/,""))}function fa(L,re){if(re){if(re=Number(re),isNaN(re)||0>re)throw Error("Bad port number "+re);L.s=re}else L.s=null}function vi(L,re,_e){re instanceof Mo?(L.i=re,No(L.i,L.h)):(_e||(re=es(re,rc)),L.i=new Mo(re,L.h))}function Lr(L,re,_e){L.i.set(re,_e)}function dl(L){return Lr(L,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),L}function zi(L,re){return L?re?decodeURI(L.replace(/%25/g,"%2525")):decodeURIComponent(L):""}function es(L,re,_e){return typeof L=="string"?(L=encodeURI(L).replace(re,_o),_e&&(L=L.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),L):null}function _o(L){return L=L.charCodeAt(0),"%"+(L>>4&15).toString(16)+(L&15).toString(16)}var Tu=/[#\/\?@]/g,Sl=/[#\?:]/g,Ac=/[#\?]/g,rc=/[#\?@]/g,El=/#/g;function Mo(L,re){this.h=this.g=null,this.i=L||null,this.j=!!re}function ys(L){L.g||(L.g=new Map,L.h=0,L.i&&Qn(L.i,function(re,_e){L.add(decodeURIComponent(re.replace(/\+/g," ")),_e)}))}n=Mo.prototype,n.add=function(L,re){ys(this),this.i=null,L=ts(this,L);var _e=this.g.get(L);return _e||this.g.set(L,_e=[]),_e.push(re),this.h+=1,this};function Ps(L,re){ys(L),re=ts(L,re),L.g.has(re)&&(L.i=null,L.h-=L.g.get(re).length,L.g.delete(re))}function ja(L,re){return ys(L),re=ts(L,re),L.g.has(re)}n.forEach=function(L,re){ys(this),this.g.forEach(function(_e,$e){_e.forEach(function(Xt){L.call(re,Xt,$e,this)},this)},this)},n.na=function(){ys(this);const L=Array.from(this.g.values()),re=Array.from(this.g.keys()),_e=[];for(let $e=0;$e<re.length;$e++){const Xt=L[$e];for(let nn=0;nn<Xt.length;nn++)_e.push(re[$e])}return _e},n.V=function(L){ys(this);let re=[];if(typeof L=="string")ja(this,L)&&(re=re.concat(this.g.get(ts(this,L))));else{L=Array.from(this.g.values());for(let _e=0;_e<L.length;_e++)re=re.concat(L[_e])}return re},n.set=function(L,re){return ys(this),this.i=null,L=ts(this,L),ja(this,L)&&(this.h-=this.g.get(L).length),this.g.set(L,[re]),this.h+=1,this},n.get=function(L,re){return L?(L=this.V(L),0<L.length?String(L[0]):re):re};function oi(L,re,_e){Ps(L,re),0<_e.length&&(L.i=null,L.g.set(ts(L,re),ce(_e)),L.h+=_e.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const L=[],re=Array.from(this.g.keys());for(var _e=0;_e<re.length;_e++){var $e=re[_e];const nn=encodeURIComponent(String($e)),Un=this.V($e);for($e=0;$e<Un.length;$e++){var Xt=nn;Un[$e]!==""&&(Xt+="="+encodeURIComponent(String(Un[$e]))),L.push(Xt)}}return this.i=L.join("&")};function ts(L,re){return re=String(re),L.j&&(re=re.toLowerCase()),re}function No(L,re){re&&!L.j&&(ys(L),L.i=null,L.g.forEach(function(_e,$e){var Xt=$e.toLowerCase();$e!=Xt&&(Ps(this,$e),oi(this,Xt,_e))},L)),L.j=re}function Xu(L,re){const _e=new qr;if(_.Image){const $e=new Image;$e.onload=M(Ao,_e,"TestLoadImage: loaded",!0,re,$e),$e.onerror=M(Ao,_e,"TestLoadImage: error",!1,re,$e),$e.onabort=M(Ao,_e,"TestLoadImage: abort",!1,re,$e),$e.ontimeout=M(Ao,_e,"TestLoadImage: timeout",!1,re,$e),_.setTimeout(function(){$e.ontimeout&&$e.ontimeout()},1e4),$e.src=L}else re(!1)}function Ul(L,re){const _e=new qr,$e=new AbortController,Xt=setTimeout(()=>{$e.abort(),Ao(_e,"TestPingServer: timeout",!1,re)},1e4);fetch(L,{signal:$e.signal}).then(nn=>{clearTimeout(Xt),nn.ok?Ao(_e,"TestPingServer: ok",!0,re):Ao(_e,"TestPingServer: server error",!1,re)}).catch(()=>{clearTimeout(Xt),Ao(_e,"TestPingServer: error",!1,re)})}function Ao(L,re,_e,$e,Xt){try{Xt&&(Xt.onload=null,Xt.onerror=null,Xt.onabort=null,Xt.ontimeout=null),$e(_e)}catch{}}function Vs(){this.g=new Sr}function Ku(L,re,_e){const $e=_e||"";try{ls(L,function(Xt,nn){let Un=Xt;w(Xt)&&(Un=Jr(Xt)),re.push($e+nn+"="+encodeURIComponent(Un))})}catch(Xt){throw re.push($e+"type="+encodeURIComponent("_badmap")),Xt}}function fl(L){this.l=L.Ub||null,this.j=L.eb||!1}se(fl,ui),fl.prototype.g=function(){return new To(this.l,this.j)},fl.prototype.i=(function(L){return function(){return L}})({});function To(L,re){Hn.call(this),this.D=L,this.o=re,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}se(To,Hn),n=To.prototype,n.open=function(L,re){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=L,this.A=re,this.readyState=1,Oo(this)},n.send=function(L){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const re={headers:this.u,method:this.B,credentials:this.m,cache:void 0};L&&(re.body=L),(this.D||_).fetch(new Request(this.A,re)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ss(this)),this.readyState=0},n.Sa=function(L){if(this.g&&(this.l=L,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=L.headers,this.readyState=2,Oo(this)),this.g&&(this.readyState=3,Oo(this),this.g)))if(this.responseType==="arraybuffer")L.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof _.ReadableStream<"u"&&"body"in L){if(this.j=L.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;vo(this)}else L.text().then(this.Ra.bind(this),this.ga.bind(this))};function vo(L){L.j.read().then(L.Pa.bind(L)).catch(L.ga.bind(L))}n.Pa=function(L){if(this.g){if(this.o&&L.value)this.response.push(L.value);else if(!this.o){var re=L.value?L.value:new Uint8Array(0);(re=this.v.decode(re,{stream:!L.done}))&&(this.response=this.responseText+=re)}L.done?Ss(this):Oo(this),this.readyState==3&&vo(this)}},n.Ra=function(L){this.g&&(this.response=this.responseText=L,Ss(this))},n.Qa=function(L){this.g&&(this.response=L,Ss(this))},n.ga=function(){this.g&&Ss(this)};function Ss(L){L.readyState=4,L.l=null,L.j=null,L.v=null,Oo(L)}n.setRequestHeader=function(L,re){this.u.append(L,re)},n.getResponseHeader=function(L){return this.h&&this.h.get(L.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const L=[],re=this.h.entries();for(var _e=re.next();!_e.done;)_e=_e.value,L.push(_e[0]+": "+_e[1]),_e=re.next();return L.join(`\r
`)};function Oo(L){L.onreadystatechange&&L.onreadystatechange.call(L)}Object.defineProperty(To.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(L){this.m=L?"include":"same-origin"}});function Vo(L){let re="";return Ve(L,function(_e,$e){re+=$e,re+=":",re+=_e,re+=`\r
`}),re}function Tc(L,re,_e){e:{for($e in _e){var $e=!1;break e}$e=!0}$e||(_e=Vo(_e),typeof L=="string"?_e!=null&&encodeURIComponent(String(_e)):Lr(L,re,_e))}function Bo(L){Hn.call(this),this.headers=new Map,this.o=L||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}se(Bo,Hn);var Al=/^https?$/i,Ma=["POST","PUT"];n=Bo.prototype,n.Ha=function(L){this.J=L},n.ea=function(L,re,_e,$e){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+L);re=re?re.toUpperCase():"GET",this.D=L,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ji.g(),this.v=this.o?ii(this.o):ii(Ji),this.g.onreadystatechange=V(this.Ea,this);try{this.B=!0,this.g.open(re,String(L),!0),this.B=!1}catch(nn){pl(this,nn);return}if(L=_e||"",_e=new Map(this.headers),$e)if(Object.getPrototypeOf($e)===Object.prototype)for(var Xt in $e)_e.set(Xt,$e[Xt]);else if(typeof $e.keys=="function"&&typeof $e.get=="function")for(const nn of $e.keys())_e.set(nn,$e.get(nn));else throw Error("Unknown input type for opt_headers: "+String($e));$e=Array.from(_e.keys()).find(nn=>nn.toLowerCase()=="content-type"),Xt=_.FormData&&L instanceof _.FormData,!(0<=Array.prototype.indexOf.call(Ma,re,void 0))||$e||Xt||_e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[nn,Un]of _e)this.g.setRequestHeader(nn,Un);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{si(this),this.u=!0,this.g.send(L),this.u=!1}catch(nn){pl(this,nn)}};function pl(L,re){L.h=!1,L.g&&(L.j=!0,L.g.abort(),L.j=!1),L.l=re,L.m=5,ic(L),$s(L)}function ic(L){L.A||(L.A=!0,Rr(L,"complete"),Rr(L,"error"))}n.abort=function(L){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=L||7,Rr(this,"complete"),Rr(this,"abort"),$s(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),$s(this,!0)),Bo.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?qs(this):this.bb())},n.bb=function(){qs(this)};function qs(L){if(L.h&&typeof m<"u"&&(!L.v[1]||Gs(L)!=4||L.Z()!=2)){if(L.u&&Gs(L)==4)wr(L.Ea,0,L);else if(Rr(L,"readystatechange"),Gs(L)==4){L.h=!1;try{const Un=L.Z();e:switch(Un){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var re=!0;break e;default:re=!1}var _e;if(!(_e=re)){var $e;if($e=Un===0){var Xt=String(L.D).match(Us)[1]||null;!Xt&&_.self&&_.self.location&&(Xt=_.self.location.protocol.slice(0,-1)),$e=!Al.test(Xt?Xt.toLowerCase():"")}_e=$e}if(_e)Rr(L,"complete"),Rr(L,"success");else{L.m=6;try{var nn=2<Gs(L)?L.g.statusText:""}catch{nn=""}L.l=nn+" ["+L.Z()+"]",ic(L)}}finally{$s(L)}}}}function $s(L,re){if(L.g){si(L);const _e=L.g,$e=L.v[0]?()=>{}:null;L.g=null,L.v=null,re||Rr(L,"ready");try{_e.onreadystatechange=$e}catch{}}}function si(L){L.I&&(_.clearTimeout(L.I),L.I=null)}n.isActive=function(){return!!this.g};function Gs(L){return L.g?L.g.readyState:0}n.Z=function(){try{return 2<Gs(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(L){if(this.g){var re=this.g.responseText;return L&&re.indexOf(L)==0&&(re=re.substring(L.length)),Kr(re)}};function qo(L){try{if(!L.g)return null;if("response"in L.g)return L.g.response;switch(L.H){case"":case"text":return L.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in L.g)return L.g.mozResponseArrayBuffer}return null}catch{return null}}function Es(L){const re={};L=(L.g&&2<=Gs(L)&&L.g.getAllResponseHeaders()||"").split(`\r
`);for(let $e=0;$e<L.length;$e++){if(oe(L[$e]))continue;var _e=z(L[$e]);const Xt=_e[0];if(_e=_e[1],typeof _e!="string")continue;_e=_e.trim();const nn=re[Xt]||[];re[Xt]=nn,nn.push(_e)}de(re,function($e){return $e.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function As(L,re,_e){return _e&&_e.internalChannelParams&&_e.internalChannelParams[L]||re}function Ya(L){this.Aa=0,this.i=[],this.j=new qr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=As("failFast",!1,L),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=As("baseRetryDelayMs",5e3,L),this.cb=As("retryDelaySeedMs",1e4,L),this.Wa=As("forwardChannelMaxRetries",2,L),this.wa=As("forwardChannelRequestTimeoutMs",2e4,L),this.pa=L&&L.xmlHttpFactory||void 0,this.Xa=L&&L.Tb||void 0,this.Ca=L&&L.useFetchStreams||!1,this.L=void 0,this.J=L&&L.supportsCrossDomainXhr||!1,this.K="",this.h=new Ea(L&&L.concurrentRequestLimit),this.Da=new Vs,this.P=L&&L.fastHandshake||!1,this.O=L&&L.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=L&&L.Rb||!1,L&&L.xa&&this.j.xa(),L&&L.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&L&&L.detectBufferingProxy||!1,this.ja=void 0,L&&L.longPollingTimeout&&0<L.longPollingTimeout&&(this.ja=L.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Ya.prototype,n.la=8,n.G=1,n.connect=function(L,re,_e,$e){vn(0),this.W=L,this.H=re||{},_e&&$e!==void 0&&(this.H.OSID=_e,this.H.OAID=$e),this.F=this.X,this.I=eo(this,null,this.W),H(this)};function ks(L){if(Vl(L),L.G==3){var re=L.U++,_e=ei(L.I);if(Lr(_e,"SID",L.K),Lr(_e,"RID",re),Lr(_e,"TYPE","terminate"),Pt(L,_e),re=new oo(L,L.j,re),re.L=2,re.v=dl(ei(_e)),_e=!1,_.navigator&&_.navigator.sendBeacon)try{_e=_.navigator.sendBeacon(re.v.toString(),"")}catch{}!_e&&_.Image&&(new Image().src=re.v,_e=!0),_e||(re.g=$o(re.j,null),re.g.ea(re.v)),re.F=Date.now(),Oi(re)}_s(L)}function Ws(L){L.g&&(Pr(L),L.g.cancel(),L.g=null)}function Vl(L){Ws(L),L.u&&(_.clearTimeout(L.u),L.u=null),gi(L),L.h.cancel(),L.s&&(typeof L.s=="number"&&_.clearTimeout(L.s),L.s=null)}function H(L){if(!Ro(L.h)&&!L.s){L.s=!0;var re=L.Ga;Re||Qe(),be||(Re(),be=!0),De.add(re,L),L.B=0}}function Le(L,re){return pn(L.h)>=L.h.j-(L.s?1:0)?!1:L.s?(L.i=re.D.concat(L.i),!0):L.G==1||L.G==2||L.B>=(L.Va?0:L.Wa)?!1:(L.s=Ln(V(L.Ga,L,re),so(L,L.B)),L.B++,!0)}n.Ga=function(L){if(this.s)if(this.s=null,this.G==1){if(!L){this.U=Math.floor(1e5*Math.random()),L=this.U++;const Xt=new oo(this,this.j,L);let nn=this.o;if(this.S&&(nn?(nn=j(nn),$(nn,this.S)):nn=this.S),this.m!==null||this.O||(Xt.H=nn,nn=null),this.P)e:{for(var re=0,_e=0;_e<this.i.length;_e++){t:{var $e=this.i[_e];if("__data__"in $e.map&&($e=$e.map.__data__,typeof $e=="string")){$e=$e.length;break t}$e=void 0}if($e===void 0)break;if(re+=$e,4096<re){re=_e;break e}if(re===4096||_e===this.i.length-1){re=_e+1;break e}}re=1e3}else re=1e3;re=qt(this,Xt,re),_e=ei(this.I),Lr(_e,"RID",L),Lr(_e,"CVER",22),this.D&&Lr(_e,"X-HTTP-Session-Id",this.D),Pt(this,_e),nn&&(this.O?re="headers="+encodeURIComponent(String(Vo(nn)))+"&"+re:this.m&&Tc(_e,this.m,nn)),as(this.h,Xt),this.Ua&&Lr(_e,"TYPE","init"),this.P?(Lr(_e,"$req",re),Lr(_e,"SID","null"),Xt.T=!0,jl(Xt,_e,null)):jl(Xt,_e,re),this.G=2}}else this.G==3&&(L?pt(this,L):this.i.length==0||Ro(this.h)||pt(this))};function pt(L,re){var _e;re?_e=re.l:_e=L.U++;const $e=ei(L.I);Lr($e,"SID",L.K),Lr($e,"RID",_e),Lr($e,"AID",L.T),Pt(L,$e),L.m&&L.o&&Tc($e,L.m,L.o),_e=new oo(L,L.j,_e,L.B+1),L.m===null&&(_e.H=L.o),re&&(L.i=re.D.concat(L.i)),re=qt(L,_e,1e3),_e.I=Math.round(.5*L.wa)+Math.round(.5*L.wa*Math.random()),as(L.h,_e),jl(_e,$e,re)}function Pt(L,re){L.H&&Ve(L.H,function(_e,$e){Lr(re,$e,_e)}),L.l&&ls({},function(_e,$e){Lr(re,$e,_e)})}function qt(L,re,_e){_e=Math.min(L.i.length,_e);var $e=L.l?V(L.l.Na,L.l,L):null;e:{var Xt=L.i;let nn=-1;for(;;){const Un=["count="+_e];nn==-1?0<_e?(nn=Xt[0].g,Un.push("ofs="+nn)):nn=0:Un.push("ofs="+nn);let mo=!0;for(let jo=0;jo<_e;jo++){let Hi=Xt[jo].g;const Qr=Xt[jo].map;if(Hi-=nn,0>Hi)nn=Math.max(0,Xt[jo].g-100),mo=!1;else try{Ku(Qr,Un,"req"+Hi+"_")}catch{$e&&$e(Qr)}}if(mo){$e=Un.join("&");break e}}}return L=L.i.splice(0,_e),re.D=L,$e}function on(L){if(!L.g&&!L.u){L.Y=1;var re=L.Fa;Re||Qe(),be||(Re(),be=!0),De.add(re,L),L.v=0}}function Dn(L){return L.g||L.u||3<=L.v?!1:(L.Y++,L.u=Ln(V(L.Fa,L),so(L,L.v)),L.v++,!0)}n.Fa=function(){if(this.u=null,$r(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var L=2*this.R;this.j.info("BP detection timer enabled: "+L),this.A=Ln(V(this.ab,this),L)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,vn(10),Ws(this),$r(this))};function Pr(L){L.A!=null&&(_.clearTimeout(L.A),L.A=null)}function $r(L){L.g=new oo(L,L.j,"rpc",L.Y),L.m===null&&(L.g.H=L.o),L.g.O=0;var re=ei(L.qa);Lr(re,"RID","rpc"),Lr(re,"SID",L.K),Lr(re,"AID",L.T),Lr(re,"CI",L.F?"0":"1"),!L.F&&L.ja&&Lr(re,"TO",L.ja),Lr(re,"TYPE","xmlhttp"),Pt(L,re),L.m&&L.o&&Tc(re,L.m,L.o),L.L&&(L.g.I=L.L);var _e=L.g;L=L.ia,_e.L=1,_e.v=dl(ei(re)),_e.m=null,_e.P=!0,Fi(_e,L)}n.Za=function(){this.C!=null&&(this.C=null,Ws(this),Dn(this),vn(19))};function gi(L){L.C!=null&&(_.clearTimeout(L.C),L.C=null)}function xi(L,re){var _e=null;if(L.g==re){gi(L),Pr(L),L.g=null;var $e=2}else if(ss(L.h,re))_e=re.D,Qi(L.h,re),$e=1;else return;if(L.G!=0){if(re.o)if($e==1){_e=re.m?re.m.length:0,re=Date.now()-re.F;var Xt=L.B;$e=Rt(),Rr($e,new Bn($e,_e)),H(L)}else on(L);else if(Xt=re.s,Xt==3||Xt==0&&0<re.X||!($e==1&&Le(L,re)||$e==2&&Dn(L)))switch(_e&&0<_e.length&&(re=L.h,re.i=re.i.concat(_e)),Xt){case 1:lo(L,5);break;case 4:lo(L,10);break;case 3:lo(L,6);break;default:lo(L,2)}}}function so(L,re){let _e=L.Ta+Math.floor(Math.random()*L.cb);return L.isActive()||(_e*=2),_e*re}function lo(L,re){if(L.j.info("Error code "+re),re==2){var _e=V(L.fb,L),$e=L.Xa;const Xt=!$e;$e=new Fr($e||"//www.google.com/images/cleardot.gif"),_.location&&_.location.protocol=="http"||aa($e,"https"),dl($e),Xt?Xu($e.toString(),_e):Ul($e.toString(),_e)}else vn(2);L.G=0,L.l&&L.l.sa(re),_s(L),Vl(L)}n.fb=function(L){L?(this.j.info("Successfully pinged google.com"),vn(2)):(this.j.info("Failed to ping google.com"),vn(1))};function _s(L){if(L.G=0,L.ka=[],L.l){const re=Au(L.h);(re.length!=0||L.i.length!=0)&&(fe(L.ka,re),fe(L.ka,L.i),L.h.i.length=0,ce(L.i),L.i.length=0),L.l.ra()}}function eo(L,re,_e){var $e=_e instanceof Fr?ei(_e):new Fr(_e);if($e.g!="")re&&($e.g=re+"."+$e.g),fa($e,$e.s);else{var Xt=_.location;$e=Xt.protocol,re=re?re+"."+Xt.hostname:Xt.hostname,Xt=+Xt.port;var nn=new Fr(null);$e&&aa(nn,$e),re&&(nn.g=re),Xt&&fa(nn,Xt),_e&&(nn.l=_e),$e=nn}return _e=L.D,re=L.ya,_e&&re&&Lr($e,_e,re),Lr($e,"VER",L.la),Pt(L,$e),$e}function $o(L,re,_e){if(re&&!L.J)throw Error("Can't create secondary domain capable XhrIo object.");return re=L.Ca&&!L.pa?new Bo(new fl({eb:_e})):new Bo(L.pa),re.Ha(L.J),re}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Go(){}n=Go.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function ds(){}ds.prototype.g=function(L,re){return new zo(L,re)};function zo(L,re){Hn.call(this),this.g=new Ya(re),this.l=L,this.h=re&&re.messageUrlParams||null,L=re&&re.messageHeaders||null,re&&re.clientProtocolHeaderRequired&&(L?L["X-Client-Protocol"]="webchannel":L={"X-Client-Protocol":"webchannel"}),this.g.o=L,L=re&&re.initMessageHeaders||null,re&&re.messageContentType&&(L?L["X-WebChannel-Content-Type"]=re.messageContentType:L={"X-WebChannel-Content-Type":re.messageContentType}),re&&re.va&&(L?L["X-WebChannel-Client-Profile"]=re.va:L={"X-WebChannel-Client-Profile":re.va}),this.g.S=L,(L=re&&re.Sb)&&!oe(L)&&(this.g.m=L),this.v=re&&re.supportsCrossDomainXhr||!1,this.u=re&&re.sendRawJson||!1,(re=re&&re.httpSessionIdParam)&&!oe(re)&&(this.g.D=re,L=this.h,L!==null&&re in L&&(L=this.h,re in L&&delete L[re])),this.j=new Hs(this)}se(zo,Hn),zo.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},zo.prototype.close=function(){ks(this.g)},zo.prototype.o=function(L){var re=this.g;if(typeof L=="string"){var _e={};_e.__data__=L,L=_e}else this.u&&(_e={},_e.__data__=Jr(L),L=_e);re.i.push(new hl(re.Ya++,L)),re.G==3&&H(re)},zo.prototype.N=function(){this.g.l=null,delete this.j,ks(this.g),delete this.g,zo.aa.N.call(this)};function Ms(L){Ie.call(this),L.__headers__&&(this.headers=L.__headers__,this.statusCode=L.__status__,delete L.__headers__,delete L.__status__);var re=L.__sm__;if(re){e:{for(const _e in re){L=_e;break e}L=void 0}(this.i=L)&&(L=this.i,re=re!==null&&L in re?re[L]:void 0),this.data=re}else this.data=L}se(Ms,Ie);function Ja(){Ye.call(this),this.status=1}se(Ja,Ye);function Hs(L){this.g=L}se(Hs,Go),Hs.prototype.ua=function(){Rr(this.g,"a")},Hs.prototype.ta=function(L){Rr(this.g,new Ms(L))},Hs.prototype.sa=function(L){Rr(this.g,new Ja)},Hs.prototype.ra=function(){Rr(this.g,"b")},ds.prototype.createWebChannel=ds.prototype.g,zo.prototype.send=zo.prototype.o,zo.prototype.open=zo.prototype.m,zo.prototype.close=zo.prototype.close,C6=function(){return new ds},I6=function(){return Rt()},T6=ct,p5={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ro.NO_ERROR=0,ro.TIMEOUT=8,ro.HTTP_ERROR=6,R1=ro,os.COMPLETE="complete",A6=os,ut.EventType=we,we.OPEN="a",we.CLOSE="b",we.ERROR="c",we.MESSAGE="d",Hn.prototype.listen=Hn.prototype.K,_y=ut,Bo.prototype.listenOnce=Bo.prototype.L,Bo.prototype.getLastError=Bo.prototype.Ka,Bo.prototype.getLastErrorCode=Bo.prototype.Ba,Bo.prototype.getStatus=Bo.prototype.Z,Bo.prototype.getResponseJson=Bo.prototype.Oa,Bo.prototype.getResponseText=Bo.prototype.oa,Bo.prototype.send=Bo.prototype.ea,Bo.prototype.setWithCredentials=Bo.prototype.Ha,E6=Bo}).apply(typeof a1<"u"?a1:typeof self<"u"?self:typeof window<"u"?window:{});const FS="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gh{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}gh.UNAUTHENTICATED=new gh(null),gh.GOOGLE_CREDENTIALS=new gh("google-credentials-uid"),gh.FIRST_PARTY=new gh("first-party-uid"),gh.MOCK_USER=new gh("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let w0="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qm=new ow("@firebase/firestore");function dy(){return qm.logLevel}function yi(n,...e){if(qm.logLevel<=gs.DEBUG){const t=e.map(lw);qm.debug(`Firestore (${w0}): ${n}`,...t)}}function pp(n,...e){if(qm.logLevel<=gs.ERROR){const t=e.map(lw);qm.error(`Firestore (${w0}): ${n}`,...t)}}function s0(n,...e){if(qm.logLevel<=gs.WARN){const t=e.map(lw);qm.warn(`Firestore (${w0}): ${n}`,...t)}}function lw(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function po(n="Unexpected state"){const e=`FIRESTORE (${w0}) INTERNAL ASSERTION FAILED: `+n;throw pp(e),new Error(e)}function wa(n,e){n||po()}function Eo(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ci extends _p{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class up{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L6{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class cN{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(gh.UNAUTHENTICATED)))}shutdown(){}}class uN{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class hN{constructor(e){this.t=e,this.currentUser=gh.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){wa(this.o===void 0);let i=this.i;const c=o=>this.i!==i?(i=this.i,t(o)):Promise.resolve();let u=new up;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new up,e.enqueueRetryable((()=>c(this.currentUser)))};const m=()=>{const o=u;e.enqueueRetryable((async()=>{await o.promise,await c(this.currentUser)}))},_=o=>{yi("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=o,this.o&&(this.auth.addAuthTokenListener(this.o),m())};this.t.onInit((o=>_(o))),setTimeout((()=>{if(!this.auth){const o=this.t.getImmediate({optional:!0});o?_(o):(yi("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new up)}}),0),m()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((i=>this.i!==e?(yi("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(wa(typeof i.accessToken=="string"),new L6(i.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return wa(e===null||typeof e=="string"),new gh(e)}}class dN{constructor(e,t,i){this.l=e,this.h=t,this.P=i,this.type="FirstParty",this.user=gh.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class fN{constructor(e,t,i){this.l=e,this.h=t,this.P=i}getToken(){return Promise.resolve(new dN(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(gh.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class pN{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class mN{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){wa(this.o===void 0);const i=u=>{u.error!=null&&yi("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const m=u.token!==this.R;return this.R=u.token,yi("FirebaseAppCheckTokenProvider",`Received ${m?"new":"existing"} token.`),m?t(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable((()=>i(u)))};const c=u=>{yi("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((u=>c(u))),setTimeout((()=>{if(!this.appCheck){const u=this.A.getImmediate({optional:!0});u?c(u):yi("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(wa(typeof t.token=="string"),this.R=t.token,new pN(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gN(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P6{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let i="";for(;i.length<20;){const c=gN(40);for(let u=0;u<c.length;++u)i.length<20&&c[u]<t&&(i+=e.charAt(c[u]%e.length))}return i}}function js(n,e){return n<e?-1:n>e?1:0}function a0(n,e,t){return n.length===e.length&&n.every(((i,c)=>t(i,e[c])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class su{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ci(Kn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ci(Kn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new ci(Kn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ci(Kn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return su.fromMillis(Date.now())}static fromDate(e){return su.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new su(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?js(this.nanoseconds,e.nanoseconds):js(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class So{constructor(e){this.timestamp=e}static fromTimestamp(e){return new So(e)}static min(){return new So(new su(0,0))}static max(){return new So(new su(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(e,t,i){t===void 0?t=0:t>e.length&&po(),i===void 0?i=e.length-t:i>e.length-t&&po(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return Xy.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Xy?e.forEach((i=>{t.push(i)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let c=0;c<i;c++){const u=e.get(c),m=t.get(c);if(u<m)return-1;if(u>m)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class cl extends Xy{construct(e,t,i){return new cl(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new ci(Kn.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter((c=>c.length>0)))}return new cl(t)}static emptyPath(){return new cl([])}}const yN=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Gu extends Xy{construct(e,t,i){return new Gu(e,t,i)}static isValidIdentifier(e){return yN.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Gu.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Gu(["__name__"])}static fromServerFormat(e){const t=[];let i="",c=0;const u=()=>{if(i.length===0)throw new ci(Kn.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let m=!1;for(;c<e.length;){const _=e[c];if(_==="\\"){if(c+1===e.length)throw new ci(Kn.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const o=e[c+1];if(o!=="\\"&&o!=="."&&o!=="`")throw new ci(Kn.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=o,c+=2}else _==="`"?(m=!m,c++):_!=="."||m?(i+=_,c++):(u(),c++)}if(u(),m)throw new ci(Kn.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Gu(t)}static emptyPath(){return new Gu([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{constructor(e){this.path=e}static fromPath(e){return new Di(cl.fromString(e))}static fromName(e){return new Di(cl.fromString(e).popFirst(5))}static empty(){return new Di(cl.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&cl.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return cl.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Di(new cl(e.slice()))}}function _N(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,c=So.fromTimestamp(i===1e9?new su(t+1,0):new su(t,i));return new em(c,Di.empty(),e)}function vN(n){return new em(n.readTime,n.key,-1)}class em{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new em(So.min(),Di.empty(),-1)}static max(){return new em(So.max(),Di.empty(),-1)}}function xN(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Di.comparator(n.documentKey,e.documentKey),t!==0?t:js(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bN="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class wN{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h_(n){if(n.code!==Kn.FAILED_PRECONDITION||n.message!==bN)throw n;yi("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&po(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ir(((i,c)=>{this.nextCallback=u=>{this.wrapSuccess(e,u).next(i,c)},this.catchCallback=u=>{this.wrapFailure(t,u).next(i,c)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof ir?t:ir.resolve(t)}catch(t){return ir.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):ir.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):ir.reject(t)}static resolve(e){return new ir(((t,i)=>{t(e)}))}static reject(e){return new ir(((t,i)=>{i(e)}))}static waitFor(e){return new ir(((t,i)=>{let c=0,u=0,m=!1;e.forEach((_=>{++c,_.next((()=>{++u,m&&u===c&&t()}),(o=>i(o)))})),m=!0,u===c&&t()}))}static or(e){let t=ir.resolve(!1);for(const i of e)t=t.next((c=>c?ir.resolve(c):i()));return t}static forEach(e,t){const i=[];return e.forEach(((c,u)=>{i.push(t.call(this,c,u))})),this.waitFor(i)}static mapArray(e,t){return new ir(((i,c)=>{const u=e.length,m=new Array(u);let _=0;for(let o=0;o<u;o++){const w=o;t(e[w]).next((I=>{m[w]=I,++_,_===u&&i(m)}),(I=>c(I)))}}))}static doWhile(e,t){return new ir(((i,c)=>{const u=()=>{e()===!0?t().next((()=>{u()}),c):i()};u()}))}}function SN(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function d_(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ie(i),this.se=i=>t.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}cw.oe=-1;function Uv(n){return n==null}function av(n){return n===0&&1/n==-1/0}function EN(n){return typeof n=="number"&&Number.isInteger(n)&&!av(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OS(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function S0(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function k6(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bl{constructor(e,t){this.comparator=e,this.root=t||$u.EMPTY}insert(e,t){return new Bl(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,$u.BLACK,null,null))}remove(e){return new Bl(this.comparator,this.root.remove(e,this.comparator).copy(null,null,$u.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const c=this.comparator(e,i.key);if(c===0)return t+i.left.size;c<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,i)=>(e(t,i),!1)))}toString(){const e=[];return this.inorderTraversal(((t,i)=>(e.push(`${t}:${i}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new l1(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new l1(this.root,e,this.comparator,!1)}getReverseIterator(){return new l1(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new l1(this.root,e,this.comparator,!0)}}class l1{constructor(e,t,i,c){this.isReverse=c,this.nodeStack=[];let u=1;for(;!e.isEmpty();)if(u=t?i(e.key,t):1,t&&c&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class $u{constructor(e,t,i,c,u){this.key=e,this.value=t,this.color=i??$u.RED,this.left=c??$u.EMPTY,this.right=u??$u.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,c,u){return new $u(e??this.key,t??this.value,i??this.color,c??this.left,u??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let c=this;const u=i(e,c.key);return c=u<0?c.copy(null,null,null,c.left.insert(e,t,i),null):u===0?c.copy(null,t,null,null,null):c.copy(null,null,null,null,c.right.insert(e,t,i)),c.fixUp()}removeMin(){if(this.left.isEmpty())return $u.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,c=this;if(t(e,c.key)<0)c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=c.moveRedLeft()),c=c.copy(null,null,null,c.left.remove(e,t),null);else{if(c.left.isRed()&&(c=c.rotateRight()),c.right.isEmpty()||c.right.isRed()||c.right.left.isRed()||(c=c.moveRedRight()),t(e,c.key)===0){if(c.right.isEmpty())return $u.EMPTY;i=c.right.min(),c=c.copy(i.key,i.value,null,null,c.right.removeMin())}c=c.copy(null,null,null,null,c.right.remove(e,t))}return c.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,$u.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,$u.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw po();const e=this.left.check();if(e!==this.right.check())throw po();return e+(this.isRed()?0:1)}}$u.EMPTY=null,$u.RED=!0,$u.BLACK=!1;$u.EMPTY=new class{constructor(){this.size=0}get key(){throw po()}get value(){throw po()}get color(){throw po()}get left(){throw po()}get right(){throw po()}copy(e,t,i,c,u){return this}insert(e,t,i){return new $u(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wu{constructor(e){this.comparator=e,this.data=new Bl(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,i)=>(e(t),!1)))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const c=i.getNext();if(this.comparator(c.key,e[1])>=0)return;t(c.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new BS(this.data.getIterator())}getIteratorFrom(e){return new BS(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((i=>{t=t.add(i)})),t}isEqual(e){if(!(e instanceof Wu)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const c=t.getNext().key,u=i.getNext().key;if(this.comparator(c,u)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Wu(this.comparator);return t.data=e,t}}class BS{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wd{constructor(e){this.fields=e,e.sort(Gu.comparator)}static empty(){return new Wd([])}unionWith(e){let t=new Wu(Gu.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new Wd(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return a0(this.fields,e.fields,((t,i)=>t.isEqual(i)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M6 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hu{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(c){try{return atob(c)}catch(u){throw typeof DOMException<"u"&&u instanceof DOMException?new M6("Invalid base64 string: "+u):u}})(e);return new Hu(t)}static fromUint8Array(e){const t=(function(c){let u="";for(let m=0;m<c.length;++m)u+=String.fromCharCode(c[m]);return u})(e);return new Hu(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const i=new Uint8Array(t.length);for(let c=0;c<t.length;c++)i[c]=t.charCodeAt(c);return i})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return js(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Hu.EMPTY_BYTE_STRING=new Hu("");const AN=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function tm(n){if(wa(!!n),typeof n=="string"){let e=0;const t=AN.exec(n);if(wa(!!t),t[1]){let c=t[1];c=(c+"000000000").substr(0,9),e=Number(c)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:vc(n.seconds),nanos:vc(n.nanos)}}function vc(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function $m(n){return typeof n=="string"?Hu.fromBase64String(n):Hu.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uw(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function hw(n){const e=n.mapValue.fields.__previous_value__;return uw(e)?hw(e):e}function Ky(n){const e=tm(n.mapValue.fields.__local_write_time__.timestampValue);return new su(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TN{constructor(e,t,i,c,u,m,_,o,w){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=c,this.ssl=u,this.forceLongPolling=m,this.autoDetectLongPolling=_,this.longPollingOptions=o,this.useFetchStreams=w}}class Zy{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Zy("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Zy&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c1={mapValue:{}};function Gm(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?uw(n)?4:CN(n)?9007199254740991:IN(n)?10:11:po()}function Mf(n,e){if(n===e)return!0;const t=Gm(n);if(t!==Gm(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ky(n).isEqual(Ky(e));case 3:return(function(c,u){if(typeof c.timestampValue=="string"&&typeof u.timestampValue=="string"&&c.timestampValue.length===u.timestampValue.length)return c.timestampValue===u.timestampValue;const m=tm(c.timestampValue),_=tm(u.timestampValue);return m.seconds===_.seconds&&m.nanos===_.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(c,u){return $m(c.bytesValue).isEqual($m(u.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(c,u){return vc(c.geoPointValue.latitude)===vc(u.geoPointValue.latitude)&&vc(c.geoPointValue.longitude)===vc(u.geoPointValue.longitude)})(n,e);case 2:return(function(c,u){if("integerValue"in c&&"integerValue"in u)return vc(c.integerValue)===vc(u.integerValue);if("doubleValue"in c&&"doubleValue"in u){const m=vc(c.doubleValue),_=vc(u.doubleValue);return m===_?av(m)===av(_):isNaN(m)&&isNaN(_)}return!1})(n,e);case 9:return a0(n.arrayValue.values||[],e.arrayValue.values||[],Mf);case 10:case 11:return(function(c,u){const m=c.mapValue.fields||{},_=u.mapValue.fields||{};if(OS(m)!==OS(_))return!1;for(const o in m)if(m.hasOwnProperty(o)&&(_[o]===void 0||!Mf(m[o],_[o])))return!1;return!0})(n,e);default:return po()}}function Yy(n,e){return(n.values||[]).find((t=>Mf(t,e)))!==void 0}function l0(n,e){if(n===e)return 0;const t=Gm(n),i=Gm(e);if(t!==i)return js(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return js(n.booleanValue,e.booleanValue);case 2:return(function(u,m){const _=vc(u.integerValue||u.doubleValue),o=vc(m.integerValue||m.doubleValue);return _<o?-1:_>o?1:_===o?0:isNaN(_)?isNaN(o)?0:-1:1})(n,e);case 3:return zS(n.timestampValue,e.timestampValue);case 4:return zS(Ky(n),Ky(e));case 5:return js(n.stringValue,e.stringValue);case 6:return(function(u,m){const _=$m(u),o=$m(m);return _.compareTo(o)})(n.bytesValue,e.bytesValue);case 7:return(function(u,m){const _=u.split("/"),o=m.split("/");for(let w=0;w<_.length&&w<o.length;w++){const I=js(_[w],o[w]);if(I!==0)return I}return js(_.length,o.length)})(n.referenceValue,e.referenceValue);case 8:return(function(u,m){const _=js(vc(u.latitude),vc(m.latitude));return _!==0?_:js(vc(u.longitude),vc(m.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return jS(n.arrayValue,e.arrayValue);case 10:return(function(u,m){var _,o,w,I;const O=u.fields||{},V=m.fields||{},M=(_=O.value)===null||_===void 0?void 0:_.arrayValue,se=(o=V.value)===null||o===void 0?void 0:o.arrayValue,ce=js(((w=M?.values)===null||w===void 0?void 0:w.length)||0,((I=se?.values)===null||I===void 0?void 0:I.length)||0);return ce!==0?ce:jS(M,se)})(n.mapValue,e.mapValue);case 11:return(function(u,m){if(u===c1.mapValue&&m===c1.mapValue)return 0;if(u===c1.mapValue)return 1;if(m===c1.mapValue)return-1;const _=u.fields||{},o=Object.keys(_),w=m.fields||{},I=Object.keys(w);o.sort(),I.sort();for(let O=0;O<o.length&&O<I.length;++O){const V=js(o[O],I[O]);if(V!==0)return V;const M=l0(_[o[O]],w[I[O]]);if(M!==0)return M}return js(o.length,I.length)})(n.mapValue,e.mapValue);default:throw po()}}function zS(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return js(n,e);const t=tm(n),i=tm(e),c=js(t.seconds,i.seconds);return c!==0?c:js(t.nanos,i.nanos)}function jS(n,e){const t=n.values||[],i=e.values||[];for(let c=0;c<t.length&&c<i.length;++c){const u=l0(t[c],i[c]);if(u)return u}return js(t.length,i.length)}function c0(n){return m5(n)}function m5(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const i=tm(t);return`time(${i.seconds},${i.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return $m(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return Di.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let i="[",c=!0;for(const u of t.values||[])c?c=!1:i+=",",i+=m5(u);return i+"]"})(n.arrayValue):"mapValue"in n?(function(t){const i=Object.keys(t.fields||{}).sort();let c="{",u=!0;for(const m of i)u?u=!1:c+=",",c+=`${m}:${m5(t.fields[m])}`;return c+"}"})(n.mapValue):po()}function US(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function g5(n){return!!n&&"integerValue"in n}function dw(n){return!!n&&"arrayValue"in n}function VS(n){return!!n&&"nullValue"in n}function qS(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function N1(n){return!!n&&"mapValue"in n}function IN(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function ky(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return S0(n.mapValue.fields,((t,i)=>e.mapValue.fields[t]=ky(i))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ky(n.arrayValue.values[t]);return e}return Object.assign({},n)}function CN(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bd{constructor(e){this.value=e}static empty(){return new bd({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!N1(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ky(t)}setAll(e){let t=Gu.emptyPath(),i={},c=[];e.forEach(((m,_)=>{if(!t.isImmediateParentOf(_)){const o=this.getFieldsMap(t);this.applyChanges(o,i,c),i={},c=[],t=_.popLast()}m?i[_.lastSegment()]=ky(m):c.push(_.lastSegment())}));const u=this.getFieldsMap(t);this.applyChanges(u,i,c)}delete(e){const t=this.field(e.popLast());N1(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Mf(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let c=t.mapValue.fields[e.get(i)];N1(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=c),t=c}return t.mapValue.fields}applyChanges(e,t,i){S0(t,((c,u)=>e[c]=u));for(const c of i)delete e[c]}clone(){return new bd(ky(this.value))}}function R6(n){const e=[];return S0(n.fields,((t,i)=>{const c=new Gu([t]);if(N1(i)){const u=R6(i.mapValue).fields;if(u.length===0)e.push(c);else for(const m of u)e.push(c.child(m))}else e.push(c)})),new Wd(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yh{constructor(e,t,i,c,u,m,_){this.key=e,this.documentType=t,this.version=i,this.readTime=c,this.createTime=u,this.data=m,this.documentState=_}static newInvalidDocument(e){return new yh(e,0,So.min(),So.min(),So.min(),bd.empty(),0)}static newFoundDocument(e,t,i,c){return new yh(e,1,t,So.min(),i,c,0)}static newNoDocument(e,t){return new yh(e,2,t,So.min(),So.min(),bd.empty(),0)}static newUnknownDocument(e,t){return new yh(e,3,t,So.min(),So.min(),bd.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(So.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=bd.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=bd.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=So.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof yh&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new yh(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lv{constructor(e,t){this.position=e,this.inclusive=t}}function $S(n,e,t){let i=0;for(let c=0;c<n.position.length;c++){const u=e[c],m=n.position[c];if(u.field.isKeyField()?i=Di.comparator(Di.fromName(m.referenceValue),t.key):i=l0(m,t.data.field(u.field)),u.dir==="desc"&&(i*=-1),i!==0)break}return i}function GS(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Mf(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cv{constructor(e,t="asc"){this.field=e,this.dir=t}}function LN(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N6{}class Gc extends N6{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new kN(e,t,i):t==="array-contains"?new NN(e,i):t==="in"?new DN(e,i):t==="not-in"?new FN(e,i):t==="array-contains-any"?new ON(e,i):new Gc(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new MN(e,i):new RN(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(l0(t,this.value)):t!==null&&Gm(this.value)===Gm(t)&&this.matchesComparison(l0(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return po()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Zd extends N6{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Zd(e,t)}matches(e){return D6(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function D6(n){return n.op==="and"}function F6(n){return PN(n)&&D6(n)}function PN(n){for(const e of n.filters)if(e instanceof Zd)return!1;return!0}function y5(n){if(n instanceof Gc)return n.field.canonicalString()+n.op.toString()+c0(n.value);if(F6(n))return n.filters.map((e=>y5(e))).join(",");{const e=n.filters.map((t=>y5(t))).join(",");return`${n.op}(${e})`}}function O6(n,e){return n instanceof Gc?(function(i,c){return c instanceof Gc&&i.op===c.op&&i.field.isEqual(c.field)&&Mf(i.value,c.value)})(n,e):n instanceof Zd?(function(i,c){return c instanceof Zd&&i.op===c.op&&i.filters.length===c.filters.length?i.filters.reduce(((u,m,_)=>u&&O6(m,c.filters[_])),!0):!1})(n,e):void po()}function B6(n){return n instanceof Gc?(function(t){return`${t.field.canonicalString()} ${t.op} ${c0(t.value)}`})(n):n instanceof Zd?(function(t){return t.op.toString()+" {"+t.getFilters().map(B6).join(" ,")+"}"})(n):"Filter"}class kN extends Gc{constructor(e,t,i){super(e,t,i),this.key=Di.fromName(i.referenceValue)}matches(e){const t=Di.comparator(e.key,this.key);return this.matchesComparison(t)}}class MN extends Gc{constructor(e,t){super(e,"in",t),this.keys=z6("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class RN extends Gc{constructor(e,t){super(e,"not-in",t),this.keys=z6("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function z6(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map((i=>Di.fromName(i.referenceValue)))}class NN extends Gc{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return dw(t)&&Yy(t.arrayValue,this.value)}}class DN extends Gc{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Yy(this.value.arrayValue,t)}}class FN extends Gc{constructor(e,t){super(e,"not-in",t)}matches(e){if(Yy(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Yy(this.value.arrayValue,t)}}class ON extends Gc{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!dw(t)||!t.arrayValue.values)&&t.arrayValue.values.some((i=>Yy(this.value.arrayValue,i)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BN{constructor(e,t=null,i=[],c=[],u=null,m=null,_=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=c,this.limit=u,this.startAt=m,this.endAt=_,this.ue=null}}function WS(n,e=null,t=[],i=[],c=null,u=null,m=null){return new BN(n,e,t,i,c,u,m)}function fw(n){const e=Eo(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((i=>y5(i))).join(","),t+="|ob:",t+=e.orderBy.map((i=>(function(u){return u.field.canonicalString()+u.dir})(i))).join(","),Uv(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((i=>c0(i))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((i=>c0(i))).join(",")),e.ue=t}return e.ue}function pw(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!LN(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!O6(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!GS(n.startAt,e.startAt)&&GS(n.endAt,e.endAt)}function _5(n){return Di.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f_{constructor(e,t=null,i=[],c=[],u=null,m="F",_=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=c,this.limit=u,this.limitType=m,this.startAt=_,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function zN(n,e,t,i,c,u,m,_){return new f_(n,e,t,i,c,u,m,_)}function Vv(n){return new f_(n)}function HS(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function j6(n){return n.collectionGroup!==null}function My(n){const e=Eo(n);if(e.ce===null){e.ce=[];const t=new Set;for(const u of e.explicitOrderBy)e.ce.push(u),t.add(u.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(m){let _=new Wu(Gu.comparator);return m.filters.forEach((o=>{o.getFlattenedFilters().forEach((w=>{w.isInequality()&&(_=_.add(w.field))}))})),_})(e).forEach((u=>{t.has(u.canonicalString())||u.isKeyField()||e.ce.push(new cv(u,i))})),t.has(Gu.keyField().canonicalString())||e.ce.push(new cv(Gu.keyField(),i))}return e.ce}function Tf(n){const e=Eo(n);return e.le||(e.le=jN(e,My(n))),e.le}function jN(n,e){if(n.limitType==="F")return WS(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((c=>{const u=c.dir==="desc"?"asc":"desc";return new cv(c.field,u)}));const t=n.endAt?new lv(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new lv(n.startAt.position,n.startAt.inclusive):null;return WS(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function v5(n,e){const t=n.filters.concat([e]);return new f_(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function x5(n,e,t){return new f_(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function qv(n,e){return pw(Tf(n),Tf(e))&&n.limitType===e.limitType}function U6(n){return`${fw(Tf(n))}|lt:${n.limitType}`}function zg(n){return`Query(target=${(function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map((c=>B6(c))).join(", ")}]`),Uv(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map((c=>(function(m){return`${m.field.canonicalString()} (${m.dir})`})(c))).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map((c=>c0(c))).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map((c=>c0(c))).join(",")),`Target(${i})`})(Tf(n))}; limitType=${n.limitType})`}function $v(n,e){return e.isFoundDocument()&&(function(i,c){const u=c.key.path;return i.collectionGroup!==null?c.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(u):Di.isDocumentKey(i.path)?i.path.isEqual(u):i.path.isImmediateParentOf(u)})(n,e)&&(function(i,c){for(const u of My(i))if(!u.field.isKeyField()&&c.data.field(u.field)===null)return!1;return!0})(n,e)&&(function(i,c){for(const u of i.filters)if(!u.matches(c))return!1;return!0})(n,e)&&(function(i,c){return!(i.startAt&&!(function(m,_,o){const w=$S(m,_,o);return m.inclusive?w<=0:w<0})(i.startAt,My(i),c)||i.endAt&&!(function(m,_,o){const w=$S(m,_,o);return m.inclusive?w>=0:w>0})(i.endAt,My(i),c))})(n,e)}function UN(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function V6(n){return(e,t)=>{let i=!1;for(const c of My(n)){const u=VN(c,e,t);if(u!==0)return u;i=i||c.field.isKeyField()}return 0}}function VN(n,e,t){const i=n.field.isKeyField()?Di.comparator(e.key,t.key):(function(u,m,_){const o=m.data.field(u),w=_.data.field(u);return o!==null&&w!==null?l0(o,w):po()})(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return po()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E0{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[c,u]of i)if(this.equalsFn(c,e))return u}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),c=this.inner[i];if(c===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let u=0;u<c.length;u++)if(this.equalsFn(c[u][0],e))return void(c[u]=[e,t]);c.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let c=0;c<i.length;c++)if(this.equalsFn(i[c][0],e))return i.length===1?delete this.inner[t]:i.splice(c,1),this.innerSize--,!0;return!1}forEach(e){S0(this.inner,((t,i)=>{for(const[c,u]of i)e(c,u)}))}isEmpty(){return k6(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qN=new Bl(Di.comparator);function mp(){return qN}const q6=new Bl(Di.comparator);function vy(...n){let e=q6;for(const t of n)e=e.insert(t.key,t);return e}function $6(n){let e=q6;return n.forEach(((t,i)=>e=e.insert(t,i.overlayedDocument))),e}function Nm(){return Ry()}function G6(){return Ry()}function Ry(){return new E0((n=>n.toString()),((n,e)=>n.isEqual(e)))}const $N=new Bl(Di.comparator),GN=new Wu(Di.comparator);function hs(...n){let e=GN;for(const t of n)e=e.add(t);return e}const WN=new Wu(js);function HN(){return WN}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:av(e)?"-0":e}}function W6(n){return{integerValue:""+n}}function XN(n,e){return EN(e)?W6(e):mw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gv{constructor(){this._=void 0}}function KN(n,e,t){return n instanceof Jy?(function(c,u){const m={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:c.seconds,nanos:c.nanoseconds}}}};return u&&uw(u)&&(u=hw(u)),u&&(m.fields.__previous_value__=u),{mapValue:m}})(t,e):n instanceof Qy?X6(n,e):n instanceof e_?K6(n,e):(function(c,u){const m=H6(c,u),_=XS(m)+XS(c.Pe);return g5(m)&&g5(c.Pe)?W6(_):mw(c.serializer,_)})(n,e)}function ZN(n,e,t){return n instanceof Qy?X6(n,e):n instanceof e_?K6(n,e):t}function H6(n,e){return n instanceof uv?(function(i){return g5(i)||(function(u){return!!u&&"doubleValue"in u})(i)})(e)?e:{integerValue:0}:null}class Jy extends Gv{}class Qy extends Gv{constructor(e){super(),this.elements=e}}function X6(n,e){const t=Z6(e);for(const i of n.elements)t.some((c=>Mf(c,i)))||t.push(i);return{arrayValue:{values:t}}}class e_ extends Gv{constructor(e){super(),this.elements=e}}function K6(n,e){let t=Z6(e);for(const i of n.elements)t=t.filter((c=>!Mf(c,i)));return{arrayValue:{values:t}}}class uv extends Gv{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function XS(n){return vc(n.integerValue||n.doubleValue)}function Z6(n){return dw(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YN{constructor(e,t){this.field=e,this.transform=t}}function JN(n,e){return n.field.isEqual(e.field)&&(function(i,c){return i instanceof Qy&&c instanceof Qy||i instanceof e_&&c instanceof e_?a0(i.elements,c.elements,Mf):i instanceof uv&&c instanceof uv?Mf(i.Pe,c.Pe):i instanceof Jy&&c instanceof Jy})(n.transform,e.transform)}class QN{constructor(e,t){this.version=e,this.transformResults=t}}class If{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new If}static exists(e){return new If(void 0,e)}static updateTime(e){return new If(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function D1(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Wv{}function Y6(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Q6(n.key,If.none()):new p_(n.key,n.data,If.none());{const t=n.data,i=bd.empty();let c=new Wu(Gu.comparator);for(let u of e.fields)if(!c.has(u)){let m=t.field(u);m===null&&u.length>1&&(u=u.popLast(),m=t.field(u)),m===null?i.delete(u):i.set(u,m),c=c.add(u)}return new Qm(n.key,i,new Wd(c.toArray()),If.none())}}function eD(n,e,t){n instanceof p_?(function(c,u,m){const _=c.value.clone(),o=ZS(c.fieldTransforms,u,m.transformResults);_.setAll(o),u.convertToFoundDocument(m.version,_).setHasCommittedMutations()})(n,e,t):n instanceof Qm?(function(c,u,m){if(!D1(c.precondition,u))return void u.convertToUnknownDocument(m.version);const _=ZS(c.fieldTransforms,u,m.transformResults),o=u.data;o.setAll(J6(c)),o.setAll(_),u.convertToFoundDocument(m.version,o).setHasCommittedMutations()})(n,e,t):(function(c,u,m){u.convertToNoDocument(m.version).setHasCommittedMutations()})(0,e,t)}function Ny(n,e,t,i){return n instanceof p_?(function(u,m,_,o){if(!D1(u.precondition,m))return _;const w=u.value.clone(),I=YS(u.fieldTransforms,o,m);return w.setAll(I),m.convertToFoundDocument(m.version,w).setHasLocalMutations(),null})(n,e,t,i):n instanceof Qm?(function(u,m,_,o){if(!D1(u.precondition,m))return _;const w=YS(u.fieldTransforms,o,m),I=m.data;return I.setAll(J6(u)),I.setAll(w),m.convertToFoundDocument(m.version,I).setHasLocalMutations(),_===null?null:_.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map((O=>O.field)))})(n,e,t,i):(function(u,m,_){return D1(u.precondition,m)?(m.convertToNoDocument(m.version).setHasLocalMutations(),null):_})(n,e,t)}function tD(n,e){let t=null;for(const i of n.fieldTransforms){const c=e.data.field(i.field),u=H6(i.transform,c||null);u!=null&&(t===null&&(t=bd.empty()),t.set(i.field,u))}return t||null}function KS(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(i,c){return i===void 0&&c===void 0||!(!i||!c)&&a0(i,c,((u,m)=>JN(u,m)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class p_ extends Wv{constructor(e,t,i,c=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=c,this.type=0}getFieldMask(){return null}}class Qm extends Wv{constructor(e,t,i,c,u=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=c,this.fieldTransforms=u,this.type=1}getFieldMask(){return this.fieldMask}}function J6(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}})),e}function ZS(n,e,t){const i=new Map;wa(n.length===t.length);for(let c=0;c<t.length;c++){const u=n[c],m=u.transform,_=e.data.field(u.field);i.set(u.field,ZN(m,_,t[c]))}return i}function YS(n,e,t){const i=new Map;for(const c of n){const u=c.transform,m=t.data.field(c.field);i.set(c.field,KN(u,m,e))}return i}class Q6 extends Wv{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class nD extends Wv{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rD{constructor(e,t,i,c){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=c}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let c=0;c<this.mutations.length;c++){const u=this.mutations[c];u.key.isEqual(e.key)&&eD(u,e,i[c])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Ny(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Ny(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=G6();return this.mutations.forEach((c=>{const u=e.get(c.key),m=u.overlayedDocument;let _=this.applyToLocalView(m,u.mutatedFields);_=t.has(c.key)?null:_;const o=Y6(m,_);o!==null&&i.set(c.key,o),m.isValidDocument()||m.convertToNoDocument(So.min())})),i}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),hs())}isEqual(e){return this.batchId===e.batchId&&a0(this.mutations,e.mutations,((t,i)=>KS(t,i)))&&a0(this.baseMutations,e.baseMutations,((t,i)=>KS(t,i)))}}class gw{constructor(e,t,i,c){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=c}static from(e,t,i){wa(e.mutations.length===i.length);let c=(function(){return $N})();const u=e.mutations;for(let m=0;m<u.length;m++)c=c.insert(u[m].key,i[m].version);return new gw(e,t,i,c)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iD{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oD{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $c,ws;function sD(n){switch(n){default:return po();case Kn.CANCELLED:case Kn.UNKNOWN:case Kn.DEADLINE_EXCEEDED:case Kn.RESOURCE_EXHAUSTED:case Kn.INTERNAL:case Kn.UNAVAILABLE:case Kn.UNAUTHENTICATED:return!1;case Kn.INVALID_ARGUMENT:case Kn.NOT_FOUND:case Kn.ALREADY_EXISTS:case Kn.PERMISSION_DENIED:case Kn.FAILED_PRECONDITION:case Kn.ABORTED:case Kn.OUT_OF_RANGE:case Kn.UNIMPLEMENTED:case Kn.DATA_LOSS:return!0}}function e9(n){if(n===void 0)return pp("GRPC error has no .code"),Kn.UNKNOWN;switch(n){case $c.OK:return Kn.OK;case $c.CANCELLED:return Kn.CANCELLED;case $c.UNKNOWN:return Kn.UNKNOWN;case $c.DEADLINE_EXCEEDED:return Kn.DEADLINE_EXCEEDED;case $c.RESOURCE_EXHAUSTED:return Kn.RESOURCE_EXHAUSTED;case $c.INTERNAL:return Kn.INTERNAL;case $c.UNAVAILABLE:return Kn.UNAVAILABLE;case $c.UNAUTHENTICATED:return Kn.UNAUTHENTICATED;case $c.INVALID_ARGUMENT:return Kn.INVALID_ARGUMENT;case $c.NOT_FOUND:return Kn.NOT_FOUND;case $c.ALREADY_EXISTS:return Kn.ALREADY_EXISTS;case $c.PERMISSION_DENIED:return Kn.PERMISSION_DENIED;case $c.FAILED_PRECONDITION:return Kn.FAILED_PRECONDITION;case $c.ABORTED:return Kn.ABORTED;case $c.OUT_OF_RANGE:return Kn.OUT_OF_RANGE;case $c.UNIMPLEMENTED:return Kn.UNIMPLEMENTED;case $c.DATA_LOSS:return Kn.DATA_LOSS;default:return po()}}(ws=$c||($c={}))[ws.OK=0]="OK",ws[ws.CANCELLED=1]="CANCELLED",ws[ws.UNKNOWN=2]="UNKNOWN",ws[ws.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ws[ws.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ws[ws.NOT_FOUND=5]="NOT_FOUND",ws[ws.ALREADY_EXISTS=6]="ALREADY_EXISTS",ws[ws.PERMISSION_DENIED=7]="PERMISSION_DENIED",ws[ws.UNAUTHENTICATED=16]="UNAUTHENTICATED",ws[ws.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ws[ws.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ws[ws.ABORTED=10]="ABORTED",ws[ws.OUT_OF_RANGE=11]="OUT_OF_RANGE",ws[ws.UNIMPLEMENTED=12]="UNIMPLEMENTED",ws[ws.INTERNAL=13]="INTERNAL",ws[ws.UNAVAILABLE=14]="UNAVAILABLE",ws[ws.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aD(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lD=new zm([4294967295,4294967295],0);function JS(n){const e=aD().encode(n),t=new S6;return t.update(e),new Uint8Array(t.digest())}function QS(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),c=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new zm([t,i],0),new zm([c,u],0)]}class yw{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new xy(`Invalid padding: ${t}`);if(i<0)throw new xy(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new xy(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new xy(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=zm.fromNumber(this.Ie)}Ee(e,t,i){let c=e.add(t.multiply(zm.fromNumber(i)));return c.compare(lD)===1&&(c=new zm([c.getBits(0),c.getBits(1)],0)),c.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=JS(e),[i,c]=QS(t);for(let u=0;u<this.hashCount;u++){const m=this.Ee(i,c,u);if(!this.de(m))return!1}return!0}static create(e,t,i){const c=e%8==0?0:8-e%8,u=new Uint8Array(Math.ceil(e/8)),m=new yw(u,c,t);return i.forEach((_=>m.insert(_))),m}insert(e){if(this.Ie===0)return;const t=JS(e),[i,c]=QS(t);for(let u=0;u<this.hashCount;u++){const m=this.Ee(i,c,u);this.Ae(m)}}Ae(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class xy extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv{constructor(e,t,i,c,u){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=c,this.resolvedLimboDocuments=u}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const c=new Map;return c.set(e,m_.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new Hv(So.min(),c,new Bl(js),mp(),hs())}}class m_{constructor(e,t,i,c,u){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=c,this.removedDocuments=u}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new m_(i,t,hs(),hs(),hs())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F1{constructor(e,t,i,c){this.Re=e,this.removedTargetIds=t,this.key=i,this.Ve=c}}class t9{constructor(e,t){this.targetId=e,this.me=t}}class n9{constructor(e,t,i=Hu.EMPTY_BYTE_STRING,c=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=c}}class eE{constructor(){this.fe=0,this.ge=nE(),this.pe=Hu.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=hs(),t=hs(),i=hs();return this.ge.forEach(((c,u)=>{switch(u){case 0:e=e.add(c);break;case 2:t=t.add(c);break;case 1:i=i.add(c);break;default:po()}})),new m_(this.pe,this.ye,e,t,i)}Ce(){this.we=!1,this.ge=nE()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,wa(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class cD{constructor(e){this.Le=e,this.Be=new Map,this.ke=mp(),this.qe=tE(),this.Qe=new Bl(js)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,(t=>{const i=this.Ge(t);switch(e.state){case 0:this.ze(t)&&i.De(e.resumeToken);break;case 1:i.Oe(),i.Se||i.Ce(),i.De(e.resumeToken);break;case 2:i.Oe(),i.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(i.Ne(),i.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),i.De(e.resumeToken));break;default:po()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach(((i,c)=>{this.ze(c)&&t(c)}))}He(e){const t=e.targetId,i=e.me.count,c=this.Je(t);if(c){const u=c.target;if(_5(u))if(i===0){const m=new Di(u.path);this.Ue(t,m,yh.newNoDocument(m,So.min()))}else wa(i===1);else{const m=this.Ye(t);if(m!==i){const _=this.Ze(e),o=_?this.Xe(_,e,m):1;if(o!==0){this.je(t);const w=o===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,w)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:c=0},hashCount:u=0}=t;let m,_;try{m=$m(i).toUint8Array()}catch(o){if(o instanceof M6)return s0("Decoding the base64 bloom filter in existence filter failed ("+o.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw o}try{_=new yw(m,c,u)}catch(o){return s0(o instanceof xy?"BloomFilter error: ":"Applying bloom filter failed: ",o),null}return _.Ie===0?null:_}Xe(e,t,i){return t.me.count===i-this.nt(e,t.targetId)?0:2}nt(e,t){const i=this.Le.getRemoteKeysForTarget(t);let c=0;return i.forEach((u=>{const m=this.Le.tt(),_=`projects/${m.projectId}/databases/${m.database}/documents/${u.path.canonicalString()}`;e.mightContain(_)||(this.Ue(t,u,null),c++)})),c}rt(e){const t=new Map;this.Be.forEach(((u,m)=>{const _=this.Je(m);if(_){if(u.current&&_5(_.target)){const o=new Di(_.target.path);this.ke.get(o)!==null||this.it(m,o)||this.Ue(m,o,yh.newNoDocument(o,e))}u.be&&(t.set(m,u.ve()),u.Ce())}}));let i=hs();this.qe.forEach(((u,m)=>{let _=!0;m.forEachWhile((o=>{const w=this.Je(o);return!w||w.purpose==="TargetPurposeLimboResolution"||(_=!1,!1)})),_&&(i=i.add(u))})),this.ke.forEach(((u,m)=>m.setReadTime(e)));const c=new Hv(e,t,this.Qe,this.ke,i);return this.ke=mp(),this.qe=tE(),this.Qe=new Bl(js),c}$e(e,t){if(!this.ze(e))return;const i=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,i),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,i){if(!this.ze(e))return;const c=this.Ge(e);this.it(e,t)?c.Fe(t,1):c.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),i&&(this.ke=this.ke.insert(t,i))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new eE,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Wu(js),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||yi("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new eE),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.Ue(e,t,null)}))}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function tE(){return new Bl(Di.comparator)}function nE(){return new Bl(Di.comparator)}const uD={asc:"ASCENDING",desc:"DESCENDING"},hD={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},dD={and:"AND",or:"OR"};class fD{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function b5(n,e){return n.useProto3Json||Uv(e)?e:{value:e}}function hv(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function r9(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function pD(n,e){return hv(n,e.toTimestamp())}function Cf(n){return wa(!!n),So.fromTimestamp((function(t){const i=tm(t);return new su(i.seconds,i.nanos)})(n))}function _w(n,e){return w5(n,e).canonicalString()}function w5(n,e){const t=(function(c){return new cl(["projects",c.projectId,"databases",c.database])})(n).child("documents");return e===void 0?t:t.child(e)}function i9(n){const e=cl.fromString(n);return wa(c9(e)),e}function S5(n,e){return _w(n.databaseId,e.path)}function Ab(n,e){const t=i9(e);if(t.get(1)!==n.databaseId.projectId)throw new ci(Kn.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new ci(Kn.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Di(s9(t))}function o9(n,e){return _w(n.databaseId,e)}function mD(n){const e=i9(n);return e.length===4?cl.emptyPath():s9(e)}function E5(n){return new cl(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function s9(n){return wa(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function rE(n,e,t){return{name:S5(n,e),fields:t.value.mapValue.fields}}function gD(n,e){let t;if("targetChange"in e){e.targetChange;const i=(function(w){return w==="NO_CHANGE"?0:w==="ADD"?1:w==="REMOVE"?2:w==="CURRENT"?3:w==="RESET"?4:po()})(e.targetChange.targetChangeType||"NO_CHANGE"),c=e.targetChange.targetIds||[],u=(function(w,I){return w.useProto3Json?(wa(I===void 0||typeof I=="string"),Hu.fromBase64String(I||"")):(wa(I===void 0||I instanceof Buffer||I instanceof Uint8Array),Hu.fromUint8Array(I||new Uint8Array))})(n,e.targetChange.resumeToken),m=e.targetChange.cause,_=m&&(function(w){const I=w.code===void 0?Kn.UNKNOWN:e9(w.code);return new ci(I,w.message||"")})(m);t=new n9(i,c,u,_||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const c=Ab(n,i.document.name),u=Cf(i.document.updateTime),m=i.document.createTime?Cf(i.document.createTime):So.min(),_=new bd({mapValue:{fields:i.document.fields}}),o=yh.newFoundDocument(c,u,m,_),w=i.targetIds||[],I=i.removedTargetIds||[];t=new F1(w,I,o.key,o)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const c=Ab(n,i.document),u=i.readTime?Cf(i.readTime):So.min(),m=yh.newNoDocument(c,u),_=i.removedTargetIds||[];t=new F1([],_,m.key,m)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const c=Ab(n,i.document),u=i.removedTargetIds||[];t=new F1([],u,c,null)}else{if(!("filter"in e))return po();{e.filter;const i=e.filter;i.targetId;const{count:c=0,unchangedNames:u}=i,m=new oD(c,u),_=i.targetId;t=new t9(_,m)}}return t}function yD(n,e){let t;if(e instanceof p_)t={update:rE(n,e.key,e.value)};else if(e instanceof Q6)t={delete:S5(n,e.key)};else if(e instanceof Qm)t={update:rE(n,e.key,e.data),updateMask:TD(e.fieldMask)};else{if(!(e instanceof nD))return po();t={verify:S5(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((i=>(function(u,m){const _=m.transform;if(_ instanceof Jy)return{fieldPath:m.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(_ instanceof Qy)return{fieldPath:m.field.canonicalString(),appendMissingElements:{values:_.elements}};if(_ instanceof e_)return{fieldPath:m.field.canonicalString(),removeAllFromArray:{values:_.elements}};if(_ instanceof uv)return{fieldPath:m.field.canonicalString(),increment:_.Pe};throw po()})(0,i)))),e.precondition.isNone||(t.currentDocument=(function(c,u){return u.updateTime!==void 0?{updateTime:pD(c,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:po()})(n,e.precondition)),t}function _D(n,e){return n&&n.length>0?(wa(e!==void 0),n.map((t=>(function(c,u){let m=c.updateTime?Cf(c.updateTime):Cf(u);return m.isEqual(So.min())&&(m=Cf(u)),new QN(m,c.transformResults||[])})(t,e)))):[]}function vD(n,e){return{documents:[o9(n,e.path)]}}function xD(n,e){const t={structuredQuery:{}},i=e.path;let c;e.collectionGroup!==null?(c=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(c=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=o9(n,c);const u=(function(w){if(w.length!==0)return l9(Zd.create(w,"and"))})(e.filters);u&&(t.structuredQuery.where=u);const m=(function(w){if(w.length!==0)return w.map((I=>(function(V){return{field:jg(V.field),direction:SD(V.dir)}})(I)))})(e.orderBy);m&&(t.structuredQuery.orderBy=m);const _=b5(n,e.limit);return _!==null&&(t.structuredQuery.limit=_),e.startAt&&(t.structuredQuery.startAt=(function(w){return{before:w.inclusive,values:w.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(w){return{before:!w.inclusive,values:w.position}})(e.endAt)),{_t:t,parent:c}}function bD(n){let e=mD(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let c=null;if(i>0){wa(i===1);const I=t.from[0];I.allDescendants?c=I.collectionId:e=e.child(I.collectionId)}let u=[];t.where&&(u=(function(O){const V=a9(O);return V instanceof Zd&&F6(V)?V.getFilters():[V]})(t.where));let m=[];t.orderBy&&(m=(function(O){return O.map((V=>(function(se){return new cv(Ug(se.field),(function(fe){switch(fe){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(se.direction))})(V)))})(t.orderBy));let _=null;t.limit&&(_=(function(O){let V;return V=typeof O=="object"?O.value:O,Uv(V)?null:V})(t.limit));let o=null;t.startAt&&(o=(function(O){const V=!!O.before,M=O.values||[];return new lv(M,V)})(t.startAt));let w=null;return t.endAt&&(w=(function(O){const V=!O.before,M=O.values||[];return new lv(M,V)})(t.endAt)),zN(e,c,m,u,_,"F",o,w)}function wD(n,e){const t=(function(c){switch(c){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return po()}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function a9(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=Ug(t.unaryFilter.field);return Gc.create(i,"==",{doubleValue:NaN});case"IS_NULL":const c=Ug(t.unaryFilter.field);return Gc.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=Ug(t.unaryFilter.field);return Gc.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const m=Ug(t.unaryFilter.field);return Gc.create(m,"!=",{nullValue:"NULL_VALUE"});default:return po()}})(n):n.fieldFilter!==void 0?(function(t){return Gc.create(Ug(t.fieldFilter.field),(function(c){switch(c){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return po()}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Zd.create(t.compositeFilter.filters.map((i=>a9(i))),(function(c){switch(c){case"AND":return"and";case"OR":return"or";default:return po()}})(t.compositeFilter.op))})(n):po()}function SD(n){return uD[n]}function ED(n){return hD[n]}function AD(n){return dD[n]}function jg(n){return{fieldPath:n.canonicalString()}}function Ug(n){return Gu.fromServerFormat(n.fieldPath)}function l9(n){return n instanceof Gc?(function(t){if(t.op==="=="){if(qS(t.value))return{unaryFilter:{field:jg(t.field),op:"IS_NAN"}};if(VS(t.value))return{unaryFilter:{field:jg(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(qS(t.value))return{unaryFilter:{field:jg(t.field),op:"IS_NOT_NAN"}};if(VS(t.value))return{unaryFilter:{field:jg(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:jg(t.field),op:ED(t.op),value:t.value}}})(n):n instanceof Zd?(function(t){const i=t.getFilters().map((c=>l9(c)));return i.length===1?i[0]:{compositeFilter:{op:AD(t.op),filters:i}}})(n):po()}function TD(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function c9(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp{constructor(e,t,i,c,u=So.min(),m=So.min(),_=Hu.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=c,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=m,this.resumeToken=_,this.expectedCount=o}withSequenceNumber(e){return new Gp(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Gp(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Gp(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Gp(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ID{constructor(e){this.ct=e}}function CD(n){const e=bD({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?x5(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LD{constructor(){this.un=new PD}addToCollectionParentIndex(e,t){return this.un.add(t),ir.resolve()}getCollectionParents(e,t){return ir.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return ir.resolve()}deleteFieldIndex(e,t){return ir.resolve()}deleteAllFieldIndexes(e){return ir.resolve()}createTargetIndexes(e,t){return ir.resolve()}getDocumentsMatchingTarget(e,t){return ir.resolve(null)}getIndexType(e,t){return ir.resolve(0)}getFieldIndexes(e,t){return ir.resolve([])}getNextCollectionGroupToUpdate(e){return ir.resolve(null)}getMinOffset(e,t){return ir.resolve(em.min())}getMinOffsetFromCollectionGroup(e,t){return ir.resolve(em.min())}updateCollectionGroup(e,t,i){return ir.resolve()}updateIndexEntries(e,t){return ir.resolve()}}class PD{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),c=this.index[t]||new Wu(cl.comparator),u=!c.has(i);return this.index[t]=c.add(i),u}has(e){const t=e.lastSegment(),i=e.popLast(),c=this.index[t];return c&&c.has(i)}getEntries(e){return(this.index[e]||new Wu(cl.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new u0(0)}static kn(){return new u0(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kD{constructor(){this.changes=new E0((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,yh.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?ir.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MD{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RD{constructor(e,t,i,c){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=c}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next((c=>(i=c,this.remoteDocumentCache.getEntry(e,t)))).next((c=>(i!==null&&Ny(i.mutation,c,Wd.empty(),su.now()),c)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.getLocalViewOfDocuments(e,i,hs()).next((()=>i))))}getLocalViewOfDocuments(e,t,i=hs()){const c=Nm();return this.populateOverlays(e,c,t).next((()=>this.computeViews(e,t,c,i).next((u=>{let m=vy();return u.forEach(((_,o)=>{m=m.insert(_,o.overlayedDocument)})),m}))))}getOverlayedDocuments(e,t){const i=Nm();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,hs())))}populateOverlays(e,t,i){const c=[];return i.forEach((u=>{t.has(u)||c.push(u)})),this.documentOverlayCache.getOverlays(e,c).next((u=>{u.forEach(((m,_)=>{t.set(m,_)}))}))}computeViews(e,t,i,c){let u=mp();const m=Ry(),_=(function(){return Ry()})();return t.forEach(((o,w)=>{const I=i.get(w.key);c.has(w.key)&&(I===void 0||I.mutation instanceof Qm)?u=u.insert(w.key,w):I!==void 0?(m.set(w.key,I.mutation.getFieldMask()),Ny(I.mutation,w,I.mutation.getFieldMask(),su.now())):m.set(w.key,Wd.empty())})),this.recalculateAndSaveOverlays(e,u).next((o=>(o.forEach(((w,I)=>m.set(w,I))),t.forEach(((w,I)=>{var O;return _.set(w,new MD(I,(O=m.get(w))!==null&&O!==void 0?O:null))})),_)))}recalculateAndSaveOverlays(e,t){const i=Ry();let c=new Bl(((m,_)=>m-_)),u=hs();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((m=>{for(const _ of m)_.keys().forEach((o=>{const w=t.get(o);if(w===null)return;let I=i.get(o)||Wd.empty();I=_.applyToLocalView(w,I),i.set(o,I);const O=(c.get(_.batchId)||hs()).add(o);c=c.insert(_.batchId,O)}))})).next((()=>{const m=[],_=c.getReverseIterator();for(;_.hasNext();){const o=_.getNext(),w=o.key,I=o.value,O=G6();I.forEach((V=>{if(!u.has(V)){const M=Y6(t.get(V),i.get(V));M!==null&&O.set(V,M),u=u.add(V)}})),m.push(this.documentOverlayCache.saveOverlays(e,w,O))}return ir.waitFor(m)})).next((()=>i))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.recalculateAndSaveOverlays(e,i)))}getDocumentsMatchingQuery(e,t,i,c){return(function(m){return Di.isDocumentKey(m.path)&&m.collectionGroup===null&&m.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):j6(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,c):this.getDocumentsMatchingCollectionQuery(e,t,i,c)}getNextDocuments(e,t,i,c){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,c).next((u=>{const m=c-u.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,c-u.size):ir.resolve(Nm());let _=-1,o=u;return m.next((w=>ir.forEach(w,((I,O)=>(_<O.largestBatchId&&(_=O.largestBatchId),u.get(I)?ir.resolve():this.remoteDocumentCache.getEntry(e,I).next((V=>{o=o.insert(I,V)}))))).next((()=>this.populateOverlays(e,w,u))).next((()=>this.computeViews(e,o,w,hs()))).next((I=>({batchId:_,changes:$6(I)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Di(t)).next((i=>{let c=vy();return i.isFoundDocument()&&(c=c.insert(i.key,i)),c}))}getDocumentsMatchingCollectionGroupQuery(e,t,i,c){const u=t.collectionGroup;let m=vy();return this.indexManager.getCollectionParents(e,u).next((_=>ir.forEach(_,(o=>{const w=(function(O,V){return new f_(V,null,O.explicitOrderBy.slice(),O.filters.slice(),O.limit,O.limitType,O.startAt,O.endAt)})(t,o.child(u));return this.getDocumentsMatchingCollectionQuery(e,w,i,c).next((I=>{I.forEach(((O,V)=>{m=m.insert(O,V)}))}))})).next((()=>m))))}getDocumentsMatchingCollectionQuery(e,t,i,c){let u;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next((m=>(u=m,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,u,c)))).next((m=>{u.forEach(((o,w)=>{const I=w.getKey();m.get(I)===null&&(m=m.insert(I,yh.newInvalidDocument(I)))}));let _=vy();return m.forEach(((o,w)=>{const I=u.get(o);I!==void 0&&Ny(I.mutation,w,Wd.empty(),su.now()),$v(t,w)&&(_=_.insert(o,w))})),_}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ND{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return ir.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,(function(c){return{id:c.id,version:c.version,createTime:Cf(c.createTime)}})(t)),ir.resolve()}getNamedQuery(e,t){return ir.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,(function(c){return{name:c.name,query:CD(c.bundledQuery),readTime:Cf(c.readTime)}})(t)),ir.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DD{constructor(){this.overlays=new Bl(Di.comparator),this.Ir=new Map}getOverlay(e,t){return ir.resolve(this.overlays.get(t))}getOverlays(e,t){const i=Nm();return ir.forEach(t,(c=>this.getOverlay(e,c).next((u=>{u!==null&&i.set(c,u)})))).next((()=>i))}saveOverlays(e,t,i){return i.forEach(((c,u)=>{this.ht(e,t,u)})),ir.resolve()}removeOverlaysForBatchId(e,t,i){const c=this.Ir.get(i);return c!==void 0&&(c.forEach((u=>this.overlays=this.overlays.remove(u))),this.Ir.delete(i)),ir.resolve()}getOverlaysForCollection(e,t,i){const c=Nm(),u=t.length+1,m=new Di(t.child("")),_=this.overlays.getIteratorFrom(m);for(;_.hasNext();){const o=_.getNext().value,w=o.getKey();if(!t.isPrefixOf(w.path))break;w.path.length===u&&o.largestBatchId>i&&c.set(o.getKey(),o)}return ir.resolve(c)}getOverlaysForCollectionGroup(e,t,i,c){let u=new Bl(((w,I)=>w-I));const m=this.overlays.getIterator();for(;m.hasNext();){const w=m.getNext().value;if(w.getKey().getCollectionGroup()===t&&w.largestBatchId>i){let I=u.get(w.largestBatchId);I===null&&(I=Nm(),u=u.insert(w.largestBatchId,I)),I.set(w.getKey(),w)}}const _=Nm(),o=u.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach(((w,I)=>_.set(w,I))),!(_.size()>=c)););return ir.resolve(_)}ht(e,t,i){const c=this.overlays.get(i.key);if(c!==null){const m=this.Ir.get(c.largestBatchId).delete(i.key);this.Ir.set(c.largestBatchId,m)}this.overlays=this.overlays.insert(i.key,new iD(t,i));let u=this.Ir.get(t);u===void 0&&(u=hs(),this.Ir.set(t,u)),this.Ir.set(t,u.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FD{constructor(){this.sessionToken=Hu.EMPTY_BYTE_STRING}getSessionToken(e){return ir.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ir.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vw{constructor(){this.Tr=new Wu(wu.Er),this.dr=new Wu(wu.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const i=new wu(e,t);this.Tr=this.Tr.add(i),this.dr=this.dr.add(i)}Rr(e,t){e.forEach((i=>this.addReference(i,t)))}removeReference(e,t){this.Vr(new wu(e,t))}mr(e,t){e.forEach((i=>this.removeReference(i,t)))}gr(e){const t=new Di(new cl([])),i=new wu(t,e),c=new wu(t,e+1),u=[];return this.dr.forEachInRange([i,c],(m=>{this.Vr(m),u.push(m.key)})),u}pr(){this.Tr.forEach((e=>this.Vr(e)))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Di(new cl([])),i=new wu(t,e),c=new wu(t,e+1);let u=hs();return this.dr.forEachInRange([i,c],(m=>{u=u.add(m.key)})),u}containsKey(e){const t=new wu(e,0),i=this.Tr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class wu{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Di.comparator(e.key,t.key)||js(e.wr,t.wr)}static Ar(e,t){return js(e.wr,t.wr)||Di.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Wu(wu.Er)}checkEmpty(e){return ir.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,c){const u=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const m=new rD(u,t,i,c);this.mutationQueue.push(m);for(const _ of c)this.br=this.br.add(new wu(_.key,u)),this.indexManager.addToCollectionParentIndex(e,_.key.path.popLast());return ir.resolve(m)}lookupMutationBatch(e,t){return ir.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,c=this.vr(i),u=c<0?0:c;return ir.resolve(this.mutationQueue.length>u?this.mutationQueue[u]:null)}getHighestUnacknowledgedBatchId(){return ir.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return ir.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new wu(t,0),c=new wu(t,Number.POSITIVE_INFINITY),u=[];return this.br.forEachInRange([i,c],(m=>{const _=this.Dr(m.wr);u.push(_)})),ir.resolve(u)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Wu(js);return t.forEach((c=>{const u=new wu(c,0),m=new wu(c,Number.POSITIVE_INFINITY);this.br.forEachInRange([u,m],(_=>{i=i.add(_.wr)}))})),ir.resolve(this.Cr(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,c=i.length+1;let u=i;Di.isDocumentKey(u)||(u=u.child(""));const m=new wu(new Di(u),0);let _=new Wu(js);return this.br.forEachWhile((o=>{const w=o.key.path;return!!i.isPrefixOf(w)&&(w.length===c&&(_=_.add(o.wr)),!0)}),m),ir.resolve(this.Cr(_))}Cr(e){const t=[];return e.forEach((i=>{const c=this.Dr(i);c!==null&&t.push(c)})),t}removeMutationBatch(e,t){wa(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let i=this.br;return ir.forEach(t.mutations,(c=>{const u=new wu(c.key,t.batchId);return i=i.delete(u),this.referenceDelegate.markPotentiallyOrphaned(e,c.key)})).next((()=>{this.br=i}))}On(e){}containsKey(e,t){const i=new wu(t,0),c=this.br.firstAfterOrEqual(i);return ir.resolve(t.isEqual(c&&c.key))}performConsistencyCheck(e){return this.mutationQueue.length,ir.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BD{constructor(e){this.Mr=e,this.docs=(function(){return new Bl(Di.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,c=this.docs.get(i),u=c?c.size:0,m=this.Mr(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:m}),this.size+=m-u,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return ir.resolve(i?i.document.mutableCopy():yh.newInvalidDocument(t))}getEntries(e,t){let i=mp();return t.forEach((c=>{const u=this.docs.get(c);i=i.insert(c,u?u.document.mutableCopy():yh.newInvalidDocument(c))})),ir.resolve(i)}getDocumentsMatchingQuery(e,t,i,c){let u=mp();const m=t.path,_=new Di(m.child("")),o=this.docs.getIteratorFrom(_);for(;o.hasNext();){const{key:w,value:{document:I}}=o.getNext();if(!m.isPrefixOf(w.path))break;w.path.length>m.length+1||xN(vN(I),i)<=0||(c.has(I.key)||$v(t,I))&&(u=u.insert(I.key,I.mutableCopy()))}return ir.resolve(u)}getAllFromCollectionGroup(e,t,i,c){po()}Or(e,t){return ir.forEach(this.docs,(i=>t(i)))}newChangeBuffer(e){return new zD(this)}getSize(e){return ir.resolve(this.size)}}class zD extends kD{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach(((i,c)=>{c.isValidDocument()?t.push(this.cr.addEntry(e,c)):this.cr.removeEntry(i)})),ir.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jD{constructor(e){this.persistence=e,this.Nr=new E0((t=>fw(t)),pw),this.lastRemoteSnapshotVersion=So.min(),this.highestTargetId=0,this.Lr=0,this.Br=new vw,this.targetCount=0,this.kr=u0.Bn()}forEachTarget(e,t){return this.Nr.forEach(((i,c)=>t(c))),ir.resolve()}getLastRemoteSnapshotVersion(e){return ir.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ir.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),ir.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.Lr&&(this.Lr=t),ir.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new u0(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,ir.resolve()}updateTargetData(e,t){return this.Kn(t),ir.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,ir.resolve()}removeTargets(e,t,i){let c=0;const u=[];return this.Nr.forEach(((m,_)=>{_.sequenceNumber<=t&&i.get(_.targetId)===null&&(this.Nr.delete(m),u.push(this.removeMatchingKeysForTargetId(e,_.targetId)),c++)})),ir.waitFor(u).next((()=>c))}getTargetCount(e){return ir.resolve(this.targetCount)}getTargetData(e,t){const i=this.Nr.get(t)||null;return ir.resolve(i)}addMatchingKeys(e,t,i){return this.Br.Rr(t,i),ir.resolve()}removeMatchingKeys(e,t,i){this.Br.mr(t,i);const c=this.persistence.referenceDelegate,u=[];return c&&t.forEach((m=>{u.push(c.markPotentiallyOrphaned(e,m))})),ir.waitFor(u)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),ir.resolve()}getMatchingKeysForTargetId(e,t){const i=this.Br.yr(t);return ir.resolve(i)}containsKey(e,t){return ir.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UD{constructor(e,t){this.qr={},this.overlays={},this.Qr=new cw(0),this.Kr=!1,this.Kr=!0,this.$r=new FD,this.referenceDelegate=e(this),this.Ur=new jD(this),this.indexManager=new LD,this.remoteDocumentCache=(function(c){return new BD(c)})((i=>this.referenceDelegate.Wr(i))),this.serializer=new ID(t),this.Gr=new ND(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new DD,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.qr[e.toKey()];return i||(i=new OD(t,this.referenceDelegate),this.qr[e.toKey()]=i),i}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,i){yi("MemoryPersistence","Starting transaction:",e);const c=new VD(this.Qr.next());return this.referenceDelegate.zr(),i(c).next((u=>this.referenceDelegate.jr(c).next((()=>u)))).toPromise().then((u=>(c.raiseOnCommittedEvent(),u)))}Hr(e,t){return ir.or(Object.values(this.qr).map((i=>()=>i.containsKey(e,t))))}}class VD extends wN{constructor(e){super(),this.currentSequenceNumber=e}}class xw{constructor(e){this.persistence=e,this.Jr=new vw,this.Yr=null}static Zr(e){return new xw(e)}get Xr(){if(this.Yr)return this.Yr;throw po()}addReference(e,t,i){return this.Jr.addReference(i,t),this.Xr.delete(i.toString()),ir.resolve()}removeReference(e,t,i){return this.Jr.removeReference(i,t),this.Xr.add(i.toString()),ir.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),ir.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach((c=>this.Xr.add(c.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next((c=>{c.forEach((u=>this.Xr.add(u.toString())))})).next((()=>i.removeTargetData(e,t)))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ir.forEach(this.Xr,(i=>{const c=Di.fromPath(i);return this.ei(e,c).next((u=>{u||t.removeEntry(c,So.min())}))})).next((()=>(this.Yr=null,t.apply(e))))}updateLimboDocument(e,t){return this.ei(e,t).next((i=>{i?this.Xr.delete(t.toString()):this.Xr.add(t.toString())}))}Wr(e){return 0}ei(e,t){return ir.or([()=>ir.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bw{constructor(e,t,i,c){this.targetId=e,this.fromCache=t,this.$i=i,this.Ui=c}static Wi(e,t){let i=hs(),c=hs();for(const u of t.docChanges)switch(u.type){case 0:i=i.add(u.doc.key);break;case 1:c=c.add(u.doc.key)}return new bw(e,t.fromCache,i,c)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qD{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $D{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(function(){return $M()?8:SN(_h())>0?6:4})()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,i,c){const u={result:null};return this.Yi(e,t).next((m=>{u.result=m})).next((()=>{if(!u.result)return this.Zi(e,t,c,i).next((m=>{u.result=m}))})).next((()=>{if(u.result)return;const m=new qD;return this.Xi(e,t,m).next((_=>{if(u.result=_,this.zi)return this.es(e,t,m,_.size)}))})).next((()=>u.result))}es(e,t,i,c){return i.documentReadCount<this.ji?(dy()<=gs.DEBUG&&yi("QueryEngine","SDK will not create cache indexes for query:",zg(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),ir.resolve()):(dy()<=gs.DEBUG&&yi("QueryEngine","Query:",zg(t),"scans",i.documentReadCount,"local documents and returns",c,"documents as results."),i.documentReadCount>this.Hi*c?(dy()<=gs.DEBUG&&yi("QueryEngine","The SDK decides to create cache indexes for query:",zg(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Tf(t))):ir.resolve())}Yi(e,t){if(HS(t))return ir.resolve(null);let i=Tf(t);return this.indexManager.getIndexType(e,i).next((c=>c===0?null:(t.limit!==null&&c===1&&(t=x5(t,null,"F"),i=Tf(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next((u=>{const m=hs(...u);return this.Ji.getDocuments(e,m).next((_=>this.indexManager.getMinOffset(e,i).next((o=>{const w=this.ts(t,_);return this.ns(t,w,m,o.readTime)?this.Yi(e,x5(t,null,"F")):this.rs(e,w,t,o)}))))})))))}Zi(e,t,i,c){return HS(t)||c.isEqual(So.min())?ir.resolve(null):this.Ji.getDocuments(e,i).next((u=>{const m=this.ts(t,u);return this.ns(t,m,i,c)?ir.resolve(null):(dy()<=gs.DEBUG&&yi("QueryEngine","Re-using previous result from %s to execute query: %s",c.toString(),zg(t)),this.rs(e,m,t,_N(c,-1)).next((_=>_)))}))}ts(e,t){let i=new Wu(V6(e));return t.forEach(((c,u)=>{$v(e,u)&&(i=i.add(u))})),i}ns(e,t,i,c){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const u=e.limitType==="F"?t.last():t.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(c)>0)}Xi(e,t,i){return dy()<=gs.DEBUG&&yi("QueryEngine","Using full collection scan to execute query:",zg(t)),this.Ji.getDocumentsMatchingQuery(e,t,em.min(),i)}rs(e,t,i,c){return this.Ji.getDocumentsMatchingQuery(e,i,c).next((u=>(t.forEach((m=>{u=u.insert(m.key,m)})),u)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GD{constructor(e,t,i,c){this.persistence=e,this.ss=t,this.serializer=c,this.os=new Bl(js),this._s=new E0((u=>fw(u)),pw),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(i)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new RD(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.os)))}}function WD(n,e,t,i){return new GD(n,e,t,i)}async function u9(n,e){const t=Eo(n);return await t.persistence.runTransaction("Handle user change","readonly",(i=>{let c;return t.mutationQueue.getAllMutationBatches(i).next((u=>(c=u,t.ls(e),t.mutationQueue.getAllMutationBatches(i)))).next((u=>{const m=[],_=[];let o=hs();for(const w of c){m.push(w.batchId);for(const I of w.mutations)o=o.add(I.key)}for(const w of u){_.push(w.batchId);for(const I of w.mutations)o=o.add(I.key)}return t.localDocuments.getDocuments(i,o).next((w=>({hs:w,removedBatchIds:m,addedBatchIds:_})))}))}))}function HD(n,e){const t=Eo(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(i=>{const c=e.batch.keys(),u=t.cs.newChangeBuffer({trackRemovals:!0});return(function(_,o,w,I){const O=w.batch,V=O.keys();let M=ir.resolve();return V.forEach((se=>{M=M.next((()=>I.getEntry(o,se))).next((ce=>{const fe=w.docVersions.get(se);wa(fe!==null),ce.version.compareTo(fe)<0&&(O.applyToRemoteDocument(ce,w),ce.isValidDocument()&&(ce.setReadTime(w.commitVersion),I.addEntry(ce)))}))})),M.next((()=>_.mutationQueue.removeMutationBatch(o,O)))})(t,i,e,u).next((()=>u.apply(i))).next((()=>t.mutationQueue.performConsistencyCheck(i))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(i,c,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,(function(_){let o=hs();for(let w=0;w<_.mutationResults.length;++w)_.mutationResults[w].transformResults.length>0&&(o=o.add(_.batch.mutations[w].key));return o})(e)))).next((()=>t.localDocuments.getDocuments(i,c)))}))}function h9(n){const e=Eo(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Ur.getLastRemoteSnapshotVersion(t)))}function XD(n,e){const t=Eo(n),i=e.snapshotVersion;let c=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(u=>{const m=t.cs.newChangeBuffer({trackRemovals:!0});c=t.os;const _=[];e.targetChanges.forEach(((I,O)=>{const V=c.get(O);if(!V)return;_.push(t.Ur.removeMatchingKeys(u,I.removedDocuments,O).next((()=>t.Ur.addMatchingKeys(u,I.addedDocuments,O))));let M=V.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(O)!==null?M=M.withResumeToken(Hu.EMPTY_BYTE_STRING,So.min()).withLastLimboFreeSnapshotVersion(So.min()):I.resumeToken.approximateByteSize()>0&&(M=M.withResumeToken(I.resumeToken,i)),c=c.insert(O,M),(function(ce,fe,ne){return ce.resumeToken.approximateByteSize()===0||fe.snapshotVersion.toMicroseconds()-ce.snapshotVersion.toMicroseconds()>=3e8?!0:ne.addedDocuments.size+ne.modifiedDocuments.size+ne.removedDocuments.size>0})(V,M,I)&&_.push(t.Ur.updateTargetData(u,M))}));let o=mp(),w=hs();if(e.documentUpdates.forEach((I=>{e.resolvedLimboDocuments.has(I)&&_.push(t.persistence.referenceDelegate.updateLimboDocument(u,I))})),_.push(KD(u,m,e.documentUpdates).next((I=>{o=I.Ps,w=I.Is}))),!i.isEqual(So.min())){const I=t.Ur.getLastRemoteSnapshotVersion(u).next((O=>t.Ur.setTargetsMetadata(u,u.currentSequenceNumber,i)));_.push(I)}return ir.waitFor(_).next((()=>m.apply(u))).next((()=>t.localDocuments.getLocalViewOfDocuments(u,o,w))).next((()=>o))})).then((u=>(t.os=c,u)))}function KD(n,e,t){let i=hs(),c=hs();return t.forEach((u=>i=i.add(u))),e.getEntries(n,i).next((u=>{let m=mp();return t.forEach(((_,o)=>{const w=u.get(_);o.isFoundDocument()!==w.isFoundDocument()&&(c=c.add(_)),o.isNoDocument()&&o.version.isEqual(So.min())?(e.removeEntry(_,o.readTime),m=m.insert(_,o)):!w.isValidDocument()||o.version.compareTo(w.version)>0||o.version.compareTo(w.version)===0&&w.hasPendingWrites?(e.addEntry(o),m=m.insert(_,o)):yi("LocalStore","Ignoring outdated watch update for ",_,". Current version:",w.version," Watch version:",o.version)})),{Ps:m,Is:c}}))}function ZD(n,e){const t=Eo(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(i=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e))))}function YD(n,e){const t=Eo(n);return t.persistence.runTransaction("Allocate target","readwrite",(i=>{let c;return t.Ur.getTargetData(i,e).next((u=>u?(c=u,ir.resolve(c)):t.Ur.allocateTargetId(i).next((m=>(c=new Gp(e,m,"TargetPurposeListen",i.currentSequenceNumber),t.Ur.addTargetData(i,c).next((()=>c)))))))})).then((i=>{const c=t.os.get(i.targetId);return(c===null||i.snapshotVersion.compareTo(c.snapshotVersion)>0)&&(t.os=t.os.insert(i.targetId,i),t._s.set(e,i.targetId)),i}))}async function A5(n,e,t){const i=Eo(n),c=i.os.get(e),u=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",u,(m=>i.persistence.referenceDelegate.removeTarget(m,c)))}catch(m){if(!d_(m))throw m;yi("LocalStore",`Failed to update sequence numbers for target ${e}: ${m}`)}i.os=i.os.remove(e),i._s.delete(c.target)}function iE(n,e,t){const i=Eo(n);let c=So.min(),u=hs();return i.persistence.runTransaction("Execute query","readwrite",(m=>(function(o,w,I){const O=Eo(o),V=O._s.get(I);return V!==void 0?ir.resolve(O.os.get(V)):O.Ur.getTargetData(w,I)})(i,m,Tf(e)).next((_=>{if(_)return c=_.lastLimboFreeSnapshotVersion,i.Ur.getMatchingKeysForTargetId(m,_.targetId).next((o=>{u=o}))})).next((()=>i.ss.getDocumentsMatchingQuery(m,e,t?c:So.min(),t?u:hs()))).next((_=>(JD(i,UN(e),_),{documents:_,Ts:u})))))}function JD(n,e,t){let i=n.us.get(e)||So.min();t.forEach(((c,u)=>{u.readTime.compareTo(i)>0&&(i=u.readTime)})),n.us.set(e,i)}class oE{constructor(){this.activeTargetIds=HN()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class QD{constructor(){this.so=new oE,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,i){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new oE,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eF{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sE{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){yi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){yi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let u1=null;function Tb(){return u1===null?u1=(function(){return 268435456+Math.round(2147483648*Math.random())})():u1++,"0x"+u1.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tF={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nF{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dh="WebChannelConnection";class rF extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const i=t.ssl?"https":"http",c=encodeURIComponent(this.databaseId.projectId),u=encodeURIComponent(this.databaseId.database);this.Do=i+"://"+t.host,this.vo=`projects/${c}/databases/${u}`,this.Co=this.databaseId.database==="(default)"?`project_id=${c}`:`project_id=${c}&database_id=${u}`}get Fo(){return!1}Mo(t,i,c,u,m){const _=Tb(),o=this.xo(t,i.toUriEncodedString());yi("RestConnection",`Sending RPC '${t}' ${_}:`,o,c);const w={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(w,u,m),this.No(t,o,w,c).then((I=>(yi("RestConnection",`Received RPC '${t}' ${_}: `,I),I)),(I=>{throw s0("RestConnection",`RPC '${t}' ${_} failed with error: `,I,"url: ",o,"request:",c),I}))}Lo(t,i,c,u,m,_){return this.Mo(t,i,c,u,m)}Oo(t,i,c){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+w0})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach(((u,m)=>t[m]=u)),c&&c.headers.forEach(((u,m)=>t[m]=u))}xo(t,i){const c=tF[t];return`${this.Do}/v1/${i}:${c}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,i,c){const u=Tb();return new Promise(((m,_)=>{const o=new E6;o.setWithCredentials(!0),o.listenOnce(A6.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case R1.NO_ERROR:const I=o.getResponseJson();yi(dh,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(I)),m(I);break;case R1.TIMEOUT:yi(dh,`RPC '${e}' ${u} timed out`),_(new ci(Kn.DEADLINE_EXCEEDED,"Request time out"));break;case R1.HTTP_ERROR:const O=o.getStatus();if(yi(dh,`RPC '${e}' ${u} failed with status:`,O,"response text:",o.getResponseText()),O>0){let V=o.getResponseJson();Array.isArray(V)&&(V=V[0]);const M=V?.error;if(M&&M.status&&M.message){const se=(function(fe){const ne=fe.toLowerCase().replace(/_/g,"-");return Object.values(Kn).indexOf(ne)>=0?ne:Kn.UNKNOWN})(M.status);_(new ci(se,M.message))}else _(new ci(Kn.UNKNOWN,"Server responded with status "+o.getStatus()))}else _(new ci(Kn.UNAVAILABLE,"Connection failed."));break;default:po()}}finally{yi(dh,`RPC '${e}' ${u} completed.`)}}));const w=JSON.stringify(c);yi(dh,`RPC '${e}' ${u} sending request:`,c),o.send(t,"POST",w,i,15)}))}Bo(e,t,i){const c=Tb(),u=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],m=C6(),_=I6(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},w=this.longPollingOptions.timeoutSeconds;w!==void 0&&(o.longPollingTimeout=Math.round(1e3*w)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Oo(o.initMessageHeaders,t,i),o.encodeInitMessageHeaders=!0;const I=u.join("");yi(dh,`Creating RPC '${e}' stream ${c}: ${I}`,o);const O=m.createWebChannel(I,o);let V=!1,M=!1;const se=new nF({Io:fe=>{M?yi(dh,`Not sending because RPC '${e}' stream ${c} is closed:`,fe):(V||(yi(dh,`Opening RPC '${e}' stream ${c} transport.`),O.open(),V=!0),yi(dh,`RPC '${e}' stream ${c} sending:`,fe),O.send(fe))},To:()=>O.close()}),ce=(fe,ne,oe)=>{fe.listen(ne,(ye=>{try{oe(ye)}catch(he){setTimeout((()=>{throw he}),0)}}))};return ce(O,_y.EventType.OPEN,(()=>{M||(yi(dh,`RPC '${e}' stream ${c} transport opened.`),se.yo())})),ce(O,_y.EventType.CLOSE,(()=>{M||(M=!0,yi(dh,`RPC '${e}' stream ${c} transport closed`),se.So())})),ce(O,_y.EventType.ERROR,(fe=>{M||(M=!0,s0(dh,`RPC '${e}' stream ${c} transport errored:`,fe),se.So(new ci(Kn.UNAVAILABLE,"The operation could not be completed")))})),ce(O,_y.EventType.MESSAGE,(fe=>{var ne;if(!M){const oe=fe.data[0];wa(!!oe);const ye=oe,he=ye.error||((ne=ye[0])===null||ne===void 0?void 0:ne.error);if(he){yi(dh,`RPC '${e}' stream ${c} received error:`,he);const Ne=he.status;let Ve=(function(D){const $=$c[D];if($!==void 0)return e9($)})(Ne),de=he.message;Ve===void 0&&(Ve=Kn.INTERNAL,de="Unknown error status: "+Ne+" with message "+he.message),M=!0,se.So(new ci(Ve,de)),O.close()}else yi(dh,`RPC '${e}' stream ${c} received:`,oe),se.bo(oe)}})),ce(_,T6.STAT_EVENT,(fe=>{fe.stat===p5.PROXY?yi(dh,`RPC '${e}' stream ${c} detected buffering proxy`):fe.stat===p5.NOPROXY&&yi(dh,`RPC '${e}' stream ${c} detected no buffering proxy`)})),setTimeout((()=>{se.wo()}),0),se}}function Ib(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xv(n){return new fD(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d9{constructor(e,t,i=1e3,c=1.5,u=6e4){this.ui=e,this.timerId=t,this.ko=i,this.qo=c,this.Qo=u,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),i=Math.max(0,Date.now()-this.Uo),c=Math.max(0,t-i);c>0&&yi("ExponentialBackoff",`Backing off for ${c} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,c,(()=>(this.Uo=Date.now(),e()))),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f9{constructor(e,t,i,c,u,m,_,o){this.ui=e,this.Ho=i,this.Jo=c,this.connection=u,this.authCredentialsProvider=m,this.appCheckCredentialsProvider=_,this.listener=o,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new d9(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,(()=>this.__())))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===Kn.RESOURCE_EXHAUSTED?(pp(t.toString()),pp("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===Kn.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([i,c])=>{this.Yo===t&&this.P_(i,c)}),(i=>{e((()=>{const c=new ci(Kn.UNKNOWN,"Fetching auth token failed: "+i.message);return this.I_(c)}))}))}P_(e,t){const i=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo((()=>{i((()=>this.listener.Eo()))})),this.stream.Ro((()=>{i((()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,(()=>(this.r_()&&(this.state=3),Promise.resolve()))),this.listener.Ro())))})),this.stream.mo((c=>{i((()=>this.I_(c)))})),this.stream.onMessage((c=>{i((()=>++this.e_==1?this.E_(c):this.onNext(c)))}))}i_(){this.state=5,this.t_.Go((async()=>{this.state=0,this.start()}))}I_(e){return yi("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget((()=>this.Yo===e?t():(yi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class iF extends f9{constructor(e,t,i,c,u,m){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,c,m),this.serializer=u}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=gD(this.serializer,e),i=(function(u){if(!("targetChange"in u))return So.min();const m=u.targetChange;return m.targetIds&&m.targetIds.length?So.min():m.readTime?Cf(m.readTime):So.min()})(e);return this.listener.d_(t,i)}A_(e){const t={};t.database=E5(this.serializer),t.addTarget=(function(u,m){let _;const o=m.target;if(_=_5(o)?{documents:vD(u,o)}:{query:xD(u,o)._t},_.targetId=m.targetId,m.resumeToken.approximateByteSize()>0){_.resumeToken=r9(u,m.resumeToken);const w=b5(u,m.expectedCount);w!==null&&(_.expectedCount=w)}else if(m.snapshotVersion.compareTo(So.min())>0){_.readTime=hv(u,m.snapshotVersion.toTimestamp());const w=b5(u,m.expectedCount);w!==null&&(_.expectedCount=w)}return _})(this.serializer,e);const i=wD(this.serializer,e);i&&(t.labels=i),this.a_(t)}R_(e){const t={};t.database=E5(this.serializer),t.removeTarget=e,this.a_(t)}}class oF extends f9{constructor(e,t,i,c,u,m){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,c,m),this.serializer=u}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return wa(!!e.streamToken),this.lastStreamToken=e.streamToken,wa(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){wa(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=_D(e.writeResults,e.commitTime),i=Cf(e.commitTime);return this.listener.g_(i,t)}p_(){const e={};e.database=E5(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map((i=>yD(this.serializer,i)))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sF extends class{}{constructor(e,t,i,c){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=c,this.y_=!1}w_(){if(this.y_)throw new ci(Kn.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,i,c){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([u,m])=>this.connection.Mo(e,w5(t,i),c,u,m))).catch((u=>{throw u.name==="FirebaseError"?(u.code===Kn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new ci(Kn.UNKNOWN,u.toString())}))}Lo(e,t,i,c,u){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([m,_])=>this.connection.Lo(e,w5(t,i),c,m,_,u))).catch((m=>{throw m.name==="FirebaseError"?(m.code===Kn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),m):new ci(Kn.UNKNOWN,m.toString())}))}terminate(){this.y_=!0,this.connection.terminate()}}class aF{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve()))))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(pp(t),this.D_=!1):yi("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lF{constructor(e,t,i,c,u){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=u,this.k_._o((m=>{i.enqueueAndForget((async()=>{eg(this)&&(yi("RemoteStore","Restarting streams for network reachability change."),await(async function(o){const w=Eo(o);w.L_.add(4),await g_(w),w.q_.set("Unknown"),w.L_.delete(4),await Kv(w)})(this))}))})),this.q_=new aF(i,c)}}async function Kv(n){if(eg(n))for(const e of n.B_)await e(!0)}async function g_(n){for(const e of n.B_)await e(!1)}function p9(n,e){const t=Eo(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Aw(t)?Ew(t):A0(t).r_()&&Sw(t,e))}function ww(n,e){const t=Eo(n),i=A0(t);t.N_.delete(e),i.r_()&&m9(t,e),t.N_.size===0&&(i.r_()?i.o_():eg(t)&&t.q_.set("Unknown"))}function Sw(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(So.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}A0(n).A_(e)}function m9(n,e){n.Q_.xe(e),A0(n).R_(e)}function Ew(n){n.Q_=new cD({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),A0(n).start(),n.q_.v_()}function Aw(n){return eg(n)&&!A0(n).n_()&&n.N_.size>0}function eg(n){return Eo(n).L_.size===0}function g9(n){n.Q_=void 0}async function cF(n){n.q_.set("Online")}async function uF(n){n.N_.forEach(((e,t)=>{Sw(n,e)}))}async function hF(n,e){g9(n),Aw(n)?(n.q_.M_(e),Ew(n)):n.q_.set("Unknown")}async function dF(n,e,t){if(n.q_.set("Online"),e instanceof n9&&e.state===2&&e.cause)try{await(async function(c,u){const m=u.cause;for(const _ of u.targetIds)c.N_.has(_)&&(await c.remoteSyncer.rejectListen(_,m),c.N_.delete(_),c.Q_.removeTarget(_))})(n,e)}catch(i){yi("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),await dv(n,i)}else if(e instanceof F1?n.Q_.Ke(e):e instanceof t9?n.Q_.He(e):n.Q_.We(e),!t.isEqual(So.min()))try{const i=await h9(n.localStore);t.compareTo(i)>=0&&await(function(u,m){const _=u.Q_.rt(m);return _.targetChanges.forEach(((o,w)=>{if(o.resumeToken.approximateByteSize()>0){const I=u.N_.get(w);I&&u.N_.set(w,I.withResumeToken(o.resumeToken,m))}})),_.targetMismatches.forEach(((o,w)=>{const I=u.N_.get(o);if(!I)return;u.N_.set(o,I.withResumeToken(Hu.EMPTY_BYTE_STRING,I.snapshotVersion)),m9(u,o);const O=new Gp(I.target,o,w,I.sequenceNumber);Sw(u,O)})),u.remoteSyncer.applyRemoteEvent(_)})(n,t)}catch(i){yi("RemoteStore","Failed to raise snapshot:",i),await dv(n,i)}}async function dv(n,e,t){if(!d_(e))throw e;n.L_.add(1),await g_(n),n.q_.set("Offline"),t||(t=()=>h9(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{yi("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Kv(n)}))}function y9(n,e){return e().catch((t=>dv(n,t,e)))}async function Zv(n){const e=Eo(n),t=nm(e);let i=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;fF(e);)try{const c=await ZD(e.localStore,i);if(c===null){e.O_.length===0&&t.o_();break}i=c.batchId,pF(e,c)}catch(c){await dv(e,c)}_9(e)&&v9(e)}function fF(n){return eg(n)&&n.O_.length<10}function pF(n,e){n.O_.push(e);const t=nm(n);t.r_()&&t.V_&&t.m_(e.mutations)}function _9(n){return eg(n)&&!nm(n).n_()&&n.O_.length>0}function v9(n){nm(n).start()}async function mF(n){nm(n).p_()}async function gF(n){const e=nm(n);for(const t of n.O_)e.m_(t.mutations)}async function yF(n,e,t){const i=n.O_.shift(),c=gw.from(i,e,t);await y9(n,(()=>n.remoteSyncer.applySuccessfulWrite(c))),await Zv(n)}async function _F(n,e){e&&nm(n).V_&&await(async function(i,c){if((function(m){return sD(m)&&m!==Kn.ABORTED})(c.code)){const u=i.O_.shift();nm(i).s_(),await y9(i,(()=>i.remoteSyncer.rejectFailedWrite(u.batchId,c))),await Zv(i)}})(n,e),_9(n)&&v9(n)}async function aE(n,e){const t=Eo(n);t.asyncQueue.verifyOperationInProgress(),yi("RemoteStore","RemoteStore received new credentials");const i=eg(t);t.L_.add(3),await g_(t),i&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Kv(t)}async function vF(n,e){const t=Eo(n);e?(t.L_.delete(2),await Kv(t)):e||(t.L_.add(2),await g_(t),t.q_.set("Unknown"))}function A0(n){return n.K_||(n.K_=(function(t,i,c){const u=Eo(t);return u.w_(),new iF(i,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,c)})(n.datastore,n.asyncQueue,{Eo:cF.bind(null,n),Ro:uF.bind(null,n),mo:hF.bind(null,n),d_:dF.bind(null,n)}),n.B_.push((async e=>{e?(n.K_.s_(),Aw(n)?Ew(n):n.q_.set("Unknown")):(await n.K_.stop(),g9(n))}))),n.K_}function nm(n){return n.U_||(n.U_=(function(t,i,c){const u=Eo(t);return u.w_(),new oF(i,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,c)})(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:mF.bind(null,n),mo:_F.bind(null,n),f_:gF.bind(null,n),g_:yF.bind(null,n)}),n.B_.push((async e=>{e?(n.U_.s_(),await Zv(n)):(await n.U_.stop(),n.O_.length>0&&(yi("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tw{constructor(e,t,i,c,u){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=c,this.removalCallback=u,this.deferred=new up,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((m=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,c,u){const m=Date.now()+i,_=new Tw(e,t,m,c,u);return _.start(i),_}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ci(Kn.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Iw(n,e){if(pp("AsyncQueue",`${e}: ${n}`),d_(n))return new ci(Kn.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t0{constructor(e){this.comparator=e?(t,i)=>e(t,i)||Di.comparator(t.key,i.key):(t,i)=>Di.comparator(t.key,i.key),this.keyedMap=vy(),this.sortedSet=new Bl(this.comparator)}static emptySet(e){return new t0(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,i)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof t0)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const c=t.getNext().key,u=i.getNext().key;if(!c.isEqual(u))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new t0;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lE{constructor(){this.W_=new Bl(Di.comparator)}track(e){const t=e.doc.key,i=this.W_.get(t);i?e.type!==0&&i.type===3?this.W_=this.W_.insert(t,e):e.type===3&&i.type!==1?this.W_=this.W_.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.W_=this.W_.remove(t):e.type===1&&i.type===2?this.W_=this.W_.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):po():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal(((t,i)=>{e.push(i)})),e}}class h0{constructor(e,t,i,c,u,m,_,o,w){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=c,this.mutatedKeys=u,this.fromCache=m,this.syncStateChanged=_,this.excludesMetadataChanges=o,this.hasCachedResults=w}static fromInitialDocuments(e,t,i,c,u){const m=[];return t.forEach((_=>{m.push({type:0,doc:_})})),new h0(e,t,t0.emptySet(t),m,i,c,!0,!1,u)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&qv(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let c=0;c<t.length;c++)if(t[c].type!==i[c].type||!t[c].doc.isEqual(i[c].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xF{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some((e=>e.J_()))}}class bF{constructor(){this.queries=cE(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,i){const c=Eo(t),u=c.queries;c.queries=cE(),u.forEach(((m,_)=>{for(const o of _.j_)o.onError(i)}))})(this,new ci(Kn.ABORTED,"Firestore shutting down"))}}function cE(){return new E0((n=>U6(n)),qv)}async function Cw(n,e){const t=Eo(n);let i=3;const c=e.query;let u=t.queries.get(c);u?!u.H_()&&e.J_()&&(i=2):(u=new xF,i=e.J_()?0:1);try{switch(i){case 0:u.z_=await t.onListen(c,!0);break;case 1:u.z_=await t.onListen(c,!1);break;case 2:await t.onFirstRemoteStoreListen(c)}}catch(m){const _=Iw(m,`Initialization of query '${zg(e.query)}' failed`);return void e.onError(_)}t.queries.set(c,u),u.j_.push(e),e.Z_(t.onlineState),u.z_&&e.X_(u.z_)&&Pw(t)}async function Lw(n,e){const t=Eo(n),i=e.query;let c=3;const u=t.queries.get(i);if(u){const m=u.j_.indexOf(e);m>=0&&(u.j_.splice(m,1),u.j_.length===0?c=e.J_()?0:1:!u.H_()&&e.J_()&&(c=2))}switch(c){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}}function wF(n,e){const t=Eo(n);let i=!1;for(const c of e){const u=c.query,m=t.queries.get(u);if(m){for(const _ of m.j_)_.X_(c)&&(i=!0);m.z_=c}}i&&Pw(t)}function SF(n,e,t){const i=Eo(n),c=i.queries.get(e);if(c)for(const u of c.j_)u.onError(t);i.queries.delete(e)}function Pw(n){n.Y_.forEach((e=>{e.next()}))}var T5,uE;(uE=T5||(T5={})).ea="default",uE.Cache="cache";class kw{constructor(e,t,i){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=i||{}}X_(e){if(!this.options.includeMetadataChanges){const i=[];for(const c of e.docChanges)c.type!==3&&i.push(c);e=new h0(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const i=t!=="Offline";return(!this.options._a||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=h0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==T5.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x9{constructor(e){this.key=e}}class b9{constructor(e){this.key=e}}class EF{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=hs(),this.mutatedKeys=hs(),this.Aa=V6(e),this.Ra=new t0(this.Aa)}get Va(){return this.Ta}ma(e,t){const i=t?t.fa:new lE,c=t?t.Ra:this.Ra;let u=t?t.mutatedKeys:this.mutatedKeys,m=c,_=!1;const o=this.query.limitType==="F"&&c.size===this.query.limit?c.last():null,w=this.query.limitType==="L"&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal(((I,O)=>{const V=c.get(I),M=$v(this.query,O)?O:null,se=!!V&&this.mutatedKeys.has(V.key),ce=!!M&&(M.hasLocalMutations||this.mutatedKeys.has(M.key)&&M.hasCommittedMutations);let fe=!1;V&&M?V.data.isEqual(M.data)?se!==ce&&(i.track({type:3,doc:M}),fe=!0):this.ga(V,M)||(i.track({type:2,doc:M}),fe=!0,(o&&this.Aa(M,o)>0||w&&this.Aa(M,w)<0)&&(_=!0)):!V&&M?(i.track({type:0,doc:M}),fe=!0):V&&!M&&(i.track({type:1,doc:V}),fe=!0,(o||w)&&(_=!0)),fe&&(M?(m=m.add(M),u=ce?u.add(I):u.delete(I)):(m=m.delete(I),u=u.delete(I)))})),this.query.limit!==null)for(;m.size>this.query.limit;){const I=this.query.limitType==="F"?m.last():m.first();m=m.delete(I.key),u=u.delete(I.key),i.track({type:1,doc:I})}return{Ra:m,fa:i,ns:_,mutatedKeys:u}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,c){const u=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const m=e.fa.G_();m.sort(((I,O)=>(function(M,se){const ce=fe=>{switch(fe){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return po()}};return ce(M)-ce(se)})(I.type,O.type)||this.Aa(I.doc,O.doc))),this.pa(i),c=c!=null&&c;const _=t&&!c?this.ya():[],o=this.da.size===0&&this.current&&!c?1:0,w=o!==this.Ea;return this.Ea=o,m.length!==0||w?{snapshot:new h0(this.query,e.Ra,u,m,e.mutatedKeys,o===0,w,!1,!!i&&i.resumeToken.approximateByteSize()>0),wa:_}:{wa:_}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new lE,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach((t=>this.Ta=this.Ta.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ta=this.Ta.delete(t))),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=hs(),this.Ra.forEach((i=>{this.Sa(i.key)&&(this.da=this.da.add(i.key))}));const t=[];return e.forEach((i=>{this.da.has(i)||t.push(new b9(i))})),this.da.forEach((i=>{e.has(i)||t.push(new x9(i))})),t}ba(e){this.Ta=e.Ts,this.da=hs();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return h0.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class AF{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class TF{constructor(e){this.key=e,this.va=!1}}class IF{constructor(e,t,i,c,u,m){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=c,this.currentUser=u,this.maxConcurrentLimboResolutions=m,this.Ca={},this.Fa=new E0((_=>U6(_)),qv),this.Ma=new Map,this.xa=new Set,this.Oa=new Bl(Di.comparator),this.Na=new Map,this.La=new vw,this.Ba={},this.ka=new Map,this.qa=u0.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function CF(n,e,t=!0){const i=I9(n);let c;const u=i.Fa.get(e);return u?(i.sharedClientState.addLocalQueryTarget(u.targetId),c=u.view.Da()):c=await w9(i,e,t,!0),c}async function LF(n,e){const t=I9(n);await w9(t,e,!0,!1)}async function w9(n,e,t,i){const c=await YD(n.localStore,Tf(e)),u=c.targetId,m=n.sharedClientState.addLocalQueryTarget(u,t);let _;return i&&(_=await PF(n,e,u,m==="current",c.resumeToken)),n.isPrimaryClient&&t&&p9(n.remoteStore,c),_}async function PF(n,e,t,i,c){n.Ka=(O,V,M)=>(async function(ce,fe,ne,oe){let ye=fe.view.ma(ne);ye.ns&&(ye=await iE(ce.localStore,fe.query,!1).then((({documents:de})=>fe.view.ma(de,ye))));const he=oe&&oe.targetChanges.get(fe.targetId),Ne=oe&&oe.targetMismatches.get(fe.targetId)!=null,Ve=fe.view.applyChanges(ye,ce.isPrimaryClient,he,Ne);return dE(ce,fe.targetId,Ve.wa),Ve.snapshot})(n,O,V,M);const u=await iE(n.localStore,e,!0),m=new EF(e,u.Ts),_=m.ma(u.documents),o=m_.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",c),w=m.applyChanges(_,n.isPrimaryClient,o);dE(n,t,w.wa);const I=new AF(e,t,m);return n.Fa.set(e,I),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),w.snapshot}async function kF(n,e,t){const i=Eo(n),c=i.Fa.get(e),u=i.Ma.get(c.targetId);if(u.length>1)return i.Ma.set(c.targetId,u.filter((m=>!qv(m,e)))),void i.Fa.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(c.targetId),i.sharedClientState.isActiveQueryTarget(c.targetId)||await A5(i.localStore,c.targetId,!1).then((()=>{i.sharedClientState.clearQueryState(c.targetId),t&&ww(i.remoteStore,c.targetId),I5(i,c.targetId)})).catch(h_)):(I5(i,c.targetId),await A5(i.localStore,c.targetId,!0))}async function MF(n,e){const t=Eo(n),i=t.Fa.get(e),c=t.Ma.get(i.targetId);t.isPrimaryClient&&c.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),ww(t.remoteStore,i.targetId))}async function RF(n,e,t){const i=jF(n);try{const c=await(function(m,_){const o=Eo(m),w=su.now(),I=_.reduce(((M,se)=>M.add(se.key)),hs());let O,V;return o.persistence.runTransaction("Locally write mutations","readwrite",(M=>{let se=mp(),ce=hs();return o.cs.getEntries(M,I).next((fe=>{se=fe,se.forEach(((ne,oe)=>{oe.isValidDocument()||(ce=ce.add(ne))}))})).next((()=>o.localDocuments.getOverlayedDocuments(M,se))).next((fe=>{O=fe;const ne=[];for(const oe of _){const ye=tD(oe,O.get(oe.key).overlayedDocument);ye!=null&&ne.push(new Qm(oe.key,ye,R6(ye.value.mapValue),If.exists(!0)))}return o.mutationQueue.addMutationBatch(M,w,ne,_)})).next((fe=>{V=fe;const ne=fe.applyToLocalDocumentSet(O,ce);return o.documentOverlayCache.saveOverlays(M,fe.batchId,ne)}))})).then((()=>({batchId:V.batchId,changes:$6(O)})))})(i.localStore,e);i.sharedClientState.addPendingMutation(c.batchId),(function(m,_,o){let w=m.Ba[m.currentUser.toKey()];w||(w=new Bl(js)),w=w.insert(_,o),m.Ba[m.currentUser.toKey()]=w})(i,c.batchId,t),await y_(i,c.changes),await Zv(i.remoteStore)}catch(c){const u=Iw(c,"Failed to persist write");t.reject(u)}}async function S9(n,e){const t=Eo(n);try{const i=await XD(t.localStore,e);e.targetChanges.forEach(((c,u)=>{const m=t.Na.get(u);m&&(wa(c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size<=1),c.addedDocuments.size>0?m.va=!0:c.modifiedDocuments.size>0?wa(m.va):c.removedDocuments.size>0&&(wa(m.va),m.va=!1))})),await y_(t,i,e)}catch(i){await h_(i)}}function hE(n,e,t){const i=Eo(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const c=[];i.Fa.forEach(((u,m)=>{const _=m.view.Z_(e);_.snapshot&&c.push(_.snapshot)})),(function(m,_){const o=Eo(m);o.onlineState=_;let w=!1;o.queries.forEach(((I,O)=>{for(const V of O.j_)V.Z_(_)&&(w=!0)})),w&&Pw(o)})(i.eventManager,e),c.length&&i.Ca.d_(c),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function NF(n,e,t){const i=Eo(n);i.sharedClientState.updateQueryState(e,"rejected",t);const c=i.Na.get(e),u=c&&c.key;if(u){let m=new Bl(Di.comparator);m=m.insert(u,yh.newNoDocument(u,So.min()));const _=hs().add(u),o=new Hv(So.min(),new Map,new Bl(js),m,_);await S9(i,o),i.Oa=i.Oa.remove(u),i.Na.delete(e),Mw(i)}else await A5(i.localStore,e,!1).then((()=>I5(i,e,t))).catch(h_)}async function DF(n,e){const t=Eo(n),i=e.batch.batchId;try{const c=await HD(t.localStore,e);A9(t,i,null),E9(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await y_(t,c)}catch(c){await h_(c)}}async function FF(n,e,t){const i=Eo(n);try{const c=await(function(m,_){const o=Eo(m);return o.persistence.runTransaction("Reject batch","readwrite-primary",(w=>{let I;return o.mutationQueue.lookupMutationBatch(w,_).next((O=>(wa(O!==null),I=O.keys(),o.mutationQueue.removeMutationBatch(w,O)))).next((()=>o.mutationQueue.performConsistencyCheck(w))).next((()=>o.documentOverlayCache.removeOverlaysForBatchId(w,I,_))).next((()=>o.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(w,I))).next((()=>o.localDocuments.getDocuments(w,I)))}))})(i.localStore,e);A9(i,e,t),E9(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await y_(i,c)}catch(c){await h_(c)}}function E9(n,e){(n.ka.get(e)||[]).forEach((t=>{t.resolve()})),n.ka.delete(e)}function A9(n,e,t){const i=Eo(n);let c=i.Ba[i.currentUser.toKey()];if(c){const u=c.get(e);u&&(t?u.reject(t):u.resolve(),c=c.remove(e)),i.Ba[i.currentUser.toKey()]=c}}function I5(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.Ma.get(e))n.Fa.delete(i),t&&n.Ca.$a(i,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach((i=>{n.La.containsKey(i)||T9(n,i)}))}function T9(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(ww(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Mw(n))}function dE(n,e,t){for(const i of t)i instanceof x9?(n.La.addReference(i.key,e),OF(n,i)):i instanceof b9?(yi("SyncEngine","Document no longer in limbo: "+i.key),n.La.removeReference(i.key,e),n.La.containsKey(i.key)||T9(n,i.key)):po()}function OF(n,e){const t=e.key,i=t.path.canonicalString();n.Oa.get(t)||n.xa.has(i)||(yi("SyncEngine","New document in limbo: "+t),n.xa.add(i),Mw(n))}function Mw(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Di(cl.fromString(e)),i=n.qa.next();n.Na.set(i,new TF(t)),n.Oa=n.Oa.insert(t,i),p9(n.remoteStore,new Gp(Tf(Vv(t.path)),i,"TargetPurposeLimboResolution",cw.oe))}}async function y_(n,e,t){const i=Eo(n),c=[],u=[],m=[];i.Fa.isEmpty()||(i.Fa.forEach(((_,o)=>{m.push(i.Ka(o,e,t).then((w=>{var I;if((w||t)&&i.isPrimaryClient){const O=w?!w.fromCache:(I=t?.targetChanges.get(o.targetId))===null||I===void 0?void 0:I.current;i.sharedClientState.updateQueryState(o.targetId,O?"current":"not-current")}if(w){c.push(w);const O=bw.Wi(o.targetId,w);u.push(O)}})))})),await Promise.all(m),i.Ca.d_(c),await(async function(o,w){const I=Eo(o);try{await I.persistence.runTransaction("notifyLocalViewChanges","readwrite",(O=>ir.forEach(w,(V=>ir.forEach(V.$i,(M=>I.persistence.referenceDelegate.addReference(O,V.targetId,M))).next((()=>ir.forEach(V.Ui,(M=>I.persistence.referenceDelegate.removeReference(O,V.targetId,M)))))))))}catch(O){if(!d_(O))throw O;yi("LocalStore","Failed to update sequence numbers: "+O)}for(const O of w){const V=O.targetId;if(!O.fromCache){const M=I.os.get(V),se=M.snapshotVersion,ce=M.withLastLimboFreeSnapshotVersion(se);I.os=I.os.insert(V,ce)}}})(i.localStore,u))}async function BF(n,e){const t=Eo(n);if(!t.currentUser.isEqual(e)){yi("SyncEngine","User change. New user:",e.toKey());const i=await u9(t.localStore,e);t.currentUser=e,(function(u,m){u.ka.forEach((_=>{_.forEach((o=>{o.reject(new ci(Kn.CANCELLED,m))}))})),u.ka.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await y_(t,i.hs)}}function zF(n,e){const t=Eo(n),i=t.Na.get(e);if(i&&i.va)return hs().add(i.key);{let c=hs();const u=t.Ma.get(e);if(!u)return c;for(const m of u){const _=t.Fa.get(m);c=c.unionWith(_.view.Va)}return c}}function I9(n){const e=Eo(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=S9.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=zF.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=NF.bind(null,e),e.Ca.d_=wF.bind(null,e.eventManager),e.Ca.$a=SF.bind(null,e.eventManager),e}function jF(n){const e=Eo(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=DF.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=FF.bind(null,e),e}class fv{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Xv(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return WD(this.persistence,new $D,e.initialUser,this.serializer)}Ga(e){return new UD(xw.Zr,this.serializer)}Wa(e){return new QD}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}fv.provider={build:()=>new fv};class C5{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>hE(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=BF.bind(null,this.syncEngine),await vF(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new bF})()}createDatastore(e){const t=Xv(e.databaseInfo.databaseId),i=(function(u){return new rF(u)})(e.databaseInfo);return(function(u,m,_,o){return new sF(u,m,_,o)})(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return(function(i,c,u,m,_){return new lF(i,c,u,m,_)})(this.localStore,this.datastore,e.asyncQueue,(t=>hE(this.syncEngine,t,0)),(function(){return sE.D()?new sE:new eF})())}createSyncEngine(e,t){return(function(c,u,m,_,o,w,I){const O=new IF(c,u,m,_,o,w);return I&&(O.Qa=!0),O})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(c){const u=Eo(c);yi("RemoteStore","RemoteStore shutting down."),u.L_.add(5),await g_(u),u.k_.shutdown(),u.q_.set("Unknown")})(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}C5.provider={build:()=>new C5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rw{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):pp("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UF{constructor(e,t,i,c,u){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=c,this.user=gh.UNAUTHENTICATED,this.clientId=P6.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=u,this.authCredentials.start(i,(async m=>{yi("FirestoreClient","Received user=",m.uid),await this.authCredentialListener(m),this.user=m})),this.appCheckCredentials.start(i,(m=>(yi("FirestoreClient","Received new app check token=",m),this.appCheckCredentialListener(m,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new up;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=Iw(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}}async function Cb(n,e){n.asyncQueue.verifyOperationInProgress(),yi("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener((async c=>{i.isEqual(c)||(await u9(e.localStore,c),i=c)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function fE(n,e){n.asyncQueue.verifyOperationInProgress();const t=await VF(n);yi("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((i=>aE(e.remoteStore,i))),n.setAppCheckTokenChangeListener(((i,c)=>aE(e.remoteStore,c))),n._onlineComponents=e}async function VF(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){yi("FirestoreClient","Using user provided OfflineComponentProvider");try{await Cb(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(c){return c.name==="FirebaseError"?c.code===Kn.FAILED_PRECONDITION||c.code===Kn.UNIMPLEMENTED:!(typeof DOMException<"u"&&c instanceof DOMException)||c.code===22||c.code===20||c.code===11})(t))throw t;s0("Error using user provided cache. Falling back to memory cache: "+t),await Cb(n,new fv)}}else yi("FirestoreClient","Using default OfflineComponentProvider"),await Cb(n,new fv);return n._offlineComponents}async function C9(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(yi("FirestoreClient","Using user provided OnlineComponentProvider"),await fE(n,n._uninitializedComponentsProvider._online)):(yi("FirestoreClient","Using default OnlineComponentProvider"),await fE(n,new C5))),n._onlineComponents}function qF(n){return C9(n).then((e=>e.syncEngine))}async function pv(n){const e=await C9(n),t=e.eventManager;return t.onListen=CF.bind(null,e.syncEngine),t.onUnlisten=kF.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=LF.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=MF.bind(null,e.syncEngine),t}function $F(n,e,t={}){const i=new up;return n.asyncQueue.enqueueAndForget((async()=>(function(u,m,_,o,w){const I=new Rw({next:V=>{I.Za(),m.enqueueAndForget((()=>Lw(u,O)));const M=V.docs.has(_);!M&&V.fromCache?w.reject(new ci(Kn.UNAVAILABLE,"Failed to get document because the client is offline.")):M&&V.fromCache&&o&&o.source==="server"?w.reject(new ci(Kn.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):w.resolve(V)},error:V=>w.reject(V)}),O=new kw(Vv(_.path),I,{includeMetadataChanges:!0,_a:!0});return Cw(u,O)})(await pv(n),n.asyncQueue,e,t,i))),i.promise}function GF(n,e,t={}){const i=new up;return n.asyncQueue.enqueueAndForget((async()=>(function(u,m,_,o,w){const I=new Rw({next:V=>{I.Za(),m.enqueueAndForget((()=>Lw(u,O))),V.fromCache&&o.source==="server"?w.reject(new ci(Kn.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):w.resolve(V)},error:V=>w.reject(V)}),O=new kw(_,I,{includeMetadataChanges:!0,_a:!0});return Cw(u,O)})(await pv(n),n.asyncQueue,e,t,i))),i.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L9(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pE=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P9(n,e,t){if(!t)throw new ci(Kn.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function WF(n,e,t,i){if(e===!0&&i===!0)throw new ci(Kn.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function mE(n){if(!Di.isDocumentKey(n))throw new ci(Kn.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function gE(n){if(Di.isDocumentKey(n))throw new ci(Kn.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Yv(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(i){return i.constructor?i.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":po()}function Hd(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new ci(Kn.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Yv(n);throw new ci(Kn.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yE{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new ci(Kn.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ci(Kn.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}WF("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=L9((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),(function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new ci(Kn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new ci(Kn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new ci(Kn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(i,c){return i.timeoutSeconds===c.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Jv{constructor(e,t,i,c){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=c,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yE({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ci(Kn.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ci(Kn.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yE(e),e.credentials!==void 0&&(this._authCredentials=(function(i){if(!i)return new cN;switch(i.type){case"firstParty":return new fN(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new ci(Kn.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const i=pE.get(t);i&&(yi("ComponentProvider","Removing Datastore"),pE.delete(t),i.terminate())})(this),Promise.resolve()}}function HF(n,e,t,i={}){var c;const u=(n=Hd(n,Jv))._getSettings(),m=`${e}:${t}`;if(u.host!=="firestore.googleapis.com"&&u.host!==m&&s0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},u),{host:m,ssl:!1})),i.mockUserToken){let _,o;if(typeof i.mockUserToken=="string")_=i.mockUserToken,o=gh.MOCK_USER;else{_=OM(i.mockUserToken,(c=n._app)===null||c===void 0?void 0:c.options.projectId);const w=i.mockUserToken.sub||i.mockUserToken.user_id;if(!w)throw new ci(Kn.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");o=new gh(w)}n._authCredentials=new uN(new L6(_,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tg{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new tg(this.firestore,e,this._query)}}class Th{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Zp(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Th(this.firestore,e,this._key)}}class Zp extends tg{constructor(e,t,i){super(e,t,Vv(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Th(this.firestore,null,new Di(e))}withConverter(e){return new Zp(this.firestore,e,this._path)}}function Em(n,e,...t){if(n=Ih(n),P9("collection","path",e),n instanceof Jv){const i=cl.fromString(e,...t);return gE(i),new Zp(n,null,i)}{if(!(n instanceof Th||n instanceof Zp))throw new ci(Kn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(cl.fromString(e,...t));return gE(i),new Zp(n.firestore,null,i)}}function Gg(n,e,...t){if(n=Ih(n),arguments.length===1&&(e=P6.newId()),P9("doc","path",e),n instanceof Jv){const i=cl.fromString(e,...t);return mE(i),new Th(n,null,new Di(i))}{if(!(n instanceof Th||n instanceof Zp))throw new ci(Kn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(cl.fromString(e,...t));return mE(i),new Th(n.firestore,n instanceof Zp?n.converter:null,new Di(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _E{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new d9(this,"async_queue_retry"),this.Vu=()=>{const i=Ib();i&&yi("AsyncQueue","Visibility state changed to "+i.visibilityState),this.t_.jo()},this.mu=e;const t=Ib();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Ib();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise((()=>{}));const t=new up;return this.gu((()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Pu.push(e),this.pu())))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!d_(e))throw e;yi("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go((()=>this.pu()))}}gu(e){const t=this.mu.then((()=>(this.du=!0,e().catch((i=>{this.Eu=i,this.du=!1;const c=(function(m){let _=m.message||"";return m.stack&&(_=m.stack.includes(m.message)?m.stack:m.message+`
`+m.stack),_})(i);throw pp("INTERNAL UNHANDLED ERROR: ",c),i})).then((i=>(this.du=!1,i))))));return this.mu=t,t}enqueueAfterDelay(e,t,i){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const c=Tw.createAndSchedule(this,e,t,i,(u=>this.yu(u)));return this.Tu.push(c),c}fu(){this.Eu&&po()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then((()=>{this.Tu.sort(((t,i)=>t.targetTimeMs-i.targetTimeMs));for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()}))}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function vE(n){return(function(t,i){if(typeof t!="object"||t===null)return!1;const c=t;for(const u of i)if(u in c&&typeof c[u]=="function")return!0;return!1})(n,["next","error","complete"])}class Wm extends Jv{constructor(e,t,i,c){super(e,t,i,c),this.type="firestore",this._queue=new _E,this._persistenceKey=c?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new _E(e),this._firestoreClient=void 0,await e}}}function XF(n,e){const t=typeof n=="object"?n:x6(),i=typeof n=="string"?n:"(default)",c=aw(t,"firestore").getImmediate({identifier:i});if(!c._initialized){const u=DM("firestore");u&&HF(c,...u)}return c}function Qv(n){if(n._terminated)throw new ci(Kn.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||KF(n),n._firestoreClient}function KF(n){var e,t,i;const c=n._freezeSettings(),u=(function(_,o,w,I){return new TN(_,o,w,I.host,I.ssl,I.experimentalForceLongPolling,I.experimentalAutoDetectLongPolling,L9(I.experimentalLongPollingOptions),I.useFetchStreams)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,c);n._componentsProvider||!((t=c.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=c.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:c.localCache._offlineComponentProvider,_online:c.localCache._onlineComponentProvider}),n._firestoreClient=new UF(n._authCredentials,n._appCheckCredentials,n._queue,u,n._componentsProvider&&(function(_){const o=_?._online.build();return{_offline:_?._offline.build(o),_online:o}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new d0(Hu.fromBase64String(e))}catch(t){throw new ci(Kn.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new d0(Hu.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nw{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new ci(Kn.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Gu(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dw{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ex{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ci(Kn.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ci(Kn.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return js(this._lat,e._lat)||js(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fw{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(i,c){if(i.length!==c.length)return!1;for(let u=0;u<i.length;++u)if(i[u]!==c[u])return!1;return!0})(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZF=/^__.*__$/;class YF{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Qm(e,this.data,this.fieldMask,t,this.fieldTransforms):new p_(e,this.data,t,this.fieldTransforms)}}function k9(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw po()}}class Ow{constructor(e,t,i,c,u,m){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=c,u===void 0&&this.vu(),this.fieldTransforms=u||[],this.fieldMask=m||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Ow(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),c=this.Fu({path:i,xu:!1});return c.Ou(e),c}Nu(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),c=this.Fu({path:i,xu:!1});return c.vu(),c}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return mv(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(k9(this.Cu)&&ZF.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class JF{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||Xv(e)}Qu(e,t,i,c=!1){return new Ow({Cu:e,methodName:t,qu:i,path:Gu.emptyPath(),xu:!1,ku:c},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Bw(n){const e=n._freezeSettings(),t=Xv(n._databaseId);return new JF(n._databaseId,!!e.ignoreUndefinedProperties,t)}function M9(n,e,t,i,c,u={}){const m=n.Qu(u.merge||u.mergeFields?2:0,e,t,c);D9("Data must be an object, but it was:",m,i);const _=R9(i,m);let o,w;if(u.merge)o=new Wd(m.fieldMask),w=m.fieldTransforms;else if(u.mergeFields){const I=[];for(const O of u.mergeFields){const V=eO(e,O,t);if(!m.contains(V))throw new ci(Kn.INVALID_ARGUMENT,`Field '${V}' is specified in your field mask but missing from your input data.`);nO(I,V)||I.push(V)}o=new Wd(I),w=m.fieldTransforms.filter((O=>o.covers(O.field)))}else o=null,w=m.fieldTransforms;return new YF(new bd(_),o,w)}class zw extends Dw{_toFieldTransform(e){return new YN(e.path,new Jy)}isEqual(e){return e instanceof zw}}function QF(n,e,t,i=!1){return jw(t,n.Qu(i?4:3,e))}function jw(n,e){if(N9(n=Ih(n)))return D9("Unsupported field value:",e,n),R9(n,e);if(n instanceof Dw)return(function(i,c){if(!k9(c.Cu))throw c.Bu(`${i._methodName}() can only be used with update() and set()`);if(!c.path)throw c.Bu(`${i._methodName}() is not currently supported inside arrays`);const u=i._toFieldTransform(c);u&&c.fieldTransforms.push(u)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return(function(i,c){const u=[];let m=0;for(const _ of i){let o=jw(_,c.Lu(m));o==null&&(o={nullValue:"NULL_VALUE"}),u.push(o),m++}return{arrayValue:{values:u}}})(n,e)}return(function(i,c){if((i=Ih(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return XN(c.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const u=su.fromDate(i);return{timestampValue:hv(c.serializer,u)}}if(i instanceof su){const u=new su(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:hv(c.serializer,u)}}if(i instanceof ex)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof d0)return{bytesValue:r9(c.serializer,i._byteString)};if(i instanceof Th){const u=c.databaseId,m=i.firestore._databaseId;if(!m.isEqual(u))throw c.Bu(`Document reference is for database ${m.projectId}/${m.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:_w(i.firestore._databaseId||c.databaseId,i._key.path)}}if(i instanceof Fw)return(function(m,_){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:m.toArray().map((o=>{if(typeof o!="number")throw _.Bu("VectorValues must only contain numeric values.");return mw(_.serializer,o)}))}}}}}})(i,c);throw c.Bu(`Unsupported field value: ${Yv(i)}`)})(n,e)}function R9(n,e){const t={};return k6(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):S0(n,((i,c)=>{const u=jw(c,e.Mu(i));u!=null&&(t[i]=u)})),{mapValue:{fields:t}}}function N9(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof su||n instanceof ex||n instanceof d0||n instanceof Th||n instanceof Dw||n instanceof Fw)}function D9(n,e,t){if(!N9(t)||!(function(c){return typeof c=="object"&&c!==null&&(Object.getPrototypeOf(c)===Object.prototype||Object.getPrototypeOf(c)===null)})(t)){const i=Yv(t);throw i==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+i)}}function eO(n,e,t){if((e=Ih(e))instanceof Nw)return e._internalPath;if(typeof e=="string")return F9(n,e);throw mv("Field path arguments must be of type string or ",n,!1,void 0,t)}const tO=new RegExp("[~\\*/\\[\\]]");function F9(n,e,t){if(e.search(tO)>=0)throw mv(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Nw(...e.split("."))._internalPath}catch{throw mv(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function mv(n,e,t,i,c){const u=i&&!i.isEmpty(),m=c!==void 0;let _=`Function ${e}() called with invalid data`;t&&(_+=" (via `toFirestore()`)"),_+=". ";let o="";return(u||m)&&(o+=" (found",u&&(o+=` in field ${i}`),m&&(o+=` in document ${c}`),o+=")"),new ci(Kn.INVALID_ARGUMENT,_+n+o)}function nO(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O9{constructor(e,t,i,c,u){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=c,this._converter=u}get id(){return this._key.path.lastSegment()}get ref(){return new Th(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new rO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Uw("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class rO extends O9{data(){return super.data()}}function Uw(n,e){return typeof e=="string"?F9(n,e):e instanceof Nw?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B9(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new ci(Kn.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Vw{}class iO extends Vw{}function xE(n,e,...t){let i=[];e instanceof Vw&&i.push(e),i=i.concat(t),(function(u){const m=u.filter((o=>o instanceof qw)).length,_=u.filter((o=>o instanceof tx)).length;if(m>1||m>0&&_>0)throw new ci(Kn.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(i);for(const c of i)n=c._apply(n);return n}class tx extends iO{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new tx(e,t,i)}_apply(e){const t=this._parse(e);return z9(e._query,t),new tg(e.firestore,e.converter,v5(e._query,t))}_parse(e){const t=Bw(e.firestore);return(function(u,m,_,o,w,I,O){let V;if(w.isKeyField()){if(I==="array-contains"||I==="array-contains-any")throw new ci(Kn.INVALID_ARGUMENT,`Invalid Query. You can't perform '${I}' queries on documentId().`);if(I==="in"||I==="not-in"){wE(O,I);const M=[];for(const se of O)M.push(bE(o,u,se));V={arrayValue:{values:M}}}else V=bE(o,u,O)}else I!=="in"&&I!=="not-in"&&I!=="array-contains-any"||wE(O,I),V=QF(_,m,O,I==="in"||I==="not-in");return Gc.create(w,I,V)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function oO(n,e,t){const i=e,c=Uw("where",n);return tx._create(c,i,t)}class qw extends Vw{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new qw(e,t)}_parse(e){const t=this._queryConstraints.map((i=>i._parse(e))).filter((i=>i.getFilters().length>0));return t.length===1?t[0]:Zd.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(c,u){let m=c;const _=u.getFlattenedFilters();for(const o of _)z9(m,o),m=v5(m,o)})(e._query,t),new tg(e.firestore,e.converter,v5(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function bE(n,e,t){if(typeof(t=Ih(t))=="string"){if(t==="")throw new ci(Kn.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!j6(e)&&t.indexOf("/")!==-1)throw new ci(Kn.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(cl.fromString(t));if(!Di.isDocumentKey(i))throw new ci(Kn.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return US(n,new Di(i))}if(t instanceof Th)return US(n,t._key);throw new ci(Kn.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Yv(t)}.`)}function wE(n,e){if(!Array.isArray(n)||n.length===0)throw new ci(Kn.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function z9(n,e){const t=(function(c,u){for(const m of c)for(const _ of m.getFlattenedFilters())if(u.indexOf(_.op)>=0)return _.op;return null})(n.filters,(function(c){switch(c){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new ci(Kn.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ci(Kn.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class sO{convertValue(e,t="none"){switch(Gm(e)){case 0:return null;case 1:return e.booleanValue;case 2:return vc(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes($m(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw po()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return S0(e,((c,u)=>{i[c]=this.convertValue(u,t)})),i}convertVectorValue(e){var t,i,c;const u=(c=(i=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||i===void 0?void 0:i.values)===null||c===void 0?void 0:c.map((m=>vc(m.doubleValue)));return new Fw(u)}convertGeoPoint(e){return new ex(vc(e.latitude),vc(e.longitude))}convertArray(e,t){return(e.values||[]).map((i=>this.convertValue(i,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const i=hw(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(Ky(e));default:return null}}convertTimestamp(e){const t=tm(e);return new su(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=cl.fromString(e);wa(c9(i));const c=new Zy(i.get(1),i.get(3)),u=new Di(i.popFirst(5));return c.isEqual(t)||pp(`Document ${u} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j9(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class by{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class U9 extends O9{constructor(e,t,i,c,u,m){super(e,t,i,c,m),this._firestore=e,this._firestoreImpl=e,this.metadata=u}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new O1(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(Uw("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class O1 extends U9{data(e={}){return super.data(e)}}class V9{constructor(e,t,i,c){this._firestore=e,this._userDataWriter=t,this._snapshot=c,this.metadata=new by(c.hasPendingWrites,c.fromCache),this.query=i}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((i=>{e.call(t,new O1(this._firestore,this._userDataWriter,i.key,i,new by(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ci(Kn.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(c,u){if(c._snapshot.oldDocs.isEmpty()){let m=0;return c._snapshot.docChanges.map((_=>{const o=new O1(c._firestore,c._userDataWriter,_.doc.key,_.doc,new by(c._snapshot.mutatedKeys.has(_.doc.key),c._snapshot.fromCache),c.query.converter);return _.doc,{type:"added",doc:o,oldIndex:-1,newIndex:m++}}))}{let m=c._snapshot.oldDocs;return c._snapshot.docChanges.filter((_=>u||_.type!==3)).map((_=>{const o=new O1(c._firestore,c._userDataWriter,_.doc.key,_.doc,new by(c._snapshot.mutatedKeys.has(_.doc.key),c._snapshot.fromCache),c.query.converter);let w=-1,I=-1;return _.type!==0&&(w=m.indexOf(_.doc.key),m=m.delete(_.doc.key)),_.type!==1&&(m=m.add(_.doc),I=m.indexOf(_.doc.key)),{type:aO(_.type),doc:o,oldIndex:w,newIndex:I}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function aO(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return po()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SE(n){n=Hd(n,Th);const e=Hd(n.firestore,Wm);return $F(Qv(e),n._key).then((t=>$9(e,n,t)))}class $w extends sO{constructor(e){super(),this.firestore=e}convertBytes(e){return new d0(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Th(this.firestore,null,t)}}function h1(n){n=Hd(n,tg);const e=Hd(n.firestore,Wm),t=Qv(e),i=new $w(e);return B9(n._query),GF(t,n._query).then((c=>new V9(e,i,n,c)))}function L5(n,e,t){n=Hd(n,Th);const i=Hd(n.firestore,Wm),c=j9(n.converter,e,t);return q9(i,[M9(Bw(i),"setDoc",n._key,c,n.converter!==null,t).toMutation(n._key,If.none())])}function EE(n,e){const t=Hd(n.firestore,Wm),i=Gg(n),c=j9(n.converter,e);return q9(t,[M9(Bw(n.firestore),"addDoc",i._key,c,n.converter!==null,{}).toMutation(i._key,If.exists(!1))]).then((()=>i))}function lO(n,...e){var t,i,c;n=Ih(n);let u={includeMetadataChanges:!1,source:"default"},m=0;typeof e[m]!="object"||vE(e[m])||(u=e[m],m++);const _={includeMetadataChanges:u.includeMetadataChanges,source:u.source};if(vE(e[m])){const O=e[m];e[m]=(t=O.next)===null||t===void 0?void 0:t.bind(O),e[m+1]=(i=O.error)===null||i===void 0?void 0:i.bind(O),e[m+2]=(c=O.complete)===null||c===void 0?void 0:c.bind(O)}let o,w,I;if(n instanceof Th)w=Hd(n.firestore,Wm),I=Vv(n._key.path),o={next:O=>{e[m]&&e[m]($9(w,n,O))},error:e[m+1],complete:e[m+2]};else{const O=Hd(n,tg);w=Hd(O.firestore,Wm),I=O._query;const V=new $w(w);o={next:M=>{e[m]&&e[m](new V9(w,V,O,M))},error:e[m+1],complete:e[m+2]},B9(n._query)}return(function(V,M,se,ce){const fe=new Rw(ce),ne=new kw(M,fe,se);return V.asyncQueue.enqueueAndForget((async()=>Cw(await pv(V),ne))),()=>{fe.Za(),V.asyncQueue.enqueueAndForget((async()=>Lw(await pv(V),ne)))}})(Qv(w),I,_,o)}function q9(n,e){return(function(i,c){const u=new up;return i.asyncQueue.enqueueAndForget((async()=>RF(await qF(i),c,u))),u.promise})(Qv(n),e)}function $9(n,e,t){const i=t.docs.get(e._key),c=new $w(n);return new U9(n,c,e._key,i,new by(t.hasPendingWrites,t.fromCache),e.converter)}function d1(){return new zw("serverTimestamp")}(function(e,t=!0){(function(c){w0=c})(b0),o0(new Vm("firestore",((i,{instanceIdentifier:c,options:u})=>{const m=i.getProvider("app").getImmediate(),_=new Wm(new hN(i.getProvider("auth-internal")),new mN(i.getProvider("app-check-internal")),(function(w,I){if(!Object.prototype.hasOwnProperty.apply(w.options,["projectId"]))throw new ci(Kn.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zy(w.options.projectId,I)})(m,c),m);return u=Object.assign({useFetchStreams:t},u),_._setSettings(u),_}),"PUBLIC").setMultipleInstances(!0)),Kp(FS,"4.7.3",e),Kp(FS,"4.7.3","esm2017")})();function Gw(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,i=Object.getOwnPropertySymbols(n);c<i.length;c++)e.indexOf(i[c])<0&&Object.prototype.propertyIsEnumerable.call(n,i[c])&&(t[i[c]]=n[i[c]]);return t}function G9(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const cO=G9,W9=new c_("auth","Firebase",G9());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gv=new ow("@firebase/auth");function uO(n,...e){gv.logLevel<=gs.WARN&&gv.warn(`Auth (${b0}): ${n}`,...e)}function B1(n,...e){gv.logLevel<=gs.ERROR&&gv.error(`Auth (${b0}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rf(n,...e){throw Hw(n,...e)}function Xd(n,...e){return Hw(n,...e)}function Ww(n,e,t){const i=Object.assign(Object.assign({},cO()),{[e]:t});return new c_("auth","Firebase",i).create(e,{appName:n.name})}function Yp(n){return Ww(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function H9(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&Rf(n,"argument-error"),Ww(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Hw(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return W9.create(n,...e)}function fo(n,e,...t){if(!n)throw Hw(e,...t)}function sp(n){const e="INTERNAL ASSERTION FAILED: "+n;throw B1(e),new Error(e)}function gp(n,e){n||sp(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P5(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function hO(){return AE()==="http:"||AE()==="https:"}function AE(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dO(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(hO()||UM()||"connection"in navigator)?navigator.onLine:!0}function fO(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __{constructor(e,t){this.shortDelay=e,this.longDelay=t,gp(t>e,"Short delay should be less than long delay!"),this.isMobile=BM()||VM()}get(){return dO()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xw(n,e){gp(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X9{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;sp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;sp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;sp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pO={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mO=new __(3e4,6e4);function Kw(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function T0(n,e,t,i,c={}){return K9(n,c,async()=>{let u={},m={};i&&(e==="GET"?m=i:u={body:JSON.stringify(i)});const _=u_(Object.assign({key:n.config.apiKey},m)).slice(1),o=await n._getAdditionalHeaders();o["Content-Type"]="application/json",n.languageCode&&(o["X-Firebase-Locale"]=n.languageCode);const w=Object.assign({method:e,headers:o},u);return jM()||(w.referrerPolicy="no-referrer"),X9.fetch()(Z9(n,n.config.apiHost,t,_),w)})}async function K9(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},pO),e);try{const c=new yO(n),u=await Promise.race([t(),c.promise]);c.clearNetworkTimeout();const m=await u.json();if("needConfirmation"in m)throw f1(n,"account-exists-with-different-credential",m);if(u.ok&&!("errorMessage"in m))return m;{const _=u.ok?m.errorMessage:m.error.message,[o,w]=_.split(" : ");if(o==="FEDERATED_USER_ID_ALREADY_LINKED")throw f1(n,"credential-already-in-use",m);if(o==="EMAIL_EXISTS")throw f1(n,"email-already-in-use",m);if(o==="USER_DISABLED")throw f1(n,"user-disabled",m);const I=i[o]||o.toLowerCase().replace(/[_\s]+/g,"-");if(w)throw Ww(n,I,w);Rf(n,I)}}catch(c){if(c instanceof _p)throw c;Rf(n,"network-request-failed",{message:String(c)})}}async function gO(n,e,t,i,c={}){const u=await T0(n,e,t,i,c);return"mfaPendingCredential"in u&&Rf(n,"multi-factor-auth-required",{_serverResponse:u}),u}function Z9(n,e,t,i){const c=`${e}${t}?${i}`;return n.config.emulator?Xw(n.config,c):`${n.config.apiScheme}://${c}`}class yO{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Xd(this.auth,"network-request-failed")),mO.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function f1(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const c=Xd(n,e,i);return c.customData._tokenResponse=t,c}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _O(n,e){return T0(n,"POST","/v1/accounts:delete",e)}async function Y9(n,e){return T0(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dy(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function vO(n,e=!1){const t=Ih(n),i=await t.getIdToken(e),c=Zw(i);fo(c&&c.exp&&c.auth_time&&c.iat,t.auth,"internal-error");const u=typeof c.firebase=="object"?c.firebase:void 0,m=u?.sign_in_provider;return{claims:c,token:i,authTime:Dy(Lb(c.auth_time)),issuedAtTime:Dy(Lb(c.iat)),expirationTime:Dy(Lb(c.exp)),signInProvider:m||null,signInSecondFactor:u?.sign_in_second_factor||null}}function Lb(n){return Number(n)*1e3}function Zw(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return B1("JWT malformed, contained fewer than 3 sections"),null;try{const c=f6(t);return c?JSON.parse(c):(B1("Failed to decode base64 JWT payload"),null)}catch(c){return B1("Caught error parsing JWT payload as JSON",c?.toString()),null}}function TE(n){const e=Zw(n);return fo(e,"internal-error"),fo(typeof e.exp<"u","internal-error"),fo(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t_(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof _p&&xO(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function xO({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bO{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const c=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,c)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k5{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Dy(this.lastLoginAt),this.creationTime=Dy(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yv(n){var e;const t=n.auth,i=await n.getIdToken(),c=await t_(n,Y9(t,{idToken:i}));fo(c?.users.length,t,"internal-error");const u=c.users[0];n._notifyReloadListener(u);const m=!((e=u.providerUserInfo)===null||e===void 0)&&e.length?J9(u.providerUserInfo):[],_=SO(n.providerData,m),o=n.isAnonymous,w=!(n.email&&u.passwordHash)&&!_?.length,I=o?w:!1,O={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:_,metadata:new k5(u.createdAt,u.lastLoginAt),isAnonymous:I};Object.assign(n,O)}async function wO(n){const e=Ih(n);await yv(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function SO(n,e){return[...n.filter(i=>!e.some(c=>c.providerId===i.providerId)),...e]}function J9(n){return n.map(e=>{var{providerId:t}=e,i=Gw(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EO(n,e){const t=await K9(n,{},async()=>{const i=u_({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:c,apiKey:u}=n.config,m=Z9(n,c,"/v1/token",`key=${u}`),_=await n._getAdditionalHeaders();return _["Content-Type"]="application/x-www-form-urlencoded",X9.fetch()(m,{method:"POST",headers:_,body:i})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function AO(n,e){return T0(n,"POST","/v2/accounts:revokeToken",Kw(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){fo(e.idToken,"internal-error"),fo(typeof e.idToken<"u","internal-error"),fo(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):TE(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){fo(e.length!==0,"internal-error");const t=TE(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(fo(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:c,expiresIn:u}=await EO(e,t);this.updateTokensAndExpiration(i,c,Number(u))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:c,expirationTime:u}=t,m=new n0;return i&&(fo(typeof i=="string","internal-error",{appName:e}),m.refreshToken=i),c&&(fo(typeof c=="string","internal-error",{appName:e}),m.accessToken=c),u&&(fo(typeof u=="number","internal-error",{appName:e}),m.expirationTime=u),m}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n0,this.toJSON())}_performRefresh(){return sp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fp(n,e){fo(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ap{constructor(e){var{uid:t,auth:i,stsTokenManager:c}=e,u=Gw(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new bO(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=u.displayName||null,this.email=u.email||null,this.emailVerified=u.emailVerified||!1,this.phoneNumber=u.phoneNumber||null,this.photoURL=u.photoURL||null,this.isAnonymous=u.isAnonymous||!1,this.tenantId=u.tenantId||null,this.providerData=u.providerData?[...u.providerData]:[],this.metadata=new k5(u.createdAt||void 0,u.lastLoginAt||void 0)}async getIdToken(e){const t=await t_(this,this.stsTokenManager.getToken(this.auth,e));return fo(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return vO(this,e)}reload(){return wO(this)}_assign(e){this!==e&&(fo(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ap(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){fo(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await yv(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(wf(this.auth.app))return Promise.reject(Yp(this.auth));const e=await this.getIdToken();return await t_(this,_O(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,c,u,m,_,o,w,I;const O=(i=t.displayName)!==null&&i!==void 0?i:void 0,V=(c=t.email)!==null&&c!==void 0?c:void 0,M=(u=t.phoneNumber)!==null&&u!==void 0?u:void 0,se=(m=t.photoURL)!==null&&m!==void 0?m:void 0,ce=(_=t.tenantId)!==null&&_!==void 0?_:void 0,fe=(o=t._redirectEventId)!==null&&o!==void 0?o:void 0,ne=(w=t.createdAt)!==null&&w!==void 0?w:void 0,oe=(I=t.lastLoginAt)!==null&&I!==void 0?I:void 0,{uid:ye,emailVerified:he,isAnonymous:Ne,providerData:Ve,stsTokenManager:de}=t;fo(ye&&de,e,"internal-error");const j=n0.fromJSON(this.name,de);fo(typeof ye=="string",e,"internal-error"),Fp(O,e.name),Fp(V,e.name),fo(typeof he=="boolean",e,"internal-error"),fo(typeof Ne=="boolean",e,"internal-error"),Fp(M,e.name),Fp(se,e.name),Fp(ce,e.name),Fp(fe,e.name),Fp(ne,e.name),Fp(oe,e.name);const D=new ap({uid:ye,auth:e,email:V,emailVerified:he,displayName:O,isAnonymous:Ne,photoURL:se,phoneNumber:M,tenantId:ce,stsTokenManager:j,createdAt:ne,lastLoginAt:oe});return Ve&&Array.isArray(Ve)&&(D.providerData=Ve.map($=>Object.assign({},$))),fe&&(D._redirectEventId=fe),D}static async _fromIdTokenResponse(e,t,i=!1){const c=new n0;c.updateFromServerResponse(t);const u=new ap({uid:t.localId,auth:e,stsTokenManager:c,isAnonymous:i});return await yv(u),u}static async _fromGetAccountInfoResponse(e,t,i){const c=t.users[0];fo(c.localId!==void 0,"internal-error");const u=c.providerUserInfo!==void 0?J9(c.providerUserInfo):[],m=!(c.email&&c.passwordHash)&&!u?.length,_=new n0;_.updateFromIdToken(i);const o=new ap({uid:c.localId,auth:e,stsTokenManager:_,isAnonymous:m}),w={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:u,metadata:new k5(c.createdAt,c.lastLoginAt),isAnonymous:!(c.email&&c.passwordHash)&&!u?.length};return Object.assign(o,w),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IE=new Map;function lp(n){gp(n instanceof Function,"Expected a class definition");let e=IE.get(n);return e?(gp(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,IE.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q9{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Q9.type="NONE";const CE=Q9;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z1(n,e,t){return`firebase:${n}:${e}:${t}`}class r0{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:c,name:u}=this.auth;this.fullUserKey=z1(this.userKey,c.apiKey,u),this.fullPersistenceKey=z1("persistence",c.apiKey,u),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ap._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new r0(lp(CE),e,i);const c=(await Promise.all(t.map(async w=>{if(await w._isAvailable())return w}))).filter(w=>w);let u=c[0]||lp(CE);const m=z1(i,e.config.apiKey,e.name);let _=null;for(const w of t)try{const I=await w._get(m);if(I){const O=ap._fromJSON(e,I);w!==u&&(_=O),u=w;break}}catch{}const o=c.filter(w=>w._shouldAllowMigration);return!u._shouldAllowMigration||!o.length?new r0(u,e,i):(u=o[0],_&&await u._set(m,_.toJSON()),await Promise.all(t.map(async w=>{if(w!==u)try{await w._remove(m)}catch{}})),new r0(u,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LE(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(rI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(eI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(oI(e))return"Blackberry";if(sI(e))return"Webos";if(tI(e))return"Safari";if((e.includes("chrome/")||nI(e))&&!e.includes("edge/"))return"Chrome";if(iI(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if(i?.length===2)return i[1]}return"Other"}function eI(n=_h()){return/firefox\//i.test(n)}function tI(n=_h()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function nI(n=_h()){return/crios\//i.test(n)}function rI(n=_h()){return/iemobile/i.test(n)}function iI(n=_h()){return/android/i.test(n)}function oI(n=_h()){return/blackberry/i.test(n)}function sI(n=_h()){return/webos/i.test(n)}function Yw(n=_h()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function TO(n=_h()){var e;return Yw(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function IO(){return qM()&&document.documentMode===10}function aI(n=_h()){return Yw(n)||iI(n)||sI(n)||oI(n)||/windows phone/i.test(n)||rI(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lI(n,e=[]){let t;switch(n){case"Browser":t=LE(_h());break;case"Worker":t=`${LE(_h())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${b0}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CO{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=u=>new Promise((m,_)=>{try{const o=e(u);m(o)}catch(o){_(o)}});i.onAbort=t,this.queue.push(i);const c=this.queue.length-1;return()=>{this.queue[c]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const c of t)try{c()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LO(n,e={}){return T0(n,"GET","/v2/passwordPolicy",Kw(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PO=6;class kO{constructor(e){var t,i,c,u;const m=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=m.minPasswordLength)!==null&&t!==void 0?t:PO,m.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=m.maxPasswordLength),m.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=m.containsLowercaseCharacter),m.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=m.containsUppercaseCharacter),m.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=m.containsNumericCharacter),m.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=m.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(c=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&c!==void 0?c:"",this.forceUpgradeOnSignin=(u=e.forceUpgradeOnSignin)!==null&&u!==void 0?u:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,c,u,m,_;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=(t=o.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),o.isValid&&(o.isValid=(i=o.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),o.isValid&&(o.isValid=(c=o.containsLowercaseLetter)!==null&&c!==void 0?c:!0),o.isValid&&(o.isValid=(u=o.containsUppercaseLetter)!==null&&u!==void 0?u:!0),o.isValid&&(o.isValid=(m=o.containsNumericCharacter)!==null&&m!==void 0?m:!0),o.isValid&&(o.isValid=(_=o.containsNonAlphanumericCharacter)!==null&&_!==void 0?_:!0),o}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,c=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),c&&(t.meetsMaxPasswordLength=e.length<=c)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let c=0;c<e.length;c++)i=e.charAt(c),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,c,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=c)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MO{constructor(e,t,i,c){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=c,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new PE(this),this.idTokenSubscription=new PE(this),this.beforeStateQueue=new CO(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=W9,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=c.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=lp(t)),this._initializationPromise=this.queue(async()=>{var i,c;if(!this._deleted&&(this.persistenceManager=await r0.create(this,e),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Y9(this,{idToken:e}),i=await ap._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(wf(this.app)){const m=this.app.settings.authIdToken;return m?new Promise(_=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(m).then(_,_))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let c=i,u=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const m=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,_=c?._redirectEventId,o=await this.tryRedirectSignIn(e);(!m||m===_)&&o?.user&&(c=o.user,u=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(u)try{await this.beforeStateQueue.runMiddleware(c)}catch(m){c=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(m))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return fo(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await yv(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=fO()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(wf(this.app))return Promise.reject(Yp(this));const t=e?Ih(e):null;return t&&fo(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&fo(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return wf(this.app)?Promise.reject(Yp(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return wf(this.app)?Promise.reject(Yp(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(lp(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await LO(this),t=new kO(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new c_("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await AO(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&lp(e)||this._popupRedirectResolver;fo(t,this,"argument-error"),this.redirectPersistenceManager=await r0.create(this,[lp(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,c){if(this._deleted)return()=>{};const u=typeof t=="function"?t:t.next.bind(t);let m=!1;const _=this._isInitialized?Promise.resolve():this._initializationPromise;if(fo(_,this,"internal-error"),_.then(()=>{m||u(this.currentUser)}),typeof t=="function"){const o=e.addObserver(t,i,c);return()=>{m=!0,o()}}else{const o=e.addObserver(t);return()=>{m=!0,o()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return fo(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=lI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());i&&(t["X-Firebase-Client"]=i);const c=await this._getAppCheckToken();return c&&(t["X-Firebase-AppCheck"]=c),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t?.error&&uO(`Error while retrieving App Check token: ${t.error}`),t?.token}}function I0(n){return Ih(n)}class PE{constructor(e){this.auth=e,this.observer=null,this.addObserver=YM(t=>this.observer=t)}get next(){return fo(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Jw={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function RO(n){Jw=n}function NO(n){return Jw.loadJS(n)}function DO(){return Jw.gapiScript}function FO(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OO(n,e){const t=aw(n,"auth");if(t.isInitialized()){const c=t.getImmediate(),u=t.getOptions();if(ov(u,e??{}))return c;Rf(c,"already-initialized")}return t.initialize({options:e})}function BO(n,e){const t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(lp);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}function zO(n,e,t){const i=I0(n);fo(i._canInitEmulator,i,"emulator-config-failed"),fo(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const c=!1,u=cI(e),{host:m,port:_}=jO(e),o=_===null?"":`:${_}`;i.config.emulator={url:`${u}//${m}${o}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:m,port:_,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:c})}),UO()}function cI(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function jO(n){const e=cI(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",c=/^(\[[^\]]+\])(:|$)/.exec(i);if(c){const u=c[1];return{host:u,port:kE(i.substr(u.length+1))}}else{const[u,m]=i.split(":");return{host:u,port:kE(m)}}}function kE(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function UO(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uI{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return sp("not implemented")}_getIdTokenResponse(e){return sp("not implemented")}_linkToIdToken(e,t){return sp("not implemented")}_getReauthenticationResolver(e){return sp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i0(n,e){return gO(n,"POST","/v1/accounts:signInWithIdp",Kw(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VO="http://localhost";class Hm extends uI{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Hm(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Rf("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:c}=t,u=Gw(t,["providerId","signInMethod"]);if(!i||!c)return null;const m=new Hm(i,c);return m.idToken=u.idToken||void 0,m.accessToken=u.accessToken||void 0,m.secret=u.secret,m.nonce=u.nonce,m.pendingToken=u.pendingToken||null,m}_getIdTokenResponse(e){const t=this.buildRequest();return i0(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,i0(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,i0(e,t)}buildRequest(){const e={requestUri:VO,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=u_(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nx{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v_ extends nx{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up extends v_{constructor(){super("facebook.com")}static credential(e){return Hm._fromParams({providerId:Up.PROVIDER_ID,signInMethod:Up.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Up.credentialFromTaggedObject(e)}static credentialFromError(e){return Up.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Up.credential(e.oauthAccessToken)}catch{return null}}}Up.FACEBOOK_SIGN_IN_METHOD="facebook.com";Up.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf extends v_{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Hm._fromParams({providerId:xf.PROVIDER_ID,signInMethod:xf.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return xf.credentialFromTaggedObject(e)}static credentialFromError(e){return xf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return xf.credential(t,i)}catch{return null}}}xf.GOOGLE_SIGN_IN_METHOD="google.com";xf.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vp extends v_{constructor(){super("github.com")}static credential(e){return Hm._fromParams({providerId:Vp.PROVIDER_ID,signInMethod:Vp.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Vp.credentialFromTaggedObject(e)}static credentialFromError(e){return Vp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Vp.credential(e.oauthAccessToken)}catch{return null}}}Vp.GITHUB_SIGN_IN_METHOD="github.com";Vp.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qp extends v_{constructor(){super("twitter.com")}static credential(e,t){return Hm._fromParams({providerId:qp.PROVIDER_ID,signInMethod:qp.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return qp.credentialFromTaggedObject(e)}static credentialFromError(e){return qp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return qp.credential(t,i)}catch{return null}}}qp.TWITTER_SIGN_IN_METHOD="twitter.com";qp.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f0{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,c=!1){const u=await ap._fromIdTokenResponse(e,i,c),m=ME(i);return new f0({user:u,providerId:m,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const c=ME(i);return new f0({user:e,providerId:c,_tokenResponse:i,operationType:t})}}function ME(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _v extends _p{constructor(e,t,i,c){var u;super(t.code,t.message),this.operationType=i,this.user=c,Object.setPrototypeOf(this,_v.prototype),this.customData={appName:e.name,tenantId:(u=e.tenantId)!==null&&u!==void 0?u:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,c){return new _v(e,t,i,c)}}function hI(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?_v._fromErrorAndOperation(n,u,e,i):u})}async function qO(n,e,t=!1){const i=await t_(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return f0._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $O(n,e,t=!1){const{auth:i}=n;if(wf(i.app))return Promise.reject(Yp(i));const c="reauthenticate";try{const u=await t_(n,hI(i,c,e,n),t);fo(u.idToken,i,"internal-error");const m=Zw(u.idToken);fo(m,i,"internal-error");const{sub:_}=m;return fo(n.uid===_,i,"user-mismatch"),f0._forOperation(n,c,u)}catch(u){throw u?.code==="auth/user-not-found"&&Rf(i,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GO(n,e,t=!1){if(wf(n.app))return Promise.reject(Yp(n));const i="signIn",c=await hI(n,i,e),u=await f0._fromIdTokenResponse(n,i,c);return t||await n._updateCurrentUser(u.user),u}function WO(n,e,t,i){return Ih(n).onIdTokenChanged(e,t,i)}function HO(n,e,t){return Ih(n).beforeAuthStateChanged(e,t)}function XO(n,e,t,i){return Ih(n).onAuthStateChanged(e,t,i)}function KO(n){return Ih(n).signOut()}const vv="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(vv,"1"),this.storage.removeItem(vv),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZO=1e3,YO=10;class fI extends dI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=aI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),c=this.localCache[t];i!==c&&e(t,c,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((m,_,o)=>{this.notifyListeners(m,o)});return}const i=e.key;t?this.detachListener():this.stopPolling();const c=()=>{const m=this.storage.getItem(i);!t&&this.localCache[i]===m||this.notifyListeners(i,m)},u=this.storage.getItem(i);IO()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(c,YO):c()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const c of Array.from(i))c(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},ZO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}fI.type="LOCAL";const JO=fI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pI extends dI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}pI.type="SESSION";const mI=pI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QO(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rx{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(c=>c.isListeningto(e));if(t)return t;const i=new rx(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:c,data:u}=t.data,m=this.handlersMap[c];if(!m?.size)return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:c});const _=Array.from(m).map(async w=>w(t.origin,u)),o=await QO(_);t.ports[0].postMessage({status:"done",eventId:i,eventType:c,response:o})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}rx.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qw(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eB{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const c=typeof MessageChannel<"u"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let u,m;return new Promise((_,o)=>{const w=Qw("",20);c.port1.start();const I=setTimeout(()=>{o(new Error("unsupported_event"))},i);m={messageChannel:c,onMessage(O){const V=O;if(V.data.eventId===w)switch(V.data.status){case"ack":clearTimeout(I),u=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),_(V.data.response);break;default:clearTimeout(I),clearTimeout(u),o(new Error("invalid_response"));break}}},this.handlers.add(m),c.port1.addEventListener("message",m.onMessage),this.target.postMessage({eventType:e,eventId:w,data:t},[c.port2])}).finally(()=>{m&&this.removeMessageHandler(m)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lf(){return window}function tB(n){Lf().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gI(){return typeof Lf().WorkerGlobalScope<"u"&&typeof Lf().importScripts=="function"}async function nB(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function rB(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function iB(){return gI()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yI="firebaseLocalStorageDb",oB=1,xv="firebaseLocalStorage",_I="fbase_key";class x_{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ix(n,e){return n.transaction([xv],e?"readwrite":"readonly").objectStore(xv)}function sB(){const n=indexedDB.deleteDatabase(yI);return new x_(n).toPromise()}function M5(){const n=indexedDB.open(yI,oB);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(xv,{keyPath:_I})}catch(c){t(c)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(xv)?e(i):(i.close(),await sB(),e(await M5()))})})}async function RE(n,e,t){const i=ix(n,!0).put({[_I]:e,value:t});return new x_(i).toPromise()}async function aB(n,e){const t=ix(n,!1).get(e),i=await new x_(t).toPromise();return i===void 0?null:i.value}function NE(n,e){const t=ix(n,!0).delete(e);return new x_(t).toPromise()}const lB=800,cB=3;class vI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await M5(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>cB)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return gI()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=rx._getInstance(iB()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await nB(),!this.activeServiceWorker)return;this.sender=new eB(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&!((e=i[0])===null||e===void 0)&&e.fulfilled&&!((t=i[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||rB()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await M5();return await RE(e,vv,"1"),await NE(e,vv),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>RE(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>aB(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>NE(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(c=>{const u=ix(c,!1).getAll();return new x_(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:c,value:u}of e)i.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(u)&&(this.notifyListeners(c,u),t.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!i.has(c)&&(this.notifyListeners(c,null),t.push(c));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const c of Array.from(i))c(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),lB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}vI.type="LOCAL";const uB=vI;new __(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e3(n,e){return e?lp(e):(fo(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t3 extends uI{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return i0(e,this._buildIdpRequest())}_linkToIdToken(e,t){return i0(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return i0(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function hB(n){return GO(n.auth,new t3(n),n.bypassAuthState)}function dB(n){const{auth:e,user:t}=n;return fo(t,e,"internal-error"),$O(t,new t3(n),n.bypassAuthState)}async function fB(n){const{auth:e,user:t}=n;return fo(t,e,"internal-error"),qO(t,new t3(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xI{constructor(e,t,i,c,u=!1){this.auth=e,this.resolver=i,this.user=c,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:c,tenantId:u,error:m,type:_}=e;if(m){this.reject(m);return}const o={auth:this.auth,requestUri:t,sessionId:i,tenantId:u||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(_)(o))}catch(w){this.reject(w)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return hB;case"linkViaPopup":case"linkViaRedirect":return fB;case"reauthViaPopup":case"reauthViaRedirect":return dB;default:Rf(this.auth,"internal-error")}}resolve(e){gp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){gp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pB=new __(2e3,1e4);async function mB(n,e,t){if(wf(n.app))return Promise.reject(Xd(n,"operation-not-supported-in-this-environment"));const i=I0(n);H9(n,e,nx);const c=e3(i,t);return new Dm(i,"signInViaPopup",e,c).executeNotNull()}class Dm extends xI{constructor(e,t,i,c,u){super(e,t,c,u),this.provider=i,this.authWindow=null,this.pollId=null,Dm.currentPopupAction&&Dm.currentPopupAction.cancel(),Dm.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return fo(e,this.auth,"internal-error"),e}async onExecution(){gp(this.filter.length===1,"Popup operations only handle one event");const e=Qw();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Xd(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Xd(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Dm.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if(!((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Xd(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,pB.get())};e()}}Dm.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gB="pendingRedirect",j1=new Map;class yB extends xI{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=j1.get(this.auth._key());if(!e){try{const i=await _B(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}j1.set(this.auth._key(),e)}return this.bypassAuthState||j1.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function _B(n,e){const t=wI(e),i=bI(n);if(!await i._isAvailable())return!1;const c=await i._get(t)==="true";return await i._remove(t),c}async function vB(n,e){return bI(n)._set(wI(e),"true")}function xB(n,e){j1.set(n._key(),e)}function bI(n){return lp(n._redirectPersistence)}function wI(n){return z1(gB,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bB(n,e,t){return wB(n,e,t)}async function wB(n,e,t){if(wf(n.app))return Promise.reject(Yp(n));const i=I0(n);H9(n,e,nx),await i._initializationPromise;const c=e3(i,t);return await vB(c,i),c._openRedirect(i,e,"signInViaRedirect")}async function SB(n,e){return await I0(n)._initializationPromise,SI(n,e,!1)}async function SI(n,e,t=!1){if(wf(n.app))return Promise.reject(Yp(n));const i=I0(n),c=e3(i,e),m=await new yB(i,c,t).execute();return m&&!t&&(delete m.user._redirectEventId,await i._persistUserIfCurrent(m.user),await i._setRedirectUser(null,e)),m}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EB=600*1e3;class AB{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!TB(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!EI(e)){const c=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(Xd(this.auth,c))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=EB&&this.cachedEventUids.clear(),this.cachedEventUids.has(DE(e))}saveEventToCache(e){this.cachedEventUids.add(DE(e)),this.lastProcessedEventTime=Date.now()}}function DE(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function EI({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function TB(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return EI(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IB(n,e={}){return T0(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CB=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,LB=/^https?/;async function PB(n){if(n.config.emulator)return;const{authorizedDomains:e}=await IB(n);for(const t of e)try{if(kB(t))return}catch{}Rf(n,"unauthorized-domain")}function kB(n){const e=P5(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const m=new URL(n);return m.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&m.hostname===i}if(!LB.test(t))return!1;if(CB.test(n))return i===n;const c=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MB=new __(3e4,6e4);function FE(){const n=Lf().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function RB(n){return new Promise((e,t)=>{var i,c,u;function m(){FE(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{FE(),t(Xd(n,"network-request-failed"))},timeout:MB.get()})}if(!((c=(i=Lf().gapi)===null||i===void 0?void 0:i.iframes)===null||c===void 0)&&c.Iframe)e(gapi.iframes.getContext());else if(!((u=Lf().gapi)===null||u===void 0)&&u.load)m();else{const _=FO("iframefcb");return Lf()[_]=()=>{gapi.load?m():t(Xd(n,"network-request-failed"))},NO(`${DO()}?onload=${_}`).catch(o=>t(o))}}).catch(e=>{throw U1=null,e})}let U1=null;function NB(n){return U1=U1||RB(n),U1}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB=new __(5e3,15e3),FB="__/auth/iframe",OB="emulator/auth/iframe",BB={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},zB=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function jB(n){const e=n.config;fo(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Xw(e,OB):`https://${n.config.authDomain}/${FB}`,i={apiKey:e.apiKey,appName:n.name,v:b0},c=zB.get(n.config.apiHost);c&&(i.eid=c);const u=n._getFrameworks();return u.length&&(i.fw=u.join(",")),`${t}?${u_(i).slice(1)}`}async function UB(n){const e=await NB(n),t=Lf().gapi;return fo(t,n,"internal-error"),e.open({where:document.body,url:jB(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:BB,dontclear:!0},i=>new Promise(async(c,u)=>{await i.restyle({setHideOnLeave:!1});const m=Xd(n,"network-request-failed"),_=Lf().setTimeout(()=>{u(m)},DB.get());function o(){Lf().clearTimeout(_),c(i)}i.ping(o).then(o,()=>{u(m)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VB={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},qB=500,$B=600,GB="_blank",WB="http://localhost";class OE{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function HB(n,e,t,i=qB,c=$B){const u=Math.max((window.screen.availHeight-c)/2,0).toString(),m=Math.max((window.screen.availWidth-i)/2,0).toString();let _="";const o=Object.assign(Object.assign({},VB),{width:i.toString(),height:c.toString(),top:u,left:m}),w=_h().toLowerCase();t&&(_=nI(w)?GB:t),eI(w)&&(e=e||WB,o.scrollbars="yes");const I=Object.entries(o).reduce((V,[M,se])=>`${V}${M}=${se},`,"");if(TO(w)&&_!=="_self")return XB(e||"",_),new OE(null);const O=window.open(e||"",_,I);fo(O,n,"popup-blocked");try{O.focus()}catch{}return new OE(O)}function XB(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KB="__/auth/handler",ZB="emulator/auth/handler",YB=encodeURIComponent("fac");async function BE(n,e,t,i,c,u){fo(n.config.authDomain,n,"auth-domain-config-required"),fo(n.config.apiKey,n,"invalid-api-key");const m={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:b0,eventId:c};if(e instanceof nx){e.setDefaultLanguage(n.languageCode),m.providerId=e.providerId||"",ZM(e.getCustomParameters())||(m.customParameters=JSON.stringify(e.getCustomParameters()));for(const[I,O]of Object.entries({}))m[I]=O}if(e instanceof v_){const I=e.getScopes().filter(O=>O!=="");I.length>0&&(m.scopes=I.join(","))}n.tenantId&&(m.tid=n.tenantId);const _=m;for(const I of Object.keys(_))_[I]===void 0&&delete _[I];const o=await n._getAppCheckToken(),w=o?`#${YB}=${encodeURIComponent(o)}`:"";return`${JB(n)}?${u_(_).slice(1)}${w}`}function JB({config:n}){return n.emulator?Xw(n,ZB):`https://${n.authDomain}/${KB}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pb="webStorageSupport";class QB{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=mI,this._completeRedirectFn=SI,this._overrideRedirectResult=xB}async _openPopup(e,t,i,c){var u;gp((u=this.eventManagers[e._key()])===null||u===void 0?void 0:u.manager,"_initialize() not called before _openPopup()");const m=await BE(e,t,i,P5(),c);return HB(e,m,Qw())}async _openRedirect(e,t,i,c){await this._originValidation(e);const u=await BE(e,t,i,P5(),c);return tB(u),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:c,promise:u}=this.eventManagers[t];return c?Promise.resolve(c):(gp(u,"If manager is not set, promise should be"),u)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await UB(e),i=new AB(e);return t.register("authEvent",c=>(fo(c?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Pb,{type:Pb},c=>{var u;const m=(u=c?.[0])===null||u===void 0?void 0:u[Pb];m!==void 0&&t(!!m),Rf(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=PB(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return aI()||tI()||Yw()}}const ez=QB;var zE="@firebase/auth",jE="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tz{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){fo(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nz(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function rz(n){o0(new Vm("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),c=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:m,authDomain:_}=i.options;fo(m&&!m.includes(":"),"invalid-api-key",{appName:i.name});const o={apiKey:m,authDomain:_,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:lI(n)},w=new MO(i,c,u,o);return BO(w,t),w},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),o0(new Vm("auth-internal",e=>{const t=I0(e.getProvider("auth").getImmediate());return(i=>new tz(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Kp(zE,jE,nz(n)),Kp(zE,jE,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iz=300,oz=g6("authIdTokenMaxAge")||iz;let UE=null;const sz=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>oz)return;const c=t?.token;UE!==c&&(UE=c,await fetch(n,{method:c?"POST":"DELETE",headers:c?{Authorization:`Bearer ${c}`}:{}}))};function V1(n=x6()){const e=aw(n,"auth");if(e.isInitialized())return e.getImmediate();const t=OO(n,{popupRedirectResolver:ez,persistence:[uB,JO,mI]}),i=g6("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(i,location.origin);if(location.origin===u.origin){const m=sz(u.toString());HO(t,m,()=>m(t.currentUser)),WO(t,_=>m(_))}}const c=p6("auth");return c&&zO(t,`http://${c}`),t}function az(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}RO({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=c=>{const u=Xd("internal-error");u.customData=c,t(u)},i.type="text/javascript",i.charset="UTF-8",az().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});rz("Browser");const lz={apiKey:"AIzaSyDqdNAi8z3vx8TJcbVwUN37GJtt4vGH_Cs",authDomain:"stakeholder-map-a4bdc.firebaseapp.com",projectId:"stakeholder-map-a4bdc",storageBucket:"stakeholder-map-a4bdc.firebasestorage.app",messagingSenderId:"201968932417",appId:"1:201968932417:web:c6053a304f5dc5f2ffd8c0",measurementId:"G-BEB17GFMBJ"},AI=v6(lz),fh=XF(AI);V1(AI);new xf;const cz=[{value:5,label:"5 - Excellent"},{value:4,label:"4 - Good"},{value:3,label:"3 - Adequate"},{value:2,label:"2 - Poor"},{value:1,label:"1 - Very Poor"},{value:0,label:"0 - Not Set"}],VE={buildingName:"",notes:"",scores:{architecture:{exterior:0,entrances:0,interiorFinishes:0,lifeSafety:0,codesAndAccessibility:0},engineering:{superstructure:0,conveyingSystems:0,fireProtection:0,plumbing:0,mechanical:0,power:0,lighting:0},functionality:{telecomm:0,fireAlarm:0,spaceSize:0,technology:0}}},uz=({buildingId:n,assessments:e,onClose:t,onSave:i,universityId:c,panelPos:u,isAdminRole:m})=>{const[_,o]=Fn.useState(VE);Fn.useEffect(()=>{if(n&&e){const M=e[n]||{...VE,buildingName:n};o(M)}},[n,e]);const w=(M,se,ce)=>{o(fe=>({...fe,scores:{...fe.scores,[M]:{...fe.scores[M],[se]:Number(ce)}}}))},I=M=>{o(se=>({...se,notes:M.target.value}))},O=async()=>{if(!m){alert("Save failed: you are not signed in as an admin.");return}if(!n||!c)return;const M=n.replace(/\//g,"__"),se=Gg(fh,"universities",c,"buildingAssessments",M),ce={..._,originalId:n};try{await L5(se,ce),i(ce),alert("Assessment saved successfully!"),t()}catch(fe){console.error("Error saving assessment:",fe),alert("Failed to save assessment. See console for details.")}};if(!n)return null;const V=u?{position:"absolute",left:u.x??80,top:u.y??160,zIndex:6}:void 0;return Q.jsxs("div",{className:"assessment-panel",style:V,children:[Q.jsxs("div",{className:"panel-header",children:[Q.jsx("h3",{children:"Technical Assessment"}),Q.jsx("button",{onClick:t,className:"close-button",children:""})]}),Q.jsxs("div",{className:"panel-content",children:[Q.jsx("h4",{children:_.buildingName||n}),_.scores&&Object.entries(_.scores).map(([M,se])=>Q.jsxs("div",{className:"category-section",children:[Q.jsx("h5",{children:M.charAt(0).toUpperCase()+M.slice(1)}),Object.entries(se).map(([ce,fe])=>Q.jsxs("div",{className:"score-item",children:[Q.jsx("label",{children:ce.replace(/([A-Z])/g," $1").trim()}),Q.jsx("select",{value:fe,onChange:ne=>w(M,ce,ne.target.value),children:cz.map(ne=>Q.jsx("option",{value:ne.value,children:ne.label},ne.value))})]},ce))]},M)),Q.jsxs("div",{className:"notes-section",children:[Q.jsx("h5",{children:"Notes"}),Q.jsx("textarea",{value:_.notes||"",onChange:I,rows:"4"})]}),Q.jsx("button",{className:"save-button",onClick:O,children:"Save Changes"})]})]})},hz=({buildingId:n,buildingName:e,currentCondition:t,onSave:i,onOpenTechnical:c,onClose:u,floorplans:m,onSelectFloorplan:_})=>{const[o,w]=Fn.useState(t??"");Fn.useEffect(()=>{w(t??"")},[n,t]);const I=()=>{n&&o&&i(n,o)},O=(o||"")!==(t||"");return Q.jsxs("div",{className:"interaction-panel",children:[Q.jsx("button",{className:"close-button",onClick:u,children:""}),Q.jsx("h4",{children:e||n}),Q.jsxs("div",{className:"control-section",children:[Q.jsx("h5",{children:"Stakeholder Condition"}),Q.jsxs("select",{value:o,onChange:V=>w(V.target.value),children:[Q.jsx("option",{value:"",disabled:!0,children:"Select condition..."}),Q.jsx("option",{value:"5",children:"5 = Excellent"}),Q.jsx("option",{value:"4",children:"4 = Good"}),Q.jsx("option",{value:"3",children:"3 = Adequate"}),Q.jsx("option",{value:"2",children:"2 = Poor"}),Q.jsx("option",{value:"1",children:"1 = Very Poor"})]}),Q.jsx("div",{className:"button-row",style:{marginTop:8},children:Q.jsx("button",{onClick:I,disabled:!O||!o,children:"Save Stakeholder Condition"})})]}),Q.jsx("div",{className:"button-row",style:{marginTop:8},children:Q.jsx("button",{onClick:c,children:"Technical Assessment"})}),m&&m.length>0&&Q.jsxs("div",{className:"control-section",children:[Q.jsx("h5",{children:"Floor Plans"}),Q.jsx("div",{className:"floorplan-buttons",children:m.map((V,M)=>Q.jsx("button",{onClick:()=>_?.(V),children:V.name},M))})]})]})},qE={"This is one of my go-to study spots":"#006400","This is a go-to hangout spot for me and my friends":"#008000","I would like to use this space more, but it needs improvement":"#9cdef1ff","This space feels outdated or run-down":"#f4e806ff","The furniture in this space is uncomfortable or not functional":"#e9a804ff","The lighting or temperature in this space makes it uncomfortable":"#f29008ff","I rarely or never use this space":"#f05555ff","I do not feel safe in this space":"#e00905bc","Just leave a comment about this space":"#9E9E9E"},dz={"This space supports my teaching and/or professional work effectively":"#007330ff","I wish this space were more flexible or adaptable for different uses":"#31f579ff","I would like to use this space more, but it needs some improvement":"#94d2bd","The layout or furniture is not functional for my needs":"#e9d8a6","The technology in this space is inadequate or unreliable":"#f4d804ff","This space lacks the privacy needed for my work":"#f97c3eff","I rarely or never use this space":"#f25f54ff","I do not feel safe in this space":"#ae2012","Just leave a comment about this space":"#9E9E9E"},p1={student:qE,staff:dz,default:qE};var Vu=63710088e-1,TI={centimeters:Vu*100,centimetres:Vu*100,degrees:360/(2*Math.PI),feet:Vu*3.28084,inches:Vu*39.37,kilometers:Vu/1e3,kilometres:Vu/1e3,meters:Vu,metres:Vu,miles:Vu/1609.344,millimeters:Vu*1e3,millimetres:Vu*1e3,nauticalmiles:Vu/1852,radians:1,yards:Vu*1.0936};function n3(n,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=n,i}function zs(n,e,t={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!$E(n[0])||!$E(n[1]))throw new Error("coordinates must contain numbers");return n3({type:"Point",coordinates:n},e,t)}function r3(n,e,t={}){for(const c of n){if(c.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(c[c.length-1].length!==c[0].length)throw new Error("First and last Position are not equivalent.");for(let u=0;u<c[c.length-1].length;u++)if(c[c.length-1][u]!==c[0][u])throw new Error("First and last Position are not equivalent.")}return n3({type:"Polygon",coordinates:n},e,t)}function i3(n,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function fz(n,e,t={}){return n3({type:"MultiPolygon",coordinates:n},e,t)}function II(n,e="kilometers"){const t=TI[e];if(!t)throw new Error(e+" units is invalid");return n*t}function pz(n,e="kilometers"){const t=TI[e];if(!t)throw new Error(e+" units is invalid");return n/t}function CI(n){return n%(2*Math.PI)*180/Math.PI}function id(n){return n%360*Math.PI/180}function LI(n,e="kilometers",t="kilometers"){if(!(n>=0))throw new Error("length must be a positive number");return II(pz(n,e),t)}function $E(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function o3(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}function Ed(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function s3(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function mz(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function km(n,e,t={}){if(t.final===!0)return gz(n,e);const i=Ed(n),c=Ed(e),u=id(i[0]),m=id(c[0]),_=id(i[1]),o=id(c[1]),w=Math.sin(m-u)*Math.cos(o),I=Math.cos(_)*Math.sin(o)-Math.sin(_)*Math.cos(o)*Math.cos(m-u);return CI(Math.atan2(w,I))}function gz(n,e){let t=km(e,n);return t=(t+180)%360,t}function vf(n,e,t={}){var i=Ed(n),c=Ed(e),u=id(c[1]-i[1]),m=id(c[0]-i[0]),_=id(i[1]),o=id(c[1]),w=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(m/2),2)*Math.cos(_)*Math.cos(o);return II(2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w)),t.units)}function PI(n,e,t={}){let i;return t.final?i=GE(Ed(e),Ed(n)):i=GE(Ed(n),Ed(e)),i>180?-(360-i):i}function GE(n,e){const t=id(n[1]),i=id(e[1]);let c=id(e[0]-n[0]);c>Math.PI&&(c-=2*Math.PI),c<-Math.PI&&(c+=2*Math.PI);const u=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(t/2+Math.PI/4)),m=Math.atan2(c,u);return(CI(m)+360)%360}function ng(n,e,t){if(n!==null)for(var i,c,u,m,_,o,w,I=0,O=0,V,M=n.type,se=M==="FeatureCollection",ce=M==="Feature",fe=se?n.features.length:1,ne=0;ne<fe;ne++){w=se?n.features[ne].geometry:ce?n.geometry:n,V=w?w.type==="GeometryCollection":!1,_=V?w.geometries.length:1;for(var oe=0;oe<_;oe++){var ye=0,he=0;if(m=V?w.geometries[oe]:w,m!==null){o=m.coordinates;var Ne=m.type;switch(I=t&&(Ne==="Polygon"||Ne==="MultiPolygon")?1:0,Ne){case null:break;case"Point":if(e(o,O,ne,ye,he)===!1)return!1;O++,ye++;break;case"LineString":case"MultiPoint":for(i=0;i<o.length;i++){if(e(o[i],O,ne,ye,he)===!1)return!1;O++,Ne==="MultiPoint"&&ye++}Ne==="LineString"&&ye++;break;case"Polygon":case"MultiLineString":for(i=0;i<o.length;i++){for(c=0;c<o[i].length-I;c++){if(e(o[i][c],O,ne,ye,he)===!1)return!1;O++}Ne==="MultiLineString"&&ye++,Ne==="Polygon"&&he++}Ne==="Polygon"&&ye++;break;case"MultiPolygon":for(i=0;i<o.length;i++){for(he=0,c=0;c<o[i].length;c++){for(u=0;u<o[i][c].length-I;u++){if(e(o[i][c][u],O,ne,ye,he)===!1)return!1;O++}he++}ye++}break;case"GeometryCollection":for(i=0;i<m.geometries.length;i++)if(ng(m.geometries[i],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function yz(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var t=0;t<n.features.length&&e(n.features[t],t)!==!1;t++);}function kI(n,e){var t,i,c,u,m,_,o,w,I,O,V=0,M=n.type==="FeatureCollection",se=n.type==="Feature",ce=M?n.features.length:1;for(t=0;t<ce;t++){for(_=M?n.features[t].geometry:se?n.geometry:n,w=M?n.features[t].properties:se?n.properties:{},I=M?n.features[t].bbox:se?n.bbox:void 0,O=M?n.features[t].id:se?n.id:void 0,o=_?_.type==="GeometryCollection":!1,m=o?_.geometries.length:1,c=0;c<m;c++){if(u=o?_.geometries[c]:_,u===null){if(e(null,V,w,I,O)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,V,w,I,O)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(e(u.geometries[i],V,w,I,O)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}V++}}function _z(n,e,t){var i=t;return kI(n,function(c,u,m,_,o){i=e(i,c,u,m,_,o)}),i}function WE(n){return _z(n,(e,t)=>e+vz(t),0)}function vz(n){let e=0,t;switch(n.type){case"Polygon":return HE(n.coordinates);case"MultiPolygon":for(t=0;t<n.coordinates.length;t++)e+=HE(n.coordinates[t]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function HE(n){let e=0;if(n&&n.length>0){e+=Math.abs(XE(n[0]));for(let t=1;t<n.length;t++)e-=Math.abs(XE(n[t]))}return e}var xz=Vu*Vu/2,kb=Math.PI/180;function XE(n){const e=n.length-1;if(e<=2)return 0;let t=0,i=0;for(;i<e;){const c=n[i],u=n[i+1===e?0:i+1],m=n[i+2>=e?(i+2)%e:i+2],_=c[0]*kb,o=u[1]*kb,w=m[0]*kb;t+=(w-_)*Math.sin(o),i++}return t*xz}function Eu(n,e={}){if(n.bbox!=null&&e.recompute!==!0)return n.bbox;const t=[1/0,1/0,-1/0,-1/0];return ng(n,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}function bz(n,e={}){const t=Eu(n),i=(t[0]+t[2])/2,c=(t[1]+t[3])/2;return zs([i,c],e.properties,e)}function tc(n,e={}){let t=0,i=0,c=0;return ng(n,function(u){t+=u[0],i+=u[1],c++},!0),zs([t/c,i/c],e.properties)}var m1={exports:{}},q1={exports:{}},wz=q1.exports,KE;function Sz(){return KE||(KE=1,(function(n,e){(function(t,i){n.exports=i()})(wz,function(){function t(oe,ye,he,Ne,Ve){(function de(j,D,$,z,W){for(;z>$;){if(z-$>600){var Z=z-$+1,Ee=D-$+1,ke=Math.log(Z),Oe=.5*Math.exp(2*ke/3),Re=.5*Math.sqrt(ke*Oe*(Z-Oe)/Z)*(Ee-Z/2<0?-1:1),be=Math.max($,Math.floor(D-Ee*Oe/Z+Re)),De=Math.min(z,Math.floor(D+(Z-Ee)*Oe/Z+Re));de(j,D,be,De,W)}var Qe=j[D],xe=$,ae=z;for(i(j,$,D),W(j[z],Qe)>0&&i(j,$,z);xe<ae;){for(i(j,xe,ae),xe++,ae--;W(j[xe],Qe)<0;)xe++;for(;W(j[ae],Qe)>0;)ae--}W(j[$],Qe)===0?i(j,$,ae):i(j,++ae,z),ae<=D&&($=ae+1),D<=ae&&(z=ae-1)}})(oe,ye,he||0,Ne||oe.length-1,Ve||c)}function i(oe,ye,he){var Ne=oe[ye];oe[ye]=oe[he],oe[he]=Ne}function c(oe,ye){return oe<ye?-1:oe>ye?1:0}var u=function(oe){oe===void 0&&(oe=9),this._maxEntries=Math.max(4,oe),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function m(oe,ye,he){if(!he)return ye.indexOf(oe);for(var Ne=0;Ne<ye.length;Ne++)if(he(oe,ye[Ne]))return Ne;return-1}function _(oe,ye){o(oe,0,oe.children.length,ye,oe)}function o(oe,ye,he,Ne,Ve){Ve||(Ve=fe(null)),Ve.minX=1/0,Ve.minY=1/0,Ve.maxX=-1/0,Ve.maxY=-1/0;for(var de=ye;de<he;de++){var j=oe.children[de];w(Ve,oe.leaf?Ne(j):j)}return Ve}function w(oe,ye){return oe.minX=Math.min(oe.minX,ye.minX),oe.minY=Math.min(oe.minY,ye.minY),oe.maxX=Math.max(oe.maxX,ye.maxX),oe.maxY=Math.max(oe.maxY,ye.maxY),oe}function I(oe,ye){return oe.minX-ye.minX}function O(oe,ye){return oe.minY-ye.minY}function V(oe){return(oe.maxX-oe.minX)*(oe.maxY-oe.minY)}function M(oe){return oe.maxX-oe.minX+(oe.maxY-oe.minY)}function se(oe,ye){return oe.minX<=ye.minX&&oe.minY<=ye.minY&&ye.maxX<=oe.maxX&&ye.maxY<=oe.maxY}function ce(oe,ye){return ye.minX<=oe.maxX&&ye.minY<=oe.maxY&&ye.maxX>=oe.minX&&ye.maxY>=oe.minY}function fe(oe){return{children:oe,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ne(oe,ye,he,Ne,Ve){for(var de=[ye,he];de.length;)if(!((he=de.pop())-(ye=de.pop())<=Ne)){var j=ye+Math.ceil((he-ye)/Ne/2)*Ne;t(oe,j,ye,he,Ve),de.push(ye,j,j,he)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(oe){var ye=this.data,he=[];if(!ce(oe,ye))return he;for(var Ne=this.toBBox,Ve=[];ye;){for(var de=0;de<ye.children.length;de++){var j=ye.children[de],D=ye.leaf?Ne(j):j;ce(oe,D)&&(ye.leaf?he.push(j):se(oe,D)?this._all(j,he):Ve.push(j))}ye=Ve.pop()}return he},u.prototype.collides=function(oe){var ye=this.data;if(!ce(oe,ye))return!1;for(var he=[];ye;){for(var Ne=0;Ne<ye.children.length;Ne++){var Ve=ye.children[Ne],de=ye.leaf?this.toBBox(Ve):Ve;if(ce(oe,de)){if(ye.leaf||se(oe,de))return!0;he.push(Ve)}}ye=he.pop()}return!1},u.prototype.load=function(oe){if(!oe||!oe.length)return this;if(oe.length<this._minEntries){for(var ye=0;ye<oe.length;ye++)this.insert(oe[ye]);return this}var he=this._build(oe.slice(),0,oe.length-1,0);if(this.data.children.length)if(this.data.height===he.height)this._splitRoot(this.data,he);else{if(this.data.height<he.height){var Ne=this.data;this.data=he,he=Ne}this._insert(he,this.data.height-he.height-1,!0)}else this.data=he;return this},u.prototype.insert=function(oe){return oe&&this._insert(oe,this.data.height-1),this},u.prototype.clear=function(){return this.data=fe([]),this},u.prototype.remove=function(oe,ye){if(!oe)return this;for(var he,Ne,Ve,de=this.data,j=this.toBBox(oe),D=[],$=[];de||D.length;){if(de||(de=D.pop(),Ne=D[D.length-1],he=$.pop(),Ve=!0),de.leaf){var z=m(oe,de.children,ye);if(z!==-1)return de.children.splice(z,1),D.push(de),this._condense(D),this}Ve||de.leaf||!se(de,j)?Ne?(he++,de=Ne.children[he],Ve=!1):de=null:(D.push(de),$.push(he),he=0,Ne=de,de=de.children[0])}return this},u.prototype.toBBox=function(oe){return oe},u.prototype.compareMinX=function(oe,ye){return oe.minX-ye.minX},u.prototype.compareMinY=function(oe,ye){return oe.minY-ye.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(oe){return this.data=oe,this},u.prototype._all=function(oe,ye){for(var he=[];oe;)oe.leaf?ye.push.apply(ye,oe.children):he.push.apply(he,oe.children),oe=he.pop();return ye},u.prototype._build=function(oe,ye,he,Ne){var Ve,de=he-ye+1,j=this._maxEntries;if(de<=j)return _(Ve=fe(oe.slice(ye,he+1)),this.toBBox),Ve;Ne||(Ne=Math.ceil(Math.log(de)/Math.log(j)),j=Math.ceil(de/Math.pow(j,Ne-1))),(Ve=fe([])).leaf=!1,Ve.height=Ne;var D=Math.ceil(de/j),$=D*Math.ceil(Math.sqrt(j));ne(oe,ye,he,$,this.compareMinX);for(var z=ye;z<=he;z+=$){var W=Math.min(z+$-1,he);ne(oe,z,W,D,this.compareMinY);for(var Z=z;Z<=W;Z+=D){var Ee=Math.min(Z+D-1,W);Ve.children.push(this._build(oe,Z,Ee,Ne-1))}}return _(Ve,this.toBBox),Ve},u.prototype._chooseSubtree=function(oe,ye,he,Ne){for(;Ne.push(ye),!ye.leaf&&Ne.length-1!==he;){for(var Ve=1/0,de=1/0,j=void 0,D=0;D<ye.children.length;D++){var $=ye.children[D],z=V($),W=(Z=oe,Ee=$,(Math.max(Ee.maxX,Z.maxX)-Math.min(Ee.minX,Z.minX))*(Math.max(Ee.maxY,Z.maxY)-Math.min(Ee.minY,Z.minY))-z);W<de?(de=W,Ve=z<Ve?z:Ve,j=$):W===de&&z<Ve&&(Ve=z,j=$)}ye=j||ye.children[0]}var Z,Ee;return ye},u.prototype._insert=function(oe,ye,he){var Ne=he?oe:this.toBBox(oe),Ve=[],de=this._chooseSubtree(Ne,this.data,ye,Ve);for(de.children.push(oe),w(de,Ne);ye>=0&&Ve[ye].children.length>this._maxEntries;)this._split(Ve,ye),ye--;this._adjustParentBBoxes(Ne,Ve,ye)},u.prototype._split=function(oe,ye){var he=oe[ye],Ne=he.children.length,Ve=this._minEntries;this._chooseSplitAxis(he,Ve,Ne);var de=this._chooseSplitIndex(he,Ve,Ne),j=fe(he.children.splice(de,he.children.length-de));j.height=he.height,j.leaf=he.leaf,_(he,this.toBBox),_(j,this.toBBox),ye?oe[ye-1].children.push(j):this._splitRoot(he,j)},u.prototype._splitRoot=function(oe,ye){this.data=fe([oe,ye]),this.data.height=oe.height+1,this.data.leaf=!1,_(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(oe,ye,he){for(var Ne,Ve,de,j,D,$,z,W=1/0,Z=1/0,Ee=ye;Ee<=he-ye;Ee++){var ke=o(oe,0,Ee,this.toBBox),Oe=o(oe,Ee,he,this.toBBox),Re=(Ve=ke,de=Oe,j=void 0,D=void 0,$=void 0,z=void 0,j=Math.max(Ve.minX,de.minX),D=Math.max(Ve.minY,de.minY),$=Math.min(Ve.maxX,de.maxX),z=Math.min(Ve.maxY,de.maxY),Math.max(0,$-j)*Math.max(0,z-D)),be=V(ke)+V(Oe);Re<W?(W=Re,Ne=Ee,Z=be<Z?be:Z):Re===W&&be<Z&&(Z=be,Ne=Ee)}return Ne||he-ye},u.prototype._chooseSplitAxis=function(oe,ye,he){var Ne=oe.leaf?this.compareMinX:I,Ve=oe.leaf?this.compareMinY:O;this._allDistMargin(oe,ye,he,Ne)<this._allDistMargin(oe,ye,he,Ve)&&oe.children.sort(Ne)},u.prototype._allDistMargin=function(oe,ye,he,Ne){oe.children.sort(Ne);for(var Ve=this.toBBox,de=o(oe,0,ye,Ve),j=o(oe,he-ye,he,Ve),D=M(de)+M(j),$=ye;$<he-ye;$++){var z=oe.children[$];w(de,oe.leaf?Ve(z):z),D+=M(de)}for(var W=he-ye-1;W>=ye;W--){var Z=oe.children[W];w(j,oe.leaf?Ve(Z):Z),D+=M(j)}return D},u.prototype._adjustParentBBoxes=function(oe,ye,he){for(var Ne=he;Ne>=0;Ne--)w(ye[Ne],oe)},u.prototype._condense=function(oe){for(var ye=oe.length-1,he=void 0;ye>=0;ye--)oe[ye].children.length===0?ye>0?(he=oe[ye-1].children).splice(he.indexOf(oe[ye]),1):this.clear():_(oe[ye],this.toBBox)},u})})(q1)),q1.exports}class Ez{constructor(e=[],t=Az){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,c=t[e];for(;e>0;){const u=e-1>>1,m=t[u];if(i(c,m)>=0)break;t[e]=m,e=u}t[e]=c}_down(e){const{data:t,compare:i}=this,c=this.length>>1,u=t[e];for(;e<c;){let m=(e<<1)+1,_=t[m];const o=m+1;if(o<this.length&&i(t[o],_)<0&&(m=o,_=t[o]),i(_,u)>=0)break;t[e]=_,e=m}t[e]=u}}function Az(n,e){return n<e?-1:n>e?1:0}const Tz=Object.freeze(Object.defineProperty({__proto__:null,default:Ez},Symbol.toStringTag,{value:"Module"})),Iz=JC(Tz);var fy={exports:{}},Mb,ZE;function Cz(){return ZE||(ZE=1,Mb=function(e,t,i,c){var u=e[0],m=e[1],_=!1;i===void 0&&(i=0),c===void 0&&(c=t.length);for(var o=(c-i)/2,w=0,I=o-1;w<o;I=w++){var O=t[i+w*2+0],V=t[i+w*2+1],M=t[i+I*2+0],se=t[i+I*2+1],ce=V>m!=se>m&&u<(M-O)*(m-V)/(se-V)+O;ce&&(_=!_)}return _}),Mb}var Rb,YE;function Lz(){return YE||(YE=1,Rb=function(e,t,i,c){var u=e[0],m=e[1],_=!1;i===void 0&&(i=0),c===void 0&&(c=t.length);for(var o=c-i,w=0,I=o-1;w<o;I=w++){var O=t[w+i][0],V=t[w+i][1],M=t[I+i][0],se=t[I+i][1],ce=V>m!=se>m&&u<(M-O)*(m-V)/(se-V)+O;ce&&(_=!_)}return _}),Rb}var JE;function Pz(){if(JE)return fy.exports;JE=1;var n=Cz(),e=Lz();return fy.exports=function(i,c,u,m){return c.length>0&&Array.isArray(c[0])?e(i,c,u,m):n(i,c,u,m)},fy.exports.nested=e,fy.exports.flat=n,fy.exports}var wy={exports:{}},kz=wy.exports,QE;function Mz(){return QE||(QE=1,(function(n,e){(function(t,i){i(e)})(kz,function(t){const c=33306690738754706e-32;function u(ce,fe,ne,oe,ye){let he,Ne,Ve,de,j=fe[0],D=oe[0],$=0,z=0;D>j==D>-j?(he=j,j=fe[++$]):(he=D,D=oe[++z]);let W=0;if($<ce&&z<ne)for(D>j==D>-j?(Ve=he-((Ne=j+he)-j),j=fe[++$]):(Ve=he-((Ne=D+he)-D),D=oe[++z]),he=Ne,Ve!==0&&(ye[W++]=Ve);$<ce&&z<ne;)D>j==D>-j?(Ve=he-((Ne=he+j)-(de=Ne-he))+(j-de),j=fe[++$]):(Ve=he-((Ne=he+D)-(de=Ne-he))+(D-de),D=oe[++z]),he=Ne,Ve!==0&&(ye[W++]=Ve);for(;$<ce;)Ve=he-((Ne=he+j)-(de=Ne-he))+(j-de),j=fe[++$],he=Ne,Ve!==0&&(ye[W++]=Ve);for(;z<ne;)Ve=he-((Ne=he+D)-(de=Ne-he))+(D-de),D=oe[++z],he=Ne,Ve!==0&&(ye[W++]=Ve);return he===0&&W!==0||(ye[W++]=he),W}function m(ce){return new Float64Array(ce)}const _=33306690738754716e-32,o=22204460492503146e-32,w=11093356479670487e-47,I=m(4),O=m(8),V=m(12),M=m(16),se=m(4);t.orient2d=function(ce,fe,ne,oe,ye,he){const Ne=(fe-he)*(ne-ye),Ve=(ce-ye)*(oe-he),de=Ne-Ve;if(Ne===0||Ve===0||Ne>0!=Ve>0)return de;const j=Math.abs(Ne+Ve);return Math.abs(de)>=_*j?de:-(function(D,$,z,W,Z,Ee,ke){let Oe,Re,be,De,Qe,xe,ae,Me,Fe,Ze,et,mt,ht,Nt,Jt,tn,fn,An;const zt=D-Z,it=z-Z,ur=$-Ee,xr=W-Ee;Qe=(Jt=(Me=zt-(ae=(xe=134217729*zt)-(xe-zt)))*(Ze=xr-(Fe=(xe=134217729*xr)-(xe-xr)))-((Nt=zt*xr)-ae*Fe-Me*Fe-ae*Ze))-(et=Jt-(fn=(Me=ur-(ae=(xe=134217729*ur)-(xe-ur)))*(Ze=it-(Fe=(xe=134217729*it)-(xe-it)))-((tn=ur*it)-ae*Fe-Me*Fe-ae*Ze))),I[0]=Jt-(et+Qe)+(Qe-fn),Qe=(ht=Nt-((mt=Nt+et)-(Qe=mt-Nt))+(et-Qe))-(et=ht-tn),I[1]=ht-(et+Qe)+(Qe-tn),Qe=(An=mt+et)-mt,I[2]=mt-(An-Qe)+(et-Qe),I[3]=An;let Tr=(function(Wt,Nn){let tr=Nn[0];for(let Hn=1;Hn<Wt;Hn++)tr+=Nn[Hn];return tr})(4,I),Tn=o*ke;if(Tr>=Tn||-Tr>=Tn||(Oe=D-(zt+(Qe=D-zt))+(Qe-Z),be=z-(it+(Qe=z-it))+(Qe-Z),Re=$-(ur+(Qe=$-ur))+(Qe-Ee),De=W-(xr+(Qe=W-xr))+(Qe-Ee),Oe===0&&Re===0&&be===0&&De===0)||(Tn=w*ke+c*Math.abs(Tr),(Tr+=zt*De+xr*Oe-(ur*be+it*Re))>=Tn||-Tr>=Tn))return Tr;Qe=(Jt=(Me=Oe-(ae=(xe=134217729*Oe)-(xe-Oe)))*(Ze=xr-(Fe=(xe=134217729*xr)-(xe-xr)))-((Nt=Oe*xr)-ae*Fe-Me*Fe-ae*Ze))-(et=Jt-(fn=(Me=Re-(ae=(xe=134217729*Re)-(xe-Re)))*(Ze=it-(Fe=(xe=134217729*it)-(xe-it)))-((tn=Re*it)-ae*Fe-Me*Fe-ae*Ze))),se[0]=Jt-(et+Qe)+(Qe-fn),Qe=(ht=Nt-((mt=Nt+et)-(Qe=mt-Nt))+(et-Qe))-(et=ht-tn),se[1]=ht-(et+Qe)+(Qe-tn),Qe=(An=mt+et)-mt,se[2]=mt-(An-Qe)+(et-Qe),se[3]=An;const Yn=u(4,I,4,se,O);Qe=(Jt=(Me=zt-(ae=(xe=134217729*zt)-(xe-zt)))*(Ze=De-(Fe=(xe=134217729*De)-(xe-De)))-((Nt=zt*De)-ae*Fe-Me*Fe-ae*Ze))-(et=Jt-(fn=(Me=ur-(ae=(xe=134217729*ur)-(xe-ur)))*(Ze=be-(Fe=(xe=134217729*be)-(xe-be)))-((tn=ur*be)-ae*Fe-Me*Fe-ae*Ze))),se[0]=Jt-(et+Qe)+(Qe-fn),Qe=(ht=Nt-((mt=Nt+et)-(Qe=mt-Nt))+(et-Qe))-(et=ht-tn),se[1]=ht-(et+Qe)+(Qe-tn),Qe=(An=mt+et)-mt,se[2]=mt-(An-Qe)+(et-Qe),se[3]=An;const $n=u(Yn,O,4,se,V);Qe=(Jt=(Me=Oe-(ae=(xe=134217729*Oe)-(xe-Oe)))*(Ze=De-(Fe=(xe=134217729*De)-(xe-De)))-((Nt=Oe*De)-ae*Fe-Me*Fe-ae*Ze))-(et=Jt-(fn=(Me=Re-(ae=(xe=134217729*Re)-(xe-Re)))*(Ze=be-(Fe=(xe=134217729*be)-(xe-be)))-((tn=Re*be)-ae*Fe-Me*Fe-ae*Ze))),se[0]=Jt-(et+Qe)+(Qe-fn),Qe=(ht=Nt-((mt=Nt+et)-(Qe=mt-Nt))+(et-Qe))-(et=ht-tn),se[1]=ht-(et+Qe)+(Qe-tn),Qe=(An=mt+et)-mt,se[2]=mt-(An-Qe)+(et-Qe),se[3]=An;const hr=u($n,V,4,se,M);return M[hr-1]})(ce,fe,ne,oe,ye,he,j)},t.orient2dfast=function(ce,fe,ne,oe,ye,he){return(fe-he)*(ne-ye)-(ce-ye)*(oe-he)},Object.defineProperty(t,"__esModule",{value:!0})})})(wy,wy.exports)),wy.exports}var eA;function Rz(){if(eA)return m1.exports;eA=1;var n=Sz(),e=Iz,t=Pz(),i=Mz().orient2d;e.default&&(e=e.default),m1.exports=c,m1.exports.default=c;function c(he,Ne,Ve){Ne=Math.max(0,Ne===void 0?2:Ne),Ve=Ve||0;var de=M(he),j=new n(16);j.toBBox=function(ae){return{minX:ae[0],minY:ae[1],maxX:ae[0],maxY:ae[1]}},j.compareMinX=function(ae,Me){return ae[0]-Me[0]},j.compareMinY=function(ae,Me){return ae[1]-Me[1]},j.load(he);for(var D=[],$=0,z;$<de.length;$++){var W=de[$];j.remove(W),z=se(W,z),D.push(z)}var Z=new n(16);for($=0;$<D.length;$++)Z.insert(V(D[$]));for(var Ee=Ne*Ne,ke=Ve*Ve;D.length;){var Oe=D.shift(),Re=Oe.p,be=Oe.next.p,De=ce(Re,be);if(!(De<ke)){var Qe=De/Ee;W=u(j,Oe.prev.p,Re,be,Oe.next.next.p,Qe,Z),W&&Math.min(ce(W,Re),ce(W,be))<=Qe&&(D.push(Oe),D.push(se(W,Oe)),j.remove(W),Z.remove(Oe),Z.insert(V(Oe)),Z.insert(V(Oe.next)))}}Oe=z;var xe=[];do xe.push(Oe.p),Oe=Oe.next;while(Oe!==z);return xe.push(Oe.p),xe}function u(he,Ne,Ve,de,j,D,$){for(var z=new e([],m),W=he.data;W;){for(var Z=0;Z<W.children.length;Z++){var Ee=W.children[Z],ke=W.leaf?fe(Ee,Ve,de):_(Ve,de,Ee);ke>D||z.push({node:Ee,dist:ke})}for(;z.length&&!z.peek().node.children;){var Oe=z.pop(),Re=Oe.node,be=fe(Re,Ne,Ve),De=fe(Re,de,j);if(Oe.dist<be&&Oe.dist<De&&w(Ve,Re,$)&&w(de,Re,$))return Re}W=z.pop(),W&&(W=W.node)}return null}function m(he,Ne){return he.dist-Ne.dist}function _(he,Ne,Ve){if(o(he,Ve)||o(Ne,Ve))return 0;var de=ne(he[0],he[1],Ne[0],Ne[1],Ve.minX,Ve.minY,Ve.maxX,Ve.minY);if(de===0)return 0;var j=ne(he[0],he[1],Ne[0],Ne[1],Ve.minX,Ve.minY,Ve.minX,Ve.maxY);if(j===0)return 0;var D=ne(he[0],he[1],Ne[0],Ne[1],Ve.maxX,Ve.minY,Ve.maxX,Ve.maxY);if(D===0)return 0;var $=ne(he[0],he[1],Ne[0],Ne[1],Ve.minX,Ve.maxY,Ve.maxX,Ve.maxY);return $===0?0:Math.min(de,j,D,$)}function o(he,Ne){return he[0]>=Ne.minX&&he[0]<=Ne.maxX&&he[1]>=Ne.minY&&he[1]<=Ne.maxY}function w(he,Ne,Ve){for(var de=Math.min(he[0],Ne[0]),j=Math.min(he[1],Ne[1]),D=Math.max(he[0],Ne[0]),$=Math.max(he[1],Ne[1]),z=Ve.search({minX:de,minY:j,maxX:D,maxY:$}),W=0;W<z.length;W++)if(O(z[W].p,z[W].next.p,he,Ne))return!1;return!0}function I(he,Ne,Ve){return i(he[0],he[1],Ne[0],Ne[1],Ve[0],Ve[1])}function O(he,Ne,Ve,de){return he!==de&&Ne!==Ve&&I(he,Ne,Ve)>0!=I(he,Ne,de)>0&&I(Ve,de,he)>0!=I(Ve,de,Ne)>0}function V(he){var Ne=he.p,Ve=he.next.p;return he.minX=Math.min(Ne[0],Ve[0]),he.minY=Math.min(Ne[1],Ve[1]),he.maxX=Math.max(Ne[0],Ve[0]),he.maxY=Math.max(Ne[1],Ve[1]),he}function M(he){for(var Ne=he[0],Ve=he[0],de=he[0],j=he[0],D=0;D<he.length;D++){var $=he[D];$[0]<Ne[0]&&(Ne=$),$[0]>de[0]&&(de=$),$[1]<Ve[1]&&(Ve=$),$[1]>j[1]&&(j=$)}var z=[Ne,Ve,de,j],W=z.slice();for(D=0;D<he.length;D++)t(he[D],z)||W.push(he[D]);return ye(W)}function se(he,Ne){var Ve={p:he,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return Ne?(Ve.next=Ne.next,Ve.prev=Ne,Ne.next.prev=Ve,Ne.next=Ve):(Ve.prev=Ve,Ve.next=Ve),Ve}function ce(he,Ne){var Ve=he[0]-Ne[0],de=he[1]-Ne[1];return Ve*Ve+de*de}function fe(he,Ne,Ve){var de=Ne[0],j=Ne[1],D=Ve[0]-de,$=Ve[1]-j;if(D!==0||$!==0){var z=((he[0]-de)*D+(he[1]-j)*$)/(D*D+$*$);z>1?(de=Ve[0],j=Ve[1]):z>0&&(de+=D*z,j+=$*z)}return D=he[0]-de,$=he[1]-j,D*D+$*$}function ne(he,Ne,Ve,de,j,D,$,z){var W=Ve-he,Z=de-Ne,Ee=$-j,ke=z-D,Oe=he-j,Re=Ne-D,be=W*W+Z*Z,De=W*Ee+Z*ke,Qe=Ee*Ee+ke*ke,xe=W*Oe+Z*Re,ae=Ee*Oe+ke*Re,Me=be*Qe-De*De,Fe,Ze,et,mt,ht=Me,Nt=Me;Me===0?(Ze=0,ht=1,mt=ae,Nt=Qe):(Ze=De*ae-Qe*xe,mt=be*ae-De*xe,Ze<0?(Ze=0,mt=ae,Nt=Qe):Ze>ht&&(Ze=ht,mt=ae+De,Nt=Qe)),mt<0?(mt=0,-xe<0?Ze=0:-xe>be?Ze=ht:(Ze=-xe,ht=be)):mt>Nt&&(mt=Nt,-xe+De<0?Ze=0:-xe+De>be?Ze=ht:(Ze=-xe+De,ht=be)),Fe=Ze===0?0:Ze/ht,et=mt===0?0:mt/Nt;var Jt=(1-Fe)*he+Fe*Ve,tn=(1-Fe)*Ne+Fe*de,fn=(1-et)*j+et*$,An=(1-et)*D+et*z,zt=fn-Jt,it=An-tn;return zt*zt+it*it}function oe(he,Ne){return he[0]===Ne[0]?he[1]-Ne[1]:he[0]-Ne[0]}function ye(he){he.sort(oe);for(var Ne=[],Ve=0;Ve<he.length;Ve++){for(;Ne.length>=2&&I(Ne[Ne.length-2],Ne[Ne.length-1],he[Ve])<=0;)Ne.pop();Ne.push(he[Ve])}for(var de=[],j=he.length-1;j>=0;j--){for(;de.length>=2&&I(de[de.length-2],de[de.length-1],he[j])<=0;)de.pop();de.push(he[j])}return de.pop(),Ne.pop(),Ne.concat(de)}return m1.exports}var Nz=Rz();const Dz=Dv(Nz);function Fz(n,e={}){e.concavity=e.concavity||1/0;const t=[];if(ng(n,c=>{t.push([c[0],c[1]])}),!t.length)return null;const i=Dz(t,e.concavity);return i.length>3?r3([i]):null}function a3(n){if(!n)throw new Error("geojson is required");switch(n.type){case"Feature":return MI(n);case"FeatureCollection":return Oz(n);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return l3(n);default:throw new Error("unknown GeoJSON type")}}function MI(n){const e={type:"Feature"};return Object.keys(n).forEach(t=>{switch(t){case"type":case"properties":case"geometry":return;default:e[t]=n[t]}}),e.properties=RI(n.properties),n.geometry==null?e.geometry=null:e.geometry=l3(n.geometry),e}function RI(n){const e={};return n&&Object.keys(n).forEach(t=>{const i=n[t];typeof i=="object"?i===null?e[t]=null:Array.isArray(i)?e[t]=i.map(c=>c):e[t]=RI(i):e[t]=i}),e}function Oz(n){const e={type:"FeatureCollection"};return Object.keys(n).forEach(t=>{switch(t){case"type":case"features":return;default:e[t]=n[t]}}),e.features=n.features.map(t=>MI(t)),e}function l3(n){const e={type:n.type};return n.bbox&&(e.bbox=n.bbox),n.type==="GeometryCollection"?(e.geometries=n.geometries.map(t=>l3(t)),e):(e.coordinates=NI(n.coordinates),e)}function NI(n){const e=n;return typeof e[0]!="object"?e.slice():e.map(t=>NI(t))}var Bz=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Nb=Math.ceil,vd=Math.floor,zh="[BigNumber Error] ",tA=zh+"Number primitive has more than 15 significant digits: ",jd=1e14,Po=14,Db=9007199254740991,Fb=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Op=1e7,bu=1e9;function DI(n){var e,t,i,c=oe.prototype={constructor:oe,toString:null,valueOf:null},u=new oe(1),m=20,_=4,o=-7,w=21,I=-1e7,O=1e7,V=!1,M=1,se=0,ce={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},fe="0123456789abcdefghijklmnopqrstuvwxyz",ne=!0;function oe(j,D){var $,z,W,Z,Ee,ke,Oe,Re,be=this;if(!(be instanceof oe))return new oe(j,D);if(D==null){if(j&&j._isBigNumber===!0){be.s=j.s,!j.c||j.e>O?be.c=be.e=null:j.e<I?be.c=[be.e=0]:(be.e=j.e,be.c=j.c.slice());return}if((ke=typeof j=="number")&&j*0==0){if(be.s=1/j<0?(j=-j,-1):1,j===~~j){for(Z=0,Ee=j;Ee>=10;Ee/=10,Z++);Z>O?be.c=be.e=null:(be.e=Z,be.c=[j]);return}Re=String(j)}else{if(!Bz.test(Re=String(j)))return i(be,Re,ke);be.s=Re.charCodeAt(0)==45?(Re=Re.slice(1),-1):1}(Z=Re.indexOf("."))>-1&&(Re=Re.replace(".","")),(Ee=Re.search(/e/i))>0?(Z<0&&(Z=Ee),Z+=+Re.slice(Ee+1),Re=Re.substring(0,Ee)):Z<0&&(Z=Re.length)}else{if(Dl(D,2,fe.length,"Base"),D==10&&ne)return be=new oe(j),Ve(be,m+be.e+1,_);if(Re=String(j),ke=typeof j=="number"){if(j*0!=0)return i(be,Re,ke,D);if(be.s=1/j<0?(Re=Re.slice(1),-1):1,oe.DEBUG&&Re.replace(/^0\.0*|\./,"").length>15)throw Error(tA+j)}else be.s=Re.charCodeAt(0)===45?(Re=Re.slice(1),-1):1;for($=fe.slice(0,D),Z=Ee=0,Oe=Re.length;Ee<Oe;Ee++)if($.indexOf(z=Re.charAt(Ee))<0){if(z=="."){if(Ee>Z){Z=Oe;continue}}else if(!W&&(Re==Re.toUpperCase()&&(Re=Re.toLowerCase())||Re==Re.toLowerCase()&&(Re=Re.toUpperCase()))){W=!0,Ee=-1,Z=0;continue}return i(be,String(j),ke,D)}ke=!1,Re=t(Re,D,10,be.s),(Z=Re.indexOf("."))>-1?Re=Re.replace(".",""):Z=Re.length}for(Ee=0;Re.charCodeAt(Ee)===48;Ee++);for(Oe=Re.length;Re.charCodeAt(--Oe)===48;);if(Re=Re.slice(Ee,++Oe)){if(Oe-=Ee,ke&&oe.DEBUG&&Oe>15&&(j>Db||j!==vd(j)))throw Error(tA+be.s*j);if((Z=Z-Ee-1)>O)be.c=be.e=null;else if(Z<I)be.c=[be.e=0];else{if(be.e=Z,be.c=[],Ee=(Z+1)%Po,Z<0&&(Ee+=Po),Ee<Oe){for(Ee&&be.c.push(+Re.slice(0,Ee)),Oe-=Po;Ee<Oe;)be.c.push(+Re.slice(Ee,Ee+=Po));Ee=Po-(Re=Re.slice(Ee)).length}else Ee-=Oe;for(;Ee--;Re+="0");be.c.push(+Re)}}else be.c=[be.e=0]}oe.clone=DI,oe.ROUND_UP=0,oe.ROUND_DOWN=1,oe.ROUND_CEIL=2,oe.ROUND_FLOOR=3,oe.ROUND_HALF_UP=4,oe.ROUND_HALF_DOWN=5,oe.ROUND_HALF_EVEN=6,oe.ROUND_HALF_CEIL=7,oe.ROUND_HALF_FLOOR=8,oe.EUCLID=9,oe.config=oe.set=function(j){var D,$;if(j!=null)if(typeof j=="object"){if(j.hasOwnProperty(D="DECIMAL_PLACES")&&($=j[D],Dl($,0,bu,D),m=$),j.hasOwnProperty(D="ROUNDING_MODE")&&($=j[D],Dl($,0,8,D),_=$),j.hasOwnProperty(D="EXPONENTIAL_AT")&&($=j[D],$&&$.pop?(Dl($[0],-bu,0,D),Dl($[1],0,bu,D),o=$[0],w=$[1]):(Dl($,-bu,bu,D),o=-(w=$<0?-$:$))),j.hasOwnProperty(D="RANGE"))if($=j[D],$&&$.pop)Dl($[0],-bu,-1,D),Dl($[1],1,bu,D),I=$[0],O=$[1];else if(Dl($,-bu,bu,D),$)I=-(O=$<0?-$:$);else throw Error(zh+D+" cannot be zero: "+$);if(j.hasOwnProperty(D="CRYPTO"))if($=j[D],$===!!$)if($)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))V=$;else throw V=!$,Error(zh+"crypto unavailable");else V=$;else throw Error(zh+D+" not true or false: "+$);if(j.hasOwnProperty(D="MODULO_MODE")&&($=j[D],Dl($,0,9,D),M=$),j.hasOwnProperty(D="POW_PRECISION")&&($=j[D],Dl($,0,bu,D),se=$),j.hasOwnProperty(D="FORMAT"))if($=j[D],typeof $=="object")ce=$;else throw Error(zh+D+" not an object: "+$);if(j.hasOwnProperty(D="ALPHABET"))if($=j[D],typeof $=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test($))ne=$.slice(0,10)=="0123456789",fe=$;else throw Error(zh+D+" invalid: "+$)}else throw Error(zh+"Object expected: "+j);return{DECIMAL_PLACES:m,ROUNDING_MODE:_,EXPONENTIAL_AT:[o,w],RANGE:[I,O],CRYPTO:V,MODULO_MODE:M,POW_PRECISION:se,FORMAT:ce,ALPHABET:fe}},oe.isBigNumber=function(j){if(!j||j._isBigNumber!==!0)return!1;if(!oe.DEBUG)return!0;var D,$,z=j.c,W=j.e,Z=j.s;e:if({}.toString.call(z)=="[object Array]"){if((Z===1||Z===-1)&&W>=-bu&&W<=bu&&W===vd(W)){if(z[0]===0){if(W===0&&z.length===1)return!0;break e}if(D=(W+1)%Po,D<1&&(D+=Po),String(z[0]).length==D){for(D=0;D<z.length;D++)if($=z[D],$<0||$>=jd||$!==vd($))break e;if($!==0)return!0}}}else if(z===null&&W===null&&(Z===null||Z===1||Z===-1))return!0;throw Error(zh+"Invalid BigNumber: "+j)},oe.maximum=oe.max=function(){return he(arguments,-1)},oe.minimum=oe.min=function(){return he(arguments,1)},oe.random=(function(){var j=9007199254740992,D=Math.random()*j&2097151?function(){return vd(Math.random()*j)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function($){var z,W,Z,Ee,ke,Oe=0,Re=[],be=new oe(u);if($==null?$=m:Dl($,0,bu),Ee=Nb($/Po),V)if(crypto.getRandomValues){for(z=crypto.getRandomValues(new Uint32Array(Ee*=2));Oe<Ee;)ke=z[Oe]*131072+(z[Oe+1]>>>11),ke>=9e15?(W=crypto.getRandomValues(new Uint32Array(2)),z[Oe]=W[0],z[Oe+1]=W[1]):(Re.push(ke%1e14),Oe+=2);Oe=Ee/2}else if(crypto.randomBytes){for(z=crypto.randomBytes(Ee*=7);Oe<Ee;)ke=(z[Oe]&31)*281474976710656+z[Oe+1]*1099511627776+z[Oe+2]*4294967296+z[Oe+3]*16777216+(z[Oe+4]<<16)+(z[Oe+5]<<8)+z[Oe+6],ke>=9e15?crypto.randomBytes(7).copy(z,Oe):(Re.push(ke%1e14),Oe+=7);Oe=Ee/7}else throw V=!1,Error(zh+"crypto unavailable");if(!V)for(;Oe<Ee;)ke=D(),ke<9e15&&(Re[Oe++]=ke%1e14);for(Ee=Re[--Oe],$%=Po,Ee&&$&&(ke=Fb[Po-$],Re[Oe]=vd(Ee/ke)*ke);Re[Oe]===0;Re.pop(),Oe--);if(Oe<0)Re=[Z=0];else{for(Z=-1;Re[0]===0;Re.splice(0,1),Z-=Po);for(Oe=1,ke=Re[0];ke>=10;ke/=10,Oe++);Oe<Po&&(Z-=Po-Oe)}return be.e=Z,be.c=Re,be}})(),oe.sum=function(){for(var j=1,D=arguments,$=new oe(D[0]);j<D.length;)$=$.plus(D[j++]);return $},t=(function(){var j="0123456789";function D($,z,W,Z){for(var Ee,ke=[0],Oe,Re=0,be=$.length;Re<be;){for(Oe=ke.length;Oe--;ke[Oe]*=z);for(ke[0]+=Z.indexOf($.charAt(Re++)),Ee=0;Ee<ke.length;Ee++)ke[Ee]>W-1&&(ke[Ee+1]==null&&(ke[Ee+1]=0),ke[Ee+1]+=ke[Ee]/W|0,ke[Ee]%=W)}return ke.reverse()}return function($,z,W,Z,Ee){var ke,Oe,Re,be,De,Qe,xe,ae,Me=$.indexOf("."),Fe=m,Ze=_;for(Me>=0&&(be=se,se=0,$=$.replace(".",""),ae=new oe(z),Qe=ae.pow($.length-Me),se=be,ae.c=D(Jf(_d(Qe.c),Qe.e,"0"),10,W,j),ae.e=ae.c.length),xe=D($,z,W,Ee?(ke=fe,j):(ke=j,fe)),Re=be=xe.length;xe[--be]==0;xe.pop());if(!xe[0])return ke.charAt(0);if(Me<0?--Re:(Qe.c=xe,Qe.e=Re,Qe.s=Z,Qe=e(Qe,ae,Fe,Ze,W),xe=Qe.c,De=Qe.r,Re=Qe.e),Oe=Re+Fe+1,Me=xe[Oe],be=W/2,De=De||Oe<0||xe[Oe+1]!=null,De=Ze<4?(Me!=null||De)&&(Ze==0||Ze==(Qe.s<0?3:2)):Me>be||Me==be&&(Ze==4||De||Ze==6&&xe[Oe-1]&1||Ze==(Qe.s<0?8:7)),Oe<1||!xe[0])$=De?Jf(ke.charAt(1),-Fe,ke.charAt(0)):ke.charAt(0);else{if(xe.length=Oe,De)for(--W;++xe[--Oe]>W;)xe[Oe]=0,Oe||(++Re,xe=[1].concat(xe));for(be=xe.length;!xe[--be];);for(Me=0,$="";Me<=be;$+=ke.charAt(xe[Me++]));$=Jf($,Re,ke.charAt(0))}return $}})(),e=(function(){function j(z,W,Z){var Ee,ke,Oe,Re,be=0,De=z.length,Qe=W%Op,xe=W/Op|0;for(z=z.slice();De--;)Oe=z[De]%Op,Re=z[De]/Op|0,Ee=xe*Oe+Re*Qe,ke=Qe*Oe+Ee%Op*Op+be,be=(ke/Z|0)+(Ee/Op|0)+xe*Re,z[De]=ke%Z;return be&&(z=[be].concat(z)),z}function D(z,W,Z,Ee){var ke,Oe;if(Z!=Ee)Oe=Z>Ee?1:-1;else for(ke=Oe=0;ke<Z;ke++)if(z[ke]!=W[ke]){Oe=z[ke]>W[ke]?1:-1;break}return Oe}function $(z,W,Z,Ee){for(var ke=0;Z--;)z[Z]-=ke,ke=z[Z]<W[Z]?1:0,z[Z]=ke*Ee+z[Z]-W[Z];for(;!z[0]&&z.length>1;z.splice(0,1));}return function(z,W,Z,Ee,ke){var Oe,Re,be,De,Qe,xe,ae,Me,Fe,Ze,et,mt,ht,Nt,Jt,tn,fn,An=z.s==W.s?1:-1,zt=z.c,it=W.c;if(!zt||!zt[0]||!it||!it[0])return new oe(!z.s||!W.s||(zt?it&&zt[0]==it[0]:!it)?NaN:zt&&zt[0]==0||!it?An*0:An/0);for(Me=new oe(An),Fe=Me.c=[],Re=z.e-W.e,An=Z+Re+1,ke||(ke=jd,Re=xd(z.e/Po)-xd(W.e/Po),An=An/Po|0),be=0;it[be]==(zt[be]||0);be++);if(it[be]>(zt[be]||0)&&Re--,An<0)Fe.push(1),De=!0;else{for(Nt=zt.length,tn=it.length,be=0,An+=2,Qe=vd(ke/(it[0]+1)),Qe>1&&(it=j(it,Qe,ke),zt=j(zt,Qe,ke),tn=it.length,Nt=zt.length),ht=tn,Ze=zt.slice(0,tn),et=Ze.length;et<tn;Ze[et++]=0);fn=it.slice(),fn=[0].concat(fn),Jt=it[0],it[1]>=ke/2&&Jt++;do{if(Qe=0,Oe=D(it,Ze,tn,et),Oe<0){if(mt=Ze[0],tn!=et&&(mt=mt*ke+(Ze[1]||0)),Qe=vd(mt/Jt),Qe>1)for(Qe>=ke&&(Qe=ke-1),xe=j(it,Qe,ke),ae=xe.length,et=Ze.length;D(xe,Ze,ae,et)==1;)Qe--,$(xe,tn<ae?fn:it,ae,ke),ae=xe.length,Oe=1;else Qe==0&&(Oe=Qe=1),xe=it.slice(),ae=xe.length;if(ae<et&&(xe=[0].concat(xe)),$(Ze,xe,et,ke),et=Ze.length,Oe==-1)for(;D(it,Ze,tn,et)<1;)Qe++,$(Ze,tn<et?fn:it,et,ke),et=Ze.length}else Oe===0&&(Qe++,Ze=[0]);Fe[be++]=Qe,Ze[0]?Ze[et++]=zt[ht]||0:(Ze=[zt[ht]],et=1)}while((ht++<Nt||Ze[0]!=null)&&An--);De=Ze[0]!=null,Fe[0]||Fe.splice(0,1)}if(ke==jd){for(be=1,An=Fe[0];An>=10;An/=10,be++);Ve(Me,Z+(Me.e=be+Re*Po-1)+1,Ee,De)}else Me.e=Re,Me.r=+De;return Me}})();function ye(j,D,$,z){var W,Z,Ee,ke,Oe;if($==null?$=_:Dl($,0,8),!j.c)return j.toString();if(W=j.c[0],Ee=j.e,D==null)Oe=_d(j.c),Oe=z==1||z==2&&(Ee<=o||Ee>=w)?y1(Oe,Ee):Jf(Oe,Ee,"0");else if(j=Ve(new oe(j),D,$),Z=j.e,Oe=_d(j.c),ke=Oe.length,z==1||z==2&&(D<=Z||Z<=o)){for(;ke<D;Oe+="0",ke++);Oe=y1(Oe,Z)}else if(D-=Ee+(z===2&&Z>Ee),Oe=Jf(Oe,Z,"0"),Z+1>ke){if(--D>0)for(Oe+=".";D--;Oe+="0");}else if(D+=Z-ke,D>0)for(Z+1==ke&&(Oe+=".");D--;Oe+="0");return j.s<0&&W?"-"+Oe:Oe}function he(j,D){for(var $,z,W=1,Z=new oe(j[0]);W<j.length;W++)z=new oe(j[W]),(!z.s||($=Am(Z,z))===D||$===0&&Z.s===D)&&(Z=z);return Z}function Ne(j,D,$){for(var z=1,W=D.length;!D[--W];D.pop());for(W=D[0];W>=10;W/=10,z++);return($=z+$*Po-1)>O?j.c=j.e=null:$<I?j.c=[j.e=0]:(j.e=$,j.c=D),j}i=(function(){var j=/^(-?)0([xbo])(?=\w[\w.]*$)/i,D=/^([^.]+)\.$/,$=/^\.([^.]+)$/,z=/^-?(Infinity|NaN)$/,W=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(Z,Ee,ke,Oe){var Re,be=ke?Ee:Ee.replace(W,"");if(z.test(be))Z.s=isNaN(be)?null:be<0?-1:1;else{if(!ke&&(be=be.replace(j,function(De,Qe,xe){return Re=(xe=xe.toLowerCase())=="x"?16:xe=="b"?2:8,!Oe||Oe==Re?Qe:De}),Oe&&(Re=Oe,be=be.replace(D,"$1").replace($,"0.$1")),Ee!=be))return new oe(be,Re);if(oe.DEBUG)throw Error(zh+"Not a"+(Oe?" base "+Oe:"")+" number: "+Ee);Z.s=null}Z.c=Z.e=null}})();function Ve(j,D,$,z){var W,Z,Ee,ke,Oe,Re,be,De=j.c,Qe=Fb;if(De){e:{for(W=1,ke=De[0];ke>=10;ke/=10,W++);if(Z=D-W,Z<0)Z+=Po,Ee=D,Oe=De[Re=0],be=vd(Oe/Qe[W-Ee-1]%10);else if(Re=Nb((Z+1)/Po),Re>=De.length)if(z){for(;De.length<=Re;De.push(0));Oe=be=0,W=1,Z%=Po,Ee=Z-Po+1}else break e;else{for(Oe=ke=De[Re],W=1;ke>=10;ke/=10,W++);Z%=Po,Ee=Z-Po+W,be=Ee<0?0:vd(Oe/Qe[W-Ee-1]%10)}if(z=z||D<0||De[Re+1]!=null||(Ee<0?Oe:Oe%Qe[W-Ee-1]),z=$<4?(be||z)&&($==0||$==(j.s<0?3:2)):be>5||be==5&&($==4||z||$==6&&(Z>0?Ee>0?Oe/Qe[W-Ee]:0:De[Re-1])%10&1||$==(j.s<0?8:7)),D<1||!De[0])return De.length=0,z?(D-=j.e+1,De[0]=Qe[(Po-D%Po)%Po],j.e=-D||0):De[0]=j.e=0,j;if(Z==0?(De.length=Re,ke=1,Re--):(De.length=Re+1,ke=Qe[Po-Z],De[Re]=Ee>0?vd(Oe/Qe[W-Ee]%Qe[Ee])*ke:0),z)for(;;)if(Re==0){for(Z=1,Ee=De[0];Ee>=10;Ee/=10,Z++);for(Ee=De[0]+=ke,ke=1;Ee>=10;Ee/=10,ke++);Z!=ke&&(j.e++,De[0]==jd&&(De[0]=1));break}else{if(De[Re]+=ke,De[Re]!=jd)break;De[Re--]=0,ke=1}for(Z=De.length;De[--Z]===0;De.pop());}j.e>O?j.c=j.e=null:j.e<I&&(j.c=[j.e=0])}return j}function de(j){var D,$=j.e;return $===null?j.toString():(D=_d(j.c),D=$<=o||$>=w?y1(D,$):Jf(D,$,"0"),j.s<0?"-"+D:D)}return c.absoluteValue=c.abs=function(){var j=new oe(this);return j.s<0&&(j.s=1),j},c.comparedTo=function(j,D){return Am(this,new oe(j,D))},c.decimalPlaces=c.dp=function(j,D){var $,z,W,Z=this;if(j!=null)return Dl(j,0,bu),D==null?D=_:Dl(D,0,8),Ve(new oe(Z),j+Z.e+1,D);if(!($=Z.c))return null;if(z=((W=$.length-1)-xd(this.e/Po))*Po,W=$[W])for(;W%10==0;W/=10,z--);return z<0&&(z=0),z},c.dividedBy=c.div=function(j,D){return e(this,new oe(j,D),m,_)},c.dividedToIntegerBy=c.idiv=function(j,D){return e(this,new oe(j,D),0,1)},c.exponentiatedBy=c.pow=function(j,D){var $,z,W,Z,Ee,ke,Oe,Re,be,De=this;if(j=new oe(j),j.c&&!j.isInteger())throw Error(zh+"Exponent not an integer: "+de(j));if(D!=null&&(D=new oe(D)),ke=j.e>14,!De.c||!De.c[0]||De.c[0]==1&&!De.e&&De.c.length==1||!j.c||!j.c[0])return be=new oe(Math.pow(+de(De),ke?j.s*(2-g1(j)):+de(j))),D?be.mod(D):be;if(Oe=j.s<0,D){if(D.c?!D.c[0]:!D.s)return new oe(NaN);z=!Oe&&De.isInteger()&&D.isInteger(),z&&(De=De.mod(D))}else{if(j.e>9&&(De.e>0||De.e<-1||(De.e==0?De.c[0]>1||ke&&De.c[1]>=24e7:De.c[0]<8e13||ke&&De.c[0]<=9999975e7)))return Z=De.s<0&&g1(j)?-0:0,De.e>-1&&(Z=1/Z),new oe(Oe?1/Z:Z);se&&(Z=Nb(se/Po+2))}for(ke?($=new oe(.5),Oe&&(j.s=1),Re=g1(j)):(W=Math.abs(+de(j)),Re=W%2),be=new oe(u);;){if(Re){if(be=be.times(De),!be.c)break;Z?be.c.length>Z&&(be.c.length=Z):z&&(be=be.mod(D))}if(W){if(W=vd(W/2),W===0)break;Re=W%2}else if(j=j.times($),Ve(j,j.e+1,1),j.e>14)Re=g1(j);else{if(W=+de(j),W===0)break;Re=W%2}De=De.times(De),Z?De.c&&De.c.length>Z&&(De.c.length=Z):z&&(De=De.mod(D))}return z?be:(Oe&&(be=u.div(be)),D?be.mod(D):Z?Ve(be,se,_,Ee):be)},c.integerValue=function(j){var D=new oe(this);return j==null?j=_:Dl(j,0,8),Ve(D,D.e+1,j)},c.isEqualTo=c.eq=function(j,D){return Am(this,new oe(j,D))===0},c.isFinite=function(){return!!this.c},c.isGreaterThan=c.gt=function(j,D){return Am(this,new oe(j,D))>0},c.isGreaterThanOrEqualTo=c.gte=function(j,D){return(D=Am(this,new oe(j,D)))===1||D===0},c.isInteger=function(){return!!this.c&&xd(this.e/Po)>this.c.length-2},c.isLessThan=c.lt=function(j,D){return Am(this,new oe(j,D))<0},c.isLessThanOrEqualTo=c.lte=function(j,D){return(D=Am(this,new oe(j,D)))===-1||D===0},c.isNaN=function(){return!this.s},c.isNegative=function(){return this.s<0},c.isPositive=function(){return this.s>0},c.isZero=function(){return!!this.c&&this.c[0]==0},c.minus=function(j,D){var $,z,W,Z,Ee=this,ke=Ee.s;if(j=new oe(j,D),D=j.s,!ke||!D)return new oe(NaN);if(ke!=D)return j.s=-D,Ee.plus(j);var Oe=Ee.e/Po,Re=j.e/Po,be=Ee.c,De=j.c;if(!Oe||!Re){if(!be||!De)return be?(j.s=-D,j):new oe(De?Ee:NaN);if(!be[0]||!De[0])return De[0]?(j.s=-D,j):new oe(be[0]?Ee:_==3?-0:0)}if(Oe=xd(Oe),Re=xd(Re),be=be.slice(),ke=Oe-Re){for((Z=ke<0)?(ke=-ke,W=be):(Re=Oe,W=De),W.reverse(),D=ke;D--;W.push(0));W.reverse()}else for(z=(Z=(ke=be.length)<(D=De.length))?ke:D,ke=D=0;D<z;D++)if(be[D]!=De[D]){Z=be[D]<De[D];break}if(Z&&(W=be,be=De,De=W,j.s=-j.s),D=(z=De.length)-($=be.length),D>0)for(;D--;be[$++]=0);for(D=jd-1;z>ke;){if(be[--z]<De[z]){for($=z;$&&!be[--$];be[$]=D);--be[$],be[z]+=jd}be[z]-=De[z]}for(;be[0]==0;be.splice(0,1),--Re);return be[0]?Ne(j,be,Re):(j.s=_==3?-1:1,j.c=[j.e=0],j)},c.modulo=c.mod=function(j,D){var $,z,W=this;return j=new oe(j,D),!W.c||!j.s||j.c&&!j.c[0]?new oe(NaN):!j.c||W.c&&!W.c[0]?new oe(W):(M==9?(z=j.s,j.s=1,$=e(W,j,0,3),j.s=z,$.s*=z):$=e(W,j,0,M),j=W.minus($.times(j)),!j.c[0]&&M==1&&(j.s=W.s),j)},c.multipliedBy=c.times=function(j,D){var $,z,W,Z,Ee,ke,Oe,Re,be,De,Qe,xe,ae,Me,Fe,Ze=this,et=Ze.c,mt=(j=new oe(j,D)).c;if(!et||!mt||!et[0]||!mt[0])return!Ze.s||!j.s||et&&!et[0]&&!mt||mt&&!mt[0]&&!et?j.c=j.e=j.s=null:(j.s*=Ze.s,!et||!mt?j.c=j.e=null:(j.c=[0],j.e=0)),j;for(z=xd(Ze.e/Po)+xd(j.e/Po),j.s*=Ze.s,Oe=et.length,De=mt.length,Oe<De&&(ae=et,et=mt,mt=ae,W=Oe,Oe=De,De=W),W=Oe+De,ae=[];W--;ae.push(0));for(Me=jd,Fe=Op,W=De;--W>=0;){for($=0,Qe=mt[W]%Fe,xe=mt[W]/Fe|0,Ee=Oe,Z=W+Ee;Z>W;)Re=et[--Ee]%Fe,be=et[Ee]/Fe|0,ke=xe*Re+be*Qe,Re=Qe*Re+ke%Fe*Fe+ae[Z]+$,$=(Re/Me|0)+(ke/Fe|0)+xe*be,ae[Z--]=Re%Me;ae[Z]=$}return $?++z:ae.splice(0,1),Ne(j,ae,z)},c.negated=function(){var j=new oe(this);return j.s=-j.s||null,j},c.plus=function(j,D){var $,z=this,W=z.s;if(j=new oe(j,D),D=j.s,!W||!D)return new oe(NaN);if(W!=D)return j.s=-D,z.minus(j);var Z=z.e/Po,Ee=j.e/Po,ke=z.c,Oe=j.c;if(!Z||!Ee){if(!ke||!Oe)return new oe(W/0);if(!ke[0]||!Oe[0])return Oe[0]?j:new oe(ke[0]?z:W*0)}if(Z=xd(Z),Ee=xd(Ee),ke=ke.slice(),W=Z-Ee){for(W>0?(Ee=Z,$=Oe):(W=-W,$=ke),$.reverse();W--;$.push(0));$.reverse()}for(W=ke.length,D=Oe.length,W-D<0&&($=Oe,Oe=ke,ke=$,D=W),W=0;D;)W=(ke[--D]=ke[D]+Oe[D]+W)/jd|0,ke[D]=jd===ke[D]?0:ke[D]%jd;return W&&(ke=[W].concat(ke),++Ee),Ne(j,ke,Ee)},c.precision=c.sd=function(j,D){var $,z,W,Z=this;if(j!=null&&j!==!!j)return Dl(j,1,bu),D==null?D=_:Dl(D,0,8),Ve(new oe(Z),j,D);if(!($=Z.c))return null;if(W=$.length-1,z=W*Po+1,W=$[W]){for(;W%10==0;W/=10,z--);for(W=$[0];W>=10;W/=10,z++);}return j&&Z.e+1>z&&(z=Z.e+1),z},c.shiftedBy=function(j){return Dl(j,-Db,Db),this.times("1e"+j)},c.squareRoot=c.sqrt=function(){var j,D,$,z,W,Z=this,Ee=Z.c,ke=Z.s,Oe=Z.e,Re=m+4,be=new oe("0.5");if(ke!==1||!Ee||!Ee[0])return new oe(!ke||ke<0&&(!Ee||Ee[0])?NaN:Ee?Z:1/0);if(ke=Math.sqrt(+de(Z)),ke==0||ke==1/0?(D=_d(Ee),(D.length+Oe)%2==0&&(D+="0"),ke=Math.sqrt(+D),Oe=xd((Oe+1)/2)-(Oe<0||Oe%2),ke==1/0?D="5e"+Oe:(D=ke.toExponential(),D=D.slice(0,D.indexOf("e")+1)+Oe),$=new oe(D)):$=new oe(ke+""),$.c[0]){for(Oe=$.e,ke=Oe+Re,ke<3&&(ke=0);;)if(W=$,$=be.times(W.plus(e(Z,W,Re,1))),_d(W.c).slice(0,ke)===(D=_d($.c)).slice(0,ke))if($.e<Oe&&--ke,D=D.slice(ke-3,ke+1),D=="9999"||!z&&D=="4999"){if(!z&&(Ve(W,W.e+m+2,0),W.times(W).eq(Z))){$=W;break}Re+=4,ke+=4,z=1}else{(!+D||!+D.slice(1)&&D.charAt(0)=="5")&&(Ve($,$.e+m+2,1),j=!$.times($).eq(Z));break}}return Ve($,$.e+m+1,_,j)},c.toExponential=function(j,D){return j!=null&&(Dl(j,0,bu),j++),ye(this,j,D,1)},c.toFixed=function(j,D){return j!=null&&(Dl(j,0,bu),j=j+this.e+1),ye(this,j,D)},c.toFormat=function(j,D,$){var z,W=this;if($==null)j!=null&&D&&typeof D=="object"?($=D,D=null):j&&typeof j=="object"?($=j,j=D=null):$=ce;else if(typeof $!="object")throw Error(zh+"Argument not an object: "+$);if(z=W.toFixed(j,D),W.c){var Z,Ee=z.split("."),ke=+$.groupSize,Oe=+$.secondaryGroupSize,Re=$.groupSeparator||"",be=Ee[0],De=Ee[1],Qe=W.s<0,xe=Qe?be.slice(1):be,ae=xe.length;if(Oe&&(Z=ke,ke=Oe,Oe=Z,ae-=Z),ke>0&&ae>0){for(Z=ae%ke||ke,be=xe.substr(0,Z);Z<ae;Z+=ke)be+=Re+xe.substr(Z,ke);Oe>0&&(be+=Re+xe.slice(Z)),Qe&&(be="-"+be)}z=De?be+($.decimalSeparator||"")+((Oe=+$.fractionGroupSize)?De.replace(new RegExp("\\d{"+Oe+"}\\B","g"),"$&"+($.fractionGroupSeparator||"")):De):be}return($.prefix||"")+z+($.suffix||"")},c.toFraction=function(j){var D,$,z,W,Z,Ee,ke,Oe,Re,be,De,Qe,xe=this,ae=xe.c;if(j!=null&&(ke=new oe(j),!ke.isInteger()&&(ke.c||ke.s!==1)||ke.lt(u)))throw Error(zh+"Argument "+(ke.isInteger()?"out of range: ":"not an integer: ")+de(ke));if(!ae)return new oe(xe);for(D=new oe(u),Re=$=new oe(u),z=Oe=new oe(u),Qe=_d(ae),Z=D.e=Qe.length-xe.e-1,D.c[0]=Fb[(Ee=Z%Po)<0?Po+Ee:Ee],j=!j||ke.comparedTo(D)>0?Z>0?D:Re:ke,Ee=O,O=1/0,ke=new oe(Qe),Oe.c[0]=0;be=e(ke,D,0,1),W=$.plus(be.times(z)),W.comparedTo(j)!=1;)$=z,z=W,Re=Oe.plus(be.times(W=Re)),Oe=W,D=ke.minus(be.times(W=D)),ke=W;return W=e(j.minus($),z,0,1),Oe=Oe.plus(W.times(Re)),$=$.plus(W.times(z)),Oe.s=Re.s=xe.s,Z=Z*2,De=e(Re,z,Z,_).minus(xe).abs().comparedTo(e(Oe,$,Z,_).minus(xe).abs())<1?[Re,z]:[Oe,$],O=Ee,De},c.toNumber=function(){return+de(this)},c.toPrecision=function(j,D){return j!=null&&Dl(j,1,bu),ye(this,j,D,2)},c.toString=function(j){var D,$=this,z=$.s,W=$.e;return W===null?z?(D="Infinity",z<0&&(D="-"+D)):D="NaN":(j==null?D=W<=o||W>=w?y1(_d($.c),W):Jf(_d($.c),W,"0"):j===10&&ne?($=Ve(new oe($),m+W+1,_),D=Jf(_d($.c),$.e,"0")):(Dl(j,2,fe.length,"Base"),D=t(Jf(_d($.c),W,"0"),10,j,z,!0)),z<0&&$.c[0]&&(D="-"+D)),D},c.valueOf=c.toJSON=function(){return de(this)},c._isBigNumber=!0,c[Symbol.toStringTag]="BigNumber",c[Symbol.for("nodejs.util.inspect.custom")]=c.valueOf,n!=null&&oe.set(n),oe}function xd(n){var e=n|0;return n>0||n===e?e:e-1}function _d(n){for(var e,t,i=1,c=n.length,u=n[0]+"";i<c;){for(e=n[i++]+"",t=Po-e.length;t--;e="0"+e);u+=e}for(c=u.length;u.charCodeAt(--c)===48;);return u.slice(0,c+1||1)}function Am(n,e){var t,i,c=n.c,u=e.c,m=n.s,_=e.s,o=n.e,w=e.e;if(!m||!_)return null;if(t=c&&!c[0],i=u&&!u[0],t||i)return t?i?0:-_:m;if(m!=_)return m;if(t=m<0,i=o==w,!c||!u)return i?0:!c^t?1:-1;if(!i)return o>w^t?1:-1;for(_=(o=c.length)<(w=u.length)?o:w,m=0;m<_;m++)if(c[m]!=u[m])return c[m]>u[m]^t?1:-1;return o==w?0:o>w^t?1:-1}function Dl(n,e,t,i){if(n<e||n>t||n!==vd(n))throw Error(zh+(i||"Argument")+(typeof n=="number"?n<e||n>t?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function g1(n){var e=n.c.length-1;return xd(n.e/Po)==e&&n.c[e]%2!=0}function y1(n,e){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(e<0?"e":"e+")+e}function Jf(n,e,t){var i,c;if(e<0){for(c=t+".";++e;c+=t);n=c+n}else if(i=n.length,++e>i){for(c=t,e-=i;--e;c+=t);n+=c}else e<i&&(n=n.slice(0,e)+"."+n.slice(e));return n}var Sf=DI(),zz=class{key;left=null;right=null;constructor(n){this.key=n}},py=class extends zz{constructor(n){super(n)}},jz=class{size=0;modificationCount=0;splayCount=0;splay(n){const e=this.root;if(e==null)return this.compare(n,n),-1;let t=null,i=null,c=null,u=null,m=e;const _=this.compare;let o;for(;;)if(o=_(m.key,n),o>0){let w=m.left;if(w==null||(o=_(w.key,n),o>0&&(m.left=w.right,w.right=m,m=w,w=m.left,w==null)))break;t==null?i=m:t.left=m,t=m,m=w}else if(o<0){let w=m.right;if(w==null||(o=_(w.key,n),o<0&&(m.right=w.left,w.left=m,m=w,w=m.right,w==null)))break;c==null?u=m:c.right=m,c=m,m=w}else break;return c!=null&&(c.right=m.left,m.left=u),t!=null&&(t.left=m.right,m.right=i),this.root!==m&&(this.root=m,this.splayCount++),o}splayMin(n){let e=n,t=e.left;for(;t!=null;){const i=t;e.left=i.right,i.right=e,e=i,t=e.left}return e}splayMax(n){let e=n,t=e.right;for(;t!=null;){const i=t;e.right=i.left,i.left=e,e=i,t=e.right}return e}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let t=this.root;const i=t,c=t.left;if(this.size--,c==null)this.root=t.right;else{const u=t.right;t=this.splayMax(c),t.right=u,this.root=t}return this.modificationCount++,i}addNewRoot(n,e){this.size++,this.modificationCount++;const t=this.root;if(t==null){this.root=n;return}e<0?(n.left=t,n.right=t.right,t.right=null):(n.right=t,n.left=t.left,t.left=null),this.root=n}_first(){const n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){const n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,e)=>n<e?-1:n>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}},bv=class Sy extends jz{root=null;compare;validKey;constructor(e,t){super(),this.compare=e??this.defaultCompare(),this.validKey=t??(i=>i!=null&&i!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const t of e)this.delete(t)}forEach(e){const t=this[Symbol.iterator]();let i;for(;i=t.next(),!i.done;)e(i.value,i.value,this)}add(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new py(e),t),this}addAndReturn(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new py(e),t),this.root.key}addAll(e){for(const t of e)this.add(t)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let i=this.root.left;if(i==null)return null;let c=i.right;for(;c!=null;)i=c,c=i.right;return i.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let i=this.root.right;if(i==null)return null;let c=i.left;for(;c!=null;)i=c,c=i.left;return i.key}retainAll(e){const t=new Sy(this.compare,this.validKey),i=this.modificationCount;for(const c of e){if(i!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(c)&&this.splay(c)==0&&t.add(this.root.key)}t.size!=this.size&&(this.root=t.root,this.size=t.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const t=new Sy(this.compare,this.validKey);for(const i of this)e.has(i)&&t.add(i);return t}difference(e){const t=new Sy(this.compare,this.validKey);for(const i of this)e.has(i)||t.add(i);return t}union(e){const t=this.clone();return t.addAll(e),t}clone(){const e=new Sy(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function t(c,u){let m,_;do{if(m=c.left,_=c.right,m!=null){const o=new py(m.key);u.left=o,t(m,o)}if(_!=null){const o=new py(_.key);u.right=o,c=_,u=o}}while(_!=null)}const i=new py(e.key);return t(e,i),i}toSet(){return this.clone()}entries(){return new Vz(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new Uz(this.wrap())}[Symbol.toStringTag]="[object Set]"},FI=class{tree;path=new Array;modificationCount=null;splayCount;constructor(n){this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let t=this.tree.getRoot();for(;t!=null;)this.path.push(t),t=t.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],e=n.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},Uz=class extends FI{getValue(n){return n.key}},Vz=class extends FI{getValue(n){return[n.key,n.key]}},OI=n=>()=>n,R5=n=>{const e=n?(t,i)=>i.minus(t).abs().isLessThanOrEqualTo(n):OI(!1);return(t,i)=>e(t,i)?0:t.comparedTo(i)};function qz(n){const e=n?(t,i,c,u,m)=>t.exponentiatedBy(2).isLessThanOrEqualTo(u.minus(i).exponentiatedBy(2).plus(m.minus(c).exponentiatedBy(2)).times(n)):OI(!1);return(t,i,c)=>{const u=t.x,m=t.y,_=c.x,o=c.y,w=m.minus(o).times(i.x.minus(_)).minus(u.minus(_).times(i.y.minus(o)));return e(w,u,m,_,o)?0:w.comparedTo(0)}}var $z=n=>n,Gz=n=>{if(n){const e=new bv(R5(n)),t=new bv(R5(n)),i=(u,m)=>m.addAndReturn(u),c=u=>({x:i(u.x,e),y:i(u.y,t)});return c({x:new Sf(0),y:new Sf(0)}),c}return $z},N5=n=>({set:e=>{yp=N5(e)},reset:()=>N5(n),compare:R5(n),snap:Gz(n),orient:qz(n)}),yp=N5(),my=(n,e)=>n.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(n.ur.y),D5=(n,e)=>{if(e.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(e.ll.y))return null;const t=n.ll.x.isLessThan(e.ll.x)?e.ll.x:n.ll.x,i=n.ur.x.isLessThan(e.ur.x)?n.ur.x:e.ur.x,c=n.ll.y.isLessThan(e.ll.y)?e.ll.y:n.ll.y,u=n.ur.y.isLessThan(e.ur.y)?n.ur.y:e.ur.y;return{ll:{x:t,y:c},ur:{x:i,y:u}}},$1=(n,e)=>n.x.times(e.y).minus(n.y.times(e.x)),BI=(n,e)=>n.x.times(e.x).plus(n.y.times(e.y)),wv=n=>BI(n,n).sqrt(),Wz=(n,e,t)=>{const i={x:e.x.minus(n.x),y:e.y.minus(n.y)},c={x:t.x.minus(n.x),y:t.y.minus(n.y)};return $1(c,i).div(wv(c)).div(wv(i))},Hz=(n,e,t)=>{const i={x:e.x.minus(n.x),y:e.y.minus(n.y)},c={x:t.x.minus(n.x),y:t.y.minus(n.y)};return BI(c,i).div(wv(c)).div(wv(i))},nA=(n,e,t)=>e.y.isZero()?null:{x:n.x.plus(e.x.div(e.y).times(t.minus(n.y))),y:t},rA=(n,e,t)=>e.x.isZero()?null:{x:t,y:n.y.plus(e.y.div(e.x).times(t.minus(n.x)))},Xz=(n,e,t,i)=>{if(e.x.isZero())return rA(t,i,n.x);if(i.x.isZero())return rA(n,e,t.x);if(e.y.isZero())return nA(t,i,n.y);if(i.y.isZero())return nA(n,e,t.y);const c=$1(e,i);if(c.isZero())return null;const u={x:t.x.minus(n.x),y:t.y.minus(n.y)},m=$1(u,e).div(c),_=$1(u,i).div(c),o=n.x.plus(_.times(e.x)),w=t.x.plus(m.times(i.x)),I=n.y.plus(_.times(e.y)),O=t.y.plus(m.times(i.y)),V=o.plus(w).div(2),M=I.plus(O).div(2);return{x:V,y:M}},_f=class zI{point;isLeft;segment;otherSE;consumedBy;static compare(e,t){const i=zI.comparePoints(e.point,t.point);return i!==0?i:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Sv.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let i=0,c=t.length;i<c;i++){const u=t[i];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const i=this.point.events[t];if(i.segment.consumedBy===void 0)for(let c=t+1;c<e;c++){const u=this.point.events[c];u.consumedBy===void 0&&i.otherSE.point.events===u.otherSE.point.events&&i.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,i=this.point.events.length;t<i;t++){const c=this.point.events[t];c!==this&&!c.segment.ringOut&&c.segment.isInResult()&&e.push(c)}return e}getLeftmostComparator(e){const t=new Map,i=c=>{const u=c.otherSE;t.set(c,{sine:Wz(this.point,e.point,u.point),cosine:Hz(this.point,e.point,u.point)})};return(c,u)=>{t.has(c)||i(c),t.has(u)||i(u);const{sine:m,cosine:_}=t.get(c),{sine:o,cosine:w}=t.get(u);return m.isGreaterThanOrEqualTo(0)&&o.isGreaterThanOrEqualTo(0)?_.isLessThan(w)?1:_.isGreaterThan(w)?-1:0:m.isLessThan(0)&&o.isLessThan(0)?_.isLessThan(w)?-1:_.isGreaterThan(w)?1:0:o.isLessThan(m)?-1:o.isGreaterThan(m)?1:0}}},Kz=class F5{events;poly;_isExteriorRing;_enclosingRing;static factory(e){const t=[];for(let i=0,c=e.length;i<c;i++){const u=e[i];if(!u.isInResult()||u.ringOut)continue;let m=null,_=u.leftSE,o=u.rightSE;const w=[_],I=_.point,O=[];for(;m=_,_=o,w.push(_),_.point!==I;)for(;;){const V=_.getAvailableLinkedEvents();if(V.length===0){const ce=w[0].point,fe=w[w.length-1].point;throw new Error(`Unable to complete output ring starting at [${ce.x}, ${ce.y}]. Last matching segment found ends at [${fe.x}, ${fe.y}].`)}if(V.length===1){o=V[0].otherSE;break}let M=null;for(let ce=0,fe=O.length;ce<fe;ce++)if(O[ce].point===_.point){M=ce;break}if(M!==null){const ce=O.splice(M)[0],fe=w.splice(ce.index);fe.unshift(fe[0].otherSE),t.push(new F5(fe.reverse()));continue}O.push({index:w.length,point:_.point});const se=_.getLeftmostComparator(m);o=V.sort(se)[0].otherSE;break}t.push(new F5(w))}return t}constructor(e){this.events=e;for(let t=0,i=e.length;t<i;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let w=1,I=this.events.length-1;w<I;w++){const O=this.events[w].point,V=this.events[w+1].point;yp.orient(O,e,V)!==0&&(t.push(O),e=O)}if(t.length===1)return null;const i=t[0],c=t[1];yp.orient(i,e,c)===0&&t.shift(),t.push(t[0]);const u=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:t.length-1,_=this.isExteriorRing()?t.length:-1,o=[];for(let w=m;w!=_;w+=u)o.push([t[w].x.toNumber(),t[w].y.toNumber()]);return o}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let c=1,u=this.events.length;c<u;c++){const m=this.events[c];_f.compare(e,m)>0&&(e=m)}let t=e.segment.prevInResult(),i=t?t.prevInResult():null;for(;;){if(!t)return null;if(!i)return t.ringOut;if(i.ringOut!==t.ringOut)return i.ringOut?.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut?.enclosingRing();t=i.prevInResult(),i=t?t.prevInResult():null}}},iA=class{exteriorRing;interiorRings;constructor(n){this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){const n=this.exteriorRing.getGeom();if(n===null)return null;const e=[n];for(let t=0,i=this.interiorRings.length;t<i;t++){const c=this.interiorRings[t].getGeom();c!==null&&e.push(c)}return e}},Zz=class{rings;polys;constructor(n){this.rings=n,this.polys=this._composePolys(n)}getGeom(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const i=this.polys[e].getGeom();i!==null&&n.push(i)}return n}_composePolys(n){const e=[];for(let t=0,i=n.length;t<i;t++){const c=n[t];if(!c.poly)if(c.isExteriorRing())e.push(new iA(c));else{const u=c.enclosingRing();u?.poly||e.push(new iA(u)),u?.poly?.addInterior(c)}}return e}},Yz=class{queue;tree;segments;constructor(n,e=Sv.compare){this.queue=n,this.tree=new bv(e),this.segments=[]}process(n){const e=n.segment,t=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(e),t;n.isLeft&&this.tree.add(e);let i=e,c=e;do i=this.tree.lastBefore(i);while(i!=null&&i.consumedBy!=null);do c=this.tree.firstAfter(c);while(c!=null&&c.consumedBy!=null);if(n.isLeft){let u=null;if(i){const _=i.getIntersection(e);if(_!==null&&(e.isAnEndpoint(_)||(u=_),!i.isAnEndpoint(_))){const o=this._splitSafely(i,_);for(let w=0,I=o.length;w<I;w++)t.push(o[w])}}let m=null;if(c){const _=c.getIntersection(e);if(_!==null&&(e.isAnEndpoint(_)||(m=_),!c.isAnEndpoint(_))){const o=this._splitSafely(c,_);for(let w=0,I=o.length;w<I;w++)t.push(o[w])}}if(u!==null||m!==null){let _=null;u===null?_=m:m===null?_=u:_=_f.comparePoints(u,m)<=0?u:m,this.queue.delete(e.rightSE),t.push(e.rightSE);const o=e.split(_);for(let w=0,I=o.length;w<I;w++)t.push(o[w])}t.length>0?(this.tree.delete(e),t.push(n)):(this.segments.push(e),e.prev=i)}else{if(i&&c){const u=i.getIntersection(c);if(u!==null){if(!i.isAnEndpoint(u)){const m=this._splitSafely(i,u);for(let _=0,o=m.length;_<o;_++)t.push(m[_])}if(!c.isAnEndpoint(u)){const m=this._splitSafely(c,u);for(let _=0,o=m.length;_<o;_++)t.push(m[_])}}}this.tree.delete(e)}return t}_splitSafely(n,e){this.tree.delete(n);const t=n.rightSE;this.queue.delete(t);const i=n.split(e);return i.push(t),n.consumedBy===void 0&&this.tree.add(n),i}},Jz=class{type;numMultiPolys;run(n,e,t){Ey.type=n;const i=[new sA(e,!0)];for(let w=0,I=t.length;w<I;w++)i.push(new sA(t[w],!1));if(Ey.numMultiPolys=i.length,Ey.type==="difference"){const w=i[0];let I=1;for(;I<i.length;)D5(i[I].bbox,w.bbox)!==null?I++:i.splice(I,1)}if(Ey.type==="intersection")for(let w=0,I=i.length;w<I;w++){const O=i[w];for(let V=w+1,M=i.length;V<M;V++)if(D5(O.bbox,i[V].bbox)===null)return[]}const c=new bv(_f.compare);for(let w=0,I=i.length;w<I;w++){const O=i[w].getSweepEvents();for(let V=0,M=O.length;V<M;V++)c.add(O[V])}const u=new Yz(c);let m=null;for(c.size!=0&&(m=c.first(),c.delete(m));m;){const w=u.process(m);for(let I=0,O=w.length;I<O;I++){const V=w[I];V.consumedBy===void 0&&c.add(V)}c.size!=0?(m=c.first(),c.delete(m)):m=null}yp.reset();const _=Kz.factory(u.segments);return new Zz(_).getGeom()}},Ey=new Jz,O5=Ey,Qz=0,Sv=class G1{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(e,t){const i=e.leftSE.point.x,c=t.leftSE.point.x,u=e.rightSE.point.x,m=t.rightSE.point.x;if(m.isLessThan(i))return 1;if(u.isLessThan(c))return-1;const _=e.leftSE.point.y,o=t.leftSE.point.y,w=e.rightSE.point.y,I=t.rightSE.point.y;if(i.isLessThan(c)){if(o.isLessThan(_)&&o.isLessThan(w))return 1;if(o.isGreaterThan(_)&&o.isGreaterThan(w))return-1;const O=e.comparePoint(t.leftSE.point);if(O<0)return 1;if(O>0)return-1;const V=t.comparePoint(e.rightSE.point);return V!==0?V:-1}if(i.isGreaterThan(c)){if(_.isLessThan(o)&&_.isLessThan(I))return-1;if(_.isGreaterThan(o)&&_.isGreaterThan(I))return 1;const O=t.comparePoint(e.leftSE.point);if(O!==0)return O;const V=e.comparePoint(t.rightSE.point);return V<0?1:V>0?-1:1}if(_.isLessThan(o))return-1;if(_.isGreaterThan(o))return 1;if(u.isLessThan(m)){const O=t.comparePoint(e.rightSE.point);if(O!==0)return O}if(u.isGreaterThan(m)){const O=e.comparePoint(t.rightSE.point);if(O<0)return 1;if(O>0)return-1}if(!u.eq(m)){const O=w.minus(_),V=u.minus(i),M=I.minus(o),se=m.minus(c);if(O.isGreaterThan(V)&&M.isLessThan(se))return 1;if(O.isLessThan(V)&&M.isGreaterThan(se))return-1}return u.isGreaterThan(m)?1:u.isLessThan(m)||w.isLessThan(I)?-1:w.isGreaterThan(I)?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,i,c){this.id=++Qz,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=i,this.windings=c}static fromRing(e,t,i){let c,u,m;const _=_f.comparePoints(e,t);if(_<0)c=e,u=t,m=1;else if(_>0)c=t,u=e,m=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const o=new _f(c,!0),w=new _f(u,!1);return new G1(o,w,[i],[m])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return yp.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const t=this.bbox(),i=e.bbox(),c=D5(t,i);if(c===null)return null;const u=this.leftSE.point,m=this.rightSE.point,_=e.leftSE.point,o=e.rightSE.point,w=my(t,_)&&this.comparePoint(_)===0,I=my(i,u)&&e.comparePoint(u)===0,O=my(t,o)&&this.comparePoint(o)===0,V=my(i,m)&&e.comparePoint(m)===0;if(I&&w)return V&&!O?m:!V&&O?o:null;if(I)return O&&u.x.eq(o.x)&&u.y.eq(o.y)?null:u;if(w)return V&&m.x.eq(_.x)&&m.y.eq(_.y)?null:_;if(V&&O)return null;if(V)return m;if(O)return o;const M=Xz(u,this.vector(),_,e.vector());return M===null||!my(c,M)?null:yp.snap(M)}split(e){const t=[],i=e.events!==void 0,c=new _f(e,!0),u=new _f(e,!1),m=this.rightSE;this.replaceRightSE(u),t.push(u),t.push(c);const _=new G1(c,m,this.rings.slice(),this.windings.slice());return _f.comparePoints(_.leftSE.point,_.rightSE.point)>0&&_.swapEvents(),_f.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(c.checkForConsuming(),u.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,i=this.windings.length;t<i;t++)this.windings[t]*=-1}consume(e){let t=this,i=e;for(;t.consumedBy;)t=t.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const c=G1.compare(t,i);if(c!==0){if(c>0){const u=t;t=i,i=u}if(t.prev===i){const u=t;t=i,i=u}for(let u=0,m=i.rings.length;u<m;u++){const _=i.rings[u],o=i.windings[u],w=t.rings.indexOf(_);w===-1?(t.rings.push(_),t.windings.push(o)):t.windings[w]+=o}i.rings=null,i.windings=null,i.consumedBy=t,i.leftSE.consumedBy=t.leftSE,i.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,i=this._afterState.windings,c=this._afterState.multiPolys;for(let _=0,o=this.rings.length;_<o;_++){const w=this.rings[_],I=this.windings[_],O=t.indexOf(w);O===-1?(t.push(w),i.push(I)):i[O]+=I}const u=[],m=[];for(let _=0,o=t.length;_<o;_++){if(i[_]===0)continue;const w=t[_],I=w.poly;if(m.indexOf(I)===-1)if(w.isExterior)u.push(I);else{m.indexOf(I)===-1&&m.push(I);const O=u.indexOf(w.poly);O!==-1&&u.splice(O,1)}}for(let _=0,o=u.length;_<o;_++){const w=u[_].multiPoly;c.indexOf(w)===-1&&c.push(w)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(O5.type){case"union":{const i=e.length===0,c=t.length===0;this._isInResult=i!==c;break}case"intersection":{let i,c;e.length<t.length?(i=e.length,c=t.length):(i=t.length,c=e.length),this._isInResult=c===O5.numMultiPolys&&i<c;break}case"xor":{const i=Math.abs(e.length-t.length);this._isInResult=i%2===1;break}case"difference":{const i=c=>c.length===1&&c[0].isSubject;this._isInResult=i(e)!==i(t);break}}return this._isInResult}},oA=class{poly;isExterior;segments;bbox;constructor(n,e,t){if(!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=t,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=yp.snap({x:new Sf(n[0][0]),y:new Sf(n[0][1])});this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let c=i;for(let u=1,m=n.length;u<m;u++){if(typeof n[u][0]!="number"||typeof n[u][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const _=yp.snap({x:new Sf(n[u][0]),y:new Sf(n[u][1])});_.x.eq(c.x)&&_.y.eq(c.y)||(this.segments.push(Sv.fromRing(c,_,this)),_.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=_.x),_.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=_.y),_.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=_.x),_.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=_.y),c=_)}(!i.x.eq(c.x)||!i.y.eq(c.y))&&this.segments.push(Sv.fromRing(c,i,this))}getSweepEvents(){const n=[];for(let e=0,t=this.segments.length;e<t;e++){const i=this.segments[e];n.push(i.leftSE),n.push(i.rightSE)}return n}},ej=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new oA(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,i=n.length;t<i;t++){const c=new oA(n[t],this,!1);c.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.bbox.ll.x),c.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.bbox.ll.y),c.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.bbox.ur.x),c.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.bbox.ur.y),this.interiorRings.push(c)}this.multiPoly=e}getSweepEvents(){const n=this.exteriorRing.getSweepEvents();for(let e=0,t=this.interiorRings.length;e<t;e++){const i=this.interiorRings[e].getSweepEvents();for(let c=0,u=i.length;c<u;c++)n.push(i[c])}return n}},sA=class{isSubject;polys;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new Sf(Number.POSITIVE_INFINITY),y:new Sf(Number.POSITIVE_INFINITY)},ur:{x:new Sf(Number.NEGATIVE_INFINITY),y:new Sf(Number.NEGATIVE_INFINITY)}};for(let t=0,i=n.length;t<i;t++){const c=new ej(n[t],this);c.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.bbox.ll.x),c.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.bbox.ll.y),c.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.bbox.ur.x),c.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.bbox.ur.y),this.polys.push(c)}this.isSubject=e}getSweepEvents(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const i=this.polys[e].getSweepEvents();for(let c=0,u=i.length;c<u;c++)n.push(i[c])}return n}},tj=(n,...e)=>O5.run("intersection",n,e);yp.set;function c3(n,e,t,i={}){const c=e<0;let u=LI(Math.abs(e),i.units,"meters");c&&(u=-Math.abs(u));const m=Ed(n),_=nj(m,u,t);return _[0]+=_[0]-m[0]>180?-360:m[0]-_[0]>180?360:0,zs(_,i.properties)}function nj(n,e,t,i){i=i===void 0?Vu:Number(i);const c=e/i,u=n[0]*Math.PI/180,m=id(n[1]),_=id(t),o=c*Math.cos(_);let w=m+o;Math.abs(w)>Math.PI/2&&(w=w>0?Math.PI-w:-Math.PI-w);const I=Math.log(Math.tan(w/2+Math.PI/4)/Math.tan(m/2+Math.PI/4)),O=Math.abs(I)>1e-11?o/I:Math.cos(m),V=c*Math.sin(_)/O;return[((u+V)*180/Math.PI+540)%360-180,w*180/Math.PI]}function jI(n,e,t={}){const i=Ed(n),c=Ed(e);c[0]+=c[0]-i[0]>180?-360:i[0]-c[0]>180?360:0;const u=rj(i,c);return LI(u,"meters",t.units)}function rj(n,e,t){t=t===void 0?Vu:Number(t);const i=t,c=n[1]*Math.PI/180,u=e[1]*Math.PI/180,m=u-c;let _=Math.abs(e[0]-n[0])*Math.PI/180;_>Math.PI&&(_-=2*Math.PI);const o=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(c/2+Math.PI/4)),w=Math.abs(o)>1e-11?m/o:Math.cos(c);return Math.sqrt(m*m+w*w*_*_)*i}function jh(n,e,t){if(t=t||{},!o3(t))throw new Error("options is invalid");const i=t.pivot,c=t.mutate;if(!n)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("angle is required");if(e===0)return n;const u=i??tc(n);return(c===!1||c===void 0)&&(n=a3(n)),ng(n,function(m){const o=PI(u,m)+e,w=jI(u,m),I=s3(c3(u,w,o));m[0]=I[0],m[1]=I[1]}),n}function UI(n,e={}){const t=[];if(kI(n,c=>{t.push(c.coordinates)}),t.length<2)throw new Error("Must specify at least 2 geometries");const i=tj(t[0],...t.slice(1));return i.length===0?null:i.length===1?r3(i[0],e.properties):fz(i,e.properties)}function p0(n,e,t){if(t=t||{},!o3(t))throw new Error("options is invalid");const i=t.origin||"centroid",c=t.mutate||!1;if(!n)throw new Error("geojson required");if(typeof e!="number"||e<=0)throw new Error("invalid factor");const u=Array.isArray(i)||typeof i=="object";return c!==!0&&(n=a3(n)),n.type==="FeatureCollection"&&!u?(yz(n,function(m,_){n.features[_]=aA(m,e,i)}),n):aA(n,e,i)}function aA(n,e,t){const i=mz(n)==="Point",c=ij(n,t);return e===1||i||(ng(n,function(u){const m=jI(c,u),_=PI(c,u),o=m*e,w=s3(c3(c,o,_));u[0]=w[0],u[1]=w[1],u.length===3&&(u[2]*=e)}),delete n.bbox),n}function ij(n,e){if(e==null&&(e="centroid"),Array.isArray(e)||typeof e=="object")return Ed(e);const t=n.bbox?n.bbox:Eu(n,{recompute:!0}),i=t[0],c=t[1],u=t[2],m=t[3];switch(e){case"sw":case"southwest":case"westsouth":case"bottomleft":return zs([i,c]);case"se":case"southeast":case"eastsouth":case"bottomright":return zs([u,c]);case"nw":case"northwest":case"westnorth":case"topleft":return zs([i,m]);case"ne":case"northeast":case"eastnorth":case"topright":return zs([u,m]);case"center":return bz(n);case void 0:case null:case"centroid":return tc(n);default:throw new Error("invalid origin")}}function Fm(n,e,t,i){if(i=i||{},!o3(i))throw new Error("options is invalid");var c=i.units,u=i.zTranslation,m=i.mutate;if(!n)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("distance is required");if(u&&typeof u!="number"&&isNaN(u))throw new Error("zTranslation is not a number");if(u=u!==void 0?u:0,e===0&&u===0)return n;if(t==null||isNaN(t))throw new Error("direction is required");return e<0&&(e=-e,t=t+180),(m===!1||m===void 0)&&(n=a3(n)),ng(n,function(_){var o=s3(c3(_,e,t,{units:c}));_[0]=o[0],_[1]=o[1],u&&_.length===3&&(_[2]+=u)}),n}function Wc(n){return String(n??"").trim().toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")||"na"}function _1(n){return Wc(n)}function ec(n){return Wc(n)}function qd(...n){if(!n?.length)return"na";const e=n.flatMap(t=>Array.isArray(t)?t:[t]).map(t=>t==null?"":String(t)).map(t=>t.trim()).filter(Boolean);if(!e.length)return"na";if(e.length===1){const t=e[0];return t.match(/^\d+$/)?t:Wc(t)}return Wc(e.join("_"))}const u3={"Academic Support":"#f68a69",Admissions:"#b3b3b3","Admin-General":"#dcf4b4","Alumni & Foundation":"#4CAF50",Art:"#ea0ea0",Athletics:"#ea550a",Biology:"#17becf","Bronco Blend":"#5a4b22","Business Economics":"#d77cf8","Business Office":"#C44E52","Career Services":"#ff7f50",Chaplain:"#7B7F9E",Chemistry:"#f24516",Classroom:"#c20583",CFO:"#789051",CIO:"#2282bd",Communication:"#109014","Creighton Coll of Nursing":"#76C7C0","Digital Art":"#ffb347",Esports:"#00B894",Facilities:"#2CA02C","Financial Aid":"#8C564B",Forensics:"#aef2e1","Health Center":"#f50909","History, Religion, Philosophy":"#649515",Housing:"#f54d4d",HR:"#3498DB",IR:"#3b580e",IT:"#836377","Languages & Literatures":"#4a64b9",Library:"#079c29","Maintenance & Facilities":"#a6a6a6",Math:"#427b75",Music:"#9467bd",Offline:"#515250",OMC:"#9273f7",Open:"#95A5A6","Physical Education":"#a6d854",PM:"#d7a0fa","President Office":"#d884d8",Psychology:"#2bf087",Registrar:"#F1C40F","Service Learning/Chaplain":"#66c2a5","Student Accounts":"#86e6ed","Student Engagement":"#1584ed","Student Union":"#7cb0ef","Teacher Education":"#2E86AB",Theatre:"#f1374c",Unknown:"#8d776c",VPAA:"#1568f9","VPAA - Academic Admin":"#dde80d",Physics:"#ff24ab"},lA=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];function oj(n){let e=0;for(let t=0;t<n.length;t++)e=e*31+n.charCodeAt(t)>>>0;return e}function Gd(n){if(!n)return"#AAAAAA";const e=u3[n];if(e)return e;const t=oj(n)%lA.length;return lA[t]}function cA(n){const e=n||{},t=Array.isArray(e.features)?e.features:[];let i=0,c=0,u=0,m=0;const _=new Map;for(const I of t){const O=I.properties||{},V=O.__areaSf??O.Area_SF??O.Area_SF??O.area??O.Area??O.SF??O["Area (SF)"]??O.NetArea??0,M=Number(V);if(!Number.isFinite(M)||M<=0)continue;c+=1,i+=M;const se=String(O.__roomType??O.NCES_Type??"").trim(),ce=O.Name??O.Room??O["Room Name"]??"",fe=String(ce).toUpperCase(),ne=se.toUpperCase();(ne.includes("CLASSROOM")||ne.includes("LECTURE")||fe.includes("CLASSROOM")||fe.includes("LECTURE"))&&(m+=1,u+=M);const ye=O.__dept??O.NCES_Department??O.NCES_Department??O.NCES_Dept??O["NCES Dept"]??O.department??O.Department??O.Dept??"",he=String(ye).trim();he&&_.set(he,(_.get(he)||0)+M)}const o=Array.from(_.entries()).sort((I,O)=>O[1]-I[1]).slice(0,12).map(([I,O])=>({name:I,sf:O,color:Gd(I)})),w=Object.fromEntries(_);return{totalSf:i,rooms:c,classroomSf:u,classroomCount:m,totalsByDept:w,keyDepts:o}}const sj=n=>Number.isFinite(n)?Math.max(0,Math.min(n,100)):null,aj=n=>Number.isFinite(n)?`${Math.round(n)}%`:"--",uA=({label:n,value:e,color:t,compact:i})=>{if(!Number.isFinite(e))return Q.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[Q.jsx("div",{style:{fontSize:i?11:12,color:"#344054"},children:n}),Q.jsx("div",{style:{fontSize:i?11:12,color:"#667085"},children:"--"})]});const c=sj(e),u=i?6:8;return Q.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[Q.jsxs("div",{children:[Q.jsx("div",{style:{fontSize:i?11:12,color:"#344054",marginBottom:3},children:n}),Q.jsx("div",{style:{height:u,background:"#e4e7ec",borderRadius:999,overflow:"hidden"},children:Q.jsx("div",{style:{width:`${c}%`,height:"100%",background:t}})})]}),Q.jsx("div",{style:{fontSize:i?11:12,color:"#475467",fontWeight:600},children:aj(e)})]})};function VI({timePct:n,seatPct:e,compact:t=!1}){return Number.isFinite(n)||Number.isFinite(e)?Q.jsxs("div",{style:{display:"grid",gap:t?6:10},children:[Q.jsx(uA,{label:"Time Utilization",value:n,color:"#3b82f6",compact:t}),Q.jsx(uA,{label:"Seat Utilization",value:e,color:"#f59e0b",compact:t})]}):null}function lj({buildingName:n,stats:e,keyDepts:t=[],floors:i=[],selectedFloor:c,onChangeFloor:u,onLoadFloorplan:m,onClose:_,onExportPDF:o,onExportCSV:w,onExplainBuilding:I,explainBuildingLoading:O=!1,explainBuildingDisabled:V=!1,explainBuildingError:M="",utilization:se,dragHandleProps:ce}){const fe=de=>Number.isFinite(de)?Math.round(de).toLocaleString():"-",ne=de=>Number.isFinite(de)?Number(de).toLocaleString():"-",oe=!!ce,{style:ye,...he}=ce||{},Ne=se&&(Number.isFinite(se.timeUtilization)||Number.isFinite(se.seatUtilization)),Ve={display:"flex",justifyContent:"space-between",alignItems:"center",paddingRight:6,...oe?{cursor:"grab",userSelect:"none",touchAction:"none"}:{},...ye||{}};return Q.jsxs("div",{style:{minWidth:320,maxWidth:360,padding:12,fontSize:13},children:[Q.jsxs("div",{style:Ve,...he,children:[Q.jsx("div",{style:{fontWeight:700},children:n}),Q.jsx("button",{onClick:_,"aria-label":"Close",style:{marginRight:4},children:""})]}),Q.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) minmax(0, 1fr)",gap:8,marginTop:8},children:[Q.jsxs("div",{children:[Q.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"BUILDING TOTALS"}),Q.jsxs("div",{children:[Q.jsx("b",{children:"Total SF:"})," ",fe(e?.totalSf)]}),Q.jsxs("div",{children:[Q.jsx("b",{children:"Rooms:"})," ",ne(e?.rooms)]}),Q.jsxs("div",{children:[Q.jsx("b",{children:"Classroom SF:"})," ",fe(e?.classroomSf)]}),Q.jsxs("div",{children:[Q.jsx("b",{children:"Classrooms:"})," ",ne(e?.classroomCount)]}),Q.jsxs("div",{children:[Q.jsx("b",{children:"Levels:"})," ",i?.length??0]})]}),Q.jsxs("div",{children:[Q.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Key Departments"}),t.length===0?Q.jsx("div",{style:{color:"#666"},children:""}):t.map(de=>Q.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,fontSize:12,lineHeight:1.25},children:[Q.jsx("div",{style:{width:14,height:14,borderRadius:3,background:Gd(de.name),border:"1px solid #999"}}),Q.jsxs("div",{style:{flex:1},children:[de.name," ",Number.isFinite(de.areaSf||de.Area||de.sf)?` (${Math.round(de.areaSf||de.Area||de.sf).toLocaleString()} SF)`:""]})]},de.name))]})]}),Ne?Q.jsxs("div",{style:{marginTop:10},children:[Q.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Classroom Utilization"}),Q.jsx(VI,{timePct:se.timeUtilization,seatPct:se.seatUtilization,compact:!0})]}):null,Q.jsxs("div",{style:{marginTop:12,display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[Q.jsx("div",{children:Q.jsx("b",{children:"Floor"})}),Q.jsx("select",{value:c??"",onChange:de=>u?.(de.target.value),children:i.map(de=>Q.jsx("option",{value:de,children:de},de))}),Q.jsx("button",{className:"btn primary",onClick:m,children:"Load"}),Q.jsx("button",{className:"btn secondary",onClick:o,children:"Export to PDF"}),Q.jsx("button",{className:"btn",onClick:w,children:"Export CSV"}),Q.jsx("button",{className:"btn",onClick:I,disabled:V||O,children:O?"Explaining...":" Explain this building"})]}),M?Q.jsx("div",{style:{color:"crimson",marginTop:6,fontSize:12},children:M}):null]})}function cj({buildingName:n,floorLabel:e,stats:t,legendItems:i=[],floors:c=[],selectedFloor:u,onChangeFloor:m,onLoadFloorplan:_,onUnloadFloorplan:o,onClose:w,onExportPDF:I,onExportCSV:O,colorMode:V="department",onChangeColorMode:M,legendTitle:se="Key Departments",legendSelection:ce,onLegendClick:fe,onExplainFloor:ne,explainLoading:oe=!1,explainDisabled:ye=!1,explainError:he="",moveScenarioMode:Ne=!1,onToggleMoveScenarioMode:Ve,rotateActive:de=!1,moveActive:j=!1,rotateValue:D=0,scaleValue:$=1,rotateNotice:z="",rotateStored:W=!1,adjustDebugInfo:Z=null,onStartRotate:Ee,onStartMove:ke,onCancelRotate:Oe,onClearRotate:Re,onScaleChange:be,onSaveAdjust:De,saveAdjustDisabled:Qe=!1,dragHandleProps:xe}){const ae=ht=>Number.isFinite(ht)?Math.round(ht).toLocaleString():"-",Me=ht=>Number.isFinite(ht)?Number(ht).toLocaleString():"-",Fe=!!xe,{style:Ze,...et}=xe||{},mt={display:"flex",justifyContent:"space-between",...Fe?{cursor:"grab",userSelect:"none",touchAction:"none"}:{},...Ze||{}};return Q.jsxs("div",{style:{minWidth:340,maxWidth:380,padding:12,fontSize:13},children:[Q.jsxs("div",{style:mt,...et,children:[Q.jsx("div",{style:{fontWeight:700},children:n}),Q.jsx("button",{onClick:w,"aria-label":"Close",children:""})]}),Q.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 0.95fr) minmax(0, 1.05fr)",gap:10,marginTop:8},children:[Q.jsxs("div",{children:[Q.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"FLOOR TOTALS"}),Q.jsxs("div",{children:[Q.jsx("b",{children:"Floor:"})," ",e??"-"]}),Q.jsxs("div",{children:[Q.jsx("b",{children:"Total SF:"})," ",ae(t?.totalSf)]}),Q.jsxs("div",{children:[Q.jsx("b",{children:"Rooms:"})," ",Me(t?.rooms)]}),Q.jsxs("div",{children:[Q.jsx("b",{children:"Classroom SF:"})," ",ae(t?.classroomSf)]}),Q.jsxs("div",{children:[Q.jsx("b",{children:"Classrooms:"})," ",Me(t?.classroomCount)]})]}),Q.jsxs("div",{children:[Q.jsx("div",{style:{fontWeight:600,marginBottom:6},children:se}),i.length===0?Q.jsx("div",{style:{color:"#666"},children:""}):Q.jsx("div",{style:{maxHeight:"46vh",overflowY:"auto"},children:i.map(ht=>Q.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,padding:"2px 0",borderRadius:4,cursor:fe?"pointer":"default",background:ce===ht.name?"#f0f4ff":"transparent",fontSize:12,lineHeight:1.25},onClick:()=>fe?.(ht.name),children:[Q.jsx("div",{style:{width:14,height:14,borderRadius:3,background:ht.color||Gd(ht.name),border:"1px solid #999"}}),Q.jsxs("div",{style:{flex:1},children:[ht.name," ",Number.isFinite(ht.areaSf||ht.Area||ht.sf)?` (${Math.round(ht.areaSf||ht.Area||ht.sf).toLocaleString()} SF)`:""]})]},ht.name))})]})]}),Q.jsxs("div",{style:{marginTop:12,display:"flex",flexDirection:"column",gap:10},children:[Q.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[Q.jsx("div",{children:Q.jsx("b",{children:"Floor"})}),Q.jsx("select",{value:u??"",onChange:ht=>m?.(ht.target.value),children:c.map(ht=>Q.jsx("option",{value:ht,children:ht},ht))}),Q.jsx("button",{className:"btn primary",onClick:_,children:"Load"}),o?Q.jsx("button",{className:"btn",onClick:o,children:"Unload"}):null]}),Q.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:6},children:[Q.jsx("button",{className:"btn secondary",onClick:I,children:"Export to PDF"}),O?Q.jsx("button",{className:"btn",onClick:O,children:"Export CSV"}):null,Q.jsx("button",{className:"btn",onClick:ne,disabled:ye||oe,children:oe?"Explaining...":" Explain this floor"})]}),he?Q.jsx("div",{style:{color:"crimson",fontSize:12},children:he}):null,Q.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[Q.jsx("div",{style:{fontWeight:600},children:"Highlight By"}),Q.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:6},children:[{key:"department",label:"Department"},{key:"type",label:"Type"},{key:"occupancy",label:"Occupancy"}].map(ht=>Q.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13},children:[Q.jsx("input",{type:"radio",name:"highlight-mode",value:ht.key,checked:V===ht.key,onChange:Nt=>M?.(Nt.target.value)}),ht.label]},ht.key))}),Ve?Q.jsxs("div",{style:{marginTop:6},children:[Q.jsxs("button",{className:"btn",style:{width:"100%",fontWeight:600},onClick:Ve,children:["Move Scenario Mode ",Ne?"ON":"OFF"]}),Q.jsx("div",{style:{marginTop:4,fontSize:11,color:"#555",textAlign:"center"},children:"Click rooms to add/remove them from a what-if scenario. Real data is not changed."})]}):null,Ee?Q.jsxs("div",{style:{marginTop:10,paddingTop:8,borderTop:"1px solid #e5e5e5"},children:[Q.jsx("div",{style:{fontWeight:600},children:"Adjust Floorplan"}),Q.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:de||j?"Drag on the map. Release to save.":"Use Rotate or Move, then drag on the map to adjust rooms + linework together."}),Q.jsxs("div",{style:{fontSize:12,marginTop:2},children:["Rotation: ",Number.isFinite(D)?`${D.toFixed(1)}`:"0","  Scale: ",Number.isFinite($)?$.toFixed(2):"1.00"]}),Q.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:6},children:[Q.jsx("button",{className:"btn",onClick:de?Oe:Ee,children:de?"Cancel Rotate":"Rotate"}),ke?Q.jsx("button",{className:"btn",onClick:j?Oe:ke,children:j?"Cancel Move":"Move"}):null,be?Q.jsxs(Q.Fragment,{children:[Q.jsx("button",{className:"btn",onClick:()=>be(-.02),children:"- Scale"}),Q.jsx("button",{className:"btn",onClick:()=>be(.02),children:"+ Scale"})]}):null,De?Q.jsx("button",{className:"btn primary",onClick:De,disabled:Qe,children:"Save Adjust"}):null,Re?Q.jsx("button",{className:"btn",onClick:Re,disabled:!W,children:"Clear Adjust"}):null]}),z?Q.jsx("div",{style:{color:"crimson",fontSize:12,marginTop:4},children:z}):null,null]}):null]})]})]})}function hA({label:n,value:e,onChange:t,options:i,placeholder:c}){const[u,m]=Fn.useState(!1),[_,o]=Fn.useState(""),w=Fn.useRef(null),I=Fn.useMemo(()=>{const se=new Set,ce=[];return(i||[]).forEach(fe=>{const ne=typeof fe=="string"?{value:fe,label:fe}:fe;!ne||!ne.value||se.has(ne.value)||(se.add(ne.value),ce.push({value:ne.value,label:ne.label??ne.value}))}),ce},[i]),O=Fn.useMemo(()=>I.find(ce=>ce.value===e)?.label??e??"",[I,e]),V=Fn.useMemo(()=>{const se=(_||"").toLowerCase();return se?I.filter(ce=>{const fe=(ce.label??"").toLowerCase(),ne=(ce.value??"").toLowerCase();return fe.includes(se)||ne.includes(se)}):I},[I,_]),M=_||O||"";return Q.jsxs("div",{className:"mf-form-row",style:{position:"relative"},children:[Q.jsx("label",{children:n}),Q.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[Q.jsx("input",{ref:w,className:"mf-input",placeholder:c,value:M,onChange:se=>{const ce=se.target.value;o(ce),t?.(ce)},onFocus:()=>m(!0)}),Q.jsx("button",{type:"button",className:"mf-input",style:{width:34,padding:0,display:"grid",placeItems:"center"},onClick:()=>{m(se=>{const ce=!se;return ce&&w.current?.focus(),ce})},title:"Toggle options",children:""})]}),u&&Q.jsx("div",{style:{position:"absolute",zIndex:9999,left:0,right:0,top:"100%",background:"#fff",border:"1px solid #ddd",borderRadius:8,maxHeight:240,overflow:"auto",marginTop:6,boxShadow:"0 8px 24px rgba(0,0,0,.12)"},onMouseDown:se=>se.preventDefault(),children:V.length===0?Q.jsx("div",{style:{padding:10,color:"#777"},children:"No matches"}):V.map(se=>Q.jsx("div",{style:{padding:"8px 10px",cursor:"pointer"},onClick:()=>{t?.(se.value),o(""),m(!1)},children:se.label},se.value))})]})}function Qf(n,e=8){if(!n)return[];const t=Object.entries(n);return t.sort((i,c)=>(c[1]||0)-(i[1]||0)),t.slice(0,e).map(([i,c])=>({name:i,areaSf:c}))}const uj=n=>{const e=Number(n||0);return Number.isFinite(e)?Math.round(e).toLocaleString():"0"},hj=({label:n,value:e})=>Q.jsxs("div",{style:{background:"#f9fafb",border:"1px solid #e4e7ec",borderRadius:8,padding:8},children:[Q.jsx("div",{style:{fontSize:10,textTransform:"uppercase",letterSpacing:.4,color:"#667085"},children:n}),Q.jsx("div",{style:{fontSize:16,fontWeight:800,color:"#1d2939"},children:e})]}),Ob=({children:n,style:e})=>Q.jsx("div",{style:{background:"#f9fafb",border:"1px solid #e4e7ec",borderRadius:8,padding:8,...e},children:n}),dj=({pct:n,occupied:e=0,vacant:t=0,unknown:i=0,scopeLabel:c=""})=>{const u=Number.isFinite(n)?Math.max(0,Math.min(1,n)):null,m=-90+(u||0)*180,_=u==null?"--":`${Math.round(u*100)}%`;return Q.jsxs("div",{className:"mf-gauge",children:[Q.jsx("div",{className:"mf-gauge-title",children:"OFFICE OCCUPANCY"}),c?Q.jsx("div",{style:{fontSize:11,color:"#667085",marginTop:-2,marginBottom:6},children:c}):null,Q.jsxs("svg",{width:"170",height:"110",viewBox:"0 0 200 130","aria-label":"Office Occupancy",children:[Q.jsx("path",{d:"M 20 110 A 80 80 0 0 1 80 30",fill:"none",stroke:"#d64545",strokeWidth:"16",strokeLinecap:"round"}),Q.jsx("path",{d:"M 80 30 A 80 80 0 0 1 120 30",fill:"none",stroke:"#f0a23b",strokeWidth:"16",strokeLinecap:"round"}),Q.jsx("path",{d:"M 120 30 A 80 80 0 0 1 180 110",fill:"none",stroke:"#2aa84a",strokeWidth:"16",strokeLinecap:"round"}),Q.jsxs("g",{transform:`translate(100 110) rotate(${m})`,children:[Q.jsx("line",{x1:"0",y1:"0",x2:"0",y2:"-70",stroke:"#222",strokeWidth:"3"}),Q.jsx("circle",{cx:"0",cy:"0",r:"6",fill:"#222"})]}),Q.jsx("text",{x:"20",y:"125",fontSize:"11",fill:"#666",children:"low"}),Q.jsx("text",{x:"92",y:"20",fontSize:"11",fill:"#666",children:"mid"}),Q.jsx("text",{x:"168",y:"125",fontSize:"11",fill:"#666",children:"high"}),Q.jsx("text",{x:"100",y:"90",textAnchor:"middle",fontSize:"16",fontWeight:"700",fill:"#1d2939",children:_})]}),Q.jsxs("div",{className:"mf-gauge-meta",children:[u==null?Q.jsx("div",{className:"muted",children:"No occupancy data"}):Q.jsxs("div",{children:[Q.jsx("b",{children:_})," occupied"]}),Q.jsxs("div",{className:"muted",children:["Occ: ",e," | Vac: ",t," | Unk: ",i]})]})]})},fj=({entries:n=[],maxSlices:e=8})=>{const t=n.slice(0,e),i=n.slice(e).reduce((V,M)=>V+Number(M?.sf||0),0),c=i>0?[...t,{name:"Other",sf:i}]:t,u=c.reduce((V,M)=>V+Number(M?.sf||0),0)||1,m="#94a3b8";let _=0;const o=60,w=60,I=50,O=c.map((V,M)=>{const se=V?.name||"Unknown",ce=Number(V?.sf||0),fe=ce/u,ne=_+fe*Math.PI*2,oe=o+I*Math.cos(_),ye=w+I*Math.sin(_),he=o+I*Math.cos(ne),Ne=w+I*Math.sin(ne),Ve=fe>.5?1:0,de=[`M ${o} ${w}`,`L ${oe} ${ye}`,`A ${I} ${I} 0 ${Ve} 1 ${he} ${Ne}`,"Z"].join(" "),j=se==="Other"?m:Gd(se);return _=ne,{d:de,name:se,sf:ce,color:j}});return Q.jsxs("div",{className:"mf-pie",children:[Q.jsx("div",{className:"mf-section-title",children:"Departments (SF)"}),Q.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[Q.jsx("svg",{width:"120",height:"120",viewBox:"0 0 120 120","aria-label":"Department share by SF",children:O.map((V,M)=>Q.jsx("path",{d:V.d,fill:V.color,stroke:"#fff",strokeWidth:"1"},M))}),Q.jsx("div",{className:"mf-pie-legend",children:O.slice(0,6).map((V,M)=>Q.jsxs("div",{className:"mf-legend-row",children:[Q.jsx("span",{className:"mf-swatch",style:{background:V.color}}),Q.jsx("span",{className:"mf-legend-name",title:V.name,children:V.name}),Q.jsx("span",{className:"mf-legend-sf",children:Math.round(V.sf).toLocaleString()})]},M))})]})]})};function pj({title:n,metrics:e,loading:t,error:i,scopeLabel:c,utilization:u,utilizationScopeLabel:m,heatmapOn:_,onToggleHeatmap:o}){const w=e?.officeOccupancy||{},I=u&&(Number.isFinite(u.timeUtilization)||Number.isFinite(u.seatUtilization));return Q.jsxs("div",{style:{padding:6,width:"100%",display:"flex",flexDirection:"column",height:"100%"},children:[Q.jsx("div",{style:{fontWeight:800,fontSize:13,marginBottom:6},children:n}),t&&Q.jsx("div",{style:{fontSize:12,color:"#667085"},children:"Loading dashboard..."}),i&&Q.jsx("div",{style:{fontSize:12,color:"#b00020"},children:String(i)}),!t&&!i&&e&&Q.jsxs(Q.Fragment,{children:[Q.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) 1.3fr",gap:6},children:[Q.jsx(hj,{label:"Total SF",value:uj(e.totalSf)}),Q.jsx(Ob,{children:Q.jsx(dj,{pct:w.pct,occupied:w.occupied,vacant:w.vacant,unknown:w.unknown,scopeLabel:c})})]}),Q.jsxs("div",{style:{flex:1,overflowY:"auto",paddingRight:4,marginTop:8},children:[Q.jsx(Ob,{children:Q.jsx(fj,{entries:e.byDept||[]})}),I?Q.jsxs(Ob,{style:{marginTop:8},children:[Q.jsx("div",{className:"mf-section-title",children:"Classroom Utilization"}),m?Q.jsx("div",{style:{fontSize:11,color:"#667085",marginTop:-2,marginBottom:6},children:m}):null,Q.jsx(VI,{timePct:u.timeUtilization,seatPct:u.seatUtilization,compact:!0}),Q.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,marginTop:8,fontSize:12},children:[Q.jsx("input",{type:"checkbox",checked:!!_,onChange:O=>o?.(O.target.checked)}),"Classroom Utilization Heat Map"]})]}):null]})]})]})}function qI(n={}){const e=n.area??n.Area??n["Area (SF)"]??n.SF??n.NetArea??n.Area_SF??n.Area_SF??0,t=Number(e);return!Number.isFinite(t)||t<=0?null:t}function h3(n={}){const e=n.occupancyStatus??n["Occupancy Status"]??n.vacancy??n.Vacancy??n.Vacant??n.Occupancy??n.OccupancyStatus??n.Status??"",t=String(e).trim().toUpperCase(),i=typeof e=="string"&&t.length>0||typeof e=="boolean"||typeof e=="number",c=e===!0||t==="VACANT"||t.includes("VACANT")||t.includes("UNOCCUPIED")||t.includes("AVAILABLE"),u=e===!1||t==="OCCUPIED"||t.includes("OCCUPIED");return i?c&&!u?"Vacant":u?"Occupied":"Unknown":(n.occupant??n.Occupant??n.AssignedTo??n.Assignee??"").toString().trim().length>0?"Occupied":"Unknown"}const mj=["Office - Staff","Office - Prof and Admin","Office - Prof & Admin","Office - Prof/Admin","Office - Faculty","Office - Adjunct Faculty","Office - Emeritus Faculty"],$I=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\b(and|&)\b/g," ").replace(/\s+/g," ").trim(),gj=new Set(mj.map($I).filter(Boolean));function yj(n={}){const e=(n.NCES_Type??n.NCES_Type_Desc??n.__roomType??n.RoomTypeName??n.RoomType??n.Type??n.type??"").toString().toLowerCase();return gj.has($I(e))}function _j(n){const e=Array.isArray(n)?n:Array.isArray(n?.features)?n.features:[];let t=0,i=0,c=0;for(const u of e){const m=u?.properties||{};if(!yj(m))continue;const _=h3(m);_==="Occupied"?t+=1:_==="Vacant"?i+=1:c+=1}return{pct:t+i>0?t/(t+i):null,occupied:t,vacant:i,unknown:c,totalOffices:t+i+c}}function vj(n={}){const e=qI(n);if(!e)return null;const t=(n.NCES_Department??n.department??n.Department??n.Dept??"").toString().trim()||"Unspecified",i=(n.NCES_Type??n.NCES_Type_Desc??n.RoomTypeName??n.RoomType??n.Type??n.type??"").toString().trim()||"Unknown",c=h3(n);return{sf:e,dept:t,type:i,occupancy:c}}function xj(n){const e=Array.isArray(n)?n:Array.isArray(n?.features)?n.features:[];let t=0,i=0,c=0,u=0,m=0,_=0;for(const I of e){const O=I?.properties||{},V=qI(O);if(!V)continue;const M=h3(O);M==="Vacant"?(i+=V,m+=1):M==="Occupied"?(t+=V,u+=1):(c+=V,_+=1)}const o=t+i+c,w=u+m+_;return{totalSF:o,totalRooms:w,occupiedSF:t,vacantSF:i,unknownSF:c,occupiedRooms:u,vacantRooms:m,unknownRooms:_,occupancyRate:o>0?t/o:null}}function bj(n=[]){let e=0,t=0;const i=new Map,c=new Map,u=new Map,m=I=>{const O=String(I||"").trim();if(!O)return!1;const V=O.toUpperCase();return/^rec[a-z0-9]{6,}$/i.test(O)?!1:V!=="UNSPECIFIED"&&V!=="UNKNOWN"&&V!=="N/A"&&V!=="NA"};for(const I of n){const O=vj(I?.properties||{});O&&(t+=1,e+=O.sf,m(O.dept)&&i.set(O.dept,(i.get(O.dept)||0)+O.sf),c.set(O.type,(c.get(O.type)||0)+O.sf),u.set(O.occupancy,(u.get(O.occupancy)||0)+O.sf))}const _=(I,O=10)=>Array.from(I.entries()).map(([V,M])=>({name:V,sf:M})).sort((V,M)=>M.sf-V.sf).slice(0,O),o=xj(n),w=_j(n);return{totalSf:e,roomCount:t,byDept:_(i,10),byType:_(c,10),byOccupancy:_(u,6),occupancySummary:o,officeOccupancy:w}}const wj={},{useRef:bo,useEffect:ji,useState:qn,useCallback:nr,useMemo:Fl}=rL,Sj="https://github-stakeholder-ai.onrender.com";function GI(){const n="".trim();return n||(typeof window<"u"&&window.location.hostname.includes("github.io")?Sj:"")}function Ej(){const n=[];for(const[e,t]of Object.entries(u3))n.push(e,t);return["match",["coalesce",["feature-state","department"],["get","department"],["get","Department"],["get","Dept"],["get","NCES_Department"],["get","NCES_Dept"]],...n,"#e6e6e6"]}const Aj=n=>{let e=0;for(let t=0;t<n.length;t++)e=e*31+n.charCodeAt(t)>>>0;return e},dA=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],B5=n=>n?String(n).trim().toLowerCase()==="public corridor"?"#D9D9D9":dA[Aj(String(n).toLowerCase())%dA.length]:"#CCCCCC";function Tj(n){return n?.length?n.map(e=>{const t=e.dept||e.name||e.Dept||e.Department;return t?`<div style="display:flex;align-items:center;gap:8px;margin:3px 0;">
        <span style="width:14px;height:14px;border-radius:3px;background:${Gd(t)};border:1px solid #00000022"></span>
        <span>${t}</span>
      </div>`:""}).filter(Boolean).join(""):""}const fA=(n,e,t)=>Math.max(e,Math.min(n,t)),Ij=n=>n instanceof Element?!!n.closest('button, a, input, select, textarea, [role="button"]'):!1,gy=(n,e,t,i)=>{if(n.button!==0||Ij(n.target))return;const c=e.current;if(!c||!i)return;const u=i();if(!u)return;n.preventDefault(),n.stopPropagation();const m=c.getBoundingClientRect(),_=n.clientX-m.left,o=n.clientY-m.top,w=8,I=document.body.style.userSelect,O=(se,ce)=>{const fe=se-u.left-_,ne=ce-u.top-o,oe=Math.max(w,u.width-m.width-w),ye=Math.max(w,u.height-m.height-w);t({x:fA(fe,w,oe),y:fA(ne,w,ye)})},V=se=>{O(se.clientX,se.clientY)},M=()=>{window.removeEventListener("pointermove",V),window.removeEventListener("pointerup",M),window.removeEventListener("pointercancel",M),document.body.style.userSelect=I};document.body.style.userSelect="none",window.addEventListener("pointermove",V),window.addEventListener("pointerup",M),window.addEventListener("pointercancel",M)},Cj=["Classroom - General (111)","Classroom - Lecture Hall","Classroom - Indoor Amphitheater / Auditorium","Classroom - Multipurpose","Classroom - Service","Classroom - Seminar","Classroom - Dist Ed / Interactive","Classroom - Computer","Classroom - Collaborative","Laboratory - Class","Laboratory - Computer (non-scheduled)","Laboratory - Studio","Laboratory - Service","Laboratory - Open (non-scheduled)","Laboratory - Music Practice (non-scheduled)","Laboratory - Special Nonclass","Special Nonclass Lab Svs","Office - Prof and Admin (310)","Office - Staff (311)","Office - Faculty","Office - Adjunct Faculty","Office - Graduate / Post Doc Students","Office - Service","Office - Research / Non-Faculty","Office - Emeritus Faculty","Office - Other","Office - Waiting / Reception","Office - Student / Organization","Office - Pantry / Kitchenette","Office - Lounge / Lunch Room","Office - File Room","Office - Work Room","Office - Mail Room","Office - Vault","Office - Department / Suite Circulation","Office - Conference Room","Office - Conference Room Service","Office - Library / Reference Room","Office - Collaborative Work Space","Library - Study / Collaborative Area","Library / Testing / Study Room Service","Training / Tutorial Room","Library - Resource Room","Library Circulation or Reference","Library - Stack","Library / Testing / Study - Storage","Library - Open Stack, Study Area","Library - Processing Room","Academic Assistance","Academic Testing","Interview Room","Departmental Library","Recreation - Health or Physical Education","Athletics - Intercollegiate Sports","Spectator Seating","Fitness Area","Recreation - Service","Athletics - Intercollegiate Sports Service","Ice Rink","Swimming Pool","Athletics - Locker Room or Shower Area","Media - Multi Media Production","Media - Television Studio","Media - Radio Station","Media - Newspaper or Publications","Media - Service","Clinic - (Non-Health care)","Clinic - Observation Room (Non-Health care)","Clinic - Service (Non-Health care)","Clinic - Interview Room (Non-Health care)","Demonstration","Demonstration Service","Special Use - Other (All Purpose)","Public Performance / Assembly","Auditorium","Multi-Purpose Room","Dressing Room","Checkroom","Assembly Room Service (All Types)","Gallery","Museum","Exhibition / Display","Museum / Display / Exhibit Service","Dining / Food Facility","Vending","Dining / Food Service","Kitchen","Dry Food Storage","Cold Food Storage","Lounge - Public","Lounge - Faculty","Lounge - Staff","Lounge - Student","Lounge - Service","Merchandising","Bookstore","Merchandising Service","Recreation - General Use","Recreation Service - General Use","General - Locker Room","General - Locker Room (All Gender)","General - Locker Room Service","Computing or Networking (Central)","Telecom Room (Central)","Telecom / Audio / Video Room","Server Room","IT / Telecom / Network Service","Shop","Shop Service","Storage Room - Central","Storage Room - General","Vehicle / Equipment Storage","Vehicle / Equipment Storage Service","Central Services","Laundry - Central","Central Service Support","Hazardous Materials","Hazardous Materials Service","Parking Garage","Parking Garage Service","Patient Bedroom","Patient Bedroom Service","Health Care - Nurse Station","Utility Room","Record Room","Health Care - Recovery Room","Health Care - Treatment / Examination","Procedure Room","Health Care - Examining Room","Health Care - Therapy Room","Recreation Room","Health Care - Treatment / Examination Service","Health Care - X-Ray Treatment Room","Pharmacy","Health Care - Miscellaneous Storage","Health Care - Patient Reception","Dorm - Sleep / Study NO Toilet & Bath","Dorm - Bedroom Closet","Dorm - Lounge / Study Room","Dorm - Hallway","Dorm - Living Room","Dorm - Toilet or Bath","Sleep / Study WITH Toilet & Bath","Staff Quarters With Bath","Sleep / Study Service","Residence - Laundry","Residence - Storage Room","Apartment - Whole Building","Apartment - Whole Unit","Apartment - Bedroom","Apartment - Closet","Apartment - Living Room","Apartment - Service","Apartment - Kitchen","Apartment - Hallway","Apartment - Bathroom","Apartment - Storage","House","Rental House","Visiting/Special Residence","Other University Residence","Vacant - Assigned","Inactive Area","Available Unassigned","Alteration or Conversion Area","Unfinished Area","Clear Story (open to below)","Leased to Others","Unknown / No Data","Public Corridor","Non-Public Corridor","Lobby","Stairway","Escalator","Elevators","Vestibule","Ramp","Receiving / Loading Dock","Exterior Space - Covered","Commons Area","Custodial Area","Custodial Storage","Custodial Locker Room","Utility Room","Building Storage","Women's Restroom","Men's Restroom","Single Stall Restroom","Private Restroom","Trash / Recycle Room","Nursing / Lactation Room","Emergency Management Command Room","Mechanical Area","Mechanical Duct / Chase or Shaft Area","Interior Incinerator","Central Utility Plant Facility","Electrical Equipment Area","Structural Area","Storage Room - General","Testing"],d3=["Teacher Education","Business Office","Registrar","VPAA - Academic Admin","Chaplain","Financial Aid","Facilities","HR","Music","Open","Physical Education","Admissions","IT","Library","Student Accounts","Student Engagement","Health Center","Biology","Chemistry","Physics","Psychology","History, Religion, Philosophy","Languages & Literatures","Math","Art","Digital Art","Communication","Academic Support","Athletics","Esports","Forensics","CIO","CFO","President Office","Alumni & Foundation","Business Economics","Classroom","Creighton Coll of Nursing","Admin-General","Bronco Blend"],sa=n=>(n??"").toString().trim(),Wg=n=>{if(n==null)return"";if(typeof n=="string"||typeof n=="number")return String(n).trim();if(typeof n=="object"){const e=n.id??n.floorId??n.floor??n.name??n.label??n.value??"";return e!=null?String(e).trim():""}return String(n).trim()},Mg=(n,e)=>{if(!n)return null;const t=typeof n=="object"?n.id??n.buildingId??n.name??n.label??n.value??"":n;return t?e(t):null};function Fy(n={}){return n.Department||n.department||n.Dept||n.NCES_Department||n.NCES_Department||n["Department Owner Text"]||""}function Pf(n={},e=[]){if(!n||!Array.isArray(e))return null;for(const t of e){const i=n[t];if(i!=null&&String(i).trim()!=="")return i}return null}function Lj(n,e,t){const i=(n||"").toString().trim(),c=sa(e),u=sa(t);return c&&u?`${c} - ${u} ${i}`.trim():c?`${c} ${i}`.trim():i||""}function WI(n,e={}){const t=sa(n);if(!t)return null;const i=sa(e.typeDesc??e.typeLabel??e.typeName),c=Lj(i||t,e.categoryCode,e.typeCode)||t;return{value:t,label:c}}function Pj(n=[]){const e=new Map;return(n||[]).forEach(t=>{const i=WI(t);i&&e.set(i.value,i)}),Array.from(e.values()).sort((t,i)=>t.label.localeCompare(i.label))}function kj(n=[],e=[]){const t=new Map;return(n||[]).forEach(i=>{i?.value&&t.set(i.value,i)}),(e||[]).forEach(i=>{i?.value&&t.set(i.value,i)}),Array.from(t.values()).sort((i,c)=>i.label.localeCompare(c.label))}function HI(n,e=.35){if(!n)return`rgba(255,165,0,${e})`;const t=n.replace("#","");if(!/^[0-9a-fA-F]+$/.test(t))return`rgba(255,165,0,${e})`;const i=parseInt(t,16);if(Number.isNaN(i))return`rgba(255,165,0,${e})`;const c=i>>16&255,u=i>>8&255,m=i&255;return`rgba(${c},${u},${m},${e})`}function XI(n={}){const e=Pf(n,["RoomCategory","Category","CategoryCode","rm_cat","rm_cat_id","NCES_Category","NCES Category","NCES_Category_Code","NCES Category Code"]);return e?String(e).trim():null}function Bb(n={}){const e=n.seatCount??n.SeatCount??n["Seat Count"]??n.Seats??n.Capacity??n.rm_seats??n.SeatingCapacity??n["NCES_Seat Count"]??n.NCES_Seat_Count??n["NCES_Seat Count"]??n.NCES_SeatCount??null,t=Number(e);return Number.isFinite(t)&&t>0?t:null}function KI(n){if(!n)return!1;const e=String(n).trim();return e.length>0&&e.startsWith("3")}function Mj(n){if(!n)return!1;const t=String(n).trim().charAt(0);return t==="1"||t==="2"}function ZI(n={}){const e=Pf(n,["RoomType","roomType","Name","type","RoomTypeName","NCES_Type Description_Sh","NCES_Type Description","NCES Type Description","NCES_Type Description_Short"])??"",t=String(e).toLowerCase(),i=t.includes("office"),c=t.includes("classroom")||t.includes("lab")||t.includes("studio");return{norm:t,isOfficeText:i,isTeachingText:c}}function n_(n={}){const e=Pf(n,["FeatureClass","featureClass","Layer","layer","Type","type","Feature","feature","Name","name"])??"",t=String(e).toLowerCase();return t.includes("door")||t.includes("entrance")?"door":t.includes("stair")?"stair":"room"}function Rj(n){const e=new Map,t=new Set(d3.map(sa)),i=_=>Pf(_,["NCES_Category","NCES Category","NCES_Category_Code","NCES Category Code"]),c=_=>Pf(_,["NCES_Type","NCES Type","NCES_Type_Code","NCES Type Code"]),u=_=>Pf(_,["NCES_Type Description_Sh","NCES_Type Description","NCES Type Description","NCES_Type Description_Short"]),m=(_,o={})=>{const w=WI(_,o);w&&e.set(w.value,w)};for(const _ of n||[]){const o=_.properties||{},w=sa(nd(o)),I=sa(o.department??o.Department??o.Dept),O=i(o),V=c(o),M=u(o);w&&m(w,{categoryCode:O,typeCode:V,typeDesc:M}),I&&t.add(I)}return{typeOptions:Array.from(e.values()).sort((_,o)=>_.label.localeCompare(o.label)),deptOptions:Array.from(t).filter(Boolean).sort()}}function Nj(n,e={}){if(!n||!Array.isArray(n.features)||!n.features.length)return null;const t=Eu(n);if(!t||t.some(de=>!Number.isFinite(de)))return null;const i=720,c=t[2]-t[0],u=t[3]-t[1];if(c<=0||u<=0)return null;const m=u/c,_=Math.max(260,Math.round(i*Math.max(.33,Math.min(m,2.5)))),o=document.createElement("canvas");o.width=i,o.height=_;const w=o.getContext("2d");w.fillStyle="#ffffff",w.fillRect(0,0,i,_);const I=de=>{const j=(de[0]-t[0])/c*i,D=_-(de[1]-t[1])/u*_;return[j,D]},O=de=>{if(!Array.isArray(de))return;w.beginPath();const j=I(de[0]);w.moveTo(j[0],j[1]);for(let D=1;D<de.length;D++){const $=I(de[D]);w.lineTo($[0],$[1])}w.closePath()},V=de=>{if(!Array.isArray(de))return;w.beginPath();const j=I(de[0]);w.moveTo(j[0],j[1]);for(let D=1;D<de.length;D++){const $=I(de[D]);w.lineTo($[0],$[1])}},M=de=>sa(de?.department??de?.Department??de?.Dept??"")||"",se=de=>{if(Number.isFinite(de))return de;const j=Number(de);return Number.isFinite(j)?j:de!=null?String(de):null},ce=new Set((e?.selectedIds||[]).map(de=>se(de)).filter(de=>de!=null)),fe=e?.solidFill===!0,ne=e?.labelOptions||{},oe=ne.enabled!==!1,ye=ne.hideDrawing===!0,he={font:ne.font||'bold 10px "Open Sans", Arial, sans-serif',lineHeight:ne.lineHeight||12,maxLines:ne.maxLines||4,minWidth:ne.minWidth||32,minHeight:ne.minHeight||14},Ne=(de,j,D,$)=>{const z=[],W=Z=>{const Ee=sa(Z);Ee&&(ye&&Ee.toLowerCase()==="drawing"||z.length>=he.maxLines||z.push(Ee))};return W(de?.Number??de?.RoomNumber??de?.number),W(nd(de)||de?.Name),W(j||D),$>0&&W(`${Math.round($).toLocaleString()} SF`),z},Ve=(de,j)=>{if(!oe||!j.length)return;const $=tc(de)?.geometry?.coordinates;if(!$)return;const z=Eu(de);if(!z)return;const W=(z[2]-z[0])/c*i,Z=(z[3]-z[1])/u*_,Ee=he.lineHeight*j.length;if(W<he.minWidth||Z<Math.max(Ee,he.minHeight))return;const[ke,Oe]=I($),Re=he.lineHeight*j.length,be=Oe-Re/2+he.lineHeight/2;w.save(),w.font=he.font,w.textAlign="center",w.textBaseline="middle",w.lineJoin="round",w.fillStyle="#101010",w.strokeStyle="rgba(255,255,255,0.95)",w.lineWidth=3;for(let De=0;De<j.length;De+=1){const Qe=be+De*he.lineHeight;w.strokeText(j[De],ke,Qe),w.fillText(j[De],ke,Qe)}w.restore()};for(const de of n.features){const j=de?.properties||{},D=n_(j),$=sa(j?.scenarioDepartment??j?.ScenarioDepartment??j?.scenarioDept??""),z=M(j),W=$||z,Z=j?.__roomType||nd(j)||j?.Name||"",Ee=(j?.occupant??j?.Occupant??"").toString().trim(),ke=e?.colorMode||"department";let Oe="#f7f7f7";ke==="type"?Oe=B5(Z):ke==="occupancy"?Oe=Ee?"#29b6f6":"#e0e0e0":ke==="vacancy"?Oe=Ee?"#29b6f6":"#ff7043":Oe=W?Gd(W):"#f7f7f7";let Re=Oe?HI(Oe,fe?1:$?.9:.4):"#f7f7f7",be="#2b2b2b",De=D==="room"?2.2:1.5;const Qe=se(de?.id??j?.RevitId??j?.Revit_UniqueId??j?.RevitUniqueId??j?.Revit_UniqueID??j?.["Revit Unique Id"]??j?.["Room GUID"]??j?.roomGuid??j?.id),xe=Qe!=null&&ce.has(Qe);D==="door"?(Re="#1d1d1d",be="#0d0d0d",De=1.5):D==="stair"?(Re="#6b6b6b",be="#3a3a3a",De=1.5):Oe&&(be="#202020"),xe&&(D==="room"&&(Re="rgba(0, 200, 255, 0.35)"),be="#00c8ff",De=4);const ae=de?.geometry;if(!ae||!ae.coordinates)continue;const Me=(et,mt)=>{Array.isArray(et)&&(mt==="Polygon"?(w.fillStyle=Re,w.strokeStyle=be,w.lineWidth=De,et.forEach(ht=>{O(ht),w.fill(),w.stroke()})):mt==="MultiPolygon"?et.forEach(ht=>Me(ht,"Polygon")):mt==="LineString"?(w.strokeStyle=be,w.lineWidth=D==="door"?2:1.5,V(et),w.stroke()):mt==="MultiLineString"&&et.forEach(ht=>Me(ht,"LineString")))};Me(ae.coordinates,ae.type);const Fe=Number(j?.Area_SF??j?.Area??j?.["Area (SF)"]??j?.Area_sf??j?.NetArea??j?.SF??0),Ze=Number.isFinite(Fe)&&Fe>0?Fe:0;if(D==="room"){const et=Ne(j,$,z,Ze);Ve(de,et)}}return{width:o.width,height:o.height,data:o.toDataURL("image/png")}}function Rg(n={}){const e=n?.fc??n;return e?Nj(e,n):null}const nd=(n={})=>{const e=n["Room Type Description"]??n.RoomTypeDescription??n.roomTypeDescription;if(e&&String(e).trim())return String(e).trim();const t=n.NCES_Type??n["NCES Type"]??n["NCES Types"]??n.NCES_Types??n.nces_type??n.ncesType;if(t&&String(t).trim())return String(t).trim();const i=n["NCES_Type Description_Sh"]??n["NCES_Type Description"]??n["NCES Type Description"]??n["NCES_Type Description_Short"]??n["NCES Type Description Short"];return i&&String(i).trim()?String(i).trim():(n["Room Type"]||n.RoomType||n.RoomTypeName||n.Type||n.type||n.Category||n.category||n.Name||n["Room Name"]||"").toString().trim()};function f3(n={}){return(n.NCES_Type??n["NCES Types"]??n.NCES_Types??n.nces_type??n.ncesType??"").toString().trim()}function YI(n={}){return(n.NCES_Department??n.NCES_Department??n.NCES_Dept??n["NCES Dept"]??n.department??n.Department??n.Dept??"").toString().trim()}function JI(n={}){const e=n.Area_SF??n.Area_SF??n.area??n.Area??n.SF??n["Area (SF)"]??n.NetArea??0,t=Number(e);return Number.isFinite(t)?t:0}function Dj(n){if(!n?.features?.length)return n;const e=n.features.map(t=>{const i=t?.properties||{};if("__roomType"in i)return t;const c=f3(i),u=c&&String(c).trim();return u?{...t,properties:{...i,__roomType:u}}:t});return{...n,features:e}}function QI(n){if(!n)return null;const e=n.anchor_feet||n.anchorFeet||n.anchor;return[n.target_lon??n.targetLon,n.target_lat??n.targetLat,n.rotation_deg_cw??n.rotation_deg,n.scale_deg_per_foot??n.scale_deg_per_ft??n.scale,Array.isArray(e)?e.join(","):""].map(i=>i==null?"":String(i)).join("|")}const Fj="mfDrawingAlign:",Oy=new Map,e8="mfFloorAdjust:",t8="mfFloorAdjustUrl:",n8="mfFloorAdjustFloor:",By=new Map,zy=new Map,jy=new Map;function p3(n,e){const t=Wc(n||""),i=ec(e||"");return`${Fj}${t}/${i}`}function ox(n,e){const t=Wc(n||""),i=ec(e||"");return`${e8}${t}/${i}`}function sx(n){const e=Wc(n||"");return`${t8}${e}`}function ax(n,e){const t=n?Sd(n):"",i=Wc(t||n||""),c=ec(e||"");return`${n8}${i}/${c}`}function r8(n){return n?[n.rotationDeg,n.scale,Array.isArray(n.pivot)?n.pivot.join(","):"",Array.isArray(n.target)?n.target.join(","):""].map(t=>t==null?"":String(t)).join("|"):null}function i8(n,e){const t=p3(n,e);if(!t)return null;if(Oy.has(t))return Oy.get(t);if(typeof window>"u"||!window.localStorage)return null;try{const i=window.localStorage.getItem(t);if(!i)return null;const c=JSON.parse(i);return!c||!Array.isArray(c.pivot)||!Array.isArray(c.target)?null:(Oy.set(t,c),c)}catch{return null}}function Mm(n,e){const t=ox(n,e);if(!t)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};if(By.has(t))return By.get(t);if(typeof window>"u"||!window.localStorage)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};try{const i=window.localStorage.getItem(t);if(!i)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};const c=JSON.parse(i),u=Number(c?.rotationDeg),m=Number(c?.scale),_=Array.isArray(c?.translateMeters)?c.translateMeters:[0,0],o=Array.isArray(c?.translateLngLat)?c.translateLngLat:null,w=Number(c?.savedAt),I=Array.isArray(c?.pivot)?c.pivot:null,O=Array.isArray(c?.anchorLngLat)?c.anchorLngLat:null,V={rotationDeg:Number.isFinite(u)?u:0,scale:Number.isFinite(m)&&m>0?m:1,translateMeters:[Number.isFinite(_[0])?_[0]:0,Number.isFinite(_[1])?_[1]:0],translateLngLat:Array.isArray(o)?[Number.isFinite(o[0])?o[0]:0,Number.isFinite(o[1])?o[1]:0]:null,anchorLngLat:Array.isArray(O)?[Number.isFinite(O[0])?O[0]:0,Number.isFinite(O[1])?O[1]:0]:null,savedAt:Number.isFinite(w)?w:0,pivot:Array.isArray(I)&&I.length>=2?I:null};return By.set(t,V),V}catch{return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0}}}function Ay(n){const e=sx(n);if(!e)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};if(zy.has(e))return zy.get(e);if(typeof window>"u"||!window.localStorage)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};try{const t=window.localStorage.getItem(e);if(!t)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};const i=JSON.parse(t),c=Number(i?.rotationDeg),u=Number(i?.scale),m=Array.isArray(i?.translateMeters)?i.translateMeters:[0,0],_=Array.isArray(i?.translateLngLat)?i.translateLngLat:null,o=Number(i?.savedAt),w=Array.isArray(i?.pivot)?i.pivot:null,I=Array.isArray(i?.anchorLngLat)?i.anchorLngLat:null,O={rotationDeg:Number.isFinite(c)?c:0,scale:Number.isFinite(u)&&u>0?u:1,translateMeters:[Number.isFinite(m[0])?m[0]:0,Number.isFinite(m[1])?m[1]:0],translateLngLat:Array.isArray(_)?[Number.isFinite(_[0])?_[0]:0,Number.isFinite(_[1])?_[1]:0]:null,anchorLngLat:Array.isArray(I)?[Number.isFinite(I[0])?I[0]:0,Number.isFinite(I[1])?I[1]:0]:null,savedAt:Number.isFinite(o)?o:0,pivot:Array.isArray(w)&&w.length>=2?w:null};return zy.set(e,O),O}catch{return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0}}}function Ty(n,e){const t=ax(n,e);if(!t)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};if(jy.has(t))return jy.get(t);if(typeof window>"u"||!window.localStorage)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};try{const i=window.localStorage.getItem(t);if(!i)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};const c=JSON.parse(i),u=Number(c?.rotationDeg),m=Number(c?.scale),_=Array.isArray(c?.translateMeters)?c.translateMeters:[0,0],o=Array.isArray(c?.translateLngLat)?c.translateLngLat:null,w=Number(c?.savedAt),I=Array.isArray(c?.pivot)?c.pivot:null,O=Array.isArray(c?.anchorLngLat)?c.anchorLngLat:null,V={rotationDeg:Number.isFinite(u)?u:0,scale:Number.isFinite(m)&&m>0?m:1,translateMeters:[Number.isFinite(_[0])?_[0]:0,Number.isFinite(_[1])?_[1]:0],translateLngLat:Array.isArray(o)?[Number.isFinite(o[0])?o[0]:0,Number.isFinite(o[1])?o[1]:0]:null,anchorLngLat:Array.isArray(O)?[Number.isFinite(O[0])?O[0]:0,Number.isFinite(O[1])?O[1]:0]:null,savedAt:Number.isFinite(w)?w:0,pivot:Array.isArray(I)&&I.length>=2?I:null};return jy.set(t,V),V}catch{return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0}}}function Oj(n,e,t){const i=p3(n,e);if(!i||!t||typeof window>"u"||!window.localStorage)return!1;try{return window.localStorage.setItem(i,JSON.stringify(t)),Oy.set(i,t),!0}catch{return!1}}function v1(n,e,t){const i=ox(n,e);if(!i||!t||typeof window>"u"||!window.localStorage)return!1;const c=Array.isArray(t.pivot)?t.pivot:null,u=Array.isArray(t.translateLngLat)?t.translateLngLat:null,m=Array.isArray(t.anchorLngLat)?t.anchorLngLat:null,_={rotationDeg:Number.isFinite(t.rotationDeg)?t.rotationDeg:0,scale:Number.isFinite(t.scale)&&t.scale>0?t.scale:1,translateMeters:Array.isArray(t.translateMeters)?[Number.isFinite(t.translateMeters[0])?t.translateMeters[0]:0,Number.isFinite(t.translateMeters[1])?t.translateMeters[1]:0]:[0,0],translateLngLat:Array.isArray(u)?[Number.isFinite(u[0])?u[0]:0,Number.isFinite(u[1])?u[1]:0]:null,anchorLngLat:Array.isArray(m)?[Number.isFinite(m[0])?m[0]:0,Number.isFinite(m[1])?m[1]:0]:null,savedAt:Date.now(),pivot:Array.isArray(c)&&c.length>=2?c:null};try{return window.localStorage.setItem(i,JSON.stringify(_)),By.set(i,_),!0}catch{return!1}}function x1(n,e){const t=sx(n);if(!t||!e||typeof window>"u"||!window.localStorage)return!1;const i=Array.isArray(e.pivot)?e.pivot:null,c=Array.isArray(e.translateLngLat)?e.translateLngLat:null,u=Array.isArray(e.anchorLngLat)?e.anchorLngLat:null,m={rotationDeg:Number.isFinite(e.rotationDeg)?e.rotationDeg:0,scale:Number.isFinite(e.scale)&&e.scale>0?e.scale:1,translateMeters:Array.isArray(e.translateMeters)?[Number.isFinite(e.translateMeters[0])?e.translateMeters[0]:0,Number.isFinite(e.translateMeters[1])?e.translateMeters[1]:0]:[0,0],translateLngLat:Array.isArray(c)?[Number.isFinite(c[0])?c[0]:0,Number.isFinite(c[1])?c[1]:0]:null,anchorLngLat:Array.isArray(u)?[Number.isFinite(u[0])?u[0]:0,Number.isFinite(u[1])?u[1]:0]:null,savedAt:Date.now(),pivot:Array.isArray(i)&&i.length>=2?i:null};try{return window.localStorage.setItem(t,JSON.stringify(m)),zy.set(t,m),!0}catch{return!1}}function b1(n,e,t){const i=ax(n,e);if(!i||!t||typeof window>"u"||!window.localStorage)return!1;const c=Array.isArray(t.pivot)?t.pivot:null,u=Array.isArray(t.translateLngLat)?t.translateLngLat:null,m=Array.isArray(t.anchorLngLat)?t.anchorLngLat:null,_={rotationDeg:Number.isFinite(t.rotationDeg)?t.rotationDeg:0,scale:Number.isFinite(t.scale)&&t.scale>0?t.scale:1,translateMeters:Array.isArray(t.translateMeters)?[Number.isFinite(t.translateMeters[0])?t.translateMeters[0]:0,Number.isFinite(t.translateMeters[1])?t.translateMeters[1]:0]:[0,0],translateLngLat:Array.isArray(u)?[Number.isFinite(u[0])?u[0]:0,Number.isFinite(u[1])?u[1]:0]:null,anchorLngLat:Array.isArray(m)?[Number.isFinite(m[0])?m[0]:0,Number.isFinite(m[1])?m[1]:0]:null,savedAt:Date.now(),pivot:Array.isArray(c)&&c.length>=2?c:null};try{return window.localStorage.setItem(i,JSON.stringify(_)),jy.set(i,_),!0}catch{return!1}}function Bj(n,e){const t=p3(n,e);if(t&&(Oy.delete(t),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(t)}catch{}}function zj(n,e){const t=ox(n,e);if(t&&(By.delete(t),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(t)}catch{}}function jj(n){const e=sx(n);if(e&&(zy.delete(e),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(e)}catch{}}function Uj(n,e){const t=ax(n,e);if(t&&(jy.delete(t),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(t)}catch{}}function Vj(n,e){if(!n?.features?.length||!e)return n;const t=r8(e);if(t&&n.__mfDrawingAlignSignature===t)return n;const i=Array.isArray(e.pivot)?e.pivot:null,c=Array.isArray(e.target)?e.target:null;if(!i||!c)return n;const u=Number.isFinite(e.scale)?e.scale:1,_=(Number.isFinite(e.rotationDeg)?e.rotationDeg:0)*Math.PI/180,o=Math.cos(_),w=Math.sin(_),[I,O]=i,[V,M]=c,se=ne=>{const oe=ne[0]-I,ye=ne[1]-O,he=(oe*o-ye*w)*u,Ne=(oe*w+ye*o)*u;return[V+he,M+Ne]},ce=n.features.map(ne=>!Ah(ne?.properties||{})||!ne?.geometry?ne:{...ne,geometry:{...ne.geometry,coordinates:Ef(ne.geometry.coordinates,se)}}),fe={...n,features:ce};return t&&(fe.__mfDrawingAlignSignature=t),fe}function Ev({buildingLabel:n,buildingId:e,floorBasePath:t,fitBuilding:i}={}){const c=n||e||i?.properties?.id||i?.properties?.name||"",u=np(c)||c;if(u)return u;if(t){const m=Sd(t);if(m)return Kg?.[m]||m}return""}function qj({buildingLabel:n,buildingId:e,floorBasePath:t,fitBuilding:i}={}){const c=t?Sd(t):null;return c||Ev({buildingLabel:n,buildingId:e,floorBasePath:t,fitBuilding:i})}function Av(n){return n?[n.rotationDeg,n.scale,Array.isArray(n.translateMeters)?n.translateMeters.join(","):"",Array.isArray(n.translateLngLat)?n.translateLngLat.join(","):"",Array.isArray(n.anchorLngLat)?n.anchorLngLat.join(","):""].map(t=>t==null?"":String(t)).join("|"):null}function tp(n){return n?Math.abs(n.rotationDeg||0)>1e-6||Math.abs((n.scale||1)-1)>1e-6||Math.abs(n.translateMeters?.[0]||0)>1e-6||Math.abs(n.translateMeters?.[1]||0)>1e-6||Math.abs(n.translateLngLat?.[0]||0)>1e-12||Math.abs(n.translateLngLat?.[1]||0)>1e-12||Math.abs(n.anchorLngLat?.[0]||0)>1e-12||Math.abs(n.anchorLngLat?.[1]||0)>1e-12:!1}function z5({base:n,url:e,label:t}){const i=[{source:"basePath",adjust:n},{source:"url",adjust:e},{source:"label",adjust:t}].filter(m=>m.adjust),c=i.filter(m=>tp(m.adjust));if(c.length){let m=null;for(const _ of c){const o=Number(_.adjust?.savedAt)||0;(!m||o>m.savedAt)&&(m={..._,savedAt:o})}if(m)return m}return i.find(m=>m.source==="label")||i[0]||{source:"label",adjust:null,savedAt:0}}function W1(n){if(!n?.features?.length)return null;try{const e=tc(n)?.geometry?.coordinates||null;return!Array.isArray(e)||e.length<2||!Number.isFinite(e[0])||!Number.isFinite(e[1])?null:e}catch{return null}}function $j(n,e,t){if(!n?.features?.length||!e)return{fc:n,fitTransform:t};const i=Av(e);if(i&&n.__mfUserAdjustSignature===i)return{fc:n,fitTransform:t};const c=Number.isFinite(e.rotationDeg)?e.rotationDeg:0,u=Number.isFinite(e.scale)?e.scale:1,m=Array.isArray(e.translateMeters)?e.translateMeters:[0,0],_=Array.isArray(e.translateLngLat)?e.translateLngLat:null,o=Array.isArray(e.anchorLngLat)?e.anchorLngLat:null;let w=n;const I=(Array.isArray(e.pivot)?e.pivot:null)||t?.scaleOrigin||t?.rotationPivot||tc(w)?.geometry?.coordinates||null;if(Number.isFinite(u)&&Math.abs(u-1)>1e-6&&I&&(w=p0(w,u,{origin:I})),Number.isFinite(c)&&Math.abs(c)>1e-6&&I&&(w=jh(w,c,{pivot:I})),_&&(Math.abs(_[0]||0)>1e-12||Math.abs(_[1]||0)>1e-12)?w=U5(w,_):m&&(Math.abs(m[0]||0)>1e-6||Math.abs(m[1]||0)>1e-6)&&(w=g3(w,m)),o&&Number.isFinite(o[0])&&Number.isFinite(o[1])){const V=W1(w);if(V){const M=o[0]-V[0],se=o[1]-V[1];(Math.abs(M)>1e-12||Math.abs(se)>1e-12)&&(w=U5(w,[M,se]))}}w&&typeof w=="object"&&(w.__mfUserAdjustSignature=i);let O=t;if((Number.isFinite(u)||Number.isFinite(c)||Array.isArray(m))&&(O=O||{rotationDeg:0,rotationPivot:I,scale:1,scaleOrigin:I,translateKm:0,translateBearing:0,nudgeMeters:[0,0],refineRotationDeg:0,refineRotationPivot:I},I&&(Array.isArray(O.rotationPivot)||(O.rotationPivot=I),Array.isArray(O.scaleOrigin)||(O.scaleOrigin=I),Array.isArray(O.refineRotationPivot)||(O.refineRotationPivot=I)),Number.isFinite(u)&&Math.abs(u-1)>1e-6&&(O.scale=(Number.isFinite(O.scale)?O.scale:1)*u),Number.isFinite(c)&&Math.abs(c)>1e-6&&(O.rotationDeg=(Number.isFinite(O.rotationDeg)?O.rotationDeg:0)+c),Array.isArray(m))){const V=Array.isArray(O.nudgeMeters)?O.nudgeMeters:[0,0];O.nudgeMeters=[(Number(V[0])||0)+(Number(m[0])||0),(Number(V[1])||0)+(Number(m[1])||0)]}return{fc:w,fitTransform:O}}function Ah(n={}){return n?String(n.type??n.Type??"").toLowerCase()==="drawing"?!0:n.interactive===!1:!1}function Gj(n,e){if(!n?.geometry||!Array.isArray(e))return e;const t=Ad(n.geometry,4e3);if(!t.length)return e;let i=e,c=1/0;for(const[u,m]of t){const _=u-e[0],o=m-e[1],w=_*_+o*o;w<c&&(c=w,i=[u,m])}return i}function Wj(n,e=4e3){let t=1/0,i=1/0,c=-1/0,u=-1/0,m=0;const _=o=>{if(!(!Array.isArray(o)||m>=e)){if(o.length>=2&&typeof o[0]=="number"&&typeof o[1]=="number"){const w=o[0],I=o[1];w<t&&(t=w),I<i&&(i=I),w>c&&(c=w),I>u&&(u=I),m+=1;return}o.forEach(_)}};return _(n),m?{minX:t,minY:i,maxX:c,maxY:u}:null}function Hj(n,e=.12){if(!n?.features?.length)return n;const t=n.features.filter(ne=>!Ah(ne?.properties||{}));if(!t.length)return n;let i=1/0,c=1/0,u=-1/0,m=-1/0,_=0;for(const ne of t){const oe=Ad(ne?.geometry,4e3);for(const[ye,he]of oe)ye<i&&(i=ye),he<c&&(c=he),ye>u&&(u=ye),he>m&&(m=he),_+=1;if(_>2e4)break}if(!_)return n;const o=Math.max(1e-9,u-i),w=Math.max(1e-9,m-c),I=o*e,O=w*e,V=i-I,M=c-O,se=u+I,ce=m+O,fe=[];for(const ne of n.features){if(!Ah(ne?.properties||{})){fe.push(ne);continue}const oe=Wj(ne?.geometry?.coordinates,4e3);if(!oe)continue;!(oe.maxX<V||oe.minX>se||oe.maxY<M||oe.minY>ce)&&fe.push(ne)}return fe.length===n.features.length?n:{...n,features:fe}}function Xj(n,e={}){if(!n?.features?.length||n.__mfAutoDrawingAlign)return n;const t=n.features.filter(fe=>Ah(fe?.properties||{})),i=n.features.filter(fe=>!Ah(fe?.properties||{}));if(!t.length||!i.length)return n;const c=(fe,ne=2e4)=>{let oe=1/0,ye=1/0,he=-1/0,Ne=-1/0,Ve=0;for(const de of fe){const j=Ad(de?.geometry,Math.max(0,ne-Ve));Ve+=j.length;for(const[D,$]of j)D<oe&&(oe=D),$<ye&&(ye=$),D>he&&(he=D),$>Ne&&(Ne=$);if(Ve>=ne)break}return!Number.isFinite(oe)||!Number.isFinite(ye)||!Number.isFinite(he)||!Number.isFinite(Ne)?null:{minX:oe,minY:ye,maxX:he,maxY:Ne,spanX:he-oe,spanY:Ne-ye,cx:(oe+he)/2,cy:(ye+Ne)/2}},u=c(i),m=c(t);if(!u||!m||!(m.maxX<u.minX||m.minX>u.maxX||m.maxY<u.minY||m.minY>u.maxY))return n;const o=u.spanX>0?m.spanX/u.spanX:0,w=u.spanY>0?m.spanY/u.spanY:0;if(o<.5||o>2||w<.5||w>2)return n;const I=JU(e.buildingLabel,e.floorId);let O=n.features;if(I){const fe=[m.cx,m.cy];O=O.map(ne=>!Ah(ne?.properties||{})||!ne?.geometry?ne:{...ne,geometry:{...ne.geometry,coordinates:Ef(ne.geometry.coordinates,oe=>Iy(oe,fe,180))}})}const V=c(O.filter(fe=>Ah(fe?.properties||{})));if(!V)return n;const M=u.cx-V.cx,se=u.cy-V.cy;if(!Number.isFinite(M)||!Number.isFinite(se))return n;const ce={...n,features:O.map(fe=>!Ah(fe?.properties||{})||!fe?.geometry?fe:{...fe,geometry:{...fe.geometry,coordinates:Ef(fe.geometry.coordinates,([ne,oe])=>[ne+M,oe+se])}})};return ce.__mfAutoDrawingAlign=!0,ce}function zb({map:n,fc:e,isDrawing:t,screenPoint:i,maxPixels:c,maxPoints:u}){if(!n||!e?.features?.length||!i)return null;const m=Number.isFinite(c)?c:null,_=Number.isFinite(u)?u:8e3;let o=null,w=1/0,I=0;for(const O of e.features){const V=O?.properties||{},M=Ah(V),se=O?.geometry?.type||"",fe=M||(se==="LineString"||se==="MultiLineString");if((t?!fe:fe)||!O?.geometry)continue;const ne=Ad(O.geometry,Math.max(0,_-I));I+=ne.length;for(const[oe,ye]of ne){const he=n.project({lng:oe,lat:ye}),Ne=he.x-i.x,Ve=he.y-i.y,de=Ne*Ne+Ve*Ve;de<w&&(w=de,o=[oe,ye])}if(I>=_)break}return o&&(m==null||w<=m*m)?o:null}function Kj(n){if(!n||!Array.isArray(n.features)||n.features.length===0)return n;const e=n.features.filter(t=>!Ah(t?.properties||{}));return e.length===0||e.length===n.features.length?n:{...n,features:e,__mfFitCandidate:!0}}const pA=[{key:"roomA",label:"Click room point A (rooms layer)"},{key:"roomB",label:"Click room point B (rooms layer)"},{key:"drawingA",label:"Click drawing point A (linework)"},{key:"drawingB",label:"Click drawing point B (linework)"}],Zj=40,Yj=140,jb=12e3,o8=wj?"/StakeholderMap/":"/",$d=n=>`${o8}${n}`.replace(/\/{2,}/g,"/"),H1=$d("floorplans/manifest.json"),j5="Hastings",Jj=!1,Hg=["==",["get","Element"],"Room"];async function r_(n){try{const e=await fetch(n,{cache:"no-store"});if(!e.ok)return null;const t=(e.headers.get("content-type")||"").toLowerCase(),i=await e.text();if(t.includes("text/html"))return null;const c=i.replace(/^\uFEFF/,"");try{return JSON.parse(c)}catch{return null}}catch{return null}}async function s8(n){if(!n)return null;try{const e=await fetch(n,{cache:"no-store"});if(!e.ok)return null;const t=(e.headers.get("content-type")||"").toLowerCase(),i=await e.text();if(t.includes("text/html"))return null;try{const c=i.replace(/^\uFEFF/,"");return JSON.parse(c)}catch{return null}}catch{return null}}function m3(n){return n?n.type==="FeatureCollection"&&Array.isArray(n.features)?n:Array.isArray(n.features)?{type:"FeatureCollection",features:n.features}:n.type==="Feature"?{type:"FeatureCollection",features:[n]}:null:null}function X1(n,e){if(!n||!e||n.__mfAffineApplied||_U(n))return n;const t=c8(n,e);return t&&typeof t=="object"&&(t.__mfAffineApplied=!0,t.__mfAffineSignature=QI(e)),t}function a8(n,e,t){if(!n||!Number.isFinite(e)||Math.abs(e)<1e-6||n.__mfRotationOverride===e)return n;try{const i=Array.isArray(t)&&t.length>=2?t:t?.geometry?.coordinates||tc(n)?.geometry?.coordinates||null,c=jh(n,e,i?{pivot:i}:void 0);if(c&&typeof c=="object")return c.__mfRotationOverride=e,i&&(c.__mfRotationPivot=i),n.__mfFitTransform&&(c.__mfFitTransform=n.__mfFitTransform),n.__mfFitted&&(c.__mfFitted=n.__mfFitted),n.__mfFittedBuilding&&(c.__mfFittedBuilding=n.__mfFittedBuilding),n.__mfAffineApplied&&(c.__mfAffineApplied=n.__mfAffineApplied),c}catch{}return n}function Ub(n){if(!n)return null;const e=String(n).split("?")[0],t=e.lastIndexOf("/Rooms/");if(t>=0)return e.slice(0,t);const i=e.lastIndexOf("/");return i>0?e.slice(0,i):null}function g3(n,e){if(!n||!Array.isArray(e)||e.length<2)return n;const t=Number(e[0]),i=Number(e[1]);let c=n;if(Number.isFinite(t)&&Math.abs(t)>1e-6){const u=Math.abs(t)/1e3,m=t>=0?90:270;c=Fm(c,u,m,{units:"kilometers"})}if(Number.isFinite(i)&&Math.abs(i)>1e-6){const u=Math.abs(i)/1e3,m=i>=0?0:180;c=Fm(c,u,m,{units:"kilometers"})}return c}function U5(n,e){if(!n||!Array.isArray(e)||e.length<2)return n;const t=Number(e[0]),i=Number(e[1]);if(!Number.isFinite(t)&&!Number.isFinite(i))return n;const c=u=>[u[0]+(Number.isFinite(t)?t:0),u[1]+(Number.isFinite(i)?i:0)];return{...n,features:(n.features||[]).map(u=>({...u,geometry:u.geometry?{...u.geometry,coordinates:Ef(u.geometry.coordinates,c)}:u.geometry}))}}function l8(n,e){if(!n||!e||n.__mfFitTransformApplied)return n;let t=n;try{const{rotationDeg:i,rotationPivot:c,scale:u,scaleOrigin:m,translateKm:_,translateBearing:o,nudgeMeters:w,refineRotationDeg:I,refineRotationPivot:O}=e;Number.isFinite(i)&&Math.abs(i)>1e-6&&Array.isArray(c)&&(t=jh(t,i,{pivot:c})),Number.isFinite(u)&&u>0&&Math.abs(u-1)>1e-6&&Array.isArray(m)&&(t=p0(t,u,{origin:m})),Number.isFinite(_)&&Number.isFinite(o)&&Math.abs(_)>1e-9&&(t=Fm(t,_,o,{units:"kilometers"})),Array.isArray(w)&&(t=g3(t,w)),Number.isFinite(I)&&Math.abs(I)>1e-6&&Array.isArray(O)&&(t=jh(t,I,{pivot:O}))}catch{}return t&&typeof t=="object"&&(t.__mfFitTransformApplied=!0),t}function K1(n,e){if(!n||!e)return null;try{const t=n.getSource("buildings");let c=(t?._data||t?.serialize?.().data||null)?.features||[];if(!c.length&&typeof n.querySourceFeatures=="function")try{c=n.querySourceFeatures("buildings")||[]}catch{}return yf(c,e)}catch{return null}}function Qj(n,e){if(!n||!Number.isFinite(e)||Math.abs(e)<1e-6||!Array.isArray(n.features)||!n.features.length)return n;const t=Math.PI/180,i=-e*t,c=Math.cos(i),u=Math.sin(i),m=o=>{const w=o*t,I=Math.sin(w),O=Math.cos(w),V=I*c-O*u,M=I*u+O*c;return(Math.atan2(V,M)/t+360)%360};return{...n,features:n.features.map(o=>{const w=o?.properties||{},I=Number(w.bearing_deg);if(!Number.isFinite(I))return o;const O=m(I);return{...o,properties:{...w,bearing_deg:O}}})}}function eU(n,e,t,i={}){if(!n)return n;const c=i.adjustBearings&&Number.isFinite(i.bearingRotationDeg)&&Math.abs(i.bearingRotationDeg)>1e-6;if(!e&&!t&&!c||n.__mfOverlayTransformApplied)return n;let u=n;if(e?.deg!=null&&(u=a8(u,e.deg,e.pivot)),t&&(u=l8(u,t)),i.adjustBearings){const m=(Number.isFinite(i.bearingRotationDeg)?i.bearingRotationDeg:0)+(Number.isFinite(e?.deg)?e.deg:0)+(Number.isFinite(t?.rotationDeg)?t.rotationDeg:0)+(Number.isFinite(t?.refineRotationDeg)?t.refineRotationDeg:0);u=Qj(u,m)}return u&&typeof u=="object"&&(u.__mfOverlayTransformApplied=!0),u}const tU=new Set(["calvin_french_chapel/basement","kiewit/level_2"]);async function Vg(n,e){if(!n||!e)return null;const t=Wc(Sd(n)||""),i=ec(e),u=tU.has(`${t}/${i}`)?[`${n}/${e}_Dept.affine.json`,`${n}/affine.json`]:[`${n}/affine.json`],m=Array.from(new Set([...u,...u.map(_=>{try{return encodeURI(_)}catch{return _}})]));for(const _ of m){const o=await s8(_);if(o)return o}return null}async function nU(n){for(const e of(n||[]).filter(Boolean)){const t=await s8(e);if(t)return{url:e,data:t}}return{url:n?.[0]||"",data:null}}async function rU({basePath:n,floorId:e,skipAffine:t=!1}){const i=[`${n}/Rooms/${e}_Dept_Rooms.geojson`,`${n}/Rooms/${e}_Dept.geojson`,`${n}/${e}_Dept_Rooms.geojson`,`${n}/${e}_Dept.geojson`],[{data:c},u]=await Promise.all([nU(i),t?Promise.resolve(null):Vg(n,e)]),m=m3(c);if(!m)return{rawFC:null,patchedFC:null,affine:null};m.features=(m.features||[]).map(o=>{const w=o?.properties||{},I=f3(w),O=YI(w);return{...o,properties:{...w,__roomType:I||"",__dept:O||"",__areaSf:JI(w)}}});const _=X1(m,u);return{rawFC:m,patchedFC:_,affine:u}}function iU(n,e){function t(i){if(!i)return i;if(typeof i[0]=="number"){const c=i[0],u=i[1];return[e.a*c+e.b*u+e.c,e.d*c+e.e*u+e.f]}return i.map(t)}return{...n,features:n.features.map(i=>({...i,geometry:i.geometry?{...i.geometry,coordinates:t(i.geometry.coordinates)}:i.geometry}))}}function c8(n,e){if(!n||!e)return n;const t=e.anchor_feet||e.anchorFeet||e.anchor;if(!Array.isArray(t)||t.length<2)return n;const i=Number(e.target_lon??e.targetLon),c=Number(e.target_lat??e.targetLat);if(!Number.isFinite(i)||!Number.isFinite(c))return n;const u=Number(e.rotation_deg_cw??e.rotation_deg??0),m=e.effective_scale_deg_per_foot!=null,_=Number(m?e.effective_scale_deg_per_foot:e.scale_deg_per_foot??e.scale_deg_per_ft??e.scale);if(!Number.isFinite(_)||_===0)return n;const o=Number(e.scale_percent??100),w=m?_:_*(Number.isFinite(o)?o/100:1),I=c*Math.PI/180,O=Math.max(1e-9,Math.cos(I)),V=w/O,M=u*Math.PI/180,se=Math.cos(M),ce=Math.sin(M),[fe,ne]=t,oe=V*se,ye=-V*ce,he=i-(oe*fe+ye*ne),Ne=w*ce,Ve=w*se,de=c-(Ne*fe+Ve*ne);return iU(n,{a:oe,b:ye,c:he,d:Ne,e:Ve,f:de})}async function u8(n){for(const e of(n||[]).filter(Boolean))try{const t=await fetch(e,{cache:"no-store"}),i=(t.headers.get("content-type")||"").toLowerCase(),c=await t.text();if(!t.ok||i.includes("text/html"))continue;try{const u=c.replace(/^\uFEFF/,""),m=JSON.parse(u);return{ok:!0,url:e,data:m}}catch{continue}}catch{continue}return{ok:!1,url:n?.[0]||"",error:"No valid JSON response from any candidate URL."}}async function oU({basePath:n,floorId:e,map:t,roomsFC:i,affine:c,rotationOverride:u,fitTransform:m}){if(!n||!e||!t)return;const _=String(e).trim(),o=[`${n}/${_}_-_Map_Export_Walls_RAW.geojson`,`${n}/${_}_Walls_RAW.geojson`,`${n}/${_}_-_Map_Export_Walls.geojson`,`${n}/${_}_Walls.geojson`],w=await ed(o);let I=m3(w);if(!I?.features?.length)return;console.log("[walls] loaded features",I.features.length);function O(ce,fe=20){let ne=0;const oe=ye=>{if(!ye||ne>=fe)return!0;if(typeof ye[0]=="number"&&typeof ye[1]=="number"){const he=ye[0],Ne=ye[1];return ne+=1,Math.abs(he)<=180&&Math.abs(Ne)<=90}for(const he of ye)if(!oe(he))return!1;return!0};for(const ye of ce?.features||[]){if(!oe(ye?.geometry?.coordinates))return!1;if(ne>=fe)break}return ne>0}c&&!O(I)?(I=c8(I,c),console.log("[walls] applied affine")):c&&console.log("[walls] skipped affine (already lon/lat)"),I=eU(I,u,m,{adjustBearings:!1});const M="walls-source",se="walls-layer";t.getSource(M)?t.getSource(M).setData(I):t.addSource(M,{type:"geojson",data:I});try{const ce=Eu(I);console.log("[walls] bbox",ce)}catch{console.log("[walls] first coord",I.features?.[0]?.geometry?.coordinates?.[0]?.[0])}if(!t.getLayer(se)){const ce=t.getLayer(us)?us:void 0;t.addLayer({id:se,type:"line",source:M,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#000","line-width":["interpolate",["linear"],["zoom"],16,.15,18,.25,20,.45],"line-opacity":.25}},ce)}}async function sU({basePath:n,floorId:e,map:t,affine:i,rotationOverride:c,fitTransform:u,roomsFC:m,buildingLabel:_}){}function mA(n,e){if(!e||!Array.isArray(n)||n.length<2)return n;const t=Number(e.target_lon??e.targetLon),i=Number(e.target_lat??e.targetLat),c=Number(e.rotation_deg_cw??e.rotation_deg??0),u=Number(e.effective_scale_deg_per_foot??e.scale_deg_per_foot??e.scale_deg_per_ft??e.scale),m=e.anchor_feet||e.anchorFeet||e.anchor;if(!Number.isFinite(t)||!Number.isFinite(i)||!Number.isFinite(u)||!Array.isArray(m))return n;const _=u,o=_/Math.max(1e-9,Math.cos(i*Math.PI/180)),[w,I]=n,O=(w-t)/o,V=(I-i)/_,M=c*Math.PI/180,se=Math.cos(M),ce=Math.sin(M),[fe,ne]=m;return[se*O+ce*V+fe,-ce*O+se*V+ne]}function Iy(n,e,t){if(!Array.isArray(n)||n.length<2)return n;const[i,c]=n,[u,m]=e||[0,0],_=t*Math.PI/180,o=Math.cos(_),w=Math.sin(_),I=i-u,O=c-m;return[u+o*I-w*O,m+w*I+o*O]}function Ef(n,e){return n&&(typeof n[0]=="number"?e(n):n.map(t=>Ef(t,e)))}function Tm(n){let e=1/0,t=1/0,i=-1/0,c=-1/0;return n.forEach(([u,m])=>{!Number.isFinite(u)||!Number.isFinite(m)||(u<e&&(e=u),m<t&&(t=m),u>i&&(i=u),m>c&&(c=m))}),{minx:e,miny:t,maxx:i,maxy:c,spanX:i-e,spanY:c-t,cx:(e+i)/2,cy:(t+c)/2}}function aU({buildingLabel:n,floorId:e,floorBasePath:t}={}){if(ec(e||"")!=="basement")return!1;if(t&&String(t).includes("/Calvin French Chapel/"))return!0;const c=Yr(n);return c&&[Yr("Calvin French Chapel"),Yr("Calvin H. French Chapel"),Yr("Calvin H. French Memorial Chapel")].includes(c)}function gA({buildingLabel:n,floorId:e,floorBasePath:t}={}){if(ec(e||"")!=="level_3")return!1;if(t&&(()=>{try{return decodeURIComponent(String(t))}catch{return String(t)}})().includes("/Babcock Hall/"))return!0;const c=Yr(n);return c&&[Yr("Babcock Hall"),Yr("Babcock Hall Residence")].includes(c)}function yA(n){let e=0,t=0,i=0;const c=u=>{if(Array.isArray(u)){if(u.length>=2&&typeof u[0]=="number"&&typeof u[1]=="number"){e+=u[0],t+=u[1],i+=1;return}u.forEach(c)}};return(n||[]).forEach(u=>{u?.geometry?.coordinates&&c(u.geometry.coordinates)}),i?[e/i,t/i]:null}function _A(n,e,t){if(!n?.features?.length||n.__mfBabcockL3AutoRotated)return n;const i=90*Math.PI/180,c=Math.cos(i),u=Math.sin(i),m=o=>{const w=o[0],I=o[1];return[w*c-I*u,w*u+I*c]},_=n.features.map(o=>!Ah(o?.properties||{})||!o?.geometry?o:{...o,geometry:{...o.geometry,coordinates:Ef(o.geometry.coordinates,m)}});return{...n,features:_,__mfBabcockL3AutoRotated:!0}}function lU(n,e,t){if(!n?.features?.length||n.__mfBasementFixed)return n;const i=n.features.filter(xe=>Ah(xe?.properties||{})),c=n.features.filter(xe=>!Ah(xe?.properties||{}));if(i.length&&c.length){const xe={type:"FeatureCollection",features:i},ae={type:"FeatureCollection",features:c},Me=Jp(xe,1200)||xe,Fe=Jp(ae,1200)||ae,Ze=qg(Me,2e3),et=qg(Fe,2e3),mt=Tm(Ze),ht=Tm(et),Nt=yA(i)||(mt?[mt.cx,mt.cy]:null),Jt=yA(c)||(ht?[ht.cx,ht.cy]:null);if(mt&&ht&&Nt&&Jt){const tn=Math.max(ht.spanX||0,ht.spanY||0,1e-9);if(Math.hypot(Nt[0]-Jt[0],Nt[1]-Jt[1])>tn*.18){const zt=Xg(Me?.geometry)??0,it=Xg(Fe?.geometry)??0,ur=Y1(it-zt),xr=mt.spanX?ht.spanX/mt.spanX:1,Tr=mt.spanY?ht.spanY/mt.spanY:1;let Tn=1;Number.isFinite(xr)&&Number.isFinite(Tr)&&xr>0&&Tr>0&&(Tn=Math.min(xr,Tr)),Tn=Math.max(.2,Math.min(5,Tn||1));const Yn=ur*Math.PI/180,$n=Math.cos(Yn),hr=Math.sin(Yn),[Wt,Nn]=Nt,[tr,Hn]=Jt,Rr=br=>{const Ir=br[0]-Wt,Bi=br[1]-Nn,Mi=(Ir*$n-Bi*hr)*Tn,pr=(Ir*hr+Bi*$n)*Tn;return[tr+Mi,Hn+pr]},lr=n.features.map(br=>!Ah(br?.properties||{})||!br?.geometry?br:{...br,geometry:{...br.geometry,coordinates:Ef(br.geometry.coordinates,Rr)}}),wr={...n,features:lr};return wr.__mfBasementFixed=!0,wr}}}if(!e||!t)return n;const u=n.features.map((xe,ae)=>{const Me=xe?.geometry?.coordinates;if(!Me)return null;const Fe=Ad({coordinates:Me},1e3);if(!Fe.length)return null;const Ze=Fe.reduce((mt,ht)=>mt+ht[0],0)/Fe.length,et=Fe.reduce((mt,ht)=>mt+ht[1],0)/Fe.length;return{i:ae,c:[Ze,et]}}).filter(Boolean);if(u.length<6)return n;const m=u.map(xe=>xe.c[0]).sort((xe,ae)=>xe-ae),_=m[Math.floor(m.length/2)],o=new Set(u.filter(xe=>xe.c[0]<=_).map(xe=>xe.i));if(!o.size||o.size===n.features.length)return n;const w={type:"FeatureCollection",features:n.features.filter((xe,ae)=>o.has(ae))},I=Jp(w,1200),O=Xg(t?.geometry)??0,V=Xg(I?.geometry)??0,M=Number.isFinite(O)&&Number.isFinite(V)?O-V:0,se=tc(t)?.geometry?.coordinates||null;if(!se)return n;const ce=xe=>Iy(xe,se,-O),fe=xe=>Iy(xe,se,O),ne={type:"Feature",properties:{},geometry:{...t.geometry,coordinates:Ef(t.geometry.coordinates,ce)}},oe=qg(ne,4e3),ye=Tm(oe);if(!Number.isFinite(ye.cx))return n;const he=ye.cx,Ne=r3([[[he-10,ye.miny-10],[he,ye.miny-10],[he,ye.maxy+10],[he-10,ye.maxy+10],[he-10,ye.miny-10]]]),Ve=UI(i3([ne,Ne]));if(!Ve?.geometry)return n;const de={type:"Feature",geometry:{...Ve.geometry,coordinates:Ef(Ve.geometry.coordinates,fe)}},j=qg(de,4e3),D=Tm(j);if(!Number.isFinite(D.minx))return n;const $=Tm([mA([D.minx,D.miny],e),mA([D.maxx,D.maxy],e)]),z=qg(w,4e3),W=Tm(z),Z=[W.cx,W.cy],Ee=z.map(xe=>Iy(xe,Z,M)),ke=Tm(Ee);if(!Number.isFinite(ke.spanX)||!Number.isFinite(ke.spanY))return n;const Oe=Math.min($.spanX/Math.max(1e-9,ke.spanX),$.spanY/Math.max(1e-9,ke.spanY)),Re=[$.cx-ke.cx,$.cy-ke.cy],be=xe=>{const ae=Iy(xe,Z,M),Me=[(ae[0]-ke.cx)*Oe+ke.cx,(ae[1]-ke.cy)*Oe+ke.cy];return[Me[0]+Re[0],Me[1]+Re[1]]},De=n.features.map((xe,ae)=>!o.has(ae)||!xe?.geometry?.coordinates?xe:{...xe,geometry:{...xe.geometry,coordinates:Ef(xe.geometry.coordinates,be)}}),Qe={...n,features:De};return Qe.__mfBasementFixed=!0,Qe}async function cU({basePath:n,floorId:e,map:t,affine:i,rotationOverride:c,fitTransform:u}){}let Vb=0;function h8(n){if(!n||/^https?:\/\//i.test(n))return n;const e=GI();if(!e)return n;const t=e.replace(/\/$/,""),i=n.startsWith("/")?n:`/${n}`,c=i.startsWith("/ai/")?i.replace(/^\/ai/,""):i;return`${t}${c}`}async function Ud(n,e={}){const t=Date.now();if(t<Vb)throw new Error(`Rate limited. Try again in ${Math.ceil((Vb-t)/1e3)}s`);const i=Number(e.timeoutMs),c=Number.isFinite(i)&&i>0?new AbortController:null,u={...e};c&&(u.signal=c.signal),delete u.timeoutMs;let m=null;c&&(m=setTimeout(()=>c.abort(),i));let _;try{_=await fetch(h8(n),u)}finally{m&&clearTimeout(m)}if(_.status===429)throw Vb=Date.now()+6e4,new Error("Rate limited (429). AI paused for 60 seconds.");return _}async function vA(n,e=j5){if(!n)return[];const t=M=>String(M||"").trim().toLowerCase().replace(/[^a-z0-9]/g,""),i=(M=[])=>{const se=Array.isArray(M)?M:M?[M]:[];return se.length?se.map(ce=>{if(typeof ce=="string")return{id:ce,url:null};if(!ce)return null;const fe=Wg(ce.id||ce.floorId||ce.name||ce.label),ne=ce.url||ce.path||null;return fe?{id:fe,url:ne}:null}).filter(Boolean):[]},c=encodeURIComponent(e),u=encodeURIComponent(n),m=$d(`floorplans/${c}/${u}/manifest.json`),_=await r_(m),w=(await r_(H1))?.floorsByBuilding||{};let I=w[n];if(!I){const M=Object.keys(w).find(se=>t(se)===t(n));I=M?w[M]:null}const O=i(I||[]),V=i(_?.floors);if(!V.length)return O;if(O.length&&V.some(M=>!M.url)){const M=new Map(O.filter(se=>se?.id&&se?.url).map(se=>[se.id,se.url]));return V.map(se=>({...se,url:se.url||M.get(se.id)||null}))}return V}const uU={version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:" OpenStreetMap contributors"}},layers:[{id:"osm-base",type:"raster",source:"osm"}]},hU=()=>{if(typeof window>"u")return"";const n=String(window.__MAPBOX_PUBLIC_TOKEN__??"").trim();if(n)return n;try{const e=String(window.localStorage?.getItem("MAPBOX_PUBLIC_TOKEN")??"").trim();if(e)return e}catch{}return""};Vd.accessToken=hU();console.log("Mapbox token length:",(Vd.accessToken||"").length);const xa="floor-source",us="floor-fill",wd="floor-line",hp="floor-drawing",Af="floor-highlight",Xm="floor-highlight-border",mh="floor-room-labels",Tv="floor-doors",Iv="floor-stairs",Cv="walls-source",m0="walls-layer",xA="doors-source",bA="stairs-source",Lv="doors-layer",Pv="stairs-layer",ms=new Map,qu=new Map,qb=new Map,dU=n=>n?/^https?:\/\//i.test(n)||n.startsWith(o8)?n:$d(String(n).replace(/^\//,"")):null;async function fU(n){const e=dU(n);if(!e)return[];if(qb.has(e))return qb.get(e);const t=await r_(e),i=Array.isArray(t?.features)?t.features:[];return qb.set(e,i),i}async function pU(n,e,t){const i=[],c=[...n],u=Math.max(1,Number(e)||1),m=Array.from({length:u},async()=>{for(;c.length;){const _=c.shift();try{i.push(await t(_))}catch(o){console.warn("dashboard fetch failed",_,o)}}});return await Promise.all(m),i}function wA(n){if(!n)return;const e="buildings-fill";if(n.getLayer(e))try{n.setPaintProperty(e,"fill-color",Qh("#ffffff")),n.setPaintProperty(e,"fill-opacity",1),n.setPaintProperty(e,"fill-outline-color","#cbd5e1")}catch{}}const mU={"fill-color":"#e6e6e6","fill-opacity":1};function V5(n,e="department",t={}){if(!n||!n.getLayer(us))return;const i=[">",["length",["coalesce",["to-string",["get","occupant"]],["to-string",["get","Occupant"]],""]],0],u=["upcase",["to-string",["coalesce",["get","occupancyStatus"],["get","Occupancy Status"],["get","OccupancyStatus"],["get","Occupancy"],["get","Vacancy"],["get","vacancy"],["get","Vacant"],""]]],_=["in",["upcase",["to-string",["coalesce",["get","__roomType"],["get","NCES_Type"],["get","RoomType"],["get","Room Type"],["get","Type"],["get","type"],["get","Name"],""]]],["literal",nV]],O=["case",[">",["length",u],0],["case",["any",[">=",["index-of","VACANT",u],0],[">=",["index-of","UNOCCUPIED",u],0],[">=",["index-of","AVAILABLE",u],0],[">=",["index-of","UNASSIGNED",u],0]],"Vacant",[">=",["index-of","OCCUPIED",u],0],"Occupied","Unknown"],i,"Occupied","Unknown"],V=["case",_,["match",O,"Occupied","#29b6f6","Vacant","#ff7043","Unknown","#e0e0e0","#e0e0e0"],"#e6e6e6"],M=["case",_,["match",O,"Vacant","#ff7043","Occupied","#cfd8dc","Unknown","#cfd8dc","#cfd8dc"],"#e6e6e6"];try{e==="occupancy"?n.setPaintProperty(us,"fill-color",V):e==="vacancy"?n.setPaintProperty(us,"fill-color",M):n.setPaintProperty(us,"fill-color",Ej()),n.setPaintProperty(us,"fill-opacity",1)}catch{}}function gU(n){if(!(!n||n.getLayer(Af)))try{n.addLayer({id:Af,type:"fill",source:xa,paint:{"fill-color":"rgba(0,255,255,0.4)","fill-outline-color":"#00ffff"},filter:["==",["id"],-1]},us),n.addLayer({id:Xm,type:"line",source:xa,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00ffff","line-width":6,"line-opacity":1,"line-gap-width":0},filter:["==",["id"],-1]})}catch{}}async function SA(n,e,t){if(!n||!e||!t)return;try{if(n.hasImage(e))return}catch{}const i=await new Promise((c,u)=>{n.loadImage(t,(m,_)=>m?u(m):c(_))});try{n.addImage(e,i,{sdf:!0})}catch(c){console.warn("addImage failed for",e,c)}}function yU(n){if(n)try{n.getLayer(m0)&&n.getLayer(us)&&n.moveLayer(m0,us),n.getLayer(wd)&&n.getLayer(us)&&n.moveLayer(wd),n.getLayer(hp)&&(n.getLayer(mh)?n.moveLayer(hp,mh):n.moveLayer(hp)),n.getLayer(Lv)&&n.moveLayer(Lv),n.getLayer(Pv)&&n.moveLayer(Pv)}catch{}}function EA(n=[],e=[]){const t=[];return n.length&&t.push(["in",["id"],["literal",n]]),e.length&&t.push(["in",["get","RevitId"],["literal",e]]),t.length?t.length===1?t[0]:["any",...t]:["==",["id"],""]}async function ed(n){const e=Array.isArray(n)?n.filter(Boolean):[n].filter(Boolean);if(!e.length)return null;const t=await u8(e);return t.ok?t.data:(console.debug("GeoJSON fetch failed",{tried:e,lastUrl:t.url,error:t.error}),null)}function _U(n){try{if(!n?.features?.length)return!1;const e=Eu(n);if(!e||e.some(o=>!Number.isFinite(o)))return!1;const[t,i,c,u]=e;if(t<-180||c>180||i<-90||u>90)return!1;const m=Math.abs(c-t),_=Math.abs(u-i);return m<=.25&&_<=.25}catch{return!1}}async function vU(n,e,t,i,c={}){if(!n||!e)return;const{buildingId:u,floor:m,roomPatches:_,onOptionsCollected:o,currentFloorContextRef:w,airtableLookup:I}=c,O=c?.roomsBasePath||c?.wallsBasePath,V=c?.roomsFloorId||c?.wallsFloorId||m||null;let M=i?.fitBuilding||null;if(!M&&u&&(M=K1(n,u)),!M&&O){const Wt=Sd(O);Wt&&(M=K1(n,Wt))}if(!M&&O){const Wt=await Hb();if(Wt?.features?.length){const Nn=Sd(O),tr=Kg?.[Nn]||Nn;M=yf(Wt.features,u)||yf(Wt.features,tr)||yf(Wt.features,Nn)||null}}if(!M&&O){const Wt=Sd(O),Nn=Kg?.[Wt]||Wt,Hn=Yr(u||Nn);Hn&&G5.has(Hn)&&(M=K1(n,Nn))}let se=Vy(M);const ce=M?.properties?.id||M?.properties?.name||u||"",fe=Ev({buildingLabel:ce,buildingId:u,floorBasePath:O,fitBuilding:M}),ne=qj({buildingLabel:ce,buildingId:u,floorBasePath:O,fitBuilding:M}),oe=RU({buildingLabel:ce}),ye=YU(ce||u||"",V||m||"")||0,he=O&&V?Ty(O,V):null,Ne=Ay(e),Ve=Mm(ne,V||m),j=z5({base:he,url:Ne,label:Ve}).adjust,D=ye;let $=null,z=null,W=ms.get(e);const Z=i8(fe,V||m),Ee=r8(Z);if(W&&QU(ce||u||"",V||m||"")&&(ms.delete(e),qu.delete(e),W=null),W&&se&&(W.__mfTransformed||W.__mfFitted||W.__mfFitTransform)&&(ms.delete(e),W=null),W&&Number.isFinite(D)&&W.__mfPostRotation!==D&&(ms.delete(e),qu.delete(e),W=null),W&&O&&V&&!oe){const Wt=await Vg(O,V),Nn=QI(Wt);Nn&&W.__mfAffineSignature&&W.__mfAffineSignature!==Nn||Nn&&W.__mfAffineApplied&&!W.__mfAffineSignature?(ms.delete(e),qu.delete(e),W=null):$=Wt}if(W&&!$&&!oe&&V){const Wt=Ub(e);Wt&&($=await Vg(Wt,V))}if(W&&(W.__mfDrawingAlignSignature||Ee)&&W.__mfDrawingAlignSignature!==Ee&&(ms.delete(e),qu.delete(e),W=null),W){const Wt=Av(j);(Wt&&W.__mfUserAdjustSignature&&W.__mfUserAdjustSignature!==Wt||Wt&&W.__mfTransformed&&!W.__mfUserAdjustSignature)&&(ms.delete(e),qu.delete(e),W=null)}if(!W){if(O&&V){const Wt=await rU({basePath:O,floorId:V,skipAffine:oe});if(!Wt.rawFC){console.warn("Floor summary: no data returned",`${O}/${V}_Dept.geojson`);return}if(W=Wt.rawFC,$=Wt.affine,!oe&&!$){const Nn=Ub(e);Nn&&($=await Vg(Nn,V))}if(oe&&($=null),aU({buildingLabel:u,floorId:V,floorBasePath:O})){const Nn=lU(Wt.rawFC,$,M);z=X1(Nn,$)}else if(gA({buildingLabel:u,floorId:V,floorBasePath:O})){const Nn=_A(Wt.rawFC);z=X1(Nn,$)}else z=Wt.patchedFC}else if(W=await ed(e),!W)return;ms.set(e,W)}if(!z){if(z=m3(W)||Uu(W),!z?.features?.length)return;if(!oe&&!$&&V&&(O&&($=await Vg(O,V)),!$)){const Wt=Ub(e);Wt&&($=await Vg(Wt,V))}gA({buildingLabel:u,floorId:V,floorBasePath:O})&&(z=_A(z)),z=X1(z,$)}Z&&(z=Vj(z,Z)),z=Xj(z,{buildingLabel:ce||u||"",floorId:V||m||""}),z=Hj(z),z=Dj(z);const ke=ce||M?.properties?.id||M?.properties?.name||u||"";if(tV(ke,V||m||"")&&(z.__mfNoFit=!0),!M&&O){const Wt=await Hb();if(Wt?.features?.length){const Nn=Sd(O),tr=Kg?.[Nn]||Nn;M=yf(Wt.features,u)||yf(Wt.features,tr)||yf(Wt.features,Nn)||null,se=Vy(M)}}if(!M&&O){const Wt=Sd(O),Nn=Kg?.[Wt]||Wt,Hn=Yr(u||Nn);if(Hn&&G5.has(Hn)){const Rr=await Hb();Rr?.features?.length&&(M=yf(Rr.features,Nn)||yf(Rr.features,Wt)||null,se=Vy(M))}}const Re=Number.isFinite(i?.rotationOverrideDeg)?i.rotationOverrideDeg:null,be=qu.get(e)||{};se&&delete be.fitTransform;let De=null;if(Re!=null){const Wt=be.rotationPivot||tc(z)?.geometry?.coordinates||null;De=Wt?{deg:Re,pivot:Wt}:{deg:Re},!be.rotationPivot&&Wt&&(be.rotationPivot=Wt,qu.set(e,be));const Nn=a8(z,Re,Wt);Nn&&Nn!==z&&(z=Nn,se||ms.set(e,z))}z.features.forEach((Wt,Nn)=>{Wt&&Wt.id==null&&(Wt.id=Wt.properties?.RevitId??Nn)});const Qe=[],xe=[],ae=[],Me=[];z.features.forEach(Wt=>{if(!Wt)return;const Nn=Wt.id??Wt.properties?.RevitId??Wt.properties?.id;if(Nn==null)return;const tr=n_(Wt.properties);tr==="door"?(Qe.push(Nn),Wt.properties?.RevitId!=null&&xe.push(Wt.properties.RevitId)):tr==="stair"&&(ae.push(Nn),Wt.properties?.RevitId!=null&&Me.push(Wt.properties.RevitId))});const Fe=(Wt,Nn)=>{if(!Wt)return;const tr=Nn?.features;if(!(!Array.isArray(tr)||tr.length===0))try{const Hn=selectedBuildingIdRef.current||selectedBuilding||i?.fitBuilding?.properties?.id,Rr=i?.floorLabel||tr[0]?.properties?.Floor||e?.match(/(BASEMENT|LEVEL_\\d+|LEVEL|L\\d+)/)?.[0]||"LEVEL_1";if(Hn){const wr={...floorStatsByBuildingRef.current[Hn]||{},[Rr]:Wt};floorStatsByBuildingRef.current[Hn]=wr,setFloorStatsByBuilding({...floorStatsByBuildingRef.current})}panelBuildingKeyRef.current&&panelBuildingKeyRef.current===Hn&&setPanelStats(lr=>({...lr||{},floor:Wt}))}catch{}};let Ze=cA(z);Fe(Ze,z);const et=Kj(z),mt=et&&et!==z?et:z;let ht=z?.__mfFitTransform||be.fitTransform||null;try{if(M&&zU(mt,M)){const Wt=CU(mt,M);if(Wt?.features?.length){if(ht=Wt.__mfFitTransform||null,mt!==z&&ht){const Nn=l8(z,ht);Nn?.features?.length&&(z.__mfAffineApplied&&(Nn.__mfAffineApplied=z.__mfAffineApplied),z.__mfRotationOverride!=null&&(Nn.__mfRotationOverride=z.__mfRotationOverride),z.__mfRotationPivot&&(Nn.__mfRotationPivot=z.__mfRotationPivot),Nn.__mfFitted=!0,Nn.__mfFittedBuilding=Wt.__mfFittedBuilding||"",Nn.__mfFitTransform=ht,z=Nn)}else z=Wt;W.__mfTransformed=!0,se||ms.set(e,z)}}}catch{}const Nt=ZU(ce||u||"",V||m||"");if(Number.isFinite(Nt)&&Math.abs(Nt-1)>.001){const Wt=ht?.scaleOrigin||tc(z)?.geometry?.coordinates||null;Wt&&(z=p0(z,Nt,{origin:Wt}),ht=ht||{rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:Wt,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null},ht.scale=(Number.isFinite(ht.scale)?ht.scale:1)*Nt,ht.scaleOrigin=Wt,W.__mfTransformed=!0,se||ms.set(e,z))}if(Number.isFinite(D)&&Math.abs(D)>.001){const Wt=ht?.scaleOrigin||ht?.rotationPivot||tc(M||z)?.geometry?.coordinates||null;Wt&&(z=jh(z,D,{pivot:Wt}),ht=ht||{rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:Wt,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null},ht.refineRotationDeg=(Number.isFinite(ht.refineRotationDeg)?ht.refineRotationDeg:0)+D,ht.refineRotationPivot=Wt,W.__mfTransformed=!0,W.__mfPostRotation=D,se||ms.set(e,z))}const Jt=ht?.scaleOrigin||ht?.rotationPivot||tc(z)?.geometry?.coordinates||null;if(j&&tp(j)){const Nn=$j(z,j,ht);Nn?.fc&&Nn.fc!==z&&(z=Nn.fc,ht=Nn.fitTransform||ht,W.__mfTransformed=!0,se||ms.set(e,z))}ht&&(be.fitTransform=ht,qu.set(e,be)),z&&Array.isArray(z.features)&&w&&typeof w=="object"&&(w.current={url:e,buildingId:u,floor:m,fc:z,floorAdjustLabel:ne,floorAdjustFloorId:V||m||"",floorAdjustBasePath:O||null,floorAdjustBasePivot:Jt||null});let tn=z,fn=[];const An=u&&m&&_ instanceof Map,zt=!!I;if(An||zt){const Wt=(z.features||[]).map(Nn=>{const tr=Nn.properties||{};let Hn=tr;if(zt&&n_(tr)==="room"){const lr=T8(tr,I,u,m);lr&&(Hn=Mv(Hn,lr))}if(An){const lr=Nn.id??tr.RevitId??tr.id,wr=qd(u,m,lr),br=_.get(wr);br&&(Hn=Mv(Hn,br))}const Rr=nd(Hn);return{...Nn,properties:{...Hn,__roomType:Rr?String(Rr).trim():Hn.__roomType||""}}});if(tn={...z,features:Wt},typeof o=="function"){const{typeOptions:Nn,deptOptions:tr}=Rj(Wt);o({typeOptions:Nn,deptOptions:tr})}}w&&typeof w=="object"&&(w.current={...w.current||{},buildingId:u,floor:V||m||"",fc:tn}),Array.isArray(tn?.features)&&(fn=tn.features.map(Wt=>{const Nn=Wt?.properties??{},tr=Wt?.id??Nn.RevitId??Nn.id,Hn=u&&m&&tr!=null?qd(u,m,tr):null,Rr=_ instanceof Map&&Hn&&_.get(Hn)||null;return{geo:{...Nn},db:Rr?{...Rr}:null,roomId:Hn||String(tr??"")}}));const it=Array.isArray(tn?.features)&&tn.features.length?cA(tn):null;it&&(Ze=it),Fe(Ze,tn),C8(n);const ur=ph(n,xa);if(ur?ur.setData(tn):n.addSource(xa,{type:"geojson",data:tn,promoteId:"RevitId"}),!n.getLayer(us))n.addLayer({id:us,type:"fill",source:xa,paint:mU,filter:Hg});else try{n.setFilter(us,Hg)}catch{}if(V5(n),gU(n),!eV(ce||u||"",V||m||"")&&Array.isArray(tn?.features)&&tn.features.some(Wt=>Wt?.properties?.interactive===!1||Wt?.properties?.type==="drawing")){const Wt=["downcase",["to-string",["coalesce",["get","Layer"],["get","layer"],["get","FeatureClass"],["get","featureClass"],["get","type"],["get","Type"]]]],tr=["all",["==",["get","interactive"],!1],["!",["any",[">=",["index-of","grid",Wt],0],[">=",["index-of","area-bndy",Wt],0],[">=",["index-of","area bndy",Wt],0]]]];if(!n.getLayer(hp))n.addLayer({id:hp,type:"line",source:xa,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#2f2f2f","line-width":["interpolate",["linear"],["zoom"],16,.15,18,.25,20,.45],"line-opacity":.6},filter:tr});else try{n.setFilter(hp,tr)}catch{}}if(!n.getLayer(wd))n.addLayer({id:wd,type:"line",source:xa,paint:{"line-color":"#444","line-width":["interpolate",["linear"],["zoom"],16,.4,18,.8,20,1.2],"line-opacity":.7},filter:Hg});else try{n.setFilter(wd,Hg)}catch{}if(L8(n),c?.enableWalls&&c?.wallsBasePath){const Wt=c.wallsFloorId||m||e?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||null;await oU({basePath:c.wallsBasePath,floorId:Wt,map:n,roomsFC:tn,affine:$,rotationOverride:De,fitTransform:ht});try{n.setPaintProperty(us,"fill-opacity",.25)}catch{}}const Tn=c?.roomsBasePath||c?.wallsBasePath,Yn=u||i?.fitBuilding?.properties?.id||i?.fitBuilding?.properties?.name||null;if(Tn){const Wt=c?.roomsFloorId||c?.wallsFloorId||m||e?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||null;Wt&&(await sU({basePath:Tn,floorId:Wt,map:n,affine:$,rotationOverride:De,fitTransform:ht||be.fitTransform||null,roomsFC:tn,buildingLabel:Yn}),await cU({basePath:Tn,floorId:Wt,map:n,affine:$,rotationOverride:De,fitTransform:ht||be.fitTransform||null}))}yU(n);const $n=EA(Qe,xe),hr=EA(ae,Me);try{n.getLayer(Tv)&&n.setFilter(Tv,$n),n.getLayer(Iv)&&n.setFilter(Iv,hr)}catch{}try{n.getLayer(Af)&&n.getLayer(wd)&&n.moveLayer(Af,wd)}catch{}if(t!=null&&n.getLayer(Af)){const Wt=Array.isArray(t)?t.filter(tr=>tr!=null):[t],Nn=Wt.length?["any",["in",["id"],["literal",Wt]],["in",["get","RevitId"],["literal",Wt]]]:["==",["id"],""];n.setFilter(Af,Nn),n.getLayer(Xm)&&n.setFilter(Xm,Nn)}try{const Wt=Eu(z);Wt&&isFinite(Wt[0])&&n.fitBounds([[Wt[0],Wt[1]],[Wt[2],Wt[3]]],{padding:40,duration:400})}catch{}return{summary:Ze,rooms:fn}}function Uu(n){return n?n.type==="FeatureCollection"?n:n.type==="Feature"?{type:"FeatureCollection",features:[n]}:n.type==="GeometryCollection"?{type:"FeatureCollection",features:(n.geometries||[]).map(e=>({type:"Feature",geometry:e,properties:{}}))}:n.type&&n.coordinates?{type:"FeatureCollection",features:[{type:"Feature",geometry:n,properties:{}}]}:null:null}function xU(n){if(n==null)return 0;if(typeof n=="number")return n;const e=Number(String(n).replace(/,/g,""));return Number.isFinite(e)?e:0}function op(n={}){if(Number.isFinite(n.areaSF))return Number(n.areaSF);const e=n.Area_SF??n.Area??n["Area SF"];return e==null||e===""?null:xU(e)}function Z1(){return{totalSf:0,rooms:0,classroomSf:0,classroomCount:0,labSf:0,labCount:0,officeSf:0,officeCount:0,deptCounts:new Map}}function bU(n={}){const e=XI(n)||"",t=String(e).trim().charAt(0),i=Pf(n,["NCES_Type","NCES Type","NCES_Type_Code","NCES Type Code"]),c=String(i||"").trim().charAt(0),u=ZI(n),m=(u?.norm||"").toLowerCase(),_=m.includes("classroom")||m.includes("lecture")||t==="1"||c==="1",o=m.includes("lab")||m.includes("laboratory")||m.includes("studio")||t==="2"||c==="2",w=u?.isOfficeText||KI(e);return _?"classroom":o?"lab":w?"office":"other"}function q5(n,e={}){if(!n)return;const t=op(e),i=Number.isFinite(t)?t:0;n.totalSf+=i,n.rooms+=1;const c=bU(e);c==="classroom"?(n.classroomSf+=i,n.classroomCount+=1):c==="lab"?(n.labSf+=i,n.labCount+=1):c==="office"&&(n.officeSf+=i,n.officeCount+=1);const u=sa(Fy(e));u&&n.deptCounts.set(u,(n.deptCounts.get(u)||0)+i)}function y3(n=[]){const e=Z1();return n.forEach(t=>q5(e,t?.properties)),Cy(e)}function Cy(n){if(!n)return null;const t=Array.from((n.deptCounts||new Map).entries()).sort((c,u)=>u[1]-c[1]),i=Object.fromEntries(t);return{totalSf:n.totalSf||0,classroomSf:n.classroomSf||0,labSf:n.labSf||0,officeSf:n.officeSf||0,rooms:n.rooms||0,classroomCount:n.classroomCount||0,labCount:n.labCount||0,officeCount:n.officeCount||0,deptCounts:i,totalsByDept:i,keyDepts:t.slice(0,6).map(([c])=>c)}}function wU(n){const e=String(n||"").trim();if(!e||x3(e))return!1;const t=e.toUpperCase();return t!=="UNSPECIFIED"&&t!=="UNKNOWN"&&t!=="N/A"&&t!=="NA"}function jp(n){const t=Object.entries(n||{}).filter(([i])=>wU(i));return Object.fromEntries(t)}function Ng(n=[]){const e=(n||[]).map(I8).filter(Boolean);if(!e.length)return null;const t=y3(e);if(!t)return null;const i=jp(t.totalsByDept||t.deptCounts||{}),c=Object.entries(i).sort((u,m)=>(m[1]||0)-(u[1]||0));return{...t,deptCounts:i,totalsByDept:i,keyDepts:c.slice(0,6).map(([u])=>u)}}function SU(n=[]){const e=y3(n);if(!e)return null;const t=jp(e.totalsByDept||e.deptCounts||{}),i=Object.entries(t).sort((c,u)=>(u[1]||0)-(c[1]||0));return{...e,deptCounts:t,totalsByDept:t,keyDepts:i.slice(0,6).map(([c])=>c)}}function EU(n,e){const t=(e||"").trim().toLowerCase();if(!t||!Array.isArray(n))return null;let i=0,c=0;const u={},m={};for(const _ of n){const o=_?.properties||{};if(String(Fy(o)||"").trim().toLowerCase()!==t)continue;const I=nd(o)||"Unspecified",O=op(o),V=Number.isFinite(O)?O:Number(o.sf??o.SF??o.AreaSF??o.Area??o.area??o.areaSF??o["Area SF"]??0)||0;c+=1,i+=V,u[I]=(u[I]||0)+1,m[I]=(m[I]||0)+V}return{totalSF:i,rooms:c,roomTypes:u,sfByRoomType:m}}function $b(n,e=1200){return Array.isArray(n)?n.slice(0,e).map((i,c)=>{const u=String(i.buildingName??i.buildingLabel??i.building??"").trim(),m=String(i.floor??i.floorId??"").trim(),_=String(i.roomNumber??i.roomLabel??i.name??"").trim(),o=String(i.roomId??i.revitId??i.id??"").trim(),w=i.roomGuid??i.roomGUID??i.revitUniqueId??i.revitUniqueID??i["Room GUID"]??null,I=[u,m,_].filter(Boolean).join("|")||`room-${c}`,O=o||I,V=String(i.occupant??"").trim(),M=String(i.vacancy??(V?"Occupied":"Unknown")).trim();return{id:O,revitId:i.revitId??w??null,roomGuid:w,roomId:o||I,buildingLabel:u,floorId:m,floorName:m,roomLabel:_,type:String(i.type??i.roomType??"").trim(),sf:Number(i.sf??i.areaSF??i.area??0)||0,department:String(i.department??"").trim(),occupant:V,vacancy:M,occupancyStatus:V?"Occupied":"Vacant",occupantDept:String(i.department??"").trim()||null}}).filter(i=>i.id):null}function d8(n){return Array.isArray(n)?n.map(e=>({id:e?.id??e?.roomId??"",roomId:e?.roomId??e?.id??"",revitId:e?.revitId??e?.roomGuid??null,buildingLabel:e?.buildingLabel??e?.buildingName??e?.building??"",floorId:e?.floorId??e?.floorName??"",floorName:e?.floorName??e?.floorId??"",roomLabel:e?.roomLabel??e?.roomNumber??"",type:e?.type??e?.roomType??"",sf:Number(e?.sf??e?.area??e?.areaSF??0)||0,department:e?.department??""})).filter(e=>e.id||e.roomId):[]}function f8(n,e={}){if(!Array.isArray(n)||n.length===0)return[];const t=Number.isFinite(e.maxTotal)?e.maxTotal:700,i=Number.isFinite(e.maxPerBuilding)?e.maxPerBuilding:120,c=Number.isFinite(e.maxPerType)?e.maxPerType:30,u=d8(n);if(u.length<=t)return u;const m=new Map;for(const I of u){const O=ho(I.buildingLabel||""),V=Km(I.type||"")||"other";m.has(O)||m.set(O,new Map);const M=m.get(O);M.has(V)||M.set(V,[]),M.get(V).push(I)}const _=[],o=(I,O)=>{if(!(!Array.isArray(I)||O<=0)){I.sort((V,M)=>(Number(M.sf)||0)-(Number(V.sf)||0));for(const V of I.slice(0,O))if(_.push(V),_.length>=t)return}};for(const[,I]of m.entries()){if(_.length>=t)break;let O=0;for(const V of I.values()){if(_.length>=t)break;const M=i-O;if(M<=0)break;const se=Math.min(c,M);o(V,se),O+=Math.min(V.length,se)}}if(_.length>=t)return _.slice(0,t);const w=new Set(_.map(I=>I.id||I.roomId));for(const I of u){if(_.length>=t)break;const O=I.id||I.roomId;w.has(O)||(_.push(I),w.add(O))}return _.slice(0,t)}function AU(n=[]){const e={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}};return(n||[]).forEach(t=>{const i=Number(t?.sf??0)||0,c=sa(t?.type??t?.roomType??"Unknown")||"Unknown";e.rooms+=1,e.totalSF+=i,e.roomTypes[c]=(e.roomTypes[c]||0)+1,e.sfByRoomType[c]=(e.sfByRoomType[c]||0)+i}),e}function TU(n,e,t={}){if(!Array.isArray(n)||!e)return n||[];const i=Number.isFinite(t.maxTotal)?t.maxTotal:180,c=Number.isFinite(t.minPerType)?t.minPerType:4,u=Number.isFinite(t.maxPerType)?t.maxPerType:30,m=e?.sfByRoomType||{},_=e?.roomTypes||{},o=Number(e?.totalSF??0)||0,w=Number(e?.rooms??0)||0,I=Object.entries(m).map(([ne,oe])=>{const ye=Km(ne),he=Number(oe||0)||0,Ne=Number(_[ne]||0)||0;return{key:ye,label:ne,sf:he,count:Ne}}).filter(ne=>ne.key);if(!I.length)return f8(n,{maxTotal:i,maxPerBuilding:i,maxPerType:u});I.sort((ne,oe)=>(oe.sf||0)-(ne.sf||0));const O=new Map;I.forEach(ne=>{const oe=o>0?ne.sf/o:0,ye=w>0?ne.count/w:0,he=Math.round(oe*i),Ne=Math.round(ye*i),Ve=Math.max(c,he,Ne);O.set(ne.key,Math.min(u,Ve))});const V=new Map;n.forEach(ne=>{const oe=Km(ne?.type??ne?.roomType??"")||"other";V.has(oe)||V.set(oe,[]),V.get(oe).push(ne)}),V.forEach(ne=>ne.sort((oe,ye)=>(Number(ye.sf)||0)-(Number(oe.sf)||0)));const M=[],se=new Set,ce=ne=>{const oe=String(ne?.roomId??ne?.id??ne?.revitId??"");!oe||se.has(oe)||(M.push(ne),se.add(oe))};for(const ne of I){if(M.length>=i)break;const oe=V.get(ne.key)||[],ye=O.get(ne.key)||0;let he=0;for(const Ne of oe){if(M.length>=i||he>=ye)break;ce(Ne),he+=1}}if(M.length>=i)return M.slice(0,i);const fe=[];V.forEach(ne=>ne.forEach(oe=>{const ye=String(oe?.roomId??oe?.id??oe?.revitId??"");!ye||se.has(ye)||fe.push(oe)})),fe.sort((ne,oe)=>(Number(oe.sf)||0)-(Number(ne.sf)||0));for(const ne of fe){if(M.length>=i)break;ce(ne)}return M.slice(0,i)}function AA(n,e,t,i={}){if(!t||!Array.isArray(e))return{candidates:n||[],added:0};const c=Number(t.totalSF??0)||0;if(!c)return{candidates:n||[],added:0};const u=Number.isFinite(i.targetTolerance)?i.targetTolerance:.1,m=c*(1-u),_=Number.isFinite(i.maxCandidates)?i.maxCandidates:25,o=i.primaryBuilding||"",w=Array.isArray(n)?[...n]:[],I=AU(w);if(I.totalSF>=m||w.length>=_)return{candidates:w,added:0};const O=new Set(w.map(ne=>String(ne?.roomId??ne?.id??ne?.revitId??""))),V=new Map;e.forEach(ne=>{const oe=String(ne?.roomId??ne?.id??ne?.revitId??"");if(!oe||O.has(oe))return;const ye=Km(ne?.type??ne?.roomType??"")||"other";V.has(ye)||V.set(ye,[]),V.get(ye).push(ne)}),V.forEach(ne=>ne.sort((oe,ye)=>p8(oe,ye,o)));const M=Object.entries(t.sfByRoomType||{}).map(([ne,oe])=>({key:Km(ne),label:ne,sf:Number(oe||0)||0})).filter(ne=>ne.key);M.sort((ne,oe)=>{const ye=kv(ne.label),he=kv(oe.label);return ye!==he?ye-he:(oe.sf||0)-(ne.sf||0)});const se=M.map(ne=>ne.key);let ce=0;const fe=(ne,oe)=>!ne||w.length>=_?!1:(w.push({roomId:ne?.roomId??ne?.id??"",id:ne?.id??ne?.roomId??"",revitId:ne?.revitId??ne?.roomGuid??null,buildingLabel:ne?.buildingLabel??"",floorId:ne?.floorId??ne?.floorName??"",floorName:ne?.floorName??ne?.floorId??"",roomLabel:ne?.roomLabel??"",type:ne?.type??"",sf:Number(ne?.sf??0)||0,rationale:oe||"Added to reach baseline target."}),I.totalSF+=Number(ne?.sf??0)||0,ce+=1,!0);for(const ne of se){if(I.totalSF>=m||w.length>=_)break;const oe=V.get(ne)||[];for(;oe.length&&I.totalSF<m&&w.length<_;){const ye=oe.shift();fe(ye,"Added to better match baseline room-type mix.")}}if(I.totalSF<m&&w.length<_){const ne=[];V.forEach(ye=>ye.forEach(he=>ne.push(he)));const oe=m8(ne,o);for(const ye of oe){if(I.totalSF>=m||w.length>=_)break;fe(ye,"Added to reach baseline total SF.")}}return{candidates:w,added:ce}}function Gb(n){return n&&String(n).replace(/^\s*vacant\s*[:\-]\s*/i,"").replace(/^\s*vacant\?\s*[:\-]\s*/i,"").replace(/\bvacancy status\b/ig,"availability").replace(/\bvacant\b/ig,"available")}const kv=n=>{const e=String(n??"").toLowerCase();return e?/(office|workstation|admin|faculty|staff|suite|open office)/i.test(e)?0:/(lab|laboratory|studio|shop|clinic|research)/i.test(e)?2:/(classroom|lecture|seminar|training|teaching)/i.test(e)?3:1:1},TA=n=>/(lab|laboratory|studio|shop|clinic|research)/i.test(String(n??"")),IA=n=>/(classroom|lecture|seminar|training|teaching)/i.test(String(n??"")),CA=n=>ho(n?.buildingLabel??n?.buildingName??n?.building??""),p8=(n,e,t)=>{const i=ho(t||""),c=CA(n),u=CA(e);if(i){const I=c===i;if(I!==(u===i))return I?-1:1}const m=Number(n?.sf??n?.area??n?.areaSF??0)||0,_=Number(e?.sf??e?.area??e?.areaSF??0)||0;if(m!==_)return _-m;const o=kv(n?.type??n?.roomType??""),w=kv(e?.type??e?.roomType??"");return o!==w?o-w:0},m8=(n,e)=>{if(!Array.isArray(n))return[];const t=[...n];return t.sort((i,c)=>p8(i,c,e)),t},LA=(n=[])=>{if(!Array.isArray(n)||!n.length)return"";const e=new Map;return n.forEach(t=>{const i=sa(t?.buildingLabel||"");if(!i)return;const c=Number(t?.sf??t?.area??t?.areaSF??0)||0;e.set(i,(e.get(i)||0)+c)}),Array.from(e.entries()).sort((t,i)=>i[1]-t[1])[0]?.[0]||""};function ph(n,e){try{const t=n?.getSource(e);return t&&typeof t.setData=="function"?t:null}catch{return null}}function IU(n,e="",t="",i=1200){return Array.isArray(n)?n.slice(0,i).map((c,u)=>{const m=c?.properties||{},_=c?.id??m.RevitId??m.id??m.roomId??m.RoomId,o=String(m.roomNumber??m.RoomNumber??m.Number??m.Room??m.Name??"").trim(),w=nd(m)||"Unknown",I=String(m.department??m.Department??m.Dept??"").trim(),O=String(m.occupant??m.Occupant??"").trim(),V=op(m),M=Number.isFinite(V)?V:Number(m.sf??m.SF??m.AreaSF??m.Area??m.area??0)||0,se=[e,t||m.Floor,o||u].filter(Boolean).join("|")||`feat-${u}`,ce=String(_??"").trim()||se;return{id:ce,revitId:m.RevitId??_??null,roomId:ce,buildingLabel:e||String(m.buildingLabel??m.Building??m.building??"").trim(),floorId:t||String(m.floorId??m.floor??m.Floor??"").trim(),floorName:t||String(m.floorId??m.floor??m.Floor??"").trim(),roomLabel:o,type:w,sf:M,department:I,occupant:O,vacancy:O?"Occupied":"Unknown",occupancyStatus:O?"Occupied":"Vacant",occupantDept:I||null}}).filter(c=>c.id):null}const PA=async(n,e)=>{const{ensureFloorsForBuilding:t,buildFloorUrl:i,floorCache:c,fetchGeoJSON:u}=e||{},m=(n||"").trim();if(!m)return{perBuilding:{},campusTotals:null};const _=m.toLowerCase(),o={},w={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}};for(const I of td){const O=I?.name;if(!O)continue;let V=await t(O);if(!V?.length)continue;const M={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}};for(const se of V){const ce=i(O,se);if(!ce)continue;let fe=c.get(ce);if(!fe)try{fe=await u(ce),fe&&c.set(ce,fe)}catch{continue}const ne=Uu(fe),oe=EU(ne?.features||[],_);oe&&(M.totalSF+=oe.totalSF||0,M.rooms+=oe.rooms||0,Object.entries(oe.roomTypes||{}).forEach(([ye,he])=>{M.roomTypes[ye]=(M.roomTypes[ye]||0)+he}),Object.entries(oe.sfByRoomType||{}).forEach(([ye,he])=>{M.sfByRoomType[ye]=(M.sfByRoomType[ye]||0)+he}))}(M.rooms||M.totalSF)&&(o[O]=M,w.totalSF+=M.totalSF,w.rooms+=M.rooms,Object.entries(M.roomTypes||{}).forEach(([se,ce])=>{w.roomTypes[se]=(w.roomTypes[se]||0)+ce}),Object.entries(M.sfByRoomType||{}).forEach(([se,ce])=>{w.sfByRoomType[se]=(w.sfByRoomType[se]||0)+ce}))}return!w.rooms&&!w.totalSF?{perBuilding:{},campusTotals:null}:{perBuilding:o,campusTotals:w}};function ju(n,e){if(!n)return{loading:!1,mode:e,totalSf:"-",classroomSf:"-",rooms:"-",classroomCount:"-",labSf:"-",officeSf:"-",labCount:"-",officeCount:"-",deptCount:"-",keyDepts:[]};const t=u=>Number.isFinite(u)?Math.round(u).toLocaleString():"-",i=u=>Number.isFinite(u)?Number(u).toLocaleString():"-",c=n.deptCounts?Object.keys(n.deptCounts).length:0;return{loading:!1,mode:e,totalSf:t(n.totalSf),classroomSf:t(n.classroomSf),labSf:t(n.labSf),officeSf:t(n.officeSf),rooms:i(n.rooms),classroomCount:i(n.classroomCount),labCount:i(n.labCount),officeCount:i(n.officeCount),deptCount:c?c.toString():"-",keyDepts:n.keyDepts||[]}}function CU(n,e){try{if(!n||!Array.isArray(n.features)||n.features.length===0)return n;const t=e?.type==="Feature"?e:e?.type?{type:"Feature",properties:{},geometry:e}:null;if(!t)return n;const i=Vy(t);if(i){const Re={rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:null,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null,snapCorner:i},be=OU(t),De=DU(t),Qe=Array.isArray(De)?De[0]:null,xe=Array.isArray(De)?De[1]:null,ae=!!(Qe&&xe),Me=FU(t);let Fe=n,Ze=tc(n);if(be!=="none"&&!ae){const ct=$5(n,t);if(Number.isFinite(ct)&&Math.abs(ct)>1.5){const Ct=Ze?.geometry?.coordinates||null;Re.rotationDeg=ct,Re.rotationPivot=Ct;const Rt=jh(n,ct,Ct?{pivot:Ct}:void 0);Rt?.features?.length&&(Fe=Rt,Ze=tc(Fe))}}const[et,mt,ht,Nt]=Eu(Fe),[Jt,tn,fn,An]=Eu(t);if(![et,mt,ht,Nt,Jt,tn,fn,An].every(Number.isFinite))return n;const zt=Math.max(1e-9,ht-et),it=Math.max(1e-9,Nt-mt),ur=Math.max(1e-9,fn-Jt),xr=Math.max(1e-9,An-tn),Tn=Xb(t)==="directional",Yn=Tn?zp(Fe):Bp([et,mt,ht,Nt]),$n=Tn?zp(t):Bp([Jt,tn,fn,An]);let hr=null,Wt=0,Nn=null,tr=null,Hn=null,Rr=null;if(Qe&&xe&&Yn&&$n&&(Nn=Yn[Qe],tr=Yn[xe],Hn=$n[Qe],Rr=$n[xe],Nn&&tr&&Hn&&Rr)){const ct=vf(zs(Nn),zs(tr),{units:"kilometers"}),Ct=vf(zs(Hn),zs(Rr),{units:"kilometers"});Number.isFinite(ct)&&Number.isFinite(Ct)&&ct>0&&(hr=Ct/ct);const Rt=km(zs(Nn),zs(tr)),St=(km(zs(Hn),zs(Rr))-Rt+540)%360-180;Number.isFinite(St)&&(Wt=St)}const lr=Nn||Ze?.geometry?.coordinates||null;Re.scaleOrigin=lr;const wr=.96,br=RA(t),Ir=Math.min(ur/zt,xr/it)*wr,Bi=Me!=="legacy"&&Number.isFinite(hr)&&hr>0,Mi=(Bi?hr:Ir)*br,Jr=Bi||Math.abs(br-1)>1e-6||Mi<.9||Mi>1.1;Re.scale=Jr?Mi:1;let Kr=Jr?p0(Fe,Mi,lr?{origin:lr}:void 0):Fe;const Sr=NU(t),ui=(Number.isFinite(Wt)?Wt:0)+(Number.isFinite(Sr)?Sr:0);ae&&Me!=="legacy"&&Number.isFinite(ui)&&Math.abs(ui)>1e-6&&Array.isArray(lr)&&(Kr=jh(Kr,ui,{pivot:lr}),Re.rotationDeg=ui,Re.rotationPivot=lr);const ii=Tn?null:Eu(Kr),ut=Tn?zp(Kr):Bp(ii),we=$n||(Tn?zp(t):Bp([Jt,tn,fn,An]));if(ut&&we){const ct=Qe===i&&xe,Ct=ct?ut[Qe]:ut[i],Rt=ct?we[Qe]:we[i];if(Ct&&Rt){const Bt=zs(Ct),St=zs(Rt),Mt=vf(Bt,St,{units:"kilometers"}),vn=km(Bt,St);Number.isFinite(Mt)&&Number.isFinite(vn)&&(Kr=Mt>0?Fm(Kr,Mt,vn,{units:"kilometers"}):Kr,Re.translateKm=Mt,Re.translateBearing=vn)}if(ae&&ct&&Me!=="legacy"&&Me!=="match"){const Bt=ut[Qe],St=we[Qe];if(Bt&&St){const Mt=vf(zs(Bt),zs(St),{units:"kilometers"}),vn=km(zs(Bt),zs(St));Number.isFinite(Mt)&&Number.isFinite(vn)&&Mt>1e-9&&(Kr=Fm(Kr,Mt,vn,{units:"kilometers"}),Re.translateKm=(Re.translateKm||0)+Mt,Re.translateBearing=vn)}}}const Ie=Hn||we?.[i]||null;if(ae&&Me==="legacy"&&Number.isFinite(ui)&&Math.abs(ui)>1e-6&&Ie&&(Kr=jh(Kr,ui,{pivot:Ie}),Re.refineRotationDeg=(Re.refineRotationDeg||0)+ui,Re.refineRotationPivot=Ie),Ie&&be!=="none"&&!ae){const ct=MA(Kr,t,Ie,{maxDeg:6,stepDeg:.4,fineStep:.1,fineWindow:1.5,hullLimit:1200});ct?.fc&&(Kr=ct.fc),Re.refineRotationDeg=ct?.angle||0,Re.refineRotationPivot=Ie}ae||Number.isFinite(Sr)&&Math.abs(Sr)>1e-6&&Ie&&(Kr=jh(Kr,Sr,{pivot:Ie}),Re.refineRotationDeg=(Re.refineRotationDeg||0)+Sr,Re.refineRotationPivot=Ie);const Ye=BU(t);return Array.isArray(Ye)&&(Kr=g3(Kr,Ye),Re.nudgeMeters=Ye),Kr&&typeof Kr=="object"&&(Kr.__mfFitted=!0,Kr.__mfFittedBuilding=t?.properties?.id||t?.properties?.name||"",Kr.__mfFitTransform=Re,n.__mfAffineApplied&&(Kr.__mfAffineApplied=n.__mfAffineApplied),n.__mfRotationOverride!=null&&(Kr.__mfRotationOverride=n.__mfRotationOverride),n.__mfRotationPivot&&(Kr.__mfRotationPivot=n.__mfRotationPivot),n.__mfFitTransformApplied&&(Kr.__mfFitTransformApplied=n.__mfFitTransformApplied)),Kr}let c=tc(n);const u=tc(t),m={rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:null,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null},_=$5(n,t);if(Number.isFinite(_)&&Math.abs(_)>1.5){const Re=c?.geometry?.coordinates||null;m.rotationDeg=_,m.rotationPivot=Re;const be=jh(n,_,Re?{pivot:Re}:void 0);be?.features?.length&&(n=be,c=tc(n))}const[o,w,I,O]=Eu(n),[V,M,se,ce]=Eu(t),fe=Math.max(1e-9,I-o),ne=Math.max(1e-9,O-w),oe=Math.max(1e-9,se-V),ye=Math.max(1e-9,ce-M),he=.96,Ne=RA(t),Ve=Math.min(oe/fe,ye/ne)*he*Ne,de=Ve<.9||Ve>1.1,j=c?.geometry?.coordinates||null;m.scale=de?Ve:1,m.scaleOrigin=j;let D=de?p0(n,Ve,j?{origin:j}:void 0):n;const $=Eu(D),z=[(V+se)/2,(M+ce)/2],W=Array.isArray($)&&$.length===4&&$.every(Re=>Number.isFinite(Re)),Z=Number.isFinite(z[0])&&Number.isFinite(z[1]);if(i&&W){const be=Xb(t)==="directional",De=be?zp(D):Bp($),Qe=be?zp(t):Bp([V,M,se,ce]);if(De&&Qe){const xe=De[i],ae=Qe[i];if(xe&&ae){const Me=zs(xe),Fe=zs(ae),Ze=vf(Me,Fe,{units:"kilometers"}),et=km(Me,Fe);Number.isFinite(Ze)&&Number.isFinite(et)&&(D=Ze>0?Fm(D,Ze,et,{units:"kilometers"}):D,m.translateKm=Ze,m.translateBearing=et,m.snapCorner=i)}}}else{const Re=[],be=(De,Qe,xe)=>{if(!Array.isArray(Qe)||!Array.isArray(xe))return;const ae=zs(Qe),Me=zs(xe),Fe=vf(ae,Me,{units:"kilometers"}),Ze=km(ae,Me);if(!Number.isFinite(Fe)||!Number.isFinite(Ze))return;const et=Fe>0?Fm(D,Fe,Ze,{units:"kilometers"}):D,mt=Jp(et,1200),ht=mt?Uy(mt,t):0;Re.push({label:De,distKm:Fe,bearing:Ze,fc:et,score:ht})};if(W&&Z){const De=[($[0]+$[2])/2,($[1]+$[3])/2];be("center",De,z);const xe=Xb(t)==="directional",ae=xe?zp(D):Bp($),Me=xe?zp(t):Bp([V,M,se,ce]);ae&&Me&&Object.keys(ae).forEach(Fe=>{be(`corner-${Fe}`,ae[Fe],Me[Fe])})}else be("centroid",c?.geometry?.coordinates,u?.geometry?.coordinates);if(Re.length){const De=Re.reduce((Qe,xe)=>!Qe||xe.score>Qe.score+1e-6||Math.abs(xe.score-Qe.score)<=1e-6&&xe.distKm<Qe.distKm?xe:Qe,null);De?.fc&&(D=De.fc,m.translateKm=De.distKm,m.translateBearing=De.bearing)}}const Ee=u?.geometry?.coordinates||z,ke=MA(D,t,Ee,{maxDeg:6,stepDeg:.4,fineStep:.1,fineWindow:1.5,hullLimit:1200}),Oe=ke?.fc||D;return m.refineRotationDeg=ke?.angle||0,m.refineRotationPivot=Ee,Oe&&typeof Oe=="object"&&(Oe.__mfFitted=!0,Oe.__mfFittedBuilding=t?.properties?.id||t?.properties?.name||"",Oe.__mfFitTransform=m,n.__mfAffineApplied&&(Oe.__mfAffineApplied=n.__mfAffineApplied),n.__mfRotationOverride!=null&&(Oe.__mfRotationOverride=n.__mfRotationOverride),n.__mfRotationPivot&&(Oe.__mfRotationPivot=n.__mfRotationPivot),n.__mfFitTransformApplied&&(Oe.__mfFitTransformApplied=n.__mfFitTransformApplied)),Oe}catch{return n}}function Ad(n,e=1/0){const t=[];function i(c){if(!(!c||t.length>=e)){if(typeof c[0]=="number"){t.push([c[0],c[1]]);return}for(const u of c){if(t.length>=e)break;i(u)}}}return n?.type==="GeometryCollection"?(n.geometries||[]).forEach(c=>i(c.coordinates)):i(n?.coordinates),t}function qg(n,e=1/0){if(!n)return[];if(n.type==="FeatureCollection"){const t=[];for(const i of n.features||[]){if(t.length>=e)break;const c=Ad(i.geometry,e-t.length);c?.length&&t.push(...c)}return t}return n.type==="Feature"?Ad(n.geometry,e):n.type?Ad(n,e):[]}function g8(n){if(!Array.isArray(n)||n.length<2)return 0;let e=0,t=0;n.forEach(([_,o])=>{e+=_,t+=o}),e/=n.length,t/=n.length;let i=0,c=0,u=0;return n.forEach(([_,o])=>{const w=_-e,I=o-t;i+=w*w,c+=I*I,u+=w*I}),!Number.isFinite(i)||!Number.isFinite(c)||!Number.isFinite(u)?0:.5*Math.atan2(2*u,i-c)*180/Math.PI}function Om(n){return Array.isArray(n)&&n.length>=2&&typeof n[0]=="number"&&typeof n[1]=="number"}function _3(n,e){if(Array.isArray(n)){if(n.length&&Om(n[0])){e.push(n);return}n.forEach(t=>_3(t,e))}}function Xg(n){if(!n?.coordinates)return null;const e=[];_3(n.coordinates,e);let t=0,i=null;const c=(u,m)=>Math.abs(u[0]-m[0])<1e-9&&Math.abs(u[1]-m[1])<1e-9;return e.forEach(u=>{if(!Array.isArray(u)||u.length<2)return;for(let o=0;o<u.length-1;o+=1){const w=u[o],I=u[o+1];if(!Om(w)||!Om(I))continue;const O=I[0]-w[0],V=I[1]-w[1],M=Math.hypot(O,V);M>t&&(t=M,i=Math.atan2(V,O)*180/Math.PI)}const m=u[u.length-1],_=u[0];if(Om(m)&&Om(_)&&!c(m,_)){const o=_[0]-m[0],w=_[1]-m[1],I=Math.hypot(o,w);I>t&&(t=I,i=Math.atan2(w,o)*180/Math.PI)}}),i}function kA(n){if(!n?.coordinates)return null;const e=[];_3(n.coordinates,e);let t=0,i=0,c=0;return e.forEach(m=>{if(!(!Array.isArray(m)||m.length<2))for(let _=0;_<m.length-1;_+=1){const o=m[_],w=m[_+1];if(!Om(o)||!Om(w))continue;const I=w[0]-o[0],O=w[1]-o[1],V=Math.hypot(I,O);if(V<=0)continue;const M=Math.atan2(O,I);i+=V*Math.cos(2*M),t+=V*Math.sin(2*M),c+=V}}),c<=0?null:.5*Math.atan2(t,i)*180/Math.PI}function Y1(n){let e=(n+180)%360-180;return e>90&&(e-=180),e<-90&&(e+=180),e}function LU(n,e=2e3){if(!n?.geometry)return 0;const t=Ad(n.geometry,e);return g8(t)}function PU(n,e=4e3){if(!n?.features?.length)return 0;const t=[];for(const i of n.features){if(t.length>=e)break;const c=Ad(i.geometry,e-t.length);c?.length&&t.push(...c)}return g8(t)}function Jp(n,e=3e3){if(!n?.features?.length)return null;const t=[];for(const u of n.features){if(t.length>=e)break;const m=Ad(u.geometry,e-t.length);m?.length&&t.push(...m)}if(t.length<3)return null;const i=t.map(u=>zs(u));return Fz(i3(i))||null}function $5(n,e){const t=Jp(n),i=Xg(t?.geometry),c=Xg(e?.geometry),u=PU(n),m=LU(e),_=kA(t?.geometry),o=kA(e?.geometry),w=[];return Number.isFinite(i)&&Number.isFinite(c)&&w.push(Y1(c-i)),Number.isFinite(u)&&Number.isFinite(m)&&w.push(Y1(m-u)),Number.isFinite(_)&&Number.isFinite(o)&&w.push(Y1(o-_)),w.length?w.length===1?w[0]:(w.sort((I,O)=>I-O),w[Math.floor(w.length/2)]):null}function Uy(n,e){try{const t=UI(i3([n,e]));if(!t)return 0;const i=WE(t),c=WE(n);return!Number.isFinite(i)||!Number.isFinite(c)||c<=0?0:i/c}catch{return 0}}function MA(n,e,t,i={}){if(!n||!e||!t)return{fc:n,angle:0};const c=Number.isFinite(i.maxDeg)?i.maxDeg:5,u=Number.isFinite(i.stepDeg)?i.stepDeg:.5,m=Number.isFinite(i.fineStep)?i.fineStep:.1,_=Number.isFinite(i.fineWindow)?i.fineWindow:1.2,o=Jp(n,i.hullLimit||1200);if(!o)return{fc:n,angle:0};const w=Uy(o,e);let I=0,O=w;for(let M=-c;M<=c;M+=u){if(Math.abs(M)<1e-6)continue;const se=jh(o,M,{pivot:t}),ce=Uy(se,e);ce>O+1e-4&&(O=ce,I=M)}if(m>0&&_>0){const M=I-_,se=I+_;for(let ce=M;ce<=se;ce+=m){if(Math.abs(ce)<1e-6)continue;const fe=jh(o,ce,{pivot:t}),ne=Uy(fe,e);ne>O+1e-4&&(O=ne,I=ce)}}if(Math.abs(I)<.001)return{fc:n,angle:0};const V=jh(n,I,{pivot:t});return{fc:V?.features?.length?V:n,angle:I}}function kU(n){let e=1/0,t=1/0,i=-1/0,c=-1/0;return(n?.features||[]).forEach(u=>{Ad(u.geometry).forEach(([m,_])=>{m<e&&(e=m),_<t&&(t=_),m>i&&(i=m),_>c&&(c=_)})}),[e,t,i,c]}function Bp(n){if(!Array.isArray(n)||n.length!==4)return null;const[e,t,i,c]=n;return[e,t,i,c].every(Number.isFinite)?{nw:[e,c],ne:[i,c],sw:[e,t],se:[i,t]}:null}function zp(n,e=4e3){let t=n;if(n?.type==="FeatureCollection"){const m=Jp(n,e);m?.geometry&&(t=m)}const i=qg(t,e);if(!i.length)return null;const c={nw:[-1,1],ne:[1,1],sw:[-1,-1],se:[1,-1]},u={nw:{score:-1/0,pt:null},ne:{score:-1/0,pt:null},sw:{score:-1/0,pt:null},se:{score:-1/0,pt:null}};for(const[m,_]of i)if(!(!Number.isFinite(m)||!Number.isFinite(_)))for(const o of Object.keys(c)){const[w,I]=c[o],O=m*w+_*I;O>u[o].score&&(u[o]={score:O,pt:[m,_]})}return{nw:u.nw.pt,ne:u.ne.pt,sw:u.sw.pt,se:u.se.pt}}function Yr(n){return String(n||"").replace(/\u00a0/g," ").trim().toLowerCase().replace(/\bthe\b/g,"").replace(/\bmemorial\b/g,"").replace(/\bresidence\b/g,"").replace(/\bresidency\b/g,"").replace(/\b[a-z]\b/g,"").replace(/theatre/g,"theater").replace(/centre/g,"center").replace(/[^a-z0-9]/g,"")}const b_=[{keys:["Morrison Reeves","Morrison-Reeves Science Center"],corner:"nw",cornerMethod:"directional",cornerPair:["nw","sw"],pairMode:"match",rotationMode:"none"},{keys:["Calvin French Chapel","Calvin H. French Chapel","French Memorial Chapel"],corner:"nw",cornerMethod:"directional",cornerPair:["nw","sw"],pairMode:"match"}];function w_(n,e){const t={};return n.forEach(i=>{!i||!i.keys||i[e]==null||i.keys.forEach(c=>{const u=Yr(c);u&&(t[u]=i[e])})}),t}const MU=new Set([]),G5=new Set([Yr("Calvin French Chapel"),Yr("Calvin H. French Chapel"),Yr("Calvin H. French Memorial Chapel"),Yr("Kiewit Building"),Yr("Taylor Hall"),Yr("Taylor Hall Residence")]);function RU({buildingLabel:n}={}){const e=Yr(n);return e&&MU.has(e)}let Wb=null;async function Hb(){if(Wb)return Wb;try{const n=[$d("Hastings_College_Buildings.json"),"/Hastings_College_Buildings.json","Hastings_College_Buildings.json"],e=await u8(n);if(e?.ok&&e.data&&Array.isArray(e.data.features))return Wb=e.data,e.data}catch{}return null}function Sd(n){const t=(()=>{try{return decodeURIComponent(String(n||""))}catch{return String(n||"")}})().split("/").filter(Boolean);if(!t.length)return"";const i=t.indexOf("floorplans");return i>=0&&t.length>i+2?t[i+2]:t[t.length-1]||""}function Vy(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Yr(i);if(c&&DA[c])return DA[c]}return null}function NU(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Yr(i);if(c&&Number.isFinite(FA[c]))return FA[c]}return null}function Xb(n){if(!n)return"bbox";const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Yr(i);if(c&&OA[c])return OA[c]}return"bbox"}function DU(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Yr(i);if(c&&BA[c])return BA[c]}return null}function FU(n){if(!n)return"match";const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Yr(i);if(c&&zA[c])return zA[c]}return"match"}function OU(n){if(!n)return"auto";const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Yr(i);if(c&&jA[c])return jA[c]}return"auto"}function RA(n){if(!n)return 1;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Yr(i),u=GU[c];if(c&&Number.isFinite(u))return u}return 1}function BU(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Yr(i),u=WU[c];if(c&&Array.isArray(u)&&u.length>=2)return u}return null}function yf(n=[],e){if(!Array.isArray(n)||!n.length||!e)return null;const t=Yr(e);if(!t)return null;let i=null,c=0;for(const u of n){const m=u?.properties||{},_=[Yr(m.id),Yr(m.name),Yr(m.Name),Yr(m.buildingId),Yr(m.buildingName),Yr(m.Building),Yr(m.building)].filter(Boolean);for(const o of _){if(!o)continue;const w=o===t,I=o.includes(t)||t.includes(o);if(!w&&!I)continue;const O=o.length;O>c&&(i=u,c=O)}}return i}function zU(n,e){try{if(!n||!n.features?.length||!e||n.__mfGeoreferenced||n.__mfNoFit)return!1;const t=Yr(e?.properties?.id||e?.properties?.name||"");if(t&&G5.has(t)||Vy(e))return!0;if(n?.__mfFitted)return!1;const[i,c,u,m]=Eu(n),[_,o,w,I]=Eu(e);if(![i,c,u,m,_,o,w,I].every(Number.isFinite))return!1;const O=Math.max(1e-9,u-i),V=Math.max(1e-9,m-c),M=Math.max(1e-9,w-_),se=Math.max(1e-9,I-o),ce=Math.min(M/O,se/V),fe=ce<.75||ce>1.35,ne=tc(n),oe=tc(e),ye=vf(ne,oe,{units:"kilometers"}),he=Number.isFinite(ye)&&ye>.06,Ne=vf(zs([_,o]),zs([w,I]),{units:"kilometers"}),de=(Number.isFinite(ye)&&Number.isFinite(Ne)&&Ne>0?ye/Ne:0)>.18,j=u<_||i>w||m<o||c>I,D=$5(n,e),$=Number.isFinite(D)&&Math.abs(D)>1.5,z=Jp(n,1200),W=z?Uy(z,e):1,Z=W>0&&W<.85;return fe||he||j||$||de||Z}catch{return!1}}const td=[{name:"Hurley-McDonald Hall",folder:"HurleyMcDonald"},{name:"Gray Center",folder:"Gray Center"},{name:"Morrison-Reeves Science Center",folder:"Morrison Reeves"},{name:"1882",folder:"1882"},{name:"Altman Hall",folder:"Altman Hall"},{name:"Babcock Hall",folder:"Babcock Hall"},{name:"Barrett Alumni",folder:"Barrett Alumni"},{name:"Batchelder Services Bldg",folder:"Batchelder"},{name:"Bronc Hall",folder:"Bronc Hall"},{name:"Bronco Village Apt 911",folder:"Bronco Village Apt 911"},{name:"Bronco Village Apt 915",folder:"Bronco Village Apt 915"},{name:"Bronco Village Apt 917",folder:"Bronco Village Apt 917"},{name:"Bronco Village Apt 919",folder:"Bronco Village Apt 919"},{name:"Bronco Village Apt 921",folder:"Bronco Village Apt 921"},{name:"Bronco Village Apt 923",folder:"Bronco Village Apt 923"},{name:"Calvin H. French Chapel",folder:"Calvin French Chapel"},{name:"Daugherty Student Engagement Center",folder:"Daugherty"},{name:"Farrell-Fleharty",folder:"Fleharty"},{name:"Hazelrigg Student Union",folder:"Hazzelrig"},{name:"Jackson Dinsdale Art Center",folder:"Jackson Dinsdale"},{name:"Kiewit Building",folder:"Kiewit"},{name:"Lloyd Wilson Stadium",folder:"Lloyd Wilson Stadium"},{name:"McCormick Hall",folder:"McCormick"},{name:"Perkins Library",folder:"Perkins"},{name:"Physical Fitness Facility",folder:"Physical Fitness Facility"},{name:"Scott Studio Theater",folder:"Scott Theater"},{name:"Stone Health Center",folder:"Stone Health Center"},{name:"Taylor Hall",folder:"Taylor Hall"},{name:"Wilson Center",folder:"WilsonCenter"}],Wp=Object.fromEntries(td.map(n=>[n.name,n.folder])),y8=new Set(td.map(n=>n.folder)),Kg=Object.fromEntries(td.map(n=>[n.folder,n.name])),_8=n=>String(n||"").replace(/\u00a0/g," ").trim().toLowerCase().replace(/theatre/g,"theater").replace(/centre/g,"center").replace(/\bmemorial\b/g,""),i_=n=>_8(n).replace(/[^a-z0-9]/g,""),W5=n=>_8(n).replace(/\b[a-z]\b/gi,"").replace(/[^a-z0-9]/g,""),jU=n=>{if(!n)return null;const e=i_(n);if(!e)return null;const t=x8?.[e];if(t&&Wp[t])return t;for(const i of Object.keys(Wp))if(i_(i)===e)return i;return null},np=n=>{if(!n)return null;if(Wp[n])return n;if(y8.has(n))return Kg[n]||null;const e=v3[n];if(e&&Wp[e])return e;const t=i_(n),i=W5(n),c=t&&x8?.[t]||i&&UU?.[i]||null;if(c&&Wp[c])return c;let u=null,m=0;for(const _ of Object.keys(Wp)){const o=i_(_),w=W5(_),I=t===o||i===w,O=t&&o&&(t.includes(o)||o.includes(t))||i&&w&&(i.includes(w)||w.includes(i));if(!I&&!O)continue;const V=o.length;V>m&&(u=_,m=V)}return u},v8={1882:"The 1882 Residence Hall","Altman Hall":"Altman Hall Residency","Babcock Hall":"Babcock Hall Residence","Barrett Alumni":"Barrett Alumni Center","Batchelder Services Bldg":"Batchelder General Services","Bronc Hall":"Bronc Hall Residence","Hurley-McDonald Hall":"hurley_mcdonald","Gray Center":"gray_center","Hazelrigg Student Union":"Hazelrigg Student Union","Lloyd Wilson Stadium":"Lloyd Wilson Field/Stadium","Morrison-Reeves Science Center":"morrison_reeves","Scott Studio Theater":"Scott Studio Theatre","Stone Health Center":"The Stone Health Center","Taylor Hall":"Taylor Hall Residence","Wilson Center":"wilson_center","Farrell-Fleharty":"Lynn Farrell Arena/Fleharty Educational Center","Calvin H. French Chapel":"Calvin French Chapel","Bronco Village Apt 911":"Bronco Village Apartments 1","Bronco Village Apt 915":"Bronco Village Apartments 2","Bronco Village Apt 917":"Bronco Village Apartments 3","Bronco Village Apt 919":"Bronco Village Apartments 4","Bronco Village Apt 921":"Bronco Village Apartments 5","Bronco Village Apt 923":"Bronco Village Apartments 6"},v3={...Object.fromEntries(Object.entries(v8).map(([n,e])=>[e,n])),"Farrell Arena Fleharty Educational Center":"Farrell-Fleharty","Daugherty Center for Student Engagement":"Daugherty Student Engagement Center","Daugherty Center For Student Engagement":"Daugherty Student Engagement Center","Fleharty Center":"Farrell-Fleharty","Calvin H. French Memorial Chapel":"Calvin H. French Chapel","French Memorial Chapel":"Calvin H. French Chapel","Hazzelrig Student Union":"Hazelrigg Student Union","Hazelrigg Student Union":"Hazelrigg Student Union",Kiewit:"Kiewit Building","Scott Theatre":"Scott Studio Theater","Scott Theater":"Scott Studio Theater","Wilson Math and Computer Sci Center":"Wilson Center"},x8=Object.fromEntries(Object.entries(v3).map(([n,e])=>[i_(n),e])),UU=Object.fromEntries(Object.entries(v3).map(([n,e])=>[W5(n),e])),VU="Data/Utilization/classroom_utilization.csv",NA=n=>{const e=[];let t="",i=!1;for(let c=0;c<n.length;c+=1){const u=n[c];if(u==='"'){i&&n[c+1]==='"'?(t+='"',c+=1):i=!i;continue}if(u===","&&!i){e.push(t),t="";continue}t+=u}return e.push(t),e},Dg=n=>{const e=String(n??"").replace(/,/g,"").trim();if(!e)return null;const t=Number(e);return Number.isFinite(t)?t:null},Fg=n=>{const e=String(n??"").replace(/[%\s]/g,"").replace(/,/g,"").trim();if(!e)return null;const t=Number(e);return Number.isFinite(t)?t:null},qU=n=>{const e=String(n??"").trim().toLowerCase();return e?/^0+\d+$/.test(e)?String(Number(e)):e:""},b8=(n,e)=>`${n}||${qU(e)}`,$U=(n="")=>{const e=n.split(/\r?\n/).filter(se=>se.trim().length>0);if(!e.length)return{buildings:{},rooms:{},campus:null};const t=NA(e[0]).map(se=>se.trim()),i=t.findIndex(se=>se.toLowerCase().includes("building")),c=t.findIndex(se=>se.toLowerCase().includes("weekly")),u=t.findIndex(se=>se.toLowerCase().includes("enrollment")),m=t.findIndex(se=>se.toLowerCase().includes("capacity")),_=t.findIndex(se=>se.toLowerCase().includes("time")),o=t.findIndex(se=>se.toLowerCase().includes("seat")),w=t.findIndex(se=>se.toLowerCase().includes("overall"));if(i<0)return{buildings:{},rooms:{},campus:null};const I={},O={};let V=null,M=null;for(let se=1;se<e.length;se+=1){const ce=NA(e[se]),fe=(ce[i]??"").trim();if(!fe)continue;if(/^grand total$/i.test(fe)){V={weeklyHours:Dg(ce[c]),finalEnrollment:Dg(ce[u]),totalCapacity:Dg(ce[m]),timeUtilization:Fg(ce[_]),seatUtilization:Fg(ce[o]),overallUtilization:Fg(ce[w])},M=null;continue}const oe=jU(fe)||null,ye=Dg(ce[c]),he=Dg(ce[u]),Ne=Dg(ce[m]),Ve=Fg(ce[_]),de=Fg(ce[o]),j=Fg(ce[w]);if(oe){M=oe,I[oe]={weeklyHours:ye,finalEnrollment:he,totalCapacity:Ne,timeUtilization:Ve,seatUtilization:de,overallUtilization:j};continue}if(!M)continue;const D=b8(M,fe);O[D]={building:M,roomLabel:fe,weeklyHours:ye,finalEnrollment:he,totalCapacity:Ne,timeUtilization:Ve,seatUtilization:de,overallUtilization:j}}return{buildings:I,rooms:O,campus:V}},DA={[Yr("Babcock Hall")]:"nw",[Yr("Babcock Hall Residence")]:"nw",[Yr("Gray Center")]:"sw",[Yr("Lloyd Wilson Stadium")]:"nw",[Yr("Lloyd Wilson Field/Stadium")]:"nw",[Yr("Stone Health Center")]:"nw",[Yr("The Stone Health Center")]:"nw",[Yr("McCormick Hall")]:"nw",[Yr("Jackson Dinsdale Art Center")]:"nw",[Yr("Farrell-Fleharty")]:"nw",[Yr("Lynn Farrell Arena/Fleharty Educational Center")]:"nw",...w_(b_,"corner")},FA={[Yr("Gray Center")]:0,[Yr("McCormick Hall")]:90},OA={[Yr("Gray Center")]:"directional",[Yr("Lloyd Wilson Stadium")]:"directional",[Yr("Lloyd Wilson Field/Stadium")]:"directional",...w_(b_,"cornerMethod")},BA={[Yr("Gray Center")]:["sw","nw"],[Yr("Lloyd Wilson Stadium")]:["nw","sw"],[Yr("Lloyd Wilson Field/Stadium")]:["nw","sw"],[Yr("Stone Health Center")]:["nw","sw"],[Yr("The Stone Health Center")]:["nw","sw"],[Yr("Jackson Dinsdale Art Center")]:["nw","sw"],[Yr("Farrell-Fleharty")]:["nw","sw"],[Yr("Lynn Farrell Arena/Fleharty Educational Center")]:["nw","sw"],[Yr("Daugherty Student Engagement Center")]:["nw","sw"],[Yr("McCormick Hall")]:["nw","sw"],...w_(b_,"cornerPair")},zA={[Yr("Lloyd Wilson Stadium")]:"match",[Yr("Lloyd Wilson Field/Stadium")]:"match",[Yr("Stone Health Center")]:"legacy",[Yr("The Stone Health Center")]:"legacy",...w_(b_,"pairMode")},jA={[Yr("Babcock Hall")]:"none",[Yr("Babcock Hall Residence")]:"none",...w_(b_,"rotationMode")},GU={[Yr("Gray Center")]:1.035,[Yr("Lloyd Wilson Stadium")]:1,[Yr("Lloyd Wilson Field/Stadium")]:1},WU={},UA={"wilson_center/basement":184.5,"wilson_center/level_1":180.5,"daugherty_student_engagement_center/basement":42,"daugherty_student_engagement_center/level_1":42,hurley_mcdonald_hall:180,"mccormick_hall/basement":84.5,"mccormick_hall/level_1":88.5,"mccormick_hall/level_2":88.5,"mccormick_hall/level_3":100,morrison_reeves_science_center:0,morrison_reeves:0,"morrison_reeves/level_1":0,"morrison_reeves/level_2":0},VA={"babcock_hall/level_2":1.12},qA={},$A=new Set(["kiewit/level_2","kiewit_building/level_2","babcock_hall/level_3","taylor_hall","taylor_hall_residence"]),GA=new Set(["calvin_french_chapel/level_2","calvin_h_french_chapel/level_2","calvin_h_french_memorial_chapel/level_2"]),HU=new Set(["bronc_hall/basement","bronc_hall_residence/basement"]),XU=new Set(["calvin_french_chapel/basement","calvin_h_french_chapel/basement","calvin_h_french_memorial_chapel/basement","kiewit/level_2","kiewit_building/level_2"]);function KU(n,e){if(!n)return null;const t=Wc(n),i=e?ec(e):null;if(i){const u=`${t}/${i}`,m=UA[u];if(Number.isFinite(m))return m}const c=UA[t];return Number.isFinite(c)?c:null}function ZU(n,e){if(!n||!e)return null;const t=Wc(n),i=ec(e),c=`${t}/${i}`,u=VA[c]??VA[t];return Number.isFinite(u)?u:null}function YU(n,e){if(!n||!e)return null;const t=Wc(n),i=ec(e),c=`${t}/${i}`,u=qA[c]??qA[t];return Number.isFinite(u)?u:null}function JU(n,e){if(!n||!e)return!1;const t=Wc(n),i=ec(e);return HU.has(`${t}/${i}`)}function QU(n,e){if(!n||!e)return!1;const t=Wc(n),i=ec(e);return $A.has(`${t}/${i}`)||$A.has(t)}function eV(n,e){if(!n||!e)return!1;const t=Wc(n),i=ec(e);return GA.has(`${t}/${i}`)||GA.has(t)}function tV(n,e){if(!n||!e)return!1;const t=Wc(n),i=ec(e);return XU.has(`${t}/${i}`)}const Mv=(n,e)=>({...n,...e}),ho=n=>{const e=String(n??"").trim();if(!e)return"";const t=np(e)||e;return Wc(t)},g0=n=>{const e=String(n||"").trim();if(!e)return"";const t=e.match(/[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}/i);return String(t?t[0]:e).trim().toLowerCase().replace(/[^a-z0-9]/g,"")},WA=n=>{const e=String(n||"").trim();if(!e)return"";const t=g0(e);return t?t.startsWith("room")&&t.length>4?t.slice(4):t:""},Km=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),y0=n=>String(n||"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]+/g," ").trim(),qy=n=>n?.building??n?.buildingName??n?.buildingLabel??"",HA=(n=[])=>{const e=new Map;return(d3||[]).forEach(t=>{const i=y0(t);i&&e.set(i,t)}),(n||[]).forEach(t=>{const i=String(t?.department??"").trim(),c=y0(i);c&&e.set(c,i)}),Array.from(e.values())},XA=(n,e=[])=>{const t=y0(n);if(!t)return"";let i="",c=0;return(e||[]).forEach(u=>{const m=y0(u);m&&t.includes(m)&&m.length>c&&(i=u,c=m.length)}),i},Rv=n=>String(n||"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]+/g," ").trim(),KA=(n=[])=>{const e=new Map;return(td||[]).forEach(t=>{const i=String(t?.name||"").trim(),c=Rv(i);c&&e.set(c,i)}),(n||[]).forEach(t=>{const i=String(t?.building??t?.buildingName??t?.buildingLabel??"").trim(),c=Rv(i);c&&e.set(c,i)}),Array.from(e.values())},ZA=(n,e=[])=>{const t=Rv(n);if(!t)return"";let i="",c=0;return(e||[]).forEach(u=>{const m=Rv(u);m&&t.includes(m)&&m.length>c&&(i=u,c=m.length)}),i},YA=(n=[],e="")=>{const t=y0(e);if(!t)return[];const i=new Set;return(n||[]).forEach(c=>{const u=y0(c?.department??"");if(u&&u===t){const m=qy(c);m&&i.add(m)}}),Array.from(i)},Kb=n=>{if(n==null)return[];const e=new Set,t=String(n);t&&e.add(t);const i=Number(t);return Number.isFinite(i)&&e.add(i),Array.from(e)},x3=n=>/^rec[a-z0-9]{6,}$/i.test(String(n||"")),Nv=n=>Array.isArray(n)&&n.length>0&&n.every(e=>x3(e)),w8=["Office - Staff","Office - Prof and Admin","Office - Prof & Admin","Office - Prof/Admin","Office - Faculty","Office - Adjunct Faculty","Office - Emeritus Faculty"],nV=w8.map(n=>n.toUpperCase()),S8=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\b(and|&)\b/g," ").replace(/\s+/g," ").trim(),rV=new Set(w8.map(S8).filter(Boolean)),J1=n=>rV.has(S8(n)),iV=/^[{(]?[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}(?:-[0-9a-f]{2,})?[)}]?$/i,oV=/^[0-9a-f]{24,}$/i,sV=/[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}(?:-[0-9a-f]{2,})?/i,Zg=n=>{const e=String(n||"").trim();return e?!!(iV.test(e)||sV.test(e)&&e.length>=24||oV.test(e)||e.includes("|")||/^[a-f0-9-]{24,}$/i.test(e)||x3(e)):!1},E8=n=>{const e=[n?.roomNumber,n?.roomLabel,n?.number,n?.Number,n?.RoomNumber,n?.Room];for(const i of e){const c=String(i??"").trim();if(c&&!Zg(c))return c}const t=String(n?.roomId??"").trim();return t&&!Zg(t)?t:""},aV=(n="")=>{const e=String(n||"").toLowerCase();return!/\bvacan(t|cy)\b/.test(e)||!/\boffice(s)?\b/.test(e)?!1:/\b(list|show|give|display|return|all|which|what)\b/.test(e)},lV=(n="")=>{const e=String(n||"").toLowerCase();return!/\bvacan(t|cy)\b/.test(e)||!/\boffice(s)?\b/.test(e)?!1:/\bhow many\b|\bcount\b|\bnumber of\b/.test(e)},cV=(n="")=>{const e=String(n||"").toLowerCase();return/\bclassroom(s)?\b/.test(e)?/\bhow many\b|\bcount\b|\bnumber of\b/.test(e):!1},uV=n=>{const e=String(n?.occupancyStatus??n?.occupancy??n?.Vacancy??n?.vacancy??"").toLowerCase();return String(n?.occupant??"").trim()||e.includes("occupied")||e.includes("assigned")&&!e.includes("unassigned")?!1:e.includes("vacant")||e.includes("available")},JA=(n=[])=>{const e=new Set,t=[];return(n||[]).forEach(i=>{const c=String(i?.type??i?.roomType??"").trim();if(!c||!c.toLowerCase().includes("office")&&!J1(c)||!uV(i))return;const m=String(qy(i)||"").trim(),_=String(i?.floor??i?.floorName??i?.floorId??"").trim(),o=E8(i),w=Number(i?.areaSF??i?.area??i?.sf??0),I=Number.isFinite(w)&&w>0?Math.round(w):"",O=[m,_,o,c,I].join("|").toLowerCase();e.has(O)||(e.add(O),t.push({Building:m||"Unknown","Room Number":o,"Room Type":c,"Square Feet":I}))}),t.sort((i,c)=>String(i.Building||"").localeCompare(String(c.Building||""),void 0,{sensitivity:"base"})||String(i["Room Number"]||"").localeCompare(String(c["Room Number"]||""),void 0,{numeric:!0,sensitivity:"base"})),t},hV=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),w1=n=>{const e=hV(n);return e?e.includes("classroom")?!0:e.includes("laboratory class")||e.includes("laboratory studio")||e.includes("lab class")||e.includes("lab studio"):!1},rp=n=>{const e=String(n??"").trim();if(!e)return[];const t=new Set,i=ec(e);t.add(i);const c=Number(e);return Number.isFinite(c)&&(t.add(`level_${c}`),c===0&&t.add("basement")),Array.from(t)},ep=(n,e)=>{if(!e?.length)return!0;const t=rp(n);return t.length?t.some(i=>e.includes(i)):!1},S1=(n,e=[])=>{const t=Wg(n);if(!t)return"";if(e.includes(t))return t;const i=rp(t);return i.length&&e.find(c=>ep(c,i))||""};function A8(n=[]){const e=new Map,t=new Map;return Array.isArray(n)?(n.forEach(i=>{if(!i)return;const c=g0(i.roomGuid??i.revitUniqueId??i["Room GUID"]??"");c&&e.set(c,i);const u=g0(i.roomId??i.roomNumber??i.roomLabel??i.id??""),m=ho(i.building??i.buildingName??i.buildingLabel??""),_=ho(i.floor??i.floorName??i.floorId??"");if(u&&m&&_){const o=`${m}|${_}|${u}`;t.has(o)||t.set(o,i)}}),{byGuid:e,byComposite:t}):{byGuid:e,byComposite:t}}function dV(n=[],e=[]){if(!Array.isArray(n)||n.length===0)return[];if(!Array.isArray(e)||e.length===0)return n;const t=A8(e);return n.map(i=>{if(!i)return i;const c=g0(i.roomGuid??i.roomId??i.revitUniqueId??""),u=c?t.byGuid.get(c):null;if(!u)return i;const m={...i};!m.roomGuid&&u.roomGuid&&(m.roomGuid=u.roomGuid),!m.roomId&&u.roomId&&(m.roomId=u.roomId);const _=String(m.roomNumber??"").trim(),o=String(m.roomLabel??"").trim();if((!_||Zg(_))&&u.roomNumber){const w=String(u.roomNumber).trim();w&&!Zg(w)&&(m.roomNumber=w)}if((!o||Zg(o))&&u.roomLabel){const w=String(u.roomLabel).trim();w&&!Zg(w)&&(m.roomLabel=w)}return!m.building&&u.building&&(m.building=u.building),!m.floor&&u.floor&&(m.floor=u.floor),(!m.type||Nv(m.type))&&u.type&&(m.type=u.type),(!m.department||Nv(m.department))&&u.department&&(m.department=u.department),(!Number.isFinite(Number(m.areaSF))||Number(m.areaSF)<=0)&&Number.isFinite(Number(u.areaSF))&&Number(u.areaSF)>0&&(m.areaSF=Number(u.areaSF)),m})}function T8(n={},e,t,i){if(!e)return null;let c=null;const u=g0(n.Revit_UniqueId??n.RevitUniqueId??n["Room GUID"]??n.roomGuid??"");if(u&&(c=e.byGuid.get(u)||null),!c){const V=g0(n.Number??n.RoomNumber??n.number??n.Room??n.roomNumber??""),M=ho(t??n.Building??n.BuildingName??n.buildingId??""),se=ho(i??n.Floor??n.floor??"");V&&M&&se&&(c=e.byComposite.get(`${M}|${se}|${V}`)||null)}if(!c)return null;const m=String(c.occupancyStatus??"").trim(),_=String(c.occupant??"").trim(),o=String(c.type??"").trim(),w=String(c.department??"").trim();if(!m&&!_&&!o&&!w)return null;const I={};m&&(I.occupancyStatus=m,I.OccupancyStatus=m,I["Occupancy Status"]=m),_&&(I.occupant=_,I.Occupant=_),o&&(I.type=o,I.Type=o,I["Room Type"]=o,I["Room Type Description"]=o),w&&(I.department=w,I.Department=w);const O=Number(c.seatCount??c.SeatCount??c["Seat Count"]??0);return Number.isFinite(O)&&O>0&&(I.seatCount=O,I.SeatCount=O,I["Seat Count"]=O),I}const fV=n=>{const e=Number(n?.areaSF??n?.area??n?.sf??0);return Number.isFinite(e)&&e>0},pV=(n,e)=>{if(!n)return null;const t=n?.properties||{},i=JI(t);if(!Number.isFinite(i)||i<=0)return null;const c=(t.occupancyStatus??t["Occupancy Status"]??t.OccupancyStatus??t.vacancy??t.Vacancy??t.Occupancy??t.Status??"").toString().trim(),u=(t.occupant??t.Occupant??t.AssignedTo??t.Assignee??"").toString().trim(),m=String(t.Revit_UniqueId??t.RevitUniqueId??t["Room GUID"]??"").trim(),_=String(t.Number??t.RoomNumber??t.number??t.Room??"").trim(),o=t.Floor??t.Level??t.LevelName??t["Level Name"]??"";return{building:e||"",floor:o,areaSF:i,area:i,sf:i,roomId:_||"",roomNumber:_||"",roomLabel:_||"",roomGuid:m,department:YI(t),type:f3(t),occupancyStatus:c,occupant:u}},QA=async n=>{const e=n?.floorsByBuilding||{},t=[],i=new Map;return Array.isArray(n?.buildings)?n.buildings.forEach(u=>{u?.id&&i.set(String(u.id),u?.name||u.id)}):n?.buildings&&typeof n.buildings=="object"&&Object.entries(n.buildings).forEach(([u,m])=>{u&&i.set(String(u),m?.name||u)}),Object.entries(e).forEach(([u,m])=>{const _=i.get(String(u))||u;(m||[]).forEach(o=>{const w=typeof o=="string"?o:o?.url;w&&t.push({url:w,buildingLabel:_})})}),t.length?(await pU(t,6,async u=>{const m=await fU(u.url),_=[];return(m||[]).forEach(o=>{const w=pV(o,u.buildingLabel);w&&_.push(w)}),_})).flat():[]},I8=n=>{if(!n)return null;const e=Number(n.areaSF??n.area??n.sf??0);if(!Number.isFinite(e)||e<=0)return null;const t=String(n.department??"").trim(),i=String(n.type??"").trim(),c=String(n.occupancyStatus??"").trim(),u=String(n.occupant??"").trim();return{type:"Feature",properties:{Area_SF:e,Area:e,area:e,"Area (SF)":e,NCES_Department:t,Department:t,department:t,NCES_Type:i,__roomType:i,OccupancyStatus:c,"Occupancy Status":c,occupancyStatus:c,Occupant:u,occupant:u}}};function C8(n,e){if(n){try{n.getLayer(Af)&&n.removeLayer(Af),n.getLayer(Xm)&&n.removeLayer(Xm),n.getLayer(mh)&&n.removeLayer(mh),n.getLayer(hp)&&n.removeLayer(hp),n.getLayer(wd)&&n.removeLayer(wd),n.getLayer(Tv)&&n.removeLayer(Tv),n.getLayer(Iv)&&n.removeLayer(Iv),n.getLayer(us)&&n.removeLayer(us),ph(n,xa)&&n.removeSource(xa),n.getLayer(m0)&&n.removeLayer(m0),n.getSource(Cv)&&n.removeSource(Cv),n.getLayer(Lv)&&n.removeLayer(Lv),n.getSource(xA)&&n.removeSource(xA),n.getLayer(Pv)&&n.removeLayer(Pv),n.getSource(bA)&&n.removeSource(bA)}catch{}e&&(e.current=null)}}function eT(n){try{const e=ph(n,xa),t=e?._data||e?.serialize?.()?.data,i=Uu(t);if(!i)return;const c=Eu(i);c&&isFinite(c[0])&&n.fitBounds([[c[0],c[1]],[c[2],c[3]]],{padding:40,duration:500})}catch{}}function L8(n){if(!n)return;const i=["case",["==",["get","Element"],"Room"],["concat",["coalesce",["get","Number"],["get","RoomNumber"],["get","name"],["literal","-"]],`
`,["coalesce",["get","__roomType"],["get","RoomType"],["get","Room Type"],["get","Type"],["get","type"],["get","Name"],["literal","-"]],`
`,["coalesce",["get","scenarioDepartment"],["get","department"],["get","Department"],["literal","-"]],`
`,["concat",["to-string",["round",["coalesce",["get","Area_SF"],["get","Area"],0]]]," SF"]],""],c=["interpolate",["linear"],["zoom"],14,0,15,0,16,3,17,5,18,7,19,10];if(n.getLayer(mh)){try{n.setLayoutProperty(mh,"text-field",i),n.setLayoutProperty(mh,"text-size",c),n.setLayoutProperty(mh,"symbol-placement","point"),n.setLayoutProperty(mh,"text-allow-overlap",!1),n.setLayoutProperty(mh,"text-ignore-placement",!1),n.setLayoutProperty(mh,"text-max-width",6),n.setLayoutProperty(mh,"visibility","visible"),n.setFilter(mh,Hg)}catch{}H5(n);return}try{n.addLayer({id:mh,type:"symbol",source:xa,filter:["all",Hg,["!=",["id"],-1]],layout:{"text-field":i,"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":c,"text-line-height":1,"text-variable-anchor":["center"],"text-radial-offset":0,"text-anchor":"center","text-justify":"center","symbol-placement":"point","text-allow-overlap":!1,"text-ignore-placement":!1,"text-max-width":6,visibility:"visible"},paint:{"text-color":"#0b0b0b","text-halo-color":"rgba(255,255,255,0.95)","text-halo-width":1}},wd),H5(n)}catch{}}function H5(n){if(n)try{n.getLayer(mh)&&n.moveLayer(mh)}catch{}}const mV={5:{label:"5 = Excellent condition",color:"#4CAF50"},4:{label:"4 = Good condition",color:"#8BC34A"},3:{label:"3 = Adequate condition",color:"#FFEB3B"},2:{label:"2 = Poor condition",color:"#FF9800"},1:{label:"1 = Very poor condition",color:"#F44336"}},gV={0:"#85474b",1:"#aed6f1",2:"#5dade2",3:"#2e86c1"},Im="#85474b",yV=["603 E 9th St","603 E. 9th St","607 E 9th St","MacKay House","McKay House","905 N Elm St","905 N Elm Ave","Name 1","Name1","706 E. 7th St","706 E 7th St","706 E. 7th St. Residence","710 E. 7th St.","710 E 7th St","710 E. 7th St. Residence","714 E. 7th St.","714 E 7th St","714 E. 7th St. Residence","812 N Ash St","812 N Ash Ave","906 E 9th St","Campus Safety","The 1882 Residence Hall","1882 Residence Hall","Hayes M. Fuhr Hall of Music","Hayes M Fuhr Hall of Music"],_V=yV.map(n=>String(n||"").toLowerCase()),vV=["downcase",["to-string",["coalesce",["get","id"],["get","name"]]]],xV=["in",vV,["literal",_V]],Qh=(n,e="#d1d5db")=>["case",xV,e,n],bV=n=>Number.isFinite(n)?n>=80?"#22c55e":n>=60?"#84cc16":n>=40?"#facc15":n>=20?"#f97316":"#ef4444":"#e5e7eb",P8=({config:n,universityId:e,mode:t="public",persona:i,engagementMode:c=!1})=>{const u=bo(null),m=bo(null),_=bo(null),o=bo(null),w=bo({}),I=bo(null),O=bo(null),V=bo(null),[M,se]=qn(!1),[ce,fe]=qn("select"),[ne,oe]=qn(t==="admin"),[ye,he]=qn([]),[Ne,Ve]=qn({}),[de,j]=qn({}),[D,$]=qn(null),[z,W]=qn(td[0]?.name||""),Ee=n?.universityName||n?.name||""||e||"Campus",ke={SPACE_DATA:"space-data",ASSESSMENT:"assessment",TECHNICAL:"technical"},Oe=c?ke.ASSESSMENT:ke.SPACE_DATA,[Re,be]=qn(Oe),De=[{value:ke.SPACE_DATA,label:"Space Data"},{value:ke.ASSESSMENT,label:"Assessment Progress"},{value:ke.TECHNICAL,label:"Technical"}],Qe=t==="admin"?De:De.filter(U=>U.value===ke.SPACE_DATA),[xe,ae]=qn(!0),[Me,Fe]=qn(!1),[Ze,et]=qn(!0);ji(()=>{const U=m.current;if(!U)return()=>{};const ge=()=>{U.querySelectorAll('.mapboxgl-popup-close-button[aria-hidden="true"]').forEach(nt=>nt.removeAttribute("aria-hidden"))};ge();const Pe=new MutationObserver(ge);return Pe.observe(U,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["aria-hidden"]}),()=>Pe.disconnect()},[]);const[mt,ht]=qn(!0),Nt=Fl(()=>Pj(Cj),[]),Jt=Fl(()=>Array.from(new Set([...Object.keys(u3),...d3])).sort(),[]),[tn,fn]=qn(null),[An,zt]=qn(null),[it,ur]=qn(null),[xr,Tr]=qn(null),[Tn,Yn]=qn("building"),[$n,hr]=qn(null),[Wt,Nn]=qn({}),[tr,Hn]=qn(0),[Rr,lr]=qn([]),[wr,br]=qn(new Map),[Ir,Bi]=qn(null),Mi=bo([]),[pr,Jr]=qn(null),[Kr,Sr]=qn(""),ui=bo(null),ii=bo(!1),ut=bo(""),[we,Ie]=qn(null),[Ye,ct]=qn(""),Ct=bo(null),Rt=bo(!1),Bt=bo(""),St=bo(null),[Mt,vn]=qn(Nt),[Bn,Ln]=qn(Jt),[qr,Cr]=qn(new Set),[Ar,Dr]=qn("__all__"),[_i,ko]=qn(""),[ro,os]=qn("rooms"),[Ji,Yo]=qn(!1),[oo,Jo]=qn(""),[La,zl]=qn(!1),[jl,Fi]=qn(!1),[nc,Hc]=qn(""),[Oi,Sc]=qn(null),[Pa,Qo]=qn(!1),[Sa,Ec]=qn(!1),[hl,Ea]=qn(""),[Ro,pn]=qn(null),[ss,as]=qn(!1),[Qi,Au]=qn(!1),[ka,Za]=qn(""),[ls,Us]=qn(null),[Qn,Fr]=qn(!1),[ei,aa]=qn(!1),[fa,vi]=qn(""),[Lr,dl]=qn(null),[zi,es]=qn(!1),[_o,Tu]=qn(""),[Sl,Ac]=qn(!1),[rc,El]=qn(""),[Mo,ys]=qn(null),[Ps,ja]=qn(!0),[oi,ts]=qn(!1),[No,Xu]=qn(!1),[Ul,Ao]=qn(""),[Vs,Ku]=qn(!1),[fl,To]=qn(""),[vo,Ss]=qn(null),[Oo,Vo]=qn(null),[Tc,Bo]=qn("Campus Summary"),[Al,Ma]=qn(!1),[pl,ic]=qn(null),[qs,$s]=qn([]),[si,Gs]=qn([]),[qo,Es]=qn(!1),[As,Ya]=qn(!1),[ks,Ws]=qn(""),[Vl,H]=qn(null),[Le,pt]=qn({buildings:{},rooms:{},campus:null}),[Pt,qt]=qn(!1),on=bo(null),Dn=bo(null),Pr=Fl(()=>A8(qs.length?qs:si),[qs,si]),$r=Fl(()=>Le?.buildings||{},[Le]),gi=Fl(()=>Le?.rooms||{},[Le]),xi=Le?.campus||null,so=Fl(()=>{const U={};return Object.entries($r||{}).forEach(([ge,Pe])=>{if(!ge)return;U[ge]=Pe;const Xe=v8[ge];Xe&&(U[Xe]=Pe)}),U},[$r]),lo=nr(U=>{if(!U)return null;const ge=np(U)||U;return $r[ge]||null},[$r]),_s=nr((U,ge)=>{if(!U||!ge)return null;const Pe=np(U)||U,Xe=b8(Pe,ge);return gi[Xe]||null},[gi]),[eo,$o]=qn(null),[Go,ds]=qn(!1),[zo,Ms]=qn("unknown"),Ja=zo==="down",Hs=zo==="ok",L=zo==="unknown",re=Fl(()=>({DEPARTMENT:"department",TYPE:"type",OCCUPANCY:"occupancy",VACANCY:"vacancy"}),[]),[_e,$e]=qn("department"),Xt=(U,ge)=>{const Pe=new Set(U);return(ge||[]).forEach(Xe=>{Xe&&Pe.add(Xe)}),Array.from(Pe).sort()},nn=nr(U=>{const ge=_.current;if(!ge||!ge.getLayer(Af))return;const Pe=Array.isArray(U)?U.filter(nt=>nt!=null):U!=null?[U]:[];Mi.current=Pe;const Xe=Pe.length?["any",["in",["id"],["literal",Pe]],["in",["get","RevitId"],["literal",Pe]]]:["==",["id"],""];try{ge.setFilter(Af,Xe),ge.getLayer(Xm)&&ge.setFilter(Xm,Xe)}catch{}},[]),[Un,mo]=qn(new Map),[jo,Hi]=qn(!1),[Qr,xo]=qn(null),[fs,pa]=qn([]),[Rs,Tl]=qn(null),Ua=bo([]),Xc=nr((U=[])=>(U||[]).map(ge=>ge?.highlightId??ge?.revitId??ge?.roomId??null).filter(ge=>ge!=null),[]),ml=nr((U=[])=>{const ge=Xc(U);nn(ge.length?ge:null)},[Xc,nn]),Qa=nr(()=>{Ua.current=[],pa([]),ml([])},[ml]),ma=nr(U=>{const ge=_.current,Pe=ph(ge,xa);if(!Pe)return;const Xe=Pe._data||Pe.serialize?.()?.data||null,nt=Uu(Xe);if(!nt?.features?.length)return;const tt=new Map,ot=new Map,Lt=gt=>{if(Number.isFinite(gt))return gt;const Ht=Number(gt);return Number.isFinite(Ht)?Ht:String(gt)};nt.features.forEach(gt=>{const Ht=gt.properties||{},Yt=op(Ht);if(!Number.isFinite(Yt)||Yt<=0)return;const bn=Ht.__roomType??Ht.NCES_Type??Ht.RoomType??Ht["Room Type"]??Ht.Type??Ht.type??Ht.Name??"",rn=J1(bn);let Zt="",En="#e6e6e6";const Br=(vr={})=>{const Ei=vr.occupancyStatus??vr["Occupancy Status"]??vr.OccupancyStatus??vr.Occupancy??vr.Vacancy??vr.vacancy??vr.Vacant??"",ni=String(Ei??"").trim();if(ni){const qi=ni.toUpperCase();return qi.includes("VACANT")||qi.includes("UNOCCUPIED")||qi.includes("AVAILABLE")||qi.includes("UNASSIGNED")?"Vacant":qi.includes("OCCUPIED")?"Occupied":"Unknown"}return(vr.occupant??vr.Occupant??"").toString().trim()?"Occupied":"Unknown"};if(U===re.TYPE)Zt=(Ht.__roomType||"").toString().trim()||"Unknown",En=B5(Zt);else if(U===re.OCCUPANCY){if(!rn)return;Zt=Br(Ht),En=Zt==="Occupied"?"#29b6f6":Zt==="Vacant"?"#ff7043":"#cfd8dc"}else if(U===re.VACANCY){if(!rn)return;Zt=Br(Ht),En=Zt==="Vacant"?"#ff7043":"#cfd8dc"}else Zt=Fy(Ht)||"Unspecified",En=Gd(Zt)||"#e6e6e6";const zr=tt.get(Zt)||{name:Zt,areaSf:0,color:En};zr.areaSf+=Yt,zr.color=En,tt.set(Zt,zr);const Gn=Lt(gt.id??Ht.RevitId??Ht.id);if(Gn!=null){const vr=ot.get(Zt)||[];vr.push(Gn),ot.set(Zt,vr)}});const _t=Array.from(tt.values()).map(gt=>({...gt,ids:ot.get(gt.name)||[]})).sort((gt,Ht)=>(Ht.areaSf||0)-(gt.areaSf||0));lr(_t),br(new Map(_t.map(gt=>[gt.name,gt.ids||[]])))},[re.OCCUPANCY,re.TYPE,re.VACANCY]),Xs=nr(U=>{const ge=_.current;if(!ge||!ge.getLayer(us))return;const Pe=ph(ge,xa),Xe=Pe&&(Pe._data||Pe.serialize?.().data)||null,nt=Uu(Xe),tt=U===re.VACANCY?re.OCCUPANCY:U;if(tt===re.DEPARTMENT&&nt?.features?.length){const ot=new Map,Lt=new Map,_t=new Map,gt=bn=>{if(Number.isFinite(bn))return bn;const rn=Number(bn);return Number.isFinite(rn)?rn:bn!=null?String(bn):null};nt.features.forEach(bn=>{const rn=bn.properties||{},Zt=Fy(rn)||"Unspecified",En=Gd(Zt)||"#e6e6e6";ot.set(Zt,En);const Br=op(rn);if(Number.isFinite(Br)&&Br>0){const Gn=Lt.get(Zt)||0;Lt.set(Zt,Gn+Br)}const zr=gt(bn.id??rn.RevitId??rn.id);if(zr!=null){const Gn=_t.get(Zt)||[];Gn.push(zr),_t.set(Zt,Gn)}});const Ht=[];ot.forEach((bn,rn)=>{Ht.push(rn,bn)});const Yt=["match",["coalesce",["feature-state","department"],["get","department"],["get","Department"],["get","Dept"],["get","NCES_Department"],["get","NCES_Dept"]],...Ht,"#e6e6e6"];try{ge.setPaintProperty(us,"fill-color",Yt),ge.setPaintProperty(us,"fill-opacity",1);const bn=Array.from(ot.entries()).map(([rn,Zt])=>({name:rn,color:Zt,areaSf:Lt.get(rn)||0,ids:_t.get(rn)||[]})).sort((rn,Zt)=>(Zt.areaSf||0)-(rn.areaSf||0));lr(bn),br(new Map(bn.map(rn=>[rn.name,rn.ids||[]])));return}catch{}}if(tt===re.TYPE&&nt?.features?.length){const ot=new Map,Lt=new Map,_t=new Map,gt=rn=>{if(Number.isFinite(rn))return rn;const Zt=Number(rn);return Number.isFinite(Zt)?Zt:rn!=null?String(rn):null};nt.features.forEach(rn=>{const Zt=rn.properties||{},En=(Zt.__roomType||"").toString().trim()||"Unknown",Br=B5(En);ot.set(En,Br);const zr=op(Zt);if(Number.isFinite(zr)&&zr>0){const vr=Lt.get(En)||0;Lt.set(En,vr+zr)}const Gn=gt(rn.id??Zt.RevitId??Zt.id);if(Gn!=null){const vr=_t.get(En)||[];vr.push(Gn),_t.set(En,vr)}});const Ht=[];ot.forEach((rn,Zt)=>{Ht.push(Zt,rn)});const bn=["match",["case",["any",["!",["has","__roomType"]],["==",["get","__roomType"],""]],"Unknown",["get","__roomType"]],...Ht,"#e6e6e6"];try{ge.setPaintProperty(us,"fill-color",bn),ge.setPaintProperty(us,"fill-opacity",1);const rn=Array.from(ot.entries()).map(([Zt,En])=>({name:Zt,color:En,areaSf:Lt.get(Zt)||0,ids:_t.get(Zt)||[]})).sort((Zt,En)=>(En.areaSf||0)-(Zt.areaSf||0));lr(rn),br(new Map(rn.map(Zt=>[Zt.name,Zt.ids||[]])));return}catch{}}V5(ge,tt),ma(tt),$e(tt)},[re.TYPE,V5,ma]);ji(()=>{Ua.current=fs},[fs]);const Kc=nr(()=>{Hi(!1),xo(null),Qa(),nn(null),Cr(new Set),Tl(null)},[Qa,nn]),Uo=Qr?.targets?.length?Qr.targets:Qr?[Qr]:[],tl={...(Uo[0]||null)?.feature?.properties||{},...Qr?.properties||{}},Ks=["Occupied","Vacant","Unknown"],Ic=(U={})=>U.occupancyStatus??U["Occupancy Status"]??U.OccupancyStatus??U.Occupancy??U.occupancy??"",Cc=(U={})=>U.seatCount??U.SeatCount??U["Seat Count"]??U.Seats??U.Capacity??U.rm_seats??U.SeatingCapacity??U["NCES_Seat Count"]??U.NCES_Seat_Count??U["NCES_Seat Count"]??U.NCES_SeatCount??"",ql=(U=[])=>{const ge=Array.from(new Set((U||[]).map(Pe=>(Pe??"").toString().trim()).filter(Boolean)));return ge.length?ge.length===1?ge[0]:"__MIXED__":""},Zc=Uo.length>1,lu=Qr?.properties?.occupancyStatus,Yc=lu!=null?String(lu).trim():"",cu=Yc.length>0,Lc=Zc?cu?Yc:ql(Uo.map(U=>{const ge={...U?.feature?.properties||{},...U?.properties||{}};return Ic(ge)})):Yc||String(Ic(tl)||"").trim(),Jc=Qr?.properties?.seatCount,uu=Jc!=null?String(Jc).trim():"",Qc=Zc?uu||ql(Uo.map(U=>{const ge={...U?.feature?.properties||{},...U?.properties||{}};return Cc(ge)})):uu||String(Cc(tl)||"").trim(),$l=Uo.length>0&&Uo.every(U=>{const ge={...U?.feature?.properties||{},...U?.properties||{},...Qr?.properties||{}},Pe=nd(ge)||ge.type||ge["Room Type"]||ge["Room Type Description"]||"";return J1(Pe)}),Gl=Uo.length>0&&Uo.every(U=>{const ge={...U?.feature?.properties||{},...U?.properties||{},...Qr?.properties||{}},Pe=nd(ge)||ge.type||ge["Room Type"]||ge["Room Type Description"]||"";return w1(Pe)});Pf(tl,["NCES_Category","NCES Category","NCES_Category_Code","NCES Category Code"]),Pf(tl,["NCES_Type","NCES Type","NCES_Type_Code","NCES Type Code"]),Pf(tl,["NCES_Type Description_Sh","NCES_Type Description","NCES Type Description","NCES_Type Description_Short"]);const ns=bo(null),Ts=bo(null),Li=bo(null),Io=bo(null),yr=bo({url:null,key:null,buildingId:null,floorId:null}),la=bo(null),oc=bo({}),sc=bo({}),Il=bo(new Map),hu=bo(new Map);bo({});const ac=bo(null),nl=bo(null);bo({});const[Ur,Wl]=qn("LEVEL_1"),[Zs,eu]=qn([]),ga=bo(new Map),du=bo(new Map),Iu=Fl(()=>{const U=n?.buildings?.features||[],ge=U.find(Xe=>String(Xe?.properties?.id)===String(D));return ge||U.find(Xe=>(Xe?.properties?.name||"")===(z||""))||null},[n,D,z]),Ai=Iu?.properties?.name||z||D||"Building",Ra=Ur??(Zs?.[0]||""),Hl=nr(U=>U?ga.current.get(U)??[]:[],[]),ca=nr(U=>{if(!U)return null;const ge=np(U);return ge&&Wp[ge]?Wp[ge]:y8.has(U)?U:null},[]),Or=nr((U,ge)=>{const Pe=Wg(ge);if(!U||!Pe)return null;const Xe=ca(U);if(!Xe||!Hl(Xe).includes(Pe))return null;const ot=du.current.get(Xe)?.get(Pe);if(ot)return/^https?:\/\//i.test(ot)?ot:$d(ot);const Lt=encodeURIComponent(j5),_t=encodeURIComponent(Xe),gt=encodeURIComponent(Pe);return $d(`floorplans/${Lt}/${_t}/Rooms/${gt}_Dept_Rooms.geojson`)},[Hl,ca]),Ys=nr(async U=>{const ge=ca(U);if(!ge)return[];const Pe=Hl(ge),Xe=du.current.has(ge);if(Pe.length&&Xe)return Pe;const nt=await vA(ge),tt=(nt||[]).map(Lt=>Wg(Lt?.id)).filter(Boolean),ot=new Map((nt||[]).filter(Lt=>Lt?.id&&Lt?.url).map(Lt=>[Lt.id,Lt.url]));return ga.current.set(ge,tt),du.current.set(ge,ot),tt},[ca,Hl]),[fu,Zu]=qn([]),[Ui,Cl]=qn(!1);bo([]);const vh=bo(null),rs=Fl(()=>Or(z,Ur),[z,Ur,Or]);ji(()=>{vh.current=rs},[rs]),ji(()=>{ui.current=pr,ii.current=!!pr},[pr]),ji(()=>{Ct.current=we,Rt.current=!!we},[we]),ji(()=>{if(!M||!_.current)return;const ge=_.current.getCanvas();if(ge){if(pr){ut.current=ge.style.cursor||"",ge.style.cursor="crosshair";return}we||(ge.style.cursor=ut.current||"")}},[M,pr]),ji(()=>{if(!M||!_.current)return;const ge=_.current.getCanvas();if(ge){if(we){Bt.current=ge.style.cursor||"",ge.style.cursor=we==="move"?"move":"grab";return}pr||(ge.style.cursor=Bt.current||"")}},[M,we,pr]),ji(()=>{!M||!rs||Xs(_e)},[M,rs,_e,Xs]),ji(()=>{!M||!rs||ma(_e)},[M,rs,_e,ma]),ji(()=>{Bi(null),nn(null)},[_e,rs,nn]),ji(()=>{Qa()},[D,rs,Qa]),ji(()=>{zl(!1),Fi(!1),Sc(null),Hc(""),Qo(!1),Ec(!1),pn(null),Ea(""),es(!1),Ac(!1),ys(null),El("")},[D,z,Ur]),ji(()=>{pr&&(Jr(null),Sr(""))},[D,z,Ur]),ji(()=>{we&&(Ie(null),ct(""))},[D,z,Ur]);const[rl,Pc]=qn(!1),[Aa,Co]=qn(new Set),[Vh,kc]=qn({}),[Vi,lc]=qn(""),[cc,or]=qn(""),[go,Cu]=qn({totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}}),Lu=Fl(()=>{const U=new Set([...Object.keys(go.roomTypes||{}),...Object.keys(go.sfByRoomType||{})]);return Array.from(U).map(ge=>({type:ge,count:go.roomTypes?.[ge]??0,sf:go.sfByRoomType?.[ge]??0}))},[go]),[qh,ya]=qn(!1),Na=bo(new Map),Mc=bo(new Set),[Yu,tu]=qn(20),[gl,Ju]=qn(null),pu=bo(null),Ch=bo(null),Qu="scenario-highlight",Qd="rgba(255, 159, 64, 0.9)",xh="#ff9f40",Lh=nr(()=>{const U=_.current;if(U&&U.getLayer(Qu))try{U.removeLayer(Qu)}catch{}},[]),Ta=nr((U=[])=>{if(!U.length)return;const ge=_.current;if(!ge)return;const Pe=ph(ge,xa);if(!Pe)return;const Xe=Pe._data||Pe.serialize?.()?.data,nt=Uu(Xe);if(!nt?.features?.length)return;const tt=new Map;if(U.forEach(({revitId:gt,dept:Ht})=>{gt!=null&&tt.set(String(gt),Ht??null)}),!tt.size)return;let ot=!1;const Lt=nt.features.map(gt=>{const Ht=gt.id??gt.properties?.RevitId;if(Ht==null)return gt;const Yt=String(Ht);if(!tt.has(Yt))return gt;const bn=tt.get(Yt),rn={...gt.properties||{}},Zt=gt.properties?.scenarioDepartment??null;bn?rn.scenarioDepartment=bn:delete rn.scenarioDepartment;const En=rn.scenarioDepartment??null;return Zt===En?gt:(ot=!0,{...gt,properties:rn})});if(!ot)return;const _t={...nt,features:Lt};try{Pe.setData(_t)}catch{}yr.current&&(yr.current={...yr.current||{},fc:_t})},[]),Da=nr((U=[],ge=Na.current)=>{const Pe=_.current;Pe&&ph(Pe,xa)&&U.forEach(Xe=>{const nt=ge.get(Xe);if(nt?.revitId)try{Kb(nt.revitId).forEach(ot=>{Pe.removeFeatureState({source:xa,id:ot},"scenarioColor"),Pe.removeFeatureState({source:xa,id:ot},"scenarioOutlineColor"),Pe.removeFeatureState({source:xa,id:ot},"scenarioDepartment")})}catch{}})},[]),Va=nr(()=>{const ge=Array.from(Na.current.values()).filter(Pe=>Pe?.revitId!=null).map(Pe=>({revitId:Pe.revitId,dept:null}));Da(Array.from(Mc.current),Na.current),ge.length&&Ta(ge),Na.current=new Map,Mc.current=new Set,Co(new Set),kc({}),Cu({totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}}),lc(""),or(""),ya(!1),Ju(null),tu(20),ts(!1),Lh()},[Da,Lh,Ta]),yl=nr(()=>{Va()},[Va]),uc=nr(()=>{const U=_.current;if(!(!U||!ph(U,xa))&&!U.getLayer(Qu))try{U.addLayer({id:Qu,type:"fill",source:xa,paint:{"fill-color":["coalesce",["feature-state","scenarioColor"],Qd],"fill-outline-color":["coalesce",["feature-state","scenarioOutlineColor"],xh],"fill-opacity":1},filter:["==",["get","id"],""]}),U.getLayer(wd)&&U.moveLayer(Qu,wd),H5(U)}catch{}},[]),_a=nr(U=>{uc();const ge=_.current;if(!ge||!ge.getLayer(Qu))return;const Pe=Array.isArray(U)?U.flatMap(tt=>Kb(tt)):[],Xe=Array.from(new Set(Pe)),nt=Xe.length?["any",["in",["id"],["literal",Xe]],["in",["get","RevitId"],["literal",Xe]],["in",["get","Revit_UniqueId"],["literal",Xe]],["in",["get","Revit Unique Id"],["literal",Xe]],["in",["get","Room GUID"],["literal",Xe]]]:["==",["id"],""];try{ge.setFilter(Qu,nt)}catch{}},[uc]),qa=nr(U=>{const ge={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}},Pe=[],Xe=Na.current;return U.forEach(nt=>{const tt=Xe.get(nt);if(!tt)return;const ot=Number.isFinite(Number(tt.area))?Number(tt.area):0,Lt=sa(tt.roomType??tt.type??"Unknown")||"Unknown";ge.rooms+=1,ge.totalSF+=ot,ge.roomTypes[Lt]=(ge.roomTypes[Lt]||0)+1,ge.sfByRoomType[Lt]=(ge.sfByRoomType[Lt]||0)+ot,tt.revitId!=null&&Pe.push(tt.revitId),tt.roomGuid&&tt.roomGuid!==tt.revitId&&Pe.push(tt.roomGuid)}),{totals:ge,highlightIds:Pe}},[]),od=nr((U,ge)=>{const Pe=U?.buildingLabel&&(U?.floorName||U?.floorId)&&U?.revitId!=null?qd(U.buildingLabel,U.floorName||U.floorId,U.revitId):null,Xe=U?.roomId||Pe||U?.id||[U?.buildingLabel,U?.floorName||U?.floorId,U?.roomLabel,ge].filter(Boolean).join("|")||`cand-${ge}`,nt=U?.roomGuid??U?.revitUniqueId??U?.revitUniqueID??null,tt=U?.revitId??nt??null;return{roomId:Xe,buildingId:U?.buildingLabel||"",buildingName:U?.buildingLabel||"",floorName:U?.floorName||U?.floorId||"",revitId:tt,roomGuid:nt,roomNumber:U?.roomLabel||"",roomType:U?.type||"Unspecified",department:U?.department||"",area:Number(U?.sf||0)||0}},[]),Id=nr(U=>{kc(ge=>{const Pe={};return U.forEach(Xe=>{ge[Xe]&&(Pe[Xe]=ge[Xe])}),Pe})},[]),Fa=nr(U=>{const{totals:ge,highlightIds:Pe}=qa(U),Xe=Mc.current,nt=Array.from(Xe).filter(tt=>!U.has(tt));nt.length&&Da(nt,Na.current),Mc.current=new Set(U),Cu(ge),ya(U.size>0),_a(Pe),Id(U)},[qa,_a,Da,Id]),Rc=nr((U=[])=>{const ge=Mc.current;ge?.size&&Da(Array.from(ge),Na.current),Na.current=new Map,Mc.current=new Set;const Pe=new Set;(U||[]).forEach((Xe,nt)=>{const tt=od(Xe,nt);tt?.roomId&&(Na.current.set(tt.roomId,tt),Pe.add(tt.roomId))}),Co(Pe),Fa(Pe)},[od,Da,Fa]),eh=nr(U=>{U?.roomId&&Co(ge=>{const Pe=new Set(ge);return Pe.has(U.roomId)?Pe.delete(U.roomId):(Pe.add(U.roomId),Na.current.set(U.roomId,U)),Fa(Pe),Pe})},[Fa]),Ph=nr((U,ge=.35)=>HI(U,ge),[]),$h=nr((U,ge={})=>{const Pe=Na.current.get(U);if(!Pe?.revitId)return;const Xe=_.current;if(!Xe||!ph(Xe,xa))return;const nt={...ge};if(Object.keys(nt).length)try{Kb(Pe.revitId).forEach(ot=>{Xe.setFeatureState({source:xa,id:ot},nt)})}catch{}},[]),nu=nr(()=>{if(!Vi||Aa.size===0)return;const U=Gd(Vi)||xh,ge=Ph(U,.9);kc(Xe=>{const nt={...Xe};return Aa.forEach(tt=>{nt[tt]=Vi,$h(tt,{scenarioColor:ge,scenarioOutlineColor:U,scenarioDepartment:Vi})}),nt});const Pe=[];Aa.forEach(Xe=>{const nt=Na.current.get(Xe);nt?.revitId!=null&&Pe.push({revitId:nt.revitId,dept:Vi})}),Pe.length&&Ta(Pe)},[Vi,Aa,$h,Ph,Ta]),Nc=nr(async()=>{if(!Lr){alert("No scenario comparison available yet.");return}try{const U=new wi("p","pt","letter"),ge=U.internal.pageSize.getWidth(),Pe=U.internal.pageSize.getHeight(),Xe=36,nt=ge-Xe*2,tt=14;let ot=Xe;const Lt=(jr=tt)=>{ot+jr>Pe-Xe&&(U.addPage(),ot=Xe)},_t=(jr,Vr={})=>{const Ci=Vr.indent||0;Lt(tt),U.text(String(jr),Xe+Ci,ot),ot+=tt},gt=(jr,Vr={})=>{const Ci=Vr.indent||0,zn=Math.max(50,nt-Ci);U.splitTextToSize(String(jr),zn).forEach(hn=>_t(hn,{indent:Ci}))},Ht=jr=>{jr&&(Lt(tt*1.2),U.setFont(void 0,"bold"),U.setFontSize(12),gt(jr),U.setFont(void 0,"normal"),U.setFontSize(11))},Yt=(jr=[])=>{const Vr=Array.isArray(jr)?jr:[];Vr.length&&Vr.forEach(Ci=>gt(`- ${Ci}`,{indent:8}))},bn=(jr={})=>{let Vr=0,Ci=0,zn=0;for(const[an,hn]of Object.entries(jr||{})){const Rn=String(an||"").toLowerCase(),gr=Number(hn||0)||0;Rn.includes("office")?Vr+=gr:Rn.includes("class")?Ci+=gr:Rn.includes("lab")&&(zn+=gr)}return{offices:Vr,classrooms:Ci,labs:zn}},rn=Lr?.scenarioDept||Vi||"Scenario",Zt=eo?.__label||"baseline",En=Ai||z||D||"scenario",Br=Ur?` (${Ur})`:"";U.setFontSize(16),U.setFont(void 0,"bold"),_t("Scenario Comparison"),U.setFont(void 0,"normal"),U.setFontSize(11),gt(`${rn} - ${Zt} to ${En}${Br}`),Lr.summary&&(Ht("Summary"),gt(Lr.summary)),Ht("Totals");const zr=eo||{},Gn=go||{},vr=bn(zr.roomTypes),Ei=bn(Gn.roomTypes);_t(`Baseline (${Zt})`),_t(`Total SF: ${Math.round(zr.totalSF||0).toLocaleString()}`,{indent:8}),_t(`Rooms: ${Math.round(zr.rooms||0).toLocaleString()}`,{indent:8}),(vr.offices||vr.classrooms||vr.labs)&&(_t(`Offices: ${vr.offices}`,{indent:8}),_t(`Classrooms: ${vr.classrooms}`,{indent:8}),_t(`Labs: ${vr.labs}`,{indent:8})),ot+=tt/2,_t(`Scenario (${En})`),_t(`Total SF: ${Math.round(Gn.totalSF||0).toLocaleString()}`,{indent:8}),_t(`Rooms: ${Math.round(Gn.rooms||0).toLocaleString()}`,{indent:8}),(Ei.offices||Ei.classrooms||Ei.labs)&&(_t(`Offices: ${Ei.offices}`,{indent:8}),_t(`Classrooms: ${Ei.classrooms}`,{indent:8}),_t(`Labs: ${Ei.labs}`,{indent:8}));const ni=(Gn.totalSF||0)-(zr.totalSF||0),Hr=(Gn.rooms||0)-(zr.rooms||0);_t(`Delta SF: ${Math.round(ni).toLocaleString()}`,{indent:8}),_t(`Delta Rooms: ${Math.round(Hr).toLocaleString()}`,{indent:8}),Lr?.scenarioPros?.length&&(Ht("Pluses"),Yt(Lr.scenarioPros)),Lr?.scenarioCons?.length&&(Ht("Minuses"),Yt(Lr.scenarioCons)),Lr?.risks?.length&&(Ht("Risks / watchouts"),Yt(Lr.risks)),Lr?.notes?.length&&(Ht("Notes"),Yt(Lr.notes)),Array.isArray(Lr?.data_used)&&Lr.data_used.length&&(Ht("Data used"),gt(Lr.data_used.join(", ")));const qi=(jr,Vr)=>{if(!jr?.data)return;U.addPage();const Ci=36,zn=U.internal.pageSize.getWidth(),an=U.internal.pageSize.getHeight(),hn=Vr?`Floorplan - ${Vr}`:"Floorplan";U.setFont(void 0,"bold"),U.setFontSize(14),U.text(hn,Ci,Ci),U.setFont(void 0,"normal"),U.setFontSize(11);const Rn=jr.height&&jr.width?jr.height/jr.width:1;let gr=zn-Ci*2,Xr=gr*Rn;const Ni=an-Ci*2-18;Xr>Ni&&(Xr=Ni,gr=Xr/(Rn||1));const sl=Ci,ti=Ci+18;U.addImage(jr.data,"PNG",sl,ti,gr,Xr)},Mr=new Map;Aa.forEach(jr=>{const Vr=Na.current.get(jr);if(!Vr)return;const Ci=Vr?.buildingName||Vr?.buildingId||Ai||z||"",zn=Vr?.floorName||Vr?.floorId||Ur||"";if(!Ci||!zn)return;const an=`${Wc(Ci)}|${ec(zn)}`;Mr.has(an)||Mr.set(an,{buildingLabel:Ci,floorLabel:zn,ids:[]});const hn=Mr.get(an);Vr?.revitId!=null&&hn.ids.push(Vr.revitId),Vr?.roomGuid&&Vr.roomGuid!==Vr.revitId&&hn.ids.push(Vr.roomGuid)});const Gr=[];if(Mr.size)for(const jr of Mr.values()){const Vr=await Ys(jr.buildingLabel),Ci=S1(jr.floorLabel,Vr)||jr.floorLabel,zn=Or(jr.buildingLabel,Ci);if(!zn)continue;let an=ms.get(zn);if(!an)try{an=await ed(zn),an&&ms.set(zn,an)}catch{}const hn=Uu(an);if(!hn?.features?.length)continue;const Rn=Rg({fc:hn,colorMode:_e,solidFill:!0,selectedIds:jr.ids,labelOptions:{hideDrawing:!0}});Rn?.data&&Gr.push({img:Rn,label:`${jr.buildingLabel} - ${Ci}`})}if(Gr.length)Gr.forEach(jr=>qi(jr.img,jr.label));else{const jr=[];Aa.forEach(zn=>{const an=Na.current.get(zn);an?.revitId!=null&&jr.push(an.revitId),an?.roomGuid&&an.roomGuid!==an.revitId&&jr.push(an.roomGuid)});const Vr=yr?.current;let Ci=Vr?.fc?Rg({...Vr,colorMode:_e,solidFill:!0,selectedIds:jr,labelOptions:{hideDrawing:!0}}):null;if(!Ci?.data&&z&&Ur){const zn=Or(z,Ur);if(zn){let an=ms.get(zn);if(!an)try{an=await ed(zn),an&&ms.set(zn,an)}catch{}const hn=Uu(an);hn?.features?.length&&(Ci=Rg({fc:hn,colorMode:_e,solidFill:!0,selectedIds:jr,labelOptions:{hideDrawing:!0}}))}}if(Ci?.data){const zn=Vr?.floor||Vr?.floorId||Ur||"";qi(Ci,zn||"")}}const Ri=`${rn}-scenario-compare`.replace(/\s+/g,"-").replace(/[^\w-]+/g,"").toLowerCase();U.save(`${Ri}.pdf`)}catch(U){console.error("Scenario export failed",U),alert("Export failed - see console for details.")}},[Lr,Vi,eo,go,Ai,z,D,Ur,Aa,_e,Ys,S1,Or,ed]);ji(()=>{rl&&uc()},[rl,uc]),ji(()=>{if(!rl||Aa.size===0)return;const{highlightIds:U}=qa(Aa);_a(U)},[rl,Aa,rs,qa,_a]);const[Lo,Xi]=qn(!1),[Ll,va]=qn(null),[Is,Xl]=qn(null);ji(()=>{Lo||rl||ml(fs)},[fs,ml,Lo,rl]);const $a=U=>{const ge=m.current?.clientWidth??0,Pe=m.current?.clientHeight??0,Xe=ge||1e3,nt=Pe||800,tt=U.x+110,ot=U.y-160,Lt=Math.max(8,nt*.15),_t=Math.max(Lt,Math.min(nt-220,nt*.65));return{x:Math.min(Math.max(tt,8),Xe-260),y:Math.min(Math.max(ot,Lt),_t)}},Pl=nr(U=>{!U||gl||tu(()=>{const ge=m.current?.clientHeight??0,Pe=Math.max(360,(ge||0)*.7),Xe=Math.max(8,(ge||800)-Pe-40),nt=U.y-120;return Math.max(8,Math.min(nt,Xe))})},[gl]),sd=nr(()=>{gl||tu(U=>{const ge=m.current?.clientHeight??0,Pe=Math.max(360,(ge||0)*.7),Xe=Math.max(8,(ge||800)-Pe-40);return Math.max(8,Math.min(U-40,Xe))})},[gl]),[Ga,Dc]=qn(null),[Ia,bh]=qn(!1),[sr,kh]=qn(!1),[C,F]=qn(!1),[Y,ie]=qn([]),Ce=nr(U=>U?np(U):null,[]),Be=nr(async U=>{if(!U)return null;const ge=[];if(typeof U=="string"&&U.endsWith("_Dept.geojson")){const ot=U.replace(/\/([^/]+)$/,"/Rooms/$1");ge.push(U.replace("_Dept.geojson","_Dept_Rooms.geojson").replace(/\/([^/]+)$/,"/Rooms/$1")),ge.push(ot),ge.push(U.replace("_Dept.geojson","_Dept_Rooms.geojson")),ge.push(U)}else ge.push(U);for(const ot of ge)if(sc.current[ot])return sc.current[ot];let Pe=null,Xe=null;for(const ot of ge)if(Pe=ms.get(ot),Pe||(Pe=await ed(ot),Pe&&ms.set(ot,Pe)),Pe){Xe=ot;break}if(!Pe)return console.warn("Floor summary: no data returned",U),null;const nt=Uu(Pe);if(!Array.isArray(nt?.features))return console.warn("Floor summary: no features, skipping",Xe||U),null;const tt=y3(nt.features);for(const ot of ge)sc.current[ot]=tt;return tt},[]),qe=nr(async(U,ge)=>{const Pe=Or(U,ge);return Pe?Be(Pe):null},[Or,Be]),Ke=nr(async U=>{if(!U)return null;const ge=Ce(U)||U;if(!ge)return null;if(oc.current[ge])return oc.current[ge];const Pe=ca(ge);let Xe=Pe?Hl(Pe):[];if(Xe.length||(Xe=await Ys(ge)),!Xe.length)return null;const nt=_1(U),tt={totalSf:0,classroomSf:0,labSf:0,officeSf:0,rooms:0,classroomCount:0,labCount:0,officeCount:0,deptCounts:new Map};for(const Lt of Xe){const _t=Or(ge,Lt);if(!_t)continue;const gt=ec(Lt),Ht=`${nt}/${gt}`;let Yt=Il.current.get(Ht);Yt||(Yt=sc.current[_t],Yt||(Yt=await qe(ge,Lt)),Yt&&Il.current.set(Ht,Yt)),Yt&&(tt.totalSf+=Yt.totalSf||0,tt.classroomSf+=Yt.classroomSf||0,tt.labSf+=Yt.labSf||0,tt.officeSf+=Yt.officeSf||0,tt.rooms+=Yt.rooms||0,tt.classroomCount+=Yt.classroomCount||0,tt.labCount+=Yt.labCount||0,tt.officeCount+=Yt.officeCount||0,Object.entries(Yt.deptCounts||{}).forEach(([bn,rn])=>{tt.deptCounts.set(bn,(tt.deptCounts.get(bn)||0)+rn)}))}const ot=Cy(tt);return oc.current[ge]=ot,ot},[qe,Ce,Hl,ca,Or,Ys]),Je=nr(async U=>{if(!U)return{totalSf:void 0,rooms:void 0,classroomSf:void 0,classroomCount:void 0,labSf:void 0,labCount:void 0,officeSf:void 0,officeCount:void 0,totalsByDept:{}};if(qo&&Array.isArray(si)&&si.length){const Pe=ho(U);if(Pe){const Xe=si.filter(tt=>{const ot=tt?.building??tt?.buildingName??tt?.buildingLabel??"";return ho(ot)===Pe}),nt=Ng(Xe);if(nt)return nt}}return await Ke(U)??{totalSf:void 0,rooms:void 0,classroomSf:void 0,classroomCount:void 0,labSf:void 0,labCount:void 0,officeSf:void 0,officeCount:void 0,totalsByDept:{}}},[Ke,qo,si]),dt=nr(async()=>{const U=Z1();return(await Promise.all(td.map(async Pe=>{if(!Pe?.name)return null;try{return await Je(Pe.name)}catch(Xe){return console.warn("Campus summary: failed to load building stats for",Pe.name,Xe),null}}))).forEach(Pe=>{if(!Pe)return;U.totalSf+=Pe.totalSf||0,U.classroomSf+=Pe.classroomSf||0,U.labSf+=Pe.labSf||0,U.officeSf+=Pe.officeSf||0,U.rooms+=Pe.rooms||0,U.classroomCount+=Pe.classroomCount||0,U.labCount+=Pe.labCount||0,U.officeCount+=Pe.officeCount||0;const Xe=Pe.deptCounts||Pe.totalsByDept||{};Object.entries(Xe).forEach(([nt,tt])=>{const ot=Number(tt)||0;U.deptCounts.set(nt,(U.deptCounts.get(nt)||0)+ot)})}),Cy(U)},[Je]);ji(()=>{let U=!1;return(async()=>{try{const Pe=await dt();if(U)return;ur(Pe),Tr(ju(Pe,"campus"))}catch(Pe){if(U)return;console.warn("Campus summary load failed",Pe),ur(null),Tr(ju(null,"campus"))}})(),()=>{U=!0}},[dt]);const Dt=nr(async U=>{const ge=ca(U);if(!ge)return;let Pe=Hl(ge);if(Pe.length||(Pe=await Ys(U)),!!Pe.length)try{await Promise.all(Pe.map(Xe=>qe(U,Xe)))}catch(Xe){console.warn("Floor summary prefetch failed:",Xe)}},[ca,Hl,qe,Ys]),Qt=nr(U=>{if(Yn("building"),zt(null),!U){fn(null),hr(ju(null,"building"));return}const ge=Ce(U)||U;if(ac.current=ge,Li.current=null,yr.current={url:null,key:null,buildingId:null,floorId:null},hr({loading:!0,mode:"building"}),qo&&Array.isArray(si)&&si.length){const Pe=ho(U);if(Pe){const Xe=si.filter(tt=>{const ot=tt?.building??tt?.buildingName??tt?.buildingLabel??"";return ho(ot)===Pe}),nt=Ng(Xe);if(nt){fn(nt),hr(ju(nt,"building"));return}}}Je(U).then(Pe=>{ac.current===ge&&(Li.current||(fn(Pe),hr(ju(Pe,"building"))))}).catch(()=>{ac.current===ge&&(Li.current||(fn(null),hr(ju(null,"building"))))})},[Je,Ce]),ft=nr(U=>{if(!U)return;Yn("floor"),Li.current=U,hr({loading:!0,mode:"floor"});const ge=yr.current;if(qo&&Array.isArray(si)&&si.length){const Xe=ge?.buildingId||D||z,nt=ge?.floorLabel||Ur||"",tt=si.filter(Lt=>{const _t=Lt?.building??Lt?.buildingName??Lt?.buildingLabel??"";if(ho(_t)!==ho(Xe))return!1;if(!nt)return!0;const gt=rp(nt);return gt.length?ep(Lt?.floor??Lt?.floorName??Lt?.floorId??"",gt):!0}),ot=Ng(tt);if(ot){const Lt={...ot,floorLabel:nt};sc.current[U]=ot,zt(Lt),lr(Qf(jp(ot.totalsByDept))),hr(ju(ot,"floor"));return}}const Pe=sc.current[U];if(Pe){const Xe=ge?.floorLabel||Ur||"";zt({...Pe,floorLabel:Xe}),lr(Qf(jp(Pe.totalsByDept))),hr(ju(Pe,"floor"));return}if(ge?.url===U&&ge?.key){const Xe=Il.current.get(ge.key);if(Xe){const nt=ge.floorLabel||Ur||"";zt({...Xe,floorLabel:nt}),lr(Qf(jp(Xe.totalsByDept))),hr(ju(Xe,"floor"));return}}Be(U).then(Xe=>{if(Li.current!==U)return;const nt=yr.current;nt?.url===U&&nt?.key&&Xe&&Il.current.set(nt.key,Xe);const tt=nt?.floorLabel||Ur||"";zt(Xe?{...Xe,floorLabel:tt}:null),lr(Qf(jp(Xe?.totalsByDept))),hr(ju(Xe,"floor"))}).catch(()=>{Li.current===U&&(zt(null),hr(ju(null,"floor")))})},[Be,Ur]),Ot=nr(async()=>{try{const U=await Ud("/ai/api/rooms",{cache:"no-store",timeoutMs:8e3});let ge=null;try{ge=await U.json()}catch{}if(U.ok&&ge?.ok&&Array.isArray(ge.rooms))return $s(ge.rooms),H(new Date),!0}catch{}return!1},[]),Kt=nr(()=>{Dn.current||(Dn.current=setTimeout(()=>{Dn.current=null,Ot()},300))},[Ot]),Sn=nr(async()=>{if(As)return;Ya(!0),Ws("");const U=await Ot(),ge=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});Ws(U?`Refreshed ${ge}`:"Refresh failed"),Ya(!1)},[As,Ot]);ji(()=>()=>{Dn.current&&(clearTimeout(Dn.current),Dn.current=null)},[]);const y=nr(async U=>{if(t!=="admin"||!Ia||!U||!e)return null;const{buildingId:ge,buildingName:Pe,floorName:Xe,revitId:nt,roomId:tt,roomLabel:ot,roomNumber:Lt,roomGuid:_t,properties:gt={}}=U;if(!ge||!Xe||nt==null)return console.warn("Missing ids for room edit",U),null;const Ht=qd(ge,Xe,nt);try{const Yt=Gg(fh,"universities",e,"buildings",ge,"floors",Xe,"rooms",Ht),bn=String(gt.type??"").trim(),rn=nd(gt)||bn,Zt=J1(rn),En=Zt?String(gt.occupancyStatus??"").trim():"",Br=String(gt.department??"").trim(),zr=gt.occupant!=null,Gn=String(gt.occupant??"").trim(),vr=gt.seatCount!=null,Ei=gt.seatCount,ni=Number(Ei),Hr=Number.isFinite(ni)&&ni>0?ni:null,qi={type:bn||"",department:Br||"",comments:gt.comments||"",updatedAt:d1()};Zt&&(qi.occupant=gt.occupant||"",qi.occupancyStatus=gt.occupancyStatus||""),vr&&(qi.seatCount=Hr),await L5(Yt,qi,{merge:!0});const Mr=gt.airtableId||gt.AirtableId||gt.airtableID||gt["Airtable ID"]||gt["Airtable Id"]||null,Gr={};En&&(Gr.occupancyStatus=En),bn&&(Gr.type=bn),Br&&(Gr.department=Br),Zt&&zr&&(Gr.occupant=Gn),vr&&(Gr.seatCount=Hr);const Ri=String(Lt??gt.roomNumber??gt.RoomNumber??gt.Number??ot??"").trim(),jr=String(_t??gt.Revit_UniqueId??gt.revit_unique_id??gt.revitUniqueId??gt.RevitUniqueId??gt["Room GUID"]??gt.roomGuid??"").trim();let Vr=!1;if(Mr&&Object.keys(Gr).length)try{const an=await Ud(`/ai/api/rooms/${Mr}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(Gr)});if(an.ok)Vr=!0;else{const hn=await an.text().catch(()=>"");console.warn("Airtable update failed",an.status,hn)}}catch(an){console.warn("Airtable update failed",an)}if(!Vr&&(jr||Ri)&&Object.keys(Gr).length)try{const an=await Ud("/ai/api/rooms",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomId:jr||Ri,roomGuid:jr||void 0,building:ge,buildingName:Pe||"",floor:Xe,...Gr})});if(an.ok)Vr=!0;else{const hn=await an.text().catch(()=>"");console.warn("Airtable update by roomId failed",an.status,hn)}}catch(an){console.warn("Airtable update by roomId failed",an)}const Ci={type:gt.type||"",department:gt.department||"",occupant:Zt?gt.occupant||"":gt.occupant??"",occupancyStatus:Zt?gt.occupancyStatus||"":gt.occupancyStatus??"",comments:gt.comments||""};vr&&(Ci.seatCount=Hr,Ci.SeatCount=Hr,Ci["Seat Count"]=Hr),mo(an=>{const hn=new Map(an||[]),Rn=tt||Ht,gr=hn.get(Rn)||{};return hn.set(Rn,{...gr,...Ci}),hn});let zn=!1;Gs(an=>{if(!Array.isArray(an)||!an.length)return an;const hn=gt.airtableId||gt.AirtableId||gt.airtableID||gt["Airtable ID"]||gt["Airtable Id"]||null,Rn=Zn=>String(Zn||"").trim().toLowerCase().replace(/[^a-z0-9]/g,""),gr=String(tt??"").trim(),Xr=String(ot??"").trim(),Ni=nt!=null?String(nt):"",sl=gt.area??gt.areaSF??gt["Area (SF)"]??gt.Area_SF??gt.Area??null,ti=Number(sl)||0,cs=ho(ge),uo=ho(Xe),bs=Rn(ge),Oa=Rn(Xe),gc=[];let Do=an.map((Zn,_l)=>{if(!Zn)return Zn;const Sh=Zn.airtableId||Zn.AirtableId||Zn["Airtable ID"]||null,Rh=String(Zn.roomId??Zn.id??"").trim(),yc=ho(Zn.building??Zn.buildingName??Zn.buildingLabel??""),hd=ho(Zn.floor??Zn.floorId??Zn.floorName??""),gu=Rn(Zn.building??Zn.buildingName??Zn.buildingLabel??""),kd=Rn(Zn.floor??Zn.floorId??Zn.floorName??""),nh=cs&&yc===cs||bs&&gu===bs,Du=uo&&hd===uo||Oa&&kd===Oa,dd=hn&&Sh&&String(Sh)===String(hn)||gr&&Rh===gr||Ni&&Rh===Ni||Xr&&Rh===Xr;let Md=!1;if(!dd&&nh&&Du&&Xr){const rh=String(Zn.roomLabel??Zn.name??Zn.number??Zn.roomNumber??"").trim(),mi=String(Zn.roomId??Zn.id??"").trim();Md=rh&&rh===Xr||mi&&mi===Xr}if(!dd&&!Md){if(Xr&&!nh&&!Du){const rh=String(Zn.roomId??Zn.id??"").trim();rh&&rh===Xr&&gc.push(_l)}return Zn}return zn=!0,{...Zn,type:gt.type!=null?gt.type:Zn.type,department:gt.department!=null?gt.department:Zn.department,occupant:gt.occupant!=null?gt.occupant:Zn.occupant,occupancyStatus:gt.occupancyStatus!=null?gt.occupancyStatus:Zn.occupancyStatus,seatCount:vr?Hr:Zn.seatCount??Zn.SeatCount??Zn["Seat Count"],area:ti>0?ti:Zn.area??Zn.areaSF??Zn.sf??Zn.Area_SF??Zn.Area??Zn["Area (SF)"],areaSF:ti>0?ti:Zn.areaSF??Zn.sf??Zn.area??Zn.Area_SF??Zn.Area??Zn["Area (SF)"],sf:ti>0?ti:Zn.sf??Zn.areaSF??Zn.area??Zn.Area_SF??Zn.Area??Zn["Area (SF)"],roomLabel:Zn.roomLabel??Zn.name??Zn.number??Zn.roomNumber??Xr,comments:gt.comments!=null?gt.comments:Zn.comments}});if(!zn&&Xr&&gc.length===1){const Zn=gc[0];Do[Zn]&&(zn=!0,Do[Zn]={...Do[Zn],type:gt.type!=null?gt.type:Do[Zn].type,department:gt.department!=null?gt.department:Do[Zn].department,occupant:gt.occupant!=null?gt.occupant:Do[Zn].occupant,occupancyStatus:gt.occupancyStatus!=null?gt.occupancyStatus:Do[Zn].occupancyStatus,seatCount:vr?Hr:Do[Zn].seatCount??Do[Zn].SeatCount??Do[Zn]["Seat Count"],area:ti>0?ti:Do[Zn].area??Do[Zn].areaSF??Do[Zn].sf,areaSF:ti>0?ti:Do[Zn].areaSF??Do[Zn].sf??Do[Zn].area,sf:ti>0?ti:Do[Zn].sf??Do[Zn].areaSF??Do[Zn].area,roomLabel:Do[Zn].roomLabel??Do[Zn].name??Do[Zn].number??Xr,comments:gt.comments!=null?gt.comments:Do[Zn].comments})}if(!zn&&Xr){const Zn=Rn(Xr),_l=Rn(ge),Sh=Rn(Xe);Do.some(yc=>{const hd=Rn(yc?.building??yc?.buildingName??yc?.buildingLabel??""),gu=Rn(yc?.floor??yc?.floorId??yc?.floorName??""),kd=Rn(yc?.roomLabel??yc?.name??yc?.number??yc?.roomNumber??yc?.roomId??yc?.id??"");return kd&&kd===Zn&&(!_l||hd===_l)&&(!Sh||gu===Sh)})||(zn=!0,Do=[...Do,{roomId:Xr,roomLabel:Xr,building:ge,floor:Xe,area:ti||0,areaSF:ti||0,sf:ti||0,type:gt.type||"",department:gt.department||"",occupant:gt.occupant||"",occupancyStatus:gt.occupancyStatus||"",seatCount:vr?Hr:null,comments:gt.comments||""}])}return Do}),Vr&&Kt();try{const an=yr.current;an&&an.url===Li.current&&Il.current.get(an.key)&&Il.current.delete(an.key)}catch(an){console.warn("Failed to invalidate floor summary cache",an)}return qi}catch(Yt){return console.error("Failed to save room edits",Yt),null}},[fh,e,Kt,t,Ia]);ji(()=>{if(z||!td.length)return;const U=td[0].name;W(U),Wl("LEVEL_1")},[]),nr(U=>{const ge=_.current,Pe=m.current?.clientWidth||1e3,Xe=m.current?.clientHeight||800;if(!ge||!U?.geometry)return null;const nt=Eu(U);if(!nt||nt.length!==4||nt.some(gt=>!Number.isFinite(gt)))return null;const tt=(nt[1]+nt[3])/2,ot=ge.project({lng:nt[2],lat:tt}),Lt=Math.min(Math.max(ot.x+12,8),Pe-360),_t=Math.min(Math.max(ot.y-120,8),Xe-260);return{x:Lt,y:_t}},[]);const a=nr(async U=>{await At(U)},[At]),f=nr(()=>{const U=Ai;return{buildingLabel:Ev({buildingLabel:U,buildingId:D||z||""})||U,floorId:Ra||Ur||""}},[Ai,D,z,Ra,Ur]),v=nr(()=>{const U=Ra||Ur||"",ge=yr.current?.url||null,Pe=yr.current?.floorAdjustBasePath||null,Xe=ge?Sd(ge):null,nt=ca(D||z)||Xe,tt=yr.current?.floorAdjustLabel||null,ot=yr.current?.floorAdjustFloorId||null,Lt=Ai,_t=tt||nt||Ev({buildingLabel:Lt,buildingId:D||z||""})||Lt,gt=ot&&ec(ot)===ec(U)?ot:U;return{buildingLabel:_t,floorId:gt,url:ge,basePath:Pe}},[Ai,D,z,Ra,Ur,ca]),S=nr((U,ge)=>{const Pe=Wc(U||""),Xe=ec(ge||"");return`${Pe}__${Xe}`},[]),T=nr(async(U,ge)=>{if(!e||!U||!ge)return null;const Pe=S(U,ge);if(!Pe)return null;try{const Xe=Gg(fh,"universities",e,"floorAdjustments",Pe),nt=await SE(Xe);return nt.exists()&&nt.data()||null}catch{return null}},[fh,e,S]),R=nr(async(U,ge,Pe)=>{if(!e||!U||!ge||!Pe)return;const Xe=S(U,ge);if(Xe)try{const nt=Gg(fh,"universities",e,"floorAdjustments",Xe);await L5(nt,{buildingLabel:U,floorId:ge,rotationDeg:Number.isFinite(Pe.rotationDeg)?Pe.rotationDeg:0,scale:Number.isFinite(Pe.scale)?Pe.scale:1,translateMeters:Array.isArray(Pe.translateMeters)?Pe.translateMeters:[0,0],translateLngLat:Array.isArray(Pe.translateLngLat)?Pe.translateLngLat:null,anchorLngLat:Array.isArray(Pe.anchorLngLat)?Pe.anchorLngLat:null,pivot:Array.isArray(Pe.pivot)?Pe.pivot:null,updatedAt:d1(),updatedBy:Ga?.uid||Ga?.email||null},{merge:!0})}catch{}},[fh,e,S,Ga]),B=nr((U,ge)=>{if(!Array.isArray(U)||U.length<2||!Array.isArray(ge)||ge.length<2)return null;const[Pe,Xe]=U,[nt,tt]=ge,ot=Xe[0]-Pe[0],Lt=Xe[1]-Pe[1],_t=tt[0]-nt[0],gt=tt[1]-nt[1],Ht=Math.hypot(ot,Lt),Yt=Math.hypot(_t,gt);if(!Number.isFinite(Ht)||!Number.isFinite(Yt)||Ht<=0||Yt<=0)return null;const bn=Math.atan2(Lt,ot),rn=Math.atan2(gt,_t),Zt=(bn-rn)*180/Math.PI,En=Ht/Yt;return{rotationDeg:Zt,scale:En,pivot:nt,target:Pe}},[]);nr(()=>{Jr(null),Sr("")},[]),nr(()=>{if(!_.current||!_.current.getLayer(us)){alert("Load a floorplan first, then start align.");return}const{buildingLabel:U,floorId:ge}=f();if(!U||!ge){alert("Select a building and floor before aligning.");return}Sr(""),Jr({buildingLabel:U,floorId:ge,roomPts:[],drawingPts:[],step:0})},[f]),nr(async()=>{const{buildingLabel:U,floorId:ge}=f();if(!U||!ge)return;Bj(U,ge),Sr("");const Pe=Or(z,ge);Pe&&(ms.delete(Pe),qu.delete(Pe)),await At(ge)},[f,z,Or,At]);const G=nr(()=>{if(!_.current||!_.current.getLayer(us)){alert("Load a floorplan first, then rotate.");return}const{buildingLabel:U,floorId:ge}=v();if(!U||!ge){alert("Select a building and floor before rotating.");return}ct(""),Ie("rotate")},[v]),J=nr(()=>{if(!_.current||!_.current.getLayer(us)){alert("Load a floorplan first, then move.");return}const{buildingLabel:U,floorId:ge}=v();if(!U||!ge){alert("Select a building and floor before moving.");return}ct(""),Ie("move")},[v]),ee=nr(()=>{Ie(null),ct("");try{_.current?.dragPan?.enable()}catch{}},[]),me=nr(async()=>{const{buildingLabel:U,floorId:ge}=v();if(!U||!ge)return;const Pe=yr.current?.floorAdjustLabel||U;zj(Pe,ge);const Xe=yr.current?.floorAdjustBasePath||null;Xe&&Uj(Xe,ge);const nt=yr.current?.url||Or(z,ge);nt&&jj(nt);try{await R(Pe,ge,{rotationDeg:0,scale:1,translateMeters:[0,0],translateLngLat:null,anchorLngLat:null,pivot:null})}catch{}ct("");const tt=nt||Or(z,ge);tt&&(ms.delete(tt),qu.delete(tt)),await At(ge)},[v,z,Or,At,R]),Ae=f();i8(Ae.buildingLabel,Ae.floorId),pr&&pA[pr.step]?.label,pr&&pr.step;const Te=v(),He=Te.basePath?Ty(Te.basePath,Te.floorId):null,je=Te.url?Ay(Te.url):null,We=Mm(Te.buildingLabel,Te.floorId),ve=z5({base:He,url:je,label:We}),Ue=ve.adjust,rt=Ia?{source:ve.source,labelKey:ox(Te.buildingLabel,Te.floorId),urlKey:Te.url?sx(Te.url):null,baseKey:Te.basePath?ax(Te.basePath,Te.floorId):null,floorId:Te.floorId,url:Te.url,basePath:Te.basePath,savedAt:Ue?.savedAt||0,rotationDeg:Ue?.rotationDeg||0,scale:Ue?.scale||1,translateMeters:Ue?.translateMeters||[0,0],translateLngLat:Ue?.translateLngLat||null,anchorLngLat:Ue?.anchorLngLat||null,pivot:Ue?.pivot||yr.current?.floorAdjustBasePivot||null,storedKeys:(()=>{if(typeof window>"u"||!window.localStorage)return[];try{const U=Object.keys(window.localStorage).filter(Pe=>Pe.startsWith(e8)||Pe.startsWith(t8)||Pe.startsWith(n8)),ge=ec(Te.floorId||"");return U.filter(Pe=>ge&&Pe.includes(`/${ge}`))}catch{return[]}})()}:null,st=Ue?.rotationDeg||0,bt=Ue?.scale||1;Ue?.translateMeters;const wt=tp(Ue),vt=nr(()=>{Ra&&(Ra!==Ur&&Wl(Ra),a(Ra))},[Ra,a,Ur]);async function At(U){if(!M||!_.current)return!1;const Pe=!!(U&&typeof U=="object"&&("nativeEvent"in U||"target"in U||"preventDefault"in U))?null:U,Xe=Wg(Pe||Ur),nt=Mg(D,ca)||Mg(z,ca);let tt=nt?Hl(nt):Zs;(!tt||tt.length===0)&&nt&&(tt=await Ys(nt));let ot=S1(Xe,tt),Lt=null;if(!ot&&Xe&&nt&&(ot=Xe,Lt=$d(`floorplans/${j5}/${nt}/Rooms/${ot}_Dept_Rooms.geojson`),tt&&!tt.includes(ot)&&(tt=[...tt,ot],ga.current.set(nt,tt))),!ot)return alert("This floor is not available for this building."),!1;ot!==Ur&&Wl(ot);const _t=Lt||Or(z,ot);if(!_t)return alert("No file mapped for that floor."),!1;try{Yn("floor"),zt(null),hr({loading:!0,mode:"floor"});const gt=w.current?.[_t],Ht=Mg(D,ca)||Mg(z,ca),Yt=Ht?$d(`floorplans/Hastings/${Ht}`):null,bn=_t?Sd(_t):null,rn=nt||bn||np(D||z||"")||D||z,Zt=Yt?Ty(Yt,ot):null,En=_t?Ay(_t):null,Br=Mm(rn,ot),Gn=z5({base:Zt,url:En,label:Br}).adjust,vr=tp(Gn),Ei=Number(Gn?.savedAt)||0,ni=await T(rn,ot);if(ni){const hn={rotationDeg:Number(ni.rotationDeg)||0,scale:Number(ni.scale)||1,translateMeters:Array.isArray(ni.translateMeters)?ni.translateMeters:[0,0],translateLngLat:Array.isArray(ni.translateLngLat)?ni.translateLngLat:null,anchorLngLat:Array.isArray(ni.anchorLngLat)?ni.anchorLngLat:null,pivot:Array.isArray(ni.pivot)?ni.pivot:null},Rn=tp(hn),gr=(()=>{const Ni=ni.updatedAt;return Ni?.toMillis?Ni.toMillis():Number.isFinite(Ni?.seconds)?Ni.seconds*1e3:0})();(gr?gr>=Ei:!vr&&Rn)&&(v1(rn,ot,hn),_t&&x1(_t,hn),Yt&&b1(Yt,ot,hn),_t&&(ms.delete(_t),qu.delete(_t)))}let Hr=Ts.current||null;const qi=String(D||z||"");try{const hn=Yr(qi),Rn=Yr(Hr?.properties?.id||Hr?.properties?.name||"");(!Rn||hn&&Rn!==hn)&&(Hr=null)}catch{}if(!Hr)try{const hn=n?.buildings?.features||[],Rn=hn.find(gr=>String(gr.properties?.id)===qi)||null;Rn?Hr=Rn:Hr=yf(hn,qi),Hr&&(Ts.current=Hr)}catch{}!Hr&&Iu&&(Hr=Iu,Ts.current=Iu),Hr||(Hr=K1(_.current,qi),Hr&&(Ts.current=Hr));const Mr=KU(Hr?.properties?.id||Hr?.properties?.name||D||z,ot),Gr=t==="admin"&&Jj,Ri=await vU(_.current,_t,gt,{fitBuilding:Hr,rotationOverrideDeg:Mr},{buildingId:D||z,floor:ot,roomPatches:Un,airtableLookup:Pr,currentFloorContextRef:yr,roomsBasePath:Yt,roomsFloorId:ot,enableWalls:Gr,wallsBasePath:Yt,wallsFloorId:ot,onOptionsCollected:({typeOptions:hn,deptOptions:Rn})=>{hn?.length&&vn(gr=>kj(gr,hn)),Rn&&Ln(gr=>Xt(gr,Rn))}});if(!Ri)return hr(ju(null,"floor")),!1;Cl(!0),Hn(hn=>hn+1),Li.current=_t,Io.current=_t;const jr=_1(D||z||""),Vr=ec(ot||""),Ci=jr&&Vr?`${jr}/${Vr}`:null;Ci&&Ri.summary&&(Il.current.set(Ci,Ri.summary),hu.current.set(Ci,Ri.rooms)),yr.current={...yr.current||{},url:_t,key:Ci,buildingId:jr,floorId:Vr,floorLabel:ot,floorAdjustLabel:rn||yr.current?.floorAdjustLabel||null,floorAdjustFloorId:ot,floorAdjustBasePath:Yt||yr.current?.floorAdjustBasePath||null};const an=(qo&&Array.isArray(si)&&si.length?Ng(si.filter(hn=>{const Rn=hn?.building??hn?.buildingName??hn?.buildingLabel??"";if(ho(Rn)!==ho(D||z))return!1;const gr=rp(ot);return gr.length?ep(hn?.floor??hn?.floorName??hn?.floorId??"",gr):!0})):null)||Ri.summary||null;if(an){sc.current[_t]=an,Il.current.set(_t,an);const hn={...an,floorLabel:ot};zt(hn),lr(Qf(jp(an.totalsByDept))),Li.current===_t&&hr(ju(an,"floor"))}else zt(null),hr(ju(null,"floor"));try{Xs(_e),ma(_e)}catch{}return ht(!1),Yn("floor"),Wa({x:12,y:12}),Re===ke.SPACE_DATA&&wA(_.current),!0}catch(gt){return console.error(gt),alert("Failed to load floor plan. See console for details."),Cl(!1),!1}}const kt=(U,ge,Pe,Xe,nt,tt,ot="Key Departments")=>{if(!ge&&!tt&&!Pe?.length)return;const Lt=14,_t=Xe+6,gt=24,Ht=tt||"Totals";U.setFontSize(12),U.setFont(void 0,"bold"),U.text(Ht,_t,gt);let Yt=gt+Lt;if(U.setFont(void 0,"normal"),ge&&[ge.totalSF!=null?`Total SF: ${Math.round(ge.totalSF).toLocaleString()}`:null,ge.rooms!=null?`Rooms: ${ge.rooms}`:null,ge.classroomSf!=null?`Classroom SF: ${Math.round(ge.classroomSf).toLocaleString()}`:null,ge.classroomCount!=null?`Classrooms: ${ge.classroomCount}`:null,ge.levels!=null?`Levels: ${ge.levels}`:null].filter(Boolean).forEach(rn=>{U.text(rn,_t,Yt),Yt+=Lt}),Pe?.length){Yt+=Lt/2,U.setFont(void 0,"bold"),U.text(ot,_t,Yt),Yt+=Lt,U.setFont(void 0,"normal");const bn=10;Pe.slice(0,8).forEach(rn=>{const Zt=rn.color||Gd(rn.name);U.setFillColor(Zt),U.rect(Xe+6,Yt-8,bn,bn,"F"),U.setTextColor("#000");const En=rn.areaSf?`${rn.name} (${Math.round(rn.areaSf).toLocaleString()} SF)`:rn.name;U.text(En,Xe+6+bn+4,Yt),Yt+=Lt})}},Vt=nr((U,ge={})=>{if(!Array.isArray(U)||!U.length){alert("No floorplan data to export.");return}try{const Pe=new wi("p","pt","letter"),Xe=Pe.internal.pageSize.getWidth(),nt=Pe.internal.pageSize.getHeight(),tt=24,ot=ge.stats||null,Lt=ge.keyDepts||[],_t=ge.summaryLabel||"",gt=ge.legendTitle||"Key Departments",Ht=ge.filenameBase||"floorplan",Yt=!!(ot||Lt&&Lt.length),bn=Yt?130:0,rn=Yt?bn-12:0;U.forEach((En,Br)=>{const zr=En?.img;if(!zr?.data)return;Br>0&&Pe.addPage();const Gn=zr.height&&zr.width?zr.height/zr.width:1,vr=Yt?Xe-tt*2-bn-tt:Xe-tt*2;let Ei=Math.min(vr,zr.width),ni=Ei*Gn;const Hr=nt-tt*2-40;ni>Hr&&(ni=Hr,Ei=ni/(Gn||1));const qi=tt;Pe.addImage(zr.data,"PNG",qi,tt+20,Ei,ni),Pe.setFontSize(12);const Mr=En.label||"";if(Mr&&Pe.text(Mr,tt,tt),Yt){const Gr=Math.min(Xe-bn-tt,qi+Ei+tt*.75);kt(Pe,ot,Lt,Gr,rn,_t||Mr,gt)}});const Zt=`${Ht.replace(/\s+/g,"-").toLowerCase()}.pdf`;Pe.save(Zt)}catch(Pe){console.error("Floor export failed",Pe),alert("Export failed - see console for details.")}},[]),gn=nr(async({context:U,floorStats:ge,panelStats:Pe})=>{const Xe=await Ud("/ai/explain-floor",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:U,floorStats:ge,panelStats:Pe})}),nt=await Xe.text();let tt=null;try{tt=JSON.parse(nt)}catch{}if(!Xe.ok)throw new Error(tt?.error||nt||`HTTP ${Xe.status}`);return tt},[]),Ut=nr(async({context:U,campusStats:ge,panelStats:Pe})=>{const Xe=await Ud("/ai/explain-campus",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:U,campusStats:ge,panelStats:Pe})}),nt=await Xe.text();let tt=null;try{tt=JSON.parse(nt)}catch{}if(!Xe.ok)throw new Error(tt?.error||nt||`HTTP ${Xe.status}`);return tt},[]),un=nr(async({context:U,baselineStats:ge,scenarioStats:Pe,deltas:Xe})=>{const nt=await Ud("/ai/compare-scenario",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:U,baselineStats:ge,scenarioStats:Pe,deltas:Xe})}),tt=await nt.text();let ot=null;try{ot=JSON.parse(tt)}catch{}if(!nt.ok)throw new Error(ot?.error||tt||`HTTP ${nt.status}`);return ot},[]),$t=nr(async({request:U,context:ge,inventory:Pe,constraints:Xe})=>{const nt=await Ud("/ai/create-move-scenario",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({request:U,context:ge,inventory:Pe,constraints:Xe})}),tt=await nt.text();let ot=null;try{ot=JSON.parse(tt)}catch{}if(!nt.ok)throw new Error(ot?.error||tt||`HTTP ${nt.status}`);return ot},[]),In=nr(async({question:U,context:ge,data:Pe})=>{const Xe=await Ud("/ai/ask-mapfluence",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:U,context:ge,data:Pe})}),nt=await Xe.text();let tt=null;try{tt=JSON.parse(nt)}catch{}if(!Xe.ok)throw new Error(tt?.error||nt||`HTTP ${Xe.status}`);return tt},[]),jt=nr(async({context:U,buildingStats:ge,panelStats:Pe})=>{const Xe=await Ud("/ai/explain-building",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:U,buildingStats:ge,panelStats:Pe})}),nt=await Xe.text();let tt=null;try{tt=JSON.parse(nt)}catch{}if(!Xe.ok)throw new Error(tt?.error||nt||`HTTP ${Xe.status}`);return tt},[]),sn=nr(async()=>{Hc(""),Fi(!0),Sc(null);try{const U=yr.current,ge={universityId:e,buildingId:U?.buildingId||D||z||"",buildingLabel:U?.buildingLabel||"",floorId:U?.floorId||Ur||"",floorLabel:U?.floorLabel||An?.floorLabel||Ur||"",url:U?.url||""},Pe=await gn({context:ge,floorStats:An,panelStats:$n});Sc(Pe),zl(!0)}catch(U){Hc(String(U?.message||U))}finally{Fi(!1)}},[gn,An,$n,D,z,Ur,e]),Cn=nr(async()=>{Za(""),Au(!0),Us(null);try{const U=Oo?{totalSf:Math.round(Oo.totalSf||0),rooms:Math.round(Oo.roomCount||0),totalsByDept:Object.fromEntries((Oo.byDept||[]).map(Xe=>[Xe.name,Math.round(Number(Xe.sf||0))])),byType:(Oo.byType||[]).map(Xe=>({type:Xe.name,sf:Math.round(Number(Xe.sf||0))})),occupancySummary:Oo.occupancySummary||null,officeOccupancy:Oo.officeOccupancy||null}:null,Pe=await Ut({context:{universityId:e,campusLabel:Ee||e||"Campus",buildingId:"",buildingLabel:"",floorId:"",floorLabel:"",url:""},campusStats:U||it,panelStats:xr});Us(Pe),as(!0)}catch(U){Za(String(U?.message||U))}finally{Au(!1)}},[Ee,xr,it,Oo,Ut,e]),_n=nr(async()=>{vi(""),aa(!0),dl(null);try{if(!go)throw new Error("No scenario totals available. Turn on Move Scenario Mode and make changes.");if(!Vi)throw new Error("Select a department for the scenario before comparing.");const{perBuilding:U,campusTotals:ge}=await PA(Vi,{ensureFloorsForBuilding:Ys,buildFloorUrl:Or,floorCache:ms,fetchGeoJSON:ed});if(!ge)throw new Error("No baseline stats for the selected department on this campus.");const Xe=sa(Ai||z||D||"").toLowerCase(),nt=Object.entries(U||{}).sort((Zt,En)=>(En[1]?.totalSF||0)-(Zt[1]?.totalSF||0)||(En[1]?.rooms||0)-(Zt[1]?.rooms||0)),tt=nt.find(([Zt])=>sa(Zt).toLowerCase()!==Xe)||nt[0]||null,ot=tt?tt[0]:"campus",Lt=tt?tt[1]:ge;Lt&&(Lt.__label=ot||"campus");const _t="campus",gt=D||z||"",Ht=np(D||z)||z||D||"",Yt={universityId:e,baselineScope:_t,buildingId:gt,buildingLabel:Ai||"",floorId:Ur||"",scenarioDepartment:Vi,baselineLabel:`Current allocation for ${Vi} (${ot})`};console.log("Scenario compare baseline (dept campus-wide):",Lt),console.log("Scenario compare scenario (selection totals):",go),$o(Lt);const bn={totalSF:(go?.totalSF||0)-(Lt?.totalSF||0),rooms:(go?.rooms||0)-(Lt?.rooms||0)},rn=await un({context:Yt,baselineStats:Lt,scenarioStats:go,deltas:bn,scenarioDept:Vi||""});dl(rn),Fr(!0)}catch(U){vi(String(U?.message||U))}finally{aa(!1)}},[Ai,un,Vi,go,Ai,Ys,Or,ms,ed,z,D,Ur,e]);ji(()=>{oi&&(!Vi||!go?.rooms||(ts(!1),_n()))},[oi,Vi,go,_n]);const Mn=nr(async()=>{Ea(""),Ec(!0),pn(null);try{const Pe=await jt({context:{universityId:e,buildingId:D||z||"",buildingLabel:Ai||"",floorId:"",floorLabel:"",url:""},buildingStats:tn,panelStats:$n});pn(Pe),Qo(!0)}catch(U){Ea(String(U?.message||U))}finally{Ec(!1)}},[Ai,tn,jt,$n,z,D,e]);ji(()=>{const U=GI();if(typeof window<"u"&&window.location.hostname.includes("github.io"))return Ms(U?"ok":"down"),()=>{};if(!U)return Ms("down"),()=>{};const Pe=h8("/ai/health"),Xe=async()=>{try{const tt=await Ud(Pe,{cache:"no-store",timeoutMs:3e3});Ms(tt.ok?"ok":"down")}catch{Ms("down")}};Xe();const nt=setInterval(Xe,3e4);return()=>clearInterval(nt)},[]);const cr=nr(()=>{const U=yr?.current;if(!U?.fc){alert("No floor loaded.");return}const ge=Ir?wr.get(Ir)||[]:[],Pe=Xc(Ua.current||[]),Xe=Mi.current||[],nt=Array.from(new Set([...ge||[],...Pe||[],...Xe||[]])),tt=Rg({...U,colorMode:_e,selectedIds:nt,solidFill:!0,labelOptions:{hideDrawing:!0}});if(!tt){alert("Unable to render floorplan.");return}const ot=`${Ai} - ${U.floorLabel||Ur||""}`.trim()||"Floor",Lt=U?.url?sc.current[U.url]:null,_t=An??(Lt?{...Lt,floorLabel:U.floorLabel||Ur}:null),gt=Rr&&Rr.length?Rr:Qf(_t?.totalsByDept),Ht={department:"Key Departments",type:"Key Types",occupancy:"Occupancy",vacancy:"Vacancy"}[_e]||"Legend";Vt([{img:tt,label:ot}],{filenameBase:`${Ai}-${U.floorLabel||Ur||"floor"}`,stats:_t,keyDepts:gt,summaryLabel:`${Ai} - ${U.floorLabel||Ur||""} (${_e||"department"})`,legendTitle:Ht})},[Ai,Ur,Vt,_e,Rr]),kr=nr(()=>{C8(_.current,Li);try{const ge=_.current;ge?.getLayer(m0)&&ge.removeLayer(m0),ge?.getSource(Cv)&&ge.removeSource(Cv)}catch{}Cl(!1),Li.current=null,Io.current=null,yr.current={url:null,key:null,buildingId:null,floorId:null},zt(null),Yn("building");const U=ns.current||z;U&&Qt(U)},[z,Qt]);nr(()=>{eT(_.current)},[]);const er=nr(()=>{const U=!rl;Pc(U),U?(ya(!0),Ju(null),tu(20)):yl()},[yl,rl,ya]),ar=nr(()=>{try{const U={markers:ye,buildingConditions:Ne,buildingAssessments:de},ge=new Blob([JSON.stringify(U,null,2)],{type:"application/json"}),Pe=document.createElement("a");Pe.href=URL.createObjectURL(ge),Pe.download=`${e||"campus"}-map-data.json`,document.body.appendChild(Pe),Pe.click(),document.body.removeChild(Pe)}catch(U){console.warn("Export failed",U),alert("Export failed. See console for details.")}},[ye,Ne,de,e]);nr(()=>{alert("Export Drawing Entries not implemented in this build.")},[]);const Wr=nr(async(U="__all__",ge="")=>{const Pe=U&&U!=="__all__"?[U]:td.map(tt=>tt.name).filter(Boolean),Xe=ge.toLowerCase().trim(),nt=[];for(const tt of Pe){if(!tt)continue;const ot=await Ys(tt);if(ot?.length)for(const Lt of ot){const _t=Or(tt,Lt);if(!_t)continue;let gt;try{const Ht=await ed(_t);gt=Uu(Ht)}catch(Ht){console.warn("Space export: failed to load",_t,Ht);continue}if(gt?.features?.length)for(const Ht of gt.features){const Yt=Ht?.properties||{},bn=Ht?.id??Yt.RevitId??Yt.id,rn=tt&&Lt&&bn!=null?qd(tt,Lt,bn):null,Zt=rn&&Un instanceof Map?Un.get(rn):null,En=Zt?{...Yt,...Zt}:Yt,Br=En.Number??En.RoomNumber??En.number??En.Room??"",zr=nd(En)||En.Name||"",Gn=(En.department??En.Department??En.Dept??"").toString().trim();if(Xe&&!Gn.toLowerCase().includes(Xe))continue;const vr=op(En),Ei=Bb(En),ni=En.occupant??En.Occupant??"";nt.push({building:tt,floor:Lt,roomNumber:Br||"",type:zr||"",department:Gn||"",area:Number.isFinite(vr)?vr:"",seatCount:Ei??"",occupant:ni||"",roomId:rn||"",revitId:bn??null})}}}return nt},[Or,Ys,Un]);nr(async()=>{const U=await Wr("__all__","");return $b(U,250)||[]},[Wr]);const hi=nr(async(U="__all__",ge="")=>{const Pe=U&&U!=="__all__"?[U]:td.map(Ht=>Ht.name).filter(Boolean),Xe=ge.toLowerCase().trim(),nt=[],tt=Z1(),ot=(Ht,Yt,bn)=>{if(!Ht)return null;const rn=En=>Number.isFinite(En)?Math.round(En):"",Zt=En=>Number.isFinite(En)?Number(En):0;return{buildingId:bn||_1(Yt||""),buildingName:Yt||"",totalSf:rn(Ht.totalSf),rooms:Zt(Ht.rooms),classroomSf:rn(Ht.classroomSf),classrooms:Zt(Ht.classroomCount),labSf:rn(Ht.labSf),labs:Zt(Ht.labCount),officeSf:rn(Ht.officeSf),offices:Zt(Ht.officeCount),keyDepts:(Ht.keyDepts||[]).join("; ")}};for(const Ht of Pe){if(!Ht)continue;const Yt=await Ys(Ht);if(!Yt?.length)continue;const bn=Z1();for(const En of Yt){const Br=Or(Ht,En);if(!Br)continue;let zr=ms.get(Br);zr||(zr=await ed(Br),zr&&ms.set(Br,zr));const Gn=Uu(zr);if(Gn?.features?.length)for(const vr of Gn.features){const Ei=vr?.properties||{},ni=vr?.id??Ei.RevitId??Ei.id,Hr=Ht&&En&&ni!=null?qd(Ht,En,ni):null,qi=Hr&&Un instanceof Map?Un.get(Hr):null,Mr=qi?{...Ei,...qi}:Ei,Gr=(Mr.department??Mr.Department??Mr.Dept??"").toString().trim();Xe&&!Gr.toLowerCase().includes(Xe)||(q5(bn,Mr),q5(tt,Mr))}}const rn=Cy(bn),Zt=rn?ot(rn,Ht):null;Zt&&(Zt.rooms||Zt.totalSf)&&nt.push(Zt)}const Lt=Cy(tt);return{campusRow:(!U||U==="__all__")&&Lt&&(Lt.rooms||Lt.totalSf)?ot(Lt,"Campus Total","campus"):null,buildingRows:nt}},[Or,Ys,Un]),_r=nr(async()=>{El(""),Ac(!0),ys(null);try{if(zo==="down")throw new Error("AI server is offline.");const U=(_o||"").trim();if(!U)throw new Error("Enter a short request for the move scenario.");const ge=qo&&Array.isArray(si)?si:[],Pe=HA(ge),Xe=Vi||XA(U,Pe)||"",nt=Xe?YA(ge,Xe):[],tt=new Set((nt||[]).map(zn=>ho(zn)).filter(Boolean)),ot=KA(ge),Lt=ZA(U,ot)||"",_t=Lt||"",gt="";let Ht=[];if(qo&&Array.isArray(si)&&si.length)Ht=$b(si,2e3)||[];else try{const zn=await Wr("__all__","");Ht=$b(zn,250)||[]}catch{}if(!Ht.length){const zn=yr?.current?.fc?.features||[];Ht=IU(zn,_t,gt,250)||[]}if(!Ht.length)throw new Error("No room inventory loaded yet. Load Space Data or a floorplan first.");if(Lt){const zn=ho(Lt),an=Ht.filter(hn=>{const Rn=hn?.buildingLabel??hn?.building??hn?.buildingName??"";return ho(Rn)===zn});if(!an.length)throw new Error(`No rooms found for ${Lt}.`);Ht=an}if(tt.size){const zn=Ht.filter(an=>{const hn=an?.buildingLabel??an?.building??an?.buildingName??"";return!tt.has(ho(hn))});if(!zn.length)throw new Error(`No rooms available outside the current ${Xe||"department"} home building(s).`);Ht=zn}Ht=d8(Ht);let Yt=null,bn="";if(Xe)try{const{perBuilding:zn,campusTotals:an}=await PA(Xe,{ensureFloorsForBuilding:Ys,buildFloorUrl:Or,floorCache:ms,fetchGeoJSON:ed}),hn=Object.entries(zn||{}).sort((Rn,gr)=>(gr[1]?.totalSF||0)-(Rn[1]?.totalSF||0)||(gr[1]?.rooms||0)-(Rn[1]?.rooms||0))[0]||null;Yt=hn?hn[1]:an,bn=hn?hn[0]:"",Yt&&(Yt={...Yt,__label:bn||"campus"})}catch{}const rn=Lt?{maxTotal:260,maxPerBuilding:260,maxPerType:35}:{maxTotal:220,maxPerBuilding:90,maxPerType:25};Yt&&Ht.length>rn.maxTotal?Ht=TU(Ht,Yt,{maxTotal:rn.maxTotal,minPerType:Lt?8:5,maxPerType:Lt?45:35}):Ht=f8(Ht,rn);const Zt=new Map;Ht.forEach(zn=>{if(!zn)return;[zn.roomId,zn.id,zn.revitId].filter(hn=>hn!=null).map(hn=>String(hn)).forEach(hn=>{Zt.has(hn)||Zt.set(hn,zn)})});const En=zn=>{if(!zn||!Ht.length)return null;const an=ho(zn?.buildingLabel||""),hn=rp(zn?.floorName||zn?.floorId||""),Rn=WA(zn?.roomLabel||zn?.roomNumber||"");if(Rn){const cs=Ht.find(uo=>{const bs=ho(uo?.buildingLabel??uo?.buildingName??uo?.building??"");if(an&&bs!==an||hn.length&&!ep(uo?.floorName??uo?.floorId??"",hn))return!1;const Oa=WA(uo?.roomLabel??uo?.roomNumber??"");return Oa&&Oa===Rn});if(cs)return cs}const gr=Km(zn?.type||""),Xr=Number(zn?.sf||0),Ni=Number.isFinite(Xr)&&Xr>0;let sl=null,ti=Number.POSITIVE_INFINITY;return Ht.forEach(cs=>{const uo=ho(cs?.buildingLabel??cs?.buildingName??cs?.building??"");if(an&&uo!==an||hn.length&&!ep(cs?.floorName??cs?.floorId??"",hn))return;const bs=Km(cs?.type||cs?.roomType||"");let Oa=0;if(gr&&bs?Oa+=bs===gr?0:1e3:gr&&(Oa+=500),Ni){const gc=Number(cs?.sf??cs?.area??cs?.areaSF??0);Number.isFinite(gc)&&(Oa+=Math.abs(gc-Xr))}Oa<ti&&(ti=Oa,sl=cs)}),sl},Br={universityId:e,campusLabel:Ee||e||"Campus",buildingLabel:Lt||"",floorId:gt,moveScenarioMode:!0,scenarioDepartment:Vi||Xe||"",targetDepartment:Xe||Vi||"",excludeBuildings:nt||[],scenarioLabel:(cc||"").trim(),scope:Lt?"building":"campus"},zr=Yt?{totalSF:Math.round(Yt.totalSF||0),rooms:Math.round(Yt.rooms||0),sfByType:Object.entries(Yt.sfByRoomType||{}).map(([zn,an])=>({type:zn,sf:Math.round(Number(an||0)||0)})),roomTypes:Object.entries(Yt.roomTypes||{}).map(([zn,an])=>({type:zn,count:Math.round(Number(an||0)||0)}))}:null,Gn=zr?{baselineTotals:zr,targetSfTolerance:Ps?.05:.1}:null,vr=await $t({request:U,context:Br,inventory:Ht,constraints:Gn}),Ei=Array.isArray(vr?.recommendedCandidates)?vr.recommendedCandidates.map(zn=>{const hn=[zn?.roomId,zn?.id,zn?.revitId].filter(Xr=>Xr!=null).map(Xr=>String(Xr)).map(Xr=>Zt.get(Xr)).find(Boolean)||En(zn);if(!hn)return{...zn,floorName:zn?.floorName||zn?.floorId||"",rationale:Gb(zn?.rationale)};const Rn=Number(hn.sf??hn.area??hn.areaSF??0),gr=Number(zn?.sf??0);return{...zn,roomId:zn?.roomId||hn.roomId||hn.id||"",id:zn?.id||hn.id||hn.roomId||"",revitId:zn?.revitId??hn.revitId??null,roomGuid:zn?.roomGuid??hn.roomGuid??hn.revitId??null,buildingLabel:zn?.buildingLabel||hn.buildingLabel||hn.buildingName||hn.building||"",roomLabel:zn?.roomLabel||hn.roomLabel||hn.roomNumber||"",type:zn?.type||hn.type||hn.roomType||"",sf:Number.isFinite(gr)&&gr>0?gr:Number.isFinite(Rn)?Rn:0,vacancy:hn.vacancy??zn.vacancy,occupant:hn.occupant??zn.occupant,occupancyStatus:hn.occupancyStatus??zn.occupancyStatus,occupantDept:hn.occupantDept??zn.occupantDept,department:hn.department??zn.department,floorName:zn?.floorName||zn?.floorId||hn.floorName||hn.floorId||"",rationale:Gb(zn?.rationale)}}):[],ni=sa(Lt||LA(Ei)||"");let Hr=Ei,qi="";if(Yt){const{candidates:zn,added:an}=AA(Ei,Ht,Yt,{targetTolerance:Gn?.targetSfTolerance??.1,maxCandidates:Ps?40:30,primaryBuilding:ni});an>0&&(Hr=zn,qi=`Auto-filled ${an} rooms to better match baseline SF and room-type mix.`)}const Mr=zn=>IA(zn?.type)||TA(zn?.type),Gr=ni||LA(Hr)||"";if(Gr){const zn=Hr.filter(an=>sa(an?.buildingLabel||"")===Gr?!0:Mr(an));if(zn.length&&(Hr=zn,qi=`${qi?qi+" ":""}Constrained scenario to a single building (${Gr}), allowing labs/classrooms to remain outside if needed.`),Yt){const an=Ht.filter(gr=>{if(sa(gr?.buildingLabel??gr?.building??gr?.buildingName??"")===Gr)return!0;const Ni=gr?.type??gr?.roomType??"";return IA(Ni)||TA(Ni)}),{candidates:hn,added:Rn}=AA(Hr,an,Yt,{targetTolerance:Gn?.targetSfTolerance??.1,maxCandidates:Ps?40:30,primaryBuilding:Gr});Rn>0&&(Hr=hn,qi=`${qi?qi+" ":""}Auto-filled ${Rn} rooms to better match baseline SF.`)}}Hr=m8(Hr,Gr);const Ri=Yt?.totalSF||vr?.baselineTotals?.totalSF||0,jr=Math.round((Gn?.targetSfTolerance??.1)*100),Vr=Ri?[`Aim for total SF within +/-${jr}% of baseline department total SF (${Math.round(Ri).toLocaleString()} SF).`]:[],Ci=Array.isArray(vr?.selectionCriteria)?vr.selectionCriteria.filter(zn=>!/baseline|total\s*sf|sf within/i.test(zn||"")):[];ys({...vr,baselineTotals:Yt||vr?.baselineTotals,selectionCriteria:[...Vr,...qi?[qi]:[],...Ci],recommendedCandidates:Hr}),es(!1)}catch(U){El(String(U?.message||U))}finally{Ac(!1)}},[Ai,Ee,_o,zo,qo,si,Wr,$t,Ys,Or,ed,Vi,cc,z,Ur,e]),Ti=nr(async()=>{To(""),Ku(!0),Ss(null);try{const U=(Ul||"").trim();if(!U)throw new Error("Type a question first.");const ge=qo&&Array.isArray(si)?si:[],Pe=HA(ge),Xe=XA(U,Pe)||"",nt=KA(ge),tt=ZA(U,nt)||"",ot=/best new suitable home|suitable home|best home|relocat|move|find space|new home|anywhere|entire campus|campus[-\s]?wide|across campus/i.test(U),Lt=/\b(basement|ground floor|first floor|second floor|third floor|fourth floor|fifth floor|sixth floor|seventh floor|eighth floor|ninth floor|tenth floor|level\s*\d+|level\s*(one|two|three|four|five|six|seven|eight|nine|ten)|lvl\s*\d+|floor\s*\d+|floor\s*(one|two|three|four|five|six|seven|eight|nine|ten))\b/i.test(U),_t=/\b(entire campus|campus[-\s]?wide|across campus|anywhere on campus)\b/i.test(U)||/\bwhere\s+(is|are)\b|\blocation of\b|\bwhere\b.*\b(located|location)\b|\bwhich building\b|\bwhat building\b/i.test(U)&&!tt,gt=ot&&Xe?YA(ge,Xe):[],Ht=new Set((gt||[]).map(an=>ho(an)).filter(Boolean)),Yt={first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,tenth:10},bn=(()=>{if(!Lt)return"";const an=U.toLowerCase();if(an.includes("basement"))return"BASEMENT";if(an.includes("ground floor"))return"LEVEL_1";const hn=an.match(/level\s*(\d+)/);if(hn)return`LEVEL_${hn[1]}`;const Rn=an.match(/floor\s*(\d+)/);if(Rn)return`LEVEL_${Rn[1]}`;const gr=an.match(/\b(first|second|third|fourth|fifth|sixth|seventh|eighth|ninth|tenth)\s+floor\b/);return gr?`LEVEL_${Yt[gr[1]]}`:""})(),rn=tt||"",Zt=tt||"",En=!tt||ot||_t,Br=!En&&!!tt&&!!bn,zr={universityId:e,campusLabel:Ee||e||"Campus",buildingId:rn,buildingLabel:tt||"",floorId:Br?bn:"",scope:En?"campus":Br?"floor":tt?"building":"campus",targetDepartment:Xe||"",excludeBuildings:gt||[]},Gn=(()=>{if(!qo)return[];if(En||!tt)return si;const an=ho(tt);if(!an)return si;const hn=si.filter(gr=>{const Xr=gr?.building??gr?.buildingName??gr?.buildingLabel??"";return ho(Xr)===an});if(!Br)return hn;const Rn=rp(bn);return Rn.length?hn.filter(gr=>ep(gr?.floor??gr?.floorName??gr?.floorId??"",Rn)):hn})(),vr=Ht.size?Gn.filter(an=>{const hn=qy(an);return!Ht.has(ho(hn))}):Gn,Ei=(an,hn={})=>{if(!Array.isArray(an))return[];const Rn=Number(hn.maxRows||400);if(an.length<=Rn)return an;const gr=ho(hn.inferredDept||"");let Xr=an;if(gr&&(Xr=an.filter(uo=>{const bs=String(uo?.department??uo?.occupantDept??"").trim();return ho(bs)===gr}),Xr.length<=Rn))return Xr;const Ni=new Map;Xr.forEach(uo=>{const bs=ho(qy(uo));Ni.has(bs)||Ni.set(bs,[]),Ni.get(bs).push(uo)});const sl=Math.max(1,Math.floor(Rn/Math.max(1,Ni.size||1))),ti=[];if(Ni.forEach(uo=>{ti.push(...uo.slice(0,sl))}),ti.length>=Rn)return ti.slice(0,Rn);const cs=Xr.filter(uo=>!ti.includes(uo));return ti.concat(cs.slice(0,Math.max(0,Rn-ti.length)))};if(cV(U)){const an=vr.filter(Rn=>w1(Rn?.type??Rn?.roomType??"")),hn=En?"campus":tt||"selected scope";Ss({answer:`Found ${an.length.toLocaleString()} classrooms in ${hn}.`,bullets:["Count is based on room type labels that include classroom/teaching room definitions."],resultType:"none",columns:[],rows:[],dataUsed:["roomRows"],missingData:[]});return}if(lV(U)){const an=JA(vr),hn=En?"campus":tt||"selected scope";Ss({answer:`Found ${an.length.toLocaleString()} vacant offices in ${hn}.`,bullets:["Only rooms marked vacant/available and without an occupant are counted."],resultType:"none",columns:[],rows:[],dataUsed:["roomRows"],missingData:an.length?[]:["Vacancy status","Room inventory"]});return}if(aV(U)){const an=JA(vr),hn=En?"campus":tt||"selected scope",Rn=an.length?`Found ${an.length.toLocaleString()} vacant offices in ${hn}.`:`No vacant offices were found in ${hn} with explicit vacancy data.`;Ss({answer:Rn,bullets:["Only rooms marked as vacant/available and not currently assigned to an occupant are included."],resultType:an.length?"table":"none",columns:an.length?["Building","Room Number","Room Type","Square Feet"]:[],rows:an,dataUsed:["roomRows"],missingData:an.length?[]:["Vacancy status","Room inventory"]});return}const ni=/\bwhere\s+(is|are)\b|\blocation of\b|\bwhere\b.*\b(located|location)\b|\bwhich building\b|\bwhat building\b/i.test(U),Hr=(()=>{const an=[];if(Xe&&an.push(Xe),/\bpresident'?s?\b/i.test(U)&&an.push("president"),/\bprovost\b/i.test(U)&&an.push("provost"),/\bdean\b/i.test(U)&&an.push("dean"),!an.length)return[];const hn=an.map(Rn=>ho(Rn)).filter(Boolean);return vr.filter(Rn=>{const gr=String(Rn?.department??Rn?.occupantDept??"").trim(),Xr=String(Rn?.occupant??"").trim(),Ni=String(Rn?.roomNumber??Rn?.roomLabel??"").trim(),sl=ho(`${gr} ${Xr} ${Ni}`);return hn.some(ti=>ti&&sl.includes(ti))})})();if(ni&&Hr.length){const an=new Map;Hr.forEach(Rn=>{const gr=qy(Rn)||"Unknown Building";an.has(gr)||an.set(gr,[]),an.get(gr).push(Rn)});const hn=Array.from(an.entries()).map(([Rn,gr])=>{const Xr=gr.map(uo=>uo?.roomNumber||uo?.roomLabel||uo?.roomId||uo?.id||uo?.revitId||"").filter(Boolean),Ni=Array.from(new Set(Xr)),sl=gr.map(uo=>uo?.occupant||uo?.department||uo?.type||"").filter(Boolean),ti=Array.from(new Set(sl)),cs=Ni.length?`Rooms: ${Ni.slice(0,12).join(", ")}`:ti.length?`Rooms: (not labeled)  ${ti.slice(0,3).join(", ")}`:"Rooms: (not labeled)";return`${Rn}  ${cs}`});Ss({answer:"Here are the rooms matching that request across campus.",bullets:hn,resultType:"none",columns:[],rows:[],dataUsed:["roomRows"],missingData:[]});return}const qi=Hr.length?Hr:vr,Mr=Ei(qi,{maxRows:Xe?180:100,inferredDept:Xe}),Gr=Ng(vr),Ri=Br&&Gr?{...Gr,floorLabel:bn}:null,jr=!Br&&tt&&Gr?Gr:null;let Vr=null;if(Mr.length)Vr=Mr.map(an=>{const hn=Number(an?.areaSF??an?.area??an?.sf??0),Rn=Number(an?.seatCount??an?.SeatCount??an?.["Seat Count"]??0),gr=E8(an);return{building:an?.building??an?.buildingName??an?.buildingLabel??Zt,floor:an?.floor??an?.floorName??an?.floorId??"",roomNumber:gr||"",type:String(an?.type??an?.roomType??"").trim(),department:String(an?.department??"").trim(),area:Number.isFinite(hn)?Math.round(hn):"",seatCount:Number.isFinite(Rn)&&Rn>0?Rn:"",occupant:String(an?.occupant??"").trim(),occupancyStatus:String(an?.occupancyStatus??"").trim()}});else try{const hn=await Wr(En?"__all__":Zt||"__all__","");if(Array.isArray(hn)){const Rn=Ht.size?hn.filter(Xr=>!Ht.has(ho(Xr.building))):hn,gr=Ei(Rn,{maxRows:Xe?180:100,inferredDept:Xe});Vr=Zt?gr:gr.slice(0,Xe?180:100)}else Vr=null}catch{Vr=null}const zn=await In({question:U,context:zr,data:{campusStats:it,buildingStats:!En&&tt&&!Br&&jr||void 0,floorStats:Br&&Ri||void 0,dashboardMetrics:void 0,scopeSummary:Gr||void 0,roomRows:Vr||void 0}});Ss(zn)}catch(U){To(String(U?.message||U))}finally{Ku(!1)}},[Ai,Ee,Ul,D,z,Ur,e,qo,si,it,tn,An,Oo,Ui,In,np,Wr]),Ii=nr(()=>{if(vo)try{const U=new wi("p","pt","letter"),ge=U.internal.pageSize.getWidth(),Pe=U.internal.pageSize.getHeight(),Xe=24,nt=ge-Xe*2,tt=14;let ot=Xe;const Lt=(rn=tt)=>{ot+rn<=Pe-Xe||(U.addPage(),ot=Xe)},_t=(rn,Zt={})=>{const En=String(rn??"").trim();if(!En)return;const Br=Zt.fontStyle||"normal",zr=Zt.fontSize||11;U.setFont(void 0,Br),U.setFontSize(zr),U.splitTextToSize(En,nt).forEach(vr=>{Lt(tt),U.text(vr,Xe,ot),ot+=tt})},gt=(rn=8)=>{Lt(rn),ot+=rn};_t("Ask Mapfluence",{fontStyle:"bold",fontSize:14}),gt(4),_t(`Question: ${Ul||"(no question)"}`,{fontSize:10}),gt(8),_t(`Answer: ${vo.answer||""}`),Array.isArray(vo.bullets)&&vo.bullets.length&&(gt(8),_t("Notes:",{fontStyle:"bold"}),vo.bullets.forEach(rn=>_t(`- ${rn}`)));const Ht=Array.isArray(vo.columns)?vo.columns:[],Yt=Array.isArray(vo.rows)?vo.rows:[];Ht.length&&Yt.length&&(gt(10),_t("Table:",{fontStyle:"bold"}),_t(Ht.join(" | "),{fontStyle:"bold",fontSize:10}),Yt.forEach(rn=>{const Zt=Ht.map(En=>{const Br=rn&&rn[En]!=null?rn[En]:"";return String(Br)});_t(Zt.join(" | "),{fontSize:10})})),Array.isArray(vo.missingData)&&vo.missingData.length&&(gt(8),_t(`Missing data: ${vo.missingData.join(", ")}`,{fontSize:10}));const bn=String(Ul||"ask-mapfluence").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,60)||"ask-mapfluence";U.save(`${bn}.pdf`)}catch(U){console.error("Ask Mapfluence PDF export failed",U),alert("PDF export failed - see console for details.")}},[vo,Ul]);ji(()=>{const U=pu.current;if(!U||U.buildingLabel!==z||U.floorId!==Ur)return;pu.current=null;const ge=Ch.current||[];Ch.current=null,(async()=>{try{if(!await At())return}catch{}Rc(ge)})()},[z,Ur,At,Rc]);const yo=nr(async()=>{const U=Mo?.recommendedCandidates||[];if(!U.length)return;const ge=Mo?.scenarioDept||Vi||"";Pc(!0),ge&&lc(ge);const Pe=U[0],Xe=Pe?.buildingLabel||z,nt=Pe?.floorName||Pe?.floorId||Ur;let tt=nt;if(Xe){const Lt=await Ys(Xe);tt=S1(nt,Lt)||Lt?.[0]||nt}if(Xe&&tt&&(Xe!==z||tt!==Ur)){pu.current={buildingLabel:Xe,floorId:tt},Ch.current=U,W(Xe),Wl(tt);return}Rc(U)},[Mo?.recommendedCandidates,Mo?.scenarioDept,Rc,Ys,Vi,z,Ur,Pc,lc,W,Wl]),co=nr(U=>{const ge=U?.recommendedCandidates||[];if(!ge.length)return;const Pe=U?.scenarioDept||Vi||"";Pc(!0),Pe&&lc(Pe),Rc(ge),ts(!0)},[Rc,Vi,Pc,lc]),Js=nr(async(U,ge)=>{const Pe=U&&typeof U=="object"?null:U,Xe=ge||ro||"rooms";Yo(!0),Jo(Xe==="summary"?"Preparing summary export...":"Building export data...");try{const nt=bn=>{if(bn==null)return"";const rn=String(bn);return/[",\n]/.test(rn)?`"${rn.replace(/"/g,'""')}"`:rn};if(Xe==="summary"){const{campusRow:bn,buildingRows:rn}=await hi(Pe||Ar,_i),Zt=[...bn?[bn]:[],...rn];if(!Zt.length){Jo("No matching rooms found."),Yo(!1);return}const Br=[["BuildingId","BuildingName","TotalSF","Rooms","ClassroomSF","Classrooms","LabSF","Labs","OfficeSF","Offices","KeyDepts"].join(",")];Zt.forEach(ni=>{Br.push([nt(ni.buildingId),nt(ni.buildingName),nt(ni.totalSf),nt(ni.rooms),nt(ni.classroomSf),nt(ni.classrooms),nt(ni.labSf),nt(ni.labs),nt(ni.officeSf),nt(ni.offices),nt(ni.keyDepts)].join(","))});const zr=new Blob([Br.join(`
`)],{type:"text/csv;charset=utf-8;"}),Gn=document.createElement("a");Gn.href=URL.createObjectURL(zr);const vr=Pe||Ar,Ei=vr&&vr!=="__all__"?vr.replace(/\s+/g,"-").toLowerCase():"campus";Gn.download=`${Ei}-space-summary.csv`,document.body.appendChild(Gn),Gn.click(),document.body.removeChild(Gn),Jo(`Exported ${Zt.length} summary rows`);return}const tt=await Wr(Pe||Ar,_i);if(!tt.length){Jo("No matching rooms found."),Yo(!1);return}const Lt=[["Building","Floor","Room","Type","Department","AreaSF","SeatCount","Occupant"].join(",")];tt.forEach(bn=>{Lt.push([nt(bn.building),nt(bn.floor),nt(bn.roomNumber),nt(bn.type),nt(bn.department),nt(bn.area),nt(bn.seatCount),nt(bn.occupant)].join(","))});const _t=new Blob([Lt.join(`
`)],{type:"text/csv;charset=utf-8;"}),gt=document.createElement("a");gt.href=URL.createObjectURL(_t);const Ht=Pe||Ar,Yt=Ht&&Ht!=="__all__"?Ht.replace(/\s+/g,"-").toLowerCase():"campus";gt.download=`${Yt}-space-data.csv`,document.body.appendChild(gt),gt.click(),document.body.removeChild(gt),Jo(`Exported ${tt.length} rows`)}catch(nt){console.warn("Space export failed",nt),Jo("Export failed. See console.")}finally{Yo(!1)}},[Wr,hi,Ar,_i,ro]);nr(()=>{try{he([]),ie([])}catch{}},[]);const ps=nr(()=>{try{Ve({}),j({})}catch{}},[]),[il,Wa]=qn(null),[Si,Ki]=qn(null),[to,Qs]=qn(null),[ua,Wo]=qn(null),vs=nr(()=>u.current?.getBoundingClientRect()||{left:0,top:0,width:window.innerWidth,height:window.innerHeight},[]),Fo=nr(()=>({left:0,top:0,width:window.innerWidth,height:window.innerHeight}),[]),xs=nr(U=>gy(U,I,Ki,vs),[vs]),Cs=nr(U=>gy(U,O,Tl,Fo),[Fo]),Kl=nr(U=>gy(U,V,Ju,vs),[vs]),ol=bo(null),hc=bo(null),ad=nr(U=>gy(U,ol,Qs,Fo),[Fo]),ea=nr(U=>gy(U,hc,Wo,Fo),[Fo]),wh={onPointerDown:xs,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},ld={onPointerDown:Cs,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},Pu={onPointerDown:Kl,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},ku={onPointerDown:ad,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},dc={onPointerDown:ea,style:{cursor:"grab",userSelect:"none",touchAction:"none"}};if(bo(null),!e)return Q.jsx("div",{children:"Loading University..."});const mu=Fl(()=>Em(fh,"universities",e,"markers"),[e]),cd=Fl(()=>Em(fh,"universities",e,"buildingConditions"),[e]),Mu=Fl(()=>Em(fh,"universities",e,"buildingAssessments"),[e]);Fl(()=>Em(fh,"universities",e,"drawingEntries"),[e]);const ud=Fl(()=>Em(fh,"moves"),[fh]),Ru=({person:U,from:ge,to:Pe,effectiveDate:Xe,comments:nt,createdBy:tt})=>({person:U||"",fromRoomId:ge?.roomId||"",toRoomId:Pe?.roomId||"",fromBuildingId:ge?.buildingId||"",toBuildingId:Pe?.buildingId||"",fromFloorId:ge?.floorId||"",toFloorId:Pe?.floorId||"",fromRoomLabel:ge?.roomLabel||"",toRoomLabel:Pe?.roomLabel||"",effectiveDate:Xe||"",comments:nt||"",createdAt:d1(),createdBy:tt||"unknown"}),Cd=nr(async U=>{if(U)try{await EE(ud,U)}catch(ge){console.warn("Failed to log move",ge)}},[ud]),Ld=()=>{va(null),Xl(null),nn(null)},Of=async()=>{if(!Is)return;const{from:U,to:ge,effectiveDate:Pe,comments:Xe,person:nt}=Is,tt=sa(nt||U?.occupantName||"");if(!(!U||!ge||!tt))try{const ot=await y({roomId:U.roomId,buildingId:U.buildingId,buildingName:U.buildingName,floorName:U.floorId,revitId:U.revitId,roomLabel:U.roomLabel,properties:{occupant:""}}),Lt=await y({roomId:ge.roomId,buildingId:ge.buildingId,buildingName:ge.buildingName,floorName:ge.floorId,revitId:ge.revitId,roomLabel:ge.roomLabel,properties:{occupant:tt}});ot&&Lt?await Cd(Ru({person:tt,from:U,to:ge,effectiveDate:Pe,comments:Xe,createdBy:Ga?.email||"unknown"})):console.warn("Move update incomplete, skipping move log.")}catch(ot){console.warn("Move confirmation failed",ot)}finally{Ld()}},Gh=Fl(()=>t!=="admin"?ye:ye.filter(U=>{const ge=(U.persona||"").toLowerCase();return ge.includes("student")?sr:ge.includes("staff")||ge.includes("faculty")?C:!0}),[ye,sr,C,t]),Mh=Fl(()=>t==="admin"?{...p1.student,...p1.staff}:p1[i]||p1.default,[i,t]);ji(()=>{const U=V1();SB(U).catch(()=>{});const ge=XO(U,async Pe=>{if(Dc(Pe||null),!Pe){bh(!1);return}try{const Xe=await SE(Gg(fh,"universities",e,"roles",Pe.uid));bh(!!Xe.exists()&&Xe.data()?.role==="admin")}catch{bh(!1)}});return()=>ge()},[e]);async function Pd(){try{const U=V1(),ge=new xf;try{await mB(U,ge)}catch{await bB(U,ge)}}catch{}}function fc(){try{KO(V1())}catch{}}ji(()=>{e&&(async()=>{try{const U=Em(fh,"universities",e,"buildings"),ge=await h1(U);if(!ge.empty){const Xe=ge.docs.map(nt=>({id:nt.id,name:nt.data()?.name||nt.id}));!z&&Xe.length&&W(Xe[0].id);return}const Pe=await fetch(H1);if(Pe.ok){const Xe=await Pe.json(),nt=Object.entries(Xe.buildings||{}).map(([tt,ot])=>({id:tt,name:ot?.name||tt}));!z&&nt.length&&W(nt[0].id)}}catch(U){console.warn("Building options load failed:",U)}})()},[e]),ji(()=>{let U=!1;const ge=()=>{eu([]),Wl(void 0)};return(async()=>{const Pe=Mg(D,ca)||Mg(z,ca);if(!Pe){ge();return}const Xe=await vA(Pe);if(U)return;const nt=(Xe||[]).map(ot=>Wg(ot?.id)).filter(Boolean),tt=new Map((Xe||[]).filter(ot=>ot?.id&&ot?.url).map(ot=>[ot.id,ot.url]));ga.current.set(Pe,nt),du.current.set(Pe,tt),nt.length?(eu(nt),Wl(ot=>ot&&nt.includes(ot)?ot:nt[0])):ge()})(),()=>{U=!0}},[D,z,ca]),ji(()=>{let U=!1;return(async()=>{Ma(!0),ic(null),Bo("Campus Summary");try{const ge=await Ud("/ai/api/rooms",{cache:"no-store",timeoutMs:8e3});let Pe=null;try{Pe=await ge.json()}catch{}if(!ge.ok){const Xe=Pe?.error||Pe?.message||`Rooms fetch failed (${ge.status})`;throw new Error(Xe)}if(Pe?.ok&&Array.isArray(Pe.rooms)&&(U||($s(Pe.rooms),H(new Date)),Pe.rooms.some(fV)))return;throw new Error("Rooms payload missing or invalid")}catch{try{let Pe=on.current;Pe||(Pe=await r_(H1),on.current=Pe);const Xe=await QA(Pe);if(!Xe.length)throw new Error("No floorplan rooms found for dashboard");U||(Gs(Xe),ic(null),Es(!0))}catch(Pe){U||ic(Pe)}}finally{U||Ma(!1)}})(),()=>{U=!0}},[e]),ji(()=>{const ge=setInterval(()=>{Ot()},18e5);return()=>clearInterval(ge)},[Ot]),ji(()=>{let U=!1;return(async()=>{try{const ge=await fetch($d(VU),{cache:"no-store"});if(!ge.ok)throw new Error(`Utilization CSV fetch failed (${ge.status})`);const Pe=await ge.text(),Xe=$U(Pe);U||pt(Xe)}catch(ge){console.warn("Unable to load classroom utilization data",ge)}})(),()=>{U=!0}},[]);const Fc=Fl(()=>{if(!qo)return[];if(!(!!D||Ui))return si;const ge=sa(Ai);if(!!!ge)return si;const Xe=new Set([ho(Ai),ho(D),ho(z)].filter(Boolean));if(!Xe.size)return si;const nt=si.filter(_t=>{const gt=_t?.building??_t?.buildingName??_t?.buildingLabel??"";return Xe.has(ho(gt))});if(!!!(Ui&&ge))return nt;const ot=sa(yr.current?.floorLabel||Ur||""),Lt=rp(ot);return Lt.length?nt.filter(_t=>ep(_t?.floor??_t?.floorName??_t?.floorId??"",Lt)):nt},[si,qo,Ai,D,z,Ui,Ur]),Zl=Fl(()=>{if(!(!!D||Ui))return"Campus";const ge=sa(Ai);if(!!!ge)return"Campus";const Xe=sa(An?.floorLabel||yr.current?.floorLabel||Ur||"");return!!(Ui&&ge&&Xe)?`${ge} ${Xe}`:ge},[Ai,D,z,Ui,Ur,An]),pc=Fl(()=>{if(!!D||Ui){const ge=sa(Ai);return ge?lo(ge):null}return xi},[Ai,D,z,Ui,xi,lo]),Oc=Fl(()=>!!D||Ui?sa(Ai)||"":xi?Ee:"",[Ai,D,z,Ui,xi,Ee]),mc=Fl(()=>{if(!Ui)return[];const U=yr.current||{},ge=ho(D||z||""),Pe=ho(U.buildingLabel||U.buildingId||U.building||"");if(ge&&Pe&&ge!==Pe)return[];const Xe=rp(Ur||"");if(Xe.length){const ot=U.floorLabel||U.floorId||U.floor||"";if(!ep(ot,Xe))return[]}const nt=U.fc,tt=Array.isArray(nt?.features)?nt.features:[];return tt.length?tt.filter(ot=>n_(ot?.properties)==="room"):[]},[Ui,tr,D,z,Ur]),th=Fl(()=>Ui?mc:(Fc||[]).map(I8).filter(Boolean),[Fc,mc,Ui]);ji(()=>{if(!qs.length)return;let U=!1;if(!qs.some(Pe=>Nv(Pe?.type)||Nv(Pe?.department))){U||(Gs(qs),Es(!0));return}return(async()=>{try{let Pe=on.current;Pe||(Pe=await r_(H1),on.current=Pe);const Xe=await QA(Pe);if(U)return;const nt=dV(qs,Xe);Gs(nt),Es(!0)}catch{U||(Gs(qs),Es(!0))}})(),()=>{U=!0}},[qs]),ji(()=>{if(!qo)return;const U=!!D||Ui,ge=sa(Ai),Pe=sa(An?.floorLabel||yr.current?.floorLabel||Ur||""),tt=!!(Ui&&ge&&Pe)?`${ge} ${Pe} Summary`:!!(U&&ge)?`${ge} Summary`:"Campus Summary";Bo(tt);try{const ot=bj(th);Vo(ot)}catch(ot){ic(ot)}},[qo,th,Ai,D,z,Ui,Ur,An]),ji(()=>{if(!qo||!Array.isArray(si)||!si.length||Ui)return;const U=D||z;if(!U)return;const ge=ho(U);if(!ge)return;const Pe=si.filter(nt=>{const tt=nt?.building??nt?.buildingName??nt?.buildingLabel??"";return ho(tt)===ge}),Xe=Ng(Pe);Xe&&(fn(Xe),hr(ju(Xe,"building")))},[qo,si,Ui,D,z]),ji(()=>{if(!Ui||!mc.length)return;const U=yr.current||{},ge=U.url||Li.current,Pe=U.floorLabel||Ur||U.floor||"";if(!ge)return;const Xe=SU(mc);if(!Xe)return;const nt={...Xe,floorLabel:Pe};sc.current[ge]=Xe,Il.current.set(ge,Xe),U.key&&Il.current.set(U.key,Xe),zt(nt),lr(Qf(jp(Xe.totalsByDept))),hr(ju(Xe,"floor"))},[Ui,mc,Ur]),ji(()=>{if(!M||!_.current||!Ui)return;const U=!!(Pr?.byGuid?.size||Pr?.byComposite?.size),ge=Un instanceof Map&&Un.size>0;if(!U&&!ge)return;const Pe=_.current,Xe=ph(Pe,xa);if(!Xe)return;const nt=Xe._data||Xe.serialize?.()?.data||null,tt=Uu(nt);if(!tt?.features?.length)return;const ot=yr.current||{},Lt=ot.buildingId||D||z,_t=ot.floorLabel||ot.floorId||ot.floor||Ur;let gt=!1;const Ht=tt.features.map(bn=>{if(!bn)return bn;const rn=bn.properties||{};if(n_(rn)!=="room")return bn;let Zt=rn,En=!1;if(U){const Gn=T8(rn,Pr,Lt,_t);Gn&&(Zt=Mv(Zt,Gn),En=!0)}if(ge&&Lt&&_t){const Gn=bn.id??rn.RevitId??rn.id,vr=Gn!=null?qd(Lt,_t,Gn):null,Ei=vr&&Un.get(vr)||null;Ei&&(Zt=Mv(Zt,Ei),En=!0)}const Br=nd(Zt),zr=Br?String(Br).trim():Zt.__roomType||"";return!En&&zr===rn.__roomType?bn:(gt=!0,{...bn,properties:{...Zt,__roomType:zr}})});if(!gt)return;const Yt={...tt,features:Ht};try{Xe.setData(Yt)}catch{}yr.current&&(yr.current={...yr.current,fc:Yt}),Hn(bn=>bn+1);try{Xs(_e)}catch{}},[Pr,Un,_e,Ui,M,D,z,Ur,Xs]),ji(()=>{if(!n)return;let U=null,ge=null;const Pe=m.current;if(!Pe)return;const Xe=()=>Pe.clientWidth>0&&Pe.clientHeight>0,nt=()=>{if(_.current)return;const ot=n&&n.style||"mapbox://styles/mapbox/streets-v12",Lt=typeof ot=="string"&&/^mapbox:\/\//i.test(ot),_t=!!(Vd.accessToken||"").trim(),gt=!_t&&Lt?uU:ot,Ht=n?.initialCenter||[-98.3739,40.5939],Yt=n?.initialZoom??16;console.log("Mapbox token length:",(Vd.accessToken||"").length),console.log("Using style:",typeof gt=="string"?gt:"tokenless-osm-style"),!_t&&Lt&&console.warn("No runtime MAPBOX_PUBLIC_TOKEN found. Falling back to OpenStreetMap base style.");let bn=null;try{bn=new Vd.Map({container:Pe,style:gt,center:Ht,zoom:Yt,attributionControl:!1,preserveDrawingBuffer:!0})}catch(rn){console.error("Map constructor failed:",rn);return}if(!bn){console.error("Map was not created (mapInstance is falsy).");return}_.current=bn,typeof window<"u"&&(window.__map=bn);try{bn.addControl(new Vd.NavigationControl,"top-right")}catch(rn){console.warn("Adding controls failed:",rn)}bn.once("load",()=>{(async()=>{try{await SA(bn,"mf-door-swing","/StakeholderMap/icons/door-swing.png")}catch(rn){console.warn("Door icon load failed:",rn)}try{await SA(bn,"mf-stairs-run","/StakeholderMap/icons/stairs-run.png")}catch(rn){console.warn("Stairs icon load failed:",rn)}se(!0);try{bn.resize()}catch(rn){console.warn("resize() failed:",rn)}try{const rn=Uu(n?.boundary);if(rn?.features?.length){const[Zt,En,Br,zr]=kU(rn);Number.isFinite(Zt)&&Number.isFinite(En)&&Number.isFinite(Br)&&Number.isFinite(zr)&&bn.fitBounds([[Zt,En],[Br,zr]],{padding:40,duration:0})}}catch(rn){console.warn("fitBounds from boundary failed:",rn)}})()})};if(Xe())nt();else{try{ge=new ResizeObserver(()=>{if(Xe()){try{ge.disconnect()}catch{}ge=void 0,nt()}}),ge.observe(Pe)}catch{}U=requestAnimationFrame(()=>{if(Xe()){if(ge){try{ge.disconnect()}catch{}ge=void 0}nt()}})}const tt=()=>{if(_.current)try{_.current.resize()}catch{}};try{window.addEventListener("resize",tt)}catch{}return()=>{if(U&&cancelAnimationFrame(U),ge)try{ge.disconnect()}catch{}try{window.removeEventListener("resize",tt)}catch{}if(_.current){try{_.current.remove()}catch{}_.current=null}}},[n]),ji(()=>{t!=="admin"&&(!jo&&!Qr&&fs.length===0||(Hi(!1),xo(null),pa([]),Ua.current=[]))},[t,jo,Qr,fs.length]),ji(()=>{(async()=>{try{let U;if(t==="admin"||c)U=xE(mu);else{if(!i){he([]);return}U=xE(mu,oO("persona","==",i))}const ge=await h1(U);if(he(ge.docs.map(ot=>({id:ot.id,...ot.data(),coordinates:[ot.data().coordinates.longitude,ot.data().coordinates.latitude]}))),t!=="admin"){Ve({}),j({});return}const[Pe,Xe]=await Promise.all([h1(cd),h1(Mu)]),nt={};Pe.forEach(ot=>{const Lt=ot.data().originalId||ot.id.replace(/__/g,"/");nt[Lt]=ot.data().condition}),Ve(nt);const tt={};Xe.forEach(ot=>{const Lt=ot.data().originalId||ot.id.replace(/__/g,"/");tt[Lt]=ot.data()}),j(tt)}catch(U){console.error("Failed to fetch data:",U),t==="admin"&&(Ve({}),j({}))}})()},[t,c,e,i,mu,cd,Mu]),ji(()=>{if(!D)return;const U=Ce(D)||D;z!==U&&W(U)},[D,Ce,z]),ji(()=>{if(nl.current){try{nl.current()}catch{}nl.current=null}const U=D||z;if(!U||!Ur||!e)return;const ge=Wc(e),Pe=_1(U),Xe=ec(Ur),nt=Em(fh,"universities",ge,"buildings",Pe,"floors",Xe,"rooms");return nl.current=lO(nt,tt=>{const ot=new Map;tt.forEach(Lt=>{const _t=Lt.data();ot.set(Lt.id,{..._t,buildingId:_t.original?.buildingName??U,floor:_t.original?.floorLabel??Ur,revitId:_t.original?.featureId??_t.revitId??Lt.id})}),mo(ot)}),()=>{if(nl.current){try{nl.current()}catch{}nl.current=null}}},[D,z,Ur,e]),ji(()=>{ns.current=D,D||(ac.current=null,Ts.current=null,fn(null),zt(null),Yn("building"),Li.current||hr(null))},[D]),ji(()=>{if(c||!M||!_.current||!n)return;const U=_.current;if(!U.getSource("buildings")){if(U.addSource("buildings",{type:"geojson",data:n.buildings,promoteId:"id"}),U.addLayer({id:"buildings-layer",type:"fill-extrusion",source:"buildings",paint:{"fill-extrusion-color":Qh(Im),"fill-extrusion-height":15,"fill-extrusion-opacity":.7}}),U.addLayer({id:"buildings-outline-base",type:"line",source:"buildings",paint:{"line-color":"rgba(0,0,0,0.35)","line-width":1.6,"line-opacity":.8}}),U.addLayer({id:"buildings-outline",type:"line",source:"buildings",paint:{"line-color":"#1d4ed8","line-width":2.6,"line-opacity":["case",["boolean",["feature-state","selected"],!1],1,0]}}),!U.getLayer("buildings-fill"))try{U.addLayer({id:"buildings-fill",type:"fill",source:"buildings",paint:{"fill-opacity":0}},"buildings-outline")}catch{U.addLayer({id:"buildings-fill",type:"fill",source:"buildings",paint:{"fill-opacity":0}})}U.addLayer({id:"buildings-labels",type:"symbol",source:"buildings",layout:{"text-field":["coalesce",["get","name"],["get","id"]],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":10,"text-anchor":"center","text-variable-anchor":["center"],"text-offset":[0,0],"text-line-height":1,"text-allow-overlap":!1,"text-max-width":10,"symbol-placement":"point"},paint:{"text-color":"#111111","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":1}}),U.getLayer("buildings-hit")||U.addLayer({id:"buildings-hit",type:"line",source:"buildings",paint:{"line-color":"#007aff","line-width":2},filter:["==",["get","id"],D||""]})}if(n.boundary&&!U.getSource("boundary")){const ge=Uu(n.boundary);ge?(U.addSource("boundary",{type:"geojson",data:ge}),U.addLayer({id:"boundary-layer",type:"line",source:"boundary",paint:{"line-color":"#a9040e","line-width":3,"line-dasharray":[2,2]}})):console.warn("Boundary provided but could not normalize to FeatureCollection.")}},[M,n]),ji(()=>{if(!M||!_.current||!n)return;const U=_.current;U.getSource("buildings")||(U.addSource("buildings",{type:"geojson",data:n.buildings,promoteId:"id"}),U.addLayer({id:"buildings-layer",type:"fill-extrusion",source:"buildings",paint:{"fill-extrusion-color":Qh(Im),"fill-extrusion-height":15,"fill-extrusion-opacity":.7}}),U.addLayer({id:"buildings-outline",type:"line",source:"buildings",paint:{"line-color":"#1d4ed8","line-width":2.2,"line-opacity":["case",["boolean",["feature-state","selected"],!1],1,0]}}),U.getLayer("buildings-fill")||U.addLayer({id:"buildings-fill",type:"fill",source:"buildings",paint:{"fill-opacity":0}},"buildings-outline"));const ge=async Pe=>{if(!U)return;let Xe=null;try{if(U.getLayer(us)){const Lt=U.queryRenderedFeatures(Pe.point,{layers:[us]});Xe=Lt&&Lt[0]}}catch{}if(Xe)return;const nt=Pe.features&&Pe.features[0];if(!nt)return;Ts.current=nt;const tt=nt.properties?.id;if(!tt)return;try{o.current&&U.setFeatureState({source:"buildings",id:o.current},{selected:!1}),U.setFeatureState({source:"buildings",id:tt},{selected:!0}),o.current=tt}catch{}$(tt),ns.current=tt;const ot=U.project(Pe.lngLat);Wa($a(ot)),ht(!1),Yn("building"),zt(null),fn(null),hr({loading:!0,mode:"building"}),Dt(tt);try{const Lt=await Je(tt);if(ns.current!==tt)return;if(Li.current||(fn(Lt),hr(ju(Lt,"building"))),Re!==ke.SPACE_DATA){const _t=await Ke?.(tt)||Lt||{},gt=rn=>Number.isFinite(rn)?Math.round(rn).toLocaleString():"-",Ht=rn=>Number.isFinite(rn)?Number(rn).toLocaleString():"-",Yt=Tj(_t.keyDepts||[]),bn=`
          <div class="mf-popup mf-popup--building" style="min-width:280px;padding:8px 10px;">
            <div style="display:flex;gap:18px;align-items:flex-start;">
              <div style="flex:1">
                <div style="font-weight:700;margin-bottom:6px;">${buildingName}</div>
                <div><b>Total SF:</b> ${gt(_t.totalSf)}</div>
                <div><b>Rooms:</b> ${Ht(_t.rooms)}</div>
                <div><b>Classroom SF:</b> ${gt(_t.classroomSf)}</div>
                <div><b>Classrooms:</b> ${Ht(_t.classroomCount)}</div>
              </div>
              <div style="min-width:180px;">
                <div style="font-weight:600;margin-bottom:4px;">Key Departments</div>
                ${Yt||'<div class="mf-subtle">?</div>'}
              </div>
            </div>
          </div>`;new Vd.Popup({offset:12}).setLngLat(Pe.lngLat).setHTML(bn).addTo(U)}}catch(Lt){console.warn("Failed to load building totals for popup:",Lt)}};return U.__mf_building_click_bound||(U.on("click","buildings-fill",ge),U.__mf_building_click_bound=!0),()=>{try{U.__mf_building_click_bound&&(U.off("click","buildings-fill",ge),U.__mf_building_click_bound=!1)}catch{}}},[c,M,n,Re,Dt,Je,Ke]),ji(()=>{if(!M||!_.current)return;const U=_.current,ge=(tt,ot)=>{try{U.setPaintProperty("buildings-layer","fill-extrusion-color",tt),U.setPaintProperty("buildings-layer","fill-extrusion-opacity",ot)}catch{}},Pe=(tt,ot,Lt)=>{try{U.setPaintProperty(tt,"fill-color",ot),U.setPaintProperty(tt,"fill-opacity",Lt)}catch{}},Xe=U.getLayer("buildings-layer"),nt=U.getLayer("buildings-fill");if(Re===ke.SPACE_DATA)Xe&&(Xe.type==="fill-extrusion"?ge(Qh("#ffffff"),1):Pe("buildings-layer",Qh("#ffffff"),1)),wA(U);else if(Xe&&(Xe.type==="fill-extrusion"?ge(Qh(Im),.7):Pe("buildings-layer",Qh(Im),.7)),nt){Pe("buildings-fill",Qh(Im),.2);try{U.setPaintProperty("buildings-fill","fill-outline-color","#00000000")}catch{}L8(U)}},[M,Re]),ji(()=>{if(!M||!_.current)return;const U=_.current;try{U.getLayer("buildings-hit")&&U.setFilter("buildings-hit",["==",["get","id"],D||""])}catch{}},[D,M]),ji(()=>{if(!M||!_.current)return;const U=_.current;o.current&&U.setFeatureState({source:"buildings",id:o.current},{selected:!1}),D&&U.setFeatureState({source:"buildings",id:D},{selected:!0}),o.current=D},[D,M,t]),ji(()=>{if(!M||!_.current)return;const U=_.current;U.getCanvas().parentElement.querySelectorAll(".custom-mapbox-marker").forEach(Pe=>Pe.remove()),(t==="admin"?ne?Gh:[]:c?ye:Y).forEach(Pe=>{const Xe=document.createElement("div");Xe.className="custom-marker custom-mapbox-marker",Xe.style.backgroundColor=Mh[Pe.type]||"#9E9E9E";const nt=new Vd.Marker(Xe).setLngLat(Pe.coordinates);Re!==ke.SPACE_DATA&&nt.setPopup(new Vd.Popup({offset:25}).setText(Pe.comment||Pe.type)),nt.addTo(U)})},[Gh,Y,ye,Mh,M,t,ne,c]),ji(()=>{if(!M||!_.current||!_.current.getSource("buildings"))return;const U=_.current;if(Re===ke.SPACE_DATA){if(Pt&&so&&Object.keys(so).length>0){const nt=["match",["get","id"]];Object.entries(so).forEach(([ot,Lt])=>{const _t=Number.isFinite(Lt?.overallUtilization)?Lt.overallUtilization:null,gt=bV(_t);nt.push(ot,gt)}),nt.push("#e5e7eb");const tt=Qh(nt);try{U.setPaintProperty("buildings-layer","fill-extrusion-color",tt),U.setPaintProperty("buildings-layer","fill-extrusion-opacity",.2),U.getLayer("buildings-fill")&&(U.setPaintProperty("buildings-fill","fill-color",tt),U.setPaintProperty("buildings-fill","fill-opacity",.55),U.setPaintProperty("buildings-fill","fill-outline-color","rgba(0,0,0,0)"))}catch{}}else try{U.setPaintProperty("buildings-layer","fill-extrusion-color",Qh("#ffffff")),U.setPaintProperty("buildings-layer","fill-extrusion-opacity",.7),U.getLayer("buildings-fill")&&(U.setPaintProperty("buildings-fill","fill-color",Qh("#ffffff")),U.setPaintProperty("buildings-fill","fill-opacity",0))}catch{}return}if(U.getLayer("buildings-fill"))try{U.setPaintProperty("buildings-fill","fill-opacity",0)}catch{}try{U.setPaintProperty("buildings-layer","fill-extrusion-opacity",.7)}catch{}const ge=["match",["get","id"]];let Pe=!1;t==="admin"&&Re===ke.ASSESSMENT&&Object.keys(de).length>0?Object.entries(de).forEach(nt=>{const tt=nt[0],ot=nt[1];let Lt=0;const _t=ot&&ot.scores?ot.scores:{};_t.architecture&&Object.values(_t.architecture).some(gt=>gt>0)&&Lt++,_t.engineering&&Object.values(_t.engineering).some(gt=>gt>0)&&Lt++,_t.functionality&&Object.values(_t.functionality).some(gt=>gt>0)&&Lt++,ge.push(ot&&ot.originalId||tt,gV[Lt]),Pe=!0}):t==="admin"&&Re===ke.SPACE_DATA&&Object.keys(Ne).length>0&&Object.entries(Ne).forEach(nt=>{const tt=nt[0],ot=nt[1],Lt=mV[ot];Lt&&(ge.push(tt,Lt.color),Pe=!0)}),ge.push(Im);const Xe=Qh(ge);Pe?U.setPaintProperty("buildings-layer","fill-extrusion-color",Xe):U.setPaintProperty("buildings-layer","fill-extrusion-color",Qh(Im))},[Ne,de,M,t,Re,Pt,so]);const Nu=nr(U=>{if(!_.current)return;const ge=document.createElement("div");ge.className="marker-prompt-popup",ge.innerHTML=`
      <h4>Add a Marker</h4>
      <select id="marker-type">${Object.keys(Mh).map(Xe=>`<option value="${Xe}">${Xe}</option>`).join("")}</select>
      <textarea id="marker-comment" placeholder="Optional comment..."></textarea>
      <div class="button-group">
        <button id="confirm-marker">Add</button>
        <button id="cancel-marker">Cancel</button>
      </div>`;const Pe=new Vd.Popup({closeOnClick:!1,maxWidth:"280px"}).setDOMContent(ge).setLngLat(U).addTo(_.current);ge.querySelector("#confirm-marker").addEventListener("click",async()=>{const Xe=ge.querySelector("#marker-type").value,nt=ge.querySelector("#marker-comment").value.trim(),tt={coordinates:new ex(U.lat,U.lng),type:Xe,comment:nt,persona:i||(c?"student":"admin"),createdAt:d1()},ot=await EE(mu,tt),Lt={...tt,id:ot.id,coordinates:[U.lng,U.lat]};he(_t=>[..._t,Lt]),ie(_t=>[..._t,Lt]),Pe.remove()}),ge.querySelector("#cancel-marker").addEventListener("click",()=>Pe.remove())},[Mh,mu,i,c]);ji(()=>{if(!c||t==="admin"||!M||!_.current)return;const U=_.current,ge=Pe=>{ii.current||Rt.current||Nu(Pe.lngLat)};return U.on("click",ge),()=>{try{U.off("click",ge)}catch{}}},[c,t,M,Nu]),ji(()=>{if(!M||!_.current)return;const U=_.current,ge=Pe=>{const Xe=ui.current;if(!Xe)return;try{Pe.preventDefault?.(),Pe.originalEvent&&(Pe.originalEvent.preventDefault?.(),Pe.originalEvent.stopPropagation?.(),Pe.originalEvent.cancelBubble=!0)}catch{}const nt=Number(Xe.step)||0,tt=nt<2,ot=tt?us:hp,_t=yr.current?.fc||null;let gt=null;if(tt){if(U.getLayer(ot)){const Yt=U.queryRenderedFeatures(Pe.point,{layers:[ot]})||[];if(Yt.length){const bn=[Pe.lngLat.lng,Pe.lngLat.lat];gt=Gj(Yt[0],bn)}}if(!gt&&_t&&(gt=zb({map:U,fc:_t,isDrawing:!1,screenPoint:Pe.point,maxPixels:Zj,maxPoints:jb})),!gt){Sr("Click closer to a room polygon (or zoom in).");return}}else{const Yt=!!_t?.features?.some(bn=>{const rn=bn?.geometry?.type||"";return Ah(bn?.properties||{})||rn==="LineString"||rn==="MultiLineString"});if(_t&&(gt=zb({map:U,fc:_t,isDrawing:!0,screenPoint:Pe.point,maxPixels:Yj,maxPoints:jb})),!gt&&Yt&&_t&&(gt=zb({map:U,fc:_t,isDrawing:!0,screenPoint:Pe.point,maxPixels:null,maxPoints:jb})),!gt){Sr(Yt?"No drawing vertex nearby. Zoom in and click closer to linework.":"No drawing linework found on this floor.");return}}const Ht={...Xe,roomPts:Array.isArray(Xe.roomPts)?[...Xe.roomPts]:[],drawingPts:Array.isArray(Xe.drawingPts)?[...Xe.drawingPts]:[]};if(tt?Ht.roomPts.push(gt):Ht.drawingPts.push(gt),Ht.step=nt+1,Ht.step>=pA.length){const Yt=B(Ht.roomPts,Ht.drawingPts);if(!Yt){Sr("Unable to compute alignment from those points.");return}if(!Oj(Xe.buildingLabel,Xe.floorId,Yt)){Sr("Failed to save alignment in local storage.");return}Jr(null),Sr("");const rn=Or(z,Xe.floorId);rn&&(ms.delete(rn),qu.delete(rn)),At(Xe.floorId);return}Sr(""),Jr(Ht)};return U.on("click",ge),()=>{try{U.off("click",ge)}catch{}}},[M,z,Or,At,B]),ji(()=>{if(!M||!_.current)return;const U=_.current,ge=(tt,ot)=>{const Lt=vf(zs([tt.lng,tt.lat]),zs([ot.lng,tt.lat]),{units:"kilometers"}),_t=vf(zs([tt.lng,tt.lat]),zs([tt.lng,ot.lat]),{units:"kilometers"}),gt=(ot.lng>=tt.lng?1:-1)*Lt*1e3,Ht=(ot.lat>=tt.lat?1:-1)*_t*1e3;return[gt,Ht]},Pe=tt=>{if(!Rt.current)return;try{tt.preventDefault?.(),tt.originalEvent&&(tt.originalEvent.preventDefault?.(),tt.originalEvent.stopPropagation?.(),tt.originalEvent.cancelBubble=!0)}catch{}const ot=Ct.current;if(!ot)return;const Lt=v(),_t=Lt.url||Or(z,Lt.floorId),gt=Lt.basePath||yr.current?.floorAdjustBasePath||null,Ht=yr.current?.floorAdjustBasePivot||null,Yt=gt?Ty(gt,Lt.floorId):null,bn=tp(Yt),rn=_t?Ay(_t):null,Zt=tp(rn),En=bn?Yt:Zt?rn:Mm(Lt.buildingLabel,Lt.floorId),Br=Array.isArray(En.translateLngLat)?En.translateLngLat:[0,0],zr=yr.current?.floorAdjustLabel||(_t?Sd(_t):null)||Lt.buildingLabel,vr=ph(U,xa)?._data||yr.current?.fc||null;if(!vr){ct("No floor data to adjust.");return}let Ei=null;try{Ei=tc(vr)?.geometry?.coordinates||null}catch{Ei=null}if(!Ei){ct("Unable to find a transform pivot.");return}const ni=U.project({lng:Ei[0],lat:Ei[1]}),Hr=Math.atan2(tt.point.y-ni.y,tt.point.x-ni.x);St.current={mode:ot,baseData:JSON.parse(JSON.stringify(vr)),pivot:Ei,pivotScreen:ni,startAngle:Hr,startRotation:En.rotationDeg||0,startScale:En.scale||1,startTranslate:En.translateMeters||[0,0],startTranslateLngLat:Br,startLngLat:tt.lngLat,buildingLabel:Lt.buildingLabel,floorId:Lt.floorId,adjustUrl:_t,adjustLabel:zr,adjustBasePath:gt,basePivot:Ht};try{U.dragPan.disable()}catch{}try{U.getCanvas().style.cursor="grabbing"}catch{}},Xe=tt=>{const ot=St.current;if(!ot)return;const Lt=ph(U,xa);if(Lt){if(ot.mode==="rotate"){const gt=(Math.atan2(tt.point.y-ot.pivotScreen.y,tt.point.x-ot.pivotScreen.x)-ot.startAngle)*180/Math.PI,Ht=jh(ot.baseData,gt,{pivot:ot.pivot});Lt.setData(Ht);return}if(ot.mode==="move"){ge(ot.startLngLat,tt.lngLat);const _t=tt.lngLat.lng-ot.startLngLat.lng,gt=tt.lngLat.lat-ot.startLngLat.lat,Ht=U5(ot.baseData,[_t,gt]);Lt.setData(Ht)}}},nt=tt=>{const ot=St.current;if(!ot)return;let Lt=Mm(ot.buildingLabel,ot.floorId);if(ot.mode==="rotate"){const En=(Math.atan2(tt.point.y-ot.pivotScreen.y,tt.point.x-ot.pivotScreen.x)-ot.startAngle)*180/Math.PI,Br=Array.isArray(ot.basePivot)?ot.basePivot:Array.isArray(ot.pivot)?ot.pivot:Lt.pivot;Lt={...Lt,rotationDeg:(ot.startRotation||0)+En,pivot:Br}}else if(ot.mode==="move"){const[Zt,En]=ge(ot.startLngLat,tt.lngLat),Br=tt.lngLat.lng-ot.startLngLat.lng,zr=tt.lngLat.lat-ot.startLngLat.lat,Gn=Array.isArray(ot.basePivot)?ot.basePivot:Array.isArray(ot.pivot)?ot.pivot:Lt.pivot;Lt={...Lt,translateMeters:[(ot.startTranslate?.[0]||0)+Zt,(ot.startTranslate?.[1]||0)+En],translateLngLat:[(ot.startTranslateLngLat?.[0]||0)+Br,(ot.startTranslateLngLat?.[1]||0)+zr],pivot:Gn}}const gt=ph(U,xa)?._data||yr.current?.fc||null,Ht=W1(gt);Ht&&(Lt={...Lt,anchorLngLat:Ht});const Yt=ot.adjustLabel||ot.buildingLabel;v1(Yt,ot.floorId,Lt),ot.adjustUrl&&x1(ot.adjustUrl,Lt),ot.adjustBasePath&&b1(ot.adjustBasePath,ot.floorId,Lt);try{R(Yt,ot.floorId,Lt)}catch{}const bn=Av(Lt);if(bn&&gt){const Zt={...gt,__mfUserAdjustSignature:bn};ot.adjustUrl&&ms.set(ot.adjustUrl,Zt),yr.current={...yr.current||{},fc:Zt}}St.current=null,Ie(null),ct("");const rn=ot.adjustUrl||Or(z,ot.floorId);rn&&!ot.adjustUrl&&(ms.delete(rn),qu.delete(rn));try{U.dragPan.enable()}catch{}try{U.getCanvas().style.cursor=ot.mode==="move"?"move":"grab"}catch{}};return U.on("mousedown",Pe),U.on("mousemove",Xe),U.on("mouseup",nt),()=>{try{U.off("mousedown",Pe)}catch{}try{U.off("mousemove",Xe)}catch{}try{U.off("mouseup",nt)}catch{}}},[M,z,Or,v,R]),ji(()=>{if(!M||!_.current)return;const U=_.current,ge=nt=>{try{nt.preventDefault?.(),nt.originalEvent&&(nt.originalEvent.preventDefault?.(),nt.originalEvent.stopPropagation?.(),nt.originalEvent.cancelBubble=!0)}catch{}if(ii.current||Rt.current)return;la.current=null;const tt=nt.features?.[0];if(!tt)return;if(rl){try{const mi=tt.properties||{},io=D||z||mi.Building||mi.buildingId||"",Ls=mi.Floor||Ur||rs?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||"LEVEL_1",ha=tt.id??mi.RevitId??mi.revitId??null,Ns=mi.Number??mi.RoomNumber??mi.number??mi.Room??"",fd=sa(nd(mi)||mi.__roomType||""),ru=mi.department??mi.Department??mi.Dept??"",Ds=op(mi),Bc=Number.isFinite(Ds)?Ds:0,Er=io&&Ls&&ha!=null?qd(io,Ls,ha):null;if(!Er){console.warn("Scenario click: could not build roomId",{buildingId:io,floorName:Ls,revitId:ha,props:mi});return}const pd=nt.point||U.project(nt.lngLat);eh({roomId:Er,buildingId:io,buildingName:mi.BuildingName||mi.buildingName||io,floorName:Ls,revitId:ha,roomNumber:Ns,roomType:fd,department:ru,area:Number(Bc)||0}),Pl(pd),sd()}catch(mi){console.warn("Scenario click failed",mi)}return}la.current=tt;const ot=tt.id??tt.properties?.RevitId??null;Lo||nn(ot),rs&&(w.current||(w.current={}),w.current[rs]=ot);const Lt=tt.properties||{},_t=D||z,gt=Ai,Ht=tt.id??Lt.RevitId??null,Yt=Lt.Floor||Ur||rs?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||"LEVEL_1",bn=_t&&Ht!=null?qd(_t,Yt,Ht):null;if(rl){if(!bn)return;Co(mi=>{const io=new Set(mi);return io.has(bn)?io.delete(bn):io.add(bn),Fa(io),io});return}const rn=bn?Un.get(bn):null,Zt=rn?{...Lt,...rn}:Lt,En=Zt.Number??Zt.RoomNumber??Zt.number??Zt.Room??"",Br=sa(nd(Zt)||Zt.__roomType||""),zr=sa(Zt.__dept||Fy(Zt)||""),Gn=Zt.occupant??Zt.Occupant??"",vr=Zt.comments??Zt.Comments??"",Ei=Ic(Zt),ni=op(Zt);let Hr=Br,qi=zr,Mr=Number.isFinite(ni)?ni:null,Gr=Gn;const Ri=XI(Zt),jr=Bb(Zt),Vr=ZI(Zt),Ci=KI(Ri)||Vr.isOfficeText,zn=w1(Br)||Mj(Ri)||Vr.isTeachingText,an=_t&&Yt&&Ht!=null?qd(_t,Yt,Ht):null,hn=(Gr??"").toString().trim(),Rn=En||"-",gr=String(Zt.Revit_UniqueId??Zt.RevitUniqueId??Lt.Revit_UniqueId??Lt.RevitUniqueId??Lt["Room GUID"]??"").trim(),Xr=ho(_t),Ni=rp(Yt),sl=String(En??"").trim(),ti=qs?.length?qs:si,cs=Array.isArray(ti)?ti.find(mi=>{if(!mi)return!1;const io=String(mi?.roomId??mi?.roomNumber??mi?.roomLabel??"").trim(),Ls=String(mi?.roomGuid??mi?.revitUniqueId??"").trim();if(gr&&(Ls===gr||io===gr))return!0;const ha=ho(mi?.building??mi?.buildingName??mi?.buildingLabel??"");return Xr&&ha!==Xr||Ni.length&&!ep(mi?.floor??mi?.floorName??mi?.floorId??"",Ni)?!1:sl&&io===sl}):null,uo=cs?.airtableId||cs?.AirtableId||cs?.["Airtable ID"]||null;if(Lo){if(!Ll){if(!hn||!an||ot==null){console.warn("Cannot start move: missing occupant or identifiers.");return}va({roomId:an,roomLabel:Rn,buildingId:_t,buildingName:gt,floorId:Yt,occupantName:hn,revitId:Ht,highlightId:ot}),Xl(null),nn(ot);return}if(ot===Ll.highlightId){va(null),Xl(null),nn(null);return}if(_t!==Ll.buildingId||Yt!==Ll.floorId){va(null),Xl(null),nn(null);return}Xl({person:Ll.occupantName,effectiveDate:"",comments:"",from:Ll,to:{roomId:an,roomLabel:Rn,buildingId:_t,buildingName:gt,floorId:Yt,revitId:Ht,highlightId:ot}});return}const bs=Ia,Oa=Zt.Floor||Yt,gc=!!(t==="admin"&&bs&&_t&&Oa&&Ht!=null&&e),Do=gc?qd(_t,Oa,Ht):null,Zn=gc?{roomId:Do,buildingId:_t,floorName:Oa,revitId:Ht,roomGuid:gr||null,roomLabel:Rn,roomNumber:En||"",feature:tt,flags:{isOffice:Ci,isTeaching:zn},highlightId:ot,properties:{type:Hr||"",department:qi||"",area:Number.isFinite(Mr)?Mr:"",occupant:Gr||"",occupancyStatus:Ei||"",comments:vr||"",roomGuid:gr||"",Revit_UniqueId:gr||"",airtableId:uo}}:null;let _l=Ua.current||[];if(Zn){const mi=Ua.current||[];mi.findIndex(Ls=>Ls.roomId===Zn.roomId)>=0?_l=mi.filter(Ls=>Ls.roomId!==Zn.roomId):_l=[...mi,Zn],Ua.current=_l,pa(_l),ml(_l)}const Sh=()=>{const mi=Number.isFinite(Mr)&&Mr!==0?Math.round(Mr).toLocaleString():"",Ls=(Ua.current||[]).length,ha=Ls>0,Ns=Ls>1?`Edit ${Ls} Rooms`:"Edit",fd=gc?`<div class="mf-popup-actions" style="margin-top:6px;padding-top:6px;gap:6px;flex-wrap:wrap;width:100%;">
               <button id="mf-room-edit-btn" class="mf-btn tiny">${Ns}</button>
               ${ha?'<button id="mf-clear-edit-selection" class="mf-btn tiny" style="background:#f4f4f4;color:#333;">Clear Selection</button>':""}
             </div>`:"",ru=Number.isFinite(jr)&&jr>0,Ds=(Gr??"").toString().trim(),Bc=w1(Hr||""),Er=ru?jr.toLocaleString():"-",pd=Bc?`<div><b>Seat Count:</b> ${Er}</div>`:"",tf=Ds.length?Ds:"-",rm=Bc?"":`<div><b>Occupant:</b> ${tf}</div>`,Bf=Bc?_s(gt,En||Rn):null,Rd=Bf&&(Number.isFinite(Bf.timeUtilization)||Number.isFinite(Bf.seatUtilization)),yu=(om,vp,nf)=>{if(!Number.isFinite(vp))return"";const zf=Math.max(0,Math.min(vp,100));return`
            <div style="margin-top:3px;">
              <div style="font-size:10px;color:#444;">${om}: ${Math.round(vp)}%</div>
              <div style="height:4px;background:#e4e7ec;border-radius:999px;overflow:hidden;">
                <div style="width:${zf}%;height:100%;background:${nf};"></div>
              </div>
            </div>
          `},Wh=Rd?`
            <div style="margin-top:6px; width:100%; max-width:220px;">
              ${yu("Time Util",Bf.timeUtilization,"#3b82f6")}
              ${yu("Seat Util",Bf.seatUtilization,"#f59e0b")}
            </div>
          `:"",im=gc&&Ls?`<div style="font-size:11px;color:#555;margin-top:6px;">Rooms selected: ${Ls}</div>`:"";return`
          <div class="mf-popup" style="min-width:340px;max-width:460px;background:#fff;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,0.15);padding:2px;">
            <div class="mf-popup-body" style="padding:8px 12px 16px 12px;">
              <div class="mf-title">Room ${En||"-"}</div>
              <div><b>Room Type:</b></div>
              <div style="white-space:normal;word-break:break-word;margin-bottom:2px;">${Hr||"-"}</div>
              <div><b>Department:</b> ${qi||"-"}</div>
              <div><b>Area (SF):</b> ${mi||"-"}</div>
              <div><b>Floor:</b> ${Oa}</div>
              ${pd}
              ${rm}
              ${Wh}
              ${im}
              ${fd}
            </div>
          </div>`},Rh=U.project(nt.lngLat),yc=m.current?.clientWidth||1e3,hd=Rh.x>yc*.56?"right":"left",gu=hd==="left"?240:-240,kd={top:[gu,12],"top-left":[gu,12],"top-right":[gu,12],bottom:[gu,-12],"bottom-left":[gu,-12],"bottom-right":[gu,-12],left:[gu,0],right:[gu,0]},nh=new Vd.Popup({closeButton:!0,offset:kd,anchor:hd,maxWidth:"520px"}).setLngLat(nt.lngLat).setHTML(Sh()).addTo(U);nh.on("close",()=>{if(!Lo&&!Ll){const mi=Xc(Ua.current||[]);nn(mi.length?mi:null)}});const Du=async()=>{try{nh.remove()}catch{}const mi=Li.current||Io.current;if(mi){be(ke.SPACE_DATA),Fe(!1),ht(!1);try{const io=U.project(nt.lngLat);Wa($a(io))}catch{}ns.current?$(ns.current):z&&$(z),ft(mi)}},dd=()=>{if(!gc)return;const io=fs.length?Do&&fs.some(fd=>fd.roomId===Do)||!Zn?fs:[...fs,Zn]:Zn?[Zn]:[];if(!io.length)return;const Ls=Ns=>{const fd=io.map(Ds=>Ds?.properties?.[Ns]??""),ru=fd[0];return fd.every(Ds=>Ds===ru)?ru:""},ha={type:Ls("type"),department:Ls("department"),occupant:Ls("occupant"),occupancyStatus:Ls("occupancyStatus"),comments:Ls("comments"),area:Ls("area")};xo({...io[0],targets:io,roomLabel:io.length===1?io[0]?.roomLabel||"-":`${io.length} rooms`,properties:ha,includedKeys:new Set(io.map(Ns=>Ns.roomId||String(Ns.revitId??""))),refreshPopup:()=>{nh.setHTML(Sh()),rh()},onApply:Ns=>{"type"in Ns&&(Hr=Ns.type),"department"in Ns&&(qi=Ns.department),"occupant"in Ns&&(Gr=Ns.occupant)}}),Cr(new Set(io.map(Ns=>Ns.roomId||String(Ns.revitId??"")))),Hi(!0)},Md=()=>{Ua.current=[],pa([]),ml([]);try{nh.remove()}catch{}};function rh(){const mi=nh.getElement();mi&&(mi.querySelector("#mf-show-floor")?.addEventListener("click",Du),gc&&(mi.querySelector("#mf-room-edit-btn")?.addEventListener("click",dd),mi.querySelector("#mf-clear-edit-selection")?.addEventListener("click",Md)))}rh()},Pe=()=>{if(!(ii.current||Rt.current))try{U.getCanvas().style.cursor="pointer"}catch{}},Xe=()=>{if(!(ii.current||Rt.current))try{U.getCanvas().style.cursor=""}catch{}};return U.on("click",us,ge),U.on("mouseenter",us,Pe),U.on("mouseleave",us,Xe),()=>{try{U.off("click",us,ge),U.off("mouseenter",us,Pe),U.off("mouseleave",us,Xe)}catch{}la.current=null}},[M,rs,z,D,Ur,ft,be,Fe,ht,Wa,$n,Un,si,qs,Ia,Ga,e,Ce,Ke,Be,Re,Wt,rl,Lo,Ll,nn,fs,Qa,ml,Xc]),ji(()=>{if(!M||!_.current)return;const U=_.current,ge=Pe=>{const Xe=_.current;if(!Xe||ii.current||Rt.current)return;const nt=ns.current;if(!nt)return;if(!!!Xe.getLayer(us)){Qt(nt);return}const ot=Pe.point,Lt=Xe.queryRenderedFeatures(ot,{layers:[us]});if(Lt&&Lt.length||!!!Xe.getLayer("buildings-fill"))return;Xe.queryRenderedFeatures(ot,{layers:["buildings-fill"]})?.some(Yt=>Yt.properties?.id===nt)&&(Li.current=null,Qt(nt))};return U.on("click",ge),()=>{try{U.off("click",ge)}catch{}}},[M,Qt]);const ef=nr(()=>{},[]),rg=nr(async()=>{const U=ac.current||D||z;if(!U){alert("No building selected for export.");return}if(!Zs.length){alert("No floors available for export.");return}const ge=[];for(const tt of Zs){const ot=Or(U,tt);if(!ot)continue;const Lt=await ed(ot),_t=Uu(Lt);if(!_t?.features?.length)continue;const gt=Rg({fc:_t,colorMode:_e,solidFill:!0,labelOptions:{hideDrawing:!0}});gt&&ge.push({img:gt,label:`${Ai} - ${tt}`})}if(!ge.length){alert("No floorplans could be rendered for export.");return}const Pe=Qf(tn?.totalsByDept),Xe={totalSF:tn?.totalSf,rooms:tn?.rooms,classroomSf:tn?.classroomSf,classroomCount:tn?.classroomCount,levels:Zs.length},nt=`${Ai.replace(/\s+/g,"-").toLowerCase()}-floors`;Vt(ge,{filenameBase:nt,stats:Xe,keyDepts:Pe,summaryLabel:`${Ai} Floors`})},[Zs,Ai,Or,Vt,z,D]);return Q.jsxs("div",{ref:u,className:"map-page-container",children:[Q.jsx("div",{className:"page",children:Q.jsx("div",{className:"map-wrapper",children:Q.jsx("div",{ref:m,className:"map-container"})})}),t==="admin"&&Q.jsx("button",{className:"controls-toggle-button",onClick:()=>ae(U=>!U),children:xe?"Hide Controls":"Show Controls"}),No&&Q.jsx("div",{style:{position:"fixed",inset:0,zIndex:10002,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Q.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(520px, 92vw)",padding:16,lineHeight:1.4},children:[Q.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[Q.jsxs("div",{children:[Q.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Q.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Ask Mapfluence"}),Q.jsx("span",{title:"AI-generated response based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Q.jsx("div",{style:{fontSize:12,color:"#555"},children:"Ask questions about loaded campus data."})]}),Q.jsx("button",{className:"btn",onClick:()=>Xu(!1),children:"Close"})]}),Q.jsxs("div",{style:{marginTop:10},children:[Q.jsx("label",{style:{fontWeight:600,fontSize:12},children:"Question"}),Q.jsx("textarea",{value:Ul,onChange:U=>Ao(U.target.value),rows:3,placeholder:"e.g. How many vacant offices are on campus?",style:{width:"100%",resize:"vertical",padding:8,borderRadius:8,border:"1px solid #d0d0d0",marginTop:4}})]}),fl?Q.jsx("div",{style:{color:"crimson",marginTop:6,fontSize:12},children:fl}):null,Q.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:10},children:Q.jsx("button",{className:"btn",disabled:Vs||!Ul.trim()||Ja,onClick:Ti,children:Vs?"Asking...":"Ask"})})]})}),vo&&Q.jsx("div",{style:{position:"fixed",inset:0,zIndex:10004,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Q.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(720px, 94vw)",padding:16,lineHeight:1.45,maxHeight:"86vh",overflowY:"auto"},children:[Q.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Q.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Q.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Ask Mapfluence"}),Q.jsx("span",{title:"AI-generated response based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Q.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[Q.jsx("button",{className:"btn",onClick:Ii,children:"Export PDF"}),Q.jsx("button",{className:"btn",onClick:()=>Ss(null),children:"Close"})]})]}),Q.jsx("p",{style:{marginTop:10},children:vo.answer}),vo.bullets?.length?Q.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:vo.bullets.map((U,ge)=>Q.jsx("li",{children:U},ge))}):null,vo.resultType==="table"&&vo.columns?.length&&vo.rows?.length?Q.jsx("div",{style:{marginTop:10,overflowX:"auto"},children:Q.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[Q.jsx("thead",{style:{background:"#f8f9fb"},children:Q.jsx("tr",{children:vo.columns.map(U=>Q.jsx("th",{style:{textAlign:"left",padding:"6px 8px",borderBottom:"1px solid #e0e0e0"},children:U},U))})}),Q.jsx("tbody",{children:vo.rows.map((U,ge)=>Q.jsx("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:vo.columns.map(Pe=>Q.jsx("td",{style:{padding:"6px 8px"},children:U&&U[Pe]!=null?String(U[Pe]):""},Pe))},ge))})]})}):null,vo.missingData?.length?Q.jsxs("div",{style:{marginTop:10,fontSize:12,color:"#555"},children:["Missing data: ",vo.missingData.join(", ")]}):null]})}),Q.jsxs("div",{className:"mf-right-rail",children:[Q.jsxs("div",{className:"mf-right-logos",children:[Q.jsxs("div",{className:"logo-box",children:[Q.jsx("div",{className:"mapfluence-title",children:"MAPFLUENCE"}),Q.jsx("img",{className:"mf-logo mf-logo--mapfluence",src:$d("Clark_Enersen_Logo.png"),alt:"Clark & Enersen Logo"})]}),Q.jsx("div",{className:"logo-box",children:Q.jsx("img",{className:"mf-logo mf-logo--hc",src:$d("HC_image.png"),alt:"Hastings College"})})]}),!c&&Q.jsx("div",{className:"dashboard-box",children:Q.jsx(pj,{title:Tc,scopeLabel:Zl,metrics:Oo,loading:Al,error:pl,utilization:pc,utilizationScopeLabel:Oc,heatmapOn:Pt,onToggleHeatmap:qt})})]}),t==="admin"&&Q.jsxs(Q.Fragment,{children:[Re===ke.ASSESSMENT&&D&&!Me&&il&&Q.jsx("div",{className:"floating-panel",style:{position:"absolute",zIndex:40,left:Math.max(8,Math.min(il.x+12,(m.current?.clientWidth||1e3)-360)),top:Math.max(8,Math.min(il.y+12,(m.current?.clientHeight||800)-260)),width:340},children:Q.jsx(hz,{buildingId:D,buildingName:n?.buildings?.features?.find(U=>U.properties.id===D)?.properties?.name,currentCondition:Ne[D],onSave:ef,onOpenTechnical:()=>Fe(!0),onClose:()=>{$(null),Fe(!1),Wa(null)},canWrite:Ia})}),Re===ke.TECHNICAL&&D&&Me&&Q.jsx(uz,{buildingId:D,assessments:de,universityId:e,panelPos:il,isAdminRole:Ia,onClose:()=>Fe(!1),onSave:handleAssessmentSave})]}),Re===ke.SPACE_DATA&&(D||z)&&!mt&&(()=>{const U=m.current?.clientWidth||1e3,ge=m.current?.clientHeight||800,Pe=360,Xe=420,nt=16,tt=260,ot=24,Lt=140,_t=(Mr,Gr,Ri)=>Math.max(Gr,Math.min(Mr,Ri)),gt=Math.max(300,Math.min(Pe,U-nt*2)),Ht=nt+40,Yt=_t(U-gt-Ht,12,U-gt-12),bn=_t(U-gt-tt-ot-Lt,320,U-gt-12),rn=12,Zt=il||{y:ge*.65},En=_t(Zt.y,8,ge-Xe-8),Br=bn,zr=En,Gn=Ts.current;let vr=null;if(Gn&&Gn.geometry)try{const Mr=Eu(Gn);if(Mr&&Mr.length===4&&Mr.every(Gr=>Number.isFinite(Gr))){const Gr=(Mr[1]+Mr[3])/2,Ri=_.current?.project?_.current.project({lng:Mr[2],lat:Gr}):null;if(Ri){const jr=Yt,Vr=_t(Ri.y-Xe*.35,8,ge-Xe-8);vr={left:jr,top:Vr}}}}catch{}const Ei={position:"absolute",zIndex:40,left:Br,top:zr,width:gt,maxHeight:"75vh",overflow:"auto"},ni=vr?{position:"absolute",zIndex:40,left:Math.max(12,Math.min(vr.left,U-gt-nt)),top:rn,width:gt,maxHeight:"80vh",overflow:"auto"}:Ei,Hr=Tn==="floor"?ni:Ei,qi=Si?{...Hr,left:Si.x,top:Si.y}:Hr;return Q.jsxs("div",{ref:I,className:"floating-panel",style:qi,children:[Tn==="building"&&Q.jsx(lj,{buildingName:Ai,stats:tn,keyDepts:Qf(tn?.totalsByDept),utilization:lo(Ai),floors:Zs,selectedFloor:Ra,onChangeFloor:Mr=>Wl(Mr),onLoadFloorplan:vt,onExportCSV:()=>Js(Ai),onClose:()=>{ht(!0),$(null),Wa(null),Ki(null),Li.current=null,ac.current=null,Ts.current=null,fn(null),zt(null),hr(null),Yn("building")},onExportPDF:rg,onExplainBuilding:Mn,explainBuildingLoading:Sa,explainBuildingDisabled:Ja||!tn,explainBuildingError:hl,dragHandleProps:wh}),Tn==="floor"&&Q.jsx(cj,{buildingName:Ai,floorLabel:An?.floorLabel||Ra,stats:An,legendItems:Rr,legendTitle:{department:"Key Departments",type:"Key Types",occupancy:"Occupancy",vacancy:"Vacancy"}[_e]||"Legend",floors:Zs,selectedFloor:Ra,onChangeFloor:Mr=>Wl(Mr),onLoadFloorplan:vt,onUnloadFloorplan:kr,onExportCSV:()=>Js(Ai),colorMode:_e,onChangeColorMode:Mr=>{$e(Mr),Xs(Mr)},legendSelection:Ir,onLegendClick:Mr=>{const Gr=wr.get(Mr)||[];Bi(Ri=>{const jr=Ri===Mr?null:Mr;return nn(jr?Gr:null),jr})},onClose:()=>{ht(!0),$(null),Wa(null),Ki(null),Li.current=null,ac.current=null,Ts.current=null,fn(null),zt(null),hr(null),Yn("building")},onExportPDF:cr,onExplainFloor:sn,explainLoading:jl,explainDisabled:Ja||!An,explainError:nc,moveScenarioMode:rl,onToggleMoveScenarioMode:er,rotateActive:t==="admin"&&we==="rotate",moveActive:t==="admin"&&we==="move",rotateValue:t==="admin"?st:0,scaleValue:t==="admin"?bt:1,rotateNotice:t==="admin"?Ye:"",rotateStored:t==="admin"?wt:!1,adjustDebugInfo:t==="admin"?rt:null,onStartRotate:t==="admin"?G:void 0,onStartMove:t==="admin"?J:void 0,onCancelRotate:t==="admin"?ee:void 0,onClearRotate:t==="admin"?me:void 0,onSaveAdjust:t==="admin"?async()=>{const Mr=v();if(!Mr?.buildingLabel||!Mr?.floorId)return;const Gr=yr.current?.floorAdjustLabel||Mr.buildingLabel,Ri=Mr.url||yr.current?.url||Or(z,Mr.floorId),jr=Mr.basePath||yr.current?.floorAdjustBasePath||null,Vr=Ue||Mm(Gr,Mr.floorId),Ci=yr.current?.floorAdjustBasePivot||yr.current?.fc&&tc(yr.current.fc)?.geometry?.coordinates||null,an=ph(_.current,xa)?._data||yr.current?.fc||null,hn=W1(an),Rn={...Vr,pivot:Array.isArray(Vr.pivot)?Vr.pivot:Array.isArray(Ci)?Ci:null,anchorLngLat:hn||Vr.anchorLngLat||null};v1(Gr,Mr.floorId,Rn),Ri&&x1(Ri,Rn),jr&&b1(jr,Mr.floorId,Rn);try{await R(Gr,Mr.floorId,Rn)}catch{}Ri&&(ms.delete(Ri),qu.delete(Ri))}:void 0,saveAdjustDisabled:t==="admin"?!wt:!0,onScaleChange:t==="admin"?Mr=>{const Gr=v();if(!Gr?.buildingLabel||!Gr?.floorId)return;const Ri=Gr.url||yr.current?.url||Or(z,Gr.floorId),jr=Gr.basePath||yr.current?.floorAdjustBasePath||null,Vr=jr?Ty(jr,Gr.floorId):null,Ci=tp(Vr),zn=Ri?Ay(Ri):null,an=tp(zn),hn=Ci?Vr:an?zn:Mm(Gr.buildingLabel,Gr.floorId),Rn=Math.max(.5,Math.min(2.5,(hn.scale||1)+Mr)),gr=Rn/(hn.scale||1),Xr=ph(_.current,xa),Ni=Xr?._data||yr.current?.fc||null,sl=Ni&&tc(Ni)?.geometry?.coordinates||null;let ti=null;Ni&&sl&&Number.isFinite(gr)&&Math.abs(gr-1)>1e-6&&(ti=p0(Ni,gr,{origin:sl}),Xr&&Xr.setData(ti));const cs={...hn,scale:Rn},uo=yr.current?.floorAdjustLabel||Gr.buildingLabel,bs=yr.current?.floorAdjustBasePivot||Ni&&tc(Ni)?.geometry?.coordinates||null,Oa={...cs,pivot:Array.isArray(bs)?bs:cs.pivot,anchorLngLat:W1(ti||Xr?._data||Ni)||cs.anchorLngLat||null};v1(uo,Gr.floorId,Oa),Ri&&x1(Ri,Oa),jr&&b1(jr,Gr.floorId,Oa);try{R(uo,Gr.floorId,Oa)}catch{}const gc=Av(Oa),Do=Ni||yr.current?.fc||null;if(gc&&Do){const _l={...Do,__mfUserAdjustSignature:gc};Ri&&ms.set(Ri,_l),yr.current={...yr.current||{},fc:_l}}const Zn=Ri||Or(z,Gr.floorId);Zn&&!Ri&&(ms.delete(Zn),qu.delete(Zn))}:void 0,dragHandleProps:wh})]})})(),rl&&qh&&Q.jsxs("div",{ref:V,className:"floating-panel mf-move-scenario-panel",style:{position:"absolute",zIndex:60,right:gl?"auto":16,left:gl?gl.x:"auto",top:gl?gl.y:Yu,width:320,maxHeight:"70vh",overflow:"auto",padding:12,fontSize:13},children:[Q.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},...Pu,children:[Q.jsx("div",{style:{fontWeight:600},children:"Move Scenario"}),Q.jsx("button",{className:"btn secondary",style:{fontSize:11,padding:"2px 6px"},onClick:yl,children:"Clear"})]}),Q.jsxs("div",{style:{marginBottom:8},children:[Q.jsx("label",{style:{display:"block",fontSize:12,marginBottom:2},children:"Scenario label (optional)"}),Q.jsx("input",{className:"mf-input",value:cc,onChange:U=>or(U.target.value),placeholder:"e.g. Art Dept to Hurley - Option A",style:{width:"100%"}})]}),Q.jsxs("div",{style:{marginBottom:8},children:[Q.jsxs("div",{children:[Q.jsx("b",{children:"Total SF:"})," ",Math.round(go.totalSF).toLocaleString()]}),Q.jsxs("div",{children:[Q.jsx("b",{children:"Rooms:"})," ",go.rooms]})]}),Q.jsxs("div",{style:{marginBottom:8},children:[Q.jsx("div",{style:{fontWeight:600,marginBottom:2},children:"Rooms by Room Type Description"}),Lu.length===0?Q.jsx("div",{style:{fontSize:12,fontStyle:"italic",color:"#666"},children:"No rooms selected."}):Q.jsxs("table",{style:{width:"100%",fontSize:12},children:[Q.jsx("thead",{children:Q.jsxs("tr",{children:[Q.jsx("th",{style:{textAlign:"left"},children:"Room Type Description"}),Q.jsx("th",{style:{textAlign:"right"},children:"Qty"}),Q.jsx("th",{style:{textAlign:"right"},children:"SF"})]})}),Q.jsx("tbody",{children:Lu.map(({type:U,count:ge,sf:Pe})=>Q.jsxs("tr",{children:[Q.jsx("td",{children:U}),Q.jsx("td",{style:{textAlign:"right"},children:ge}),Q.jsx("td",{style:{textAlign:"right"},children:Math.round(Pe).toLocaleString()})]},U))})]})]}),Q.jsxs("div",{style:{marginTop:4},children:[Q.jsx("label",{style:{fontSize:12},children:"Scenario Department"}),Q.jsxs("select",{className:"mf-input",value:Vi,onChange:U=>lc(U.target.value),children:[Q.jsx("option",{value:"",children:"Choose department..."}),Bn.map(U=>Q.jsx("option",{value:U,children:U},U))]}),Q.jsx("button",{className:"btn primary",style:{marginTop:6},onClick:nu,disabled:!Vi||Aa.size===0,children:"Commit"})]}),Q.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",marginTop:8},children:[Q.jsx("button",{className:"btn primary",onClick:_n,disabled:Ja||ei||!Vi||!go,title:Vi?go?"Compare scenario vs current allocation for this department.":"Enable Move Scenario Mode and create a scenario to compare.":"Select a department for the scenario before comparing.",children:ei?"Comparing...":" Compare scenario vs current"}),fa?Q.jsx("div",{style:{color:"crimson",fontSize:12},children:fa}):null]}),Q.jsx("button",{className:"btn secondary",style:{width:"100%",marginTop:6},onClick:async()=>{try{const U=new wi("p","pt","letter"),ge=U.internal.pageSize.getWidth(),Pe=U.internal.pageSize.getHeight(),Xe=20,nt=Rg({...yr.current,labelOptions:{hideDrawing:!0}});let tt=!1,ot=0,Lt=0;if(nt){const Mr=nt.height&&nt.width?nt.height/nt.width:1,Gr=Math.min(ge*.55,ge-Xe*3),Ri=Pe-Xe*2;ot=Gr,Lt=ot*Mr,Lt>Ri&&(Lt=Ri,ot=Lt/(Mr||1)),U.addImage(nt.data,"PNG",Xe,Xe,ot,Lt),tt=!0}const _t="Move Scenario",gt=cc||"Move Scenario",Ht=cc?.trim()?cc.trim():"",Yt=tt?ot+Xe*2:Xe,bn=ge-Yt-Xe,rn=16;let Zt=Xe;U.setFontSize(14),U.text(_t,Yt,Zt),Ht&&U.text(Ht,Yt+bn,Zt,{align:"right"}),Zt+=rn,U.setFontSize(12);const En=Mr=>{U.text(Mr,Yt,Zt,{maxWidth:bn}),Zt+=rn},Br=Vi||"None selected",zr=Gd(Vi)||"#AAAAAA",Gn=14;U.setDrawColor(0),U.setFillColor(zr),U.rect(Yt,Zt,Gn,Gn,"FD");const vr=`Scenario Dept: ${Br}`;U.setTextColor("#000000"),U.setFont(void 0,"bold");const Ei=U.splitTextToSize(vr,Math.max(50,bn-Gn-6));Ei.forEach((Mr,Gr)=>{U.text(Mr,Yt+Gn+6,Zt+Gn-4+Gr*rn)}),U.setFont(void 0,"normal"),Zt+=Math.max(Gn,Ei.length*rn)+rn/2,U.setFontSize(12),En(`Total SF: ${Math.round(go.totalSF).toLocaleString()}`),En(`Rooms: ${go.rooms}`),Zt+=rn/2,U.setFont(void 0,"bold"),U.text("Rooms by Type",Yt,Zt),Zt+=rn;const ni=Yt+bn*.65,Hr=Yt+bn;if(U.setFontSize(11),U.text("Type",Yt,Zt),U.text("Qty",ni,Zt,{align:"right"}),U.text("SF",Hr,Zt,{align:"right"}),Zt+=rn,U.setFont(void 0,"normal"),!Lu.length)U.text("No rooms selected.",Yt,Zt),Zt+=rn;else{const Mr=Math.max(bn-120,100);Lu.forEach(({type:Gr,count:Ri,sf:jr})=>{const Vr=Math.round(jr).toLocaleString(),Ci=U.splitTextToSize(Gr,Mr);Ci.forEach((zn,an)=>{U.text(zn,Yt,Zt+an*(rn*.9))}),U.text(String(Ri),ni,Zt,{align:"right"}),U.text(Vr,Hr,Zt,{align:"right"}),Zt+=rn*Math.max(1,Ci.length*.9)})}U.setFont(void 0,"normal"),U.setFontSize(12),Zt+=rn/4;const qi=`${(gt||"move-scenario").replace(/\s+/g,"-").toLowerCase()}.pdf`;U.save(qi)}catch(U){console.error("Scenario export failed",U),alert("Export failed - see console for details.")}},children:"Export Scenario (PDF)"})]}),xe&&Q.jsx("div",{className:"map-controls-panel",style:{width:270,fontSize:12.5,lineHeight:1.25},children:Q.jsxs("div",{className:"map-controls",children:[t==="admin"&&Q.jsx("div",{className:"control-section",style:{background:"#fff",padding:6,border:"1px solid #ddd",borderRadius:6,marginBottom:4},children:Q.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,justifyContent:"space-between"},children:[Q.jsx("h5",{style:{margin:0,fontSize:13},children:"Admin access"}),Ga?Q.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[Q.jsxs("span",{style:{fontSize:12,whiteSpace:"nowrap"},children:[Ga.email," ",Ia?"(admin)":"(no admin)"]}),Q.jsx("button",{onClick:fc,children:"Sign out"})]}):Q.jsx("button",{onClick:Pd,children:"Sign in with Google"})]})}),!c&&Q.jsxs("div",{className:"control-section theme-selector",style:{marginTop:6},children:[Q.jsx("label",{htmlFor:"theme-select",style:{marginRight:8},children:"Map View:"}),Q.jsx("select",{id:"theme-select",value:Re,onChange:U=>be(U.target.value),disabled:Qe.length<=1,children:Qe.map(U=>Q.jsx("option",{value:U.value,children:U.label},U.value))})]}),c&&Q.jsxs("div",{className:"legend",style:{marginTop:6},children:[Q.jsx("h4",{children:"Legend"}),Q.jsxs("div",{className:"legend-section",children:[Q.jsx("h5",{children:"Marker Types"}),Object.entries(Mh||{}).map(([U,ge])=>Q.jsxs("div",{className:"legend-item",children:[Q.jsx("span",{className:"legend-color-box",style:{backgroundColor:ge}}),Q.jsx("span",{children:U})]},U))]})]}),!c&&Q.jsxs("div",{className:"floorplans-section",style:{marginTop:8,padding:6,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(235,250,240,0.9), rgba(220,242,230,0.9))"},children:[Q.jsx("h4",{style:{margin:"0 0 6px 0",fontSize:12.5},children:"Floorplans"}),Q.jsxs("div",{className:"floorplans",style:{display:"grid",gap:6},children:[Q.jsx("select",{id:"fp-building",style:{width:"100%"},value:z,onChange:U=>{const ge=U.target.value;W(ge),Wl(void 0)},children:td.map(U=>Q.jsx("option",{value:U.name,children:U.name},U.name))}),Q.jsx("select",{id:"fp-floor",style:{width:"100%"},value:Ur??"",onChange:U=>Wl(U.target.value),disabled:!Zs.length,children:Zs.map(U=>Q.jsx("option",{value:U,children:U},U))}),Q.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>At(),disabled:!Zs.length,children:"Load"}),Q.jsx("button",{className:"btn",style:{width:"100%"},onClick:kr,children:"Unload"}),Q.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>eT(_.current),children:"Center"})]}),Q.jsxs("div",{style:{marginTop:8},children:[Q.jsxs("button",{className:"mf-btn",style:{width:"100%",fontWeight:600},onClick:er,children:["Move Scenario Mode ",rl?"ON":"OFF"]}),rl&&Q.jsx("div",{style:{marginTop:6,fontSize:11,color:"#555",textAlign:"center"},children:"Click rooms to add/remove them from a what-if scenario. Real data is not changed."})]})]}),!c&&Q.jsxs("div",{className:"floorplans-section",style:{marginTop:8,padding:6,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(255,247,235,0.9), rgba(255,239,219,0.9))"},children:[Q.jsx("h4",{style:{margin:"2px 0 4px 0",fontSize:12.5},children:"Space Data Export"}),Q.jsxs("div",{style:{display:"grid",gap:6},children:[Q.jsxs("select",{style:{width:"100%"},value:Ar,onChange:U=>Dr(U.target.value),children:[Q.jsx("option",{value:"__all__",children:"All buildings"}),td.map(U=>Q.jsx("option",{value:U.name,children:U.name},U.name))]}),Q.jsx("input",{className:"mf-input",style:{width:"100%"},placeholder:"Filter department (optional)",value:_i,onChange:U=>ko(U.target.value)}),Q.jsxs("select",{style:{width:"100%"},value:ro,onChange:U=>os(U.target.value),children:[Q.jsx("option",{value:"rooms",children:"Room rows"}),Q.jsx("option",{value:"summary",children:"Building summary"})]}),Q.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>Js(),disabled:Ji,children:Ji?"Exporting...":ro==="summary"?"Export Summary CSV":"Export Space CSV"}),t==="admin"&&Q.jsx("button",{className:"btn",style:{width:"100%"},onClick:Sn,disabled:As,children:As?"Refreshing Airtable...":"Refresh Airtable Data"})]}),Q.jsx("div",{style:{fontSize:11,color:"#555",marginTop:2,minHeight:0},children:oo||(ro==="summary"?"Summary export adds a campus total (when exporting all buildings) plus one row per building.":"")}),t==="admin"&&ks&&Q.jsx("div",{style:{fontSize:11,color:"#555",marginTop:2},children:ks}),t==="admin"&&Q.jsxs("div",{style:{fontSize:11,color:"#555",marginTop:2},children:["Last synced: ",Vl?Vl.toLocaleString([],{hour:"2-digit",minute:"2-digit",month:"short",day:"numeric"}):"Not yet"]})]}),!c&&Q.jsxs("div",{style:{marginTop:4,padding:6,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(240,246,255,0.94), rgba(228,238,255,0.94))",boxShadow:"0 2px 6px rgba(0,0,0,0.05)"},children:[Q.jsx("style",{children:"@keyframes aiSparklePulse { 0% { transform: translateY(0); } 50% { transform: translateY(-1px); } 100% { transform: translateY(0); } }"}),Q.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:10},children:[Q.jsxs("div",{children:[Q.jsxs("div",{style:{fontWeight:800,letterSpacing:.2,display:"flex",alignItems:"center",gap:6,flexWrap:"nowrap"},children:[Q.jsx("span",{style:{color:"#c62828",fontFamily:"'Trebuchet MS', 'Gill Sans', 'Helvetica Neue', Arial, sans-serif",fontWeight:700},children:"MAPFLUENCE"}),Q.jsx("span",{children:"AI"}),Q.jsx("span",{title:"AI-generated summaries based on currently loaded space data.",style:{display:"inline-flex",alignItems:"center",marginLeft:"auto",padding:"2px 6px",borderRadius:999,fontSize:10,fontWeight:700,border:"1px solid rgba(0,0,0,0.15)",background:"rgba(255,255,255,0.9)",animation:Hs?"aiSparklePulse 2.8s ease-in-out infinite":"none"},children:" AI Summary"})]}),Q.jsxs("div",{style:{marginTop:4,fontSize:11,opacity:.8,display:"flex",alignItems:"center",justifyContent:"space-between",gap:6},children:[Q.jsx("span",{children:"Summaries from loaded space data"}),Q.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[Q.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:Hs?"rgba(0,255,0,0.10)":L?"rgba(255,193,7,0.18)":"rgba(255,0,0,0.08)"},title:Hs?"AI server available":L?"Checking AI status":"AI server not reachable",children:Hs?"Online":L?"Checking":"Unavailable"}),Q.jsx("button",{onClick:()=>ds(!0),title:"What Mapfluence AI is doing",style:{border:"1px solid rgba(0,0,0,0.15)",borderRadius:999,background:"white",width:18,height:18,display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:10},"aria-label":"What Mapfluence AI is doing",children:"?"})]})]})]}),Q.jsxs("div",{style:{display:"none",alignItems:"center",gap:6,marginTop:10},children:[Q.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:Hs?"rgba(0,255,0,0.10)":L?"rgba(255,193,7,0.18)":"rgba(255,0,0,0.08)"},title:Hs?"AI server available":L?"Checking AI status":"AI server not reachable",children:Hs?"Online":L?"Checking":"Unavailable"}),Q.jsx("button",{onClick:()=>ds(!0),title:"What Mapfluence AI is doing",style:{border:"1px solid rgba(0,0,0,0.15)",borderRadius:999,background:"white",width:20,height:20,display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:11,marginTop:2},"aria-label":"What Mapfluence AI is doing",children:"i"})]})]}),Q.jsxs("div",{style:{display:"grid",gap:6,marginTop:6},children:[Q.jsx("button",{style:{padding:"5px 7px",fontSize:11},disabled:Ja||!An||jl,onClick:sn,children:jl?"Explaining...":" Explain this floor"}),Q.jsx("button",{style:{padding:"5px 7px",fontSize:11},disabled:Ja||!tn||Sa,onClick:Mn,children:Sa?"Explaining...":" Explain this building"}),Q.jsx("button",{style:{padding:"5px 7px",fontSize:11},disabled:Ja||!it||Qi,onClick:Cn,children:Qi?"Explaining...":" Explain campus"})]}),Q.jsx("div",{style:{marginTop:6,display:"grid",gap:4},children:Q.jsx("button",{style:{padding:"5px 7px",fontSize:11},onClick:()=>Xu(!0),children:" Ask Mapfluence"})}),t==="admin"&&Q.jsx("div",{style:{marginTop:6},children:Q.jsx("button",{disabled:Ja,onClick:()=>es(!0),style:{width:"100%",padding:"5px 7px",fontSize:11},children:" Create move scenario"})}),Q.jsx("div",{style:{marginTop:10,fontSize:11,opacity:.75,lineHeight:1.35},children:"Results are descriptive and do not modify project data."}),nc||hl||ka?Q.jsx("div",{style:{marginTop:8,color:"crimson",fontSize:12},children:nc||hl||ka}):null]})]})}),t==="admin"&&xe&&Q.jsxs("div",{style:{position:"absolute",left:20,bottom:20,width:270,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(245,245,245,0.96), rgba(230,230,230,0.96))",padding:8,boxShadow:"0 2px 6px rgba(0,0,0,0.05)"},children:[Q.jsx("h4",{style:{margin:"0 0 6px 0",fontSize:12.5},children:"Data Filters"}),Q.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[Q.jsx("button",{className:"btn",onClick:ar,children:"Export Map Data"}),Q.jsx("button",{className:"btn",onClick:ps,children:"Clear Conditions"})]})]}),c&&Ze&&Q.jsxs("div",{className:"help-panel",style:{right:20,bottom:20},children:[Q.jsx("button",{className:"close-button","aria-label":"Close help",onClick:()=>et(!1),children:""}),Q.jsx("h4",{children:"How to Use This Map"}),Q.jsxs("ul",{children:[Q.jsx("li",{children:"Click anywhere on the map to add a marker."}),Q.jsx("li",{children:"Select a marker type and add an optional comment."}),Q.jsx("li",{children:"Markers are saved to the engagement demo dataset."})]}),Q.jsx("button",{className:"close-button-main",onClick:()=>et(!1),children:"Close"})]}),jo&&Qr&&Q.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.35)"},children:Q.jsxs("div",{ref:O,className:"mf-room-edit-panel",style:{position:"absolute",left:Rs?Rs.x:"50%",top:Rs?Rs.y:"50%",transform:Rs?"none":"translate(-50%, -50%)",width:520,maxWidth:"90vw",background:"#fff",borderRadius:14,padding:16,boxShadow:"0 18px 36px rgba(0,0,0,0.2)"},children:[Q.jsx("div",{style:{display:"flex",alignItems:"center",marginBottom:12},...ld,children:Q.jsx("h4",{style:{margin:0},children:Uo.length>1?`Edit ${Uo.length} Rooms`:`Edit Room ${Qr.feature?.properties?.name||Qr.roomLabel||""}`})}),Uo.length>1&&Q.jsxs("div",{style:{marginBottom:12},children:[Q.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Selected Rooms"}),Q.jsx("div",{style:{maxHeight:180,overflow:"auto",border:"1px solid #e5e5e5",borderRadius:6},children:Q.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[Q.jsx("thead",{style:{background:"#f9f9f9",position:"sticky",top:0},children:Q.jsxs("tr",{children:[Q.jsx("th",{style:{padding:"6px 8px",width:40,textAlign:"center"},children:Q.jsx("input",{type:"checkbox",checked:qr.size===Uo.length,onChange:U=>{const ge=U.target.checked?new Set(Uo.map(Pe=>Pe.roomId||String(Pe.revitId??""))):new Set;Cr(ge)}})}),Q.jsx("th",{style:{padding:"6px 8px",textAlign:"left"},children:"Room"}),Q.jsx("th",{style:{padding:"6px 8px",textAlign:"right"},children:"Area (SF)"}),Q.jsx("th",{style:{padding:"6px 8px",textAlign:"left"},children:"Department"}),Q.jsx("th",{style:{padding:"6px 8px",textAlign:"left"},children:"Room Type Description"})]})}),Q.jsx("tbody",{children:Uo.map(U=>{const ge=U.roomId||String(U.revitId??""),Pe=qr.has(ge),Xe=Number.isFinite(U.properties?.area)?Math.round(U.properties.area):"";return Q.jsxs("tr",{style:{borderTop:"1px solid #f0f0f0"},children:[Q.jsx("td",{style:{padding:"6px 8px",textAlign:"center"},children:Q.jsx("input",{type:"checkbox",checked:Pe,onChange:nt=>{Cr(tt=>{const ot=new Set(tt||[]);return nt.target.checked?ot.add(ge):ot.delete(ge),ot})}})}),Q.jsx("td",{style:{padding:"6px 8px",fontWeight:600},children:U.roomLabel||U.feature?.properties?.name||ge}),Q.jsx("td",{style:{padding:"6px 8px",textAlign:"right",whiteSpace:"nowrap"},children:Xe?Xe.toLocaleString():""}),Q.jsx("td",{style:{padding:"6px 8px"},children:U.properties?.department||U.feature?.properties?.department||""}),Q.jsx("td",{style:{padding:"6px 8px"},children:U.properties?.type||U.feature?.properties?.type||""})]},ge)})})]})})]}),Q.jsx(hA,{label:"Room Type",value:Qr.properties?.type??Qr.feature?.properties?.type??"",onChange:U=>xo(ge=>ge&&{...ge,properties:{...ge.properties,type:U}}),options:Mt,placeholder:"Search or choose a type..."}),Q.jsx(hA,{label:"Department",value:Qr.properties?.department??Qr.feature?.properties?.department??"",onChange:U=>xo(ge=>ge&&{...ge,properties:{...ge.properties,department:U}}),options:Bn,placeholder:"Search or choose a department..."}),$l&&Q.jsxs("div",{className:"mf-form-row",children:[Q.jsx("label",{children:"Occupant"}),Q.jsx("input",{className:"mf-input",type:"text",value:Qr.properties?.occupant??"",onChange:U=>xo(ge=>ge&&{...ge,properties:{...ge.properties,occupant:U.target.value}}),placeholder:"(optional)"})]}),Q.jsxs("div",{className:"mf-form-row",children:[Q.jsx("label",{children:"Area (SF)"}),Q.jsx("input",{className:"mf-input",value:Qr.properties?.area??"",disabled:!0,readOnly:!0})]}),Gl&&Q.jsxs("div",{className:"mf-form-row",children:[Q.jsx("label",{children:"Seat Count"}),Q.jsx("input",{className:"mf-input",type:"number",min:"0",value:Qc==="__MIXED__"?"":Qc,placeholder:Zc&&Qc==="__MIXED__"?"varies":"",onChange:U=>{const ge=U.target.value;xo(Pe=>Pe&&{...Pe,properties:{...Pe.properties,seatCount:ge}})}})]}),$l&&Q.jsxs("div",{className:"mf-form-row",children:[Q.jsx("label",{children:"Occupancy Status"}),Q.jsxs("select",{className:"mf-input",value:Lc==="__MIXED__"?"":Lc,onChange:U=>{const ge=U.target.value;xo(Pe=>Pe&&{...Pe,properties:{...Pe.properties,occupancyStatus:ge||(Zc?null:"")}})},children:[Zc&&Lc==="__MIXED__"?Q.jsx("option",{value:"",children:"-- Mixed --"}):Q.jsx("option",{value:"",children:"--"}),Ks.map(U=>Q.jsx("option",{value:U,children:U},U))]})]}),Q.jsxs("div",{className:"mf-form-row",children:[Q.jsx("label",{children:"Comments"}),Q.jsx("textarea",{className:"mf-input",rows:3,value:Qr.properties?.comments??"",onChange:U=>xo(ge=>ge&&{...ge,properties:{...ge.properties,comments:U.target.value}})})]}),Q.jsxs("div",{className:"mf-actions",children:[Q.jsx("button",{className:"btn",onClick:Kc,children:"Cancel"}),Q.jsx("button",{className:"btn",onClick:async()=>{const U=qr,ge=Uo.length?Uo.filter(gt=>U.has(gt.roomId||String(gt.revitId??""))):[];if(!ge.length)return;let Pe=0;const Xe=ge.length>1,nt=Qr.properties||{},tt=_.current,ot=ph(tt,xa),Lt=ot&&(ot._data||ot.serialize?.().data)||null,_t=Lt?Uu(Lt)?.features||[]:[];for(const gt of ge){const Ht={type:gt.properties?.type??gt.feature?.properties?.type??"",department:gt.properties?.department??gt.feature?.properties?.department??"",occupant:gt.properties?.occupant??gt.feature?.properties?.occupant??"",occupancyStatus:gt.properties?.occupancyStatus??gt.feature?.properties?.occupancyStatus??gt.properties?.["Occupancy Status"]??gt.feature?.properties?.["Occupancy Status"]??gt.properties?.OccupancyStatus??gt.feature?.properties?.OccupancyStatus??"",comments:gt.properties?.comments??gt.feature?.properties?.comments??"",seatCount:Bb({...gt.feature?.properties||{},...gt.properties||{}})},bn=nt.occupancyStatus!=null&&String(nt.occupancyStatus).trim()!==""?nt.occupancyStatus:Ht.occupancyStatus,rn=$l?Xe?nt.occupant!=null&&String(nt.occupant).trim()!==""?nt.occupant:Ht.occupant:nt.occupant??Ht.occupant:void 0,Zt=Gl?nt.seatCount!=null?nt.seatCount:Ht.seatCount:void 0,En={...gt.properties,...nt,type:nt.type!=null&&String(nt.type).trim()!==""?nt.type:Ht.type,department:nt.department!=null&&String(nt.department).trim()!==""?nt.department:Ht.department,...$l?{occupancyStatus:bn,occupant:rn}:{},...Gl?{seatCount:Zt}:{}};if($l&&(En.OccupancyStatus=bn,En["Occupancy Status"]=bn),await y({roomId:gt.roomId,buildingId:gt.buildingId,buildingName:gt.buildingName,floorName:gt.floorName,revitId:gt.revitId,roomLabel:gt.roomLabel,roomNumber:gt.roomNumber,properties:En})&&(Pe+=1,_t.length)){const zr=gt.revitId??gt.feature?.id??gt.feature?.properties?.RevitId??null;if(zr!=null){const Gn=_t.find(vr=>(vr.id??vr.properties?.RevitId)===zr);Gn&&Gn.properties&&(Gn.properties.department=En.department??Gn.properties.department,Gn.properties.department=Gn.properties.department||En.department||"",Gn.properties.Department=Gn.properties.department,Gn.properties.type=En.type??Gn.properties.type,Gn.properties.Type=Gn.properties.type,Gn.properties.RoomType=Gn.properties.type,$l&&(Gn.properties.Occupant=En.occupant??Gn.properties.Occupant,Gn.properties.occupant=Gn.properties.Occupant,Gn.properties.occupancyStatus=En.occupancyStatus??Gn.properties.occupancyStatus,Gn.properties.OccupancyStatus=En.OccupancyStatus??Gn.properties.OccupancyStatus,Gn.properties["Occupancy Status"]=En["Occupancy Status"]??Gn.properties["Occupancy Status"]),Gl&&(Gn.properties.SeatCount=En.seatCount??Gn.properties.SeatCount,Gn.properties["Seat Count"]=En.seatCount??Gn.properties["Seat Count"],Gn.properties.seatCount=En.seatCount??Gn.properties.seatCount))}}}if(Pe>0){try{if(ot&&_t.length){const gt=Uu(Lt)||{type:"FeatureCollection",features:[]};gt.features=_t,ot.setData(gt)}}catch{}Qr.refreshPopup?.(),Qa(),Kc()}},children:Uo.length>1?`Save ${Uo.length} Rooms`:"Save"})]})]})}),La&&Oi&&Q.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Q.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(760px, 92vw)",padding:16},children:[Q.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Q.jsxs("div",{children:[Q.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Q.jsx("div",{style:{fontWeight:700,fontSize:16},children:Oi.title&&Oi.title.includes("Summary")?Oi.title:`${Oi.title||"Level"} - Summary`}),Q.jsx("span",{title:"AI-generated summary based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI Summary"})]}),Q.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:"AI-assisted overview"})]}),Q.jsx("button",{className:"btn",onClick:()=>zl(!1),children:"Close"})]}),Q.jsxs("div",{style:{marginTop:10,lineHeight:1.45},children:[Oi.summary?Q.jsx("p",{style:{margin:"6px 0 10px 0"},children:Oi.summary}):null,Q.jsxs("div",{children:[Q.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Insights"}),Q.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:(Oi.insights||[]).map((U,ge)=>Q.jsx("li",{children:U},ge))})]}),Array.isArray(Oi.watchouts)&&Oi.watchouts.length?Q.jsxs("div",{children:[Q.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Watchouts"}),Q.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:Oi.watchouts.map((U,ge)=>Q.jsx("li",{children:U},ge))})]}):null,Array.isArray(Oi.data_used)&&Oi.data_used.length?Q.jsxs("small",{style:{color:"#555"},children:["Data used: ",Oi.data_used.join(", ")]}):null,Q.jsx("div",{style:{marginTop:12,fontSize:11,color:"#666"},children:"AI summaries reflect available data at the time of generation."})]})]})}),Pa&&Ro&&Q.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Q.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(760px, 92vw)",padding:16},children:[Q.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Q.jsxs("div",{children:[Q.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Q.jsx("div",{style:{fontWeight:700,fontSize:16},children:Ro.title&&Ro.title.includes("Summary")?Ro.title:`${Ro.title||"Building"} - Summary`}),Q.jsx("span",{title:"AI-generated summary based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI Summary"})]}),Q.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:"AI-assisted overview"})]}),Q.jsx("button",{className:"btn",onClick:()=>Qo(!1),children:"Close"})]}),Q.jsxs("div",{style:{marginTop:10,lineHeight:1.45},children:[Ro.summary?Q.jsx("p",{style:{margin:"6px 0 10px 0"},children:Ro.summary}):null,Q.jsxs("div",{children:[Q.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Insights"}),Q.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:(Ro.insights||[]).map((U,ge)=>Q.jsx("li",{children:U},ge))})]}),Array.isArray(Ro.watchouts)&&Ro.watchouts.length?Q.jsxs("div",{children:[Q.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Watchouts"}),Q.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:Ro.watchouts.map((U,ge)=>Q.jsx("li",{children:U},ge))})]}):null,Array.isArray(Ro.data_used)&&Ro.data_used.length?Q.jsxs("small",{style:{color:"#555"},children:["Data used: ",Ro.data_used.join(", ")]}):null,Q.jsx("div",{style:{marginTop:12,fontSize:11,color:"#666"},children:"AI summaries reflect available data at the time of generation."})]})]})}),ss&&ls&&Q.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Q.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(760px, 92vw)",padding:16},children:[Q.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Q.jsxs("div",{children:[Q.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Q.jsx("div",{style:{fontWeight:700,fontSize:16},children:ls.title&&ls.title.includes("Summary")?ls.title:`${ls.title||Ee} - Summary`}),Q.jsx("span",{title:"AI-generated summary based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI Summary"})]}),Q.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:"AI-assisted overview"})]}),Q.jsx("button",{className:"btn",onClick:()=>as(!1),children:"Close"})]}),Q.jsxs("div",{style:{marginTop:10,lineHeight:1.45},children:[ls.summary?Q.jsx("p",{style:{margin:"6px 0 10px 0"},children:ls.summary}):null,Q.jsxs("div",{children:[Q.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Insights"}),Q.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:(ls.insights||[]).map((U,ge)=>Q.jsx("li",{children:U},ge))})]}),Array.isArray(ls.watchouts)&&ls.watchouts.length?Q.jsxs("div",{children:[Q.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Watchouts"}),Q.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:ls.watchouts.map((U,ge)=>Q.jsx("li",{children:U},ge))})]}):null,Array.isArray(ls.data_used)&&ls.data_used.length?Q.jsxs("small",{style:{color:"#555"},children:["Data used: ",ls.data_used.join(", ")]}):null,Q.jsx("div",{style:{marginTop:12,fontSize:11,color:"#666"},children:"AI summaries reflect available data at the time of generation."})]})]})}),Qn&&Lr&&(()=>{const U=(Ht={})=>{let Yt=0,bn=0,rn=0;for(const[Zt,En]of Object.entries(Ht||{})){const Br=String(Zt||"").toLowerCase(),zr=Number(En||0)||0;Br.includes("office")?Yt+=zr:Br.includes("class")?bn+=zr:Br.includes("lab")&&(rn+=zr)}return{offices:Yt,classrooms:bn,labs:rn}},ge=eo||{},Pe=go||{},Xe=Lr?.scenarioDept||Vi||"Selected Dept",nt=eo?.__label||"baseline",tt=Ai,ot=`Baseline (${Xe} in ${nt})`,Lt=`Scenario (${Xe} to ${tt})`,_t=U(ge.roomTypes),gt=U(Pe.roomTypes);return Q.jsx("div",{style:{position:"fixed",inset:0,zIndex:10006,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Q.jsxs("div",{ref:ol,className:"mf-ai-modal-panel",style:{position:"fixed",left:to?to.x:"50%",top:to?to.y:"50%",transform:to?"none":"translate(-50%, -50%)",width:"min(760px, 92vw)",padding:16,maxHeight:"90vh",overflow:"auto"},children:[Q.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Q.jsx("div",{...ku,style:{fontWeight:700},children:`${Vi||"Scenario"} - ${eo?.__label||"baseline"} to ${Ai}${Ur?` (${Ur})`:""}`}),Q.jsxs("div",{style:{display:"flex",gap:8},children:[Q.jsx("button",{className:"btn",onClick:Nc,children:"Export Scenario (PDF)"}),Q.jsx("button",{className:"btn",onClick:()=>Fr(!1),children:"Close"})]})]}),Q.jsx("p",{style:{marginTop:10},children:Lr.summary}),Q.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:10,marginBottom:10},children:[Q.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Q.jsx("div",{style:{fontWeight:700,marginBottom:4},children:ot}),Q.jsxs("div",{style:{fontSize:13},children:["SF: ",Math.round(eo?.totalSF||0).toLocaleString()]}),Q.jsxs("div",{style:{fontSize:13},children:["Rooms: ",Math.round(eo?.rooms||0).toLocaleString()]}),_t.offices||_t.classrooms||_t.labs?Q.jsxs(Q.Fragment,{children:[Q.jsxs("div",{style:{fontSize:13},children:["Offices: ",_t.offices]}),Q.jsxs("div",{style:{fontSize:13},children:["Classrooms: ",_t.classrooms]}),Q.jsxs("div",{style:{fontSize:13},children:["Labs: ",_t.labs]})]}):null]}),Q.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Q.jsx("div",{style:{fontWeight:700,marginBottom:4},children:Lt}),Q.jsxs("div",{style:{fontSize:13},children:["SF: ",Math.round(go?.totalSF||0).toLocaleString()]}),Q.jsxs("div",{style:{fontSize:13},children:["Rooms: ",Math.round(go?.rooms||0).toLocaleString()]}),gt.offices||gt.classrooms||gt.labs?Q.jsxs(Q.Fragment,{children:[Q.jsxs("div",{style:{fontSize:13},children:["Offices: ",gt.offices]}),Q.jsxs("div",{style:{fontSize:13},children:["Classrooms: ",gt.classrooms]}),Q.jsxs("div",{style:{fontSize:13},children:["Labs: ",gt.labs]})]}):null]})]}),Q.jsx("b",{children:`Scenario - ${Lr?.scenarioDept||Vi||"Selected Dept"}`}),Q.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:8},children:[Q.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Q.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"Pluses"}),Q.jsx("ul",{style:{margin:0,paddingLeft:18},children:(Lr?.scenarioPros||[]).map((Ht,Yt)=>Q.jsx("li",{children:Ht},Yt))})]}),Q.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Q.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"Minuses"}),Q.jsx("ul",{style:{margin:0,paddingLeft:18},children:(Lr?.scenarioCons||[]).map((Ht,Yt)=>Q.jsx("li",{children:Ht},Yt))})]})]}),Lr.risks?.length?Q.jsxs(Q.Fragment,{children:[Q.jsx("b",{children:"Risks / watchouts"}),Q.jsx("ul",{children:Lr.risks.map((Ht,Yt)=>Q.jsx("li",{children:Ht},Yt))})]}):null,Lr.notes?.length?Q.jsxs(Q.Fragment,{children:[Q.jsx("b",{children:"Notes"}),Q.jsx("ul",{children:Lr.notes.map((Ht,Yt)=>Q.jsx("li",{children:Ht},Yt))})]}):null]})})})(),zi&&Q.jsx("div",{style:{position:"fixed",inset:0,zIndex:10002,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Q.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(560px, 92vw)",padding:16,lineHeight:1.4},children:[Q.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[Q.jsxs("div",{children:[Q.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Q.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Create move scenario (AI)"}),Q.jsx("span",{title:"AI-generated scenario plan based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Q.jsx("div",{style:{fontSize:12,color:"#555"},children:"Uses campus-wide room inventory to suggest candidates."})]}),Q.jsx("button",{className:"btn",onClick:()=>es(!1),children:"Close"})]}),Q.jsxs("div",{style:{marginTop:10},children:[Q.jsx("label",{style:{fontWeight:600,fontSize:12},children:"Request"}),Q.jsx("textarea",{value:_o,onChange:U=>Tu(U.target.value),rows:3,placeholder:"e.g. Find a new home for Physics; move the Art department to the Gray Center.",style:{width:"100%",resize:"vertical",padding:8,borderRadius:8,border:"1px solid #d0d0d0",marginTop:4}})]}),rc?Q.jsx("div",{style:{color:"crimson",marginTop:6,fontSize:12},children:rc}):null,Q.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginTop:10},children:[Q.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:12,color:"#444"},children:[Q.jsx("input",{type:"checkbox",checked:Ps,onChange:U=>ja(U.target.checked)}),"Strict fit (5% target)"]}),Q.jsx("button",{className:"btn",disabled:Sl||!_o.trim()||Ja,onClick:_r,children:Sl?"Planning...":"Create move scenario"})]})]})}),Mo&&Q.jsx("div",{style:{position:"fixed",inset:0,zIndex:10004,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Q.jsxs("div",{ref:hc,className:"mf-ai-modal-panel",style:{position:"fixed",left:ua?ua.x:"50%",top:ua?ua.y:"50%",transform:ua?"none":"translate(-50%, -50%)",width:"min(760px, 92vw)",padding:12,lineHeight:1.35,fontSize:12,maxHeight:"90vh",overflow:"auto"},children:[Q.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Q.jsxs("div",{children:[Q.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},...dc,children:[Q.jsx("div",{style:{fontWeight:700,fontSize:16},children:Mo.title||"Move scenario plan"}),Q.jsx("span",{title:"AI-generated scenario plan based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Mo.interpretedIntent?Q.jsx("div",{style:{fontSize:12,color:"#555"},children:Mo.interpretedIntent}):null]}),Q.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[Q.jsx("button",{className:"btn",onClick:()=>co(Mo),children:"Add to Scenario Comparison"}),Q.jsx("button",{className:"btn",onClick:()=>ys(null),children:"Close"})]})]}),Mo.selectionCriteria?.filter(U=>!/vacan/i.test(U||"")).length?Q.jsxs("div",{style:{marginTop:10},children:[Q.jsx("b",{children:"Selection criteria"}),Q.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:Mo.selectionCriteria.filter(U=>!/vacan/i.test(U||"")).map((U,ge)=>Q.jsx("li",{children:U},ge))})]}):null,Q.jsxs("div",{style:{marginTop:10},children:[Q.jsx("b",{children:"Recommended candidates"}),Mo.recommendedCandidates?.length?Q.jsxs("div",{style:{marginTop:6,border:"1px solid #e0e0e0",borderRadius:8,overflow:"hidden"},children:[Q.jsx("div",{style:{display:"flex",justifyContent:"flex-end",padding:"6px 8px",background:"#f8f9fb"},children:Q.jsx("button",{className:"btn",onClick:yo,children:"Select these rooms in Move Scenario"})}),Q.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 3fr",background:"#f8f9fb",padding:"6px 8px",fontWeight:600,fontSize:12},children:[Q.jsx("div",{children:"Location"}),Q.jsx("div",{children:"Room"}),Q.jsx("div",{style:{textAlign:"right"},children:"SF"}),Q.jsx("div",{style:{textAlign:"right"},children:"Match / Notes"}),Q.jsx("div",{children:"Rationale"})]}),Q.jsx("div",{children:Mo.recommendedCandidates.map((U,ge)=>Q.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 3fr",padding:"6px 8px",borderTop:"1px solid #f0f0f0",fontSize:12},children:[Q.jsxs("div",{children:[Q.jsx("div",{style:{fontWeight:600},children:U.buildingLabel||"Building"}),Q.jsx("div",{style:{opacity:.75},children:U.floorId||""})]}),Q.jsxs("div",{children:[Q.jsx("div",{style:{fontWeight:600},children:U.roomLabel||"Room"}),Q.jsx("div",{style:{opacity:.75},children:U.type||"Unspecified"})]}),Q.jsx("div",{style:{textAlign:"right"},children:Math.round(Number(U.sf||0)).toLocaleString()}),Q.jsx("div",{style:{textAlign:"right"},children:(()=>{const Pe=String(U.occupant||"").trim(),Xe=String(U.occupantDept||U.department||"").trim();return Pe?` Occupied  requires relocation${Xe?` of ${Xe}`:""}`:""})()}),Q.jsx("div",{children:Gb(U.rationale)||""})]},U.id||ge))})]}):Q.jsx("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:"No candidates returned."})]}),Mo.assumptions?.length?Q.jsxs("div",{style:{marginTop:10},children:[Q.jsx("b",{children:"Assumptions"}),Q.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:Mo.assumptions.map((U,ge)=>Q.jsx("li",{children:U},ge))})]}):null,Mo.nextSteps?.length?Q.jsxs("div",{style:{marginTop:10},children:[Q.jsx("b",{children:"Next steps"}),Q.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:Mo.nextSteps.map((U,ge)=>Q.jsx("li",{children:U},ge))})]}):null]})}),Go&&Q.jsx("div",{style:{position:"fixed",inset:0,zIndex:10002,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Q.jsxs("div",{style:{width:"min(520px, 92vw)",background:"#fff",borderRadius:12,padding:16,boxShadow:"0 22px 44px rgba(0,0,0,0.25)",lineHeight:1.5,fontSize:13},children:[Q.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[Q.jsx("div",{style:{fontWeight:700,fontSize:16},children:"What Mapfluence AI is doing"}),Q.jsx("button",{className:"btn",onClick:()=>ds(!1),children:"Close"})]}),Q.jsxs("div",{style:{marginTop:10},children:[Q.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"What Mapfluence AI is doing"}),Q.jsxs("ul",{style:{paddingLeft:18,margin:"0 0 10px 0"},children:[Q.jsx("li",{children:"Generates summaries and comparisons from the statistics currently loaded in this session."}),Q.jsx("li",{children:"Uses your selected scope (campus / building / floor) and scenario totals when available."}),Q.jsx("li",{children:"Produces descriptive output and does not modify project data."})]}),Q.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"What Mapfluence AI is not doing"}),Q.jsxs("ul",{style:{paddingLeft:18,margin:0},children:[Q.jsx("li",{children:"Not writing to the database automatically."}),Q.jsx("li",{children:"Not making final planning decisions."}),Q.jsx("li",{children:"Not inventing missing data; it will note what's unavailable."})]})]})]})}),Is&&Q.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Q.jsxs("div",{style:{width:480,maxWidth:"90vw",background:"#fff",borderRadius:14,padding:18,boxShadow:"0 22px 44px rgba(0,0,0,0.25)"},children:[Q.jsx("h4",{style:{margin:"0 0 10px 0"},children:"Confirm Move"}),Q.jsx("div",{style:{fontSize:13,color:"#333",marginBottom:10},children:`Move ${Is.person||Is.from?.occupantName||"-"} from ${Is.from?.buildingId||""} ${Is.from?.roomLabel||"-"} to ${Is.to?.buildingId||""} ${Is.to?.roomLabel||"-"}.`}),Q.jsxs("div",{className:"mf-form-row",children:[Q.jsx("label",{children:"Person"}),Q.jsx("input",{className:"mf-input",value:Is.person||"",onChange:U=>Xl(ge=>ge&&{...ge,person:U.target.value})})]}),Q.jsxs("div",{className:"mf-form-row",children:[Q.jsx("label",{children:"Effective Date"}),Q.jsx("input",{className:"mf-input",type:"date",value:Is.effectiveDate||"",onChange:U=>Xl(ge=>ge&&{...ge,effectiveDate:U.target.value})})]}),Q.jsxs("div",{className:"mf-form-row",children:[Q.jsx("label",{children:"Comments"}),Q.jsx("textarea",{className:"mf-input",rows:3,value:Is.comments||"",onChange:U=>Xl(ge=>ge&&{...ge,comments:U.target.value})})]}),Q.jsxs("div",{className:"mf-actions",style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[Q.jsx("button",{className:"btn",onClick:Ld,children:"Cancel"}),Q.jsx("button",{className:"btn",onClick:Of,children:"Confirm move"})]})]})})]})},wV=({config:n,universityId:e,persona:t,engagementMode:i=!1})=>Q.jsx(P8,{config:n,universityId:e,persona:t,engagementMode:i}),SV=({config:n,universityId:e})=>Q.jsx("div",{className:"admin-page",style:{width:"100%",height:"100%"},children:Q.jsx(P8,{config:n,universityId:e,mode:"admin"})}),EV=[{universityName:"Hastings College",enableDrawingEntry:!0,buildings:"Hastings_College_Buildings.geojson",boundary:"Hastings_College_Boundary.geojson",outdoorSpacesUrl:"geojson/HC_Outdoor_map.geojson",style:"mapbox://styles/mapbox/streets-v12",lng:-98.371164,lat:40.592958,zoom:15.8,pitch:39,bearing:0,logos:{clarkEnersen:"Clark_Enersen_Logo.png",university:"HC_image.png"}}],AV="rockhurst",TV="Rockhurst University",IV=!1,CV="mapbox://styles/mapbox/light-v10",LV=39.038,PV=-94.57,kV=16,MV=45,RV=-17.6,NV={universityId:AV,universityName:TV,enableDrawingEntry:IV,style:CV,lat:LV,lng:PV,zoom:kV,pitch:MV,bearing:RV},DV=`\uFEFF{"type":"FeatureCollection", "features": [\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37413233965788,40.590313487951285],[-98.37471259730057,40.59032045203848],[-98.37471509841112,40.5901317883289],[-98.3741348407684,40.590126090423354],[-98.37413233965788,40.590313487951285]]]},"properties":{"id":"Perkins Library"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3736191179045,40.59064334156154],[-98.37362033072382,40.59056689953065],[-98.37387380996378,40.59057058348595],[-98.37387866124111,40.5903256000165],[-98.3736639922197,40.59032283703991],[-98.37366520503903,40.59030073322319],[-98.37333455263524,40.590296927283184],[-98.37333901987164,40.59001629518303],[-98.37333621176148,40.59001558437107],[-98.37294307634048,40.59001416274713],[-98.37294319965034,40.59029870430257],[-98.37297039172454,40.59029870430257],[-98.37297048222555,40.590645772706125],[-98.3736191179045,40.59064334156154]]]},"properties":{"id":"Kiewit Building"}},\r
{\r
  "type": "Feature",\r
  "geometry": {\r
    "type": "Polygon",\r
    "coordinates": [\r
      [\r
        [-98.374702, 40.590876],\r
        [-98.374710, 40.590479],\r
        [-98.374496, 40.590477],\r
        [-98.374487, 40.590874],\r
        [-98.374702, 40.590876]\r
      ]\r
    ]\r
  },\r
  "properties": {\r
    "id": "Hurley-McDonald Hall",\r
    "floorplans": [\r
      {\r
        "name": "Basement",\r
        "url": "/floorplans/hastings/Hurley_McDonald_Floor0.png",\r
        "bounds": [\r
          [-98.374714, 40.590887], \r
          [-98.374499, 40.590891], \r
          [-98.374507, 40.590498], \r
          [-98.374739, 40.590506]  \r
        ]\r
      },\r
      {\r
        "name": "First Floor",\r
        "url": "/floorplans/hastings/Hurley_McDonald_Floor1.png",\r
        "bounds": [\r
          [-98.374714, 40.590887],\r
          [-98.374499, 40.590891],\r
          [-98.374507, 40.590498],\r
          [-98.374739, 40.590506]\r
        ]\r
      },\r
      {\r
        "name": "Second Floor",\r
        "url": "/floorplans/hastings/HurleyMcDonald_Floor2.png",\r
        "bounds": [\r
          [-98.374714, 40.590887],\r
          [-98.374499, 40.590891],\r
          [-98.374507, 40.590498],\r
          [-98.374739, 40.590506]\r
        ]\r
      }\r
    ]\r
  }\r
},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37353314553962,40.59087905110178],[-98.37353314553962,40.590708779882675],[-98.37343235743603,40.590709639839424],[-98.37342896008421,40.59087905110178],[-98.37353314553962,40.59087905110178]]]},"properties":{"id":"Name1"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37382750296666,40.591193020762205],[-98.37382980649612,40.59115891068626],[-98.37386551120254,40.59115891068626],[-98.37387127002614,40.590980488467004],[-98.37383211002555,40.59097961384712],[-98.37382980649612,40.59094812752329],[-98.37358217708065,40.59094462904195],[-98.37357987355122,40.5911921461451],[-98.37382750296666,40.591193020762205]]]},"properties":{"id":"Daugherty Student Engagement Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37229446140842,40.59159148756918],[-98.37223367991126,40.591483310642786],[-98.37238183481058,40.59144580926746],[-98.37226027181626,40.59117752958438],[-98.37226217123805,40.59064529412409],[-98.37211591576053,40.59063952461079],[-98.3721178151823,40.59070587398362],[-98.372022844093,40.59070731636056],[-98.372022844093,40.590756357157964],[-98.37191647647298,40.590759241909645],[-98.3719107782076,40.59114002803756],[-98.37187278977188,40.591154451711894],[-98.37211211691694,40.59164773950174],[-98.37229446140842,40.59159148756918]]]},"properties":{"id":"Morrison-Reeves Science Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37336463965526,40.591802138119164],[-98.37337046026076,40.59172257877987],[-98.37363587987099,40.59172611475252],[-98.3736393722343,40.59156345981731],[-98.37337046026076,40.59155903984072],[-98.37337395262405,40.59147948021219],[-98.37323658633453,40.591475060230046],[-98.37323891457672,40.59155903984072],[-98.373206319186,40.59155815584537],[-98.37320748330708,40.591719042807036],[-98.37323891457672,40.591719042807036],[-98.37323658633453,40.59179860215054],[-98.37336463965526,40.591802138119164]]]},"properties":{"id":"Calvin H. French Memorial Chapel"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37201576628836,40.59262743658687],[-98.37201700980901,40.592578334337375],[-98.37203317557764,40.592578334337375],[-98.37204312374293,40.59206842423039],[-98.37202695797433,40.59206747994882],[-98.37202944501566,40.59201271159418],[-98.3719846782718,40.59201271159418],[-98.37198343475114,40.592025931545955],[-98.37195607729657,40.592026875828125],[-98.37195483377592,40.5920627585407],[-98.37188768366015,40.592063702822344],[-98.3718789790155,40.592578334337375],[-98.37194364208995,40.59257927861174],[-98.37194239856929,40.59260666256263],[-98.3719809477098,40.59260666256263],[-98.37197970418916,40.59262743658687],[-98.37201576628836,40.59262743658687]]]},"properties":{"id":"Altman Hall Residency"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37345908377378,40.592428311631785],[-98.37346414649254,40.592127677901516],[-98.37348540991137,40.592127677901516],[-98.37354717508036,40.59209077136578],[-98.37348844754263,40.59203771818496],[-98.3731381074038,40.59203694929797],[-98.3731340572288,40.592211486417455],[-98.37322214853538,40.59221379307237],[-98.3732170858166,40.592428311631785],[-98.37345908377378,40.592428311631785]]]},"properties":{"id":"Scott Studio Theatre"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37378031069133,40.59233336628362],[-98.37378112606382,40.592306742401384],[-98.37381863319813,40.59230736156156],[-98.37382271006055,40.592159382117295],[-98.37378520292624,40.59215876295575],[-98.37378520292624,40.59213151984219],[-98.37363680513397,40.59212966235677],[-98.37363680513397,40.59215133301679],[-98.37359522113724,40.59215133301679],[-98.37359032890232,40.59231107652247],[-98.37363272827155,40.59231107652247],[-98.37363354364403,40.59233336628362],[-98.37378031069133,40.59233336628362]]]},"properties":{"id":"McCormick Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37472106546831,40.59285396151976],[-98.3747264832459,40.59266057179469],[-98.3747658645213,40.59266160297934],[-98.37476450654628,40.59255229731774],[-98.37474549489609,40.59255126613141],[-98.37474549489609,40.59250692510384],[-98.37467895412038,40.59250692510384],[-98.37467895412038,40.592480114235705],[-98.37464228879502,40.592479083048254],[-98.37464093082,40.59250795629086],[-98.37457846396934,40.59250795629086],[-98.37457826932462,40.59254912199468],[-98.37452034258709,40.59254809904091],[-98.37451764832021,40.59265857795722],[-98.37457018652402,40.59265755500513],[-98.37456479799032,40.59285498446884],[-98.37472106546831,40.59285396151976]]]},"properties":{"id":"Taylor Hall Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3737386139963,40.592822505804655],[-98.3737406459065,40.592765417120646],[-98.37377315646964,40.59276618858968],[-98.37377417242475,40.59266744048179],[-98.37374369377179,40.59266666901163],[-98.37374470972688,40.59260417989853],[-98.37339826903835,40.59259955107303],[-98.37339217330776,40.592818648462675],[-98.3737386139963,40.592822505804655]]]},"properties":{"id":"Wilson Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3710880581408,40.59285384881594],[-98.37108495134117,40.59269460559814],[-98.37111757273735,40.59269460559814],[-98.37111912613716,40.592625010294974],[-98.37109116494044,40.59262265113089],[-98.37109116494044,40.592462227777595],[-98.37088766956425,40.59245986860776],[-98.37088922296408,40.59250115406781],[-98.3708488345688,40.59249997448359],[-98.37084572776917,40.59285384881594],[-98.3710880581408,40.59285384881594]]]},"properties":{"id":"Batchelder General Services"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37139804641792,40.59329458891759],[-98.37139804641792,40.59319899088562],[-98.37129990788338,40.59319823814465],[-98.3712969339884,40.59329308343783],[-98.37139804641792,40.59329458891759]]]},"properties":{"id":"Campus Safety"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37252975651616,40.593156827790594],[-98.37252881637454,40.59312398858383],[-98.37250813325893,40.59312327468785],[-98.37251095368379,40.59305259894826],[-98.37230600281096,40.59304902946449],[-98.37230882323581,40.59292195571781],[-98.37217062241788,40.59292195571781],[-98.37217062241788,40.593047601670925],[-98.37191960460574,40.593045459980516],[-98.37191866446413,40.59312184689587],[-98.37189234049882,40.59312184689587],[-98.37189328064044,40.593152544416704],[-98.3719572102705,40.593152544416704],[-98.3719572102705,40.59316468064199],[-98.37217062241788,40.59316468064199],[-98.37217156255952,40.59315325831238],[-98.37224959431384,40.593155399999326],[-98.37224865417222,40.59316682232858],[-98.37246206631963,40.59316967791059],[-98.37246394660288,40.59315468610369],[-98.37252975651616,40.593156827790594]]]},"properties":{"id":"Bronc Hall Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37189410131195,40.59411717917972],[-98.3718924278385,40.594065714506016],[-98.37190665236291,40.594065714506016],[-98.37190748909967,40.593829357718064],[-98.37189410131195,40.59382999308689],[-98.37189661152215,40.59378170503864],[-98.37176022343498,40.59378043430005],[-98.37175938669823,40.59382745161154],[-98.37174683564726,40.59382745161154],[-98.3717451621738,40.5940663498726],[-98.37175603975129,40.5940663498726],[-98.37175603975129,40.5941152730814],[-98.37189410131195,40.59411717917972]]]},"properties":{"id":"The 1882 Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37297358496218,40.594287236848594],[-98.37302656725574,40.594179361354826],[-98.37318062346203,40.59422593696438],[-98.37321057883548,40.59415661511511],[-98.37328903338498,40.594179361354826],[-98.3734202664496,40.59391832071013],[-98.37334181190009,40.59389665754029],[-98.37335892925634,40.5938717448863],[-98.37293670113542,40.593748264638194],[-98.37292243667187,40.59377317733819],[-98.37255726640511,40.593660528533846],[-98.37249307631916,40.59376559521309],[-98.37264713252546,40.593813254270884],[-98.37260576558117,40.59390857228456],[-98.37245313582125,40.59386199645395],[-98.37236130461655,40.5940333213648],[-98.37244344372661,40.594057941663856],[-98.37243407698598,40.59407927924903],[-98.3725123372465,40.594103359502135],[-98.37250152675315,40.59412524968894],[-98.37257936230517,40.59414878163177],[-98.37257071391052,40.594169030041066],[-98.37297358496218,40.594287236848594]]]},"properties":{"id":"Hazelrigg Student Union"}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37003093644454,40.59489319890186],[-98.37002539427893,40.594554427576305],[-98.36991824574359,40.594554427576305],[-98.36991824574359,40.594491302294855],[-98.36939635848097,40.59449551064881],[-98.36939635848097,40.59456985819158],[-98.36930768383104,40.59456915680006],[-98.36931045491386,40.5949002127828],[-98.37003093644454,40.59489319890186]]]},"properties":{"id":"Physical Fitness Facility"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3707569741431,40.595997812186724],[-98.3707609796432,40.59595345634213],[-98.37093925863765,40.59595608489197],[-98.37093579690959,40.59587065696967],[-98.37126985366618,40.59587459979926],[-98.37126985366618,40.595589401192704],[-98.37099983887846,40.59558677262847],[-98.37099983887846,40.595392258587665],[-98.36994747355205,40.59538963001566],[-98.3699455880793,40.59587362637473],[-98.3702990362079,40.59587224653109],[-98.37030085342192,40.59595296733678],[-98.37043169283199,40.59595227741577],[-98.37042896701095,40.595997812186724],[-98.3707569741431,40.595997812186724]]]},"properties":{"id":"Lynn Farrell Arena/Fleharty Educational Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37211946976164,40.595036751142146],[-98.37209853033835,40.595007397045535],[-98.37215327445425,40.59498984579718],[-98.37194527282195,40.59469129454744],[-98.37194712982472,40.594305952303756],[-98.37169736008775,40.5943052575816],[-98.37169708368509,40.594470035453604],[-98.37176513394347,40.59446865751005],[-98.37176604128025,40.5945802708457],[-98.37153514181085,40.59467504115343],[-98.37155328864164,40.59470053315958],[-98.37153877117701,40.59470397802453],[-98.37157052813086,40.594785965758],[-98.37158504559547,40.59478114295293],[-98.37158595293702,40.59481421360927],[-98.37186178476472,40.594816280524746],[-98.37186178476472,40.59482661510118],[-98.3718844683032,40.59482799304458],[-98.3718826536201,40.59485210704955],[-98.37185180400779,40.59486313059177],[-98.37190170779242,40.59493685048371],[-98.3718871903278,40.594941673277546],[-98.37198881258011,40.59508980177594],[-98.37211946976164,40.595036751142146]]]},"properties":{"id":"Hayes M. Fuhr Hall of Music"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37538555821986,40.59328018799004],[-98.37538724870973,40.59309726484104],[-98.37520974727416,40.59309405565852],[-98.37521059251908,40.5931608066232],[-98.37519875909004,40.5931608066232],[-98.37519537811033,40.59327890432057],[-98.37538555821986,40.59328018799004]]]},"properties":{"id":"The Stone Health Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37471015347589,40.59324279822121],[-98.37471437942709,40.592969393604285],[-98.37457407784693,40.5929681100119],[-98.37457069708597,40.59313433502105],[-98.37436278028643,40.59313369322644],[-98.3743602447157,40.59324023104691],[-98.37471015347589,40.59324279822121]]]},"properties":{"id":"Babcock Hall Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37464990421633,40.59375608706591],[-98.37465352180178,40.593639797917334],[-98.37456187630376,40.59363888225395],[-98.3745570528565,40.59375608706591],[-98.37464990421633,40.59375608706591]]]},"properties":{"id":"MacKay House"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3742242349953,40.593824761664976],[-98.3742242349953,40.593780809929704],[-98.37426523429703,40.593780809929704],[-98.37427005774431,40.593658111182506],[-98.37412414846457,40.59365627985621],[-98.37412173674093,40.593824761664976],[-98.3742242349953,40.593824761664976]]]},"properties":{"id":"905 N Elm Ave"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37328303907076,40.59576922084294],[-98.37317465862661,40.595267009011295],[-98.37290194299486,40.59530583646519],[-98.37292020520233,40.595377020072085],[-98.3728508088139,40.595386264690795],[-98.37291395234293,40.595698179498136],[-98.37300321983061,40.59568449262486],[-98.37301866997268,40.59575031994207],[-98.37316630466383,40.59573076728035],[-98.37316973802872,40.59576335504669],[-98.37323926366815,40.59575227520792],[-98.37324527205675,40.59577573839374],[-98.37328303907076,40.59576922084294]]]},"properties":{"id":"Gray Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37355669887391,40.59683971651677],[-98.37346882100307,40.59659623606328],[-98.37349312764819,40.59659197692209],[-98.3734622769063,40.596499695463045],[-98.37332952522907,40.596526670056555],[-98.37330428371297,40.59644929553547],[-98.37297801374571,40.59651176304569],[-98.37254797310115,40.59649259688399],[-98.37254516848826,40.596542996778915],[-98.37256106129469,40.59659481634959],[-98.37255171258502,40.596682128686005],[-98.37264706942358,40.59668425825375],[-98.37264426481069,40.596737497425636],[-98.3727667329073,40.59674175655755],[-98.37276766777826,40.59669277652411],[-98.37282376003624,40.596682128686005],[-98.37300979935856,40.59668851738907],[-98.37300512500373,40.596779378877706],[-98.37291163790708,40.59679499568363],[-98.3729247261006,40.59683758695397],[-98.37296586042312,40.5968361672454],[-98.37296586042312,40.596802094230576],[-98.37299110193923,40.596887986588825],[-98.37307617519718,40.59686882053498],[-98.37309393774554,40.596929158093324],[-98.37355669887391,40.59683971651677]]]},"properties":{"id":"Jackson Dinsdale Art Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36946922209306,40.59663009808219],[-98.36946309192157,40.59646951080968],[-98.36938339969201,40.596471838164206],[-98.36938646477778,40.59621582868018],[-98.36946922209306,40.59621582868018],[-98.36946309192157,40.59595516347105],[-98.36938952986353,40.59595516347105],[-98.36938646477778,40.59568984248238],[-98.36946615700731,40.59568984248238],[-98.36946309192157,40.59554321727376],[-98.36923321049021,40.595536235112945],[-98.36923321049021,40.596632425431125],[-98.36946922209306,40.59663009808219]]]},"properties":{"id":"Lloyd Wilson Field/Stadium"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36635224661157,40.5952162806942],[-98.36635339463838,40.594929482162954],[-98.36611345703568,40.594929482162954],[-98.36611116098207,40.595215408968],[-98.36635224661157,40.5952162806942]]]},"properties":{"id":"Bronco Village Apartments 3"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36594778233456,40.59521075896037],[-98.36594433215241,40.595025407005174],[-98.36560448920957,40.59502671691478],[-98.36560621430067,40.595043090782795],[-98.36556481211473,40.595043090782795],[-98.36556912484242,40.59519242027393],[-98.36560362666404,40.595191765320756],[-98.36560362666404,40.59521337877231],[-98.36594778233456,40.59521075896037]]]},"properties":{"id":"Bronco Village Apartments 4"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36581753737377,40.59488116136897],[-98.36582035820989,40.594594140268],[-98.36557917672252,40.594593069291435],[-98.36557776630447,40.59489829691811],[-98.36562431010026,40.59489936788978],[-98.36562431010026,40.594879019425015],[-98.36581753737377,40.59488116136897]]]},"properties":{"id":"Bronco Village Apartments 1"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36636763296093,40.59478975582371],[-98.3663640756504,40.59460499524451],[-98.36598486634739,40.594606075717216],[-98.36598842365792,40.59476814642561],[-98.36602186237695,40.59476868666066],[-98.36602186237695,40.59479029605858],[-98.36636763296093,40.59478975582371]]]},"properties":{"id":"Bronco Village Apartments 2"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36542716760385,40.59439543172675],[-98.36542432429836,40.59422414915383],[-98.36538736132702,40.594225588505026],[-98.36538830909551,40.59420543758567],[-98.36508217987125,40.59420543758567],[-98.36508407540826,40.59422630818061],[-98.3650442691314,40.59422630818061],[-98.3650433213629,40.59437815955442],[-98.36508217987125,40.59437815955442],[-98.36508312763975,40.59439615140052],[-98.36542716760385,40.59439543172675]]]},"properties":{"id":"Bronco Village Apartments 5"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36597687333165,40.594175930871394],[-98.36597687333165,40.59398737546289],[-98.3655949226277,40.59398881481917],[-98.36559302709068,40.594155060260746],[-98.36563188559904,40.5941543405844],[-98.36563283336753,40.59417521119527],[-98.36597687333165,40.594175930871394]]]},"properties":{"id":"Bronco Village Apartments 6"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3646686039858,40.595412581009995],[-98.36494650785933,40.595223709584495],[-98.36492058096735,40.59520402262996],[-98.36498701862807,40.595156035653986],[-98.36490680730597,40.595086515999505],[-98.36483631856838,40.59513450302537],[-98.36481120189175,40.59511481604457],[-98.36470911475455,40.595181874799174],[-98.36465645075519,40.59513327258924],[-98.36458110072535,40.595182490016796],[-98.36463295450933,40.59522801610503],[-98.3645316775875,40.59529938126202],[-98.3646686039858,40.595412581009995]]]},"properties":{"id":"Barrett Alumni Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37338949046577,40.58959597891962],[-98.3733933780237,40.58945132240717],[-98.37327675128608,40.589449551101],[-98.37327286372816,40.58959361718315],[-98.37338949046577,40.58959597891962]]]},"properties":{"id":"706 E. 7th St. Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37321144031304,40.58958535110486],[-98.37321299533619,40.589450141536396],[-98.37309792362176,40.5894489606656],[-98.37309559108701,40.58958535110486],[-98.37321144031304,40.58958535110486]]]},"properties":{"id":"710 E. 7th St. Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37301550739384,40.58959538848551],[-98.3730225049981,40.58935803355154],[-98.37315079440947,40.58935921442396],[-98.37315312694422,40.58927655330535],[-98.37305827053098,40.58927537243149],[-98.37305749301939,40.58930607514516],[-98.37299218204632,40.58930489427181],[-98.37299140453474,40.5893633474772],[-98.37294008877019,40.5893633474772],[-98.37294164379337,40.58939582145811],[-98.37290976581842,40.58939523102224],[-98.3729058782605,40.58959538848551],[-98.37301550739384,40.58959538848551]]]},"properties":{"id":"714 E. 7th St. Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37481677520717,40.59378243356543],[-98.3748159702016,40.59364459103049],[-98.37470492415694,40.59364364015712],[-98.37470219608254,40.59378243356543],[-98.37481677520717,40.59378243356543]]]},"properties":{"id":"607 E 9th St"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37505232877834,40.59378603329276],[-98.37505232877834,40.59363389370436],[-98.3749411932886,40.59363270511246],[-98.37493806271144,40.59378603329276],[-98.37505232877834,40.59378603329276]]]},"properties":{"id":"603 E 9th St"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37020808429642,40.59325096070355],[-98.3702087922692,40.59304678270344],[-98.37012640522326,40.59305025829369],[-98.37007453189801,40.59300275854457],[-98.3700699548399,40.59284403962595],[-98.36997383661961,40.59284403962595],[-98.36996925956151,40.59300275854457],[-98.37007148052594,40.59305373388376],[-98.37007497105584,40.59325096070355],[-98.37020808429642,40.59325096070355]]]},"properties":{"id":"906 E 9th St"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3713716620568,40.59216760861196],[-98.3713716620568,40.59208501885758],[-98.37123658640381,40.592083686763935],[-98.37123658640381,40.592170272795876],[-98.3713716620568,40.59216760861196]]]},"properties":{"id":"812 N Ash Ave"}}\r
]}
`,FV=`{"type":"GeometryCollection", "geometries": [\r
{"type":"Polygon","coordinates":[[[-98.3702723467576,40.59295246060802],[-98.3712898200761,40.59296962250515],[-98.37127145248702,40.593452202532475],[-98.3693821617939,40.59343919245249],[-98.3693821617939,40.59396210621867],[-98.36898697694681,40.59395690670241],[-98.36897317608825,40.595313897438444],[-98.36666104991127,40.59530626415921],[-98.3666645004967,40.59434137689304],[-98.3660775631237,40.594328458560554],[-98.3660903226318,40.59391184099969],[-98.36552890427502,40.593908611396046],[-98.3655251986316,40.59414249211982],[-98.36432525734347,40.59413791286647],[-98.36427367897022,40.59707709495426],[-98.37377329389933,40.59709097965043],[-98.37386191086847,40.59401359006412],[-98.37508078915154,40.594020829208134],[-98.37509913072566,40.59343618356128],[-98.37541607762186,40.59342916474601],[-98.37541607762186,40.59304686495786],[-98.37491595389913,40.593044333163895],[-98.37497941341485,40.58982081072618],[-98.37347119813148,40.58981164082747],[-98.373477248548,40.58922812309826],[-98.37287220689669,40.589232717745936],[-98.37286010606364,40.58981164082747],[-98.37161977067842,40.58981164082747],[-98.37159980641273,40.59071814140597],[-98.37034264550859,40.590714592488666],[-98.37035943903622,40.59162321748957],[-98.37107540475405,40.59163250297191],[-98.37106656585733,40.592037456704084],[-98.37065419418758,40.59203614756078],[-98.37065535506281,40.59209797250316],[-98.37051258408789,40.59209551837214],[-98.37051409247337,40.59219975052995],[-98.37028934303831,40.59219975052995],[-98.3702875945045,40.59227459272085],[-98.37028731105269,40.59253351783216],[-98.37009609918391,40.59252977623261],[-98.36990069493494,40.59252314685871],[-98.36990818515268,40.5933535522459],[-98.37026022538576,40.59335639608224],[-98.3702723467576,40.59295246060802]]]}\r
]}`,OV='{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"id":"Kiewit_MR_SEcorner"},"geometry":{"coordinates":[[[-98.37163503619607,40.59063976074893],[-98.37216212045448,40.590601318073],[-98.37257008962634,40.59062619274795],[-98.37289765611462,40.59063523808223],[-98.37286192158837,40.59039101362893],[-98.37285894371118,40.590234980871685],[-98.37290658974618,40.58994326648016],[-98.37282320918538,40.5896877326733],[-98.3716618370903,40.58968320994222],[-98.37163503619607,40.59063976074893]]],"type":"Polygon"},"id":0},{"type":"Feature","properties":{"id":"Daughtery_MR_Chapel"},"geometry":{"coordinates":[[[-98.37352702156389,40.5914658384647],[-98.37355230279564,40.59090910098766],[-98.37337280605138,40.590895662440005],[-98.37336774980503,40.59069984328954],[-98.37309471250403,40.590674885905486],[-98.3723160505715,40.590648008712265],[-98.37231099432515,40.591164432888604],[-98.3724626817145,40.5914312824801],[-98.37242728799043,40.591569506310634],[-98.37239189426599,40.5917653229138],[-98.37310482499674,40.5917787612872],[-98.37321100616931,40.591446640697654],[-98.37352702156389,40.5914658384647]]],"type":"Polygon"},"id":1},{"type":"Feature","properties":{"id":"801 Block"},"geometry":{"coordinates":[[[-98.37164381749396,40.591608632859675],[-98.37164919913825,40.59068913232153],[-98.37024189916244,40.59066052543514],[-98.37033069629301,40.591596372935584],[-98.37164381749396,40.591608632859675]]],"type":"Polygon"},"id":2},{"type":"Feature","properties":{"id":"South of Arboretum"},"geometry":{"coordinates":[[[-98.37476627281052,40.5910136742458],[-98.37477964615867,40.59092227590415],[-98.37446537247885,40.590915505651594],[-98.37446537247885,40.59037726838508],[-98.37394604079577,40.590356957462575],[-98.37393266744795,40.59120662589234],[-98.37434278345529,40.591032292413445],[-98.37476627281052,40.5910136742458]]],"type":"Polygon"},"id":3},{"type":"Feature","properties":{"id":"Arboretum"},"geometry":{"coordinates":[[[-98.37489112509611,40.59219972777811],[-98.37490794950106,40.591069061838084],[-98.37470325257557,40.59106054450788],[-98.37460230614677,40.59105628584243],[-98.37443686616615,40.59106693250561],[-98.37431068312993,40.59109035515871],[-98.37407514146206,40.591215985611285],[-98.3739938235057,40.59130328799105],[-98.37399101943821,40.59197189267704],[-98.37412561467688,40.59209965077304],[-98.37435554820935,40.59219333988858],[-98.37489112509611,40.59219972777811]]],"type":"Polygon"},"id":4},{"type":"Feature","properties":{"id":"North of Arboretum"},"geometry":{"coordinates":[[[-98.37431231320465,40.59336193656449],[-98.37433594448096,40.593078415557756],[-98.37448482150404,40.59306047115021],[-98.37451081590508,40.59293306571445],[-98.37449191088317,40.59276797661897],[-98.37448245837369,40.59257776476619],[-98.37449900026525,40.592471891896395],[-98.37483456434931,40.5924557417828],[-98.37483929060404,40.59226194011691],[-98.37479202805706,40.592233228710995],[-98.37449191088317,40.59222963978439],[-98.37424378251136,40.59221348961228],[-98.3740381904318,40.59213453315965],[-98.37391767093679,40.59193355267803],[-98.37388222402663,40.59336014213147],[-98.37431231320465,40.59336193656449]]],"type":"Polygon"},"id":5},{"type":"Feature","properties":{"id":"PickleBall Cts"},"geometry":{"coordinates":[[[-98.37301888192918,40.592758212922234],[-98.37305404173038,40.59270862956615],[-98.3730665988024,40.59181802995374],[-98.3720670558787,40.591791330852686],[-98.3720544988067,40.59201445872537],[-98.3720821243651,40.59211553349891],[-98.3720896586079,40.59233866028978],[-98.37207961295069,40.5925408087046],[-98.3720544988067,40.592636161518556],[-98.37203691890592,40.592884078198324],[-98.37301888192918,40.592758212922234]]],"type":"Polygon"},"id":6},{"type":"Feature","properties":{"id":"Steinhart Plz"},"geometry":{"coordinates":[[[-98.37375767305471,40.59380937954694],[-98.37381334284255,40.59285824408735],[-98.37336179901064,40.592860592586646],[-98.37332777858475,40.59276195554597],[-98.37319478964805,40.59273847051469],[-98.3726349990074,40.59282771358974],[-98.37261334964592,40.59363559284384],[-98.37317004752059,40.59373422859568],[-98.37375767305471,40.59380937954694]]],"type":"Polygon"},"id":7},{"type":"Feature","properties":{"id":"SE of Union"},"geometry":{"coordinates":[[[-98.37251903104057,40.59362476563635],[-98.37254773304886,40.593196135370334],[-98.37197369288644,40.59318887042687],[-98.37166753813338,40.593159810645574],[-98.37171059114546,40.59367925233752],[-98.37217939061152,40.593824549991155],[-98.37251903104057,40.59362476563635]]],"type":"Polygon"},"id":8},{"type":"Feature","properties":{"id":"Heartwell"},"geometry":{"coordinates":[[[-98.37407601600557,40.595375081069506],[-98.37397063105409,40.594673938335205],[-98.37389033775756,40.594109970364855],[-98.37308740479394,40.59428906881678],[-98.37294689152506,40.59433098540674],[-98.37263575500172,40.5942509628037],[-98.37250527839498,40.59418237192435],[-98.37237982011926,40.594094727921146],[-98.37199842696151,40.594033758112204],[-98.37202351861642,40.594334796004546],[-98.37202853694748,40.59470823353095],[-98.37212890356825,40.594822550724416],[-98.37225436184359,40.59499021558764],[-98.37219916020231,40.5950397528529],[-98.37206366526487,40.595108342852654],[-98.37216403188529,40.59528362808683],[-98.3728164149183,40.595218848814255],[-98.37322289973137,40.595119774511886],[-98.37330821135897,40.5956418182227],[-98.37353905458613,40.595710407604884],[-98.37407601600557,40.595375081069506]]],"type":"Polygon"},"id":9},{"type":"Feature","properties":{"id":"Heartwell North"},"geometry":{"coordinates":[[[-98.37364723125614,40.59642709268644],[-98.37372717366044,40.595729025036405],[-98.37348068458046,40.595744200497705],[-98.37331413790477,40.59580996078944],[-98.37317423869737,40.5958504286296],[-98.37308763442599,40.59580996078944],[-98.37296772081977,40.595789726860176],[-98.37289444028254,40.595739142010984],[-98.37274121734099,40.59567844014052],[-98.37272123173979,40.59534963738679],[-98.37165533301602,40.59529905220464],[-98.37130891593102,40.59546598316149],[-98.3713555489995,40.59585548710561],[-98.37149803178302,40.59612724032186],[-98.37170454966062,40.59618288333169],[-98.37166457845869,40.59672413564374],[-98.37141142751166,40.59705293163782],[-98.37241070756525,40.596997289352856],[-98.37251063557076,40.596410513342704],[-98.37364723125614,40.59642709268644]]],"type":"Polygon"},"id":10},{"type":"Feature","properties":{"id":"Athletic Parking lot"},"geometry":{"coordinates":[[[-98.37135713636462,40.59703881753842],[-98.37159398256752,40.59675342106121],[-98.37164547087292,40.59621781068529],[-98.37141377350018,40.59613570944552],[-98.37124901092368,40.59594804909017],[-98.37084225331375,40.5960575176949],[-98.37024498897541,40.59604578892433],[-98.36962198048437,40.5960184217856],[-98.36954474802666,40.596280363943634],[-98.3695498968572,40.59707400332135],[-98.37135713636462,40.59703881753842]]],"type":"Polygon"},"id":11},{"type":"Feature","properties":{"id":"Fle+PFF"},"geometry":{"coordinates":[[[-98.36986465261369,40.595478850474535],[-98.37011842595624,40.594928288639665],[-98.36931682444536,40.59493746470747],[-98.36901874147125,40.59488240828182],[-98.36905499480616,40.59548190913873],[-98.36986465261369,40.595478850474535]]],"type":"Polygon"},"id":12},{"type":"Feature","properties":{"id":"Football field"},"geometry":{"coordinates":[[[-98.36913306842247,40.59687166324542],[-98.36912125095233,40.595575039769074],[-98.36904443739681,40.59551222692079],[-98.36897944131144,40.59530135478337],[-98.36831766298764,40.59536416782973],[-98.36827630184256,40.596880636330724],[-98.36913306842247,40.59687166324542]]],"type":"Polygon"},"id":13},{"type":"Feature","properties":{"id":"Practice field"},"geometry":{"coordinates":[[[-98.36817488651938,40.596967941434826],[-98.3682206392564,40.5952830148853],[-98.36668220346046,40.59530907080216],[-98.36580718237055,40.59530907080216],[-98.36588153056778,40.59700268176945],[-98.36817488651938,40.596967941434826]]],"type":"Polygon"},"id":14},{"type":"Feature","properties":{"id":"track"},"geometry":{"coordinates":[[[-98.3658412178937,40.597004912936484],[-98.36577780942038,40.595387736092704],[-98.36551671491901,40.59541889048063],[-98.3653525983754,40.59530276950733],[-98.36468494243638,40.59548119921246],[-98.36468494243638,40.59674435461838],[-98.36463272353635,40.59700491285406],[-98.3658412178937,40.597004912936484]]],"type":"Polygon"},"id":15},{"type":"Feature","properties":{"id":"BVH outdoor"},"geometry":{"coordinates":[[[-98.36606218586846,40.594981336403094],[-98.36621039516318,40.5948299194323],[-98.36602176515188,40.59482378089922],[-98.36595709200517,40.59480741147544],[-98.36594361843285,40.59475011845865],[-98.36585738757081,40.59474807227855],[-98.36586277699975,40.594981336403094],[-98.36606218586846,40.594981336403094]]],"type":"Polygon"},"id":16},{"type":"Feature","properties":{"id":"BVH south outdoor"},"geometry":{"coordinates":[[[-98.36605957398896,40.59455423531671],[-98.36605957398896,40.59420722418943],[-98.36571163584682,40.59422694077912],[-98.36549871847637,40.59418750759389],[-98.36547794604984,40.59433735357291],[-98.36543120809051,40.59455817861465],[-98.36605957398896,40.59455423531671]]],"type":"Polygon"},"id":17}]}',BV=`{"type":"FeatureCollection", "features": [\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5732546949417,39.033957896346706],[-94.57326522382158,39.033796212560006],[-94.5729226302682,39.033781742786736],[-94.57291453112981,39.03394783044083],[-94.5732546949417,39.033957896346706]]]},"properties":{"id":"Physical Plant Operations"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57330618126248,39.03329184109743],[-94.57333069079144,39.032868879640596],[-94.57332112401924,39.03286702180975],[-94.57332590740536,39.03279828203385],[-94.57289061927166,39.032835438677765],[-94.57286046661933,39.03328233695542],[-94.57330618126248,39.03329184109743]]]},"properties":{"id":"St. Luke's Urgent Care"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57151501542803,39.03292423985276],[-94.57151293405649,39.032993004805604],[-94.57184717798721,39.03300418514015],[-94.57184478733176,39.03304318257621],[-94.57179856799333,39.03305618171678],[-94.57179298979729,39.03312055837771],[-94.571829646514,39.033121177383784],[-94.57181849012196,39.033266024655184],[-94.5720280709153,39.03327654773599],[-94.57204321173309,39.033054943703505],[-94.5720575556657,39.03305556271014],[-94.5720631338617,39.03295156951771],[-94.572026477145,39.032949093487446],[-94.57203205534103,39.03290576294391],[-94.57191730388003,39.03289895385609],[-94.57191252256916,39.0329466174571],[-94.57185434995351,39.03294537944191],[-94.57185275618323,39.03297261577139],[-94.57165911309279,39.032966425697424],[-94.57166230063338,39.032929904250025],[-94.57151501542803,39.03292423985276]]]},"properties":{"id":"St. Peter Claver Jesuit Community"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57320143143617,39.03248280295288],[-94.5732236476623,39.03206766728228],[-94.57287806192237,39.03205807982458],[-94.57285214299189,39.0324693805906],[-94.57320143143617,39.03248280295288]]]},"properties":{"id":"Greenlease Library"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57258061133909,39.03244157711775],[-94.57259171945215,39.03223353009446],[-94.57203878226827,39.03221147899157],[-94.57202520568563,39.03242240230252],[-94.57258061133909,39.03244157711775]]]},"properties":{"id":"Conway Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5729983573256,39.031851550588144],[-94.57299756184071,39.031777457537544],[-94.57321564931763,39.03178334435931],[-94.57323249004943,39.03143209646873],[-94.57296205948676,39.031423909721845],[-94.57296447934267,39.03135905846342],[-94.57280960856365,39.03135529896836],[-94.5728071887077,39.03138819454341],[-94.57269708526324,39.03138631479668],[-94.57269708526324,39.03142109010315],[-94.57267409663196,39.03142015023023],[-94.572672886704,39.03149158053676],[-94.57274790223761,39.0314934602807],[-94.57273580295798,39.03168519389932],[-94.5727950894281,39.031686133768716],[-94.57279387950013,39.031724668403285],[-94.5728701049617,39.03172748800987],[-94.57286526524985,39.03184873098651],[-94.5729983573256,39.031851550588144]]]},"properties":{"id":"Sedgewick Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57326241323847,39.03143368161774],[-94.57327626990363,39.03124423732891],[-94.5730261570974,39.03123347343362],[-94.57301275849636,39.0314254445335],[-94.57326241323847,39.03143368161774]]]},"properties":{"id":"Greenlease Gallery"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.573095990435,39.03111733680814],[-94.57308496704151,39.031231510274026],[-94.57308922652759,39.0312361877],[-94.57325910712441,39.03124349870881],[-94.57328155089225,39.03098889143854],[-94.57264954299825,39.03095820723238],[-94.57262565897899,39.031273611693024],[-94.57279744019438,39.0312828882735],[-94.57281213805237,39.03110377869681],[-94.573095990435,39.03111733680814]]]},"properties":{"id":"Van Ackeren Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57168446809365,39.032022569107156],[-94.57169184016705,39.03180937961588],[-94.57179868570213,39.031816109120946],[-94.57180734885364,39.0318116227843],[-94.57183045059094,39.03127774669104],[-94.57147526137969,39.031266530763475],[-94.57148969996551,39.030961456851074],[-94.57133665095579,39.03095921365567],[-94.57130690259424,39.031697853704856],[-94.57146028857838,39.031697853704856],[-94.57144848965653,39.032017331773794],[-94.57168446809365,39.032022569107156]]]},"properties":{"id":"Massman Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57102622899816,39.03227668523504],[-94.57041136868395,39.032248511124756],[-94.57038028024108,39.03258659970685],[-94.57099514055531,39.03261611529995],[-94.57102622899816,39.03227668523504]]]},"properties":{"id":"Mason-Halpin Fieldhouse"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57102622899816,39.03227668523504],[-94.5710435003553,39.03201775132257],[-94.57017475109112,39.0319855522205],[-94.57016266114111,39.03223509487781],[-94.57102622899816,39.03227668523504]]]},"properties":{"id":"Convocation Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57003078591215,39.032220762006155],[-94.57011418121974,39.032159390693046],[-94.57010430545964,39.032152571654976],[-94.57011857044647,39.0321355240569],[-94.57007906740601,39.03210654313074],[-94.57011857044647,39.03207244790827],[-94.57010211084628,39.03205880981468],[-94.57012515428654,39.03204005743169],[-94.57007687279265,39.03200340503239],[-94.57005492665907,39.03201960028093],[-94.57003627244553,39.03200425741399],[-94.56983546532327,39.03214575261624],[-94.56986180068357,39.03216620973048],[-94.56983985454998,39.03218837159754],[-94.56987935759042,39.03221479535305],[-94.56989910911065,39.032200304907704],[-94.56992434716427,39.03221905724818],[-94.56996714212474,39.03218496207999],[-94.57000993708525,39.032220762006155],[-94.57001981284535,39.03221309059493],[-94.57003078591215,39.032220762006155]]]},"properties":{"id":"Student Activities Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5700079120054,39.03251153999033],[-94.57007391952787,39.03239788275361],[-94.56962616850038,39.03226029743301],[-94.56963937000486,39.03224064236535],[-94.56956236122863,39.03221756901809],[-94.569545859348,39.0322355149555],[-94.56911791057726,39.032091092758456],[-94.56905630355628,39.03220047764487],[-94.56942814593293,39.03231926260322],[-94.56943254643443,39.03240899211564],[-94.56956566160477,39.032447447586094],[-94.56962836875111,39.03238335512371],[-94.5700079120054,39.03251153999033]]]},"properties":{"id":"Corcoran Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.56854799775466,39.03168092891154],[-94.56855120851591,39.03148472512313],[-94.5683842489311,39.03148306237683],[-94.56838210842359,39.031552066315285],[-94.56833501725863,39.03155040357058],[-94.5683318064974,39.03160527412545],[-94.56837889766234,39.031604442753725],[-94.5683756869011,39.03167843479901],[-94.56854799775466,39.03168092891154]]]},"properties":{"id":"Town House Village"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5694451877561,39.031137040617324],[-94.56944931800915,39.031079289457125],[-94.56924142860419,39.03107180319216],[-94.56923729835111,39.031130623824076],[-94.5694451877561,39.031137040617324]]]},"properties":{"id":"The Birdhouse"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57023544284519,39.03101832984793],[-94.57024370335134,39.03090603569337],[-94.56974669623084,39.03088999365672],[-94.56974531947982,39.03083117282454],[-94.56960626762614,39.03082582547373],[-94.56960351412411,39.03088250737171],[-94.56911752101182,39.03087074320795],[-94.56911201400773,39.03097982901504],[-94.57023544284519,39.03101832984793]]]},"properties":{"id":"Xavier-Loyola Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57110683934017,39.030625006944845],[-94.5711103812666,39.03058465303729],[-94.57115524566798,39.03058648730631],[-94.57116351016298,39.030412231536324],[-94.57103836209599,39.030407645852364],[-94.57103836209599,39.03042507144983],[-94.57075146605564,39.030415900083284],[-94.5707502854135,39.03054338197162],[-94.57072076935995,39.03054429910667],[-94.57071722743352,39.03061583560425],[-94.57110683934017,39.030625006944845]]]},"properties":{"id":"Magis Activity Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57198788526269,39.03047484462258],[-94.57200861727132,39.03025032364125],[-94.57210130154519,39.03026832323989],[-94.57212569214357,39.03018021989759],[-94.57206837423735,39.02993485624719],[-94.57194154312575,39.02995664533168],[-94.57194032359583,39.029975592356216],[-94.57188544474947,39.02997275030286],[-94.57188544474947,39.029948119168985],[-94.57170739338125,39.029948119168985],[-94.57155373261142,39.029932961543864],[-94.57155373261142,39.02994906652044],[-94.57146348739738,39.0299414877084],[-94.57145373115803,39.03010916873508],[-94.57150129282489,39.03011201078295],[-94.57148665846586,39.03031758527588],[-94.57179885812519,39.03032705874041],[-94.5717927604756,39.030445476939825],[-94.57185373697156,39.03044831897417],[-94.57185495650148,39.030468213211414],[-94.57198788526269,39.03047484462258]]]},"properties":{"id":"Pedro Arrupe, S.J., Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57284047860178,39.0302797832297],[-94.57286427952926,39.029831426558175],[-94.5727080859427,39.02982911543394],[-94.572694697921,39.03005444969102],[-94.5725905688633,39.03005329413256],[-94.57258164351548,39.030234716579436],[-94.57268279745728,39.030237027690404],[-94.57267982234133,39.03027631656532],[-94.57284047860178,39.0302797832297]]]},"properties":{"id":"McGee Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5730942108803,39.03066445893382],[-94.57317199672308,39.030664613464],[-94.57325985414333,39.030643791903515],[-94.57335366799886,39.03057901367613],[-94.57337898284875,39.03051307863372],[-94.57340366198356,39.02995448923646],[-94.57335443753462,39.029949304371044],[-94.57335193459656,39.029918843279034],[-94.57318507205777,39.02991495462804],[-94.57317172305467,39.03002707731239],[-94.57310581235186,39.03002837352735],[-94.5730700106048,39.030426554038584],[-94.57268280619707,39.03041812687501],[-94.57267696475127,39.03046998632717],[-94.57261938478547,39.03048035821303],[-94.57261604681642,39.03052508695338],[-94.57264692302996,39.03053999652721],[-94.57264692302996,39.030585373471666],[-94.57268864764288,39.03067936847824],[-94.5730858659577,39.03068714736974],[-94.5730942108803,39.03066445893382]]]},"properties":{"id":"St. Ignatius Science Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57292884511348,39.02885017929442],[-94.57292884511348,39.02878607947923],[-94.57289583924593,39.02878607947923],[-94.57289790211264,39.02876043953688],[-94.57268542684032,39.02875242705299],[-94.57268336397358,39.02881973188946],[-94.57272049557459,39.02881973188946],[-94.57271843270787,39.02884697430505],[-94.57292884511348,39.02885017929442]]]},"properties":{"id":"University Marketing and Communication"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57283326901032,39.028729445595104],[-94.57284341632814,39.02854814224998],[-94.57270405983009,39.028544463626574],[-94.57270270685437,39.028568111916584],[-94.57268511817016,39.028568111916584],[-94.57268308870658,39.028620663643835],[-94.5727020303665,39.028622240195055],[-94.57270000090294,39.02865902638007],[-94.57268241221873,39.02865902638007],[-94.57268173573087,39.02870684839195],[-94.5727006773908,39.028707899424816],[-94.5726993244151,39.028725766981125],[-94.57283326901032,39.028729445595104]]]},"properties":{"id":"Rock Row Housing N"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57284691787102,39.02851897602392],[-94.57285908326953,39.0283383666503],[-94.57271782947576,39.02833311637091],[-94.57271715362029,39.02835674262511],[-94.5726975538116,39.02835726765288],[-94.57269417453423,39.02840924538392],[-94.57271512605388,39.02840924538392],[-94.572712422632,39.02844599729188],[-94.5726975538116,39.02844809740033],[-94.5726948503897,39.0284948247972],[-94.572712422632,39.028496399877454],[-94.57271174677652,39.02851582586437],[-94.57284691787102,39.02851897602392]]]},"properties":{"id":"Rock Row Housing S"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57359514381248,39.02847208180017],[-94.57361271431651,39.028083475715746],[-94.57327990829927,39.02807143210462],[-94.57325923711807,39.028461644061366],[-94.57359514381248,39.02847208180017]]]},"properties":{"id":"Security Department"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57480409573863,39.03238485708068],[-94.57475834188774,39.03234294052741],[-94.57478743748095,39.0323230514835],[-94.57466523598949,39.03222270213117],[-94.57465592539967,39.03222903047291],[-94.57456281950141,39.032149474135494],[-94.57455234508787,39.032154898434065],[-94.57453256008448,39.03213591338722],[-94.5745418706743,39.03212868098708],[-94.57443596271503,39.03204189212767],[-94.57444294565741,39.03200392196817],[-94.57448600713533,39.031963239631786],[-94.57446854977943,39.03195419910939],[-94.57445691154213,39.0319668558404],[-94.57437893535234,39.031978608517164],[-94.57437078858625,39.03197318420506],[-94.57426022533207,39.03199216929562],[-94.57421018091178,39.031950582900116],[-94.57410660059993,39.03202561920467],[-94.5741217303084,39.03203737187166],[-94.57391816391097,39.03218429006349],[-94.5739193483118,39.03221373112918],[-94.57398567475879,39.03222937169034],[-94.57396790874621,39.03229653406067],[-94.57383525585222,39.03238485708068],[-94.5738127522363,39.03243637879136],[-94.57379024862033,39.03244833918312],[-94.57380209262874,39.03245661945314],[-94.573822227443,39.03244281900256],[-94.57387552548074,39.03242901854928],[-94.57400462517222,39.032327815142885],[-94.57410885244606,39.03231401466714],[-94.57411122124773,39.032375656771244],[-94.57415030647543,39.03237933689516],[-94.5743552078206,39.03223397185472],[-94.574367051829,39.03224501224803],[-94.57443811587935,39.03218705016392],[-94.57453642114899,39.032267093029475],[-94.57452220833892,39.03227813341762],[-94.57461577600522,39.03235817618002],[-94.57462880441446,39.032348055835755],[-94.57464538602619,39.03236553642948],[-94.57466078323709,39.03235541608627],[-94.57474369129585,39.03242809851896],[-94.57480409573863,39.03238485708068]]]},"properties":{"id":"St. Francis Xavier Church"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57151501542803,39.03292423985276],[-94.57133748256577,39.032919396176545],[-94.57133184858787,39.03302943092199],[-94.57151052617259,39.03303443249725],[-94.57151501542803,39.03292423985276]]]},"properties":{"id":"Campus Ministry Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57133184858787,39.03302943092199],[-94.57132503847693,39.033133258595875],[-94.57150408963523,39.03313923484835],[-94.57151052617259,39.03303443249725],[-94.57133184858787,39.03302943092199]]]},"properties":{"id":"Kateri Community Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57286010900144,39.03328693338342],[-94.57283532620258,39.03371719964933],[-94.5732878874704,39.0337356369808],[-94.57330546295397,39.03329801918155],[-94.57286010900144,39.03328693338342]]]},"properties":{"id":"Prosperity Center for Financial Opportunity"}}\r
]}`,zV=`{"type":"GeometryCollection", "geometries": [\r
{"type":"Polygon","coordinates":[[[-94.5733601221702,39.033991702842954],[-94.57343057843688,39.032627336829854],[-94.57483618218124,39.03266045740923],[-94.57483618218124,39.03225653248882],[-94.57456975228335,39.031925844267924],[-94.57443769998508,39.031865057522765],[-94.5734766527032,39.03184416206704],[-94.5737667714431,39.02721317928421],[-94.57318118713299,39.027186419902776],[-94.5731396822614,39.02830719202791],[-94.5726236948803,39.02827994478758],[-94.57256476148764,39.028963612429386],[-94.5679483123955,39.02883237317173],[-94.56774097288552,39.032390935290124],[-94.5688957036816,39.03245419936561],[-94.57042657308332,39.032720791128675],[-94.57108453863592,39.03274057444863],[-94.57121364975842,39.03280827134139],[-94.57119428309004,39.03315176939054],[-94.57150092200602,39.03315929122695],[-94.57153965534276,39.03306150729117],[-94.57173977758268,39.03306652185526],[-94.57178173869748,39.03329719141926],[-94.57214002206244,39.033307220513656],[-94.57216584428696,39.0332119440594],[-94.57283722212401,39.03322949499484],[-94.57279848878727,39.033964123097064],[-94.5733601221702,39.033991702842954]]]}\r
]}`;function S_(n){return typeof n=="string"?n.replace(/^\uFEFF/,""):n}const jV=JSON.parse(S_(DV)),UV=JSON.parse(S_(FV)),VV=JSON.parse(S_(OV)),qV=JSON.parse(S_(BV)),$V=JSON.parse(S_(zV));function k8(n){return Array.isArray(n)?n[0]||{}:n||{}}const GV=k8(EV),WV=k8(NV),tT={...GV,buildings:jV,boundary:UV,outdoorSpaces:VV},HV={...WV,buildings:qV,boundary:$V},XV={hastings:tT,"hastings-demo":tT,rockhurst:HV};function KV(n){return XV[n]}function yy({engagementMode:n=!1}){const{universityId:e,persona:t}=UL(),i=KV(e);return i?window.location.pathname.includes("/admin")?Q.jsx(SV,{config:i,universityId:e}):Q.jsx(wV,{config:i,universityId:e,persona:t,engagementMode:n}):Q.jsxs("div",{children:['Error: Configuration not found for "',e,'".']})}function ZV(){return Q.jsx(AP,{basename:"/StakeholderMap",children:Q.jsxs(nP,{children:[Q.jsx(Cm,{path:"/:universityId/admin",element:Q.jsx(yy,{})}),Q.jsx(Cm,{path:"/:universityId/engagement",element:Q.jsx(yy,{engagementMode:!0})}),Q.jsx(Cm,{path:"/:universityId/:persona",element:Q.jsx(yy,{})}),Q.jsx(Cm,{path:"/:universityId/survey",element:Q.jsx(yy,{})}),Q.jsx(Cm,{path:"/:universityId",element:Q.jsx(yy,{})}),Q.jsx(Cm,{path:"/",element:Q.jsx("div",{children:"Please select a university by navigating to its URL (e.g., /hastings)"})})]})})}const YV=uL.createRoot(document.getElementById("root"));YV.render(Q.jsx(ZV,{}));export{ba as _,JV as c,Dv as g};
